{"title":"Linux操作系统下的全局代理配置与实践","slug":"系统运维/Linux/运维实践/网络配置/Linux操作系统下的全局代理配置与实践","date":"2021-01-02T10:34:30.000Z","updated":"2021-01-12T03:23:19.482Z","url":"2021/1-2-518.html","path":"api/articles/2021/1-2-518.html.json","covers":null,"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"0x00-前言简述\"><a href=\"#0x00-前言简述\" class=\"headerlink\" title=\"0x00 前言简述\"></a>0x00 前言简述</h2><p>Q: 操作系统的全局代理?</p>\n<blockquote>\n<p>答：我们常常听说网络代理例如Socket、Http代理，全局代理即系统所有的流量都是通过该代理通道进行通信, 然而这个还不能说是全称走代理，只能说是90%的应用都可以使用这个设置来实现代理访问，但这个只是针对于个别软件由于他们更不都不走http协议，所有代理的方式不是绝对的，只有网关流量代理是完全代理的;</p>\n</blockquote>\n<p>Q: 网上关于Linux中http_proxy的设置说明错误</p>\n<blockquote>\n<p>答: Linux操作系统全局代理配置主要在于环境变量的设置 http_proxy 该变量是支持http以及socket的;<br>比如 curl、git 软件默认使用http_proxy这个环境变量来设置代理服务器，所以在linux下只要设置了 http_proxy 环境变量就能被这些软件识别;<br>比如 chrome 和 yum 软件针对http_proxy可能不会生效，比如chrome用的是server_proxy这个变量，而且是在启动时设置才生效。</p>\n</blockquote>\n<hr>\n<h2 id=\"0x01-代理服务搭建\"><a href=\"#0x01-代理服务搭建\" class=\"headerlink\" title=\"0x01 代理服务搭建\"></a>0x01 代理服务搭建</h2><hr>\n<h2 id=\"0x02-代理配置\"><a href=\"#0x02-代理配置\" class=\"headerlink\" title=\"0x02 代理配置\"></a>0x02 代理配置</h2><h3 id=\"Linux-全局代理\"><a href=\"#Linux-全局代理\" class=\"headerlink\" title=\"Linux 全局代理\"></a>Linux 全局代理</h3><p><strong>操作系统中代理变量的配置:</strong></p>\n<table>\n<thead>\n<tr>\n<th>环境变量</th>\n<th>描述</th>\n<th>值示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>http_proxy</td>\n<td>为http变量设置代理；默认不填开头以http协议传输</td>\n<td><a href=\"http://10.0.0.51:8080\" target=\"_blank\" rel=\"noopener\">http://10.0.0.51:8080</a> <br> <a href=\"http://user:pass@10.0.0.10:8080\" target=\"_blank\" rel=\"noopener\">http://user:pass@10.0.0.10:8080</a>  <br>  socks4://10.0.0.51:1080 <br> socks5://192.168.1.1:1080</td>\n</tr>\n<tr>\n<td>https_proxy</td>\n<td>为https变量设置代理；</td>\n<td>同上</td>\n</tr>\n<tr>\n<td>ftp_proxy</td>\n<td>为ftp变量设置代理；</td>\n<td>同上</td>\n</tr>\n<tr>\n<td>all_proxy</td>\n<td>全部变量设置代理，设置了这个时候上面的不用设置</td>\n<td>同上</td>\n</tr>\n<tr>\n<td>no_proxy</td>\n<td>无需代理的主机或域名； 可以使用通配符； 多个时使用“,”号分隔；</td>\n<td><em>.aiezu.com,10.</em>.<em>.</em>,192.168.<em>.</em>, *.local,localhost,127.0.0.1</td>\n</tr>\n</tbody>\n</table>\n<p><strong>设置方式:</strong></p>\n<ul>\n<li><p>(1) 临时生效(当前shell下)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> proxy=<span class=\"string\">\"http://192.168.5.14:8118\"</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> http_proxy=<span class=\"variable\">$proxy</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> https_proxy=<span class=\"variable\">$proxy</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> ftp_proxy=<span class=\"variable\">$proxy</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> no_proxy=<span class=\"string\">\"localhost, 127.0.0.1, ::1\"</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>(2) 永久生效</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 针对上面变量的设置方法</span></span><br><span class=\"line\">1、在/etc/profile文件</span><br><span class=\"line\">2、在~/.bashrc</span><br><span class=\"line\">3、在~/.zshrc</span><br><span class=\"line\">4、在/etc/profile.d/文件夹下新建一个文件xxx.sh</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 例如</span></span><br><span class=\"line\">sudo tee /etc/profile.d/custom_proxy.sh &lt;&lt;<span class=\"string\">'END'</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> proxy=<span class=\"string\">\"http://192.168.1.1:8080\"</span></span><br><span class=\"line\"><span class=\"comment\"># export proxy=\"socks5://192.168.1.1:1080\"</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> http_proxy=<span class=\"variable\">$proxy</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> https_proxy=<span class=\"variable\">$proxy</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> ftp_proxy=<span class=\"variable\">$proxy</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> no_proxy=<span class=\"string\">\"localhost, 127.0.0.1, ::1\"</span></span><br><span class=\"line\">END</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><strong>取消环境变量的设置：</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">unset</span> http_proxy</span><br><span class=\"line\"><span class=\"built_in\">unset</span> https_proxy</span><br><span class=\"line\"><span class=\"built_in\">unset</span> ftp_proxy</span><br><span class=\"line\"><span class=\"built_in\">unset</span> no_proxy</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"Ubuntu-apt-代理配置\"><a href=\"#Ubuntu-apt-代理配置\" class=\"headerlink\" title=\"Ubuntu-apt 代理配置\"></a>Ubuntu-apt 代理配置</h3><p>代理参数命令:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 使用 Squid cache（简称为Squid）是一个流行的自由软件（GNU通用公共许可证）的代理服务器和Web缓存服务器。</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> http_proxy=http://192.168.1.2:3128</span><br><span class=\"line\"><span class=\"built_in\">export</span> https_proxy=http://192.168.1.2:3128</span><br><span class=\"line\">sudo apt -o Acquire::http::proxy=<span class=\"string\">\"http://192.168.1.2:3128/\"</span> update</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"CentOS-yum-代理配置\"><a href=\"#CentOS-yum-代理配置\" class=\"headerlink\" title=\"CentOS-yum 代理配置\"></a>CentOS-yum 代理配置</h3><p>yum代理配置文件变量配置:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 单独设置yum代理访问，如下文件的变量</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"proxy=http://127.0.0.1:8080/\"</span> &gt;&gt; /etc/yum.conf</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"Tsocks-代理配置\"><a href=\"#Tsocks-代理配置\" class=\"headerlink\" title=\"Tsocks 代理配置\"></a>Tsocks 代理配置</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 客户端</span></span><br><span class=\"line\">$ sudo apt-get install tsocks</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 配置文件</span></span><br><span class=\"line\">$ sudo vi /etc/tsocks.conf</span><br><span class=\"line\"><span class=\"comment\"># 把Server设置为你的代理服务器IP，一般为127.0.0.1</span></span><br><span class=\"line\"><span class=\"comment\"># 把Server_type设置为5</span></span><br><span class=\"line\"><span class=\"comment\"># 把Server_port设置为与代理服务器对应的配置</span></span><br></pre></td></tr></table></figure>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Linux","path":"api/categories/Linux.json"},{"name":"远程桌面","path":"api/categories/远程桌面.json"}],"tags":[{"name":"xrdp","path":"api/tags/xrdp.json"}]}