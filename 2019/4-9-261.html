<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ é«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆ(DBA).md|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="é«˜å¯ç”¨æœåŠ¡">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>é«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆ(DBA).md</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">é«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆ(DBA).md</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-04-09T06:34:30.000Z" itemprop="datePublished" class="page-time">
  2019-04-09
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/">ç³»ç»Ÿæ¶æ„</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/%E8%BF%90%E7%BB%B4%E5%9F%BA%E7%A1%80/">è¿ç»´åŸºç¡€</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-ç³»ç»Ÿè¿ç»´/ç³»ç»Ÿæ¶æ„/é«˜å¯ç”¨/Heartbeaté«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆ"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">é«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆ(DBA).md</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-04-09 14:34:30" datetime="2019-04-09T06:34:30.000Z"  itemprop="datePublished">2019-04-09</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/">ç³»ç»Ÿæ¶æ„</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/%E8%BF%90%E7%BB%B4%E5%9F%BA%E7%A1%80/">è¿ç»´åŸºç¡€</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<h4 id="æ–‡ç« ç›®å½•"><a href="#æ–‡ç« ç›®å½•" class="headerlink" title="æ–‡ç« ç›®å½•"></a>æ–‡ç« ç›®å½•</h4><p>(1) Heartbeat é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ</p>
<a id="more"></a>
<h4 id="0x00-Heartbeat-é«˜å¯ç”¨"><a href="#0x00-Heartbeat-é«˜å¯ç”¨" class="headerlink" title="0x00 Heartbeat é«˜å¯ç”¨"></a>0x00 Heartbeat é«˜å¯ç”¨</h4><p><em>Q:ä»€ä¹ˆæ˜¯é«˜å¯ç”¨æŠ€æœ¯å‘¢ï¼Ÿ</em><br>ç­”ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æˆ‘æ—¢è¦ä¿è¯æœåŠ¡ä¸é—´æ–­çš„æœåŠ¡åˆè¦ä¿è¯æœåŠ¡å™¨ç¨³å®šä¸downæœºï¼Œä½†æ˜¯å¼‚å¸¸è¿˜æ˜¯ä¼šå‘ç”Ÿ;<br>æ¯”å¦‚è¯´æœåŠ¡å™¨ç¡¬ä»¶æŸåå¯¼è‡´æœåŠ¡å™¨downæœº,æˆ‘è¯¥å¦‚ä½•ä¿è¯æœåŠ¡å™¨downæœºåç»§ç»­æä¾›æœåŠ¡å‘¢ï¼Ÿè¿™æ—¶æˆ‘å°±åº”è¯¥è¯·å‡ºé«˜å¯ç”¨æŠ€æœ¯æ¥å¸®å¿™äº†ï¼Œå½“æˆ‘ä»¬çš„æœåŠ¡å™¨å‘ç”Ÿæ•…éšœåä¸èƒ½ç»§ç»­æ—¶ï¼Œé«˜å¯ç”¨é›†ç¾¤æŠ€æœ¯è§£å†³å°†ä¸šåŠ¡åŠæœåŠ¡è‡ªåŠ¨è½¬ç§»è‡³å…¶ä»–ä¸»æœºæœåŠ¡å™¨ä¸Šç»§ç»­æœåŠ¡ï¼Œä¿è¯æœåŠ¡æ¶æ„ä¸é—´æ–­è¿è¡Œã€‚</p>
<h5 id="1-Heartbeat-ä»‹ç»"><a href="#1-Heartbeat-ä»‹ç»" class="headerlink" title="1) Heartbeat ä»‹ç»"></a>1) Heartbeat ä»‹ç»</h5><p><strong>1.1 Heartbeatä½œç”¨</strong><br>æè¿°ï¼šæ˜¯Linux-HA å·¥ç¨‹çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ï¼Œå®ƒå®ç°äº†ä¸€ä¸ªé«˜å¯ç”¨é›†ç¾¤ç³»ç»Ÿ,å¸¸å¸¸ä½¿ç”¨åœ¨åˆ†åŒºé›†ç¾¤ç­‰å¤§å‹æ¶æ„ä¸­<br>é€šè¿‡heartbeat,å¯ä»¥å°†èµ„æºï¼ˆipä»¥åŠç¨‹åºæœåŠ¡ç­‰èµ„æºï¼‰ä»ä¸€å°å·²ç»æ•…éšœçš„è®¡ç®—æœºå¿«é€Ÿè½¬ç§»åˆ°å¦ä¸€å°æ­£å¸¸è¿è½¬çš„æœºå™¨ä¸Šç»§ç»­æä¾›æœåŠ¡,ä¸€èˆ¬ç§°ä¹‹ä¸ºé«˜å¯ç”¨æœåŠ¡;</p>
<p>heartbeatå’Œkeepalived(è¿‘å¹´æ¥ä½¿ç”¨å¢åŠ ,ä½†æ˜¯æŸäº›åœºæ™¯è¿˜æ˜¯ä¸åŠhb)æœ‰å¾ˆå¤šç›¸åŒä¹‹å¤„,ä½†æ˜¯ä¹Ÿæœ‰åŒºåˆ«:</p>
<ol>
<li>Keepalived</li>
</ol>
<ul>
<li>ä½¿ç”¨çš„vrrpåè®®æ–¹å¼,è™šæ‹Ÿè·¯ç”±å†—ä½™åè®® (Virtual Router Redundancy Protocolï¼Œç®€ç§°VRRP)</li>
<li>ç›®çš„æ˜¯æ¨¡æ‹Ÿè·¯ç”±å™¨çš„åŒæœº</li>
<li>å¸¸å¸¸ä¸lvsè´Ÿè½½å‡è¡¡çš„é«˜å¯ç”¨ä¸­ä½¿ç”¨ç»“åˆ</li>
<li>kaä¸»è¦æ§åˆ¶IPé£˜ç§»ï¼Œé…ç½®åº”ç”¨ç®€å•ï¼Œè€Œä¸”åˆ†å±‚ï¼Œlayer3ï¼Œ4ï¼Œ5ï¼Œå„è‡ªé…ç½®æä¸ºç®€å•</li>
</ul>
<ol start="2">
<li>Heartbeat</li>
</ol>
<ul>
<li>åŸºäºä¸»æœºæˆ–ç½‘ç»œçš„æœåŠ¡çš„é«˜å¯ç”¨æ–¹å¼ï¼›</li>
<li>ç›®çš„æ˜¯ç”¨æˆ·serviceçš„åŒæœº</li>
<li>ä¸­é—´ä»¶ä¸šåŠ¡çš„é«˜å¯ç”¨ä¸­ä½¿ç”¨ä½†æ˜¯ä¸lvsè´Ÿè½½å‡è¡¡é…ç½®æ¯”è¾ƒéº»çƒ¦éœ€è¦å…¶ä»–è„šæœ¬ä»‹å…¥(ldirectord),å¸¸å¸¸ä¸drbdè¿›è¡Œè”åˆä½¿ç”¨</li>
<li>hbä¸ä½†å¯ä»¥æ§åˆ¶IPé£˜ç§»ï¼Œæ›´æ“…é•¿å¯¹èµ„æºæœåŠ¡çš„æ§åˆ¶ï¼Œé…ç½®ï¼Œåº”ç”¨äºæ¯”è¾ƒå¤æ‚åœºæ™¯</li>
</ul>
<p><strong>1.2 Heartbeatå·¥ä½œåŸç†</strong><br>æè¿°ï¼šé€šè¿‡ä¿®æ”¹heartbeatçš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æŒ‡å®šä¸€å°heartbeatæœåŠ¡å™¨ä½œä¸ºä¸»æœåŠ¡å™¨ï¼Œå¦ä¸€å°è‡ªåŠ¨æˆä¸ºçƒ­å¤‡æœåŠ¡å™¨ã€‚<br>åœ¨çƒ­å¤‡æœåŠ¡å™¨ä¸Šé¢é…ç½®heartbeatå®ˆæŠ¤ç¨‹åºæ¥ç›‘å¬æ¥è‡ªä¸»æœåŠ¡å™¨çš„å¿ƒè·³ä¿¡æ¯;å¦‚æœåœ¨è§„å®šæ—¶é—´å†…ï¼Œæ— æ³•ç›‘å¬åˆ°å¿ƒè·³ä¿¡æ¯ï¼Œé‚£ä¹ˆå°±å¯åŠ¨æ•…éšœè½¬ç§»ï¼Œå–å¾—ä¸»æœåŠ¡å™¨ä¸Šçš„ç›¸å…³èµ„æºçš„æ‰€æœ‰æƒï¼Œæ¥æ›¿ä¸»æœåŠ¡å™¨ç»§ç»­ä¸é—´æ–­çš„æä¾›æœåŠ¡ï¼Œä»è€Œè¾¾åˆ°èµ„æºä»¥åŠæœåŠ¡é«˜å¯ç”¨çš„ç›®çš„;</p>
<p>Heartbeatæ”¯æŒæ¨¡å¼ï¼š</p>
<ul>
<li>ä¸»ä»æ¨¡å¼</li>
<li>ä¸»ä¸»æ¨¡å¼</li>
<li>äº’ä¸ºä¸»å¤‡</li>
</ul>
<p>ä¸€èˆ¬æ•…éšœè½¬ç§»åˆ‡æ¢æ—¶é—´åœ¨5~20sä¹‹é—´(hearbeatéœ€è¦è¿›è¡Œarpå¹¿æ’­,èµ„æºæ”¶ç¼©ç­‰);<em>å’Œkeepalivedçš„æœåŠ¡ä¸€æ ·ï¼Œheartbeaté«˜å¯ç”¨æ˜¯æœåŠ¡å™¨çº§åˆ«çš„ï¼Œä¸æ˜¯æœåŠ¡çº§åˆ«çš„</em>ã€‚ </p>
<p><em>åˆ‡æ¢æ¼‚ç§»çš„æ¡ä»¶ï¼š</em></p>
<ol>
<li>ä¸»æœåŠ¡å™¨ç‰©ç†å®•æœºï¼ˆç¡¬ä»¶æŸåï¼Œæ“ä½œç³»ç»Ÿæ•…éšœï¼‰</li>
<li>heartbeatè½¯ä»¶æ•…éšœ</li>
<li>ä¸¤å°ä¸»å¤‡æœåŠ¡å™¨ä¹‹é—´å¿ƒè·³è¿æ¥æ•…éšœ<br>æœåŠ¡æ•…éšœä¸ä¼šå¯¼è‡´åˆ‡æ¢,å¯ä»¥é€šè¿‡æœåŠ¡å®•æœºæŠŠheartbeatæœåŠ¡åœæ‰ã€‚ </li>
</ol>
<p><strong>1.3 Heartbeatå¿ƒè·³è¿æ¥</strong><br>é«˜å¯ç”¨æœåŠ¡å™¨ä¸Šçš„Heartbeatè½¯ä»¶ä¼šåˆ©ç”¨è¿™æ¡å¿ƒè·³è¿æ¥çº¿æ¥æ£€æŸ¥å¯¹ç«¯çš„æœºå™¨é‡Šæ”¾å­˜æ´»,è¿›è€Œå†³å®šæ˜¯å¦åšæ•…éšœæ¼‚ç§»,èµ„æºåˆ‡æ¢æ¥ä¿è¯ä¸šåŠ¡çš„è¿ç»­æ€§;<br><em>Q:å¦‚ä½•è¿›è¡Œå¿ƒè·³è¿æ¥ä¸ç›‘æ§?</em><br>ç­”ï¼šè‡³å°‘éœ€è¦ä¸¤å°ä¸»æœºæ‰å¯ä»¥å®ç°é«˜å¯ç”¨æœåŠ¡,é‡‡ç”¨é€šä¿¡æŠ€æœ¯ä½¿ä¸¤å°heartbeatæœåŠ¡ä¹‹é—´é€šä¿¡;</p>
<ul>
<li>ç©¿è¡Œç”µç¼†ï¼Œæ‰€è°“çš„ä¸²å£Serialï¼ˆé¦–å…ˆï¼Œç¼ºç‚¹æ˜¯è·ç¦»ä¸èƒ½å¤ªè¿œï¼‰</li>
<li>ä¸€æ ¹ä»¥å¤ªç½‘ç”µç¼†ä¸¤ç½‘å¡ç›´è¿ï¼ˆå¸¸ç”¨æ–¹å¼ï¼‰</li>
<li>ä»¥å¤ªç½‘ç”µç¼†ï¼Œé€šè¿‡äº¤æ¢æœºç­‰ç½‘ç»œè®¾å¤‡è¿æ¥ã€‚ï¼ˆäº¤æ¢æœºå¯èƒ½å‡ºç°é—®é¢˜,å¿ƒè·³æ•°æ®å®¹æ˜“å—åˆ°å½±å“ç­‰ï¼‰ </li>
</ul>
<p><strong>1.4 Heartbeatåº”ç”¨åœºæ™¯</strong></p>
<ul>
<li>Nginx/haproxyé«˜å¯ç”¨</li>
<li>æ•°æ®åº“ä¸»ä»åº“ä¸»çš„é«˜å¯ç”¨</li>
<li>LVS-DRè´Ÿè½½å‡è¡¡é«˜å¯ç”¨</li>
<li>å…±äº«å­˜å‚¨é«˜å¯ç”¨</li>
</ul>
<p>å®é™…å·¥ä½œä¸­ä¸¤ç§é«˜å¯ç”¨é—®é¢˜ï¼š<br>(1) hbä»…ä»…æ§åˆ¶vipèµ„æº,ä¸è´Ÿè´£æœåŠ¡èµ„æºçš„å¯åŠ¨åŠåœæ­¢;æ¯”å¦‚ä¸‹é¢çš„Heartbeat å®‰è£…ä¸é…ç½®(WebæœåŠ¡)<br>(2) hbå³æ§åˆ¶vipèµ„æºçš„æ¼‚ç§»,åŒæ—¶åˆæ§åˆ¶æœåŠ¡èµ„æºå¯åŠ¨åŠåœæ­¢;æ¯”å¦‚ä¸‹é¢çš„å®ä¾‹;(é€‚åˆæ•°æ®åº“å’Œå­˜å‚¨)</p>
<p>å…¶ä»–æ¶æ„å‚è€ƒï¼š<br>(1) heartbeat+drbd+mysql     #æ•°æ®åº“é«˜å¯ç”¨ (åé¢ä¼šè¿›è¡Œè®²è§£)<br>(2) heartbeat+active+nfs/mfs #å­˜å‚¨é«˜å¯ç”¨</p>
<p><em>Tips:</em></p>
<ul>
<li>ä¸€èˆ¬æ¥è¯´åªæœ‰å†…ç½‘æœºå™¨å¾ˆå¤šçš„æƒ…å†µä¸‹,æ‰æœ‰å¯èƒ½ä½¿ç”¨heartbeat,å‡ å°æœºå™¨æ˜¯æ²¡æœ‰å¿…è¦çš„ï¼›</li>
<li>å¦‚æœVIPæ­£å¸¸httpdæœåŠ¡å®•æ‰è¿™æ—¶å€™å®ƒæœ‰å¯èƒ½ä¸åšé«˜å¯ç”¨åˆ‡æ¢;éœ€è¦è‡ªå·±å†™ä¸ªè„šæœ¬åˆ¤æ–­httpdæœåŠ¡,å¦‚æœæœ‰é—®é¢˜åˆ™åœæ­¢hbä½¿ä¸šåŠ¡è½¬åˆ°å¦å¤–ä¸€å°æœåŠ¡å™¨ä¸Š;</li>
</ul>
<p><br></p>
<h5 id="2-Heartbeat-è„‘è£‚ä»‹ç»"><a href="#2-Heartbeat-è„‘è£‚ä»‹ç»" class="headerlink" title="2) Heartbeat è„‘è£‚ä»‹ç»"></a>2) Heartbeat è„‘è£‚ä»‹ç»</h5><p><em>è£‚è„‘(splitbrain)åŸç†ï¼š</em><br>ä¸¤å°æœåŠ¡å™¨åœ¨ä¸€å®šæ—¶é—´å†…ï¼Œæ— æ³•ç›¸äº’æ£€æµ‹åˆ°å¯¹æ–¹å¿ƒè·³è€Œå„è‡ªå¯åŠ¨æ•…éšœè½¬ç§»åŠŸèƒ½ï¼Œå–å¾—èµ„æºå’ŒæœåŠ¡çš„æ‰€æœ‰æƒï¼Œä¼šå¯¼è‡´åŒä¸€ä¸ªIPåœ¨ä¸¤ç«¯åŒæ—¶å¯åŠ¨æœåŠ¡ï¼Œå­˜åœ¨ä¸¤ä¸ªç›¸åŒçš„VIPï¼Œé€ æˆå†²çªå¯èƒ½å¯¼è‡´æœåŠ¡å™¨ä¸¤ç«¯çš„æ•°æ®ä¸ä¸€è‡´æˆ–æ•°æ®ä¸¢å¤±;(å³å…±äº«èµ„æºè¢«ç“œåˆ†ï¼ŒæœåŠ¡éƒ½èµ·ä¸èµ·æ¥äº†åˆæˆ–è€…æœåŠ¡éƒ½èµ·æ¥ï¼Œä½†æ˜¯å…±äº«èµ„æºåŒæ—¶å†™ï¼Œæœ€åæ•°æ®å°±è¢«ç ´åäº†ï¼)</p>
<p><strong>2.1 è£‚è„‘åŸå› </strong></p>
<ul>
<li>å¿ƒè·³é“¾è·¯æ•…éšœ(å¿ƒè·³çº¿è€åŒ–,æ¥è§¦ä¸è‰¯,ç½‘å¡é©±åŠ¨é—®é¢˜ç­‰ç­‰),å¯¼è‡´æ— æ³•æ­£å¸¸é€šä¿¡ </li>
<li>å¼€å¯äº†é˜²ç«å¢™é˜»æŒ¡äº†å¿ƒè·³ä¿¡æ¯ä¼ è¾“;</li>
<li>å¿ƒè·³ç½‘å¡åœ°å€ç­‰é…ç½®ä¸æ­£ç¡®;</li>
<li>æœåŠ¡é…ç½®é”™è¯¯,å¿ƒè·³æ–¹å¼å¼‚å¸¸ï¼Œå¿ƒè·³å¹¿æ’­å†²çªï¼Œè½¯ä»¶bug;</li>
</ul>
<p><strong>2.2 è£‚è„‘è§£å†³</strong></p>
<ul>
<li>åŒæ—¶ä½¿ç”¨ä¸²è¡Œç”µç¼†å’Œä»¥å¤ªç½‘ç”µç¼†è¿æ¥ï¼ŒåŒæ—¶ä½¿ç”¨ä¸¤æ¡å¿ƒè·³çº¿ï¼ˆæ¨èï¼‰</li>
<li>æ£€æµ‹åˆ°è£‚è„‘æ—¶,å¼ºåˆ¶å…³é—­ä¸€ä¸ªèŠ‚ç‚¹(éœ€è¦ç‰¹æ®Šè®¾å¤‡æ”¯æŒ,å¦‚stonishå’Œfence), ç›¸å½“äºç¨‹åºä¸Šçš„å¤‡èŠ‚ç‚¹å‘ç°å¿ƒè·³æ•…éšœï¼Œå‘é€å…³æœºæŒ‡ä»¤åˆ°ä¸»èŠ‚ç‚¹</li>
<li>ç›‘æ§é¢„è­¦(çŸ­ä¿¡ç”µè¯é€šçŸ¥è¿ç»´äººå‘˜),æŠ¥è­¦åœ¨æœåŠ¡å™¨æ¥ç®¡ä¹‹å‰ç»™äººå‘˜å¤„ç†ç•™è¶³æ—¶é—´,æŠ¥è­¦åä¸ç›´æ¥æœåŠ¡å™¨æ­¤æ—¶æ¥ç®¡è€Œæ˜¯ç”±äººå‘˜æ¥æ§åˆ¶æ“ä½œ</li>
<li>å¯ç”¨ç£ç›˜é”,åšå†—ä½™</li>
<li>ä»²è£æœºåˆ¶ï¼ˆç¡®å®šè®©é‚£ä¸ªèŠ‚ç‚¹æ¥ç®¡æœåŠ¡ï¼‰, é€šè¿‡ç¬¬ä¸‰æ–¹è½¯ä»¶ä»²è£è°è·å¾—èµ„æº;</li>
</ul>
<p><strong>2.3 fenceä»‹ç»</strong><br>æè¿°ï¼šFenceæ˜¯HAé›†ç¾¤ç¯å¢ƒä¸‹çš„æœ¯è¯­,åœ¨ç¡¬ä»¶é¢†åŸŸfenceè®¾å¤‡å…¶å®å°±æ˜¯ä¸€ä¸ªæ™ºèƒ½ç”µæºç®¡ç†è®¾å¤‡(IPMI,Intelligent PowerManagement Interface);å…¶åˆ†ä¸ºå†…/å¤–éƒ¨fence,è¿™äº›è®¾å¤‡éƒ½æœ‰ä»¥å¤ªç½‘å£çš„,ç”¨æ¥åœ¨HAåˆ‡æ¢è§¦å‘æ—¶é€šè¿‡ç½‘ç»œé‡å¯æä¾›èµ„æºæœåŠ¡çš„æœåŠ¡å™¨;</p>
<p>ä¸åŒæœåŠ¡å™¨å¯¹åº”Fenceè®¾å¤‡åç§°ï¼š</p>
<ul>
<li>IBMï¼šRSA II</li>
<li>HPï¼šILO 2</li>
<li>DELLï¼šiDRAC 3</li>
<li>å¤–éƒ¨fenceè®¾å¤‡ï¼šæœ‰APCï¼ˆUPSç”µæºç”Ÿäº§å•†ï¼‰ç”Ÿäº§çš„PowerSwitch </li>
</ul>
<h5 id="3-Heartbeat-æ¶ˆæ¯åˆ—è¡¨"><a href="#3-Heartbeat-æ¶ˆæ¯åˆ—è¡¨" class="headerlink" title="3) Heartbeat æ¶ˆæ¯åˆ—è¡¨"></a>3) Heartbeat æ¶ˆæ¯åˆ—è¡¨</h5><p>é«˜å¯ç”¨è½¯ä»¶å·¥ä½œè¿‡ç¨‹ä¸­,ä¸€èˆ¬æ¥è¯´ç”±ä¸‰ç§æ¶ˆæ¯ç±»å‹ï¼š</p>
<ul>
<li>å¿ƒè·³ä¿¡æ¯ï¼š150å­—èŠ‚çš„æ•°æ®åŒ…,å¯èƒ½ä¸ºå•æ’­,å¹¿æ’­æˆ–å¤šæ’­æ–¹å¼;å¯ä»¥æ§åˆ¶å¿ƒè·³é¢‘ç‡ä¸å‡ºç°æ•…éšœçš„ç­‰å¾…æ—¶é—´;</li>
<li>é›†ç¾¤è½¬æ¢æ¶ˆæ¯: ip-request (Master æ¢å¤åœ¨çº¿çŠ¶æ€æ—¶) / ip-request-rsp (Slave é‡Šæ”¾ä¸»æœåŠ¡å™¨å¤±è´¥æ—¶å–å¾—çš„èµ„æºåŠæœåŠ¡),ä¸»æœåŠ¡å™¨æ”¶åˆ°å¤‡èŠ‚ç‚¹çš„è¯¥æ¶ˆæ¯åˆ™æä¾›æ­£å¸¸è®¿é—®;</li>
<li>é‡ä¼ æ¶ˆæ¯ï¼šrexmit-request æ§åˆ¶é‡ä¼ å¿ƒè·³è¯·æ±‚ </li>
</ul>
<p><a rel=é«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆ(DBA).md href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190406230526.png" target="_blank" title="WeiyiGeek.é›†ç¾¤è½¬æ¢æ¶ˆæ¯" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190406230526.png" alt="WeiyiGeek.é›†ç¾¤è½¬æ¢æ¶ˆæ¯"></a></p>
<p>æç¤ºï¼šä»¥ä¸Šå¿ƒè·³æ§åˆ¶æ¶ˆæ¯éƒ½ä½¿ç”¨UDPåè®®å‘ç”Ÿåˆ°/etc/ha.d/ha.cf æ–‡ä»¶æŒ‡å®šçš„ä»»æ„ç«¯å£æˆ–è€…æŒ‡å®šå¤šæ’­åœ°å€;</p>
<p><strong>3.1 IPåœ°å€æ¥ç®¡å’Œæ•…éšœè½¬ç§»</strong><br>é€šè¿‡IPåœ°å€æ¥ç®¡å’ŒARPå¹¿æ’­è¿›è¡Œæ•…éšœè½¬ç§»çš„,ARPå¹¿æ’­åœ¨ä¸»æœåŠ¡å™¨æ•…éšœæ—¶å€™,å¤‡ç”¨èŠ‚ç‚¹æ¥ç®¡èµ„æºå,ä¼šç«‹å³å¼ºåˆ¶æ›´æ–°æ‰€æœ‰Clientæœ¬åœ°arpè¡¨(VIPåœ°å€ä¸macåœ°å€çš„è§£æè®°å½•),<em>ç¡®ä¿å®¢æˆ·ç«¯å’Œæ–°çš„æœåŠ¡å™¨å¯¹è¯</em>;</p>
<p><strong>3.2 VIP/IP åˆ«å/è¾…åŠ©IP</strong></p>
<ul>
<li><p>çœŸå®IPåˆç§°ä¸ºç®¡ç†/ç‰©ç†ipï¼Œä¸€èˆ¬æŒ‡é…ç½®åœ¨ç‰©ç†ç½‘å¡ä¸Šé¢çš„ipã€‚åœ¨è´Ÿè½½å‡è¡¡é«˜å¯ç”¨ç¯å¢ƒä¸­ï¼Œç®¡ç†IPæ˜¯ä¸å¯¹å¤–æä¾›è®¿é—®æœåŠ¡çš„ã€‚ä»…ä»…ä½œä¸ºç®¡ç†æœåŠ¡å™¨ä½¿ç”¨ï¼Œå¦‚SSHå¯ä»¥é€šè¿‡è¿™ä¸ªè¿›è¡ŒæœåŠ¡è¿æ¥ç®¡ç†ã€‚</p>
</li>
<li><p>VIPæ˜¯è™šæ‹Ÿip,å®é™…ä¸Šå°±æ˜¯eth0:Xï¼Œxä¸º0~255çš„ä»»æ„æ•°å­—ï¼Œä½ å¯ä»¥åœ¨ä¸€ä¸ªç½‘å¡ä¸Šé¢ç»‘å®šå¤šä¸ªåˆ«åã€‚VIPå½“ä¸»æœåŠ¡å™¨æ•…éšœæ—¶ï¼Œå¯ä»¥è‡ªåŠ¨æ¼‚ç§»åˆ°å¤‡ç”¨æœåŠ¡å™¨ã€‚</p>
</li>
</ul>
<p>æ³¨æ„åŒºåˆ«è¾…åŠ©ipå’Œåˆ«åipï¼Œkeepalivedå’Œheartbeat3éƒ½æ˜¯ç”¨è¾…åŠ©ipçš„å½¢å¼;åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­éœ€è¦åœ¨DNSé…ç½®ä¸­æŠŠç½‘ç«™åŸŸååœ°å€è§£æåˆ°VIPåœ°å€è€Œå¹¶å‘éçœŸå®IPåœ°å€;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¾…åŠ©ipè®¾ç½®ï¼š(HA/HB3 ç°åœ¨éƒ½é‡‡ç”¨è¿™ä¸ª)</span></span><br><span class="line">ip addr add 192.168.12.1/24 broadcast 192.168.12.255 dev eth1</span><br><span class="line">ip addr del 192.168.12.1/24 broadcast 192.168.12.255 dev eth1</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ«åipè®¾ç½®ï¼šï¼ˆæ”¶å·¥è®¾ç½® HB2ç‰ˆæœ¬æ—¶å€™ä½¿ç”¨ï¼‰</span></span><br><span class="line">ifconfig eth0:1 192.168.12.1 netmask 255.255.255.224 up</span><br><span class="line">ifconfig eth0:1 192.168.12.1 netmask 255.255.255.224 down</span><br></pre></td></tr></table></figure>
<p>ç®¡ç†IP/VIPå¯¹æ¯”ï¼š</p>
<ul>
<li>ç®¡ç†IPæ¥å›è¿ç§»éå¸¸éš¾åšåˆ°</li>
<li>VIP æ–¹ä¾¿ç®¡ç†ä¸é…ç½®</li>
</ul>
<h5 id="4-Heartbeat-å®‰è£…ä¸é…ç½®"><a href="#4-Heartbeat-å®‰è£…ä¸é…ç½®" class="headerlink" title="4) Heartbeat å®‰è£…ä¸é…ç½®"></a>4) Heartbeat å®‰è£…ä¸é…ç½®</h5><p><strong>1.ç¯å¢ƒéœ€æ±‚ä»‹ç»</strong><br>éœ€æ±‚ï¼šå½“Master-data1æˆ–è€…Master-data2ä»»æ„ä¸€å°æœåŠ¡å™¨å®•æœº,å†å®•æœºçš„æœºå™¨ä¸Šåˆå§‹å¯åŠ¨çš„è™šæ‹ŸVIPå°±ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°è¿ä½œæ­£å¸¸çš„æœºå™¨ä¸Š,å®ç°IPèµ„æºçš„è‡ªåŠ¨æ¥ç®¡,ä»è€Œè¾¾åˆ°é«˜å¯ç”¨æ— ä¸šåŠ¡å½±å“çš„ç›®çš„; </p>
<p>åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­,ä¹Ÿå¯ä»¥é…ç½®ä¸»å¤‡æ¨¡å¼,å³åªåœ¨ä¸»çš„ä¸€ç«¯é…ç½®VIP,å¤‡çš„ä¸€ç«¯ä»…å¤„äºçƒ­å¤‡çŠ¶æ€;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ç³»ç»Ÿï¼šCentOS release 6.10 (Final) </span><br><span class="line">å†…æ ¸ï¼šLinux WeiyiGeek 2.6.32-754.10.1.el6.i686 2019 GNU/Linux</span><br><span class="line">è™šæ‹Ÿè½¯ä»¶ï¼šVirtualBOX (ç®¡ç†-&gt; å…¨å±€è®¾å®š -&gt; NAT ç½‘ç»œ -&gt; é…ç½®ä¸¤ä¸ª1/2ç½‘æ®µå°†è‡ªåŠ¨è·å–IPå»æ‰)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æœºå™¨1 Master-data1 </span></span><br><span class="line">ç®¡ç†IP ï¼š192.168.1.100</span><br><span class="line">å¿ƒè·³è¿æ¥ï¼š192.168.2.100</span><br><span class="line">VIP ï¼š192.168.1.10</span><br><span class="line"></span><br><span class="line"><span class="comment">#æœºå™¨2 Master-data2 </span></span><br><span class="line">ç®¡ç†IP ï¼š192.168.1.101</span><br><span class="line">å¿ƒè·³è¿æ¥ï¼š192.168.2.101</span><br><span class="line">VIP ï¼š192.168.1.11</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸¤å°æœºå™¨éƒ½å…³é—­é˜²ç«å¢™å’Œunixå®‰å…¨</span></span><br><span class="line"><span class="comment">#å…³é—­iptableså’Œselinuxï¼š </span></span><br><span class="line">[root@Master-data1/2 ~]<span class="comment"># getenforce</span></span><br><span class="line">Disabled</span><br></pre></td></tr></table></figure>
<p>Tips:</p>
<ul>
<li>å»ºè®®å¤§å®¶æŠŠå†…å¤–ç½‘IPæœ€å8ä½é…ç½®æˆä¸ºç›¸åŒçš„æ–¹å¼,å®¹æ˜“è®°å¿†æ–¹ä¾¿ç®¡ç†;</li>
<li>å¦å¤–å­˜å‚¨æœåŠ¡å™¨ä¹‹é—´,å­˜å‚¨æœåŠ¡å™¨å’Œäº¤æ¢æœºä¹‹é—´å¯é…ç½®æˆåŒåƒå…†ç½‘å¡ç»‘å®šï¼ˆbondingï¼‰æ¥æå‡ç½‘å¡æ€§èƒ½;</li>
<li>åœ¨éƒ¨ç½²è¿›è¡Œä¸»æœºè§„åˆ’æ„ä¹‰é‡å¤§,å®ƒè®©æˆ‘ä»¬æ€è·¯æ¸…æ™°;</li>
</ul>
<p><strong>2.Heartbeatç‰ˆæœ¬å’Œé…ç½®</strong><br>å®˜æ–¹ç½‘ç«™ï¼š<a href="http://www.linux-ha.org/wiki/Download" target="_blank" rel="noopener">http://www.linux-ha.org/wiki/Download</a><br>Heartbeat-3.Xç‰ˆæœ¬ä»¥åè¢«åˆ†ä¸ºäº†4ä¸ªæ¨¡å—ï¼Œè¿™äº›å®‰è£…åŒ…éƒ½å¯ä»¥ä»å®˜ç½‘ï¼š</p>
<ul>
<li>Heartbeat 3.0.6        //å¿ƒè·³ä¸»ç¨‹åºåŒ…</li>
<li>Cluster Glue 1.0.12    //å¯é‡å¤ä½¿ç”¨çš„ç¾¤é›†ç»„ä»¶ï¼ˆå…‰ç›˜ï¼‰</li>
<li>Resource Agents 3.9.6   //é›†ç¾¤å®éªŒèµ„æºä»£ç†ï¼ˆå…‰ç›˜ï¼‰</li>
<li>Pacemaker-1.1.9-1512.el6.src.rpm   //èµ·æå™¨ï¼ˆå…‰ç›˜é•œåƒï¼‰<figure class="image-box">
                <a rel=é«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆ(DBA).md href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190408225805.png" target="_blank" title="WeiyiGeek.Heartbeatä¸‹è½½" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190408225805.png" alt="WeiyiGeek.Heartbeatä¸‹è½½" title="" class=""></a>
                <p>WeiyiGeek.Heartbeatä¸‹è½½</p>
            </figure>
</li>
</ul>
<p>HAé»˜è®¤é…ç½®æ–‡ä»¶ç›®å½•/etc/ha.d/,å¸¸ç”¨é…ç½®æ–‡ä»¶ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ha.cf     å‚æ•°é…ç½®æ–‡ä»¶    é…ç½®heartbeatä¸€äº›åŸºæœ¬å‚æ•°</span><br><span class="line">authkey   è®¤è¯æ–‡ä»¶        é«˜å¯ç”¨æœåŠ¡å™¨å¯¹ä¹‹é—´æ ¹æ®å¯¹ç«¯çš„authkey(å¯¹ç«¯è¿›è¡Œç›¸äº’è®¤è¯-é˜²æ­¢ç¬¬ä¸‰è€…æ’è¶³)</span><br><span class="line">haresource  èµ„æºé…ç½®æ–‡ä»¶  é…ç½®å¯åŠ¨IPèµ„æºåŠè„šæœ¬ç¨‹åº/æœåŠ¡ç­‰</span><br><span class="line"></span><br><span class="line"><span class="comment">#/etc/ha.d/resource.d/ ä»¥åå¼€å‘çš„ç¨‹åºå­˜æ”¾ç›®å½•ç›´æ¥å¯ä»¥è¿›è¡Œè°ƒç”¨</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>ç¯å¢ƒé…ç½®</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##Step1.é…ç½®DATA1ä¸DATA2çš„ IPåœ°å€</span></span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-eth2</span><br><span class="line">DEVICE=eth2</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">UUID=c3f35428-3740-4791-bc38-8e0d69707d4b</span><br><span class="line">ONBOOT=yes</span><br><span class="line">NM_CONTROLLED=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">IPADDR=192.168.2.100</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">; GATEWAY=192.168.1.1    å¿ƒè·³çº¿IPé…ç½®ä¸ç”¨é…ç½‘å…³å’ŒDNS</span><br><span class="line"><span class="comment">#æˆ–è€…é‡‡ç”¨ä¸´æ—¶ç”Ÿæ•ˆ </span></span><br><span class="line">$ ifconfig eth2 192.168.2.100</span><br><span class="line">$ ifdown eth2</span><br><span class="line"></span><br><span class="line"><span class="comment">#æœºå™¨1 Master-data1</span></span><br><span class="line">ETH1:inet addr:192.168.1.100  Bcast:192.168.1.255  Mask:255.255.255.0  <span class="comment">#ç®¡ç†</span></span><br><span class="line">ETH2:inet addr:192.168.2.100    <span class="comment">#å¿ƒè·³</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æœºå™¨2 Master-data2</span></span><br><span class="line">ETH1:inet addr:192.168.1.101  Bcast:192.168.1.255  Mask:255.255.255.0</span><br><span class="line">ETH2:inet addr:192.168.2.101  <span class="comment">#å¿ƒè·³</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##Step2.é…ç½®ä¸»æœºå</span></span><br><span class="line">[root@WeiyiGeek ~]$ hostname Master-data1</span><br><span class="line">[root@WeiyiGeek ~]$ sed -i <span class="string">'s/HOSTNAME=WeiyiGeek/HOSTNAME=Master-data1/g'</span> /etc/sysconfig/network</span><br><span class="line">[root@WeiyiGeek ~]$ sed -i <span class="string">'s/HOSTNAME=WeiyiGeek/HOSTNAME=Master-data2/g'</span> /etc/sysconfig/network</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸¤å°æœºå™¨ä¸Šåˆ†åˆ«è¿è¡Œ</span></span><br><span class="line">cat &gt;&gt; /etc/hosts&lt;&lt;eof</span><br><span class="line">192.168.1.100 Master-data1</span><br><span class="line">192.168.1.101 Master-data2</span><br><span class="line">eof</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ¤æ–­èƒ½å¦ç›¸äº’é€šä¿¡</span></span><br><span class="line">[root@Master-data1 ]<span class="comment"># ping Master-data2</span></span><br><span class="line">64 bytes from Master-data2 (192.168.1.101): icmp_seq=1 ttl=64 time=0.415 ms</span><br><span class="line">64 bytes from Master-data2 (192.168.1.101): icmp_seq=2 ttl=64 time=0.545 ms</span><br><span class="line"></span><br><span class="line">[root@Master-data2 ]<span class="comment"># ping Master-data1</span></span><br><span class="line">64 bytes from Master-data1 (192.168.1.100): icmp_seq=1 ttl=64 time=1.04 ms</span><br><span class="line">64 bytes from Master-data1 (192.168.1.100): icmp_seq=2 ttl=64 time=0.796 ms</span><br></pre></td></tr></table></figure></p>
<p><em>Tips:</em> hostsé…ç½®åœ¨heartbeatæœåŠ¡ä¸­ä¼šç”¨åˆ°,åæ–‡çš„drbdåŠå­˜å‚¨é«˜å¯ç”¨æ€§èƒ½é…ç½®éƒ½ä¼šç”¨åˆ°;åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ä¼šæŠŠæ‰€æœ‰æœºå™¨åå¯¹åº”ä¸Šæ‰€æœ‰çš„æœºå™¨IPåœ°å€;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Step3.å¿ƒè·³è¿æ¥é…ç½®(å®é™…æ·»åŠ ä¸¤æ¡ä¸»æœºè·¯ç”±)</span></span><br><span class="line">route add -host 192.168.2.101 dev eth2   <span class="comment">#Master-data1 (å¯¹ç«¯çš„IP)</span></span><br><span class="line">route add -host 192.168.2.100 dev eth2   <span class="comment">#Master-data2</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'/sbin/route add -host 192.168.2.101 dev eth2'</span> &gt;&gt; /etc/rc.local <span class="comment">#é…ç½®å¼€æœºè‡ªåŠ¨é…ç½®,åŒä¸Š</span></span><br><span class="line"></span><br><span class="line">$ route -n  <span class="comment">#æŸ¥çœ‹è·¯ç”±</span></span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">192.168.2.101   0.0.0.0         255.255.255.255 UH    0      0        0 eth2  <span class="comment">#Master-data1 (å¯¹ç«¯çš„IP)</span></span><br><span class="line"></span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">192.168.2.100   0.0.0.0         255.255.255.255 UH    0      0        0 eth2  <span class="comment">#Master-data2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Step4.å®‰è£…Heartbeat3.xè½¯ä»¶åŒ…</span></span><br><span class="line">TIPSï¼šå…ˆyum search heartbeatçœ‹çœ‹æ˜¯å¦æœ‰ç›¸å…³å¯ä»¥ä¸‹è½½çš„åŒ…;æ²¡æœ‰çš„è¯ä¸‹è½½å®‰è£…epelæ‰©å±• (æ³¨æ„é€‰ä¸­å¯¹åº”çš„ç‰ˆæœ¬)</span><br><span class="line">mv /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel.repo.backup</span><br><span class="line">yum install -y epel-release  <span class="comment">#æˆ–è€…</span></span><br><span class="line">rpm -ivh http://dl.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm   <span class="comment">#æ³¨æ„ç³»ç»Ÿç‰ˆæœ¬</span></span><br><span class="line">rpm -ivh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm </span><br><span class="line">rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6 <span class="comment">#å¯¼å…¥key</span></span><br><span class="line">[root@Master-data[1/2] ~]<span class="comment"># rpm -qa | grep epel</span></span><br><span class="line">epel-release-6-8.noarch</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿›è¡Œyumå®‰è£…heartbeat ï¼ˆæ‚¨ä¹Ÿå¯é€‰ä¸­ç¼–è¯‘å®‰è£…ï¼‰</span></span><br><span class="line">TIPSï¼šyum å®‰è£…rpmåŒ…å®‰è£…åæœ¬åœ°ä¸æ¸…é™¤çš„æ–¹æ³•  sed -i <span class="string">"s/keepcache=0/keppcache=1/g"</span> /etc/yum.conf  </span><br><span class="line">$ yum install heartbeat* -y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Step5.é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@Master-data1 ha.d]$ <span class="built_in">cd</span> /usr/share/doc/heartbeat-3.0.4/  <span class="comment">#é…ç½®æ¨¡æ¿ç›®å½•</span></span><br><span class="line">$ cp ha.cf haresources authkeys /etc/ha.d/  <span class="comment"># authkeys(600æƒé™)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## ha.cf æ–‡ä»¶é…ç½®</span></span><br><span class="line">[root@Master-data1 ha.d]$ vim ha.cf</span><br><span class="line">[root@Master-data1 ha.d]<span class="comment"># grep -v -E "^#" ha.cf</span></span><br><span class="line">debugfile /var/<span class="built_in">log</span>/ha-debug</span><br><span class="line">logfile /var/<span class="built_in">log</span>/ha-log</span><br><span class="line">logfacility     local0  <span class="comment">#ä»¥ä¸Šä¸ºæ—¥å¿—é…ç½® </span></span><br><span class="line"></span><br><span class="line">keepalive 2</span><br><span class="line">deadtime 30</span><br><span class="line">warntime 10</span><br><span class="line">initdead 120  <span class="comment">#ä»¥ä¸Šä¸ºåŸºç¡€å‚æ•°,é…ç½®ä¸éœ€è¦æ”¹åŠ¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å…³é”®ç‚¹ï¼ˆå¤šæ’­çš„ç½‘å¡ï¼‰</span></span><br><span class="line">mcast eth1 225.0.0.11 694 1 0    <span class="comment">#æ³¨æ„è¿™é‡Œæ˜¯11 netmask ï¼ˆå…³é”®ç‚¹ï¼‰å­ç½‘æ©ç å¯¹åº”</span></span><br><span class="line">auto_failback on</span><br><span class="line">node    Master-data1</span><br><span class="line">node    Master-data2</span><br><span class="line"></span><br><span class="line"><span class="comment">## authkeys æ–‡ä»¶é…ç½®</span></span><br><span class="line">[root@Master-data1 ha.d]$  chmod 600 authkeys</span><br><span class="line">[root@Master-data1 ha.d]$  vim authkeys</span><br><span class="line">auth 2</span><br><span class="line">2 sha1 HI! <span class="comment">#è¿™é‡ŒHIæ˜¯å¯†åŒ™</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## haresources æ–‡ä»¶é…ç½®</span></span><br><span class="line">[root@Master-data1 ha.d]$ vim haresources</span><br><span class="line"><span class="comment">#node-name resource1 resource2 ... resourceN</span></span><br><span class="line">45 Master-data1 IPaddr::192.168.1.10/24/eth1   <span class="comment">#è¿™é‡Œçš„IP ç½‘å¡ ä¸ mcast å‚æ•°æ˜¯å­˜åœ¨å…³è”çš„ ï¼ˆå…³é”®ç‚¹ï¼‰</span></span><br><span class="line">46 Master-data2 IPaddr::192.168.1.11/24/eth1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Step6.æ‹·è´é…ç½®æ–‡ä»¶åˆ°Master-data2ä¸­ ï¼ˆæ³¨æ„å¦‚æœå¯¹åº”IPç½‘å¡ä¸å¯¹å°±éœ€è¦ä¿®æ”¹ï¼‰</span></span><br><span class="line">[root@Master-data1 ha.d]$ tar -zcvf test.tar.gz ha.cf authkeys haresources</span><br><span class="line">[root@Master-data2 ha.d]$ scp root@192.168.1.100:/etc/ha.d/test.tar.gz /etc/ha.d/</span><br><span class="line">$ tar -zxvf test.tar.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Step7. å¯åŠ¨heartbeat</span></span><br><span class="line">[root@Master-data1 ha.d]$ /etc/init.d/heartbeat start</span><br><span class="line">[root@Master-data2 ha.d]$ /etc/init.d/heartbeat start</span><br><span class="line">Starting High-Availability services: INFO:  Resource is stopped</span><br><span class="line">INFO:  Resource is stopped</span><br><span class="line">Done.</span><br><span class="line"></span><br><span class="line">æ­£å¸¸æƒ…å†µéœ€è¦ç­‰å¾…120sæ¥æ¢å¤ç½‘ç»œï¼š</span><br><span class="line">[root@Master-data1 ha.d]$ ip addr | grep -v -E <span class="string">"link|inet6"</span> | grep <span class="string">"192.168"</span></span><br><span class="line">    inet 192.168.1.100/24 brd 192.168.1.255 scope global eth1</span><br><span class="line">    inet 192.168.1.10/24 brd 192.168.1.255 scope global secondary eth1  <span class="comment">#è™šæ‹ŸVIP </span></span><br><span class="line">    inet 192.168.2.100/24 brd 192.168.2.255 scope global eth2</span><br><span class="line"></span><br><span class="line">[root@Master-data2 ha.d]$ ip addr | grep -v -E <span class="string">"link|inet6"</span> | grep <span class="string">"192.168"</span></span><br><span class="line">    inet 192.168.1.101/24 brd 192.168.1.255 scope global eth1</span><br><span class="line">    inet 192.168.1.11/24 brd 192.168.1.255 scope global secondary eth1 <span class="comment">#è™šæ‹ŸVIP </span></span><br><span class="line">    inet 192.168.2.101/24 brd 192.168.2.255 scope global eth2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Step8. åˆ‡æ¢å»¶æ—¶</span></span><br><span class="line"><span class="comment">#æœåŠ¡å™¨åœæ‰/ç½‘å¡downæ‰/heartbeatæœåŠ¡å…³é—­ï¼ˆåœæ‰Master-data1ï¼‰</span></span><br><span class="line">[root@Master-data1 ha.d]$ /etc/init.d/heartbeat stop</span><br><span class="line">$ ip addr | grep -v -E <span class="string">"link|inet6"</span> | grep <span class="string">"192.168"</span></span><br><span class="line">    inet 192.168.1.100/24 brd 192.168.1.255 scope global eth1</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ­¤æ—¶Master-data2è¿›è¡Œæ¥ç®¡ (å½“Master-data1 é‡æ–°å¯åŠ¨åå°†ä¼šè‡ªåŠ¨è¿›è¡Œæ¥ç®¡)</span></span><br><span class="line">[root@Master-data2 ha.d]$ ip addr | grep -v -E <span class="string">"link|inet6"</span> | grep <span class="string">"192.168"</span></span><br><span class="line">    inet 192.168.1.101/24 brd 192.168.1.255 scope global eth1</span><br><span class="line">    inet 192.168.1.11/24 brd 192.168.1.255 scope global secondary eth1</span><br><span class="line">    inet 192.168.1.10/24 brd 192.168.1.255 scope global secondary eth1</span><br></pre></td></tr></table></figure>
<h5 id="5-å®æˆ˜æ¡ˆä¾‹"><a href="#5-å®æˆ˜æ¡ˆä¾‹" class="headerlink" title="5) å®æˆ˜æ¡ˆä¾‹"></a>5) å®æˆ˜æ¡ˆä¾‹</h5><p>ç›®çš„ï¼šé€šè¿‡ä¸€ä¸ªWEBæœåŠ¡é«˜å¯ç”¨æ¡ˆä¾‹ç†Ÿæ‚‰heartbeatè½¯ä»¶çš„ä½¿ç”¨,åœ¨ä¸Šé¢åŸºç¡€ä¹‹ä¸Šè¿›è¡Œå®ç°;<br>ç¯å¢ƒï¼šå®‰è£… httpd (ä¸å¤šè¯´)</p>
<p><em>æ­¥éª¤æµç¨‹ï¼š</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">1. é…ç½®httpdé¦–é¡µå°†Master-data1 / Master-data2åˆ†åˆ«å†™å…¥index.html</span><br><span class="line">[root@Master-data1 ~]$ <span class="built_in">echo</span> <span class="string">"Master-data1 192.168.1.100"</span> &gt; /var/www/html/index.html</span><br><span class="line">[root@Master-data2 ~]$ <span class="built_in">echo</span> <span class="string">"Master-data2 192.168.1.101"</span> &gt; /var/www/html/index.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2. é…ç½®hoståŸŸåæ¥è§£æ(åˆ¤æ–­VIPæ˜¯ä¸æ˜¯è¢«æ¼‚ç§»)</span><br><span class="line">[root@Master-data2 ~]$ <span class="built_in">echo</span> <span class="string">'192.168.1.10 www.demo.org'</span> &gt;&gt; /etc/hosts</span><br><span class="line">[root@Master-data2 ~]$ ping www.demo.org</span><br><span class="line">PING www.demo.org (192.168.1.10) 56(84) bytes of data.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.å¼€å¯ä¸»å¤‡çš„httpdä¸heartbeatæœåŠ¡</span><br><span class="line">[root@Master-data1 ~]$ /etc/init.d/heartbeat start</span><br><span class="line">$ service httpd start</span><br><span class="line">Starting httpd:                                            [  OK  ]</span><br><span class="line"></span><br><span class="line">[root@Master-data2 ~]$ /etc/init.d/heartbeat start</span><br><span class="line">$ /etc/init.d/httpd start</span><br><span class="line">Starting httpd:                                            [  OK  ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4.æ¨¡å¼é‡Šæ”¾ <span class="comment">#[Master-data1] ä¸Šæ‰§è¡Œ</span></span><br><span class="line">[root@Master-data1 html]$ /usr/share/heartbeat/hb_standby  <span class="comment">#[Master-data1] heartbeat3.0.4</span></span><br><span class="line">Going standby [all].</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5.å®ç°çš„æ•ˆæœ</span><br><span class="line">[root@Master-data2 ~]$ curl www.demo.org <span class="comment">#(master-data1 é‡Šæ”¾å‰)</span></span><br><span class="line">Master-data1 192.168.1.100</span><br><span class="line">[root@Master-data2 ~]$ curl www.demo.org  <span class="comment">#(master-data1 é‡Šæ”¾å)</span></span><br><span class="line">Master-data2 192.168.1.101</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6.æ­¤æ—¶ä»¥å°†æ¼‚ç§»åˆ°Master-data2ä¸Š</span><br><span class="line">[root@Master-data2 ~]$ ip addr | grep -v -E <span class="string">"link|inet6"</span> | grep <span class="string">"192.168"</span></span><br><span class="line">    inet 192.168.1.101/24 brd 192.168.1.255 scope global eth3</span><br><span class="line">    inet 192.168.1.11/24 brd 192.168.1.255 scope global secondary eth3</span><br><span class="line">    inet 192.168.1.10/24 brd 192.168.1.255 scope global secondary eth3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">7.æ¢å¤æ¥ç®¡</span><br><span class="line">/usr/share/heartbeat/hb_takeover  <span class="comment">#heartbeat3.0.4</span></span><br><span class="line">[root@Master-data1 html]$ ip addr | grep -v -E <span class="string">"link|inet6"</span> | grep <span class="string">"192.168"</span></span><br><span class="line">    inet 192.168.1.100/24 brd 192.168.1.255 scope global eth1</span><br><span class="line">    inet 192.168.1.10/24 brd 192.168.1.255 scope global secondary eth1</span><br><span class="line">    inet 192.168.1.11/24 brd 192.168.1.255 scope global secondary eth1</span><br></pre></td></tr></table></figure></p>
<p><em>ç¬¬äºŒç§æ–¹å¼ï¼š</em> è®©heartbeatè´Ÿè´£httpdå¯åŠ¨åŒæ—¶è´Ÿè´£vipå¯åŠ¨<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Step1.å°†httpdæ”¾æƒç»™heatbeat </span></span><br><span class="line">chkconfig httpd off  <span class="comment">#åˆ†åˆ«å…³é—­httpdè‡ªå¯åŠ¨</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Step2.é…ç½®httpæœåŠ¡å¯åŠ¨è„šæœ¬(ç”±äºyumå®‰è£…å·²ç»åˆ¶åŠ¨å°±æœ‰äº†) [Master-data1/2 é…ç½®ä¸€è‡´]</span></span><br><span class="line">[root@Master-data1 ha.d]$ cp /etc/init.d/httpd /etc/ha.d/resource.d  <span class="comment">#æ‹·è´åˆ°hbé»˜è®¤è„šæœ¬ç›®å½•ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#step3.ä¿®æ”¹haresource åŠ ä¸Šhttpdå¯åŠ¨è„šæœ¬   [Master-data1/2 é…ç½®ä¸€è‡´]</span></span><br><span class="line">[root@Master-data1 ha.d]$ vim haresources</span><br><span class="line">Master-data1 IPaddr::192.168.1.10/24/eth1 httpd  <span class="comment">#æ³¨æ„è¿™é‡Œåªéœ€è¦é…ç½®ä¸€ä¸ªhttpd æœåŠ¡å³å¯(éšç€VIPæ¼‚ç§»è€Œå¼€å¯ä¸åœæ­¢)</span></span><br><span class="line">Master-data2 IPaddr::192.168.1.11/24/eth1 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#step4.éªŒè¯æŸ¥çœ‹</span></span><br><span class="line">[root@Master-data1 ha.d]$ netstat -tlnp | grep <span class="string">"httpd"</span>  <span class="comment">#æ²¡æœ‰å¯åŠ¨</span></span><br><span class="line">[root@Master-data1 ha.d]$ /etc/init.d/heartbeat start  <span class="comment">#ä¸»èŠ‚ç‚¹å¼€å¯heartbeat</span></span><br><span class="line"></span><br><span class="line">[root@Master-data1 resource.d]$ netstat -tlnp | grep <span class="string">"httpd"</span>  <span class="comment">#ç­‰å¾…120såå¯åŠ¨</span></span><br><span class="line">tcp        0      0 :::80                       :::*                        LISTEN      12984/httpd</span><br><span class="line"></span><br><span class="line">[root@Master-data2 ha.d]$ curl www.demo.org</span><br><span class="line">Master-data1 192.168.1.100</span><br><span class="line"></span><br><span class="line"><span class="comment">#Step5.å½“ä¸»å¤‡åŒæ—¶å¯åŠ¨heartbeatæ—¶å€™</span></span><br><span class="line"><span class="comment">#Master-data1 heartbeat/ä¸»æœºæŒ‚äº†æ‰ä¼šhttpd å¯åŠ¨ ï¼ˆé»˜è®¤åœ¨Master-data1å¯åŠ¨ï¼‰</span></span><br><span class="line"><span class="comment">#è¿˜æ˜¯ä¼šåœ¨Master-data1ä¸»æœºè¿›è¡Œå¯åŠ¨httpd,è¿™æ—¶å€™åœæ­¢è¯¥ä¸»æœºä¸Šçš„heartbeatä¾¿ä¼šè¿›è¡Œæ¼‚ç§»åˆ°data2ä¸Šæ˜¯;</span></span><br><span class="line"></span><br><span class="line">[root@Master-data2 ha.d]$ netstat -tlnp | grep <span class="string">"httpd"</span></span><br><span class="line">tcp        0      0 :::80                       :::*                        LISTEN      12063/httpd</span><br><span class="line"></span><br><span class="line">[root@Master-data2 ha.d]$ curl www.demo.org</span><br><span class="line">Master-data2 192.168.1.101</span><br><span class="line"><span class="comment">#å¯ä»¥é€šè¿‡logæ–‡ä»¶è§‚å¯Ÿ httpd åœæ­¢/å¯åŠ¨</span></span><br><span class="line">ResourceManager(default)[14023]: </span><br><span class="line">2019/04/09_23:32:35 info: Releasing resource group: master-data1     IPaddr::192.168.1.10/24/eth1 httpd</span><br><span class="line"></span><br><span class="line">ResourceManager(default)[14023]:       </span><br><span class="line">2019/04/09_23:32:35 info: Running /etc/ha.d/resource.d/httpd  stop</span><br></pre></td></tr></table></figure></p>
<p><em>æ³¨æ„äº‹é¡¹ï¼š</em></p>
<ul>
<li>è„šæœ¬è·¯å¾„è¦æ”¾å…¥/etc/init.d/httpd æˆ– /etc/ha.d/resource.d/</li>
<li>è„šæœ¬æ‰§è¡Œéœ€è¦æ”¯æŒ stop/startæ–¹å¼è„šæœ¬å…·å¤‡å¯æ‰§è¡Œæƒé™,ä¸”ä¸haresource ä¸­è„šæœ¬åç§°ä¸€è‡´</li>
<li>å¦‚æœhttpdæœåŠ¡è¢«å¡æ­»,ä¼šè‡ªå·±é‡å¯ç³»ç»Ÿ(è¿›è¡Œè¿›ç¨‹è‡ªæ€)</li>
<li>å¸¸ç”¨git/svnè¿›è¡Œé…ç½®heartbeaté…ç½®æ–‡ä»¶,é‡è¦çš„äº‹æƒ…è¯´ä¸‰é(å¤‡ä»½/å¤‡ä»½/å¤‡ä»½);</li>
<li>åœ¨æ­£å¼çš„ç¯å¢ƒä¸­å»ºè®®å…ˆè¿›è¡Œæµ‹è¯•(æ‰¾ä¸ªæµé‡ä½è°·),æ‰‹åŠ¨é…ç½®ä¸´æ—¶ç½‘å¡æ¥æµ‹è¯•ç½‘ç»œæ–¹é¢çš„é—®é¢˜;</li>
</ul>
<p><br></p>
<h5 id="è¡¥å……ï¼ˆé™„å½•ï¼‰"><a href="#è¡¥å……ï¼ˆé™„å½•ï¼‰" class="headerlink" title="è¡¥å……ï¼ˆé™„å½•ï¼‰"></a>è¡¥å……ï¼ˆé™„å½•ï¼‰</h5><p><strong>0.heartbeaté‡Šæ”¾æ¨¡æ‹Ÿè„šæœ¬</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å®Œå…¨é‡Šæ”¾</span></span><br><span class="line">/usr/lib64/heartbeat/hb_standby</span><br><span class="line">/usr/share/heartbeat/hb_standby  <span class="comment">#heartbeat3.0.4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å®Œå…¨æ¥ç®¡</span></span><br><span class="line">/usr/lib64/heartbeat/hb_takeover</span><br><span class="line">/usr/share/heartbeat/hb_takeover  <span class="comment">#heartbeat3.0.4</span></span><br></pre></td></tr></table></figure></p>
<p><strong>1.é…ç½®æ–‡ä»¶è®²è§£</strong><br>ha.cf<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ha.d/ha.cf</span><br><span class="line">24 debugfile /var/<span class="built_in">log</span>/ha-debug  <span class="comment">#è°ƒè¯•æ—¥å¿—æ–‡ä»¶ï¼Œå–é»˜è®¤å€¼</span></span><br><span class="line">29 logfile /var/<span class="built_in">log</span>/ha-log     <span class="comment">#ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶ï¼Œå–é»˜è®¤å€¼    </span></span><br><span class="line">34 ogfacility local0   <span class="comment">#åœ¨syslogæœåŠ¡ä¸­é…ç½®é€šè¿‡local1è®¾å¤‡æ¥æ”¶æ—¥å¿— è¡¨ç¤ºä½¿ç”¨ç³»ç»Ÿæ—¥å¿—ä¸ä¸Šé¢åªèƒ½å¼€å¯ä¸€ä¸ª</span></span><br><span class="line"></span><br><span class="line">48 keepalive 2 <span class="comment">#å¿ƒè·³é¢‘ç‡ï¼Œå¯ä»¥è‡ªå·±è®¾å®š heartbeat ä¹‹é—´çš„æ—¶é—´é—´éš”ä¸º 2 ç§’ã€‚ä¹Ÿå¯ä»¥200ms è¡¨ç¤º200æ¯«ç§’</span></span><br><span class="line">56 deadtime 30  <span class="comment">#èŠ‚ç‚¹æ­»äº¡æ—¶é—´çš„é˜€å€¼ï¼Œå°±æ˜¯ä»èŠ‚ç‚¹åœ¨è¿‡äº† 30 ç§’åè¿˜æ²¡æœ‰æ”¶åˆ°å¿ƒè·³å°±è®¤ä¸ºä¸»èŠ‚ç‚¹æ­»äº¡</span></span><br><span class="line">61 warntime 10  <span class="comment">#æŒ‡å®šå¿ƒè·³å»¶è¿Ÿçš„ä¸º10S,å½“10så†…å¤‡ä»½èŠ‚ç‚¹ä¸èƒ½æ¥æ”¶åˆ°ä¸»èŠ‚ç‚¹çš„å¿ƒè·³ä¿¡å·,å¹¶åœ¨æ—¥å¿—ä¸­å‘å‡ºâ€œlate heartbeatâ€œè­¦å‘Šå‰ç­‰å¾…çš„æ—¶é—´ï¼Œ</span></span><br><span class="line">71 initdead 120  <span class="comment">#åœ¨æŸäº›ç³»ç»Ÿä¸Šï¼Œç³»ç»Ÿå¯åŠ¨æˆ–é‡å¯ä¹‹åéœ€è¦ç»è¿‡ä¸€æ®µæ—¶é—´ç½‘ç»œæ‰èƒ½æ­£å¸¸å·¥ä½œï¼Œè¯¥é€‰é¡¹ç”¨äºè§£å†³è¿™ç§æƒ…å†µäº§ç”Ÿçš„æ—¶é—´é—´éš”ã€‚å–å€¼è‡³å°‘ä¸º deadtime çš„ä¸¤å€ã€‚</span></span><br><span class="line">76 udpport 694  <span class="comment">#å¿ƒè·³ä¿¡æ¯ä¼ é€’çš„UDPç«¯å£ï¼Œä½¿ç”¨ç«¯å£ 694 è¿›è¡Œ bcast å’Œ ucast é€šä¿¡ã€‚è¿™æ˜¯é»˜è®¤çš„ï¼Œå¹¶ä¸”åœ¨ IANA å®˜æ–¹æ³¨å†Œçš„ç«¯å£å·ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#baud   19200  #ä¸²è¡Œç«¯å£çš„æ³¢ç‰¹ç‡</span></span><br><span class="line"><span class="comment">#serial /dev/ttyS0      # Linux  #ä¸²å£çš„æ¥å£å</span></span><br><span class="line"><span class="comment">#serial /dev/cuaa0      # FreeBSD</span></span><br><span class="line"><span class="comment">#serial /dev/cuad0      # FreeBSD 6.x</span></span><br><span class="line"><span class="comment">#serial /dev/cua/a      # Solaris</span></span><br><span class="line"><span class="comment">#bcast  eth0            # Linux #ä¼ æ’­å¿ƒè·³çš„å¹¿æ’­ç½‘å¡ä¿¡æ¯</span></span><br><span class="line"><span class="comment">#bcast  eth1 eth2       # Linux</span></span><br><span class="line"><span class="comment">#bcast  le0             # Solaris</span></span><br><span class="line"><span class="comment">#bcast  le1 le2         # Solaris</span></span><br><span class="line"></span><br><span class="line">91 <span class="comment">#bcast  eth0   #è¡¨ç¤ºåœ¨ eth0 æ¥å£ä¸Šä½¿ç”¨å¹¿æ’­ heartbeatï¼ˆå°† eth1 æ›¿æ¢ä¸º eth0ï¼Œ eth2ï¼Œæˆ–è€…æ‚¨ä½¿ç”¨çš„ä»»ä½•æ¥å£ï¼‰,å¿ƒè·³ç½‘å¡ï¼Œå¦‚æœä½ æœ‰ä¸¤ä¸ªç½‘å¡ï¼Œå¯ä»¥å†™æˆ eth1 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡ç‚¹éœ€è¦æ›´ç½‘å¡çš„ç‰©ç†ipåœ¨ä¸€ä¸ªç½‘æ®µ</span></span><br><span class="line">113 mcast eth0 225.0.0.1 694 1 0    <span class="comment">#è¯´æ˜ï¼šé‡‡ç”¨udpå¤šæ’­æ’­æ¥é€šçŸ¥å¿ƒè·³(ç¨³å®šï¼‰ï¼Œ Dç±»åœ°å€å»ºè®®åœ¨å‰¯èŠ‚ç‚¹ä¸åªä¸€å°æ—¶ä½¿ç”¨(é»˜è®¤ç«¯å£694) å¤šæ’­ä¼ é€å¿ƒè·³çš„ç½‘å¡ å¤šæ’­ç»„ ç«¯å£ è·ƒç‚¹æ•° æ˜¯å¦å›ç¯å†…ä¼ é€</span></span><br><span class="line">121 <span class="comment">#ucast eth0 192.168.1.64    #éœ€è¦ä¿®æ”¹ï¼Œè¡¨ç¤ºä»æœ¬æœºçš„ eth0 æ¥å£å‘å¿ƒè·³æ¶ˆæ¯ç»™å¯¹æ–¹èŠ‚ç‚¹ï¼Œå†™å¦ä¸€ç«¯çš„IP åœ°å€ã€‚è¿™æ˜¯å•æ’­åœ°å€ã€‚ xuegod64 ä¸Šæ”¹ä¸º 192.168.1.63 </span></span><br><span class="line">157 auto_failback on    <span class="comment">#é»˜è®¤å¯ç”¨ï¼Œå½“ auto_failback è®¾ç½®ä¸º on æ—¶ï¼Œä¸€æ—¦ä¸»èŠ‚ç‚¹é‡æ–°æ¢å¤è”æœºï¼Œå°†ä»ä»èŠ‚ç‚¹å–å›æ‰€æœ‰èµ„æºã€‚è‹¥è¯¥é€‰é¡¹è®¾ç½®ä¸º offï¼Œä¸»èŠ‚ç‚¹ä¾¿ä¸èƒ½é‡æ–°è·å¾—èµ„æºã€‚</span></span><br><span class="line"></span><br><span class="line">211 node Master-data1  <span class="comment">#(ä¸»èŠ‚ç‚¹)éœ€è¦ä¿®æ”¹ï¼Œè¯¥é€‰é¡¹æ˜¯å¿…é¡»é…ç½®çš„ã€‚é›†ç¾¤ä¸­æœºå™¨çš„ä¸»æœºåï¼Œä¸â€œuname â€“nâ€çš„è¾“å‡ºç›¸åŒã€‚</span></span><br><span class="line">212 node Master-data2  <span class="comment">#(å¤‡ç”¨èŠ‚ç‚¹)éœ€è¦ä¿®æ”¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨pingæ¨¡å¼ æœ‰æ—¶å½“ä¸»æœºæŒ‚æ‰æˆ–è€…heartbeatæŒ‚æ‰åvipæ‰ä¼šè½¬ç§»  æœ‰æ—¶å‡ºç°æŸä¸ªè¿›ç¨‹æŒ‚æ‰ åˆ‡æ¢éœ€è¦ä½¿ç”¨è„šæœ¬ </span></span><br><span class="line"><span class="comment">#pingæ¨¡å¼ç”¨äºæµ‹è¯• å¦‚æœç½‘å¡pingä¸åŒ æŸä¸ªä¸»æœº å°±è®¤ä¸ºå½“å‰æ–­ç½‘ éœ€è¦è½¬ç§»vip </span></span><br><span class="line">220 ping 192.186.1.254 <span class="comment">#éœ€è¦ä¿®æ”¹ï¼Œé€šè¿‡pingå‘½ä»¤å®ç°ä»²è£</span></span><br><span class="line">253 respawn hacluster /usr/libexec/heartbeat/ipfail  <span class="comment">#å½“pingä¸é€šæ—¶ è‡ªåŠ¨è°ƒç”¨ ipfailè¿™ä¸ªè„šæœ¬</span></span><br><span class="line">259 apiauth ipfail gid=haclient uid=hacluster  <span class="comment"># è¡¨ç¤ºæœ‰æƒé™æ“ä½œipfailè„šæœ¬çš„ç»„å’Œç”¨æˆ·</span></span><br><span class="line"></span><br><span class="line">157 auto_failback on <span class="comment">#auto_failback on ä¸º on æ—¶ï¼Œä¸»ç»“ç‚¹æ¢å¤æ­£å¸¸åï¼Œèµ„æºè‡ªåŠ¨è½¬ç»™ä¸»ç»“ç‚¹ã€‚å»ºè®®è®¾ä¸º auto_failback off ï¼Œç­‰ä¸»èŠ‚ç‚¹æ¢å¤æ­£å¸¸åï¼Œåœ¨ä¸šåŠ¡ä¸ç¹å¿™æ—¶ï¼Œåˆ‡æ¢å›æ¥ã€‚é˜²æ­¢ä¸»èŠ‚ç‚¹æ¢å¤æ­£å¸¸æ—¶ï¼Œå›åˆ‡æ—¶ï¼Œå†æ¬¡å½±èµ·ç½‘ç»œä¸­æ–­ã€‚</span></span><br><span class="line"><span class="comment">#crm no  #æ˜¯å¦å¼€å¯Cluster Resource Masngerï¼ˆé›†ç¾¤èµ„æºç®¡ç†ï¼‰åŠŸèƒ½;(ä¸€èˆ¬ä¸ç”¨)</span></span><br></pre></td></tr></table></figure></p>
<p><br><br>authkeys æ–‡ä»¶:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„è¯¥æ–‡ä»¶æƒé™å¿…é¡»æ˜¯600</span></span><br><span class="line">auth 1  <span class="comment"># è®¾ç½®è®¤è¯çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">#1 crc  # ä¸å®‰å…¨</span></span><br><span class="line"><span class="comment">#2 sha1 HI!  #æ¨èä½¿ç”¨</span></span><br><span class="line"><span class="comment">#3 md5 Hello!</span></span><br></pre></td></tr></table></figure></p>
<p><br><br>haresource æ–‡ä»¶ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŒ‡å®šèŠ‚ç‚¹ä¸»æœºåï¼Œå’ŒVIPåœ°å€ï¼Œä»¥åŒå†’å·åˆ†éš”èµ„æºï¼Œæ­¤å¤„ä»¥apacheä¸ºä¾‹è¿›è¡Œé…ç½®</span></span><br><span class="line"><span class="comment">#ä¸»å¤‡èŠ‚ç‚¹ VIPæ¼‚ç§»IP</span></span><br><span class="line">data-1-1 IPaddr::10.0.0.100/24/eth0</span><br><span class="line">data-1-2 IPaddr::10.0.0.101/24/eth0    <span class="comment">#å½“ä¸»æŒ‚äº†æ‰è¿›è¡Œè§¦å‘</span></span><br><span class="line"><span class="comment">#å‚æ•°è¯¦è§£ï¼š</span></span><br><span class="line">data-1-1 : ä¸»æœºå</span><br><span class="line">IPaddr ï¼šResources.d/ ä¸­çš„è„šæœ¬æ–‡ä»¶</span><br><span class="line">10.0.0.100/24/eth0 : é›†ç¾¤å¯¹å¤–æœåŠ¡çš„VIP,24ä¸ºå­ç½‘æ©ç ,eth0ä¸ºIPç»‘å®šçš„å®é™…ç‰©ç†ç½‘å¡;ä¸ºheartbeatæä¾›å¯¹å¤–æœåŠ¡çš„é€šä¿¡æ¥å£;</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=é«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆ(DBA).md href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190409160848.png" target="_blank" title="WeiyiGeek.MYSQLé›†ç¾¤è¿ç»´" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190409160848.png" alt="WeiyiGeek.MYSQLé›†ç¾¤è¿ç»´" title="" class=""></a>
                <p>WeiyiGeek.MYSQLé›†ç¾¤è¿ç»´</p>
            </figure></p>
<p><br></p>
<p><strong>2.Heartbaetå…¥å‘è®¡</strong><br>å»ºè®®ï¼šæŸ¥çœ‹æ—¥å¿—/var/log/ha-log<br><em>Q:æ—¥å¿—åˆ†ææ¥ç®¡è¿‡ç¨‹?</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.pacemaker support æƒ…å†µ</span><br><span class="line">2.logging daemon</span><br><span class="line">3.heartbeat ç‰ˆæœ¬ä¿¡æ¯</span><br><span class="line">4.glib:UDP å¤šæ’­ä¿¡æ¯å‘é€</span><br><span class="line">5.è¿è¡Œ/etc/ha.d/rc.d/status è„šæœ¬æŸ¥çœ‹å¯¹ç«¯çš„çŠ¶æ€;</span><br><span class="line">6.æœåŠ¡å¼‚å¸¸åˆ™æ¥ç®¡èµ„æº,é€šè¿‡IPaddrè„šæœ¬</span><br><span class="line">7.å¹¿æ’­UDPåŠVIPåœ°å€</span><br><span class="line">8.å¦‚æœæ£€æµ‹å¯¹ç«¯æ­£å¸¸åˆ™å°†ç»“æœçš„èµ„æºé‡Šæ”¾å¹¶è¿”å›ç»™å®ƒ   ip-request (è¯·æ±‚å‘é€) / ip-request-rsep (è¯·æ±‚å‘é€)</span><br></pre></td></tr></table></figure></p>
<p><em>Q:ä¸¤è¾¹éƒ½æ˜¾ç¤ºæ¼‚ç§»çš„VIPåœ°å€?</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@Master-data1 ha.d]$ ip addr | grep -v -E <span class="string">"link|inet6"</span> | grep <span class="string">"192.168"</span></span><br><span class="line">    inet 192.168.1.100/24 brd 192.168.1.255 scope global eth1</span><br><span class="line">    inet 192.168.1.11/24 brd 192.168.1.255 scope global secondary eth1  <span class="comment">#é—®é¢˜ç‚¹</span></span><br><span class="line">    inet 192.168.1.10/24 brd 192.168.1.255 scope global secondary eth1</span><br><span class="line">    inet 192.168.2.100/24 brd 192.168.2.255 scope global eth3</span><br><span class="line"></span><br><span class="line">[root@Master-data2 ha.d]<span class="comment"># ip addr | grep -v -E "link|inet6" | grep "192.168"</span></span><br><span class="line">    inet 192.168.1.101/24 brd 192.168.1.255 scope global eth3</span><br><span class="line">    inet 192.168.1.10/24 brd 192.168.1.255 scope global secondary eth3  <span class="comment">#é—®é¢˜ç‚¹</span></span><br><span class="line">    inet 192.168.1.11/24 brd 192.168.1.255 scope global secondary eth3</span><br><span class="line">    inet 192.168.2.101/24 brd 192.168.2.255 scope global eth5</span><br></pre></td></tr></table></figure><br>è§£å†³æ–¹æ³•ï¼šæ˜¯ä¸æ˜¯é“¾è·¯æœ‰é—®é¢˜,èƒ½ä¸èƒ½è¿›è¡Œé€šä¿¡,é˜²ç«å¢™æ˜¯å¦è¢«å¼€å¯(å¯ä»¥å…³é—­/ä¹Ÿå¯ä»¥å°†694ç«¯å£æ·»åŠ é€šä¿¡è§„åˆ™)</p>
<p><em>Q:ä¸€ä¸ªLANä¸­æ˜¯å¤šç»„heartbeatæœåŠ¡åŒæ—¶å¼€å¯çš„é—®é¢˜?</em><br>æ¯”å¦‚ï¼šmcast eth1 225.0.0.1 694 1 0 â€” å½“åŒä¸€ä¸ªIDCæœ‰å¤šä¸ªè¿™æ ·çš„æƒ…å†µåº”è¯¥ä½¿ç”¨å•æ’­;<br>å¦‚æœéè¦ä½¿ç”¨å¤šæ’­æ–¹å¼,å‰ææ˜¯å¤šæ’­åœ°å€ä¸èƒ½ç›¸åŒ(å¯é€‰mutiladdr&gt; 224.0.0.0 ~ 239.255.255.255)ä¸€èˆ¬ Router/siwtchç­‰è®¾å¤‡éƒ½æ˜¯é‡‡ç”¨å¤šæ’­å½¢å¼;<br><figure class="image-box">
                <a rel=é«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆ(DBA).md href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190409233728.png" target="_blank" title="WeiyiGeek.å®æ—¶åŒæ­¥å…±äº«å­˜å‚¨" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190409233728.png" alt="WeiyiGeek.å®æ—¶åŒæ­¥å…±äº«å­˜å‚¨" title="" class=""></a>
                <p>WeiyiGeek.å®æ—¶åŒæ­¥å…±äº«å­˜å‚¨</p>
            </figure></p>
<p><em>Q:Filesystemè„šæœ¬é—®é¢˜</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é—®é¢˜</span></span><br><span class="line">Filesystem(Filesystem_/dev/drbd0)[18085]:       2019/05/14_17:12:48 ERROR: Setup problem: couldn<span class="string">'t find command: fuser'</span></span><br><span class="line"><span class="comment">#è§£å†³åŠæ³•</span></span><br><span class="line">yum install psmisc</span><br></pre></td></tr></table></figure></p>
<p><em>Q:ä»æœºè™šæ‹Ÿæœºå¤åˆ¶çš„ä¸»æœºå¼€å¯heartbeatæ—¶å€™æŠ¥uuidé”™è¯¯</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">May 15 13:29:21 Szabbix heartbeat: [4467]: WARN: nodename mzabbix uuid changed to szabbix</span><br><span class="line"></span><br><span class="line"><span class="comment">#è§£å†³æ–¹æ³•:åˆ é™¤å…¶ä¸­ä¸€å°ä¸»æœºçš„hd_uuid ï¼ˆé‡å¯çš„æ—¶å€™ä¼šè‡ªåŠ¨æ›´æ–°ï¼‰</span></span><br><span class="line">[root@Szabbix ~]<span class="comment"># rm -rf /usr/local/heartbeat/var/lib/heartbeat/hb_uuid</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>3.Centos7å®‰è£…heartbeatåœ¨epelæºä¸å­˜åœ¨é—®é¢˜</strong><br>è§£å†³æ–¹æ³•ï¼šæè¿°é‡‡ç”¨æºç ç¼–è¯‘å®‰è£…heartbeatå³å¯ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å…±ç”¨é…ç½®</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line">setenforce 0</span><br><span class="line">sed -i s<span class="comment">#SELINUX=enforcing#SELINUX=disabled# /etc/selinux/config</span></span><br><span class="line">reboot</span><br><span class="line"></span><br><span class="line">hostname data-1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"data-1"</span> &gt;&gt; /etc/hostname</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"192.168.1.100 data-1 node1\n192.168.1.100 data-1 node2"</span> &gt;&gt; /etc/hosts</span><br><span class="line"></span><br><span class="line">ssh-keygen -q -t rsa -N <span class="string">''</span> -f ~/.ssh/id_rsa</span><br><span class="line">ssh-copy-id root@192.168.1.100   <span class="comment">#æ‹·è´å…¬é’¥åˆ°å¯¹æ–¹æœºå™¨,å°±èƒ½ä¸ä½¿ç”¨å¯†ç è¿›è¡Œç™»é™†ssh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1.å®‰è£…åŸºç¡€ç¯å¢ƒåŒ…ï¼š</span></span><br><span class="line">yum install gcc gcc-c++ autoconf automake libtool glib2-devel libxml2-devel bzip2 bzip2-devel e2fsprogs-devel libxslt-devel libtool-ltdl-devel asciidoc wget psmisc </span><br><span class="line"></span><br><span class="line"><span class="comment">#2.åˆ›å»ºç”¨æˆ·å’Œç»„</span></span><br><span class="line">groupadd haclient</span><br><span class="line">useradd -g haclient hacluster</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.å®˜ç½‘ä¸‹è½½è½¯ä»¶åŒ…ï¼šReusable-Components-glueã€resource-agentsã€heartbeat</span></span><br><span class="line">wget http://hg.linux-ha.org/heartbeat-STABLE_3_0/archive/958e11be8686.tar.bz2 -O /opt/heartbeat3.tar.bz2</span><br><span class="line">wget http://hg.linux-ha.org/glue/archive/0a7add1d9996.tar.bz2  -O /opt/glue.tar.bz2</span><br><span class="line">wget https://github.com/ClusterLabs/resource-agents/archive/v3.9.6.tar.gz -O /opt/resource-agents.tar.bz2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#4.å®‰è£…glue</span></span><br><span class="line">tar xf glue.tar.bz2 </span><br><span class="line">./autogen.sh</span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/heartbeat --with-daemon-user=hacluster --with-daemon-group=haclient --<span class="built_in">enable</span>-fatal-warnings=no LIBS=<span class="string">'/lib64/libuuid.so.1'</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">echo</span> $?</span><br><span class="line"></span><br><span class="line"><span class="comment">#5.å®‰è£…Resource Agents</span></span><br><span class="line">tar xf resource-agents.tar.bz2 </span><br><span class="line"><span class="built_in">cd</span> resource-agents-3.9.6/</span><br><span class="line">./autogen.sh </span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/heartbeat --with-daemon-user=hacluster --with-daemon-group=haclient --<span class="built_in">enable</span>-fatal-warnings=no LIBS=<span class="string">'/lib64/libuuid.so.1'</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">echo</span> $?</span><br><span class="line"></span><br><span class="line"><span class="comment">#6.å®‰è£…HeartBeat</span></span><br><span class="line">tar xf heartbeat3.tar.bz2</span><br><span class="line">./bootstrap</span><br><span class="line"><span class="built_in">export</span> CFLAGS=<span class="string">"<span class="variable">$CFLAGS</span> -I/usr/local/heartbeat/include -L/usr/local/heartbeat/lib"</span></span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/heartbeat --with-daemon-user=hacluster --with-daemon-group=haclient --<span class="built_in">enable</span>-fatal-warnings=no LIBS=<span class="string">'/lib64/libuuid.so.1'</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">echo</span> $?</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#7.é…ç½®ç½‘å¡æ”¯æŒæ’ä»¶æ–‡ä»¶</span></span><br><span class="line">mkdir -pv /usr/<span class="built_in">local</span>/heartbeat/usr/lib/ocf/lib/heartbeat/</span><br><span class="line">cp /usr/lib/ocf/lib/heartbeat/ocf-* /usr/<span class="built_in">local</span>/heartbeat/usr/lib/ocf/lib/heartbeat/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼šä¸€èˆ¬å¯åŠ¨æ—¶ä¼šæŠ¥é”™å› ä¸º pingå’Œucastè¿™äº›é…ç½®éƒ½éœ€è¦æ’ä»¶æ”¯æŒ éœ€è¦å°†lib64ä¸‹é¢çš„æ’ä»¶è½¯è¿æ¥åˆ°libç›®å½• æ‰ä¸ä¼šæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">ln -svf /usr/<span class="built_in">local</span>/heartbeat/lib64/heartbeat/plugins/RAExec/* /usr/<span class="built_in">local</span>/heartbeat/lib/heartbeat/plugins/RAExec/</span><br><span class="line">ln -svf /usr/<span class="built_in">local</span>/heartbeat/lib64/heartbeat/plugins/* /usr/<span class="built_in">local</span>/heartbeat/lib/heartbeat/plugins/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å®‰è£…åä¸»è¦å¾—ç›®å½•é…ç½®æ–‡ä»¶</span></span><br><span class="line">heartbeat configuration:</span><br><span class="line">  Version                  = <span class="string">"3.0.6"</span></span><br><span class="line">  Executables              = <span class="string">"/usr/local/heartbeat/sbin"</span></span><br><span class="line">  Man pages                = <span class="string">"/usr/local/heartbeat/share/man"</span></span><br><span class="line">  Libraries                = <span class="string">"/usr/local/heartbeat/lib64"</span></span><br><span class="line">  Header files             = <span class="string">"/usr/local/heartbeat/include"</span></span><br><span class="line">  Arch-independent files   = <span class="string">"/usr/local/heartbeat/share"</span></span><br><span class="line">  Documentation files      = <span class="string">"/usr/local/heartbeat/share/doc/heartbeat"</span></span><br><span class="line">  State information        = <span class="string">"/usr/local/heartbeat/var"</span></span><br><span class="line">  System configuration     = <span class="string">"/usr/local/heartbeat/etc"</span></span><br><span class="line">  Init (rc) scripts        = <span class="string">"/etc/rc.d/init.d"</span></span><br><span class="line">  Init (rc) defaults       = <span class="string">"/etc/sysconfig"</span></span><br><span class="line">  Use system LTDL          = <span class="string">"yes"</span></span><br><span class="line">  HA group name            = <span class="string">"haclient"</span></span><br><span class="line">  HA group id              = <span class="string">"1001"</span></span><br><span class="line">  HA user name             = <span class="string">"hacluster"</span></span><br><span class="line">  HA user user id          = <span class="string">"1001"</span></span><br><span class="line">  Build dopd plugin        = <span class="string">"yes"</span></span><br><span class="line">  Enable <span class="built_in">times</span> kludge      = <span class="string">"yes"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#8. é…ç½®heartbeaté…ç½®æ–‡ä»¶(å‚è€ƒä¸Šé¢å³å¯)</span></span><br><span class="line"><span class="comment">#æ‹·è´ä¸‰ä¸ªæ¨¡ç‰ˆé…ç½®æ–‡ä»¶åˆ° /usr/local/heartbeat/etc/ha.d ç›®å½•ä¸‹ </span></span><br><span class="line">cp /usr/<span class="built_in">local</span>/heartbeat/share/doc/heartbeat/&#123;ha.cf,haresources,authkeys&#125; /usr/<span class="built_in">local</span>/heartbeat/etc/ha.d/</span><br><span class="line">vim /usr/<span class="built_in">local</span>/heartbeat/etc/ha.d/ha.cf</span><br><span class="line"><span class="comment">#éå¸¸å»ºè®®ä½¿ç”¨å•æ’­æ–¹æ³• ï¼ˆéå¸¸æ³¨æ„ç½‘å¡ -- å·¨å‘ï¼‰</span></span><br><span class="line">mcast eth2 225.0.0.200 694 1 0   <span class="comment">#å¤šæ’­ä¼ é€å¿ƒè·³çš„ç½‘å¡ å¤šæ’­ç»„ ç«¯å£ è·ƒç‚¹æ•° æ˜¯å¦å›ç¯å†…ä¼ é€</span></span><br><span class="line">ucast eth2 192.168.2.100  <span class="comment">#å¯¹ç«¯ - data2ä¸Šé…ç½®</span></span><br><span class="line">ucast eth2 192.168.2.101  <span class="comment">#å¯¹ç«¯ - data1ä¸Šé…ç½®</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /usr/<span class="built_in">local</span>/heartbeat/etc/ha.d/authkeys</span><br><span class="line">vim /usr/<span class="built_in">local</span>/heartbeat/etc/ha.d/haresources</span><br><span class="line"><span class="comment">#æŒ‡å®šèŠ‚ç‚¹ä¸»æœºåï¼Œå’ŒVIPåœ°å€ï¼Œä»¥åŒå†’å·åˆ†éš”èµ„æºï¼Œæ­¤å¤„ä»¥apacheä¸ºä¾‹è¿›è¡Œé…ç½®</span></span><br><span class="line">node1 192.168.1.200 apache::/etc/httpd/conf/httpd.conf</span><br><span class="line">data1 IPaddr::192.168.1.200/24/eth1  <span class="comment">#VIP æ¼‚ç§»å¾—IP</span></span><br><span class="line">data2 IPaddr::192.168.1.201/24/eth1</span><br><span class="line"></span><br><span class="line"><span class="comment">#9.è®¾ç½®æƒé™éå¸¸é‡è¦</span></span><br><span class="line">chmod 600 /usr/<span class="built_in">local</span>/heartbeat/etc/ha.d/authkeys</span><br><span class="line">chown -R root:haclient /usr/<span class="built_in">local</span>/heartbeat/</span><br><span class="line"></span><br><span class="line">[root@data1 heartbeat]<span class="comment"># ip addr | grep "192.168"</span></span><br><span class="line">    inet 192.168.1.100/24 brd 192.168.1.255 scope global eth1</span><br><span class="line">    inet 192.168.1.201/24 brd 192.168.1.255 scope global secondary eth1:0</span><br><span class="line">    inet 192.168.1.200/24 brd 192.168.1.255 scope global secondary eth1:1</span><br><span class="line">    inet 192.168.2.100/24 brd 192.168.2.255 scope global noprefixroute eth2</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=é«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆ(DBA).md href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190429150631.png" target="_blank" title="WeiyiGeek.æµ‹è¯•æ¥ç®¡" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190429150631.png" alt="WeiyiGeek.æµ‹è¯•æ¥ç®¡" title="" class=""></a>
                <p>WeiyiGeek.æµ‹è¯•æ¥ç®¡</p>
            </figure></p>
<p><br><br><strong>4.å¦‚ä½•é…ç½®nfsçš„é«˜å¯ç”¨</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é…ç½®NFSå…±äº«å­˜å‚¨</span></span><br><span class="line"><span class="comment">#åœ¨å»ºç«‹NFSçš„æœåŠ¡å™¨ä¸Šå»ºç«‹NFSå­˜å‚¨ï¼š</span></span><br><span class="line">yum install nfs-utils rpcbind</span><br><span class="line">systemctl start rpcbind</span><br><span class="line">systemctl start nfs</span><br><span class="line">cat /etc/exports  <span class="comment">#å»ºç«‹NFSå…±äº«å­˜å‚¨</span></span><br><span class="line">/data 192.168.146.0/24(ro)</span><br><span class="line">mkdir /data  <span class="comment">#å»ºç«‹æµ‹è¯•æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'&lt;h1&gt;nfs server&lt;/h1&gt;'</span> &gt; /data/index.html</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç„¶åä¿®æ”¹haresourcesé…ç½®æ–‡ä»¶æ·»åŠ è‡ªåŠ¨æŒ‚è½½nfsèµ„æºï¼š</span></span><br><span class="line">node1.pjy.com IPaddr::192.168.146.222/24/ens33 Filesystem::192.168.146.151:/data::/var/www/html::nfs::ro apache::/etc/httpd/conf/httpd.conf</span><br><span class="line"></span><br><span class="line">pz142  IPaddr::192.168.146.222/24/eth0 drbddisk::nfddrbd Filesystem::/dev/drbd0::/data/image::ext4 killnfsd</span><br><span class="line"><span class="comment">#kulllnfsdè„šæœ¬</span></span><br><span class="line"><span class="comment">#killall -9 nfsd; /etc/init.d/nfs restart; /etc/init.d/nfs restart; exit 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡å¯heartbeatæœåŠ¡åŠ è½½é…ç½®</span></span><br><span class="line">systemctl restart heartbeat</span><br><span class="line">ssh node2 <span class="string">'systemctl restart heartbeat'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æµ‹è¯•æ˜¯å¦åŠ è½½èµ„æºï¼š</span></span><br><span class="line">ip addr</span><br><span class="line">netstat -lntup</span><br><span class="line">mount</span><br><span class="line"></span><br><span class="line"><span class="comment">#èµ„æºè½¬ç§»æµ‹è¯•ï¼š</span></span><br><span class="line">/usr/<span class="built_in">local</span>/heartbeat/share/heartbeat/hb_standby</span><br></pre></td></tr></table></figure></p>

        </div>
        
  <hr>
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>

  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>

  <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ï¼Œè½¬ä¸ªå‘ã€‘(äººé—´äº”å¤§æƒ…)</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œè°¢è°¢ï¼ã€‚</p>

  <div>
    <img src="https://www.weiyigeek.top/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul>

  <div>
    <img src="/img/wechat-search.png" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·"  width="380" height="170">
    <img src="/img/wechat-app.png" class="img-responsive" alt="æ‰«æVisit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº"  width="385" height="170">
  </div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-03-29T05:39:06.301Z" itemprop="dateUpdated">2022-03-29 13:39:06</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç³»ç»Ÿè¿ç»´/ç³»ç»Ÿæ¶æ„/é«˜å¯ç”¨/Heartbeaté«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆ.md" target="_blank" rel="noopener noreferrer">_posts/ç³»ç»Ÿè¿ç»´/ç³»ç»Ÿæ¶æ„/é«˜å¯ç”¨/Heartbeaté«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆ.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2019/4-9-261.html" target="_blank" rel="external">https://blog.weiyigeek.top/2019/4-9-261.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">ğŸ‘ é’Ÿæ„ä½œè€…</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9C%8D%E5%8A%A1/" rel="tag">é«˜å¯ç”¨æœåŠ¡</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/4-9-261.html&title=ã€Šé«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆ(DBA).mdã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/4-9-261.html&title=ã€Šé«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆ(DBA).mdã€‹ â€” WeiyiGeek Blog&source=[TOC]
æ–‡ç« ç›®å½•(1) Heartbeat é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/4-9-261.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Šé«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆ(DBA).mdã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/4-9-261.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/4-9-261.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/4-10-434.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Winå†…ç½‘æ¸—é€ä¿¡æ¯æœå¯».md</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/3-31-382.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">SQLæ³¨å…¥åŸç†åˆ†æä¸ç»•è¿‡æ¡ˆä¾‹.md</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#æ–‡ç« ç›®å½•"><span class="post-toc-number">1.</span> <span class="post-toc-text">æ–‡ç« ç›®å½•</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x00-Heartbeat-é«˜å¯ç”¨"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x00 Heartbeat é«˜å¯ç”¨</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

  <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¿˜è¯·æ”¯æŒä¸€ä¸‹åšä¸»å“Ÿ, è°¢è°¢å„ä½çœ‹å‹â™¥!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

  
 <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->

  <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">ä¸ªäººGithub</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">ä¸ªäººGitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">ä¸ªäººçŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘+äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/4-9-261.html&title=ã€Šé«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆ(DBA).mdã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/4-9-261.html&title=ã€Šé«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆ(DBA).mdã€‹ â€” WeiyiGeek Blog&source=[TOC]
æ–‡ç« ç›®å½•(1) Heartbeat é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/4-9-261.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Šé«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆ(DBA).mdã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/4-9-261.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/4-9-261.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACG0lEQVR42u3a227CQAwFQP7/p+krUkt6bAMS3slTFUiyQyXHl73d4uP+cDye+f1p75vPrn3xgYGB8bWM5HbXS8nZ19+vsjEwME5j5LdOHpxflZy5XhsGBgZGHnDvgyP/+TAwMDCqwTEvdHtBFgMDA6NaxFaDbPT4z9fiGBgYX8jIu+6f//st8w0MDIyvYkxKzUmgfHEBjIGBsZrRG2FOwmU1vSskmhgYGEsZkzI1X1zSdKtS/3hvYGBgrGbkgS9pmU3GCXnQx8DAOI2RDy97oXaebhbeGxgYGKsZ14Gyl+S9aiARNdowMDCWMqpLnGyqqKaJ+VUYGBi7GclCe+ykBJ0H7qe1OAYGxiJGnopVAUmK+b4SFwMDYx9jkrTl2yMSXhJMn16LgYGxlFF9WLUyztn5EwtZKgYGxgrGpE1f3WwxP4+BgXEyo7cxKz+Tt8xG/wcMDIyljHwMOWnx58OGajGMgYFxAiNfdPJpj10dgv7zo2BgYCxlTDZ79TZh5AG68CwMDIxjGPOk8B2NtoiKgYGxmtELnfNxwvxuGBgYJzDuxaO6iEk7L38NYGBg7GbMo3WVUR2C5k1ADAyM3Yx8m0W1rd8rRHsjTwwMjBMYSeqWbIDIF9p7A0QzWAwMjOMZ1WurBW1yZwwMDIyEkaSSearXK3cxMDBOY+RFbA6oBuvqIGHUbsPAwPgqxqSXlZSy1UX0tqlhYGAsZfwALKzWLFj+ts8AAAAASUVORK5CYII=" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 



  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 
     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>
