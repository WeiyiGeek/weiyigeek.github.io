{"title":"系统各类日志查看","slug":"系统运维/Linux/常用命令/系统管理类命令/系统各类日志查看处理","date":"2019-06-06T11:35:30.000Z","updated":"2023-01-31T02:29:09.176Z","url":"2019/6-6-165.html","path":"api/articles/2019/6-6-165.html.json","covers":["https://img.weiyigeek.top/2019/20190606092157.png","https://img.weiyigeek.top/2019/1/20190802130956.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-快速入门\"><a href=\"#0x00-快速入门\" class=\"headerlink\" title=\"0x00 快速入门\"></a>0x00 快速入门</h4><p>包含了用户日志、服务进程日志、系统安全日志等(syslog);</p>\n<h5 id=\"logrotate-命令\"><a href=\"#logrotate-命令\" class=\"headerlink\" title=\"logrotate 命令\"></a>logrotate 命令</h5><p>描述：用于对系统日志进行轮转、压缩和删除，也可以将日志发送到指定邮箱,防止linux系统日志文件过大</p>\n<p><em>使用logrotate指令优点：</em><br>可让你轻松管理系统所产生的记录文件，每个记录文件都可被设置成每日，每周或每月处理，也能在文件太大时立即处理。</p>\n<p>预设的配置文件存放在/etc/logrotate.conf文件中，可以管理wtmp/btmp等产生的日志的配置选项;</p>\n<p>这是一个text文档，包含许多配置选项（如下表），可以给系统的任何日志制定配置参数，此外这些选项还允许logrotate从其他日志文件读取和使用参数。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># see \"man logrotate\" for details</span></span><br><span class=\"line\"><span class=\"comment\"># rotate log files weekly</span></span><br><span class=\"line\">weekly</span><br><span class=\"line\"><span class=\"comment\"># keep 4 weeks worth of backlogs</span></span><br><span class=\"line\">rotate 4</span><br><span class=\"line\"><span class=\"comment\"># create new (empty) log files after rotating old ones</span></span><br><span class=\"line\">create</span><br><span class=\"line\"><span class=\"comment\"># uncomment this if you want your log files compressed</span></span><br><span class=\"line\"><span class=\"comment\">#compress</span></span><br><span class=\"line\"><span class=\"comment\"># use date as a suffix of the rotated filedateext</span></span><br><span class=\"line\"><span class=\"comment\"># RPM packages drop log rotation information into this directory</span></span><br><span class=\"line\">include /etc/logrotate.d</span><br><span class=\"line\"><span class=\"comment\"># no packages own wtmp -- we'll rotate them here</span></span><br><span class=\"line\">/var/<span class=\"built_in\">log</span>/wtmp &#123;</span><br><span class=\"line\">  monthly</span><br><span class=\"line\">  minsize 1M</span><br><span class=\"line\">  create 0664 root utmp</span><br><span class=\"line\">  rotate 1</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">#至于logrotate对文件进行管理时的所要执行的规则，可以在/etc/logrotate.d文件夹下创建文件，logrotate会在执行的时候自动读取相应的规则，比如我在/etc/logrotate.d/路径下新建了一个名为syslog的文件，其中的内容为：</span></span><br><span class=\"line\">/var/<span class=\"built_in\">log</span>/mail.info</span><br><span class=\"line\">/var/<span class=\"built_in\">log</span>/mail.warn</span><br><span class=\"line\">/var/<span class=\"built_in\">log</span>/mail.err</span><br><span class=\"line\">/var/<span class=\"built_in\">log</span>/mail.log</span><br><span class=\"line\">/var/<span class=\"built_in\">log</span>/daemon.log</span><br><span class=\"line\">/var/<span class=\"built_in\">log</span>/kern.log</span><br><span class=\"line\">/var/<span class=\"built_in\">log</span>/auth.log</span><br><span class=\"line\">/var/<span class=\"built_in\">log</span>/user.log</span><br><span class=\"line\">/var/<span class=\"built_in\">log</span>/lpr.log</span><br><span class=\"line\">/var/<span class=\"built_in\">log</span>/cron.log</span><br><span class=\"line\">/var/<span class=\"built_in\">log</span>/debug</span><br><span class=\"line\">/var/<span class=\"built_in\">log</span>/messages</span><br><span class=\"line\">/<span class=\"built_in\">log</span>/test.log </span><br><span class=\"line\">&#123; </span><br><span class=\"line\">         size 10M </span><br><span class=\"line\">         create </span><br><span class=\"line\">         start 10 </span><br><span class=\"line\">         rotate 4 </span><br><span class=\"line\">         compress </span><br><span class=\"line\">         copytruncate</span><br><span class=\"line\">         postrotate      <span class=\"comment\">#轮换过后重启rsyslog服务；</span></span><br><span class=\"line\">            invoke-rc.d rsyslog rotate &gt; /dev/null</span><br><span class=\"line\">         endscript       <span class=\"comment\">#结束脚本；</span></span><br><span class=\"line\">&#125; </span><br><span class=\"line\"><span class=\"comment\">#当文件/log/test.log的大小超过10M时就开始循环，允许logrotate创建文件，循环文件的开始为10，即文件为为test.log.10.gz，最多循环创建4个文件，即为test.log.13.gz，多于四个后开始在第一个上面循环，依次迭代。</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Function 参数解释</span></span><br><span class=\"line\">compress — 用gzip压缩旋转的日志文件。</span><br><span class=\"line\">nocompress — 在不需要压缩旋转日志文件的情况下使用。</span><br><span class=\"line\">copytruncate — 用于还在向开放日志文件写信息的过程。该选择将活归档日志文件制成副本。</span><br><span class=\"line\">nocopytruncate — 把日志文件复制进备份，但该开放文件不会被裁剪。</span><br><span class=\"line\">create mode owner group — 旋转日志文件并创建允许特定组合用户的新文件。缺省是使用与原始文件一样的模式，组合用户。</span><br><span class=\"line\">nocreate — 可以防止产生新日志文件。</span><br><span class=\"line\">delaycompress — 在使用压缩选择时，旋转文件不会在下一个循环开始时被压缩。</span><br><span class=\"line\">nodelaycompress –    日志文件会在循环过程中被压缩。</span><br><span class=\"line\">errors address — 将logrotate错误邮件发送到某个地址。</span><br><span class=\"line\">ifempty — 即使在空文件时也要旋转。这是Logrotate的缺省项。</span><br><span class=\"line\">notifempty — 空文件不旋转。</span><br><span class=\"line\">mail address — 这个邮件日志文件是循环到一个地址，因此能有效从系统中清楚。</span><br><span class=\"line\">nomail    在邮件日志循环时，副本不邮寄。</span><br><span class=\"line\">olddir directory — 这个选项会将循环日志文件保持在特定目录。该目录必需与现有日志文件在同一文件系统。</span><br><span class=\"line\">noolddir — 循环的日志文件与现有文件处于相同目录。</span><br><span class=\"line\">prerotate/endscript — 结束和执行旋转任务。</span><br><span class=\"line\">postrotate/endscript — 可以在一个日志文件旋转时执行的命令。</span><br><span class=\"line\">daily — 每日旋转日志文件。</span><br><span class=\"line\">weekly — 每周旋转日志文件。</span><br><span class=\"line\">monthly — 每月旋转日志文件。</span><br><span class=\"line\">rotate count — 在删除前旋转文件的特定次数。如果计数为零，就意味着没有副本保留。而5则意味着保留5个副本。</span><br><span class=\"line\">tabootext [+] list — This directs logrotate to not rotate files with the specified extension. The default list of extensions is .rpm-orig, .rpmsave, v, and ~。</span><br><span class=\"line\">size size — 在日志文件达到一定大小时开始旋转。大小是以bytes (默认), kilobytes (sizek)或megabytes (sizem)计算。</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190606092157.png\" alt=\"WeiyiGeek.配置\" title=\"\" class=\"\">\n                <p>WeiyiGeek.配置</p>\n            </figure>\n<p>基于语法：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#语法</span></span><br><span class=\"line\">logrotate(选项)(参数)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#选项</span></span><br><span class=\"line\">-?或--<span class=\"built_in\">help</span>：在线帮助； </span><br><span class=\"line\">-d或--debug：详细显示指令执行过程，便于排错或了解程序执行的情况； </span><br><span class=\"line\">-f或--force ：强行启动记录文件维护操作，纵使logrotate指令认为没有需要亦然； </span><br><span class=\"line\">-s&lt;状态文件&gt;或--state=&lt;状态文件&gt;：使用指定的状态文件； </span><br><span class=\"line\">-v或--version：显示指令执行过程； </span><br><span class=\"line\">-usage：显示指令基本用法。</span><br></pre></td></tr></table></figure></p>\n<p>实际案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p><em>logrotate规则配置好后怎么定时去执行呢？</em><br>答：这个就可以交给Linux中的crontab来控制了</p>\n<p><br></p>\n<h5 id=\"logger-命令-重要\"><a href=\"#logger-命令-重要\" class=\"headerlink\" title=\"logger 命令(重要)\"></a>logger 命令(重要)</h5><p>描述：syslog是Linux系统默认的日志守护进程，用于往系统中写入日志也可以接受来自系统的各种功能的信息，他提供一个shell命令接口到syslog系统模块。</p>\n<p>默认的syslog配置文件是/etc/syslog.conf文件，程序，守护进程和内核提供了访问系统的日志信息;因此任何希望生成日志信息的程序都可以向 syslog 接口呼叫生成该信息。</p>\n<p>几乎所有的网络设备都可以通过syslog协议，将日志信息以用户数据报协议(UDP)方式传送到远端服务器，远端接收日志服务器必须通过syslogd监听UDP 端口514，并根据 syslog.conf配置文件中的配置处理本机，接收访问系统的日志信息，把指定的事件写入特定文件中，供后台数据库管理和响应之用。</p>\n<p>意味着可以让任何事件都登录到一台或多台服务器上，以备后台数据库用off-line(离线) 方法分析远端设备的事件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#用法</span></span><br><span class=\"line\">logger [options] [messages]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#参数</span></span><br><span class=\"line\">-d, --udp </span><br><span class=\"line\">        使用数据报(UDP)而不是使用默认的流连接(TCP)</span><br><span class=\"line\">-i, --id  </span><br><span class=\"line\">        逐行记录每一次logger的进程ID</span><br><span class=\"line\">-f, --file file_name</span><br><span class=\"line\">        记录特定的文件</span><br><span class=\"line\">-h, --<span class=\"built_in\">help</span></span><br><span class=\"line\">        显示帮助文本并退出</span><br><span class=\"line\">-n， --server</span><br><span class=\"line\">        写入指定的远程syslog服务器，使用UDP代替内装式syslog的例程</span><br><span class=\"line\">-P(大)， --port port_num</span><br><span class=\"line\">        使用指定的UDP端口。默认的端口号是514</span><br><span class=\"line\">-p(小)， --priority priority_level</span><br><span class=\"line\">        指定输入消息的优先级，优先级可以是数字或者指定为 <span class=\"string\">\" facility.level\"</span> 的格式。比如：<span class=\"string\">\" -p local3.info \"</span> local3 这个设备的消息级别为 info。默认级别是 <span class=\"string\">\"user.notice\"</span></span><br><span class=\"line\">-s， --stderr</span><br><span class=\"line\">        输出标准错误到系统日志。</span><br><span class=\"line\">-t， --tag tag</span><br><span class=\"line\">        指定标记记录</span><br><span class=\"line\">-u， --socket socket</span><br><span class=\"line\">        写入指定的socket，而不是到内置系统日志例程。</span><br><span class=\"line\">-V, --version</span><br><span class=\"line\">        现实版本信息并退出</span><br></pre></td></tr></table></figure>\n<p>/etc/syslog.conf 文件通知 syslogd 如何根据设备和信息重要级别来报告信息:<br>日志级别：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">facility：</span><br><span class=\"line\">    auth：             用户授权</span><br><span class=\"line\">    authpriv：         授权和安全</span><br><span class=\"line\">    cron：             计划任务</span><br><span class=\"line\">    daemon：           系统守护进程</span><br><span class=\"line\">    kern：             与内核有关的信息</span><br><span class=\"line\">    lpr                与打印服务有关的信息</span><br><span class=\"line\">    mail               与电子邮件有关的信息</span><br><span class=\"line\">    news               来自新闻服务器的信息</span><br><span class=\"line\">    syslog             由syslog生成的信息</span><br><span class=\"line\">    user               用户的程序生成的信息，默认</span><br><span class=\"line\">    uucp               由uucp生成的信息</span><br><span class=\"line\">    local0~7           用来定义本地策略</span><br><span class=\"line\"> </span><br><span class=\"line\">level：</span><br><span class=\"line\">    alert          需要立即采取动作</span><br><span class=\"line\">    crit           临界状态</span><br><span class=\"line\">    debug          调试</span><br><span class=\"line\">    emerg          系统不可用</span><br><span class=\"line\">    err            错误状态</span><br><span class=\"line\">    error          错误状态</span><br><span class=\"line\">    info           正常消息</span><br><span class=\"line\">    notice         正常但是要注意</span><br></pre></td></tr></table></figure></p>\n<p>实际案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1.在/var/log中创建并写入日志信息由syslog协议处理的,是由守护进程sylogd负责执行，每个标准进程都可以用syslog记录日志,可以使用logger命令通过syslogd记录日志</span></span><br><span class=\"line\">logger <span class=\"string\">\"This is a test logger\"</span></span><br><span class=\"line\">[root@izwz9biz2m4sd3bb3k38pgz ~]<span class=\"comment\"># tail -n 1 /var/log/messages</span></span><br><span class=\"line\">Jun  6 09:41:03 izwz9biz2m4sd3bb3k38pgz root: This is a <span class=\"built_in\">test</span> logger</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例2.如果要记录特定的标记（tag）可以使用：</span></span><br><span class=\"line\">logger -t FLAG-TAG <span class=\"string\">\"This is a test logger demo 2\"</span></span><br><span class=\"line\">[root@izwz9biz2m4sd3bb3k38pgz ~]<span class=\"comment\"># tail -n 1 /var/log/messages</span></span><br><span class=\"line\">Jun  6 09:42:09 izwz9biz2m4sd3bb3k38pgz FLAG-TAG: This is a <span class=\"built_in\">test</span> logger demo 2</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例3.连接远程rsyslog示(这样设置不带HOST名称)</span></span><br><span class=\"line\">logger -p user.notice -t bash-$$ -i -n 192.168.1.88 -- <span class=\"string\">\"<span class=\"variable\">$&#123;SSH_CONNECTION&#125;</span> - <span class=\"variable\">$&#123;USER&#125;</span> - <span class=\"variable\">$&#123;PWD&#125;</span> - <span class=\"variable\">$&#123;command&#125;</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例4.连接远程rsyslog示(带HOST名称)</span></span><br><span class=\"line\">logger -p user.notice -t bash-$$ -i -- <span class=\"string\">\"<span class=\"variable\">$&#123;SSH_CONNECTION&#125;</span> - <span class=\"variable\">$&#123;USER&#125;</span> - <span class=\"variable\">$&#123;PWD&#125;</span> - <span class=\"variable\">$&#123;command&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"comment\">#编辑rsyslog文件</span></span><br><span class=\"line\">user.* @@192.168.1.88:514</span><br><span class=\"line\"><span class=\"comment\"># Aug  2 13:42:35\t10.10.107.222\tmaster\tlocal1\tnotice\tbash-12610[12650]\t192.168.1.88 52965 10.10.107.222 22 - root - /root - grep --color=auto \"12610\"</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20190802130956.png\" alt=\"WeiyiGeek.syslog日志收集\" title=\"\" class=\"\">\n                <p>WeiyiGeek.syslog日志收集</p>\n            </figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Linux命令","path":"api/categories/Linux命令.json"}],"tags":[{"name":"系统命令","path":"api/tags/系统命令.json"}]}