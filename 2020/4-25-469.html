<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="k8s">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-04-25T10:37:47.000Z" itemprop="datePublished" class="page-time">
  2020-04-25
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-04-25 18:37:47" datetime="2020-04-25T10:37:47.000Z"  itemprop="datePublished">2020-04-25</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h3 id="0x00-å‰è¨€ç®€è¿°"><a href="#0x00-å‰è¨€ç®€è¿°" class="headerlink" title="0x00 å‰è¨€ç®€è¿°"></a>0x00 å‰è¨€ç®€è¿°</h3><p>æè¿°: é€šè¿‡ä¸Šä¸€ç¯‡K8så…¥é—¨ä½“ç³»æ¶æ„å­¦ä¹ æˆ‘ä»¬åˆæ­¥çš„äº†è§£å•èŠ‚ç‚¹çš„masterä¸workerçš„å·¥ä½œéƒ¨ç½²æµç¨‹ï¼Œä½†æ˜¯å‰é¢æ‰€ç”¨çš„æ˜¯kuboardæ‰€æä¾›çš„å®‰è£…è„šæœ¬ä½œä¸ºæµ‹è¯•ç»ƒæ‰‹å®‰è£…è¿˜æ˜¯å¯ä»¥å°†å°±çš„ï¼Œä½†æ˜¯åœ¨å®é™…çš„ç”Ÿäº§çš„ç¯å¢ƒä¸­ç”±äºä¸šåŠ¡çš„å¤æ‚æ€§å’Œå¤šæ ·æ€§éœ€è¦ä¾é é›†ç¾¤æ¥ä¿è¯å…¶å®‰å…¨å¯é æ€§;</p>
<p>å®‰è£…K8så‰æˆ‘ä»¬éœ€è¦ä»é›†ç¾¤è§„åˆ’çš„ä»¥ä¸‹å‡ æ–¹é¢å…¥æ‰‹å‡†å¤‡:</p>
<ul>
<li>(1) æ“ä½œç³»ç»Ÿ (OS)<br>æè¿°:åœ¨ä½¿ç”¨ CentOS 7x ç³»çš„ OS æ—¶å»ºè®®å‡çº§ä¸€ä¸‹å†…æ ¸ç‰ˆæœ¬(<code>stable  &gt;= 4.19</code>)ï¼Œä¸ç„¶åœ¨è¿è¡Œä¸€äº› java å®¹å™¨çš„æ—¶å€™å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚å‰æœŸå¯ä»¥åœ¨æµ‹è¯•ç¯å¢ƒéƒ¨ç½²ä¸€äº› Java åº”ç”¨ä¸šåŠ¡ï¼Œè§‚å¯Ÿæ˜¯å¦ä¼šé‡åˆ°æ­¤ç±»é—®é¢˜ï¼Œå¦‚æœé‡åˆ°æ­¤ç±»é—®é¢˜å¯å°è¯•é€šè¿‡å‡çº§å†…æ ¸ç‰ˆæœ¬æ¥è§£å†³ã€‚</li>
</ul>
<blockquote>
<p>Q:Javaå®¹å™¨ç¬é—´æ‹‰èµ·çš„è¿‡ç¨‹ï¼Œæ•´ä¸ªé›†ç¾¤éƒ½ä¼šè¢«CPUç”¨å°½ï¼Œå¦‚ä½•è§£å†³Java CPUå¯åŠ¨æ—¶å€™CPUèµ„æºäº’äº‰çš„æƒ…å†µï¼Ÿ<br>A:è¿™ä¸ªé—®é¢˜æˆ‘ä»¬ä¹Ÿé‡åˆ°è¿‡ï¼Œåæ¥æŠŠå†…æ ¸å‡çº§åˆ°4.19åå°±ä¸å†å‘ç”Ÿäº†å¾ˆå¤šå†…å­˜è€—å°½ï¼ŒCPUçˆ†ç‚¸çš„é—®é¢˜æˆ‘ä»¬éƒ½é€šè¿‡å†…æ ¸å‡çº§è§£å†³äº†ã€‚</p>
</blockquote>
<p>PS : æ³¨æ„åœ¨Linux Kernel 3.10.x å†…æ ¸å­˜åœ¨ä¸€äº› Bugsï¼Œå¯¼è‡´è¿è¡Œçš„ Dockerã€Kubernetes ä¸ç¨³å®š<br>PS : å‰é¢æˆ‘ä»¬è¯´è¿‡å¯¹äºNodeå·¥ä½œè´Ÿè½½çš„èŠ‚ç‚¹å°½å¯èƒ½é€‰æ‹©ç‰©ç†æœºå™¨ï¼Œè€ŒMasterèŠ‚ç‚¹ä¸ºäº†ä¾¿äºæ¢å¤å»ºè®®å®‰è£…åœ¨vSphereè™šæ‹ŸåŒ–ç¯å¢ƒä¹‹ä¸­;</p>
<p><br></p>
<ul>
<li>(2) ç¨³å®šç‰ˆæœ¬é€‰æ‹© (VERSION)</li>
</ul>
<p>ç›®å‰æˆªè‡³æœ¬æ–‡æ¡£æ±‡æ€»æ—¶ï¼ˆ2020-06-20ï¼‰ï¼ŒKubernetes å®˜æ–¹è¿˜åœ¨ç»´æŠ¤çš„ release stable ç‰ˆæœ¬æœ‰ <code>1.16.x</code>ã€ <code>1.17.x</code> ã€<code>1.18.x</code> ã€‚<code>1.14.x</code> å’Œ <code>1.15.x</code> ç‰ˆæœ¬çš„ç”Ÿå‘½å‘¨æœŸéƒ½å·²ç»æ¥è¿‘ <code>EOL</code> ï¼Œå› æ­¤ä¸å»ºè®®é€‰æ‹©è¾ƒæ—§ç‰ˆæœ¬ã€‚ç»¼åˆè€ƒè™‘ï¼Œç›®å‰æ¥è®²é€‰æ‹© <code>4 &lt; x &lt; 10</code> å°ç‰ˆæœ¬ä¸­çš„  <code>1.17.4</code> æˆ– <code>1.17.5</code> ç‰ˆæœ¬æœ€ä¸ºåˆé€‚ä»¥åŠ<code>1.18.3</code>ã€‚</p>
<ul>
<li>å¯¹äº <code>docker-ce</code> ç‰ˆæœ¬ï¼Œé»˜è®¤ä½¿ç”¨å®˜æ–¹ yum æºä¸­çš„æœ€æ–°ç‰ˆæœ¬å³å¯ï¼Œå³ <code>docker-ce-19.03.9-3.el7</code>ã€‚</li>
<li>å¯¹äº <code>harbor</code> ç‰ˆæœ¬ï¼Œè€ƒè™‘åˆ° harbor <a href="https://github.com/goharbor/harbor/releases/tag/v2.0.0-rc1" target="_blank" rel="noopener">v2.0.0-rc1</a> åˆšåˆš release ï¼Œä½†ä¸å»ºè®®é€‰æ‹©ä½¿ç”¨ï¼Œå»ºè®®é€‰æ‹© <a href="https://github.com/goharbor/harbor/releases/tag/v1.9.4" target="_blank" rel="noopener">v1.9.4</a> ç‰ˆæœ¬ï¼Œåç»­å¦‚æœæœ‰é‡åˆ°é—®é¢˜å¿…é¡»é€šè¿‡å‡çº§çš„æ–¹å¼è§£å†³ï¼Œå¯ä»¥è€ƒè™‘å‡çº§åˆ°å·²ç» release stable ç‰ˆæœ¬çš„ <code>v2.x.x</code> ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">pkg</th>
<th style="text-align:center">version</th>
<th style="text-align:center">release date</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">kubernetes</td>
<td style="text-align:center"><a href="https://github.com/kubernetes/kubernetes/releases/tag/v1.17.5" target="_blank" rel="noopener">v1.17.5</a></td>
<td style="text-align:center">2020-04-16</td>
</tr>
<tr>
<td style="text-align:center">docker-ce</td>
<td style="text-align:center"><a href="https://github.com/docker/docker-ce/releases/tag/v19.03.9" target="_blank" rel="noopener">19.03.9</a></td>
<td style="text-align:center">2020-04-12</td>
</tr>
<tr>
<td style="text-align:center">harbor</td>
<td style="text-align:center"><a href="https://github.com/goharbor/harbor/releases/tag/v1.9.4" target="_blank" rel="noopener">v1.9.4</a></td>
<td style="text-align:center">2020-12-31</td>
</tr>
</tbody>
</table>
<hr>
<p><br></p>
<ul>
<li>3.å­˜å‚¨(Storage)</li>
</ul>
<p>åœ¨Kubernetesä¸­æ•°æ®å­˜å‚¨ä¸€èˆ¬æ˜¯é€šè¿‡å…±äº«æ–‡ä»¶çš„æ–¹å¼ï¼Œåœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­å¤šé‡‡ç”¨NFS/åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸGlusterFSæˆ–è€…å…‰çº¤å­˜å‚¨ç­‰å…±äº«å­˜å‚¨æ–¹æ¡ˆï¼Œä¸ºå…¶æä¾›å­˜å‚¨ç©ºé—´;</p>
<p>å»ºè®®é‡‡ç”¨å­˜å‚¨æœåŠ¡å™¨è¿›è¡Œæä¾›å­˜å‚¨æœåŠ¡ï¼Œå¹¶ä¸”åœ¨ä¸è€ƒè™‘ç»è´¹çš„é—®é¢˜ä¸Šæ—¶å›ºæ€æ— ç–‘æ˜¯æœ€å¥½çš„é€‰æ‹©;</p>
<p><br></p>
<ul>
<li>4.ç½‘ç»œç¯å¢ƒ</li>
</ul>
<p>ä¸€èˆ¬æ¥è¯´kubernetesé›†ç¾¤åœ¨éƒ¨ç½²å®‰è£…æ—¶å€™ä¸ºäº†é˜²æ­¢é”™è¯¯éƒ½æ˜¯å°†é˜²ç«å¢™è¿›è¡Œå…³é—­éƒ¨ç½²çš„ï¼Œæ­¤æ—¶å…¶å®ƒç¡¬ä»¶æˆ–è€…è½¯ä»¶é˜²ç«å¢™æ˜¾å¾—å°¤ä¸ºé‡è¦ï¼Œå¹¶ä¸”äº¤æ¢æœºä¸€å®šè¦åˆ’åˆ†VLANåšéš”ç¦»;</p>
<hr>
<h3 id="0x01-å®‰è£…éƒ¨ç½²"><a href="#0x01-å®‰è£…éƒ¨ç½²" class="headerlink" title="0x01 å®‰è£…éƒ¨ç½²"></a>0x01 å®‰è£…éƒ¨ç½²</h3><p>æè¿°:æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰å®‰è£…æ‰€éœ€ç»„ä»¶å’Œæ’ä»¶æ‰€ä»¥æˆ‘ä»¬ä¸‹é¢è¿›è¡Œåˆ©ç”¨ <code>kubeadm</code> è¿›è¡Œæ‰‹åŠ¨éƒ¨ç½²K8S(<code>å•æœº|é›†ç¾¤</code>);</p>
<h4 id="0-åŸºç¡€å®‰è£…ç¯å¢ƒ"><a href="#0-åŸºç¡€å®‰è£…ç¯å¢ƒ" class="headerlink" title="0.åŸºç¡€å®‰è£…ç¯å¢ƒ"></a>0.åŸºç¡€å®‰è£…ç¯å¢ƒ</h4><p>æè¿°:åœ¨è¿›è¡Œkubeadmå®‰è£…çš„æ—¶å€™ï¼Œä¸è®ºæ˜¯workerèŠ‚ç‚¹æˆ–è€…masterèŠ‚ç‚¹éƒ½éœ€è¦è¿›è¡Œæ‰§è¡Œ;<br>ç³»ç»Ÿç¯å¢ƒå»ºè®®:</p>
<p><strong>ç³»ç»Ÿç‰ˆæœ¬</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#OS</span></span><br><span class="line">CentOS 7.x/8.x (æ¨èæ­¤å¤„ç¯å¢ƒ7.8),Ubuntu(18.04) </span><br><span class="line"><span class="comment">#Kerner</span></span><br><span class="line">OS KERNER &gt;= 4.18 </span><br><span class="line"><span class="comment">#Docker Version: 19.03.09</span></span><br><span class="line"><span class="comment">#kubernetes 1.18.3</span></span><br></pre></td></tr></table></figure></p>
<p><strong>ç¯å¢ƒæ£€æŸ¥</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">hostnamectl <span class="built_in">set</span>-hostname master-01</span><br><span class="line">hostnamectl status</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.kubeadmä¼šæ£€æŸ¥å½“å‰ä¸»æœºæ˜¯å¦ç¦ç”¨äº†`swap`,æ‰€ä»¥è¿™é‡Œä¸´æ—¶å…³é—­swap()å’ŒSELinux</span></span><br><span class="line"><span class="comment"># ä¸´æ—¶å…³é—­swapå’ŒSELinux</span></span><br><span class="line">swapoff -a</span><br><span class="line">setenforce 0</span><br><span class="line"><span class="comment"># æ°¸ä¹…å…³é—­swapå’ŒSELinux</span></span><br><span class="line">yes | cp /etc/fstab /etc/fstab_bak</span><br><span class="line">cat /etc/fstab_bak |grep -v swap &gt; /etc/fstab</span><br><span class="line">sed -i <span class="string">'s/^SELINUX=.*$/SELINUX=disabled/'</span> /etc/selinux/config</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.ä¸»æœºåè®¾ç½®</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"127.0.0.1 <span class="variable">$(hostname)</span>"</span> &gt;&gt; /etc/hosts</span><br><span class="line">cat  &lt;&lt;EOF &gt;&gt; /etc/hosts</span><br><span class="line">10.80.172.211  master-01</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.å…³é—­é˜²ç«å¢™</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure></p>
<p><strong>ç³»ç»Ÿå†…æ ¸å‚æ•°è°ƒæ•´:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/sysctl.conf è¿›è¡Œå†…æ ¸å‚æ•°çš„é…ç½®</span></span><br><span class="line"><span class="comment"># /etc/sysctl.d/99-kubernetes-cri.conf</span></span><br><span class="line">egrep -q <span class="string">"^(#)?net.ipv4.ip_forward.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.ipv4.ip_forward.*|net.ipv4.ip_forward = 1|g"</span>  /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.ipv4.ip_forward = 1"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">egrep -q <span class="string">"^(#)?net.bridge.bridge-nf-call-ip6tables.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.bridge.bridge-nf-call-ip6tables.*|net.bridge.bridge-nf-call-ip6tables = 1|g"</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.bridge.bridge-nf-call-ip6tables = 1"</span> &gt;&gt; /etc/sysctl.conf </span><br><span class="line">egrep -q <span class="string">"^(#)?net.bridge.bridge-nf-call-iptables.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.bridge.bridge-nf-call-iptables.*|net.bridge.bridge-nf-call-iptables = 1|g"</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.bridge.bridge-nf-call-iptables = 1"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">egrep -q <span class="string">"^(#)?net.ipv6.conf.all.disable_ipv6.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.ipv6.conf.all.disable_ipv6.*|net.ipv6.conf.all.disable_ipv6 = 1|g"</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.ipv6.conf.all.disable_ipv6 = 1"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">egrep -q <span class="string">"^(#)?net.ipv6.conf.default.disable_ipv6.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.ipv6.conf.default.disable_ipv6.*|net.ipv6.conf.default.disable_ipv6 = 1|g"</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.ipv6.conf.default.disable_ipv6 = 1"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">egrep -q <span class="string">"^(#)?net.ipv6.conf.lo.disable_ipv6.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.ipv6.conf.lo.disable_ipv6.*|net.ipv6.conf.lo.disable_ipv6 = 1|g"</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.ipv6.conf.lo.disable_ipv6 = 1"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">egrep -q <span class="string">"^(#)?net.ipv6.conf.all.forwarding.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.ipv6.conf.all.forwarding.*|net.ipv6.conf.all.forwarding = 1|g"</span>  /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.ipv6.conf.all.forwarding = 1"</span>  &gt;&gt; /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œå‘½ä»¤ä»¥åº”ç”¨</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="1-Docker-å®‰è£…é…ç½®"><a href="#1-Docker-å®‰è£…é…ç½®" class="headerlink" title="1.Docker å®‰è£…é…ç½®"></a>1.Docker å®‰è£…é…ç½®</h4><p>æè¿°:ä¸»è¦å°±æ˜¯ä¸‹è½½æŒ‡å®šçš„Docker-ceç‰ˆæœ¬ä»¥åŠdocker-composeçš„ä¸‹è½½é…ç½®,æ³¨æ„<code>åœ¨ master èŠ‚ç‚¹å’Œ worker èŠ‚ç‚¹éƒ½è¦æ‰§è¡Œ</code>;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€‚ç”¨äº:CentOS</span></span><br><span class="line"><span class="comment"># Docker hub é•œåƒåŠ é€Ÿæº:åœ¨ master èŠ‚ç‚¹å’Œ worker èŠ‚ç‚¹éƒ½è¦æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"># æœ€åä¸€ä¸ªå‚æ•° 1.18.2 ç”¨äºæŒ‡å®š kubenetes ç‰ˆæœ¬ï¼Œæ”¯æŒæ‰€æœ‰ 1.18.x ç‰ˆæœ¬çš„å®‰è£…</span></span><br><span class="line"><span class="comment"># è…¾è®¯äº‘ docker hub é•œåƒ</span></span><br><span class="line"><span class="comment"># export REGISTRY_MIRROR="https://mirror.ccs.tencentyun.com"</span></span><br><span class="line"><span class="comment"># DaoCloud é•œåƒ</span></span><br><span class="line"><span class="comment"># export REGISTRY_MIRROR="http://f1361db2.m.daocloud.io"</span></span><br><span class="line"><span class="comment"># é˜¿é‡Œäº‘ docker hub é•œåƒ</span></span><br><span class="line"><span class="built_in">export</span> REGISTRY_MIRROR=</span><br><span class="line"><span class="comment">#https://registry.cn-hangzhou.aliyuncs.com</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… docker</span></span><br><span class="line"><span class="comment"># å‚è€ƒæ–‡æ¡£å¦‚ä¸‹</span></span><br><span class="line"><span class="comment"># https://docs.docker.com/install/linux/docker-ce/centos/ </span></span><br><span class="line"><span class="comment"># https://docs.docker.com/install/linux/linux-postinstall/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸è½½æ—§ç‰ˆæœ¬</span></span><br><span class="line">yum remove -y docker \</span><br><span class="line">docker-client \</span><br><span class="line">docker-client-latest \</span><br><span class="line">docker-common \</span><br><span class="line">docker-latest \</span><br><span class="line">docker-latest-logrotate \</span><br><span class="line">docker-logrotate \</span><br><span class="line">docker-selinux \</span><br><span class="line">docker-engine-selinux \</span><br><span class="line">docker-engine</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…åŸºç¡€ä¾èµ–</span></span><br><span class="line">yum install -y yum-utils lvm2 wget</span><br><span class="line"><span class="comment"># å®‰è£… nfs-utils å¿…é¡»å…ˆå®‰è£… nfs-utils æ‰èƒ½æŒ‚è½½ nfs ç½‘ç»œå­˜å‚¨</span></span><br><span class="line">yum install -y nfs-utils</span><br><span class="line"><span class="comment"># æ·»åŠ  docker é•œåƒä»“åº“</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS8</span></span><br><span class="line"><span class="comment"># dnf -y install https://download.docker.com/linux/centos/7/x86_64/stable/Packages/containerd.io-1.2.6-3.3.el7.x86_64.rpm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… docker</span></span><br><span class="line">yum list docker-ce --showduplicates | sort -r</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">'è¯·è¾“å…¥éœ€è¦å®‰è£…çš„Docker-ceçš„ç‰ˆæœ¬å·(ä¾‹å¦‚:19.03.9):'</span> VERSION</span><br><span class="line">yum install -y docker-ce-<span class="variable">$&#123;VERSION&#125;</span> docker-ce-cli-<span class="variable">$&#123;VERSION&#125;</span> containerd.io</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… Docker-compose</span></span><br><span class="line">curl -L https://get.daocloud.io/docker/compose/releases/download/1.25.5/docker-compose-`uname -s`-`uname -m` &gt; /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment"># é•œåƒæºåŠ é€Ÿé…ç½®</span></span><br><span class="line"><span class="comment"># curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s $&#123;REGISTRY_MIRROR&#125;</span></span><br><span class="line"><span class="comment"># curl -sSL https://kuboard.cn/install-script/set_mirror.sh | sh -s $&#123;REGISTRY_MIRROR&#125;</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># General CentOS8</span></span><br><span class="line">mkdir /etc/docker/</span><br><span class="line">cat &gt; /etc/docker/daemon.json &lt;&lt;EOF</span><br><span class="line">&#123;<span class="string">"registry-mirrors"</span>: [<span class="string">"REPLACE"</span>]&#125;</span><br><span class="line">EOF</span><br><span class="line">sed -i <span class="string">"s#REPLACE#<span class="variable">$&#123;REGISTRY_MIRROR&#125;</span>#g"</span> /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨dockerå¹¶æŸ¥çœ‹å®‰è£…åçš„ç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br><span class="line">systemctl start docker</span><br><span class="line">docker-compose -v</span><br><span class="line">docker info</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="2-K8s-åŸºç¡€ç¯å¢ƒ"><a href="#2-K8s-åŸºç¡€ç¯å¢ƒ" class="headerlink" title="2.K8s åŸºç¡€ç¯å¢ƒ"></a>2.K8s åŸºç¡€ç¯å¢ƒ</h4><p>æè¿°:ä»¥ä¸‹æ˜¯å¯¹äºK8såŸºç¡€ç¯å¢ƒçš„å®‰è£…ä»¥åŠåˆ†åˆ«å®ç°Masterå’ŒNodeèŠ‚ç‚¹åˆå§‹åŒ–;</p>
<p>k8s ç¯å¢ƒå®‰è£…è®¾ç½®:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubneets ç‰ˆæœ¬å·</span></span><br><span class="line"><span class="built_in">export</span> K8SVERSION=<span class="string">"1.18.3"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸è½½æ—§ç‰ˆæœ¬</span></span><br><span class="line">yum remove -y kubelet kubeadm kubectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®K8Sçš„yumæº</span></span><br><span class="line">cat &lt;&lt;<span class="string">'EOF'</span> &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class="line">      http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…kubeletã€kubeadmã€kubectl</span></span><br><span class="line"><span class="comment"># å°† $&#123;1&#125; æ›¿æ¢ä¸º kubernetes ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚ 1.18.3</span></span><br><span class="line">yum list kubeadm --showduplicates|sort -r</span><br><span class="line">yum install -y  kubeadm-<span class="variable">$&#123;K8SVERSION&#125;</span> kubectl-<span class="variable">$&#123;K8SVERSION&#125;</span> kubelet-<span class="variable">$&#123;K8SVERSION&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹docker Cgroup Driverä¸ºsystemd</span></span><br><span class="line"><span class="comment"># # å°†/usr/lib/systemd/system/docker.serviceæ–‡ä»¶ä¸­çš„è¿™ä¸€è¡Œ ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span></span><br><span class="line"><span class="comment"># # ä¿®æ”¹ä¸º ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --exec-opt native.cgroupdriver=systemd</span></span><br><span class="line"><span class="comment"># å¦‚æœä¸ä¿®æ”¹åœ¨æ·»åŠ  worker èŠ‚ç‚¹æ—¶å¯èƒ½ä¼šç¢°åˆ°å¦‚ä¸‹é”™è¯¯</span></span><br><span class="line"><span class="comment"># [WARNING IsDockerSystemdCheck]: detected "cgroupfs" as the Docker cgroup driver. The recommended driver is "systemd". </span></span><br><span class="line"><span class="comment"># Please follow the guide at https://kubernetes.io/docs/setup/cri/    </span></span><br><span class="line">sed -i <span class="string">"s#^ExecStart=/usr/bin/dockerd.*#ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --exec-opt native.cgroupdriver=systemd#g"</span> /usr/lib/systemd/system/docker.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯ dockerï¼Œå¹¶å¯åŠ¨ kubelet</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet &amp;&amp; systemctl start kubelet</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="3-master-ä¸»æ§åˆ¶èŠ‚ç‚¹é…ç½®"><a href="#3-master-ä¸»æ§åˆ¶èŠ‚ç‚¹é…ç½®" class="headerlink" title="3.master - ä¸»æ§åˆ¶èŠ‚ç‚¹é…ç½®"></a>3.master - ä¸»æ§åˆ¶èŠ‚ç‚¹é…ç½®</h4><p>æè¿°:å…³äºåˆå§‹åŒ–æ—¶ç”¨åˆ°çš„ç¯å¢ƒå˜é‡</p>
<ul>
<li>APISERVER_NAME ä¸èƒ½æ˜¯ master çš„ hostname</li>
<li>APISERVER_NAME å¿…é¡»å…¨ä¸ºå°å†™å­—æ¯ã€æ•°å­—ã€å°æ•°ç‚¹ï¼Œä¸èƒ½åŒ…å«å‡å·</li>
<li>POD_SUBNET æ‰€ä½¿ç”¨çš„ç½‘æ®µä¸èƒ½ä¸ masterèŠ‚ç‚¹/workerèŠ‚ç‚¹ æ‰€åœ¨çš„ç½‘æ®µé‡å ã€‚è¯¥å­—æ®µçš„å–å€¼ä¸ºä¸€ä¸ª CIDR å€¼ï¼Œå¦‚æœæ‚¨å¯¹ CIDR è¿™ä¸ªæ¦‚å¿µè¿˜ä¸ç†Ÿæ‚‰ï¼Œè¯·ä»ç„¶æ‰§è¡Œ export POD_SUBNET=10.100.0.1/16 å‘½ä»¤ï¼Œä¸åšä¿®æ”¹</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubneets ç‰ˆæœ¬å·</span></span><br><span class="line"><span class="built_in">export</span> K8SVERSION=<span class="string">"1.18.3"</span></span><br><span class="line"><span class="comment"># æ›¿æ¢ x.x.x.x ä¸º master èŠ‚ç‚¹çš„å†…ç½‘IP</span></span><br><span class="line"><span class="comment"># export å‘½ä»¤åªåœ¨å½“å‰ shell ä¼šè¯ä¸­æœ‰æ•ˆï¼Œå¼€å¯æ–°çš„ shell çª—å£åï¼Œå¦‚æœè¦ç»§ç»­å®‰è£…è¿‡ç¨‹ï¼Œè¯·é‡æ–°æ‰§è¡Œæ­¤å¤„çš„ export å‘½ä»¤</span></span><br><span class="line"><span class="built_in">export</span> MASTER_IP=<span class="variable">$&#123;IPADDR&#125;</span></span><br><span class="line"><span class="comment"># æ›¿æ¢ apiserver.demo ä¸º æ‚¨æƒ³è¦çš„ dnsName</span></span><br><span class="line"><span class="built_in">export</span> APISERVER_NAME=apiserver.test</span><br><span class="line"><span class="comment"># é˜¿é‡Œäº‘ docker hub é•œåƒ</span></span><br><span class="line"><span class="built_in">export</span> REGISTRY_MIRROR=https://registry.cn-hangzhou.aliyuncs.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"># Kubernetes å®¹å™¨ç»„æ‰€åœ¨çš„ç½‘æ®µï¼Œè¯¥ç½‘æ®µå®‰è£…å®Œæˆåï¼Œç”± kubernetes åˆ›å»ºï¼Œäº‹å…ˆå¹¶ä¸å­˜åœ¨äºæ‚¨çš„ç‰©ç†ç½‘ç»œä¸­</span></span><br><span class="line"><span class="built_in">export</span> POD_SUBNET=10.100.0.1/16</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;MASTER_IP&#125;</span> <span class="variable">$&#123;APISERVER_NAME&#125;</span>"</span> &gt;&gt; /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$&#123;#POD_SUBNET&#125;</span> -eq 0 ] || [ <span class="variable">$&#123;#APISERVER_NAME&#125;</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">"\033[31;1mè¯·ç¡®ä¿æ‚¨å·²ç»è®¾ç½®äº†ç¯å¢ƒå˜é‡ POD_SUBNET å’Œ APISERVER_NAME \033[0m"</span></span><br><span class="line">  <span class="built_in">echo</span> å½“å‰POD_SUBNET=<span class="variable">$POD_SUBNET</span></span><br><span class="line">  <span class="built_in">echo</span> å½“å‰APISERVER_NAME=<span class="variable">$APISERVER_NAME</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å®Œæ•´é…ç½®é€‰é¡¹ https://godoc.org/k8s.io/kubernetes/cmd/kubeadm/app/apis/kubeadm/v1beta2</span></span><br><span class="line">rm -f ./kubeadm-config.yaml</span><br><span class="line">cat &lt;&lt;EOF &gt; ./kubeadm-config.yaml</span><br><span class="line">apiVersion: kubeadm.k8s.io/v1beta2</span><br><span class="line">kind: ClusterConfiguration</span><br><span class="line">kubernetesVersion: v<span class="variable">$&#123;K8SVERSION&#125;</span></span><br><span class="line">imageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers</span><br><span class="line">controlPlaneEndpoint: <span class="string">"<span class="variable">$&#123;APISERVER_NAME&#125;</span>:6443"</span></span><br><span class="line">networking:</span><br><span class="line">  serviceSubnet: <span class="string">"10.99.0.0/16"</span></span><br><span class="line">  podSubnet: <span class="string">"<span class="variable">$&#123;POD_SUBNET&#125;</span>"</span></span><br><span class="line">  dnsDomain: <span class="string">"cluster.local"</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># kubeadm init</span></span><br><span class="line"><span class="comment"># æ ¹æ®æ‚¨æœåŠ¡å™¨ç½‘é€Ÿçš„æƒ…å†µï¼Œæ‚¨éœ€è¦ç­‰å€™ 3 - 10 åˆ†é’Ÿ</span></span><br><span class="line">kubeadm init --config=kubeadm-config.yaml --upload-certs</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½® kubectl (é‡ç‚¹å¦‚ä¸é…ç½®å°†ä¼šå¯¼è‡´kubectlæ— æ³•æ‰§è¡Œ)</span></span><br><span class="line">rm -rf /root/.kube/</span><br><span class="line">mkdir /root/.kube/</span><br><span class="line">cp -i /etc/kubernetes/admin.conf /root/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… calico ç½‘ç»œæ’ä»¶</span></span><br><span class="line"><span class="comment"># å‚è€ƒæ–‡æ¡£ https://docs.projectcalico.org/v3.13/getting-started/kubernetes/self-managed-onprem/onpremises</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"---å®‰è£…calico-3.13.1---"</span></span><br><span class="line">rm -f calico-3.13.1.yaml</span><br><span class="line">wget https://kuboard.cn/install-script/calico/calico-3.13.1.yaml</span><br><span class="line">kubectl apply -f calico-3.13.1.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"># æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œç­‰å¾… 3-10 åˆ†é’Ÿï¼Œç›´åˆ°æ‰€æœ‰çš„å®¹å™¨ç»„å¤„äº Running çŠ¶æ€</span></span><br><span class="line">watch kubectl get pod -n kube-system -o wide</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"---ç­‰å¾…å®¹å™¨ç»„æ„å»ºå®Œæˆ---"</span> &amp;&amp; sleep 180</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ master èŠ‚ç‚¹åˆå§‹åŒ–ç»“æœ</span></span><br><span class="line">kubectl get nodes -o wide</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¡¨ç¤ºåˆå§‹åŒ–å®‰è£…kubernetesæˆåŠŸ</span></span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line">  mkdir -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run <span class="string">"kubectl apply -f [podnetwork].yaml"</span> with one of the options listed at:</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‚¨ç°åœ¨å¯ä»¥åŠ å…¥ä»»æ„æ•°é‡çš„æ§åˆ¶å¹³é¢èŠ‚ç‚¹(é›†ç¾¤)ï¼Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ä½œä¸ºæ ¹:</span></span><br><span class="line">kubeadm join apiserver.test:6443 --token hzlzrr.uwuegx4locpu36oc \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:4cbe428cb3503277be9fbcf3a99de82a97397a624dd94d4270c4eed1b861f951 \</span><br><span class="line">    --control-plane --certificate-key 28b178f04afae3770aa92add0206650b2359dd61424f127a6d44142dd15a280d</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡åœ¨æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šä½œä¸ºæ ¹è¿è¡Œä»¥ä¸‹æ“ä½œæ¥åŠ å…¥ä»»æ„æ•°é‡çš„å·¥ä½œèŠ‚ç‚¹:</span></span><br><span class="line">kubeadm join apiserver.test:6443 --token hzlzrr.uwuegx4locpu36oc \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:4cbe428cb3503277be9fbcf3a99de82a97397a624dd94d4270c4eed1b861f951</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200615163724.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200615163724.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure></p>
<p><br></p>
<h4 id="4-node-å·¥ä½œèŠ‚ç‚¹é…ç½®"><a href="#4-node-å·¥ä½œèŠ‚ç‚¹é…ç½®" class="headerlink" title="4.node - å·¥ä½œèŠ‚ç‚¹é…ç½®"></a>4.node - å·¥ä½œèŠ‚ç‚¹é…ç½®</h4><p>æ³¨æ„ï¼Œè¯¥æ®µå‘½ä»¤åªåœ¨WorkerèŠ‚ç‚¹æ‰§è¡Œã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åªåœ¨ worker èŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"è¯·è¾“å…¥K8sçš„MasterèŠ‚ç‚¹çš„IPåœ°å€:"</span> MASTER_IP</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;MASTER_IP&#125;</span>  <span class="variable">$&#123;APISERVER_NAME&#125;</span>"</span> &gt;&gt; /etc/hosts</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[32m#åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤\n kubeadm token create --print-join-command\nå¯è·å–kubeadm join å‘½ä»¤åŠå‚æ•°åœ¨NodeèŠ‚ç‚¹è¿è¡Œå³å¯\n"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"[æ³¨æ„]:è¯¥ token çš„æœ‰æ•ˆæ—¶é—´ä¸º 24 ä¸ªå°æ—¶ï¼Œ24å°æ—¶å†…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ­¤ token åˆå§‹åŒ–ä»»æ„æ•°é‡çš„ worker èŠ‚ç‚¹\e[0m"</span></span><br></pre></td></tr></table></figure></p>
<p>å¦‚ä¸‹å‘½ä»¤æŒ‰ç…§å…¶æ³¨é‡Šçš„æœºå™¨æˆ–è€…èŠ‚ç‚¹ä¸Šæ‰§è¡Œã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Master</span></span><br><span class="line">[root@ks8test ~]<span class="comment"># kubeadm token create --print-join-command</span></span><br><span class="line">W0616 15:10:45.622701   23160 configset.go:202] WARNING: kubeadm cannot validate component configs <span class="keyword">for</span> API groups [kubelet.config.k8s.io kubeproxy.config.k8s.io]</span><br><span class="line">kubeadm join apiserver.test:6443 --token 5q3zl5.4h2xllxhy7gxccx1     --discovery-token-ca-cert-hash sha256:4cbe428cb3503277be9fbcf3a99de82a97397a624dd94d4270c4eed1b861f951</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nodes</span></span><br><span class="line">[root@node-1 ~]<span class="comment"># ./CentOS7-k8s_init.sh node node-1</span></span><br><span class="line">è¯·è¾“å…¥K8sçš„MasterèŠ‚ç‚¹çš„IPåœ°å€:10.10.107.193</span><br><span class="line"><span class="comment">#åªåœ¨ master èŠ‚ç‚¹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</span></span><br><span class="line">kubeadm token create --<span class="built_in">print</span>-join-command</span><br><span class="line">å¯è·å–kubeadm join å‘½ä»¤åŠå‚æ•°åœ¨NodeèŠ‚ç‚¹è¿è¡Œå³å¯</span><br><span class="line"></span><br><span class="line">[æ³¨æ„]:è¯¥ token çš„æœ‰æ•ˆæ—¶é—´ä¸º 2 ä¸ªå°æ—¶ï¼Œ2å°æ—¶å†…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ­¤ token åˆå§‹åŒ–ä»»æ„æ•°é‡çš„ worker èŠ‚ç‚¹</span><br><span class="line">[root@node-1 ~]<span class="comment"># kubeadm join apiserver.test:6443 --token 5q3zl5.4h2xllxhy7gxccx1     --discovery-token-ca-cert-hash sha256:4cbe428cb3503277be9fbcf3a99de82a97397a624dd94d4270c4eed1b861f951</span></span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">[preflight] Reading configuration from the cluster...</span><br><span class="line">[preflight] FYI: You can look at this config file with <span class="string">'kubectl -n kube-system get cm kubeadm-config -oyaml'</span></span><br><span class="line">[kubelet-start] Downloading configuration <span class="keyword">for</span> the kubelet from the <span class="string">"kubelet-config-1.18"</span> ConfigMap <span class="keyword">in</span> the kube-system namespace</span><br><span class="line">[kubelet-start] Writing kubelet configuration to file <span class="string">"/var/lib/kubelet/config.yaml"</span></span><br><span class="line">[kubelet-start] Writing kubelet environment file with flags to file <span class="string">"/var/lib/kubelet/kubeadm-flags.env"</span></span><br><span class="line">[kubelet-start] Starting the kubelet</span><br><span class="line">[kubelet-start] Waiting <span class="keyword">for</span> the kubelet to perform the TLS Bootstrap...</span><br><span class="line">This node has joined the cluster:</span><br><span class="line">* Certificate signing request was sent to apiserver and a response was received.</span><br><span class="line">* The Kubelet was informed of the new secure connection details.</span><br><span class="line"></span><br><span class="line"><span class="comment"># Master è¿è¡ŒæŸ¥çœ‹åŠ å…¥çš„èŠ‚ç‚¹</span></span><br><span class="line">Run <span class="string">'kubectl get nodes'</span> on the control-plane to see this node join the cluster.</span><br><span class="line">[root@ks8test ~]<span class="comment"># kubectl get nodes</span></span><br><span class="line">NAME      STATUS   ROLES    AGE   VERSION</span><br><span class="line">ks8test   Ready    master   22h   v1.18.3</span><br><span class="line">node-1    Ready    &lt;none&gt;   67s   v1.18.3</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="0x02-æ‰‹åŠ¨å®‰è£…K8sé›†ç¾¤-åœ¨çº¿"><a href="#0x02-æ‰‹åŠ¨å®‰è£…K8sé›†ç¾¤-åœ¨çº¿" class="headerlink" title="0x02 æ‰‹åŠ¨å®‰è£…K8sé›†ç¾¤(åœ¨çº¿)"></a>0x02 æ‰‹åŠ¨å®‰è£…K8sé›†ç¾¤(åœ¨çº¿)</h3><p>æè¿°:å®‰è£…K8sé«˜å¯ç”¨é›†ç¾¤è‡³å°‘éœ€è¦ä¸‰ä¸ªMasterèŠ‚ç‚¹å’Œä¸é™åˆ¶èŠ‚ç‚¹æ•°é‡çš„å·¥ä½œèŠ‚ç‚¹è¿›è¡Œç»„æˆï¼Œå¦åˆ™ä¼šå‡ºç°<code>è„‘è£‚</code>çš„ç°è±¡ï¼›</p>
<ul>
<li>ä¸‰ä¸ª master ç»„æˆä¸»èŠ‚ç‚¹é›†ç¾¤ï¼Œé€šè¿‡å†…ç½‘ loader balancer å®ç°è´Ÿè½½å‡è¡¡</li>
<li>å¤šä¸ª worker ç»„æˆå·¥ä½œèŠ‚ç‚¹é›†ç¾¤ï¼Œé€šè¿‡å¤–ç½‘ loader balancer å®ç°è´Ÿè½½å‡è¡¡</li>
</ul>
<figure class="image-box">
                <a rel=2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200628114808.png" target="_blank" title="WeiyiGeek.é›†ç¾¤æ¶æ„" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200628114808.png" alt="WeiyiGeek.é›†ç¾¤æ¶æ„" title="" class=""></a>
                <p>WeiyiGeek.é›†ç¾¤æ¶æ„</p>
            </figure>
<p>é›†ç¾¤å®‰è£…ç¯å¢ƒè¯´æ˜ä»¥åŠIPåœ°å€è§„åˆ’è¯´æ˜ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ“ä½œç³»ç»Ÿ</span></span><br><span class="line">CentOS Linux release 7.8.2003 (Core)</span><br><span class="line"><span class="comment"># å†…æ ¸ç‰ˆæœ¬</span></span><br><span class="line">5.7.0-1.el7.elrepo.x86_64</span><br><span class="line"></span><br><span class="line"><span class="comment"># åº”ç”¨ç‰ˆæœ¬</span></span><br><span class="line">docker 19.03.9</span><br><span class="line">docker-compose 1.25.5</span><br><span class="line">Kubernetes 1.18.4</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾èµ–é•œåƒå’Œç‰ˆæœ¬</span></span><br><span class="line"><span class="comment"># docker images | awk -F ' ' '&#123;print $1":"$2&#125;'</span></span><br><span class="line"><span class="comment"># REPOSITORY:TAG</span></span><br><span class="line">mirrorgcrio/kube-proxy:v1.18.4</span><br><span class="line">mirrorgcrio/kube-apiserver:v1.18.4</span><br><span class="line">mirrorgcrio/kube-controller-manager:v1.18.4</span><br><span class="line">mirrorgcrio/kube-scheduler:v1.18.4</span><br><span class="line">calico/node:v3.13.1</span><br><span class="line">calico/pod2daemon-flexvol:v3.13.1</span><br><span class="line">calico/cni:v3.13.1</span><br><span class="line">calico/kube-controllers:v3.13.1</span><br><span class="line">mirrorgcrio/pause:3.2</span><br><span class="line">mirrorgcrio/coredns:1.6.7</span><br><span class="line">mirrorgcrio/etcd:3.4.3-0</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><em>IPåœ°å€è§„åˆ’</em></p>
<table>
<thead>
<tr>
<th style="text-align:center">IP</th>
<th style="text-align:center">ä¸»æœºåç§°</th>
<th style="text-align:center">å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">10.10.107.191</td>
<td style="text-align:center">master-01</td>
<td style="text-align:center">ä¸»MasterèŠ‚ç‚¹</td>
</tr>
<tr>
<td style="text-align:center">10.10.107.192</td>
<td style="text-align:center">master-02</td>
<td style="text-align:center">ä»MasterèŠ‚ç‚¹</td>
</tr>
<tr>
<td style="text-align:center">10.10.107.193</td>
<td style="text-align:center">master-03</td>
<td style="text-align:center">ä»MasterèŠ‚ç‚¹</td>
</tr>
<tr>
<td style="text-align:center">10.10.107.194</td>
<td style="text-align:center">worker-01</td>
<td style="text-align:center">å·¥ä½œèŠ‚ç‚¹</td>
</tr>
<tr>
<td style="text-align:center">10.10.107.196</td>
<td style="text-align:center">worker-02</td>
<td style="text-align:center">å·¥ä½œèŠ‚ç‚¹</td>
</tr>
</tbody>
</table>
<p><br/></p>
<p><em>ApiServer çš„ Load Balancerï¼ˆç§ç½‘ï¼‰ç›¸å…³:</em><br>ç›‘å¬è¿æ¥ç«¯å£ï¼š6443 / TCP<br>åç«¯èµ„æºç»„ï¼šåŒ…å« master-01,master-02,master-03;<br>å®ç° Load Balancer æ–¹å¼:<code>nginx / haproxy / keepalived / äº‘ä¾›åº”å•†æä¾›çš„è´Ÿè½½å‡è¡¡äº§å“</code>,è¿™é‡Œæˆ‘ä»¬æš‚æ—¶ä¸æ¶‰åŠï¼›</p>
<p><br/></p>
<p><em>ç‰¹åˆ«æ³¨æ„:</em></p>
<ul>
<li>1.ä»»æ„èŠ‚ç‚¹å»ºè®®å¤§äºç­‰äºcentos ç‰ˆæœ¬ä¸º 7.6 æˆ– 7.7;</li>
<li>2.ä»»æ„èŠ‚ç‚¹ CPU å†…æ ¸æ•°é‡å¤§äºç­‰äº 2ï¼Œä¸”å†…å­˜å¤§äºç­‰äº 4G;</li>
<li>3.ä»»æ„èŠ‚ç‚¹ hostname ä¸æ˜¯ localhostï¼Œä¸”ä¸åŒ…å«ä¸‹åˆ’çº¿ã€å°æ•°ç‚¹ã€å¤§å†™å­—æ¯å¹¶ä¸”ä¸èƒ½é‡å¤;</li>
<li>4.ä»»æ„èŠ‚ç‚¹éƒ½æœ‰å›ºå®šçš„å†…ç½‘ IP åœ°å€ä¸”ä¸ºå•ç½‘å¡</li>
<li>5.ä»»æ„èŠ‚ç‚¹ä¸Š Kubeletä½¿ç”¨çš„ IP åœ°å€ å¯äº’é€šæ— éœ€ NAT æ˜ å°„å³å¯ç›¸äº’è®¿é—®ï¼‰ï¼Œä¸”æ²¡æœ‰é˜²ç«å¢™ã€å®‰å…¨ç»„éš”ç¦»Selinux;</li>
<li>6.ä»»æ„èŠ‚ç‚¹ä¸Šä¸´æ—¶çš„swapåˆ†åŒºå°†è¢«å…³é—­;</li>
<li>7.ä»»æ„èŠ‚ç‚¹ä¸Šåˆå§‹åŒ–æ—¶ç”¨åˆ°çš„ç¯å¢ƒå˜é‡APISERVER_NAMEæ˜¯ä¸€è‡´çš„,ä¸èƒ½æ˜¯ master çš„ hostnameå¹¶ä¸”å¿…é¡»å…¨ä¸ºå°å†™å­—æ¯ã€æ•°å­—ã€å°æ•°ç‚¹ï¼Œä¸èƒ½åŒ…å«å‡å·;</li>
<li>8.ä»»æ„èŠ‚ç‚¹ä¸Šåˆå§‹åŒ–æ—¶ç”¨åˆ°çš„ç¯å¢ƒå˜é‡ POD_SUBNET æ‰€ä½¿ç”¨çš„ç½‘æ®µä¸èƒ½ä¸ masterèŠ‚ç‚¹/workerèŠ‚ç‚¹ æ‰€åœ¨çš„ç½‘æ®µé‡å (å¸¸å¸¸æ˜¯ä¸€ä¸ªAç±»ç§æœ‰åœ°å€-CIDR å€¼)ã€‚</li>
<li>9.ä»»æ„çš„masterèŠ‚ç‚¹åœ¨è¿›è¡Œåˆå§‹åŒ–çš„æ—¶å€™ï¼Œå¦‚æœä¸­é—´å‡ºç°éƒ¨ç½²æ­¥éª¤çš„é…ç½®å‡ºé”™ï¼Œéœ€è¦<code>é‡æ–°åˆå§‹åŒ– master èŠ‚ç‚¹</code>æ—¶è¯·å…ˆæ‰§è¡Œ <code>kubeadm reset</code> æ“ä½œ</li>
</ul>
<p><br/></p>
<p><strong>æ“ä½œæµç¨‹:</strong></p>
<ul>
<li>1.å…¨éƒ¨ä¸»æœºéƒ½éœ€è¦æ‰§è¡Œä»¥ä¸‹è„šæœ¬è¿›è¡Œ<code>åŸºç¡€ç¯å¢ƒé…ç½®ä¸(docker/docker-compose/kubernetes)å®‰è£…</code>æ‰€ä»¥éœ€è¦å¯¹å…¶è¿›è¡Œè‡ªå®šä¹‰çš„ä¿®æ”¹é…ç½®(ä¸»è¦æ˜¯:<code>èŠ‚ç‚¹ä¸»æœºåç§°/APISERVER/APIPORT</code>);</li>
</ul>
<p>åŸºç¡€ç¯å¢ƒ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> HOSTNAME=worker-02</span><br><span class="line"><span class="comment"># ä¸´æ—¶å…³é—­swapå’ŒSELinux</span></span><br><span class="line">swapoff -a &amp;&amp; setenforce 0</span><br><span class="line"><span class="comment"># æ°¸ä¹…å…³é—­swapå’ŒSELinux</span></span><br><span class="line">yes | cp /etc/fstab /etc/fstab_bak</span><br><span class="line">cat /etc/fstab_bak |grep -v swap &gt; /etc/fstab</span><br><span class="line">sed -i <span class="string">'s/^SELINUX=.*$/SELINUX=disabled/'</span> /etc/selinux/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»æœºåè®¾ç½®(è¿™é‡Œä¸»æœºåç§°å®‰è£…ä¸Šé¢çš„IPåœ°å€è§„åˆ’å¯¹åº”çš„ä¸»æœºåç§°-æ ¹æ®å®‰è£…çš„ä¸»æœºè¿›è¡Œå˜åŒ–)</span></span><br><span class="line">hostnamectl <span class="built_in">set</span>-hostname <span class="variable">$HOSTNAME</span></span><br><span class="line">hostnamectl status</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»æœºåè®¾ç½®</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"127.0.0.1 <span class="variable">$HOSTNAME</span>"</span> &gt;&gt; /etc/hosts</span><br><span class="line">cat &gt;&gt; /etc/hosts &lt;&lt;EOF</span><br><span class="line">10.10.107.191 master-01</span><br><span class="line">10.10.107.192 master-02</span><br><span class="line">10.10.107.193 master-03</span><br><span class="line">10.10.107.194 worker-01</span><br><span class="line">10.10.107.196 worker-02</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘½ä»¤è‡ªåŠ¨è¡¥é½</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"source &lt;(kubectl completion bash)"</span> &gt;&gt; ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># DNS è®¾ç½®</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"nameserver 223.6.6.6\nnameserver 192.168.10.254"</span> &gt;&gt; /etc/resolv.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­é˜²ç«å¢™</span></span><br><span class="line">systemctl stop firewalld &amp;&amp; systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker å®‰è£…é…ç½® (å¦‚æœå·²ç»å®‰è£…è¿‡äº†åˆ™å¯ä»¥è·³è¿‡)</span></span><br><span class="line"><span class="comment"># å®‰è£…åŸºç¡€ä¾èµ–</span></span><br><span class="line">yum install -y yum-utils lvm2 wget</span><br><span class="line"><span class="comment"># å®‰è£… nfs-utils å¿…é¡»å…ˆå®‰è£… nfs-utils æ‰èƒ½æŒ‚è½½ nfs ç½‘ç»œå­˜å‚¨</span></span><br><span class="line">yum install -y nfs-utils</span><br><span class="line"><span class="comment"># æ·»åŠ  docker é•œåƒä»“åº“</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¯ç”¨Dockerç‰ˆæœ¬ä»¥åŠå®‰è£…Docker</span></span><br><span class="line">yum list docker-ce --showduplicates | sort -r</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">'è¯·è¾“å…¥éœ€è¦å®‰è£…çš„Docker-ceçš„ç‰ˆæœ¬å·(ä¾‹å¦‚:19.03.9):'</span> VERSION</span><br><span class="line">yum install -y docker-ce-<span class="variable">$&#123;VERSION&#125;</span> docker-ce-cli-<span class="variable">$&#123;VERSION&#125;</span> containerd.io</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… Docker-compose</span></span><br><span class="line">curl -L https://get.daocloud.io/docker/compose/releases/download/1.25.5/docker-compose-`uname -s`-`uname -m` &gt; /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment"># é•œåƒæºåŠ é€Ÿé…ç½®</span></span><br><span class="line"><span class="comment"># å¦‚æœæ–‡ä»¶å¤¹ä¸å­˜åœ¨åˆ™å»ºç«‹/etc/docker/</span></span><br><span class="line"><span class="keyword">if</span> [[ ! -d <span class="string">"/etc/docker/"</span> ]];<span class="keyword">then</span> mkdir /etc/docker/;<span class="keyword">fi</span></span><br><span class="line">cat &gt; /etc/docker/daemon.json &lt;&lt;EOF</span><br><span class="line">&#123;<span class="string">"registry-mirrors"</span>: [<span class="string">"REPLACE"</span>]&#125;</span><br><span class="line">EOF</span><br><span class="line">sed -i <span class="string">"s#REPLACE#<span class="variable">$&#123;REGISTRY_MIRROR&#125;</span>#g"</span> /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨dockerå¹¶æŸ¥çœ‹å®‰è£…åçš„ç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class="line">systemctl <span class="built_in">enable</span> docker &amp;&amp; systemctl start docker</span><br><span class="line">docker-compose -v &amp;&amp; docker info</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ /etc/sysctl.conf è¿›è¡Œå†…æ ¸å‚æ•°çš„é…ç½®</span></span><br><span class="line">egrep -q <span class="string">"^(#)?net.ipv4.ip_forward.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.ipv4.ip_forward.*|net.ipv4.ip_forward = 1|g"</span>  /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.ipv4.ip_forward = 1"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">egrep -q <span class="string">"^(#)?net.bridge.bridge-nf-call-ip6tables.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.bridge.bridge-nf-call-ip6tables.*|net.bridge.bridge-nf-call-ip6tables = 1|g"</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.bridge.bridge-nf-call-ip6tables = 1"</span> &gt;&gt; /etc/sysctl.conf </span><br><span class="line">egrep -q <span class="string">"^(#)?net.bridge.bridge-nf-call-iptables.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.bridge.bridge-nf-call-iptables.*|net.bridge.bridge-nf-call-iptables = 1|g"</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.bridge.bridge-nf-call-iptables = 1"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">egrep -q <span class="string">"^(#)?net.ipv6.conf.all.disable_ipv6.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.ipv6.conf.all.disable_ipv6.*|net.ipv6.conf.all.disable_ipv6 = 1|g"</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.ipv6.conf.all.disable_ipv6 = 1"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">egrep -q <span class="string">"^(#)?net.ipv6.conf.default.disable_ipv6.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.ipv6.conf.default.disable_ipv6.*|net.ipv6.conf.default.disable_ipv6 = 1|g"</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.ipv6.conf.default.disable_ipv6 = 1"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">egrep -q <span class="string">"^(#)?net.ipv6.conf.lo.disable_ipv6.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.ipv6.conf.lo.disable_ipv6.*|net.ipv6.conf.lo.disable_ipv6 = 1|g"</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.ipv6.conf.lo.disable_ipv6 = 1"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">egrep -q <span class="string">"^(#)?net.ipv6.conf.all.forwarding.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.ipv6.conf.all.forwarding.*|net.ipv6.conf.all.forwarding = 1|g"</span>  /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.ipv6.conf.all.forwarding = 1"</span>  &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="comment"># ä½¿ä¿®æ”¹çš„å†…æ ¸å‚æ•°ç«‹å³ç”Ÿæ•ˆ</span></span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®K8Sçš„yumæº</span></span><br><span class="line">  cat &lt;&lt;<span class="string">'EOF'</span> &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class="line">       http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å®‰è£…kubeletã€kubeadmã€kubectl æŒ‡å®šç»Ÿä¸€çš„kubernetes ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚ 1.18.4</span></span><br><span class="line">yum list kubelet --showduplicates | tail -n 10</span><br><span class="line">yum install -y kubelet-1.18.4 kubeadm-1.18.4 kubectl-1.18.4</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹docker Cgroup Driverä¸ºsystemd</span></span><br><span class="line"><span class="comment"># # å°†/usr/lib/systemd/system/docker.serviceæ–‡ä»¶ä¸­çš„è¿™ä¸€è¡Œ ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span></span><br><span class="line"><span class="comment"># # ä¿®æ”¹ä¸º ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --exec-opt native.cgroupdriver=systemd</span></span><br><span class="line"><span class="comment"># å¦‚æœä¸ä¿®æ”¹åœ¨æ·»åŠ  worker èŠ‚ç‚¹æ—¶å¯èƒ½ä¼šç¢°åˆ°å¦‚ä¸‹é”™è¯¯</span></span><br><span class="line"><span class="comment"># [WARNING IsDockerSystemdCheck]: detected "cgroupfs" as the Docker cgroup driver. The recommended driver is "systemd". </span></span><br><span class="line"><span class="comment"># Please follow the guide at https://kubernetes.io/docs/setup/cri/    </span></span><br><span class="line">sed -i <span class="string">"s#^ExecStart=/usr/bin/dockerd.*#ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --exec-opt native.cgroupdriver=systemd#g"</span> /usr/lib/systemd/system/docker.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯ dockerï¼Œå¹¶å¯åŠ¨ kubelet</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet</span><br><span class="line">systemctl restart docker &amp;&amp; systemctl restart kubelet</span><br></pre></td></tr></table></figure></p>
<ul>
<li>2.ä»…åœ¨ä¸»MasterèŠ‚ç‚¹(<code>10.10.107.191</code>)ä¸Šè¿›è¡ŒMasterèŠ‚ç‚¹åˆå§‹åŒ–æ“ä½œ(<code>è¯¥èŠ‚ç‚¹ä¹Ÿæ˜¯æ¥å…¥é›†ç¾¤ä½¿ç”¨çš„ip</code>);<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">APISERVER_IP=10.10.107.191</span><br><span class="line">APISERVER_NAME=k8s.weiyigeek.top</span><br><span class="line">APISERVER_PORT=6443</span><br><span class="line">SERVICE_SUBNET=10.99.0.0/16</span><br><span class="line"><span class="comment"># calico ç¼ºçœå­ç½‘</span></span><br><span class="line">POD_SUBNET=10.100.0.1/16</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;APISERVER_IP&#125;</span> <span class="variable">$&#123;APISERVER_NAME&#125;</span>"</span> &gt;&gt; /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–é…ç½®(å»ºè®®å„ä¸ªç»„ä»¶çš„ç‰ˆæœ¬ä¸k8sçš„ç‰ˆæœ¬ä¸€è‡´)</span></span><br><span class="line">rm -f ./kubeadm-config.yaml</span><br><span class="line">  cat &lt;&lt;EOF &gt; ./kubeadm-config.yaml</span><br><span class="line">apiVersion: kubeadm.k8s.io/v1beta2</span><br><span class="line">kind: ClusterConfiguration</span><br><span class="line">kubernetesVersion: v<span class="variable">$&#123;K8SVERSION&#125;</span></span><br><span class="line">imageRepository: mirrorgcrio</span><br><span class="line"><span class="comment">#imageRepository: registry.aliyuncs.com/google_containers</span></span><br><span class="line"><span class="comment">#imageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers</span></span><br><span class="line"><span class="comment">#imageRepository: gcr.azk8s.cn/google_containers</span></span><br><span class="line">controlPlaneEndpoint: <span class="string">"<span class="variable">$&#123;APISERVER_NAME&#125;</span>:<span class="variable">$&#123;APISERVER_PORT&#125;</span>"</span></span><br><span class="line">networking:</span><br><span class="line">  serviceSubnet: <span class="string">"<span class="variable">$&#123;SERVICE_SUBNET&#125;</span>"</span></span><br><span class="line">  podSubnet: <span class="string">"<span class="variable">$&#123;POD_SUBNET&#125;</span>"</span></span><br><span class="line">  dnsDomain: <span class="string">"cluster.local"</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># kubeadm init æ ¹æ®æ‚¨æœåŠ¡å™¨ç½‘é€Ÿçš„æƒ…å†µï¼Œæ‚¨éœ€è¦ç­‰å€™ 3 - 10 åˆ†é’Ÿ</span></span><br><span class="line">kubeadm init --config=kubeadm-config.yaml --upload-certs</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½® kubectlå¦åˆ™ä¸èƒ½æ‰§è¡Œkubectl get pods -A</span></span><br><span class="line">mkdir -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… calico ç½‘ç»œæ’ä»¶</span></span><br><span class="line"><span class="comment"># å‚è€ƒæ–‡æ¡£ https://docs.projectcalico.org/v3.13/getting-started/kubernetes/self-managed-onprem/onpremises</span></span><br><span class="line">rm -f calico-3.13.1.yaml</span><br><span class="line">wget -L https://kuboard.cn/install-script/calico/calico-3.13.1.yaml</span><br><span class="line">kubectl apply -f calico-3.13.1.yaml</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œç­‰å¾… 3-10 åˆ†é’Ÿï¼Œç›´åˆ°æ‰€æœ‰çš„å®¹å™¨ç»„å¤„äº Running çŠ¶æ€</span></span><br><span class="line">watch kubectl get pod -n kube-system -o wide</span><br><span class="line"><span class="comment"># NAME                                       READY   STATUS    RESTARTS   AGE   IP              NODE        NOMINATED NODE   READINESS GATES</span></span><br><span class="line"><span class="comment"># calico-kube-controllers-5b8b769fcd-ns9r4   1/1     Running   0          6m   10.100.184.65   master-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># calico-node-bg2g9                          1/1     Running   0          6m   10.10.107.191   master-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># coredns-54f99b968c-2tqc4                   1/1     Running   0          6m   10.100.184.67   master-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># coredns-54f99b968c-672zn                   1/1     Running   0          6m   10.100.184.66   master-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># etcd-master-01                             1/1     Running   0          6m   10.10.107.191   master-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-apiserver-master-01                   1/1     Running   0          6m   10.10.107.191   master-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-controller-manager-master-01          1/1     Running   0          6m   10.10.107.191   master-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-proxy-trg7v                           1/1     Running   0          6m   10.10.107.191   master-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-scheduler-master-01                   1/1     Running   0          6m   10.10.107.191   master-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æ­¤æ—¶ä¸»èŠ‚ç‚¹çš„çŠ¶æ€åº”è¯¥ä¸ºReady</span></span><br><span class="line">kubectl get node -o wide</span><br><span class="line"><span class="comment"># NAME        STATUS   ROLES    AGE   VERSION   INTERNAL-IP     EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION              CONTAINER-RUNTIME</span></span><br><span class="line"><span class="comment"># master-01   Ready    master   7m   v1.18.4   10.10.107.191   &lt;none&gt;        CentOS Linux 7 (Core)   5.7.0-1.el7.elrepo.x86_64   docker://19.3.9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) ä¸‹è½½çš„é•œåƒä¿¡æ¯</span></span><br><span class="line">docker images</span><br><span class="line"><span class="comment"># REPOSITORY                            TAG                 IMAGE ID            CREATED             SIZE</span></span><br><span class="line"><span class="comment"># mirrorgcrio/kube-proxy                v1.18.4             718fa77019f2        5 days ago          117MB</span></span><br><span class="line"><span class="comment"># mirrorgcrio/kube-apiserver            v1.18.4             408913fc18eb        5 days ago          173MB</span></span><br><span class="line"><span class="comment"># mirrorgcrio/kube-scheduler            v1.18.4             c663567f869e        5 days ago          95.3MB</span></span><br><span class="line"><span class="comment"># mirrorgcrio/kube-controller-manager   v1.18.4             e8f1690127c4        5 days ago          162MB</span></span><br><span class="line"><span class="comment"># calico/node                           v3.13.1             2e5029b93d4a        3 months ago        260MB</span></span><br><span class="line"><span class="comment"># calico/pod2daemon-flexvol             v3.13.1             e8c600448aae        3 months ago        111MB</span></span><br><span class="line"><span class="comment"># calico/cni                            v3.13.1             6912ec2cfae6        3 months ago        207MB</span></span><br><span class="line"><span class="comment"># calico/kube-controllers               v3.13.1             3971f13f2c6c        3 months ago        56.6MB</span></span><br><span class="line"><span class="comment"># mirrorgcrio/pause                     3.2                 80d28bedfe5d        4 months ago        683kB</span></span><br><span class="line"><span class="comment"># mirrorgcrio/coredns                   1.6.7               67da37a9a360        4 months ago        43.8MB</span></span><br><span class="line"><span class="comment"># mirrorgcrio/etcd                      3.4.3-0             303ce5db0e90        8 months ago        288MB</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) ç°åœ¨åº”è¯¥å°†podç½‘ç»œéƒ¨ç½²åˆ°é›†ç¾¤éƒ¨ç½²calico æ’ä»¶(å®‰è£…é›†ç¾¤ç½‘ç»œ)</span></span><br><span class="line">kubectl apply -f calico-3.13.1.yaml</span><br><span class="line"><span class="comment"># configmap/calico-config created</span></span><br><span class="line"><span class="comment"># customresourcedefinition.apiextensions.k8s.io/bgpconfigurations.crd.projectcalico.org created</span></span><br><span class="line"><span class="comment"># customresourcedefinition.apiextensions.k8s.io/bgppeers.crd.projectcalico.org created</span></span><br><span class="line"><span class="comment"># customresourcedefinition.apiextensions.k8s.io/blockaffinities.crd.projectcalico.org created</span></span><br><span class="line"><span class="comment"># customresourcedefinition.apiextensions.k8s.io/clusterinformations.crd.projectcalico.org created</span></span><br><span class="line"><span class="comment"># customresourcedefinition.apiextensions.k8s.io/felixconfigurations.crd.projectcalico.org created</span></span><br><span class="line"><span class="comment"># customresourcedefinition.apiextensions.k8s.io/globalnetworkpolicies.crd.projectcalico.org created</span></span><br><span class="line"><span class="comment"># customresourcedefinition.apiextensions.k8s.io/globalnetworksets.crd.projectcalico.org created</span></span><br><span class="line"><span class="comment"># customresourcedefinition.apiextensions.k8s.io/hostendpoints.crd.projectcalico.org created</span></span><br><span class="line"><span class="comment"># customresourcedefinition.apiextensions.k8s.io/ipamblocks.crd.projectcalico.org created</span></span><br><span class="line"><span class="comment"># customresourcedefinition.apiextensions.k8s.io/ipamconfigs.crd.projectcalico.org created</span></span><br><span class="line"><span class="comment"># customresourcedefinition.apiextensions.k8s.io/ipamhandles.crd.projectcalico.org created</span></span><br><span class="line"><span class="comment"># customresourcedefinition.apiextensions.k8s.io/ippools.crd.projectcalico.org created</span></span><br><span class="line"><span class="comment"># customresourcedefinition.apiextensions.k8s.io/networkpolicies.crd.projectcalico.org created</span></span><br><span class="line"><span class="comment"># customresourcedefinition.apiextensions.k8s.io/networksets.crd.projectcalico.org created</span></span><br><span class="line"><span class="comment"># clusterrole.rbac.authorization.k8s.io/calico-kube-controllers created</span></span><br><span class="line"><span class="comment"># clusterrolebinding.rbac.authorization.k8s.io/calico-kube-controllers created</span></span><br><span class="line"><span class="comment"># clusterrole.rbac.authorization.k8s.io/calico-node created</span></span><br><span class="line"><span class="comment"># clusterrolebinding.rbac.authorization.k8s.io/calico-node created</span></span><br><span class="line"><span class="comment"># daemonset.apps/calico-node created</span></span><br><span class="line"><span class="comment"># serviceaccount/calico-node created</span></span><br><span class="line"><span class="comment"># deployment.apps/calico-kube-controllers created</span></span><br><span class="line"><span class="comment"># serviceaccount/calico-kube-controllers Created</span></span><br></pre></td></tr></table></figure></p>
<p><span style="color:red">æ³¨æ„ï¼šè¯·ç­‰åˆ°æ‰€æœ‰å®¹å™¨ç»„ï¼ˆå¤§çº¦9ä¸ªï¼‰å…¨éƒ¨å¤„äº Running çŠ¶æ€ï¼Œæ‰è¿›è¡Œä¸‹ä¸€æ­¥</span></p>
<ul>
<li>3.åœ¨å…¶ä½™ä¸¤å°ä»MasterèŠ‚ç‚¹ä¸Šè¿è¡Œç¬¬äºŒæ¡å‘½ä»¤ä¾¿ä¼šåŠ å…¥åˆ°masteré›†ç¾¤ä¹‹ä¸­,ä½†æ˜¯æ‰§è¡Œä¸‹é¢<code>(1) (2)</code>å‰æˆ‘ä»¬éœ€è¦å°†ä½¿ç”¨åˆ°çš„é•œåƒè¿›è¡Œä¸‹è½½;</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (0) ç”±äºå›½å†…æ— æ³•è®¿é—®k8s.gcr.ioåˆ™åœ¨è¿›è¡Œä»masterèŠ‚ç‚¹åˆå§‹åŒ–æ—¶å€™ä¼šä¸€ç›´å¡åœ¨åŠ å…¥æ§åˆ¶å¹³é¢èŠ‚ç‚¹å‘½ä»¤åï¼Œä¸€ç›´åˆ°è¶…æ—¶æ—¶é—´ï¼›</span></span><br><span class="line"><span class="comment"># è§£å†³åŠæ³•: ä»Dockerå®˜æ–¹é»˜è®¤é•œåƒå¹³å°æ‹‰å–é•œåƒå¹¶é‡æ–°æ‰“tagçš„æ–¹å¼æ¥ç»•è¿‡å¯¹ k8s.gcr.io çš„è®¿é—®ã€‚ </span></span><br><span class="line">kubeadm config images pull --image-repository mirrorgcrio</span><br><span class="line"><span class="comment"># [config/images] Pulled mirrorgcrio/kube-apiserver:v1.18.4</span></span><br><span class="line"><span class="comment"># [config/images] Pulled mirrorgcrio/kube-controller-manager:v1.18.4</span></span><br><span class="line"><span class="comment"># [config/images] Pulled mirrorgcrio/kube-scheduler:v1.18.4</span></span><br><span class="line"><span class="comment"># [config/images] Pulled mirrorgcrio/kube-proxy:v1.18.4</span></span><br><span class="line"><span class="comment"># [config/images] Pulled mirrorgcrio/pause:3.2</span></span><br><span class="line"><span class="comment"># [config/images] Pulled mirrorgcrio/etcd:3.4.3-0</span></span><br><span class="line"><span class="comment"># [config/images] Pulled mirrorgcrio/coredns:1.6.7</span></span><br><span class="line"></span><br><span class="line">kubeadm config images list --image-repository mirrorgcrio &gt; gcr.io.log </span><br><span class="line"><span class="comment"># é‡æ–°ä¸ºé•œåƒæ‰“ä¸Štagä¸º k8s.gcr.io\é•œåƒåç§°:ç‰ˆæœ¬</span></span><br><span class="line">sed -e <span class="string">"s#\\(/.*$\\)#\1 k8s.gcr.io\1#g"</span> gcr.io.log &gt; gcr.io.log1</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> k8sgcrio;<span class="keyword">do</span></span><br><span class="line">  docker tag <span class="variable">$&#123;k8sgcrio&#125;</span></span><br><span class="line"><span class="keyword">done</span> &lt; gcr.io.log1</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤tagå¸¦æœ‰mirrorgcrio</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> k8s;<span class="keyword">do</span></span><br><span class="line">  docker rmi <span class="variable">$&#123;k8s&#125;</span></span><br><span class="line"><span class="keyword">done</span> &lt; gcr.io.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€åçš„æ•ˆæœ</span></span><br><span class="line"><span class="variable">$docker</span> images</span><br><span class="line"><span class="comment"># REPOSITORY                           TAG                 IMAGE ID            CREATED             SIZE</span></span><br><span class="line"><span class="comment"># k8s.gcr.io/kube-proxy                v1.18.4             718fa77019f2        6 days ago          117MB</span></span><br><span class="line"><span class="comment"># k8s.gcr.io/kube-scheduler            v1.18.4             c663567f869e        6 days ago          95.3MB</span></span><br><span class="line"><span class="comment"># k8s.gcr.io/kube-apiserver            v1.18.4             408913fc18eb        6 days ago          173MB</span></span><br><span class="line"><span class="comment"># k8s.gcr.io/kube-controller-manager   v1.18.4             e8f1690127c4        6 days ago          162MB</span></span><br><span class="line"><span class="comment"># k8s.gcr.io/pause                     3.2                 80d28bedfe5d        4 months ago        683kB</span></span><br><span class="line"><span class="comment"># k8s.gcr.io/coredns                   1.6.7               67da37a9a360        4 months ago        43.8MB</span></span><br><span class="line"><span class="comment"># k8s.gcr.io/etcd                      3.4.3-0             303ce5db0e90        8 months ago        288MB</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (1) APIServerè¿›è¡Œä¸»MasterIPä»¥åŠServeråç§°é…ç½®</span></span><br><span class="line">APISERVER_IP=10.10.107.191</span><br><span class="line">APISERVER_NAME=k8s.weiyigeek.top</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;APISERVER_IP&#125;</span> <span class="variable">$&#123;APISERVER_NAME&#125;</span>"</span> &gt;&gt; /etc/hosts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) ä»MasterèŠ‚ç‚¹åŠ å…¥æ§åˆ¶å¹³é¢èŠ‚ç‚¹(certificate-key) ä¸¤ä¸ªå°æ—¶åå¤±æ•ˆ</span></span><br><span class="line">kubeadm join k8s.weiyigeek.top:6443 --token opcpye.79zeofy6eo4h9ag6 \</span><br><span class="line">  --discovery-token-ca-cert-hash sha256:0795075090d621285dbaa4a76b9b320150f5ae3c37f5d7b92fc1c4f8942d9243 \</span><br><span class="line">  --control-plane --certificate-key 6dbee003011ac1dae15ae1fad3014ac8b568d154387aa0c43663d5fc47a109c4</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) æ‹·è´kubernetesé…ç½®æ–‡ä»¶åˆ°ç”¨æˆ·å®¶ç›®å½•ä¸­(å¦‚æœä¸æ‰§è¡Œåˆ™kubectl get èµ„æºä¼šå‡ºé”™)</span></span><br><span class="line">mkdir -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200624000734.png" target="_blank" title="WeiyiGeek.ä»MasterèŠ‚ç‚¹" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200624000734.png" alt="WeiyiGeek.ä»MasterèŠ‚ç‚¹" title="" class=""></a>
                <p>WeiyiGeek.ä»MasterèŠ‚ç‚¹</p>
            </figure>
<ul>
<li><p>4.å…¶ä½™ä¸¤å°NodeèŠ‚ç‚¹ä¸Šè¿è¡Œ<code>kubeadm join</code>å‘½ä»¤;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) APIServerè¿›è¡Œä¸»MasterIPä»¥åŠServeråç§°é…ç½®</span></span><br><span class="line">APISERVER_IP=10.10.107.191</span><br><span class="line">APISERVER_NAME=k8s.weiyigeek.top</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;APISERVER_IP&#125;</span> <span class="variable">$&#123;APISERVER_NAME&#125;</span>"</span> &gt;&gt; /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) å°†workerå·¥ä½œèŠ‚ç‚¹åŠ å…¥åˆ°å—MasterèŠ‚ç‚¹ç®¡ç†çš„é›†ç¾¤ä¸­;</span></span><br><span class="line">kubeadm join k8s.weiyigeek.top:6443 --token opcpye.79zeofy6eo4h9ag6 \</span><br><span class="line">  --discovery-token-ca-cert-hash sha256:0795075090d621285dbaa4a76b9b320150f5ae3c37f5d7b92fc1c4f8942d9243</span><br></pre></td></tr></table></figure>
</li>
<li><p>5.åœ¨K8sé›†ç¾¤ä¸­é…ç½®etcdçš„clusterï¼Œä¿®æ”¹etcd.yamlæ–‡ä»¶ä¸­çš„â€“initial-clusterå‚æ•°ä¿è¯ä¸‰å°MasterèŠ‚ç‚¹æœºå™¨éƒ½æ˜¯åŠ å…¥åˆ°etcdé›†ç¾¤ä¸­çš„;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰€æœ‰ Master èŠ‚ç‚¹æœºå™¨é…ç½®å¦‚ä¸‹:</span></span><br><span class="line">[root@master-01 ~]$ grep -n <span class="string">"initial-cluster"</span> /etc/kubernetes/manifests/etcd.yaml</span><br><span class="line">21:    - --initial-cluster=master-01=https://10.10.107.191:2380,master-03=https://10.10.107.193:2380,master-02=https://10.10.107.192:2380</span><br><span class="line"></span><br><span class="line">[root@master-02 ~]$ grep -n <span class="string">"initial-cluster"</span> /etc/kubernetes/manifests/etcd.yaml</span><br><span class="line">21:    - --initial-cluster=master-01=https://10.10.107.191:2380,master-02=https://10.10.107.192:2380,master-03=https://10.10.107.193:2380</span><br><span class="line">22:    - --initial-cluster-state=existing</span><br><span class="line"></span><br><span class="line">[root@master-03 ~]$ grep -n <span class="string">"initial-cluster"</span> /etc/kubernetes/manifests/etcd.yaml</span><br><span class="line">21:    - --initial-cluster=master-01=https://10.10.107.191:2380,master-03=https://10.10.107.193:2380,master-02=https://10.10.107.192:2380</span><br><span class="line">22:    - --initial-cluster-state=existing</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¶åå†ä¿®æ”¹ kube-apiserver etcd è¿æ¥ä¸ºé›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹ip</span></span><br><span class="line">[root@master-01 ~]$ grep -n <span class="string">"etcd-servers"</span> /etc/kubernetes/manifests/kube-apiserver.yaml</span><br><span class="line">25:    - --etcd-servers=https://10.10.107.191:2379,https://10.10.107.192:2379,https://10.10.107.193:2379</span><br><span class="line"></span><br><span class="line">[root@master-02 ~]$ grep -n <span class="string">"etcd-servers"</span> /etc/kubernetes/manifests/kube-apiserver.yaml</span><br><span class="line">25:    - --etcd-servers=https://10.10.107.191:2379,https://10.10.107.192:2379,https://10.10.107.193:2379</span><br><span class="line"></span><br><span class="line">[root@master-03 ~]$ grep -n <span class="string">"etcd-servers"</span> /etc/kubernetes/manifests/kube-apiserver.yaml</span><br><span class="line">25:    - --etcd-servers=https://10.10.107.191:2379,https://10.10.107.192:2379,https://10.10.107.193:2379</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>5.éªŒè¯masteré›†ç¾¤æ˜¯å¦éƒ¨ç½²æ­£å¸¸<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">kubectl get nodes -o wide</span><br><span class="line"><span class="comment"># NAME        STATUS   ROLES    AGE     VERSION   INTERNAL-IP     EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION              CONTAINER-RUNTIME</span></span><br><span class="line"><span class="comment"># master-01   Ready    master   5d1h    v1.18.4   10.10.107.191   &lt;none&gt;        CentOS Linux 7 (Core)   5.7.0-1.el7.elrepo.x86_64   docker://19.3.9</span></span><br><span class="line"><span class="comment"># master-02   Ready    master   4d13h   v1.18.4   10.10.107.192   &lt;none&gt;        CentOS Linux 7 (Core)   5.7.0-1.el7.elrepo.x86_64   docker://19.3.9</span></span><br><span class="line"><span class="comment"># master-03   Ready    master   4d4h    v1.18.4   10.10.107.193   &lt;none&gt;        CentOS Linux 7 (Core)   5.7.0-1.el7.elrepo.x86_64   docker://19.3.9</span></span><br><span class="line"><span class="comment"># worker-01   Ready    &lt;none&gt;   5d1h    v1.18.4   10.10.107.194   &lt;none&gt;        CentOS Linux 7 (Core)   5.7.0-1.el7.elrepo.x86_64   docker://19.3.9</span></span><br><span class="line"><span class="comment"># worker-02   Ready    &lt;none&gt;   4d14h   v1.18.4   10.10.107.196   &lt;none&gt;        CentOS Linux 7 (Core)   5.7.0-1.el7.elrepo.x86_64   docker://19.3.9</span></span><br><span class="line"></span><br><span class="line">kubectl get pods -A -o wide</span><br><span class="line"><span class="comment"># NAMESPACE     NAME                                       READY   STATUS             RESTARTS   AGE     IP              NODE        NOMINATED NODE   READINESS GATES</span></span><br><span class="line"><span class="comment"># default       helloworld                                 0/1     CrashLoopBackOff   1089       3d21h   10.100.37.193   worker-02   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   calico-kube-controllers-5b8b769fcd-ns9r4   1/1     Running            0          5d1h    10.100.184.65   master-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   calico-node-8rn2s                          1/1     Running            0          4d4h    10.10.107.193   master-03   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   calico-node-bg2g9                          1/1     Running            0          5d1h    10.10.107.191   master-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   calico-node-d2vqd                          1/1     Running            0          4d13h   10.10.107.196   worker-02   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   calico-node-n48dt                          1/1     Running            0          4d13h   10.10.107.192   master-02   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   calico-node-whznq                          1/1     Running            1          5d1h    10.10.107.194   worker-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   coredns-54f99b968c-2tqc4                   1/1     Running            0          5d1h    10.100.184.67   master-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   coredns-54f99b968c-672zn                   1/1     Running            0          5d1h    10.100.184.66   master-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   etcd-master-01                             1/1     Running            0          4d2h    10.10.107.191   master-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   etcd-master-02                             1/1     Running            0          4d2h    10.10.107.192   master-02   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   etcd-master-03                             1/1     Running            0          4d4h    10.10.107.193   master-03   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   kube-apiserver-master-01                   1/1     Running            0          4d2h    10.10.107.191   master-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   kube-apiserver-master-02                   1/1     Running            0          4d2h    10.10.107.192   master-02   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   kube-apiserver-master-03                   1/1     Running            0          4d2h    10.10.107.193   master-03   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   kube-controller-manager-master-01          1/1     Running            3          5d1h    10.10.107.191   master-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   kube-controller-manager-master-02          1/1     Running            2          4d13h   10.10.107.192   master-02   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   kube-controller-manager-master-03          1/1     Running            1          4d4h    10.10.107.193   master-03   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   kube-proxy-5jjql                           1/1     Running            0          4d13h   10.10.107.196   worker-02   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   kube-proxy-7ln9t                           1/1     Running            1          5d1h    10.10.107.194   worker-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   kube-proxy-8x257                           1/1     Running            0          4d4h    10.10.107.193   master-03   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   kube-proxy-gbm52                           1/1     Running            0          4d13h   10.10.107.192   master-02   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   kube-proxy-trg7v                           1/1     Running            0          5d1h    10.10.107.191   master-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   kube-scheduler-master-01                   1/1     Running            1          5d1h    10.10.107.191   master-01   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   kube-scheduler-master-02                   1/1     Running            3          4d13h   10.10.107.192   master-02   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># kube-system   kube-scheduler-master-03                   1/1     Running            2          4d4h    10.10.107.193   master-03   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»„ä»¶å¥åº·ä¿¡æ¯æŸ¥çœ‹</span></span><br><span class="line">[root@master-01 ~]$ kubectl get cs</span><br><span class="line">NAME                 STATUS    MESSAGE             ERROR</span><br><span class="line">scheduler            Healthy   ok</span><br><span class="line">controller-manager   Healthy   ok</span><br><span class="line">etcd-1               Healthy   &#123;<span class="string">"health"</span>:<span class="string">"true"</span>&#125;</span><br><span class="line">etcd-2               Healthy   &#123;<span class="string">"health"</span>:<span class="string">"true"</span>&#125;</span><br><span class="line">etcd-0               Healthy   &#123;<span class="string">"health"</span>:<span class="string">"true"</span>&#125;</span><br><span class="line"></span><br><span class="line">[root@master-02 ~]$ kubectl get cs</span><br><span class="line">NAME                 STATUS    MESSAGE             ERROR</span><br><span class="line">scheduler            Healthy   ok</span><br><span class="line">controller-manager   Healthy   ok</span><br><span class="line">etcd-2               Healthy   &#123;<span class="string">"health"</span>:<span class="string">"true"</span>&#125;</span><br><span class="line">etcd-0               Healthy   &#123;<span class="string">"health"</span>:<span class="string">"true"</span>&#125;</span><br><span class="line">etcd-1               Healthy   &#123;<span class="string">"health"</span>:<span class="string">"true"</span>&#125;</span><br><span class="line"></span><br><span class="line">[root@master-03 ~]$ kubectl get cs</span><br><span class="line">NAME                 STATUS    MESSAGE             ERROR</span><br><span class="line">controller-manager   Healthy   ok</span><br><span class="line">scheduler            Healthy   ok</span><br><span class="line">etcd-2               Healthy   &#123;<span class="string">"health"</span>:<span class="string">"true"</span>&#125;</span><br><span class="line">etcd-1               Healthy   &#123;<span class="string">"health"</span>:<span class="string">"true"</span>&#125;</span><br><span class="line">etcd-0               Healthy   &#123;<span class="string">"health"</span>:<span class="string">"true"</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ä¿¡æ¯æŸ¥çœ‹</span></span><br><span class="line">kubectl get cm kubeadm-config -n kube-system -o yaml</span><br><span class="line"></span><br><span class="line"><span class="comment">#é€‰ä¸¾ä¿¡æ¯æŸ¥çœ‹</span></span><br><span class="line">kubectl get ep kube-controller-manager -n kube-system -o yaml</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200628155350.png" target="_blank" title="WeiyiGeek.é€‰ä¸¾æŸ¥çœ‹" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200628155350.png" alt="WeiyiGeek.é€‰ä¸¾æŸ¥çœ‹" title="" class=""></a>
                <p>WeiyiGeek.é€‰ä¸¾æŸ¥çœ‹</p>
            </figure>
</li>
</ul>
<ul>
<li><p>6.ç§»é™¤ worker èŠ‚ç‚¹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#(1)åœ¨å‡†å¤‡ç§»é™¤çš„ worker èŠ‚ç‚¹ä¸Šæ‰§è¡Œ</span></span><br><span class="line">kubeadm reset</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨ç¬¬ä¸€ä¸ª master èŠ‚ç‚¹ master-01 ä¸Šæ‰§è¡Œ,worker èŠ‚ç‚¹çš„åå­—å¯ä»¥é€šè¿‡æ‰§è¡Œ kubectl get nodes å‘½ä»¤è·å¾—;</span></span><br><span class="line">kubectl delete node worker-02</span><br></pre></td></tr></table></figure>
</li>
<li><p>7.è‡³æ­¤ä¸€ä¸ªç®€å•çš„K8sé›†ç¾¤å°±æ­å»ºå®Œæ¯•,æœ€åå†è¡¥å……ä¸€ç‚¹å…³äºtokenå¤±æ•ˆçš„é—®é¢˜é‡‡ç”¨ä»¥ä¸‹å‘½ä»¤æå®š,<code>éœ€è¦åœ¨ä¸»MasterèŠ‚ç‚¹ä¸Šè¿è¡Œå‘½ä»¤</code>;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1)æŸ¥çœ‹tokenæ˜¯å¦å¤±æ•ˆé»˜è®¤æ˜¯24H</span></span><br><span class="line">kubeadm token list</span><br><span class="line"><span class="comment"># TOKEN                     TTL         EXPIRES                     USAGES                   DESCRIPTION                                                EXTRA GROUPS</span></span><br><span class="line"><span class="comment"># opcpye.79zeofy6eo4h9ag6   13h         2020-06-24T12:45:29+08:00   authentication,signing   &lt;none&gt;                                                     system:bootstrappers:kubeadm:default-node-token</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## æ–¹å¼(1) ## </span></span><br><span class="line"><span class="comment"># (2)ä»èŠ‚ç‚¹çš„ kubeadm åŠ å…¥åˆ°k8sé›†ç¾¤ä¹‹ä¸­ (æ¨è)ï¼Œä½¿ç”¨æ­¤å‘½ä»¤è°ƒç”¨initå·¥ä½œæµçš„å•ä¸ªé˜¶æ®µ</span></span><br><span class="line">kubeadm init phase upload-certs --upload-certs</span><br><span class="line"><span class="comment"># [upload-certs] Using certificate key:</span></span><br><span class="line"><span class="comment"># 70eb87e62f052d2d5de759969d5b42f372d0ad798f98df38f7fe73efdf63a13c</span></span><br><span class="line">kubeadm token create --<span class="built_in">print</span>-join-command</span><br><span class="line"><span class="comment"># kubeadm join apiserver.demo:6443 --token bl80xo.hfewon9l5jlpmjft --discovery-token-ca-cert-hash sha256:b4d2bed371fe4603b83e7504051dcfcdebcbdcacd8be27884223c4ccc13059a4 </span></span><br><span class="line"><span class="comment"># åˆ™è¿›è¡Œç»„åˆåçš„ç¬¬äºŒã€ä¸‰ä¸ª master èŠ‚ç‚¹çš„ join å‘½ä»¤å¦‚ä¸‹:</span></span><br><span class="line">kubeadm join apiserver.demo:6443 --token ejwx62.vqwog6il5p83uk7y \</span><br><span class="line">--discovery-token-ca-cert-hash sha256:6f7a8e40a810323672de5eee6f4d19aa2dbdb38411845a1bf5dd63485c43d303 \</span><br><span class="line">--control-plane --certificate-key 70eb87e62f052d2d5de759969d5b42f372d0ad798f98df38f7fe73efdf63a13c</span><br><span class="line"><span class="comment"># (3)å·¥ä½œèŠ‚ç‚¹åŠ å…¥ç›´æ¥æ‰§è¡Œä¸Šé¢æ‰“å°å‡ºçš„token</span></span><br><span class="line"> kubeadm join apiserver.demo:6443 --token bl80xo.hfewon9l5jlpmjft --discovery-token-ca-cert-hash sha256:b4d2bed371fe4603b83e7504051dcfcdebcbdcacd8be27884223c4ccc13059a4 </span><br><span class="line"></span><br><span class="line"><span class="comment">## æ–¹å¼(2) ##</span></span><br><span class="line"><span class="comment"># 1) å¦‚æœå¤±æ•ˆå¯ä»¥é‡æ–°è¿›è¡Œç”Ÿæˆtokenè¿‡æœŸåç”Ÿæˆ</span></span><br><span class="line">kubeadm token create</span><br><span class="line"><span class="comment"># 2q41vx.w73xe9nrlqdujawu     ##æ­¤å¤„æ˜¯æ–°token</span></span><br><span class="line"><span class="comment"># 2) è·å–CAï¼ˆè¯ä¹¦ï¼‰å…¬é’¥å“ˆå¸Œå€¼</span></span><br><span class="line">openssl x509 -pubkey -<span class="keyword">in</span> /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | openssl dgst -sha256 -hex | sed <span class="string">'s/^ .* //'</span></span><br><span class="line"><span class="comment"># (stdin)= 43c8b7186efa9c68002aca3d4eed56fbc9e200c8550071a3dd1db99a10445713  ### æ­¤å¤„æ˜¯å…¬é’¥å“ˆå¸Œå€¼(ä¸€å°æœºå™¨ä¸Šè¯ä¹¦ä¸å˜å°±ä¸€ç›´æ˜¯è¯¥sha256çš„å€¼)</span></span><br><span class="line"><span class="comment"># (3) èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</span></span><br><span class="line">kubeadm join 192.168.80.137:6443 --token æ–°ç”Ÿæˆçš„Tokenå¡«å†™æ­¤å¤„ --discovery-token-ca-cert-hash sha256:è·å–çš„å…¬é’¥å“ˆå¸Œå€¼å¡«å†™æ­¤å¤„</span><br><span class="line"><span class="comment">#kubeadm join apiserver.demo:6443 --token 2q41vx.w73xe9nrlqdujawu  --discovery-token-ca-cert-hash sha256:43c8b7186efa9c68002aca3d4eed56fbc9e200c8550071a3dd1db99a10445713</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><em>æ³¨æ„äº‹é¡¹:</em></p>
<ul>
<li>1) åªæœ‰åœ¨MasterèŠ‚ç‚¹æ‰èƒ½æ‰§è¡ŒæŸ¥çœ‹nodeä»¥åŠpodç›¸å…³ä¿¡æ¯;</li>
<li>2) å¦‚æœä¸»MasterèŠ‚ç‚¹åœ¨åˆå§‹åŒ–æ—¶å€™å‡ºé”™éœ€è¦é‡æ–°é…ç½®æ—¶å€™è¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œé‡ç½®;<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop kubelet</span><br><span class="line">docker stop $(docker ps -aq)</span><br><span class="line">docker rm -f $(docker ps -aq)</span><br><span class="line">systemctl stop docker</span><br><span class="line">kubeadm reset</span><br><span class="line">sudo rm -rf <span class="variable">$HOME</span>/.kube /etc/kubernetes</span><br><span class="line">sudo rm -rf /var/lib/cni/ /etc/cni/ /var/lib/kubelet/* </span><br><span class="line">iptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X</span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl start kubelet</span><br></pre></td></tr></table></figure></li>
<li>3) å¦‚æœåŠ å…¥ä¸»masterèŠ‚ç‚¹æ—¶ä¸€ç›´åœç•™åœ¨ pre-flight çŠ¶æ€ï¼Œè¯·åœ¨ç¬¬äºŒã€ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤æ£€æŸ¥ï¼š<code>curl -ik https://è®¾ç½®APISERVER:6443/version</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ­£å¸¸çŠ¶æ€</span></span><br><span class="line"><span class="variable">$curl</span> -ik https://k8s.weiyigeek.top:6443/version</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Cache-Control: no-cache, private</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Date: Wed, 24 Jun 2020 02:16:23 GMT</span><br><span class="line">Content-Length: 263</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"major"</span>: <span class="string">"1"</span>,</span><br><span class="line">  <span class="string">"minor"</span>: <span class="string">"18"</span>,</span><br><span class="line">  <span class="string">"gitVersion"</span>: <span class="string">"v1.18.4"</span>,</span><br><span class="line">  <span class="string">"gitCommit"</span>: <span class="string">"c96aede7b5205121079932896c4ad89bb93260af"</span>,</span><br><span class="line">  <span class="string">"gitTreeState"</span>: <span class="string">"clean"</span>,</span><br><span class="line">  <span class="string">"buildDate"</span>: <span class="string">"2020-06-17T11:33:59Z"</span>,</span><br><span class="line">  <span class="string">"goVersion"</span>: <span class="string">"go1.13.9"</span>,</span><br><span class="line">  <span class="string">"compiler"</span>: <span class="string">"gc"</span>,</span><br><span class="line">  <span class="string">"platform"</span>: <span class="string">"linux/amd64"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="0x03-æ‰‹åŠ¨å®‰è£…K8sé›†ç¾¤-ç¦»çº¿"><a href="#0x03-æ‰‹åŠ¨å®‰è£…K8sé›†ç¾¤-ç¦»çº¿" class="headerlink" title="0x03 æ‰‹åŠ¨å®‰è£…K8sé›†ç¾¤(ç¦»çº¿)"></a>0x03 æ‰‹åŠ¨å®‰è£…K8sé›†ç¾¤(ç¦»çº¿)</h3><p>æè¿°:ç¦»çº¿å®‰è£…K8så³åœ¨æœºå™¨æ²¡æœ‰è¿æ¥å¤–ç½‘çš„æƒ…å†µè¿›è¡Œè¿›è¡ŒK8Sé›†ç¾¤çš„å®‰è£…ï¼›<br>å®‰è£…æ–¹å¼ä¸¤ç§:</p>
<ul>
<li>1.ç¦»çº¿å®‰è£…å·¥å…·<code>sealos</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">çº¯golangå¼€å‘ï¼Œåªéœ€ä¸€ä¸ªäºŒè¿›åˆ¶ï¼Œæ— ä»»ä½•ä¾èµ–</span><br><span class="line">å†…æ ¸æœ¬åœ°è´Ÿè½½ï¼Œä¸ä¾èµ–haproxy keepalivedç­‰</span><br><span class="line">ä¸ä¾èµ–ansible</span><br><span class="line">99å¹´è¯ä¹¦</span><br><span class="line">æ”¯æŒè‡ªå®šä¹‰é…ç½®å®‰è£…</span><br><span class="line">å·¥å…·ä¸èµ„æºåŒ…åˆ†ç¦»ï¼Œç¦»çº¿å®‰è£…ï¼Œå®‰è£…ä¸åŒç‰ˆæœ¬ä»…éœ€è¦æ›´æ¢ä¸åŒèµ„æºåŒ…å³å¯</span><br><span class="line">æ”¯æŒingress kuboard prometheusç­‰APPï¼ˆaddonsï¼‰å®‰è£…</span><br></pre></td></tr></table></figure></li>
<li>2.è‡ªå»ºä¸€ä¸ªç³»ç»Ÿæ¨¡æ¿çš„è½¯ä»¶ä»“åº“ä»¥åŠdockeré•œåƒä»“åº“harbor;</li>
</ul>
<p>åŸºç¡€è¦æ±‚:</p>
<ul>
<li>1.ç³»ç»Ÿæ¨èCentOS7.6ä»¥ä¸Šï¼Œå†…æ ¸æ¨è4.14ä»¥ä¸Šï¼ŒCPUèŠ‚ç‚¹é…ç½®ä¸ä½äº2æ ¸4Gï¼›</li>
<li>2.æœ‰æœºå™¨ root ç”¨æˆ·å¯†ç ä¸€è‡´ï¼ˆå¦‚ä¸ä¸€è‡´ä¹Ÿå¯ä»¥ä½¿ç”¨ ssh å¯†é’¥ï¼‰</li>
</ul>
<p><br></p>
<h4 id="1-åŠè‡ªåŠ¨ç¦»çº¿å®‰è£…"><a href="#1-åŠè‡ªåŠ¨ç¦»çº¿å®‰è£…" class="headerlink" title="1.åŠè‡ªåŠ¨ç¦»çº¿å®‰è£…"></a>1.åŠè‡ªåŠ¨ç¦»çº¿å®‰è£…</h4><p>æè¿°:å¯¹äºåŠè‡ªåŠ¨ç¦»çº¿è¿›è¡Œkubernetesçš„å®‰è£…ï¼Œæˆ‘ä»¬é‡‡ç”¨ç¦»çº¿ä¸‹è½½é•œåƒä»¥åŠæ­å»ºæœ¬åœ°å†…éƒ¨yumä»“åº“æœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€ä¸‹çš„å‡†å¤‡å·¥ä½œï¼›</p>
<ul>
<li>(1) åŸºç¡€æ“ä½œç³»ç»Ÿå®‰è£…é•œåƒ: CentOS Linux release 7.8.2003 (Core) - 5.7.0-1.el7.elrepo.x86_64</li>
<li>(2) å†…ç½‘yumä»“åº“å»ºç«‹ä¸‹è½½Kubernetesç›¸å…³çš„å®‰è£…åŒ…å³:<code>kubelet-1.18.4 kubeadm-1.18.4 kubectl-1.18.4</code></li>
<li>(3) Dockerç›¸å…³ç¯å¢ƒä¸‹è½½kubernetesç›¸å…³åŠŸèƒ½ç»„ä»¶è¿›è¡Œæ‰“åŒ…ï¼ˆåé¢å»ºè®®é‡‡ç”¨harboré•œåƒä»“åº“ï¼‰:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">k8s.gcr.io/kube-apiserver:v1.18.4</span><br><span class="line">k8s.gcr.io/kube-controller-manager:v1.18.4</span><br><span class="line">k8s.gcr.io/kube-scheduler:v1.18.4</span><br><span class="line">k8s.gcr.io/kube-proxy:v1.18.4</span><br><span class="line">k8s.gcr.io/pause:3.2</span><br><span class="line">k8s.gcr.io/etcd:3.4.3-0</span><br><span class="line">k8s.gcr.io/coredns:1.6.7</span><br></pre></td></tr></table></figure></li>
<li>(4) ç®€æ˜“çš„webåº”ç”¨:Nginxæˆ–è€…httpdç¯å¢ƒ</li>
<li>(5) å‡†å¤‡å‡ å°ç›¸å…³é…ç½®çš„æœºå™¨å¹¶ä¸”è®¾ç½®ä¸åŒçš„æœºå™¨åç§°;</li>
</ul>
<p>k8s.gcr.ioé•œåƒä¸‹è½½æ–¹æ³•:</p>
<ul>
<li>1.æœºå™¨ä¸èƒ½è®¿é—®<code>k8s.gcr.io</code>æƒ…å†µä¸‹<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## é•œåƒä¸‹è½½æ–¹æ³•ï¼ˆ1ï¼‰</span></span><br><span class="line"><span class="comment"># æ–¹å¼1ï¼škubeadm config images list &gt; gcr.io.log &amp;&amp; sed -i 's#k8s.gcr.io#mirrorgcrio#g' gcr.io.log</span></span><br><span class="line"><span class="comment"># æ–¹å¼2: kubeadm config images list --image-repository mirrorgcrio &gt; gcr.io.log</span></span><br><span class="line"><span class="comment"># æ³¨æ„è¯¥forè¯»å–è¡Œé»˜è®¤ä»¥ç©ºæ ¼ä½œä¸ºç»“æŸåˆ†éš”ç¬¦</span></span><br><span class="line"><span class="comment"># for k8s in $(cat gcr.io.log);do docker pull $&#123;k8s&#125;; done  </span></span><br><span class="line"><span class="comment"># sed -e "s#\\(/.*$\\)#\1 k8s.gcr.io\1#g" gcr.io.log &gt; gcr.io.log1</span></span><br><span class="line"><span class="comment"># while read k8sgcrio;do docker tag $&#123;k8sgcrio&#125;; done &lt; gcr.io.log1</span></span><br><span class="line"><span class="comment"># for k8s in $(cat gcr.io.log);do docker rmi $&#123;k8s&#125;; done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## é•œåƒä¸‹è½½ä¸tagæ‰“åŒ…æ–¹æ³•ï¼ˆ2ï¼‰- æ¨è</span></span><br><span class="line">K8SVERSION=1.18.5</span><br><span class="line">kubeadm config images list --kubernetes-version=<span class="variable">$&#123;K8SVERSION&#125;</span> 2&gt;/dev/null | sed <span class="string">'s/k8s.gcr.io/docker pull mirrorgcrio/g'</span> | sudo sh</span><br><span class="line">kubeadm config images list --kubernetes-version=<span class="variable">$&#123;K8SVERSION&#125;</span> 2&gt;/dev/null | sed <span class="string">'s/k8s.gcr.io\(.*\)/docker tag mirrorgcrio\1 k8s.gcr.io\1/g'</span> | sudo sh</span><br><span class="line">kubeadm config images list --kubernetes-version=<span class="variable">$&#123;K8SVERSION&#125;</span> 2&gt;/dev/null | sed <span class="string">'s/k8s.gcr.io/docker image rm mirrorgcrio/g'</span> | sudo sh</span><br><span class="line">docker save -o v<span class="variable">$&#123;K8SVERSION&#125;</span>.tar $(docker images | grep -v TAG | cut -d <span class="string">' '</span> -f1)</span><br><span class="line">gzip v<span class="variable">$&#123;K8SVERSION&#125;</span>.tar v<span class="variable">$&#123;K8SVERSION&#125;</span>.tar.gz</span><br></pre></td></tr></table></figure></li>
<li>2.æœºå™¨èƒ½è®¿é—®k8s.gcr.ioæ—¶å»ºè®®ï¼Œå°†æ‰€éœ€ç‰ˆæœ¬çš„é•œåƒ pull ä¸‹æ¥ç„¶å save æˆ tar åŒ…ä¼ å›æœ¬åœ°æˆ–è€…harborä¹‹ä¸­ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># for: use kubeadm pull kubernetes images</span></span><br><span class="line"><span class="comment"># date: 2019-08-15</span></span><br><span class="line"><span class="built_in">set</span> -xue</span><br><span class="line">apt-get update &amp;&amp; apt-get install -y apt-transport-https curl</span><br><span class="line">curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -</span><br><span class="line">cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span><br><span class="line">deb https://apt.kubernetes.io/ kubernetes-xenial main</span><br><span class="line">EOF</span><br><span class="line">apt-get update</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> version <span class="keyword">in</span> 1.17.4</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    apt install kubeadm=<span class="variable">$&#123;version&#125;</span>-00</span><br><span class="line">    mkdir -p <span class="variable">$&#123;version&#125;</span></span><br><span class="line">    kubeadm config images pull --kubernetes-version=<span class="variable">$&#123;version&#125;</span></span><br><span class="line">    docker save -o v<span class="variable">$&#123;version&#125;</span>.tar $(docker images | grep -v TAG | grep k8s.gcr.io | cut -d <span class="string">' '</span> -f1)</span><br><span class="line">    gzip v<span class="variable">$&#123;version&#125;</span>.tar v<span class="variable">$&#123;version&#125;</span>.tar.gz</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>åŸºç¡€æµç¨‹:</strong><br>Step1.æœ¬åœ°å†…éƒ¨yumä»“åº“æ­å»º(ç›¸å…³ç¯å¢ƒçš„ä¾èµ–åŒ…ä¸‹è½½)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å…¨å±€å˜é‡</span></span><br><span class="line"><span class="built_in">export</span> K8SVERSION=<span class="string">"1.18.5"</span></span><br><span class="line"><span class="built_in">export</span> REGISTRY_MIRROR=<span class="string">"https://xlx9erfu.mirror.aliyuncs.com"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## ç³»ç»ŸåŸºç¡€è®¾ç½®</span></span><br><span class="line">hostnamectl <span class="built_in">set</span>-hostname k8s-yum-server &amp;&amp; <span class="built_in">echo</span> <span class="string">"127.0.0.1 k8s-yum-server"</span> &gt;&gt; /etc/hosts</span><br><span class="line">setenforce 0 &amp;&amp; getenforce &amp;&amp; hostnamectl status</span><br><span class="line"></span><br><span class="line"><span class="comment">## åº”ç”¨åŸºç¡€è®¾ç½®</span></span><br><span class="line">sed -i <span class="string">"s#keepcache=0#keepcache=1#g"</span> /etc/yum.conf &amp;&amp; <span class="built_in">echo</span> -e <span class="string">"ç¼“å­˜ç›®å½•:"</span> &amp;&amp; grep <span class="string">"cachedir"</span> /etc/yum.conf </span><br><span class="line"><span class="keyword">if</span> [[ ! -d <span class="string">"/etc/docker/"</span> ]];<span class="keyword">then</span> mkdir /etc/docker/;<span class="keyword">fi</span></span><br><span class="line">cat &gt; /etc/docker/daemon.json &lt;&lt;EOF</span><br><span class="line">&#123;<span class="string">"registry-mirrors"</span>: [<span class="string">"REPLACE"</span>]&#125;</span><br><span class="line">EOF</span><br><span class="line">sed -i <span class="string">"s#REPLACE#<span class="variable">$&#123;REGISTRY_MIRROR&#125;</span>#g"</span> /etc/docker/daemon.json</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker kubelet</span><br><span class="line"></span><br><span class="line"><span class="comment">## åº”ç”¨å®‰è£…è®¾ç½®</span></span><br><span class="line"><span class="comment"># å®‰è£…åŸºç¡€ä¾èµ–</span></span><br><span class="line">yum install -y yum-utils lvm2 wget nfs-utils</span><br><span class="line"><span class="comment"># æ·»åŠ  docker é•œåƒä»“åº“</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;<span class="string">'EOF'</span> &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class="line">      http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">yum list docker-ce --showduplicates | sort -r</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">'è¯·è¾“å…¥éœ€è¦å®‰è£…çš„Docker-ceçš„ç‰ˆæœ¬å·(ä¾‹å¦‚:19.03.9):'</span> VERSION</span><br><span class="line">yum install -y docker-ce-<span class="variable">$&#123;VERSION&#125;</span> docker-ce-cli-<span class="variable">$&#123;VERSION&#125;</span> containerd.io</span><br><span class="line"></span><br><span class="line">yum list kubeadm --showduplicates | sort -r</span><br><span class="line"><span class="comment"># createrepo ä¸ httpd æ˜¯å»ºç«‹å†…éƒ¨ä»“åº“å¿…é¡»çš„è½¯ä»¶</span></span><br><span class="line">yum install -y kubelet-<span class="variable">$&#123;K8SVERSION&#125;</span> kubeadm-<span class="variable">$&#123;K8SVERSION&#125;</span> kubectl-<span class="variable">$&#123;K8SVERSION&#125;</span> httpd createrepo</span><br><span class="line"><span class="comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„ docker-ce å’Œ kubeletã€kubeadm</span></span><br><span class="line"><span class="comment"># yum install docker-ce-19.03.3-3.el7 kubelet-1.17.4-0 kubeadm-1.17.4-0 kubectl-1.17.4-0 --disableexcludes=kubernetes</span></span><br></pre></td></tr></table></figure></p>
<p>Step2.ä¸‹è½½K8s.gcr.ioä¸­çš„é•œåƒåˆ°æœ¬åœ°å¹¶ä¸”è¿›è¡Œæ‰“åŒ…<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Dockerä¸‹è½½K8s.gcr.ioé•œåƒ</span></span><br><span class="line">kubeadm config images list --kubernetes-version=<span class="variable">$&#123;K8SVERSION&#125;</span> 2&gt;/dev/null | sed <span class="string">'s/k8s.gcr.io/docker pull mirrorgcrio/g'</span> | sudo sh</span><br><span class="line">kubeadm config images list --kubernetes-version=<span class="variable">$&#123;K8SVERSION&#125;</span> 2&gt;/dev/null | sed <span class="string">'s/k8s.gcr.io\(.*\)/docker tag mirrorgcrio\1 k8s.gcr.io\1/g'</span> | sudo sh</span><br><span class="line">kubeadm config images list --kubernetes-version=<span class="variable">$&#123;K8SVERSION&#125;</span> 2&gt;/dev/null | sed <span class="string">'s/k8s.gcr.io/docker image rm mirrorgcrio/g'</span> | sudo sh</span><br><span class="line">docker save -o v<span class="variable">$&#123;K8SVERSION&#125;</span>.tar $(docker images | grep -v TAG | cut -d <span class="string">' '</span> -f1)</span><br><span class="line"><span class="comment"># å‡å°‘é•œåƒæ‰“åŒ…åçš„ä½“ç§¯</span></span><br><span class="line">gzip v<span class="variable">$&#123;K8SVERSION&#125;</span>.tar v<span class="variable">$&#123;K8SVERSION&#125;</span>.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>Step3.å°†yumç¼“å­˜ä¸‹è½½çš„rpmä»¥åŠk8sæ‰“åŒ…åçš„é•œåƒæ”¾åœ¨httpdåº”ç”¨æœåŠ¡è®¿é—®ç›®å½•é‡Œå³<code>/var/www/html/</code>ï¼Œç„¶åè¿›è¡Œç”Ÿæˆå†…éƒ¨yumæ•°æ®åº“å’Œä¿¡æ¯ç´¢å¼•æ–‡ä»¶ï¼›<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/httpd/conf.d/welcome.conf&#123;,.bak&#125;</span><br><span class="line">mkdir /var/www/html/yum/</span><br><span class="line">find /var/cache/yum -name *.rpm -<span class="built_in">exec</span> cp -a &#123;&#125; /var/www/html/yum/ \;</span><br><span class="line"><span class="comment"># æƒé™éå¸¸é‡è¦å¦åˆ™åé¢ä¸‹è½½æç¤ºæƒé™ä¸è¶³</span></span><br><span class="line">cp v<span class="variable">$&#123;K8SVERSION&#125;</span>.tar.gz /var/www/html/yum/ &amp;&amp; chmod +644 /var/www/html/yum/v<span class="variable">$&#123;K8SVERSION&#125;</span>.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆå†…éƒ¨yumæ•°æ®åº“å’Œä¿¡æ¯ç´¢å¼•æ–‡ä»¶</span></span><br><span class="line">createrepo -pdo /var/www/html/yum/ /var/www/html/yum/</span><br><span class="line">createrepo --update /var/www/html/yum/</span><br></pre></td></tr></table></figure></p>
<p>Step4.å†…éƒ¨yumä»“åº“çš„httpdæœåŠ¡å¯åŠ¨å’Œé˜²ç«å¢™è®¾ç½®<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-port=80/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">systemctl start httpd</span><br></pre></td></tr></table></figure></p>
<p>Step5.åˆ©ç”¨æ¨¡æ¿å…‹éš†ä¸€å°æœºå™¨å‡ºæ¥éªŒè¯å†…éƒ¨ä»“åº“æ˜¯å¦é…ç½®æˆåŠŸå¯ä»¥æ­£å¸¸è¿›è¡Œè½¯ä»¶å®‰è£…<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"10.10.107.201 yum.weiyigeek.top"</span> &gt;&gt; /etc/hosts</span><br><span class="line">cat &gt; /etc/yum.repos.d/localyumserver.repo &lt;&lt;END</span><br><span class="line">[localyumserver]</span><br><span class="line">name=localyumserver</span><br><span class="line">baseurl=http://yum.weiyigeek.top/yum/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">END</span><br><span class="line">yum --enablerepo=localyumserver --disablerepo=base,extras,updates,epel,elrepo,docker-ce-stable list</span><br></pre></td></tr></table></figure><br>å¦‚æœæ­£å¸¸æ˜¾ç¤ºä»¥ä¸‹åˆ™è¯´æ˜åˆ›å»ºæˆåŠŸï¼Œå¦åˆ™è¯·å‚è€ƒæŠ¥é”™ä¿¡æ¯è¿›è¡Œç›¸åº”çš„è°ƒæ•´;<br><figure class="image-box">
                <a rel=2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200629171127.png" target="_blank" title="WeiyiGeek.localyumserver" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200629171127.png" alt="WeiyiGeek.localyumserver" title="" class=""></a>
                <p>WeiyiGeek.localyumserver</p>
            </figure></p>
<ul>
<li>Step6.åœ¨è¿™å°å…‹éš†æœºä¸Šè¿›è¡Œå®‰è£…K8såŸºç¡€ç¯å¢ƒçš„è®¾ç½®<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> HOSTNAME=worker-03</span><br><span class="line"><span class="comment"># ä¸´æ—¶å…³é—­swapå’ŒSELinux</span></span><br><span class="line">swapoff -a &amp;&amp; setenforce 0</span><br><span class="line"><span class="comment"># æ°¸ä¹…å…³é—­swapå’ŒSELinux</span></span><br><span class="line">yes | cp /etc/fstab /etc/fstab_bak</span><br><span class="line">cat /etc/fstab_bak |grep -v swap &gt; /etc/fstab</span><br><span class="line">sed -i <span class="string">"s/^SELINUX=.*$/SELINUX=disabled/"</span> /etc/selinux/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»æœºåè®¾ç½®(è¿™é‡Œä¸»æœºåç§°å®‰è£…ä¸Šé¢çš„IPåœ°å€è§„åˆ’å¯¹åº”çš„ä¸»æœºåç§°-æ ¹æ®å®‰è£…çš„ä¸»æœºè¿›è¡Œå˜åŒ–)</span></span><br><span class="line">hostnamectl <span class="built_in">set</span>-hostname <span class="variable">$HOSTNAME</span></span><br><span class="line">hostnamectl status</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»æœºåè®¾ç½®</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"127.0.0.1 <span class="variable">$HOSTNAME</span>"</span> &gt;&gt; /etc/hosts</span><br><span class="line">cat &gt;&gt; /etc/hosts &lt;&lt;EOF</span><br><span class="line">10.10.107.191 master-01</span><br><span class="line">10.10.107.192 master-02</span><br><span class="line">10.10.107.193 master-03</span><br><span class="line">10.10.107.194 worker-01</span><br><span class="line">10.10.107.196 worker-02</span><br><span class="line">10.20.172.200 worker-03</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹ /etc/sysctl.conf è¿›è¡Œå†…æ ¸å‚æ•°çš„é…ç½®</span></span><br><span class="line">egrep -q <span class="string">"^(#)?net.ipv4.ip_forward.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.ipv4.ip_forward.*|net.ipv4.ip_forward = 1|g"</span>  /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.ipv4.ip_forward = 1"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">egrep -q <span class="string">"^(#)?net.bridge.bridge-nf-call-ip6tables.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.bridge.bridge-nf-call-ip6tables.*|net.bridge.bridge-nf-call-ip6tables = 1|g"</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.bridge.bridge-nf-call-ip6tables = 1"</span> &gt;&gt; /etc/sysctl.conf </span><br><span class="line">egrep -q <span class="string">"^(#)?net.bridge.bridge-nf-call-iptables.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.bridge.bridge-nf-call-iptables.*|net.bridge.bridge-nf-call-iptables = 1|g"</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.bridge.bridge-nf-call-iptables = 1"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">egrep -q <span class="string">"^(#)?net.ipv6.conf.all.disable_ipv6.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.ipv6.conf.all.disable_ipv6.*|net.ipv6.conf.all.disable_ipv6 = 1|g"</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.ipv6.conf.all.disable_ipv6 = 1"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">egrep -q <span class="string">"^(#)?net.ipv6.conf.default.disable_ipv6.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.ipv6.conf.default.disable_ipv6.*|net.ipv6.conf.default.disable_ipv6 = 1|g"</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.ipv6.conf.default.disable_ipv6 = 1"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">egrep -q <span class="string">"^(#)?net.ipv6.conf.lo.disable_ipv6.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.ipv6.conf.lo.disable_ipv6.*|net.ipv6.conf.lo.disable_ipv6 = 1|g"</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.ipv6.conf.lo.disable_ipv6 = 1"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">egrep -q <span class="string">"^(#)?net.ipv6.conf.all.forwarding.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.ipv6.conf.all.forwarding.*|net.ipv6.conf.all.forwarding = 1|g"</span>  /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.ipv6.conf.all.forwarding = 1"</span>  &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="comment"># ä½¿ä¿®æ”¹çš„å†…æ ¸å‚æ•°ç«‹å³ç”Ÿæ•ˆ</span></span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># é•œåƒåŠ é€Ÿ</span></span><br><span class="line"><span class="built_in">export</span> REGISTRY_MIRROR=<span class="string">"https://xlx9erfu.mirror.aliyuncs.com"</span></span><br><span class="line"><span class="keyword">if</span> [[ ! -d <span class="string">"/etc/docker/"</span> ]];<span class="keyword">then</span> mkdir /etc/docker/;<span class="keyword">fi</span></span><br><span class="line">cat &gt; /etc/docker/daemon.json &lt;&lt;EOF</span><br><span class="line">&#123;<span class="string">"registry-mirrors"</span>: [<span class="string">"REPLACE"</span>]&#125;</span><br><span class="line">EOF</span><br><span class="line">sed -i <span class="string">"s#REPLACE#<span class="variable">$&#123;REGISTRY_MIRROR&#125;</span>#g"</span> /etc/docker/daemon.json</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Step7.åˆ©ç”¨å†…éƒ¨yumæºè¿›è¡ŒKuberntesç¯å¢ƒå®‰è£…<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install -y --enablerepo=localyumserver --disablerepo=base,extras,updates,epel,elrepo,docker-ce-stable kubelet kubeadm kubectl</span><br><span class="line"><span class="comment"># dockerå¯åŠ¨è®¾ç½®</span></span><br><span class="line">sed -i <span class="string">"s#^ExecStart=/usr/bin/dockerd.*#ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --exec-opt native.cgroupdriver=systemd#g"</span> /usr/lib/systemd/system/docker.service</span><br><span class="line"><span class="comment"># é‡å¯ dockerï¼Œå¹¶å¯åŠ¨ kubelet</span></span><br><span class="line">systemctl daemon-reload &amp;&amp; systemctl <span class="built_in">enable</span> kubelet</span><br><span class="line">systemctl restart docker kubelet</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200629173552.png" target="_blank" title="WeiyiGeek.kubeç›¸å…³å‘½ä»¤å®‰è£…å¸¸è§„" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200629173552.png" alt="WeiyiGeek.kubeç›¸å…³å‘½ä»¤å®‰è£…å¸¸è§„" title="" class=""></a>
                <p>WeiyiGeek.kubeç›¸å…³å‘½ä»¤å®‰è£…å¸¸è§„</p>
            </figure></p>
<p>Step8.å°†yumä»“åº“ä¸­çš„é•œåƒæ‹‰å–æœ¬åœ°éƒ¨ç½²æœºå™¨ä¸Šåï¼Œå†ä½¿ç”¨ docker load å‘½ä»¤å°†é•œåƒå¯¼å…¥åˆ°å®¿ä¸»æœº docker é•œåƒå­˜å‚¨ä¸­ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget -c http://10.10.107.201/yum/v1.18.5.tar.gz </span><br><span class="line">gzip -dv v1.18.5.tar.gz &amp;&amp; docker load &lt; v1.18.5.tar</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200629203618.png" target="_blank" title="WeiyiGeek.é•œåƒå¯¼å…¥ç»“æœ" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200629203618.png" alt="WeiyiGeek.é•œåƒå¯¼å…¥ç»“æœ" title="" class=""></a>
                <p>WeiyiGeek.é•œåƒå¯¼å…¥ç»“æœ</p>
            </figure></p>
<p>Step9.å°†å·¥ä½œèŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¹‹ä¸­<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) ä¸»MasterèŠ‚ç‚¹è¿è¡Œ</span></span><br><span class="line">[root@master-01 ~]<span class="variable">$kubeadm</span> token create --<span class="built_in">print</span>-join-command 2&gt;/dev/null</span><br><span class="line">kubeadm join k8s.weiyigeek.top:6443 --token fvu5ei.akiiuhywibwxvdwh     --discovery-token-ca-cert-hash sha256:0795075090d621285dbaa4a76b9b320150f5ae3c37f5d7b92fc1c4f8942d9243</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) å·¥ä½œèŠ‚ç‚¹æ‰§è¡ŒåŠ å…¥åˆ°k8sçš„clusterä¸­</span></span><br><span class="line">APISERVER_IP=10.10.107.191</span><br><span class="line">APISERVER_NAME=k8s.weiyigeek.top</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;APISERVER_IP&#125;</span> <span class="variable">$&#123;APISERVER_NAME&#125;</span>"</span> &gt;&gt; /etc/hosts</span><br><span class="line"></span><br><span class="line">[root@worker-03 ~]<span class="variable">$kubeadm</span> join k8s.weiyigeek.top:6443 --token fvu5ei.akiiuhywibwxvdwh     --discovery-token-ca-cert-hash sha256:0795075090d621285dbaa4a76b9b320150f5ae3c37f5d7b92fc1c4f8942d9243</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) ä¸»èŠ‚ç‚¹éªŒè¯åŠ å…¥çš„workerå·¥ä½œèŠ‚ç‚¹</span></span><br><span class="line"><span class="variable">$kubectl</span> get nodes</span><br><span class="line">NAME        STATUS   ROLES    AGE     VERSION</span><br><span class="line">master-01   Ready    master   6d8h    v1.18.4</span><br><span class="line">master-02   Ready    master   5d20h   v1.18.4</span><br><span class="line">master-03   Ready    master   5d11h   v1.18.4</span><br><span class="line">worker-01   Ready    &lt;none&gt;   6d8h    v1.18.4</span><br><span class="line">worker-02   Ready    &lt;none&gt;   5d21h   v1.18.4</span><br><span class="line">worker-03   Ready    &lt;none&gt;   11m     v1.18.5  <span class="comment">#ç”±äºkubeletæ˜¯v1.18.5ç‰ˆæœ¬çš„ï¼Œåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ä¸€èˆ¬é‡‡ç”¨ç¨³å®šç‰ˆæœ¬</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$kubectl</span> get pods -A -n kube-system  -o wide | grep <span class="string">"worker-03"</span></span><br><span class="line">kube-system   calico-node-f2vwk                          1/1     Running   0          2m14s   10.20.172.200   worker-03   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   kube-proxy-mwml4                           1/1     Running   0          2m5s    10.20.172.200   worker-03   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„äº‹é¡¹:</p>
<ul>
<li>1.å½“ä½¿ç”¨ <code>kubeadm pull</code> ç›¸å…³é•œåƒæ—¶ <code>kubeadm</code> çš„ç‰ˆæœ¬æœ€å¥½å’Œ <code>kubernetes-version=${version}</code> ç‰ˆæœ¬ä¸€è‡´ï¼Œä¸ä¸€è‡´çš„è¯æœ‰äº›ç‰ˆæœ¬çš„é•œåƒæ˜¯ pull ä¸ä¸‹æ¥çš„éœ€è¦å¯¹åº”ç‰ˆæœ¬çš„ kubernetes è¦ä½¿ç”¨å¯¹åº”ç‰ˆæœ¬çš„é•œåƒæ‰å¯ä»¥ã€‚</li>
<li>2.ä¸€èˆ¬æ¥è¯´å¤§ç‰ˆæœ¬é™¤äº†k8sè‡ªå¸¦çš„å‘½ä»¤ç‰ˆæœ¬ä¼šæœ‰å˜åŒ–å¤–ï¼Œä¾èµ–çš„åŠŸèƒ½ç»„ä»¶é€šå¸¸æ˜¯ä¸ä¼šå˜åŒ–çš„æ¯”å¦‚<code>pause:3.2/etcd:3.4.3-0/coredns:1.6.7</code></li>
<li>3.æˆåŠŸå¯¼å…¥ docker é•œåƒä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ kubeadm init å‘½ä»¤æ¥åˆå§‹åŒ– master èŠ‚ç‚¹æˆ–è€…åˆå§‹åŒ–workèŠ‚ç‚¹ï¼›</li>
</ul>
<p><br></p>
<h4 id="2-ç¦»çº¿åŒ…å®‰è£…-sealos"><a href="#2-ç¦»çº¿åŒ…å®‰è£…-sealos" class="headerlink" title="2.ç¦»çº¿åŒ…å®‰è£…(sealos)"></a>2.ç¦»çº¿åŒ…å®‰è£…(sealos)</h4><p>æè¿°:å¯¹äºç”Ÿäº§ç¯å¢ƒéœ€è¦è€ƒè™‘åˆ°æ§åˆ¶å¹³é¢çš„é«˜å¯ç”¨ï¼Œåœ¨è¿™é‡Œä¸ºäº†æ–¹ä¾¿éƒ¨ç½²é€‰ç”¨åŸºäº kubeadm çš„éƒ¨ç½²å·¥å…· <a href="https://github.com/fanux/sealos" target="_blank" rel="noopener">sealos</a>å®‰è£…ï¼ŒåŒ…å«<code>å®‰è£…æ‰€éœ€çš„æ‰€æœ‰äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé•œåƒæ–‡ä»¶ï¼Œsystemdé…ç½®ï¼Œyamlé…ç½®ä¸ä¸€äº›ç®€å•çš„å¯åŠ¨è„šæœ¬</code>;å¯¹äºç”Ÿäº§ç¯å¢ƒæ— éœ€æµ‹è¯•ç¯å¢ƒå½“ä¸­çš„ä¸€äº›å‡†å¤‡å·¥ä½œï¼Œä½¿ç”¨ <code>sealos</code> ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å®ŒæˆèŠ‚ç‚¹åˆå§‹åŒ–ç›¸å…³å·¥ä½œï¼Œåªéœ€è¦åœ¨ä¸€å° master èŠ‚ç‚¹ä¸‹è½½ <code>sealos äºŒè¿›åˆ¶æ–‡ä»¶</code>å’Œ<code>ç¦»çº¿å®‰è£…åŒ…éƒ¨ç½²</code>å³å¯ã€‚</p>
<p>ä½¿ç”¨èµ„æº:</p>
<ul>
<li>1.<a href="http://store.lameleg.com/" target="_blank" rel="noopener">kubernetesç¦»çº¿å®‰è£…åŒ…</a></li>
<li>2.<a href="https://github.com/fanux/sealos/releases" target="_blank" rel="noopener">sealosäºŒè¿›åˆ¶ç‰ˆæœ¬</a></li>
</ul>
<p>åŸºç¡€è¯´æ˜:</p>
<ul>
<li>1.å¯¹äº <code>1.17.0~1.17.5</code>æˆ–è€…<code>1.18.0~1.18.5</code>ç‰ˆæœ¬çš„ç¦»çº¿å®‰è£…åŒ…ï¼Œå…¶ä¸­åªæœ‰ kubenetets çš„ç‰ˆæœ¬é•œåƒä¸åŒå…¶ä½™çš„æ’ä»¶ç‰ˆæœ¬éƒ½ä¸€è‡´ï¼Œå› æ­¤å¯ä»¥é€‰æ‹©ä»¥ <code>1.17.0/1.18.0</code> ç‰ˆæœ¬ä¸ºåŸºç¡€åˆ¶ä½œç¬¦åˆè‡ªå·±æ‰€éœ€è¦çš„ç‰ˆæœ¬ã€‚ä¾‹å¦‚:<a href="http://store.lameleg.com:8080/pro/kubernetes1.18.0?time=1593396354742&amp;referrer=null" target="_blank" rel="noopener">1.18.0åŸºç¡€ç‰ˆæœ¬</a></li>
</ul>
<p>é›†ç¾¤éƒ¨ç½²:</p>
<ul>
<li>Step1.ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„sealosäºŒè¿›åˆ¶æ–‡ä»¶<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -c https://sealyun.oss-cn-beijing.aliyuncs.com/latest/sealos -O /usr/bin/  &amp;&amp; chmod +x /usr/bin/sealos</span><br></pre></td></tr></table></figure></li>
<li>Step2.sealoså‚æ•°è¯´æ˜å’Œä½¿ç”¨</li>
</ul>
<table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>å«ä¹‰</th>
<th>ç¤ºä¾‹</th>
<th>æ˜¯å¦å¿…é¡»</th>
</tr>
</thead>
<tbody>
<tr>
<td>passwd</td>
<td>æœåŠ¡å™¨å¯†ç </td>
<td>123456</td>
<td>å’Œç§é’¥äºŒé€‰ä¸€</td>
</tr>
<tr>
<td>master</td>
<td>k8s masterèŠ‚ç‚¹IPåœ°å€</td>
<td>192.168.0.2</td>
<td>å¿…é¡»</td>
</tr>
<tr>
<td>node</td>
<td>k8s nodeèŠ‚ç‚¹IPåœ°å€</td>
<td>192.168.0.3</td>
<td>å¯é€‰</td>
</tr>
<tr>
<td>pkg-url</td>
<td>ç¦»çº¿èµ„æºåŒ…åœ°å€ï¼Œæ”¯æŒä¸‹è½½åˆ°æœ¬åœ°ï¼Œæˆ–è€…ä¸€ä¸ªè¿œç¨‹åœ°å€</td>
<td>/root/kube1.16.0.tar.gz</td>
<td>å¿…é¡»</td>
</tr>
<tr>
<td>version</td>
<td><a href="http://store.lameleg.com/" target="_blank" rel="noopener">èµ„æºåŒ…</a>å¯¹åº”çš„ç‰ˆæœ¬</td>
<td>v1.16.0</td>
<td>å¿…é¡»</td>
</tr>
<tr>
<td>kubeadm-config</td>
<td>è‡ªå®šä¹‰kubeadmé…ç½®æ–‡ä»¶</td>
<td>kubeadm.yaml.temp</td>
<td>å¯é€‰</td>
</tr>
<tr>
<td>pk</td>
<td>sshç§é’¥åœ°å€ï¼Œå…å¯†é’¥æ—¶ä½¿ç”¨</td>
<td>/root/.ssh/id_rsa</td>
<td>å’ŒpasswdäºŒé€‰ä¸€</td>
</tr>
<tr>
<td>user</td>
<td>sshç”¨æˆ·å</td>
<td>root</td>
<td>å¯é€‰</td>
</tr>
<tr>
<td>interface</td>
<td>æœºå™¨ç½‘å¡åï¼ŒCNIç½‘å¡å‘ç°ç”¨</td>
<td>eth.*</td>
<td>å¯é€‰</td>
</tr>
<tr>
<td>network</td>
<td>CNIç±»å‹å¦‚calico flannel</td>
<td>calico</td>
<td>å¯é€‰</td>
</tr>
<tr>
<td>podcidr</td>
<td>podç½‘æ®µ</td>
<td>100.64.0.0/10</td>
<td>å¯é€‰</td>
</tr>
<tr>
<td>repo</td>
<td>é•œåƒä»“åº“,ç¦»çº¿åŒ…é€šå¸¸ä¸ç”¨é…ç½®,é™¤éä½ æŠŠé•œåƒå¯¼å…¥åˆ°è‡ªå·±ç§æœ‰ä»“åº“äº†</td>
<td>k8s.gcr.io</td>
<td>å¯é€‰</td>
</tr>
<tr>
<td>svccidr</td>
<td>clusteripç½‘æ®µ</td>
<td>10.96.0.0/22</td>
<td>å¯é€‰</td>
</tr>
<tr>
<td>without-cni</td>
<td>ä¸è£…cniæ’ä»¶ï¼Œä¸ºäº†ç”¨æˆ·è‡ªå·±è£…åˆ«çš„CNI</td>
<td></td>
<td>å¯é€‰</td>
</tr>
</tbody>
</table>
<p>å°†åˆ¶ä½œå¥½çš„ç¦»çº¿å®‰è£…åŒ… <code>scp</code> åˆ° <code>master</code> èŠ‚ç‚¹çš„ <code>/opt</code> ç›®å½•ä¸‹ã€‚<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sealos init --master 10.10.107.109 \</span><br><span class="line">    --master 10.10.107.119 \</span><br><span class="line">    --master 10.10.107.121 \</span><br><span class="line">    --node 10.10.107.123 \</span><br><span class="line">    --node 10.10.107.124 \</span><br><span class="line">    --user root \</span><br><span class="line">    --passwd weiyigeek_test \</span><br><span class="line">    --version v1.17.4 \</span><br><span class="line">    --network calico \</span><br><span class="line">    --pkg-url /opt/kube1.17.4.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>éƒ¨ç½²æˆåŠŸåä¼šå‡ºç°ä»¥ä¸‹æç¤ºï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">15:37:35 [INFO] [ssh.go:60] [ssh][10.10.107.124:22]:</span><br><span class="line">15:37:35 [INFO] [ssh.go:11] [ssh][10.10.107.124:22]exec cmd is : mkdir -p /etc/kubernetes/manifests</span><br><span class="line">15:37:36 [DEBG] [ssh.go:23] [ssh][10.10.107.124:22]command result is:</span><br><span class="line">15:37:36 [ALRT] [scp.go:156] [ssh][10.10.107.124:22]transfer total size is: 0MB</span><br><span class="line">15:37:36 [INFO] [ssh.go:36] [ssh][10.10.107.124:22]exec cmd is : rm -rf /root/kube</span><br><span class="line">15:37:36 [DEBG] [print.go:20] ==&gt;SendPackage==&gt;KubeadmConfigInstall==&gt;InstallMaster0==&gt;JoinMasters==&gt;JoinNodes</span><br><span class="line">15:37:36 [INFO] [print.go:25] sealos install success.</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„äº‹é¡¹:</p>
<ul>
<li>(1)æ³¨æ„éœ€è¦ä¿®æ”¹å„ä¸ªèŠ‚ç‚¹çš„ hostname ä¸èƒ½ä¸€è‡´ï¼Œä¸ç„¶éƒ¨ç½²çš„æ—¶å€™ä¼šæŠ¥é”™<code>duplicate hostnames is not allowed</code>ã€‚</li>
</ul>

        </div>
        
  <hr>
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>

  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>

  <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ï¼Œè½¬ä¸ªå‘ã€‘(äººé—´äº”å¤§æƒ…)</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œè°¢è°¢ï¼ã€‚</p>

  <div>
    <img src="https://www.weiyigeek.top/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul>

  <div>
    <img src="https://www.weiyigeek.top/img/wechat-search.png" class="img-responsive" alt="æ‰«æfollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·"  width="328" height="149">
  </div>

  <hr>
  


  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-04-26T08:34:23.835Z" itemprop="dateUpdated">2022-04-26 16:34:23</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤.md" target="_blank" rel="noopener noreferrer">_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2020/4-25-469.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/4-25-469.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">ğŸ‘ é’Ÿæ„ä½œè€…</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/4-25-469.html&title=ã€Š2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/4-25-469.html&title=ã€Š2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/4-25-469.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/4-25-469.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/4-25-469.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/4-26-605.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">1.Goè¯­è¨€é¡¹ç›®æ€§èƒ½è°ƒä¼˜å®è·µ</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/4-25-600.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Goç¼–ç¨‹ä¹‹ç›¸å…³å‘½ä»¤å·¥å…·è®°å½•</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#0x00-å‰è¨€ç®€è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å‰è¨€ç®€è¿°</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#0x01-å®‰è£…éƒ¨ç½²"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 å®‰è£…éƒ¨ç½²</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0-åŸºç¡€å®‰è£…ç¯å¢ƒ"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">0.åŸºç¡€å®‰è£…ç¯å¢ƒ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-Docker-å®‰è£…é…ç½®"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">1.Docker å®‰è£…é…ç½®</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-K8s-åŸºç¡€ç¯å¢ƒ"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">2.K8s åŸºç¡€ç¯å¢ƒ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-master-ä¸»æ§åˆ¶èŠ‚ç‚¹é…ç½®"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">3.master - ä¸»æ§åˆ¶èŠ‚ç‚¹é…ç½®</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-node-å·¥ä½œèŠ‚ç‚¹é…ç½®"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">4.node - å·¥ä½œèŠ‚ç‚¹é…ç½®</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#0x02-æ‰‹åŠ¨å®‰è£…K8sé›†ç¾¤-åœ¨çº¿"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 æ‰‹åŠ¨å®‰è£…K8sé›†ç¾¤(åœ¨çº¿)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#0x03-æ‰‹åŠ¨å®‰è£…K8sé›†ç¾¤-ç¦»çº¿"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 æ‰‹åŠ¨å®‰è£…K8sé›†ç¾¤(ç¦»çº¿)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-åŠè‡ªåŠ¨ç¦»çº¿å®‰è£…"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">1.åŠè‡ªåŠ¨ç¦»çº¿å®‰è£…</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-ç¦»çº¿åŒ…å®‰è£…-sealos"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">2.ç¦»çº¿åŒ…å®‰è£…(sealos)</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

  <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        äººé—´è‡ªæœ‰äº”å¤§æƒ…ã€ç‚¹èµã€æŠ•å¸(èµèµ)ã€æ”¶è—ã€å…³æ³¨ï¼Œè½¬å‘ã€‘, è°¢è°¢çœ‹å‹æ”¯æŒ!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

  
 <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->

  <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">ä¸ªäººGithub</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">ä¸ªäººGitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">ä¸ªäººçŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘+äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved. ITå”¯ä¸€æå®¢ ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/4-25-469.html&title=ã€Š2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/4-25-469.html&title=ã€Š2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/4-25-469.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/4-25-469.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/4-25-469.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACKklEQVR42u3a0W6DMAwF0P7/T7PXTRP02kk3JTl5qihQDpM8x/brFa/r17r7Njn/+znP95m8MDAwlmVcj+v5QXPM3VW/jz+/jlsqBgbGAYxP3Do/Z4SNgYGBkZxTDdNJ4MbAwMAYD7j5Tz5vUP/5/wYGBsZSjCR0VoNsEqafr/rIXhwDA2NBRl51//vPH+lvYGBgLMW4imtW33D8SX7cEwMDY2tGHuB6yVx1QzvyPBgYGGcyksZk70HzAlx+BAMD4wRGtbmYNwOSon+12XkbcDEwMLZjVMvx+XjESMOyOuSBgYGxNyNvBvRSumpTs/ciMDAwTmDkxfekrJaE5mrzMvoLYGBgbMqobkrzVsHcZsCbqzAwMA5g5O3JnFelJscnlNswMDAWZPSStrwMlySg1ezuzcvFwMDYmlGFJbyRQlsvYcXAwNiPkf9kNSD2CnBNMAYGxtaMkQg2MlSRb4BfIwsDA+MARm/8IsfnyWUz28XAwNiUUb1RntLlW+LqiAYGBsYJjN42MmlS9sbLemNqGBgYJzN6AxPV7WjeOr19rRgYGEcyRoYtqt+O19AwMDB2ZVzF1du49oJs8iIwMDBOYMwaERsPwb00sYzBwMBYltFLDUdGxJLGQzmgY2BgHMDoBb5esC7ssOOGKAYGBkYvyOYBNx+8eFN0w8DAwIhHuPKwmzdHJ6eGGBgYCzKqzYBZI2JVJAYGxpmMoUmN1la2mvaNDJxhYGAszvgCu52yUHaOSVgAAAAASUVORK5CYII=" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 



  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 
     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>
