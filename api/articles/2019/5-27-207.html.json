{"title":"软Raid基础实现流程","slug":"系统运维/Linux/运维实践/磁盘存储/软Raid基础实现流程","date":"2019-05-27T05:34:30.000Z","updated":"2020-10-10T02:37:46.086Z","url":"2019/5-27-207.html","path":"api/articles/2019/5-27-207.html.json","covers":null,"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-前言\"><a href=\"#0x00-前言\" class=\"headerlink\" title=\"0x00 前言\"></a>0x00 前言</h4><p>RAID是英文Redundant Array of Independent Disks的缩写，中文简称为独立冗余磁盘阵列。RAID是把多块独立的物理硬盘按不同的方式组合起来形成一个硬盘组（逻辑硬盘），从而提供比单个硬盘更高的存储性能和提供数据备份技术组成磁盘阵列的不同方式称为RAID级别（RAID Levels），常用的RAID级别有以下几种: RAIDO，RAID1，RAID5，RAID6，RAID10等</p>\n<p>我们知道实现RAID技术有两种，一是采用硬件设备支持，二是采用采用软件系统支持;</p>\n<p>软raid比较依赖操作系统，所以他的劣势也显而易见，需要占用系统资源（主要是CPU资源）。<br>目前在Linux和windows下软raid都比较常见了:</p>\n<ul>\n<li>Linux 是通过mdadm实现</li>\n<li>windows则在win2003之后通过磁盘管理来实现</li>\n</ul>\n<p><em>P.S:</em> 需要强调的是生产环境下两块组raid的硬盘必须是同品牌同型号同容量的，否则极容易出现软raid失效的情况。</p>\n<hr>\n<h4 id=\"0x01-软Raid实践流程\"><a href=\"#0x01-软Raid实践流程\" class=\"headerlink\" title=\"0x01 软Raid实践流程\"></a>0x01 软Raid实践流程</h4><h5 id=\"1-基于CentOS7实现\"><a href=\"#1-基于CentOS7实现\" class=\"headerlink\" title=\"1.基于CentOS7实现\"></a>1.基于CentOS7实现</h5><p>环境准备:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">OS:CentOS7 (可以采用虚拟机实现)</span><br><span class=\"line\">Disk:三个以上并且大小相同的硬盘(xvdb xvdc xvdd)</span><br></pre></td></tr></table></figure></p>\n<p>实践流程:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#0.磁盘做好raid分区</span></span><br><span class=\"line\">$ lsblk <span class=\"comment\">#查看磁盘信息 (分别对三块盘进行)</span></span><br><span class=\"line\">$ fdisk /dev/xvdb</span><br><span class=\"line\">n  <span class=\"comment\">#创建分区</span></span><br><span class=\"line\">p  <span class=\"comment\">#构建主分区</span></span><br><span class=\"line\">1  <span class=\"comment\">#分区号</span></span><br><span class=\"line\">... <span class=\"comment\">#设置扇区起始位置</span></span><br><span class=\"line\">l <span class=\"comment\">#列出分区类型代码 找到 Raid hex为fd</span></span><br><span class=\"line\">t <span class=\"comment\">#修改分区类型</span></span><br><span class=\"line\">fd <span class=\"comment\">#修改分区类型为Linux Raid autodetect;</span></span><br><span class=\"line\">p <span class=\"comment\">#打印分区表信息</span></span><br><span class=\"line\">w <span class=\"comment\">#同步写入对磁盘的操作</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#1.并且检查是否安装了mdadm安装包</span></span><br><span class=\"line\"><span class=\"variable\">$rpm</span> -q mdadm</span><br><span class=\"line\">mdadm-3.3.2-7.el7.x86_64</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.创建磁盘阵列</span></span><br><span class=\"line\">mdadm -C -v /dev/md0 -l5 -n3 /dev/xvd[b,c,d]1 -x1 /dev/sde1</span><br><span class=\"line\"><span class=\"comment\"># -C,--create　 创建阵列;</span></span><br><span class=\"line\"><span class=\"comment\"># -a,--auto　　 同意创建设备，如不加此参数时必须先使用mknod 命令来创建一个RAID设备，不过推荐使用-a yes参数一次性创建;</span></span><br><span class=\"line\"><span class=\"comment\"># -l,--level　　　阵列模式，支持的阵列模式有 linear, raid0, raid1, raid4, raid5, raid6, raid10, multipath, faulty, container;</span></span><br><span class=\"line\"><span class=\"comment\"># -n, --raid-devices 阵列中活动磁盘的数目，该数目加上备用磁盘的数目应该等于阵列中总的磁盘数目;</span></span><br><span class=\"line\"><span class=\"comment\"># /dev/md0　阵列的设备名称，如果还有其他阵列组可以以此类推；</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3.查看同步进程（完成后不显示resync同步进度）</span></span><br><span class=\"line\">ct /proc/mdstat</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4.查看阵列组的状态.</span></span><br><span class=\"line\">mdadm -D /dev/md0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#5.创建md0的配置文件(mdadm运行时会自动检查/etc/mdadm.conf  文件并尝试自动装配，因此第一次配置raid后可以将信息导入到/etc/mdadm.conf中。)</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> DEVICE /dev/sd&#123;a,b,c&#125;1 &gt;&gt; /etc/mdadm.conf</span><br><span class=\"line\">mdadm -Evs &gt;&gt; /etc/mdadm.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#5.卸掉磁盘来模拟一块磁盘损坏 -f(--fail)</span></span><br><span class=\"line\">mdadm -f /dev/md0 /dev/xvdb1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#6.从阵列中移除/dev/sdb1 故障磁盘 -r(--remove)</span></span><br><span class=\"line\">mdadm /dev/md0 / -r /dev/xvdb1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#7.添加一块热备盘 /dev/sde1 -a(--add)</span></span><br><span class=\"line\">mdadm /dev/md0 --add /dev/xvde1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#8.格式化，挂载即可</span></span><br><span class=\"line\">mkfs.ext4 /dev/md0</span><br><span class=\"line\">mkfs.ext4  -E stride=16 -b 4096 /dev/md0 </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#9.停止阵列</span></span><br><span class=\"line\">mdadm -S /dev/md1</span><br></pre></td></tr></table></figure></p>\n<p>注意事项:</p>\n<ul>\n<li>如果硬盘容量大于2TB以上请使用parted工具进行分区设置,但是需要将磁盘格式由MBR改成GPT类型然后再使用mkpart命令进行分区，分区完成之后使用set设置分区flag为raid即可;</li>\n<li>软raid不能当启动设备这就是软raid比较鸡肋的地方了。</li>\n<li>在格式化时可以<code>指定-E选项下的stride参数指定条带是块大小的多少倍</code>，有在一定程度上提高软RAID性能，如块默认大小为4k，而条带大小默认为64k，则stride为16，这样就避免了RAID每次存取数据时都去计算条带大小</li>\n</ul>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Disk","path":"api/categories/Disk.json"}],"tags":[{"name":"Raid","path":"api/tags/Raid.json"}]}