<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ Harborä¹‹ä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å®è·µ|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Docker,Harbor">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/2018/1-1-1.html"  >
                <i class="icon icon-lg icon-mortar-board"></i>
                å­¦ä¹ ä¹‹è·¯
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>Harborä¹‹ä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å®è·µ</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">Harborä¹‹ä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å®è·µ</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-06-22T09:37:47.000Z" itemprop="datePublished" class="page-time">
  2020-06-22
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/kubernetes/">kubernetes</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/kubernetes/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/kubernetes/Containers/OperationTools/">OperationTools</a></li></ul></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
  <article id="post-è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Harbor/Harborä¹‹ä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å­¦ä¹ "
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">Harborä¹‹ä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å®è·µ</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-06-22 17:37:47" datetime="2020-06-22T09:37:47.000Z"  itemprop="datePublished">2020-06-22</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/kubernetes/">kubernetes</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/kubernetes/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/kubernetes/Containers/OperationTools/">OperationTools</a></li></ul></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h3 id="0x00-å‰è¨€ç®€è¿°"><a href="#0x00-å‰è¨€ç®€è¿°" class="headerlink" title="0x00 å‰è¨€ç®€è¿°"></a>0x00 å‰è¨€ç®€è¿°</h3><p><strong>Q: ä»€ä¹ˆæ˜¯Harbor?</strong></p>
<blockquote>
<p>ç­”: Harbor(Harbor)æ˜¯ä¸€ä¸ªå¼€æºå—ä¿¡ä»»çš„äº‘æœ¬åœ°æ³¨å†Œé¡¹ç›®(<code>cloud native registry project</code>)ï¼Œå®ƒå­˜å‚¨ã€ç­¾ç½²å’Œæ‰«æå†…å®¹ã€‚Harboré€šè¿‡æ·»åŠ ç”¨æˆ·é€šå¸¸éœ€è¦çš„åŠŸèƒ½ï¼ˆå¦‚å®‰å…¨ã€èº«ä»½å’Œç®¡ç†ï¼‰æ¥æ‰©å±•å¼€æº Docker åˆ†å‘ã€‚ä½¿æ³¨å†Œè¡¨æ›´æ¥è¿‘ç”Ÿæˆå’Œè¿è¡Œç¯å¢ƒå¯ä»¥æé«˜æ˜ åƒä¼ è¾“æ•ˆç‡ã€‚æ¸¯æ¹¾æ”¯æŒåœ¨æ³¨å†Œè¡¨ä¹‹é—´å¤åˆ¶æ˜ åƒï¼Œè¿˜æä¾›é«˜çº§å®‰å…¨åŠŸèƒ½ï¼Œå¦‚ç”¨æˆ·ç®¡ç†ã€è®¿é—®æ§åˆ¶å’Œæ´»åŠ¨å®¡æ ¸ã€‚<br>å…¶ç›®æ ‡æ˜¯æˆä¸º Kubernetes å€¼å¾—ä¿¡èµ–çš„äº‘åŸç”Ÿå­˜å‚¨åº“<br>å®˜ç½‘åœ°å€: <a href="https://goharbor.io/" target="_blank" rel="noopener">https://goharbor.io/</a><br>é¡¹ç›®åœ°å€: <a href="https://github.com/goharbor/harbor" target="_blank" rel="noopener">https://github.com/goharbor/harbor</a></p>
</blockquote>
<p><br></p>
<p>Q: ä¸ºå•¥è¦ä½¿ç”¨é€‰æ‹©Harbor?</p>
<blockquote>
<p>ç­”: HHarbor æ˜¯ä¸€ä¸ªäº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šæ¯•ä¸šé¡¹ç›®ï¼ŒHarboræ˜¯VMwareå…¬å¸å¼€æºçš„ä¼ä¸šçº§<code>Docker Registry</code>é¡¹ç›®å³ä¼ä¸šçº§ Docker ç§æœ‰ä»“åº“;å…¶ç›®æ ‡æ˜¯å¸®åŠ©ç”¨æˆ·è¿…é€Ÿæ­å»ºä¸€ä¸ªä¼ä¸šçº§çš„Docker RegistryæœåŠ¡ï¼Œå®ƒæ˜¯ä»¥Dockerå…¬å¸å¼€æºçš„registryä¸ºåŸºç¡€ï¼Œä½†å…¶æä¾›äº†å¯è§†åŒ–ç®¡ç†ç•Œé¢ä»¥åŠé«˜çº§å®‰å…¨åŠŸèƒ½ï¼Œå¦‚ç”¨æˆ·ç®¡ç†ã€è®¿é—®æ§åˆ¶å’Œæ´»åŠ¨å®¡æ ¸ã€‚</p>
</blockquote>
<p><strong>Harbor ç‰¹æ€§</strong></p>
<ul>
<li>(1) æœ¬åœ°Registry ï¼šé€šè¿‡åŒæ—¶æ”¯æŒå®¹å™¨æ˜ åƒå’ŒHelmå›¾è¡¨ï¼Œæ¸¯æ¹¾å¯å……å½“äº‘æœ¬æœºç¯å¢ƒï¼ˆå¦‚å®¹å™¨è¿è¡Œæ—¶å’Œä¸šåŠ¡æµç¨‹å¹³å°ï¼‰çš„æ³¨å†Œè¡¨ã€‚</li>
<li>(2) åŸºäºè§’è‰²æ§åˆ¶ï¼šç”¨æˆ·é€šè¿‡â€é¡¹ç›®â€è®¿é—®ä¸åŒçš„å­˜å‚¨åº“ï¼Œç”¨æˆ·å¯ä»¥å¯¹é¡¹ç›®ä¸‹çš„å›¾åƒæˆ– Helm å›¾è¡¨å…·æœ‰ä¸åŒçš„æƒé™ã€‚</li>
<li>(3) åŸºäºç­–ç•¥çš„å¤åˆ¶ï¼šå¯ä»¥ä½¿ç”¨ç­›é€‰å™¨ï¼ˆå­˜å‚¨åº“ã€æ ‡è®°å’Œæ ‡ç­¾ï¼‰åœ¨å¤šä¸ªæ³¨å†Œè¡¨å®ä¾‹ä¹‹é—´å¤åˆ¶ï¼ˆåŒæ­¥ï¼‰å›¾åƒå’Œå›¾è¡¨ã€‚å¦‚æœå¤åˆ¶é‡åˆ°ä»»ä½•é”™è¯¯ï¼Œæ¸¯æ¹¾ä¼šè‡ªåŠ¨é‡æ–°å¤åˆ¶ã€‚è¿™å¯ç”¨äºåœ¨æ··åˆå’Œå¤šäº‘æ–¹æ¡ˆä¸­å¸®åŠ©è´Ÿè½½å¹³è¡¡ã€å®ç°é«˜å¯ç”¨æ€§å’Œè¾…åŠ©å¤šæ•°æ®ä¸­å¿ƒéƒ¨ç½²ã€‚</li>
<li>(4) æ¼æ´æ‰«æï¼šæ¸¯æ¸¯å®šæœŸæ‰«æå›¾åƒæ˜¯å¦å­˜åœ¨æ¼æ´ï¼Œå¹¶è¿›è¡Œç­–ç•¥æ£€æŸ¥ï¼Œä»¥é˜²æ­¢éƒ¨ç½²æ˜“å—æ”»å‡»çš„å›¾åƒã€‚</li>
<li>(5) è‡³æ­¤LDAP/ADè®¤è¯æ–¹å¼: æ¸¯ä¸ç°æœ‰ä¼ä¸š LDAP/AD é›†æˆï¼Œç”¨äºç”¨æˆ·èº«ä»½éªŒè¯å’Œç®¡ç†ï¼Œå¹¶æ”¯æŒå°† LDAP ç»„å¯¼å…¥æ¸¯ï¼Œç„¶åå¯æˆäºˆç‰¹å®šé¡¹ç›®çš„æƒé™ã€‚</li>
<li>(6) OIDC æ”¯æŒï¼šæ¸¯æ¹¾åˆ©ç”¨ OpenID è¿æ¥ ï¼ˆOIDCï¼‰ æ¥éªŒè¯ç”±å¤–éƒ¨æˆæƒæœåŠ¡å™¨æˆ–èº«ä»½æä¾›å•†éªŒè¯çš„ç”¨æˆ·çš„èº«ä»½ã€‚å¯ä»¥å¯ç”¨å•ç‚¹ç™»å½•ä»¥ç™»å½•åˆ°æ¸¯å£é—¨æˆ·ã€‚</li>
<li>(7) å›¾åƒåˆ é™¤å’Œåƒåœ¾å›æ”¶ï¼šç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥è¿è¡Œåƒåœ¾å›æ”¶ä½œä¸šï¼Œä»¥ä¾¿å¯ä»¥åˆ é™¤å›¾åƒï¼ˆæ‚¬ç©ºæ¸…å•å’Œæœªå¼•ç”¨çš„ Blobï¼‰ï¼Œå¹¶å¯ä»¥å®šæœŸé‡Šæ”¾å…¶ç©ºé—´ã€‚</li>
<li>(8) ç­¾åè®¤è¯: æ”¯æŒä½¿ç”¨ Docker å†…å®¹ä¿¡ä»»ï¼ˆåˆ©ç”¨å…¬è¯ï¼‰å¯¹å®¹å™¨æ˜ åƒè¿›è¡Œç­¾åï¼Œä»¥ä¿è¯çœŸå®æ€§å’Œæ¥æºæ€§ã€‚åœ¨é™„åŠ ä¸­ï¼Œè¿˜å¯ä»¥æ¿€æ´»é˜»æ­¢æœªç­¾åæ˜ åƒéƒ¨ç½²çš„ç­–ç•¥ã€‚</li>
<li>(9) å›¾å½¢åŒ–UIç•Œé¢ç®¡ç†: ç”¨æˆ·å¯ä»¥è½»æ¾åœ°æµè§ˆã€æœç´¢å­˜å‚¨åº“å’Œç®¡ç†é¡¹ç›®å¹¶ä¸”æ”¯æŒä¸­æ–‡åŸç”Ÿã€‚</li>
<li>(10) è½»æ¾éƒ¨ç½²: Harboræä¾›äº†onlineã€offlineå®‰è£…ï¼ŒHarborçš„æ¯ä¸ªç»„ä»¶éƒ½æ˜¯ä»¥Dockerå®¹å™¨çš„å½¢å¼æ„å»ºçš„ï¼Œä½¿ç”¨Docker-Composeæ¥å¯¹å®ƒè¿›è¡Œéƒ¨ç½²;</li>
<li>(11) æ—¥å¿—å®¡æ ¸(Auditlogging): é€šè¿‡æ—¥å¿—è·Ÿè¸ªå­˜å‚¨åº“çš„æ‰€æœ‰æ“ä½œã€‚</li>
<li>(12) RESTful API: æä¾› RESTful API ä»¥æ–¹ä¾¿ç®¡ç†æ“ä½œï¼Œå¹¶ä¸”æ˜“äºç”¨äºä¸å¤–éƒ¨ç³»ç»Ÿé›†æˆ</li>
</ul>
<p><br/></p>
<p><strong>Harbor ç»„æˆ</strong><br>æè¿°: ç”¨äºéƒ¨ ç½²Harbor çš„ Docker Composeæ¨¡æ¿ä½äº /Deployer/docker-compose.ymlï¼Œç”±5ä¸ªå®¹å™¨ç»„æˆï¼Œè¿™å‡ ä¸ªå®¹å™¨é€šè¿‡Docker linkçš„å½¢å¼è¿æ¥åœ¨ä¸€èµ·ï¼Œåœ¨å®¹å™¨ä¹‹é—´é€šè¿‡å®¹å™¨åå­—äº’ç›¸è®¿é—®ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¾èµ–é•œåƒ</span></span><br><span class="line">Loaded image: goharbor/harbor-db:v2.4.1</span><br><span class="line">Loaded image: goharbor/redis-photon:v2.4.1</span><br><span class="line">Loaded image: goharbor/notary-signer-photon:v2.4.1</span><br><span class="line">Loaded image: goharbor/clair-photon:v2.4.1</span><br><span class="line">Loaded image: goharbor/clair-adapter-photon:v2.4.1</span><br><span class="line">Loaded image: goharbor/harbor-core:v2.4.1</span><br><span class="line">Loaded image: goharbor/harbor-portal:v2.4.1</span><br><span class="line">Loaded image: goharbor/harbor-log:v2.4.1</span><br><span class="line">Loaded image: goharbor/nginx-photon:v2.4.1</span><br><span class="line">Loaded image: goharbor/prepare:v2.4.1</span><br><span class="line">Loaded image: goharbor/harbor-registryctl:v2.4.1</span><br><span class="line">Loaded image: goharbor/notary-server-photon:v2.4.1</span><br><span class="line">Loaded image: goharbor/trivy-adapter-photon:v2.4.1</span><br><span class="line">Loaded image: goharbor/harbor-jobservice:v2.4.1</span><br><span class="line">Loaded image: goharbor/chartmuseum-photon:v2.4.1</span><br><span class="line">Loaded image: goharbor/registry-photon:v2.4.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…é…ç½®æ–‡ä»¶</span></span><br><span class="line">~/harbor/common/config$ tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ core</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ app.conf</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ certificates</span><br><span class="line">â”‚Â Â  â””â”€â”€ env</span><br><span class="line">â”œâ”€â”€ db</span><br><span class="line">â”‚Â Â  â””â”€â”€ env</span><br><span class="line">â”œâ”€â”€ jobservice</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ config.yml</span><br><span class="line">â”‚Â Â  â””â”€â”€ env</span><br><span class="line">â”œâ”€â”€ <span class="built_in">log</span></span><br><span class="line">â”‚Â Â  â”œâ”€â”€ logrotate.conf</span><br><span class="line">â”‚Â Â  â””â”€â”€ rsyslog_docker.conf</span><br><span class="line">â”œâ”€â”€ nginx</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ conf.d</span><br><span class="line">â”‚Â Â  â””â”€â”€ nginx.conf</span><br><span class="line">â”œâ”€â”€ portal</span><br><span class="line">â”‚Â Â  â””â”€â”€ nginx.conf</span><br><span class="line">â”œâ”€â”€ registry</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ config.yml</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ passwd</span><br><span class="line">â”‚Â Â  â””â”€â”€ root.crt</span><br><span class="line">â”œâ”€â”€ registryctl</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ config.yml</span><br><span class="line">â”‚Â Â  â””â”€â”€ env</span><br><span class="line">â””â”€â”€ shared</span><br><span class="line">    â””â”€â”€ trust-certificates</span><br></pre></td></tr></table></figure></p>
<ul>
<li>UIï¼šå³æ¶æ„ä¸­çš„ core services æ„æˆæ­¤å®¹å™¨çš„ä»£ç æ˜¯ Harbor é¡¹ç›®çš„ä¸»ä½“ã€‚</li>
<li>Proxyï¼šç”± Nginx æœåŠ¡å™¨æ„æˆçš„åå‘ä»£ç†ã€‚</li>
<li>Registryï¼šç”± Dockerå®˜æ–¹çš„å¼€æº registry é•œåƒæ„æˆçš„å®¹å™¨å®ä¾‹ã€‚</li>
<li>Postgresqlï¼šç”±å®˜æ–¹ POSTGRESQL é•œåƒæ„æˆçš„æ•°æ®åº“å®¹å™¨ã€‚</li>
<li>Redis : ç”±å®˜æ–¹ Redis é•œåƒæ„æˆçš„ç¼“å­˜æ•°æ®åº“å®¹å™¨ã€‚</li>
<li>Logï¼šè¿è¡Œç€ rsyslogdçš„å®¹å™¨ï¼Œé€šè¿‡ log-driverçš„å½¢å¼æ”¶é›†å…¶ä»–å®¹å™¨çš„æ—¥å¿—</li>
</ul>
<p><br/></p>
<p><strong>Harborè®¤è¯è¿‡ç¨‹</strong></p>
<ul>
<li>aã€dockerdaemonä»dockerregistryæ‹‰å–é•œåƒã€‚</li>
<li>bã€å¦‚æœdockerregistryéœ€è¦è¿›è¡Œæˆæƒæ—¶ï¼Œregistryå°†ä¼šè¿”å›401 Unauthorizedå“åº”ï¼ŒåŒæ—¶åœ¨å“åº”ä¸­åŒ…å«äº†docker clientå¦‚ä½•è¿›è¡Œè®¤è¯çš„ä¿¡æ¯ã€‚</li>
<li>cã€dockerclientæ ¹æ®registryè¿”å›çš„ä¿¡æ¯ï¼Œå‘auth serverå‘é€è¯·æ±‚è·å–è®¤è¯tokenã€‚</li>
<li>dã€auth serveråˆ™æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡å®ç°å»éªŒè¯æäº¤çš„ç”¨æˆ·ä¿¡æ¯æ˜¯å¦å­˜ç¬¦åˆä¸šåŠ¡è¦æ±‚ã€‚</li>
<li>eã€ç”¨æˆ·æ•°æ®ä»“åº“è¿”å›ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯ã€‚</li>
<li>fã€auth serverå°†ä¼šæ ¹æ®æŸ¥è¯¢çš„ç”¨æˆ·ä¿¡æ¯ï¼Œç”Ÿæˆtokenä»¤ç‰Œï¼Œä»¥åŠå½“å‰ç”¨æˆ·æ‰€å…·æœ‰çš„ç›¸å…³æƒé™ä¿¡æ¯.ä¸Šè¿°å°±æ˜¯å®Œæ•´çš„æˆæƒè¿‡ç¨‹.å½“ç”¨æˆ·å®Œæˆä¸Šè¿°è¿‡ç¨‹ä»¥åä¾¿å¯ä»¥æ‰§è¡Œç›¸å…³çš„pull/pushæ“ä½œã€‚è®¤è¯ä¿¡æ¯ä¼šæ¯æ¬¡éƒ½å¸¦åœ¨è¯·æ±‚å¤´ä¸­</li>
</ul>
<p><br/></p>
<p><strong>Harborè®¤è¯æµç¨‹</strong></p>
<ul>
<li>aã€é¦–å…ˆï¼Œè¯·æ±‚è¢«ä»£ç†å®¹å™¨ç›‘å¬æ‹¦æˆªï¼Œå¹¶è·³è½¬åˆ°æŒ‡å®šçš„è®¤è¯æœåŠ¡å™¨ã€‚</li>
<li>bã€ å¦‚æœè®¤è¯æœåŠ¡å™¨é…ç½®äº†æƒé™è®¤è¯ï¼Œåˆ™ä¼šè¿”å›401ã€‚é€šçŸ¥dockerclientåœ¨ç‰¹å®šçš„è¯·æ±‚ä¸­éœ€è¦å¸¦ä¸Šä¸€ä¸ªåˆæ³•çš„</li>
<li>tokenã€‚è€Œè®¤è¯çš„é€»è¾‘åœ°å€åˆ™æŒ‡å‘æ¶æ„å›¾ä¸­çš„core servicesã€‚</li>
<li>cã€ å½“dockerclientæ¥å—åˆ°é”™è¯¯codeã€‚clientå°±ä¼šå‘é€è®¤è¯è¯·æ±‚(å¸¦æœ‰ç”¨æˆ·åå’Œå¯†ç )åˆ°coreservicesè¿›è¡Œbasic</li>
<li>authè®¤è¯ã€‚</li>
<li>dã€ å½“Cçš„è¯·æ±‚å‘é€ç»™ngnixä»¥åï¼Œngnixä¼šæ ¹æ®é…ç½®çš„è®¤è¯åœ°å€å°†å¸¦æœ‰ç”¨æˆ·åå’Œå¯†ç çš„è¯·æ±‚å‘é€åˆ°core</li>
<li>serivcesã€‚</li>
<li>eã€ coreservicesè·å–ç”¨æˆ·åå’Œå¯†ç ä»¥åå¯¹ç”¨æˆ·ä¿¡æ¯è¿›è¡Œè®¤è¯(è‡ªå·±çš„æ•°æ®åº“æˆ–è€…ä»‹å…¥LDAPéƒ½å¯ä»¥)ã€‚æˆåŠŸä»¥</li>
<li>åï¼Œè¿”å›è®¤è¯æˆåŠŸçš„ä¿¡æ¯</li>
</ul>
<hr>
<h3 id="0x01-å®‰è£…é…ç½®"><a href="#0x01-å®‰è£…é…ç½®" class="headerlink" title="0x01 å®‰è£…é…ç½®"></a>0x01 å®‰è£…é…ç½®</h3><p>ç³»ç»Ÿè¦æ±‚ &amp; System requirements:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">On a Linux host: docker 17.06.0-ce+ and docker-compose 1.18.0+ and Python 2.7+</span><br></pre></td></tr></table></figure></p>
<p>å®‰è£…æ–¹å¼: Download binaries of <a href="https://github.com/goharbor/harbor/releases" target="_blank" rel="noopener">Harbor release</a></p>
<ul>
<li>(1) æºç ç¼–è¯‘å®‰è£…</li>
<li>(2) äºŒè¿›åˆ¶åœ¨çº¿æˆ–è€…ç¦»çº¿å®‰è£…(æ¨è-å®é™…ä¸Šè¿˜æ˜¯dockeré•œåƒå®‰è£…)</li>
</ul>
<p><strong>å®‰è£…ç¯å¢ƒå£°æ˜:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-52-generic x86_64)</span><br><span class="line">Docker 19.03.13</span><br><span class="line">Docker-Compose 1.27.4</span><br><span class="line">Harbor v2.4.1</span><br></pre></td></tr></table></figure></p>
<h4 id="1-æœ¬åœ°å®‰è£…"><a href="#1-æœ¬åœ°å®‰è£…" class="headerlink" title="(1) æœ¬åœ°å®‰è£…"></a>(1) æœ¬åœ°å®‰è£…</h4><p><strong>å®‰è£…æµç¨‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.æˆ‘ä¹Ÿå®‰è£…Dockerç¯å¢ƒæ­¤å¤„ä¸å†ç´¯è¿°dockerå®‰è£…è¿‡ç¨‹(è¯·è‡ªè¡Œdockerå®˜ç½‘æŸ¥é˜…)ï¼Œä¸‹é¢è¿›è¡Œå®‰è£…docker-compose</span></span><br><span class="line"><span class="comment"># æ–¹å¼1: https://github.com/docker/compose/releases/</span></span><br><span class="line">sudo wget https://github.com/docker/compose/releases/download/1.27.4/docker-compose-`uname -s`-`uname -m` -O /usr/bin/docker-compose</span><br><span class="line">sudo chmod a+x /usr/bin/docker-compose</span><br><span class="line"><span class="comment"># æ–¹å¼2: å»ºè®®ä½¿ç”¨é˜¿é‡Œäº‘çš„æº https://developer.aliyun.com/mirror/docker-ce </span></span><br><span class="line"><span class="comment"># apt install -y docker-compose</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ä¸‹è½½harbor-offlineå®‰è£…åŒ…: https://github.com/goharbor/harbor/releases</span></span><br><span class="line">wget https://github.com/goharbor/harbor/releases/download/v2.4.1/harbor-offline-installer-v2.4.1.tgz</span><br><span class="line">tar -zxf harbor-offline-installer-v2.4.1.tgz &amp;&amp; ls harbor/</span><br><span class="line">  <span class="comment"># common.sh  harbor.v2.4.1.tar.gz  harbor.yml.tmpl  install.sh  LICENSE  prepare</span></span><br><span class="line">docker load -i harbor.v2.4.1.tar.gz</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'192.168.1.2 harbor.weiyigeek.top'</span> &gt;&gt; /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.harbor.yml.tmplé…ç½®æ–‡ä»¶è¿›è¡ŒåŸºç¡€å®‰è£…é…ç½®å¹¶å°†ä¿®æ”¹çš„é…ç½®è¾“å…¥åˆ°harbor.yamlä¹‹ä¸­(æ³¨æ„è¿˜æœ‰è¿™ä¸€æ­¥)</span></span><br><span class="line">$ egrep -v <span class="string">"^#|^  #"</span> harbor.yml.tmpl  | tee harbor.yml</span><br><span class="line"><span class="comment"># ç›®æ ‡çš„ä¸»æœºåæˆ–è€…å®Œå…¨é™å®šåŸŸå(æ³¨æ„ä¸èƒ½æ˜¯127.0.0.1) </span></span><br><span class="line">hostname: harbor.weiyigeek.top</span><br><span class="line"></span><br><span class="line">db_passwordï¼šç”¨äºdb_authçš„MySQLæ•°æ®åº“çš„æ ¹å¯†ç ã€‚æ›´æ”¹æ­¤å¯†ç è¿›è¡Œä»»ä½•ç”Ÿäº§ç”¨é€”</span><br><span class="line">max_job_workersï¼šå¯¹äºæ¯ä¸ªæ˜ åƒå¤åˆ¶ä½œä¸šï¼Œ</span><br><span class="line"></span><br><span class="line">customize_crtï¼šï¼ˆonæˆ–offã€‚é»˜è®¤ä¸ºonï¼‰å½“æ­¤å±æ€§æ‰“å¼€æ—¶ï¼Œprepareè„šæœ¬å°†ä¸ºæ³¨å†Œè¡¨çš„ä»¤ç‰Œçš„ç”Ÿæˆ/éªŒè¯åˆ›å»ºç§é’¥å’Œæ ¹è¯ä¹¦</span><br><span class="line">ssl_certï¼šSSLè¯ä¹¦çš„è·¯å¾„ï¼Œä»…å½“åè®®è®¾ç½®ä¸ºhttpsæ—¶æ‰åº”ç”¨</span><br><span class="line">ssl_cert_keyï¼šSSLå¯†é’¥çš„è·¯å¾„ï¼Œä»…å½“åè®®è®¾ç½®ä¸ºhttpsæ—¶æ‰åº”ç”¨</span><br><span class="line">secretkey_pathï¼šç”¨äºåœ¨å¤åˆ¶ç­–ç•¥ä¸­åŠ å¯†æˆ–è§£å¯†è¿œç¨‹æ³¨å†Œè¡¨çš„å¯†ç çš„å¯†é’¥è·¯å¾„</span><br><span class="line"></span><br><span class="line"><span class="comment"># éSSLç«¯å£</span></span><br><span class="line">http:</span><br><span class="line">  port: 80</span><br><span class="line"><span class="comment"># SSLç«¯å£ä»¥åŠè¯ä¹¦é…ç½®</span></span><br><span class="line">https:</span><br><span class="line">  port: 443</span><br><span class="line">  certificate: /etc/harbor/pki/server.crt</span><br><span class="line">  private_key: /etc/harbor/pki/server.key</span><br><span class="line"><span class="comment"># harborç®¡ç†å¯†ç </span></span><br><span class="line">harbor_admin_password: Harbor12345</span><br><span class="line"><span class="comment"># harborçš„Postgreæ•°æ®å¯†ç </span></span><br><span class="line">database:</span><br><span class="line">  password: root123</span><br><span class="line">  max_idle_conns: 50</span><br><span class="line">  max_open_conns: 1000</span><br><span class="line"><span class="comment"># harboræ•°æ®å­˜å‚¨ç›®å½•</span></span><br><span class="line">data_volume: /data/harbor</span><br><span class="line"></span><br><span class="line">clair:</span><br><span class="line">  updaters_interval: 12</span><br><span class="line"></span><br><span class="line">trivy:</span><br><span class="line">  ignore_unfixed: <span class="literal">false</span></span><br><span class="line">  skip_update: <span class="literal">false</span></span><br><span class="line">  insecure: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é»˜è®¤å€¼ä¸º3 å¯¹äºæ¯ä¸ªæ˜ åƒå¤åˆ¶ä½œä¸šæœåŠ¡ä¸­çš„å¤åˆ¶å·¥ä½œäººå‘˜çš„æœ€å¤§æ•°é‡ã€‚ </span></span><br><span class="line"><span class="comment"># å·¥ä½œäººå‘˜å°†å­˜å‚¨åº“çš„æ‰€æœ‰æ ‡ç­¾åŒæ­¥åˆ°è¿œç¨‹ç›®æ ‡ï¼Œä½†æ˜¯ç”±äºæ¯ä¸ªå·¥ä½œäººå‘˜éƒ½ä¼šæ¶ˆè€—ä¸€å®šæ•°é‡çš„ç½‘ç»œ/ CPU/IOèµ„æºï¼Œè¯·æ ¹æ®ä¸»æœºçš„ç¡¬ä»¶èµ„æºä»”ç»†é€‰æ‹©è¯¥å±æ€§çš„å€¼ï¼›</span></span><br><span class="line">jobservice:</span><br><span class="line">  max_job_workers: 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># æé†’æœ€å¤§æ•°</span></span><br><span class="line">notification:</span><br><span class="line">  webhook_job_max_retry: 10</span><br><span class="line"></span><br><span class="line">chart:</span><br><span class="line">  absolute_url: disabled</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥å¿—è®°å½•è®¾ç½®</span></span><br><span class="line"><span class="built_in">log</span>:</span><br><span class="line">  level: info</span><br><span class="line">  <span class="built_in">local</span>:</span><br><span class="line">    <span class="comment"># åœ¨åˆ é™¤æ—¥å¿—æ–‡ä»¶ä¹‹å‰ï¼Œå°†log_rotate_countæ—‹è½¬å‡ æ¬¡ã€‚å¦‚æœcountä¸º0ï¼Œåˆ™åˆ é™¤æ—§ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯æ—‹è½¬ã€‚</span></span><br><span class="line">    rotate_count: 50</span><br><span class="line">    <span class="comment"># åªæœ‰å½“æ—¥å¿—æ–‡ä»¶çš„å¤§å°å¤§äºlog_rotate_sizeå­—èŠ‚æ—¶ï¼Œæ‰ä¼šå¯¹å…¶è¿›è¡Œæ—‹è½¬ã€‚å¦‚æœsizeåé¢è·Ÿç€kï¼Œåˆ™å‡è®¾sizeçš„å•ä½ä¸ºåƒå­—èŠ‚ã€‚</span></span><br><span class="line">    rotate_size: 200M</span><br><span class="line">    location: /var/<span class="built_in">log</span>/harbor</span><br><span class="line"></span><br><span class="line">_version: 2.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»£ç†è®¾ç½®</span></span><br><span class="line">proxy:</span><br><span class="line">  http_proxy:</span><br><span class="line">  https_proxy:</span><br><span class="line">  no_proxy:</span><br><span class="line">  components:</span><br><span class="line">    - core</span><br><span class="line">    - jobservice</span><br><span class="line">    - clair</span><br><span class="line">    - trivy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.åŸºç¡€ç¯å¢ƒä¸åˆ›å»º https è¯ä¹¦ä»¥åŠé…ç½®ç›¸å…³ç›®å½•æƒé™</span></span><br><span class="line">sudo mkdir -pv /data/harbor /etc/harbor/pki/</span><br><span class="line">openssl genrsa -des3 -out server.key 2048</span><br><span class="line">openssl req -new -key server.key -out server.csr</span><br><span class="line"><span class="comment"># Country Name (2 letter code) [AU]:CN</span></span><br><span class="line"><span class="comment"># State or Province Name (full name) [Some-State]:ChongQing</span></span><br><span class="line"><span class="comment"># Locality Name (eg, city) []:ChongQing</span></span><br><span class="line"><span class="comment"># Organization Name (eg, company) [Internet Widgits Pty Ltd]: weiyigeek</span></span><br><span class="line"><span class="comment"># Organizational Unit Name (eg, section) []: weiyigeek</span></span><br><span class="line"><span class="comment"># Common Name (e.g. server FQDN or YOUR name) []:harbor.weiyigeek.top</span></span><br><span class="line"><span class="comment"># Email Address []:master@weiyigeek.top</span></span><br><span class="line">cp server.key server.key.org &amp;&amp; openssl rsa -<span class="keyword">in</span> server.key.org -out server.key</span><br><span class="line">openssl x509 -req -days 365 -<span class="keyword">in</span> server.csr -signkey server.key -out server.crt</span><br><span class="line"><span class="comment"># Signature ok</span></span><br><span class="line"><span class="comment"># subject=C = CN, ST = ChongQing, L = ChongQing, O = weiyigeek, OU = weiyigeek.top, CN = harbor.weiyigeek.top, emailAddress = master@weiyigeek.top</span></span><br><span class="line"><span class="comment"># Getting Private key</span></span><br><span class="line">sudo cp server.key server.crt /etc/harbor/pki/</span><br><span class="line"><span class="comment"># å¯è¯»æƒé™å³å¯</span></span><br><span class="line">sudo chmod -R 644 /etc/harbor/pki/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.æ‰§è¡Œå®‰è£…è„šæœ¬install.sh</span></span><br><span class="line">$ sudo ./install.sh</span><br><span class="line">  [Step 0]: checking <span class="keyword">if</span> docker is installed ...</span><br><span class="line">  Note: docker version: 19.03.13</span><br><span class="line"></span><br><span class="line">  [Step 1]: checking docker-compose is installed ...</span><br><span class="line">  Note: docker-compose version: 1.25.0</span><br><span class="line"></span><br><span class="line">  [Step 2]: loading Harbor images ...</span><br><span class="line">    Loaded image: goharbor/harbor-db:v2.4.1</span><br><span class="line">    Loaded image: goharbor/redis-photon:v2.4.1</span><br><span class="line">    Loaded image: goharbor/notary-signer-photon:v2.4.1</span><br><span class="line">    Loaded image: goharbor/clair-photon:v2.4.1</span><br><span class="line">    Loaded image: goharbor/clair-adapter-photon:v2.4.1</span><br><span class="line">    Loaded image: goharbor/harbor-core:v2.4.1</span><br><span class="line">    Loaded image: goharbor/harbor-portal:v2.4.1</span><br><span class="line">    Loaded image: goharbor/harbor-log:v2.4.1</span><br><span class="line">    Loaded image: goharbor/nginx-photon:v2.4.1</span><br><span class="line">    Loaded image: goharbor/prepare:v2.4.1</span><br><span class="line">    Loaded image: goharbor/harbor-registryctl:v2.4.1</span><br><span class="line">    Loaded image: goharbor/notary-server-photon:v2.4.1</span><br><span class="line">    Loaded image: goharbor/trivy-adapter-photon:v2.4.1</span><br><span class="line">    Loaded image: goharbor/harbor-jobservice:v2.4.1</span><br><span class="line">    Loaded image: goharbor/chartmuseum-photon:v2.4.1</span><br><span class="line">    Loaded image: goharbor/registry-photon:v2.4.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  [Step 3]: preparing environment ...</span><br><span class="line"></span><br><span class="line">  [Step 4]: preparing harbor configs ...</span><br><span class="line">    prepare base dir is <span class="built_in">set</span> to /home/weiyigeek/harbor</span><br><span class="line">    Generated configuration file: /config/portal/nginx.conf</span><br><span class="line">    Generated configuration file: /config/<span class="built_in">log</span>/logrotate.conf</span><br><span class="line">    Generated configuration file: /config/<span class="built_in">log</span>/rsyslog_docker.conf</span><br><span class="line">    Generated configuration file: /config/nginx/nginx.conf</span><br><span class="line">    Generated configuration file: /config/core/env</span><br><span class="line">    Generated configuration file: /config/core/app.conf</span><br><span class="line">    Generated configuration file: /config/registry/config.yml</span><br><span class="line">    Generated configuration file: /config/registryctl/env</span><br><span class="line">    Generated configuration file: /config/registryctl/config.yml</span><br><span class="line">    Generated configuration file: /config/db/env</span><br><span class="line">    Generated configuration file: /config/jobservice/env</span><br><span class="line">    Generated configuration file: /config/jobservice/config.yml</span><br><span class="line">    Generated and saved secret to file: /data/secret/keys/secretkey</span><br><span class="line">    Successfully called func: create_root_cert</span><br><span class="line">    Generated configuration file: /compose_location/docker-compose.yml</span><br><span class="line">    Clean up the input dir</span><br><span class="line"></span><br><span class="line">  [Step 5]: starting Harbor ...</span><br><span class="line">  âœ” ----Harbor has been installed and started successfully.----  <span class="comment"># è¡¨ç¤ºå®‰è£…æˆåŠŸ</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="2-åŸºç¡€é…ç½®"><a href="#2-åŸºç¡€é…ç½®" class="headerlink" title="(2) åŸºç¡€é…ç½®"></a>(2) åŸºç¡€é…ç½®</h4><p><strong>1.åˆ©ç”¨å†…éƒ¨ DNS åŸŸåè§£æ <code>harbor.weiyigeek.top</code> é…ç½®å°†k8sé›†ç¾¤ä¸­çš„æœºå™¨DNSè®¾ç½®ä¸ºå†…éƒ¨DNSåœ°å€</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ ansible k8s -m shell -a <span class="string">"sudo sed -i 's#127.0.0.53#192.168.12.253#g' /etc/resolv.conf"</span></span><br><span class="line">~$ ansible k8s -m shell -a <span class="string">"ping harbor.weiyigeek.top -c 2"</span></span><br><span class="line"><span class="comment"># WeiyiGeek-224 | CHANGED | rc=0 &gt;&gt;</span></span><br><span class="line"><span class="comment"># PING harbor.weiyigeek.top (192.168.12.108) 56(84) bytes of data.</span></span><br><span class="line"><span class="comment"># 64 bytes from WeiyiGeek-108 (192.168.12.108): icmp_seq=1 ttl=64 time=0.227 ms</span></span><br><span class="line"><span class="comment"># 64 bytes from WeiyiGeek-108 (192.168.12.108): icmp_seq=2 ttl=64 time=0.167 ms</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="0x02-åŸºç¡€ä½¿ç”¨"><a href="#0x02-åŸºç¡€ä½¿ç”¨" class="headerlink" title="0x02 åŸºç¡€ä½¿ç”¨"></a>0x02 åŸºç¡€ä½¿ç”¨</h3><p><strong>Harbor è®¿é—®æµ‹è¯•</strong><br>Step 1.è®¿é—® harbor.weiyigeek.top ä½¿ç”¨Harborçš„é»˜è®¤è´¦å·å¯†ç ç™»é™†</p>
<blockquote>
<p>è´¦å·å¯†ç  : admin / Harbor12345</p>
</blockquote>
<figure class="image-box">
                <a rel=Harborä¹‹ä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å®è·µ href="https://img.weiyigeek.top/2020/2/20201106095852.png" target="_blank" title="WeiyiGeek.harbor-login" data-fancybox="images"><img src="https://img.weiyigeek.top/2020/2/20201106095852.png" alt="WeiyiGeek.harbor-login" title="" class=""></a>
                <p>WeiyiGeek.harbor-login</p>
            </figure>
<p>Step 2.ç”¨æˆ·åˆ›å»ºä¸é¡¹ç›®åˆ›å»º: ç³»ç»Ÿç®¡ç† -&gt; ç”¨æˆ·ç®¡ç†</p>
<p>Step 3.æ™®é€šç”¨æˆ·é¡¹ç›®åˆ›å»º:</p>
<blockquote>
<p>é¡¹ç›® -&gt; æ–°å»ºé¡¹ç›® -&gt; é¡¹ç›®åç§°ä¸è®¿é—®çº§åˆ«</p>
</blockquote>
<figure class="image-box">
                <a rel=Harborä¹‹ä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å®è·µ href="https://img.weiyigeek.top/2020/2/20201106102054.png" target="_blank" title="WeiyiGeek.é¡¹ç›®åˆ›å»º" data-fancybox="images"><img src="https://img.weiyigeek.top/2020/2/20201106102054.png" alt="WeiyiGeek.é¡¹ç›®åˆ›å»º" title="" class=""></a>
                <p>WeiyiGeek.é¡¹ç›®åˆ›å»º</p>
            </figure>
<p>PS: é¡¹ç›®å¦‚æœè®¾ç½®ä¸ºç§æœ‰åˆ™å¿…é¡»é‡‡ç”¨æ‰€å±ç”¨æˆ·è¿›è¡ŒéªŒè¯ç™»é™†åæ‰èƒ½è¿›è¡Œæ‹‰å–;</p>
<p>Step 4.ç®¡ç†å‘˜æ‰èƒ½å¯ä»¥è¿›è¡Œåƒåœ¾å›æ”¶:  ç³»ç»Ÿç®¡ç† -&gt; åƒåœ¾æ¸…ç†</p>
<p>Step 5.é•œåƒæ„å»ºä¸ä¸Šä¼ æµ‹è¯•<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.é…ç½®æœ¬åœ°dockerçš„insecure-registriesçš„Harborä»“åº“åœ°å€</span></span><br><span class="line"><span class="comment"># è‡ªç­¾è¯ä¹¦éœ€è¦å¿½ç•¥çš„ä¸å®‰å…¨è¯ä¹¦éªŒè¯ "insecure-registries"</span></span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [<span class="string">"https://xlx9erfu.mirror.aliyuncs.com"</span>],</span><br><span class="line">  <span class="string">"exec-opts"</span>: [<span class="string">"native.cgroupdriver=systemd"</span>],</span><br><span class="line">  <span class="string">"log-driver"</span>: <span class="string">"json-file"</span>,</span><br><span class="line">  <span class="string">"log-opts"</span>: &#123;</span><br><span class="line">    <span class="string">"max-size"</span>: <span class="string">"100m"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"insecure-registries"</span>: [<span class="string">"harbor.weiyigeek.top"</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload  &amp;&amp; sudo systemctl restart docker</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æŒ‡å®šHarborä»“åº“è®¤è¯</span></span><br><span class="line">docker login harbor.weiyigeek.top</span><br><span class="line">  <span class="comment"># Username: weiyigeek</span></span><br><span class="line">  <span class="comment"># Password:</span></span><br><span class="line">  <span class="comment"># WARNING! Your password will be stored unencrypted in /home/weiyigeek/.docker/config.json.Configure a credential helper to remove this warning. See</span></span><br><span class="line">  <span class="comment"># https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span></span><br><span class="line">  <span class="comment"># Login Succeeded</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æµ‹è¯•æœ¬åœ°é•œåƒä¸Šä¼ åˆ°haiborä¸­</span></span><br><span class="line"><span class="comment"># ä¸‹è½½é•œåƒ</span></span><br><span class="line">$ docker pull nginx</span><br><span class="line"><span class="comment"># é•œåƒé‡æ–°æ‰“æ ‡ç­¾</span></span><br><span class="line">$ docker tag nginx:latest harbor.weiyigeek.top/<span class="built_in">test</span>/nginx:v1.1</span><br><span class="line">$ docker images | grep <span class="string">"nginx"</span></span><br><span class="line">  <span class="comment"># harbor.weiyigeek.top/test/nginx                                  v1.1                c39a868aad02        12 hours ago        133MB</span></span><br><span class="line">  <span class="comment"># nginx                                                            latest              c39a868aad02        12 hours ago        133MB</span></span><br><span class="line"><span class="comment"># push é•œåƒåˆ°harbor</span></span><br><span class="line">$ docker push harbor.weiyigeek.top/<span class="built_in">test</span>/nginx:v1.1</span><br><span class="line">  <span class="comment"># The push refers to repository [harbor.weiyigeek.top/test/nginx]</span></span><br><span class="line">  <span class="comment"># 7b5417cae114: Pushed</span></span><br><span class="line">  <span class="comment"># aee208b6ccfb: Pushed</span></span><br><span class="line">  <span class="comment"># 2f57e21e4365: Pushed</span></span><br><span class="line">  <span class="comment"># 2baf69a23d7a: Pushed</span></span><br><span class="line">  <span class="comment"># d0fe97fa8b8c: Pushed</span></span><br><span class="line">  <span class="comment"># v1.1: digest: sha256:34f3f875e745861ff8a37552ed7eb4b673544d2c56c7cc58f9a9bec5b4b3530e size: 1362</span></span><br></pre></td></tr></table></figure></p>
<p>Step 6.åœ¨Harborä¸ŠæŸ¥çœ‹WeiyiGeekç”¨æˆ·ä¸Šä¼ çš„é•œåƒ</p>
<figure class="image-box">
                <a rel=Harborä¹‹ä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å®è·µ href="https://img.weiyigeek.top/2020/2/20201106204434.png" target="_blank" title="WeiyiGeek.Harbor" data-fancybox="images"><img src="https://img.weiyigeek.top/2020/2/20201106204434.png" alt="WeiyiGeek.Harbor" title="" class=""></a>
                <p>WeiyiGeek.Harbor</p>
            </figure>
<p>Step 7.åœ¨å…¶å®ƒèŠ‚ç‚¹æ‹‰å–æˆ‘ä»¬ä¸Šä¼ æµ‹è¯•çš„é•œåƒ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.åŒæ ·éœ€è¦ä¿®æ”¹Dockerçš„å®ˆæŠ¤è¿›ç¨‹</span></span><br><span class="line"><span class="string">"insecure-registries"</span>: [<span class="string">"harbor.weiyigeek.top"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æ‹‰å–é•œåƒæµ‹è¯•</span></span><br><span class="line">$ docker pull harbor.weiyigeek.top/<span class="built_in">test</span>/nginx:v1.1</span><br><span class="line">  <span class="comment"># v1.1: Pulling from test/nginx</span></span><br><span class="line">  <span class="comment"># bb79b6b2107f: Pull complete</span></span><br><span class="line">  <span class="comment"># 5a9f1c0027a7: Pull complete</span></span><br><span class="line">  <span class="comment"># b5c20b2b484f: Pull complete</span></span><br><span class="line">  <span class="comment"># 166a2418f7e8: Pull complete</span></span><br><span class="line">  <span class="comment"># 1966ea362d23: Pull complete</span></span><br><span class="line">  <span class="comment"># Digest: sha256:34f3f875e745861ff8a37552ed7eb4b673544d2c56c7cc58f9a9bec5b4b3530e</span></span><br><span class="line">  <span class="comment"># Status: Downloaded newer image for harbor.weiyigeek.top/test/nginx:v1.1</span></span><br><span class="line">  <span class="comment"># harbor.weiyigeek.top/test/nginx:v1.1</span></span><br><span class="line">$ docker images | grep <span class="string">"nginx"</span></span><br><span class="line">  <span class="comment"># harbor.weiyigeek.top/test/nginx                                               v1.1                c39a868aad02        19 hours ago        133MB</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="0x03-æ‰©å±•å®‰è£…"><a href="#0x03-æ‰©å±•å®‰è£…" class="headerlink" title="0x03 æ‰©å±•å®‰è£…"></a>0x03 æ‰©å±•å®‰è£…</h3><p><strong>æ·»åŠ æ”¯æŒChartä»“åº“æ‰©å±•</strong><br>æè¿°: å®‰è£…chartå›¾è¡¨ä»“åº“æ“ä½œæµç¨‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) å½“å‰harborç¯å¢ƒå·²å…·å¤‡</span></span><br><span class="line">~/harbor$ sudo docker-compose  ps</span><br><span class="line">  <span class="comment"># [sudo] password for weiyigeek:</span></span><br><span class="line">  <span class="comment">#       Name                     Command                  State                          Ports</span></span><br><span class="line">  <span class="comment"># ---------------------------------------------------------------------------------------------------------------</span></span><br><span class="line">  <span class="comment"># harbor-core         /harbor/entrypoint.sh            Up (healthy)</span></span><br><span class="line">  <span class="comment"># harbor-db           /docker-entrypoint.sh            Up (healthy)</span></span><br><span class="line">  <span class="comment"># harbor-jobservice   /harbor/entrypoint.sh            Up (healthy)</span></span><br><span class="line">  <span class="comment"># harbor-log          /bin/sh -c /usr/local/bin/ ...   Up (healthy)   127.0.0.1:1514-&gt;10514/tcp</span></span><br><span class="line">  <span class="comment"># harbor-portal       nginx -g daemon off;             Up (healthy)</span></span><br><span class="line">  <span class="comment"># nginx               nginx -g daemon off;             Up (healthy)   0.0.0.0:80-&gt;8080/tcp, 0.0.0.0:443-&gt;8443/tcp</span></span><br><span class="line">  <span class="comment"># redis               redis-server /etc/redis.conf     Up (healthy)</span></span><br><span class="line">  <span class="comment"># registry            /home/harbor/entrypoint.sh       Up (healthy)</span></span><br><span class="line">  <span class="comment"># registryctl         /home/harbor/start.sh            Up (healthy)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) å®‰è£…ç›®å½•</span></span><br><span class="line">~/harbor$ ls</span><br><span class="line">  <span class="comment"># common     docker-compose.yml  harbor.v2.4.1.tar.gz  harbor.yml.tmpl  LICENSE  server.crt  server.key</span></span><br><span class="line">  <span class="comment"># common.sh  harbor_install.log  harbor.yml            install.sh       prepare  server.csr  server.key.org</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) æ·»åŠ  chart å›¾è¡¨æ”¯æŒ</span></span><br><span class="line">~/harbor$ sudo ./install.sh --with-chartmuseum</span><br><span class="line">  <span class="comment"># [Step 0]: checking if docker is installed ...</span></span><br><span class="line">  <span class="comment"># Note: docker version: 19.03.13</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># [Step 1]: checking docker-compose is installed ...</span></span><br><span class="line">  <span class="comment"># Note: docker-compose version: 1.25.0</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># [Step 2]: loading Harbor images ...</span></span><br><span class="line">  <span class="comment"># Loaded image: goharbor/harbor-db:v2.4.1</span></span><br><span class="line">  <span class="comment"># .....</span></span><br><span class="line">  <span class="comment"># Loaded image: goharbor/registry-photon:v2.4.1</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># [Step 3]: preparing environment ...</span></span><br><span class="line">  <span class="comment"># [Step 4]: preparing harbor configs ...</span></span><br><span class="line">  <span class="comment"># prepare base dir is set to /home/weiyigeek/harbor</span></span><br><span class="line">  <span class="comment"># Clearing the configuration file: /config/db/env</span></span><br><span class="line">  <span class="comment"># ......</span></span><br><span class="line">  <span class="comment"># Clearing the configuration file: /config/registryctl/config.yml</span></span><br><span class="line">  <span class="comment"># Generated configuration file: /config/portal/nginx.conf</span></span><br><span class="line">  <span class="comment"># .....</span></span><br><span class="line">  <span class="comment"># Generated configuration file: /compose_location/docker-compose.yml</span></span><br><span class="line">  <span class="comment"># Clean up the input dir</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Note: stopping existing Harbor instance ...</span></span><br><span class="line">  <span class="comment"># Stopping harbor-jobservice ... done</span></span><br><span class="line">  <span class="comment"># ....</span></span><br><span class="line">  <span class="comment"># Removing network harbor_harbor</span></span><br><span class="line">  <span class="comment"># Removing network harbor_harbor-chartmuseum</span></span><br><span class="line">  <span class="comment"># WARNING: Network harbor_harbor-chartmuseum not found.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># [Step 5]: starting Harbor ...</span></span><br><span class="line">  <span class="comment"># Creating network "harbor_harbor" with the default driver</span></span><br><span class="line">  <span class="comment"># Creating network "harbor_harbor-chartmuseum" with the default driver</span></span><br><span class="line">  <span class="comment"># Creating harbor-log ... done</span></span><br><span class="line">  <span class="comment"># Creating registryctl   ... done</span></span><br><span class="line">  <span class="comment"># Creating chartmuseum   ... done</span></span><br><span class="line">  <span class="comment"># Creating registry      ... done</span></span><br><span class="line">  <span class="comment"># Creating harbor-db     ... done</span></span><br><span class="line">  <span class="comment"># Creating harbor-portal ... done</span></span><br><span class="line">  <span class="comment"># Creating redis         ... done</span></span><br><span class="line">  <span class="comment"># Creating harbor-core   ... done</span></span><br><span class="line">  <span class="comment"># Creating harbor-jobservice ... done</span></span><br><span class="line">  <span class="comment"># Creating nginx             ... done</span></span><br><span class="line">  <span class="comment"># âœ” ----Harbor has been installed and started successfully.----</span></span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=Harborä¹‹ä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å®è·µ href="https://img.weiyigeek.top/2020/2/20201126130800.png" target="_blank" title="WeiyiGeek.Helm Chartså·²å®‰è£…å®Œæˆ" data-fancybox="images"><img src="https://img.weiyigeek.top/2020/2/20201126130800.png" alt="WeiyiGeek.Helm Chartså·²å®‰è£…å®Œæˆ" title="" class=""></a>
                <p>WeiyiGeek.Helm Chartså·²å®‰è£…å®Œæˆ</p>
            </figure>
<p>æ¸©é¦¨æç¤º: å¦‚æœæƒ³å®‰è£…å…¬æ­£æœåŠ¡ notary ä»¥åŠæ¼æ´æ‰«æå™¨ trivy ï¼Œæˆ‘ä»¬åœ¨æ‰§è¡Œ<code>./install.sh</code>åæ·»åŠ å¦‚ä¸‹å‚æ•°ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ./install.sh --with-notary --with-trivy --with-chartmuseum</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="0x04-è¡¥å……è¯´æ˜"><a href="#0x04-è¡¥å……è¯´æ˜" class="headerlink" title="0x04 è¡¥å……è¯´æ˜"></a>0x04 è¡¥å……è¯´æ˜</h3><h4 id="1-Harborè¯ä¹¦åˆ°æœŸå¦‚ä½•è¿›è¡Œæ›´æ–°æ›¿æ¢"><a href="#1-Harborè¯ä¹¦åˆ°æœŸå¦‚ä½•è¿›è¡Œæ›´æ–°æ›¿æ¢" class="headerlink" title="1.Harborè¯ä¹¦åˆ°æœŸå¦‚ä½•è¿›è¡Œæ›´æ–°æ›¿æ¢?"></a>1.Harborè¯ä¹¦åˆ°æœŸå¦‚ä½•è¿›è¡Œæ›´æ–°æ›¿æ¢?</h4><p>æè¿°: å½“ Harbor è¯ä¹¦åˆ°æœŸåæˆ‘ä»¬éœ€è¦ç»­ç­¾è¯ä¹¦æˆ–è€…é‡æ–°ç”³è¯·è¯ä¹¦,å¹¶æ›¿æ¢æ‰é…ç½® harbor.yml æ–‡ä»¶ä¸­çš„ certificateã€private_key é…ç½®é¡¹ã€‚</p>
<p><strong>æ“ä½œæµç¨‹:</strong><br>æ­¥éª¤ 01.åˆ›å»ºCAå¹¶ç­¾å‘harborè¯ä¹¦<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.æ‰“å°configæ¨¡æ¿æ–‡ä»¶ä»è€Œè¿›è¡Œä¿®æ”¹å…¶ä¸­æœ‰ä¸¤ä¸ªé…ç½®.</span></span><br><span class="line">cfssl <span class="built_in">print</span>-defaults config &gt; ca-config.json</span><br><span class="line">vim ca-config.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"signing"</span>: &#123;</span><br><span class="line">    <span class="string">"default"</span>: &#123;</span><br><span class="line">        <span class="string">"expiry"</span>: <span class="string">"8760h"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"profiles"</span>: &#123;</span><br><span class="line">      <span class="string">"harbor"</span>: &#123;</span><br><span class="line">          <span class="string">"expiry"</span>: <span class="string">"87600h"</span>,</span><br><span class="line">          <span class="string">"usages"</span>: [</span><br><span class="line">              <span class="string">"signing"</span>,</span><br><span class="line">              <span class="string">"key encipherment"</span>,</span><br><span class="line">              <span class="string">"server auth"</span>,</span><br><span class="line">              <span class="string">"client auth"</span></span><br><span class="line">          ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cfssl <span class="built_in">print</span>-defaults csr &gt; ca-csr.json</span><br><span class="line">vim ca-csr.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"CN"</span>: <span class="string">"weiyigeek.top"</span>,</span><br><span class="line">  <span class="string">"key"</span>: &#123;</span><br><span class="line">    <span class="string">"algo"</span>: <span class="string">"rsa"</span>,</span><br><span class="line">    <span class="string">"size"</span>: 2048</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"names"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"C"</span>: <span class="string">"CN"</span>,</span><br><span class="line">      <span class="string">"L"</span>: <span class="string">"ChongQing"</span>,</span><br><span class="line">      <span class="string">"ST"</span>: <span class="string">"ChongQing"</span>,</span><br><span class="line">      <span class="string">"O"</span>: <span class="string">"weiyigeek"</span>,</span><br><span class="line">      <span class="string">"OU"</span>: <span class="string">"weiyigeek.top"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.å‡†å¤‡ä¸€ä»½harborè¯ä¹¦é…ç½®è¯·æ±‚æ–‡ä»¶ã€‚</span></span><br><span class="line">tee harbor-csr.json &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"CN"</span>: <span class="string">"harbor.weiyigeek.top"</span>,</span><br><span class="line">  <span class="string">"hosts"</span>: [</span><br><span class="line">    <span class="string">"127.0.0.1"</span>,</span><br><span class="line">    <span class="string">"192.168.12.108"</span>,</span><br><span class="line">    <span class="string">"harbor.weiyigeek.top"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"key"</span>: &#123;</span><br><span class="line">    <span class="string">"algo"</span>: <span class="string">"rsa"</span>,</span><br><span class="line">    <span class="string">"size"</span>: 2048</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"names"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"C"</span>: <span class="string">"CN"</span>,</span><br><span class="line">      <span class="string">"L"</span>: <span class="string">"ChongQing"</span>,</span><br><span class="line">      <span class="string">"ST"</span>: <span class="string">"ChongQing"</span>,</span><br><span class="line">      <span class="string">"O"</span>: <span class="string">"weiyigeek"</span>,</span><br><span class="line">      <span class="string">"OU"</span>: <span class="string">"weiyigeek.top"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.åˆ©ç”¨CAç­¾å‘ harbor ä»“åº“ä½¿ç”¨çš„æœåŠ¡ç«¯è¯ä¹¦ã€‚</span></span><br><span class="line">$ cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=harbor harbor-csr.json | cfssljson -bare harbor</span><br><span class="line">$ ls harbor*</span><br><span class="line">harbor.csr  harbor-csr.json  harbor-key.pem  harbor.pem</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.å°†ç”Ÿæˆè¯ä¹¦ä¸å¯†é’¥æ”¹ä¸ªåç¼€ã€‚</span></span><br><span class="line">cp harbor.pem /etc/harbor/pki/harbor.crt</span><br><span class="line">cp harbor-key.pem /etc/harbor/pki/harbor.key</span><br></pre></td></tr></table></figure><br><br/></p>
<p>æ­¥éª¤ 02.ä¿®æ”¹æ›¿æ¢å¯¹åº”çš„è¯ä¹¦æ–‡ä»¶ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.é…ç½®ä¿®æ”¹</span></span><br><span class="line">$ im harbor.yml</span><br><span class="line"><span class="comment"># éSSLç«¯å£</span></span><br><span class="line">http:</span><br><span class="line">  port: 80</span><br><span class="line"><span class="comment"># SSLç«¯å£ä»¥åŠè¯ä¹¦é…ç½®</span></span><br><span class="line">https:</span><br><span class="line">  port: 443</span><br><span class="line">  certificate: /etc/harbor/pki/harbor.crt</span><br><span class="line">  private_key: /etc/harbor/pki/harbor.key</span><br></pre></td></tr></table></figure><br><br/></p>
<p>æ­¥éª¤ 03.åˆ©ç”¨docker-composeåœæ­¢harborç›¸å…³å®¹å™¨,æ›´æ–°é¢„åŠ è½½é…ç½®åå†é‡å¯ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/harbor &amp;&amp; docker-compose down</span><br><span class="line">/opt/harbor<span class="comment"># ./prepare</span></span><br><span class="line">  prepare base dir is <span class="built_in">set</span> to /opt/harbor</span><br><span class="line">  Clearing the configuration file: /config/portal/nginx.conf</span><br><span class="line">  ........</span><br><span class="line">  Clearing the configuration file: /config/nginx/nginx.conf</span><br><span class="line">  Generated configuration file: /config/portal/nginx.conf</span><br><span class="line">  ........</span><br><span class="line">  Generated configuration file: /config/jobservice/config.yml</span><br><span class="line">  loaded secret from file: /data/secret/keys/secretkey</span><br><span class="line">  Generated configuration file: /compose_location/docker-compose.yml</span><br><span class="line">  Clean up the input dir</span><br><span class="line">/opt/harbor<span class="comment"># docker-compose up -d</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>æ­¥éª¤ 04.æµè§ˆå™¨è®¿é—®éªŒè¯æˆ–è€…åˆ©ç”¨cfsslå‘½ä»¤éªŒè¯é…ç½®çš„è¯ä¹¦, æ³¨æ„å¦‚æœæ²¡æœ‰é…ç½®å…¬ç½‘å’Œå†…éƒ¨è§£æ, è¯·åœ¨/etc/hostsæŒ‡å®šå¯¹åº”çš„IPåœ°å€ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cfssl certinfo -domain harbor.weiyigeek.top</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="2-å¦‚ä½•æ›´æ–°æ—§ç‰ˆæœ¬çš„Harboråˆ°æŒ‡å®šçš„æ–°ç‰ˆæœ¬"><a href="#2-å¦‚ä½•æ›´æ–°æ—§ç‰ˆæœ¬çš„Harboråˆ°æŒ‡å®šçš„æ–°ç‰ˆæœ¬" class="headerlink" title="2.å¦‚ä½•æ›´æ–°æ—§ç‰ˆæœ¬çš„Harboråˆ°æŒ‡å®šçš„æ–°ç‰ˆæœ¬?"></a>2.å¦‚ä½•æ›´æ–°æ—§ç‰ˆæœ¬çš„Harboråˆ°æŒ‡å®šçš„æ–°ç‰ˆæœ¬?</h4><p>æè¿°: å¦‚æœæ‚¨æ˜¯ä»ä»¥å‰ç‰ˆæœ¬çš„ Harbor å‡çº§ï¼Œæ‚¨å¯èƒ½éœ€è¦æ›´æ–°é…ç½®æ–‡ä»¶å¹¶è¿ç§»æ‚¨çš„æ•°æ®ä»¥é€‚åº”æ›´é«˜ç‰ˆæœ¬çš„æ•°æ®åº“æ¶æ„ã€‚</p>
<p>Harbor æ›´æ–°å‚è€ƒåœ°å€: <a href="https://goharbor.io/docs/2.4.0/administration/upgrade/" target="_blank" rel="noopener">https://goharbor.io/docs/2.4.0/administration/upgrade/</a></p>
<p>æ¸©é¦¨æç¤º: å¦‚æœè¦å‡çº§ä½¿ç”¨ Helm éƒ¨ç½²çš„ Harbor å®ä¾‹ï¼Œè¯·å‚é˜…å‡çº§ä½¿ç”¨ Helm éƒ¨ç½²çš„ Harbor ã€<a href="https://goharbor.io/docs/2.4.0/administration/upgrade/helm-upgrade/" target="_blank" rel="noopener">https://goharbor.io/docs/2.4.0/administration/upgrade/helm-upgrade/</a> ã€‘ã€‚</p>
<p><br/></p>
<p><strong>ç¯å¢ƒè¯´æ˜</strong><br>å½“å‰Harborç‰ˆæœ¬(v2.1.3)åŠå…¶æ—§çš„ç¦»çº¿å®‰è£…åŒ… <code>harbor-offline-installer-v2.1.3.tgz</code><br>æ›´æ–°Harborç‰ˆæœ¬(v2.4.1)åŠå…¶å½“å‰æ—¶é—´æœ€æ–°çš„ç¦»çº¿å®‰è£…åŒ… <code>harbor-offline-installer-v2.4.1.tgz</code></p>
<p>æ¸©é¦¨æç¤º: æˆªè‡³2022å¹´2æœˆ10æ—¥ï¼Œç›®å‰æœ€æ–°çš„Harborç‰ˆæœ¬ä¸º[v2.4.1], æˆ‘ä»¬å¯ä»¥è®¿é—®harborçš„releasesè·å–æœ€æ–°çš„Harbor(<a href="https://github.com/goharbor/harbor/releases" target="_blank" rel="noopener">https://github.com/goharbor/harbor/releases</a>)</p>
<p><br/></p>
<p><strong>å‡çº§å‰é‡è¦æç¤º</strong></p>
<ul>
<li>1.åœ¨ä»»ä½•æ•°æ®è¿ç§»ä¹‹å‰å¤‡ä»½Harborç›¸å…³æ•°æ®ï¼Œä¾‹å¦‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># harbor å®‰è£…é…ç½®ç›®å½•</span></span><br><span class="line">cp /op/harbor&#123;,.bak&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># harbor æ•°æ®åº“ç›®å½•</span></span><br><span class="line">cp -a /data/harbor&#123;,.bak&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>2.åœ¨v2.0ä¸­é¡¹ç›®çš„å…ƒæ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå½“å‡çº§åé¦–æ¬¡å¯åŠ¨ Harbor æ—¶ï¼Œå®ƒå°†éå†æ³¨å†Œè¡¨å­˜å‚¨ä¸­çš„é¡¹ç›®ä»¥å°†é¡¹ç›®çš„å…ƒæ•°æ®æå–åˆ°æ•°æ®åº“ä¸­, <code>å¦‚æœæ³¨å†Œè¡¨ä¸­å­˜åœ¨å¤§é‡é¡¹ç›®ï¼Œåˆ™æ­¤è¿‡ç¨‹å¯èƒ½éœ€è¦ç›¸å¯¹è¾ƒé•¿çš„æ—¶é—´</code>ï¼Œå°¤å…¶æ˜¯åœ¨å°†æ³¨å†Œè¡¨é…ç½®ä¸ºä½¿ç”¨å¤–éƒ¨å­˜å‚¨ï¼ˆå¦‚ S3ï¼‰æ—¶ã€‚ å¯ä»¥æŸ¥çœ‹ harbor-core registry æ—¥å¿—éªŒè¯æ˜¯å¦åœ¨è¿›è¡Œå®‰è£…ã€‚</p>
</li>
<li><p>3.åœ¨ v2.2 ä¹‹åClairæ¼æ´æ‰«æä»ªå°†è¢«ç§»é™¤, å»ºè®®åœ¨å‡çº§åä½¿ç”¨ Trivy ä½œä¸ºé»˜è®¤æ‰«æä»ªï¼Œæˆ–å°† Clair æ·»åŠ ä¸ºå¤–éƒ¨æ‰«æä»ªã€‚</p>
</li>
<li><p>4.åœ¨ v2.3 ä½¿ç”¨ PostgreSQL v13.2 , åœ¨å‡çº§è¿‡ç¨‹ä¸­ Harbor å°†åˆ é™¤æ—§çš„ PostgreSQL æ•°æ®ï¼Œå¹¶å°†å…¶è¿ç§»åˆ°å…¼å®¹çš„æ–°ç‰ˆæœ¬ PostgreSQL çš„æ–°ç›®æ ‡ä½ç½®, æ‰€ä»¥åœ¨å‡çº§åˆ°v2.3.0 å¿…é¡»è¿›è¡Œ PostgreSQL æ•°æ®å¤‡ä»½ã€‚</p>
</li>
</ul>
<p><br></p>
<p><strong>å¿«é€Ÿå‡çº§Harboræˆ–è€…è¿ç§»æ•°æ®</strong><br>æ­¥éª¤ 01.åœæ­¢ Harbor æ‰€æœ‰ç»„ä»¶è¿è¡Œå®ä¾‹ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æˆ‘çš„å®‰è£…ç›®å½•æ˜¯ /opt/harbor,ä½ å¯æ ¹æ®å®é™…æƒ…å†µè¿›å…¥å¯¹åº”çš„harborè§£å‹ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /opt/harbor &amp;&amp; docker-compose down</span><br></pre></td></tr></table></figure></p>
<p>æ­¥éª¤ 02.å¤‡ä»½ Harbor ç›¸å…³æ•°æ®(ç”Ÿäº§ç¯å¢ƒå¿…é¡»è¦ã€æµ‹è¯•ç¯å¢ƒçœ‹ä½ è‡ªå·±)ï¼Œä»¥ä¾¿åœ¨å¿…è¦æ—¶å¯ä»¥å›æ»šåˆ°å½“å‰ç‰ˆæœ¬ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤‡ä»½ harbor å®‰è£…é…ç½®ç›®å½•</span></span><br><span class="line">cp -a /opt/harbor&#123;,.bak&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤‡ä»½ harbor æ•°æ®åº“ç›®å½•</span></span><br><span class="line">cp -a /data/harbor&#123;,.bak&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ­¥éª¤ 03.ä»Harborå®˜æ–¹çš„Githubä¸­è·å–æœ€æ–°çš„Harborç‰ˆæœ¬åŒ…å¹¶å°†å…¶è§£å‹ç¼©(<a href="https://github.com/goharbor/harbor/releases)" target="_blank" rel="noopener">https://github.com/goharbor/harbor/releases)</a>, å›½å†…ç¯å¢ƒæ¨èé‡‡ç”¨ç¦»çº¿å®‰è£…åŒ…çš„æ–¹å¼è¿›è¡Œå®‰è£…éƒ¨ç½²ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åå°ä¸‹è½½+æ–­ç‚¹ç»­ä¼ </span></span><br><span class="line">wget -b -c https://github.com/goharbor/harbor/releases/download/v2.4.1/harbor-offline-installer-v2.4.1.tgz</span><br></pre></td></tr></table></figure></p>
<p>æ¸©é¦¨æç¤ºï¼šå»ºè®®é€šè¿‡è¿…é›·è¿›è¡Œä¸‹è½½ï¼Œå›½å†…åœ¨æœåŠ¡å™¨ä¸Šé‡‡ç”¨wgetç›´æ¥ä¸‹è½½å¤ªæ…¢äº†ã€‚</p>
<p>æ­¥éª¤ 04.è§£å‹ä¸‹è½½çš„è„±æœºå®‰è£…ç¨‹åºåŒ…åˆ°harborç›®å½•ä¹‹ä¸­,å¹¶å¯¼å…¥harborå¯¹åº”ç‰ˆæœ¬çš„ç›¸å…³ç»„ä»¶é•œåƒåˆ°dockeræœ¬åœ°æ³¨å†Œè¡¨ä¸­ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥ è„±æœºå®‰è£…ç¨‹åºåŒ… æ‰€åœ¨çš„ç›®å½•æ‰§è¡Œè§£å‹æ“ä½œ</span></span><br><span class="line"><span class="built_in">cd</span> /opt/ &amp;&amp; tar zxf harbor-offline-installer-v2.4.1.tgz</span><br><span class="line">ls /opt/harbor </span><br><span class="line">certs  common  common.sh  docker-compose.yml  harbor.v2.4.1.tar.gz  harbor.yml  harbor.yml.tmpl  install.sh  LICENSE  prepare</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥é•œåƒ &amp;&amp; æŸ¥çœ‹å¯¼å…¥çš„é•œåƒ</span></span><br><span class="line">docker load -i harbor/harbor.v2.4.1.tar.gz</span><br><span class="line">docker images --filter label=build-date=20211206</span><br><span class="line">  <span class="comment"># REPOSITORY                      TAG       IMAGE ID       CREATED       SIZE</span></span><br><span class="line">  <span class="comment"># goharbor/harbor-exporter        v2.4.1    0ee361b5454a   8 weeks ago   82.7MB</span></span><br><span class="line">  <span class="comment"># goharbor/chartmuseum-photon     v2.4.1    337a9d03b197   8 weeks ago   174MB</span></span><br><span class="line">  <span class="comment"># goharbor/redis-photon           v2.4.1    2bbe19b8cc5d   8 weeks ago   156MB</span></span><br><span class="line">  <span class="comment"># goharbor/trivy-adapter-photon   v2.4.1    d39fd42c93f0   8 weeks ago   151MB</span></span><br><span class="line">  <span class="comment"># goharbor/notary-server-photon   v2.4.1    e75c68b6638b   8 weeks ago   111MB</span></span><br><span class="line">  <span class="comment"># goharbor/notary-signer-photon   v2.4.1    17a627caf6dd   8 weeks ago   108MB</span></span><br><span class="line">  <span class="comment"># goharbor/harbor-registryctl     v2.4.1    bff3d2665456   8 weeks ago   137MB</span></span><br><span class="line">  <span class="comment"># goharbor/registry-photon        v2.4.1    b46e45c49d6f   8 weeks ago   79.2MB</span></span><br><span class="line">  <span class="comment"># goharbor/nginx-photon           v2.4.1    78aad8c8ef41   8 weeks ago   45.7MB</span></span><br><span class="line">  <span class="comment"># goharbor/harbor-log             v2.4.1    c86562daee64   8 weeks ago   160MB</span></span><br><span class="line">  <span class="comment"># goharbor/harbor-jobservice      v2.4.1    d8baceb5f1f6   8 weeks ago   220MB</span></span><br><span class="line">  <span class="comment"># goharbor/harbor-core            v2.4.1    80a4e3e60403   8 weeks ago   198MB</span></span><br><span class="line">  <span class="comment"># goharbor/harbor-portal          v2.4.1    1c9ed1cc3cb9   8 weeks ago   54.7MB</span></span><br><span class="line">  <span class="comment"># goharbor/harbor-db              v2.4.1    417d0a840247   8 weeks ago   222MB</span></span><br><span class="line">  <span class="comment"># goharbor/prepare                v2.4.1    e9158d34970b   8 weeks ago   257MB</span></span><br></pre></td></tr></table></figure></p>
<p>æ­¥éª¤ 05.å‡çº§è¿ç§»(migrate - è‹± [maÉªËˆÉ¡reÉªt] ï¼‰harboræŒ‡å®šç‰ˆæœ¬å¹¶ç”Ÿæˆæœ€æ–°harbor.yml é…ç½®æ–‡ä»¶<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm -v /:/hostfs goharbor/prepare:v2.4.1 migrate -i /opt/harbor/harbor.yml</span><br><span class="line">  <span class="comment"># migrating to version 2.1.0</span></span><br><span class="line">  <span class="comment"># migrating to version 2.2.0</span></span><br><span class="line">  <span class="comment"># migrating to version 2.3.0</span></span><br><span class="line">  <span class="comment"># migrating to version 2.4.0</span></span><br><span class="line">  <span class="comment"># Written new values to /opt/harbor/harbor.yml</span></span><br></pre></td></tr></table></figure></p>
<p>æ­¥éª¤ 06.æœ€æ–°æ‰§è¡Œå®‰è£…æ›´æ–°Harboræ“ä½œ,æ­¤å¤„æˆ‘å®‰è£… notary(å…¬è¯æœåŠ¡)ã€Trivy å’Œ chart(å›¾è¡¨å­˜å‚¨åº“)ç­‰æœåŠ¡<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">sudo ./install.sh --with-notary --with-trivy --with-chartmuseum</span><br><span class="line">  <span class="comment"># Creating harbor-log ... done</span></span><br><span class="line">  <span class="comment"># Creating chartmuseum   ... done</span></span><br><span class="line">  <span class="comment"># Creating registryctl   ... done</span></span><br><span class="line">  <span class="comment"># Creating harbor-db     ... done</span></span><br><span class="line">  <span class="comment"># Creating redis         ... done</span></span><br><span class="line">  <span class="comment"># Creating harbor-portal ... done</span></span><br><span class="line">  <span class="comment"># Creating registry      ... done</span></span><br><span class="line">  <span class="comment"># Creating notary-signer ... done</span></span><br><span class="line">  <span class="comment"># Creating harbor-core   ... done</span></span><br><span class="line">  <span class="comment"># Creating trivy-adapter ... done</span></span><br><span class="line">  <span class="comment"># Creating notary-server ... done</span></span><br><span class="line">  <span class="comment"># Creating harbor-jobservice ... done</span></span><br><span class="line">  <span class="comment"># Creating nginx             ... done</span></span><br><span class="line"><span class="comment"># å‡ºç°å¦‚ä¸‹æç¤ºè¡¨æ˜æ›´æ–°,å¦‚æœ‰é”™è¯¯è¯·æŸ¥çœ‹é”™è¯¯ä¿¡æ¯,å¹¶è¿›è¡ŒGoogleè§£å†³ã€‚</span></span><br><span class="line">âœ” ----Harbor has been installed and started successfully.----</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=Harborä¹‹ä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å®è·µ href="https://img.weiyigeek.top/2022/2/20220210205310.png" target="_blank" title="WeiyiGeek.å‡çº§HarboræœåŠ¡å™¨åˆ°v2.4.1" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/2/20220210205310.png" alt="WeiyiGeek.å‡çº§HarboræœåŠ¡å™¨åˆ°v2.4.1" title="" class=""></a>
                <p>WeiyiGeek.å‡çº§HarboræœåŠ¡å™¨åˆ°v2.4.1</p>
            </figure>
<p>è‡³æ­¤ï¼Œå®Œæˆäº†harborä»v2.1.3ç‰ˆæœ¬æ›´æ–°è¿ç§»åˆ°v2.4.1ç‰ˆæœ¬ã€‚</p>
<p><br></p>
<h4 id="3-Harborä»“åº“å¿˜è®°ç®¡ç†å‘˜å¯†ç å¦‚ä½•é‡ç½®"><a href="#3-Harborä»“åº“å¿˜è®°ç®¡ç†å‘˜å¯†ç å¦‚ä½•é‡ç½®" class="headerlink" title="3.Harborä»“åº“å¿˜è®°ç®¡ç†å‘˜å¯†ç å¦‚ä½•é‡ç½®?"></a>3.Harborä»“åº“å¿˜è®°ç®¡ç†å‘˜å¯†ç å¦‚ä½•é‡ç½®?</h4><p>æè¿°: åœ¨ Harbor åˆå§‹åŒ–å®‰è£…æ—¶æˆ‘ä»¬ä¼šåœ¨harbor.yamlæ–‡ä»¶ä¸­è®¾å®šadminç”¨æˆ·å¯†ç ï¼Œå½“æˆ‘ä»¬ç™»å½•æ›´æ”¹å…¶å¯†ç åå¿˜è®°è®¾å®šçš„å¯†ç ï¼Œå¦‚ä½•è¿›è¡Œé‡ç½®å¯†ç ?</p>
<p>ç‰ˆæœ¬ç¯å¢ƒè¯´æ˜: v2.4.x</p>
<p><br/></p>
<p><strong>æ“ä½œæµç¨‹:</strong></p>
<p>æ­¥éª¤01.é€šè¿‡<code>docker exec -it harbor-db /bin/bash</code>å‘½ä»¤è¿›å…¥harbor-dbå®¹å™¨å†…éƒ¨</p>
<p>æ­¥éª¤02.æ‰§è¡Œå¦‚ä¸‹postgresqlå‘½ä»¤è¡Œ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">psql -h postgresql -d postgres -U postgres        <span class="comment"># è¿™è¦è¾“å…¥é»˜è®¤å¯†ç ï¼šroot123</span></span><br><span class="line">psql -U postgres -d postgres -h 127.0.0.1 -p 5432 <span class="comment"># æˆ–è€…ç”¨è¿™ä¸ªå¯ä»¥ä¸è¾“å…¥å¯†ç </span></span><br></pre></td></tr></table></figure></p>
<p>æ­¥éª¤03.ç„¶ååˆ‡æ¢åˆ°harboræ‰€åœ¨çš„æ•°æ®åº“,æ‰§è¡Œ <code>\c registry</code> å‘½ä»¤</p>
<p>æ­¥éª¤04.æ‰§è¡ŒSQLè¯­å¥<code>select * from harbor_user;</code>æŸ¥çœ‹harbor_userè¡¨</p>
<p>æ­¥éª¤05.ä¾‹å¦‚ä¿®æ”¹adminçš„å¯†ç ï¼Œä¿®æ”¹ä¸ºåˆå§‹åŒ–å¯†ç  Harbor12345 ä¿®æ”¹å¥½äº†ä¹‹åå†å¯ä»¥ä»web uiä¸Šå†æ”¹ä¸€æ¬¡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚ä¸‹æ­¤æ–¹æ³•ä¸è¡Œ</span></span><br><span class="line">update harbor_user <span class="built_in">set</span> password=<span class="string">'a71a7d0df981a61cbb53a97ed8d78f3e'</span>,salt=<span class="string">'ah3fdh5b7yxepalg9z45bu8zb36sszmr'</span> <span class="built_in">where</span> username=<span class="string">'admin'</span>;    </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£ç¡®åšæ³•</span></span><br><span class="line">update harbor_user <span class="built_in">set</span> salt=<span class="string">''</span>, password=<span class="string">''</span> <span class="built_in">where</span> username=<span class="string">'admin'</span>;</span><br></pre></td></tr></table></figure>
<p>æ­¥éª¤06.æ‰§è¡Œ <code>\q</code> é€€å‡ºpostgresqlï¼Œå†æ‰§è¡Œ <code>exit</code> é€€å‡ºå®¹å™¨ã€‚</p>
<p>æ­¥éª¤07.é‡å¯harboræœåŠ¡ï¼Œä»¥é…ç½®ä¸­çš„é»˜è®¤å¯†ç è¿›è¡Œç™»é™†ã€‚</p>
<figure class="image-box">
                <a rel=Harborä¹‹ä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å®è·µ href="https://img.weiyigeek.top/2022/2/20220212152733.png" target="_blank" title="WeiyiGeek.é‡ç½®Harborä»“åº“ç®¡ç†å‘˜å¯†ç " data-fancybox="images"><img src="https://img.weiyigeek.top/2022/2/20220212152733.png" alt="WeiyiGeek.é‡ç½®Harborä»“åº“ç®¡ç†å‘˜å¯†ç " title="" class=""></a>
                <p>WeiyiGeek.é‡ç½®Harborä»“åº“ç®¡ç†å‘˜å¯†ç </p>
            </figure>
<p><br></p>
<h4 id="4-Harborä»“åº“è¿ç§»æç¤ºåè®®å¿…é¡»ä¸ºhttpsåœ¨å®‰è£…ç»„ä»¶æ—¶"><a href="#4-Harborä»“åº“è¿ç§»æç¤ºåè®®å¿…é¡»ä¸ºhttpsåœ¨å®‰è£…ç»„ä»¶æ—¶" class="headerlink" title="4.Harborä»“åº“è¿ç§»æç¤ºåè®®å¿…é¡»ä¸ºhttpsåœ¨å®‰è£…ç»„ä»¶æ—¶"></a>4.Harborä»“åº“è¿ç§»æç¤ºåè®®å¿…é¡»ä¸ºhttpsåœ¨å®‰è£…ç»„ä»¶æ—¶</h4><p>é”™è¯¯ä¿¡æ¯:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo ./install.sh --with-notary --with-trivy --with-chartmuseum</span><br><span class="line">prepare base dir is <span class="built_in">set</span> to /opt/harbor</span><br><span class="line">Error happened <span class="keyword">in</span> config validation...</span><br><span class="line">ERROR:root:Error: the protocol must be https when Harbor is deployed with Notary</span><br></pre></td></tr></table></figure><br>é”™è¯¯åŸå› : é”™è¯¯rooté”™è¯¯,å½“Harborä¸å…¬è¯äººä¸€èµ·éƒ¨ç½²æ—¶ï¼Œåè®®å¿…é¡»æ˜¯https<br>è§£å†³åŠæ³•: å¯ç”¨443ä»¥åŠè®¾ç½®è¯ä¹¦ï¼Œæˆ–è€…å–æ¶ˆå…¬è¯äººNotaryå®‰è£…å³å¯è§£å†³ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https related config</span></span><br><span class="line">https:</span><br><span class="line">  <span class="comment"># https port for harbor, default is 443</span></span><br><span class="line">  port: 443</span><br><span class="line">  <span class="comment"># The path of cert and key files for nginx</span></span><br><span class="line">  certificate: /etc/harbor/pki/server.crt</span><br><span class="line">  private_key: /etc/harbor/pki/server.key</span><br></pre></td></tr></table></figure></p>

        </div>
        <!-- Google å¹¿å‘Š -->
        
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
  

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2023-01-31T02:29:10.471Z" itemprop="dateUpdated">2023-01-31 10:29:10</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Harbor/Harborä¹‹ä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å­¦ä¹ .md" target="_blank" rel="noopener noreferrer">_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Harbor/Harborä¹‹ä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å­¦ä¹ .md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2020/6-22-510.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/6-22-510.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Harbor/" rel="tag">Harbor</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/6-22-510.html&title=ã€ŠHarborä¹‹ä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å®è·µã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/6-22-510.html&title=ã€ŠHarborä¹‹ä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å®è·µã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/6-22-510.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠHarborä¹‹ä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å®è·µã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/6-22-510.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/6-22-510.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/6-22-188.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Linuxç³»ç»Ÿè‡ªå®šä¹‰åˆ¶ä½œISOå®‰è£…é•œåƒ</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/6-17-565.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Linuxå†…æ ¸å‚æ•°ä½¿ç”¨ä¸ä¼˜åŒ–ä»‹ç»</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#0x00-å‰è¨€ç®€è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å‰è¨€ç®€è¿°</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#0x01-å®‰è£…é…ç½®"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 å®‰è£…é…ç½®</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-æœ¬åœ°å®‰è£…"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">(1) æœ¬åœ°å®‰è£…</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-åŸºç¡€é…ç½®"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">(2) åŸºç¡€é…ç½®</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#0x02-åŸºç¡€ä½¿ç”¨"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 åŸºç¡€ä½¿ç”¨</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#0x03-æ‰©å±•å®‰è£…"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 æ‰©å±•å®‰è£…</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#0x04-è¡¥å……è¯´æ˜"><span class="post-toc-number">5.</span> <span class="post-toc-text">0x04 è¡¥å……è¯´æ˜</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-Harborè¯ä¹¦åˆ°æœŸå¦‚ä½•è¿›è¡Œæ›´æ–°æ›¿æ¢"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">1.Harborè¯ä¹¦åˆ°æœŸå¦‚ä½•è¿›è¡Œæ›´æ–°æ›¿æ¢?</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-å¦‚ä½•æ›´æ–°æ—§ç‰ˆæœ¬çš„Harboråˆ°æŒ‡å®šçš„æ–°ç‰ˆæœ¬"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">2.å¦‚ä½•æ›´æ–°æ—§ç‰ˆæœ¬çš„Harboråˆ°æŒ‡å®šçš„æ–°ç‰ˆæœ¬?</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-Harborä»“åº“å¿˜è®°ç®¡ç†å‘˜å¯†ç å¦‚ä½•é‡ç½®"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">3.Harborä»“åº“å¿˜è®°ç®¡ç†å‘˜å¯†ç å¦‚ä½•é‡ç½®?</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-Harborä»“åº“è¿ç§»æç¤ºåè®®å¿…é¡»ä¸ºhttpsåœ¨å®‰è£…ç»„ä»¶æ—¶"><span class="post-toc-number">5.4.</span> <span class="post-toc-text">4.Harborä»“åº“è¿ç§»æç¤ºåè®®å¿…é¡»ä¸ºhttpsåœ¨å®‰è£…ç»„ä»¶æ—¶</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    


    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      

    <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
    
      <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½çœ‹å‹,æ¬¢è¿å…³æ³¨åšä¸»å¾®ä¿¡å…¬ä¼—å·å“Ÿ! â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘å³å¯å…³é—­ç»§ç»­æµè§ˆæ–‡ç« .<br>  <b style="color:red;"> æ¸©é¦¨æç¤º: æœªè§£é”çš„ç”¨æˆ·ä¸èƒ½ç²˜è´´å¤åˆ¶æ–‡ç« å†…å®¹å“Ÿ!</b> <br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
        
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/search-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2023 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>

<div id="go" class="waves-effect waves-light">
  <a href="javascript:;" id="goqrcode"> <span class="icon icon-lg icon-qrcode"></span> </a>
  <a href="javascript:;" id="gotop"> <span class="icon icon-lg icon-chevron-up"></span></a>
</div>





<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/6-22-510.html&title=ã€ŠHarborä¹‹ä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å®è·µã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/6-22-510.html&title=ã€ŠHarborä¹‹ä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å®è·µã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/6-22-510.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠHarborä¹‹ä¼ä¸šçº§ç§æœ‰é•œåƒå­˜å‚¨ä»“åº“å…¥é—¨å®è·µã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/6-22-510.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/6-22-510.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACL0lEQVR42u3aS24bMRAFQN3/0gqQVQLZk/eakpEhiytBgsmpWbTZn8cjXs/f68/Pr+v11+/2SdbjEwsDA+O2jGS7162vD7t+rOv9k1f2xekYGBgHMJIge/24CSmPmfmzYWBgYMyCcvt59vowMDAw8uvadWDNk94f/b+BgYFxQ8asiLb+zfUpH8nFMTAwbsiYNQZ+5vPH+xsYGBj/PeO5sFaaBG1g/ccOGBgYWzPawv3KgyYp66xJgIGBsTejTVzzhmV+0WwHNb54EgwMjAMYs+GJPN2dheOiMYCBgbE1o00gZ03H/LHahgEGBsY5jPz4tqm53gaoW5gYGBgHMFYC3yzdbUcr6skRDAyMmzNmLcn1sYz2UlhUDTEwMA5gJBG6Lcnl+w+TYQwMjK0Z683FPK2tZ0DK0zEwME5mzC5tK+W8WWEOAwNjV0YbBNtj1qnFRRADA2NTRj5skf/tShuyfRHfZuQYGBgbMdpifRuaVwJxkSpjYGBszXhXS7Idm1hvFdQYDAyMmzOuS/l55jhLj/MyXFR0w8DA2JqRB803HBm8groMh4GBsTWjLW8lCWqbjrbBfTgzgoGBcUPGs1xtISy/dLaDF399g4GBsTVjva6e/LpOwsDAwFgp37edh9kVMNoHAwPjAMYsyM4aAHW8T3gYGBgYyw2DWXO0uNtiYGBgBMevBOWV4QwMDIxzGHkzIE9WZ4Ma+RAGBgbGOYy2MdA2LPMm5dtmRjAwMPZh/ALSX5Nhpo2aWQAAAABJRU5ErkJggg==" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// ç«™ç‚¹è¿è¡Œæ—¶é—´
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + "å¤©" + RunHours + "æ—¶" + RunMinutes + "åˆ†" + RunSeconds + "ç§’";
  document.getElementById(id).innerHTML = "ç½‘ç«™å·²åœ¨é£é›¨ä¸­å‹‰å‹‰å¼ºå¼ºè¿è¡Œäº†ã€" + RunTime + "ã€‘";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
</body>
</html>