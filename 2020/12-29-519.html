<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>🌐 2.Jenkins进阶之流水线pipeline语法入门学习|WeiyiGeek Blog|唯一极客Geek-IT网络安全运维开发技术知识分享-博客站点</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Jenkins">
    <meta name="Description" content="WeiyiGeek-唯一极客博客站点,关注于网络安全运维,Web安全开发,IOT物联网安全开发,应用开发,分享技术学习知识与入坑解决,提升网络安全技术与自身技术能力,立志维护大众网络安全为己任,做一个对国家有用的人,为实现中华民族伟大复兴的中国梦不懈奋斗">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-头像">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                首页
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                文章分类
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                文章标签
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                文章归档
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                学习书籍
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                关于作者
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                站点导航
              </a>
            </li>
        
            <li class="">
              <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                公众账号
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                哔哩哔哩
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>2.Jenkins进阶之流水线pipeline语法入门学习</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="文章头部背景">
    <div class="container fade-scale">
        <h1 class="title">2.Jenkins进阶之流水线pipeline语法入门学习</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-12-29T04:34:30.000Z" itemprop="datePublished" class="page-time">
  2020-12-29
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevOps/">DevOps</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevOps/CI-CD/">CI-CD</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-系统运维/自动化运维/CI-CD/Jenkins/2.Jenkins进阶之流水线pipeline语法入门学习"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">2.Jenkins进阶之流水线pipeline语法入门学习</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-12-29 12:34:30" datetime="2020-12-29T04:34:30.000Z"  itemprop="datePublished">2020-12-29</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevOps/">DevOps</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevOps/CI-CD/">CI-CD</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="0x00-前言简述"><a href="#0x00-前言简述" class="headerlink" title="0x00 前言简述"></a>0x00 前言简述</h2><h3 id="Pipeline-介绍"><a href="#Pipeline-介绍" class="headerlink" title="Pipeline 介绍"></a>Pipeline 介绍</h3><p><strong>Q: 什么是 Pipeline？</strong></p>
<blockquote>
<p>答: Pipeline（流水线）是 Jenkins 2.0 的精髓它基于Groovy语言实现的一种DSL(领域特定语言)，简而言之就是一套运行于Jenkins上的工作流框架，用于描述整条流水线是如何进行的。<br>它将原本独立运行于单个或者多个节点的任务连接起来，实现单个任务难以完成的<code>复杂流程编排与可视化</code>。</p>
</blockquote>
<p><br></p>
<p><strong>Q: 什么是DSL?</strong></p>
<blockquote>
<p>答: DSL即 <code>(Domain Specific Language)</code> 领域专用语言，专门针对一个特定的问题领域，具有建模所需的语法和语义的语言。在与问题域相同的抽象层次对概念建模。<br>DSL 是 Jenkins 服务特有的一个语言，底层通过 Groovy 编程语言来实现。在使用过程中，可以很好的结合 Groovy。Jenkins Job DSL Plugin 提供了丰富的API，我们可以通过这些API实现对 Jenkinis 中View、Job 等管理。<br>Tips: Jenkins 内置了 Groovy 的引擎，我们可以通过 Groovy 编程语言在 DSL API 中添加逻辑编程。</p>
</blockquote>
<p><br></p>
<p><strong>Q: 什么是 Groovy 语言</strong><br>答: Groovy 是 Apache 旗下的一门基于 JVM 平台的动态/敏捷编程语言，在语言的设计上它吸纳了 Python、Ruby 和 Smalltalk 语言的优秀特性，语法非常简练和优美，开发效率也非常高（编程语言的开发效率和性能是相互矛盾的，越高级的编程语言性能越差，因为意味着更多底层的封装，不过开发效率会更高，需结合使用场景做取舍）</p>
<p><strong>Tips: PipeLine在Jenkins中的发展历史</strong></p>
<ul>
<li>1.Jenkins 1.x 支持 Pipeline ，只不过是通过页面手动配置流水线。</li>
<li>2.Jenkins 2.x 开始支持 pipeline as code ,可以通过代码来配置流水线了。</li>
</ul>
<p><br/></p>
<p><strong>Q: 为什么要使用Pipeline?</strong></p>
<blockquote>
<p>1.Pipeline是Jenkins2.X的最核心的特性，帮助Jenkins实现从<code>CI到CD</code>与<code>AutoDevOps</code>的转变;<br>2.Pipeline是一组插件它可以让Jenkins可以实现持续交付 Pipeline的落地和实施。<br>3.Pipeline提供了一组可扩展的工具，通过<code>Pipeline Domain Specific Language(DSL) syntax</code>可以达到 Pipeline as Code（Jenkinsfile存储在项目的源代码库）的目的。</p>
</blockquote>
<p>Tips: 流水线的内容包括执行编译、打包、测试、输出测试报告等步骤。<br>Tips: 持续交付<code>Pipeline (CD Pipeline)</code>是将软件从版本控制阶段到交付给用户或客户的完整过程的自动化表现, 软件的每一次更改（提交到源代码管理系统）都要经过一个复杂的过程才能被发布。</p>
<p><br></p>
<p><strong>Pipeline五大特性（优点）</strong></p>
<ul>
<li>代码: Pipeline以代码的形式实现，通常被检入源代码控制，使团队能够编辑、审查和迭代其CD流程。</li>
<li>可持续性：Jenklins重启或者中断后都不会影响Pipeline Job。</li>
<li>停顿：Pipeline可以选择停止并等待构建人员的输入或批准，然后再继续Pipeline运行。</li>
<li>多功能：Pipeline支持现实世界的复杂CD要求，包括fork/join子进程，循环和并行执行工作的能力</li>
<li>可扩展：Pipeline插件支持其<code>DSL</code>的自定义扩展以及与其他插件集成的多个选项。</li>
</ul>
<p>Tips: 它实现持续集成与部署、节省产品发布时间、优化部署策略、节省人力成本、以及自动化脚本复用等等;</p>
<p><br></p>
<p><strong>Q: 怎样安装Pipeline插件?</strong></p>
<blockquote>
<p>答: 熟话说工欲善其事必先利其器，第一步当然需要安装Jenkins使用Pipeline所需的插件;</p>
</blockquote>
<p>Jenkins pipeline 相关插件安装: 打开 Jenkins 找到 <code>【系统管理】-&gt;【插件管理】-&gt;【可选插件】</code> 然后在搜索框输入 <code>Pipeline</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Pipeline 命令行接口 杂项 代理启动器和控制器 构建触发器  2.6 	2 年 3 月 ago </span><br><span class="line"><span class="comment"># 说明：一套插件，让您编排自动化，简单或复杂。更多细节请参阅Jenkins的 Pipeline代码。</span></span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=2.Jenkins进阶之流水线pipeline语法入门学习 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210106230344.png" target="_blank" title="WeiyiGeek.Pipeline-Plug" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210106230344.png" alt="WeiyiGeek.Pipeline-Plug" title="" class=""></a>
                <p>WeiyiGeek.Pipeline-Plug</p>
            </figure></p>
<p><br></p>
<h3 id="Pipeline-基础知识"><a href="#Pipeline-基础知识" class="headerlink" title="Pipeline 基础知识"></a>Pipeline 基础知识</h3><p><strong>基础说明:</strong></p>
<blockquote>
<ul>
<li>Pipeline 脚本是由 Groovy 语言结合 DSL 语言实现的。</li>
<li>Pipeline 支持两种语法：<code>Declarative Pipeline (声明式 - 2.5 引入)</code> 和 <code>Scripted Pipeline (脚本式)</code>语法</li>
<li>Pipeline 也有两种创建方法：<ul>
<li>方式1、在 Jenkins 的 Web UI 界面中输入脚本；</li>
<li>方式2、通过创建一个 Jenkinsfile 脚本文件(<code>Groovy 语言结合 DSL 开发</code>)放入项目源码库中 (<code>推荐在 Jenkins 中直接从源代码控制(SCMD) 中直接载入 Jenkinsfile Pipeline</code>)</li>
</ul>
</li>
</ul>
</blockquote>
<p><br></p>
<p><strong>语法差异:</strong><br>描述: 最初创建 Jenkins Pipeline 时 Groovy 语言被选为基础。Jenkins长期以来一直提供嵌入式Groovy引擎，以为管理员和用户提供高级脚本功能。另外Jenkins Pipeline的实现者发现Groovy是构建现在称为”脚本 Pipelin” DSL的坚实基础。</p>
<p>由于它是功能齐全的编程环境，因此脚本化 Pipeline为Jenkins用户提供了极大的灵活性和可扩展性。Groovy学习曲线通常不是给定团队的所有成员所希望的，因此创建了声明式 Pipeline，以为编写Jenkins Pipeline提供更简单，更自以为是的语法。</p>
<p>两者基本上是下面的相同 Pipeline子系统。它们都是“ Pipeline作为代码”的持久实现。他们都可以使用内置在Pipeline中或由插件提供的步骤。两者都可以利用 共享库</p>
<p>但是它们的区别在于语法和灵活性。声明性限制使用更严格和预定义的结构为用户提供的功能，使其成为更简单的连续交付 Pipeline的理想选择。脚本化脚本提供的限制非常少，以至于对结构和语法的唯一限制往往是由Groovy本身定义的，而不是由任何特定于 Pipeline的系统定义的，因此，它成为高级用户和要求更复杂的用户的理想选择。顾名思义，声明性流水线鼓励使用声明性编程模型，而脚本 Pipeline 遵循更强制性的编程模型。</p>
<p><br></p>
<p><strong>Q: 选择<code>Declarative Pipeline</code>还是<code>Scripted Pipeline</code>?</strong></p>
<blockquote>
<p>答: 最开始<code>Pipeline plugin</code>仅支持<code>Scripted Pipeline</code>一种脚本类型,而 <code>Declarative Pipeline</code> 为Pipeline plugin在2.5版本之后新增的一种脚本类型与原先的<code>Scripted Pipeline</code>一样都可以用来编写脚本。</p>
<p>由于在我们使用BlueOcean流水线UI插件后，Declarative Pipeline 与 BlueOcean 脚本编辑器是可以兼容使用，<code>并且在eclarative Pipeline中，也是可以内嵌Scripted Pipeline代码的</code>，所以通常建议使用 <code>Declarative Pipeline</code> (<code>英 /dɪˈklærətɪv/</code>)的方式进行编写</p>
</blockquote>
<p><br></p>
<p><strong>Declarative pipeline和Scripted pipeline的比较?</strong></p>
<ul>
<li>1.共同点:  <ul>
<li>声明式和脚本式流水线都是 DSL 语言，用来描述软件交付流水线的一部分。</li>
<li>两者都能够使用pipeline内置的插件或者插件提供的step步骤部分。</li>
<li>两者都可以利用共享库扩展。</li>
</ul>
</li>
<li>2.区别: 两者不同之处在于语法和灵活性;<ul>
<li>Declarative pipeline 语法更严格 (<code>例如必须以 pipeline 关键词打头</code>)，有固定的组织结构但更容易生成代码段，所以它成为用户更理想的选择。</li>
<li>Scripted pipeline 语法更加灵活，因为Groovy本身只能对结构和语法进行限制，对于更复杂的pipeline来说，用户可以根据自己的业务进行灵活的实现和扩展。</li>
</ul>
</li>
</ul>
<p>Tips: 脚本式语法的确灵活、可扩展，但是也意味着更复杂。而声明式语法供更简单、更结构化（more opinionated）的语法 (<code>模块化的感觉</code>)。</p>
<p><br></p>
<h3 id="Pipeline-扩展共享库"><a href="#Pipeline-扩展共享库" class="headerlink" title="Pipeline 扩展共享库"></a>Pipeline 扩展共享库</h3><p>描述: 由于流水线被组织中越来越多的项目所采用，常见的模式很可能会出现在多个项目之间共享流水线, <code>共享流水线有助于减少冗余并保持代码 “DRY（Don’t Repeat Yourself）”</code>。</p>
<p><strong>Q: 如何定义共享库?</strong></p>
<blockquote>
<p>答: 我们将一些通用的代码或者代码包，封装定义为底层代码库，方便流水线创建。</p>
</blockquote>
<p>特定的目录结构:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(root)</span><br><span class="line">+- src                     <span class="comment"># Groovy source files</span></span><br><span class="line">|   +- org</span><br><span class="line">|     +- foo</span><br><span class="line">|       +- Bar.groovy      <span class="comment"># for org.foo.Bar class</span></span><br><span class="line">+- vars</span><br><span class="line">|   +- foo.groovy          <span class="comment"># for global 'foo' variable</span></span><br><span class="line">|   +- foo.txt             <span class="comment"># help for 'foo' variable</span></span><br><span class="line">+- resources               <span class="comment"># resource files (external libraries only)</span></span><br><span class="line">|   +- org</span><br><span class="line">|       +- foo</span><br><span class="line">|           +- bar.json    <span class="comment"># static helper data for org.foo.Bar</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>目录结构解析:</strong></p>
<ul>
<li>1、src 目录应该看起来像标准的 Java 源目录结构。当执行流水线时，该目录被添加到类路径下。</li>
<li>2、vars 目录定义可从流水线访问的全局变量的脚本。 每个 <em>.groovy 文件的基名应该是一个 Groovy (~ Java) 标识符, 通常是 驼峰命名法（camelCased）。 匹配 </em>.txt, 如果存在可以包含文档, 通过系统的配置标记格式化从处理 (所以可能是 HTML, Markdown 等，虽然 txt 扩展是必需的)。这些目录中的 Groovy 源文件 在脚本化流水线中的 “CPS transformation” 一样。</li>
<li>3、resources 目录允许从外部库中使用 libraryResource 步骤来加载有关的非 Groovy 文件。 目前，内部库不支持该特性。</li>
<li>4、根目录下的其他目录被保留下来以便于将来的增强。</li>
</ul>
<p><br/></p>
<p><strong>Q: 如何将将共享库设置为全局共享库？</strong></p>
<blockquote>
<p>描述: 在Jenkins 管理页面中的 “Configure System” 页面中的 “Global Pipeline Libraries” 中设置全局共享库。</p>
</blockquote>
<p><strong>Q: 如何使用封装的代码库</strong></p>
<blockquote>
<p>答: Jenkinsfile 文件中需要使用 @Library 注解，指定库的名字。另外关于代码库的动态加载、版本管理和检索方式等，请见官网。</p>
</blockquote>
<p><strong>Q: 如何编写自己的 Jenkins 共享库，共享库中的变量作用域?</strong></p>
<blockquote>
<p>答: 其他关于写库的访问步骤、定义全局变量 请见官网。</p>
</blockquote>
<p><br></p>
<h3 id="BlueOcean-介绍"><a href="#BlueOcean-介绍" class="headerlink" title="BlueOcean 介绍"></a>BlueOcean 介绍</h3><p><strong>Q: 什么是BlueOcean?</strong></p>
<blockquote>
<p>A: BlueOcean 重新考虑了 Jenkins 的用户体验而重新设置UI界面,从而更加直观的展现Pipeline各流程执行情况;<br>BlueOcean由Jenkins Pipeline设计，但仍然兼容自由式工作，减少了团队成员的混乱，增加了清晰度。</p>
</blockquote>
<p><strong>Q: 为啥要使用BlueOcean?</strong></p>
<blockquote>
<p>连续交付（CD）Pipeline的复杂可视化，允许快速和直观地了解Pipeline的状态。<br>Pipeline编辑器通过引导用户直观和可视化的过程创建Pipeline，使创建Pipeline平易近人。<br>个性化，以适应团队每个成员的角色需求。<br>需要干预和/或出现问题时确定精度。BlueOcean显示了Pipeline需要注意的地方，便于异常处理和提高生产率。<br>用于分支和拉取请求的本地集成可以在GitHub和Bitbucket中与其他人进行代码协作时最大限度提高开发人员的生产力。</p>
</blockquote>
<p><strong>Q: 如何安装BlueOcean?</strong></p>
<blockquote>
<p>A: 同样是在插件中搜索 ”Blue Ocean“ 下载安装即可<br>Blue Ocean - 外部工具集成 用户界面 - BlueOcean Aggregator  - 1.24.3     2 月 5 天 ago </p>
</blockquote>
<hr>
<h2 id="0x01-Pipeline-Syntax"><a href="#0x01-Pipeline-Syntax" class="headerlink" title="0x01 Pipeline Syntax"></a>0x01 Pipeline Syntax</h2><h3 id="0-Groovy-Basic-Syntax"><a href="#0-Groovy-Basic-Syntax" class="headerlink" title="(0) Groovy Basic Syntax"></a>(0) Groovy Basic Syntax</h3><p>描述: 我们前面说过不管是声明式还是脚本式都是基于Groovy语言,所以学习 Groovy 基础知识是必须的。</p>
<ul>
<li>1.虽然Groovy同时支持静态类型和动态类型，但是在定义变量时，在Groovy中我们习惯使用def关键字<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def x&#x3D;&quot;abc&quot;</span><br><span class="line">def y&#x3D;1</span><br></pre></td></tr></table></figure></li>
<li><p>2.不像 Java语法语句,Groovy语句最后的分号不是必需的。</p>
</li>
<li><p>3.Groovy中的方法调用可以省略括号，比如System.out.println “Hello world”。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.println x</span><br><span class="line">println t</span><br></pre></td></tr></table></figure>
</li>
<li><p>4.支持单引号、双引号。双引号支持插值(变量)，单引号不支持。</p>
</li>
<li><p>5.支持三引号。三引号分为三单引号和三双引号。它们都支持换行，区别在于只有三双引号支持插值(变量)。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def var = <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">This is Variable!</span></span><br><span class="line"><span class="string">&lt;br&gt;</span></span><br><span class="line"><span class="string">Test defiend</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>6.支持函数。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> getSecure(String Ticket_Token) &#123;</span><br><span class="line">  <span class="keyword">def</span> token = <span class="string">"Ticket Token is "</span> + Ticket_Token</span><br><span class="line">  <span class="keyword">return</span> token</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">println getSecure(<span class="string">"weiyigeek"</span>)  <span class="comment">//Ticket Token is weiyigeek</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>7.支持闭包。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// # 闭包的定义方法：</span></span><br><span class="line"><span class="keyword">def</span> codeBlock = &#123;print <span class="string">"hello world!"</span>&#125;</span><br><span class="line"><span class="comment">// codeBlock() //</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// # 闭包的另类用法:</span></span><br><span class="line"><span class="comment">// 定义一个stage函数</span></span><br><span class="line"><span class="keyword">def</span> stage(String name, closue) &#123;</span><br><span class="line">  println name</span><br><span class="line">  <span class="keyword">def</span> closue() &#123;</span><br><span class="line">    println <span class="string">"闭包调用的 closue function!"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">stage(<span class="string">"stage name"</span>,&#123;println <span class="string">"closue"</span>&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>8.支持类定义和实例化。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greet</span> &#123;</span></span><br><span class="line">  <span class="keyword">def</span> name</span><br><span class="line">  Greet(who) &#123; name = who[<span class="number">0</span>].toUpperCase() + who[<span class="number">1.</span>.<span class="number">-1</span>] &#125;</span><br><span class="line">  <span class="keyword">def</span> salute() &#123; println <span class="string">"Hello "</span> + name + <span class="string">"!"</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">g = <span class="keyword">new</span> Greet(<span class="string">'world'</span>)  <span class="comment">// create object</span></span><br><span class="line">g.salute()   <span class="comment">// Hello World!</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h3 id="1-Scripted-Pipeline-Syntax"><a href="#1-Scripted-Pipeline-Syntax" class="headerlink" title="(1) Scripted Pipeline Syntax"></a>(1) Scripted Pipeline Syntax</h3><p>描述: Scripted Pipeline 是基于 groovy 的一种 <code>DSL</code> 语言相比于 Declarative pipeline，它为jenkins用户提供了更巨大的灵活性和可扩展性。</p>
<p><strong>Scripted Pipeline 基础结构说明:</strong></p>
<ul>
<li>Node：节点，一个 Node 就是一个 Jenkins 节点，Master 或者 Agent，是执行 Step 的具体运行环境，比如我们之前动态运行的 Jenkins Slave 就是一个 Node 节点</li>
<li>Stage：阶段，一个 Pipeline 可以划分为若干个 Stage，每个 Stage 代表一组操作，比如：Build、Test、Deploy，Stage 是一个逻辑分组的概念，可以跨多个 Node</li>
<li>Step：步骤，Step 是最基本的操作单元，可以是打印一句话，也可以是构建一个 Docker 镜像，由各类 Jenkins 插件提供，·<code>比如命令：sh &#39;make&#39;，就相当于我们平时 shell 终端中执行 make 命令一样。</code> (注意:此处Step不是cripted Pipeline关键字而是代表一条执行语句)</li>
</ul>
<p><strong>Scripted Pipeline 语法示例:</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Jenkinsfile (Scripted Pipeline)</span></span><br><span class="line"><span class="comment">// #结构1</span></span><br><span class="line">node &#123;</span><br><span class="line">    <span class="comment">// @变量定义</span></span><br><span class="line">    <span class="keyword">def</span> mvnHome</span><br><span class="line">    <span class="comment">// #结构2</span></span><br><span class="line">    stage(<span class="string">'Preparation'</span>) &#123;</span><br><span class="line">      <span class="comment">// # 结构3 - 它就是 Step 基本操作单元</span></span><br><span class="line">      echo <span class="string">"Scripted Pipeline"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Tips : 注释（Comments）和Java一样，<code>支持单行（使用//）、多行（/* */）和文档注释（使用/** */）</code>。</p>
<p><br></p>
<h4 id="Hello-World-实践"><a href="#Hello-World-实践" class="headerlink" title="Hello-World 实践"></a>Hello-World 实践</h4><p>Step 1.在Jenkins的WEB UI -&gt; 新建任务 -&gt; simple-pipeline-demo 任务名称 -&gt; 选择流水线 -&gt; 确定</p>
<p>Step 2.在 Dashboard -&gt; simple-pipeline-demo -&gt; 流水线 -&gt; 可以选择pipeline script（或者直接从scm拉取Jenkinsfile）此处为了演示只是简单的了解 -&gt; 应用保存</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Scripted Pipeline 脚本式</span></span><br><span class="line">node &#123;</span><br><span class="line">  stage(<span class="string">'Clone'</span>) &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"1.Clone Stage"</span></span><br><span class="line">  &#125;</span><br><span class="line">  stage(<span class="string">'Test'</span>) &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"2.Test Stage"</span></span><br><span class="line">  &#125;</span><br><span class="line">  stage(<span class="string">'Build'</span>) &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"3.Build Stage"</span></span><br><span class="line">  &#125;</span><br><span class="line">  stage(<span class="string">'Deploy'</span>) &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"4. Deploy Stage"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=2.Jenkins进阶之流水线pipeline语法入门学习 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210114103627.png" target="_blank" title="WeiyiGeek.Create PipeLine 流水线项目" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210114103627.png" alt="WeiyiGeek.Create PipeLine 流水线项目" title="" class=""></a>
                <p>WeiyiGeek.Create PipeLine 流水线项目</p>
            </figure>
<p>Step 3.立即构建 -&gt; 查看阶段视图 (或者利用blue-Ocean插件)进行更加直观的查看 -&gt;  观察构建的日志信息<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Started by user admin</span><br><span class="line">Running <span class="keyword">in</span> Durability level: MAX_SURVIVABILITY</span><br><span class="line">[Pipeline] Start of Pipeline</span><br><span class="line">[Pipeline] node</span><br><span class="line">Running on Jenkins <span class="keyword">in</span> /var/lib/jenkins/workspace/simple-pipeline-demo</span><br><span class="line">[Pipeline] &#123;</span><br><span class="line">[Pipeline] stage</span><br><span class="line">[Pipeline] &#123; (Clone)</span><br><span class="line">[Pipeline] <span class="built_in">echo</span></span><br><span class="line">1.Clone Stage</span><br><span class="line">[Pipeline] &#125;</span><br><span class="line">[Pipeline] // stage</span><br><span class="line">[Pipeline] stage</span><br><span class="line">[Pipeline] &#123; (Test)</span><br><span class="line">[Pipeline] <span class="built_in">echo</span></span><br><span class="line">2.Test Stage</span><br><span class="line">[Pipeline] &#125;</span><br><span class="line">[Pipeline] // stage</span><br><span class="line">[Pipeline] stage</span><br><span class="line">[Pipeline] &#123; (Build)</span><br><span class="line">[Pipeline] <span class="built_in">echo</span></span><br><span class="line">3.Build Stage</span><br><span class="line">[Pipeline] &#125;</span><br><span class="line">[Pipeline] // stage</span><br><span class="line">[Pipeline] stage</span><br><span class="line">[Pipeline] &#123; (Deploy)</span><br><span class="line">[Pipeline] <span class="built_in">echo</span></span><br><span class="line">4. Deploy Stage</span><br><span class="line">[Pipeline] &#125;</span><br><span class="line">[Pipeline] // stage</span><br><span class="line">[Pipeline] &#125;</span><br><span class="line">[Pipeline] // node</span><br><span class="line">[Pipeline] End of Pipeline</span><br><span class="line">Finished: SUCCESS</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=2.Jenkins进阶之流水线pipeline语法入门学习 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210114104250.png" target="_blank" title="WeiyiGeek.jenkins流水线执行结果与blue-Ocean" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210114104250.png" alt="WeiyiGeek.jenkins流水线执行结果与blue-Ocean" title="" class=""></a>
                <p>WeiyiGeek.jenkins流水线执行结果与blue-Ocean</p>
            </figure>
<p>PS : 你可以选择使用BlueOcean或者jenkins原生的流水控制台展示两则并不冲突，但是需要注意Scripted pipeline不完全兼容<code>BlueOcean</code>;</p>
<p><br></p>
<h4 id="变量名-Identifiers"><a href="#变量名-Identifiers" class="headerlink" title="变量名-Identifiers"></a>变量名-Identifiers</h4><p>描述: 标识符（Identifiers）也称变量名, <code>以字母、美元符号$或下划线_开始</code>，不能以数字开始。<br>例如以下是可用的标识符：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> name</span><br><span class="line"><span class="keyword">def</span> item3</span><br><span class="line"><span class="keyword">def</span> with_underscore</span><br><span class="line"><span class="keyword">def</span> $dollarStart</span><br></pre></td></tr></table></figure><br>以下是不可用的标识符：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="number">3</span>tier <span class="comment">// 不能以数字开始</span></span><br><span class="line"><span class="keyword">def</span> a+b <span class="comment">// "+"号是非法字符</span></span><br><span class="line">def a#b // #号也不是可用的字符</span><br></pre></td></tr></table></figure></p>
<p>Tips : 在点号后是可以使用关键字作为标识符时产生<code>org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed:</code>错误;<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">foo.<span class="keyword">as</span></span><br><span class="line">foo.<span class="keyword">assert</span></span><br><span class="line">foo.<span class="keyword">break</span></span><br><span class="line">foo.<span class="keyword">case</span></span><br><span class="line">foo.<span class="keyword">catch</span></span><br></pre></td></tr></table></figure><br><br></p>
<h4 id="字符串-String"><a href="#字符串-String" class="headerlink" title="字符串-String"></a>字符串-String</h4><p>描述: 在Groovy中字符串有两种类型，一种是Java原生的<code>java.lang.String</code>；另一种是<code>groovy.lang.GString</code>，又叫插值字符串(interpolated strings)。</p>
<ul>
<li><p>(1) 单引号字符串（Single quoted string）<br>在Groovy中，使用单引号括住的字符串就是java.lang.String，不支持插值：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> name = <span class="string">'yjiyjgie'</span></span><br><span class="line">println name.<span class="keyword">class</span> <span class="comment">// class java.lang.String</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>(2) 三单引号字符串（Triple single quoted string）<br>使用三单引号括住字符串支持多行，也是java.lang.String实例，在第一个’‘’起始处加一个反斜杠\可以在新一行开始文本：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> strippedFirstNewline = <span class="string">'''line one</span></span><br><span class="line"><span class="string">line two</span></span><br><span class="line"><span class="string">line three</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以写成下面这种形式，可读性更好</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> strippedFirstNewline = <span class="string">'''\</span></span><br><span class="line"><span class="string">line one</span></span><br><span class="line"><span class="string">line two</span></span><br><span class="line"><span class="string">line three</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>(3) 双引号字符串（Double quoted string）<br>如果双引号括住的字符串中没有插值表达式（interpolated expression），那它就是java.lang.String；如是有插值表达式，那它就是groovy.lang.GString：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> normalStr = <span class="string">"yjiyjige"</span> <span class="comment">// 这是一个java.lang.String</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> interpolatedStr = <span class="string">"my name is $&#123;normalStr&#125;"</span> <span class="comment">// 这是一个groovy.lang.GString</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>(4) 字符串插值（String interpolation）<br>在Groovy所有的字符串字面量表示中，除了单引号字符串和三单引号字符串，其他形式都支持字符串插值。字符串插值也即将占位表达式中的结果最终替换到字符串相应的位置中：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> name = <span class="string">'Guillaume'</span>          <span class="comment">// a plain string</span></span><br><span class="line"><span class="keyword">def</span> greeting = <span class="string">"Hello $&#123;name&#125;"</span> <span class="comment">// name变量的值会被替换进去</span></span><br><span class="line"><span class="keyword">assert</span> greeting.toString()  == <span class="string">'Hello Guillaume'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//当使用点号表达式时，可以只用$代替$&#123;&#125;：</span></span><br><span class="line"><span class="keyword">def</span> person = [<span class="string">name:</span> <span class="string">'Guillaume'</span>, <span class="string">age:</span> <span class="number">36</span>]</span><br><span class="line">println <span class="string">"$person.name is $person.age years old"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>补充说明:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 插值占位符中还支持闭包，而闭包的一个好处是惰性求值（lazy evaluation）：</span></span><br><span class="line"><span class="keyword">def</span> number = <span class="number">1</span></span><br><span class="line"><span class="keyword">def</span> eagerGString = <span class="string">"value == $&#123;number&#125;"</span> <span class="comment">// 普通形式</span></span><br><span class="line"><span class="keyword">def</span> lazyGString = <span class="string">"value == $&#123;-&gt; number&#125;"</span> <span class="comment">// 这是一个闭包</span></span><br><span class="line"></span><br><span class="line">println eagerGString <span class="comment">// == "value == 1"</span></span><br><span class="line">println lazyGString  <span class="comment">// == "value == 1"</span></span><br><span class="line"></span><br><span class="line">number = <span class="number">2</span></span><br><span class="line">println eagerGString <span class="comment">// == "value == 1" // eagerGString已经被固定下来了</span></span><br><span class="line">println lazyGString  <span class="comment">// == "value == 2" // lazyGString的值会被重新计算</span></span><br></pre></td></tr></table></figure></p>
<p>Tips: GString与String的hashCode是不一样的即使他们最终结果一样。所以在Map中不应该用GString去做元素的Key，而又使用普通的String去取值;<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当一个方法的需要一个java.lang.String变量，而我们传递的是一个groovy.lang.GString实例时，GString的toString方法会被自动调用，看起来像我们可以直接将一个GString赋值给一个String变量一样。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> key = <span class="string">"a"</span></span><br><span class="line"><span class="keyword">def</span> m = [<span class="string">"$&#123;key&#125;"</span>: <span class="string">"letter $&#123;key&#125;"</span>] <span class="comment">// key类型是一个GString</span></span><br><span class="line"><span class="keyword">assert</span> m[<span class="string">"a"</span>] <span class="comment">// == null // 用一个普通String类型的key去取值取代的值为null 而并非 letter a</span></span><br></pre></td></tr></table></figure></p>
<p>Tips : 对于输出对象带有指定方法时如有需要拼接其它字符串需要以<code>${对象.方法}</code>进行包含;<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> number = <span class="number">3.14</span></span><br><span class="line">println <span class="string">"$number.toString()"</span> <span class="comment">// 这里会报异常,因为相当于"$&#123;number.toString&#125;()"</span></span><br><span class="line">println <span class="string">"$&#123;number.toString()&#125; -- Other String、"</span> <span class="comment">// 这样就正常了</span></span><br></pre></td></tr></table></figure><br><br></p>
<h4 id="数字-Numbers"><a href="#数字-Numbers" class="headerlink" title="数字 - Numbers"></a>数字 - Numbers</h4><p>描述: 当使用def指明整数字面量时，变量的类型会根据数字的大小自动调整：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果要强制指明一个数字的字面量类型，可以给字面量加上类型后缀：</span></span><br><span class="line">BigInteger 使用G或g</span><br><span class="line">Long 使用L或l</span><br><span class="line">Integer 使用I或i</span><br><span class="line">BigDecimal 使用G或g</span><br><span class="line">Double 使用D或d</span><br><span class="line">Float 使用F或f</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> a = <span class="number">1</span></span><br><span class="line"><span class="keyword">assert</span> a <span class="keyword">instanceof</span> Integer</span><br><span class="line"></span><br><span class="line"><span class="comment">// Integer.MAX_VALUE</span></span><br><span class="line"><span class="keyword">def</span> b = <span class="number">2147483647</span></span><br><span class="line"><span class="keyword">assert</span> b <span class="keyword">instanceof</span> Integer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Integer.MAX_VALUE + 1</span></span><br><span class="line"><span class="keyword">def</span> c = <span class="number">2147483648</span></span><br><span class="line"><span class="keyword">assert</span> c <span class="keyword">instanceof</span> Long</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Long.MAX_VALUE</span></span><br><span class="line"><span class="keyword">def</span> d = <span class="number">9223372036854775807</span></span><br><span class="line"><span class="keyword">assert</span> d <span class="keyword">instanceof</span> Long</span><br><span class="line"></span><br><span class="line"><span class="comment">// Long.MAX_VALUE + 1</span></span><br><span class="line"><span class="keyword">def</span> e = <span class="number">9223372036854775808</span></span><br><span class="line"><span class="keyword">assert</span> e <span class="keyword">instanceof</span> BigInteger</span><br></pre></td></tr></table></figure><br>Tips : 为了精确地计算小数，在Groovy中使用def声明的小数是BigDecimal类型的：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> decimal = <span class="number">123.456</span></span><br><span class="line">println decimal.getClass() <span class="comment">// class java.math.BigDecimal</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="列表-List"><a href="#列表-List" class="headerlink" title="列表-List"></a>列表-List</h4><p>描述：默认情况下Groovy的列表使用的是<code>java.util.ArrayList</code>，用中括号[]括住，使用逗号分隔：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  定义一个 list 隐式</span></span><br><span class="line">def numbers = [1, 2, 3]</span><br><span class="line">println numbers.getClass() <span class="comment"># // class java.util.ArrayList</span></span><br><span class="line"></span><br><span class="line">def arrayList = [1, 2, 3]  <span class="comment"># // 默认类型</span></span><br><span class="line"><span class="comment"># assert arrayList instanceof java.util.ArrayList</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果要使用其它类型的列表（如：LinkedList）可以使用as操作符或显式分配给一个指定类型的变量：</span></span><br><span class="line">def linkedList = [2, 3, 4] as LinkedList <span class="comment"># // 使用as操作符</span></span><br><span class="line"><span class="comment"># assert linkedList instanceof java.util.LinkedList</span></span><br><span class="line"></span><br><span class="line">LinkedList otherLinked = [3, 4, 5]         <span class="comment"># // 显式指明类型</span></span><br><span class="line"><span class="comment"># assert otherLinked instanceof java.util.LinkedList</span></span><br></pre></td></tr></table></figure></p>
<p>Groovy重载了列表的[]和&lt;&lt;操作符，可以通过List[index]访问指定位置元素，也可以通过<code>List &lt;&lt; element</code>往列表末尾添加元素：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个list</span></span><br><span class="line"><span class="keyword">def</span> letters = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>]</span><br><span class="line"><span class="keyword">assert</span> letters[<span class="number">0</span>]  <span class="comment">//  == 'a'</span></span><br><span class="line"><span class="keyword">assert</span> letters[<span class="number">1</span>]  <span class="comment">// == 'b'</span></span><br><span class="line"><span class="keyword">assert</span> letters[<span class="number">-1</span>] <span class="comment">// == 'd' 从后面访问 倒数第一个</span></span><br><span class="line"><span class="keyword">assert</span> letters[<span class="number">-2</span>] <span class="comment">// == 'c' // 从后面访问 倒数第二个</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 元素修改</span></span><br><span class="line">letters[<span class="number">2</span>] = <span class="string">'C'</span>    </span><br><span class="line"><span class="keyword">assert</span> letters[<span class="number">2</span>]   <span class="comment">//  == 'C'</span></span><br><span class="line"></span><br><span class="line">letters &lt;&lt; <span class="string">'e'</span> <span class="comment">// 往最后面添加元素</span></span><br><span class="line"><span class="keyword">assert</span> letters[<span class="number">4</span>] == <span class="string">'e'</span></span><br><span class="line"><span class="keyword">assert</span> letters[<span class="number">-1</span>] == <span class="string">'e'</span></span><br><span class="line"><span class="keyword">assert</span> letters[<span class="number">1</span>, <span class="number">3</span>] == [<span class="string">'b'</span>, <span class="string">'d'</span>]      <span class="comment">// 提取指定元素</span></span><br><span class="line"><span class="keyword">assert</span> letters[<span class="number">2.</span><span class="number">.4</span>] == [<span class="string">'C'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>] <span class="comment">// 支持范围（ranges）操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 二维列表</span></span><br><span class="line"><span class="keyword">def</span> multi = [[<span class="number">0</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">3</span>]]</span><br><span class="line"><span class="keyword">assert</span> multi[<span class="number">1</span>][<span class="number">0</span>] == <span class="number">2</span></span><br></pre></td></tr></table></figure></p>
<p><strong>常用方法</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> mylist = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="string">"weiyigeek.top"</span>,<span class="string">"devops"</span>,<span class="string">"jenkins"</span>]</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 通过索引获取列表元素</span></span><br><span class="line">println(numList[<span class="number">5</span>])  <span class="comment">// weiyigeek.top</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 列表的长度</span></span><br><span class="line">println(mylist.size())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算列表中元素出现的次数</span></span><br><span class="line">println(numList.count(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断元素是否为空</span></span><br><span class="line">println(mylist.isEmpty())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 列表元素增删</span></span><br><span class="line"><span class="comment">// + 操作符性能比较低,从而建议使用&lt;&lt;</span></span><br><span class="line"><span class="keyword">def</span> newlist = mylist.add(<span class="string">"gitlab"</span>)</span><br><span class="line">println(mylist + <span class="string">"jenkins"</span>)</span><br><span class="line">println(mylist - <span class="string">"devops"</span>)</span><br><span class="line">println(mylist &lt;&lt; <span class="string">"java"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 列表元素移除</span></span><br><span class="line">println(mylist.remove(<span class="string">"java"</span>)) <span class="comment">// 移除指定元素,成功则返回True</span></span><br><span class="line">println(mylist.removeAll())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 整数取最值、求和</span></span><br><span class="line">println(mylist.min())</span><br><span class="line">println(mylist.max())</span><br><span class="line">println(mylist.sum())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 列表去重</span></span><br><span class="line">println(mylist.unique())</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 列表反转</span></span><br><span class="line">println(mylist.reverse())</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 列表排序</span></span><br><span class="line">println(mylist.sort())</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 取交集、判断是否有交集</span></span><br><span class="line">println(mylist.intersect([<span class="number">2</span>,<span class="number">3</span>]))</span><br><span class="line">println(mylist.disjoint([<span class="number">2</span>,<span class="number">3</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断列表是否包含元素</span></span><br><span class="line">println(mylist.contains(<span class="string">"devops"</span>))</span><br><span class="line"><span class="comment">// 或者使用in关键字</span></span><br><span class="line"><span class="keyword">def</span> isContains = <span class="string">'devops'</span> <span class="keyword">in</span> strList</span><br><span class="line">println(isContains)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 列表拼接插入到中间</span></span><br><span class="line">println(mylist.join(<span class="string">"geek"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 列表克隆</span></span><br><span class="line"><span class="keyword">def</span> list = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</span><br><span class="line"><span class="keyword">def</span> newlist = list.clone()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 合并嵌套列表</span></span><br><span class="line"><span class="keyword">def</span> mylist = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,[<span class="number">4</span>,<span class="number">5</span>],<span class="number">5</span>,<span class="string">"weiyigeek.top"</span>,<span class="string">"devops"</span>,<span class="string">"jenkins"</span>]</span><br><span class="line">println(mylist.flatten())</span><br><span class="line"></span><br><span class="line"><span class="comment">//扩展列表定义方式</span></span><br><span class="line">String[] stus = [<span class="string">"Weiyi"</span>, <span class="string">"Geek"</span>,<span class="string">"Top"</span>]</span><br><span class="line"><span class="keyword">def</span> numList = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">6</span>] <span class="keyword">as</span> <span class="keyword">int</span>[]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将list集合通过调用collect()把list中的值*2构成一个新的集合，构成的新集合是[2,4,6]</span></span><br><span class="line"><span class="keyword">def</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">def</span> newList = list.collect &#123; it * <span class="number">2</span> &#125;</span><br><span class="line"><span class="keyword">def</span> newList = list*.multiply(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把元素重复的复制几次</span></span><br><span class="line"><span class="keyword">def</span> list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="keyword">def</span> newList = list*<span class="number">3</span></span><br><span class="line"><span class="keyword">def</span> newList = list.multiply(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用findAll()找到所有匹配的元素</span></span><br><span class="line">println(list.findAll&#123; it &gt; <span class="number">1</span> &#125;)  <span class="comment">// [2,3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断集合中的值是否都小于5(与)</span></span><br><span class="line"><span class="keyword">def</span> isTrue = list.every &#123; it &lt; <span class="number">5</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断集合中的值是否存在小于5(或)</span></span><br><span class="line"><span class="keyword">def</span> isTrue = list.any &#123; it &lt; <span class="number">5</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用inject(index) 方法 集合中元素相加后再加index</span></span><br><span class="line"><span class="keyword">def</span> list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>]</span><br><span class="line"><span class="keyword">def</span> num = list.inject(<span class="number">93</span>)&#123; count, item -&gt; count + item &#125;</span><br><span class="line">println (num) <span class="comment">// 100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用findIndexOf()查找第一个元素匹配标准的索引</span></span><br><span class="line"><span class="keyword">def</span> strList =  [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>]</span><br><span class="line"><span class="keyword">def</span> index =  strList.findIndexOf &#123;</span><br><span class="line">  it <span class="keyword">in</span> [<span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'g'</span>]</span><br><span class="line">&#125;</span><br><span class="line">println(index)  <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用indexOf()查找集合某个值对应的下标值</span></span><br><span class="line"><span class="keyword">def</span> index =  strList.indexOf(<span class="string">'c'</span>)  </span><br><span class="line">println(index)  <span class="comment">// 如果没有找到就返回-1否则返回下标值</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="字典-Maps"><a href="#字典-Maps" class="headerlink" title="字典 - Maps"></a>字典 - Maps</h4><p>描述: Groovy使用中括号[]来定义字典，元素需要包含key和value使用冒号分隔，元素与元素之间用逗号分隔：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// key部分其实是字符串</span></span><br><span class="line"><span class="keyword">def</span> colors = [<span class="string">red:</span> <span class="string">'#FF0000'</span>, <span class="string">green:</span> <span class="string">'#00FF00'</span>, <span class="string">blue:</span> <span class="string">'#0000FF'</span>]</span><br><span class="line"><span class="keyword">assert</span> colors[<span class="string">'red'</span>] == <span class="string">'#FF0000'</span> <span class="comment">// 使用中括号访问</span></span><br><span class="line"><span class="keyword">assert</span> colors.green == <span class="string">'#00FF00'</span> <span class="comment">// 使用点表达式访问</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 两种方式</span></span><br><span class="line">colors[<span class="string">'pink'</span>] = <span class="string">'#FF00FF'</span></span><br><span class="line">colors.yellow = <span class="string">'#FFFF00'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> colors.pink      <span class="comment">// == '#FF00FF'</span></span><br><span class="line"><span class="keyword">assert</span> colors[<span class="string">'yellow'</span>] <span class="comment">// == '#FFFF00'</span></span><br><span class="line"><span class="keyword">assert</span> colors <span class="keyword">instanceof</span> java.util.LinkedHashMap <span class="comment">// 默认使用LinkedHashMap类型</span></span><br></pre></td></tr></table></figure></p>
<p>在上边的例子中，虽然没有明确的使用字符串<code>’red‘、’green‘</code>，但Groovy会自动把那些key转化为字符串。并且在默认情况下，初始化字典时key也不会去使用已经存在的变量：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> keyVal = <span class="string">'name'</span></span><br><span class="line"><span class="keyword">def</span> persons = [<span class="string">keyVal:</span> <span class="string">'Guillaume'</span>] <span class="comment">// 非常注意: 此处的key是字符串keyVal而不是name</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> !persons.containsKey(<span class="string">'name'</span>)</span><br><span class="line"><span class="keyword">assert</span> persons.containsKey(<span class="string">'keyVal'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果要使用一个变量作为key，需要用括号括住：</span></span><br><span class="line"><span class="keyword">def</span> keyVal = <span class="string">'name'</span></span><br><span class="line"><span class="keyword">def</span> persons = [(keyVal): <span class="string">'Guillaume'</span>] <span class="comment">// 相当于[ 'name' : 'Guillaume' ]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> persons.containsKey(<span class="string">'name'</span>)</span><br><span class="line"><span class="keyword">assert</span> !persons.containsKey(<span class="string">'keyVal'</span>)</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="条件语句-Condition"><a href="#条件语句-Condition" class="headerlink" title="条件语句 - Condition"></a>条件语句 - Condition</h4><p><strong>if 语句</strong><br>第一个决策语句是 if 语句。这种说法的一般形式是<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// # syntax</span></span><br><span class="line"><span class="keyword">if</span>(condition) &#123;</span><br><span class="line">  statement #1</span><br><span class="line">  statement #2</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>例子:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@ 流程控制Groovy表达式如if/else条件语句</span></span><br><span class="line"><span class="keyword">if</span> (env.BRANCH_NAME == <span class="string">'master'</span>) &#123;</span><br><span class="line">  echo <span class="string">'I only execute on the master branch'</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  echo <span class="string">'I execute elsewhere'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>For循环</strong><br>for 语句用于遍历一组值。for 语句通常以以下方式使用。<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(variable declaration;expression;Increment) &#123;</span><br><span class="line">  statement #1</span><br><span class="line">  statement #2</span><br><span class="line">  …</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>例子：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 常规</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;<span class="number">5</span>;i++) &#123;</span><br><span class="line">  println(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// List 循环迭代</span></span><br><span class="line"><span class="keyword">def</span> mylist = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">"weiyigeek.top"</span>,<span class="string">"devops"</span>,<span class="string">"jenkins"</span>]</span><br><span class="line">mylist.each&#123; println(it) &#125;</span><br><span class="line"><span class="comment">// 'it'是当前元素，而'i'是索引</span></span><br><span class="line">mylist.eachWithIndex &#123; it, i -&gt;  println <span class="string">"$i: $it"</span> &#125;</span><br><span class="line">mylist.eachWithIndex &#123; count, count -&gt; count + item &#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>Switch 语句</strong><br>Swict 语句用于条件判断, 基础语法如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">switch () &#123;</span><br><span class="line">  case &#39;1&#39;:</span><br><span class="line">    echo 1</span><br><span class="line">    break</span><br><span class="line">  case &#39;2&#39;:</span><br><span class="line">    echo 2</span><br><span class="line">    break</span><br><span class="line">  default:</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br></p>
<h4 id="异常-Exception"><a href="#异常-Exception" class="headerlink" title="异常 - Exception"></a>异常 - Exception</h4><p>描述:流程控制是Groovy的异常处理机制,在实际过程中建议同时使用try…catch..finally进行捕获异常;<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">      helloWorld()  <span class="comment">// == Scripted Pipeline - Hello Wrold - STARTED - 1024!</span></span><br><span class="line">      dir(<span class="string">"place"</span>) &#123;</span><br><span class="line">          sh <span class="string">'id'</span>  <span class="comment">// == uid=112(jenkins) gid=117(jenkins) groups=117(jenkins)</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="comment">// If there was an exception thrown, the build failed</span></span><br><span class="line">      currentBuild.result = <span class="string">"FAILED"</span></span><br><span class="line">      <span class="keyword">throw</span> e</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      println <span class="string">"success or failure, always send notifications"</span>   <span class="comment">// == Success or failure, always send notifications </span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="函数-Functions"><a href="#函数-Functions" class="headerlink" title="函数 - Functions"></a>函数 - Functions</h4><p>描述：Groovy中的方法是使用返回类型或使用def关键字定义的, 方法可以接收任意数量的参数并定义参数时不必显式定义类型，可以添加修饰符如<code>public，private和protected</code>。</p>
<p>Tips : 注意事项</p>
<ul>
<li>默认情况下如果未提供可见性修饰符则该方法为public。</li>
<li>注意: 函数定义不能被包含在<code>node{}块</code>之中, 而函数调用是在 <code>node { stage() { 函数名称} }</code> 之中的;</li>
<li>注意: 函数参数有定义默认值</li>
</ul>
<p><strong>简单示例</strong>:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.函数命令以及函数参数</span></span><br><span class="line"><span class="keyword">def</span> methodName(String param)&#123;</span><br><span class="line">  println param  <span class="comment">//Method code</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2.支持函数重载，当参数个数不同时，函数名称可以同名</span></span><br><span class="line"><span class="keyword">def</span> methodName(String param = <span class="string">'default1'</span>,<span class="keyword">int</span> number = <span class="number">1024</span>) &#123;</span><br><span class="line">  println <span class="string">"Hello Wrold function - $&#123;param&#125; - $&#123;age&#125;!"</span> </span><br><span class="line">  println param+<span class="string">" "</span>+age</span><br><span class="line">  <span class="comment">// 如果没有显式地使用return关键字，则返回函数最后一行语句的运行结果。</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">"Hello Wrold function - $&#123;param&#125; - $&#123;age&#125;!"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 3.Groovy支持不定长参数</span></span><br><span class="line"><span class="keyword">def</span> methodName(... param)&#123;</span><br><span class="line">  println param[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 4.函数可以赋值给其它函数，使用语法标记&amp;将函数赋予新的函数。</span></span><br><span class="line"><span class="keyword">def</span> printHello=<span class="keyword">this</span>.&amp;methodName</span><br><span class="line"></span><br><span class="line">node &#123; </span><br><span class="line">  stage(<span class="string">'函数调用'</span>) &#123; </span><br><span class="line">    res00 = methodName(<span class="string">"WeiyiGeek"</span>)</span><br><span class="line">    res01 = methodName(<span class="string">"WeiyiGeek"</span>,<span class="number">1024</span>)</span><br><span class="line">    res02 = printHello(<span class="string">"WeiyiGeek"</span>)</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>闭包函数</strong><br>描述: Groovy中闭包是这么定义的,可以用作函数参数和方法参数的代码块, 可以把这个代码块理解为一个函数指针。</p>
<p>Tips: 闭包可以访问外部的变量，记住一点方法是不能访问外部变量的。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// # 闭包格式</span></span><br><span class="line"><span class="keyword">def</span> xxx = &#123; params -&gt; code &#125;</span><br><span class="line"><span class="keyword">def</span> xxx=&#123;code&#125; <span class="comment">//或者</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.闭包可访问外部变量</span></span><br><span class="line"><span class="keyword">def</span> str=<span class="string">"hello world"</span></span><br><span class="line"><span class="keyword">def</span> closure=&#123;</span><br><span class="line">  println str</span><br><span class="line">&#125;</span><br><span class="line">closure()  <span class="comment">//hello world</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.闭包调用的两种方式</span></span><br><span class="line"><span class="keyword">def</span> closure = &#123;</span><br><span class="line">  param -&gt; println param</span><br><span class="line">&#125;</span><br><span class="line">closure(<span class="string">"hello world"</span>)</span><br><span class="line">closure <span class="string">"hello world"</span></span><br><span class="line">closure.call(<span class="string">"hell call"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.闭包是有返回值的，默认最后一行语句就是该闭包的返回值，如果最后一行语句没有不输入任何类型，闭包将返回null</span></span><br><span class="line"><span class="keyword">def</span> noReturn=&#123;</span><br><span class="line">    println <span class="string">"hello world"</span></span><br><span class="line">&#125;</span><br><span class="line">println noReturn()</span><br><span class="line"><span class="comment">//hello world</span></span><br><span class="line"><span class="comment">//null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.闭包可预定参数，如没有预定则有一个隐式的默认参数it，值得非常注意闭包中参数名称不能与闭包内或闭包外的参数名重名。</span></span><br><span class="line"><span class="keyword">def</span> closure=&#123;</span><br><span class="line">  println <span class="string">"hello $it"</span></span><br><span class="line">&#125;</span><br><span class="line">closure(<span class="string">"admin"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> closure=&#123;</span><br><span class="line">  param01,param02,param03-&gt;println param01+param02+param03</span><br><span class="line">&#125;</span><br><span class="line">closure <span class="string">"hello"</span>,<span class="string">"world"</span>,<span class="string">"ok"</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> closure=&#123;</span><br><span class="line">  println it</span><br><span class="line">&#125;</span><br><span class="line">closure <span class="string">"hello world"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.闭包可以作为一个参数传递给另一个闭包，也可以在闭包中返回一个闭包。</span></span><br><span class="line"><span class="keyword">def</span> toTriple = &#123; n -&gt; n * <span class="number">3</span> &#125;</span><br><span class="line"><span class="keyword">def</span> runTwice = &#123; a, c -&gt; c(c(a)) &#125;</span><br><span class="line">println runTwice(<span class="number">5</span>, toTriple)  <span class="comment">// 15 * 3 =  45</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> times = &#123; x -&gt; &#123; y -&gt; x * y &#125; &#125;</span><br><span class="line">println times(<span class="number">3</span>)(<span class="number">4</span>)<span class="comment">//12</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 6.当闭包作为闭包或方法的最后一个参数，可以将闭包从参数圆括号中提取出来接在最后。</span></span><br><span class="line"><span class="keyword">def</span> runTwice = &#123; a, c -&gt; c(c(a)) &#125;</span><br><span class="line">println runTwice(<span class="number">5</span>, &#123; it * <span class="number">3</span> &#125;) <span class="comment">//45 usual syntax</span></span><br><span class="line"><span class="comment">//当多个闭包作为最后一个参数时</span></span><br><span class="line"><span class="keyword">def</span> runTwoClosures = &#123; a, c1, c2 -&gt; c1(c2(a)) &#125;</span><br><span class="line"><span class="keyword">assert</span> runTwoClosures(<span class="number">5</span>, &#123; it * <span class="number">3</span> &#125;, &#123; it * <span class="number">4</span> &#125;) == <span class="number">60</span> <span class="comment">//usual syntax</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 7.闭包接受参数的规则，会将参数列表中所有有键值关系的参数，作为一个map组装，传入闭包作为调用闭包的第一个参数。</span></span><br><span class="line"><span class="keyword">def</span> f= &#123;m, i, j-&gt; i + j + m.x + m.y &#125;</span><br><span class="line">println f(<span class="number">6</span>, <span class="string">x:</span><span class="number">4</span>, <span class="string">y:</span><span class="number">3</span>, <span class="number">7</span>)<span class="comment">//20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 8.如果闭包的参数声明中没有list，那么传入参数可以设置为list，里面的参数将分别传入闭包参数。</span></span><br><span class="line"><span class="keyword">def</span> c = &#123; a, b, c -&gt; a + b + c &#125;</span><br><span class="line"><span class="keyword">def</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">println c(list) <span class="comment">// 6</span></span><br></pre></td></tr></table></figure>
<p>参考地址: <a href="https://stackoverflow.com/questions/40870657/groovy-method-definition-not-expected-here" target="_blank" rel="noopener">https://stackoverflow.com/questions/40870657/groovy-method-definition-not-expected-here</a></p>
<p><br></p>
<h4 id="类和对象"><a href="#类和对象" class="headerlink" title="类和对象"></a>类和对象</h4><p>Groovy类与Java类似，在字节码级都被编译成Java类，由于其在定义变量上面的灵活性，所以在新建一个Groovy类时还是有一些不同的，增加了许多灵活性。</p>
<p>1.由于Groovy是松散型语言，它并不强制你给属性、方法参数和返回值定义类型。如果没有指定类型，在字节码级别会被编译成Object,所以在定义类的属性时不用刻意加上权限修饰符，默认就是public的。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span>&#123;</span></span><br><span class="line">  <span class="keyword">def</span> title</span><br><span class="line">  String author</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> price</span><br><span class="line">  <span class="comment">// 是否与Java的类差不多</span></span><br><span class="line">  <span class="keyword">public</span> Book(title)&#123;</span><br><span class="line">    <span class="keyword">this</span>.title=title</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 默认public</span></span><br><span class="line">  <span class="keyword">boolean</span> order(<span class="keyword">int</span> isbn)&#123;</span><br><span class="line">    <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">def</span> title()&#123;</span><br><span class="line">    <span class="string">"Booke Title"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化对象</span></span><br><span class="line">Book book=<span class="keyword">new</span> Book(<span class="string">"Hello Groovy"</span>)</span><br><span class="line">book.order(<span class="number">1001</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用说明</span></span><br><span class="line">book.title   <span class="comment">//获取属性</span></span><br><span class="line">book.title() <span class="comment">//访问方法</span></span><br></pre></td></tr></table></figure>
<p>2.Groovy在编译完成后会自动帮助我们生成getter与setter方法，但是私有属性除外也就是说 price 属性我们不能使用getter与setter方法。<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例如 title 属性的 getter 与 setter 方法。</span></span><br><span class="line">Book book=<span class="keyword">new</span> Book(<span class="string">"Hello Groovy"</span>)</span><br><span class="line">println book.getTitle() <span class="comment">// Hello Groovy</span></span><br><span class="line"> </span><br><span class="line">book.setTitle(<span class="string">"New Groovy"</span>)</span><br><span class="line">println book.getTitle() <span class="comment">// New Groovy</span></span><br><span class="line">println book.title      <span class="comment">// New Groovy</span></span><br></pre></td></tr></table></figure></p>
<p>3.在Groovy中类名和文件名并不需要严格的映射关系，我们知道在Java中主类名必须与文件同名，但是在Groovy中一个文件可以定义多个public类。<br>在Groovy中可以定义与任何类不相关的方法和语句，这些方法通常称为独立方法或者松方法。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Hello 类中有一个的公共静态 hello 方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hello</span>&#123;</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String hello()&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"hello"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">World</span>&#123;</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String world()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"world"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">println Hello.hello()+World.world()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> helloWorld()&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"hello world"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面一个文件名定义为Structure.groovy，在这个文件中包含了类的定义和独立方法声明，它编译之后会发生什么呢。</p>
<p>首先会生成一个与文件同名的class文件，所有的松语句都集中在run方法中，并且run方法被该类的main方法调用。<br>独立方法被编译成了类的静态方法，与Java相似每一个独立的类都会被编译成一个单独的class文件。<br>因此编译Structure.groovy文件最后会被编译成<code>Hello.class、World.class和Structure.class</code>。</p>
<p><br></p>
<h4 id="字符串处理"><a href="#字符串处理" class="headerlink" title="字符串处理"></a>字符串处理</h4><p><strong>字符串分隔</strong></p>
<ul>
<li>split() ：结果为字符串数组、保留空字符串、按照单词切割、支持使用使用正则</li>
<li>tokenize() ：结果为List、但不会保留空字符串、按字符串切割、不支持使用使用正则<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def demo_string = <span class="string">"Hello WeiyiGeek"</span></span><br><span class="line">out1 = demo_string.split(<span class="string">"l"</span>)       <span class="comment"># [He, , o WeiyiGeek]</span></span><br><span class="line">out2 = demo_string.tokenize(<span class="string">"l"</span>)    <span class="comment"># [He, o WeiyiGeek]</span></span><br><span class="line"></span><br><span class="line">out3 = demo_string.split(<span class="string">'lo'</span>)      <span class="comment"># [Hel, WeiyiGeek]</span></span><br><span class="line">out4 = demo_string.tokenize(<span class="string">'li'</span>)   <span class="comment"># [Hel, We, y, Geek]</span></span><br><span class="line"></span><br><span class="line">out5 = demo_string.split(/We\w&#123;3&#125;/) <span class="comment"># [Hello , Geek]</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h4 id="语法总结"><a href="#语法总结" class="headerlink" title="语法总结"></a>语法总结</h4><p>描述: 此次对 <code>Scripted Pipeline</code> 语法的使用进行一个简单的总结, 或许在后面的Declarative Pipeline中可以进行使用;<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">node &#123;</span><br><span class="line">  <span class="comment">// 变量定义</span></span><br><span class="line">  <span class="keyword">def</span> foo</span><br><span class="line">  <span class="comment">// 字符串</span></span><br><span class="line">  <span class="keyword">def</span> project=<span class="string">"HelloWorld"</span></span><br><span class="line">  <span class="comment">// 单引号字符串（Single quoted string）不能解析变量</span></span><br><span class="line">  <span class="keyword">def</span> name=<span class="string">'weiyigeek - $&#123;project&#125;'</span></span><br><span class="line">  <span class="comment">// 三单引号字符串（Triple single quoted string）不能解析变量</span></span><br><span class="line">  <span class="keyword">def</span> line=<span class="string">'''\</span></span><br><span class="line"><span class="string">  Line one</span></span><br><span class="line"><span class="string">  Line $&#123;project&#125;</span></span><br><span class="line"><span class="string">  '''</span></span><br><span class="line">  <span class="comment">// 定义字典Maps</span></span><br><span class="line">  <span class="keyword">def</span> person = [<span class="string">name:</span> <span class="string">'WeiyiGeek'</span>, <span class="string">age:</span> <span class="number">96</span>]  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  stage(<span class="string">'Scripted Pipeline Syntax'</span>) &#123;</span><br><span class="line">    <span class="comment">// (1) 变量声明</span></span><br><span class="line">    foo=<span class="string">"Identifiers"</span></span><br><span class="line">    <span class="comment">// (2) 变量调用</span></span><br><span class="line">    echo <span class="string">"$&#123;foo&#125; -- $&#123;project&#125;"</span> <span class="comment">// == Identifiers -- HelloWorld</span></span><br><span class="line">    <span class="comment">// (3) 字符串输出</span></span><br><span class="line">    echo <span class="string">"my name is $&#123;name&#125;"</span> <span class="comment">// == my name is weiyigeek - $&#123;project&#125;</span></span><br><span class="line">    <span class="comment">// (4) 多行字符串输出</span></span><br><span class="line">    echo <span class="string">"$&#123;line&#125;"</span> <span class="comment">/* ==</span></span><br><span class="line"><span class="comment">    Line one</span></span><br><span class="line"><span class="comment">    Line $&#123;project&#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// (5) 变量对象属性输出</span></span><br><span class="line">    echo <span class="string">"$person.name is $person.age years old"</span> <span class="comment">// == WeiyiGeek is 96 years old</span></span><br><span class="line">    </span><br><span class="line">    name = <span class="string">'WeiyiGeek'</span>         </span><br><span class="line">    project = <span class="string">"my name is $&#123;name&#125;"</span></span><br><span class="line">    <span class="keyword">def</span> greeting = <span class="string">"Hello $&#123;name&#125;"</span> <span class="comment">// name变量的值会被替换进去</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// (6) 字符串格式化声明</span></span><br><span class="line">    <span class="keyword">assert</span> greeting.toString()</span><br><span class="line">    println <span class="string">"$&#123;project.toString()&#125;"</span> <span class="comment">//调用方法后直接输出 ==  my name is  WeiyiGeek</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 闭包</span></span><br><span class="line">    <span class="keyword">def</span> number = <span class="number">1</span></span><br><span class="line">    <span class="keyword">def</span> eagerGString = <span class="string">"value == $&#123;number&#125;"</span>   <span class="comment">// 普通形式</span></span><br><span class="line">    <span class="keyword">def</span> lazyGString = <span class="string">"value == $&#123;-&gt; number&#125;"</span> <span class="comment">// 这是一个闭包</span></span><br><span class="line">    println eagerGString <span class="comment">// == value == 1</span></span><br><span class="line">    println lazyGString  <span class="comment">// 此处输出为空 (value == 1)</span></span><br><span class="line">    number=<span class="number">1024</span></span><br><span class="line">    echo <span class="string">"-----------------"</span></span><br><span class="line">    println eagerGString <span class="comment">// == value == 1</span></span><br><span class="line">    println lazyGString  <span class="comment">// 此处输出为空 (value == 1024)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// (7) 变量类型输出</span></span><br><span class="line">    println <span class="string">"变量name类型："</span>+name.<span class="keyword">class</span>+<span class="string">", \n 变量project类型: "</span>+project.<span class="keyword">class</span>+<span class="string">", \n 变量greeting类型: "</span>+greeting.<span class="keyword">class</span> </span><br><span class="line">    <span class="comment">/* == 变量name类型：class java.lang.String, </span></span><br><span class="line"><span class="comment">          变量project类型: class org.codehaus.groovy.runtime.GStringImpl, </span></span><br><span class="line"><span class="comment">          变量greeting类型: class org.codehaus.groovy.runtime.GStringImpl */</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// (8) 数值类型与类型强转</span></span><br><span class="line">    <span class="keyword">def</span> decimal = <span class="number">123.456</span></span><br><span class="line">    println <span class="string">"$&#123;decimal.getClass()&#125; -- $&#123;decimal&#125; "</span> <span class="comment">// ==  class java.math.BigDecimal -- 123.456</span></span><br><span class="line">    <span class="comment">//assert decimal instanceof BigDecimal</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// (9) 数组列表</span></span><br><span class="line">    <span class="keyword">def</span> arrayList = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">"number"</span>]</span><br><span class="line">    println arrayList[<span class="number">0</span>]   <span class="comment">// == 1</span></span><br><span class="line">    arrayList &lt;&lt; <span class="string">'5'</span> </span><br><span class="line">    echo <span class="string">"assert $&#123;arrayList[0]&#125; ---  $&#123;arrayList[-2]&#125; --- $&#123;arrayList[-1]&#125;"</span>   <span class="comment">// == assert 1 ---  number --- 5</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> multi = [[<span class="number">0</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">3</span>]]  <span class="comment">// 二维数组</span></span><br><span class="line">    echo <span class="string">"assert $&#123;multi[1][0]&#125;"</span>  <span class="comment">// == 2</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// (10) 字典Map</span></span><br><span class="line">    <span class="keyword">def</span> colors = [<span class="string">red:</span> <span class="string">'#FF0000'</span>, <span class="string">green:</span> <span class="string">'#00FF00'</span>, <span class="string">blue:</span> <span class="string">'#0000FF'</span>]</span><br><span class="line">    colors[<span class="string">'pink'</span>] = <span class="string">'#FF00FF'</span>  </span><br><span class="line">    colors.yellow = <span class="string">'#FFFF00'</span></span><br><span class="line">    println <span class="string">"colors 类型 : "</span>+ colors.pink.<span class="keyword">class</span> + <span class="string">", assert colors.pink : "</span> + colors.pink + <span class="string">",assert colors['yellow'] : "</span> + colors[<span class="string">'yellow'</span>]</span><br><span class="line">    <span class="comment">/*       colors 类型 : class java.lang.String, assert colors.pink : #FF00FF,assert colors['yellow'] : #FFFF00     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 如果要使用一个变量作为key（缺省为字符串），需要用括号括住：</span></span><br><span class="line">    <span class="keyword">def</span> keyVal = <span class="string">'name'</span></span><br><span class="line">    <span class="keyword">def</span> persons = [(keyVal): <span class="string">'WeiyiGeek'</span>] <span class="comment">// 相当于[ 'name' : 'WeiyiGeek' ]</span></span><br><span class="line">    println <span class="string">"key is name: "</span> + persons.containsKey(<span class="string">'name'</span>) + <span class="string">" , Key not is KeyVal : "</span> + !persons.containsKey(<span class="string">'keyVal'</span>)</span><br><span class="line">    <span class="comment">/* key is name: true , Key is  KeyVal : true */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// (11) 条件语句 - if - for - switch</span></span><br><span class="line">    <span class="keyword">if</span> ( keyVal == <span class="string">'name'</span> ) &#123;</span><br><span class="line">      echo <span class="string">"keyVal value is name"</span>   <span class="comment">// == keyVal value is name</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      echo <span class="string">"keyVal value is not name"</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (env.BRANCH_NAME == <span class="string">'master'</span>) &#123;</span><br><span class="line">      echo <span class="string">'I only execute on the master branch'</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      echo <span class="string">'I execute elsewhere'</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">      println arrayList[i]  <span class="comment">// 如果越界显示则 `null` // == 1,2,3,number,5</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> option = <span class="string">"deploy"</span></span><br><span class="line">    <span class="keyword">switch</span> (<span class="string">"$&#123;option&#125;"</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'deploy'</span>:</span><br><span class="line">          echo <span class="string">"deploy"</span>   <span class="comment">// == deploy</span></span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">'rollback'</span>:</span><br><span class="line">          echo <span class="string">"rollback"</span></span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line"><span class="symbol">      default:</span></span><br><span class="line">          echo <span class="string">"default"</span></span><br><span class="line">    &#125;</span><br><span class="line">      </span><br><span class="line">    <span class="comment">// (12) 异常捕获</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        helloWorld()  <span class="comment">// == Scripted Pipeline - Hello Wrold - STARTED - 1024!</span></span><br><span class="line">        dir(<span class="string">"place"</span>) &#123;</span><br><span class="line">            sh <span class="string">'id'</span>  <span class="comment">// == uid=112(jenkins) gid=117(jenkins) groups=117(jenkins)</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="comment">// If there was an exception thrown, the build failed</span></span><br><span class="line">        currentBuild.result = <span class="string">"FAILED"</span></span><br><span class="line">        <span class="keyword">throw</span> e</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        println <span class="string">"success or failure, always send notifications"</span>   <span class="comment">// == Success or failure, always send notifications </span></span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">// （13）函数调用 </span></span><br><span class="line">    helloWorld(<span class="string">"weiyigeek"</span>)  <span class="comment">/* Scripted Pipeline - Hello Wrold - weiyigeek - 1024! */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (13) 函数声明定义时 不能包括在node中</span></span><br><span class="line"><span class="keyword">def</span> helloWorld (String username = <span class="string">'STARTED'</span>,<span class="keyword">int</span> age = <span class="number">1024</span>) &#123;</span><br><span class="line">    println <span class="string">"Scripted Pipeline - Hello Wrold - $&#123;username&#125; - $&#123;age&#125;!"</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=2.Jenkins进阶之流水线pipeline语法入门学习 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210129121425.png" target="_blank" title="WeiyiGeek.Scripted Pipeline 示例" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210129121425.png" alt="WeiyiGeek.Scripted Pipeline 示例" title="" class=""></a>
                <p>WeiyiGeek.Scripted Pipeline 示例</p>
            </figure>
<hr>
<h3 id="2-Declarative-Pipeline-Syntax"><a href="#2-Declarative-Pipeline-Syntax" class="headerlink" title="(2) Declarative Pipeline Syntax"></a>(2) Declarative Pipeline Syntax</h3><p>描述: 前面说过<code>Declarative Pipeline</code>是 Jenkins Pipeline 的一个相对较新的补充, 它在Pipeline子系统之上提出了一种更为简化和有意义的语法。</p>
<p><code>Declarative Pipeline</code> 中的基本语句和表达式遵循与Groovy语法相同的规则 ，但有以下例外：</p>
<ul>
<li>1.Pipeline的顶层必须是块,即所有有效的<code>Declarative Pipeline</code>必须包含在一个pipeline块内.</li>
<li>2.没有分号作为语句分隔符,每个声明必须在自己的一行。</li>
<li>3.块只能包含<code>Sections, Directives, Steps</code>或赋值语句。</li>
<li>4.属性引用语句被视为无参方法调用。(例如: 输入被视为input)</li>
</ul>
<p>参考流水线语法: <a href="http://jenkins.weiyigeek.top:8080/job/simple-pipeline-demo/pipeline-syntax" target="_blank" rel="noopener">http://jenkins.weiyigeek.top:8080/job/simple-pipeline-demo/pipeline-syntax</a></p>
<p><br/></p>
<p>简单语法规范示例:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// (1) 所有代码包裹在 Pipeline 块之中</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">  <span class="comment">// (2) 定义任务在那台主机上运行可以是any、none(可以实现分布式的构建)等</span></span><br><span class="line">  agent any</span><br><span class="line">  <span class="comment">// (3) 定义的环境变量比如PATH路径</span></span><br><span class="line">  environment &#123;</span><br><span class="line">    hostname=<span class="string">'Jenkins Pipeline'</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// (4) 其类似一个大项目任务的集合主要包含所有stage子项目</span></span><br><span class="line">  stages &#123;</span><br><span class="line">    <span class="comment">// (5) 其类似一个项目中的单个任务主要来包含所有stage子任务</span></span><br><span class="line">    stage (<span class="string">'clone'</span>) &#123;</span><br><span class="line">      <span class="comment">// (6) 用来实现具体的执行的动作</span></span><br><span class="line">      steps &#123;</span><br><span class="line">        <span class="comment">// (7) 内置命令执行(信息打印)</span></span><br><span class="line">        echo <span class="string">"git Clone Stage!"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage (<span class="string">'build'</span>) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        <span class="comment">// (8) shell 命令执行 (Shell Script)</span></span><br><span class="line">        sh <span class="string">"echo $hostname"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// (9) 消息通知</span></span><br><span class="line">  post &#123;</span><br><span class="line">    always &#123;</span><br><span class="line">      echo <span class="string">"构建成功"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>语法格式说明:</strong><br>pipeline：代表整条流水线，包含整条流水线的逻辑。</p>
<ul>
<li>agent 部分：指定流水线的执行位置（Jenkins agent）。流水线中的每个阶段都必须在某个地方（物理机、虚拟机或Docker容器）执行。</li>
<li>stage 部分：阶段，代表流水线的阶段。每个阶段都必须有名称。本例中，build就是此阶段的名称。<ul>
<li>stages 部分：流水线中多个stage的容器。stages部分至少包含一个stage。<ul>
<li>steps 部分：代表阶段中的一个或多个具体步骤（step）的容器。steps部分至少包含一个步骤。</li>
</ul>
</li>
<li>post 部分：包含的是在整个pipeline或阶段完成后一些附加的步骤 (可选)</li>
</ul>
</li>
</ul>
<p><br></p>
<h4 id="2-1-Sections-章节"><a href="#2-1-Sections-章节" class="headerlink" title="2.1) Sections - 章节"></a>2.1) Sections - 章节</h4><p>描述: 声明性 Pipeline中的节通常包含一个或多个指令或步骤(Steps)。</p>
<h5 id="agent-代理"><a href="#agent-代理" class="headerlink" title="agent - 代理"></a>agent - 代理</h5><p>描述: 指定整个Pipeline或特定阶段将在Jenkins环境中执行的位置，具体取决于该<code>agent</code> 部分的放置位置;</p>
<p><strong>语法参数:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">必须: YES</span><br><span class="line">参数：any / none / label /　node / docker / dockerfile / kubernetes</span><br><span class="line">  - 1.在任何可用的 agent 上执行Pipeline或stage</span><br><span class="line">  - 2.在pipeline块的顶层应用时，不会为整个 Pipeline运行分配全局代理，并且每个stage部分都需要包含自己的agent部分。</span><br><span class="line">  - 3.使用提供的标签在Jenkins环境中可用的代理上执行 Pipeline或阶段, 注意标签条件也可以使用。</span><br><span class="line">  - 4.node使用与lable类似</span><br><span class="line">  - 5.执行Pipeline或stage时会动态供应一个docker节点去接受Docker-based的Pipelines。</span><br><span class="line">  - 6.使用从Dockerfile源存储库中包含的容器构建的容器执行 Pipeline或阶段，Jenkinsfile 必须从多分支 Pipeline或 SCM Pipeline加载。</span><br><span class="line">  - 7.在Kubernetes集群上部署的Pod内执行 Pipeline或阶段，同样Jenkinsfile 必须从多分支 Pipeline或 SCM Pipeline加载，Pod模板在kubernetes &#123;&#125; 块内定义。</span><br><span class="line">允许：在顶层pipeline块和每个stage块中。</span><br></pre></td></tr></table></figure></p>
<p><strong>语法示例:</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line"></span><br><span class="line">  agent none</span><br><span class="line"></span><br><span class="line">  agent &#123; </span><br><span class="line">    label <span class="string">'my-label1 &amp;&amp; my-label2'</span> </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  agent &#123; node &#123; label <span class="string">'labelName'</span> &#125; &#125;  <span class="comment">// 等同于 agent &#123; label 'labelName' &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// docker 还可以接受一个args直接传递给`docker run`调用以及一个 alwaysPull 选项</span></span><br><span class="line">  <span class="comment">// registryUrl和registryCredentialsId参数 有助于指定要使用的Docker注册表及其凭据</span></span><br><span class="line">  agent &#123;</span><br><span class="line">    docker &#123;</span><br><span class="line">      image <span class="string">'maven:3-alpine'</span></span><br><span class="line">      label <span class="string">'my-defined-label'</span></span><br><span class="line">      args  <span class="string">'-v /tmp:/tmp'</span></span><br><span class="line">      registryUrl <span class="string">'https://myregistry.com/'</span></span><br><span class="line">      registryCredentialsId <span class="string">'myPredefinedCredentialsInJenkins'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// dockerfile</span></span><br><span class="line">  agent &#123;</span><br><span class="line">    <span class="comment">// 等同于 to "docker build -f Dockerfile.build --build-arg version=1.0.2 ./build/</span></span><br><span class="line">    dockerfile &#123;</span><br><span class="line">        filename <span class="string">'Dockerfile.build'</span></span><br><span class="line">        <span class="comment">// 如果要Dockerfile在另一个目录中构建，请使用以下dir选项</span></span><br><span class="line">        dir <span class="string">'build'</span></span><br><span class="line">        label <span class="string">'my-defined-label'</span></span><br><span class="line">        additionalBuildArgs  <span class="string">'--build-arg version=1.0.2'</span></span><br><span class="line">        args <span class="string">'-v /tmp:/tmp'</span></span><br><span class="line">        <span class="comment">// 同样也接受registryUrl和registryCredentialsId参数</span></span><br><span class="line">        registryUrl <span class="string">'https://myregistry.com/'</span></span><br><span class="line">        registryCredentialsId <span class="string">'myPredefinedCredentialsInJenkins'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// kubernetes: 例如如果要在其中装有Kaniko容器的容器</span></span><br><span class="line">  agent &#123;</span><br><span class="line">    kubernetes &#123;</span><br><span class="line">      label podlabel</span><br><span class="line">      yaml <span class="string">"""</span></span><br><span class="line"><span class="string">  kind: Pod</span></span><br><span class="line"><span class="string">  metadata:</span></span><br><span class="line"><span class="string">    name: jenkins-agent</span></span><br><span class="line"><span class="string">  spec:</span></span><br><span class="line"><span class="string">    containers:</span></span><br><span class="line"><span class="string">    - name: kaniko</span></span><br><span class="line"><span class="string">      image: gcr.io/kaniko-project/executor:debug</span></span><br><span class="line"><span class="string">      imagePullPolicy: Always</span></span><br><span class="line"><span class="string">      command:</span></span><br><span class="line"><span class="string">      - /busybox/cat</span></span><br><span class="line"><span class="string">      tty: true</span></span><br><span class="line"><span class="string">      volumeMounts:</span></span><br><span class="line"><span class="string">        - name: aws-secret</span></span><br><span class="line"><span class="string">          mountPath: /root/.aws/</span></span><br><span class="line"><span class="string">        - name: docker-registry-config</span></span><br><span class="line"><span class="string">          mountPath: /kaniko/.docker</span></span><br><span class="line"><span class="string">    restartPolicy: Never</span></span><br><span class="line"><span class="string">    volumes:</span></span><br><span class="line"><span class="string">      - name: aws-secret</span></span><br><span class="line"><span class="string">        secret:</span></span><br><span class="line"><span class="string">          secretName: aws-secret</span></span><br><span class="line"><span class="string">      - name: docker-registry-config</span></span><br><span class="line"><span class="string">        configMap:</span></span><br><span class="line"><span class="string">          name: docker-registry-config</span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>常用选项:</strong><br>描述: 下面可以应用于两个或者多个agent实现的选项即label、customWorkspace、reuseNode;</p>
<ul>
<li>1.label (参数:字符串): 运行 Pipeline或单个 Pipeline的标签或标签条件stage。 【此选项对node，docker和有效对dockerfile必需 node。】</li>
<li>2.customWorkspace (参数: 字符串) : 运行 Pipeline或个人 stage 这 agent 是这个自定义的工作空间内的应用，而不是默认的, 它可以是相对路径（<code>在这种情况下自定义工作空间将位于节点上的工作空间根目录下</code>），也可以是绝对路径。【此选项是有效的node，docker和dockerfile。】</li>
<li>3.reuseNode（参数: 布尔值-false）: 如果为true在同一工作空间中在 Pipeline顶级指定的节点上运行容器，而不是在整个新节点上运行</li>
<li>4.args (参数: 字符串): 要传递给的运行时参数docker run,此选项对docker和有效dockerfile。</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例1. Docker代理，声明性 Pipeline</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">  <span class="comment">// V.在具有给定名称和标签（maven:3-alpine）的新创建容器中执行此 Pipeline中定义的所有步骤。</span></span><br><span class="line">  agent &#123; docker <span class="string">'maven:3-alpine'</span> &#125; </span><br><span class="line">  stages &#123;</span><br><span class="line">      stage(<span class="string">'Example Build'</span>) &#123;</span><br><span class="line">          steps &#123;</span><br><span class="line">              sh <span class="string">'mvn -B clean verify'</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例子2.阶段级代理部分</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">  <span class="comment">/* agent none在 Pipeline的顶层进行定义可确保 不会不必要地分配执行程序。使用agent none还会强制每个stage部分包含其自己的agent部分。 */</span></span><br><span class="line">  agent none </span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">'Example Build'</span>) &#123;</span><br><span class="line">      <span class="comment">/* 使用此映像在新创建的容器中执行此阶段中的步骤。*/</span></span><br><span class="line">      agent &#123; docker <span class="string">'maven:3-alpine'</span> &#125; </span><br><span class="line">      steps &#123;</span><br><span class="line">          echo <span class="string">'Hello, Maven'</span></span><br><span class="line">          sh <span class="string">'mvn --version'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(<span class="string">'Example Test'</span>) &#123;</span><br><span class="line">      <span class="comment">/* 使用与上一阶段不同的图像在新创建的容器中执行此阶段中的步骤。 */</span></span><br><span class="line">      agent &#123; docker <span class="string">'openjdk:8-jre'</span> &#125; </span><br><span class="line">      steps &#123;</span><br><span class="line">          echo <span class="string">'Hello, JDK'</span></span><br><span class="line">          sh <span class="string">'java -version'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h5 id="stages-阶段"><a href="#stages-阶段" class="headerlink" title="stages - 阶段"></a>stages - 阶段</h5><p>描述: Stages 是 Pipeline描述的大部分“工作”所在的位置, 该部分包含一个或多个阶段指令的序列。对于连续交付过程的每个离散部分，建议stages至少包含一个阶段指令，例如Build，Test和Deploy。</p>
<p>位置&amp;参数:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">必须: YES</span><br><span class="line">参数：NONE</span><br><span class="line">允许：pipeline块内只有一次</span><br></pre></td></tr></table></figure></p>
<p>例子.阶段声明性 Pipeline<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    <span class="comment">// stages部分将典型地遵循指令，例如agent， options等</span></span><br><span class="line">    stages &#123; </span><br><span class="line">        stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">'Hello World'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Tips : 该部分必须在pipeline块内的顶层定义，但stage级使用是可选的。<br>Tips : 顶级代理和阶段代理之间的细微差别，而在options应用指令时会有所不同。</p>
<p><br></p>
<h5 id="steps-步骤"><a href="#steps-步骤" class="headerlink" title="steps - 步骤"></a>steps - 步骤</h5><p>描述: 该阶段包含在给定指令中执行的一系列一个或多个步骤 stage 之中</p>
<p>位置&amp;参数:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">必须: YES</span><br><span class="line">参数：None</span><br><span class="line">允许：每个Stage块之中</span><br></pre></td></tr></table></figure></p>
<h6 id="script-脚本"><a href="#script-脚本" class="headerlink" title="script - 脚本"></a>script - 脚本</h6><p>描述: 前面我们说过我们可在<code>Declarative Pipeline</code> 中 采用script指令来执行<code>Scripted Pipeline</code>中的一些脚本;</p>
<p>例子.单步式声明式 &amp;&amp; Script Block in Declarative Pipeline<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">          <span class="comment">// 步骤部分必须包含一个或多个步骤。</span></span><br><span class="line">          steps &#123; </span><br><span class="line">              echo <span class="string">'Hello World'</span></span><br><span class="line">              <span class="comment">// 执行 Scripted Pipeline (实际上就是直接执行并采用Groovy原生语法)</span></span><br><span class="line">              script &#123;</span><br><span class="line">                <span class="keyword">def</span> browsers = [<span class="string">'chrome'</span>, <span class="string">'firefox'</span>]</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; browsers.size(); ++i) &#123;</span><br><span class="line">                    echo <span class="string">"Testing the $&#123;browsers[i]&#125; browser"</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h6 id="sh-命令执行"><a href="#sh-命令执行" class="headerlink" title="sh - 命令执行"></a>sh - 命令执行</h6><p>描述: pipeline中获取shell命令的输出以及状态，注意其必须在steps 块以及 script 块之中</p>
<ul>
<li><p>(0) 最简单的方式最简单的方式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh <span class="string">'&lt;shell command&gt;'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>(1) 获取标准输出</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一种</span></span><br><span class="line">result = sh <span class="string">returnStdout:</span> <span class="literal">true</span> ,<span class="string">script:</span> <span class="string">"&lt;shell command&gt;"</span></span><br><span class="line">result = result.trim()</span><br><span class="line"><span class="comment">//第二种</span></span><br><span class="line">result = sh(<span class="string">script:</span> <span class="string">"&lt;shell command&gt;"</span>, <span class="string">returnStdout:</span> <span class="literal">true</span>).trim()</span><br><span class="line"><span class="comment">//第三种</span></span><br><span class="line">sh <span class="string">"&lt;shell command&gt; &gt; commandResult"</span></span><br><span class="line">result = readFile(<span class="string">'commandResult'</span>).trim()</span><br></pre></td></tr></table></figure>
</li>
<li><p>(2) 获取执行状态</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一种</span></span><br><span class="line">result = sh <span class="string">returnStatus:</span> <span class="literal">true</span> ,<span class="string">script:</span> <span class="string">"&lt;shell command&gt;"</span></span><br><span class="line">result = result.trim()</span><br><span class="line"></span><br><span class="line"><span class="comment">//第二种</span></span><br><span class="line">result = sh(<span class="string">script:</span> <span class="string">"&lt;shell command&gt;"</span>, <span class="string">returnStatus:</span> <span class="literal">true</span>).trim()</span><br><span class="line"></span><br><span class="line"><span class="comment">//第三种</span></span><br><span class="line">sh <span class="string">'&lt;shell command&gt;; echo $? &gt; status'</span></span><br><span class="line"><span class="keyword">def</span> r = readFile(<span class="string">'status'</span>).trim() <span class="comment">//值得学习</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//第四种</span></span><br><span class="line">sh <span class="string">label:</span> <span class="string">'release'</span>, <span class="string">returnStdout:</span> <span class="literal">true</span>, <span class="string">script:</span><span class="string">"""</span></span><br><span class="line"><span class="string">sudo apk add jq &amp;&amp; \</span></span><br><span class="line"><span class="string">if ( \$(curl -s --header 'PRIVATE-TOKEN: $&#123;private_token&#125;' $&#123;GITLAB_REL&#125; | jq .[].tag_name | grep -c '$&#123;params.RELEASE_VERSION&#125;') != 0 );then echo -n 1 &gt; result.txt;else echo -n 0 &gt; result.txt;fi</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">def</span> r = readFile(<span class="string">'result.txt'</span>).trim() <span class="comment">//值得学习</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意使用'但引号也可以解析变量</span></span><br><span class="line">sh(<span class="string">returnStatus:</span> <span class="literal">true</span>, <span class="string">script:</span> <span class="string">"sudo apk add jq &amp;&amp; curl -s --header 'PRIVATE-TOKEN: $&#123;private_token&#125;' $&#123;GITLAB_REL&#125; | jq .[].tag_name | grep -c '$&#123;params.RELEASE_VERSION&#125;'"</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>实际案例:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// # (1) 命令拼接</span></span><br><span class="line">sh <span class="string">' $SonarScannerHome/bin/sonar-scanner '</span> +</span><br><span class="line">    <span class="string">'-Dsonar.sources=src/main '</span> +</span><br><span class="line">    <span class="string">'-Dsonar.projectKey="test" '</span> +</span><br><span class="line">    <span class="string">'-Dsonar.projectName="test" '</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// # (2) 值传递到参数</span></span><br><span class="line">stage (<span class="string">"测试"</span>) &#123;</span><br><span class="line">  steps &#123;</span><br><span class="line">    timeout(<span class="string">time:</span> <span class="number">1</span>, <span class="string">unit:</span> <span class="string">'MINUTES'</span>) &#123;</span><br><span class="line">        script &#123;</span><br><span class="line">          <span class="keyword">def</span> RELEASE=sh <span class="string">returnStdout:</span> <span class="literal">true</span>, <span class="string">script:</span> <span class="string">'git tag -l --column'</span>   <span class="comment">// # git show --oneline --ignore-all-space --text | head -n 1</span></span><br><span class="line">          env.DEPLOY_ENV = input <span class="string">message:</span> <span class="string">"选择部署的环境的版本"</span>, <span class="string">ok:</span> <span class="string">'deploy'</span>,</span><br><span class="line"><span class="symbol">              parameters:</span> [string(<span class="string">name:</span> <span class="string">'DEPLOY_ENV'</span>,<span class="string">defaultValue:</span> <span class="string">"$&#123;RELEASE&#125;"</span>,<span class="string">description:</span> <span class="string">"可选项选择的版本 $&#123;RELEASE&#125;"</span>)]</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// # (3) 多行命令执行(值得注意在sh中得 $符号 需要采用 \$ 进行转义)</span></span><br><span class="line">stage (<span class="string">"测试"</span>) &#123;</span><br><span class="line">  steps &#123;</span><br><span class="line">      timeout(<span class="string">time:</span> <span class="number">1</span>, <span class="string">unit:</span> <span class="string">'MINUTES'</span>) &#123;</span><br><span class="line">      script &#123;</span><br><span class="line">          <span class="keyword">def</span> RELEASE=sh <span class="string">returnStdout:</span> <span class="literal">true</span>, <span class="string">script:</span> <span class="string">'git tag -l --column'</span></span><br><span class="line">          <span class="keyword">def</span> RELE=sh <span class="string">returnStdout:</span> <span class="literal">true</span>, <span class="string">script:</span> <span class="string">"""\</span></span><br><span class="line"><span class="string">          git tag -l --column | tr -d ' '  &gt; tag ;</span></span><br><span class="line"><span class="string">          export a="\$(sed "s#v#,'v#g" tag)'";</span></span><br><span class="line"><span class="string">          echo [\$&#123;a#,*&#125;];</span></span><br><span class="line"><span class="string">          """</span></span><br><span class="line">          <span class="comment">// env.DEPLOY_ENV = input message: "选择部署的环境的版本1", ok: 'deploy',</span></span><br><span class="line">          <span class="comment">//     parameters: [string(name: 'DEPLOY_ENV',defaultValue: "$&#123;RELEASE&#125;",description: "可选项选择的版本 $&#123;RELEASE&#125;")]</span></span><br><span class="line">          <span class="comment">// &#125;</span></span><br><span class="line">          println RELE <span class="comment">// ['v1.1,'v1.10,'v1.11,'v1.2,'v1.3,'v1.6,'v1.7,'v1.8,'v1.9']</span></span><br><span class="line">          <span class="comment">// 选择部署的环境的版本 ['v1.1,'v1.10,'v1.11,'v1.2,'v1.3,'v1.6,'v1.7,'v1.8,'v1.9']</span></span><br><span class="line">          env.DEPLOY_RELEASE = input <span class="string">message:</span> <span class="string">"选择部署的环境的版本 $&#123;RELE&#125;"</span>, <span class="string">ok:</span> <span class="string">'deploy'</span>,   </span><br><span class="line"><span class="symbol">          parameters:</span> [choice(<span class="string">name:</span> <span class="string">'PREJECT_OPERATION'</span>, <span class="string">choices:</span> [<span class="string">"ss"</span>,<span class="string">"s"</span>], <span class="string">description:</span> <span class="string">'Message: 选择项目版本? $&#123;RELE&#125;'</span>)]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=2.Jenkins进阶之流水线pipeline语法入门学习 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210201153324.png" target="_blank" title="WeiyiGeek.script块&sh指令联合使用" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210201153324.png" alt="WeiyiGeek.script块&sh指令联合使用" title="" class=""></a>
                <p>WeiyiGeek.script块&sh指令联合使用</p>
            </figure>
<p>Tips : 注意传递变量得生存周期以及范围，在pipeline全局中则全局有效，而stage块中则该块中有效，其他stage引用则报<code>No such property: 变量名称 for class: groovy.lang.Binding</code>错误</p>
<p><br></p>
<h5 id="post-发布"><a href="#post-发布" class="headerlink" title="post - 发布"></a>post - 发布</h5><p>描述: 本post部分定义了在 Pipeline或阶段的运行完成后运行的一个或多个其他步骤（<code>取决于该post部分在 Pipeline中的位置</code>）,即定义Pipeline或stage运行结束时的操作, 通常<code>将清理工作空间以及构建状态的消息通知(Email/钉钉、企业微信或者其他WebHook)</code>;<br>post可以支持任何以下的后置条件块：<code>always， changed，fixed，regression，aborted，failure，success， unstable，unsuccessful，和cleanup</code>, 条件块允许根据 Pipeline或阶段的完成状态在每个条件内执行步骤。</p>
<p><strong>位置&amp;参数:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">必须: NO</span><br><span class="line"></span><br><span class="line">参数：`always，changed，fixed，regression，aborted，failure，success， unstable，unsuccessful，和cleanup`</span><br><span class="line">  - always ：post不管 Pipeline运行或阶段运行的完成状态如何，都运行本节中的步骤。</span><br><span class="line">  - changed ：仅post当当前 Pipeline或阶段的运行与之前的运行具有不同的完成状态时，才运行步骤。</span><br><span class="line">  - fixed ：仅post在当前 Pipeline或阶段的运行成功并且前一运行失败或不稳定的情况下运行步骤。</span><br><span class="line">  - regression ：仅post当当前 Pipeline或阶段的运行状态为失败，不稳定或中止并且上一次运行成功时，才运行步骤。</span><br><span class="line">  - aborted ：仅post在当前 Pipeline或阶段的运行状态为“中止”时才运行步骤，通常是由于手动中止了 Pipeline。通常在网络用户界面中用灰色表示。</span><br><span class="line">  - failure ：仅post当当前 Pipeline或阶段的运行具有“失败”状态时才运行这些步骤，通常在Web UI中用红色表示。</span><br><span class="line">  - success ：仅post当当前 Pipeline或阶段的运行具有“成功”状态时才运行步骤，通常在Web UI中用蓝色或绿色表示。</span><br><span class="line">  - unstable ：仅post在当前 Pipeline或阶段的运行状态为“不稳定”（通常由测试失败，代码冲突等引起）的情况下，才运行步骤。通常在Web UI中以黄色表示。</span><br><span class="line">  - unsuccessful ：仅post当当前 Pipeline或阶段的运行状态不是“成功”时才运行步骤。这通常根据前面提到的状态在Web UI中表示。</span><br><span class="line">  - cleanup ： 在评估post所有其他条件之后post，无论 Pipeline或阶段的状态如何，都在此条件下运行步骤。</span><br><span class="line"></span><br><span class="line">允许位置：在顶层pipeline块和每个stage块中。</span><br></pre></td></tr></table></figure></p>
<p>示例.Post 部分示例:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">          <span class="built_in">echo</span> <span class="string">'Hello World'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  post &#123; </span><br><span class="line">    always &#123; </span><br><span class="line">      <span class="built_in">echo</span> <span class="string">'I will always say Hello again!'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="2-2-Directives-指令"><a href="#2-2-Directives-指令" class="headerlink" title="2.2) Directives - 指令"></a>2.2) Directives - 指令</h4><p>描述: 显然基本结构满足不了现实多变的需求。所以Jenkins pipeline通过各种指令（directive）来丰富自己。指令可以被理解为对<code>Jenkins pipeline</code>基本结构的补充。</p>
<p>Jenkins pipeline支持的指令有：</p>
<ul>
<li>environment：用于设置环境变量，可定义在stage或pipeline部分。</li>
<li>tools：可定义在pipeline或stage部分。它会自动下载并安装我们指定的工具，并将其加入PATH变量中。</li>
<li>input：定义在stage部分，会暂停pipeline，提示你输入内容。</li>
<li>options：用于配置Jenkins pipeline本身的选项，比如options {retry（3）}指当pipeline失败时再重试2次。options指令可定义在stage或pipeline部分。</li>
<li>parallel：并行执行多个step。在pipeline插件1.2版本后，parallel开始支持对多个阶段进行并行执行。</li>
<li>parameters：与input不同，parameters是执行pipeline前传入的一些参数。</li>
<li>triggers：用于定义执行pipeline的触发器。</li>
<li>when：当满足when定义的条件时，阶段才执行。</li>
</ul>
<p>Tips: 在使用指令时需要注意的是每个指令都有自己的“作用域”。如果指令使用的位置不正确Jenkins将会报错。</p>
<p><br/></p>
<h5 id="environment-环境"><a href="#environment-环境" class="headerlink" title="environment - 环境"></a>environment - 环境</h5><p>描述: 该指定了一系列键值对，这些键值对将被定义为所有步骤或特定于阶段的步骤的环境变量，具体取决于该environment指令在 Pipeline中的位置。</p>
<p><strong>位置&amp;参数:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">必须: No</span><br><span class="line">参数：Yes</span><br><span class="line">允许：在pipeline块内，或在stage指令内。</span><br></pre></td></tr></table></figure></p>
<p>Tips : <code>非常注意</code>该块中的变量将写入到Linux环境变量之中作为全局变量，在shell可通过变量名访问，而在script pipeline脚本中通过env.变量名称访问.</p>
<p><strong>支持的凭证类型：Supported Credentials Type</strong></p>
<ul>
<li>Secret Text ：设置为加密文本字符串内容</li>
<li>Secret File : 设置为临时创建的文件文件的位置, 并自动定义变量存储该文件内容。</li>
<li>Username and password : 将设置为<code>username:password</code>并且两个其他环境变量将自动定义为<code>MYVARNAME_USR 和MYVARNAME_PSW</code>。</li>
<li>SSH with Private Key : 设置为临时创建的SSH密钥文件的位置，并且可能会自动定义两个其他环境变量：<code>MYVARNAME_USR</code>和<code>MYVARNAME_PSW</code>（保留密码）。</li>
</ul>
<p><br/></p>
<p>示例1:秘密文本凭证，声明性 Pipeline<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  <span class="comment">// (1) 由于在pipeline下一层，则使用的指令将应用于 Pipeline中的所有步骤。</span></span><br><span class="line">  environment &#123; </span><br><span class="line">    CC = <span class="string">'clang'</span></span><br><span class="line">  &#125;</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">      <span class="comment">// (2) 在 stage 中定义的 environment指令只会将给定的环境变量应用于Example内的步骤。</span></span><br><span class="line">        environment &#123; </span><br><span class="line">          <span class="comment">// 在environment块中credentials('凭据名称')定义的帮助程序方法通过其在Jenkins环境中的标识符来访问预定义的凭据</span></span><br><span class="line">          AN_ACCESS_KEY = credentials(<span class="string">'my-predefined-secret-text'</span>) </span><br><span class="line">        &#125;</span><br><span class="line">        steps &#123;</span><br><span class="line">          sh <span class="string">'printenv'</span></span><br><span class="line">          echo <span class="string">"$&#123;env.AN_ACCESS_KEY&#125;"</span></span><br><span class="line">          echo <span class="string">"$&#123;env.CC&#125;"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>示例2.用户名和密码凭证<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">'Example Username/Password'</span>) &#123;</span><br><span class="line">      environment &#123;</span><br><span class="line">        <span class="comment">// 变量 = 将用户密码凭证赋予变量</span></span><br><span class="line">        SERVICE_CREDS = credentials(<span class="string">'my-predefined-username-password'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      steps &#123;</span><br><span class="line">        <span class="comment">// 注意点: defined: MYVARNAME_USR and MYVARNAME_PSW respectively.</span></span><br><span class="line">        sh <span class="string">'echo "Service user is $SERVICE_CREDS_USR"'</span></span><br><span class="line">        sh <span class="string">'echo "Service password is $SERVICE_CREDS_PSW"'</span></span><br><span class="line">        sh <span class="string">'curl -u $SERVICE_CREDS https://myservice.example.com'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(<span class="string">'Example SSH Username with private key'</span>) &#123;</span><br><span class="line">      environment &#123;</span><br><span class="line">        <span class="comment">// 变量 = 将 `ssh private` 公密钥进行赋予变量</span></span><br><span class="line">        SSH_CREDS = credentials(<span class="string">'my-predefined-ssh-creds'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      steps &#123;</span><br><span class="line">        <span class="comment">// 注意点: defined: MYVARNAME_USR and MYVARNAME_PSW (holding the passphrase).</span></span><br><span class="line">        sh <span class="string">'echo "SSH private key is located at $SSH_CREDS"'</span></span><br><span class="line">        sh <span class="string">'echo "SSH user is $SSH_CREDS_USR"'</span></span><br><span class="line">        sh <span class="string">'echo "SSH passphrase is $SSH_CREDS_PSW"'</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用内置变量 (如果变量不存在则输出null) - 值得学习注意。</span></span><br><span class="line">        echo <span class="string">"$&#123;JOB_NAME&#125;"</span></span><br><span class="line">        echo env.<span class="string">'JOB_NAME'</span></span><br><span class="line">        println(env.<span class="string">'JOB_NAME'</span>)  </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 自定义全局变量方式(写入文件中再读取)</span></span><br><span class="line">        script &#123;</span><br><span class="line">          <span class="keyword">def</span> projectProduct = sh <span class="string">returnStdout:</span> <span class="literal">true</span>, <span class="string">script:</span> <span class="string">"find $&#123;APP_NAME&#125;"</span></span><br><span class="line">          <span class="keyword">if</span> ( projectProduct != <span class="string">''</span> )&#123;</span><br><span class="line">            echo <span class="string">"$&#123;projectProduct&#125;"</span></span><br><span class="line">            writeFile <span class="string">file:</span> <span class="string">'abc.sh'</span>, <span class="string">text:</span> <span class="string">"$&#123;projectProduct&#125;"</span></span><br><span class="line">            change_id = readFile <span class="string">'abc.sh'</span></span><br><span class="line">            print(change_id)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            error <span class="string">"[-Error] : projectProduct 不能为空!"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Tips : 该指令支持特殊的<code>帮助程序方法credentials()</code>，该方法可用于在Jenkins环境中通过其标识符访问预定义的凭据。</p>
<p>Tips : 如有不支持的凭据类型导致 Pipeline失败，并显示以下消息：<code>org.jenkinsci.plugins.credentialsbinding.impl.CredentialNotFoundException: No suitable binding handler could be found for type &lt;unsupportedType&gt;.</code></p>
<p><br></p>
<h5 id="options-选项"><a href="#options-选项" class="headerlink" title="options - 选项"></a>options - 选项</h5><p>描述: options 指令 允许在 <code>Pipeline</code> 本身内配置 Pipeline 专用选项, 例如 buildDiscarder 它们也可能由插件提供;</p>
<p><strong>位置&amp;参数:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">必须: No</span><br><span class="line">参数：None</span><br><span class="line">允许：pipeline块内只有一次。</span><br></pre></td></tr></table></figure></p>
<p><strong>可用选项:</strong></p>
<ul>
<li><p>1.<code>buildDiscarder</code> ： 保存最近历史构建记录的数量。设置此选项后会自动清理pipeline 的构建历史。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; buildDiscarder(logRotator(numToKeepStr: <span class="string">'1'</span>)) &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.<code>disableConcurrentBuilds</code> : 禁止并发执行 Pipeline 对于防止同时访问共享资源等很有用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; disableConcurrentBuilds() &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.<code>checkoutToSubdirectory</code> : Jenkins从版本控制库拉取源码时，默认检出到工作空间的根目录中，此选项可以指定检出到工作空间的子目录中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; checkoutToSubdirectory(<span class="string">'foo'</span>) &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>4.<code>newContainerPerStage</code> : 当agent为docker或dockerfile时，指定在同一个Jenkins节点上，每个stage都分别运行在一个新的容器中，而不是所有stage都运行在同一个容器中。</p>
</li>
<li><p>5.<code>disableResume</code> : 如果控制器重新启动则不允许 Pipeline恢复</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; disableResume() &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>6.<code>overrideIndexTriggers</code> : 允许重写分支索引触发器的默认处理,如果在多分支或组织标签处禁用了分支索引触发器。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 仅为该作业启用分支索引触发器</span></span><br><span class="line">options &#123; overrideIndexTriggers(<span class="literal">true</span>) &#125; </span><br><span class="line"></span><br><span class="line"><span class="comment"># 仅为此作业禁用分支索引触发器</span></span><br><span class="line">options &#123; overrideIndexTriggers(<span class="literal">false</span>) &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>7.<code>preserveStashes</code>: 保留已完成构建中的隐藏项，以用于阶段重新启动。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 保存构建</span></span><br><span class="line">options &#123; preserveStashes() &#125; </span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存最近5次构建</span></span><br><span class="line">options &#123; preserveStashes(buildCount: 5) &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>8.<code>quietPeriod</code>:设置 Pipeline的静默时间段（以秒为单位），以覆盖全局默认值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; quietPeriod(30) &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>9.<code>retry</code>：如果失败重试整个 Pipeline指定次数。该次数是指总次数包括第1次失败。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; retry(3) &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>10.<code>skipDefaultCheckout</code> : 默认跳过来自源代码控制的代码（代理指令）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; skipDefaultCheckout() &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>11.<code>skipStagesAfterUnstable</code> : 一旦构建状态变得不稳定就跳过各个阶段;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; skipStagesAfterUnstable() &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>12.<code>timestamps</code> : 预定义由Pipeline生成的所有控制台输出时间</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; timestamps() &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>13.<code>parallelsAlwaysFailFast</code> ：将 Pipeline中所有后续并行阶段的failfast设置为true。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options &#123; parallelsAlwaysFailFast() &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>14.<code>timeout</code>(<code>常用</code>) : 设置 Pipeline运行的超时时间在此之后Jenkins 应中止 Pipeline(运行的超时时间)。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 操守时间一个小时(HOURS/Minute)</span></span><br><span class="line">options &#123; timeout(time: 1, unit: <span class="string">'HOURS'</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Global Timeout, Declarative Pipeline</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    options &#123;</span><br><span class="line">      // 将全局执行超时指定为一小时，然后Jenkins将中止 Pipeline运行。</span><br><span class="line">      timeout(time: 1, unit: <span class="string">'HOURS'</span>) </span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">'Hello World'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Tips: 在 stage 块中支持的 options 要少于 pipeline 块中，只能采用<code>skipDefaultCheckout，timeout，retry，timestamps</code> 等选项;</p>
<p>例如:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">            <span class="comment">// 关键单</span></span><br><span class="line">            options &#123;</span><br><span class="line">                timeout(<span class="string">time:</span> <span class="number">1</span>, <span class="string">unit:</span> <span class="string">'HOURS'</span>) </span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">'Hello World'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="parameters-参数"><a href="#parameters-参数" class="headerlink" title="parameters - 参数"></a>parameters - 参数</h5><p>描述: 该指令提供了一个用户在触发 Pipeline时应该提供的参数列表。这些用户指定参数的值通过params对象提供给 Pipeline步骤，请参阅参数，声明式 Pipeline的具体用法。</p>
<p>目前可用参数有<code>string , text, booleanParam, choice, password</code>等参数，其他高级参数化类型还需等待社区支持。</p>
<p><strong>位置&amp;参数:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">必须: No</span><br><span class="line">参数: None</span><br><span class="line">允许: 在`Pipeline`块内仅一次。</span><br></pre></td></tr></table></figure></p>
<p>Tips : <code>非常注意</code>全局参数, 在shell可通过变量名访问，而在script pipeline脚本中通过params.参数名称访问.</p>
<p><br></p>
<p><strong>示例: Parameters, Declarative Pipeline</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Parameters, Declarative Pipeline</span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Jenkins -&gt; 原生 Build With Parameters 支持</span></span><br><span class="line">    parameters &#123;</span><br><span class="line">      gitParameter <span class="string">name:</span> <span class="string">'RELEASE_VERSION'</span>, </span><br><span class="line"><span class="symbol">                      type:</span> <span class="string">'PT_BRANCH_TAG'</span>,</span><br><span class="line"><span class="symbol">                      branchFilter:</span> <span class="string">'origin/(.*)'</span>,</span><br><span class="line"><span class="symbol">                      defaultValue:</span> <span class="string">'master'</span>,</span><br><span class="line"><span class="symbol">                      selectedValue:</span> <span class="string">'DEFAULT'</span>,</span><br><span class="line"><span class="symbol">                      sortMode:</span> <span class="string">'DESCENDING_SMART'</span>,</span><br><span class="line"><span class="symbol">            description:</span> <span class="string">'Message: 请选择部署的Tags版本?'</span></span><br><span class="line">      choice(<span class="string">name:</span> <span class="string">'SONARQUBE'</span>, <span class="string">choices:</span> [<span class="string">'False'</span>,<span class="string">'True'</span>], <span class="string">description:</span> <span class="string">'Message: 是否进行代码质量检测?'</span>)				 </span><br><span class="line"> </span><br><span class="line">      <span class="comment">//  Jenkins -&gt; 原生 Build With Parameters 支持 和 BlueOcean 都支持</span></span><br><span class="line">      string(<span class="string">name:</span> <span class="string">'PERSON'</span>, <span class="string">defaultValue:</span> <span class="string">'Mr Jenkins'</span>, <span class="string">description:</span> <span class="string">'Who should I say hello to?'</span>)</span><br><span class="line"></span><br><span class="line">      text(<span class="string">name:</span> <span class="string">'BIOGRAPHY'</span>, <span class="string">defaultValue:</span> <span class="string">''</span>, <span class="string">description:</span> <span class="string">'Enter some information about the person'</span>)</span><br><span class="line"></span><br><span class="line">      booleanParam(<span class="string">name:</span> <span class="string">'TOGGLE'</span>, <span class="string">defaultValue:</span> <span class="literal">true</span>, <span class="string">description:</span> <span class="string">'Toggle this value'</span>)</span><br><span class="line"></span><br><span class="line">      choice(<span class="string">name:</span> <span class="string">'CHOICE'</span>, <span class="string">choices:</span> [<span class="string">'One'</span>, <span class="string">'Two'</span>, <span class="string">'Three'</span>], <span class="string">description:</span> <span class="string">'Pick something'</span>)</span><br><span class="line"></span><br><span class="line">      password(<span class="string">name:</span> <span class="string">'PASSWORD'</span>, <span class="string">defaultValue:</span> <span class="string">'SECRET'</span>, <span class="string">description:</span> <span class="string">'Enter a password'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                <span class="comment">// 调用</span></span><br><span class="line">                echo <span class="string">"Hello $&#123;params.PERSON&#125;"</span></span><br><span class="line"></span><br><span class="line">                echo <span class="string">"Biography: $&#123;params.BIOGRAPHY&#125;"</span></span><br><span class="line"></span><br><span class="line">                echo <span class="string">"Toggle: $&#123;params.TOGGLE&#125;"</span></span><br><span class="line"></span><br><span class="line">                echo <span class="string">"Choice: $&#123;params.CHOICE&#125;"</span></span><br><span class="line"></span><br><span class="line">                echo <span class="string">"Password: $&#123;params.PASSWORD&#125;"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=2.Jenkins进阶之流水线pipeline语法入门学习 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210201114915.png" target="_blank" title="WeiyiGeek.parameters" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210201114915.png" alt="WeiyiGeek.parameters" title="" class=""></a>
                <p>WeiyiGeek.parameters</p>
            </figure>
<p><br></p>
<h5 id="triggers-触发器"><a href="#triggers-触发器" class="headerlink" title="triggers - 触发器"></a>triggers - 触发器</h5><p>描述: 该指令定义了Pipeline自动化触发的方式，对于与GitHub或BitBucket等源集成的 Pipeline可能不需要触发器，因为基于webhook的集成可能已经存在了。</p>
<p><strong>位置&amp;参数:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">必须: No</span><br><span class="line">参数: None</span><br><span class="line">允许: 在Pipeline块内</span><br></pre></td></tr></table></figure></p>
<p>Tips : 当前可用的触发器是<code>cron、pollSCM和upstream</code>。</p>
<ul>
<li><p>1.<code>cron</code> : 以Linux中Cron风格的字符串，以定义应该重新触发 Pipeline的定期间隔</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">triggers &#123; cron(<span class="string">'H */4 * * 1-5'</span>) &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.<code>pollSCM</code> : 接受cron样式的字符串以定义Jenkins应检查新源更改的定期间隔。如果存在新的更改则将重新触发 Pipeline。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">triggers &#123; pollSCM(<span class="string">'H */4 * * 1-5'</span>) &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Tips : pollSCM触发器仅在Jenkins 2.22或更高版本中可用。</li>
</ul>
</li>
<li><p>3.<code>upstream</code> : 接受以逗号分隔的作业字符串和阈值。当字符串中的任何作业以最小阈值结束时 Pipeline将被重新触发</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">triggers &#123; upstream(<span class="string">upstreamProjects:</span> <span class="string">'job1,job2'</span>, <span class="string">threshold:</span> hudson.model.Result.SUCCESS) &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<p><strong>cron语法</strong><br>描述: Jenkins cron语法遵循cron实用程序的语法（略有不同）。具体来说每行包含5个由TAB或空格分隔的字段：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* * * * * </span><br><span class="line">MINUTE - Minutes within the hour (0–59)</span><br><span class="line"></span><br><span class="line">HOUR   - The hour of the day (0–23)</span><br><span class="line"></span><br><span class="line">DAY	   - The day of the month (1–31)</span><br><span class="line"></span><br><span class="line">MONTH  - The month (1–12)</span><br><span class="line"></span><br><span class="line">WEEK   - The day of the week (0–7) <span class="built_in">where</span> 0 and 7 are Sunday.</span><br></pre></td></tr></table></figure></p>
<p>如果要为一个字段指定多个值，可以使用以下操作符。按照优先顺序，<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">*   specifies all valid values  (指定所有有效值)</span><br><span class="line"></span><br><span class="line">M-N specifies a range of values (指定值范围)</span><br><span class="line"></span><br><span class="line">M-N/X or */X steps by intervals of X through the specified range or whole valid range (在指定范围或整个有效范围内按X的间隔步进)</span><br><span class="line"></span><br><span class="line">A,B,…​,Z enumerates multiple values (枚举多个值)</span><br></pre></td></tr></table></figure></p>
<p>Tips : 在 Cron 中使用 H 字符为了使定期计划的任务在系统上产生均匀的负载，H符号可以被认为是在一定范围内的随机值。<br>例如<code>使用0 0 * * *一打日常工作将导致午夜时分大幅增加</code>。相反使用<code>H H * * *仍会每天执行一次每个作业，但不是同时执行所有作业，更好地使用有限的资源</code>。</p>
<p>Tips : 此外<code>@yearly，@annually，@monthly， @weekly，@daily，@midnight</code>，并且@hourly也支持方便的别名。这些使用哈希系统进行自动平衡。<br>例如 @hourly与相同，H <em> </em> <em> </em>并且可能表示该小时中的任何时间, @midnight实际上是指在12:00 AM和2:59 AM之间的某个时间。</p>
<p><br></p>
<p><strong>示例.Triggers, Declarative Pipeline:</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// (1) Jenkins cron语法示例</span></span><br><span class="line"><span class="comment">// 每十五分钟执行触发</span></span><br><span class="line">triggers&#123; cron(<span class="string">'H/15 * * * *'</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每小时（1~30分钟）内每十分钟一次</span></span><br><span class="line">triggers&#123; cron(<span class="string">'H(0-29)/10 * * * *'</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每隔一个小时的45分钟，每两小时一次，从上午9:45开始，到每个工作日的下午3:45结束。</span></span><br><span class="line">triggers&#123; cron(<span class="string">'45 9-16/2 * * 1-5'</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每个工作日的上午9点至下午5点之间每两小时一次</span></span><br><span class="line">triggers&#123; cron(<span class="string">'H H(9-16)/2 * * 1-5'</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每月12月1日和15日每天一次</span></span><br><span class="line">triggers&#123; cron(<span class="string">'H H 1,15 1-11 *'</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//(2) Declarative Pipeline</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    triggers &#123;</span><br><span class="line">      cron(<span class="string">'H */4 * * 1-5'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">'Hello World'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="stage-单阶段"><a href="#stage-单阶段" class="headerlink" title="stage - 单阶段"></a>stage - 单阶段</h5><p>描述: 该 stage 指令位于stages中并且应包含<code>Step 节</code>，可选 <code>agent 节</code>或其他特定于阶段的指令, 实际上管道完成的所有实际工作都将包含在一个或多个stage指令中。</p>
<p><strong>位置&amp;参数:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">必须: YES</span><br><span class="line">参数: 步骤名称(字符串、必填)</span><br><span class="line">允许: 在 Pipeline块 -&gt; stages部分 内</span><br></pre></td></tr></table></figure></p>
<p><strong>示例.stage , Declarative Pipeline</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Declarative </span></span><br><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        echo <span class="string">'Hello World'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="Tools-工具"><a href="#Tools-工具" class="headerlink" title="Tools - 工具"></a>Tools - 工具</h5><p>描述: 定义自定义安装的Tools工具路径，并放置环境变量到PATH。如果agent none 这将被忽略<br>Supported Tools(Global Tool Configuration) : maven / jdk / gradle / Sonarqube</p>
<p><strong>位置&amp;参数:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">必须: No</span><br><span class="line">参数: None</span><br><span class="line">允许: 在 Pipeline 块 或者 stage 部分 内</span><br></pre></td></tr></table></figure></p>
<p><strong>示例.Tools ，声明性管道</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    tools &#123;</span><br><span class="line">      <span class="comment">// 工具名称必须在Jenkins中的 Manage Jenkins → Global Tool Configuration 下预先配置。</span></span><br><span class="line">      maven <span class="string">'apache-maven-3.0.1'</span> </span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">      stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">        steps &#123;</span><br><span class="line">          sh <span class="string">'mvn --version'</span></span><br><span class="line">          script &#123;</span><br><span class="line">            <span class="comment">// 无指定名称时可用采用tool指定设置的全局工具名称，这里这个tool是直接根据名称，获取自动安装的插件的路径</span></span><br><span class="line">            <span class="keyword">def</span> scannerHome = tool <span class="string">'sonarqubescanner'</span></span><br><span class="line">          &#125;</span><br><span class="line">          withSonarQubeEnv(<span class="string">'SonarQube'</span>) &#123;</span><br><span class="line">            sh <span class="string">"$&#123;scannerHome&#125;/bin/sonar-scanner -Dsonar.projectKey=YourProjectKey -Dsonar.sources=."</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="Input-输入"><a href="#Input-输入" class="headerlink" title="Input - 输入"></a>Input - 输入</h5><p>描述: input指令允许您使用输入步骤提示输入。在应用了任何选项之后，在进入该阶段的代理块或评估该阶段的when条件之前，该阶段将暂停。如果输入被批准，该阶段将继续。作为输入提交的一部分提供的任何参数都将在该阶段的其余部分的环境中可用。</p>
<p><strong>位置&amp;参数:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">必须: No</span><br><span class="line">参数: message 、id 、ok、submitter、submitterParameter、parameters</span><br><span class="line">允许: 在 Pipeline块 -&gt; stages 块内 （注意不是在stage中）</span><br></pre></td></tr></table></figure></p>
<p><strong>配置选项</strong></p>
<ul>
<li>message : 必须的前台输入时提示用户的信息;</li>
<li>id : 此输入的可选标识符。默认为阶段名称。</li>
<li>ok : 输入表单上“确定”按钮的可选文本。</li>
<li>Parameter : 提示提交者提供的可选参数列表。请参阅<a href="https://www.jenkins.io/doc/book/pipeline/syntax/#parameters" target="_blank" rel="noopener">参数</a>以获取更多信息。</li>
<li>submitter : 可选的用逗号分隔的用户或允许输入此输入的外部组名的列表,默认为允许任何用户。</li>
<li>submitterParameter : 可以使用提交者名称设置的环境变量的可选名称（如果存在）。</li>
</ul>
<p>基础示例:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">'Example'</span>) &#123;</span><br><span class="line">      <span class="comment">// 方式1.此种方式只能该块有效</span></span><br><span class="line">      input &#123;</span><br><span class="line">        message <span class="string">"Title : 个人信息输入"</span></span><br><span class="line">        ok <span class="string">"完成提交"</span></span><br><span class="line">        submitter <span class="string">"alice,bob"</span></span><br><span class="line">        parameters &#123;</span><br><span class="line">          string(<span class="string">name:</span> <span class="string">'INPUT_PERSON'</span>, <span class="string">defaultValue:</span> <span class="string">'WeiyiGeek'</span>, <span class="string">description:</span> <span class="string">'Message: 请输入您的姓名?'</span>)</span><br><span class="line">          string(<span class="string">name:</span> <span class="string">'INPUT_AGE'</span>, <span class="string">defaultValue:</span> <span class="string">'WeiyiGeek'</span>, <span class="string">description:</span> <span class="string">'Message: 请输入您的年龄?'</span>)</span><br><span class="line">          choice(<span class="string">name:</span> <span class="string">'INPUT_SEX'</span>, <span class="string">choices:</span> [<span class="string">'Male'</span>,<span class="string">'Female'</span>], <span class="string">description:</span> <span class="string">'Message: 请选择你的性别?'</span>)</span><br><span class="line">          booleanParam(<span class="string">name:</span> <span class="string">'INPUT_AGREE'</span>, <span class="string">defaultValue:</span> <span class="literal">true</span>, <span class="string">description:</span> <span class="string">'Message: 是否确定协议?'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      steps &#123;</span><br><span class="line">        <span class="comment">// 方式2: 注意script必须包含在 steps 块之中(此种方式可以全局传递参数)</span></span><br><span class="line">        script &#123;</span><br><span class="line">          env.git_version=input <span class="string">message:</span> <span class="string">'Titel: 版本'</span>, <span class="string">ok:</span> <span class="string">'通过'</span>,<span class="string">parameters:</span> [string ( <span class="string">name:</span> <span class="string">'git_version'</span>, <span class="string">trim:</span> <span class="literal">true</span>, <span class="string">description:</span> <span class="string">'Message : 请选择要操作的应用版本?'</span>)];</span><br><span class="line"></span><br><span class="line">          env.deploy_option = input <span class="string">message:</span> <span class="string">'Titel: 操作'</span>, <span class="string">ok:</span> <span class="string">'deploy'</span>, <span class="string">parameters:</span> [choice(<span class="string">name:</span> <span class="string">'deploy_option'</span>, <span class="string">choices:</span> [<span class="string">'deploy'</span>, <span class="string">'rollback'</span>, <span class="string">'redeploy'</span>], <span class="string">description:</span> <span class="string">'Message : 请选择操作流程?'</span>)];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 12.input 输出示例</span></span><br><span class="line">        echo <span class="string">"局部可用 输出示例1: 姓名：$&#123;INPUT_PERSON&#125;, 年龄：$&#123;INPUT_AGE&#125;, 性别：$&#123;INPUT_SEX&#125;, 是否同意协议: $&#123;INPUT_AGREE&#125;"</span></span><br><span class="line"></span><br><span class="line">        echo <span class="string">"全局可用 输出示例(script) -&gt; 版本 : $&#123;env.git_version&#125;"</span></span><br><span class="line">        echo <span class="string">"全局可用 输出示例(script) -&gt; 版本 : $&#123;env.deploy_option&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 采用script块中定义input可以调用不同stage中得参数值</span></span><br><span class="line">  stage (<span class="string">'调用'</span>) &#123;</span><br><span class="line">    steps &#123;</span><br><span class="line">      echo <span class="string">"调用1 : $&#123;env.git_version&#125;"</span></span><br><span class="line">      echo <span class="string">"调用2 : $&#123;env.deploy_option&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=2.Jenkins进阶之流水线pipeline语法入门学习 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210131162014.png" target="_blank" title="WeiyiGeek.实际案例" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210131162014.png" alt="WeiyiGeek.实际案例" title="" class=""></a>
                <p>WeiyiGeek.实际案例</p>
            </figure>
<p><br></p>
<h5 id="when-执行条件"><a href="#when-执行条件" class="headerlink" title="when - 执行条件"></a>when - 执行条件</h5><p>描述: 该指令允许管道根据给定条件确定是否应执行该阶段，when指令必须至少包含一个条件，如果when指令包含多个条件，则<code>所有子条件必须返回true才能执行该阶段</code>;</p>
<p>使用嵌套条件构建更复杂的条件结构:<code>not，allOf或anyOf</code>,嵌套条件可以嵌套到任意深度。</p>
<ul>
<li>1.如果使用allOf条件，则表示所有条件为真才继续执行。</li>
<li>2.如果使用anyOf条件，请注意一旦找到第一个“真”条件，该条件将跳过其余测试。</li>
<li>3.使用使用not条件是，则当条件为false是为真才进行执行</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.不匹配分支</span></span><br><span class="line">when &#123; not &#123; branch <span class="string">'master'</span> &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.分别满足分支为master并且DEPLOY_TO环境变量值为production是继续执行</span></span><br><span class="line">when &#123; allOf &#123; branch <span class="string">'master'</span>; environment <span class="string">name:</span> <span class="string">'DEPLOY_TO'</span>, <span class="string">value:</span> <span class="string">'production'</span> &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.满足分支为master或者分支为staging都可以继续执行.</span></span><br><span class="line">when &#123; anyOf &#123; branch <span class="string">'master'</span>; branch <span class="string">'staging'</span> &#125; &#125;</span><br></pre></td></tr></table></figure>
<p><strong>位置&amp;参数:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">必须: No</span><br><span class="line">参数: Express</span><br><span class="line">允许: 在 Pipeline块 -&gt; stage 块内</span><br></pre></td></tr></table></figure></p>
<p><strong>内置条件:</strong></p>
<ul>
<li><p>branch : 当正在构建的分支与给出的分支模式匹配时执行,请注意这仅适用于多分支管道;</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">when &#123; branch <span class="string">'master'</span> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>environment : 当指定的环境变量设置为给定值时执行，</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">when &#123; expression &#123; <span class="keyword">return</span> params.DEBUG_BUILD &#125; &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>equals : 当期望值等于实际值时执行阶段，</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">when &#123; equals <span class="string">expected:</span> <span class="number">2</span>, <span class="string">actual:</span> currentBuild.number &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>expression : 在指定的Groovy表达式计算为true时执行阶段, 注意当从表达式返回字符串时，它们必须被转换为布尔值，或者返回null来计算为false。<code>简单地返回&quot;0&quot;或&quot;false&quot;仍然会计算为&quot;true&quot;</code>。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">when &#123; expression &#123; <span class="keyword">return</span> params.DEBUG_BUILD &#125; &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Tag : 如果TAG_NAME变量匹配给定的模式则执行该阶段, 注意如果提供了一个空模式，那么阶段将在TAG_NAME变量存在时执行(与buildingTag()相同)。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">when &#123; tag <span class="string">"release-*"</span> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>buildingTag : 执行构建构建标签的阶段.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">when &#123; buildingTag() &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>changelog : 如果构建的SCM更改日志包含给定的正则表达式模式则执行阶段;</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">when &#123; changelog <span class="string">'.*^\\[DEPENDENCY\\] .+$'</span> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>changeset : 如果构建的SCM变更集包含一个或多个与给定模式匹配的文件，则执行阶段。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">when &#123; changeset <span class="string">"**/*.js"</span> &#125;</span><br><span class="line">when &#123; changeset <span class="string">pattern:</span> <span class="string">".TEST\\.java"</span>, <span class="string">comparator:</span> <span class="string">"REGEXP"</span> &#125;  <span class="comment">// 正则表达式匹配</span></span><br><span class="line">when &#123; changeset <span class="string">pattern:</span> <span class="string">"*/*TEST.java"</span>, <span class="string">caseSensitive:</span> <span class="literal">true</span> &#125;   <span class="comment">// 区分大小写ANT样式路径</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>changeRequest : 如果当前构建是针对“变更请求”的，则执行阶段（也称为GitHub和Bitbucket上的Pull Request，GitLab上的Merge Request，Gerrit变更等）。如果未传递任何参数，则阶段将在每个更改请求上运行</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">when &#123; changeRequest() &#125;.</span><br><span class="line"><span class="comment">// # Possible attributes are `id, target, branch, fork, url, title, author, authorDisplayName, and authorEmail`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 每一个都对应一个CHANGE_*环境变量，</span></span><br><span class="line">when &#123; changeRequest <span class="string">target:</span> <span class="string">'master'</span> &#125;.</span><br><span class="line"></span><br><span class="line"><span class="comment">// comparator 参数后指导属性，以指定匹配时如何计算任何模式:</span></span><br><span class="line"><span class="comment">// * EQUALS用于简单的字符串比较(默认值)，</span></span><br><span class="line"><span class="comment">// * GLOB用于ANT风格的路径GLOB(与例如changeset相同)，</span></span><br><span class="line"><span class="comment">// * REGEXP用于正则表达式匹配</span></span><br><span class="line">when &#123; changeRequest <span class="string">authorEmail:</span> <span class="string">"[\\w_-.]+@example.com"</span>, <span class="string">comparator:</span> <span class="string">'REGEXP'</span> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>triggeredBy : 在给定的参数触发当前构建时执行该阶段。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">when &#123; triggeredBy <span class="string">'SCMTrigger'</span> &#125;</span><br><span class="line"></span><br><span class="line">when &#123; triggeredBy <span class="string">'TimerTrigger'</span> &#125;</span><br><span class="line"></span><br><span class="line">when &#123; triggeredBy <span class="string">'UpstreamCause'</span> &#125;</span><br><span class="line"></span><br><span class="line">when &#123; triggeredBy <span class="string">cause:</span> <span class="string">"UserIdCause"</span>, <span class="string">detail:</span> <span class="string">"vlinde"</span> &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>优先级说明</strong></p>
<ul>
<li><p>1.when在input指令前评估 : 默认情况下，如果定义了阶段则在输入之前不会评估阶段的when条件。但是可以通过beforeInput在when块中指定选项来更改此设置。<code>如果beforeInput设置为true，则将首先评估when条件并且仅当when条件评估为true时才输入</code>。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent none</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'Example Build'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">'Hello World'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">'Example Deploy'</span>) &#123;</span><br><span class="line">            when &#123;</span><br><span class="line">                beforeInput <span class="literal">true</span>    <span class="comment">// 关键点</span></span><br><span class="line">                branch <span class="string">'production'</span></span><br><span class="line">            &#125;</span><br><span class="line">            input &#123;</span><br><span class="line">                message <span class="string">"Deploy to production?"</span></span><br><span class="line">                id <span class="string">"simple-input"</span></span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">'Deploying'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.when在options指令前评估 : 默认情况下，when一个条件stage会进入之后进行评价options为stage，如果任何限定。但是可以通过beforeOptions在when 块中指定选项来更改此设置。<code>如果beforeOptions将设置为true，when则将首先评估条件，并且options仅在 when 条件评估为true时才输入</code>。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent none</span><br><span class="line">    stages &#123;</span><br><span class="line">      stage(<span class="string">'Example Build'</span>) &#123;</span><br><span class="line">          steps &#123;</span><br><span class="line">              echo <span class="string">'Hello World'</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      stage(<span class="string">'Example Deploy'</span>) &#123;</span><br><span class="line">          when &#123;</span><br><span class="line">              beforeOptions <span class="literal">true</span>   <span class="comment">// 关键点</span></span><br><span class="line">              branch <span class="string">'testing'</span></span><br><span class="line">          &#125;</span><br><span class="line">          options &#123;</span><br><span class="line">              lock <span class="string">label:</span> <span class="string">'testing-deploy-envs'</span>, <span class="string">quantity:</span> <span class="number">1</span>, <span class="string">variable:</span> <span class="string">'deployEnv'</span></span><br><span class="line">          &#125;</span><br><span class="line">          steps &#123;</span><br><span class="line">              echo <span class="string">"Deploying to $&#123;deployEnv&#125;"</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.when在stage进入agent前评估 : 默认情况下，如果定义了一个阶段的when条件，那么将在进入该阶段的代理之后计算。但是，这可以通过在when块中指定beforeAgent选项来更改。<code>如果beforeAgent被设置为true，那么将首先计算when条件，只有当when条件计算为true时才会输入agent</code>。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent none</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'Example Build'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">'Hello World'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">'Example Deploy'</span>) &#123;</span><br><span class="line">            agent &#123;</span><br><span class="line">                label <span class="string">"some-label"</span></span><br><span class="line">            &#125;</span><br><span class="line">            when &#123;</span><br><span class="line">                beforeAgent <span class="literal">true</span></span><br><span class="line">                branch <span class="string">'production'</span></span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">'Deploying'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>示例.Condition When</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent none  <span class="comment">// beforeAgent</span></span><br><span class="line">    stages &#123;</span><br><span class="line">      stage(<span class="string">'Example Build'</span>) &#123;</span><br><span class="line">        steps &#123;</span><br><span class="line">          echo <span class="string">'Hello World'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      stage(<span class="string">'Example Deploy'</span>) &#123;</span><br><span class="line">        <span class="comment">// Single Condition - 单一条件</span></span><br><span class="line">        when &#123;</span><br><span class="line">          branch <span class="string">'production'</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Multiple Condition - 多重条件</span></span><br><span class="line">        when &#123;</span><br><span class="line">          branch <span class="string">'production'</span></span><br><span class="line">          environment <span class="string">name:</span> <span class="string">'DEPLOY_TO'</span>, <span class="string">value:</span> <span class="string">'production'</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Nested condition - 嵌套条件</span></span><br><span class="line">        when &#123;</span><br><span class="line">          allOf &#123;</span><br><span class="line">            branch <span class="string">'production'</span></span><br><span class="line">            environment <span class="string">name:</span> <span class="string">'DEPLOY_TO'</span>, <span class="string">value:</span> <span class="string">'production'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Multiple condition and nested condition - 注意点</span></span><br><span class="line">        when &#123;</span><br><span class="line">            branch <span class="string">'production'</span></span><br><span class="line">            anyOf &#123;</span><br><span class="line">                environment <span class="string">name:</span> <span class="string">'DEPLOY_TO'</span>, <span class="string">value:</span> <span class="string">'production'</span></span><br><span class="line">                environment <span class="string">name:</span> <span class="string">'DEPLOY_TO'</span>, <span class="string">value:</span> <span class="string">'staging'</span></span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Expression condition and nested condition  - 表达式条件和嵌套条件</span></span><br><span class="line">        when &#123;</span><br><span class="line">          expression &#123; BRANCH_NAME ==~ <span class="regexp">/(production|staging)/</span> &#125;</span><br><span class="line">          anyOf &#123;</span><br><span class="line">              environment <span class="string">name:</span> <span class="string">'DEPLOY_TO'</span>, <span class="string">value:</span> <span class="string">'production'</span></span><br><span class="line">              environment <span class="string">name:</span> <span class="string">'DEPLOY_TO'</span>, <span class="string">value:</span> <span class="string">'staging'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// triggeredBy</span></span><br><span class="line">        when &#123;</span><br><span class="line">          triggeredBy <span class="string">"TimerTrigger"</span>  <span class="comment">// 当前Job设置的触发器名称进行监控</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当前面的when都满足时采用执行该阶段步骤，否则丢弃</span></span><br><span class="line">        steps &#123;</span><br><span class="line">            echo <span class="string">'Deploying'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Tips : GLOB（对于默认）对于不区分大小写的ANT样式路径所以可以使用caseSensitive参数将其关闭；</p>
<p><br></p>
<h4 id="2-3-Sequential-Stages-顺序阶段"><a href="#2-3-Sequential-Stages-顺序阶段" class="headerlink" title="2.3) Sequential Stages - 顺序阶段"></a>2.3) Sequential Stages - 顺序阶段</h4><p>描述: 声明式管道中的阶段可能有一个包含要按顺序运行的嵌套阶段列表的stage节。注意，一个阶段必须有且只有一个<code>步骤、阶段、并行或 Matrix</code>。如果stage指令嵌套在一个并行块或 Matrix 块本身中，  <code>则不可能在stage指令中嵌套一个并行块或 Matrix 块</code>。然而一个并行或 Matrix 块中的stage指令可以使用stage的所有其他功能，包括代理、工具、when等。</p>
<p><strong>示例:Sequential Stages, Declarative Pipeline</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent none</span><br><span class="line">    stages &#123;</span><br><span class="line">        <span class="comment">// 非时序的阶段</span></span><br><span class="line">        stage(<span class="string">'Non-Sequential Stage'</span>) &#123;</span><br><span class="line">            agent &#123;</span><br><span class="line">                label <span class="string">'for-non-sequential'</span></span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">"On Non-Sequential Stage"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 顺序阶段</span></span><br><span class="line">        stage(<span class="string">'Sequential Stage'</span>) &#123;</span><br><span class="line">            agent &#123;</span><br><span class="line">                label <span class="string">'for-sequential'</span></span><br><span class="line">            &#125;</span><br><span class="line">            environment &#123;</span><br><span class="line">                FOR_SEQUENTIAL = <span class="string">"some-value"</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 注意点1:</span></span><br><span class="line">            stages &#123;</span><br><span class="line">                stage(<span class="string">'In Sequential 1'</span>) &#123;</span><br><span class="line">                    steps &#123;</span><br><span class="line">                        echo <span class="string">"In Sequential 1"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                stage(<span class="string">'In Sequential 2'</span>) &#123;</span><br><span class="line">                    steps &#123;</span><br><span class="line">                        echo <span class="string">"In Sequential 2"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 注意点2:可以使用stage的所有其他功能，包括代理、工具、when等</span></span><br><span class="line">                stage(<span class="string">'Parallel In Sequential'</span>) &#123;</span><br><span class="line">                    <span class="comment">// 并行执行上面已讲述</span></span><br><span class="line">                    parallel &#123;</span><br><span class="line">                        stage(<span class="string">'In Parallel 1'</span>) &#123;</span><br><span class="line">                            steps &#123;</span><br><span class="line">                                echo <span class="string">"In Parallel 1"</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        stage(<span class="string">'In Parallel 2'</span>) &#123;</span><br><span class="line">                            steps &#123;</span><br><span class="line">                                echo <span class="string">"In Parallel 2"</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="2-4-Parallel-并行"><a href="#2-4-Parallel-并行" class="headerlink" title="2.4) Parallel - 并行"></a>2.4) Parallel - 并行</h4><p>描述:声明式管道中的阶段可能有一个包含要并行运行的嵌套阶段列表的并行部分。注意，一个阶段必须有且只有一个步骤、阶段、并行或 Matrix 。如果stage指令嵌套在一个并行块或 Matrix 块本身中，则不可能在stage指令中嵌套一个并行块或 Matrix 块。然而，一个并行或 Matrix 块中的stage指令可以使用stage的所有其他功能，包括代理、工具、when等。</p>
<p>Tips : 此外，通过在包含并行的阶段中添加<code>failFast true</code>，可以在任何一个阶段失败时强制终止所有并行阶段。添加<code>failfast</code> 的另一个选项是在管道定义中<code>添加一个option{ parallelsAlwaysFailFast() }</code></p>
<p><strong>示例:Parallel Stages, Declarative Pipeline</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    <span class="comment">//方式1.parallelsAlwaysFailFast</span></span><br><span class="line">    options &#123;</span><br><span class="line">        parallelsAlwaysFailFast()</span><br><span class="line">    &#125; </span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'Non-Parallel Stage'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">'This stage will be executed first.'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">'Parallel Stage'</span>) &#123;</span><br><span class="line">            when &#123;</span><br><span class="line">                branch <span class="string">'master'</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 方式2.在任何一个阶段失败时强制终止所有并行阶段</span></span><br><span class="line">            failFast <span class="literal">true</span></span><br><span class="line">            <span class="comment">// 并行构建值得学习</span></span><br><span class="line">            parallel &#123;</span><br><span class="line">                stage(<span class="string">'Branch A'</span>) &#123;</span><br><span class="line">                    agent &#123;</span><br><span class="line">                        label <span class="string">"for-branch-a"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    steps &#123;</span><br><span class="line">                        echo <span class="string">"On Branch A"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                stage(<span class="string">'Branch B'</span>) &#123;</span><br><span class="line">                    agent &#123;</span><br><span class="line">                        label <span class="string">"for-branch-b"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    steps &#123;</span><br><span class="line">                        echo <span class="string">"On Branch B"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                stage(<span class="string">'Branch C'</span>) &#123;</span><br><span class="line">                    agent &#123;</span><br><span class="line">                        label <span class="string">"for-branch-c"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    stages &#123;</span><br><span class="line">                        stage(<span class="string">'Nested 1'</span>) &#123;</span><br><span class="line">                            steps &#123;</span><br><span class="line">                                echo <span class="string">"In stage Nested 1 within Branch C"</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        stage(<span class="string">'Nested 2'</span>) &#123;</span><br><span class="line">                            steps &#123;</span><br><span class="line">                                echo <span class="string">"In stage Nested 2 within Branch C"</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="2-5-Matrix-模型"><a href="#2-5-Matrix-模型" class="headerlink" title="2.5) Matrix - 模型"></a>2.5) Matrix - 模型</h4><p>描述: 声明式管道(Declarative pipeline)中的阶段可能有一个 Matrix 节，定义要并行运行的名称-值组合的多维 Matrix 。我们将把这些组合称为 Matrix 中的“细胞”。 Matrix 中的每个单元<code>可以包括一个或多个阶段，使用该单元的配置按顺序运行</code>。注意一个阶段必须有且只有一个步骤、阶段、并行或 Matrix 。如果stage指令嵌套在一个并行块或 Matrix 块本身中，则不可能在stage指令中嵌套一个并行块或 Matrix 块。然而，一个并行或 Matrix 块中的stage指令可以使用stage的所有其他功能，包括代理、工具、when等。</p>
<p>此外，通过在包含 Matrix 的阶段同样也可添加 <code>failFast true</code>，您可以强制您的 Matrix 单元在其中任何一个失败时全部终止。添加failfast的另一个选项是在管道定义中添加一个<code>option { parallelsAlwaysFailFast() }</code> Matrix 部分必须包括一个轴部分和一个级部分。</p>
<ul>
<li>axis部分定义了 Matrix 中每个轴的值。</li>
<li>stage部分定义了要在每个单元格中按顺序运行的阶段列表。</li>
</ul>
<p>Tips : 同时Matrix 可以有一个exclude节来<code>移除无效的单元格</code>, 舞台上可用的许多指令，包括代理、工具、何时等，也可以添加到matrix中来控制每个单元格的行为。</p>
<p><br></p>
<p><strong>axis</strong><br>描述: axes(轴线)部分<code>指定了一个或多个axis指令</code>。每个轴由一个名称和一个值列表组成。每个轴上的所有值都与其他轴上的值组合起来生成单元格。</p>
<p><br></p>
<p><strong>stages</strong><br>描述: 该阶段部分指定每个单元中要顺序执行的一个或多个阶段, 此部分与前面任何stages是相同的;</p>
<p>示例: Matrix<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// One-axis with 3 cells, each cell runs three stages - "build", "test", and "deploy"</span></span><br><span class="line">matrix &#123;</span><br><span class="line">    axes &#123;</span><br><span class="line">      axis &#123;</span><br><span class="line">        name <span class="string">'PLATFORM'</span></span><br><span class="line">        values <span class="string">'linux'</span>, <span class="string">'mac'</span>, <span class="string">'windows'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'build'</span>) &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">'test'</span>) &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">'deploy'</span>) &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Three-axis matrix with 24 cells (three by four by two)</span></span><br><span class="line"><span class="comment">// 即 24 种组合方式: 例如 linux -&gt; 32-bit -&gt; chrome , mac -&gt; 32-bit -&gt; chrome </span></span><br><span class="line">matrix &#123;</span><br><span class="line">  axes &#123;</span><br><span class="line">    axis &#123;</span><br><span class="line">        name <span class="string">'PLATFORM'</span></span><br><span class="line">        values <span class="string">'linux'</span>, <span class="string">'mac'</span>, <span class="string">'windows'</span></span><br><span class="line">    &#125;</span><br><span class="line">    axis &#123;</span><br><span class="line">        name <span class="string">'BROWSER'</span></span><br><span class="line">        values <span class="string">'chrome'</span>, <span class="string">'edge'</span>, <span class="string">'firefox'</span>, <span class="string">'safari'</span></span><br><span class="line">    &#125;</span><br><span class="line">    axis &#123;</span><br><span class="line">        name <span class="string">'ARCHITECTURE'</span></span><br><span class="line">        values <span class="string">'32-bit'</span>, <span class="string">'64-bit'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>excludes (optional) - 排出</strong><br>描述: 可选的exclude部分允许作者指定一个或多个exclude filter表达式，这些表达式选择要从扩展的矩阵单元格集合中排除的单元格(aka, sparsening)。过滤器是使用一个或多个带有名称和值列表的排除轴指令的基本指令结构来构造的。<br>exclude中的axis指令生成一组组合(类似于生成矩阵单元格)。匹配排除组合中所有值的矩阵单元格从矩阵中移除。如果提供了多个exclude指令，则每个指令将分别计算以删除单元格。</p>
<p>当处理一长串要排除的值时 exclude axis指令可以使用 notValues 代替 values.这将排除与传递给notValues的值之一不匹配的单元格。</p>
<p>示例.具有24个单元的三轴矩阵，不包括“ 32位，mac”（不包括4个单元）<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">matrix &#123;</span><br><span class="line">  axes &#123;</span><br><span class="line">      axis &#123;</span><br><span class="line">          name <span class="string">'PLATFORM'</span></span><br><span class="line">          values <span class="string">'linux'</span>, <span class="string">'mac'</span>, <span class="string">'windows'</span></span><br><span class="line">      &#125;</span><br><span class="line">      axis &#123;</span><br><span class="line">          name <span class="string">'BROWSER'</span></span><br><span class="line">          values <span class="string">'chrome'</span>, <span class="string">'edge'</span>, <span class="string">'firefox'</span>, <span class="string">'safari'</span></span><br><span class="line">      &#125;</span><br><span class="line">      axis &#123;</span><br><span class="line">          name <span class="string">'ARCHITECTURE'</span></span><br><span class="line">          values <span class="string">'32-bit'</span>, <span class="string">'64-bit'</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  excludes &#123;</span><br><span class="line">      exclude &#123;</span><br><span class="line">          axis &#123;</span><br><span class="line">              name <span class="string">'PLATFORM'</span></span><br><span class="line">              values <span class="string">'mac'</span></span><br><span class="line">          &#125;</span><br><span class="line">          axis &#123;</span><br><span class="line">              name <span class="string">'ARCHITECTURE'</span></span><br><span class="line">              values <span class="string">'32-bit'</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//排除linux和safari组合，并排除使用edge浏览器的任何非windows平台。</span></span><br><span class="line">       exclude &#123;</span><br><span class="line">          <span class="comment">// 2 cells</span></span><br><span class="line">          axis &#123;</span><br><span class="line">              name <span class="string">'PLATFORM'</span></span><br><span class="line">              values <span class="string">'linux'</span></span><br><span class="line">          &#125;</span><br><span class="line">          axis &#123;</span><br><span class="line">              name <span class="string">'BROWSER'</span></span><br><span class="line">              values <span class="string">'safari'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        exclude &#123;</span><br><span class="line">          <span class="comment">// 3 more cells and '32-bit, mac' (already excluded)</span></span><br><span class="line">          axis &#123;</span><br><span class="line">              name <span class="string">'PLATFORM'</span></span><br><span class="line">              notValues <span class="string">'windows'</span> <span class="comment">// 注意点 norValues</span></span><br><span class="line">          &#125;</span><br><span class="line">          axis &#123;</span><br><span class="line">              name <span class="string">'BROWSER'</span></span><br><span class="line">              values <span class="string">'edge'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="Matrix-单元级指令（可选）"><a href="#Matrix-单元级指令（可选）" class="headerlink" title="Matrix 单元级指令（可选）"></a>Matrix 单元级指令（可选）</h5><p>描述: 通过在Matrix本身下添加阶段级指令，用户可以有效地为每个单元配置整体环境。这些指令的行为与它们在舞台上的行为相同，但它们也可以接受矩阵为每个单元格提供的值。</p>
<p>注意 axis和exclude指令定义了组成矩阵的静态单元格集, 这组组合是在管道运行开始之前生成的。另一方面“per-cell”指令在运行时进行计算。</p>
<p><strong>directives include:</strong></p>
<ul>
<li>agent</li>
<li>environment</li>
<li>input</li>
<li>options</li>
<li>post</li>
<li>tools</li>
<li>when</li>
</ul>
<p><br></p>
<p><strong>Example.完整的矩阵示例，声明性管道</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    <span class="comment">// 参数选择</span></span><br><span class="line">    parameters &#123;</span><br><span class="line">        choice(<span class="string">name:</span> <span class="string">'PLATFORM_FILTER'</span>, <span class="string">choices:</span> [<span class="string">'all'</span>, <span class="string">'linux'</span>, <span class="string">'windows'</span>, <span class="string">'mac'</span>], <span class="string">description:</span> <span class="string">'Run on specific platform'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    agent none</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'BuildAndTest'</span>) &#123;</span><br><span class="line">            matrix &#123;</span><br><span class="line">                agent &#123;</span><br><span class="line">                    label <span class="string">"$&#123;PLATFORM&#125;-agent"</span></span><br><span class="line">                &#125;</span><br><span class="line">                when &#123; anyOf &#123;</span><br><span class="line">                    <span class="comment">// 参数选择不为空时继续执行</span></span><br><span class="line">                    expression &#123; params.PLATFORM_FILTER == <span class="string">'all'</span> &#125;</span><br><span class="line">                    expression &#123; params.PLATFORM_FILTER == env.PLATFORM &#125;</span><br><span class="line">                &#125; &#125;</span><br><span class="line">                <span class="comment">// 2 轴 (3 x 4) 十二格组合方式</span></span><br><span class="line">                axes &#123;</span><br><span class="line">                    axis &#123;</span><br><span class="line">                        name <span class="string">'PLATFORM'</span></span><br><span class="line">                        values <span class="string">'linux'</span>, <span class="string">'windows'</span>, <span class="string">'mac'</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    axis &#123;</span><br><span class="line">                        name <span class="string">'BROWSER'</span></span><br><span class="line">                        values <span class="string">'firefox'</span>, <span class="string">'chrome'</span>, <span class="string">'safari'</span>, <span class="string">'edge'</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 排除指定Matrix矩阵中的值 (排除linux和safari组合，并排除使用edge浏览器的任何非windows平台。) </span></span><br><span class="line">                <span class="comment">// 即 排除 (linux,safari) , (linux,edge) , (mac,edge) 三种情况</span></span><br><span class="line">                excludes &#123;</span><br><span class="line">                    exclude &#123;</span><br><span class="line">                        axis &#123;</span><br><span class="line">                            name <span class="string">'PLATFORM'</span></span><br><span class="line">                            values <span class="string">'linux'</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        axis &#123;</span><br><span class="line">                            name <span class="string">'BROWSER'</span></span><br><span class="line">                            values <span class="string">'safari'</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    exclude &#123;</span><br><span class="line">                        axis &#123;</span><br><span class="line">                            name <span class="string">'PLATFORM'</span></span><br><span class="line">                            notValues <span class="string">'windows'</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        axis &#123;</span><br><span class="line">                            name <span class="string">'BROWSER'</span></span><br><span class="line">                            values <span class="string">'edge'</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                stages &#123;</span><br><span class="line">                    stage(<span class="string">'Build'</span>) &#123;</span><br><span class="line">                        steps &#123;</span><br><span class="line">                            echo <span class="string">"Do Build for $&#123;PLATFORM&#125; - $&#123;BROWSER&#125;"</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    stage(<span class="string">'Test'</span>) &#123;</span><br><span class="line">                        steps &#123;</span><br><span class="line">                            echo <span class="string">"Do Test for $&#123;PLATFORM&#125; - $&#123;BROWSER&#125;"</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=2.Jenkins进阶之流水线pipeline语法入门学习 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210131135816.png" target="_blank" title="WeiyiGeek.Matrix示例" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210131135816.png" alt="WeiyiGeek.Matrix示例" title="" class=""></a>
                <p>WeiyiGeek.Matrix示例</p>
            </figure>
<p><br></p>
<h4 id="语法总结-1"><a href="#语法总结-1" class="headerlink" title="语法总结"></a>语法总结</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Declarative Pipeline Syntax Composite sample</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">  <span class="comment">// 1.由于此处没有其它jenkins slave 分布式机器则采用any进行替代</span></span><br><span class="line">  agent any</span><br><span class="line">  <span class="comment">// 7.全局环境变量</span></span><br><span class="line">  environment &#123; </span><br><span class="line">    global_env = <span class="string">'Jenkins global environment'</span></span><br><span class="line">    global_when = <span class="string">'true'</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 8.全局选项</span></span><br><span class="line">  options &#123; </span><br><span class="line">    <span class="comment">// 如果失败重试整个 Pipeline指定次数</span></span><br><span class="line">    retry(<span class="number">3</span>)</span><br><span class="line">    <span class="comment">// 在任何一个阶段失败时强制终止所有并行阶段</span></span><br><span class="line">    parallelsAlwaysFailFast()</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 9.全局参数</span></span><br><span class="line">  parameters &#123;</span><br><span class="line">    <span class="comment">// 参数声明定义</span></span><br><span class="line">    string(<span class="string">name:</span> <span class="string">'PERSON'</span>, <span class="string">defaultValue:</span> <span class="string">'Mr Jenkins'</span>, <span class="string">description:</span> <span class="string">'Who should I say hello to?'</span>)</span><br><span class="line">    booleanParam(<span class="string">name:</span> <span class="string">'TOGGLE'</span>, <span class="string">defaultValue:</span> <span class="literal">true</span>, <span class="string">description:</span> <span class="string">'Toggle this value'</span>)</span><br><span class="line">    text(<span class="string">name:</span> <span class="string">'BIOGRAPHY'</span>, <span class="string">defaultValue:</span> <span class="string">''</span>, <span class="string">description:</span> <span class="string">'Enter some information about the person'</span>)</span><br><span class="line">    choice(<span class="string">name:</span> <span class="string">'CHOICE'</span>, <span class="string">choices:</span> [<span class="string">'One'</span>, <span class="string">'Two'</span>, <span class="string">'Three'</span>], <span class="string">description:</span> <span class="string">'Pick something'</span>)</span><br><span class="line">    password(<span class="string">name:</span> <span class="string">'PASSWORD'</span>, <span class="string">defaultValue:</span> <span class="string">'SECRET'</span>, <span class="string">description:</span> <span class="string">'Enter a password'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 11.触发器 (每两分钟执行一次)</span></span><br><span class="line">  triggers&#123; cron(<span class="string">'H/2 * * * *'</span>) &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 12.工具路径并放置环境变量到PATH</span></span><br><span class="line">  <span class="comment">// Dashboard -&gt; 全局工具配置</span></span><br><span class="line">  tools &#123;</span><br><span class="line">    maven <span class="string">'maven_env'</span></span><br><span class="line">    jdk   <span class="string">'jdk_1.8.0_211'</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 2.多阶段唯一入口</span></span><br><span class="line">  stages &#123;</span><br><span class="line">    <span class="comment">// 3.指定的单阶段（init-初始化阶段）</span></span><br><span class="line">    stage (<span class="string">'init'</span>) &#123;</span><br><span class="line">      <span class="comment">// 4.单阶段中的只有一个步骤steps</span></span><br><span class="line">      steps &#123;</span><br><span class="line">        <span class="comment">// 5.内置指令例如 echo 、println进行输出</span></span><br><span class="line">        echo <span class="string">"init - steps one - built-in functions echo"</span></span><br><span class="line">        println <span class="string">"init - steps one - built-in functions println "</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6.采用script指令来执行Scripted Pipeline中的一些脚本</span></span><br><span class="line">        script &#123;</span><br><span class="line">          <span class="keyword">def</span> browsers = [<span class="string">'chrome'</span>, <span class="string">'firefox'</span>, <span class="string">'edge'</span>]</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; browsers.size(); ++i) &#123;</span><br><span class="line">              echo <span class="string">"Testing the $&#123;browsers[i]&#125; browser"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   stage (<span class="string">'one-stage'</span>) &#123;</span><br><span class="line">      <span class="comment">// 7.局部环境变量</span></span><br><span class="line">      environment &#123; </span><br><span class="line">        <span class="comment">// 变量定义</span></span><br><span class="line">        local_env = <span class="string">"Jenkins local environment"</span></span><br><span class="line">        <span class="comment">// 将在Jenkins中设置的用户密码凭证赋予local_creds变量, 注意括号中为凭据名称</span></span><br><span class="line">        <span class="comment">// Dashboard -&gt; 凭据 -&gt; 系统 -&gt; 全局凭据 (unrestricted) -&gt; 添加凭据</span></span><br><span class="line">        <span class="comment">// Username with password	: 43287e62-ce5b-489a-9c11-cedf38e16e92	weiyigeek/****** (Pipeline 测试 credentials 读取)	Username with password	Pipeline 测试 credentials 读取</span></span><br><span class="line">        Local_userpass_creds = credentials(<span class="string">'43287e62-ce5b-489a-9c11-cedf38e16e92'</span>)</span><br><span class="line">        <span class="comment">// SSH Username with private key : b4c8b4e9-2777-44a1-a1ed-e9dc21d37f4f	weiyigeek (myself-gitlab-weiyigeek)	SSH Username with private key	myself-gitlab-weiyigeek</span></span><br><span class="line">        Local_ssh_creds = credentials(<span class="string">'b4c8b4e9-2777-44a1-a1ed-e9dc21d37f4f'</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      steps &#123;</span><br><span class="line">        println <span class="string">"全局变量: "</span> + global_env +<span class="string">", 局部变量: "</span> + local_env </span><br><span class="line">        <span class="comment">/* == 全局变量: Jenkins global environment, 局部变量: Jenkins local environment*/</span></span><br><span class="line">        <span class="comment">// 注意点: defined: MYVARNAME_USR and MYVARNAME_PSW respectively. (输出的字符串已经经过转义)</span></span><br><span class="line">        sh <span class="string">'echo "user is $Local_userpass_creds_USR"'</span>      <span class="comment">/* = user is **** */</span></span><br><span class="line">        sh <span class="string">'echo "password is $Local_userpass_creds_PSW"'</span>  <span class="comment">/* = password is **** */</span></span><br><span class="line">        <span class="comment">// 注意点: defined: MYVARNAME_USR and MYVARNAME_PSW (holding the passphrase).</span></span><br><span class="line">        sh <span class="string">'echo "SSH private key is located at $Local_ssh_creds"'</span></span><br><span class="line">        sh <span class="string">'echo "SSH user is $Local_ssh_creds_USR"'</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 12.额外第三方工具插件路径调用方式</span></span><br><span class="line">        script &#123;</span><br><span class="line">          scannerHome = tool <span class="string">'sonarqubescanner'</span></span><br><span class="line">          <span class="comment">//这里这个tool是直接根据名称，获取自动安装的插件的路径</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// withSonarQubeEnv('SonarQube') &#123;</span></span><br><span class="line">        <span class="comment">//   sh "$&#123;scannerHome&#125;/bin/sonar-scanner -Dsonar.projectKey=YourProjectKey -Dsonar.sources=."</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">    stage (<span class="string">'two-stage'</span>) &#123;</span><br><span class="line">      <span class="comment">// 13.当任一满足以下条件时执行</span></span><br><span class="line">      when &#123;   </span><br><span class="line">        beforeInput <span class="literal">true</span> </span><br><span class="line">        anyOf &#123; branch <span class="string">'master'</span>; environment <span class="string">name:</span> <span class="string">'global_when'</span>, <span class="string">value:</span> <span class="string">'true'</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 8.局部选项</span></span><br><span class="line">      options &#123;</span><br><span class="line">        <span class="comment">// 可设置全局(局部阶段)执行超时指定为一分钟，然后Jenkins将中止 Pipeline运行。</span></span><br><span class="line">        timeout(<span class="string">time:</span> <span class="number">5</span>, <span class="string">unit:</span> <span class="string">'MINUTES'</span>) </span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 12.Input指令输入参数到变量中</span></span><br><span class="line">      <span class="comment">// 方式1</span></span><br><span class="line">      input &#123;</span><br><span class="line">          message <span class="string">"Title : 个人信息输入"</span></span><br><span class="line">          ok <span class="string">"完成提交"</span></span><br><span class="line">          submitter <span class="string">"alice,bob"</span></span><br><span class="line">          parameters &#123;</span><br><span class="line">            string(<span class="string">name:</span> <span class="string">'INPUT_PERSON'</span>, <span class="string">defaultValue:</span> <span class="string">'WeiyiGeek'</span>, <span class="string">description:</span> <span class="string">'Message: 请输入您的姓名?'</span>)</span><br><span class="line">            text(<span class="string">name:</span> <span class="string">'INPUT_AGE'</span>, <span class="string">defaultValue:</span> <span class="string">'WeiyiGeek'</span>, <span class="string">description:</span> <span class="string">'Message: 请输入您的年龄?'</span>)</span><br><span class="line">            choice(<span class="string">name:</span> <span class="string">'INPUT_SEX'</span>, <span class="string">choices:</span> [<span class="string">'Male'</span>,<span class="string">'Female'</span>], <span class="string">description:</span> <span class="string">'Message: 请选择你的性别?'</span>)</span><br><span class="line">            password(<span class="string">name:</span> <span class="string">'INPUT_PASSWORD'</span>, <span class="string">defaultValue:</span> <span class="string">'SECRET'</span>, <span class="string">description:</span> <span class="string">'Message: 请输入您注册密码?'</span>)</span><br><span class="line">            booleanParam(<span class="string">name:</span> <span class="string">'INPUT_AGREE'</span>, <span class="string">defaultValue:</span> <span class="literal">true</span>, <span class="string">description:</span> <span class="string">'Message: 是否确定协议?'</span>)</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      steps &#123;</span><br><span class="line">          <span class="comment">// 方式2：注意script必须包含在 steps 块之中</span></span><br><span class="line">          script &#123;</span><br><span class="line">            env.git_version=input <span class="string">message:</span> <span class="string">'Titel: 版本'</span>, <span class="string">ok:</span> <span class="string">'通过'</span>,<span class="string">parameters:</span> [string ( <span class="string">name:</span> <span class="string">'git_version'</span>, <span class="string">trim:</span> <span class="literal">true</span>, <span class="string">description:</span> <span class="string">'Message : 请选择要操作的应用版本?'</span>)];</span><br><span class="line">            env.deploy_option = input <span class="string">message:</span> <span class="string">'Titel: 操作'</span>, <span class="string">ok:</span> <span class="string">'deploy'</span>, <span class="string">parameters:</span> [choice(<span class="string">name:</span> <span class="string">'deploy_option'</span>, <span class="string">choices:</span> [<span class="string">'deploy'</span>, <span class="string">'rollback'</span>, <span class="string">'redeploy'</span>], <span class="string">description:</span> <span class="string">'Message : 请选择操作流程?'</span>)];</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 10.Parameters 参数调用</span></span><br><span class="line">        echo <span class="string">"全局 - Hello $&#123;params.PERSON&#125;"</span></span><br><span class="line">        echo <span class="string">"全局 - Toggle: $&#123;params.TOGGLE&#125;"</span></span><br><span class="line">        echo <span class="string">"全局 - Choice: $&#123;params.CHOICE&#125;"</span></span><br><span class="line">        echo <span class="string">"全局 - Password: $&#123;params.PASSWORD&#125;"</span></span><br><span class="line">        echo <span class="string">"全局 - Biography: $&#123;params.BIOGRAPHY&#125;"</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 12.input 输出示例</span></span><br><span class="line">        echo <span class="string">"input 输出示例1: 姓名：$&#123;INPUT_PERSON&#125;, 年龄：$&#123;INPUT_AGE&#125;, 性别：$&#123;INPUT_SEX&#125;, 是否同意协议: $&#123;INPUT_AGREE&#125;"</span></span><br><span class="line">        echo <span class="string">"input 输出示例(script) -&gt; 版本 : $&#123;env.git_version&#125;"</span></span><br><span class="line">        echo <span class="string">"input 输出示例(script) -&gt; 版本 : $&#123;env.deploy_option&#125;"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stage (<span class="string">'three-stage'</span>) &#123;</span><br><span class="line">      <span class="comment">// 14.Parallel Stages 并行执行</span></span><br><span class="line">      <span class="comment">// 方式2.failFast true 在任何一个阶段失败时强制终止所有并行阶段</span></span><br><span class="line">      parallel &#123;</span><br><span class="line">        stage(<span class="string">'parallel-Branch A'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">"On Branch A"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">'parallel-Branch B'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">"On Branch B"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">'parallel-Branch C'</span>) &#123;</span><br><span class="line">          stages &#123;</span><br><span class="line">              stage(<span class="string">'嵌套Nested 1'</span>) &#123;</span><br><span class="line">                  steps &#123;</span><br><span class="line">                      echo <span class="string">"In stage Nested 1 within Branch C"</span></span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              stage(<span class="string">'嵌套Nested 2'</span>) &#123;</span><br><span class="line">                  steps &#123;</span><br><span class="line">                      echo <span class="string">"In stage Nested 2 within Branch C"</span></span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 15.Matrix 矩阵模型实践</span></span><br><span class="line">    stage (<span class="string">'four-stage'</span>) &#123;</span><br><span class="line">      input &#123;</span><br><span class="line">        message <span class="string">"Title : 部署平台"</span></span><br><span class="line">        ok <span class="string">"完成提交"</span></span><br><span class="line">        submitter <span class="string">"alice,bob"</span></span><br><span class="line">        parameters &#123;</span><br><span class="line">          choice(<span class="string">name:</span> <span class="string">'PLATFORM_FILTER'</span>, <span class="string">choices:</span> [<span class="string">'all'</span>, <span class="string">'linux'</span>, <span class="string">'windows'</span>, <span class="string">'mac'</span>], <span class="string">description:</span> <span class="string">'Run on specific platform'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      matrix &#123; </span><br><span class="line">        when &#123; anyOf &#123;</span><br><span class="line">                <span class="comment">// 参数选择不为空时继续执行</span></span><br><span class="line">                expression &#123; params.PLATFORM_FILTER == <span class="string">'all'</span> &#125;</span><br><span class="line">                expression &#123; params.PLATFORM_FILTER == env.PLATFORM &#125;</span><br><span class="line">              &#125; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 16.2 轴 (3 x 2) 6种组合方式的模型</span></span><br><span class="line">        axes &#123;</span><br><span class="line">          axis &#123;</span><br><span class="line">            name <span class="string">'PLATFORM'</span></span><br><span class="line">            values <span class="string">'linux'</span>, <span class="string">'windows'</span>, <span class="string">'mac'</span></span><br><span class="line">          &#125;</span><br><span class="line">          axis &#123;</span><br><span class="line">            name <span class="string">'ARCHITECTURE'</span></span><br><span class="line">            values <span class="string">'32-bit'</span>,<span class="string">'64-bit'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 17.排除指定模型例如非64-bit的在windows平台的将被剔除</span></span><br><span class="line">        excludes &#123;</span><br><span class="line">          exclude &#123;</span><br><span class="line">              axis &#123;</span><br><span class="line">                name <span class="string">'PLATFORM'</span></span><br><span class="line">                values <span class="string">'windows'</span></span><br><span class="line">              &#125;</span><br><span class="line">              axis &#123;</span><br><span class="line">                name <span class="string">'ARCHITECTURE'</span></span><br><span class="line">                notValues <span class="string">'64-bit'</span></span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 18.还有5种情况依次进行构建</span></span><br><span class="line">        stages &#123;</span><br><span class="line">          stage(<span class="string">'Build'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">              echo <span class="string">"matrix - Do Build for $&#123;PLATFORM&#125; - $&#123;BROWSER&#125;"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 6.消息通知</span></span><br><span class="line">  post &#123; </span><br><span class="line">    <span class="comment">// # 总是执行的步骤</span></span><br><span class="line">    always &#123; </span><br><span class="line">      echo <span class="string">'I will always say Hello again!'</span> <span class="comment">/* == I will always say Hello again!— Print Message */</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## init - stage</span></span><br><span class="line">maven_env— Use a tool from a predefined Tool Installation  &lt;1s</span><br><span class="line"><span class="comment"># Fetches the environment variables for a given tool in a list of 'FOO=bar' strings suitable for the withEnv step.&lt;1s</span></span><br><span class="line">jdk_k1.8.0_211— Use a tool from a predefined Tool Installation  &lt;1s</span><br><span class="line"><span class="comment"># Fetches the environment variables for a given tool in a list of 'FOO=bar' strings suitable for the withEnv step.&lt;1s</span></span><br><span class="line">maven_env— Use a tool from a predefined Tool Installation  &lt;1s</span><br><span class="line"><span class="comment"># Fetches the environment variables for a given tool in a list of 'FOO=bar' strings suitable for the withEnv step.&lt;1s</span></span><br><span class="line">jdk_k1.8.0_211— Use a tool from a predefined Tool Installation &lt;1s</span><br><span class="line"><span class="comment"># Fetches the environment variables for a given tool in a list of 'FOO=bar' strings suitable for the withEnv step.&lt;1s</span></span><br><span class="line">init - steps one - built-in <span class="built_in">functions</span> <span class="built_in">echo</span>— Print Message &lt;1s</span><br><span class="line">init - steps one - built-in <span class="built_in">functions</span> println — Print Message &lt;1s</span><br><span class="line">Testing the chrome browser— Print Messag e&lt;1s</span><br><span class="line">Testing the firefox browser— Print Message 1s</span><br><span class="line">Testing the edge browser— Print Message &lt;1s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## one - stage</span></span><br><span class="line">全局变量: Jenkins global environment, 局部变量: Jenkins <span class="built_in">local</span> environment</span><br><span class="line">+ <span class="built_in">echo</span> user is ****</span><br><span class="line">user is ****</span><br><span class="line">+ <span class="built_in">echo</span> **** is ****</span><br><span class="line">**** is ****</span><br><span class="line">+ <span class="built_in">echo</span> SSH private key is located at ****</span><br><span class="line">SSH private key is located at ****</span><br><span class="line">+ <span class="built_in">echo</span> SSH user is ****</span><br><span class="line">SSH user is ****</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## two-stage</span></span><br><span class="line">全局 - Hello Mr Jenkins— Print Message&lt;1s</span><br><span class="line">全局 - Toggle: <span class="literal">true</span>— Print Message&lt;1s</span><br><span class="line">全局 - Choice: One— Print Message&lt;1s</span><br><span class="line">全局 - Password: SECRET— Print Message&lt;1s</span><br><span class="line">全局 - Biography: — Print Message&lt;1s</span><br><span class="line">input 输出示例1: 姓名：WeiyiGeek, 年龄：185, 性别：Male, 是否同意协议: <span class="literal">true</span>— Print Message&lt;1s</span><br><span class="line">input 输出示例(script) -&gt; 版本 : v1.2— Print Message&lt;1s</span><br><span class="line">input 输出示例(script) -&gt; 版本 : deploy— Print Message</span><br><span class="line"></span><br><span class="line"><span class="comment">## three-stage</span></span><br><span class="line">On Branch A— Print Message</span><br><span class="line">On Branch B— Print Message</span><br><span class="line">In stage Nested 1 within Branch C</span><br><span class="line">In stage Nested 2 within Branch C</span><br><span class="line"></span><br><span class="line"><span class="comment">## four-stage</span></span><br><span class="line">I will always say Hello again!— Print Message&lt;1s</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=2.Jenkins进阶之流水线pipeline语法入门学习 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210131171702.png" target="_blank" title="WeiyiGeek.结果一览" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210131171702.png" alt="WeiyiGeek.结果一览" title="" class=""></a>
                <p>WeiyiGeek.结果一览</p>
            </figure>
<hr>
<h2 id="0x03-pipeline-内置支持"><a href="#0x03-pipeline-内置支持" class="headerlink" title="0x03 pipeline 内置支持"></a>0x03 pipeline 内置支持</h2><h3 id="3-0-字符串和标准输出"><a href="#3-0-字符串和标准输出" class="headerlink" title="3.0) 字符串和标准输出"></a>3.0) 字符串和标准输出</h3><ul>
<li>echo: Print Message</li>
<li>println: Print Message<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"Hello"</span></span><br><span class="line">println <span class="string">"World!"</span></span><br></pre></td></tr></table></figure>
<br/></li>
</ul>
<p><strong>脚本中操作字符串替换值</strong><br>描述: 在使用 Groovy 语法写 Pipleline 脚本时候，可能需要替换先前设置好的一些文本的值，此处我们简单演示一下:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">script &#123;</span><br><span class="line">  <span class="comment">// 测试的字符串</span></span><br><span class="line">  sourceStr = <span class="string">"这是要替换的值：#value1, 这是要替换的值：#value2"</span></span><br><span class="line">  <span class="comment">// 替换 #value1 与 #value2 两个值</span></span><br><span class="line">  afterStr = sourceStr.replaceAll(<span class="string">"#value1"</span>,<span class="string">"AAA"</span>).replaceAll(<span class="string">"#value2"</span>,<span class="string">"BBB"</span>)</span><br><span class="line">  <span class="comment">// 输出替换后的字符串</span></span><br><span class="line">  print <span class="string">"$&#123;afterStr&#125;"</span></span><br><span class="line">  <span class="comment">// 这是要替换的值：AAA，这是要替换的值：BBB</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="3-1-文件目录相关步骤"><a href="#3-1-文件目录相关步骤" class="headerlink" title="3.1) 文件目录相关步骤"></a>3.1) 文件目录相关步骤</h3><ul>
<li>isUnix： 如果封闭节点运行在类unix系统(如Linux或Mac OS X)上，则返回true，如果Windows。</li>
<li>pwd：确认当前目录</li>
<li>dir: 默认pipeline工作在工作空间目录下，dir步骤可以让我们切换到其他目录。</li>
<li>deleteDir：是一个无参步骤删除的是当前工作目录。通常它与dir步骤一起使用，用于删除指定目录下的内容。<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dir(<span class="string">"./delete_dir"</span>)</span><br><span class="line">deleteDir()</span><br></pre></td></tr></table></figure></li>
<li><p>fileExists：检查给定的文件(作为当前目录的相对路径)是否存在。参数file返回 <code>true | false</code> 。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 工作空间中文件的相对(/分隔)路径，以验证文件是否存在。</span></span><br><span class="line">fileExists file: <span class="string">"./pom.xml"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>writeFile：将内容写入指定文件中; 参数为：<code>file, text, encoding</code></p>
</li>
<li>readFile：读取文件内容; 参数为：<code>file, encoding</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">writeFile encoding: <span class="string">'utf-8'</span>, file: <span class="string">'file'</span>, text: <span class="string">'测试写入'</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<h3 id="3-2-制品相关步骤"><a href="#3-2-制品相关步骤" class="headerlink" title="3.2) 制品相关步骤"></a>3.2) 制品相关步骤</h3><ul>
<li><p>stash : 步骤可以将一些文件保存起来以便被同一次构建的其他步骤或阶段使用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">name</span><br><span class="line">Name of a stash. Should be a simple identifier akin to a job name.</span><br><span class="line">    Type: String</span><br><span class="line"></span><br><span class="line">allowEmpty (optional)</span><br><span class="line">    Type: boolean</span><br><span class="line"></span><br><span class="line">excludes (optional)</span><br><span class="line">Optional <span class="built_in">set</span> of Ant-style exclude patterns.</span><br><span class="line">Use a comma separated list to add more than one expression.</span><br><span class="line">If blank, no files will be excluded.</span><br><span class="line">    Type: String</span><br><span class="line"></span><br><span class="line">includes (optional)</span><br><span class="line">Optional <span class="built_in">set</span> of Ant-style include patterns.</span><br><span class="line">Use a comma separated list to add more than one expression.</span><br><span class="line">If blank, treated like **: all files.</span><br><span class="line">The current working directory is the base directory <span class="keyword">for</span> the saved files, <span class="built_in">which</span> will later be restored <span class="keyword">in</span> the same relative locations, so <span class="keyword">if</span> you want to use a subdirectory wrap this <span class="keyword">in</span> dir.</span><br><span class="line">    Type: String</span><br><span class="line"></span><br><span class="line">useDefaultExcludes (optional)</span><br><span class="line">If selected, use the default excludes from Ant - see here <span class="keyword">for</span> the list.</span><br><span class="line">    Type: boolean</span><br></pre></td></tr></table></figure>
</li>
<li><p>unstash：恢复以前存储在当前工作区中的一组文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># name: 以前保存的仓库的名称。</span></span><br><span class="line">unstash <span class="string">'repo'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>wrap: 一般构建包装,它是特殊的步骤允许调用构建包装器(在freestyle或类似项目中也称为“环境配置”)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wrap([<span class="variable">$class</span>: <span class="string">'AnsiColorBuildWrapper'</span>]).</span><br></pre></td></tr></table></figure>
</li>
<li><p>archive: Archive artifacts-归档的工件</p>
</li>
<li>unarchive: Copy archived artifacts into the workspace-将存档工件复制到工作区中</li>
<li>archiveArtifacts: 存档构建的成品 (重点)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 参数: String includes, optional: excludes </span></span><br><span class="line">archive</span><br><span class="line"><span class="comment"># 参数: Type: java.util.Map&lt;java.lang.String, java.lang.String&gt; mapping </span></span><br><span class="line">unarchive</span><br><span class="line"><span class="comment"># 参数: </span></span><br><span class="line"><span class="comment"># artifacts: 用于存档的文件(支持通配符)</span></span><br><span class="line"><span class="comment"># excludes: 不包含的文件(支持通配符)</span></span><br><span class="line"><span class="comment"># allowEmptyArchive: 归档为空时不引起构建失败</span></span><br><span class="line"><span class="comment"># onlyIfSuccessful: 只有构建成功时归档</span></span><br><span class="line"><span class="comment"># fingerprint: 记录所有归档成品的指纹</span></span><br><span class="line"><span class="comment"># Follow symbolic links: 通过禁用此选项，工作空间中找到的所有符号链接都将被忽略。</span></span><br><span class="line">archiveArtifacts artifacts: <span class="string">'./target/*.jar'</span>, excludes: <span class="string">'./target/test/*'</span>, fingerprint: <span class="literal">true</span>, onlyIfSuccessful: <span class="literal">true</span>, allowEmptyArchive: <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<h3 id="3-3-命令相关步骤"><a href="#3-3-命令相关步骤" class="headerlink" title="3.3) 命令相关步骤"></a>3.3) 命令相关步骤</h3><p>描述: 与命令相关的步骤其实是 <code>Pipeline：Nodes and Processes</code> 插件提供的步骤。由于它是 Pipeline 插件的一个组件，所以基本不需要单独安装</p>
<p><strong>withEnv: 设置环境变量</strong><br>描述: 在块中设置一个或多个环境变量, 这些可用于该范围内生成的任何外部流程。例如:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">node &#123;</span><br><span class="line">  withEnv([<span class="string">'MYTOOL_HOME=/usr/local/mytool'</span>]) &#123;</span><br><span class="line">    sh <span class="string">'$MYTOOL_HOME/bin/start'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Tips: 注意这里我们在Groovy中使用了单引号，所以变量展开是<code>由Bourne shell完成的</code>而不是Jenkins;</p>
<p><br/></p>
<p><strong>sh：执行shell命令</strong><br>该步骤支持的参数有：</p>
<ul>
<li>script：将要执行的shell脚本，通常在类UNIX系统上可以是多行脚本。</li>
<li>encoding：脚本执行后输出日志的编码，默认值为脚本运行所在系统的编码。</li>
<li>returnStatus：布尔类型，默认脚本返回的是状态码，如果是一个非零的状态码，则会引发pipeline执行失败。如果 <code>returnStatus</code> 参数为true，则不论状态码是什么，pipeline的执行都不会受影响。</li>
<li>returnStdout：布尔类型，如果为true，则任务的标准输出将作为步骤的返回值，而不是打印到构建日志中（如果有错误，则依然会打印到日志中）。除了script参数，其他参数都是可选的。</li>
</ul>
<p>Tips: returnStatus与returnStdout参数一般不会同时使用，因为返回值只能有一个。如果同时使用则只有returnStatus参数生效。</p>
<p>Tips : 注意采用sh执行<code>echo 1 &gt; 1.txt</code>命令时然后采用readFile读取时带有换行符，解决办法:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方式1.采用 $? 判断命令执行成功与否。</span></span><br><span class="line"><span class="comment"># 方式2.采用echo命令输出到文件时加上 -n 选项。</span></span><br></pre></td></tr></table></figure></p>
<p><strong>bat、powershell步骤</strong></p>
<ul>
<li>bat步骤执行的是Windows的批处理命令。</li>
<li>powershell步骤执行的是PowerShell脚本，支持3+版本。</li>
</ul>
<p>Tips: 步骤支持的参数与sh步骤的一样就不重复介绍了。</p>
<p><br/></p>
<h3 id="3-4-其他步骤"><a href="#3-4-其他步骤" class="headerlink" title="3.4) 其他步骤"></a>3.4) 其他步骤</h3><p><strong>异常终止</strong><br>try-catch-finally : 异常捕获和抛出<br>error：主动报错中止当前 pipeline 并且避免打印堆栈跟踪信息。<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 简单示例</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  sh <span class="string">'might fail &amp;&amp; whoami'</span></span><br><span class="line">  echo <span class="string">'Succeeded!'</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  echo <span class="string">"Failed: $&#123;err&#125; - "</span> + err.toString() </span><br><span class="line">  error <span class="string">"[-Error] : 项目部署失败 \n[-Msg] : $&#123;err.getMessage()&#125; "</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  sh <span class="string">'./tear-down.sh'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>catchError: 捕获错误并将构建结果设置为失败<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">catchError &#123;</span><br><span class="line">  sh <span class="string">'might fail'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>unstable: 设置阶段结果为不稳定, 将一条消息打印到日志中并将整个构建结果和阶段结果设置为不稳定。消息还将与阶段结果相关联并可能以可视化方式显示。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">unstable <span class="string">'阶段结果为不稳定'</span></span><br><span class="line">unstable &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"阶段结果为不稳定"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>电子邮件</strong></p>
<ul>
<li>mail: Simple step for sending email.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">subject</span><br><span class="line">Email subject line.</span><br><span class="line">    Type: String</span><br><span class="line">body</span><br><span class="line">Email body.</span><br><span class="line">    Type: String</span><br><span class="line">bcc (optional)</span><br><span class="line">BCC email address list. Comma separated list of email addresses.</span><br><span class="line">    Type: String</span><br><span class="line">cc (optional)</span><br><span class="line">CC email address list. Comma separated list of email addresses.</span><br><span class="line">    Type: String</span><br><span class="line">charset (optional)</span><br><span class="line">Email body character encoding. Defaults to UTF-8</span><br><span class="line">    Type: String</span><br><span class="line">from (optional)</span><br><span class="line">From email address. Defaults to the admin address globally configured <span class="keyword">for</span> the Jenkins instance.</span><br><span class="line">    Type: String</span><br><span class="line">mimeType (optional)</span><br><span class="line">Email body MIME <span class="built_in">type</span>. Defaults to text/plain.</span><br><span class="line">    Type: String</span><br><span class="line">replyTo (optional)</span><br><span class="line">Reploy-To email address. Defaults to the admin address globally configured <span class="keyword">for</span> the Jenkins instance.</span><br><span class="line">    Type: String</span><br><span class="line">to (optional)</span><br><span class="line">To email address list. Comma separated list of email addresses. </span><br><span class="line">    Type: String</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<p><strong>重试休眠和超时</strong></p>
<ul>
<li>retry：重试正文最多N次, 如果在块体执行过程中发生任何异常，请重试该块(最多N次)。如果在最后一次尝试时发生异常，那么它将导致中止构建(除非以某种方式捕获并处理它),不会捕获生成的用户中止。</li>
<li>sleep：让pipeline休眠指定的一段时间 , 只需暂停管道构建直到给定的时间已经过期<code>相当于(在Unix上)sh &#39;sleep…&#39;</code>。</li>
<li>timeout：以确定的超时限制执行块内的代码。</li>
<li>waitUntil：反复运行它的主体直至条件满足。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 参数: int count</span></span><br><span class="line">retry(count: 5)  <span class="comment"># 重试5次</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数: int time, optional unit ( Values: NANOSECONDS, MICROSECONDS, MILLISECONDS, SECONDS, MINUTES, HOURS, DAYS)</span></span><br><span class="line">sleep(time: 60,unit: SECONDS  <span class="comment"># 休眠60s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数: int time, optional activity, optional unit </span></span><br><span class="line"><span class="comment"># Values: NANOSECONDS, MICROSECONDS, MILLISECONDS, SECONDS, MINUTES, HOURS, DAYS</span></span><br><span class="line">timeout(time: 10,unit: MINUTES) <span class="comment"># 超时10分钟 </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数: optional initialRecurrencePeriod, optional quiet </span></span><br><span class="line"><span class="comment"># initialRecurrencePeriod: 设置重试之间的初始等待周期(以毫秒为单位)默认为250 ms。每次失败都将降低尝试之间的延迟最多可达15秒。</span></span><br><span class="line"><span class="comment"># quiet: 如果为true，则该步骤不会在每次检查条件时记录消息。默认值为false。</span></span><br><span class="line">waitUntil(initialRecurrencePeriod: 250, quiet: <span class="literal">false</span>)&#123;</span><br><span class="line">  sh <span class="string">"./monitor.sh"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>tool：使用预定义的工具,在Global Tool Configuration（全局工具配置）中配置了工具。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tool name: <span class="string">'Sonar-Scanner'</span>, <span class="built_in">type</span>: <span class="string">'hudson.plugins.sonar.SonarRunnerInstallation'</span></span><br><span class="line">tool name: <span class="string">'docker'</span>, <span class="built_in">type</span>: <span class="string">'dockerTool'</span></span><br></pre></td></tr></table></figure></p>
<p>getContext: 从内部api获取上下文对象<br>withContext: 在块中使用内部api中的上下文对象<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 参数: 用于受信任的代码，如全局库，它可以操作内部Jenkins api。</span></span><br><span class="line"><span class="comment"># Type: java.lang.Class&lt;?&gt;</span></span><br><span class="line"><span class="comment"># 例子:接受单个类型参数</span></span><br><span class="line">getContext hudson.FilePath</span><br><span class="line"></span><br><span class="line"><span class="comment"># 例子:接受一个context参数和一个block。</span></span><br><span class="line"><span class="comment"># 在ConsoleLogFilter、LauncherDecorator和EnvironmentExpander的情况下，自动将其参数与上下文对象合并。</span></span><br><span class="line">withContext(new MyConsoleLogFilter()) &#123;</span><br><span class="line">  sh <span class="string">'process'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>Tips : 不要试图传递在Groovy中定义的对象;只支持java定义的对象。实际上你应该避免使用this和getContext而只是在插件中定义一个步骤。</p>
<p>参考地址: <a href="https://www.jenkins.io/doc/pipeline/steps/workflow-basic-steps/" target="_blank" rel="noopener">https://www.jenkins.io/doc/pipeline/steps/workflow-basic-steps/</a></p>
<hr>
<h2 id="0x04-Pipeline-片段示例"><a href="#0x04-Pipeline-片段示例" class="headerlink" title="0x04 Pipeline 片段示例"></a>0x04 Pipeline 片段示例</h2><p><strong>(1) 超时设置与部署参数switch语句选择</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">timeout(<span class="string">time:</span> <span class="number">1</span>, <span class="string">unit:</span> <span class="string">'MINUTES'</span>) &#123;</span><br><span class="line">  script &#123;</span><br><span class="line">    env.deploy_option = input <span class="string">message:</span> <span class="string">'选择操作'</span>, <span class="string">ok:</span> <span class="string">'deploy'</span>,</span><br><span class="line"><span class="symbol">    parameters:</span> [choice(<span class="string">name:</span> <span class="string">'deploy_option'</span>, <span class="string">choices:</span> [<span class="string">'deploy'</span>, <span class="string">'rollback'</span>, <span class="string">'redeploy'</span>], <span class="string">description:</span> <span class="string">'选择部署环境'</span>)]</span><br><span class="line">    <span class="keyword">switch</span>(<span class="string">"$&#123;env.deploy_option&#125;"</span>)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'deploy'</span>:</span><br><span class="line">            println(<span class="string">'1.deploy prd env'</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'rollback'</span>:</span><br><span class="line">            println(<span class="string">'2.rollback env'</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'redeploy'</span>:</span><br><span class="line">            println(<span class="string">'3.redeploy env'</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"><span class="symbol">        default:</span></span><br><span class="line">            println(<span class="string">'error env'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>（1）代码仓库拉取之checkout SCM</strong></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">checkout([<span class="string">$class:</span> <span class="string">'GitSCM'</span>, <span class="string">branches:</span> [[<span class="string">name:</span> <span class="string">'*/master'</span>]], <span class="string">doGenerateSubmoduleConfigurations:</span> <span class="literal">false</span>, <span class="string">extensions:</span> [], <span class="string">submoduleCfg:</span> [], <span class="string">userRemoteConfigs:</span> [[<span class="string">credentialsId:</span> <span class="string">'b4c8b4e9-2777-44a1-a1ed-e9dc21d37f4f'</span>, <span class="string">url:</span> <span class="string">'git@gitlab.weiyigeek.top:ci-cd/java-maven.git'</span>]]])</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=2.Jenkins进阶之流水线pipeline语法入门学习 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210114134413.png" target="_blank" title="WeiyiGeek.流水线之代码拉取" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210114134413.png" alt="WeiyiGeek.流水线之代码拉取" title="" class=""></a>
                <p>WeiyiGeek.流水线之代码拉取</p>
            </figure>
<p><br/></p>
<p><strong>(2) 代码质量检测之shell Script</strong></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>sonar-scanner -Dsonar.projectName=$&#123;JOB_NAME&#125; -Dsonar.projectKey=Hello-World -Dsonar.sources=.</span><br><span class="line"></span><br><span class="line"><span class="comment">// # 生成的流水线</span></span><br><span class="line">sh <span class="string">label:</span> <span class="string">'sonar'</span>, <span class="string">returnStatus:</span> <span class="literal">true</span>, <span class="string">script:</span> <span class="string">'''/usr/local/bin/sonar-scanner -Dsonar.projectName=$&#123;JOB_NAME&#125; -Dsonar.projectKey=Hello-World -Dsonar.sources=.'''</span></span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=2.Jenkins进阶之流水线pipeline语法入门学习 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210114135242.png" target="_blank" title="WeiyiGeek.流水线之代码质量检测" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210114135242.png" alt="WeiyiGeek.流水线之代码质量检测" title="" class=""></a>
                <p>WeiyiGeek.流水线之代码质量检测</p>
            </figure>
<p><br/></p>
<p><strong>(3) Kubernetes 动态节点 Pod 模板的选择</strong></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// # Scripted Pipeline</span></span><br><span class="line">podTemplate(<span class="string">label:</span> <span class="string">'jenkins-jnlp-slave'</span>, <span class="string">cloud:</span> <span class="string">'k8s_115'</span>) &#123;</span><br><span class="line">  node (<span class="string">'jenkins-jnlp-slave'</span>) &#123;</span><br><span class="line">    stage (<span class="string">'dynamic-checkout'</span>) &#123;</span><br><span class="line">      checkout([<span class="string">$class:</span> <span class="string">'GitSCM'</span>, <span class="string">branches:</span> [[<span class="string">name:</span> <span class="string">'*/master'</span>]], <span class="string">userRemoteConfigs:</span> [[<span class="string">credentialsId:</span> <span class="string">'69c0dbf0-f786-4aa0-975a-76528f10de8b'</span>, <span class="string">url:</span> <span class="string">'http://127.0.0.1/xxx/devops_test.git'</span>]]])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        </div>
        
  <hr>
  <p> 欢迎各位志同道合的朋友一起学习交流，如文章有误请在下方留下您宝贵的经验知识，个人邮箱地址<b style="color:#ff654e"><code>【master#weiyigeek.top】</code></b>或者个人公众号<b style="color:#ff654e"><code>【WeiyiGeek】</code></b>联系我。 </p>

  <p> 更多文章来源于<b style="color:#03a9f4">【WeiyiGeek Blog - 为了能到远方，脚下的每一步都不能少】</b>, 个人首页地址( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>

  <p>专栏书写不易，如果您觉得这个专栏还不错的，请给这篇专栏 <b style="color: red;">【点个赞、投个币、收个藏、关个注，转个发】(人间五大情)</b>，这将对我的肯定，谢谢！。</p>

  <div>
    <img src="https://www.weiyigeek.top/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"【点个赞】，动动你那粗壮的拇指或者芊芊玉手，亲！"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"【投个币】，万水千山总是情，投个硬币行不行，亲！")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("【收个藏】，阅后即焚不吃灰，亲！")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("【转个发】，让更多的志同道合的朋友一起学习交流，亲！")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("【关个注】，后续浏览查看不迷路哟，亲！")</span></p>
    </li>
  </ul>

  <div>
    <img src="https://www.weiyigeek.top/img/wechat-search.png" class="img-responsive" alt="扫描follow(关注)WeiyiGeek公众号"  width="328" height="149">
  </div>

  <hr>
  


  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    最后更新时间：<time datetime="2022-05-17T08:35:46.737Z" itemprop="dateUpdated">2022-05-17 16:35:46</time>
</span><br>


        <span>文章原始路径：<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/系统运维/自动化运维/CI-CD/Jenkins/2.Jenkins进阶之流水线pipeline语法入门学习.md" target="_blank" rel="noopener noreferrer">_posts/系统运维/自动化运维/CI-CD/Jenkins/2.Jenkins进阶之流水线pipeline语法入门学习.md</a></span><br>
         <span class="copy-copyright">转载注明出处，原文地址：<a href="/2020/12-29-519.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/12-29-519.html</a></span><br>本站文章内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">👍 钟意作者</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/12-29-519.html&title=《2.Jenkins进阶之流水线pipeline语法入门学习》 — WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/12-29-519.html&title=《2.Jenkins进阶之流水线pipeline语法入门学习》 — WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/12-29-519.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《2.Jenkins进阶之流水线pipeline语法入门学习》 — WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/12-29-519.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/12-29-519.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- 评论组件 -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/12-30-531.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">4.Jenkins进阶之分布式架构环境配置</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/12-28-515.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">SonarQube基础介绍与在代码检测中的应用</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-前言简述"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 前言简述</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Pipeline-介绍"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">Pipeline 介绍</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Pipeline-基础知识"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">Pipeline 基础知识</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Pipeline-扩展共享库"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">Pipeline 扩展共享库</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#BlueOcean-介绍"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">BlueOcean 介绍</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-Pipeline-Syntax"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 Pipeline Syntax</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#0-Groovy-Basic-Syntax"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">(0) Groovy Basic Syntax</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-Scripted-Pipeline-Syntax"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">(1) Scripted Pipeline Syntax</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Hello-World-实践"><span class="post-toc-number">2.2.1.</span> <span class="post-toc-text">Hello-World 实践</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#变量名-Identifiers"><span class="post-toc-number">2.2.2.</span> <span class="post-toc-text">变量名-Identifiers</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#字符串-String"><span class="post-toc-number">2.2.3.</span> <span class="post-toc-text">字符串-String</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#数字-Numbers"><span class="post-toc-number">2.2.4.</span> <span class="post-toc-text">数字 - Numbers</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#列表-List"><span class="post-toc-number">2.2.5.</span> <span class="post-toc-text">列表-List</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#字典-Maps"><span class="post-toc-number">2.2.6.</span> <span class="post-toc-text">字典 - Maps</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#条件语句-Condition"><span class="post-toc-number">2.2.7.</span> <span class="post-toc-text">条件语句 - Condition</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#异常-Exception"><span class="post-toc-number">2.2.8.</span> <span class="post-toc-text">异常 - Exception</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#函数-Functions"><span class="post-toc-number">2.2.9.</span> <span class="post-toc-text">函数 - Functions</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#类和对象"><span class="post-toc-number">2.2.10.</span> <span class="post-toc-text">类和对象</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#字符串处理"><span class="post-toc-number">2.2.11.</span> <span class="post-toc-text">字符串处理</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#语法总结"><span class="post-toc-number">2.2.12.</span> <span class="post-toc-text">语法总结</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-Declarative-Pipeline-Syntax"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">(2) Declarative Pipeline Syntax</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-1-Sections-章节"><span class="post-toc-number">2.3.1.</span> <span class="post-toc-text">2.1) Sections - 章节</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-2-Directives-指令"><span class="post-toc-number">2.3.2.</span> <span class="post-toc-text">2.2) Directives - 指令</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-3-Sequential-Stages-顺序阶段"><span class="post-toc-number">2.3.3.</span> <span class="post-toc-text">2.3) Sequential Stages - 顺序阶段</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-4-Parallel-并行"><span class="post-toc-number">2.3.4.</span> <span class="post-toc-text">2.4) Parallel - 并行</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-5-Matrix-模型"><span class="post-toc-number">2.3.5.</span> <span class="post-toc-text">2.5) Matrix - 模型</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#语法总结-1"><span class="post-toc-number">2.3.6.</span> <span class="post-toc-text">语法总结</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x03-pipeline-内置支持"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x03 pipeline 内置支持</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-0-字符串和标准输出"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">3.0) 字符串和标准输出</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-1-文件目录相关步骤"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">3.1) 文件目录相关步骤</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-2-制品相关步骤"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">3.2) 制品相关步骤</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-3-命令相关步骤"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">3.3) 命令相关步骤</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-4-其他步骤"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">3.4) 其他步骤</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x04-Pipeline-片段示例"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x04 Pipeline 片段示例</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

  <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        人间自有五大情【点赞、投币(赞赏)、收藏、关注，转发】, 谢谢看友支持!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="228" height="228" alt="打赏二维码">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="228" height="228" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>

  
 <!-- 微信公众号关注/文章版权复制 -->

  <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">你好朋友,可以关个注吗? ❤ <br> 这将是我持续更新文章的动力源泉，谢谢支持！(๑′ᴗ‵๑) </b> <br> 如不想关注请点击右上角的【X】<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">【My Twitter】</a></strong>. There is an article verification code in the homepage.
<br>方式2.请访问本博主的B站<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">【WeiyiGeek】</a></strong>首页关注UP主,<br>将自动随机获取解锁验证码。
<br>方式3.扫一扫下方二维码，关注本站<strong>官方公众号</strong><br>
回复：<strong style="color: rgb(240, 65, 52);">验证码</strong>
将获取<strong style="color: rgb(240, 65, 52);">解锁(有效期7天)</strong>本站所有技术文章哟!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="请输入验证码|Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">提
    交</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - 为了能到远方，脚下的每一步都不能少</p>
</div>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">公众账号</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">哔哩哔哩专栏</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">个人Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">个人Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">个人知乎</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">博客园</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">今日头条</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">简书</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">腾讯云+云社区</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">百度文库</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">IT极客知识分享</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTO博客</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">掘金</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">微博文章</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">小红书</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">抖音主页</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved. IT唯一极客 版权所有 </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>访问统计
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-站点地图">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-百度站点地图">站点地图</a> </span>
        <!-- 
  -->
        <br/>ICP备案号<span><a href="https://beian.miit.gov.cn" target="_blank">渝ICP备2022003447号</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSL安全认证" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/12-29-519.html&title=《2.Jenkins进阶之流水线pipeline语法入门学习》 — WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/12-29-519.html&title=《2.Jenkins进阶之流水线pipeline语法入门学习》 — WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/12-29-519.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《2.Jenkins进阶之流水线pipeline语法入门学习》 — WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/12-29-519.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/12-29-519.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACKUlEQVR42u3aQXKDMAwFUO5/6XSm2w7wJUFbzPMqk6TGLwtVsrRt8fp8r+P3Pz9W8p29td2xMDAwHstItts7SrJPskOPjYGB8TZGEkzzoNkL5ce8kzNjYGBg3LD2no6BgYFxR8A9PlD+nT/+v4GBgfHvGcl2SfI3Ca+/VItjYGA8kNErNX/n9Y39DQwMjIcwripEq2H32iIZAwNjbcZxSzI5YrWsrSILgRgDA2NRRnVsoldeJu8cP/0kYcXAwHgN46rULQHk1/3RNzEwMF7P2MNUr8mSv80/LQdcDAyMxzIml/V3dCGqoxij3gUGBsZjGQkyCYvVRDNPQHdDMAYGxqKMSSqWtwfyoydBf7cTi4GBsTQjOe5Vpel8FOPkug0DA2NRRg6oHvGqH+skcGNgYLyGUah6xwNe+YBFRMXAwFiaESVe8ahWr3BNDhqFYwwMjNcwqoNZeWiej1ycBHEMDIxFGdUANwm1kz2bPVgMDIwlGL3r+7yg7bUZqqfCwMB4DyNP7/KytoqsjpqVfwMMDIwlGFdd+lf3rLYldlNDDAyMRRnzx1fHL64K2VFvFgMD4+GMT3FtxdVrXpaTSAwMjKUZ1QNNAuXkWRgYGBh52le9vk8C6FUjaBgYGG9gzMcd8qGuXjg+4WFgYGAcBtDk014LoZDbYmBgYLSu76upXhKsmz0NDAyMJRi99mQvpUv2bw5YYGBgLMqYXNb3LtcmP9mosYqBgfE8xhfHy/Au8SIoMgAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 



  


<script>
  var _hmt = _hmt || [];
  (function() {
    // 百度统计
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-关注于网络安全_物联网安全开发_网络安全运维-学习心得分享';
                clearTimeout(titleTime);
            } else {
                document.title = '(つェ⊂)咦!又好了!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 
     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>
