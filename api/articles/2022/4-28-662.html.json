{"title":"Ubuntu系统运维所遇问题解决","slug":"系统运维/Linux/系统配置/Ubuntu/20.04/Ubuntu-20.04-LTS系统运维所遇问题解决","date":"2022-04-28T05:34:30.000Z","updated":"2022-08-21T02:19:16.500Z","url":"2022/4-28-662.html","path":"api/articles/2022/4-28-662.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210326222039.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200901161845.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200901161822.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201024100129.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210627155159.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210627155416.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210728163258.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"0x01-入坑出坑\"><a href=\"#0x01-入坑出坑\" class=\"headerlink\" title=\"0x01 入坑出坑\"></a>0x01 入坑出坑</h2><h3 id=\"1-Ubuntu20-04密码忘记了怎么办？\"><a href=\"#1-Ubuntu20-04密码忘记了怎么办？\" class=\"headerlink\" title=\"1.Ubuntu20.04密码忘记了怎么办？\"></a>1.Ubuntu20.04密码忘记了怎么办？</h3><p>描述:解决流程与CentOS7更改密码原理差不多都是通过修复模式进入单用户模式进行更改重置密码;</p>\n<p><strong>实施准备工作：</strong></p>\n<ul>\n<li><ol>\n<li>Ubuntu 20.04系统</li>\n</ol>\n</li>\n<li><ol start=\"2\">\n<li>具有root权限或者sudo权限</li>\n</ol>\n</li>\n<li><ol start=\"3\">\n<li>具有域名控制权，可做DNS映射，比如域网与IP的映射</li>\n</ol>\n</li>\n<li><ol start=\"4\">\n<li>熟悉Linux基本命令行操作，比如vi命令</li>\n</ol>\n</li>\n</ul>\n<p><strong>方式1:grub菜单进入单用户模式进行修改</strong></p>\n<ul>\n<li><p>1) 重启Ubuntu20.04操作系统，然后快速的按下SHIFT按键并保持，直到出现启动界面选择【Ubuntu的高级选项】回车继续。</p>\n</li>\n<li><p>2) 接下来当Ubuntu启动菜单突出显示时，按e编辑Grub的启动提示符。</p>\n</li>\n<li><p>3) 进入编辑页面后替换找到如(<code>把ro quiet splash $vt_handoff</code>)下图标记位置将 ro 替换为 rw init=/bin/bash进行grub引导参数的修改, 之后按Ctrl+X进行引导启动Ubuntu 20.04系统;</p>\n</li>\n<li><p>4) 成功启动Ubuntu 20.04系统之后，您应该直接就是root用户身份在执行命令了，而不需要输入root密码。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.执行以下命令确认根目录是否已被挂载为rw可读写权限。</span></span><br><span class=\"line\">mount | grep -w /</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.重置root密码</span></span><br><span class=\"line\">passwd root</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>5) 完成重置密码或者破解密码的工作后，重启Ubuntu 20.04，执行以下命令重启服务器：<code>exec /sbin/init</code></p>\n</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210326222039.png\" alt=\"WeiyiGeek.密码更改\" title=\"\" class=\"\">\n                <p>WeiyiGeek.密码更改</p>\n            </figure>\n<p>Tips : 如果想放弃修改，按下Ctrl+c或者F2或者ESC放弃修改，重新回到GRUB菜单中。</p>\n<p><br></p>\n<p><strong>方式2.利用恢复模式(Recovery Mode)进行root密码的修改</strong></p>\n<ul>\n<li><p>1) 选择指定内核版本的恢复模式(Recovery Mode)按回车键进入。</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200901161845.png\" alt=\"WeiyiGeek.高级选项\" title=\"\" class=\"\">\n                <p>WeiyiGeek.高级选项</p>\n            </figure>\n</li>\n<li><p>2) 选择单用户模式进行root修改密码或者重置其它用户的密码采用<code>passwd 用户</code>命令;</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200901161822.png\" alt=\"WeiyiGeek.恢复菜单\" title=\"\" class=\"\">\n                <p>WeiyiGeek.恢复菜单</p>\n            </figure>\n</li>\n<li><p>3) 退出重启(reboot)即可</p>\n</li>\n</ul>\n<p><br/></p>\n<p><strong>Tips : 如果执行passwd时，提示以下错误：</strong><br>错误提示:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">passwd: Authentication token manipulation error</span><br><span class=\"line\">passwd: password unchanged</span><br></pre></td></tr></table></figure><br>原因：根目录挂载了只读状态。</p>\n<p>解决方法如下：<code>mount -o remount,rw /</code></p>\n<p><br/></p>\n<p><strong>Tips : 如果提示错误[ end Kernel panic - not syncing: Attempted to kill init! exit code=0x0007f00</strong><br>错误原因：确保在前面修改grub参数时，删除splash启动选项。</p>\n<p><br/></p>\n<p><strong>Tips : 如果执行reboot命令时被提示：</strong><br>错误提示:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Failed to connect to bus: No such file or directory</span><br><span class=\"line\">Failed to talk to init daemon.</span><br></pre></td></tr></table></figure><br>解决办法: 忽略这样的错误，改为以下命令重启服务器：<code>exec /sbin/init</code></p>\n<p><br></p>\n<h3 id=\"2-在使用Ubuntu-Software时提示-usr-share-appdata目录不存在\"><a href=\"#2-在使用Ubuntu-Software时提示-usr-share-appdata目录不存在\" class=\"headerlink\" title=\"2.在使用Ubuntu Software时提示/usr/share/appdata目录不存在\"></a>2.在使用Ubuntu Software时提示/usr/share/appdata目录不存在</h3><p>问题描述: 新装的系统在软件商店装软件的时候一直提示/usr/share/appdata目录不存在<br>解决办法: </p>\n<ul>\n<li>(1) 图形界面打开系统监视器，并搜索 snap-store 选择 snap-store 进程并点击结束进程，然后重新打开Ubuntu软件;</li>\n<li>(2) 命令行界面打开系统监视器 <code>gnome-system-monitor</code></li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201024100129.png\" alt=\"WeiyiGeek.gnome-system-monitor\" title=\"\" class=\"\">\n                <p>WeiyiGeek.gnome-system-monitor</p>\n            </figure>\n<p><br></p>\n<h3 id=\"3-运行fcitx-config-gtk3时候显示如下-Name-“org-fcitx-Fcitx-0”-does-not-exist-警告\"><a href=\"#3-运行fcitx-config-gtk3时候显示如下-Name-“org-fcitx-Fcitx-0”-does-not-exist-警告\" class=\"headerlink\" title=\"3.运行fcitx-config-gtk3时候显示如下 Name “org.fcitx.Fcitx-0” does not exist 警告\"></a>3.运行fcitx-config-gtk3时候显示如下 Name “org.fcitx.Fcitx-0” does not exist 警告</h3><p>问题描述:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">** (fcitx-config-gtk3:19361): WARNING **: 06:55:31.194: GDBus.Error:org.freedesktop.DBus.Error.NameHasNoOwner: Name <span class=\"string\">\"org.fcitx.Fcitx-0\"</span> does not exist</span><br><span class=\"line\">** (fcitx-config-gtk3:19361): WARNING **: 06:55:42.456: GDBus.Error:org.freedesktop.DBus.Error.ServiceUnknown: The name org.fcitx.Fcitx-0 was not provided by any .service files</span><br></pre></td></tr></table></figure><br>问题原因: 由于ubuntu输入法配置为iBus需要执行<code>im-config</code>命令配置键盘输入输出为fcitx;</p>\n<p><br></p>\n<h3 id=\"4-Ubuntu-Desktop-版本右上角有一个红色的圆中间有一条白色的横线，鼠标移上去提示发生了一个错误\"><a href=\"#4-Ubuntu-Desktop-版本右上角有一个红色的圆中间有一条白色的横线，鼠标移上去提示发生了一个错误\" class=\"headerlink\" title=\"4.Ubuntu Desktop 版本右上角有一个红色的圆中间有一条白色的横线，鼠标移上去提示发生了一个错误\"></a>4.Ubuntu Desktop 版本右上角有一个红色的圆中间有一条白色的横线，鼠标移上去提示发生了一个错误</h3><p>问题描述: 发生了一个错误，请通过右键菜单运行软件包管理器或通过终端执行apt-get来查看具体错误。错误信息：“错误：已损坏个数&gt;0“，这通常意味着您安装的软件包有未满足的依赖关系<br>问题原因: 由于上次安装软件后未正确退出以及缺少依赖;<br>解决方法：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#在终端执行：</span></span><br><span class=\"line\">sudo apt-get install -f</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"5-GRUB-Bootloader密码忘记了解决办法\"><a href=\"#5-GRUB-Bootloader密码忘记了解决办法\" class=\"headerlink\" title=\"5.GRUB Bootloader密码忘记了解决办法?\"></a>5.GRUB Bootloader密码忘记了解决办法?</h3><p>描述: 如果忘记密码或grub密码无法正常工作，则可以使用<code>实时可启动闪存驱动器</code>(GParted Live)或<code>DVD</code>(操作系统镜像文件)恢复更改。</p>\n<p>Tips : 此处都是采用虚拟机进行演示所以首先需要关机然后选择相应的CD/DVD介质。</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210627155159.png\" alt=\"WeiyiGeek.ISO镜像挂载\" title=\"\" class=\"\">\n                <p>WeiyiGeek.ISO镜像挂载</p>\n            </figure>\n<p><strong>方式1: 利用 GParted Live (<a href=\"https://gparted.org/download.php\" target=\"_blank\" rel=\"noopener\">https://gparted.org/download.php</a>) 进行清除密码</strong>,下载地址: <a href=\"https://downloads.sourceforge.net/gparted/gparted-live-1.3.0-1-amd64.iso\" target=\"_blank\" rel=\"noopener\">https://downloads.sourceforge.net/gparted/gparted-live-1.3.0-1-amd64.iso</a>, 启动<code>gparted</code>查看我的案例的屏幕截图：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 用以下命令装载Linux OS根分区：</span></span><br><span class=\"line\">sudo mount /dev/sda6 /mnt/ &amp;&amp; <span class=\"built_in\">cd</span> /mnt/</span><br><span class=\"line\"><span class=\"comment\"># 然后按原样输入以下命令：</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> /sys /proc /run /dev; <span class=\"keyword\">do</span> sudo mount --<span class=\"built_in\">bind</span> <span class=\"string\">\"<span class=\"variable\">$i</span>\"</span> <span class=\"string\">\"/mnt<span class=\"variable\">$i</span>\"</span>;<span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"comment\"># 使用编辑文件/etc/grub.d/00_header删除它末尾添加如下图：</span></span><br><span class=\"line\">vi /etc/grub.d/00_header</span><br><span class=\"line\"><span class=\"comment\"># 在Debian、Ubuntu和Kali Linux上用密码保护grub的方法</span></span><br><span class=\"line\"><span class=\"comment\"># grub-install /dev/sda  # 如没有引导记录请使用以下命令在主引导记录（MBR）中安装 grub 引导程序</span></span><br><span class=\"line\">update-grub            <span class=\"comment\"># 更新grub </span></span><br><span class=\"line\">reboot <span class=\"comment\"># 重新启动系统grub密码提示消失了。</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 采用以下命令装载LVM逻辑卷的操作系统</span></span><br><span class=\"line\">sudo mount /dev/mapper/ubuntu--vg-lv--00 /mnt</span><br><span class=\"line\">chroot /mnt</span><br><span class=\"line\">mount -o remount, rw /</span><br><span class=\"line\">vim /etc/grub.d/00_header</span><br><span class=\"line\">update-grub</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210627155416.png\" alt=\"WeiyiGeek.GParted Live\" title=\"\" class=\"\">\n                <p>WeiyiGeek.GParted Live</p>\n            </figure>\n<p>Tips : Gnome Partition Editor(简写 GParted)是一种非常小巧自启动运行光盘，它采用 X.org、轻量级的 Fluxbox 窗口管理器，以及 Linux 内核构建。其中包含的 GParted 硬盘分区工具，作为系统维护盘非常有用。</p>\n<p><br/></p>\n<p><strong>方式2: 利用系统安全镜像中Rescue救援模式进行清除密码。(后面遇到在写)</strong></p>\n<p><br></p>\n<h3 id=\"6-Windows使用XRDP远程桌面连接Ubuntu后没有Dock、桌面图标及UI难看问题解决\"><a href=\"#6-Windows使用XRDP远程桌面连接Ubuntu后没有Dock、桌面图标及UI难看问题解决\" class=\"headerlink\" title=\"6.Windows使用XRDP远程桌面连接Ubuntu后没有Dock、桌面图标及UI难看问题解决\"></a>6.Windows使用XRDP远程桌面连接Ubuntu后没有Dock、桌面图标及UI难看问题解决</h3><p>描述: 采用xrdp登陆到Ubuntu时只有桌面背景并且右键菜单只有两项功能，并且右边软件栏无Dock。<br>环境说明：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ lsb_release -a</span><br><span class=\"line\">  <span class=\"comment\"># Distributor ID:\tUbuntu</span></span><br><span class=\"line\">  <span class=\"comment\"># Description:\tUbuntu 20.04.2 LTS</span></span><br><span class=\"line\">  <span class=\"comment\"># Release:\t20.04</span></span><br><span class=\"line\">  <span class=\"comment\"># Codename:\tfocal</span></span><br><span class=\"line\">$ uname -r</span><br><span class=\"line\">5.8.0-63-generic</span><br><span class=\"line\"></span><br><span class=\"line\">$ cat .xsession</span><br><span class=\"line\">gnome-session --session=ubuntu-2d</span><br><span class=\"line\"><span class=\"comment\"># 如果是 xfce 桌面 该文件则为 xfce4-session</span></span><br></pre></td></tr></table></figure></p>\n<ul>\n<li>解决办法:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.只需要安装一个 gnome 的调整工具，调整一下主题即可</span></span><br><span class=\"line\">sudo apt install gnome-tweak-tool</span><br><span class=\"line\"><span class=\"comment\"># 找到安装好的 gnome-tweak-tool 工具，打开后找到 扩展 ，然后打开 Ubuntu appindicators 与 Ubuntu dock</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重启资源控制器</span></span><br><span class=\"line\">按下alt+F2 会跳出一个窗口，然后输入一个r(重启gnome shell）</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210728163258.png\" alt=\"WeiyiGeek.Ubuntu桌面图标设置\" title=\"\" class=\"\">\n                <p>WeiyiGeek.Ubuntu桌面图标设置</p>\n            </figure>\n<p>参考连接: <a href=\"https://c-nergy.be/blog/?p=12155\" target=\"_blank\" rel=\"noopener\">https://c-nergy.be/blog/?p=12155</a></p>\n<p><br></p>\n<h3 id=\"7-Ubuntu-Gnome-桌面无法打开文件管理器或者gedit，显示Invalid-MIT-MAGIC-COOKIE-1-keyUnable-to-init-server-无法连接：-拒绝连接错误\"><a href=\"#7-Ubuntu-Gnome-桌面无法打开文件管理器或者gedit，显示Invalid-MIT-MAGIC-COOKIE-1-keyUnable-to-init-server-无法连接：-拒绝连接错误\" class=\"headerlink\" title=\"7.Ubuntu Gnome 桌面无法打开文件管理器或者gedit，显示Invalid MIT-MAGIC-COOKIE-1 keyUnable to init server: 无法连接： 拒绝连接错误\"></a>7.Ubuntu Gnome 桌面无法打开文件管理器或者gedit，显示Invalid MIT-MAGIC-COOKIE-1 keyUnable to init server: 无法连接： 拒绝连接错误</h3><ul>\n<li><p>错误信息:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ journalctl -f</span><br><span class=\"line\">7月 30 09:06:51 ubuntu-pc org.gnome.Nautilus[4675]: Invalid MIT-MAGIC-COOKIE-1 keyUnable to init server: 无法连接： 拒绝连接</span><br><span class=\"line\">7月 30 09:06:51 ubuntu-pc nautilus[4675]: cannot open display: :10.0</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>解决办法:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">➜  桌面 xhost <span class=\"built_in\">local</span>:gedit </span><br><span class=\"line\">non-network <span class=\"built_in\">local</span> connections being added to access control list</span><br><span class=\"line\">➜  桌面 xhost <span class=\"built_in\">local</span>:explorer</span><br><span class=\"line\">non-network <span class=\"built_in\">local</span> connections being added to access control list</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<h3 id=\"8-Ubuntu-软件中心显示”文件已过期，该仓库的更新将不会应用”-提示问题信息的解决办法。\"><a href=\"#8-Ubuntu-软件中心显示”文件已过期，该仓库的更新将不会应用”-提示问题信息的解决办法。\" class=\"headerlink\" title=\"8.Ubuntu 软件中心显示”文件已过期，该仓库的更新将不会应用” 提示问题信息的解决办法。\"></a>8.Ubuntu 软件中心显示”文件已过期，该仓库的更新将不会应用” 提示问题信息的解决办法。</h3><ul>\n<li>解决办法:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 排查项1.问题原因可能是系统日期不正确导致的。</span></span><br><span class=\"line\">ntpdate cn.pool.ntp.org </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 排查项2.清理 apt sources.list 中多余的list。</span></span><br><span class=\"line\">➜  ~ ls /etc/apt/sources.list.d</span><br><span class=\"line\">martinx-ubuntu-xrdp-hwe-18_04-focal.list</span><br><span class=\"line\">martinx-ubuntu-xrdp-hwe-18_04-focal.list.save</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<h3 id=\"9-Ubuntu-切换终端时显示-Failed-to-set-time-zone-Invalid-or-not-installed-time-zone-‘Asia-shanghai’-错误信息的解决办法！。\"><a href=\"#9-Ubuntu-切换终端时显示-Failed-to-set-time-zone-Invalid-or-not-installed-time-zone-‘Asia-shanghai’-错误信息的解决办法！。\" class=\"headerlink\" title=\"9.Ubuntu 切换终端时显示 Failed to set time zone: Invalid or not installed time zone ‘Asia/shanghai’ 错误信息的解决办法！。\"></a>9.Ubuntu 切换终端时显示 Failed to set time zone: Invalid or not installed time zone ‘Asia/shanghai’ 错误信息的解决办法！。</h3><ul>\n<li>错误信息: <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[sudo] weiyigeek 的密码： </span><br><span class=\"line\">Failed to <span class=\"built_in\">set</span> time zone: Invalid or not installed time zone <span class=\"string\">'Asia/shanghai</span></span><br></pre></td></tr></table></figure></li>\n<li>解决办法: 最新时区调整方法（可靠，简单）解决 <code>Time zone: Asia/Shanghai (Asia, +0000)</code> 出错的方法.<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.执行如下命令 -&gt; tzdata 设置 -&gt; 选择 None Of the above (不选择城市,直接选时区) -&gt;  选择 GMT-8 (CST 是中央标准时间) -&gt; ok</span></span><br><span class=\"line\">sudo dpkg-reconfigure tzdata</span><br><span class=\"line\">  <span class=\"comment\"># Current default time zone: 'Etc/GMT-8'</span></span><br><span class=\"line\">  <span class=\"comment\"># Local time is now:      2022年 01月 20日 星期四 13:11:04 +08.</span></span><br><span class=\"line\">  <span class=\"comment\"># Universal Time is now:  Thu Jan 20 05:11:04 UTC 2022.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.把RTC配置成 `localtime timezone` 格式（非必要而且会产生警告）</span></span><br><span class=\"line\"><span class=\"comment\"># ➜  ~ timedatectl set-local-rtc 1</span></span><br><span class=\"line\"><span class=\"comment\"># ➜  ~ timedatectl                </span></span><br><span class=\"line\"><span class=\"comment\">#                Local time: 四 2022-01-20 15:17:02 +08</span></span><br><span class=\"line\"><span class=\"comment\">#            Universal time: 四 2022-01-20 07:17:02 UTC</span></span><br><span class=\"line\"><span class=\"comment\">#                  RTC time: 四 2022-01-20 15:17:02     # 关键点</span></span><br><span class=\"line\"><span class=\"comment\">#                 Time zone: Etc/GMT-8 (+08, +0800)    </span></span><br><span class=\"line\"><span class=\"comment\"># System clock synchronized: no                        </span></span><br><span class=\"line\"><span class=\"comment\">#               NTP service: active                    </span></span><br><span class=\"line\"><span class=\"comment\">#           RTC in local TZ: yes                        # 关键点</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br/></p>\n<h3 id=\"10-在Console界面显示hung-task-timeout-secs-disables-this-message-错误信息解决办法。\"><a href=\"#10-在Console界面显示hung-task-timeout-secs-disables-this-message-错误信息解决办法。\" class=\"headerlink\" title=\"10.在Console界面显示hung_task_timeout_secs disables this message.错误信息解决办法。\"></a>10.在Console界面显示<code>hung_task_timeout_secs disables this message.</code>错误信息解决办法。</h3><ul>\n<li><p>错误信息:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> 0 &gt; /proc/sys/kernel/hung_task_timeout_secs disables this message.</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>错误原因: 默认情况下Linux会最多使用40%的可用内存作为文件系统缓存。当超过这个阈值后，文件系统会把将缓存中的内存全部写入磁盘，导致后续的IO请求都是同步的. 将缓存写入磁盘时，有一个默认120秒的超时时间, 出现上面的问题的原因是IO子系统的处理速度不够快，不能在120秒将缓存中的数据全部写入磁盘。IO系统响应缓慢，导致越来越多的请求堆积，最终系统内存全部被占用，导致系统失去响应。</p>\n</li>\n<li><p>解决办法:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 临时生效</span></span><br><span class=\"line\"><span class=\"comment\"># - vm.dirty_background_ratio : 指定了当文件系统缓存脏页数量达到系统内存百分之多少时（如5%）就会触发pdflush/flush/kdmflush等后台回写进程运行，将一定缓存的脏页异步地刷入外存；</span></span><br><span class=\"line\">sysctl -w vm.dirty_ratio=10</span><br><span class=\"line\"><span class=\"comment\"># - vm.dirty_ratio : 指定了当文件系统缓存脏页数量达到系统内存百分之多少时（如10%），系统不得不开始处理缓存脏页（因为此时脏页数量已经比较多，为了避免数据丢失需要将一定脏页刷入外存）;</span></span><br><span class=\"line\">sysctl -w vm.dirty_background_ratio=5</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 永久生效</span></span><br><span class=\"line\">tee -a /etc/sysctl.conf &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\">vm.dirty_background_ratio = 5</span><br><span class=\"line\">vm.dirty_ratio = 10</span><br><span class=\"line\">EOF</span><br><span class=\"line\">sysctl -p</span><br><span class=\"line\">reboot</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"入坑出坑","path":"api/categories/入坑出坑.json"}],"tags":[{"name":"Ubuntu","path":"api/tags/Ubuntu.json"}]}