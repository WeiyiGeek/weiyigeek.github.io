{"title":"Redis-KV数据库Java连接以及Jedis包的使用","slug":"编程世界/JavaWeb/3.JDBC/Redis-KV数据库Java连接以及Jedis包的使用","date":"2020-04-22T11:35:30.000Z","updated":"2022-03-29T05:39:06.300Z","url":"2020/4-22-307.html","path":"api/articles/2020/4-22-307.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200522170247.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-前言\"><a href=\"#0x00-前言\" class=\"headerlink\" title=\"0x00 前言\"></a>0x00 前言</h4><p>描述:Redis是一个开源的Key-Value数据缓存，和Memcached类似。现在基本上主流的语言都有客户端支持，比如java、C、C#、C++、php、Node.js、Go等。</p>\n<p>Redis多种类型的value，包括string(字符串)、list(链表)、set(集合)、zset(sorted set –有序集合)和hash（哈希类型）。</p>\n<p>Jedis 是 Redis 官方首选的 Java 客户端开发包,其他我们有shardjedis可以进行备选；</p>\n<p><em>环境准备:</em><br>开始在 Java 中使用 Redis 前， 我们需要确保已经安装了 redis 服务及 Java redis 驱动，且你的机器上能正常使用 Java。 </p>\n<ul>\n<li>Java redis 驱动:<a href=\"https://mvnrepository.com/artifact/redis.clients/jedis\" target=\"_blank\" rel=\"noopener\">https://mvnrepository.com/artifact/redis.clients/jedis</a></li>\n<li>组件依赖:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jedis-2.9.3.jar</span><br><span class=\"line\">org.apache.commons » commons-pool2\t2.6.2\t2.8.0</span><br><span class=\"line\">org.slf4j » slf4j-simple 1.7.30</span><br></pre></td></tr></table></figure></li>\n<li>PS:速度太慢的情况下可以采用此种方式:<a href=\"https://maven.aliyun.com/mvn/search\" target=\"_blank\" rel=\"noopener\">https://maven.aliyun.com/mvn/search</a></li>\n</ul>\n<hr>\n<h4 id=\"0x01-基础语法\"><a href=\"#0x01-基础语法\" class=\"headerlink\" title=\"0x01 基础语法\"></a>0x01 基础语法</h4><p>描述:主要列举了Jedis中常用的方法<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#(1) redis的默认端口是6379</span></span><br><span class=\"line\">Jedis jedis = new Jedis (<span class=\"string\">\"localhost\"</span>,6379);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(2) 密码验证</span></span><br><span class=\"line\">jedis.auth(<span class=\"string\">\"password\"</span>); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(3) 连接验证</span></span><br><span class=\"line\">jedis.connect();</span><br><span class=\"line\">jedis.ping();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(4) 断开连接</span></span><br><span class=\"line\">jedis.disconnect();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(5) 数据库号选择</span></span><br><span class=\"line\">jedis.select(1);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(6) 字符串键值设置与获取(增删改查)</span></span><br><span class=\"line\">jedis.set(<span class=\"string\">\"Key\"</span>,<span class=\"string\">\"Value\"</span>);</span><br><span class=\"line\">jedis.setex(<span class=\"string\">\"foo\"</span>, 5, <span class=\"string\">\"tor\"</span>); <span class=\"comment\">#将值value关联到key，并将key的生存时间设为seconds(秒)。 </span></span><br><span class=\"line\">jedis.get(<span class=\"string\">\"Key\"</span>);</span><br><span class=\"line\">Set&lt;String&gt; keys = jedis.keys(<span class=\"string\">\"*\"</span>);   <span class=\"comment\">#列出所有的key并存入集合中</span></span><br><span class=\"line\">Set&lt;String&gt; keys = jedis.keys(<span class=\"string\">\"key\"</span>); <span class=\"comment\">#查找特定的key并存入集合中</span></span><br><span class=\"line\">jedis.exists(<span class=\"string\">\"key1\"</span>);    <span class=\"comment\">#检查给定key是否存在</span></span><br><span class=\"line\">jedis.expire(<span class=\"string\">\"key1\"</span>, 5); <span class=\"comment\">#设置key生存时间，当key过期时，它会被自动删除。 </span></span><br><span class=\"line\">jedis.persist(<span class=\"string\">\"key1\"</span>);   <span class=\"comment\">#移除给定key的生存时间(设置这个key永不过期)</span></span><br><span class=\"line\">jedis.type(<span class=\"string\">\"key1\"</span>);      <span class=\"comment\">#返回key所储存的值的类型。 </span></span><br><span class=\"line\"><span class=\"comment\">#none(key不存在),string(字符串),list(列表),set(集合),zset(有序集),hash(哈希表) </span></span><br><span class=\"line\">jedis.rename(<span class=\"string\">\"key1\"</span>, <span class=\"string\">\"key2\"</span>); <span class=\"comment\">#将key改名为newkey,当key和newkey相同或者key不存在时,返回一个错误</span></span><br><span class=\"line\">jedis.del(<span class=\"string\">\"key1\"</span>,<span class=\"string\">\"key2\"</span>,<span class=\"string\">\"key3\"</span>,<span class=\"string\">\"key4\"</span>,<span class=\"string\">\"key5\"</span>); <span class=\"comment\">#移除给定的一个或多个key不存在则不执行;</span></span><br><span class=\"line\">jedis.dbSize();   <span class=\"comment\">#返回key的个数 </span></span><br><span class=\"line\">jedis.flushAll(); <span class=\"comment\">#清空所有的key</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(7) List集合增删改查</span></span><br><span class=\"line\">jedis.lpush(<span class=\"string\">\"ListKey1\"</span>,<span class=\"string\">\"Value0\"</span>);  <span class=\"comment\">#将值value插入到列表key的表头。 </span></span><br><span class=\"line\">jedis.lpush(<span class=\"string\">\"ListKey1\"</span>,<span class=\"string\">\"Value1\"</span>);</span><br><span class=\"line\">jedis.llen(<span class=\"string\">\"key1\"</span>)   <span class=\"comment\">#返回列表key的长度。 </span></span><br><span class=\"line\"><span class=\"comment\">#//返回列表key中指定区间内的元素,区间以偏移量start和stop指定.</span></span><br><span class=\"line\"><span class=\"comment\">#//下标(index)参数start和stop从0开始;</span></span><br><span class=\"line\"><span class=\"comment\">#//负数下标代表从后开始(-1表示列表的最后一个元素,-2表示列表的倒数第二个元素,以此类推)</span></span><br><span class=\"line\">List&lt;String&gt; list = jedis.lrange(<span class=\"string\">\"ListKey1\"</span>, 0 ,2); <span class=\"comment\">#lrange(\"key1\", 0, -1);  stop下标也在取值范围内(闭区间)</span></span><br><span class=\"line\"><span class=\"keyword\">for</span>(int i=0;i&lt;list.size();i++)&#123; </span><br><span class=\"line\">   System.out.println(list.get(i)); </span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(8) Hash集合增删改查</span></span><br><span class=\"line\">jedis.hset(<span class=\"string\">\"hashkey1\"</span>, <span class=\"string\">\"field1\"</span>, <span class=\"string\">\"field1-value\"</span>); <span class=\"comment\">#设置单个哈希表key中的域field的值设为value</span></span><br><span class=\"line\">jedis.hset(<span class=\"string\">\"hashkey1\"</span>, <span class=\"string\">\"field2\"</span>, <span class=\"string\">\"field2-value\"</span>); <span class=\"comment\">#可以不断向哈希表key中添加键值对</span></span><br><span class=\"line\"></span><br><span class=\"line\">Map&lt;String,String&gt; map = new HashMap&lt;String,String&gt;(); </span><br><span class=\"line\">map.put(<span class=\"string\">\"field1\"</span>, <span class=\"string\">\"field1-value\"</span>); </span><br><span class=\"line\">map.put(<span class=\"string\">\"field2\"</span>, <span class=\"string\">\"field2-value\"</span>); </span><br><span class=\"line\">jedis.hmset(<span class=\"string\">\"hkey1\"</span>, map);    <span class=\"comment\">#哈希表key中的不同域field的值设为value</span></span><br><span class=\"line\"></span><br><span class=\"line\">jedis.hkeys(<span class=\"string\">\"key1\"</span>);          <span class=\"comment\">#返回哈希表key中的所有域</span></span><br><span class=\"line\">jedis.hvals(<span class=\"string\">\"key1\"</span>);          <span class=\"comment\">#返回哈希表key中的所有值</span></span><br><span class=\"line\"></span><br><span class=\"line\">jedis.hget(<span class=\"string\">\"hkey1\"</span>, <span class=\"string\">\"field1\"</span>); <span class=\"comment\">#返回哈希表key中给定域field的值 </span></span><br><span class=\"line\">Map&lt;String,String&gt; map = jedis.hgetAll(<span class=\"string\">\"hashkey1\"</span>);  <span class=\"comment\">#返回哈希表key中所有域和值</span></span><br><span class=\"line\"><span class=\"keyword\">for</span>(Map.Entry entry: map.entrySet()) &#123; </span><br><span class=\"line\">   System.out.print(entry.getKey() + <span class=\"string\">\":\"</span> + entry.getValue() + <span class=\"string\">\"\\t\"</span>); </span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\">jedis.hexists(<span class=\"string\">\"key1\"</span>, <span class=\"string\">\"field1\"</span>);      <span class=\"comment\">#查看哈希表key中，给定域field是否存在</span></span><br><span class=\"line\">jedis.hdel(<span class=\"string\">\"key1\"</span>, <span class=\"string\">\"field1\"</span>,<span class=\"string\">\"field2\"</span>);<span class=\"comment\">#删除哈希表key中的一个或多个指定域</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(9) set集合增删改查</span></span><br><span class=\"line\">jedis.sadd(<span class=\"string\">\"key1\"</span>, <span class=\"string\">\"value0\"</span>);  <span class=\"comment\">#//将member元素加入到集合key当中。 </span></span><br><span class=\"line\">jedis.sadd(<span class=\"string\">\"key1\"</span>, <span class=\"string\">\"value1\"</span>);</span><br><span class=\"line\">jedis.sismember(<span class=\"string\">\"key1\"</span>, <span class=\"string\">\"value2\"</span>));  <span class=\"comment\">#//判断元素是否是集合key的成员</span></span><br><span class=\"line\"></span><br><span class=\"line\">jedis.scard(<span class=\"string\">\"key1\"</span>);                 <span class=\"comment\">#//返回集合key的元素的数量</span></span><br><span class=\"line\">Set <span class=\"built_in\">set</span> = jedis.smembers(<span class=\"string\">\"key1\"</span>);    <span class=\"comment\">#//返回集合key中的所有成员。 </span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (Object val : <span class=\"built_in\">set</span>) &#123;</span><br><span class=\"line\">  System.out.println(val);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#交、并、补</span></span><br><span class=\"line\">jedis.sinter(<span class=\"string\">\"key1\"</span>,<span class=\"string\">\"key2\"</span>)    <span class=\"comment\">#//返回一个集合的全部成员，该集合是所有给定集合的交集</span></span><br><span class=\"line\">jedis.sunion(<span class=\"string\">\"key1\"</span>,<span class=\"string\">\"key2\"</span>)    <span class=\"comment\">#//返回一个集合的全部成员，该集合是所有给定集合的并集</span></span><br><span class=\"line\">jedis.sdiff(<span class=\"string\">\"key1\"</span>,<span class=\"string\">\"key2\"</span>);    <span class=\"comment\">#//返回一个集合的全部成员，该集合是所有给定集合的差集</span></span><br><span class=\"line\"></span><br><span class=\"line\">jedis.srem(<span class=\"string\">\"key1\"</span>, <span class=\"string\">\"value1\"</span>);  <span class=\"comment\">#//移除集合中的member元素。 </span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(10)额外补充</span></span><br><span class=\"line\">jedis.set(<span class=\"string\">\"count\"</span>,<span class=\"string\">\"1\"</span>)</span><br><span class=\"line\">System.out.println(<span class=\"string\">\"incr key = \"</span> + jedis.incr(<span class=\"string\">\"count\"</span>));</span><br><span class=\"line\">System.out.println(<span class=\"string\">\"incrby key 5 = \"</span> + jedis.incrBy(<span class=\"string\">\"count\"</span>, 5));</span><br></pre></td></tr></table></figure></p>\n<hr>\n<h4 id=\"0x02-实际案例\"><a href=\"#0x02-实际案例\" class=\"headerlink\" title=\"0x02 实际案例\"></a>0x02 实际案例</h4><p>描述: 采用Jedis连接Redis数据库的基础使用案例</p>\n<p>Redis连接认证配置文件:config.properties<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Connection Redis Configure</span></span><br><span class=\"line\">RedisUrl=10.20.10.248:6379</span><br><span class=\"line\">RedisAuth=weiyigeek.top</span><br></pre></td></tr></table></figure></p>\n<p>示例1.基础语法使用<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> top.weiyigeek.connredis;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Iterator;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Properties;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"><span class=\"keyword\">import</span> redis.clients.jedis.Jedis;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Redis 连接测试</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> WeiyiGeek</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RedisDemo1</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        String[] RedisUrl=<span class=\"keyword\">null</span>;</span><br><span class=\"line\">        String RedisAuth=<span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//1.创建一个属性配置对象并打开配置文件</span></span><br><span class=\"line\">            Properties prop = <span class=\"keyword\">new</span> Properties();</span><br><span class=\"line\">            InputStream ins = RedisDemo1.class.getClassLoader().getResourceAsStream(<span class=\"string\">\"config.properties\"</span>);</span><br><span class=\"line\">            prop.load(ins);</span><br><span class=\"line\">            RedisUrl=prop.getProperty(<span class=\"string\">\"RedisUrl\"</span>).split(<span class=\"string\">\":\"</span>);</span><br><span class=\"line\">            RedisAuth=prop.getProperty(<span class=\"string\">\"RedisAuth\"</span>);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"RedisServer:\"</span>+ prop.getProperty(<span class=\"string\">\"RedisUrl\"</span>) + <span class=\"string\">\"\\nPassword:\"</span> + RedisAuth );</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//2.连接到 redis 服务</span></span><br><span class=\"line\">            Jedis jedis = <span class=\"keyword\">new</span> Jedis(RedisUrl[<span class=\"number\">0</span>],Integer.parseInt(RedisUrl[<span class=\"number\">1</span>]));</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"正在Redis认证连接...\"</span>);</span><br><span class=\"line\">            jedis.auth(RedisAuth);</span><br><span class=\"line\">   </span><br><span class=\"line\">            <span class=\"comment\">//3.查看链接是否成功并且服务是否运行</span></span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"服务正在运行: \"</span>+jedis.ping()+<span class=\"string\">\"\\n\"</span>);</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//4.选择一号库</span></span><br><span class=\"line\">            jedis.select(<span class=\"number\">1</span>);</span><br><span class=\"line\">             </span><br><span class=\"line\">            <span class=\"comment\">//5.设置 redis 字符串数据与 获取存储的数据并输出</span></span><br><span class=\"line\">            String key = <span class=\"string\">\"WeiyiGeek\"</span>;</span><br><span class=\"line\">            jedis.set(key, <span class=\"string\">\"www.weiyigeek.top\"</span>);</span><br><span class=\"line\">            jedis.set(<span class=\"string\">\"count\"</span>, <span class=\"string\">\"1\"</span>);</span><br><span class=\"line\">            jedis.setex(<span class=\"string\">\"Key\"</span>, <span class=\"number\">60</span>, <span class=\"string\">\"60 Sec\"</span>);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"当前数据库总键数:\"</span>+jedis.dbSize());</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(jedis.exists(key)) &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">\"Redis中WeyiGeek键存储的字符串为:\"</span>+ jedis.get(key));</span><br><span class=\"line\">                System.out.println(<span class=\"string\">\"其类型为 : \"</span> + jedis.type(key));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//value + 1 并返回其其值</span></span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"incr key = \"</span> + jedis.incr(<span class=\"string\">\"count\"</span>));</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"incrby key 5 = \"</span> + jedis.incrBy(<span class=\"string\">\"count\"</span>, <span class=\"number\">5</span>));</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//6.采用迭代器进行遍历所有键值</span></span><br><span class=\"line\">            Set&lt;String&gt; keys = jedis.keys(<span class=\"string\">\"*\"</span>); </span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Iterator iterator = keys.iterator(); iterator.hasNext();) &#123;</span><br><span class=\"line\">                String k = (String) iterator.next();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (jedis.type(k).equalsIgnoreCase(<span class=\"string\">\"string\"</span>)) &#123;</span><br><span class=\"line\">                    System.out.println(k + <span class=\"string\">\" - \"</span> + jedis.get(k));</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                    </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"\"</span>);</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//List集合</span></span><br><span class=\"line\">            RedisListTest(jedis);</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//Hash集合</span></span><br><span class=\"line\">            RedisHashTest(jedis);</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//Set集合</span></span><br><span class=\"line\">            RedisSetTest(jedis);</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//Zset集合</span></span><br><span class=\"line\">            RedisZsetTest(jedis);</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//清空所有的key</span></span><br><span class=\"line\">            jedis.flushAll();</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//关闭释放jedis连接资源</span></span><br><span class=\"line\">            jedis.disconnect();</span><br><span class=\"line\">            </span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// TODO Auto-generated catch block</span></span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//7.列表集合存储K-V数据到列表</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">RedisListTest</span><span class=\"params\">(Jedis jedis)</span> </span>&#123;</span><br><span class=\"line\">        jedis.lpush(<span class=\"string\">\"site-list\"</span>, <span class=\"string\">\"WeiyiGeek\"</span>);</span><br><span class=\"line\">        jedis.lpush(<span class=\"string\">\"site-list\"</span>, <span class=\"string\">\"Google\"</span>);</span><br><span class=\"line\">        jedis.lpush(<span class=\"string\">\"site-list\"</span>, <span class=\"string\">\"Taobao\"</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"列表中元素数量:  \"</span> + jedis.llen(<span class=\"string\">\"site-list\"</span>));</span><br><span class=\"line\">        <span class=\"comment\">// 获取存储的数据并输出</span></span><br><span class=\"line\">        List&lt;String&gt; list = jedis.lrange(<span class=\"string\">\"site-list\"</span>, <span class=\"number\">0</span> , <span class=\"number\">2</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>; i&lt;list.size(); i++) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"列表项为: \"</span>+list.get(i));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//8.Hash值</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">RedisHashTest</span><span class=\"params\">(Jedis jedis)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//hash值存入</span></span><br><span class=\"line\">        Map&lt;String, String&gt; map = <span class=\"keyword\">new</span> HashMap&lt;String, String&gt;();</span><br><span class=\"line\">        jedis.hset(<span class=\"string\">\"hashkey1\"</span>, <span class=\"string\">\"field1\"</span>, <span class=\"string\">\"1024\"</span>);  <span class=\"comment\">//</span></span><br><span class=\"line\">        jedis.hset(<span class=\"string\">\"hashkey1\"</span>, <span class=\"string\">\"field2\"</span>, <span class=\"string\">\"whoami\"</span>);</span><br><span class=\"line\">        map.put(<span class=\"string\">\"field3\"</span>,<span class=\"string\">\"This\"</span>);</span><br><span class=\"line\">        map.put(<span class=\"string\">\"field4\"</span>,<span class=\"string\">\"10.24\"</span>);</span><br><span class=\"line\">        jedis.hmset(<span class=\"string\">\"hashkey1\"</span>, map);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (jedis.hexists(<span class=\"string\">\"hashkey1\"</span>, <span class=\"string\">\"field1\"</span>)) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"\\n返回哈希表中给定field的值：\"</span> + jedis.hget(<span class=\"string\">\"hashkey1\"</span>, <span class=\"string\">\"field1\"</span>));</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"哈希表所有中field域名称:  \"</span> + jedis.hkeys(<span class=\"string\">\"hashkey1\"</span>));</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"哈希表所有中field域的值:  \"</span> +jedis.hvals(<span class=\"string\">\"hashkey1\"</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//循环遍历读取添加的域与值</span></span><br><span class=\"line\">        Map &lt;String,String&gt; map1 = jedis.hgetAll(<span class=\"string\">\"hashkey1\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Map.Entry&lt;String, String&gt; entry: map1.entrySet()) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"域:\"</span> + entry.getKey() + <span class=\"string\">\", 值:  \"</span> + entry.getValue());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//9.Set集合</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">RedisSetTest</span><span class=\"params\">(Jedis jedis)</span> </span>&#123;</span><br><span class=\"line\">        jedis.sadd(<span class=\"string\">\"setkey1\"</span>, <span class=\"string\">\"Java\"</span>);</span><br><span class=\"line\">        jedis.sadd(<span class=\"string\">\"setkey1\"</span>, <span class=\"string\">\"Python\"</span>);</span><br><span class=\"line\">        jedis.sadd(<span class=\"string\">\"setkey2\"</span>, <span class=\"string\">\"Redis\"</span>);</span><br><span class=\"line\">        jedis.sadd(<span class=\"string\">\"setkey2\"</span>, <span class=\"string\">\"Java\"</span>);</span><br><span class=\"line\">        jedis.sadd(<span class=\"string\">\"setkey2\"</span>, <span class=\"string\">\"Java\"</span>); <span class=\"comment\">//自动剔除重复的元素</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"\\nset 集合中setkey2键中元素数量 : \"</span> + jedis.scard(<span class=\"string\">\"setkey2\"</span>));</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!jedis.sismember(<span class=\"string\">\"setkey1\"</span>, <span class=\"string\">\"setkey2\"</span>)) &#123;</span><br><span class=\"line\">            Set set = jedis.smembers(<span class=\"string\">\"setkey2\"</span>);   <span class=\"comment\">//返回集合key中的所有成员。 </span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Object val : set) &#123;</span><br><span class=\"line\">                System.out.println(val);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//#交、并、补</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"交集:\"</span> + jedis.sinter(<span class=\"string\">\"setkey1\"</span>,<span class=\"string\">\"setkey2\"</span>));  <span class=\"comment\">//返回一个集合的全部成员，该集合是所有给定集合的交集</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"并集:\"</span> + jedis.sunion(<span class=\"string\">\"setkey1\"</span>,<span class=\"string\">\"setkey2\"</span>));  <span class=\"comment\">//返回一个集合的全部成员，该集合是所有给定集合的并集</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"差集:\"</span> + jedis.sdiff(<span class=\"string\">\"setkey1\"</span>,<span class=\"string\">\"setkey2\"</span>));   <span class=\"comment\">//返回一个集合的全部成员，该集合是所有给定集合的差集</span></span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//10.Zset集合</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">RedisZsetTest</span><span class=\"params\">(Jedis jedis)</span> </span>&#123;</span><br><span class=\"line\">       jedis.zadd(<span class=\"string\">\"Zsetkey\"</span>, <span class=\"number\">0</span>, <span class=\"string\">\"redis\"</span>);</span><br><span class=\"line\">       jedis.zadd(<span class=\"string\">\"Zsetkey\"</span>, <span class=\"number\">0</span>, <span class=\"string\">\"java\"</span>);</span><br><span class=\"line\">       jedis.zadd(<span class=\"string\">\"Zsetkey\"</span>, <span class=\"number\">1</span>, <span class=\"string\">\"eclipse\"</span>);</span><br><span class=\"line\">       Map&lt;String, Double&gt; map = <span class=\"keyword\">new</span> HashMap&lt;String, Double&gt;();</span><br><span class=\"line\">       map.put(<span class=\"string\">\"WeiyiGeek\"</span>, <span class=\"number\">1.0</span>);</span><br><span class=\"line\">       map.put(<span class=\"string\">\"Weiyi\"</span>, <span class=\"number\">3.0</span>);</span><br><span class=\"line\">       map.put(<span class=\"string\">\"极客\"</span>, <span class=\"number\">4.0</span>);</span><br><span class=\"line\">       jedis.zadd(<span class=\"string\">\"Zsetkey\"</span>, map);</span><br><span class=\"line\">       System.out.println(<span class=\"string\">\"\\n有序集合元素个数: \"</span> + jedis.zcard(<span class=\"string\">\"Zsetkey\"</span>));</span><br><span class=\"line\">       System.out.println(<span class=\"string\">\"指定集合范围内的元素个数: \"</span> + jedis.zcount(<span class=\"string\">\"Zsetkey\"</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>));  <span class=\"comment\">//把1.0 等价于 1</span></span><br><span class=\"line\">       <span class=\"comment\">//循环遍历有序计集合</span></span><br><span class=\"line\">       Set set = jedis.zrangeByScore(<span class=\"string\">\"Zsetkey\"</span>,<span class=\"number\">0</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\">       <span class=\"keyword\">for</span> (Object val : set) &#123;</span><br><span class=\"line\">           System.out.println(val);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>执行结果:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RedisServer:10.20.10.248:6379</span><br><span class=\"line\">Password:weiyigeek.top</span><br><span class=\"line\">正在Redis认证连接...</span><br><span class=\"line\">服务正在运行: PONG</span><br><span class=\"line\"></span><br><span class=\"line\">当前数据库总键数:3</span><br><span class=\"line\">Redis中WeyiGeek键存储的字符串为:www.weiyigeek.top</span><br><span class=\"line\">其类型为 : string</span><br><span class=\"line\">incr key = 2</span><br><span class=\"line\">incrby key 5 = 7</span><br><span class=\"line\">count - 7</span><br><span class=\"line\">WeiyiGeek - www.weiyigeek.top</span><br><span class=\"line\">Key - 60 Sec</span><br><span class=\"line\"></span><br><span class=\"line\">列表中元素数量:  3</span><br><span class=\"line\">列表项为: Taobao</span><br><span class=\"line\">列表项为: Google</span><br><span class=\"line\">列表项为: WeiyiGeek</span><br><span class=\"line\"></span><br><span class=\"line\">返回哈希表中给定field的值：1024</span><br><span class=\"line\">哈希表所有中field域名称:  [field1, field3, field2, field4]</span><br><span class=\"line\">哈希表所有中field域的值:  [1024, whoami, 10.24, This]</span><br><span class=\"line\">域:field3, 值:  This</span><br><span class=\"line\">域:field2, 值:  whoami</span><br><span class=\"line\">域:field1, 值:  1024</span><br><span class=\"line\">域:field4, 值:  10.24</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">set</span> 集合中setkey2键中元素数量 : 2</span><br><span class=\"line\">Java</span><br><span class=\"line\">Redis</span><br><span class=\"line\">交集:[Java]</span><br><span class=\"line\">并集:[Java, Python, Redis]</span><br><span class=\"line\">差集:[Python]</span><br><span class=\"line\"></span><br><span class=\"line\">有序集合元素个数: 6</span><br><span class=\"line\">指定集合范围内的元素个数: 4</span><br><span class=\"line\">java</span><br><span class=\"line\">redis</span><br><span class=\"line\">WeiyiGeek</span><br><span class=\"line\">eclipse</span><br><span class=\"line\">Weiyi</span><br><span class=\"line\">极客</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200522170247.png\" alt=\"WeiyiGeek.Redis\" title=\"\" class=\"\">\n                <p>WeiyiGeek.Redis</p>\n            </figure>\n<hr>\n<h4 id=\"0x03-工具包\"><a href=\"#0x03-工具包\" class=\"headerlink\" title=\"0x03 工具包\"></a>0x03 工具包</h4><h5 id=\"Jedis连接池\"><a href=\"#Jedis连接池\" class=\"headerlink\" title=\"Jedis连接池\"></a>Jedis连接池</h5><p>描述:jedis连接资源的创建与销毁是很消耗程序性能，所以jedis为我们提供了jedis的池化技术，在创建时初始化一些连接资源存储到连接池中，使用jedis连接资源时不需要创建，而是从连接池中获取一个资源进行redis的操作，使用完毕后不需要销毁该jedis连接资源，而是将该资源归还给连接池供其他请求使用。</p>\n<p><em>注意事项:</em></p>\n<ul>\n<li>1) Redis连接池建立依赖Jedis与commons-pool2-2.8.0.jar包;</li>\n<li>2) JedisPoolConfig继承关系,上面我们说到JedisPoolConfig需要依赖<code>Apache common pool</code>，其中pool配置依赖 <code>common pool</code>中的<code>BaseObjectPoolConfig</code>类中定义了相关属性的缺省值，在JedisPoolConfig中定义了相关的属性;  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#Jedispoolconfig继承关系</span></span><br><span class=\"line\">JedisPoolConfig -&gt; GenericObjectPoolConfig -&gt; BaseObjectPoolConfig -&gt; Cloneable</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#属性值&amp;缺省值</span></span><br><span class=\"line\">setTestWhileIdle();  | <span class=\"literal\">true</span></span><br><span class=\"line\">setMinEvictableIdleTimeMillis(); | 60000</span><br><span class=\"line\">setTimeBetweenEvictionRunsMillis(); | 30000</span><br><span class=\"line\">setNumTestsPerEvictionRun(); | -1</span><br></pre></td></tr></table></figure></li>\n<li>3) JedisPoolConfig参数一览<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setJmxEnabled                          <span class=\"comment\">#设置是否启用JMX,默认true</span></span><br><span class=\"line\">setJmxNameBase(String jmxNameBase)     <span class=\"comment\">#设置JMX基础名</span></span><br><span class=\"line\">setJmxNamePrefix(String jmxNamePrefix) <span class=\"comment\">#设置JMX前缀名,默认值pool</span></span><br><span class=\"line\"></span><br><span class=\"line\">setLifo(boolean lifo)  <span class=\"comment\">#设置连接对象是否后进先出默认true</span></span><br><span class=\"line\">setMaxIdle(int maxIdle) <span class=\"comment\">#设置最大空闲连接数满了则将逐出，默认为8(一般为最大连接数的45%~50%)</span></span><br><span class=\"line\">setMinIdle(int minIdle)  <span class=\"comment\">#设置无连接时池中最小的连接个数,默认连接0</span></span><br><span class=\"line\">setMaxTotal(int maxTotal) <span class=\"comment\">#设置最大连接数,默认18个</span></span><br><span class=\"line\">setMaxWaitMillis(long maxWaitMillis) <span class=\"comment\">#获取连接时的最大等待毫秒数(如果设置为阻塞时BlockWhenExhausted),如果超时就抛异常, 小于零:阻塞不确定的时间,  默认-1</span></span><br><span class=\"line\"></span><br><span class=\"line\">setTestOnBorrow(boolean testOnBorrow)  <span class=\"comment\">#从池中获取连接时是否测试连接的有效性,默认false(会消耗一定的时间但是为了稳定建议开启)</span></span><br><span class=\"line\">setTestOnCreate(boolean testOnCreate)  <span class=\"comment\">#在连接对象创建时测试连接对象的有效性,默认false</span></span><br><span class=\"line\">setTestOnReturn(boolean testOnReturn)  <span class=\"comment\">#在连接对象返回时是否测试对象的有效性,默认false</span></span><br><span class=\"line\">setTestWhileIdle(boolean testWhileIdle)  <span class=\"comment\">#在连接池空闲时是否测试连接对象的有效性,默认false</span></span><br><span class=\"line\">setBlockWhenExhausted(boolean blockWhenExhausted)  <span class=\"comment\">#当池中的资源耗尽时是否进行阻塞,设置false直接报错,true表示会一直等待，直到有可用资源</span></span><br><span class=\"line\"></span><br><span class=\"line\">setNumTestsPerEvictionRun(int numTestsPerEvictionRun)              <span class=\"comment\">#每次逐出检查时,逐出连接的个数</span></span><br><span class=\"line\">setMinEvictableIdleTimeMillis(long minEvictableIdleTimeMillis)     <span class=\"comment\">#设置连接最小的逐出间隔时间，默认1800000毫秒</span></span><br><span class=\"line\">setSoftMinEvictableIdleTimeMillis(softMinEvictableIdleTimeMillis); <span class=\"comment\">#对象空闲多久后逐出, 当空闲时间&gt;该值 且 空闲连接&gt;最大空闲数 时直接逐出,不再根据MinEvictableIdleTimeMillis判断</span></span><br><span class=\"line\">setTimeBetweenEvictionRunsMillis(long timeBetweenEvictionRunsMillis) <span class=\"comment\">#设置连接对象有效性扫描间隔,设置为-1,则不运行逐出线程</span></span><br><span class=\"line\"></span><br><span class=\"line\">setFairness(boolean fairness)  <span class=\"comment\">#当从池中获取资源或者将资源还回池中时 是否使用java.util.concurrent.locks.ReentrantLock.ReentrantLock 的公平锁机制,默认为false</span></span><br><span class=\"line\">setEvictionPolicyClassName(String evictionPolicyClassName)  <span class=\"comment\">#设置逐出策略,默认策略为\"org.apache.commons.pool2.impl.DefaultEvictionPolicy\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">getNumActive() <span class=\"comment\">#当前池中被激活的数量</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<p><strong>基础示例1:(单机Redis连接池)</strong><br>jedis.properties<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#Jedis Pool Configure</span><br><span class=\"line\">RedisHost&#x3D;10.20.172.248</span><br><span class=\"line\">RedisPort&#x3D;6379</span><br><span class=\"line\">RedisAuth&#x3D;WeiyiGeek.top</span><br><span class=\"line\">RedisDBIndex&#x3D;1</span><br><span class=\"line\">RedisTimeout&#x3D;20</span><br><span class=\"line\">RedisMaxIdle&#x3D;50</span><br><span class=\"line\">RedisMinIdle&#x3D;100</span><br><span class=\"line\">RedisMaxTotal&#x3D;100</span><br><span class=\"line\">RedisWaitMillis&#x3D;3000</span><br><span class=\"line\">RedisTestBorrow&#x3D;true</span><br><span class=\"line\">RedisTestReturn&#x3D;true</span><br><span class=\"line\">RedisBlockWhenExhausted&#x3D;true</span><br></pre></td></tr></table></figure></p>\n<p>/Web/src/top/weiyigeek/utils/RedisPoolUtil.java<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> top.weiyigeek.utils;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ResourceBundle;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> redis.clients.jedis.Jedis;</span><br><span class=\"line\"><span class=\"keyword\">import</span> redis.clients.jedis.JedisPool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> redis.clients.jedis.JedisPoolConfig;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Redis 连接池工具类建立</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> WeiyiGeek</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Date</span>: 2020年5月31日 23:47:36</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Desc</span>: Jedis(2.9.0)</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RedisPoolUtil</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> JedisPool jedisPool;  <span class=\"comment\">//jedis连接池</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String host; <span class=\"comment\">//redis主机</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Integer port; <span class=\"comment\">//redis端口</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String auth; <span class=\"comment\">//redis认证</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Integer dbindex; <span class=\"comment\">//redis仓库选择(0~15)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Integer timeout; <span class=\"comment\">//redis连接超时时间(毫秒)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Integer maxIdle; <span class=\"comment\">//在jedispool中最大的idle状态(空闲的)jedis实例的个数</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Integer minIdle; <span class=\"comment\">//在jedispool中最小的idle状态(空闲的)jedis实例的个数</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Integer maxTotal; <span class=\"comment\">//redis最大连接数</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Integer maxWaitMillis; <span class=\"comment\">//获取连接最大的等待时间(毫秒)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Boolean testOnBorrow;<span class=\"comment\">//在borow一个jedis实例的时候，是否要进行验证操作，如果赋值true，则得到的jedis实例肯定是可以用的。</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Boolean testOnReturn; <span class=\"comment\">//在return一个jedis实例的时候，是否要进行验证操作，如果赋值true，则放回的jedis实例肯定是可以用的。</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Boolean blockWhenExhausted; <span class=\"comment\">//连接耗尽的时候是否阻塞，false会抛出异常，true阻塞直到超时。默认true</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//静态代码块可以在应用启动加载时候进行</span></span><br><span class=\"line\">    <span class=\"comment\">/** 读取jedis.properties配置文件 **/</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">        ResourceBundle rb = ResourceBundle.getBundle(<span class=\"string\">\"jedis\"</span>);</span><br><span class=\"line\">        host = rb.getString(<span class=\"string\">\"RedisHost\"</span>);</span><br><span class=\"line\">        port = Integer.parseInt(rb.getString(<span class=\"string\">\"RedisPort\"</span>));</span><br><span class=\"line\">        auth = rb.getString(<span class=\"string\">\"RedisAuth\"</span>); </span><br><span class=\"line\">        dbindex = Integer.parseInt(rb.getString(<span class=\"string\">\"RedisDBIndex\"</span>));</span><br><span class=\"line\">        timeout = Integer.parseInt(rb.getString(<span class=\"string\">\"RedisTimeout\"</span>));</span><br><span class=\"line\">        maxIdle = Integer.parseInt(rb.getString(<span class=\"string\">\"RedisMaxIdle\"</span>));</span><br><span class=\"line\">        minIdle = Integer.parseInt(rb.getString(<span class=\"string\">\"RedisMinIdle\"</span>));</span><br><span class=\"line\">        maxTotal = Integer.parseInt(rb.getString(<span class=\"string\">\"RedisMaxTotal\"</span>));</span><br><span class=\"line\">        maxWaitMillis = Integer.parseInt(rb.getString(<span class=\"string\">\"RedisWaitMillis\"</span>));</span><br><span class=\"line\">        testOnBorrow = Boolean.parseBoolean(rb.getString(<span class=\"string\">\"RedisTestBorrow\"</span>));</span><br><span class=\"line\">        testOnReturn = Boolean.parseBoolean(rb.getString(<span class=\"string\">\"RedisTestReturn\"</span>));</span><br><span class=\"line\">        blockWhenExhausted = Boolean.parseBoolean(rb.getString(<span class=\"string\">\"RedisBlockWhenExhausted\"</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">   <span class=\"comment\">/** 方式1.类加载的时候初始化连接池，采用静态内部类中的静态域存储唯一一个实例，</span></span><br><span class=\"line\"><span class=\"comment\">    * 既保证了线程安全又保证了懒加载  (重点) **/</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">        JedisPoolConfig poolConfig = <span class=\"keyword\">new</span> JedisPoolConfig();</span><br><span class=\"line\">        poolConfig.setMaxIdle(maxIdle); </span><br><span class=\"line\">        poolConfig.setMaxTotal(maxTotal);  </span><br><span class=\"line\">        poolConfig.setMaxWaitMillis(maxWaitMillis);</span><br><span class=\"line\">        poolConfig.setTestOnBorrow(testOnBorrow);</span><br><span class=\"line\">        poolConfig.setTestOnReturn(testOnReturn);</span><br><span class=\"line\">        poolConfig.setBlockWhenExhausted(blockWhenExhausted);</span><br><span class=\"line\">        jedisPool = <span class=\"keyword\">new</span> JedisPool(poolConfig, host, port, timeout, auth, dbindex);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\">/** 获取 jedis 连接池 中连接**/</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Jedis <span class=\"title\">getJedis</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"当前Redis连接池被使用的数量: \"</span>+(jedisPool.getNumActive()+<span class=\"number\">1</span>));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> jedisPool.getResource();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"comment\">/** 补充:关闭 Jedis 将3.0版本开始使用 **/</span></span><br><span class=\"line\"><span class=\"comment\">//Redis JedisPool 的 returnResource 方法遭废弃，改用 close 替代。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">close</span><span class=\"params\">(Jedis jedis)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(jedis!=<span class=\"keyword\">null</span>)</span><br><span class=\"line\">            jedis.close(); </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\">/** 返还redis连接到连接池(Jedis 小于 3.0版本使用) **/</span></span><br><span class=\"line\"><span class=\"comment\">//    public static void returnResource(Jedis jedis) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//        if (jedis != null)</span></span><br><span class=\"line\"><span class=\"comment\">//            jedisPool.returnResource(jedis);</span></span><br><span class=\"line\"><span class=\"comment\">//    &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//    </span></span><br><span class=\"line\">  </span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\">/** 方式2.在多线程环境同步初始化,保证不要创建过多的jedispool和 jedis **/</span></span><br><span class=\"line\"><span class=\"comment\">//    private static synchronized void poolInit() &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//        if (jedisPool == null) &#123; </span></span><br><span class=\"line\"><span class=\"comment\">//            initialPool();</span></span><br><span class=\"line\"><span class=\"comment\">//        &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//    &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/** 同步获取Jedis实例 </span></span><br><span class=\"line\"><span class=\"comment\"> *  <span class=\"doctag\">@return</span> Jedis */</span></span><br><span class=\"line\"><span class=\"comment\">//public synchronized static Jedis getJedis() &#123; </span></span><br><span class=\"line\"><span class=\"comment\">//    if (jedisPool == null) &#123; </span></span><br><span class=\"line\"><span class=\"comment\">//        poolInit();</span></span><br><span class=\"line\"><span class=\"comment\">//    &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//    Jedis jedis = null;</span></span><br><span class=\"line\"><span class=\"comment\">//    try &#123; </span></span><br><span class=\"line\"><span class=\"comment\">//        if (jedisPool != null) &#123; </span></span><br><span class=\"line\"><span class=\"comment\">//            // 从池中获取一个Jedis对象</span></span><br><span class=\"line\"><span class=\"comment\">//            jedis = jedisPool.getResource();</span></span><br><span class=\"line\"><span class=\"comment\">//        &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//    &#125; catch (Exception e) &#123; </span></span><br><span class=\"line\"><span class=\"comment\">//        logger.error(\"Get jedis error : \"+e);</span></span><br><span class=\"line\"><span class=\"comment\">//    &#125;finally&#123;</span></span><br><span class=\"line\"><span class=\"comment\">//        returnResource(jedis);</span></span><br><span class=\"line\"><span class=\"comment\">//    &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//    return jedis;</span></span><br><span class=\"line\"><span class=\"comment\">//&#125; </span></span><br><span class=\"line\"><span class=\"comment\">//        </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h5 id=\"Jedis之Dao类\"><a href=\"#Jedis之Dao类\" class=\"headerlink\" title=\"Jedis之Dao类\"></a>Jedis之Dao类</h5><p>描述:此处是在于数据库交付操作层进行实现的工具类，只是一部分实现功能，其他功能等遇到的时候在进行补充添加;</p>\n<p>/Web/src/top/weiyigeek/connredis/RedisDemo3.java<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> top.weiyigeek.connredis;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Iterator;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"><span class=\"keyword\">import</span> redis.clients.jedis.Jedis;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RedisDemo3</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/* redis过期时间,以秒为单位 */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> EXRP_HOUR = <span class=\"number\">60</span> * <span class=\"number\">60</span> ;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> EXRP_DAY = <span class=\"number\">60</span> * <span class=\"number\">60</span> * <span class=\"number\">24</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> EXRP_MONTH = <span class=\"number\">60</span> * <span class=\"number\">60</span> * <span class=\"number\">24</span> * <span class=\"number\">30</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//常用的key类型，用于辅助不区分key类型获取key的value值(非常值得学习)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">enum</span> GetValue &#123;</span><br><span class=\"line\">        LIST()&#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getValue</span><span class=\"params\">(Jedis jedis,String key)</span> </span>&#123;</span><br><span class=\"line\">                List&lt;String&gt; list = jedis.lrange(key, <span class=\"number\">0</span>, jedis.llen(key));</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"string\">\"key=\"</span>+key+<span class=\"string\">\"|type=list|value=\"</span>+toString(list);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        HASH()&#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getValue</span><span class=\"params\">(Jedis jedis, String key)</span> </span>&#123;</span><br><span class=\"line\">                Set&lt;String&gt; keys = jedis.hkeys(key);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"string\">\"key=\"</span>+key+<span class=\"string\">\"|type=hash|value=\"</span>+toString(keys);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        SET()&#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getValue</span><span class=\"params\">(Jedis jedis, String key)</span> </span>&#123;</span><br><span class=\"line\">                Set&lt;String&gt; smembers = jedis.smembers(key);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"string\">\"key=\"</span>+key+<span class=\"string\">\"|type=set|value=\"</span>+toString(smembers);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        STRING()&#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getValue</span><span class=\"params\">(Jedis jedis, String key)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"string\">\"key=\"</span>+key+<span class=\"string\">\"|type=string|value=\"</span>+jedis.get(key);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        ZSET()&#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getValue</span><span class=\"params\">(Jedis jedis, String key)</span> </span>&#123;</span><br><span class=\"line\">                Set&lt;String&gt; keys = jedis.zrange(key, <span class=\"number\">0</span>, jedis.zcard(key));</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"string\">\"key=\"</span>+key+<span class=\"string\">\"|type=zset|value=\"</span>+toString(keys);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// TODO Auto-generated method stub</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> String <span class=\"title\">getValue</span><span class=\"params\">(Jedis jedis,String key)</span></span>;</span><br><span class=\"line\">        <span class=\"function\">String <span class=\"title\">toString</span><span class=\"params\">(Collection&lt;String&gt; collection)</span></span>&#123;</span><br><span class=\"line\">            StringBuilder sb = <span class=\"keyword\">new</span> StringBuilder();</span><br><span class=\"line\">            Iterator&lt;String&gt; iterator = collection.iterator();</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (iterator.hasNext())&#123;</span><br><span class=\"line\">                sb.append(iterator.next()).append(<span class=\"string\">\",\"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> sb.substring(<span class=\"number\">0</span>,sb.length()-<span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 判定指定的key是否存在</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> jedis</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">exits</span><span class=\"params\">(Jedis jedis, String key)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> jedis.exists(key);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  获取key的类型</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> jedis</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> String</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">type</span><span class=\"params\">(Jedis jedis, String key)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> jedis.type(key);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 设置key的过期时间</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> seconds</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">expire</span><span class=\"params\">(String key, <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> seconds)</span> </span>&#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  删除指定的key(字符串/列表/哈希/集合/有序集合)</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> jedis</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">del</span><span class=\"params\">(Jedis jedis, String key)</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (jedis.exists(key)) &#123;</span><br><span class=\"line\">               jedis.del(key);</span><br><span class=\"line\">               <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>; </span><br><span class=\"line\">           &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">               <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *         设置与获取String类型的Key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> jedis</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> seconds</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">setKeyString</span><span class=\"params\">(Jedis jedis, String key, String value, <span class=\"keyword\">int</span> seconds)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          <span class=\"comment\">//判断字符串最安全的方法</span></span><br><span class=\"line\">          value = (value == <span class=\"keyword\">null</span> ||value.isEmpty()) ? <span class=\"string\">\"\"</span>:value;</span><br><span class=\"line\">          jedis.setex(key, seconds, value);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> Exception(<span class=\"string\">\"Setting Key Error....\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">getKeyString</span><span class=\"params\">(Jedis jedis, String key)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (jedis == <span class=\"keyword\">null</span> || !jedis.exists(key)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> jedis.get(key);</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>使用示例:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> top.weiyigeek.connredis;</span><br><span class=\"line\"><span class=\"keyword\">import</span> redis.clients.jedis.Jedis;</span><br><span class=\"line\"><span class=\"keyword\">import</span> top.weiyigeek.utils.RedisPoolUtil;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RedisDemo2</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//1.测试工具类</span></span><br><span class=\"line\">        Jedis redis1 = RedisPoolUtil.getJedis();</span><br><span class=\"line\">        System.out.println(redis1.ping());</span><br><span class=\"line\">        </span><br><span class=\"line\">        Jedis redis2 = RedisPoolUtil.getJedis();</span><br><span class=\"line\">        System.out.println(redis2.ping());</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">//2.性能测试</span></span><br><span class=\"line\">        Jedis redis = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> loop = <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (loop &lt; <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">long</span> start = System.currentTimeMillis();</span><br><span class=\"line\">                redis = RedisPoolUtil.getJedis();</span><br><span class=\"line\">                redis.set(<span class=\"string\">\"k\"</span>+loop, <span class=\"string\">\"WeiyiGeek\"</span>+loop);</span><br><span class=\"line\">                String ret = redis.get(<span class=\"string\">\"k\"</span>+loop);</span><br><span class=\"line\">                <span class=\"keyword\">long</span> end = System.currentTimeMillis();</span><br><span class=\"line\">                System.out.printf(<span class=\"string\">\"Get ret from redis: %s with %d millis\\n\"</span>, ret, end-start);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (redis != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    redis.close();</span><br><span class=\"line\">                    <span class=\"comment\">//RedisPoolUtil.close(redis); //已经被close方法替代</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            loop++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        </span><br><span class=\"line\">       <span class=\"comment\">//3.Redis通用方法测试(值得学习采用枚举的形式+抽象方法实现)</span></span><br><span class=\"line\">       System.out.println(RedisDemo3.GetValue.STRING.getValue(redis, <span class=\"string\">\"Name\"</span>));       </span><br><span class=\"line\">       System.out.println(RedisDemo3.GetValue.LIST.getValue(redis, <span class=\"string\">\"site-list\"</span>));</span><br><span class=\"line\">       System.out.println(RedisDemo3.GetValue.HASH.getValue(redis, <span class=\"string\">\"hashkey1\"</span>));</span><br><span class=\"line\">       System.out.println(RedisDemo3.GetValue.SET.getValue(redis, <span class=\"string\">\"setkey1\"</span>));</span><br><span class=\"line\">       System.out.println(RedisDemo3.GetValue.ZSET.getValue(redis, <span class=\"string\">\"Zsetkey\"</span>)+<span class=\"string\">\"\\n\"</span>);</span><br><span class=\"line\">       </span><br><span class=\"line\">       </span><br><span class=\"line\">       <span class=\"comment\">//4.redis工具类测试</span></span><br><span class=\"line\">       <span class=\"comment\">//String类型(其他类型遇到的时候在写)</span></span><br><span class=\"line\">       <span class=\"keyword\">long</span> start = System.currentTimeMillis();</span><br><span class=\"line\">       <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        RedisDemo3.setKeyString(redis, <span class=\"string\">\"Name\"</span>, <span class=\"string\">\"WeiyiGeek\"</span>, <span class=\"number\">360</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// TODO Auto-generated catch block</span></span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        String value = RedisDemo3.getKeyString(redis, <span class=\"string\">\"Name\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">long</span> end = System.currentTimeMillis();</span><br><span class=\"line\">        System.out.printf(<span class=\"string\">\"Get ret from redis: %s with %d millis\\n\"</span>, value, end-start);</span><br><span class=\"line\">        </span><br><span class=\"line\">        RedisDemo3.expire(<span class=\"string\">\"Name\"</span>, <span class=\"number\">3600</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"key值是否存在 = \"</span> + RedisDemo3.exits(redis, <span class=\"string\">\"hashkey1\"</span>));</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"key值类型 = \"</span>+RedisDemo3.type(redis, <span class=\"string\">\"hashkey1\"</span>));</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"删除指定Key值状态 = \"</span> + RedisDemo3.del(redis, <span class=\"string\">\"hashkey1\"</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><strong>执行结果:</strong><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">当前Redis连接池被使用的数量: 1</span><br><span class=\"line\">PONG</span><br><span class=\"line\">当前Redis连接池被使用的数量: 2</span><br><span class=\"line\">PONG</span><br><span class=\"line\">当前Redis连接池被使用的数量: 3</span><br><span class=\"line\">Get ret from redis: WeiyiGeek1 with 2 millis</span><br><span class=\"line\">当前Redis连接池被使用的数量: 3</span><br><span class=\"line\">Get ret from redis: WeiyiGeek2 with 11 millis</span><br><span class=\"line\">key&#x3D;Name|type&#x3D;string|value&#x3D;WeiyiGeek</span><br><span class=\"line\">key&#x3D;site-list|type&#x3D;list|value&#x3D;Taobao,Google,WeiyiGeek</span><br><span class=\"line\">key&#x3D;hashkey1|type&#x3D;hash|value&#x3D;Love,Name</span><br><span class=\"line\">key&#x3D;setkey1|type&#x3D;set|value&#x3D;Python,Java</span><br><span class=\"line\">key&#x3D;Zsetkey|type&#x3D;zset|value&#x3D;java,redis,WeiyiGeek,eclipse,Weiyi,极客</span><br><span class=\"line\"></span><br><span class=\"line\">Get ret from redis: WeiyiGeek with 6 millis</span><br><span class=\"line\">key值是否存在 &#x3D; true</span><br><span class=\"line\">key值类型 &#x3D; hash</span><br><span class=\"line\">删除指定Key值状态 &#x3D; true</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h5 id=\"Jedis订阅与发布实现\"><a href=\"#Jedis订阅与发布实现\" class=\"headerlink\" title=\"Jedis订阅与发布实现\"></a>Jedis订阅与发布实现</h5><p>描述:Redis通过publish和subscribe命令实现订阅和发布的功能。</p>\n<ul>\n<li>订阅者可以通过subscribe向redis server订阅自己感兴趣的消息类型, <code>redis将信息类型称为通道(channel)</code>。</li>\n<li>当发布者通过publish命令向redis server发送特定类型的信息时，订阅该消息类型的全部订阅者都会收到此消息。</li>\n</ul>\n<p><strong>基础示例:</strong><br>Redis驱动包提供了一个抽象类<code>JedisPubSub</code>继承这个类就完成了对客户端对订阅的监听</p>\n<p>/Web/src/top/weiyigeek/utils/RedisPubSubListener.java<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> top.weiyigeek.utils;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> redis.clients.jedis.JedisPubSub;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RedisPubSubListener</span> <span class=\"keyword\">extends</span> <span class=\"title\">JedisPubSub</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//日志打印:Slf4j-simple</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Logger logger = LoggerFactory.getLogger(RedisPubSubListener.class);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">unsubscribe</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.unsubscribe();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">unsubscribe</span><span class=\"params\">(String... channels)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.unsubscribe(channels);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">subscribe</span><span class=\"params\">(String... channels)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.subscribe(channels);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">psubscribe</span><span class=\"params\">(String... patterns)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.psubscribe(patterns);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">punsubscribe</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.punsubscribe();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">punsubscribe</span><span class=\"params\">(String... patterns)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.punsubscribe(patterns);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">//监听到订阅频道接受到消息时的回调 (onMessage )  </span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onMessage</span><span class=\"params\">(String channel, String message)</span> </span>&#123;</span><br><span class=\"line\">        logger.info(<span class=\"string\">\"onMessage: channel[&#123;&#125;], message[&#123;&#125;]\"</span>,channel, message);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//监听到订阅模式接受到消息时的回调 (onPMessage)</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onPMessage</span><span class=\"params\">(String pattern, String channel, String message)</span> </span>&#123;</span><br><span class=\"line\">        logger.info(<span class=\"string\">\"onPMessage: pattern[&#123;&#125;], channel[&#123;&#125;], message[&#123;&#125;]\"</span>, pattern, channel, message);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//订阅频道时的回调( onSubscribe )</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onSubscribe</span><span class=\"params\">(String channel, <span class=\"keyword\">int</span> subscribedChannels)</span> </span>&#123;</span><br><span class=\"line\">        logger.info(<span class=\"string\">\"onSubscribe: channel[&#123;&#125;], subscribedChannels[&#123;&#125;]\"</span>, channel, subscribedChannels);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//取消订阅频道时的回调( onUnsubscribe )</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onUnsubscribe</span><span class=\"params\">(String channel, <span class=\"keyword\">int</span> subscribedChannels)</span> </span>&#123;</span><br><span class=\"line\">        logger.info(<span class=\"string\">\"channel:&#123;&#125; is been subscribed:&#123;&#125;\"</span>, channel, subscribedChannels);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">//订阅频道模式时的回调 ( onPSubscribe )</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onPSubscribe</span><span class=\"params\">(String pattern, <span class=\"keyword\">int</span> subscribedChannels)</span> </span>&#123;</span><br><span class=\"line\">        logger.info(<span class=\"string\">\"onPSubscribe: pattern[&#123;&#125;], subscribedChannels[&#123;&#125;]\"</span>, pattern, subscribedChannels);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//取消订阅模式时的回调 ( onPUnSubscribe )    @Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onPUnsubscribe</span><span class=\"params\">(String pattern, <span class=\"keyword\">int</span> subscribedChannels)</span> </span>&#123;</span><br><span class=\"line\">        logger.info(<span class=\"string\">\"onPUnsubscribe: pattern[&#123;&#125;], subscribedChannels[&#123;&#125;]\"</span>, pattern, subscribedChannels);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><strong>基础示例:订阅者</strong><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> top.weiyigeek.connredis;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.jupiter.api.Test;</span><br><span class=\"line\"><span class=\"keyword\">import</span> redis.clients.jedis.Jedis;</span><br><span class=\"line\"><span class=\"keyword\">import</span> top.weiyigeek.utils.RedisPoolUtil;</span><br><span class=\"line\"><span class=\"keyword\">import</span> top.weiyigeek.utils.RedisPubSubListener;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//subscribe订阅者</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RedisSub</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sub</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">       System.out.println(<span class=\"string\">\"--------订阅者------------------- \"</span>); </span><br><span class=\"line\">       Jedis jedis = RedisPoolUtil.getJedis();</span><br><span class=\"line\">       <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        RedisPubSubListener rpsl = <span class=\"keyword\">new</span> RedisPubSubListener();</span><br><span class=\"line\">        <span class=\"comment\">//jedis.subscribe(rpsl, \"news.blog\",\"news.share\"); //方式1.订阅频道</span></span><br><span class=\"line\">        jedis.psubscribe(rpsl,<span class=\"string\">\"news.*\"</span>);   <span class=\"comment\">//方式2.订阅频道模式采用通配符模式订阅多个频道</span></span><br><span class=\"line\">       &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">           e.printStackTrace();</span><br><span class=\"line\">       &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (jedis != <span class=\"keyword\">null</span>)</span><br><span class=\"line\">               jedis.close();</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><strong>基础示例:发布者</strong><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> top.weiyigeek.connredis;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</span><br><span class=\"line\"><span class=\"keyword\">import</span> redis.clients.jedis.Jedis;</span><br><span class=\"line\"><span class=\"keyword\">import</span> top.weiyigeek.utils.RedisPoolUtil;</span><br><span class=\"line\"><span class=\"comment\">//publish 发布者</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RedisPub</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Pub</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"-------发布者------------- \"</span>);</span><br><span class=\"line\">        Jedis jedis = RedisPoolUtil.getJedis();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            jedis.publish(<span class=\"string\">\"news.share\"</span>, <span class=\"string\">\"WeiyiGeek-个人分享\"</span>);</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">2000</span>);</span><br><span class=\"line\">            jedis.publish(<span class=\"string\">\"news.blog\"</span>, <span class=\"string\">\"WeiyiGeek-个人博客\"</span>);</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">            jedis.publish(<span class=\"string\">\"new\"</span>, <span class=\"string\">\"最新信息\"</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// <span class=\"doctag\">TODO:</span> handle finally clause</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (jedis != <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                   jedis.close();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><strong>执行结果:</strong><br>此时当在有客户端向new.share或者new.blog通道publish消息时<code>jedis.publish(channel, message)</code>，onMessage方法即可被触发。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#--------订阅者------------------- </span></span><br><span class=\"line\"><span class=\"comment\">#当前Redis连接池被使用的数量: 0</span></span><br><span class=\"line\">[main] INFO top.weiyigeek.utils.RedisPubSubListener - onPSubscribe: pattern[news.*], subscribedChannels[1]</span><br><span class=\"line\">[main] INFO top.weiyigeek.utils.RedisPubSubListener - onPMessage: pattern[news.*], channel[news.blog], message[www.weiyigeek.top]</span><br><span class=\"line\">[main] INFO top.weiyigeek.utils.RedisPubSubListener - onPMessage: pattern[news.*], channel[news.share], message[WeiyiGeek-个人分享]</span><br><span class=\"line\">[main] INFO top.weiyigeek.utils.RedisPubSubListener - onPMessage: pattern[news.*], channel[news.blog], message[WeiyiGeek-个人博客]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#-------发布者------------- </span></span><br><span class=\"line\">当前Redis连接池被使用的数量: 0</span><br></pre></td></tr></table></figure></p>\n<p><em>借鉴参考:</em></p>\n<ul>\n<li><a href=\"https://www.cnblogs.com/onlymate/p/9524960.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/onlymate/p/9524960.html</a></li>\n</ul>\n<p><br></p>\n<hr>\n<h4 id=\"0x04-入坑解决\"><a href=\"#0x04-入坑解决\" class=\"headerlink\" title=\"0x04 入坑解决\"></a>0x04 入坑解决</h4><p><strong>0) 针对Redis实例JedisPool提示JedisPoolConfig报错问题</strong><br>答:在进行测试Redis连接池的使用时候，jedisPoolConfig无补充方法且报启动错误信息<code>org.apache.commons.pool2</code>;<br>解决办法:</p>\n<ul>\n<li>1.Apache中下载Commons.pool2.jar包然后导入添加到工程里面;</li>\n</ul>\n<p><strong>1) 回收函数returnResource弃用说明</strong><br>答:其中有个函数returnResource已经deprecated了，现在Jedis的close方法重写了，用Jedis.close来释放资源。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@deprecated</span> starting from Jedis 3.0 this method will not be exposed.</span></span><br><span class=\"line\"><span class=\"comment\">* Resource cleanup should be done using <span class=\"doctag\">@see</span> &#123;<span class=\"doctag\">@link</span> redis.clients.jedis.Jedis#close()&#125;</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"meta\">@Deprecated</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">returnResource</span><span class=\"params\">(<span class=\"keyword\">final</span> Jedis resource)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (resource != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        resource.resetState();</span><br><span class=\"line\">        returnResourceObject(resource);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">        returnBrokenResource(resource);</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> JedisException(<span class=\"string\">\"Could not return the resource to the pool\"</span>, e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//自Jedis3.0版本后jedisPool.returnResource()遭弃用,官方重写了Jedis的close方法用以代替进行资源回收，官方代码如下：</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">close</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (dataSource != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (client.isBroken()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.dataSource.returnBrokenResource(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.dataSource.returnResource(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        client.close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><strong>2) 在订阅与发布进行日志输出的时候slf4j的jar包导入错误导致不支持logger.info方法</strong><br>描述:slf4j-simple-1.7.9<a href=\"https://repo1.maven.org/maven2/org/slf4j/slf4j-simple/1.7.9/slf4j-simple-1.7.9.jar\" target=\"_blank\" rel=\"noopener\">下载地址</a>然后导包到工程之中;<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Logger logger = LoggerFactory.getLogger(RedisPubSubListener.class);</span><br><span class=\"line\"> logger.info(<span class=\"string\">\"onMessage: channel[&#123;&#125;], message[&#123;&#125;]\"</span>,channel, message); <span class=\"comment\">//采用占位符</span></span><br></pre></td></tr></table></figure></p>\n<hr>\n<h4 id=\"0x05-补充案例\"><a href=\"#0x05-补充案例\" class=\"headerlink\" title=\"0x05 补充案例\"></a>0x05 补充案例</h4><p>SpringCloud 框架Until包:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.cache.annotation.CachingConfigurerSupport;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> redis.clients.jedis.JedisPool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> redis.clients.jedis.JedisPoolConfig;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableCaching</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RedisConfig</span> <span class=\"keyword\">extends</span> <span class=\"title\">CachingConfigurerSupport</span> </span>&#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;spring.redis.database&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> index;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;spring.redis.host&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String host;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;spring.redis.port&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> port;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;spring.redis.timeout&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> timeout;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;spring.redis.pool.max-idle&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> maxIdle;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;spring.redis.pool.max-wait&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> maxWaitMillis;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;spring.redis.password&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String password;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> JedisPool <span class=\"title\">redisPoolFactory</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        JedisPoolConfig jedisPoolConfig = <span class=\"keyword\">new</span> JedisPoolConfig();</span><br><span class=\"line\">        jedisPoolConfig.setMaxIdle(maxIdle);</span><br><span class=\"line\">        jedisPoolConfig.setMaxWaitMillis(maxWaitMillis);</span><br><span class=\"line\">        JedisPool jedisPool = <span class=\"keyword\">new</span> JedisPool(jedisPoolConfig, host, port, timeout, password,index);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> jedisPool;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>基础示例:<br>redis配置</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#redis实例</span></span><br><span class=\"line\">redis.info=192.168.127.128:6379,192.168.127.128:6380</span><br><span class=\"line\"><span class=\"comment\">#redis最大连接数</span></span><br><span class=\"line\">redis.pool.maxTotal=50</span><br><span class=\"line\">redis.pool.maxIdle=20</span><br><span class=\"line\">redis.pool.minIdle=10</span><br><span class=\"line\">redis.pool.maxWaitMillis=1000</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Component</span><br><span class=\"line\">@Data</span><br><span class=\"line\">@PropertySource(<span class=\"string\">\"config/properties\"</span>)</span><br><span class=\"line\">public class RedisConfig &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Value(<span class=\"string\">\"<span class=\"variable\">$&#123;redis.info&#125;</span>\"</span>)</span><br><span class=\"line\">    private String redisInfo;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Value(<span class=\"string\">\"<span class=\"variable\">$&#123;redis.pool.maxTotal&#125;</span>\"</span>)</span><br><span class=\"line\">    private int maxTotal;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Value(<span class=\"string\">\"<span class=\"variable\">$&#123;redis.pool.maxIdle&#125;</span>\"</span>)</span><br><span class=\"line\">    private int maxIdle;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Value(<span class=\"string\">\"<span class=\"variable\">$&#123;redis.pool.minIdle&#125;</span>\"</span>)</span><br><span class=\"line\">    private int minIdle;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Value(<span class=\"string\">\"<span class=\"variable\">$&#123;redis.pool.maxWaitMillis&#125;</span>\"</span>)</span><br><span class=\"line\">    private int maxWaitMillis;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>shardjedis采用一致hash算法实现key的分片，通过计算key的hash值将key分布到不同的redis服务器上，从而达到横向扩展的目的。<br>以下介绍shardjedis的常用操作。</p>\n<p>配置shardjedispool<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Configuration</span><br><span class=\"line\">@ComponentScan(basePackages = <span class=\"string\">\"config\"</span>)</span><br><span class=\"line\">public class ShardJedisPool &#123;</span><br><span class=\"line\">    @Autowired</span><br><span class=\"line\">    RedisConfig redisConfig;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     *获取jedisinfo信息</span><br><span class=\"line\">     * @<span class=\"built_in\">return</span></span><br><span class=\"line\">     */</span><br><span class=\"line\">    private List&lt;JedisShardInfo&gt; <span class=\"function\"><span class=\"title\">jedisShardInfos</span></span>()&#123;</span><br><span class=\"line\">        String[] redisInfos = redisConfig.getRedisInfo().split(<span class=\"string\">\",\"</span>);</span><br><span class=\"line\">        List&lt;JedisShardInfo&gt; jedisShardInfos = new ArrayList&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(String redisInfo :redisInfos)&#123;</span><br><span class=\"line\">            String[] part = redisInfo.split(<span class=\"string\">\":\"</span>);</span><br><span class=\"line\">            jedisShardInfos.add(new JedisShardInfo(part[0],Integer.parseInt(part[1])));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">return</span> jedisShardInfos;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * 设置redis的参数配置</span><br><span class=\"line\">     * @<span class=\"built_in\">return</span></span><br><span class=\"line\">     */</span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public GenericObjectPoolConfig <span class=\"function\"><span class=\"title\">genericObjectPoolConfig</span></span>()&#123;</span><br><span class=\"line\">        GenericObjectPoolConfig genericObjectPoolConfig = new GenericObjectPoolConfig();</span><br><span class=\"line\">        genericObjectPoolConfig.setMaxIdle(redisConfig.getMaxIdle());</span><br><span class=\"line\">        genericObjectPoolConfig.setMaxTotal(redisConfig.getMaxTotal());</span><br><span class=\"line\">        genericObjectPoolConfig.setMinIdle(redisConfig.getMinIdle());</span><br><span class=\"line\">        genericObjectPoolConfig.setMaxWaitMillis(redisConfig.getMaxWaitMillis());</span><br><span class=\"line\">        <span class=\"built_in\">return</span> genericObjectPoolConfig;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * 获取shardjedis连接池</span><br><span class=\"line\">     * @param genericObjectPoolConfig</span><br><span class=\"line\">     * @<span class=\"built_in\">return</span></span><br><span class=\"line\">     */</span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public ShardedJedisPool shardedJedisPool(GenericObjectPoolConfig genericObjectPoolConfig)&#123;</span><br><span class=\"line\">        <span class=\"built_in\">return</span> new ShardedJedisPool(genericObjectPoolConfig,jedisShardInfos());</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<p>常用方法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Component</span><br><span class=\"line\">public class JedisAction &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Autowired</span><br><span class=\"line\">    private ShardedJedisPool shardedJedisPool;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * 获取string类型的value</span><br><span class=\"line\">     * @param key</span><br><span class=\"line\">     * @<span class=\"built_in\">return</span></span><br><span class=\"line\">     */</span><br><span class=\"line\">    public String get(String key)&#123;</span><br><span class=\"line\">        try(ShardedJedis shardedJedis = shardedJedisPool.getResource()) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">return</span> shardedJedis.get(key);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * 设置string类型的值</span><br><span class=\"line\">     * @param key</span><br><span class=\"line\">     * @param value</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public void <span class=\"built_in\">set</span>(String key,String value)&#123;</span><br><span class=\"line\">       try (ShardedJedis shardedJedis = shardedJedisPool.getResource())&#123;</span><br><span class=\"line\">           shardedJedis.set(key,value);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * 删除key</span><br><span class=\"line\">     * @param key</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public void del(String key)&#123;</span><br><span class=\"line\">        try(ShardedJedis shardedJedis = shardedJedisPool.getResource())&#123;</span><br><span class=\"line\">            shardedJedis.del(key);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * 判断key是否存在</span><br><span class=\"line\">     * @param key</span><br><span class=\"line\">     * @<span class=\"built_in\">return</span></span><br><span class=\"line\">     */</span><br><span class=\"line\">    public boolean exits(String key)&#123;</span><br><span class=\"line\">        try(ShardedJedis shardedJedis = shardedJedisPool.getResource())&#123;</span><br><span class=\"line\">            <span class=\"built_in\">return</span> shardedJedis.exists(key);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * 获取key的类型</span><br><span class=\"line\">     * @param key</span><br><span class=\"line\">     * @<span class=\"built_in\">return</span></span><br><span class=\"line\">     */</span><br><span class=\"line\">    public String <span class=\"built_in\">type</span>(String key)&#123;</span><br><span class=\"line\">        try(ShardedJedis shardedJedis = shardedJedisPool.getResource())&#123;</span><br><span class=\"line\">            <span class=\"built_in\">return</span> shardedJedis.type(key);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * 设置key的过期时间</span><br><span class=\"line\">     * @param key</span><br><span class=\"line\">     * @param seconds</span><br><span class=\"line\">     */</span><br><span class=\"line\">    public void expire(String key,final int seconds)&#123;</span><br><span class=\"line\">        try(ShardedJedis shardedJedis = shardedJedisPool.getResource())&#123;</span><br><span class=\"line\">            shardedJedis.expire(key,seconds);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * 根据key的模糊类型获取所有的key</span><br><span class=\"line\">     * @param pattern</span><br><span class=\"line\">     * @<span class=\"built_in\">return</span></span><br><span class=\"line\">     */</span><br><span class=\"line\">    public List&lt;String&gt; keys(String pattern)&#123;</span><br><span class=\"line\">        try(ShardedJedis shardedJedis = shardedJedisPool.getResource())&#123;</span><br><span class=\"line\">            Collection&lt;Jedis&gt; allShards = shardedJedis.getAllShards();</span><br><span class=\"line\">            List&lt;String&gt; keyList = new ArrayList&lt;&gt;();</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(Jedis jedis:allShards)&#123;</span><br><span class=\"line\">                Set&lt;String&gt; keys = jedis.keys(pattern);</span><br><span class=\"line\">                keyList.addAll(keys);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">return</span> keyList;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * 获取所有匹配模糊key的value值</span><br><span class=\"line\">     * @param pattern</span><br><span class=\"line\">     * @<span class=\"built_in\">return</span></span><br><span class=\"line\">     */</span><br><span class=\"line\">    public List&lt;String&gt; getValues(String pattern)&#123;</span><br><span class=\"line\">        try(ShardedJedis shardedJedis = shardedJedisPool.getResource())&#123;</span><br><span class=\"line\">            Collection&lt;Jedis&gt; allShards = shardedJedis.getAllShards();</span><br><span class=\"line\">            List&lt;String&gt; values = new ArrayList&lt;&gt;();</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(Jedis jedis:allShards)&#123;</span><br><span class=\"line\">                Set&lt;String&gt; keys = jedis.keys(pattern);</span><br><span class=\"line\">                <span class=\"keyword\">for</span>(String key:keys)&#123;</span><br><span class=\"line\">                    values.add(getValue(jedis,key));</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"built_in\">return</span> values;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * 不区分key的类型获取key的value，可以匹配string,list,<span class=\"built_in\">hash</span>,<span class=\"built_in\">set</span>四种类型</span><br><span class=\"line\">     * @param jedis</span><br><span class=\"line\">     * @param key</span><br><span class=\"line\">     * @<span class=\"built_in\">return</span></span><br><span class=\"line\">     */</span><br><span class=\"line\">    public String getValue(Jedis jedis,String key)&#123;</span><br><span class=\"line\">        String <span class=\"built_in\">type</span> = jedis.type(key);</span><br><span class=\"line\">        GetValue value = GetValue.valueOf(type.toUpperCase());</span><br><span class=\"line\">        <span class=\"built_in\">return</span> value.getValue(jedis,key);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h4 id=\"jedisCluster连接redis（集群）\"><a href=\"#jedisCluster连接redis（集群）\" class=\"headerlink\" title=\"jedisCluster连接redis（集群）\"></a>jedisCluster连接redis（集群）</h4><p>描述:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Test</span><br><span class=\"line\">public void testJedisCluster()throws Exception&#123;</span><br><span class=\"line\">    //创建jedisCluster对象，有一个参数 nodes是Set类型，Set包含若干个HostAndPort对象</span><br><span class=\"line\">    Set&lt;HostAndPort&gt; nodes = new HashSet&lt;&gt;();</span><br><span class=\"line\">    nodes.add(new HostAndPort(<span class=\"string\">\"192.168.241.133\"</span>,7001));</span><br><span class=\"line\">    nodes.add(new HostAndPort(<span class=\"string\">\"192.168.241.133\"</span>,7002));</span><br><span class=\"line\">    nodes.add(new HostAndPort(<span class=\"string\">\"192.168.241.133\"</span>,7003));</span><br><span class=\"line\">    nodes.add(new HostAndPort(<span class=\"string\">\"192.168.241.133\"</span>,7004));</span><br><span class=\"line\">    nodes.add(new HostAndPort(<span class=\"string\">\"192.168.241.133\"</span>,7005));</span><br><span class=\"line\">    nodes.add(new HostAndPort(<span class=\"string\">\"192.168.241.133\"</span>,7006));</span><br><span class=\"line\">    JedisCluster jedisCluster = new JedisCluster(nodes);</span><br><span class=\"line\">    //使用jedisCluster操作redis</span><br><span class=\"line\">    jedisCluster.set(<span class=\"string\">\"test\"</span>, <span class=\"string\">\"my forst jedis\"</span>);</span><br><span class=\"line\">    String str = jedisCluster.get(<span class=\"string\">\"test\"</span>);</span><br><span class=\"line\">    System.out.println(str);</span><br><span class=\"line\">    //关闭连接池</span><br><span class=\"line\">    jedisCluster.close();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">JedisCluster设置密码</span><br><span class=\"line\">1. 修改配置文件，通过requirePass指定密码</span><br><span class=\"line\">2. 通过JedisCluster构造方法指定密码</span><br><span class=\"line\">new JedisCluster(node, connectionTimeout, soTimeout, maxAttempts, password, poolConfig)</span><br><span class=\"line\">new JedisCluster(jedisClusterNode, connectionTimeout, soTimeout, maxAttempts, password, poolConfig)</span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Java","path":"api/categories/Java.json"}],"tags":[{"name":"redis","path":"api/tags/redis.json"}]}