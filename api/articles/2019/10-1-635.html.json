{"title":"DNS漏洞利用实践","slug":"网安大类/Vulnerable/服务端口/53-DNS","date":"2019-10-01T05:34:30.000Z","updated":"2022-03-30T05:11:15.354Z","url":"2019/10-1-635.html","path":"api/articles/2019/10-1-635.html.json","covers":null,"content":"<p><b style=\"color:red\">注意：本文分享给安全从业人员、网站开发人员以及运维人员在日常工作防范恶意攻击,请勿恶意使用下面介绍技术进行非法攻击操作。</b></p>\n<p>[TOC]</p>\n<a id=\"more\"></a>\n<p>很多dns探测工具，都会首先尝试dns区域传送，然后才是暴力枚举，那么什么是DNS区域传送漏洞呢？</p>\n<p>区域传送操作指的是一台后备服务器使用来自主服务器的数据刷新自己的zone数据库。这为运行中的DNS服务提供了一定的冗余度，其目的是为了防止主域名服务器因意外故障变得不可用时影响到全局。一般来说，DNS区域传送操作只在网络里真的有后备域名DNS服务器时才有必要执行，但许多DNS服务器却被错误地配置成只要有人发出请求，就会向对方提供一个zone数据库的拷贝。如果所提供的信息只是与连到因特网上且具备有效主机名的系统相关，那么这种错误配置不一定是坏事，尽管这使得攻击者发现潜在目标要容易得多。真正的问题发生在一个单位没有使用公用/私用DNS机制来分割外部公用DNS信息和内部私用DNS信息的时候，此时内部主机名和IP地址都暴露给了攻击者。把内部IP地址信息提供给因特网上不受信任的用户，就像是把一个单位的内部网络完整蓝图或导航图奉送给了别人。</p>\n<p>使用dig工具可以检测dns 区域传送漏洞，语法如下：</p>\n<p>dig axfr @域名服务器 被检测域名</p>\n<p>示例：</p>\n<p>root@kali-xuanhun:~# dig @wormhole.movie.edu movie.edu axfr</p>\n<p>; &lt;&lt;&gt;&gt; DiG 9.8.4-rpz2+rl005.12-P1 &lt;&lt;&gt;&gt; @wormhole.movie.edu movie.edu axfr</p>\n<p>; (1 server found)</p>\n<p>;; global options: +cmd</p>\n<p>;; connection timed out; no servers could be reached</p>\n<p>root@kali-xuanhun:~# dig axfr @ns12.zoneedit.com zonetransfer.me</p>\n<p>; &lt;&lt;&gt;&gt; DiG 9.8.4-rpz2+rl005.12-P1 &lt;&lt;&gt;&gt; axfr @ns12.zoneedit.com zonetransfer.me</p>\n<p>; (1 server found)</p>\n<p>;; global options: +cmd</p>\n<p>zonetransfer.me. 7200 IN SOA ns16.zoneedit.com. soacontact.zoneedit.com. 2013064418 2400 360 1209600 300</p>\n<p>zonetransfer.me. 7200 IN NS ns16.zoneedit.com.</p>\n<p>zonetransfer.me. 7200 IN NS ns12.zoneedit.com.</p>\n<p>zonetransfer.me. 7200 IN A 217.147.180.162</p>\n<p>zonetransfer.me. 7200 IN MX 0 ASPMX.L.GOOGLE.COM.</p>\n<p>zonetransfer.me. 7200 IN MX 10 ALT1.ASPMX.L.GOOGLE.COM.</p>\n<p>zonetransfer.me. 7200 IN MX 10 ALT2.ASPMX.L.GOOGLE.COM.</p>\n<p>zonetransfer.me. 7200 IN MX 20 ASPMX2.GOOGLEMAIL.COM.</p>\n<p>zonetransfer.me. 7200 IN MX 20 ASPMX3.GOOGLEMAIL.COM.</p>\n<p>zonetransfer.me. 7200 IN MX 20 ASPMX4.GOOGLEMAIL.COM.</p>\n<p>zonetransfer.me. 7200 IN MX 20 ASPMX5.GOOGLEMAIL.COM.</p>\n<p>zonetransfer.me. 301 IN TXT “Remember to call or email Pippa on +44 123 4567890 or <a href=\"mailto:pippa@zonetransfer.me\">pippa@zonetransfer.me</a> when making DNS changes”</p>\n<p>zonetransfer.me. 301 IN TXT “google-site-verification=tyP28J7JAUHA9fw2sHXMgcCC0I6XBmmoVi04VlMewxA”</p>\n<p>testing.zonetransfer.me. 301 IN CNAME <a href=\"http://www.zonetransfer.me\" target=\"_blank\" rel=\"noopener\">www.zonetransfer.me</a>.</p>\n<p>164.180.147.217.in-addr.arpa.zonetransfer.me. 7200 IN PTR <a href=\"http://www.zonetransfer.me\" target=\"_blank\" rel=\"noopener\">www.zonetransfer.me</a>.</p>\n<p>ipv6actnow.org.zonetransfer.me. 7200 IN AAAA 2001:67c:2e8:11::c100:1332</p>\n<p>asfdbauthdns.zonetransfer.me. 7900 IN AFSDB 1 asfdbbox.zonetransfer.me.</p>\n<p>office.zonetransfer.me. 7200 IN A 4.23.39.254</p>\n<p>owa.zonetransfer.me. 7200 IN A 207.46.197.32</p>\n<p>info.zonetransfer.me. 7200 IN TXT “ZoneTransfer.me service provided by Robin Wood - <a href=\"mailto:robin@digininja.org\">robin@digininja.org</a>. See <a href=\"http://www.digininja.org/projects/zonetransferme.php\" target=\"_blank\" rel=\"noopener\">www.digininja.org/projects/zonetransferme.php</a> for more information.”</p>\n<p>asfdbbox.zonetransfer.me. 7200 IN A 127.0.0.1</p>\n<p>canberra_office.zonetransfer.me. 7200 IN A 202.14.81.230</p>\n<p>asfdbvolume.zonetransfer.me. 7800 IN AFSDB 1 asfdbbox.zonetransfer.me.</p>\n<p>email.zonetransfer.me. 2222 IN NAPTR 1 1 “” “E2U+email” “” email.zoneedit.com.zonetransfer.me.</p>\n<p>dzc.zonetransfer.me. 7200 IN TXT “AbCdEfG”</p>\n<p>dr.zonetransfer.me. 300 IN LOC 53 20 56.558 N 1 38 33.526 W 0.00m 1m 10000m 10m</p>\n<p>rp.zonetransfer.me. 321 IN RP robin.zonetransfer.me.zonetransfer.me. robinwood.zonetransfer.me.</p>\n<p>sip.zonetransfer.me. 3333 IN NAPTR 2 3 “au” “E2U+sip” “!^.*$!sip:<a href=\"mailto:customer-service@zonetransfer.me\">customer-service@zonetransfer.me</a>!” .</p>\n<p>alltcpportsopen.firewall.test.zonetransfer.me. 301 IN A 127.0.0.1</p>\n<p><a href=\"http://www.zonetransfer.me\" target=\"_blank\" rel=\"noopener\">www.zonetransfer.me</a>. 7200 IN A 217.147.180.162</p>\n<p>staging.zonetransfer.me. 7200 IN CNAME <a href=\"http://www.sydneyoperahouse.com\" target=\"_blank\" rel=\"noopener\">www.sydneyoperahouse.com</a>.</p>\n<p>deadbeef.zonetransfer.me. 7201 IN AAAA dead:beaf::</p>\n<p>robinwood.zonetransfer.me. 302 IN TXT “Robin Wood”</p>\n<p>vpn.zonetransfer.me. 4000 IN A 174.36.59.154</p>\n<p>_sip._tcp.zonetransfer.me. 14000 IN SRV 0 0 5060 <a href=\"http://www.zonetransfer.me\" target=\"_blank\" rel=\"noopener\">www.zonetransfer.me</a>.</p>\n<p>dc_office.zonetransfer.me. 7200 IN A 143.228.181.132</p>\n<p>zonetransfer.me. 7200 IN SOA ns16.zoneedit.com. soacontact.zoneedit.com. 2013064418 2400 360 1209600 300</p>\n<p>;; Query time: 425 msec</p>\n<p>;; SERVER: 209.62.64.46#53(209.62.64.46)</p>\n<p>;; WHEN: Tue Dec 24 14:12:21 2013</p>\n<p>;; XFR size: 37 records (messages 37, bytes 2673)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">weiyigeek@weiyigeek-107:~$ dig axfr @192.168.12.254 weiyigeek.cn</span><br><span class=\"line\"></span><br><span class=\"line\">; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; axfr @192.168.12.254 weiyigeek.cn</span><br><span class=\"line\">; (1 server found)</span><br><span class=\"line\">;; global options: +cmd</span><br><span class=\"line\">; Transfer failed.</span><br></pre></td></tr></table></figure>","comments":true,"excerpt":"注意：本文分享给安全从业人员、网站开发人员以及运维人员在日常工作防范恶意攻击,请勿恶意使用下面介绍技术进行非法攻击操作。[TOC]","categories":[{"name":"漏洞分析","path":"api/categories/漏洞分析.json"},{"name":"服务安全","path":"api/categories/服务安全.json"}],"tags":[{"name":"DNS","path":"api/tags/DNS.json"}]}