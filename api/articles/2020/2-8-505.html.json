{"title":"1.安卓逆向学习入门记录","slug":"软件逆向/Android/1.安卓逆向学习入门记录","date":"2020-02-08T05:34:30.000Z","updated":"2022-03-16T07:21:34.102Z","url":"2020/2-8-505.html","path":"api/articles/2020/2-8-505.html.json","covers":null,"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-前言\"><a href=\"#0x00-前言\" class=\"headerlink\" title=\"0x00 前言\"></a>0x00 前言</h4><p>Android 安全与逆向分析, 自从2017年网络安全法的实施，网络安全受到越来越多的企业和行业的重视，Android 安全的重要性已无需多言，只要有智能机的朋友无论是apple还是Android都是离不开其内部的生态圈的, 所以自2017年起各大主流的加固采取VM优化代码,加之各厂商协议越来越底层和采用证书, 更越发重视服务器的风险控制和安全保障, 所以对安卓软件和安卓系统的渗透测试已成为热门的学习方向;</p>\n<p>学习流程:</p>\n<ul>\n<li>1.环境搭建</li>\n<li>2.APK文件结构</li>\n<li>3.APK打包流程</li>\n<li>4.APK安装流程</li>\n<li>5.APK反编译与回编译</li>\n<li>6.基础知识点(编程语言:Java C/C++ , 虚拟机)</li>\n<li>7.Dalvk字节码</li>\n<li>8.small文件</li>\n<li>9.快速定位关键代码</li>\n</ul>\n<hr>\n<h4 id=\"0x01-基础环境\"><a href=\"#0x01-基础环境\" class=\"headerlink\" title=\"0x01 基础环境\"></a>0x01 基础环境</h4><p>常用工具集:</p>\n<ul>\n<li>运行环境: JDK/SDK/NDK<ul>\n<li>JDK:Java开发与运行环境。<a href=\"https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html\" target=\"_blank\" rel=\"noopener\">下载地址</a></li>\n<li>NDK:使您能在 Android 应用中使用 C 和 C++ 代码。 <a href=\"https://developer.android.google.cn/ndk/downloads/\" target=\"_blank\" rel=\"noopener\">下载地址</a></li>\n</ul>\n</li>\n<li>IDE:Eclipse(推荐) / AndroidStudio</li>\n<li>逆向工具:AndroidKill / Jeb / Jadx / GDA /Android逆向助手 / IDA / GDB (后面单独介绍各逆向工具的使用)</li>\n<li>签名:Apkhelper / getsign / APK 上上签</li>\n<li>安卓模拟器：雷电(快速) / 海马玩(稳定)</li>\n<li>常用软件: adb.exe  / RE文件管理器 / MT 管理器</li>\n</ul>\n<p>基础软件安装:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 静默安装</span></span><br><span class=\"line\">jdk-8u251-windows-x64.exe /s</span><br><span class=\"line\"><span class=\"comment\"># setx JAVA_HOME \"C:\\Program Files\\Java\\jdk1.6.0_31\" /M</span></span><br><span class=\"line\"><span class=\"comment\"># setx JRE_HOME \"C:\\Program Files\\Java\\jre6\" /M</span></span><br><span class=\"line\"><span class=\"comment\"># setx CLASSPSTH \".;%JAVA_HOME%\\lib\\dt.jar;%JAVA_HOME%\\lib\\tools.jar;\" /M</span></span><br><span class=\"line\"><span class=\"comment\"># setx PATH \"%JAVA_HOME%\\bin\\;%PATH%\" /M</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># setx JAVA_HOME \"D:\\jdk1.7.0_67\" /M</span></span><br><span class=\"line\"><span class=\"comment\"># setx JRE_HOME \"D:\\jdk1.7.0_67\\jre\" /M</span></span><br><span class=\"line\"><span class=\"comment\"># setx CLASSPSTH \".;%JAVA_HOME%\\lib\\dt.jar;%JAVA_HOME%\\lib\\tools.jar;\" /M</span></span><br><span class=\"line\"><span class=\"comment\"># setx PATH \"%JAVA_HOME%\\bin\\;%PATH%\" /M</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 环境变量</span></span><br><span class=\"line\">setx JAVA_HOME <span class=\"string\">\"C:\\Program Files\\Java\\jdk1.8.0_251\"</span> /M</span><br><span class=\"line\">setx NDK_HOME <span class=\"string\">\"C:\\Android-Resever\\android-ndk-r21\"</span> /M</span><br><span class=\"line\">setx CLASSPSTH <span class=\"string\">\".;%JAVA_HOME%\\lib\\dt.jar;%JAVA_HOME%\\lib\\tools.jar;\"</span> /M</span><br><span class=\"line\">setx PATH <span class=\"string\">\"%PATH%;%JAVA_HOME%\\bin\\;%NDK_HOME%\"</span> /M</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装软件版本</span></span><br><span class=\"line\">C:\\Users\\Weiyi&gt;java -version</span><br><span class=\"line\">java version <span class=\"string\">\"1.8.0_251\"</span></span><br><span class=\"line\">Java(TM) SE Runtime Environment (build 1.8.0_251-b08)</span><br><span class=\"line\">Java HotSpot(TM) 64-Bit Server VM (build 25.251-b08, mixed mode)</span><br><span class=\"line\"></span><br><span class=\"line\">C:\\Users\\Weiyi&gt;ndk-build</span><br><span class=\"line\">Android NDK: Could not find application project directory !</span><br><span class=\"line\">Android NDK: Please define the NDK_PROJECT_PATH variable to point to it.</span><br><span class=\"line\">C:\\Android-Resever\\android-ndk-r21\\build\\\\..\\build\\core\\build-local.mk:151: ***</span><br><span class=\"line\">Android NDK: Aborting    .  Stop.</span><br></pre></td></tr></table></figure></p>\n<p>注意事项:</p>\n<ul>\n<li>1.JDK与NDK的配置路径中不能有中文和空格；</li>\n<li>2.安装包文件不全则运行会出错;</li>\n<li>3.安装完成后需要校验设置的环境变量;</li>\n<li>4.如果在运行ndk-build提示<code>api-ms-win-crt-convert-l1-1-0.dll</code>找不到时候将本机的32位与64位分别放置于system32、SysWOW64目录之中然后注册该DLL;<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"built_in\">echo</span> 开始注册</span><br><span class=\"line\">copy api-ms-win-crt-convert-l1-1-0.dll %windir%\\sysWOW64</span><br><span class=\"line\">regsvr32 %windir%\\sysWOW64\\api-ms-win-crt-convert-l1-1-0.dll /s</span><br><span class=\"line\">@pause</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<h4 id=\"0x02-APK文件与目录介绍\"><a href=\"#0x02-APK文件与目录介绍\" class=\"headerlink\" title=\"0x02 APK文件与目录介绍\"></a>0x02 APK文件与目录介绍</h4><h5 id=\"APK-文件\"><a href=\"#APK-文件\" class=\"headerlink\" title=\"APK 文件\"></a>APK 文件</h5><p>描述:APK全称为Android Package的缩写即Android安装包,APK是类似于Symbian sis 或者 Sisx 的文件格式。通过将APK文件直接转入到Android手机或者Android模拟器中即可安装执行;</p>\n<p><br></p>\n<h5 id=\"APK-文件目录\"><a href=\"#APK-文件目录\" class=\"headerlink\" title=\"APK 文件目录\"></a>APK 文件目录</h5><p>描述:将APK文件通过解压缩包进行解压，然后可以看见应用程序的一些代码和资源;<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">❯ tree -L 1 -r</span><br><span class=\"line\">├── third_party</span><br><span class=\"line\">├── resources.arsc</span><br><span class=\"line\">├── res <span class=\"comment\"># 通用 - 编译过的文件(二进制)以及应用静态资源(图片/xml/)即UI界面的一些东西;</span></span><br><span class=\"line\">    ├── drawable <span class=\"comment\">#图片</span></span><br><span class=\"line\">    ├── layout   <span class=\"comment\">#布局</span></span><br><span class=\"line\">    └── menu     <span class=\"comment\">#菜单</span></span><br><span class=\"line\">├── org</span><br><span class=\"line\">├── okhttp3</span><br><span class=\"line\">├── lib  <span class=\"comment\"># 通用 - 静态链接文件so </span></span><br><span class=\"line\">├── jsr305_annotations</span><br><span class=\"line\">├── javax</span><br><span class=\"line\">├── freemarker</span><br><span class=\"line\">├── error_prone</span><br><span class=\"line\">├── entity.ftl</span><br><span class=\"line\">├── dao.ftl</span><br><span class=\"line\">├── dao-unit-test.ftl</span><br><span class=\"line\">├── dao-session.ftl</span><br><span class=\"line\">├── dao-master.ftl</span><br><span class=\"line\">├── dao-deep.ftl</span><br><span class=\"line\">├── content-provider.ftl</span><br><span class=\"line\">├── classes.dex  <span class=\"comment\">#通用 - java编译后的可执行文件(android中)</span></span><br><span class=\"line\">├── build-data.properties</span><br><span class=\"line\">├── resources.arsc <span class=\"comment\"># 经过AAPT编译过的资源文件，字符串文件以及显示样式文件夹</span></span><br><span class=\"line\">├── assets  <span class=\"comment\">#通用 - 不经过AAPT编译的资源文件</span></span><br><span class=\"line\">├── androidsupportmultidexversion.txt</span><br><span class=\"line\">├── META-INF <span class=\"comment\">#通用 - 文件摘要(摘要加密和签名证书文件目录)</span></span><br><span class=\"line\">    ├── GOFUN.RSA  <span class=\"comment\">#公钥加密算法描述</span></span><br><span class=\"line\">    ├── GOFUN.SF   <span class=\"comment\">#加密文件它是使用私钥对摘要名称加密后得道的密文信息,只有使用私钥配对的公钥才能进行解密该文件;</span></span><br><span class=\"line\">    └── MANIFEST.MF  <span class=\"comment\">#程序清单文件，它包括所有文件的摘要信息</span></span><br><span class=\"line\">└── AndroidManifest.xml <span class=\"comment\"># 通用 - 配置清单文件(安卓的配置清单)</span></span><br></pre></td></tr></table></figure></p>\n<p>文件:MANIFEST.MF<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Manifest-Version: 1.0</span><br><span class=\"line\"></span><br><span class=\"line\">Name: AndroidManifest.xml</span><br><span class=\"line\">SHA-256-Digest: sCLLLPEivWLfeMHwNEz7Bt3yeBWMiT+EjPcIL9QdvxI=</span><br></pre></td></tr></table></figure></p>\n<p>文件:gofun.sf (采用公钥对MANIFEST.MF文件中的资源进行再次摘要加密)<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Signature-Version: 1.0</span><br><span class=\"line\">Created-By: 1.0 (Android)</span><br><span class=\"line\">SHA-256-Digest-Manifest: WPorAy8iCJO3Rl5xbczVMiBhZOXOQXjVwylG1xL2ulA=</span><br><span class=\"line\">X-Android-APK-Signed: 2</span><br><span class=\"line\"></span><br><span class=\"line\">Name: AndroidManifest.xml</span><br><span class=\"line\">SHA-256-Digest: GFXtodin/suAdOtSKFP/1RSvvOFy/Hx6dxlcJyZYRYc=</span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Android","path":"api/categories/Android.json"}],"tags":[{"name":"Software-Reverse","path":"api/tags/Software-Reverse.json"}]}