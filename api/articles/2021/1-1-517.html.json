{"title":"Xrdp服务安装配置实现Linux远程桌面访问","slug":"系统运维/Linux/运维实践/图形界面/Xrdp服务安装配置实现Linux远程桌面访问","date":"2021-01-01T10:34:30.000Z","updated":"2022-03-29T05:39:06.305Z","url":"2021/1-1-517.html","path":"api/articles/2021/1-1-517.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210106145524.png","https://img-blog.csdnimg.cn/20190927204711497.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"0x00-基础介绍\"><a href=\"#0x00-基础介绍\" class=\"headerlink\" title=\"0x00 基础介绍\"></a>0x00 基础介绍</h2><p>Q: 什么是 Xrdp ? 它有何作用 ?</p>\n<blockquote>\n<p>描述: Xrdp 是一个微软远程桌面协议（RDP）的开源实现，它允许你通过图形界面控制远程系统。通过 RDP 你可以登录远程机器，并且创建一个真实的桌面会话就像你登录本地机器一样。</p>\n</blockquote>\n<p>Q: 其它的可视化界面远程访问方式有那些?</p>\n<blockquote>\n<p>描述: 最常见的是通过<code>xrdp和vnc</code>这两种远程桌面协议来进行可视化远程操作。</p>\n</blockquote>\n<p><strong>xrdp和vnc之间区别介绍：</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">远程协议      xrdp \t      vnc</span><br><span class=\"line\">BIOS屏幕显示 \t能 \t          不能</span><br><span class=\"line\">全彩支持 \t    能 \t          能</span><br><span class=\"line\">更改分辨率 \t  能 \t          能</span><br><span class=\"line\">多显示器 \t    只有一个屏幕 \t多显示器支持</span><br><span class=\"line\">图像传输 \t    图像传输 \t    图像和图形传输</span><br><span class=\"line\">视频播放支持 \t不能 \t        GPU加速支持</span><br><span class=\"line\">音频传输 \t    不能 \t        双向语音可以控制</span><br><span class=\"line\">鼠标控制 \t    服务器端控制  服务器端控制</span><br><span class=\"line\">USB传输  \t    不能 \t       USB可以通过网络传输</span><br><span class=\"line\">多桌面支持     支持多人连接  只支持一个桌面</span><br><span class=\"line\">原生的Unit桌面 支持          支持</span><br><span class=\"line\">``` </span><br><span class=\"line\"></span><br><span class=\"line\">**XRDP 和 VNC 适用场景:**</span><br><span class=\"line\">- XRDP</span><br><span class=\"line\">&gt; 适用系统：windows、linux</span><br><span class=\"line\">&gt; 网络流量：较小/正常使用100-200k左右</span><br><span class=\"line\">&gt; 适用场景：由于在色彩、音频、usb及本地磁盘映射方面较好`非常适用于虚拟桌面`;</span><br><span class=\"line\"></span><br><span class=\"line\">- VNC</span><br><span class=\"line\">&gt; 适用系统：windows、linux</span><br><span class=\"line\">&gt; 网络流量：较小，常用100k左右</span><br><span class=\"line\">&gt; 适用场景：主要用于linux的服务器的管理，由于无声音和usb传输，不满足于虚拟桌面的使用</span><br><span class=\"line\"></span><br><span class=\"line\">Tips : 用Xrdp是因为比VNC好很多，磁盘共享这种附带功能不说，关键是RDP的算法，用起来要比VNC这RFB快VNC采用的RFB算法，下面放一下他们俩的主要区别:</span><br><span class=\"line\">* RFB是在服务器端将窗口在显存中画好之后将图像传给客户端，客户端只充当一个图像解码显示的角色；</span><br><span class=\"line\">* RDP则将画图的工作交给了客户端，服务器需要了解客户端显示能力的具体情况，以便作出相应调整。 RFB主要传图像，RDP主要传指令。就一般应用而言，RFB数据量太大，RDP对客户端要求较高，因此RFB适用于瘦客户端，RDP适用于低速网络。</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 0x01 安装桌面环境</span></span><br><span class=\"line\">描述: CentOS(精简版) / Ubuntu 服务器通常使用命令行进行管理，并且默认没有安装桌面环境, 如果你正在运行 Ubuntu / CentOS 桌面版，忽略这一步。</span><br><span class=\"line\">目的: 配置一个远程桌面，允许你从你的本地机器通过一个简单易用的图形界面来管理你的 Ubuntu 20.04 服务器。</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### Ubuntu 系列</span></span><br><span class=\"line\">在 Ubuntu 源仓库有很多桌面环境供你选择;</span><br><span class=\"line\">- (1) Gnome : 它是 Ubuntu 20.04 的默认桌面环境, 界面炫酷但是比较耗费资源，通常是在桌面版本中使用。</span><br><span class=\"line\">- (2) xfce : 它是快速，稳定，并且轻量的桌面环境，使得它成为远程服务器的理想桌面。</span><br><span class=\"line\"></span><br><span class=\"line\">PS : Xrdp 使用默认的 X Window 桌面环境（`Gnome or XFCE`）。</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 0x02 Xrdp 安装使用</span></span><br><span class=\"line\"><span class=\"comment\">### How to Install xrdp on Ubuntu ?</span></span><br><span class=\"line\">**Ubuntu 20.04 Gnome 桌面**</span><br><span class=\"line\">```bash</span><br><span class=\"line\"><span class=\"comment\"># (1) 更新源</span></span><br><span class=\"line\">nano /etc/apt/sources.list</span><br><span class=\"line\">apt-get update &amp;&amp; apt-get upgrade</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2) 安装Ubuntu Gnome桌面与XRDP</span></span><br><span class=\"line\">apt-get install -y ubuntu-desktop &amp;&amp; apt-get install -y xrdp</span><br><span class=\"line\"><span class=\"comment\"># sudo apt install xubuntu-desktop   # 安装 Xfce </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (3) 查看xrdp服务</span></span><br><span class=\"line\">sudo systemctl status xrdp </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (4) 默认情况下 Xrdp 使用/etc/ssl/private/ssl-cert-snakeoil.key,它仅仅对“ssl-cert” 用户组成语可读。</span></span><br><span class=\"line\"><span class=\"comment\"># 运行下面的命令将 xrdp 用户添加到这个用户组：（缺省未采用ssl）</span></span><br><span class=\"line\"><span class=\"comment\"># sudo adduser xrdp ssl-cert </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (5) 重启 Xrdp 服务使得修改生效：</span></span><br><span class=\"line\">sudo systemctl restart xrdp</span><br></pre></td></tr></table></figure></p>\n<p>Tips: 安装完成后即可使用Windows远程桌面工具登录Ubuntu, 非常注意并不需要在家目录中创建<code>.xsession</code>的文件并输入<code>xfce4-session</code>等命令信息(坑);</p>\n<p><br></p>\n<p><strong>Ubuntu 20.04 xfce4 桌面</strong><br>描述: 安装与使用方式与上面相差不大。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get update</span><br><span class=\"line\">apt install xfce4 xfce4-goodies tightvncserver xrdp</span><br><span class=\"line\"><span class=\"comment\"># - 以及在 vi /etc/X11/Xsession首行添加xfce4-session</span></span><br><span class=\"line\"><span class=\"comment\"># 创建~/.xsession 和 ~/.xsessionrc</span></span><br><span class=\"line\">$ <span class=\"built_in\">echo</span> <span class=\"string\">\"xfce4-session\"</span> &gt; ~/.xsession</span><br><span class=\"line\">$ D=/usr/share/xfce4:/usr/share/xubuntu:/usr/<span class=\"built_in\">local</span>/share</span><br><span class=\"line\">$ D=<span class=\"variable\">$&#123;D&#125;</span>:/usr/share:/var/lib/snapd/desktop:/usr/share</span><br><span class=\"line\">$ cat &lt;&lt;EOF &gt; ~/.xsessionrc</span><br><span class=\"line\"><span class=\"built_in\">export</span> XDG_SESSION_DESKTOP=xubuntu</span><br><span class=\"line\"><span class=\"built_in\">export</span> XDG_DATA_DIRS=<span class=\"variable\">$&#123;D&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> XDG_CONFIG_DIRS=/etc/xdg/xdg-xubuntu:/etc/xdg:/etc/xdg</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 支持断开连接后同用户恢复链接</span></span><br><span class=\"line\">vi /etc/xrdp/xrdp.ini</span><br><span class=\"line\">[Reconnect]</span><br><span class=\"line\">name=Reconnect</span><br><span class=\"line\">lib=libvnc.so</span><br><span class=\"line\">username=ask</span><br><span class=\"line\">password=ask</span><br><span class=\"line\">ip=127.0.0.1</span><br><span class=\"line\">port=5910</span><br><span class=\"line\"></span><br><span class=\"line\">[Xvnc]</span><br><span class=\"line\">name=Xvnc</span><br><span class=\"line\">lib=libvnc.so</span><br><span class=\"line\">username=ask</span><br><span class=\"line\">password=ask</span><br><span class=\"line\">ip=127.0.0.1</span><br><span class=\"line\">port=-1  <span class=\"comment\"># 代表自动分配端口，为其他数字则指定（第一次连接时不可指定） </span></span><br><span class=\"line\"><span class=\"comment\">#xserverbpp=24</span></span><br><span class=\"line\"><span class=\"comment\">#delay_ms=2000</span></span><br><span class=\"line\"></span><br><span class=\"line\">[Xorg]</span><br><span class=\"line\">name=Xorg</span><br><span class=\"line\">lib=libxup.so</span><br><span class=\"line\">username=ask</span><br><span class=\"line\">password=ask</span><br><span class=\"line\">ip=127.0.0.1</span><br><span class=\"line\">port=-1</span><br><span class=\"line\">code=20</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 编辑完保存，执行service xrdp restart 或systemctl restart xrdp重启xrdp</span></span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h3 id=\"How-to-Install-xrdp-to-CentOS\"><a href=\"#How-to-Install-xrdp-to-CentOS\" class=\"headerlink\" title=\"How to Install xrdp to CentOS?\"></a>How to Install xrdp to CentOS?</h3><p>在 CentOS/Redhat 系列操作系统上的安装方法</p>\n<ul>\n<li><p>Step 1.扩展源以及采用yum方式安装xrdp;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y epel-release &amp;&amp; yum install -y xrdp</span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> xrdp &amp;&amp; systemctl start xrdp</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Step 2.查看启动状态</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl status xrdp</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<h3 id=\"How-to-use-Xrdp\"><a href=\"#How-to-use-Xrdp\" class=\"headerlink\" title=\"How to use Xrdp ?\"></a>How to use Xrdp ?</h3><p>描述：现在你已经设置好你的 Xrdp 服务器，是时候打开你的 Xrdp 客户端并且连接到服务器。</p>\n<p>Step 1.如果你有一台 Windows 电脑，你可以使用默认的 RDP 客户端，执行mstsc命令调出远程桌面连接,并且在“Computer”区域输入远程服务器 IP地址，并且点击“Connect”。;</p>\n<p>Step 2.在登录屏幕，输入你的用户名和密码，点击“OK”。</p>\n<p>Step 3.一旦登录你将看到默认的 Gnome 或者 Xfce 桌面，它应该像下面这样，现在你可以从你的本地机器上使用你的键盘和鼠标和远程桌面进行交互了</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210106145524.png\" alt=\"WeiyiGeek.xrdp远程桌面\" title=\"\" class=\"\">\n                <p>WeiyiGeek.xrdp远程桌面</p>\n            </figure>\n<hr>\n<h2 id=\"0x03-XRDP-基础配置\"><a href=\"#0x03-XRDP-基础配置\" class=\"headerlink\" title=\"0x03 XRDP 基础配置\"></a>0x03 XRDP 基础配置</h2><h3 id=\"配置文件目录结构\"><a href=\"#配置文件目录结构\" class=\"headerlink\" title=\"配置文件目录结构\"></a>配置文件目录结构</h3><p>描述: Xrdp 配置文件定位在 <code>/etc/xrdp</code> 目录,对于基本的 Xrdp 链接你不需要对配置文件做任何改动，注意如果您修改配置文件后必须要重启Xrdp服务。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">~$ ls /etc/xrdp/</span><br><span class=\"line\">cert.pem         km-00000409.ini  km-00000410.ini  km-00000415.ini  km-00000807.ini  km-00000813.ini  pulse           startwm.sh</span><br><span class=\"line\">key.pem          km-0000040a.ini  km-00000411.ini  km-00000416.ini  km-00000809.ini  km-00000816.ini  reconnectwm.sh  xrdp.ini</span><br><span class=\"line\">km-00000406.ini  km-0000040b.ini  km-00000412.ini  km-00000419.ini  km-0000080a.ini  km-0000100c.ini  rsakeys.ini     xrdp_keyboard.ini</span><br><span class=\"line\">km-00000407.ini  km-0000040c.ini  km-00000414.ini  km-0000041d.ini  km-0000080c.ini  km-00010409.ini  sesman.ini</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li><p>/etc/xrdp/xrdp.ini :  主配置文件，该文件被分成不同的段，允许你设置全局配置，例如安全，监听地址，创建不同的 xrdp 登录会话等。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Xrdp 监听端口</span></span><br><span class=\"line\">; Examples:</span><br><span class=\"line\">;   port=3389</span><br><span class=\"line\">;   port=unix://./tmp/xrdp.socket</span><br><span class=\"line\">;   port=tcp://.:3389                           127.0.0.1:3389</span><br><span class=\"line\">;   port=tcp://:3389                            *:3389</span><br><span class=\"line\">;   port=tcp://&lt;any ipv4 format addr&gt;:3389      192.168.1.1:3389</span><br><span class=\"line\">;   port=tcp6://.:3389                          ::1:3389</span><br><span class=\"line\">;   port=tcp6://:3389                           *:3389</span><br><span class=\"line\">;   port=tcp6://&#123;&lt;any ipv6 format addr&gt;&#125;:3389   &#123;FC00:0:0:0:0:0:0:1&#125;:3389</span><br><span class=\"line\">;   port=vsock://&lt;cid&gt;:&lt;port&gt;</span><br><span class=\"line\">port=3389 </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 证书设置与SSL 协议 </span></span><br><span class=\"line\">; X.509 certificate and private key</span><br><span class=\"line\">; openssl req -x509 -newkey rsa:2048 -nodes -keyout key.pem -out cert.pem -days 365</span><br><span class=\"line\">; note this needs the user xrdp to be a member of the ssl-cert group, <span class=\"keyword\">do</span> with e.g.</span><br><span class=\"line\">;$ sudo adduser xrdp ssl-cert</span><br><span class=\"line\">certificate=</span><br><span class=\"line\">key_file=</span><br><span class=\"line\">ssl_protocols=TLSv1.2, TLSv1.3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 会话类型(如Xorg、X11rdp和Xvnc)会启动显示服务器。</span></span><br><span class=\"line\"><span class=\"comment\"># ;配置显示服务器的启动命令行参数(可连接到其他服务器之上)</span></span><br><span class=\"line\">[Xorg]</span><br><span class=\"line\">name=Xorg</span><br><span class=\"line\">lib=libxup.so</span><br><span class=\"line\">username=ask</span><br><span class=\"line\">password=ask</span><br><span class=\"line\">ip=127.0.0.1</span><br><span class=\"line\">port=-1</span><br><span class=\"line\">code=20</span><br><span class=\"line\"></span><br><span class=\"line\">[Xvnc]</span><br><span class=\"line\">name=Xvnc</span><br><span class=\"line\">lib=libvnc.so</span><br><span class=\"line\">username=ask</span><br><span class=\"line\">password=ask</span><br><span class=\"line\">ip=127.0.0.1</span><br><span class=\"line\">port=-1</span><br><span class=\"line\"><span class=\"comment\">#xserverbpp=24</span></span><br><span class=\"line\"><span class=\"comment\">#delay_ms=2000</span></span><br><span class=\"line\"></span><br><span class=\"line\">[vnc-any]</span><br><span class=\"line\">name=vnc-any</span><br><span class=\"line\">lib=libvnc.so</span><br><span class=\"line\">ip=ask</span><br><span class=\"line\">port=ask5900</span><br><span class=\"line\">username=ask</span><br><span class=\"line\">password=ask</span><br><span class=\"line\"><span class=\"comment\">#pamusername=asksame</span></span><br><span class=\"line\"><span class=\"comment\">#pampassword=asksame</span></span><br><span class=\"line\"><span class=\"comment\">#pamsessionmng=127.0.0.1</span></span><br><span class=\"line\"><span class=\"comment\">#delay_ms=2000</span></span><br><span class=\"line\"></span><br><span class=\"line\">[neutrinordp-any]</span><br><span class=\"line\">name=neutrinordp-any</span><br><span class=\"line\">lib=libxrdpneutrinordp.so</span><br><span class=\"line\">ip=ask</span><br><span class=\"line\">port=ask39393</span><br><span class=\"line\">username=ask</span><br><span class=\"line\">password=ask</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>/etc/xrdp/startwm.sh : Xrdp 使用startwm.sh文件启动 X 会话, 如果你想使用另外一个 X Window 桌面，编辑这个文件。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"><span class=\"comment\"># xrdp X session start script (c) 2015, 2017 mirabilos</span></span><br><span class=\"line\"><span class=\"comment\"># published under The MirOS Licence</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"built_in\">test</span> -r /etc/profile; <span class=\"keyword\">then</span></span><br><span class=\"line\">        . /etc/profile</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"built_in\">test</span> -r /etc/default/locale; <span class=\"keyword\">then</span></span><br><span class=\"line\">  . /etc/default/locale</span><br><span class=\"line\">  <span class=\"built_in\">test</span> -z <span class=\"string\">\"<span class=\"variable\">$&#123;LANG+x&#125;</span>\"</span> || <span class=\"built_in\">export</span> LANG</span><br><span class=\"line\">  <span class=\"built_in\">test</span> -z <span class=\"string\">\"<span class=\"variable\">$&#123;LANGUAGE+x&#125;</span>\"</span> || <span class=\"built_in\">export</span> LANGUAGE</span><br><span class=\"line\">  <span class=\"built_in\">test</span> -z <span class=\"string\">\"<span class=\"variable\">$&#123;LC_ADDRESS+x&#125;</span>\"</span> || <span class=\"built_in\">export</span> LC_ADDRESS</span><br><span class=\"line\">  <span class=\"built_in\">test</span> -z <span class=\"string\">\"<span class=\"variable\">$&#123;LC_ALL+x&#125;</span>\"</span> || <span class=\"built_in\">export</span> LC_ALL</span><br><span class=\"line\">  <span class=\"built_in\">test</span> -z <span class=\"string\">\"<span class=\"variable\">$&#123;LC_COLLATE+x&#125;</span>\"</span> || <span class=\"built_in\">export</span> LC_COLLATE</span><br><span class=\"line\">  <span class=\"built_in\">test</span> -z <span class=\"string\">\"<span class=\"variable\">$&#123;LC_CTYPE+x&#125;</span>\"</span> || <span class=\"built_in\">export</span> LC_CTYPE</span><br><span class=\"line\">  <span class=\"built_in\">test</span> -z <span class=\"string\">\"<span class=\"variable\">$&#123;LC_IDENTIFICATION+x&#125;</span>\"</span> || <span class=\"built_in\">export</span> LC_IDENTIFICATION</span><br><span class=\"line\">  <span class=\"built_in\">test</span> -z <span class=\"string\">\"<span class=\"variable\">$&#123;LC_MEASUREMENT+x&#125;</span>\"</span> || <span class=\"built_in\">export</span> LC_MEASUREMENT</span><br><span class=\"line\">  <span class=\"built_in\">test</span> -z <span class=\"string\">\"<span class=\"variable\">$&#123;LC_MESSAGES+x&#125;</span>\"</span> || <span class=\"built_in\">export</span> LC_MESSAGES</span><br><span class=\"line\">  <span class=\"built_in\">test</span> -z <span class=\"string\">\"<span class=\"variable\">$&#123;LC_MONETARY+x&#125;</span>\"</span> || <span class=\"built_in\">export</span> LC_MONETARY</span><br><span class=\"line\">  <span class=\"built_in\">test</span> -z <span class=\"string\">\"<span class=\"variable\">$&#123;LC_NAME+x&#125;</span>\"</span> || <span class=\"built_in\">export</span> LC_NAME</span><br><span class=\"line\">  <span class=\"built_in\">test</span> -z <span class=\"string\">\"<span class=\"variable\">$&#123;LC_NUMERIC+x&#125;</span>\"</span> || <span class=\"built_in\">export</span> LC_NUMERIC</span><br><span class=\"line\">  <span class=\"built_in\">test</span> -z <span class=\"string\">\"<span class=\"variable\">$&#123;LC_PAPER+x&#125;</span>\"</span> || <span class=\"built_in\">export</span> LC_PAPER</span><br><span class=\"line\">  <span class=\"built_in\">test</span> -z <span class=\"string\">\"<span class=\"variable\">$&#123;LC_TELEPHONE+x&#125;</span>\"</span> || <span class=\"built_in\">export</span> LC_TELEPHONE</span><br><span class=\"line\">  <span class=\"built_in\">test</span> -z <span class=\"string\">\"<span class=\"variable\">$&#123;LC_TIME+x&#125;</span>\"</span> || <span class=\"built_in\">export</span> LC_TIMEs</span><br><span class=\"line\">  <span class=\"built_in\">test</span> -z <span class=\"string\">\"<span class=\"variable\">$&#123;LOCPATH+x&#125;</span>\"</span> || <span class=\"built_in\">export</span> LOCPATH</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"built_in\">test</span> -r /etc/profile; <span class=\"keyword\">then</span></span><br><span class=\"line\">  . /etc/profile</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 防止黑屏命令(最新版本不用添加)</span></span><br><span class=\"line\"><span class=\"built_in\">unset</span> DBUS_SESSION_BUS_ADDRESS</span><br><span class=\"line\"><span class=\"built_in\">unset</span> XDG_RUNTIME_DIR</span><br><span class=\"line\"><span class=\"comment\"># - 切换到xfsce4桌面</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> xfce4-session &gt; ~/.xsession</span><br><span class=\"line\">xfce4-session</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">test</span> -x /etc/X11/Xsession &amp;&amp; <span class=\"built_in\">exec</span> /etc/X11/Xsession</span><br><span class=\"line\"><span class=\"built_in\">exec</span> /bin/sh /etc/X11/Xsession</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<h3 id=\"配置防火墙\"><a href=\"#配置防火墙\" class=\"headerlink\" title=\"配置防火墙\"></a>配置防火墙</h3><p>描述: Xrdp 守护程序在所有的网络接口上监听端口3389。如果你在你的 Ubuntu 服务器上运行一个防火墙，你需要打开 Xrdp 端口。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 如果你想允许从任何地方访问（由于安全原因，这种方式不鼓励），运行：</span></span><br><span class=\"line\">sudo ufw allow 3389</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 想要允许从某一个指定的 IP 地址或者 IP 范围访问 Xrdp 服务器,例如192.168.33.0/24,你需要运行下面的命令：</span></span><br><span class=\"line\">sudo ufw allow from 192.168.33.0/24 to any port 3389</span><br></pre></td></tr></table></figure>\n<p>TIPS: 如果想要增加安全你可以考虑 Xrdp 仅仅监听 localhost，并且创建一个 SSH 隧道，将本地机器的3389端口到远程服务器的同样端口之间的流量加密。</p>\n<hr>\n<h2 id=\"0x04-入坑-amp-出坑\"><a href=\"#0x04-入坑-amp-出坑\" class=\"headerlink\" title=\"0x04 入坑&amp;出坑\"></a>0x04 入坑&amp;出坑</h2><h3 id=\"问题1-Sesmal-connect-ok-sending-login-info-to-session-mananger-please-wait…-Login-failed-for-display-0\"><a href=\"#问题1-Sesmal-connect-ok-sending-login-info-to-session-mananger-please-wait…-Login-failed-for-display-0\" class=\"headerlink\" title=\"问题1.Sesmal connect ok , sending login info to session mananger, please wait… Login failed for display 0\"></a>问题1.Sesmal connect ok , sending login info to session mananger, please wait… Login failed for display 0</h3><p>错误信息: Windows 连接 CentOS XRDP 错误信息 login failed for display 0</p>\n<p>错误原因: 输入的操作系统密码有误，注意此处输入密码不是<code>cat /etc/xrdp/xrdp.ini</code>中的<code>username、password</code>而是操作系统中的;</p>\n<figure class=\"image-box\">\n                <img src=\"https://img-blog.csdnimg.cn/20190927204711497.png\" alt=\"CSDN.login failed for display 0\" title=\"\" class=\"\">\n                <p>CSDN.login failed for display 0</p>\n            </figure>\n<p>其他解决办法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 方式1.将 allowed_users=console 改为 anybody</span></span><br><span class=\"line\">sudo vi /etc/X11/Xwrapper.config</span><br><span class=\"line\">allowed_users=anybody</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"问题2-Windows-连接-Xdrp-Ubuntu-20-04-server-出现闪退-报错信息-xsession-line-1-xfce4-session-command-not-found\"><a href=\"#问题2-Windows-连接-Xdrp-Ubuntu-20-04-server-出现闪退-报错信息-xsession-line-1-xfce4-session-command-not-found\" class=\"headerlink\" title=\"问题2.Windows 连接 Xdrp(Ubuntu 20.04 server) 出现闪退,报错信息 xsession: line 1: xfce4-session: command not found\"></a>问题2.Windows 连接 Xdrp(Ubuntu 20.04 server) 出现闪退,报错信息 xsession: line 1: xfce4-session: command not found</h3><p>错误信息:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">~$ ls </span><br><span class=\"line\">-rw------- 1  106 Jan  5 05:56 .Xauthority</span><br><span class=\"line\">-rw-r--r-- 1  16K Jan  5 05:56 .xorgxrdp.11.log</span><br><span class=\"line\">-rw-r--r-- 1  17K Jan  5 05:53 .xorgxrdp.11.log.old</span><br><span class=\"line\">-rw-rw-r-- 1   12 Jan  5 05:55 .xsession</span><br><span class=\"line\">-rw------- 1 4.3K Jan  5 05:56 .xsession-errors</span><br><span class=\"line\"></span><br><span class=\"line\">~$ cat .xsession-errors</span><br><span class=\"line\"><span class=\"comment\"># Xsession: X session started for weiyigeek at Tue 05 Jan 2021 05:53:45 AM UTC</span></span><br><span class=\"line\"><span class=\"comment\"># dbus-update-activation-environment: setting DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus</span></span><br><span class=\"line\"><span class=\"comment\"># dbus-update-activation-environment: setting DISPLAY=:11.0</span></span><br><span class=\"line\">localuser:weiyigeek being added to access control list  <span class=\"comment\"># 登录的用户</span></span><br><span class=\"line\"><span class=\"comment\"># dbus-update-activation-environment: setting GTK_MODULES=gail:atk-bridge</span></span><br><span class=\"line\"><span class=\"comment\"># dbus-update-activation-environment: setting QT_ACCESSIBILITY=1</span></span><br><span class=\"line\"><span class=\"comment\"># ...</span></span><br><span class=\"line\">/home/weiyigeek/.xsession: line 1: xfce4-session: <span class=\"built_in\">command</span> not found</span><br><span class=\"line\"><span class=\"comment\"># Xsession: X session started for weiyigeek at Tue 05 Jan 2021 05:56:14 AM UTC</span></span><br><span class=\"line\"><span class=\"comment\"># dbus-update-activation-environment: setting DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus</span></span><br><span class=\"line\"><span class=\"comment\"># dbus-update-activation-environment: setting DISPLAY=:11.0</span></span><br><span class=\"line\">localuser:weiyigeek being added to access control list <span class=\"comment\"># 登录的用户</span></span><br><span class=\"line\"><span class=\"comment\"># dbus-update-activation-environment: setting GTK_MODULES=gail:atk-bridge</span></span><br><span class=\"line\"><span class=\"comment\"># .....</span></span><br><span class=\"line\"><span class=\"comment\"># dbus-update-activation-environment: setting XDG_DATA_DIRS=/usr/local/share:/usr/share:/var/lib/snapd/desktop</span></span><br><span class=\"line\">/home/weiyigeek/.xsession: line 1: x11-session: <span class=\"built_in\">command</span> not found</span><br></pre></td></tr></table></figure><br>错误原因: Ubuntu 20.04 Server 中默认采用 Gnome 桌面如果配置了没有安装的第三方桌面软件到.xsession将会出现改问题<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Unity 桌面(老版本)</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> unity&gt; ~/.xsession</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ubuntu-desktop 原始桌面</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> gnome-session &gt; ~/.xsession</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># xubuntu-desktop xfce4桌面</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> xfce4-session &gt; ~/.xsession</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"问题3-dconf-CRITICAL-unable-to-create-file-‘-run-user-1000-dconf-user’-Permission-denied-dconf-will-not-work-properly\"><a href=\"#问题3-dconf-CRITICAL-unable-to-create-file-‘-run-user-1000-dconf-user’-Permission-denied-dconf-will-not-work-properly\" class=\"headerlink\" title=\"问题3.dconf-CRITICAL **: unable to create file ‘/run/user/1000/dconf/user’: Permission denied.  dconf will not work properly.\"></a>问题3.dconf-CRITICAL **: unable to create file ‘/run/user/1000/dconf/user’: Permission denied.  dconf will not work properly.</h3><p>问题信息:<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat .xsession-errors </span><br><span class=\"line\">Xsession: X session started for  at Sun May 21 22:03:26 CST 2017</span><br><span class=\"line\">X Error of failed request:  BadValue (integer parameter out of range for operation)</span><br><span class=\"line\">  Major opcode of failed request:  109 (X_ChangeHosts)</span><br><span class=\"line\">  Value in failed request:  0x5</span><br><span class=\"line\">  Serial number of failed request:  6</span><br><span class=\"line\">  Current serial number in output stream:  8</span><br><span class=\"line\">localuser:fred being added to access control list</span><br><span class=\"line\">(xfce4-session:41354): dconf-CRITICAL **: unable to create file &#39;&#x2F;run&#x2F;user&#x2F;1000&#x2F;dconf&#x2F;user&#39;: Permission denied.  dconf will not work properly.</span><br></pre></td></tr></table></figure><br>问题描述: 新装的 ubuntu 的 利用 xrdp 登录 xfce4 桌面 普通用户登陆不了，而root管理员却能登陆。<br>问题解决: 家目录中权限问题<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/home/fred<span class=\"comment\"># chown -R fred:fred *.*</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"问题4-Windows-桌面连接后远程使用Terminal时-，Tab键无法自动补全。\"><a href=\"#问题4-Windows-桌面连接后远程使用Terminal时-，Tab键无法自动补全。\" class=\"headerlink\" title=\"问题4.Windows 桌面连接后远程使用Terminal时 ，Tab键无法自动补全。\"></a>问题4.Windows 桌面连接后远程使用Terminal时 ，Tab键无法自动补全。</h3><p>描述: 默认情况下是使用ctrl+i的, Tab键被占用作为其他的快捷键;<br>解决办法: 在windows manager（窗口管理器）中，keyboard 里将用到 <code>Super + Tab</code> 的快捷键 clear 掉即可。</p>\n<p><br></p>\n<h3 id=\"问题5-远程桌面进去之后没有菜单栏\"><a href=\"#问题5-远程桌面进去之后没有菜单栏\" class=\"headerlink\" title=\"问题5.远程桌面进去之后没有菜单栏\"></a>问题5.远程桌面进去之后没有菜单栏</h3><p>解决办法: 右键面板-&gt; 面板首选项-&gt; backup and restore -&gt; apply configuration图标</p>\n<p><br></p>\n<h3 id=\"问题6-运行一段时间后，出现xrdp-mm-process-login-response-login-failed\"><a href=\"#问题6-运行一段时间后，出现xrdp-mm-process-login-response-login-failed\" class=\"headerlink\" title=\"问题6.运行一段时间后，出现xrdp_mm_process_login_response: login failed\"></a>问题6.运行一段时间后，出现xrdp_mm_process_login_response: login failed</h3><p>问题原因：远程桌面没有正确关闭，虽然在windows 系统关闭远程桌面连接，但是在里linux上的进程还在运行，导致连接数量达到上限出现问题。<br>问题解决：通过设置sesman.ini文件内的MaxSessions参数解决<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/xrdp/sesman.ini</span><br><span class=\"line\"><span class=\"comment\"># 修改会话设置最大会话限制</span></span><br><span class=\"line\">MaxSessions=50</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 每次断开连接时linux都会关闭会话进程</span></span><br><span class=\"line\">KillDisconnected=1</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"问题7-出现-password-failed，-error-problem-connecting\"><a href=\"#问题7-出现-password-failed，-error-problem-connecting\" class=\"headerlink\" title=\"问题7.出现 password failed， error - problem connecting\"></a>问题7.出现 password failed， error - problem connecting</h3><p>问题信息:如果你的log也有类似 X server for display 10 startup timeout和another Xserver is already active on display 10。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 信息1 </span></span><br><span class=\"line\">sudo vim /var/<span class=\"built_in\">log</span>/xrdp-sesman.log</span><br><span class=\"line\">  <span class=\"comment\"># xrdp-sesman.log下错误为：</span></span><br><span class=\"line\">  <span class=\"comment\"># [INFO ] starting Xvnc session...</span></span><br><span class=\"line\">  <span class=\"comment\"># [ERROR] X server for display 10 startup timeout[INFO ] starting xrdp-sessvc - xpid=2924 - wmpid=2923</span></span><br><span class=\"line\">  <span class=\"comment\"># [ERROR] X server for display 10 startup timeout</span></span><br><span class=\"line\">  <span class=\"comment\"># [ERROR] another Xserver is already active on display 10</span></span><br><span class=\"line\">  <span class=\"comment\"># [DEBUG] aborting connection...</span></span><br></pre></td></tr></table></figure><br>问题原因: tightvnc 出现问题的版本跟X字体有冲突，导致连接Xserver出错。<br>解决办法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get purge tightvnc xrdp</span><br><span class=\"line\">apt-get install tightvncserver xrdp</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重启启动xrdp服务并通过命令 netstat -tnl 查看监听状态</span></span><br><span class=\"line\">3350 3389 5910 <span class=\"comment\"># 一般这三个端口处于Listen</span></span><br></pre></td></tr></table></figure></p>\n<p>如果日志里跟第一种情况不同，可以考虑如下方式解决<code>sudo vim /etc/xrdp/sesman.ini</code>添加如下两行：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 解决办法</span></span><br><span class=\"line\">[Xvnc]</span><br><span class=\"line\">param8=-SecurityTypes</span><br><span class=\"line\">param9=None</span><br></pre></td></tr></table></figure><br>Tips: 若上述问题还是无法解决可卸载xrdp服务进行重装，并如上进行同样的操作，修改sesman.ini文件。</p>\n<p>卸载xrdp的命令为：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get purge xrdp</span><br><span class=\"line\">sudo apt-get purge tightvncserver</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"问题8-xrdp-service-fails-to-start，xrdp用systemctl-start启动时发现失败，查看错误信息、日志也没啥明确提示\"><a href=\"#问题8-xrdp-service-fails-to-start，xrdp用systemctl-start启动时发现失败，查看错误信息、日志也没啥明确提示\" class=\"headerlink\" title=\"问题8.xrdp service fails to start，xrdp用systemctl start启动时发现失败，查看错误信息、日志也没啥明确提示\"></a>问题8.xrdp service fails to start，xrdp用systemctl start启动时发现失败，查看错误信息、日志也没啥明确提示</h3><p>解决办法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">touch /var/<span class=\"built_in\">log</span>/xrdp.log</span><br><span class=\"line\">chown xrdp:adm /var/<span class=\"built_in\">log</span>/xrdp.log</span><br><span class=\"line\">chmod 640 /var/<span class=\"built_in\">log</span>/xrdp.log</span><br><span class=\"line\">systemctl start xrdp &amp;&amp; systemctl status xrdp</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"问题9-黑屏问题Xfce4会自动锁屏\"><a href=\"#问题9-黑屏问题Xfce4会自动锁屏\" class=\"headerlink\" title=\"问题9.黑屏问题Xfce4会自动锁屏\"></a>问题9.黑屏问题Xfce4会自动锁屏</h3><p>描述: 当你远程桌面断开连接一阵子在恢复，会发现黑屏，这时候不管teamviewer还是什么都连不了的。<br>解决办法: 所以需要关掉自动锁屏，在第一次远程连接上桌面后，左上角<code>Applications--&gt;Settings--&gt;Power Manager, Security</code>标签，”Automatically lock the session”–&gt;”Never” 从不锁定，就OK了。</p>\n<p><br></p>\n<h3 id=\"问题10-ubuntu利用xrdp登陆xfce4桌面vscode无法启动\"><a href=\"#问题10-ubuntu利用xrdp登陆xfce4桌面vscode无法启动\" class=\"headerlink\" title=\"问题10.ubuntu利用xrdp登陆xfce4桌面vscode无法启动\"></a>问题10.ubuntu利用xrdp登陆xfce4桌面vscode无法启动</h3><ul>\n<li>问题信息:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 问题1.vscode版本信息</span></span><br><span class=\"line\">code --version</span><br><span class=\"line\"><span class=\"comment\"># 1.58.2 c3f126316369cd610563c75b1b1725e0679adfb3 x64</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 问题2.在linux上安装vscode后，发现普通用户可以使用，管理员用户启动不了，报错如下：</span></span><br><span class=\"line\">ou are trying to start Visual Studio Code as a super user <span class=\"built_in\">which</span> isn’t recommended. If this was intended, please specify an alternate user data directory using the --user-data-dir argument.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 问题3.发生系统错误无法写入程序用户数据请确保以下目录可写</span></span><br><span class=\"line\">- ~/.config/code</span><br><span class=\"line\">- ~/.vscode/extensions</span><br><span class=\"line\">- /usr/lib</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul>\n<li>问题解决:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 问题1-2.解决</span></span><br><span class=\"line\"><span class=\"comment\"># 参考地址: https://github.com/Microsoft/vscode/issues/3451</span></span><br><span class=\"line\">sudo sed -i <span class=\"string\">'s/BIG-REQUESTS/_IG-REQUESTS/'</span> /usr/lib/x86_64-linux-gnu/libxcb.so.1</span><br><span class=\"line\"><span class=\"comment\"># 启动的时候，设置下–user-data-dir参数即可，如下所示：</span></span><br><span class=\"line\">./code --user-data-dir=<span class=\"string\">\"~/.vscode\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 问题3.解决</span></span><br><span class=\"line\">sudo chown -R weiyigeek:root /usr/lib</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<h3 id=\"问题11-利于XRDP远程登陆切换使用xfce桌面报Environment-variable-XDG-SESSION-PATH-not-set-Is-LightDM-running-错误。\"><a href=\"#问题11-利于XRDP远程登陆切换使用xfce桌面报Environment-variable-XDG-SESSION-PATH-not-set-Is-LightDM-running-错误。\" class=\"headerlink\" title=\"问题11.利于XRDP远程登陆切换使用xfce桌面报Environment variable XDG_SESSION_PATH not set. Is LightDM running? 错误。\"></a>问题11.利于XRDP远程登陆切换使用xfce桌面报<code>Environment variable XDG_SESSION_PATH not set. Is LightDM running?</code> 错误。</h3><ul>\n<li><p>错误信息: </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">** (light-locker:2769): ERROR **: 08:09:59.625: Environment variable XDG_SESSION_PATH not <span class=\"built_in\">set</span>. Is LightDM running?</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>问题解决: 禁用 light-locker</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo cp /usr/bin/light-locker /usr/bin/light-locker.orig</span><br><span class=\"line\">$  </span><br><span class=\"line\">sudo tee /usr/bin/light-locker &lt;&lt; EOF </span><br><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># The light-locker uses XDG_SESSION_PATH provided by lightdm.</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -z <span class=\"string\">\"\\$&#123;XDG_SESSION_PATH&#125;\"</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  /usr/bin/light-locker.orig</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">  <span class=\"comment\"># Disable light-locker in XRDP.</span></span><br><span class=\"line\">  <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\">EOF</span><br><span class=\"line\">$ sudo chmod a+x /usr/bin/light-locker</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<h3 id=\"问题12-解决QStandardPaths-XDG-RUNTIME-DIR-not-set-defaulting-to-‘-tmp-runtime-root’问题\"><a href=\"#问题12-解决QStandardPaths-XDG-RUNTIME-DIR-not-set-defaulting-to-‘-tmp-runtime-root’问题\" class=\"headerlink\" title=\"问题12. 解决QStandardPaths: XDG_RUNTIME_DIR not set, defaulting to ‘/tmp/runtime-root’问题\"></a>问题12. 解决QStandardPaths: XDG_RUNTIME_DIR not set, defaulting to ‘/tmp/runtime-root’问题</h3><p>解决办法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 在/etc/profile末尾增加两句</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> XDG_RUNTIME_DIR=/usr/lib/</span><br><span class=\"line\"><span class=\"built_in\">export</span> RUNLEVEL=3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重载 /etc/profile</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"问题13-Ubuntu配置xrdp后出现-thinclient-drives-文件夹\"><a href=\"#问题13-Ubuntu配置xrdp后出现-thinclient-drives-文件夹\" class=\"headerlink\" title=\"问题13.Ubuntu配置xrdp后出现 thinclient_drives 文件夹\"></a>问题13.Ubuntu配置xrdp后出现 thinclient_drives 文件夹</h3><p>描述: 下面我们将进行彻底删除 <code>thinclient_drives</code> </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 修改 /etc/xrdp/sesman.ini 文件，其</span></span><br><span class=\"line\">sudo vim /etc/xrdp/sesman.ini</span><br><span class=\"line\">; Fedora 26 or later    :  param=/usr/libexec/Xorg</span><br><span class=\"line\">; Debian 9 or later     :  param=/usr/lib/xorg/Xorg</span><br><span class=\"line\">; Ubuntu 16.04 or later :  param=/usr/lib/xorg/Xorg</span><br><span class=\"line\">; Arch Linux            :  param=/usr/lib/xorg-server/Xorg</span><br><span class=\"line\">; CentOS 7              :  param=/usr/bin/Xorg or param=Xorg</span><br><span class=\"line\">;</span><br><span class=\"line\">param=/usr/lib/xorg/Xorg</span><br><span class=\"line\">; Leave the rest paramaters as-is unless you understand what will happen.</span><br><span class=\"line\">param=-config</span><br><span class=\"line\">param=xrdp/xorg.conf</span><br><span class=\"line\">param=-noreset</span><br><span class=\"line\">param=-nolisten</span><br><span class=\"line\">param=tcp</span><br><span class=\"line\">param=-logfile</span><br><span class=\"line\">param=.xrdp/.xorgxrdp.%s.log</span><br><span class=\"line\">.....</span><br><span class=\"line\"><span class=\"comment\"># 把 FuseMountName=thinclient_drives 修改为 FuseMountName=xxxx/thinclient_drives，其中 xxxx 是任意一个不存在的位置（其实没有这个文件夹），如改为 FuseMountName=.xrdp/thinclient_drives。</span></span><br><span class=\"line\">[Chansrv]</span><br><span class=\"line\">; drive redirection, defaults to xrdp_client <span class=\"keyword\">if</span> not <span class=\"built_in\">set</span></span><br><span class=\"line\">FuseMountName=.xrdp/thinclient_drives</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除 thinclient_drives 文件夹</span></span><br><span class=\"line\">sudo umount thinclient_drives</span><br><span class=\"line\">sudo rm -rf thinclient_drives</span><br></pre></td></tr></table></figure>","comments":true,"excerpt":"[TOC]","categories":[{"name":"Linux","path":"api/categories/Linux.json"},{"name":"远程桌面","path":"api/categories/远程桌面.json"}],"tags":[{"name":"xrdp","path":"api/tags/xrdp.json"}]}