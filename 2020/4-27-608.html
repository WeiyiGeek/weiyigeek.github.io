<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 3.Goè¯­è¨€é¡¹ç›®æ“ä½œRedisæ•°æ®å®è·µ|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Go">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>3.Goè¯­è¨€é¡¹ç›®æ“ä½œRedisæ•°æ®å®è·µ</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">3.Goè¯­è¨€é¡¹ç›®æ“ä½œRedisæ•°æ®å®è·µ</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-04-27T03:16:58.000Z" itemprop="datePublished" class="page-time">
  2020-04-27
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/">Development</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/Programming/">Programming</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-ç¼–ç¨‹ä¸–ç•Œ/Go/Extension/3.Goè¯­è¨€é¡¹ç›®æ“ä½œRedisæ•°æ®å®è·µ"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">3.Goè¯­è¨€é¡¹ç›®æ“ä½œRedisæ•°æ®å®è·µ</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-04-27 11:16:58" datetime="2020-04-27T03:16:58.000Z"  itemprop="datePublished">2020-04-27</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/">Development</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/Programming/">Programming</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="Goè¯­è¨€ç¼–ç¨‹ä½¿ç”¨Go-redisåº“æ“ä½œRedisæ•°æ®åº“"><a href="#Goè¯­è¨€ç¼–ç¨‹ä½¿ç”¨Go-redisåº“æ“ä½œRedisæ•°æ®åº“" class="headerlink" title="Goè¯­è¨€ç¼–ç¨‹ä½¿ç”¨Go-redisåº“æ“ä½œRedisæ•°æ®åº“"></a>Goè¯­è¨€ç¼–ç¨‹ä½¿ç”¨Go-redisåº“æ“ä½œRedisæ•°æ®åº“</h2><p><strong>å¿«é€Ÿäº†è§£ Redis æ•°æ®åº“</strong><br>æè¿°: Redisæ˜¯ä¸€ä¸ªå¼€æºçš„å†…å­˜æ•°æ®åº“, Redisæä¾›äº†å¤šç§ä¸åŒç±»å‹çš„æ•°æ®ç»“æ„ï¼Œå¾ˆå¤šä¸šåŠ¡åœºæ™¯ä¸‹çš„é—®é¢˜éƒ½å¯ä»¥å¾ˆè‡ªç„¶åœ°æ˜ å°„åˆ°è¿™äº›æ•°æ®ç»“æ„ä¸Šã€‚é™¤æ­¤ä¹‹å¤–ï¼Œé€šè¿‡å¤åˆ¶ã€æŒä¹…åŒ–å’Œå®¢æˆ·ç«¯åˆ†ç‰‡ç­‰ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å°†Redisæ‰©å±•æˆä¸€ä¸ªèƒ½å¤ŸåŒ…å«æ•°ç™¾GBæ•°æ®ã€æ¯ç§’å¤„ç†ä¸Šç™¾ä¸‡æ¬¡è¯·æ±‚çš„ç³»ç»Ÿã€‚</p>
<p><br></p>
<p><strong>Redis æ”¯æŒçš„æ•°æ®ç»“æ„</strong></p>
<ul>
<li>å­—ç¬¦ä¸²ï¼ˆstringsï¼‰</li>
<li>å“ˆå¸Œï¼ˆhashesï¼‰</li>
<li>åˆ—è¡¨ï¼ˆlistsï¼‰</li>
<li>é›†åˆï¼ˆsetsï¼‰</li>
<li>å¸¦èŒƒå›´æŸ¥è¯¢çš„æ’åºé›†åˆï¼ˆsorted setsï¼‰</li>
<li>ä½å›¾ï¼ˆbitmapsï¼‰</li>
<li>hyperloglogs</li>
<li>å¸¦åŠå¾„æŸ¥è¯¢å’Œæµçš„åœ°ç†ç©ºé—´ç´¢å¼•ç­‰æ•°æ®ç»“æ„ï¼ˆgeospatial indexesï¼‰</li>
</ul>
<p><br/></p>
<p><strong>Redis åº”ç”¨åœºæ™¯</strong></p>
<ul>
<li>é«˜é€Ÿç¼“å­˜ç³»ç»Ÿï¼šå‡è½»ä¸»æ•°æ®åº“ï¼ˆMySQLï¼‰çš„å‹åŠ› <code>set keyname</code>ã€‚</li>
<li>è®¡æ•°åœºæ™¯ï¼šæ¯”å¦‚å¾®åšã€æŠ–éŸ³ä¸­çš„å…³æ³¨æ•°å’Œç²‰ä¸æ•° <code>incr keyname</code>ã€‚</li>
<li>çƒ­é—¨æ’è¡Œæ¦œ: éœ€è¦æ’åºçš„åœºæ™¯ç‰¹åˆ«é€‚åˆä½¿ç”¨ <code>ZSET</code>ã€‚</li>
<li>å®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„åŠŸèƒ½: ç®€å•çš„é˜Ÿåˆ—æ“ä½œä½¿ç”¨listç±»å‹å®ç°,Lè¡¨ç¤ºä»å·¦è¾¹(å¤´éƒ¨)å¼€å§‹æ’ä¸å¼¹å‡ºï¼ŒRè¡¨ç¤ºä»å³è¾¹(å°¾éƒ¨)å¼€å§‹æ’ä¸å¼¹å‡º,ä¾‹å¦‚<code>&quot;lpush / rpop&quot; - (æ»¡è¶³å…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—æ¨¡å¼)</code>å’Œ<code>&quot;rpush / lpop&quot; - (æ»¡è¶³å…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—æ¨¡å¼)</code>ã€‚</li>
</ul>
<p><br></p>
<h3 id="Redis-ç¯å¢ƒå‡†å¤‡"><a href="#Redis-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="Redis ç¯å¢ƒå‡†å¤‡"></a>Redis ç¯å¢ƒå‡†å¤‡</h3><p>æè¿°: æ­¤å¤„ä½¿ç”¨Dockerå¿«é€Ÿå¯åŠ¨ä¸€ä¸ªredisç¯å¢ƒï¼Œå¦‚æœ‰ä¸ä¼šçš„æœ‹å‹å¯ä»¥çœ‹æˆ‘å‰é¢å…³äºDockeræ–‡ç« æˆ–è€…ç™¾åº¦ã€‚</p>
<p>ä»¥ä¸‹æ˜¯å¯åŠ¨ä¸€ä¸ªredis serverï¼Œåˆ©ç”¨dockerå¯åŠ¨ä¸€ä¸ªåä¸ºredisçš„å®¹å™¨,æ³¨æ„æ­¤å¤„çš„ç‰ˆæœ¬ä¸º5.0.8ã€å®¹å™¨åå’Œç«¯å£å·è¯·æ ¹æ®è‡ªå·±éœ€è¦è®¾ç½®ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- Server</span></span><br><span class="line">$ docker run --name redis -p 6379:6379 -d redis:5.0.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># -- æŸ¥çœ‹è¿è¡Œçš„ redis å®¹å™¨</span></span><br><span class="line">$ docker ps | grep <span class="string">"redis"</span></span><br><span class="line">24eb3c6f7bab  redis   <span class="string">"docker-entrypoint.sâ€¦"</span>   19 months ago   Up 2 weeks  0.0.0.0:6379-&gt;6379/tcp   redis</span><br><span class="line"></span><br><span class="line"><span class="comment"># -- æŸ¥è¯¢rediså®¹å™¨èµ„æºä½¿ç”¨çŠ¶æ€ (æ‰©å±•)</span></span><br><span class="line">$ docker stats redis</span><br><span class="line">CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT   MEM %               NET I/O             BLOCK I/O           PIDS</span><br><span class="line">24eb3c6f7bab        redis               0.10%               9.02MiB / 2.77GiB   0.32%               20.8MB / 126MB      33.5MB / 16.2MB     4</span><br></pre></td></tr></table></figure></p>
<p>ä»¥ä¸‹æ–¹æ³•æ˜¯å¯åŠ¨ä¸€ä¸ª redis-cli è¿æ¥ä¸Šé¢çš„ redis server<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- Client </span></span><br><span class="line">docker run -it --network host --rm redis:5.0.8 redis-cli</span><br><span class="line"></span><br><span class="line"><span class="comment"># -- äº¤äº’å¼</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it redis bash</span><br><span class="line">root@24eb3c6f7bab:/data<span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">(error) NOAUTH Authentication required.</span><br><span class="line">127.0.0.1:6379&gt; auth weiyigeek.top</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="Redis-å®¢æˆ·ç«¯åº“å®‰è£…"><a href="#Redis-å®¢æˆ·ç«¯åº“å®‰è£…" class="headerlink" title="Redis å®¢æˆ·ç«¯åº“å®‰è£…"></a>Redis å®¢æˆ·ç«¯åº“å®‰è£…</h3><p>æè¿°: åœ¨ç½‘é¡µé¡¹ç›®å¼€å‘ä¸­redisæ•°æ®åº“çš„ä½¿ç”¨ä¹Ÿæ¯”è¾ƒé¢‘ç¹ï¼Œæœ¬èŠ‚å°†ä»‹ç»åœ¨Goè¯­è¨€ä¸­å¦‚ä½•è¿æ¥æ“ä½œRedisæ•°æ®åº“ä»¥åŠå®¢æˆ·åº“çš„åŸºæœ¬å®‰è£…å’Œä½¿ç”¨ã€‚</p>
<p>Go è¯­è¨€ä¸­å¸¸ç”¨çš„Redis Clientåº“:</p>
<ul>
<li>redigo : <a href="https://github.com/gomodule/redigo" target="_blank" rel="noopener">https://github.com/gomodule/redigo</a></li>
<li>go-redis : <a href="https://github.com/go-redis/redis" target="_blank" rel="noopener">https://github.com/go-redis/redis</a></li>
</ul>
<p>Tips: æ­¤å¤„æˆ‘ä»¬é‡‡ç”¨go-redisæ¥è¿æ¥Redisæ•°æ®åº“å¹¶è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œ,å› ä¸ºå…¶æ”¯æŒè¿æ¥å“¨å…µåŠé›†ç¾¤æ¨¡å¼çš„Redisã€‚</p>
<p>ä½¿ç”¨å‘½ä»¤ä¸‹è½½å®‰è£…go-redisåº“: <code>go get -u github.com/go-redis/redis</code></p>
<p><br/></p>
<h3 id="Redis-æ•°æ®åº“è¿æ¥"><a href="#Redis-æ•°æ®åº“è¿æ¥" class="headerlink" title="Redis æ•°æ®åº“è¿æ¥"></a>Redis æ•°æ®åº“è¿æ¥</h3><p>æè¿°: å‰é¢æˆ‘ä»¬ä¸‹è½½å¹¶å®‰è£…äº†<code>go-redis</code>ç¬¬ä¸‰æ–¹åº“, ä¸‹é¢æˆ‘å°†åˆ†åˆ«è¿›è¡Œå•èŠ‚ç‚¹è¿æ¥å’Œé›†ç¾¤è¿æ¥æ¼”ç¤º, å¹¶å°†å…¶å°è£…ä¸ºpackageæ–¹ä¾¿åç»­è¯•éªŒè¿›è¡Œè°ƒç”¨.</p>
<h4 id="1-Rediså•èŠ‚ç‚¹è¿æ¥"><a href="#1-Rediså•èŠ‚ç‚¹è¿æ¥" class="headerlink" title="1.Rediså•èŠ‚ç‚¹è¿æ¥"></a>1.Rediså•èŠ‚ç‚¹è¿æ¥</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// weiyigeek.top/studygo/Day09/MySQL/mypkg/initredis.go</span></span><br><span class="line"><span class="keyword">package</span> mypkg</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"github.com/go-redis/redis"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªRedisSingleObjç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> RedisSingleObj <span class="keyword">struct</span> &#123;</span><br><span class="line">  Redis_host <span class="keyword">string</span></span><br><span class="line">  Redis_port <span class="keyword">uint16</span></span><br><span class="line">  Redis_auth <span class="keyword">string</span></span><br><span class="line">  Database   <span class="keyword">int</span></span><br><span class="line">  Db         *redis.Client</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æ„ä½“InitSingleRedisæ–¹æ³•: ç”¨äºåˆå§‹åŒ–redisæ•°æ®åº“</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RedisSingleObj)</span> <span class="title">InitSingleRedis</span><span class="params">()</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">  <span class="comment">// Redisè¿æ¥æ ¼å¼æ‹¼æ¥</span></span><br><span class="line">  redisAddr := fmt.Sprintf(<span class="string">"%s:%d"</span>, r.Redis_host, r.Redis_port)</span><br><span class="line">  <span class="comment">// Redis è¿æ¥å¯¹è±¡: NewClientå°†å®¢æˆ·ç«¯è¿”å›åˆ°ç”±é€‰é¡¹æŒ‡å®šçš„RedisæœåŠ¡å™¨ã€‚</span></span><br><span class="line">  r.Db = redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">    Addr:        redisAddr,    <span class="comment">// redisæœåŠ¡ip:port</span></span><br><span class="line">    Password:    r.Redis_auth, <span class="comment">// redisçš„è®¤è¯å¯†ç </span></span><br><span class="line">    DB:          r.Database,   <span class="comment">// è¿æ¥çš„databaseåº“</span></span><br><span class="line">    IdleTimeout: <span class="number">300</span>,          <span class="comment">// é»˜è®¤Idleè¶…æ—¶æ—¶é—´</span></span><br><span class="line">    PoolSize:    <span class="number">100</span>,          <span class="comment">// è¿æ¥æ± </span></span><br><span class="line">  &#125;)</span><br><span class="line">  fmt.Printf(<span class="string">"Connecting Redis : %v\n"</span>, redisAddr)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// éªŒè¯æ˜¯å¦è¿æ¥åˆ°redisæœåŠ¡ç«¯</span></span><br><span class="line">  res, err := r.Db.Ping().Result()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Connect Failed! Err: %v\n"</span>, err)</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Connect Successful! Ping =&gt; %v\n"</span>, res)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨ç¨‹åº:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// weiyigeek.top/studygo/Day09/MySQL/demo6/singeredis.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"weiyigeek.top/studygo/Day09/MySQL/mypkg"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// å®ä¾‹åŒ–RedisSingleObjç»“æ„ä½“</span></span><br><span class="line">  conn := &amp;mypkg.RedisSingleObj&#123;</span><br><span class="line">    Redis_host: <span class="string">"10.20.172.248"</span>,</span><br><span class="line">    Redis_port: <span class="number">6379</span>,</span><br><span class="line">    Redis_auth: <span class="string">"weiyigeek.top"</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–è¿æ¥ Single Redis æœåŠ¡ç«¯</span></span><br><span class="line">  err := conn.InitSingleRedis()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç¨‹åºæ‰§è¡Œå®Œæ¯•é‡Šæ”¾èµ„æº</span></span><br><span class="line">  <span class="keyword">defer</span> conn.Db.Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Connecting Redis : 10.20.172.248:6379</span><br><span class="line">Connect Successful! Ping() =&gt; PONG</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="2-Rediså“¨å…µæ¨¡å¼è¿æ¥"><a href="#2-Rediså“¨å…µæ¨¡å¼è¿æ¥" class="headerlink" title="2.Rediså“¨å…µæ¨¡å¼è¿æ¥"></a>2.Rediså“¨å…µæ¨¡å¼è¿æ¥</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªRedisClusterObjç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> RedisSentinelObj <span class="keyword">struct</span> &#123;</span><br><span class="line">  Redis_master <span class="keyword">string</span></span><br><span class="line">  Redis_addr []<span class="keyword">string</span></span><br><span class="line">  Redis_auth <span class="keyword">string</span></span><br><span class="line">  Db         *redis.Client</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æ„ä½“æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RedisSentinelObj)</span> <span class="title">initSentinelClient</span><span class="params">()</span><span class="params">(err error)</span></span>&#123;</span><br><span class="line">  r.Db = redis.NewFailoverClient(&amp;redis.FailoverOptions&#123;</span><br><span class="line">    MasterName:    <span class="string">"master"</span>,</span><br><span class="line">    SentinelAddrs: []<span class="keyword">string</span>&#123;<span class="string">"x.x.x.x:26379"</span>, <span class="string">"xx.xx.xx.xx:26379"</span>, <span class="string">"xxx.xxx.xxx.xxx:26379"</span>&#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  _, err = rdb.Ping().Result()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br/></p>
<h4 id="3-Redisé›†ç¾¤æ¨¡å¼è¿æ¥"><a href="#3-Redisé›†ç¾¤æ¨¡å¼è¿æ¥" class="headerlink" title="3.Redisé›†ç¾¤æ¨¡å¼è¿æ¥"></a>3.Redisé›†ç¾¤æ¨¡å¼è¿æ¥</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªRedisClusterObjç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> RedisClusterObj <span class="keyword">struct</span> &#123;</span><br><span class="line">  Redis_addr []<span class="keyword">string</span></span><br><span class="line">  Redis_auth <span class="keyword">string</span></span><br><span class="line">  Db         *redis.Client</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æ„ä½“æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RedisSingleObj)</span> <span class="title">initClusterClient</span><span class="params">()</span><span class="params">(err error)</span></span>&#123;</span><br><span class="line">  r.Db = redis.NewClusterClient(&amp;redis.ClusterOptions&#123;</span><br><span class="line">    Addrs: []<span class="keyword">string</span>&#123;<span class="string">":7000"</span>, <span class="string">":7001"</span>, <span class="string">":7002"</span>, <span class="string">":7003"</span>, <span class="string">":7004"</span>, <span class="string">":7005"</span>&#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  _, err = rdb.Ping().Result()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br/></p>
<h4 id="4-V8æ–°ç‰ˆæœ¬è¿æ¥æ–¹å¼-é‡ç‚¹"><a href="#4-V8æ–°ç‰ˆæœ¬è¿æ¥æ–¹å¼-é‡ç‚¹" class="headerlink" title="4.V8æ–°ç‰ˆæœ¬è¿æ¥æ–¹å¼(é‡ç‚¹)"></a>4.V8æ–°ç‰ˆæœ¬è¿æ¥æ–¹å¼(é‡ç‚¹)</h4><p>æè¿°: æœ€æ–°ç‰ˆæœ¬çš„<code>go-redis</code>åº“æ˜¯v8ç‰ˆæœ¬, åœ¨ä½¿ç”¨å‰æˆ‘ä»¬å¿…é¡»è¿›è¡Œå®‰è£…ï¼š<code>go get github.com/go-redis/redis/v8</code>ã€‚<br>é¡¹ç›®åœ°å€: <a href="https://pkg.go.dev/github.com/go-redis/redis/v8" target="_blank" rel="noopener">https://pkg.go.dev/github.com/go-redis/redis/v8</a></p>
<p>æ³¨æ„æœ€æ–°ç‰ˆæœ¬çš„<code>go-redis</code>åº“ç›¸å…³å‘½ä»¤æ–°å¢äº†ä¸Šä¸‹æ–‡æ“ä½œï¼Œæ‰€ä»¥éœ€è¦ä¼ é€’<code>context.Context</code>å‚æ•°ï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"context"</span></span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">  <span class="string">"github.com/go-redis/redis/v8"</span> <span class="comment">// æ³¨æ„å¯¼å…¥çš„æ˜¯æ–°ç‰ˆæœ¬</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">  rdb *redis.Client</span><br><span class="line">)</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–è¿æ¥</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initClient</span><span class="params">()</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">  rdb = redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">    Addr:     <span class="string">"localhost:16379"</span>,</span><br><span class="line">    Password: <span class="string">""</span>,  <span class="comment">// no password set</span></span><br><span class="line">    DB:       <span class="number">0</span>,   <span class="comment">// use default DB</span></span><br><span class="line">    PoolSize: <span class="number">100</span>, <span class="comment">// è¿æ¥æ± å¤§å°</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// éœ€è¦ä½¿ç”¨contextåº“</span></span><br><span class="line">  ctx, cancel := context.WithTimeout(context.Background(), <span class="number">5</span>*time.Second)</span><br><span class="line">  <span class="keyword">defer</span> cancel()</span><br><span class="line"></span><br><span class="line">  _, err = rdb.Ping(ctx).Result()</span><br><span class="line">  <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">V8Example</span><span class="params">()</span></span> &#123;</span><br><span class="line">  ctx := context.Background()</span><br><span class="line">  <span class="keyword">if</span> err := initClient(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è®¾ç½®Key</span></span><br><span class="line">  err := rdb.Set(ctx, <span class="string">"key"</span>, <span class="string">"value"</span>, <span class="number">0</span>).Err()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è·å–å­˜åœ¨çš„Key</span></span><br><span class="line">  val, err := rdb.Get(ctx, <span class="string">"key"</span>).Result()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(<span class="string">"key"</span>, val)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è·å–ä¸å­˜åœ¨çš„Key</span></span><br><span class="line">  val2, err := rdb.Get(ctx, <span class="string">"key2"</span>).Result()</span><br><span class="line">  <span class="keyword">if</span> err == redis.Nil &#123;</span><br><span class="line">    fmt.Println(<span class="string">"key2 does not exist"</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"key2"</span>, val2)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Output: key value</span></span><br><span class="line"><span class="comment">// key2 does not exist</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="Redis-æ•°æ®ç±»å‹æŒ‡ä»¤æ“ä½œå®è·µ"><a href="#Redis-æ•°æ®ç±»å‹æŒ‡ä»¤æ“ä½œå®è·µ" class="headerlink" title="Redis æ•°æ®ç±»å‹æŒ‡ä»¤æ“ä½œå®è·µ"></a>Redis æ•°æ®ç±»å‹æŒ‡ä»¤æ“ä½œå®è·µ</h3><p>æè¿°: åœ¨ä½¿ç”¨<code>go-redis</code>æ¥æ“ä½œrediså‰,æˆ‘ä»¬å¯ä»¥é€šè¿‡redis-cliå‘½ä»¤è¿›å…¥åˆ°äº¤äº’å¼çš„å‘½ä»¤è¡Œæ¥æ‰§è¡Œç›¸å…³å‘½ä»¤å¹¶æŸ¥çœ‹æ‰§è¡Œåç›¸åº”çš„æ•ˆæœä¾¿äºè¯»è€…ç†è§£ã€‚</p>
<p>Step 1.é¦–å…ˆæˆ‘ä»¬è¿æ¥åˆ°æœåŠ¡ç«¯.<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿æ¥åˆ°redisæœåŠ¡å™¨ -a æŒ‡å®šè®¤è¯å­—ç¬¦ä¸²</span></span><br><span class="line">redis-cli -a weiyigeek.top</span><br><span class="line"></span><br><span class="line"><span class="comment">// éªŒè¯è¿æ¥çŠ¶æ€</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; ping  </span><br><span class="line">PONG <span class="comment">// è¡¨ç¤ºè¿æ¥æ­£å¸¸</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>Step 2. Redis å­—ç¬¦ä¸²æ•°æ®ç±»å‹çš„ç›¸å…³å‘½ä»¤ç”¨äºç®¡ç† redis å­—ç¬¦ä¸²å€¼<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®keyå¹¶æŒ‡å®šå­—ç¬¦ä¸²(String)</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; set myname <span class="string">"weiyigeek"</span> EX <span class="number">60</span></span><br><span class="line">OK</span><br><span class="line"><span class="comment">// è·å–æŒ‡å®škeyå­˜åœ¨çš„å­—ç¬¦ä¸²(String)</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get myname</span><br><span class="line"><span class="string">"weiyigeek"</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get myname  <span class="comment">// ç­‰å¾…60såè¯¥keyså¤±æ•ˆ</span></span><br><span class="line">(<span class="literal">nil</span>)</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>Step 3. Redis hash ç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡å®ƒæ˜¯ä¸€ä¸ª string ç±»å‹çš„ fieldï¼ˆå­—æ®µï¼‰ å’Œ valueï¼ˆå€¼ï¼‰ çš„æ˜ å°„è¡¨<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HMSET mymsets name <span class="string">"weiygeek"</span> age <span class="number">13</span> hobby <span class="string">"Study Go!"</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HGET mymsets name  <span class="comment">// æŒ‡å®šé”®çš„æŒ‡å®šå­—æ®µå€¼</span></span><br><span class="line"><span class="string">"weiygeek"</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HGETALL mymsets   <span class="comment">// è·å–åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®š key çš„æ‰€æœ‰å­—æ®µå’Œå€¼</span></span><br><span class="line"><span class="number">1</span>) <span class="string">"name"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"weiygeek"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"age"</span></span><br><span class="line"><span class="number">4</span>) <span class="string">"13"</span></span><br><span class="line"><span class="number">5</span>) <span class="string">"hobby"</span></span><br><span class="line"><span class="number">6</span>) <span class="string">"Study Go!"</span></span><br></pre></td></tr></table></figure><br><br/></p>
<p>Step 4. Redis List æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt;  LPUSH mylpush one <span class="string">"C"</span> tow <span class="string">"C#"</span> there <span class="string">"Java"</span> four <span class="string">"Go"</span> <span class="comment">// å¤´éƒ¨æ’å…¥</span></span><br><span class="line">(integer) <span class="number">8</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt;  LRANGE mylpush <span class="number">0</span> <span class="number">7</span>  <span class="comment">// ä»0å¼€å§‹åˆ°1çš„èŒƒå›´å†…æ•°æ®</span></span><br><span class="line"><span class="number">1</span>) <span class="string">"Go"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"four"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"Java"</span></span><br><span class="line"><span class="number">4</span>) <span class="string">"there"</span></span><br><span class="line"><span class="number">5</span>) <span class="string">"C#"</span></span><br><span class="line"><span class="number">6</span>) <span class="string">"tow"</span></span><br><span class="line"><span class="number">7</span>) <span class="string">"C"</span></span><br><span class="line"><span class="number">8</span>) <span class="string">"one"</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; LINDEX mylpush <span class="number">0</span>  <span class="comment">// è·å–ç´¢å¼•ä¸º0çš„å€¼</span></span><br><span class="line"><span class="string">"Go"</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; LINDEX mylpush <span class="number">1</span>  <span class="comment">// è·å–ç´¢å¼•ä¸º1çš„å€¼</span></span><br><span class="line"><span class="string">"four"</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; LPOP mylpush      <span class="comment">// ç§»é™¤åˆ—è¡¨ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›å€¼ä¸ºç§»é™¤çš„å…ƒç´ ã€‚ 0 -&gt;</span></span><br><span class="line"><span class="string">"Go"</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; RPOP mylpush      <span class="comment">// ç§»é™¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›å€¼ä¸ºç§»é™¤çš„å…ƒç´ ã€‚-1 &lt;-  </span></span><br><span class="line"><span class="string">"one"</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; RPUSH mylpush <span class="string">"æœ«å°¾"</span>  <span class="comment">// å‘æœ«å°¾è¿›è¡Œæ’å…¥å€¼</span></span><br><span class="line">(integer) <span class="number">7</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; LINDEX mylpush <span class="number">-1</span>    <span class="comment">// </span></span><br><span class="line"><span class="string">"\xe6\x9c\xab\xe5\xb0\xbe"</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>Step 5. Setæ˜¯ String ç±»å‹çš„æ— åºé›†åˆä¸”é›†åˆæˆå‘˜æ˜¯å”¯ä¸€çš„<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SADD mysadds <span class="number">1</span> redis <span class="number">8</span> mongodb <span class="number">3</span> mysql <span class="number">4</span> oracle <span class="number">5</span> db2</span><br><span class="line">(integer) <span class="number">10</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SMEMBERS mysadds <span class="comment">// è¿”å›é›†åˆä¸­çš„æ‰€æœ‰æˆå‘˜</span></span><br><span class="line"> <span class="number">1</span>) <span class="string">"8"</span></span><br><span class="line"> <span class="number">2</span>) <span class="string">"5"</span></span><br><span class="line"> <span class="number">3</span>) <span class="string">"3"</span></span><br><span class="line"> <span class="number">4</span>) <span class="string">"4"</span></span><br><span class="line"> <span class="number">5</span>) <span class="string">"mongodb"</span></span><br><span class="line"> <span class="number">6</span>) <span class="string">"oracle"</span></span><br><span class="line"> <span class="number">7</span>) <span class="string">"mysql"</span></span><br><span class="line"> <span class="number">8</span>) <span class="string">"db2"</span></span><br><span class="line"> <span class="number">9</span>) <span class="string">"1"</span></span><br><span class="line"><span class="number">10</span>) <span class="string">"redis"</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SCARD mysadds  <span class="comment">// è·å–é›†åˆçš„æˆå‘˜æ•°</span></span><br><span class="line">(integer) <span class="number">10</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SPOP mysadds   <span class="comment">// éšæœºç§»é™¤æˆå‘˜</span></span><br><span class="line"><span class="string">"db2"</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SPOP mysadds</span><br><span class="line"><span class="string">"mysql"</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>Step 6. Redis æœ‰åºé›†åˆæ˜¯ string ç±»å‹å…ƒç´ çš„é›†åˆä¸”ä¸å…è®¸é‡å¤çš„æˆå‘˜, ä½†æ˜¯ä¼šé€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å°åˆ°å¤§çš„æ’åºã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; ZADD mysets <span class="number">100</span> <span class="string">"Go"</span> <span class="number">90</span> <span class="string">"Python"</span> <span class="number">80</span> <span class="string">"Ruby"</span> <span class="number">70</span> <span class="string">"C"</span></span><br><span class="line">(integer) <span class="number">4</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; ZRANGE mysets <span class="number">0</span> <span class="number">5</span> withscores  <span class="comment">// æŒ‡å®šèŒƒå›´</span></span><br><span class="line"><span class="number">1</span>) <span class="string">"C"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"70"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"Ruby"</span></span><br><span class="line"><span class="number">4</span>) <span class="string">"80"</span></span><br><span class="line"><span class="number">5</span>) <span class="string">"Python"</span></span><br><span class="line"><span class="number">6</span>) <span class="string">"90"</span></span><br><span class="line"><span class="number">7</span>) <span class="string">"Go"</span></span><br><span class="line"><span class="number">8</span>) <span class="string">"100"</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; ZRANGE mysets <span class="number">0</span> <span class="number">-1</span>   <span class="comment">// æ•´ä¸ªé›†åˆ</span></span><br><span class="line"><span class="number">1</span>) <span class="string">"C"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"Ruby"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"Python"</span></span><br><span class="line"><span class="number">4</span>) <span class="string">"Go"</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; ZRANGE mysets <span class="number">-1</span> <span class="number">3</span>   <span class="comment">// è·å–åˆ†æ•°æœ€é«˜çš„å€¼-1ä»£è¡¨å€’æ•°ç¬¬ä¸€ä¸ªã€‚</span></span><br><span class="line"><span class="number">1</span>) <span class="string">"Go"</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; ZRANGE mysets <span class="number">-2</span> <span class="number">2</span></span><br><span class="line"><span class="number">1</span>) <span class="string">"Python"</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; ZRANGE mysets <span class="number">-3</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">"Ruby"</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; ZRANGE mysets <span class="number">-4</span> <span class="number">0</span></span><br><span class="line"><span class="number">1</span>) <span class="string">"C"</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>Step 7. Redis HyperLogLog æ˜¯ç”¨æ¥åšåŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ï¼ŒHyperLogLog çš„ä¼˜ç‚¹æ˜¯ï¼Œåœ¨è¾“å…¥å…ƒç´ çš„æ•°é‡æˆ–è€…ä½“ç§¯éå¸¸éå¸¸å¤§æ—¶ï¼Œè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ€»æ˜¯å›ºå®š çš„ã€å¹¶ä¸”æ˜¯å¾ˆå°çš„ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; PFADD myhlkey <span class="string">"redis"</span>  <span class="comment">// æ·»åŠ æŒ‡å®šå…ƒç´ åˆ° HyperLogLog ä¸­ã€‚</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; PFADD myhlkey <span class="string">"memcache"</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; PFADD myhlkey <span class="string">"mysql"</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; PFADD myhlkey <span class="string">"redis"</span>  </span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; PFCOUNT myhlkey  <span class="comment">// è¿”å›ç»™å®š HyperLogLog çš„åŸºæ•°ä¼°ç®—å€¼ã€‚</span></span><br><span class="line">(integer) <span class="number">3</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>Step 8. å‘å¸ƒè®¢é˜… (pub/sub) æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€… (pub) å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€… (sub) æ¥æ”¶æ¶ˆæ¯ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ª redis-cli å®¢æˆ·ç«¯ï¼Œåœ¨æˆ‘ä»¬å®ä¾‹ä¸­æˆ‘ä»¬åˆ›å»ºäº†è®¢é˜…é¢‘é“åä¸º weiyigeekChat:</span></span><br><span class="line">redis 127.0.0.1:6379&gt; SUBSCRIBE weiyigeekChat</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) <span class="string">"subscribe"</span></span><br><span class="line">2) <span class="string">"weiyigeekChat"</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬äºŒä¸ª redis-cli å®¢æˆ·ç«¯,åœ¨åŒä¸€ä¸ªé¢‘é“ weiyigeekChat å‘å¸ƒä¸¤æ¬¡æ¶ˆæ¯ï¼Œè®¢é˜…è€…å°±èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯ã€‚</span></span><br><span class="line">redis 127.0.0.1:6379&gt; PUBLISH weiyigeekChat <span class="string">"Redis PUBLISH test"</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; PUBLISH weiyigeekChat <span class="string">"Learn redis by weiyigeek.top"</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¢é˜…è€…çš„å®¢æˆ·ç«¯ä¼šæ˜¾ç¤ºå¦‚ä¸‹æ¶ˆæ¯</span></span><br><span class="line">1) <span class="string">"subscribe"</span></span><br><span class="line">2) <span class="string">"weiyigeekChat"</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line">1) <span class="string">"message"</span></span><br><span class="line">2) <span class="string">"weiyigeekChat"</span></span><br><span class="line">3) <span class="string">"Redis PUBLISH test"</span></span><br><span class="line"></span><br><span class="line">1) <span class="string">"message"</span></span><br><span class="line">2) <span class="string">"weiyigeekChat"</span></span><br><span class="line">3) <span class="string">"Learn redis by weiyigeek.top"</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>Step 9.Redis äº‹åŠ¡å¯ä»¥ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤, ä¸€ä¸ªäº‹åŠ¡ä»å¼€å§‹åˆ°æ‰§è¡Œä¼šç»å†ä»¥ä¸‹ä¸‰ä¸ªé˜¶æ®µï¼š<code>å¼€å§‹äº‹åŠ¡</code>,<code>å‘½ä»¤å…¥é˜Ÿ</code>,<code>æ‰§è¡Œäº‹åŠ¡</code>ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; MULTI  <span class="comment"># å¼€å¯äº‹åŠ¡</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">redis 127.0.0.1:6379&gt; SET book-name <span class="string">"Mastering C++ in 21 days"</span></span><br><span class="line">QUEUED</span><br><span class="line">redis 127.0.0.1:6379&gt; GET book-name</span><br><span class="line">QUEUED</span><br><span class="line">redis 127.0.0.1:6379&gt; SADD tag <span class="string">"C++"</span> <span class="string">"Programming"</span> <span class="string">"Mastering Series"</span></span><br><span class="line">QUEUED</span><br><span class="line">redis 127.0.0.1:6379&gt; SMEMBERS tag</span><br><span class="line">QUEUED</span><br><span class="line"></span><br><span class="line">redis 127.0.0.1:6379&gt; EXEC  <span class="comment"># æ‰§è¡Œæ‰€æœ‰äº‹åŠ¡å—å†…çš„å‘½ä»¤</span></span><br><span class="line">1) OK</span><br><span class="line">2) <span class="string">"Mastering C++ in 21 days"</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 3</span><br><span class="line">4) 1) <span class="string">"Mastering Series"</span></span><br><span class="line">   2) <span class="string">"C++"</span></span><br><span class="line">   3) <span class="string">"Programming"</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>Step 10. Redis GEO ä¸»è¦ç”¨äºå­˜å‚¨åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œå¹¶å¯¹å­˜å‚¨çš„ä¿¡æ¯è¿›è¡Œæ“ä½œï¼Œè¯¥åŠŸèƒ½åœ¨ Redis 3.2 ç‰ˆæœ¬æ–°å¢ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å°†ä¸€ä¸ªæˆ–å¤šä¸ªç»åº¦(longitude)|ã€çº¬åº¦(latitude)-ã€ä½ç½®åç§°(member)æ·»åŠ åˆ°æŒ‡å®šçš„ key ä¸­</span></span><br><span class="line"><span class="comment"># é‡åº† ç»åº¦:106.55 çº¬åº¦:29.57</span></span><br><span class="line"><span class="comment"># å››å·æˆéƒ½ ç»åº¦:104.06	çº¬åº¦:30.67</span></span><br><span class="line">GEOADD cityAddr 106.55 29.57 ChongQing 104.06 30.67 SichuanChengDu</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.è¿”å›æ‰€æœ‰æŒ‡å®šåç§°(member)çš„ä½ç½®ï¼ˆç»åº¦å’Œçº¬åº¦ï¼‰ï¼Œä¸å­˜åœ¨çš„è¿”å› nilã€‚</span></span><br><span class="line">GEOPOS cityAddr ChongQing SichuanChengDu NonExistKey</span><br><span class="line">1) 1) <span class="string">"106.5499994158744812"</span></span><br><span class="line">   2) <span class="string">"29.5700000136221135"</span></span><br><span class="line">2) 1) <span class="string">"104.05999749898910522"</span></span><br><span class="line">   2) <span class="string">"30.67000055930392222"</span></span><br><span class="line">3) (nil)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.ç”¨äºè¿”å›ä¸¤ä¸ªç»™å®šä½ç½®ä¹‹é—´çš„è·ç¦»,æ­¤å¤„è®¡ç®—é‡åº†ä¸ç¨‹åº¦çš„è·ç¦»ï¼ˆm ï¼šç±³ï¼Œé»˜è®¤å•ä½ã€km ï¼šåƒç±³ã€mi ï¼šè‹±é‡Œã€ft ï¼šè‹±å°ºï¼‰ã€‚</span></span><br><span class="line">GEODIST cityAddr ChongQing SichuanChengDu km</span><br><span class="line"><span class="string">"268.9827"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.ä»¥ç»™å®šçš„ç»çº¬åº¦ä¸ºä¸­å¿ƒï¼Œ è¿”å›é”®åŒ…å«çš„ä½ç½®å…ƒç´ å½“ä¸­ï¼Œ ä¸ä¸­å¿ƒçš„è·ç¦»ä¸è¶…è¿‡ç»™å®šæœ€å¤§è·ç¦»çš„æ‰€æœ‰ä½ç½®å…ƒç´ ã€‚</span></span><br><span class="line"><span class="comment"># WITHDIST: åœ¨è¿”å›ä½ç½®å…ƒç´ çš„åŒæ—¶ï¼Œ å°†ä½ç½®å…ƒç´ ä¸ä¸­å¿ƒä¹‹é—´çš„è·ç¦»ä¹Ÿä¸€å¹¶è¿”å›ã€‚</span></span><br><span class="line"><span class="comment"># WITHCOORD: å°†ä½ç½®å…ƒç´ çš„ç»åº¦å’Œçº¬åº¦ä¹Ÿä¸€å¹¶è¿”å›ã€‚</span></span><br><span class="line"><span class="comment"># WITHHASH: ä»¥ 52 ä½æœ‰ç¬¦å·æ•´æ•°çš„å½¢å¼ï¼Œ è¿”å›ä½ç½®å…ƒç´ ç»è¿‡åŸå§‹ geohash ç¼–ç çš„æœ‰åºé›†åˆåˆ†å€¼ã€‚ è¿™ä¸ªé€‰é¡¹ä¸»è¦ç”¨äºåº•å±‚åº”ç”¨æˆ–è€…è°ƒè¯•ï¼Œ å®é™…ä¸­çš„ä½œç”¨å¹¶ä¸å¤§ã€‚</span></span><br><span class="line">127.0.0.1:6379&gt; GEORADIUS cityAddr 105 29 200 km WITHDIST WITHCOORD</span><br><span class="line">1) 1) <span class="string">"ChongQing"</span></span><br><span class="line">   2) <span class="string">"163.1843"</span></span><br><span class="line">   3) 1) <span class="string">"106.5499994158744812"</span></span><br><span class="line">      2) <span class="string">"29.5700000136221135"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.geohash ç”¨äºè·å–ä¸€ä¸ªæˆ–å¤šä¸ªä½ç½®å…ƒç´ çš„ geohash å€¼ã€‚</span></span><br><span class="line">GEOHASH cityAddr ChongQing SichuanChengDu</span><br><span class="line">127.0.0.1:6379&gt; GEOHASH cityAddr ChongQing SichuanChengDu</span><br><span class="line">1) <span class="string">"wm7b0x53dz0"</span></span><br><span class="line">2) <span class="string">"wm3yrzq1tw0"</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>Step 11.Redis Stream ä¸»è¦ç”¨äºæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼ŒMessage Queueï¼‰ï¼ŒRedis æœ¬èº«æ˜¯æœ‰ä¸€ä¸ª Redis å‘å¸ƒè®¢é˜… (pub/sub) æ¥å®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„åŠŸèƒ½ï¼Œä½†å®ƒæœ‰ä¸ªç¼ºç‚¹å°±æ˜¯æ¶ˆæ¯æ— æ³•æŒä¹…åŒ–ï¼Œå¦‚æœå‡ºç°ç½‘ç»œæ–­å¼€ã€Redis å®•æœºç­‰ï¼Œæ¶ˆæ¯å°±ä¼šè¢«ä¸¢å¼ƒï¼Œå®ƒæ˜¯Redis 5.0 ç‰ˆæœ¬æ–°å¢åŠ çš„æ•°æ®ç»“æ„ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ XADD å‘é˜Ÿåˆ—æ·»åŠ æ¶ˆæ¯ï¼Œå¦‚æœæŒ‡å®šçš„é˜Ÿåˆ—ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—</span></span><br><span class="line">XADD mystreams * Name <span class="string">"WeiyiGeek"</span> Age 25 Hobby <span class="string">"Computer"</span></span><br><span class="line"><span class="string">"1640313258699-0"</span></span><br><span class="line">XADD mystreams * Addr ChongQing</span><br><span class="line"><span class="string">"1640313276946-0"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦</span></span><br><span class="line">127.0.0.1:6379&gt; XLEN mystreams</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°é˜Ÿåˆ—å­˜å‚¨çš„å­—æ®µä¸å€¼( - è¡¨ç¤ºæœ€å°å€¼ ,+ è¡¨ç¤ºæœ€å¤§å€¼ )</span></span><br><span class="line">127.0.0.1:6379&gt; XRANGE mystreams - +</span><br><span class="line">1) 1) <span class="string">"1640313258699-0"</span></span><br><span class="line">   2) 1) <span class="string">"Name"</span></span><br><span class="line">      2) <span class="string">"WeiyiGeek"</span></span><br><span class="line">      3) <span class="string">"Age"</span></span><br><span class="line">      4) <span class="string">"25"</span></span><br><span class="line">      5) <span class="string">"Hobby"</span></span><br><span class="line">      6) <span class="string">"Computer"</span></span><br><span class="line">2) 1) <span class="string">"1640313276946-0"</span></span><br><span class="line">   2) 1) <span class="string">"Addr"</span></span><br><span class="line">      2) <span class="string">"ChongQing"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  ä½¿ç”¨ XTRIM å¯¹æµè¿›è¡Œä¿®å‰ªï¼Œé™åˆ¶é•¿åº¦ï¼Œ è¯­æ³•æ ¼å¼ï¼š</span></span><br><span class="line">127.0.0.1:6379&gt; XTRIM mystreams MAXLEN 1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; XRANGE mystreams - +</span><br><span class="line">1) 1) <span class="string">"1640313276946-0"</span></span><br><span class="line">   2) 1) <span class="string">"Addr"</span></span><br><span class="line">      2) <span class="string">"ChongQing"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä» Stream å¤´éƒ¨è¯»å–ä¸¤æ¡æ¶ˆæ¯</span></span><br><span class="line">127.0.0.1:6379&gt; XADD mystreams * Name <span class="string">"WeiyiGeek"</span> Age 25 Hobby <span class="string">"Computer"</span></span><br><span class="line">127.0.0.1:6379&gt; XREAD COUNT 2 STREAMS mystreams  writers 0-0 0-0</span><br><span class="line">1) 1) <span class="string">"mystreams"</span></span><br><span class="line">   2) 1) 1) <span class="string">"1640313276946-0"</span></span><br><span class="line">         2) 1) <span class="string">"Addr"</span></span><br><span class="line">            2) <span class="string">"ChongQing"</span></span><br><span class="line">      2) 1) <span class="string">"1640313910204-0"</span></span><br><span class="line">         2) 1) <span class="string">"Name"</span></span><br><span class="line">            2) <span class="string">"WeiyiGeek"</span></span><br><span class="line">            3) <span class="string">"Age"</span></span><br><span class="line">            4) <span class="string">"25"</span></span><br><span class="line">            5) <span class="string">"Hobby"</span></span><br><span class="line">            6) <span class="string">"Computer"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä» Stream å¤´éƒ¨è¯»å–1æ¡æ¶ˆæ¯</span></span><br><span class="line">127.0.0.1:6379&gt; XREAD COUNT 1 STREAMS mystreams  writers 0-0 0-0</span><br><span class="line">1) 1) <span class="string">"mystreams"</span></span><br><span class="line">   2) 1) 1) <span class="string">"1640313276946-0"</span></span><br><span class="line">         2) 1) <span class="string">"Addr"</span></span><br><span class="line">            2) <span class="string">"ChongQing"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ XGROUP CREATE åˆ›å»ºæ¶ˆè´¹è€…ç»„,æ­¤å¤„ä»å¤´éƒ¨æ¶ˆè´¹,å¦‚æœæƒ³ä»å°¾éƒ¨æ¶ˆè´¹è¯·å°†0-0æ”¹æˆ$</span></span><br><span class="line">127.0.0.1:6379&gt; XGROUP CREATE mystreams consumer-group-name 0-0</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ XREADGROUP GROUP è¯»å–æ¶ˆè´¹ç»„ä¸­çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"># XREADGROUP GROUP group consumer [COUNT count] [BLOCK milliseconds] [NOACK] STREAMS key [key ...] ID [ID ...]</span></span><br><span class="line"><span class="comment"># group ï¼šæ¶ˆè´¹ç»„å</span></span><br><span class="line"><span class="comment"># consumer ï¼šæ¶ˆè´¹è€…åã€‚</span></span><br><span class="line"><span class="comment"># count ï¼š è¯»å–æ•°é‡ã€‚</span></span><br><span class="line"><span class="comment"># milliseconds ï¼š é˜»å¡æ¯«ç§’æ•°ã€‚</span></span><br><span class="line"><span class="comment"># key ï¼š é˜Ÿåˆ—åã€‚</span></span><br><span class="line"><span class="comment"># ID ï¼š æ¶ˆæ¯ IDã€‚</span></span><br><span class="line">127.0.0.1:6379&gt; XREADGROUP GROUP consumer-group-name consumer-name COUNT 1 STREAMS mystreams &gt;</span><br><span class="line">1) 1) <span class="string">"mystreams"</span></span><br><span class="line">   2) 1) 1) <span class="string">"1640313276946-0"</span></span><br><span class="line">         2) 1) <span class="string">"Addr"</span></span><br><span class="line">            2) <span class="string">"ChongQing"</span></span><br><span class="line">127.0.0.1:6379&gt; XREADGROUP GROUP consumer-group-name consumer-name COUNT 1 STREAMS mystreams &gt;</span><br><span class="line">1) 1) <span class="string">"mystreams"</span></span><br><span class="line">   2) 1) 1) <span class="string">"1640313910204-0"</span></span><br><span class="line">         2) 1) <span class="string">"Name"</span></span><br><span class="line">            2) <span class="string">"WeiyiGeek"</span></span><br><span class="line">            3) <span class="string">"Age"</span></span><br><span class="line">            4) <span class="string">"25"</span></span><br><span class="line">            5) <span class="string">"Hobby"</span></span><br><span class="line">            6) <span class="string">"Computer"</span></span><br><span class="line">127.0.0.1:6379&gt; XREADGROUP GROUP consumer-group-name consumer-name COUNT 1 STREAMS mystreams &gt;</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="Redis-å®¢æˆ·ç«¯åº“åŸºæœ¬ä½¿ç”¨"><a href="#Redis-å®¢æˆ·ç«¯åº“åŸºæœ¬ä½¿ç”¨" class="headerlink" title="Redis å®¢æˆ·ç«¯åº“åŸºæœ¬ä½¿ç”¨"></a>Redis å®¢æˆ·ç«¯åº“åŸºæœ¬ä½¿ç”¨</h3><h4 id="Go-Redis-V8-åˆå§‹åŒ–è¿æ¥"><a href="#Go-Redis-V8-åˆå§‹åŒ–è¿æ¥" class="headerlink" title="Go-Redis V8 åˆå§‹åŒ–è¿æ¥"></a>Go-Redis V8 åˆå§‹åŒ–è¿æ¥</h4><p>æè¿°: æ­¤å¤„é‡‡ç”¨Go-Redis V8 ç‰ˆæœ¬, ä¸‹è¿°å°†å…¶å°è£…ä¸ºåŒ…ä»¥ä¾¿åç»­è°ƒç”¨ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// weiyigeek.top/studygo/Day09/MySQL/mypkg/initredis.go</span></span><br><span class="line"><span class="keyword">package</span> mypkg</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"context"</span></span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">  <span class="string">"github.com/go-redis/redis/v8"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">  RedisClient *redis.Client</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªRedisSingleObjç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> RedisSingleObj <span class="keyword">struct</span> &#123;</span><br><span class="line">  Redis_host <span class="keyword">string</span></span><br><span class="line">  Redis_port <span class="keyword">uint16</span></span><br><span class="line">  Redis_auth <span class="keyword">string</span></span><br><span class="line">  Database   <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æ„ä½“InitSingleRedisæ–¹æ³•: ç”¨äºåˆå§‹åŒ–redisæ•°æ®åº“</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RedisSingleObj)</span> <span class="title">InitSingleRedis</span><span class="params">()</span> <span class="params">(*redis.Client, error)</span></span> &#123;</span><br><span class="line">  <span class="comment">// Redisè¿æ¥æ ¼å¼æ‹¼æ¥</span></span><br><span class="line">  redisAddr := fmt.Sprintf(<span class="string">"%s:%d"</span>, r.Redis_host, r.Redis_port)</span><br><span class="line">  <span class="comment">// Redis è¿æ¥å¯¹è±¡: NewClientå°†å®¢æˆ·ç«¯è¿”å›åˆ°ç”±é€‰é¡¹æŒ‡å®šçš„RedisæœåŠ¡å™¨ã€‚</span></span><br><span class="line">  RedisClient = redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">    Addr:        redisAddr,    <span class="comment">// redisæœåŠ¡ip:port</span></span><br><span class="line">    Password:    r.Redis_auth, <span class="comment">// redisçš„è®¤è¯å¯†ç </span></span><br><span class="line">    DB:          r.Database,   <span class="comment">// è¿æ¥çš„databaseåº“</span></span><br><span class="line">    IdleTimeout: <span class="number">300</span>,          <span class="comment">// é»˜è®¤Idleè¶…æ—¶æ—¶é—´</span></span><br><span class="line">    PoolSize:    <span class="number">100</span>,          <span class="comment">// è¿æ¥æ± </span></span><br><span class="line">  &#125;)</span><br><span class="line">  fmt.Printf(<span class="string">"Connecting Redis : %v\n"</span>, redisAddr)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// go-redisåº“v8ç‰ˆæœ¬ç›¸å…³å‘½ä»¤éƒ½éœ€è¦ä¼ é€’context.Contextå‚æ•°,Background è¿”å›ä¸€ä¸ªéç©ºçš„Context,å®ƒæ°¸è¿œä¸ä¼šè¢«å–æ¶ˆï¼Œæ²¡æœ‰å€¼ï¼Œä¹Ÿæ²¡æœ‰æœŸé™ã€‚</span></span><br><span class="line">  ctx, cancel := context.WithTimeout(context.Background(), <span class="number">5</span>*time.Second)</span><br><span class="line">  <span class="keyword">defer</span> cancel()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// éªŒè¯æ˜¯å¦è¿æ¥åˆ°redisæœåŠ¡ç«¯</span></span><br><span class="line">  res, err := RedisClient.Ping(ctx).Result()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Connect Failed! Err: %v\n"</span>, err)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¾“å‡ºè¿æ¥æˆåŠŸæ ‡è¯†</span></span><br><span class="line">  fmt.Printf(<span class="string">"Connect Successful! \nPing =&gt; %v\n"</span>, res)</span><br><span class="line">  <span class="keyword">return</span> RedisClient, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>è°ƒç”¨æ¼”ç¤º:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"context"</span></span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">  <span class="string">"github.com/go-redis/redis/v8"</span></span><br><span class="line">  <span class="string">"weiyigeek.top/studygo/Day09/MySQL/mypkg"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€æ–°ç‰ˆæœ¬çš„go-redisåº“çš„ç›¸å…³å‘½ä»¤éƒ½éœ€è¦ä¼ é€’context.Contextå‚æ•°</span></span><br><span class="line"><span class="keyword">var</span> ctx = context.Background()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// å®ä¾‹åŒ–RedisSingleObjç»“æ„ä½“</span></span><br><span class="line">  conn := &amp;mypkg.RedisSingleObj&#123;</span><br><span class="line">    Redis_host: <span class="string">"10.20.172.248"</span>,</span><br><span class="line">    Redis_port: <span class="number">6379</span>,</span><br><span class="line">    Redis_auth: <span class="string">"weiyigeek.top"</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–è¿æ¥ Single Redis æœåŠ¡ç«¯</span></span><br><span class="line">  redisClient, err := conn.InitSingleRedis()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"[Error] - %v\n"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç¨‹åºæ‰§è¡Œå®Œæ¯•é‡Šæ”¾èµ„æº</span></span><br><span class="line">  <span class="keyword">defer</span> redisClient.Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="Redis-åŸºæœ¬æŒ‡ä»¤æ“ä½œç¤ºä¾‹"><a href="#Redis-åŸºæœ¬æŒ‡ä»¤æ“ä½œç¤ºä¾‹" class="headerlink" title="Redis åŸºæœ¬æŒ‡ä»¤æ“ä½œç¤ºä¾‹"></a>Redis åŸºæœ¬æŒ‡ä»¤æ“ä½œç¤ºä¾‹</h3><h4 id="å­—ç¬¦ä¸²-string-ç±»å‹æ“ä½œ"><a href="#å­—ç¬¦ä¸²-string-ç±»å‹æ“ä½œ" class="headerlink" title="å­—ç¬¦ä¸²(string)ç±»å‹æ“ä½œ"></a>å­—ç¬¦ä¸²(string)ç±»å‹æ“ä½œ</h4><p><strong>å¸¸ç”¨æ–¹æ³•:</strong></p>
<ul>
<li>Keys():æ ¹æ®æ­£åˆ™è·å–keys</li>
<li>Type():è·å–keyå¯¹åº”å€¼å¾—ç±»å‹</li>
<li>Del():åˆ é™¤ç¼“å­˜é¡¹</li>
<li>Exists():æ£€æµ‹ç¼“å­˜é¡¹æ˜¯å¦å­˜åœ¨</li>
<li>Expire(),ExpireAt():è®¾ç½®æœ‰æ•ˆæœŸ</li>
<li>TTL(),PTTL():è·å–æœ‰æ•ˆæœŸ</li>
<li>DBSize():æŸ¥çœ‹å½“å‰æ•°æ®åº“keyçš„æ•°é‡</li>
<li>FlushDB():æ¸…ç©ºå½“å‰æ•°æ®</li>
<li><p>FlushAll():æ¸…ç©ºæ‰€æœ‰æ•°æ®åº“</p>
</li>
<li><p>Set():è®¾ç½®é”®ç¼“å­˜</p>
</li>
<li>SetEX():è®¾ç½®å¹¶æŒ‡å®šè¿‡æœŸæ—¶é—´</li>
<li>SetNX():è®¾ç½®å¹¶æŒ‡å®šè¿‡æœŸæ—¶é—´,ä»…å½“keyä¸å­˜åœ¨çš„æ—¶å€™æ‰è®¾ç½®ã€‚</li>
<li>Get():è·å–é”®å€¼</li>
<li>GetRange():å­—ç¬¦ä¸²æˆªå–</li>
<li>Incr():å¢åŠ +1</li>
<li>IncrBy():æŒ‰æŒ‡å®šæ­¥é•¿å¢åŠ </li>
<li>Decr():å‡å°‘-1</li>
<li>DecrBy():æŒ‰æŒ‡å®šæ­¥é•¿å‡å°‘</li>
<li>Append():è¿½åŠ </li>
<li>StrLen():è·å–é•¿åº¦</li>
</ul>
<p><br/></p>
<p><strong>ç¤ºä¾‹1.redisæ•°æ®åº“ä¸­å­—ç¬¦ä¸²çš„setä¸getæ“ä½œå®è·µ.</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Redis String Set/Get ç¤ºä¾‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setGetExample</span><span class="params">(rdb *redis.Client, ctx context.Context)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1.Set è®¾ç½® key å¦‚æœè®¾ç½®ä¸º-1åˆ™è¡¨ç¤ºæ°¸ä¸è¿‡æœŸ</span></span><br><span class="line">  err := rdb.Set(ctx, <span class="string">"score"</span>, <span class="number">100</span>, <span class="number">60</span>*time.Second).Err()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"set score failed, err:%v\n"</span>, err)</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.Get è·å–å·²å­˜åœ¨çš„Keyå…¶å­˜å‚¨çš„å€¼</span></span><br><span class="line">  val1, err := rdb.Get(ctx, <span class="string">"score"</span>).Result() <span class="comment">// è·å–å…¶å€¼</span></span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"get score failed, err:%v\n"</span>, err)</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Printf(<span class="string">"val1 -&gt; score ï¼š%v\n"</span>, val1)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Get è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„å€¼è¿”å›redis.Nil åˆ™è¯´æ˜ä¸å­˜åœ¨</span></span><br><span class="line">  val2, err := rdb.Get(ctx, <span class="string">"name"</span>).Result()</span><br><span class="line">  <span class="keyword">if</span> err == redis.Nil &#123;</span><br><span class="line">    fmt.Println(<span class="string">"[ERROR] - Key [name] not exist"</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"get name failed, err:%v\n"</span>, err)</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Exists() æ–¹æ³•ç”¨äºæ£€æµ‹æŸä¸ªkeyæ˜¯å¦å­˜åœ¨</span></span><br><span class="line">  n, _ := rdb.Exists(ctx, <span class="string">"name"</span>).Result()</span><br><span class="line">  <span class="keyword">if</span> n &gt; <span class="number">0</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"name key å­˜åœ¨!"</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"name key ä¸å­˜åœ¨!"</span>)</span><br><span class="line">    rdb.Set(ctx, <span class="string">"name"</span>, <span class="string">"weiyi"</span>, <span class="number">60</span>*time.Second)</span><br><span class="line">  &#125;</span><br><span class="line">  val2, _ = rdb.Get(ctx, <span class="string">"name"</span>).Result()</span><br><span class="line">  fmt.Println(<span class="string">"val2 -&gt; name : "</span>, val2)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.SetNX å½“ä¸å­˜åœ¨keyæ—¶å°†è¿›è¡Œè®¾ç½®è¯¥å¯ä»¥å¹¶è®¾ç½®å…¶è¿‡æœŸæ—¶é—´</span></span><br><span class="line">  val3, err := rdb.SetNX(ctx, <span class="string">"username"</span>, <span class="string">"weiyigeek"</span>, <span class="number">0</span>).Result()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"set username failed, err:%v\n"</span>, err)</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Printf(<span class="string">"val3 -&gt; username: %v\n"</span>, val3)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4.Keys() æ ¹æ®æ­£åˆ™è·å–keys, DBSize() æŸ¥çœ‹å½“å‰æ•°æ®åº“keyçš„æ•°é‡.</span></span><br><span class="line">  keys, _ := rdb.Keys(ctx, <span class="string">"*"</span>).Result()</span><br><span class="line">  num, err := rdb.DBSize(ctx).Result()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Printf(<span class="string">"All Keys : %v, Keys number : %v \n"</span>, keys, num)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¹æ®å‰ç¼€è·å–Key</span></span><br><span class="line">  vals, _ := rdb.Keys(ctx, <span class="string">"user*"</span>).Result()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 5.Type() æ–¹æ³•ç”¨æˆ·è·å–ä¸€ä¸ªkeyå¯¹åº”å€¼çš„ç±»å‹</span></span><br><span class="line">  vType, err := rdb.Type(ctx, <span class="string">"username"</span>).Result()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Printf(<span class="string">"username key type : %v\n"</span>, vType)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 6.Expire()æ–¹æ³•æ˜¯è®¾ç½®æŸä¸ªæ—¶é—´æ®µ(time.Duration)åè¿‡æœŸï¼ŒExpireAt()æ–¹æ³•æ˜¯åœ¨æŸä¸ªæ—¶é—´ç‚¹(time.Time)è¿‡æœŸå¤±æ•ˆ.</span></span><br><span class="line">  val4, _ := rdb.Expire(ctx, <span class="string">"name"</span>, time.Minute*<span class="number">2</span>).Result()</span><br><span class="line">  <span class="keyword">if</span> val4 &#123;</span><br><span class="line">    fmt.Println(<span class="string">"name è¿‡æœŸæ—¶é—´è®¾ç½®æˆåŠŸ"</span>, val4)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"name è¿‡æœŸæ—¶é—´è®¾ç½®å¤±è´¥"</span>, val4)</span><br><span class="line">  &#125;</span><br><span class="line">  val5, _ := rdb.ExpireAt(ctx, <span class="string">"username"</span>, time.Now().Add(time.Minute*<span class="number">2</span>)).Result()</span><br><span class="line">  <span class="keyword">if</span> val5 &#123;</span><br><span class="line">    fmt.Println(<span class="string">"username è¿‡æœŸæ—¶é—´è®¾ç½®æˆåŠŸ"</span>, val5)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"username è¿‡æœŸæ—¶é—´è®¾ç½®å¤±è´¥"</span>, val5)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 7.TTL()ä¸PTTL()æ–¹æ³•å¯ä»¥è·å–æŸä¸ªé”®çš„å‰©ä½™æœ‰æ•ˆæœŸ</span></span><br><span class="line">  userTTL, _ := rdb.TTL(ctx, <span class="string">"user"</span>).Result() <span class="comment">// è·å–å…¶keyçš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line">  usernameTTL, _ := rdb.PTTL(ctx, <span class="string">"username"</span>).Result()</span><br><span class="line">  fmt.Printf(<span class="string">"user TTL : %v, username TTL : %v\n"</span>, userTTL, usernameTTL)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 8.Del():åˆ é™¤ç¼“å­˜é¡¹ä¸FlushDB():æ¸…ç©ºå½“å‰æ•°æ®</span></span><br><span class="line">  <span class="comment">// å½“é€šé…ç¬¦åŒ¹é…çš„keyçš„æ•°é‡ä¸å¤šæ—¶ï¼Œå¯ä»¥ä½¿ç”¨Keys()å¾—åˆ°æ‰€æœ‰çš„keyåœ¨ä½¿ç”¨Delå‘½ä»¤åˆ é™¤ã€‚</span></span><br><span class="line">  num, err = rdb.Del(ctx, <span class="string">"user"</span>, <span class="string">"username"</span>).Result()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(<span class="string">"Del() : "</span>, num)</span><br><span class="line">  <span class="comment">// å¦‚æœkeyçš„æ•°é‡éå¸¸å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æ­é…ä½¿ç”¨Scanå‘½ä»¤å’ŒDelå‘½ä»¤å®Œæˆåˆ é™¤ã€‚</span></span><br><span class="line">  iter := rdb.Scan(ctx, <span class="number">0</span>, <span class="string">"user*"</span>, <span class="number">0</span>).Iterator()</span><br><span class="line">  <span class="keyword">for</span> iter.Next(ctx) &#123;</span><br><span class="line">    err := rdb.Del(ctx, iter.Val()).Err()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> err := iter.Err(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 9.æ¸…ç©ºå½“å‰æ•°æ®åº“ï¼Œå› ä¸ºè¿æ¥çš„æ˜¯ç´¢å¼•ä¸º0çš„æ•°æ®åº“ï¼Œæ‰€ä»¥æ¸…ç©ºçš„å°±æ˜¯0å·æ•°æ®åº“</span></span><br><span class="line">  flag, err := rdb.FlushDB(ctx).Result()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(<span class="string">"FlushDB() : "</span>, flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main è°ƒç”¨</span></span><br><span class="line"><span class="comment">// String æ•°æ®ç±»å‹æ“ä½œ</span></span><br><span class="line">setGetExample(redisClient, ctx)</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// # Go execute</span></span><br><span class="line">Connecting Redis : <span class="number">10.20</span><span class="number">.172</span><span class="number">.248</span>:<span class="number">6379</span></span><br><span class="line">Connect Successful! </span><br><span class="line">Ping =&gt; PONG</span><br><span class="line">val1 -&gt; score ï¼š<span class="number">100</span></span><br><span class="line">[ERROR] - Key [name] not exist</span><br><span class="line">name key ä¸å­˜åœ¨!</span><br><span class="line">val2 -&gt; name :  weiyi</span><br><span class="line">val3 -&gt; username: <span class="literal">true</span></span><br><span class="line">All Keys : [name username score], Keys number : <span class="number">3</span> </span><br><span class="line">username key <span class="keyword">type</span> : <span class="keyword">string</span></span><br><span class="line">name è¿‡æœŸæ—¶é—´è®¾ç½®æˆåŠŸ <span class="literal">true</span></span><br><span class="line">username è¿‡æœŸæ—¶é—´è®¾ç½®æˆåŠŸ <span class="literal">true</span></span><br><span class="line">user TTL : <span class="number">-2</span>ns, username TTL : <span class="number">2</span>m1<span class="number">.679s</span></span><br><span class="line">Del() :  <span class="number">1</span></span><br><span class="line">FlushDB() :  OK</span><br><span class="line"></span><br><span class="line"><span class="comment">// # Redis-cli</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get score</span><br><span class="line"><span class="string">"100"</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get name</span><br><span class="line">(<span class="literal">nil</span>)</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get username</span><br><span class="line"><span class="string">"weiyigeek"</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; TTL username  <span class="comment">// ç”Ÿå­˜å‘¨æœŸ60s</span></span><br><span class="line">(integer) <span class="number">50</span></span><br><span class="line">........ </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; keys *   <span class="comment">// æ‰§è¡Œåå…¨éƒ¨keyä¸ºç©º</span></span><br><span class="line">(empty list or set)</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>ç¤ºä¾‹2.redisæ•°æ®åº“ä¸­å­—ç¬¦ä¸²ä¸æ•´å‹æ“ä½œå®è·µ.</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// stringIntExample æ•°æ®ç±»å‹æ¼”ç¤º</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">stringIntExample</span><span class="params">(rdb *redis.Client, ctx context.Context)</span></span> &#123;</span><br><span class="line">  <span class="comment">// è®¾ç½®å­—ç¬¦ä¸²ç±»å‹çš„key</span></span><br><span class="line">  err := rdb.Set(ctx, <span class="string">"hello"</span>, <span class="string">"Hello World!"</span>, <span class="number">0</span>).Err()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// GetRange ï¼š å­—ç¬¦ä¸²æˆªå–</span></span><br><span class="line">  <span class="comment">// æ³¨ï¼šå³ä½¿keyä¸å­˜åœ¨ï¼Œè°ƒç”¨GetRange()ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œåªæ˜¯è¿”å›çš„æˆªå–ç»“æœæ˜¯ç©º"",å¯ä»¥ä½¿ç”¨fmt.Printf("%q\n", val)æ¥æ‰“å°æµ‹è¯•</span></span><br><span class="line">  val1, _ := rdb.GetRange(ctx, <span class="string">"hello"</span>, <span class="number">1</span>, <span class="number">4</span>).Result()</span><br><span class="line">  fmt.Printf(<span class="string">"key: hello, value: %v\n"</span>, val1) <span class="comment">//æˆªå–åˆ°çš„å†…å®¹ä¸º: ello</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Append()è¡¨ç¤ºå¾€å­—ç¬¦ä¸²åé¢è¿½åŠ å…ƒç´ ï¼Œè¿”å›å€¼æ˜¯å­—ç¬¦ä¸²çš„æ€»é•¿åº¦</span></span><br><span class="line">  length1, _ := rdb.Append(ctx, <span class="string">"hello"</span>, <span class="string">" Go Programer"</span>).Result()</span><br><span class="line">  val2, _ := rdb.Get(ctx, <span class="string">"hello"</span>).Result()</span><br><span class="line">  fmt.Printf(<span class="string">"å½“å‰ç¼“å­˜keyçš„é•¿åº¦ä¸º: %vï¼Œå€¼: %v \n"</span>, length1, val2)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¾ç½®æ•´å½¢çš„key</span></span><br><span class="line">  err = rdb.SetNX(ctx, <span class="string">"number"</span>, <span class="number">1</span>, <span class="number">0</span>).Err()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Incr()ã€IncrBy()éƒ½æ˜¯æ“ä½œæ•°å­—ï¼Œå¯¹æ•°å­—è¿›è¡Œå¢åŠ çš„æ“ä½œ</span></span><br><span class="line">  <span class="comment">// Decr()ã€DecrBy()æ–¹æ³•æ˜¯å¯¹æ•°å­—è¿›è¡Œå‡çš„æ“ä½œï¼Œå’ŒIncræ­£å¥½ç›¸å</span></span><br><span class="line">  <span class="comment">// incræ˜¯æ‰§è¡ŒåŸå­åŠ 1æ“ä½œ</span></span><br><span class="line">  val3, _ := rdb.Incr(ctx, <span class="string">"number"</span>).Result()</span><br><span class="line">  fmt.Printf(<span class="string">"Incr -&gt; keyå½“å‰çš„å€¼ä¸º: %v\n"</span>, val3) <span class="comment">// 2</span></span><br><span class="line">  <span class="comment">// incrByæ˜¯å¢åŠ æŒ‡å®šçš„æ•°</span></span><br><span class="line">  val4, _ := rdb.IncrBy(ctx, <span class="string">"number"</span>, <span class="number">6</span>).Result()</span><br><span class="line">  fmt.Printf(<span class="string">"IncrBy -&gt; keyå½“å‰çš„å€¼ä¸º: %v\n"</span>, val4) <span class="comment">// 8</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// StrLen ä¹Ÿå¯ä»¥è¿”å›ç¼“å­˜keyçš„é•¿åº¦</span></span><br><span class="line">  length2, _ := rdb.StrLen(ctx, <span class="string">"number"</span>).Result()</span><br><span class="line">  fmt.Printf(<span class="string">"number å€¼é•¿åº¦: %v\n"</span>, length2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main å‡½æ•°ä¸­è°ƒç”¨</span></span><br><span class="line"><span class="comment">// å­—ç¬¦ä¸²æ•´å½¢æ•°æ®ç±»å‹</span></span><br><span class="line">stringIntExample(redisClient, ctx)</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># âœ demo6 go run .</span></span><br><span class="line">Connecting Redis : 10.20.172.248:6379</span><br><span class="line">Connect Successful! </span><br><span class="line">Ping =&gt; PONG</span><br><span class="line">key: hello, value: ello</span><br><span class="line">å½“å‰ç¼“å­˜keyçš„é•¿åº¦ä¸º: 25ï¼Œå€¼: Hello World! Go Programer </span><br><span class="line">Incr -&gt; keyå½“å‰çš„å€¼ä¸º: 9</span><br><span class="line">IncrBy -&gt; keyå½“å‰çš„å€¼ä¸º: 15</span><br><span class="line">number å€¼é•¿åº¦: 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">"hello"</span></span><br><span class="line">2) <span class="string">"number"</span></span><br><span class="line">127.0.0.1:6379&gt; get hello</span><br><span class="line"><span class="string">"Hello World! Go Promgram"</span></span><br><span class="line">127.0.0.1:6379&gt; get number</span><br><span class="line"><span class="string">"8"</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="åˆ—è¡¨-list-ç±»å‹æ“ä½œ"><a href="#åˆ—è¡¨-list-ç±»å‹æ“ä½œ" class="headerlink" title="åˆ—è¡¨(list)ç±»å‹æ“ä½œ"></a>åˆ—è¡¨(list)ç±»å‹æ“ä½œ</h4><p><strong>å¸¸ç”¨æ–¹æ³•:</strong></p>
<ul>
<li>LPush():å°†å…ƒç´ å‹å…¥é“¾è¡¨</li>
<li>LInsert():åœ¨æŸä¸ªä½ç½®æ’å…¥æ–°å…ƒç´ </li>
<li>LSet():è®¾ç½®æŸä¸ªå…ƒç´ çš„å€¼</li>
<li>LLen():è·å–é“¾è¡¨å…ƒç´ ä¸ªæ•°</li>
<li>LIndex():è·å–é“¾è¡¨ä¸‹æ ‡å¯¹åº”çš„å…ƒç´ </li>
<li>LRange():è·å–æŸä¸ªé€‰å®šèŒƒå›´çš„å…ƒç´ é›†</li>
<li>LPop()ä»é“¾è¡¨å·¦ä¾§å¼¹å‡ºæ•°æ®</li>
<li>LRem():æ ¹æ®å€¼ç§»é™¤å…ƒç´ </li>
</ul>
<p><br></p>
<p><strong>ç®€å•ç¤ºä¾‹</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">listExample</span><span class="params">(rdb *redis.Client, ctx context.Context)</span></span> &#123;</span><br><span class="line">  <span class="comment">// æ’å…¥æŒ‡å®šå€¼åˆ°liståˆ—è¡¨ä¸­ï¼Œè¿”å›å€¼æ˜¯å½“å‰åˆ—è¡¨å…ƒç´ çš„æ•°é‡</span></span><br><span class="line">  <span class="comment">// ä½¿ç”¨LPush()æ–¹æ³•å°†æ•°æ®ä»å·¦ä¾§å‹å…¥é“¾è¡¨ï¼ˆåè¿›å…ˆå‡ºï¼‰,ä¹Ÿå¯ä»¥ä»å³ä¾§å‹å¦‚é“¾è¡¨å¯¹åº”çš„æ–¹æ³•æ˜¯RPush()</span></span><br><span class="line">  count, _ := rdb.LPush(ctx, <span class="string">"list"</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>).Result()</span><br><span class="line">  fmt.Println(<span class="string">"æ’å…¥åˆ°listé›†åˆä¸­å…ƒç´ çš„æ•°é‡: "</span>, count)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// LInsert() åœ¨æŸä¸ªä½ç½®æ’å…¥æ–°å…ƒç´ </span></span><br><span class="line">  <span class="comment">// åœ¨åä¸ºkeyçš„ç¼“å­˜é¡¹å€¼ä¸º2çš„å…ƒç´ å‰é¢æ’å…¥ä¸€ä¸ªå€¼ï¼Œå€¼ä¸º123 ï¼Œ æ³¨æ„åªä¼šæ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">  _ = rdb.LInsert(ctx, <span class="string">"list"</span>, <span class="string">"before"</span>, <span class="string">"2"</span>, <span class="number">123</span>).Err()</span><br><span class="line">  <span class="comment">// åœ¨åä¸ºkeyçš„ç¼“å­˜é¡¹å€¼ä¸º2çš„å…ƒç´ åé¢æ’å…¥ä¸€ä¸ªå€¼ï¼Œå€¼ä¸º321</span></span><br><span class="line">  _ = rdb.LInsert(ctx, <span class="string">"list"</span>, <span class="string">"after"</span>, <span class="string">"2"</span>, <span class="number">321</span>).Err()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// LSet() è®¾ç½®æŸä¸ªå…ƒç´ çš„å€¼</span></span><br><span class="line">  <span class="comment">//ä¸‹æ ‡æ˜¯ä»0å¼€å§‹çš„</span></span><br><span class="line">  val1, _ := rdb.LSet(ctx, <span class="string">"list"</span>, <span class="number">2</span>, <span class="number">256</span>).Result()</span><br><span class="line">  fmt.Println(<span class="string">"æ˜¯å¦æˆåŠŸå°†ä¸‹æ ‡ä¸º2çš„å…ƒç´ å€¼æ”¹æˆ256: "</span>, val1)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// LLen() è·å–é“¾è¡¨å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">  length, _ := rdb.LLen(ctx, <span class="string">"list"</span>).Result()</span><br><span class="line">  fmt.Printf(<span class="string">"å½“å‰é“¾è¡¨çš„é•¿åº¦ä¸º: %v\n"</span>, length)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// LIndex() è·å–é“¾è¡¨ä¸‹æ ‡å¯¹åº”çš„å…ƒç´ </span></span><br><span class="line">  val2, _ := rdb.LIndex(ctx, <span class="string">"list"</span>, <span class="number">2</span>).Result()</span><br><span class="line">  fmt.Printf(<span class="string">"ä¸‹æ ‡ä¸º2çš„å€¼ä¸º: %v\n"</span>, val2)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä»é“¾è¡¨å·¦ä¾§å¼¹å‡ºæ•°æ®</span></span><br><span class="line">  val3, _ := rdb.LPop(ctx, <span class="string">"list"</span>).Result()</span><br><span class="line">  fmt.Printf(<span class="string">"å¼¹å‡ºä¸‹æ ‡ä¸º0çš„å€¼ä¸º: %v\n"</span>, val3)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// LRem() æ ¹æ®å€¼ç§»é™¤å…ƒç´  lrem key count value</span></span><br><span class="line">  n, _ := rdb.LRem(ctx, <span class="string">"list"</span>, <span class="number">2</span>, <span class="string">"256"</span>).Result()</span><br><span class="line">  fmt.Printf(<span class="string">"ç§»é™¤äº†: %v ä¸ª\n"</span>, n)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Connecting Redis : 10.20.172.248:6379</span><br><span class="line">Connect Successful! </span><br><span class="line">Ping =&gt; PONG</span><br><span class="line">æ’å…¥åˆ°listé›†åˆä¸­å…ƒç´ çš„æ•°é‡:  3</span><br><span class="line">æ˜¯å¦æˆåŠŸå°†ä¸‹æ ‡ä¸º2çš„å…ƒç´ å€¼æ”¹æˆ256:  OK</span><br><span class="line">å½“å‰é“¾è¡¨çš„é•¿åº¦ä¸º: 5</span><br><span class="line">ä¸‹æ ‡ä¸º2çš„å€¼ä¸º: 256</span><br><span class="line">å¼¹å‡ºä¸‹æ ‡ä¸º0çš„å€¼ä¸º: 3</span><br><span class="line">ç§»é™¤äº†: 1 ä¸ª</span><br><span class="line"></span><br><span class="line"><span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; keys lis*</span><br><span class="line">1) <span class="string">"list"</span></span><br><span class="line">127.0.0.1:6379&gt; LINDEX list 0</span><br><span class="line"><span class="string">"123"</span></span><br><span class="line">127.0.0.1:6379&gt; LPOP list</span><br><span class="line"><span class="string">"123"</span></span><br><span class="line">127.0.0.1:6379&gt; LLEN list</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="é›†åˆ-set-ç±»å‹æ“ä½œ"><a href="#é›†åˆ-set-ç±»å‹æ“ä½œ" class="headerlink" title="é›†åˆ(set)ç±»å‹æ“ä½œ"></a>é›†åˆ(set)ç±»å‹æ“ä½œ</h4><p>å¸¸ç”¨æ–¹æ³•:</p>
<ul>
<li>SAdd():æ·»åŠ å…ƒç´ </li>
<li>SPop():éšæœºè·å–ä¸€ä¸ªå…ƒç´ </li>
<li>SRem():åˆ é™¤é›†åˆé‡ŒæŒ‡å®šçš„å€¼</li>
<li>SSMembers():è·å–æ‰€æœ‰æˆå‘˜</li>
<li>SIsMember():åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­</li>
<li>SCard():è·å–é›†åˆå…ƒç´ ä¸ªæ•°</li>
<li>SUnion():å¹¶é›†,SDiff():å·®é›†,SInter():äº¤é›†</li>
</ul>
<p>Tipsï¼šé›†åˆæ•°æ®çš„ç‰¹å¾ï¼Œå…ƒç´ ä¸èƒ½é‡å¤ä¿æŒå”¯ä¸€æ€§, å…ƒç´ æ— åºä¸èƒ½ä½¿ç”¨ç´¢å¼•(ä¸‹æ ‡)æ“ä½œ</p>
<p><br></p>
<p><strong>ç®€å•ç¤ºä¾‹</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setExample</span><span class="params">(rdb *redis.Client, ctx context.Context)</span></span> &#123;</span><br><span class="line">  <span class="comment">// é›†åˆå…ƒç´ ç¼“å­˜è®¾ç½®</span></span><br><span class="line">  keyname := <span class="string">"Program"</span></span><br><span class="line">  mem := []<span class="keyword">string</span>&#123;<span class="string">"C"</span>, <span class="string">"Golang"</span>, <span class="string">"C++"</span>, <span class="string">"C#"</span>, <span class="string">"Java"</span>, <span class="string">"Delphi"</span>, <span class="string">"Python"</span>, <span class="string">"Golang"</span>&#125;</span><br><span class="line">  <span class="comment">// //ç”±äºGolangå·²ç»è¢«æ·»åŠ åˆ°Programé›†åˆä¸­ï¼Œæ‰€ä»¥é‡å¤æ·»åŠ æ—¶æ— æ•ˆçš„</span></span><br><span class="line">  <span class="keyword">for</span> _, v := <span class="keyword">range</span> mem &#123;</span><br><span class="line">    rdb.SAdd(ctx, keyname, v)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// SCard() è·å–é›†åˆå…ƒç´ ä¸ªæ•°</span></span><br><span class="line">  total, _ := rdb.SCard(ctx, keyname).Result()</span><br><span class="line">  fmt.Println(<span class="string">"golangé›†åˆæˆå‘˜ä¸ªæ•°: "</span>, total)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// SPop() éšæœºè·å–ä¸€ä¸ªå…ƒç´  ï¼ˆæ— åºæ€§ï¼Œæ˜¯éšæœºçš„ï¼‰</span></span><br><span class="line">  val1, _ := rdb.SPop(ctx, keyname).Result()</span><br><span class="line">  <span class="comment">// SPopN()  éšæœºè·å–å¤šä¸ªå…ƒç´ .</span></span><br><span class="line">  val2, _ := rdb.SPopN(ctx, keyname, <span class="number">2</span>).Result()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// SSMembers() è·å–æ‰€æœ‰æˆå‘˜</span></span><br><span class="line">  val3, _ := rdb.SMembers(ctx, keyname).Result()</span><br><span class="line">  fmt.Printf(<span class="string">"éšæœºè·å–ä¸€ä¸ªå…ƒç´ : %v , éšæœºè·å–å¤šä¸ªå…ƒç´ : %v \næ‰€æœ‰æˆå‘˜: %v\n"</span>, val1, val2, val3)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// SIsMember() åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­</span></span><br><span class="line">  exists, _ := rdb.SIsMember(ctx, keyname, <span class="string">"golang"</span>).Result()</span><br><span class="line">  <span class="keyword">if</span> exists &#123;</span><br><span class="line">    fmt.Println(<span class="string">"golang å­˜åœ¨ Program é›†åˆä¸­."</span>) <span class="comment">// æ³¨æ„:æˆ‘ä»¬å­˜å…¥çš„æ˜¯Golangè€Œégolang</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"golang ä¸å­˜åœ¨ Program é›†åˆä¸­."</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// SUnion():å¹¶é›†, SDiff():å·®é›†, SInter():äº¤é›†</span></span><br><span class="line">  rdb.SAdd(ctx, <span class="string">"setA"</span>, <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>)</span><br><span class="line">  rdb.SAdd(ctx, <span class="string">"setB"</span>, <span class="string">"a"</span>, <span class="string">"d"</span>, <span class="string">"e"</span>, <span class="string">"f"</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//å¹¶é›†</span></span><br><span class="line">  union, _ := rdb.SUnion(ctx, <span class="string">"setA"</span>, <span class="string">"setB"</span>).Result()</span><br><span class="line">  fmt.Println(<span class="string">"å¹¶é›†"</span>, union)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//å·®é›†</span></span><br><span class="line">  diff, _ := rdb.SDiff(ctx, <span class="string">"setA"</span>, <span class="string">"setB"</span>).Result()</span><br><span class="line">  fmt.Println(<span class="string">"å·®é›†"</span>, diff)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//äº¤é›†</span></span><br><span class="line">  inter, _ := rdb.SInter(ctx, <span class="string">"setA"</span>, <span class="string">"setB"</span>).Result()</span><br><span class="line">  fmt.Println(<span class="string">"äº¤é›†"</span>, inter)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ é™¤é›†åˆä¸­æŒ‡å®šå…ƒç´ (è¿”å›æˆåŠŸ)</span></span><br><span class="line">  n, _ := rdb.SRem(ctx, <span class="string">"setB"</span>, <span class="string">"a"</span>, <span class="string">"f"</span>).Result()</span><br><span class="line">  fmt.Println(<span class="string">"å·²æˆåŠŸåˆ é™¤å…ƒç´ çš„ä¸ªæ•°: "</span>,n)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Connecting Redis : 10.20.172.248:6379</span><br><span class="line">Connect Successful! </span><br><span class="line">Ping =&gt; PONG</span><br><span class="line">golangé›†åˆæˆå‘˜ä¸ªæ•°:  7</span><br><span class="line">éšæœºè·å–ä¸€ä¸ªå…ƒç´ : Java , éšæœºè·å–å¤šä¸ªå…ƒç´ : [Golang C++] </span><br><span class="line">æ‰€æœ‰æˆå‘˜: [C Python C<span class="comment"># Delphi]</span></span><br><span class="line">golang ä¸å­˜åœ¨ Program é›†åˆä¸­.</span><br><span class="line">å¹¶é›† [a d c e f b]</span><br><span class="line">å·®é›† [c b]</span><br><span class="line">äº¤é›† [a d]</span><br><span class="line">å·²æˆåŠŸåˆ é™¤å…ƒç´ çš„ä¸ªæ•°: 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; keys Prog*</span><br><span class="line">1) <span class="string">"Program"</span></span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER Program</span><br><span class="line"><span class="string">"Python"</span></span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER Program</span><br><span class="line"><span class="string">"Delphi"</span></span><br><span class="line">127.0.0.1:6379&gt; SCARD Program</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="æœ‰åºé›†åˆ-zset-ç±»å‹æ“ä½œ"><a href="#æœ‰åºé›†åˆ-zset-ç±»å‹æ“ä½œ" class="headerlink" title="æœ‰åºé›†åˆ(zset)ç±»å‹æ“ä½œ"></a>æœ‰åºé›†åˆ(zset)ç±»å‹æ“ä½œ</h4><p>å¸¸ç”¨æ–¹æ³•:</p>
<ul>
<li>ZAdd():æ·»åŠ å…ƒç´ </li>
<li>ZIncrBy():å¢åŠ å…ƒç´ åˆ†å€¼</li>
<li>ZRange()ã€ZRevRange():è·å–æ ¹æ®scoreæ’åºåçš„æ•°æ®æ®µ</li>
<li>ZRangeByScore()ã€ZRevRangeByScore():è·å–scoreè¿‡æ»¤åæ’åºçš„æ•°æ®æ®µ</li>
<li>ZCard():è·å–å…ƒç´ ä¸ªæ•°</li>
<li>ZCount():è·å–åŒºé—´å†…å…ƒç´ ä¸ªæ•°</li>
<li>ZScore():è·å–å…ƒç´ çš„score</li>
<li>ZRank()ã€ZRevRank():è·å–æŸä¸ªå…ƒç´ åœ¨é›†åˆä¸­çš„æ’å</li>
<li>ZRem():åˆ é™¤å…ƒç´ </li>
<li>ZRemRangeByRank():æ ¹æ®æ’åæ¥åˆ é™¤</li>
<li>ZRemRangeByScore():æ ¹æ®åˆ†å€¼åŒºé—´æ¥åˆ é™¤</li>
</ul>
<p><br/></p>
<p><strong>ç®€å•ç¤ºä¾‹:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">zsetExample</span><span class="params">(rdb *redis.Client, ctx context.Context)</span></span> &#123;</span><br><span class="line">  <span class="comment">// æœ‰åºé›†åˆæˆå‘˜ä¸åˆ†æ•°è®¾ç½®</span></span><br><span class="line">  <span class="comment">// zSetç±»å‹éœ€è¦ä½¿ç”¨ç‰¹å®šçš„ç±»å‹å€¼*redis.Zï¼Œä»¥ä¾¿ä½œä¸ºæ’åºä½¿ç”¨</span></span><br><span class="line">  lang := []*redis.Z&#123;</span><br><span class="line">    &amp;redis.Z&#123;Score: <span class="number">90.0</span>, Member: <span class="string">"Golang"</span>&#125;,</span><br><span class="line">    &amp;redis.Z&#123;Score: <span class="number">98.0</span>, Member: <span class="string">"Java"</span>&#125;,</span><br><span class="line">    &amp;redis.Z&#123;Score: <span class="number">95.0</span>, Member: <span class="string">"Python"</span>&#125;,</span><br><span class="line">    &amp;redis.Z&#123;Score: <span class="number">97.0</span>, Member: <span class="string">"JavaScript"</span>&#125;,</span><br><span class="line">    &amp;redis.Z&#123;Score: <span class="number">99.0</span>, Member: <span class="string">"C/C++"</span>&#125;,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//æ’å…¥ZSetç±»å‹</span></span><br><span class="line">  num, err := rdb.ZAdd(ctx, <span class="string">"language_rank"</span>, lang...).Result()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"zadd failed, err:%v\n"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Printf(<span class="string">"zadd %d succ.\n"</span>, num)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†ZSetä¸­çš„æŸä¸€ä¸ªå…ƒç´ é¡ºåºå€¼å¢åŠ : æŠŠGolangçš„åˆ†æ•°åŠ 10</span></span><br><span class="line">  newScore, err := rdb.ZIncrBy(ctx, <span class="string">"language_rank"</span>, <span class="number">10.0</span>, <span class="string">"Golang"</span>).Result()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"zincrby failed, err:%v\n"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Printf(<span class="string">"Golang's score is %f now.\n"</span>, newScore)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¹æ®åˆ†æ•°æ’åå–å‡ºå…ƒç´ :å–åˆ†æ•°æœ€é«˜çš„3ä¸ª</span></span><br><span class="line">  ret, err := rdb.ZRevRangeWithScores(ctx, <span class="string">"language_rank"</span>, <span class="number">0</span>, <span class="number">2</span>).Result()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"zrevrange failed, err:%v\n"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Printf(<span class="string">"zsetKeyå‰3åçƒ­åº¦çš„æ˜¯: %v\n,Top 3 çš„ Memeber ä¸ Score æ˜¯:\n"</span>, ret)</span><br><span class="line">  <span class="keyword">for</span> _, z := <span class="keyword">range</span> ret &#123;</span><br><span class="line">    fmt.Println(z.Member, z.Score)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ZRangeByScore()ã€ZRevRangeByScore():è·å–scoreè¿‡æ»¤åæ’åºçš„æ•°æ®æ®µ</span></span><br><span class="line">  <span class="comment">// æ­¤å¤„è¡¨ç¤ºå–95~100åˆ†çš„</span></span><br><span class="line">  op := redis.ZRangeBy&#123;</span><br><span class="line">    Min: <span class="string">"95"</span>,</span><br><span class="line">    Max: <span class="string">"100"</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  ret, err = rdb.ZRangeByScoreWithScores(ctx, <span class="string">"language_rank"</span>, &amp;op).Result()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"zrangebyscore failed, err:%v\n"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è¾“å‡ºå…¨éƒ¨æˆå‘˜åŠå…¶scoreåˆ†æ•°</span></span><br><span class="line">  fmt.Println(<span class="string">"language_rank é”®å­˜å‚¨çš„å…¨éƒ¨å…ƒç´ :"</span>)</span><br><span class="line">  <span class="keyword">for</span> _, z := <span class="keyword">range</span> ret &#123;</span><br><span class="line">    fmt.Println(z.Member, z.Score)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># go run .</span></span><br><span class="line">Connecting Redis : 10.20.172.248:6379</span><br><span class="line">Connect Successful! </span><br><span class="line">Ping =&gt; PONG</span><br><span class="line">zadd 0 succ.</span><br><span class="line">Golang\<span class="string">'s score is 100.000000 now.</span></span><br><span class="line"><span class="string">zsetKeyå‰3åçƒ­åº¦çš„æ˜¯: [&#123;100 Golang&#125; &#123;99 C/C++&#125; &#123;98 Java&#125;]</span></span><br><span class="line"><span class="string">,Top 3 çš„ Memeber ä¸ Score æ˜¯:</span></span><br><span class="line"><span class="string">Golang 100</span></span><br><span class="line"><span class="string">C/C++ 99</span></span><br><span class="line"><span class="string">Java 98</span></span><br><span class="line"><span class="string">language_rank é”®å­˜å‚¨çš„å…¨éƒ¨å…ƒç´ :</span></span><br><span class="line"><span class="string">Python 95</span></span><br><span class="line"><span class="string">JavaScript 97</span></span><br><span class="line"><span class="string">Java 98</span></span><br><span class="line"><span class="string">C/C++ 99</span></span><br><span class="line"><span class="string">Golang 100</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># redis-cli</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; keys language_rank*</span></span><br><span class="line"><span class="string">1) "language_rank"</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; keys language_rank*</span></span><br><span class="line"><span class="string">1) "language_rank"</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; ZCARD language_rank</span></span><br><span class="line"><span class="string">(integer) 5</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; ZRANGE language_rank 1 3  # 1-3 ç´¢å¼•çš„æˆå‘˜åç§°</span></span><br><span class="line"><span class="string">1) "JavaScript"</span></span><br><span class="line"><span class="string">2) "Java"</span></span><br><span class="line"><span class="string">3) "C/C++"</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; ZRANGEBYSCORE language_rank 99 100 WITHSCORES</span></span><br><span class="line"><span class="string">1) "C/C++"</span></span><br><span class="line"><span class="string">2) "99"</span></span><br><span class="line"><span class="string">3) "Golang"</span></span><br><span class="line"><span class="string">4) "100"</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="å“ˆå¸Œ-hash-ç±»å‹æ“ä½œ"><a href="#å“ˆå¸Œ-hash-ç±»å‹æ“ä½œ" class="headerlink" title="å“ˆå¸Œ(hash)ç±»å‹æ“ä½œ"></a>å“ˆå¸Œ(hash)ç±»å‹æ“ä½œ</h4><p>å¸¸ç”¨æ–¹æ³•:</p>
<ul>
<li>HSet():è®¾ç½®</li>
<li>HMset():æ‰¹é‡è®¾ç½®</li>
<li>HGet():è·å–æŸä¸ªå…ƒç´ </li>
<li>HGetAll():è·å–å…¨éƒ¨å…ƒç´ </li>
<li>HDel():åˆ é™¤æŸä¸ªå…ƒç´ </li>
<li>HExists():åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</li>
<li>HLen():è·å–é•¿åº¦</li>
</ul>
<p><br></p>
<p><strong>ç®€å•ç¤ºä¾‹:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hash æ˜¯ä¸€ä¸ª string ç±»å‹çš„ fieldï¼ˆå­—æ®µï¼‰ å’Œ valueï¼ˆå€¼ï¼‰ çš„æ˜ å°„è¡¨ï¼Œhash ç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hashExample</span><span class="params">(rdb *redis.Client, ctx context.Context)</span></span> &#123;</span><br><span class="line">  <span class="comment">// (1) HSet() è®¾ç½®å­—æ®µå’Œå€¼</span></span><br><span class="line">  rdb.HSet(ctx, <span class="string">"huser"</span>, <span class="string">"key1"</span>, <span class="string">"value1"</span>, <span class="string">"key2"</span>, <span class="string">"value2"</span>)</span><br><span class="line">  rdb.HSet(ctx, <span class="string">"huser"</span>, []<span class="keyword">string</span>&#123;<span class="string">"key3"</span>, <span class="string">"value3"</span>, <span class="string">"key4"</span>, <span class="string">"value4"</span>&#125;)</span><br><span class="line">  rdb.HSet(ctx, <span class="string">"huser"</span>, <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;<span class="string">"key5"</span>: <span class="string">"value5"</span>, <span class="string">"key6"</span>: <span class="string">"value6"</span>&#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (2) HMset():æ‰¹é‡è®¾ç½®</span></span><br><span class="line">  rdb.HMSet(ctx, <span class="string">"hmuser"</span>, <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;<span class="string">"name"</span>: <span class="string">"WeiyiGeek"</span>, <span class="string">"age"</span>: <span class="number">88</span>, <span class="string">"address"</span>: <span class="string">"é‡åº†"</span>&#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (3) HGet() è·å–æŸä¸ªå…ƒç´ </span></span><br><span class="line">  address, _ := rdb.HGet(ctx, <span class="string">"hmuser"</span>, <span class="string">"address"</span>).Result()</span><br><span class="line">  fmt.Println(<span class="string">"hmuser.address -&gt; "</span>, address)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (4) HGetAll() è·å–å…¨éƒ¨å…ƒç´ </span></span><br><span class="line">  hmuser, _ := rdb.HGetAll(ctx, <span class="string">"hmuser"</span>).Result()</span><br><span class="line">  fmt.Println(<span class="string">"hmuser :=&gt; "</span>, hmuser)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (5) HExists åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">  flag, _ := rdb.HExists(ctx, <span class="string">"hmuser"</span>, <span class="string">"address"</span>).Result()</span><br><span class="line">  fmt.Println(<span class="string">"address æ˜¯å¦å­˜åœ¨ hmuser ä¸­: "</span>, flag)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (6) HLen() è·å–é•¿åº¦</span></span><br><span class="line">  length, _ := rdb.HLen(ctx, <span class="string">"hmuser"</span>).Result()</span><br><span class="line">  fmt.Println(<span class="string">"hmuser hash é”®é•¿åº¦: "</span>, length)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (7) HDel() æ”¯æŒä¸€æ¬¡åˆ é™¤å¤šä¸ªå…ƒç´ </span></span><br><span class="line">  count, _ := rdb.HDel(ctx, <span class="string">"huser"</span>, <span class="string">"key3"</span>, <span class="string">"key4"</span>).Result()</span><br><span class="line">  fmt.Println(<span class="string">"åˆ é™¤å…ƒç´ çš„ä¸ªæ•°: "</span>, count)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Connecting Redis : 10.20.172.248:6379</span><br><span class="line">Connect Successful! </span><br><span class="line">Ping =&gt; PONG</span><br><span class="line">hmuser.address -&gt;  é‡åº†</span><br><span class="line">hmuser :=&gt;  map[address:é‡åº† age:88 name:WeiyiGeek]</span><br><span class="line">address æ˜¯å¦å­˜åœ¨ hmuser ä¸­: <span class="literal">true</span></span><br><span class="line">hmuser <span class="built_in">hash</span> é”®é•¿åº¦: 3</span><br><span class="line">åˆ é™¤å…ƒç´ çš„ä¸ªæ•°: 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; keys *user</span><br><span class="line">1) <span class="string">"hmuser"</span></span><br><span class="line">2) <span class="string">"huser"</span></span><br><span class="line">127.0.0.1:6379&gt; HGETALL huser</span><br><span class="line">1) <span class="string">"key1"</span></span><br><span class="line">2) <span class="string">"value1"</span></span><br><span class="line">3) <span class="string">"key2"</span></span><br><span class="line">4) <span class="string">"value2"</span></span><br><span class="line">5) <span class="string">"key6"</span></span><br><span class="line">6) <span class="string">"value6"</span></span><br><span class="line">7) <span class="string">"key5"</span></span><br><span class="line">8) <span class="string">"value5"</span></span><br><span class="line">127.0.0.1:6379&gt; HGET hmuser name</span><br><span class="line"><span class="string">"WeiyiGeek"</span></span><br><span class="line">127.0.0.1:6379&gt; HLEN hmuser</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="åŸºæ•°ç»Ÿè®¡-HyperLogLog-ç±»å‹æ“ä½œ"><a href="#åŸºæ•°ç»Ÿè®¡-HyperLogLog-ç±»å‹æ“ä½œ" class="headerlink" title="åŸºæ•°ç»Ÿè®¡ HyperLogLog ç±»å‹æ“ä½œ"></a>åŸºæ•°ç»Ÿè®¡ HyperLogLog ç±»å‹æ“ä½œ</h4><p>æè¿°: ç”¨æ¥åšåŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ï¼ŒHyperLogLog çš„ä¼˜ç‚¹æ˜¯ï¼Œåœ¨è¾“å…¥å…ƒç´ çš„æ•°é‡æˆ–è€…ä½“ç§¯éå¸¸éå¸¸å¤§æ—¶ï¼Œè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ€»æ˜¯å›ºå®š çš„ã€å¹¶ä¸”æ˜¯å¾ˆå°çš„ã€‚</p>
<p>Tips: æ¯ä¸ª HyperLogLog é”®åªéœ€è¦èŠ±è´¹ 12 KB å†…å­˜ï¼Œå°±å¯ä»¥è®¡ç®—æ¥è¿‘ 2^64 ä¸ªä¸åŒå…ƒç´ çš„åŸºæ•°.</p>
<p><strong>ç¤ºä¾‹ä»£ç :</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hyperLogLogExample</span><span class="params">(rdb *redis.Client, ctx context.Context)</span></span> &#123;</span><br><span class="line">  log.Println(<span class="string">"Start ExampleClient_HyperLogLog"</span>)</span><br><span class="line">  <span class="keyword">defer</span> log.Println(<span class="string">"End ExampleClient_HyperLogLog"</span>)</span><br><span class="line">  <span class="comment">//  è®¾ç½® HyperLogLog ç±»å‹çš„é”®  pf_test_1</span></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">    rdb.PFAdd(ctx, <span class="string">"pf_test_1"</span>, fmt.Sprintf(<span class="string">"pf1key%d"</span>, i))</span><br><span class="line">  &#125;</span><br><span class="line">  ret, err := rdb.PFCount(ctx, <span class="string">"pf_test_1"</span>).Result()</span><br><span class="line">  log.Println(ret, err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  è®¾ç½® HyperLogLog ç±»å‹çš„é”®  pf_test_2</span></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">    rdb.PFAdd(ctx, <span class="string">"pf_test_2"</span>, fmt.Sprintf(<span class="string">"pf2key%d"</span>, i))</span><br><span class="line">  &#125;</span><br><span class="line">  ret, err = rdb.PFCount(ctx, <span class="string">"pf_test_2"</span>).Result()</span><br><span class="line">  log.Println(ret, err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  åˆå¹¶ä¸¤ä¸ª HyperLogLog ç±»å‹çš„é”®  pf_test_1 + pf_test_1</span></span><br><span class="line">  rdb.PFMerge(ctx, <span class="string">"pf_test"</span>, <span class="string">"pf_test_2"</span>, <span class="string">"pf_test_1"</span>)</span><br><span class="line">  ret, err = rdb.PFCount(ctx, <span class="string">"pf_test"</span>).Result()</span><br><span class="line">  log.Println(ret, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>æ‰§è¡Œç»“æœ:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Connecting Redis : 10.20.172.248:6379</span><br><span class="line">Connect Successful! </span><br><span class="line">Ping =&gt; PONG</span><br><span class="line">2021/12/27 09:26:11 Start ExampleClient_HyperLogLog</span><br><span class="line">2021/12/27 09:26:11 5 &lt;nil&gt;</span><br><span class="line">2021/12/27 09:26:11 10 &lt;nil&gt;</span><br><span class="line">2021/12/27 09:26:11 15 &lt;nil&gt;</span><br><span class="line">2021/12/27 09:26:11 End ExampleClient_HyperLogLog</span><br><span class="line"></span><br><span class="line"><span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; keys  pf_test*</span><br><span class="line">1) <span class="string">"pf_test"</span></span><br><span class="line">2) <span class="string">"pf_test_2"</span></span><br><span class="line">3) <span class="string">"pf_test_1"</span></span><br><span class="line">127.0.0.1:6379&gt; PFCOUNT pf_test</span><br><span class="line">(<span class="built_in">integer</span>) 15</span><br><span class="line">127.0.0.1:6379&gt; PFCOUNT pf_test_1</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="è‡ªå®šä¹‰redisæŒ‡ä»¤æ“ä½œ"><a href="#è‡ªå®šä¹‰redisæŒ‡ä»¤æ“ä½œ" class="headerlink" title="è‡ªå®šä¹‰redisæŒ‡ä»¤æ“ä½œ"></a>è‡ªå®šä¹‰redisæŒ‡ä»¤æ“ä½œ</h4><p>æè¿°: æˆ‘ä»¬å¯ä»¥é‡‡ç”¨go-redisæä¾›çš„Doæ–¹æ³•ï¼Œå¯ä»¥è®©æˆ‘ä»¬ç›´æ¥æ‰§è¡Œredis-cliä¸­æ‰§è¡Œçš„ç›¸å…³æŒ‡ä»¤, å¯ä»¥æå¤§çš„ä¾¿äºä½¿ç”¨è€…ä¸Šæ‰‹ã€‚</p>
<p><strong>ç®€å•ç¤ºä¾‹:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ExampleClient_CMD</span><span class="params">(rdb *redis.Client, ctx context.Context)</span></span> &#123;</span><br><span class="line">  log.Println(<span class="string">"Start ExampleClient_CMD"</span>)</span><br><span class="line">  <span class="keyword">defer</span> log.Println(<span class="string">"End ExampleClient_CMD"</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1.æ‰§è¡ŒredisæŒ‡ä»¤ Set è®¾ç½®ç¼“å­˜</span></span><br><span class="line">  v := rdb.Do(ctx, <span class="string">"set"</span>, <span class="string">"NewStringCmd"</span>, <span class="string">"redis-cli"</span>).String()</span><br><span class="line">  log.Println(<span class="string">"&gt;"</span>, v)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.æ‰§è¡ŒredisæŒ‡ä»¤ Get è®¾ç½®ç¼“å­˜</span></span><br><span class="line">  v = rdb.Do(ctx, <span class="string">"get"</span>, <span class="string">"NewStringCmd"</span>).String()</span><br><span class="line">  log.Println(<span class="string">"Method1 &gt;"</span>, v)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.åŒ¿åæ–¹å¼æ‰§è¡Œè‡ªå®šä¹‰rediså‘½ä»¤</span></span><br><span class="line">  <span class="comment">// Set</span></span><br><span class="line">  Set := <span class="function"><span class="keyword">func</span><span class="params">(client *redis.Client, ctx context.Context, key, value <span class="keyword">string</span>)</span> *<span class="title">redis</span>.<span class="title">StringCmd</span></span> &#123;</span><br><span class="line">    cmd := redis.NewStringCmd(ctx, <span class="string">"set"</span>, key, value) <span class="comment">// å…³é”®ç‚¹</span></span><br><span class="line">    client.Process(ctx, cmd)</span><br><span class="line">    <span class="keyword">return</span> cmd</span><br><span class="line">  &#125;</span><br><span class="line">  v, _ = Set(rdb, ctx, <span class="string">"NewCmd"</span>, <span class="string">"go-redis"</span>).Result()</span><br><span class="line">  log.Println(<span class="string">"&gt; set NewCmd go-redis:"</span>, v)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Get</span></span><br><span class="line">  Get := <span class="function"><span class="keyword">func</span><span class="params">(client *redis.Client, ctx context.Context, key <span class="keyword">string</span>)</span> *<span class="title">redis</span>.<span class="title">StringCmd</span></span> &#123;</span><br><span class="line">    cmd := redis.NewStringCmd(ctx, <span class="string">"get"</span>, key) <span class="comment">// å…³é”®ç‚¹</span></span><br><span class="line">    client.Process(ctx, cmd)</span><br><span class="line">    <span class="keyword">return</span> cmd</span><br><span class="line">  &#125;</span><br><span class="line">  v, _ = Get(rdb, ctx, <span class="string">"NewCmd"</span>).Result()</span><br><span class="line">  log.Println(<span class="string">"Method2 &gt; get NewCmd:"</span>, v)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4.æ‰§è¡ŒredisæŒ‡ä»¤ hset è®¾ç½®å“ˆå¸Œç¼“å­˜ (å®è·µä»¥ä¸‹æ–¹å¼ä¸è¡Œ)</span></span><br><span class="line">  <span class="comment">// kv := map[string]interface&#123;&#125;&#123;"key5": "value5", "key6": "value6"&#125;</span></span><br><span class="line">  <span class="comment">// v, _ = rdb.Do(ctx, "hmset", "NewHashCmd", kv)</span></span><br><span class="line">  <span class="comment">// log.Println("&gt; ", v)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>æ‰§è¡Œç»“æœ:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Connecting Redis : 10.20.172.248:6379</span><br><span class="line">Connect Successful! </span><br><span class="line">Ping =&gt; PONG</span><br><span class="line">2021/12/27 12:11:43 Start ExampleClient_CMD</span><br><span class="line">2021/12/27 12:11:43 &gt; <span class="built_in">set</span> NewStringCmd redis-cli: OK</span><br><span class="line">2021/12/27 12:11:43 Method1 &gt; get NewStringCmd: redis-cli</span><br><span class="line">2021/12/27 12:11:43 &gt; <span class="built_in">set</span> NewCmd go-redis: OK</span><br><span class="line">2021/12/27 12:11:43 Method2 &gt; get NewCmd: go-redis</span><br><span class="line">2021/12/27 12:11:43 End ExampleClient_CMD</span><br><span class="line"></span><br><span class="line"><span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; keys New*</span><br><span class="line">1) <span class="string">"NewCmd"</span></span><br><span class="line">2) <span class="string">"NewStringCmd"</span></span><br><span class="line">127.0.0.1:6379&gt; get NewCmd</span><br><span class="line"><span class="string">"go-redis"</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><br></p>
<h4 id="Redis-Pipeline-é€šé“æ“ä½œ"><a href="#Redis-Pipeline-é€šé“æ“ä½œ" class="headerlink" title="Redis Pipeline é€šé“æ“ä½œ"></a>Redis Pipeline é€šé“æ“ä½œ</h4><p>æè¿°: Pipeline ä¸»è¦æ˜¯ä¸€ç§ç½‘ç»œä¼˜åŒ–,å®ƒæœ¬è´¨ä¸Šæ„å‘³ç€å®¢æˆ·ç«¯ç¼“å†²ä¸€å †å‘½ä»¤å¹¶ä¸€æ¬¡æ€§å°†å®ƒä»¬å‘é€åˆ°æœåŠ¡å™¨ã€‚è¿™äº›å‘½ä»¤ä¸èƒ½ä¿è¯åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯èŠ‚çœäº†æ¯ä¸ªå‘½ä»¤çš„ç½‘ç»œå¾€è¿”æ—¶é—´ï¼ˆRTTï¼‰ã€‚</p>
<p>Pipeline åŸºæœ¬ç¤ºä¾‹å¦‚ä¸‹ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pipe := rdb.Pipeline()</span><br><span class="line"></span><br><span class="line">incr := pipe.Incr(<span class="string">"pipeline_counter"</span>)</span><br><span class="line">pipe.Expire(<span class="string">"pipeline_counter"</span>, time.Hour)</span><br><span class="line"></span><br><span class="line">_, err := pipe.Exec()</span><br><span class="line">fmt.Println(incr.Val(), err)</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>ä¸Šé¢çš„ä»£ç ç›¸å½“äºå°†ä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤ä¸€æ¬¡å‘ç»™<code>redis server</code>ç«¯æ‰§è¡Œä¸ä¸ä½¿ç”¨Pipelineç›¸æ¯”èƒ½å‡å°‘ä¸€æ¬¡RTTã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INCR pipeline_counter</span><br><span class="line">EXPIRE pipeline_counts <span class="number">3600</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨Pipelined:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> incr *redis.IntCmd</span><br><span class="line">_, err := rdb.Pipelined(<span class="function"><span class="keyword">func</span><span class="params">(pipe redis.Pipeliner)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">  incr = pipe.Incr(<span class="string">"pipelined_counter"</span>)</span><br><span class="line">  pipe.Expire(<span class="string">"pipelined_counter"</span>, time.Hour)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;)</span><br><span class="line">fmt.Println(incr.Val(), err)</span><br></pre></td></tr></table></figure></p>
<p>æ‰€ä»¥åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå½“æˆ‘ä»¬æœ‰å¤šæ¡å‘½ä»¤è¦æ‰§è¡Œæ—¶ï¼Œå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨pipelineæ¥ä¼˜åŒ–redisç¼“å†²æ•ˆç‡ã€‚</p>
<p><br/></p>
<h4 id="MULTI-EXEC-äº‹åŠ¡å¤„ç†æ“ä½œ"><a href="#MULTI-EXEC-äº‹åŠ¡å¤„ç†æ“ä½œ" class="headerlink" title="MULTI/EXEC äº‹åŠ¡å¤„ç†æ“ä½œ"></a>MULTI/EXEC äº‹åŠ¡å¤„ç†æ“ä½œ</h4><p>æè¿°: Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œå› æ­¤å•ä¸ªå‘½ä»¤å§‹ç»ˆæ˜¯åŸå­çš„ï¼Œä½†æ˜¯æ¥è‡ªä¸åŒå®¢æˆ·ç«¯çš„ä¸¤ä¸ªç»™å®šå‘½ä»¤å¯ä»¥ä¾æ¬¡æ‰§è¡Œï¼Œä¾‹å¦‚åœ¨å®ƒä»¬ä¹‹é—´äº¤æ›¿æ‰§è¡Œã€‚ä½†æ˜¯<code>Multi/exec</code>èƒ½å¤Ÿç¡®ä¿åœ¨å…¶ä¸¤ä¸ªè¯­å¥ä¹‹é—´çš„å‘½ä»¤ä¹‹é—´æ²¡æœ‰å…¶ä»–å®¢æˆ·ç«¯æ­£åœ¨æ‰§è¡Œå‘½ä»¤ã€‚</p>
<p>åœ¨è¿™ç§åœºæ™¯æˆ‘ä»¬éœ€è¦ä½¿ç”¨TxPipeline, å®ƒæ€»ä½“ä¸Šç±»ä¼¼äºä¸Šé¢çš„Pipeline, ä½†æ˜¯å®ƒå†…éƒ¨ä¼šä½¿ç”¨<code>MULTI/EXEC</code>åŒ…è£¹æ’é˜Ÿçš„å‘½ä»¤ã€‚ä¾‹å¦‚ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pipe := rdb.TxPipeline()</span><br><span class="line">incr := pipe.Incr(<span class="string">"tx_pipeline_counter"</span>)</span><br><span class="line">pipe.Expire(<span class="string">"tx_pipeline_counter"</span>, time.Hour)</span><br><span class="line">_, err := pipe.Exec()</span><br><span class="line">fmt.Println(incr.Val(), err)</span><br><span class="line"></span><br><span class="line"><span class="comment">// # ä¸Šé¢ä»£ç ç›¸å½“äºåœ¨ä¸€ä¸ªRTTä¸‹æ‰§è¡Œäº†ä¸‹é¢çš„rediså‘½ä»¤ï¼š</span></span><br><span class="line">MULTI</span><br><span class="line">INCR pipeline_counter</span><br><span class="line">EXPIRE pipeline_counts <span class="number">3600</span></span><br><span class="line">EXEC</span><br><span class="line"></span><br><span class="line"><span class="comment">// # è¿˜æœ‰ä¸€ä¸ªä¸ä¸Šæ–‡ç±»ä¼¼çš„TxPipelinedæ–¹æ³•ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="keyword">var</span> incr *redis.IntCmd</span><br><span class="line">_, err := rdb.TxPipelined(<span class="function"><span class="keyword">func</span><span class="params">(pipe redis.Pipeliner)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">  incr = pipe.Incr(<span class="string">"tx_pipelined_counter"</span>)</span><br><span class="line">  pipe.Expire(<span class="string">"tx_pipelined_counter"</span>, time.Hour)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;)</span><br><span class="line">fmt.Println(incr.Val(), err)</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>ç®€å•ç¤ºä¾‹:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TxPipelineExample</span><span class="params">(rdb *redis.Client, ctx context.Context)</span></span> &#123;</span><br><span class="line">  <span class="comment">// å¼€pipelineä¸äº‹åŠ¡</span></span><br><span class="line">  pipe := rdb.TxPipeline()</span><br><span class="line">  <span class="comment">// è®¾ç½®TxPipelineé”®ç¼“å­˜</span></span><br><span class="line">  v, _ := rdb.Do(ctx, <span class="string">"set"</span>, <span class="string">"TxPipeline"</span>, <span class="number">1023.0</span>).Result()</span><br><span class="line">  log.Println(v)</span><br><span class="line">  <span class="comment">// è‡ªå¢+1.0</span></span><br><span class="line">  incr := pipe.IncrByFloat(ctx, <span class="string">"TxPipeline"</span>, <span class="number">1026.0</span>)</span><br><span class="line">  log.Println(incr) <span class="comment">// æœªæäº¤æ—¶  incr.Val() å€¼ ä¸º 0</span></span><br><span class="line">  <span class="comment">// è®¾ç½®é”®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">  pipe.Expire(ctx, <span class="string">"TxPipeline"</span>, time.Hour)</span><br><span class="line">  <span class="comment">// æäº¤äº‹åŠ¡</span></span><br><span class="line">  _, err := pipe.Exec(ctx)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Println(<span class="string">"æ‰§è¡Œå¤±è´¥, è¿›è¡Œå›æ»šæ“ä½œ!"</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(<span class="string">"äº‹åŠ¡æ‰§è¡ŒæˆåŠŸ,å·²æäº¤!"</span>)</span><br><span class="line">  log.Println(<span class="string">"TxPipeline :"</span>, incr.Val()) <span class="comment">// æäº¤åå€¼ ä¸º 2049</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœ:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Connecting Redis : <span class="number">10.20</span><span class="number">.172</span><span class="number">.248</span>:<span class="number">6379</span></span><br><span class="line">Connect Successful! </span><br><span class="line">Ping =&gt; PONG</span><br><span class="line"><span class="number">2021</span>/<span class="number">12</span>/<span class="number">27</span> <span class="number">13</span>:<span class="number">20</span>:<span class="number">15</span> OK</span><br><span class="line"><span class="number">2021</span>/<span class="number">12</span>/<span class="number">27</span> <span class="number">13</span>:<span class="number">20</span>:<span class="number">15</span> incrbyfloat TxPipeline <span class="number">1026</span>: <span class="number">0</span></span><br><span class="line">äº‹åŠ¡æ‰§è¡ŒæˆåŠŸ,å·²æäº¤!</span><br><span class="line"><span class="number">2021</span>/<span class="number">12</span>/<span class="number">27</span> <span class="number">13</span>:<span class="number">20</span>:<span class="number">15</span> TxPipeline : <span class="number">2049</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// # redis-cli</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; TYPE TxPipeline</span><br><span class="line"><span class="keyword">string</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get TxPipeline</span><br><span class="line"><span class="string">"2049"</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="Watch-ç›‘å¬æ“ä½œ"><a href="#Watch-ç›‘å¬æ“ä½œ" class="headerlink" title="Watch ç›‘å¬æ“ä½œ"></a>Watch ç›‘å¬æ“ä½œ</h4><p>æè¿°: åœ¨æŸäº›åœºæ™¯ä¸‹æˆ‘ä»¬é™¤äº†è¦ä½¿ç”¨<code>MULTI/EXEC</code>å‘½ä»¤å¤–ï¼Œè¿˜éœ€è¦é…åˆä½¿ç”¨WATCHå‘½ä»¤, ç”¨æˆ·ä½¿ç”¨WATCHå‘½ä»¤ç›‘è§†æŸä¸ªé”®ä¹‹åï¼Œç›´åˆ°è¯¥ç”¨æˆ·æ‰§è¡ŒEXECå‘½ä»¤çš„è¿™æ®µæ—¶é—´é‡Œï¼Œå¦‚æœæœ‰å…¶ä»–ç”¨æˆ·æŠ¢å…ˆå¯¹è¢«ç›‘è§†çš„é”®è¿›è¡Œäº†æ›¿æ¢ã€æ›´æ–°ã€åˆ é™¤ç­‰æ“ä½œï¼Œé‚£ä¹ˆå½“ç”¨æˆ·å°è¯•æ‰§è¡ŒEXECçš„æ—¶å€™ï¼Œäº‹åŠ¡å°†å¤±è´¥å¹¶è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è¿™ä¸ªé”™è¯¯é€‰æ‹©é‡è¯•äº‹åŠ¡æˆ–è€…æ”¾å¼ƒäº‹åŠ¡ã€‚</p>
<p>Watchæ–¹æ³•æ¥æ”¶ä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªæˆ–å¤šä¸ªkeyä½œä¸ºå‚æ•°,å…¶å‡½æ•°åŸå‹:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Watch(fn <span class="function"><span class="keyword">func</span><span class="params">(*Tx)</span> <span class="title">error</span>, <span class="title">keys</span> ...<span class="title">string</span>) <span class="title">error</span></span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç›‘è§†watch_countçš„å€¼ï¼Œå¹¶åœ¨å€¼ä¸å˜çš„å‰æä¸‹å°†å…¶å€¼+1</span></span><br><span class="line">key := <span class="string">"watch_count"</span></span><br><span class="line">err = client.Watch(<span class="function"><span class="keyword">func</span><span class="params">(tx *redis.Tx)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">  n, err := tx.Get(key).Int()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &amp;&amp; err != redis.Nil &#123;</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">  &#125;</span><br><span class="line">  _, err = tx.Pipelined(<span class="function"><span class="keyword">func</span><span class="params">(pipe redis.Pipeliner)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    pipe.Set(key, n+<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> err</span><br><span class="line">&#125;, key)</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>go-redis V8ç‰ˆæœ¬ä¸­: ä½¿ç”¨<code>GETå’ŒSET</code>å‘½ä»¤ä»¥äº‹åŠ¡æ–¹å¼é€’å¢Keyçš„å€¼çš„ç¤ºä¾‹ï¼Œä»…å½“Keyçš„å€¼ä¸å‘ç”Ÿå˜åŒ–æ—¶æäº¤ä¸€ä¸ªäº‹åŠ¡ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">transactionDemo</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> (</span><br><span class="line">    maxRetries   = <span class="number">1000</span></span><br><span class="line">    routineCount = <span class="number">10</span></span><br><span class="line">  )</span><br><span class="line">  ctx, cancel := context.WithTimeout(context.Background(), <span class="number">5</span>*time.Second)</span><br><span class="line">  <span class="keyword">defer</span> cancel()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Increment ä½¿ç”¨GETå’ŒSETå‘½ä»¤ä»¥äº‹åŠ¡æ–¹å¼é€’å¢Keyçš„å€¼ (åŒ¿åå‡½æ•°)</span></span><br><span class="line">  increment := <span class="function"><span class="keyword">func</span><span class="params">(key <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="comment">// äº‹åŠ¡å‡½æ•°</span></span><br><span class="line">    txf := <span class="function"><span class="keyword">func</span><span class="params">(tx *redis.Tx)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">      <span class="comment">// è·å¾—keyçš„å½“å‰å€¼æˆ–é›¶å€¼</span></span><br><span class="line">      n, err := tx.Get(ctx, key).Int()</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &amp;&amp; err != redis.Nil &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å®é™…çš„æ“ä½œä»£ç ï¼ˆä¹è§‚é”å®šä¸­çš„æœ¬åœ°æ“ä½œï¼‰</span></span><br><span class="line">      n++</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ“ä½œä»…åœ¨ Watch çš„ Key æ²¡å‘ç”Ÿå˜åŒ–çš„æƒ…å†µä¸‹æäº¤</span></span><br><span class="line">      _, err = tx.TxPipelined(ctx, <span class="function"><span class="keyword">func</span><span class="params">(pipe redis.Pipeliner)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">        pipe.Set(ctx, key, n, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœ€å¤šé‡è¯• maxRetries æ¬¡</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; maxRetries; i++ &#123;</span><br><span class="line">      err := rdb.Watch(ctx, txf, key)</span><br><span class="line">      <span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="comment">// æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> err == redis.TxFailedErr &#123;</span><br><span class="line">        <span class="comment">// ä¹è§‚é”ä¸¢å¤± é‡è¯•</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// è¿”å›å…¶ä»–çš„é”™è¯¯</span></span><br><span class="line">      <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> errors.New(<span class="string">"increment reached maximum number of retries"</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¨¡æ‹Ÿ routineCount ä¸ªå¹¶å‘åŒæ—¶å»ä¿®æ”¹ counter3 çš„å€¼</span></span><br><span class="line">  <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">  wg.Add(routineCount)</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; routineCount; i++ &#123;</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">defer</span> wg.Done()</span><br><span class="line">      <span class="keyword">if</span> err := increment(<span class="string">"counter3"</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"increment error:"</span>, err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">  &#125;</span><br><span class="line">  wg.Wait()</span><br><span class="line"></span><br><span class="line">  n, err := rdb.Get(context.TODO(), <span class="string">"counter3"</span>).Int()</span><br><span class="line">  fmt.Println(<span class="string">"ended with"</span>, n, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="Script-è„šæœ¬æ“ä½œ"><a href="#Script-è„šæœ¬æ“ä½œ" class="headerlink" title="Script è„šæœ¬æ“ä½œ"></a>Script è„šæœ¬æ“ä½œ</h4><p>æè¿°: ä» Redis 2.6.0 ç‰ˆæœ¬å¼€å§‹çš„ï¼Œä½¿ç”¨å†…ç½®çš„ Lua è§£é‡Šå™¨ï¼Œå¯ä»¥å¯¹ Lua è„šæœ¬è¿›è¡Œæ±‚å€¼, æ‰€ä»¥æˆ‘ä»¬å¯ç›´æ¥åœ¨rediså®¢æˆ·ç«¯ä¸­æ‰§è¡Œä¸€äº›è„šæœ¬ã€‚</p>
<p>redis Eval å‘½ä»¤åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š<code>EVAL script numkeys key [key ...] arg [arg ...]</code></p>
<ul>
<li>script: å‚æ•°æ˜¯ä¸€æ®µ Lua 5.1 è„šæœ¬ç¨‹åºã€‚è„šæœ¬ä¸å¿…(ä¹Ÿä¸åº”è¯¥)å®šä¹‰ä¸ºä¸€ä¸ª Lua å‡½æ•°ã€‚</li>
<li>numkeys: ç”¨äºæŒ‡å®šé”®åå‚æ•°çš„ä¸ªæ•°ã€‚</li>
<li>key [key â€¦]: ä» EVAL çš„ç¬¬ä¸‰ä¸ªå‚æ•°å¼€å§‹ç®—èµ·ï¼Œè¡¨ç¤ºåœ¨è„šæœ¬ä¸­æ‰€ç”¨åˆ°çš„é‚£äº› Redis é”®(key)ï¼Œè¿™äº›é”®åå‚æ•°å¯ä»¥åœ¨ Lua ä¸­é€šè¿‡å…¨å±€å˜é‡ KEYS æ•°ç»„ï¼Œç”¨ 1 ä¸ºåŸºå€çš„å½¢å¼è®¿é—®<code>( KEYS[1] ï¼Œ KEYS[2] ï¼Œä»¥æ­¤ç±»æ¨)</code>ã€‚</li>
<li>arg [arg â€¦]: é™„åŠ å‚æ•°ï¼Œåœ¨ Lua ä¸­é€šè¿‡å…¨å±€å˜é‡ ARGV æ•°ç»„è®¿é—®ï¼Œè®¿é—®çš„å½¢å¼å’Œ KEYS å˜é‡ç±»ä¼¼<code>( ARGV[1] ã€ ARGV[2] ï¼Œè¯¸å¦‚æ­¤ç±»)</code>ã€‚</li>
</ul>
<p><code>redis.call()</code> ä¸ <code>redis.pcall()</code> å”¯ä¸€çš„åŒºåˆ«æ˜¯å½“rediså‘½ä»¤æ‰§è¡Œç»“æœè¿”å›é”™è¯¯æ—¶ redis.call() å°†è¿”å›ç»™è°ƒç”¨è€…ä¸€ä¸ªé”™è¯¯ï¼Œè€Œredis.pcall()ä¼šå°†æ•è·çš„é”™è¯¯ä»¥Luaè¡¨çš„å½¢å¼è¿”å›<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ©ç”¨evalæ‰§è¡Œè„šæœ¬</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name weiyigeek</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">eval</span> <span class="string">"return redis.call('get','name')"</span> 0</span><br><span class="line"><span class="string">"weiyigeek"</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">eval</span> <span class="string">"return redis.call('set','foo','bar')"</span> 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">eval</span> <span class="string">"return redis.pcall('get','foo')"</span> 0</span><br><span class="line"><span class="string">"bar"</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">eval</span> <span class="string">"return &#123;KEYS[1],ARGV[1],KEYS[2],ARGV[2]&#125;"</span> 2 name age weiyigeek 25</span><br><span class="line">1) <span class="string">"name"</span></span><br><span class="line">2) <span class="string">"weiyigeek"</span></span><br><span class="line">3) <span class="string">"age"</span></span><br><span class="line">4) <span class="string">"25"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Lua æ•°æ®ç±»å‹å’Œ Redis æ•°æ®ç±»å‹ä¹‹é—´è½¬æ¢</span></span><br><span class="line">&gt; <span class="built_in">eval</span> <span class="string">"return 10"</span> 0</span><br><span class="line">(<span class="built_in">integer</span>) 10</span><br><span class="line"></span><br><span class="line">&gt; <span class="built_in">eval</span> <span class="string">"return &#123;1,2,&#123;3,'Hello World!'&#125;&#125;"</span> 0</span><br><span class="line">1) (<span class="built_in">integer</span>) 1</span><br><span class="line">2) (<span class="built_in">integer</span>) 2</span><br><span class="line">3) 1) (<span class="built_in">integer</span>) 3</span><br><span class="line">   2) <span class="string">"Hello World!"</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="built_in">eval</span> <span class="string">"return redis.call('get','foo')"</span> 0</span><br><span class="line"><span class="string">"bar"</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>é‚£åœ¨<code>go-redis</code>å®¢æˆ·ç«¯ä¸­å¦‚ä½•æ‰§è¡Œè„šæœ¬æ“ä½œ?</p>
<p><strong>ç®€å•ç¤ºä¾‹:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ScriptExample</span><span class="params">(rdb *redis.Client, ctx context.Context)</span></span> &#123;</span><br><span class="line">  <span class="comment">// Luaè„šæœ¬å®šä¹‰1. ä¼ é€’keyè¾“å‡ºæŒ‡å®šæ ¼å¼çš„ç»“æœ</span></span><br><span class="line">  EchoKey := redis.NewScript(<span class="string">`</span></span><br><span class="line"><span class="string">		if redis.call("GET", KEYS[1]) ~= false then</span></span><br><span class="line"><span class="string">			return &#123;KEYS[1],"==&gt;",redis.call("get", KEYS[1])&#125;</span></span><br><span class="line"><span class="string">		end</span></span><br><span class="line"><span class="string">		return false</span></span><br><span class="line"><span class="string">	`</span>)</span><br><span class="line"></span><br><span class="line">  err := rdb.Set(ctx, <span class="string">"xx_name"</span>, <span class="string">"WeiyiGeek"</span>, <span class="number">0</span>).Err()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">  val1, err := EchoKey.Run(ctx, rdb, []<span class="keyword">string</span>&#123;<span class="string">"xx_name"</span>&#125;).Result()</span><br><span class="line">  log.Println(val1, err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Luaè„šæœ¬å®šä¹‰2. ä¼ é€’keyä¸stepä½¿å¾—ï¼Œkeyå€¼ç­‰äº`é”®å€¼+step`</span></span><br><span class="line">  IncrByXX := redis.NewScript(<span class="string">`</span></span><br><span class="line"><span class="string">		if redis.call("GET", KEYS[1]) ~= false then</span></span><br><span class="line"><span class="string">			return redis.call("INCRBY", KEYS[1], ARGV[1])</span></span><br><span class="line"><span class="string">		end</span></span><br><span class="line"><span class="string">		return false</span></span><br><span class="line"><span class="string">	`</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ¤æ–­é”®æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨å°±åˆ é™¤è¯¥é”®</span></span><br><span class="line">  exist, err := rdb.Exists(ctx, <span class="string">"xx_counter"</span>).Result()</span><br><span class="line">  <span class="keyword">if</span> exist &gt; <span class="number">0</span> &#123;</span><br><span class="line">    res, err := rdb.Del(ctx, <span class="string">"xx_counter"</span>).Result()</span><br><span class="line">    log.Printf(<span class="string">"is Exists?: %v, del xx_counter: %v, err: %v \n"</span>, exist, res, err)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é¦–æ¬¡è°ƒç”¨</span></span><br><span class="line">  val2, err := IncrByXX.Run(ctx, rdb, []<span class="keyword">string</span>&#123;<span class="string">"xx_counter"</span>&#125;, <span class="number">2</span>).Result()</span><br><span class="line">  log.Println(<span class="string">"é¦–æ¬¡è°ƒç”¨ IncrByXX.Run -&gt;"</span>, val2, err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å†™å…¥ xx_counter é”®</span></span><br><span class="line">  err = rdb.Set(ctx, <span class="string">"xx_counter"</span>, <span class="number">40</span>, <span class="number">0</span>).Err()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// äºŒæ¬¡è°ƒç”¨</span></span><br><span class="line">  val3, err := IncrByXX.Run(ctx, rdb, []<span class="keyword">string</span>&#123;<span class="string">"xx_counter"</span>&#125;, <span class="number">2</span>).Result()</span><br><span class="line">  log.Println(<span class="string">"äºŒæ¬¡è°ƒç”¨ IncrByXX.Run -&gt;"</span>, val3, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Connecting Redis : 10.20.172.248:6379</span><br><span class="line">Connect Successful! </span><br><span class="line">Ping =&gt; PONG</span><br><span class="line">2021/12/27 15:00:18 [xx_name ==&gt; WeiyiGeek] &lt;nil&gt;</span><br><span class="line">2021/12/27 15:00:18 is Exists?: 1, del xx_counter: 1, err: &lt;nil&gt; </span><br><span class="line">2021/12/27 15:00:18 é¦–æ¬¡è°ƒç”¨ IncrByXX.Run -&gt; &lt;nil&gt; redis: nil</span><br><span class="line">2021/12/27 15:00:18 äºŒæ¬¡è°ƒç”¨ IncrByXX.Run -&gt; 42 &lt;nil&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; keys xx*</span><br><span class="line">1) <span class="string">"xx_counter"</span></span><br><span class="line">2) <span class="string">"xx_name"</span></span><br><span class="line">127.0.0.1:6379&gt; get xx_counter</span><br><span class="line"><span class="string">"42"</span></span><br><span class="line">127.0.0.1:6379&gt; get <span class="string">"xx_name"</span></span><br><span class="line"><span class="string">"WeiyiGeek"</span></span><br><span class="line">127.0.0.1:6379&gt; TTL xx_counter</span><br><span class="line">(<span class="built_in">integer</span>) -1</span><br></pre></td></tr></table></figure></p>
<p>è‡³æ­¤åœ¨ä½¿ç”¨go-Rediså®¢æˆ·ç«¯åº“æ“ä½œå®è·µRedisæ•°æ®åº“å®Œæ¯•!</p>

        </div>
        
  <hr>
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>

  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>

  <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ï¼Œè½¬ä¸ªå‘ã€‘(äººé—´äº”å¤§æƒ…)</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œè°¢è°¢ï¼ã€‚</p>

  <div>
    <img src="https://www.weiyigeek.top/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul>

  <div>
    <img src="/img/wechat-search.png" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·"  width="328" height="149">
    <img src="/img/wechat-app.png" class="img-responsive" alt="æ‰«æVisit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº"  width="328" height="149">
  </div>


  <hr>
  


  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-03-11T03:43:52.946Z" itemprop="dateUpdated">2022-03-11 11:43:52</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç¼–ç¨‹ä¸–ç•Œ/Go/Extension/3.Goè¯­è¨€é¡¹ç›®æ“ä½œRedisæ•°æ®å®è·µ.md" target="_blank" rel="noopener noreferrer">_posts/ç¼–ç¨‹ä¸–ç•Œ/Go/Extension/3.Goè¯­è¨€é¡¹ç›®æ“ä½œRedisæ•°æ®å®è·µ.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2020/4-27-608.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/4-27-608.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">ğŸ‘ é’Ÿæ„ä½œè€…</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go/" rel="tag">Go</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/4-27-608.html&title=ã€Š3.Goè¯­è¨€é¡¹ç›®æ“ä½œRedisæ•°æ®å®è·µã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/4-27-608.html&title=ã€Š3.Goè¯­è¨€é¡¹ç›®æ“ä½œRedisæ•°æ®å®è·µã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/4-27-608.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š3.Goè¯­è¨€é¡¹ç›®æ“ä½œRedisæ•°æ®å®è·µã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/4-27-608.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/4-27-608.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/4-27-521.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">4-Kuberneteså…¥é—¨åŸºç¡€ä¹‹Podä»‹ç»</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/4-27-606.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">2.Goè¯­è¨€é¡¹ç›®æ“ä½œMySQLæ•°æ®åº“å®è·µ</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Goè¯­è¨€ç¼–ç¨‹ä½¿ç”¨Go-redisåº“æ“ä½œRedisæ•°æ®åº“"><span class="post-toc-number">1.</span> <span class="post-toc-text">Goè¯­è¨€ç¼–ç¨‹ä½¿ç”¨Go-redisåº“æ“ä½œRedisæ•°æ®åº“</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Redis-ç¯å¢ƒå‡†å¤‡"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">Redis ç¯å¢ƒå‡†å¤‡</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Redis-å®¢æˆ·ç«¯åº“å®‰è£…"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">Redis å®¢æˆ·ç«¯åº“å®‰è£…</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Redis-æ•°æ®åº“è¿æ¥"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">Redis æ•°æ®åº“è¿æ¥</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-Rediså•èŠ‚ç‚¹è¿æ¥"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">1.Rediså•èŠ‚ç‚¹è¿æ¥</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-Rediså“¨å…µæ¨¡å¼è¿æ¥"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">2.Rediså“¨å…µæ¨¡å¼è¿æ¥</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-Redisé›†ç¾¤æ¨¡å¼è¿æ¥"><span class="post-toc-number">1.3.3.</span> <span class="post-toc-text">3.Redisé›†ç¾¤æ¨¡å¼è¿æ¥</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-V8æ–°ç‰ˆæœ¬è¿æ¥æ–¹å¼-é‡ç‚¹"><span class="post-toc-number">1.3.4.</span> <span class="post-toc-text">4.V8æ–°ç‰ˆæœ¬è¿æ¥æ–¹å¼(é‡ç‚¹)</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Redis-æ•°æ®ç±»å‹æŒ‡ä»¤æ“ä½œå®è·µ"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">Redis æ•°æ®ç±»å‹æŒ‡ä»¤æ“ä½œå®è·µ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Redis-å®¢æˆ·ç«¯åº“åŸºæœ¬ä½¿ç”¨"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">Redis å®¢æˆ·ç«¯åº“åŸºæœ¬ä½¿ç”¨</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Go-Redis-V8-åˆå§‹åŒ–è¿æ¥"><span class="post-toc-number">1.5.1.</span> <span class="post-toc-text">Go-Redis V8 åˆå§‹åŒ–è¿æ¥</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Redis-åŸºæœ¬æŒ‡ä»¤æ“ä½œç¤ºä¾‹"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">Redis åŸºæœ¬æŒ‡ä»¤æ“ä½œç¤ºä¾‹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#å­—ç¬¦ä¸²-string-ç±»å‹æ“ä½œ"><span class="post-toc-number">1.6.1.</span> <span class="post-toc-text">å­—ç¬¦ä¸²(string)ç±»å‹æ“ä½œ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#åˆ—è¡¨-list-ç±»å‹æ“ä½œ"><span class="post-toc-number">1.6.2.</span> <span class="post-toc-text">åˆ—è¡¨(list)ç±»å‹æ“ä½œ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#é›†åˆ-set-ç±»å‹æ“ä½œ"><span class="post-toc-number">1.6.3.</span> <span class="post-toc-text">é›†åˆ(set)ç±»å‹æ“ä½œ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#æœ‰åºé›†åˆ-zset-ç±»å‹æ“ä½œ"><span class="post-toc-number">1.6.4.</span> <span class="post-toc-text">æœ‰åºé›†åˆ(zset)ç±»å‹æ“ä½œ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#å“ˆå¸Œ-hash-ç±»å‹æ“ä½œ"><span class="post-toc-number">1.6.5.</span> <span class="post-toc-text">å“ˆå¸Œ(hash)ç±»å‹æ“ä½œ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#åŸºæ•°ç»Ÿè®¡-HyperLogLog-ç±»å‹æ“ä½œ"><span class="post-toc-number">1.6.6.</span> <span class="post-toc-text">åŸºæ•°ç»Ÿè®¡ HyperLogLog ç±»å‹æ“ä½œ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#è‡ªå®šä¹‰redisæŒ‡ä»¤æ“ä½œ"><span class="post-toc-number">1.6.7.</span> <span class="post-toc-text">è‡ªå®šä¹‰redisæŒ‡ä»¤æ“ä½œ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Redis-Pipeline-é€šé“æ“ä½œ"><span class="post-toc-number">1.6.8.</span> <span class="post-toc-text">Redis Pipeline é€šé“æ“ä½œ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#MULTI-EXEC-äº‹åŠ¡å¤„ç†æ“ä½œ"><span class="post-toc-number">1.6.9.</span> <span class="post-toc-text">MULTI&#x2F;EXEC äº‹åŠ¡å¤„ç†æ“ä½œ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Watch-ç›‘å¬æ“ä½œ"><span class="post-toc-number">1.6.10.</span> <span class="post-toc-text">Watch ç›‘å¬æ“ä½œ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Script-è„šæœ¬æ“ä½œ"><span class="post-toc-number">1.6.11.</span> <span class="post-toc-text">Script è„šæœ¬æ“ä½œ</span></a></li></ol></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

  <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        äººé—´è‡ªæœ‰äº”å¤§æƒ…ã€ç‚¹èµã€æŠ•å¸(èµèµ)ã€æ”¶è—ã€å…³æ³¨ï¼Œè½¬å‘ã€‘, è°¢è°¢çœ‹å‹æ”¯æŒ!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

  
 <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->

  <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">ä¸ªäººGithub</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">ä¸ªäººGitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">ä¸ªäººçŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘+äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved. ITå”¯ä¸€æå®¢ ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/4-27-608.html&title=ã€Š3.Goè¯­è¨€é¡¹ç›®æ“ä½œRedisæ•°æ®å®è·µã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/4-27-608.html&title=ã€Š3.Goè¯­è¨€é¡¹ç›®æ“ä½œRedisæ•°æ®å®è·µã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/4-27-608.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š3.Goè¯­è¨€é¡¹ç›®æ“ä½œRedisæ•°æ®å®è·µã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/4-27-608.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/4-27-608.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACL0lEQVR42u3ay26DMBAFUP7/p6nUVaU05M7YRMI+XlUpYA6LkedxHPE6f9f1f/9ec76s5JnX109YGBgYj2Wcl+t1y/z65K7q53hLxcDA2IBxHRCTF72+Nw/izXsxMDAwJlGvQzkGBgbG3QF37rESAwMDo5fEJsHxeuNqCL4lF8fAwHggo9oY+ObfN/Y3MDAwHsI4iysJiNV9J7wVBgbG0oyk4JW0GHuHvJFUOZoHwcDAWJpRbVJW780T48KHxsDA2JIxktZWy3YTPhAGBsbSjFkl+JEAPV7gw8DAWJVRSBGHD5HVgde8aYqBgbEno1rwevdLfkzMn/DPvhgYGEszktJ8HhyrTc3eOFrUwsTAwFiIkQe7Xsk+L7f13gQDA2MfRq8cPzJGlifJ0VgGBgbGBozxZmQelHNSkh4fSZ6NgYHxcEZe3rojaOZltUKyjYGBsRxjpOB1DKz8M0VvgoGBsTQjD6Z5QzH5vdd++DD2gYGBsQ2j+ojeJ6gmqFHQx8DAWJQxXtyvJrS9QPzhMIqBgbEBI084R4Yt8iZoeYAMAwNjaUaycRIoq6WxJIktR1cMDIxFGWdx9cr61dZCXtSL+hsYGBgPZ/TCXG+ca3w4Y0IzFQMD47GMarktR/aGwJrHUwwMjA0YeXI7a5CiGvXLnVgMDIwtGb2hivFAHIV+DAwMjPgAN7edUGhdYGBgbMAYbwb0XqhasHt7rMTAwFia0Usge4xeeW7auAYGBsbzGD/cqCLg7t1aJQAAAABJRU5ErkJggg==" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 



  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 
     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>
