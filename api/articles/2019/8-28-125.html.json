{"title":"SSL证书申请与使用","slug":"基础知识/Web原理/Web协议/SSL证书申请与使用","date":"2019-08-28T11:34:30.000Z","updated":"2021-04-06T08:38:36.868Z","url":"2019/8-28-125.html","path":"api/articles/2019/8-28-125.html.json","covers":null,"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"Let’s-Encrypt申请证书\"><a href=\"#Let’s-Encrypt申请证书\" class=\"headerlink\" title=\"Let’s Encrypt申请证书\"></a>Let’s Encrypt申请证书</h4><p>描述:服务器CentOS7.x，Nignx，Let’s Encrypt做免费的HTTPS证书。<br>Let’s Encrypt官网: <a href=\"https://letsencrypt.org/\" target=\"_blank\" rel=\"noopener\">https://letsencrypt.org/</a><br>操作流程:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#流程</span></span><br><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://github.com/letsencrypt/letsencrypt.git</span><br><span class=\"line\">$ <span class=\"built_in\">cd</span> letsencrypt　</span><br><span class=\"line\">$ sudo ./letsencrypt-auto certonly</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#根据该向导选用standalone模式填写自己的邮箱域名等等</span></span><br><span class=\"line\">/etc/letsencrypt/live/mydomain</span><br><span class=\"line\"><span class=\"comment\"># privkey.pem</span></span><br><span class=\"line\"><span class=\"comment\"># fullchain.pem</span></span><br></pre></td></tr></table></figure></p>\n<p>修改配置nginx文件:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 443 ssl http2 default_server;</span><br><span class=\"line\">    listen [::]:443 ssl http2 default_server;</span><br><span class=\"line\">    server_name www.linuxidc.com;</span><br><span class=\"line\">    root /usr/share/nginx/html;</span><br><span class=\"line\"></span><br><span class=\"line\">    ssl_certificate <span class=\"string\">\"/etc/letsencrypt/live/www.linuxidc.com/fullchain.pem\"</span>;</span><br><span class=\"line\">    ssl_certificate_key <span class=\"string\">\"/etc/letsencrypt/live/www.linuxidc.com/privkey.pem\"</span>;</span><br><span class=\"line\">    ssl_session_cache shared:SSL:1m;</span><br><span class=\"line\">    ssl_session_timeout 10m;</span><br><span class=\"line\">    ssl_ciphers HIGH:!aNULL:!MD5;</span><br><span class=\"line\">    ssl_prefer_server_ciphers on;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Load configuration files for the default server block.</span></span><br><span class=\"line\">    include /etc/nginx/default.d/*.conf;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#实现http转换到https中,颁发的证书右击页面-&gt;检查-&gt;security-&gt;View certificate 证书的有效期是3个月</span></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name www.linuxidc.com;</span><br><span class=\"line\">    <span class=\"built_in\">return</span> 301 https://<span class=\"variable\">$host</span><span class=\"variable\">$request_uri</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>实现定时更新证书我们可以用linux自带的定时器crontab:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ crontab -e</span><br><span class=\"line\">30 2 1 * * /usr/bin/certbot renew &gt;&gt; /var/<span class=\"built_in\">log</span>/le-renew.log</span><br><span class=\"line\">35 2 1 * * /usr/bin/systemctl reload nginx</span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"SystemOperation","path":"api/categories/SystemOperation.json"}],"tags":[{"name":"https","path":"api/tags/https.json"}]}