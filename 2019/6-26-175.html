<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>🌐 AWK三剑客入门与进阶|WeiyiGeek Blog|唯一极客Geek-IT网络安全运维开发技术知识分享-博客站点</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="shell">
    <meta name="Description" content="WeiyiGeek-唯一极客博客站点,关注于网络安全运维,Web安全开发,IOT物联网安全开发,应用开发,分享技术学习知识与入坑解决,提升网络安全技术与自身技术能力,立志维护大众网络安全为己任,做一个对国家有用的人,为实现中华民族伟大复兴的中国梦不懈奋斗">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-头像">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                首页
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                文章分类
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                文章标签
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                文章归档
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                学习书籍
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                关于作者
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                站点导航
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                公众账号
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                哔哩哔哩
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>AWK三剑客入门与进阶</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="文章头部背景">
    <div class="container fade-scale">
        <h1 class="title">AWK三剑客入门与进阶</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-06-26T12:37:30.000Z" itemprop="datePublished" class="page-time">
  2019-06-26
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Linux%E5%91%BD%E4%BB%A4/">Linux命令</a></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
  <article id="post-系统运维/Linux/常用命令/脚本常用类命令/awk三剑客入门与进阶"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">AWK三剑客入门与进阶</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-06-26 20:37:30" datetime="2019-06-26T12:37:30.000Z"  itemprop="datePublished">2019-06-26</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Linux%E5%91%BD%E4%BB%A4/">Linux命令</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h4 id="0x00-快速入门"><a href="#0x00-快速入门" class="headerlink" title="0x00 快速入门"></a>0x00 快速入门</h4><p>描述：awk 命令与其说它是一个命令，更不如说它是一门脚本编程语言，它是主要针对文本和数据进行处理的编程语言,是linux/unix下的一个强大编程工具。<br>它有三种形式 <code>awk,gawk,nawk</code> 平时所说的awk其实就是gawk;它在命令行中使用,但更多是作为脚本来使用,</p>
<p><em>awk特点</em>:</p>
<ul>
<li>它支持用户自定义函数和动态正则表达式等先进功能</li>
<li>awk有很多内建的功能：<code>可以自定义变量,有条件语句,有循环,有数组,有正则,有函数</code>等这是它和C语言的相同之处</li>
<li>灵活性是awk最大的优势</li>
</ul>
<h4 id="0x01-命令格式和选项"><a href="#0x01-命令格式和选项" class="headerlink" title="0x01 命令格式和选项"></a>0x01 命令格式和选项</h4><p><strong>语法形式</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">awk [options] <span class="string">'script'</span> -v var=value file (s) <span class="comment">#数据可以来自标准输入(stdin)、一个或多个文件,或其它命令的管道输出.</span></span><br><span class="line">awk [options] -f scriptfile -v var=value file(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">#awk脚本基本结构:&#123;&#125;类似一个循环体，会对文件中的每一行进行迭代，</span></span><br><span class="line"><span class="comment">#一个awk脚本通常由三个部分是可选的。</span></span><br><span class="line"><span class="comment"># - BEGIN语句块、</span></span><br><span class="line"><span class="comment"># - 能够使用模式匹配的通用语句块、</span></span><br><span class="line"><span class="comment"># - END语句块</span></span><br><span class="line">awk <span class="string">'BEGIN&#123; print "start" &#125; pattern&#123; commands &#125; END&#123; print "end" &#125;'</span> file</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><em>常用命令选项：</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-F fs <span class="comment">#fs指定输入分隔符，fs可以是字符串或正则表达式，如-F:</span></span><br><span class="line">-v var=value  <span class="comment">#赋值一个用户定义变量，将外部变量传递给awk</span></span><br><span class="line">-f scripfile  <span class="comment">#从脚本文件中读取awk命令</span></span><br><span class="line">-m[fr] val    <span class="comment"># 对val值设置内在限制，-mf选项限制分配给val的最大块数目；</span></span><br><span class="line">-mr选项 限制记录的最大数目 <span class="comment">#这两个功能是Bell实验室版awk的扩展功能，在标准awk中不适用。</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><em>awk模式和操作</em><br>模式可以是以下任意一个：</p>
<ul>
<li>/正则表达式/：使用通配符的扩展集。</li>
<li>关系表达式：使用运算符进行操作，可以是字符串或数字的比较测试。</li>
<li>模式匹配表达式：用运算符~（匹配）和~!（不匹配）。</li>
<li>BEGIN语句块、pattern语句块、END语句块参见awk的工作原理</li>
</ul>
<p>操作由<code>一个或多个命令、函数、表达式组成</code>之间由换行符或分号隔开，并位于大括号内主要部分是：</p>
<ul>
<li>变量或数组赋值</li>
<li>输出命令</li>
<li>内置函数</li>
<li>控制流语句</li>
</ul>
<hr>

<h4 id="0x02-awk的工作原理"><a href="#0x02-awk的工作原理" class="headerlink" title="0x02 awk的工作原理"></a>0x02 awk的工作原理</h4><p>比如：<code>awk &#39;BEGIN{ commands } pattern{ commands } END{ commands }&#39;</code></p>
<ul>
<li>第一步：执行BEGIN{ commands }语句块中的语句；</li>
<li>第二步：从文件或标准输入(stdin)读取一行，然后执行pattern{ commands }语句块，它逐行扫描文件，从第一行到最后一行重复这个过程直到文件全部被读取完毕。</li>
<li>第三步：当读至输入流末尾时，执行END{ commands }语句块。</li>
</ul>
<p><em>BEGIN语句块(程序初始操作)</em></p>
<ul>
<li>在awk开始从输入流中读取行之前被执行，<code>可选的语句块比如显示变量以及变量初始化、打印输出表格的表头</code>等语句通常可以写在BEGIN语句块中。</li>
</ul>
<p>pattern语句块中的通用命令是最重要的部分，它也是可选的。如果没有提供pattern语句块，则<code>默认执行{ print }即打印每一个读取到的行</code>，awk读取的每一行都会执行该语句块。</p>
<p><em>END语句块（程序结束操作）</em></p>
<ul>
<li>在awk从输入流中读取完所有的行之后(程序结束之后)被执行(扫尾工作)，比如<code>打印所有行的分析结果这类信息汇总都是在END语句块中完成</code>，它也是一个可选语句块。</li>
<li><code>有END语句块后必须有处理的文件</code>或者是通过管道符传入的字符串，否则会一直卡再输入状态;</li>
</ul>
<p>注意事项：<br>任何在BEGIN之后列出的操作<code>{}内</code>,将在awk开始扫描输入之前执行,而END之后列出的操作将会在扫描完全后输入后执行;</p>
<p><br></p>
<p>Awk支持输出中文字符,同时也支持Print与printf命令</p>
<ul>
<li>1.print会在每个输出之后自动加入一个换行符（Linux-shell是没有Print命令的，只有printf命令）</li>
<li>2.printf是标准格式的输出命令，并不会自动加入换行符,如果需要则要加上\反义字符.</li>
</ul>
<p><br></p>
<p>基本示例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例1.任意一个部分都可以不出现在脚本中，脚本通常是被单引号或双引号中，例如：</span></span><br><span class="line"><span class="comment">#通常变量初始化语句（如：i=0）以及打印文件头部的语句放入BEGIN语句块中，将打印的结果等语句放在END语句块中</span></span><br><span class="line">awk <span class="string">'BEGIN&#123; i=0 &#125; &#123; i++ &#125; END&#123; print i &#125;'</span> filename  <span class="comment">#[推荐方式] </span></span><br><span class="line">awk <span class="string">"BEGIN&#123; i=0 &#125; &#123; i++ &#125; END&#123; print i &#125;"</span> filename  <span class="comment">#在awk的print语句块中双引号是被当作拼接符使用，（执行某些语句时候会出现问题）</span></span><br><span class="line"><span class="comment">#有END后必须在后面接上处理的文件</span></span><br><span class="line">awk <span class="string">'BEGIN &#123;</span></span><br><span class="line"><span class="string">    arr[1]="boy";</span></span><br><span class="line"><span class="string">    arr[2]="girl";</span></span><br><span class="line"><span class="string">    for(key in array)</span></span><br><span class="line"><span class="string">      print key,array[key]</span></span><br><span class="line"><span class="string">  &#125;'</span> /etc/hosts <span class="comment">#毫无相关的也可以</span></span><br><span class="line"><span class="comment"># 1 boy</span></span><br><span class="line"><span class="comment"># 2 girl</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例2.当使用不带参数的print时，它就打印当前行，当print的参数是以逗号进行分隔时，打印时则以空格作为定界符。</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"A line 1\nA line 2"</span> | awk <span class="string">'BEGIN&#123; print "Start" &#125; &#123; print &#125; END&#123; print "End" &#125;'</span>  <span class="comment">#通过管道符号</span></span><br><span class="line"><span class="comment"># Start</span></span><br><span class="line"><span class="comment"># A line 1</span></span><br><span class="line"><span class="comment"># A line 2</span></span><br><span class="line"><span class="comment"># End</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例3.双引号""拼接使用：</span></span><br><span class="line"><span class="built_in">echo</span> | awk <span class="string">'&#123; var1="v1"; var2="v2"; var3="v3"; print var1,var2,var3; &#125;'</span> </span><br><span class="line"><span class="comment">#v1 v2 v3</span></span><br><span class="line"><span class="built_in">echo</span> | awk <span class="string">'&#123; var1="1"; var2="2"; var3="3"; print var1"=&gt;"var2"=&gt;"var3; &#125;'</span></span><br><span class="line"><span class="comment">#1=&gt;2=&gt;3</span></span><br></pre></td></tr></table></figure></p>
<p>借助-v选项:可以将外部值（并非来自stdin）传递给awk<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例1.将外部变量值传递给awk,</span></span><br><span class="line">VAR=10000;<span class="built_in">echo</span> | awk -v VARIABLE=<span class="variable">$VAR</span> <span class="string">'&#123; print VARIABLE &#125;'</span></span><br><span class="line"><span class="comment"># 10000</span></span><br><span class="line"><span class="comment">#另一种传递外部变量方法：</span></span><br><span class="line">var1=<span class="string">"aaa"</span>;var2=<span class="string">"bbb"</span></span><br><span class="line"><span class="built_in">echo</span> | awk <span class="string">'&#123; print v1,v2 &#125;'</span> v1=<span class="variable">$var1</span> v2=<span class="variable">$var2</span>  <span class="comment">#方法中变量之间用空格分隔作为awk的命令行参数跟随在BEGIN、&#123;&#125;和END语句块之后</span></span><br><span class="line"><span class="comment"># aaa bbb</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例2.变量传递加文件读取</span></span><br><span class="line">var1=1024;var2=<span class="string">"weiyigeek"</span></span><br><span class="line">awk <span class="string">'BEGIN&#123; print v2,"BEIGIN",v1 &#125; &#123; print v1,v2 &#125; END&#123; print v2,v1 &#125;'</span> v1=<span class="variable">$var1</span> v2=<span class="variable">$var2</span> /etc/passwd</span><br><span class="line">    BEIGIN     <span class="comment">#BEGIN 初始化为空白此时变量还没写入</span></span><br><span class="line"><span class="comment"># 1024 weiyigeek  #/etc/passwd有几行就显示几行</span></span><br><span class="line"><span class="comment"># 1024 weiyigeek</span></span><br><span class="line"><span class="comment"># 1024 weiyigeek</span></span><br><span class="line"><span class="comment"># 1024 weiyigeek</span></span><br><span class="line"><span class="comment"># 1024 weiyigeek</span></span><br><span class="line">weiyigeek 1024  <span class="comment">#END 除开最后一行不一样</span></span><br></pre></td></tr></table></figure></p>
<p>awk借助-F 选项确定分割符号进行指定列输出，默认的字段定界符是空格：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例1.passwd文件分割</span></span><br><span class="line">awk -F: <span class="string">'&#123; print $NF &#125;'</span> /etc/passwd</span><br><span class="line">awk -F <span class="string">":"</span> <span class="string">'&#123; print $1 &#125;'</span> /etc/passwd</span><br><span class="line"><span class="comment"># root</span></span><br><span class="line"><span class="comment"># daemon</span></span><br><span class="line"><span class="comment"># bin</span></span><br><span class="line"><span class="comment"># sys</span></span><br><span class="line">awk -F <span class="string">'&#123; print $1 &#125;'</span> /etc/passwd</span><br><span class="line"><span class="comment">#补充可以采用正则的方式进行指定分隔符进行分割（及多个分隔符）</span></span><br><span class="line"><span class="comment"># netstat -an | grep "EST"</span></span><br><span class="line"><span class="comment">#   TCP    127.0.0.1:5354         127.0.0.1:49155        ESTABLISHED</span></span><br><span class="line"><span class="comment">#   TCP    127.0.0.1:5354         127.0.0.1:49156        ESTABLISHED</span></span><br><span class="line"><span class="comment">#值得学习</span></span><br><span class="line">netstat -an | grep <span class="string">"EST"</span> | grep -v <span class="string">"127.0.0.1"</span> | awk -F <span class="string">"[ :]+"</span> <span class="string">'&#123;print $5&#125;'</span> | sort | uniq -c</span><br><span class="line">netstat -an | grep <span class="string">"EST"</span> | awk -F <span class="string">"[ :]+"</span> <span class="string">'&#123;print $5&#125;'</span> | sort |uniq -c</span><br><span class="line">      6 127.0.0.1</span><br><span class="line">      1 183.232.94.216</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例2.统计一个文本文件中url出现的次数，并且去重复</span></span><br><span class="line">cat &gt;&gt; test.txt &lt;&lt;END</span><br><span class="line">http://www.weiyigeek.github.io/1.path</span><br><span class="line">http://www.weiyigeek.github.io/1.html</span><br><span class="line">http://bbs.weiyigeek.github.io/1.jsp</span><br><span class="line">http://www.weiyigeek.github.io/1.php</span><br><span class="line">http://blog.weiyigeek.github.io/1.jsp</span><br><span class="line">http://bbs.weiyigeek.github.io/1.jsp</span><br><span class="line">END</span><br><span class="line">workspace&gt; awk -F <span class="string">"/"</span> <span class="string">'&#123; print $3 &#125;'</span> test.txt | sort -r | uniq -c </span><br><span class="line">  3 www.weiyigeek.github.io</span><br><span class="line">  2 bbs.weiyigeek.github.io</span><br><span class="line">  1 blog.weiyigeek.github.io</span><br><span class="line"><span class="comment">#补从示例2,注意字符串默认从0加整数自加1（值得学习）</span></span><br><span class="line">awk -F <span class="string">"/"</span> <span class="string">'&#123;S[$3]+=1&#125;END&#123; for(item in S) print item":"S[item]&#125;'</span> test.txt  <span class="comment">#借鉴与学习</span></span><br><span class="line">awk -F <span class="string">"/"</span> <span class="string">'&#123;S[$3]++&#125;END&#123; for(item in S) print item":"S[item]&#125;'</span> test.txt | sort -t <span class="string">":"</span> -k2  <span class="comment">#排序</span></span><br><span class="line">blog.weiyigeek.github.io:1</span><br><span class="line">bbs.weiyigeek.github.io:2</span><br><span class="line">www.weiyigeek.github.io:3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例3.统计服务器中不同网络连接状态的对应数量 （借鉴学习）</span></span><br><span class="line">$ NETSTAT.EXE -an | awk <span class="string">'/^tcp/ &#123;print $NF&#125;'</span> | sort | uniq -c | sort -rn |head   <span class="comment">#$NF 代表最后一行</span></span><br><span class="line">$ NETSTAT.EXE -an | awk -F <span class="string">" "</span> <span class="string">'&#123; if($4 == "" || $4 == " ")&#123;next&#125;else&#123;S[$4]++&#125;&#125; END&#123; for(key in S) print key"状态数量："S[key]; &#125;'</span></span><br><span class="line"><span class="comment"># LISTENING状态数量：37</span></span><br><span class="line"><span class="comment"># CLOSE_WAIT状态数量：12</span></span><br><span class="line"><span class="comment"># ESTABLISHED状态数量：15</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例4.统计apache.logs日志数量 (访问次数*文件大小) 文件名称</span></span><br><span class="line">awk <span class="string">'&#123; print $7"\t" $10&#125;'</span> access_2018-12.log | sort | uniq -c | awk <span class="string">'&#123;print $1*$3,$1,$2&#125;'</span> | sort -rn | head  <span class="comment">#方式1</span></span><br><span class="line">awk <span class="string">'&#123;namenum[$7]++;size[$7]+=$10&#125; END &#123;for x in name&#123; print(size[x],namenum[x],x)&#125;&#125;'</span> access_2018-12.log | sort -rn -k1 | head -10  <span class="comment">#方式2 （自带统计数量）</span></span><br><span class="line"><span class="comment"># 57254 1 /static/js/jquery-juquey-1.3.2min.js</span></span><br></pre></td></tr></table></figure></p>
<hr>

<h4 id="0x03-awk内置变量（预定义变量）"><a href="#0x03-awk内置变量（预定义变量）" class="headerlink" title="0x03 awk内置变量（预定义变量）"></a>0x03 awk内置变量（预定义变量）</h4><p>说明：[A][N][P][G]表示第一个支持变量的工具<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[A]=awk</span><br><span class="line">[N]=nawk</span><br><span class="line">[P]=POSIXawk</span><br><span class="line">[G]=gawk </span><br><span class="line"></span><br><span class="line"><span class="comment">#内置变量</span></span><br><span class="line"><span class="variable">$n</span> 当前记录的第n个字段，比如n为1表示第一个字段，n为2表示第二个字段。 </span><br><span class="line"><span class="variable">$0</span> 这个变量包含执行过程中当前行的文本内容。</span><br><span class="line">[N] ARGC 命令行参数的数目。</span><br><span class="line">[G] ARGIND 命令行中当前文件的位置（从0开始算）。</span><br><span class="line">[N] ARGV 包含命令行参数的数组。</span><br><span class="line">[G] CONVFMT 数字转换格式（默认值为%.6g）。</span><br><span class="line">[P] ENVIRON 环境变量关联数组。</span><br><span class="line">[N] ERRNO 最后一个系统错误的描述。</span><br><span class="line">[G] FIELDWIDTHS 字段宽度列表（用空格键分隔）。</span><br><span class="line">[A] FILENAME 当前输入文件的名。</span><br><span class="line">[P] FNR 同NR，但相对于当前文件。</span><br><span class="line">[A] FS 字段分隔符（默认是任何空格）。</span><br><span class="line">[G] IGNORECASE 如果为真，则进行忽略大小写的匹配。</span><br><span class="line">[A] NF 表示字段数，在执行过程中对应于当前的字段数。常用</span><br><span class="line">[A] NR 表示记录数，在执行过程中对应于当前的行号。 常用</span><br><span class="line">[A] OFMT 数字的输出格式（默认值是%.6g）。</span><br><span class="line">[A] OFS 输出字段分隔符（默认值是一个空格）。常用</span><br><span class="line">[A] ORS 输出记录分隔符（默认值是一个换行符）。</span><br><span class="line">[A] RS 记录分隔符（默认是一个换行符）。</span><br><span class="line">[N] RSTART 由match函数所匹配的字符串的第一个位置。</span><br><span class="line">[N] RLENGTH 由match函数所匹配的字符串的长度。</span><br><span class="line">[N] SUBSEP 数组下标分隔符（默认值是34）。</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>输出字段$0~{$1.$n}开始(类似于shell的位置参数变量):<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例1.输出第几列的数据，类似shell从cmd传入到脚本程序的参数</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"1 2 3\n4 5 6\n7 8 9"</span> | awk <span class="string">'&#123;print $0," ==",$1,"-",$2,"-",$3&#125;'</span></span><br><span class="line"><span class="comment"># 1 2 3  == 1 - 2 - 3</span></span><br><span class="line"><span class="comment"># 4 5 6  == 4 - 5 - 6</span></span><br><span class="line"><span class="comment"># 7 8 9  == 7 - 8 - 9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例2.打印每一行的第二和第三个字段：</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"1 2 3\n4 5 6\n7 8 9"</span> | awk <span class="string">'&#123; print $2,$3 &#125;'</span></span><br><span class="line"><span class="comment"># 2 3</span></span><br><span class="line"><span class="comment"># 5 6</span></span><br><span class="line"><span class="comment"># 8 9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例3.文件处理传入输出字符,把文件内容第一列作为下标,第二列作为值，放入数组然后输出</span></span><br><span class="line">cat &gt;&gt; demo1.txt &lt;&lt;END</span><br><span class="line">1 WeiyiGeek</span><br><span class="line">2 Weiy_</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line"><span class="variable">$awk</span> <span class="string">'&#123;S[$1]=$2 &#125; END&#123; for(key in S) print key":"S[key] &#125;'</span> demo1.txt</span><br><span class="line"><span class="comment"># 1:WeiyiGeek</span></span><br><span class="line"><span class="comment"># 2:Weiy_</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>对于传入的文件进行字段数NF处理：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例1.使用print $NF可以打印出一行中的最后一个字段，使用$(NF-1)则是打印倒数第二个字段，其他以此类推：</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"line1 f2 f3\n line2 f4 f5"</span> | awk <span class="string">'&#123;print $NF&#125;'</span></span><br><span class="line"><span class="comment"># f3</span></span><br><span class="line"><span class="comment"># f5</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"line1 f2 f3\n line2 f4 f5"</span> | awk <span class="string">'&#123;print $(NF-1)&#125;'</span></span><br><span class="line"><span class="comment"># f2</span></span><br><span class="line"><span class="comment"># f4</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>统计文件中的行数NR<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例0：统计行数</span></span><br><span class="line">$ awk <span class="string">'END&#123;print NR&#125;'</span> /etc/passwd</span><br><span class="line">24</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例1:输出字段$0~$1~$n开始(类似于shell的位置参数变量)，</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"line1 f2 f3\nline2 f4 f5\nline3 f6 f7"</span> | awk <span class="string">'&#123;print "Line No:" NR ", No of fields:" NF , "$0="$0, "$1="$1, "$2="$2, "$3="$3&#125;'</span> </span><br><span class="line"><span class="comment"># Line No:1(关键点), No of fields:3(关键点) $0=line1 f2 f3(关键点) $1=line1(关键点) $2=f2(关键点) $3=f3(关键点)</span></span><br><span class="line"><span class="comment"># Line No:2, No of fields:3 $0=line2 f4 f5 $1=line2 $2=f4 $3=f5</span></span><br><span class="line"><span class="comment"># Line No:3, No of fields:3 $0=line3 f6 f7 $1=line3 $2=f6 $3=f7</span></span><br></pre></td></tr></table></figure><br>以上命令只使用了END语句块在读入每一行的时，awk会将NR更新为对应的行号，当到达最后一行NR的值就是最后一行的行号，所以END语句块中的NR就是文件的行数。</p>
<p><br><br>设置字符分割定界符 FS:<br>描述：在BEGIN语句块中可以用<code>FS=&quot;定界符&quot;</code>设置输出字段的定界符;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例1.指定定界符</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"1-2-3-4-5-6"</span> | awk <span class="string">'BEGIN&#123; FS="-"&#125; &#123;print "行数:"$NR,"列数:"$NF,"\n选择分割元素:"$1,"全部元素:"$0&#125;'</span></span><br><span class="line">行数:1 列数:6 </span><br><span class="line">选择分割元素:1 全部元素:1-2-3-4-5-6</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例2.与-F选项同功能来提取passwd</span></span><br><span class="line">awk <span class="string">'BEGIN&#123; FS=":";&#125; &#123;print "用户名:"$1&#125;'</span> /etc/passwd | sort -u    </span><br><span class="line">用户名:_apt</span><br><span class="line">用户名:backup</span><br><span class="line">用户名:bin</span><br><span class="line">用户名:daemon</span><br><span class="line">用户名:dnsmasq</span><br><span class="line">用户名:games</span><br><span class="line">用户名:gnats</span><br><span class="line">用户名:irc</span><br><span class="line">用户名:landscape</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>环境变量关联数组ENVIRON是awk常量，是子典型数组。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例1.获取单个环境关联数组</span></span><br><span class="line">/tmp&gt; awk <span class="string">'BEGIN&#123; print ENVIRON["LOGNAME"] &#125;'</span>  <span class="comment">#注意 双引号</span></span><br><span class="line">ubuntu</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例2.遍历打印环境数组变量</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;</span></span><br><span class="line"><span class="string">  for(k in ENVIRON)&#123;</span></span><br><span class="line"><span class="string">    print k"="ENVIRON[k];</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"><span class="comment"># LESS=-R</span></span><br><span class="line"><span class="comment"># PAGER=less</span></span><br><span class="line"><span class="comment"># WSLENV=</span></span><br><span class="line"><span class="comment"># AWKPATH=.:/usr/share/awk</span></span><br><span class="line"><span class="comment"># OLDPWD=/mnt/e/githubProject/blog</span></span><br><span class="line"><span class="comment"># AWKLIBPATH=/usr/lib/x86_64-linux-gnu/gawk</span></span><br></pre></td></tr></table></figure></p>
<p><br><br>SUBSEP   数组下标分隔符用于多维数组的分割<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#注意此种方法输出无序</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;</span></span><br><span class="line"><span class="string">for(i=1;i&lt;=9;i++)&#123;</span></span><br><span class="line"><span class="string">  for(j=1;j&lt;=9;j++)&#123;</span></span><br><span class="line"><span class="string">    tarr[i,j]=i*j;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">  for(m in tarr)&#123;</span></span><br><span class="line"><span class="string">    split(m,tarr2,SUBSEP);</span></span><br><span class="line"><span class="string">    print tarr2[1],"*",tarr2[2],"=",tarr[m];</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br></pre></td></tr></table></figure></p>
<p><br><br>OFMT 设置输出数据格式是保留3位小数。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#保留指定位数的小数点后的数字,注意此时输出的时候不能使用""进行连接awk变量否则会失效：</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;</span></span><br><span class="line"><span class="string">    OFMT="%.3f";</span></span><br><span class="line"><span class="string">    f1=20/3;</span></span><br><span class="line"><span class="string">    f2=cos(15%4);</span></span><br><span class="line"><span class="string">    f3=sin(5^2);</span></span><br><span class="line"><span class="string">    print "f1=",f1, "f2=",f2, "f3=",f3;</span></span><br><span class="line"><span class="string">  &#125;'</span></span><br><span class="line">f1= 6.667 f2= -0.990 f3= -0.132</span><br></pre></td></tr></table></figure></p>
<hr/>

<h4 id="0x04-awk运算与判断"><a href="#0x04-awk运算与判断" class="headerlink" title="0x04 awk运算与判断"></a>0x04 awk运算与判断</h4><p>作为一种程序设计语言所应具有的特点之一，awk支持多种运算，这些运算与C语言提供的基本相同。函数的引用大大的提高了awk的运算功能。作为对条件转移指令的一部分，关系判断是每种程序设计语言都具备的功能，</p>
<ul>
<li>awk还提供了一系列内置的运算函数（如<code>log、sqr、cos、sin等</code>）和一些用于对字符串进行操作（运算）的函数（<code>如length、substr等等</code>）</li>
<li>awk中允许进行多种测试，作为样式匹配，还提供了模式匹配表达式~（匹配）和~!（不匹配）。</li>
<li>awk也支持用逻辑运算符作为对测试的一种扩充</li>
</ul>
<p><br></p>
<figure class="image-box">
                <a rel=AWK三剑客入门与进阶 href="https://weiyigeek-1251733653.cos.ap-chengdu.myqcloud.com/2019/20190719105814.png" target="_blank" title="WeiyiGeek.算数运算符" data-fancybox="images"><img src="https://weiyigeek-1251733653.cos.ap-chengdu.myqcloud.com/2019/20190719105814.png" alt="WeiyiGeek.算数运算符" title="" class=""></a>
                <p>WeiyiGeek.算数运算符</p>
            </figure>
<figure class="image-box">
                <a rel=AWK三剑客入门与进阶 href="https://weiyigeek-1251733653.cos.ap-chengdu.myqcloud.com/2019/20190719110319.png" target="_blank" title="WeiyiGeek.赋值运算符" data-fancybox="images"><img src="https://weiyigeek-1251733653.cos.ap-chengdu.myqcloud.com/2019/20190719110319.png" alt="WeiyiGeek.赋值运算符" title="" class=""></a>
                <p>WeiyiGeek.赋值运算符</p>
            </figure>
<figure class="image-box">
                <a rel=AWK三剑客入门与进阶 href="https://weiyigeek-1251733653.cos.ap-chengdu.myqcloud.com/2019/20190719111438.png" target="_blank" title="WeiyiGeek.逻辑运算符" data-fancybox="images"><img src="https://weiyigeek-1251733653.cos.ap-chengdu.myqcloud.com/2019/20190719111438.png" alt="WeiyiGeek.逻辑运算符" title="" class=""></a>
                <p>WeiyiGeek.逻辑运算符</p>
            </figure>
<figure class="image-box">
                <a rel=AWK三剑客入门与进阶 href="https://weiyigeek-1251733653.cos.ap-chengdu.myqcloud.com/2019/20190719111546.png" target="_blank" title="WeiyiGeek.正则运算符" data-fancybox="images"><img src="https://weiyigeek-1251733653.cos.ap-chengdu.myqcloud.com/2019/20190719111546.png" alt="WeiyiGeek.正则运算符" title="" class=""></a>
                <p>WeiyiGeek.正则运算符</p>
            </figure>
<figure class="image-box">
                <a rel=AWK三剑客入门与进阶 href="https://weiyigeek-1251733653.cos.ap-chengdu.myqcloud.com/2019/20190719111855.png" target="_blank" title="WeiyiGeek.关系运算符" data-fancybox="images"><img src="https://weiyigeek-1251733653.cos.ap-chengdu.myqcloud.com/2019/20190719111855.png" alt="WeiyiGeek.关系运算符" title="" class=""></a>
                <p>WeiyiGeek.关系运算符</p>
            </figure>
<figure class="image-box">
                <a rel=AWK三剑客入门与进阶 href="https://weiyigeek-1251733653.cos.ap-chengdu.myqcloud.com/2019/20190719112313.png" target="_blank" title="WeiyiGeek.其他运算符" data-fancybox="images"><img src="https://weiyigeek-1251733653.cos.ap-chengdu.myqcloud.com/2019/20190719112313.png" alt="WeiyiGeek.其他运算符" title="" class=""></a>
                <p>WeiyiGeek.其他运算符</p>
            </figure>
<p>运算符优先级列表：<br><figure class="image-box">
                <a rel=AWK三剑客入门与进阶 href="https://weiyigeek-1251733653.cos.ap-chengdu.myqcloud.com/2019/20190719113232.png" target="_blank" title="WeiyiGeek.运算符优先级" data-fancybox="images"><img src="https://weiyigeek-1251733653.cos.ap-chengdu.myqcloud.com/2019/20190719113232.png" alt="WeiyiGeek.运算符优先级" title="" class=""></a>
                <p>WeiyiGeek.运算符优先级</p>
            </figure></p>
<p>运算符示例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#算数运算符</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;a="a";print a++,++a;&#125;'</span>  <span class="comment">#字母默认都是为0 </span></span><br><span class="line">0 2</span><br><span class="line">awk <span class="string">'BEGIN&#123;a=1;print a++,++a;&#125;'</span>  </span><br><span class="line">1 3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#赋值运算符</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;a=1;b=2; print a "+" b " =",b+=a&#125;'</span>  </span><br><span class="line">1+2 = 3</span><br><span class="line">awk <span class="string">'BEGIN&#123;a=2;b=3; print a "**" b " =",a**=b&#125;'</span>  <span class="comment">#幂运算的两种形式</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;a=2;b=3; print a "^" b " =",a^=b&#125;'</span>  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#逻辑运算符</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;a=1;b=2; print (a&gt;5 &amp;&amp; b&lt;=2),(a&gt;5 || b&lt;=2);&#125;'</span></span><br><span class="line">0 1                        <span class="comment"># false           true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#正则运算符与逻辑判断</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;a="100testa";if(a ~ /^a/) &#123;print "ok";&#125;else&#123;print "fasle";&#125;&#125;'</span></span><br><span class="line">fasle</span><br><span class="line">awk <span class="string">'BEGIN&#123;a="100testa";if(a !~ /^100*/)&#123;print "yes";&#125;else&#123;print "no"&#125;&#125;'</span></span><br><span class="line">no</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#关系运算符</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;a=11;if(a &gt;= 9)&#123;print "ok";&#125;else&#123;printf "no";&#125;&#125;'</span>  <span class="comment">#ok</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;a=13;if(a &gt;= 9 &amp;&amp; 12&gt;=a )&#123;print "ok";&#125;else&#123;printf "no\n";&#125;&#125;'</span> <span class="comment">#no</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;a="weiyi";b="geek"; if(a&gt;b)&#123;print "a字符串大于b字符串";&#125;else&#123;printf "a字符串小于b字符串"&#125;&#125;'</span></span><br><span class="line">a字符串大于b字符串</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#其他运算符</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;a="b";print a=="b"?"ok":"err";&#125;'</span>     <span class="comment">#ok 三元运算符</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;a="b";arr[0]="b";arr[1]="c";print (a in arr);&#125;'</span> <span class="comment">#0</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;a="b";arr[0]="b";arr["b"]="c";print (a in arr);&#125;'</span> <span class="comment">#1</span></span><br></pre></td></tr></table></figure></p>
<p>基础示例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例0.一个每一行中第一个字段值累加的例子：</span></span><br><span class="line">seq 5 | awk <span class="string">'BEGIN&#123; sum=0;printf "总和：" &#125; &#123;printf $1"+"; sum+=$1 &#125; END&#123; printf "等于"; printf sum &#125;'</span>  <span class="comment">#内部定义的变量可以不加$</span></span><br><span class="line">总和：1+2+3+4+5等于15</span><br><span class="line"></span><br><span class="line"><span class="comment">#示例1.AWK进行小数计算 ($类似于引用)</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"5.5 6.6"</span> | awk <span class="string">'&#123;print ($2 - $1)&#125;'</span>       <span class="comment">#计算结果：1.1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"5.5 6.6"</span> | awk <span class="string">'&#123;print ($2 - $1) / 3 &#125;'</span>  <span class="comment">#计算结果：0.366667</span></span><br></pre></td></tr></table></figure></p>
<p><em>注意：</em> </p>
<ul>
<li>所有用作算术运算符进行操作，操作数自动转为数值，所有非数值都变为0</li>
<li><code>&gt;</code> <code>&lt;</code>可以作为字符串比较，也可以用作数值比较，关键看操作数如果是字符串就会转换为字符串比较。</li>
<li>两个都为数字才转为数值比较,<code>字符串比较按照ASCII码顺序比较</code>。</li>
</ul>
<p><br></p>
<h4 id="0x05-awk数组应用"><a href="#0x05-awk数组应用" class="headerlink" title="0x05 awk数组应用"></a>0x05 awk数组应用</h4><p> 数组是awk的灵魂处理文本中最不能少的就是它的数组处理，因为数组索引（下标）可以是数字和字符串在awk中数组叫做<code>关联数组(associative arrays)</code>。</p>
<ul>
<li>awk 中的数组不必提前声明，也不必声明大小。</li>
<li>数组元素<code>用0或空字符串来初始化</code>，这根据上下文而定。</li>
</ul>
<p>关联与索引数组定义：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数字做数组索引（下标）：awk索引下标默认是从1开始的，但您也可以设置从0开始</span></span><br><span class="line">Array[0]=<span class="string">"GEEK"</span></span><br><span class="line">Array[1]=<span class="string">"sun"</span></span><br><span class="line">Array[2]=<span class="string">"kai"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串做数组索引（下标）：</span></span><br><span class="line">Array[<span class="string">"age"</span>]=15</span><br><span class="line">Array[<span class="string">"name"</span>]=<span class="string">"weiyigeek"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用中print Array[1]会打印出sun；</span></span><br><span class="line"><span class="comment">#使用print Array[2]会打印出kai；</span></span><br><span class="line"><span class="comment">#使用print["birth"]会得到1987。</span></span><br></pre></td></tr></table></figure></p>
<p>数组示例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#我们可以利用循环来读取索引数组与关联数组，以上面的变量为例</span></span><br><span class="line"><span class="comment">#方式1：&#123; for(i=1;i&lt;=len;i++) &#123;print array[i]&#125;; &#125;  #Len是数组的长度</span></span><br><span class="line"><span class="comment">#方式2：</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;</span></span><br><span class="line"><span class="string">    Array[0]="GEEK";</span></span><br><span class="line"><span class="string">    Array[1]="sun";</span></span><br><span class="line"><span class="string">    Array[2]="kai";</span></span><br><span class="line"><span class="string">    for(item in Array)&#123;</span></span><br><span class="line"><span class="string">      print "第",item+1,"个元素："Array[item]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;'</span></span><br><span class="line"><span class="comment"># 第 1 个元素：GEEK</span></span><br><span class="line"><span class="comment"># 第 2 个元素：sun</span></span><br><span class="line"><span class="comment"># 第 3 个元素：kai</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#关联数组</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;</span></span><br><span class="line"><span class="string">  Array["name"]="weiyigeek";</span></span><br><span class="line"><span class="string">  Array["age"]=15;</span></span><br><span class="line"><span class="string">  STR="";</span></span><br><span class="line"><span class="string">  STR1="";</span></span><br><span class="line"><span class="string">  for(item in Array)</span></span><br><span class="line"><span class="string">  &#123;</span></span><br><span class="line"><span class="string">    if( item == "name" )</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      STR="我的姓名是:"Array[item];</span></span><br><span class="line"><span class="string">    &#125;else if( item == "age" )&#123;</span></span><br><span class="line"><span class="string">      STR1=",我的年龄是:"Array[item];</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  print STR,STR1</span></span><br><span class="line"><span class="string">  &#125;'</span></span><br><span class="line"><span class="comment">#我的姓名是:weiyigeek ,我的年龄是:15</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除键值：delete array[key]可以删除，对应数组key的，序列值。</span></span><br><span class="line"></span><br><span class="line">$ awk <span class="string">'BEGIN&#123;</span></span><br><span class="line"><span class="string">  tB["a"]="a1";tB["b"]="b1";</span></span><br><span class="line"><span class="string">  delete tB["a"];</span></span><br><span class="line"><span class="string">  for(k in tB)&#123;</span></span><br><span class="line"><span class="string">    print k,tB[k];</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;'</span>                     </span><br><span class="line">b b1</span><br></pre></td></tr></table></figure></p>
<h5 id="二维、多维数组使用"><a href="#二维、多维数组使用" class="headerlink" title="二维、多维数组使用"></a>二维、多维数组使用</h5><p>awk的多维数组在本质上是一维数组，但是awk在存储上并不支持多维数组;<br>awk提供了逻辑上模拟二维数组的访问方式。<br>例如<code>array[2,4]=1</code>这样的访问是允许的。</p>
<p>awk多维数组新特点：</p>
<ul>
<li>类似一维数组的成员测试，多维数组可以使用<code>if ( (i,j) in array)</code>这样的语法，但是下标必须放置在圆括号中。</li>
<li>类似一维数组的循环访问，多维数组使用<code>for ( item in array )</code>这样的语法遍历数组</li>
<li>与一维数组不同的是多维数组<code>必须使用split()函数来访问单独的下标分量</code>。</li>
</ul>
<p>基础示例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方法1.九九乘法表, 可以通过array[k,k2]引用获得数组内容。</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;</span></span><br><span class="line"><span class="string">for(i=1;i&lt;=9;i++)&#123;</span></span><br><span class="line"><span class="string">  for(j=1;j&lt;=9;j++)&#123;</span></span><br><span class="line"><span class="string">    tarr[i,j]=i*j; printf i"*"j"="tarr[i,j]" ";</span></span><br><span class="line"><span class="string">    if( j == 9)&#123;</span></span><br><span class="line"><span class="string">      print ""</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"><span class="comment"># 1*1=1 1*2=2 1*3=3 1*4=4 1*5=5 1*6=6 1*7=7 1*8=8 1*9=9 </span></span><br><span class="line"><span class="comment"># 2*1=2 2*2=4 2*3=6 2*4=8 2*5=10 2*6=12 2*7=14 2*8=16 2*9=18</span></span><br><span class="line"><span class="comment"># 3*1=3 3*2=6 3*3=9 3*4=12 3*5=15 3*6=18 3*7=21 3*8=24 3*9=27</span></span><br><span class="line"><span class="comment"># 4*1=4 4*2=8 4*3=12 4*4=16 4*5=20 4*6=24 4*7=28 4*8=32 4*9=36</span></span><br><span class="line"><span class="comment"># 5*1=5 5*2=10 5*3=15 5*4=20 5*5=25 5*6=30 5*7=35 5*8=40 5*9=45</span></span><br><span class="line"><span class="comment"># 6*1=6 6*2=12 6*3=18 6*4=24 6*5=30 6*6=36 6*7=42 6*8=48 6*9=54</span></span><br><span class="line"><span class="comment"># 7*1=7 7*2=14 7*3=21 7*4=28 7*5=35 7*6=42 7*7=49 7*8=56 7*9=63</span></span><br><span class="line"><span class="comment"># 8*1=8 8*2=16 8*3=24 8*4=32 8*5=40 8*6=48 8*7=56 8*8=64 8*9=72</span></span><br><span class="line"><span class="comment"># 9*1=9 9*2=18 9*3=27 9*4=36 9*5=45 9*6=54 9*7=63 9*8=72 9*9=81</span></span><br></pre></td></tr></table></figure></p>
<p><em>注意事项</em>：</p>
<ul>
<li>awk数组是关联数组，只要通过数组引用它的key，就会自动创建改序列，所以当Array[“c”]没有定义但是循环时候，发现已经<code>存在该键值并且它的值为空</code></li>
</ul>
<p><br></p>
<h4 id="0x06-awk流程控制"><a href="#0x06-awk流程控制" class="headerlink" title="0x06 awk流程控制"></a>0x06 awk流程控制</h4><p>在linux中awk里面也能进行流程控制，流程控制语句/语法结构与C语言类似，有了这些语句很多shell程序都可以交给awk进行,而且性能非常的快;</p>
<ul>
<li>条件分支：if</li>
<li>循环判断：while, do…while, for</li>
<li>其他语句：break, Continue, exit<ul>
<li>break 当 break 语句用于 while 或 for 语句时，导致退出程序循环。</li>
<li>continue 当 continue 语句用于 while 或 for 语句时，使程序循环移动到下一个迭代。</li>
<li>next 能能够导致读入下一个输入行，并返回到脚本的顶部。这可以避免对当前输入行执行其他的操作过程。</li>
<li>exit 语句使主输入循环退出并将控制转移到END,如果END存在的话。如果没有定义END规则或在END中应用exit语句，则终止脚本的执行。</li>
</ul>
</li>
</ul>
<p><em>条件判断</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例1.判断优良差</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;</span></span><br><span class="line"><span class="string">test=100;</span></span><br><span class="line"><span class="string">if(test&gt;90)&#123;</span></span><br><span class="line"><span class="string">  print "very good - 优";</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  else if(test&gt;60)&#123;</span></span><br><span class="line"><span class="string">    print "good";</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  else&#123;</span></span><br><span class="line"><span class="string">    print "no pass";</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#very good - 优</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例2.指定普通用户按照终端显示 (每条命令语句后面可以用;分号结尾)。 </span></span><br><span class="line">awk <span class="string">'BEGIN&#123; FS=":"&#125; &#123; if( "/bin/zsh" == $7)&#123; print $0":"$7; &#125;else if ("/usr/sbin/nologin" == $7)&#123; print $1":nologin";&#125; &#125;'</span> /etc/passwd | sort -t <span class="string">":"</span> -k </span><br><span class="line">3 -r</span><br><span class="line"><span class="comment"># ubuntu:x:1000:1000:,,,:/home/ubuntu:/bin/zsh:/bin/zsh</span></span><br><span class="line"><span class="comment"># root:x:0:0:root:/root:/bin/zsh:/bin/zsh</span></span><br><span class="line"><span class="comment"># www-data:nologin</span></span><br><span class="line"><span class="comment"># uuidd:nologin</span></span><br><span class="line"><span class="comment"># uucp:nologin</span></span><br><span class="line"><span class="comment"># messagebus:nologin</span></span><br><span class="line"><span class="comment"># man:nologin</span></span><br><span class="line"><span class="comment"># mail:nologin</span></span><br><span class="line"><span class="comment"># lp:nologin</span></span><br><span class="line"><span class="comment"># list:nologin</span></span><br><span class="line"><span class="comment"># landscape:nologin</span></span><br><span class="line"><span class="comment"># irc:nologin</span></span><br><span class="line"><span class="comment"># gnats:nologin</span></span><br><span class="line"><span class="comment"># games:nologin</span></span><br><span class="line"><span class="comment"># dnsmasq:nologin</span></span><br><span class="line"><span class="comment"># daemon:nologin</span></span><br><span class="line"><span class="comment"># bin:nologin</span></span><br><span class="line"><span class="comment"># backup:nologin</span></span><br><span class="line"><span class="comment"># _apt:nologin</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><em>循环语句</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例1.采用awk的while语句,进行1加到100百;</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;</span></span><br><span class="line"><span class="string">test=100;</span></span><br><span class="line"><span class="string">total=0;</span></span><br><span class="line"><span class="string">while(i&lt;=test)&#123;</span></span><br><span class="line"><span class="string">  total+=i;</span></span><br><span class="line"><span class="string">  i++;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">print "1+..+100=",total;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"><span class="comment">#1+..+100= 5050</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例2.采用awk的for语句,进行1加到100百;</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;</span></span><br><span class="line"><span class="string">  TOTAL=0;</span></span><br><span class="line"><span class="string">  for(i=0;i&lt;=100;i++)&#123;</span></span><br><span class="line"><span class="string">    total+=i</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  print "1+...+100="total</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"><span class="comment">#1+...+100=5050</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#for格式2.遍历环境变量数组输出</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;</span></span><br><span class="line"><span class="string">  for(k in ENVIRON)&#123;</span></span><br><span class="line"><span class="string">    print k"="ENVIRON[k];</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例3.采用awk的do..while语句,进行1加到100百;</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;</span></span><br><span class="line"><span class="string">  TOTAL=0</span></span><br><span class="line"><span class="string">  num=0</span></span><br><span class="line"><span class="string">  do</span></span><br><span class="line"><span class="string">  &#123;</span></span><br><span class="line"><span class="string">    TOTAL+=num</span></span><br><span class="line"><span class="string">    num++</span></span><br><span class="line"><span class="string">  &#125; while(num&lt;=100)</span></span><br><span class="line"><span class="string">  printf "1+...+100="TOTAL</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"><span class="comment">#1+...+100=5050</span></span><br></pre></td></tr></table></figure></p>
<p>实际案例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#判断键值存在以及删除键值,注意awk关联数组的特点;</span></span><br><span class="line"><span class="comment">#错误的判断方法：</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;tB["a"]="a1";tB["b"]="b1";if(tB["c"]!="1")&#123;print "no found";&#125;;for(k in tB)&#123;print k,tB[k];&#125;&#125;'</span> </span><br><span class="line"><span class="comment">#正确判断方法： if(key in array)通过这种方法判断数组中是否包含key键值。</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;tB["a"]="a1";tB["b"]="b1";if( "c" in tB)&#123;print "ok";&#125;;for(k in tB)&#123;print k,tB[k];&#125;&#125;'</span>  </span><br><span class="line">a a1</span><br><span class="line">b b1</span><br></pre></td></tr></table></figure></p>
<p><em>注意事项</em>：</p>
<ul>
<li>for…in输出，因为数组是关联数组，默认是无序的;所以通过for…in得到是无序的数组。如果需要得到有序数组，需要通过下标获得。</li>
</ul>
<p><br></p>
<h4 id="0x07-awk函数"><a href="#0x07-awk函数" class="headerlink" title="0x07 awk函数"></a>0x07 awk函数</h4><p>awk内置函数，主要分以下3种类似：算数函数、字符串函数、其它一般函数、时间函数。</p>
<h5 id="算数函数"><a href="#算数函数" class="headerlink" title="算数函数"></a>算数函数</h5><p>格式    描述</p>
<ul>
<li>atan2( y, x )    返回 y/x 的反正切。</li>
<li>cos( x )    返回 x 的余弦；x 是弧度。</li>
<li>sin( x )    返回 x 的正弦；x 是弧度。</li>
<li>exp( x )    返回 x 幂函数。</li>
<li>log( x )    返回 x 的自然对数。</li>
<li>sqrt( x )    返回 x 平方根。</li>
<li>int( x )    返回 x 的截断至整数的值。</li>
<li>rand( )    返回任意数字 n，其中 0 &lt;= n &lt; 1。</li>
<li>srand( [expr] )    将 rand 函数的种子值设置为 Expr 参数的值，或如果省略 Expr 参数则使用某天的时间。返回先前的种子值。</li>
</ul>
<p>示例说明：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 算数函数的使用(注意输出的时候不能有""拼接)</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;OFMT="%.3f";fs=sin(1);fe=exp(10);fl=log(10);fi=int(3.1415);print fs,fe,fl,fi;&#125;'</span></span><br><span class="line">0.841 22026.466 2.303 3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得随机数srand</span></span><br><span class="line"><span class="variable">$awk</span> <span class="string">'BEGIN&#123;srand();fr=int(100*rand());print fr;&#125;'</span></span><br><span class="line">78</span><br><span class="line"><span class="variable">$awk</span> <span class="string">'BEGIN&#123;srand();fr=int(100*rand());print fr;&#125;'</span></span><br><span class="line">31</span><br><span class="line"><span class="variable">$awk</span> <span class="string">'BEGIN&#123;srand();fr=int(100*rand());print fr;&#125;'</span></span><br><span class="line">41</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h5><table>
<thead>
<tr>
<th>格式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>gsub( Ere, Repl, [ In ] )</td>
<td>除了正则表达式所有具体值被替代这点，它和 sub 函数完全一样地执行。</td>
</tr>
<tr>
<td>sub( Ere, Repl, [ In ] )</td>
<td>用 Repl 参数指定的字符串替换 In 参数指定的字符串中的由 Ere 参数指定的扩展正则表达式的第一个具体值。sub 函数返回替换的数量。出现在 Repl 参数指定的字符串中的 &amp;（和符号）由 In 参数指定的与 Ere 参数的指定的扩展正则表达式匹配的字符串替换。如果未指定 In 参数，缺省值是整个记录（$0 记录变量）。</td>
</tr>
<tr>
<td>index( String1, String2 )</td>
<td>在由 String1 参数指定的字符串（其中有出现 String2 指定的参数）中，返回位置，从 1 开始编号。如果 String2 参数不在 String1 参数中出现，则返回 0（零）。</td>
</tr>
<tr>
<td>length [(String)]</td>
<td>返回 String 参数指定的字符串的长度（字符形式）。如果未给出 String 参数，则返回整个记录的长度（$0 记录变量）。</td>
</tr>
<tr>
<td>blength [(String)]</td>
<td>返回 String 参数指定的字符串的长度（以字节为单位）。如果未给出 String 参数，则返回整个记录的长度（$0 记录变量）。</td>
</tr>
<tr>
<td>substr( String, M, [ N ] )</td>
<td>返回具有 N 参数指定的字符数量子串。子串从 String 参数指定的字符串取得，其字符以 M 参数指定的位置开始。M 参数指定为将 String 参数中的第一个字符作为编号 1。如果未指定 N 参数，则子串的长度将是 M 参数指定的位置到 String 参数的末尾 的长度。</td>
</tr>
<tr>
<td>match( String, Ere )</td>
<td>在 String 参数指定的字符串（Ere 参数指定的扩展正则表达式出现在其中）中返回位置（字符形式），从 1 开始编号，或如果 Ere 参数不出现，则返回 0（零）。RSTART 特殊变量设置为返回值。RLENGTH 特殊变量设置为匹配的字符串的长度，或如果未找到任何匹配，则设置为 -1（负一）。</td>
</tr>
<tr>
<td>split( String, A, [Ere] )</td>
<td>将 String 参数指定的参数分割为数组元素 A[1], A[2], . . ., A[n]，并返回 n 变量的值。此分隔可以通过 Ere 参数指定的扩展正则表达式进行，或用当前字段分隔符（FS 特殊变量）来进行（如果没有给出 Ere 参数）。除非上下文指明特定的元素还应具有一个数字值，否则 A 数组中的元素用字符串值来创建。</td>
</tr>
<tr>
<td>tolower( String )</td>
<td>返回 String 参数指定的字符串，字符串中每个大写字符将更改为小写。大写和小写的映射由当前语言环境的 LC_CTYPE 范畴定义。</td>
</tr>
<tr>
<td>toupper( String )</td>
<td>返回 String 参数指定的字符串，字符串中每个小写字符将更改为大写。大写和小写的映射由当前语言环境的 LC_CTYPE 范畴定义。</td>
</tr>
<tr>
<td>sprintf(Format, Expr, Expr, . . . )</td>
<td>根据 Format 参数指定的 printf 子例程格式字符串来格式化 Expr 参数指定的表达式并返回最后生成的字符串。</td>
</tr>
</tbody>
</table>
<p>常用函数使用：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gsub,sub使用利用正则匹配</span></span><br><span class="line"><span class="comment"># 在 info中查找满足正则表达式，/[0-9]+/用"!"替换，并且替换后的值赋值给info未给info值默认是$0</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;</span></span><br><span class="line"><span class="string">  info="this is a test2010test!";</span></span><br><span class="line"><span class="string">  gsub(/[0-9]+/,"!",info);print info</span></span><br><span class="line"><span class="string">  sub(/test!+/,"[replace]",info);print info</span></span><br><span class="line"><span class="string">  &#125;'</span></span><br><span class="line">this is a <span class="built_in">test</span>!<span class="built_in">test</span>!</span><br><span class="line">this is a [replace]<span class="built_in">test</span>!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找字符串（index使用）,并且采用三元运算符</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;info="this is a test2010test!";print index(info,"test")?"ok":"no found";&#125;'</span></span><br><span class="line">ok</span><br><span class="line"></span><br><span class="line"><span class="comment">#正则表达式匹配查找(match使用）</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;info="this is a test2010test!";print match(info,/[0-9]+/)?"ok":"no found";&#125;'</span></span><br><span class="line">ok</span><br><span class="line"></span><br><span class="line"><span class="comment"># 截取字符串(substr使用）</span></span><br><span class="line"><span class="variable">$awk</span> <span class="string">'BEGIN&#123;info="this is a test2010test!";print substr(info,4,10);&#125;'</span></span><br><span class="line">s is a tes</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"WeiyiGeek LIVE Computer"</span> | awk <span class="string">'&#123;print  substr($0,0,9)&#125;'</span></span><br><span class="line">WeiyiGeek</span><br></pre></td></tr></table></figure></p>
<p><strong>split函数</strong><br>描述：把变量out转化成数组mon然后打印数组mon的第二个元素，并且返回数组长度工作中非常有用;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#split()函数分割成的数组是从1开始的</span></span><br><span class="line">awk <span class="string">'BEGIN&#123; "date" | getline out; split(out,mon); print mon[2] &#125;'</span></span><br><span class="line">Jul</span><br><span class="line"><span class="comment"># Fri Jul 19 12:25:12 CST 2019 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定分隔符进行分割</span></span><br><span class="line">awk <span class="string">'BEGIN&#123; "id" | getline out; split(out,mon,","); print mon[3] &#125;'</span></span><br><span class="line">20(dialout)</span><br><span class="line"><span class="comment"># groups=1000(ubuntu),4(adm),20(dialout),24(cdrom),25(floppy),27(sudo),29(audio),30(dip),44(video),46(plugdev),108(lxd),114(netdev)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#输出数组与下标（有序for() 和无序 in）</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;info="it is a test";tlen=split(info,tA," ");for(k=1;k&lt;=tlen;k++)&#123;print k,tA[k];&#125;&#125;'</span></span><br><span class="line"><span class="comment"># 1 it</span></span><br><span class="line"><span class="comment"># 2 is</span></span><br><span class="line"><span class="comment"># 3 a</span></span><br><span class="line"><span class="comment"># 4 test</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;info="it is a test";split(info,tA," ");for(k in tA)&#123;print k,tA[k];&#125;&#125;'</span></span><br><span class="line"><span class="comment"># 4 test</span></span><br><span class="line"><span class="comment"># 1 it</span></span><br><span class="line"><span class="comment"># 2 is</span></span><br><span class="line"><span class="comment"># 3 a</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>length函数</strong><br>描述：利用length函数可以得到数组的元素的个数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># length返回字符串以及数组长度，split进行分割字符串为数组，也会返回分割得到数组长度。</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;</span></span><br><span class="line"><span class="string">  info="it is a test";</span></span><br><span class="line"><span class="string">  lens=split(info,tA," ");</span></span><br><span class="line"><span class="string">  print "数组长度："length(tA),lens;</span></span><br><span class="line"><span class="string">  &#125;'</span></span><br><span class="line"><span class="comment">#tA 为数组名称 </span></span><br><span class="line"><span class="comment">#数组长度：4 4</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>sprintf函数</strong><br>sprintf主要用于返回格式化后的字符串;其中格式化字符串包括两部分内容：</p>
<ul>
<li>一部分是正常字符，这些字符将按原样输出; </li>
<li>另一部分是格式化规定字符，以”%”开始，后跟一个或几个规定字符,用来确定输出内容格式。</li>
</ul>
<figure class="image-box">
                <a rel=AWK三剑客入门与进阶 href="https://weiyigeek-1251733653.cos.ap-chengdu.myqcloud.com/2019/20190719164104.png" target="_blank" title="WeiyiGeek.sprintf函数" data-fancybox="images"><img src="https://weiyigeek-1251733653.cos.ap-chengdu.myqcloud.com/2019/20190719164104.png" alt="WeiyiGeek.sprintf函数" title="" class=""></a>
                <p>WeiyiGeek.sprintf函数</p>
            </figure>
<p>基础示例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#printf与sprintf的不同</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;n1=124.113;n2=-1.224;n3=1.2345; printf("%.2f,%.2u,%.2g,%X,%on",n1,n2,n3,n1,n1);&#125;'</span></span><br><span class="line">124.11,18446744073709551615,1.2,7C,174</span><br><span class="line"></span><br><span class="line">awk <span class="string">'BEGIN&#123;n1=124.113;n2=-1.224;n3=1.2345; S1=sprintf("%.2f,%.2u,%.2g,%X,%on",n1,n2,n3,n1,n1);print S1&#125;'</span></span><br><span class="line">124.11,18446744073709551615,1.2,7C,174n</span><br></pre></td></tr></table></figure></p>
<hr>

<h5 id="一般函数"><a href="#一般函数" class="headerlink" title="一般函数"></a>一般函数</h5><table>
<thead>
<tr>
<th>格式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>close( Expression )</td>
<td>用同一个带字符串值的 Expression 参数来关闭由 print 或 printf 语句打开的或调用 getline 函数打开的文件或管道。如果文件或管道成功关闭，则返回 0；其它情况下返回非零值。如果打算写一个文件，并稍后在同一个程序中读取文件，则 close 语句是必需的。</td>
</tr>
<tr>
<td>system(command )</td>
<td>执行 Command 参数指定的命令，并返回退出状态。等同于 system 子例程。</td>
</tr>
<tr>
<td>Expression</td>
<td>getline [ Variable ]</td>
<td>从来自 Expression 参数指定的命令的输出中通过管道传送的流中读取一个输入记录，并将该记录的值指定给 Variable 参数指定的变量。如果当前未打开将 Expression 参数的值作为其命令名称的流，则创建流。创建的流等同于调用 popen 子例程，此时 Command 参数取 Expression 参数的值且 Mode 参数设置为一个是 r 的值。只要流保留打开且 Expression 参数求得同一个字符串，则对 getline 函数的每次后续调用读取另一个记录。如果未指定 Variable 参数，则 $0 记录变量和 NF 特殊变量设置为从流读取的记录。</td>
</tr>
<tr>
<td>getline [ Variable ] &lt; Expression</td>
<td>从 Expression 参数指定的文件读取输入的下一个记录，并将 Variable 参数指定的变量设置为该记录的值。只要流保留打开且 Expression 参数对同一个字符串求值，则对 getline 函数的每次后续调用读取另一个记录。如果未指定 Variable 参数，则 $0 记录变量和 NF 特殊变量设置为从流读取的记录。</td>
</tr>
<tr>
<td>getline [ Variable ]</td>
<td>将 Variable 参数指定的变量设置为从当前输入文件读取的下一个输入记录。如果未指定 Variable 参数，则 $0 记录变量设置为该记录的值，还将设置 NF、NR 和 FNR 特殊变量。</td>
</tr>
</tbody>
</table>
<p><br></p>
<p><strong>asort函数</strong><br>描述：asort对数组进行排序，并且返回数组长度。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">'BEGIN&#123;</span></span><br><span class="line"><span class="string">  info="it is a test";</span></span><br><span class="line"><span class="string">  split(info,tA," ");</span></span><br><span class="line"><span class="string">  print asort(tA);</span></span><br><span class="line"><span class="string">  &#125;'</span></span><br><span class="line"><span class="comment">#4</span></span><br></pre></td></tr></table></figure><br><br></p>
<p><strong>getline函数</strong><br>用法：输出重定向需用到getline函数。getline从标准输入、管道或者当前正在处理的文件之外的其他输入文件获得输入。它负责从输入获得下一行的内容，并给NF/NR和FNR等内建变量赋值。</p>
<p>getline语法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk getline</span><br><span class="line">getline var <span class="comment">#变量var包含了特定行的内容。</span></span><br></pre></td></tr></table></figure></p>
<p>返回值：</p>
<ul>
<li>如果得到一条记录getline函数返回1，</li>
<li>如果到达文件的末尾就返回0，</li>
<li>如果出现错误，例如打开文件失败，就返回-1。</li>
</ul>
<p>用法说明： </p>
<ul>
<li>当其左右 无 重定向符|或&lt;时：getline作用于当前文件，读入当前文件的第一行给其后跟的变量var或$0（无变量），应该注意到，由于awk在处理getline之前已经读入了一行，所以getline得到的返回结果是隔行的。<br>-当其左右 有 重定向符|或&lt;时：getline则作用于定向输入文件，由于该文件是刚打开，并没有被awk读入一行，只是getline读入，那么getline返回的是该文件的第一行而不是隔行。 </li>
</ul>
<p>基础示例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例1.执行shell的date命令，并通过管道输出给getline，然后getline从管道中读取并将输入赋值给out： </span></span><br><span class="line">/tmp&gt; awk <span class="string">'BEGIN&#123; "date" | getline out; print out &#125;'</span> <span class="built_in">test</span></span><br><span class="line">Fri Jul 19 12:22:37 CST 2019</span><br><span class="line">/tmp&gt; awk <span class="string">'BEGIN&#123; "id" | getline out; print out &#125;'</span> <span class="built_in">test</span></span><br><span class="line">uid=1000(ubuntu) gid=1000(ubuntu) groups=1000(ubuntu),4(adm),20(dialout),24(cdrom),25(floppy),27(sudo),29(audio),30(dip),44(video),46(plugdev),108(lxd),114(netdev)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例2.命令ls的输出传递给geline作为输入，循环使getline从ls的输出中读取一行，并把它打印到屏幕。</span></span><br><span class="line">awk <span class="string">'BEGIN&#123; while( "ls" | getline) print &#125;'</span> <span class="comment">#没有输入文件，因为BEGIN块在打开输入文件前执行，所以可以忽略输入文件。</span></span><br><span class="line"><span class="comment"># npm-252-6a2b6463</span></span><br><span class="line"><span class="comment"># test.txt</span></span><br><span class="line">awk <span class="string">'BEGIN&#123; while( "cat /etc/passwd" | getline) print &#125;'</span> | head -5</span><br><span class="line"><span class="comment"># root:x:0:0:root:/root:/bin/zsh</span></span><br><span class="line"><span class="comment"># daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span></span><br><span class="line"><span class="comment"># bin:x:2:2:bin:/bin:/usr/sbin/nologin</span></span><br><span class="line"><span class="comment"># sys:x:3:3:sys:/dev:/usr/sbin/nologin</span></span><br><span class="line"><span class="comment"># sync:x:4:65534:sync:/bin:/bin/sync</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例3.接受来之stdin的输入(值得学习)</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;printf "Enter your name:";getline name;print "My name is "name;&#125;'</span></span><br><span class="line">Enter your name:WeiyiGeek</span><br><span class="line">My name is WeiyiGeek</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>close函数</strong><br>描述:awk中允许在程序中关闭一个输入或输出文件，方法是使用awk的close语句。<br>filename可以是getline打开的文件:<code>close(&quot;filename&quot;)</code></p>
<ul>
<li>也可以是stdin，包含文件名的变量或者getline使用的确切命令。</li>
<li>或一个输出文件可以是stdout，包含文件名的变量或使用管道的确切命令。</li>
</ul>
<p>基础示例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$awk</span> <span class="string">'BEGIN&#123;while("cat /etc/passwd"|getline)&#123;print $0;&#125;;close("/etc/passwd");&#125;'</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 逐行读取外部文件(getline使用方法）</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;while(getline &lt; "/etc/passwd")&#123;print $0;&#125;;close("/etc/passwd");&#125;'</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>system函数</strong><br>描述：主要运用于调用外部应用程序，非常有用值得借鉴学习;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例1</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;b=system("ls -al");print b;&#125;'</span></span><br><span class="line"><span class="comment"># total 42092</span></span><br><span class="line"><span class="comment"># drwxr-xr-x 14 chengmo chengmo     4096 09-30 17:47 .</span></span><br><span class="line"><span class="comment"># drwxr-xr-x 95 root   root       4096 10-08 14:01 ..</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例2:补充案例修改 (去除![] 和 ()),变量处有$符号   </span></span><br><span class="line">git ls-files | grep <span class="string">".md"</span> | xargs sed -i <span class="string">"s#wxx.com#xxx.cn#g"</span></span><br><span class="line">git ls-files | grep <span class="string">".md"</span> | xargs grep <span class="string">"xxx.myqcloud.com"</span> | awk -F <span class="string">"[:/]"</span>  <span class="string">'&#123;if($NF &gt;= 2019072515)&#123;print $0&#125;&#125;'</span> &gt; text.txt</span><br><span class="line">awk -F <span class="string">":"</span> <span class="string">'&#123; $cmd="sed s#"$2"#1/"$2"#g " $1; print $cmd;&#125;'</span> text.txt</span><br><span class="line">awk -F <span class="string">":"</span> <span class="string">'&#123; $cmd="sed -i s#"$2"#1/"$2"#g " $1; system($cmd); &#125;'</span> text.txt</span><br></pre></td></tr></table></figure><br><br></p>
<h5 id="时间函数"><a href="#时间函数" class="headerlink" title="时间函数"></a>时间函数</h5><ul>
<li>mktime( YYYY MM dd HH MM ss[ DST])    生成时间格式</li>
<li>strftime([format [, timestamp]])    格式化时间输出，将时间戳转为时间字符串具体格式，见下表.</li>
<li>systime()    得到时间戳,返回从1970年1月1日开始到当前时间(不计闰年)的整秒数</li>
</ul>
<p>strftime日期和时间格式说明符<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">格式	描述</span><br><span class="line">%a	星期几的缩写(Sun)</span><br><span class="line">%A	星期几的完整写法(Sunday)</span><br><span class="line">%b	月名的缩写(Oct)</span><br><span class="line">%B	月名的完整写法(October)</span><br><span class="line">%c	本地日期和时间</span><br><span class="line">%d	十进制日期</span><br><span class="line">%D	日期 08/20/99</span><br><span class="line">%e	日期，如果只有一位会补上一个空格</span><br><span class="line">%H	用十进制表示24小时格式的小时</span><br><span class="line">%I	用十进制表示12小时格式的小时</span><br><span class="line">%j	从1月1日起一年中的第几天</span><br><span class="line">%m	十进制表示的月份</span><br><span class="line">%M	十进制表示的分钟</span><br><span class="line">%p	12小时表示法(AM/PM)</span><br><span class="line">%S	十进制表示的秒</span><br><span class="line">%U	十进制表示的一年中的第几个星期(星期天作为一个星期的开始)</span><br><span class="line">%w	十进制表示的星期几(星期天是0)</span><br><span class="line">%W	十进制表示的一年中的第几个星期(星期一作为一个星期的开始)</span><br><span class="line">%x	重新设置本地日期(08/20/99)</span><br><span class="line">%X	重新设置本地时间(12：00：00)</span><br><span class="line">%y	两位数字表示的年(99)</span><br><span class="line">%Y	当前月份</span><br><span class="line">%Z	时区(PDT)</span><br><span class="line">%%	百分号(%)</span><br></pre></td></tr></table></figure></p>
<p>基础示例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#建指定时间(mktime使用）</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;</span></span><br><span class="line"><span class="string">  tstamp=mktime("2001 01 01 12 12 12");</span></span><br><span class="line"><span class="string">  print strftime("%c",tstamp);</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line">2001年01月01日 星期一 12时12分12秒</span><br><span class="line"></span><br><span class="line"><span class="comment">#返回两个时间只差利用mktime与systime</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;tstamp1=mktime("2001 01 01 12 12 12");tstamp2=mktime("2001 02 01 0 0 0");print tstamp2-tstamp1;&#125;'</span></span><br><span class="line">2634468</span><br><span class="line">awk <span class="string">'BEGIN&#123;tstamp1=mktime("2001 01 01 12 12 12");tstamp2=systime();print tstamp2-tstamp1;&#125;'</span> </span><br><span class="line">308201392</span><br><span class="line"></span><br><span class="line"><span class="comment">#strftime使用</span></span><br><span class="line">awk <span class="string">'BEGIN&#123; print strftime("%c",systime()) &#125;'</span></span><br><span class="line"><span class="comment"># Fri 19 Jul 2019 05:06:09 PM CST</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;tstamp=systime();print strftime("%c",tstamp);&#125;'</span></span><br><span class="line">awk <span class="string">'BEGIN&#123;tstamp=systime();print strftime("%j",tstamp);&#125;'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ls | awk <span class="string">'&#123; len=split($1,images,".");</span></span><br><span class="line"><span class="string">filename=images[1];</span></span><br><span class="line"><span class="string">suffix=images[len];</span></span><br><span class="line"><span class="string">tstamp=systime();</span></span><br><span class="line"><span class="string">datetime=strftime("%Y%m%d%H%M%S",tstamp)"."suffix;</span></span><br><span class="line"><span class="string">cmd="echo "$1" "datetime"&gt;&gt; 1.txt &amp; mv "$1" "datetime" &amp; sleep 1";</span></span><br><span class="line"><span class="string">system(cmd);</span></span><br><span class="line"><span class="string">print cmd;</span></span><br><span class="line"><span class="string">&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line </span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">old=$(<span class="built_in">echo</span> <span class="variable">$&#123;line&#125;</span>|cut -f1 -d <span class="string">" "</span>)</span><br><span class="line">new=$(<span class="built_in">echo</span> <span class="variable">$&#123;line&#125;</span>|cut -f2 -d <span class="string">" "</span>)</span><br><span class="line">sed -i <span class="string">"s#index_files/<span class="variable">$&#123;old&#125;</span>#https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/wiz1/<span class="variable">$&#123;new&#125;</span>#g"</span> 常见编程语言对字符编码解码一览表.md</span><br><span class="line"><span class="keyword">done</span> &lt; 1.txt</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=AWK三剑客入门与进阶 href="https://weiyigeek-1251733653.cos.ap-chengdu.myqcloud.com/2019/20190719170801.png" target="_blank" title="WeiyiGeek.strftime示例" data-fancybox="images"><img src="https://weiyigeek-1251733653.cos.ap-chengdu.myqcloud.com/2019/20190719170801.png" alt="WeiyiGeek.strftime示例" title="" class=""></a>
                <p>WeiyiGeek.strftime示例</p>
            </figure></p>
<hr/>

<h4 id="0x08-awk高级利用"><a href="#0x08-awk高级利用" class="headerlink" title="0x08 awk高级利用"></a>0x08 awk高级利用</h4><h5 id="实践扩展"><a href="#实践扩展" class="headerlink" title="实践扩展"></a>实践扩展</h5><p><strong>1.读取下一条记录-{next}</strong><br>awk中在循环逐行匹配里如果遇到next语句就会直接跳入到下一行，一般用于多行合并;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例0.当记录行号除以2余1，就跳过当前行下面的print NR,$0也不会执行</span></span><br><span class="line"><span class="comment">#下一行判断NR%2值,这个时候记录行号是：2 ，就会执行下面语句块：'print NR,$0'.</span></span><br><span class="line"><span class="variable">$blog</span>&gt; seq 5 | awk <span class="string">'NR%2==1&#123;next&#125;&#123;print "第"NR"行",$0;&#125;'</span></span><br><span class="line">第2行 2</span><br><span class="line">第4行 4</span><br><span class="line"></span><br><span class="line"><span class="comment">#示例2</span></span><br><span class="line"><span class="variable">$cat</span> test.txt</span><br><span class="line">web01[192.168.2.100]</span><br><span class="line">httpd            ok</span><br><span class="line">tomcat               ok</span><br><span class="line">sendmail               ok</span><br><span class="line">web02[192.168.2.101]</span><br><span class="line">httpd            ok</span><br><span class="line">postfix               ok</span><br><span class="line">web03[192.168.2.102]</span><br><span class="line">mysqld            ok</span><br><span class="line">httpd               ok</span><br><span class="line"></span><br><span class="line"><span class="comment"># next是关键注意单算引号得使用,如果存在web字符串的行则将值赋给T，然后进入下一次循环</span></span><br><span class="line">awk <span class="string">'/^web/&#123;T=$0;next;&#125;&#123;print T":"$0;&#125;'</span> test.txt  </span><br><span class="line">web01[192.168.2.100]:httpd            ok</span><br><span class="line">web01[192.168.2.100]:tomcat           ok</span><br><span class="line">web01[192.168.2.100]:sendmail         ok</span><br><span class="line">web02[192.168.2.101]:httpd            ok</span><br><span class="line">web02[192.168.2.101]:postfix          ok</span><br><span class="line">web03[192.168.2.102]:mysqld           ok</span><br><span class="line">web03[192.168.2.102]:httpd            ok</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>2.记录输出</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例1.输出内容到一个文件</span></span><br><span class="line"><span class="built_in">echo</span> | awk <span class="string">'&#123;print("Hello World!\n") &gt;&gt; "date"&#125;'</span>;cat date</span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>3.利用awk进行xml文件解析</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">  xsi:schemaLocation=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;top.weiyigeek&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;Platform&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0.0&lt;/version&gt;</span><br><span class="line">  &lt;packaging&gt;jar&lt;/packaging&gt;</span><br><span class="line">&lt;/project&gt;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line">awk <span class="string">'/&lt;\/*name\/*&gt;/&#123;gsub(/[[:space:]]*&lt;\/*name\/*&gt;/,"");print $0&#125;'</span> pom.xml | head -n 1</span><br><span class="line">awk <span class="string">'/&lt;\/*artifactId\/*&gt;/&#123;gsub(/[[:space:]]*&lt;\/*artifactId\/*&gt;/,"");print $0&#125;'</span> pom.xml | head -n 1</span><br><span class="line">awk <span class="string">'/&lt;\/*version\/*&gt;/&#123;gsub(/[[:space:]]*&lt;\/*version\/*&gt;/,"");print $0&#125;'</span> pom.xml | head -n 1</span><br><span class="line">awk <span class="string">'/&lt;\/*packaging\/*&gt;/&#123;gsub(/[[:space:]]*&lt;\/*packaging\/*&gt;/,"");print $0&#125;'</span> pom.xml | head -n 1</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>3.shell去除字符串中最后一个字符</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方式1.awk</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"www.weiyigeek.top-"</span> | awk <span class="string">'&#123;sub(/.$/,"")&#125;1'</span></span><br><span class="line">www.weiyigeek.top</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式2.sed</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"www.weiyigeek.top-"</span> | sed <span class="string">'s/.$//'</span></span><br><span class="line">www.weiyigeek.top</span><br></pre></td></tr></table></figure>
<p><br></p>
<h5 id="awk脚本"><a href="#awk脚本" class="headerlink" title="awk脚本"></a>awk脚本</h5><p>采用awk -f选项来指定脚本文件，注意蛇棒是#/bin/awk</p>
<p>示例1：采用脚本文件输出数组<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; awk.script &lt;&lt;END</span><br><span class="line">BEGIN &#123;</span><br><span class="line">  array[1]=<span class="string">"Weiyi"</span>;</span><br><span class="line">  array[2]=<span class="string">"geek"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(item <span class="keyword">in</span> array)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">print</span> <span class="string">"Key:"</span>item,<span class="string">"Value:"</span>array[item]</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="built_in">print</span> <span class="string">"arr = "</span>arr;</span><br><span class="line">&#125;</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行命令及其效果</span></span><br><span class="line">$ awk -f awk.script -v arr=<span class="string">"add"</span>  <span class="comment">#注意后面设置的变量</span></span><br><span class="line">Key:1 Value:Weiyi</span><br><span class="line">Key:2 Value:geek</span><br><span class="line">arr = add  <span class="comment">#关键点</span></span><br></pre></td></tr></table></figure></p>

        </div>
        <!-- Google 广告 -->
        
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
  

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> 欢迎各位志同道合的朋友一起学习交流，如文章有误请在下方留下您宝贵的经验知识，个人邮箱地址<b style="color:#ff654e"><code>【master#weiyigeek.top】</code></b>或者个人公众号<b style="color:#ff654e"><code>【WeiyiGeek】</code></b>联系我。 </p>
  <p> 更多文章来源于<b style="color:#03a9f4">【WeiyiGeek Blog - 为了能到远方，脚下的每一步都不能少】</b>, 个人首页地址( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"【点个赞】，动动你那粗壮的拇指或者芊芊玉手，亲！"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"【投个币】，万水千山总是情，投个硬币行不行，亲！")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("【收个藏】，阅后即焚不吃灰，亲！")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("【转个发】，让更多的志同道合的朋友一起学习交流，亲！")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("【关个注】，后续浏览查看不迷路哟，亲！")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="扫描Follow(关注)WeiyiGeek公众号与Visit(浏览)极客全栈修炼小程序" >
    <p>专栏书写不易，如果您觉得这个专栏还不错的，请给这篇专栏 <b style="color: red;">【点个赞、投个币、收个藏、关个注、转个发、赞个助】</b>，这将对我的肯定，我将持续整理发布更多优质原创文章！。</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    最后更新时间：<time datetime="2022-05-07T01:37:26.091Z" itemprop="dateUpdated">2022-05-07 09:37:26</time>
</span><br>


        <span>文章原始路径：<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/系统运维/Linux/常用命令/脚本常用类命令/awk三剑客入门与进阶.md" target="_blank" rel="noopener noreferrer">_posts/系统运维/Linux/常用命令/脚本常用类命令/awk三剑客入门与进阶.md</a></span><br>
         <span class="copy-copyright">转载注明出处，原文地址：<a href="/2019/6-26-175.html" target="_blank" rel="external">https://blog.weiyigeek.top/2019/6-26-175.html</a></span><br>本站文章内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">☕️ 请作者喝杯咖啡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/" rel="tag">shell</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/6-26-175.html&title=《AWK三剑客入门与进阶》 — WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/6-26-175.html&title=《AWK三剑客入门与进阶》 — WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/6-26-175.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《AWK三剑客入门与进阶》 — WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/6-26-175.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/6-26-175.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- 评论组件 -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/6-26-177.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Sed三剑客入门与进阶</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/6-26-176.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">grep三剑客入门与进阶指南</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x00-快速入门"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 快速入门</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x01-命令格式和选项"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 命令格式和选项</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x02-awk的工作原理"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 awk的工作原理</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x03-awk内置变量（预定义变量）"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 awk内置变量（预定义变量）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x04-awk运算与判断"><span class="post-toc-number">5.</span> <span class="post-toc-text">0x04 awk运算与判断</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x05-awk数组应用"><span class="post-toc-number">6.</span> <span class="post-toc-text">0x05 awk数组应用</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x06-awk流程控制"><span class="post-toc-number">7.</span> <span class="post-toc-text">0x06 awk流程控制</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x07-awk函数"><span class="post-toc-number">8.</span> <span class="post-toc-text">0x07 awk函数</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x08-awk高级利用"><span class="post-toc-number">9.</span> <span class="post-toc-text">0x08 awk高级利用</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    


    <!-- 支付宝微信文章赞赏 -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        如果此篇文章对您有帮助，就请作者喝杯 Coffee ☕️☕️!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="微信打赏二维码">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="支付宝打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>

      

    <!-- 微信公众号关注/文章版权复制 -->
    
      <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">你好朋友,可以关个注吗? ❤ <br> 这将是我持续更新文章的动力源泉，谢谢支持！(๑′ᴗ‵๑) </b> <br> 如不想关注请点击右上角的【X】<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">【My Twitter】</a></strong>. There is an article verification code in the homepage.
<br>方式2.请访问本博主的B站<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">【WeiyiGeek】</a></strong>首页关注UP主,<br>将自动随机获取解锁验证码。
<br>方式3.扫一扫下方二维码，关注本站<strong>官方公众号</strong><br>
回复：<strong style="color: rgb(240, 65, 52);">验证码</strong>
将获取<strong style="color: rgb(240, 65, 52);">解锁(有效期7天)</strong>本站所有技术文章哟!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="请输入验证码|Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">提
    交</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - 为了能到远方，脚下的每一步都不能少</p>
</div>
        
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">公众账号</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">哔哩哔哩专栏</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">个人Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">个人Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">个人知乎</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">博客园</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">今日头条</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">简书</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">腾讯云+云社区</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">百度文库</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">IT极客知识分享</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTO博客</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">掘金</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">微博文章</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">小红书</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">抖音主页</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">快手主页</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.唯一极客IT知识分享 版权所有 </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>访问统计
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-站点地图">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-百度站点地图">站点地图</a> </span>
        <!-- 
  -->
        <br/>ICP备案号<span><a href="https://beian.miit.gov.cn" target="_blank">渝ICP备2022003447号</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSL安全认证" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/6-26-175.html&title=《AWK三剑客入门与进阶》 — WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/6-26-175.html&title=《AWK三剑客入门与进阶》 — WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/6-26-175.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《AWK三剑客入门与进阶》 — WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/6-26-175.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/6-26-175.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMklEQVR42u3aQVLDMAwF0N7/0mHNMEm/JMpg+3nFlOL4ZSFkSa9XvK6b9fO3d9+/2/PuKa9PLAwMjGUZ1+Pqfef5k2dS9bkYGBjnMPKtnx+Wh+lknzxYY2BgYORHnIdgDAwMjDkjCZ3Pd8x/EXAxMDAWZCShc54IVstzH7mLY2BgLMjIq+5///NH+hsYGBhLMa7iSgr3eYCenOTbnhgYGFsz8gA3Ke7nF9reeTAwMPZm9Er/OWxegIs+wcDAOJKRHy45aPK31WZnFHAxMDC2YPQeX20PTBqWk/QRAwNjD0ZvbKIa/vKmZu9FYGBg7M2oHrF6oa0ml9UBteb/DQwMjAUZoyyyNRFRPUMhQcTAwNiOkRe5eqW3yW6FfTAwMA5gVAvxyaU0ucpOCm1vWpgYGBgbMaqhbT6KOmlCjPJQDAyMZRm94Yk84UuKZb0QHGW4GBgYWzPKA1iDBuev9TEwMDA2ZUwK9/lY2PyqPEoTMTAwNmVUt+uNhfVeTTRygYGBsR0jH/BKxrnyMbJqge8NBgMD4wBGtXCfFOby62j+gt5Mt2FgYBzAqB6uFxx7JbxybouBgbEF4yquXmLXC7J5MoqBgbE3o9cZzI+eX4N7aWIZg4GBsSyjF2R719e85VAN2RgYGCcw5gfqjXFUU73b3TAwMDDiQYpewM0HL6JhCwwMjOMZhVmzeOQrHwu7xWNgYBzA6BXUeuE4D68fKbdhYGAsyJhMasxJ+Z69QI+BgbE44wvWz/oIv/TtLAAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // 百度统计
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-关注于网络安全_物联网安全开发_网络安全运维-学习心得分享';
                clearTimeout(titleTime);
            } else {
                document.title = '(つェ⊂)咦!又好了!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>