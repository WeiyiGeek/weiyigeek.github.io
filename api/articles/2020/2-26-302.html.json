{"title":"Servlet基础入门学习2","slug":"编程世界/JavaWeb/1.Servlet/Servlet基础入门学习2","date":"2020-02-26T05:34:30.000Z","updated":"2022-03-29T05:39:06.300Z","url":"2020/2-26-302.html","path":"api/articles/2020/2-26-302.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200227152447.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200229161445.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x01-Servlet-进阶\"><a href=\"#0x01-Servlet-进阶\" class=\"headerlink\" title=\"0x01 Servlet 进阶\"></a>0x01 Servlet 进阶</h4><h5 id=\"1-Cookies\"><a href=\"#1-Cookies\" class=\"headerlink\" title=\"1.Cookies\"></a>1.Cookies</h5><p><strong>1) 什么是Cookies?</strong></p>\n<blockquote>\n<p>英文翻译为饼干,它实际是一个信息记录程序，是服务器给客户端记录信息使用并且会存储在客户端上，用户可以随意的操纵(<code>实际上不安全</code>);</p>\n</blockquote>\n<p><br></p>\n<p><strong>2) Cookies有什么用?</strong></p>\n<blockquote>\n<p>由于HTTP协议请求是无状态的，客户端（多次）与服务器在通信的时候，服务器不知道该客户端是否曾经来访过，为了提高用户的体验以及收集用户的操作数据而使用(<code>实际上记录客户端上的用户使用信息</code>)</p>\n</blockquote>\n<p><br></p>\n<p><strong>3) Servlet中如何使用Cookies?</strong><br>基础语法:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//1.在Servlet响应的时候进行添加Cookies,此时用户在收到响应头中会多一个set-Cookies字段; </span></span><br><span class=\"line\">response.addCookie(<span class=\"keyword\">new</span> Cookie(name, value));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//2.设置Cookies后客户端再下一次请求的时候会将该请求带代入，我们可以用Servlet请求进行获取;</span></span><br><span class=\"line\">Cookie[] cook = request.getCookies();</span><br><span class=\"line\"><span class=\"comment\">//防止出现空指针</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(cook != <span class=\"keyword\">null</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (Cookie cookie : cook) &#123;</span><br><span class=\"line\">    response.getWriter().append(cookie.getName() + <span class=\"string\">\" ：\"</span> + cookie.getValue());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//3.Cookies失效期设置一般关闭浏览器则数据消失负值，而如果是正值则按照其设置秒数进行设置失效时间</span></span><br><span class=\"line\">Cookie age = <span class=\"keyword\">new</span> Cookie(<span class=\"string\">\"age\"</span>, <span class=\"string\">\"18\"</span>);</span><br><span class=\"line\">age.setMaxAge(<span class=\"number\">60</span> * <span class=\"number\">60</span> * <span class=\"number\">24</span> * <span class=\"number\">7</span>); <span class=\"comment\">//单位秒，正值时间过期，负值时间关闭浏览器即失效;</span></span><br><span class=\"line\">age.setMaxAge(<span class=\"number\">0</span>);  <span class=\"comment\">//删除Cookie</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//4.设置新值（设置后任然需要进行提交）</span></span><br><span class=\"line\">age.setValue(<span class=\"string\">\"2020\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//5.设置用于指定请求了指定的域名才会带上该Cookies</span></span><br><span class=\"line\">age.setDomain(<span class=\"string\">\"127.0.0.1\"</span>); <span class=\"comment\">//只有在127.0.0.1该域才生效（可以区分内外网络）</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//6.设置访问域名下的路径才会带有此Cookies</span></span><br><span class=\"line\">age.setPath(<span class=\"string\">\"/\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//7.设置HttpOnly防止JS获取Cookies</span></span><br><span class=\"line\">age.setHttpOnly(<span class=\"keyword\">true</span>);</span><br></pre></td></tr></table></figure></p>\n<p>基础实例:获取用户上次登陆的时间;<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Servlet 设置 Cookies 验证</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo1</span> <span class=\"keyword\">extends</span> <span class=\"title\">HttpServlet</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">1L</span>;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doGet</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">    response.setContentType(<span class=\"string\">\"text/html; charset=UTF-8\"</span>);</span><br><span class=\"line\">    <span class=\"comment\">//1.内容回显</span></span><br><span class=\"line\">    response.getWriter().append(<span class=\"string\">\"Served at: \"</span>).append(request.getContextPath()+<span class=\"string\">\"&lt;br/&gt;\"</span>);</span><br><span class=\"line\">    String name = request.getParameter(<span class=\"string\">\"name\"</span>);</span><br><span class=\"line\">    String value =request.getParameter(<span class=\"string\">\"value\"</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//2.设置Cookies和有效期默认是7天</span></span><br><span class=\"line\">    Cookie xm = <span class=\"keyword\">new</span> Cookie(name, value);</span><br><span class=\"line\">    xm.setMaxAge(<span class=\"number\">60</span> * <span class=\"number\">60</span>); <span class=\"comment\">// 失效时间 1个小时</span></span><br><span class=\"line\">    response.addCookie(xm);</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"设置的Cookie1: \"</span> + name + <span class=\"string\">\" = \"</span> + value);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//3.设置Cookies的有效期和HTTPOnly</span></span><br><span class=\"line\">    Cookie age = <span class=\"keyword\">new</span> Cookie(<span class=\"string\">\"age\"</span>, <span class=\"string\">\"18\"</span>);</span><br><span class=\"line\">    age.setHttpOnly(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">    age.setDomain(<span class=\"string\">\"127.0.0.1\"</span>);     <span class=\"comment\">//只有在127.0.0.1该域才生效（可以区分内外网络）</span></span><br><span class=\"line\">    age.setPath(<span class=\"string\">\"/\"</span>);  <span class=\"comment\">//设置域下访问的网页</span></span><br><span class=\"line\">    age.setMaxAge(<span class=\"number\">60</span> * <span class=\"number\">60</span> * <span class=\"number\">24</span> * <span class=\"number\">7</span>); <span class=\"comment\">//单位秒，正值时间过期，负值时间关闭浏览器即失效;</span></span><br><span class=\"line\">    age.setValue(<span class=\"string\">\"2020\"</span>);   <span class=\"comment\">//重新设置Cookie值</span></span><br><span class=\"line\">    response.addCookie(age);</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"设置的Cookie2: \"</span> + age.getName() + <span class=\"string\">\" = \"</span> + age.getValue());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//3.获取请求的Cookies</span></span><br><span class=\"line\">    Cookie[] cook = request.getCookies();</span><br><span class=\"line\">    <span class=\"comment\">//防止出现空指针</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(cook != <span class=\"keyword\">null</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (Cookie cookie : cook) &#123;</span><br><span class=\"line\">        String cn = cookie.getName();</span><br><span class=\"line\">        String cv = cookie.getValue();</span><br><span class=\"line\">        response.getWriter().append(cn + <span class=\"string\">\" ：\"</span> + cv + <span class=\"string\">\"&lt;br&gt;\"</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"comment\">//4.显示最近访问的时间是什么时候;</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"string\">\"name\"</span>.equals(name) &amp;&amp; <span class=\"string\">\"WeiyiGeek\"</span>.equals(value))</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      System.out.println(<span class=\"string\">\"用户登陆成功:\"</span>+ name);</span><br><span class=\"line\">      Cookie lastTime = until(cook,<span class=\"string\">\"lasttime\"</span>); <span class=\"comment\">//调用工具类进行查找</span></span><br><span class=\"line\">      <span class=\"comment\">//判断用户是否首测登陆过</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span>(lastTime == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        Cookie currentTime = <span class=\"keyword\">new</span> Cookie(<span class=\"string\">\"lasttime\"</span>,<span class=\"keyword\">new</span> Date().getTime()+<span class=\"string\">\"\"</span>);</span><br><span class=\"line\">        currentTime.setMaxAge(<span class=\"number\">60</span>*<span class=\"number\">60</span>);</span><br><span class=\"line\">        response.addCookie(currentTime);</span><br><span class=\"line\">      &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">long</span> lastVisitTime = Long.parseLong(lastTime.getValue()); <span class=\"comment\">//解析转换字符串为</span></span><br><span class=\"line\">        response.getWriter().append(<span class=\"string\">\"&lt;b&gt;当前用户最近登陆时间:&lt;/b&gt;\"</span>+<span class=\"keyword\">new</span> Date(lastVisitTime));</span><br><span class=\"line\">        lastTime.setValue(<span class=\"keyword\">new</span> Date().getTime()+<span class=\"string\">\"\"</span>);        <span class=\"comment\">//重置用户登陆的时间</span></span><br><span class=\"line\">        response.addCookie(lastTime);  <span class=\"comment\">//修改后重新响应提交</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">      response.getWriter().append(<span class=\"string\">\"&lt;b&gt;账号或者密码错误&lt;/b&gt;\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//5.工具类：搜素</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> Cookie <span class=\"title\">until</span><span class=\"params\">(Cookie[] userCook,String flag)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(userCook != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span>(Cookie ucook: userCook)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(flag.equals(ucook.getName()))&#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> ucook;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//6.工具类，清除Cookies</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> Boolean <span class=\"title\">clearCookie</span><span class=\"params\">(Cookie cook)</span></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        cook.setvalue(<span class=\"string\">\"\"</span>);</span><br><span class=\"line\">        cook.setMaxAge(<span class=\"number\">0</span>);</span><br><span class=\"line\">        response.addCookie(cook);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doPost</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// TODO Auto-generated method stub</span></span><br><span class=\"line\">    doGet(request, response);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200227152447.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p><br></p>\n<p><strong>4) 总结补充</strong></p>\n<ul>\n<li>浏览器支持每台Web服务器有20个Cookie,总共有300Cookie，其中每一个Cookie的大小为4KB；</li>\n<li>采用Cookie由于数据是存放在本地的容易出现安全等问题(比如Cookie盗用);</li>\n</ul>\n<p>所以为了解决上面这些问题，采用了下面所学的Session方法进行记录用户Client的身份;</p>\n<p><br></p>\n<h5 id=\"2-Session\"><a href=\"#2-Session\" class=\"headerlink\" title=\"2.Session\"></a>2.Session</h5><p><strong>1) 什么是Session?</strong><br>描述:英文翻译为会话，它是基于Cookie的一种会话机制（技术），它不同于Cookie的是Session是服务端返回给客户端的标识，实际存储在服务器上，而在客户端浏览器里面Cookie会记录该Session值;</p>\n<p><br></p>\n<p><strong>2) 有什么用Session?</strong><br>描述:记录客户端多次请求访问标识并存储用户的信息,常使用在HTTP客户端与服务端的对话，并且保留指定时间段可以跨多个连接来着用户的页面请求，而服务端也可以采用多种方式维护会话如(使用Cookie或者重写URL);</p>\n<p>在客户端访问Tomcat中网页的时候会生成一个Session并且添加到Cookie中即<code>JSESSIONID=abc2FE1NT6GCYczGAQpcx</code></p>\n<p><br></p>\n<p><strong>3) 如何使用Session API?</strong><br>基础语法:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//1.获取用户的Session会话ID</span></span><br><span class=\"line\">HttpSession session = request.getSession();</span><br><span class=\"line\">String sessionid = session.getId();</span><br><span class=\"line\">response.getWriter().append(<span class=\"string\">\"&lt;h5&gt;用户当前Session会话ID值 :   \"</span> + sessionid + <span class=\"string\">\"&lt;/h5&gt;&lt;br&gt;\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//2.采用Session进行存值(在浏览器没有关闭后在没到失效时间时存放的值任然存在)</span></span><br><span class=\"line\">session.setAttribute(<span class=\"string\">\"name\"</span>, name);</span><br><span class=\"line\">session.setAttribute(<span class=\"string\">\"pass\"</span>, pass);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//3.获取Session中获取的值</span></span><br><span class=\"line\">session.getAttribute(<span class=\"string\">\"name\"</span>);</span><br><span class=\"line\">session.getAttribute(<span class=\"string\">\"pass\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//4.移除值</span></span><br><span class=\"line\">session.removeAttribute(<span class=\"string\">\"name\"</span>);</span><br><span class=\"line\">session.removeAttribute(<span class=\"string\">\"pass\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//5.关闭会话</span></span><br><span class=\"line\">session.invalidate();</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p>基础示例:<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%<span class=\"meta\">@page</span> <span class=\"keyword\">import</span>=<span class=\"string\">\"java.util.Map\"</span>%&gt;</span><br><span class=\"line\">&lt;%@ page language=<span class=\"string\">\"java\"</span> contentType=<span class=\"string\">\"text/html; charset=utf-8\"</span></span><br><span class=\"line\">    pageEncoding=<span class=\"string\">\"utf-8\"</span>%&gt;</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;meta charset=<span class=\"string\">\"utf-8\"</span>&gt;</span><br><span class=\"line\">&lt;title&gt;Session&lt;/title&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;h1&gt;Session 操作显示 &lt;/h1&gt;</span><br><span class=\"line\">&lt;p&gt;</span><br><span class=\"line\">&lt;!-- 简单的JSP定义说明 --&gt;</span><br><span class=\"line\">&lt;%! <span class=\"keyword\">int</span> a = <span class=\"number\">1234</span>; %&gt;</span><br><span class=\"line\">&lt;% <span class=\"keyword\">int</span> b = <span class=\"number\">1024</span>; %&gt;</span><br><span class=\"line\">&lt;b&gt;a 值 = &lt;/b&gt;&lt;%=a %&gt; &lt;br/&gt;</span><br><span class=\"line\">&lt;b&gt;b 值 = &lt;/b&gt;&lt;%=b %&gt; &lt;br/&gt;</span><br><span class=\"line\">&lt;/p&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!-- 登陆表单判断用户是否登录 --&gt;</span><br><span class=\"line\">&lt;!-- <span class=\"comment\">//3.获取会话设置的属性 --&gt;</span></span><br><span class=\"line\">&lt;% <span class=\"keyword\">if</span> (session.getAttribute(<span class=\"string\">\"login\"</span>) != <span class=\"string\">\"yes\"</span>) &#123; %&gt;</span><br><span class=\"line\">&lt;form action=<span class=\"string\">\"Demo3\"</span> method=<span class=\"string\">\"get\"</span>&gt;</span><br><span class=\"line\">  用户名称: &lt;input type=<span class=\"string\">\"text\"</span> name=<span class=\"string\">\"name\"</span>&gt;&lt;br&gt;</span><br><span class=\"line\">  用户密码: &lt;input type=<span class=\"string\">\"password\"</span> name=<span class=\"string\">\"pass\"</span>&gt;&lt;br&gt;</span><br><span class=\"line\">  &lt;input type=<span class=\"string\">\"submit\"</span> value=<span class=\"string\">\"提交\"</span>&gt;</span><br><span class=\"line\">&lt;/form&gt;</span><br><span class=\"line\">&lt;% &#125; <span class=\"keyword\">else</span> &#123; %&gt;</span><br><span class=\"line\">  &lt;h4&gt;尊敬的用户您已经成功登录了&lt;/h4&gt; &lt;p&gt;&lt;a href=\"Demo3?action=logout\"&gt;注销登陆&lt;/a&gt;&lt;/p&gt;</span><br><span class=\"line\">  &lt;p&gt;请选择购买的商品：&lt;/p&gt;</span><br><span class=\"line\">  &lt;ol&gt;</span><br><span class=\"line\">    &lt;li&gt;&lt;a href='Demo3?id=1'&gt;安全数据&lt;/a&gt;&lt;/li&gt;</span><br><span class=\"line\">    &lt;li&gt;&lt;a href='Demo3?id=2'&gt;安全开发运维&lt;/a&gt;&lt;/li&gt;</span><br><span class=\"line\">    &lt;li&gt;&lt;a href='Demo3?id=3'&gt;DevOps&lt;/a&gt;&lt;/li&gt;</span><br><span class=\"line\">    &lt;li&gt;&lt;a href='Demo3?id=4'&gt;大型分布式网站架构&lt;/a&gt;&lt;/li&gt;</span><br><span class=\"line\">    &lt;li&gt;&lt;a href='Demo3?id=5'&gt;安全威胁分析&lt;/a&gt;&lt;/li&gt;</span><br><span class=\"line\">  &lt;/ol&gt;</span><br><span class=\"line\">  &lt;hr&gt;</span><br><span class=\"line\">  &lt;p&gt;您的购物车:&lt;a href=\"#cart\"&gt;go&lt;/a&gt;&lt;/p&gt;</span><br><span class=\"line\">  &lt;div&gt;</span><br><span class=\"line\">    &lt;table style=<span class=\"string\">\"border: 1px black solid\"</span> cellspacing=<span class=\"string\">\"1\"</span> cellpadding=<span class=\"string\">\"1\"</span>  rules=<span class=\"string\">\"all\"</span> align=<span class=\"string\">\"center\"</span>&gt;</span><br><span class=\"line\">      &lt;tr&gt;&lt;th&gt;商品名称&lt;/th&gt; &lt;th&gt;购买数量&lt;/th&gt;&lt;/tr&gt;</span><br><span class=\"line\">        &lt;% <span class=\"comment\">//6.从Session中获取到map;</span></span><br><span class=\"line\">          Map&lt;String,Integer&gt; map = (Map&lt;String, Integer&gt;) session.getAttribute(<span class=\"string\">\"cart\"</span>);</span><br><span class=\"line\">          <span class=\"comment\">//遍历Map</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (map != <span class=\"keyword\">null</span>)</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(String key: map.keySet())&#123;</span><br><span class=\"line\">              <span class=\"keyword\">int</span> value = map.get(key);</span><br><span class=\"line\">              %&gt;</span><br><span class=\"line\">              &lt;tr&gt; &lt;td&gt;&lt;%=key %&gt;&lt;/td&gt; &lt;td&gt;&lt;%=value %&gt; 本&lt;/td&gt; &lt;/tr&gt;</span><br><span class=\"line\">              &lt;% </span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            %&gt;</span><br><span class=\"line\">              &lt;tr&gt; &lt;td&gt;暂无&lt;/td&gt; &lt;td&gt;暂无&lt;/td&gt; &lt;/tr&gt;</span><br><span class=\"line\">            &lt;%</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        %&gt;</span><br><span class=\"line\">        </span><br><span class=\"line\">      &lt;/table&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">  &lt;br&gt;</span><br><span class=\"line\">  &lt;p&gt;&lt;a href=\"Demo3?action=del\"&gt;清空购物车&lt;/a&gt;&lt;/p&gt;</span><br><span class=\"line\">&lt;% &#125; %&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure><br><br></p>\n<p>Java代码:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> top.weiyigeek.sesssion;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.LinkedHashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServlet;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpSession;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo3</span> <span class=\"keyword\">extends</span> <span class=\"title\">HttpServlet</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">1L</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doGet</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//0.获取JSP页面传递过来的参数</span></span><br><span class=\"line\">    String name = request.getParameter(<span class=\"string\">\"name\"</span>);</span><br><span class=\"line\">    String pass = request.getParameter(<span class=\"string\">\"pass\"</span>);</span><br><span class=\"line\">    String action = request.getParameter(<span class=\"string\">\"action\"</span>);</span><br><span class=\"line\">    String product = request.getParameter(<span class=\"string\">\"id\"</span>);</span><br><span class=\"line\">    String[] productname = &#123;<span class=\"string\">\"安全数据\"</span>, <span class=\"string\">\"安全开发运维\"</span>, <span class=\"string\">\"DevOps\"</span>,<span class=\"string\">\"大型分布式网站架构\"</span> , <span class=\"string\">\"安全威胁分析\"</span>&#125;;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// TODO Auto-generated method stub</span></span><br><span class=\"line\">    response.setContentType(<span class=\"string\">\"text/html; charset=utf-8\"</span>);</span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (name != <span class=\"keyword\">null</span> &amp;&amp; pass != <span class=\"keyword\">null</span> ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(<span class=\"string\">\"admin\"</span>.equals(name) &amp;&amp; <span class=\"string\">\"123456\"</span>.equals(pass)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//1.获取当前用户的Session会话值</span></span><br><span class=\"line\">        String sessionid = request.getSession().getId();</span><br><span class=\"line\">        response.getWriter().append(<span class=\"string\">\"&lt;br&gt;用户登陆成功 &lt;br&gt;\"</span>).append(<span class=\"string\">\"当前 Session 会话值 : \"</span> + sessionid);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">//2.设置登陆会话属性</span></span><br><span class=\"line\">        request.getSession().setAttribute(<span class=\"string\">\"login\"</span>, <span class=\"string\">\"yes\"</span>);</span><br><span class=\"line\">        response.getWriter().append(<span class=\"string\">\"&lt;br&gt;&lt;a style='color:red' href='index.jsp'&gt;浏览商品&lt;/p&gt;\"</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        response.getWriter().append(<span class=\"string\">\"&lt;p style='color:red'&gt;账号或密码错误!&lt;/p&gt;\"</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//4.获取购物车存储的Session值</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> (product !=  <span class=\"keyword\">null</span> ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">int</span> id = Integer.parseInt(product);</span><br><span class=\"line\">      String idname = productname[id-<span class=\"number\">1</span>];</span><br><span class=\"line\">      Map&lt;String, Integer&gt; map = (Map&lt;String, Integer&gt;) request.getSession().getAttribute(<span class=\"string\">\"cart\"</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">       <span class=\"comment\">//首次</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span>(map == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//存入Map对象到Session</span></span><br><span class=\"line\">        map = <span class=\"keyword\">new</span> LinkedHashMap&lt;String, Integer&gt;();</span><br><span class=\"line\">        request.getSession().setAttribute(<span class=\"string\">\"cart\"</span>, map);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">      <span class=\"comment\">//判断是否存在该商品</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span>(map.containsKey(idname)) &#123;</span><br><span class=\"line\">        map.put(idname,map.get(idname)+<span class=\"number\">1</span>);</span><br><span class=\"line\">      &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        map.put(idname,<span class=\"number\">1</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\">//界面跳转</span></span><br><span class=\"line\">      response.getWriter().append(<span class=\"string\">\"&lt;br&gt;&lt;b&gt;添加到购物车成功!&lt;/b&gt;\"</span>);</span><br><span class=\"line\">      response.getWriter().append(<span class=\"string\">\"&lt;p&gt;&lt;a href='index.jsp'&gt;返回商品页&lt;/a&gt;&lt;/p&gt;\"</span>);</span><br><span class=\"line\">      response.getWriter().append(<span class=\"string\">\"&lt;p&gt;&lt;a href='index.jsp?#cart'&gt;我的购物车&lt;/a&gt;&lt;/p&gt;\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//7.清空购物车即session值与会话清除</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"string\">\"del\"</span>.equals(action)) &#123;</span><br><span class=\"line\">      HttpSession session = request.getSession();</span><br><span class=\"line\">      session.removeAttribute(<span class=\"string\">\"cart\"</span>);</span><br><span class=\"line\">      response.sendRedirect(<span class=\"string\">\"index.jsp\"</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"string\">\"logout\"</span>.equals(action)) &#123;</span><br><span class=\"line\">      <span class=\"comment\">//Session 会话清除</span></span><br><span class=\"line\">      request.getSession().invalidate();</span><br><span class=\"line\">      response.sendRedirect(<span class=\"string\">\"index.jsp\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doPost</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// TODO Auto-generated method stub</span></span><br><span class=\"line\">    doGet(request, response);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br>执行结果:访问<code>http://127.0.0.1:8080/Web/login.jsp</code><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200229161445.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p><br></p>\n<p>问题:Session何时创建又何时销毁?</p>\n<blockquote>\n<p>1.创建:在Servlet中调用运行request.getSession(); //如果没有则进行创建当前会话ID<br>2.销毁:Session会在服务器应用或者系统关闭时候和会话到期(默认30分钟在tomcat的web.xml配置文件中设置)进行自动销毁由于Session是存放在内存之中，如果想做持久化则可以才Redis、Postgre等NOSQL数据库；</p>\n</blockquote>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--\\Development\\apache-tomcat-9.0.31\\conf\\web.xml --&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- ==================== Default Session Configuration ================= --&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- You can set the default session timeout (in minutes) for all newly   --&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- created sessions by modifying the value below.                       --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">session-config</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">session-timeout</span>&gt;</span>30<span class=\"tag\">&lt;/<span class=\"name\">session-timeout</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">session-config</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<hr>\n<h4 id=\"0x01-补充说明\"><a href=\"#0x01-补充说明\" class=\"headerlink\" title=\"0x01 补充说明\"></a>0x01 补充说明</h4><h5 id=\"1-Servlet数量减少\"><a href=\"#1-Servlet数量减少\" class=\"headerlink\" title=\"1.Servlet数量减少\"></a>1.Servlet数量减少</h5><p>描述:在我们的日常开发如果针对于一个用户数据的增删改查，以我们前面的方式则需要创建五个Servlet，但是在实际的开发中会产生代码冗余，所以我们为了减少Servlet的数量我们可以通过以下方式解决;</p>\n<p>首先我们先来看看从客户端向服务端发起请求调用的几种方式:</p>\n<ul>\n<li>1.通过表单<code>&lt;form method=&quot;POST&quot; action=&quot;BaseServlet?method=UserLogin&quot;&gt;&lt;/form&gt;</code>发起服务端的请求</li>\n<li>2.通过链接<code>&lt;a href=&quot;BaseServlet?method=UserShow&quot;&gt;&lt;/a&gt;</code>发起服务端的请求</li>\n<li>3.通过Ajax异步请求服务端<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(<span class=\"built_in\">document</span>).ready(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  $.ajax(&#123;<span class=\"attr\">url</span>:<span class=\"string\">\"BaseServlet?method=UserVerity\"</span>,<span class=\"attr\">async</span>:<span class=\"literal\">true</span>,<span class=\"attr\">success</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">result</span>)</span>&#123; alert(result) &#125;&#125;);</span><br><span class=\"line\">  $.post(<span class=\"string\">\"BaseServlet\"</span>,&#123;<span class=\"string\">\"method\"</span>:<span class=\"string\">\"Userverity\"</span>,<span class=\"string\">\"user\"</span>:<span class=\"string\">\"tom\"</span>&#125;,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>)</span>&#123;alert(data)&#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>基础示例1:(当功能模块较少时候可以这样做)<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ServletDemo01</span> <span class=\"keyword\">extends</span> <span class=\"title\">HttpServlet</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">1L</span>;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doPost</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">    doGet(request, response);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doGet</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//获取客户端提交到服务端的method对应的值</span></span><br><span class=\"line\">    String md=request.getParameter(<span class=\"string\">\"method\"</span>);</span><br><span class=\"line\">    <span class=\"comment\">//定义变量,存放功能执行完毕之后要转发的路径</span></span><br><span class=\"line\">    String path=<span class=\"keyword\">null</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//通过判断md中不同的内容来决定本次功能</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"string\">\"addStu\"</span>.equals(md))&#123;</span><br><span class=\"line\">      path=addStu(request, response);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"string\">\"delStu\"</span>.equals(md))&#123;</span><br><span class=\"line\">      path=delStu(request, response);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"string\">\"checkStu\"</span>.equals(md))&#123;</span><br><span class=\"line\">      path=checkStu(request, response);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"string\">\"\"</span>.equals(md))&#123;</span><br><span class=\"line\">      path=<span class=\"string\">\"Index.html\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">null</span>!=path)&#123;</span><br><span class=\"line\">      <span class=\"comment\">//服务端的转发</span></span><br><span class=\"line\">      request.getRequestDispatcher(path).forward(request, response);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">protected</span> String <span class=\"title\">addStu</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"添加学生\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"/test.html\"</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">protected</span> String <span class=\"title\">delStu</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"删除学生\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"/test.html\"</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">protected</span> String <span class=\"title\">checkStu</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"检查学生\"</span>);</span><br><span class=\"line\">    response.getWriter().println(<span class=\"string\">\"DDDDDD\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>Tips:该方式的弊端如果模块下功能较多，<code>if(){}else{}</code>语句过多;</p>\n<p><br></p>\n<p>基础示例2:(<code>采用reflect反射机制利用字节码进行调用方法</code>)</p>\n<p>Base-Servlet : BaseServlet<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/***</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> WeiyiGeek</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@desc</span> 工具类:自建一个Servlet基础类所有继承该类的Servlet都将执行重写后的Service方法</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BaseServlet</span> <span class=\"keyword\">extends</span> <span class=\"title\">HttpServlet</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"unused\"</span>)</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">service</span><span class=\"params\">(HttpServletRequest req, HttpServletResponse resp)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"BaseServlet - 被继承的基础Servlet中的Service方法\"</span>);</span><br><span class=\"line\">        <span class=\"comment\">//1.获取请求的操作的方法</span></span><br><span class=\"line\">        String method = req.getParameter(<span class=\"string\">\"method\"</span>);</span><br><span class=\"line\">        <span class=\"comment\">//2.定义转发路径</span></span><br><span class=\"line\">        String redirection = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"comment\">//3.获取当前的字节码对象</span></span><br><span class=\"line\">        Class&lt;? extends BaseServlet&gt; clazz = <span class=\"keyword\">this</span>.getClass(); <span class=\"comment\">//此时获取的实际上是继承者的class即 UserOper.class</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//4.采用反射reflect形式获取到clazz的方法并且进行调用传入的指定方法</span></span><br><span class=\"line\">            Method md = clazz.getMethod(method, HttpServletRequest.class, HttpServletResponse.class);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> != md) </span><br><span class=\"line\">              redirection = (String) md.invoke(<span class=\"keyword\">this</span>, req, resp);</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//5.当跳转路径不为空的时候返回的指定路径</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> != redirection)</span><br><span class=\"line\">              req.getRequestDispatcher(redirection).forward(req, resp);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>Servlet : UserOper<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserOper</span> <span class=\"keyword\">extends</span> <span class=\"title\">BaseServlet</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">1L</span>;</span><br><span class=\"line\">       </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">UserOper</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"UserOper Servlet 构造方法!\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//Servlet中对用户操作的方法</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">addUser</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse reponse)</span> <span class=\"keyword\">throws</span> ServletException </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"addUser - 添加用户!\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"Demo2/test.html\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">showUser</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse reponse)</span> <span class=\"keyword\">throws</span> ServletException </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"showUser - 查看用户!\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"Demo2/test.html\"</span>;</span><br><span class=\"line\">    &#125;       </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>执行结果:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">UserOper Servlet 构造方法!</span><br><span class=\"line\">BaseServlet - 被继承的基础Servlet中的Service方法</span><br><span class=\"line\">addUser - 添加用户!</span><br><span class=\"line\"></span><br><span class=\"line\">BaseServlet - 被继承的基础Servlet中的Service方法</span><br><span class=\"line\">showUser - 查看用户!</span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Java","path":"api/categories/Java.json"}],"tags":[{"name":"Servlet","path":"api/tags/Servlet.json"}]}