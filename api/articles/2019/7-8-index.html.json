{"title":"Shell脚本编程示例大全","slug":"系统运维/Linux/Shell编程/Shell脚本编程示例大全","date":"2019-07-08T10:34:30.000Z","updated":"2023-01-31T02:29:10.385Z","url":"2019/7-8-index.html","path":"api/articles/2019/7-8-index.html.json","covers":["https://img.weiyigeek.top/2019/20190722164611.png","https://img.weiyigeek.top/2019/20190722170007.png","https://img.weiyigeek.top/2019/20190722170601.png","https://img.weiyigeek.top/2019/20190722173736.png","https://img.weiyigeek.top/2019/20190722211259.png","https://img.weiyigeek.top/2019/20190722211352.png","https://img.weiyigeek.top/2019/20190722211426.png","https://img.weiyigeek.top/2019/20190722211547.png","https://img.weiyigeek.top/2019/20190722164854.png","https://img.weiyigeek.top/2019/20190722173450.png","https://img.weiyigeek.top/2019/20190722173503.png","https://img.weiyigeek.top/2019/20190722170336.png","https://img.weiyigeek.top/2019/20190723091030.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"0x00-基础案例\"><a href=\"#0x00-基础案例\" class=\"headerlink\" title=\"0x00 基础案例\"></a>0x00 基础案例</h2><h3 id=\"示例1-变量叠加与单双引i号得异同\"><a href=\"#示例1-变量叠加与单双引i号得异同\" class=\"headerlink\" title=\"示例1.变量叠加与单双引i号得异同\"></a>示例1.变量叠加与单双引i号得异同</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\">x=123</span><br><span class=\"line\">y=<span class=\"string\">\"<span class=\"variable\">$x</span>\"</span>456</span><br><span class=\"line\">y=<span class=\"variable\">$&#123;y&#125;</span>789 </span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"y=\\e[1;32m <span class=\"variable\">$y</span> \\e[0m\"</span>  <span class=\"comment\">#y=123456789</span></span><br><span class=\"line\"></span><br><span class=\"line\">z=<span class=\"string\">'$y'</span>   <span class=\"comment\"># 单引号 不能引用变量 'character':表示字符串  #$y</span></span><br><span class=\"line\">a=<span class=\"string\">\"<span class=\"variable\">$y</span>\"</span>   <span class=\"comment\"># 双引号 引用变量 特殊符号有特殊意义 \\\\ \\n  #123456789</span></span><br><span class=\"line\"></span><br><span class=\"line\">b=<span class=\"string\">\"<span class=\"variable\">$x</span>\"</span></span><br><span class=\"line\">c=<span class=\"string\">'\"$x\"'</span>    <span class=\"comment\">#不能被解析变量</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"z=\\e[1;37m '<span class=\"variable\">$z</span>' <span class=\"variable\">$a</span> \\e[0m\"</span>  <span class=\"comment\">#z = '$y' 123456789</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"<span class=\"variable\">$c</span>=\\e[37;1;5m <span class=\"variable\">$b</span> \\e[0m\"</span>   <span class=\"comment\">#$x = 123</span></span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190722164611.png\" alt=\"WeiyiGeek.单双引号\" title=\"\" class=\"\">\n                <p>WeiyiGeek.单双引号</p>\n            </figure>\n<p><br></p>\n<h3 id=\"示例2-五种计算方法Method\"><a href=\"#示例2-五种计算方法Method\" class=\"headerlink\" title=\"示例2.五种计算方法Method\"></a>示例2.五种计算方法Method</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\">va=<span class=\"variable\">$1</span></span><br><span class=\"line\">vb=<span class=\"variable\">$2</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"输入的参数:<span class=\"variable\">$va</span>,<span class=\"variable\">$vb</span> \\n\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## [] 方式，无操作符号无空格影响，括号里面的数值变量无需$</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[1;36m #Method 1 '$[exp]' \\e[0m\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"va+vb=$[<span class=\"variable\">$va</span>+<span class=\"variable\">$vb</span>]\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## (()) 方式，无操作符号无空格影响，括号里面的数值变量无需$</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n\\e[1;35m #Method 2 '<span class=\"variable\">$((exr)</span>)' \\e[0m\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"va+vb=<span class=\"variable\">$(($va+$vb)</span>)\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## let 方式，操作符号的变量两边无需空格，且里面的数值变量无需$</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n\\e[1;34m #Method 3 'let x=1+1' \\e[0m\"</span></span><br><span class=\"line\"><span class=\"built_in\">let</span> vc=<span class=\"variable\">$va</span>+<span class=\"variable\">$vb</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"va+vb=<span class=\"variable\">$vc</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## expr 方式，非常注意表达式两边的空格,里面的数值变量必须加上$</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n\\e[1;33m #Method 4 'expr 1 + 1' \\e[0m\"</span></span><br><span class=\"line\">result=`expr <span class=\"variable\">$va</span> + <span class=\"variable\">$vb</span>` <span class=\"comment\">#注意加号两边的空格</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"va+vb=<span class=\"variable\">$result</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## declare 方法，操作符号两边无需空格，且里面的数值变量必须加上$</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n\\e[1;32m #Method 5 'declare -i x=1+1' \\e[0m\"</span></span><br><span class=\"line\"><span class=\"built_in\">declare</span> -i vd=<span class=\"variable\">$va</span>+<span class=\"variable\">$vb</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"va+vb=<span class=\"variable\">$vd</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 自加自减</span></span><br><span class=\"line\">a=10; ((a++));  <span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;a&#125;</span>  <span class=\"comment\"># 11</span></span><br><span class=\"line\">b=10; ((b--));  <span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;b&#125;</span>  <span class=\"comment\"># 9</span></span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190722170007.png\" alt=\"WeiyiGeek.数值计算的几种方式\" title=\"\" class=\"\">\n                <p>WeiyiGeek.数值计算的几种方式</p>\n            </figure>\n<p><br></p>\n<h3 id=\"示例3-精密计算之小数计算\"><a href=\"#示例3-精密计算之小数计算\" class=\"headerlink\" title=\"示例3.精密计算之小数计算\"></a>示例3.精密计算之小数计算</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[1;32m #精密计算bc\\e[0m\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">a=<span class=\"variable\">$1</span></span><br><span class=\"line\">b=<span class=\"variable\">$2</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"bc精密计算a=:`echo \"</span><span class=\"variable\">$a</span><span class=\"string\">\"|bc`\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"bc精密计算b=:`echo \"</span><span class=\"variable\">$b</span><span class=\"string\">\"|bc` \\n\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"bc精密计算a+b=:`echo \"</span><span class=\"variable\">$a</span>+<span class=\"variable\">$b</span><span class=\"string\">\"|bc`\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"bc精密计算a/b=:`echo \"</span><span class=\"variable\">$a</span>/<span class=\"variable\">$b</span><span class=\"string\">\"|bc`\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"bc精密计算a*b=:`echo \"</span><span class=\"variable\">$a</span>*<span class=\"variable\">$b</span><span class=\"string\">\"|bc`\\n\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[1;33m #scale设定小数精度（数值范围）\\e[0m\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"scale设置小数3位精度a/b:`echo \"</span>scale=3;<span class=\"variable\">$a</span>/<span class=\"variable\">$b</span><span class=\"string\">\"|bc`\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"scale设置小数3位精度a*b:`echo \"</span>scale=10;<span class=\"variable\">$a</span>*<span class=\"variable\">$b</span><span class=\"string\">\"|bc`\"</span></span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190722170601.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n<p><br></p>\n<h3 id=\"示例4-字符串与数组处理\"><a href=\"#示例4-字符串与数组处理\" class=\"headerlink\" title=\"示例4.字符串与数组处理\"></a>示例4.字符串与数组处理</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\">string=<span class=\"string\">\"alibaba is a great company\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$string</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"获取字符串长度:<span class=\"variable\">$&#123;#string&#125;</span> \\n\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"提取子字符串:<span class=\"variable\">$&#123;string:0:5&#125;</span> \\n\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"查找子字符串alibaba:`expr index \"</span><span class=\"variable\">$string</span><span class=\"string\">\" alibab`\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#数组案例</span></span><br><span class=\"line\"><span class=\"built_in\">read</span> -p <span class=\"string\">\"Please Input Data Array:\"</span> -a array_name</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[1;32mAll Array Arguments:<span class=\"variable\">$&#123;array_name[*]&#125;</span> \\n\"</span></span><br><span class=\"line\"><span class=\"comment\"># 取得数组元素的个数 length=$&#123;#array_name[*]&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[1;36mArray Arguments Accounts:<span class=\"variable\">$&#123;#array_name[*]&#125;</span> \\e[0m\\n\"</span></span><br><span class=\"line\"><span class=\"comment\"># 取得数组单个元素的长度</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"array_name[1]:<span class=\"variable\">$&#123;array_name[1]&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[1;37mSingle Array Arguments(array_name[1]):<span class=\"variable\">$&#123;#array_name[1]&#125;</span> \\e[0m\\n\"</span></span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190722173736.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n<hr>\n\n<h2 id=\"0x01-语法记忆\"><a href=\"#0x01-语法记忆\" class=\"headerlink\" title=\"0x01 语法记忆\"></a>0x01 语法记忆</h2><p><strong>示例1.分支与判断</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#if分支语句</span></span><br><span class=\"line\"><span class=\"built_in\">read</span> -p <span class=\"string\">\"Please INput A:\"</span> a</span><br><span class=\"line\"><span class=\"built_in\">read</span> -p <span class=\"string\">\"Please INput B:\"</span> b</span><br><span class=\"line\"><span class=\"built_in\">read</span> -p <span class=\"string\">\"Please INput C:\"</span> c\t</span><br><span class=\"line\"><span class=\"comment\">#单分支语句(1)</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$a</span> == <span class=\"variable\">$b</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"a is equal to b!!\"</span> </span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$a</span> != <span class=\"variable\">$b</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"a is not equal to b!!\"</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#单分支语句(2)</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$c</span> == <span class=\"variable\">$b</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"c is equal to b!!\"</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">\"c is not equal to b!!\\n\"</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#双分支语句</span></span><br><span class=\"line\">a=10</span><br><span class=\"line\">b=20</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$a</span> == <span class=\"variable\">$b</span> ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">   <span class=\"built_in\">echo</span> <span class=\"string\">\"a is equal to b\"</span></span><br><span class=\"line\"><span class=\"keyword\">elif</span> [ <span class=\"variable\">$a</span> -gt <span class=\"variable\">$b</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">   <span class=\"built_in\">echo</span> <span class=\"string\">\"a is greater than b\"</span></span><br><span class=\"line\"><span class=\"keyword\">elif</span> [ <span class=\"variable\">$a</span> -lt <span class=\"variable\">$b</span> ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">   <span class=\"built_in\">echo</span> <span class=\"string\">\"a is less than b\"</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">   <span class=\"built_in\">echo</span> <span class=\"string\">\"None of the condition met\"</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>示例2.Case多分支语句</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#case 多分支语句</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'Input a number between 1 to 4'</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span>  -e <span class=\"string\">'Your number is:\\c'</span></span><br><span class=\"line\"><span class=\"built_in\">read</span> aNum</span><br><span class=\"line\"><span class=\"keyword\">case</span> <span class=\"variable\">$aNum</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">        1)  <span class=\"built_in\">echo</span> -e <span class=\"string\">'You select 1\\n'</span></span><br><span class=\"line\">        ;;</span><br><span class=\"line\">        2)  <span class=\"built_in\">echo</span> -e <span class=\"string\">'You select 2\\n'</span></span><br><span class=\"line\">        ;;</span><br><span class=\"line\">        3)  <span class=\"built_in\">echo</span> -e <span class=\"string\">'You select 3\\n'</span></span><br><span class=\"line\">        ;;</span><br><span class=\"line\">        4)  <span class=\"built_in\">echo</span> -e <span class=\"string\">'You select 4\\n'</span></span><br><span class=\"line\">        ;;</span><br><span class=\"line\">        *)  <span class=\"built_in\">echo</span> -e <span class=\"string\">'You do not select a number between 1 to 4'</span></span><br><span class=\"line\">        ;;</span><br><span class=\"line\"><span class=\"keyword\">esac</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#新颖的思路可以利用这个来写小脚本</span></span><br><span class=\"line\">option=<span class=\"string\">\"<span class=\"variable\">$&#123;1&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"keyword\">case</span> <span class=\"variable\">$&#123;option&#125;</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">       -f) FILE=<span class=\"string\">\"<span class=\"variable\">$&#123;2&#125;</span>\"</span></span><br><span class=\"line\">          <span class=\"built_in\">echo</span> <span class=\"string\">\"File name is <span class=\"variable\">$FILE</span>\"</span></span><br><span class=\"line\">          ;;</span><br><span class=\"line\">       -d) DIR=<span class=\"string\">\"<span class=\"variable\">$&#123;2&#125;</span>\"</span></span><br><span class=\"line\">          <span class=\"built_in\">echo</span> <span class=\"string\">\"Dir name is <span class=\"variable\">$DIR</span>\"</span></span><br><span class=\"line\">          ;;</span><br><span class=\"line\">       *) </span><br><span class=\"line\">          <span class=\"built_in\">echo</span> <span class=\"string\">\"`basename <span class=\"variable\">$&#123;0&#125;</span>`:usage: [-f file] | [-d directory]\"</span></span><br><span class=\"line\">          <span class=\"built_in\">exit</span> 1 <span class=\"comment\"># Command to come out of the program with status 1</span></span><br><span class=\"line\">          ;;</span><br><span class=\"line\"><span class=\"keyword\">esac</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190722211259.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p><br></p>\n<p><strong>示例3.For循环(Circulation)语句</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#For circulation Method 1</span></span><br><span class=\"line\"><span class=\"comment\">#一行一行得读取家目录总中.bash开头的文件</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> FILE <span class=\"keyword\">in</span> <span class=\"variable\">$HOME</span>/.bash*</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"variable\">$FILE</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#依次输出</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> t <span class=\"keyword\">in</span> 1 2 3 4 5</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"输出第<span class=\"variable\">$&#123;t&#125;</span>个数字:<span class=\"variable\">$t</span>\"</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#For Method2</span></span><br><span class=\"line\">sum=0</span><br><span class=\"line\"><span class=\"keyword\">for</span>((i=0;i&lt;=100;i++))</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">    sum=$[ <span class=\"variable\">$sum</span> + <span class=\"variable\">$i</span> ]</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"一到一百相加得:<span class=\"variable\">$sum</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#批量解压缩</span></span><br><span class=\"line\">ls *.tar.gz &gt;&gt; gz.log 2&gt;/dev/null</span><br><span class=\"line\">ls *.tgz &gt;&gt; gz.log 2&gt;/dev/null</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"正在解压缩 : Wait,Please!!\"</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> $(cat gz.log)</span><br><span class=\"line\">    <span class=\"keyword\">do</span></span><br><span class=\"line\">  tar -zxf <span class=\"variable\">$i</span> &amp;&gt; /dev/null</span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br><span class=\"line\">rm -rf gz.log</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190722211352.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p><br></p>\n<p><strong>示例4.While 与 Until 语句：</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#while Circulation</span></span><br><span class=\"line\">num=0</span><br><span class=\"line\">sum=0</span><br><span class=\"line\"><span class=\"keyword\">while</span> [ <span class=\"variable\">$num</span> -le 100 ]</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  sum=$((<span class=\"variable\">$sum</span>+<span class=\"variable\">$num</span>))</span><br><span class=\"line\">  num=$[<span class=\"variable\">$num</span>+1]</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"1+2+....+100=<span class=\"variable\">$sum</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Until Circulation</span></span><br><span class=\"line\"><span class=\"comment\">#输出 0 - 4</span></span><br><span class=\"line\">a=0 </span><br><span class=\"line\">until [ ! <span class=\"variable\">$a</span> -lt 5 ]   <span class=\"comment\">#到5得时候就不成立了</span></span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"variable\">$a</span></span><br><span class=\"line\">  a=`expr <span class=\"variable\">$a</span> + 1`</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n\"</span></span><br><span class=\"line\"><span class=\"comment\">#输出 0 - 5</span></span><br><span class=\"line\">b=0</span><br><span class=\"line\">until [ <span class=\"variable\">$b</span> -gt 5 ]   <span class=\"comment\"># 可以等于5</span></span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"variable\">$b</span></span><br><span class=\"line\">  b=$((<span class=\"variable\">$b</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190722211426.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p><br></p>\n<p><strong>示例5.函数嵌套与调用</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Define your function here</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">Hello</span></span> () &#123;</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"Hello Shell Program!!\\n\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Invoke your function</span></span><br><span class=\"line\">Hello</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Return Arguments！！</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">funWithReturn</span></span>()&#123;</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"The function is to get the sum of two numbers...\"</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -n <span class=\"string\">\"Input first number: \"</span></span><br><span class=\"line\">    <span class=\"built_in\">read</span> aNum</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -n <span class=\"string\">\"Input another number: \"</span></span><br><span class=\"line\">    <span class=\"built_in\">read</span> anotherNum</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"The two numbers are <span class=\"variable\">$aNum</span> and <span class=\"variable\">$anotherNum</span> !\"</span></span><br><span class=\"line\">    <span class=\"built_in\">return</span> $((<span class=\"variable\">$aNum</span>+<span class=\"variable\">$anotherNum</span>)) <span class=\"comment\"># 2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">funWithReturn</span><br><span class=\"line\"><span class=\"comment\"># Capture value returnd by last command</span></span><br><span class=\"line\">ret=$?</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"The sum of two numbers is <span class=\"variable\">$ret</span> !\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#函数嵌套</span></span><br><span class=\"line\"><span class=\"comment\"># Calling one function from another</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">number_one</span></span> () &#123;</span><br><span class=\"line\">   <span class=\"built_in\">echo</span> <span class=\"string\">\"Url_1 is http://see.edu.cn/cpp/shell/\"</span></span><br><span class=\"line\">   number_two</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">number_two</span></span> () &#123;</span><br><span class=\"line\">   <span class=\"built_in\">echo</span> <span class=\"string\">\"Url_2 is http://see.edu.cn/cpp/\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># unset -f number_two  #删除number_two函数</span></span><br><span class=\"line\">number_one</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190722211547.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<hr>\n\n<h2 id=\"0x02-标准输入\"><a href=\"#0x02-标准输入\" class=\"headerlink\" title=\"0x02 标准输入\"></a>0x02 标准输入</h2><p><strong>示例1.命令行中输入参数，shell中使用位置参数变化</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#接受 输出得参数(Arguments),位置参数num1=$1</span></span><br><span class=\"line\">num2=<span class=\"variable\">$2</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"输入得参数:\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$num1</span>,<span class=\"variable\">$num2</span></span><br><span class=\"line\"><span class=\"built_in\">let</span> num3=<span class=\"variable\">$num1</span>+<span class=\"variable\">$num2</span>  <span class=\"comment\">#Add输入得参数</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"num1+num2=\\e[1;35m <span class=\"variable\">$num3</span> \\e[0m\"</span></span><br><span class=\"line\"><span class=\"comment\">##</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n代表所有参数的个数:\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\" A total of\\e[1;32m <span class=\"variable\">$#</span> \\e[0m Parameters\"</span>   <span class=\"comment\">#所有参数的个数:</span></span><br><span class=\"line\"><span class=\"comment\">##</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n整体参数:\"</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"string\">\"$*\"</span></span><br><span class=\"line\">    <span class=\"keyword\">do</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">\"ioutput:\\e[1;31m <span class=\"variable\">$i</span> \\e[0m\"</span>   <span class=\"comment\">#整体参数</span></span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"comment\">##</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n个体参数:\"</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"string\">\"<span class=\"variable\">$@</span>\"</span></span><br><span class=\"line\">    <span class=\"keyword\">do</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">\"joutput:\\e[1;36m <span class=\"variable\">$j</span> \\e[0m\"</span>   <span class=\"comment\">#个体参数</span></span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190722164854.png\" alt=\"WeiyiGeek.参数命令\" title=\"\" class=\"\">\n                <p>WeiyiGeek.参数命令</p>\n            </figure></p>\n<p><br></p>\n<p><strong>示例2.标准输入和命令行输入验证</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># 实现标准输入格式验证的几种方法</span></span><br><span class=\"line\"><span class=\"built_in\">read</span> -p <span class=\"string\">\"Please two number:\"</span> NUM1 NUM2</span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">CheckNumberFormat</span></span>()&#123;</span><br><span class=\"line\">  <span class=\"built_in\">local</span> value=<span class=\"variable\">$1</span></span><br><span class=\"line\">  flag=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$value</span> | grep -E <span class=\"string\">'[a-zA-Z_\\.]'</span>| wc -l)  <span class=\"comment\">#字符输入时候也的值得参考</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ <span class=\"variable\">$flag</span> -eq 1 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"please input Number!\"</span></span><br><span class=\"line\">    <span class=\"built_in\">return</span> 1</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"built_in\">return</span> 0</span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">CheckNumberLength</span></span>()&#123;</span><br><span class=\"line\">  <span class=\"built_in\">local</span> value=<span class=\"variable\">$1</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ <span class=\"variable\">$&#123;#value&#125;</span> -lt 1 -o -z <span class=\"variable\">$&#123;value&#125;</span> -o ! -n <span class=\"variable\">$&#123;value&#125;</span> -o <span class=\"string\">\"<span class=\"variable\">$&#123;value&#125;</span>\"</span> == <span class=\"string\">\"\"</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">     <span class=\"built_in\">echo</span> <span class=\"string\">\"输入为空!\"</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">CheckNumber</span></span>()&#123;</span><br><span class=\"line\">  expr <span class=\"variable\">$1</span> + <span class=\"variable\">$2</span> + 0 &gt; /dev/null</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ $? -ne 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"Input not number!\"</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>示例3.匹配更改文件名称思路</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># 批量更改文件名称</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#方式1:</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> file <span class=\"keyword\">in</span> $(ls *.jpg);<span class=\"keyword\">do</span>\t</span><br><span class=\"line\">  mv <span class=\"variable\">$file</span> $(<span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;file&#125;</span> | sed <span class=\"string\">'s#需要改变的文件名称#.jpg#g'</span>)</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#方式2:</span></span><br><span class=\"line\">ls *.jpg | awk -F <span class=\"string\">' '</span> <span class=\"string\">'&#123;print \" mv \" $0,$1\".jpg\"&#125;'</span> | bash</span><br><span class=\"line\">ls *.jpg | awk -F <span class=\"string\">' '</span> <span class=\"string\">'&#123;cmd=\"mv \"$0\" \"$1\".jpg\";system(cmd)&#125;'</span></span><br><span class=\"line\"><span class=\"comment\">#补充示例：wiz笔记图片批量改名并且高亮显示</span></span><br><span class=\"line\">$ ls | awk -F <span class=\"string\">'.'</span> <span class=\"string\">'&#123;cmd=\"dd=$(date +%Y%m%d%H%M%S)$RANDOM;echo -e \\\"\\033[1;31m\" $1 \"\\033[0m $dd \\\"; mv \" $0 \" $dd.\"$2;system(cmd)&#125;'</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#方式3：</span></span><br><span class=\"line\">rename <span class=\"string\">\"需要更改的字符串\"</span> <span class=\"string\">\"改成什么\"</span> 对什么文件进行修改</span><br><span class=\"line\">rename <span class=\"string\">\"_finished.html\"</span> <span class=\"string\">\".jpg\"</span> *.html</span><br></pre></td></tr></table></figure>\n<p><br></p>\n<h2 id=\"0x03-进制随机编码\"><a href=\"#0x03-进制随机编码\" class=\"headerlink\" title=\"0x03 进制随机编码\"></a>0x03 进制随机编码</h2><p><strong>示例1.进制转换采用bc</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#进制之间的转换 B-&gt;O-&gt;D-&gt;H</span></span><br><span class=\"line\"><span class=\"built_in\">read</span> -p <span class=\"string\">\"Please INput NUmeric:\"</span> abc</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[1;33;5m 进制转换结果 \\e[0m\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"二进制(BIN):`echo \"</span>obase=2;<span class=\"variable\">$abc</span><span class=\"string\">\"|bc`\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"八进制(OCTAL):`echo \"</span>obase=8;<span class=\"variable\">$abc</span><span class=\"string\">\"|bc`\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"十进制(DEC):`echo \"</span>obase=10;<span class=\"variable\">$abc</span><span class=\"string\">\"|bc`\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"十六进制(HEX):`echo \"</span>obase=16;<span class=\"variable\">$abc</span><span class=\"string\">\"|bc`\"</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190722173450.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p><br></p>\n<p><strong>示例2.Ascii码与进制转换</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#Printf里的进制转换</span></span><br><span class=\"line\"><span class=\"built_in\">exec</span> 4&lt;&gt;test.txt  <span class=\"comment\">#绑定文件描述符号</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"built_in\">read</span> line&lt;&amp;4</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[1;37;5m 进制数据进行相互转换: \\e[0m\"</span></span><br><span class=\"line\">  <span class=\"built_in\">printf</span> <span class=\"string\">\"%-10s \\n\"</span> Octal-Dec-hex:</span><br><span class=\"line\">  <span class=\"built_in\">printf</span> <span class=\"string\">\"%-10o\"</span> <span class=\"variable\">$line</span> </span><br><span class=\"line\">  <span class=\"built_in\">printf</span> <span class=\"string\">\"%-10d\"</span> <span class=\"variable\">$line</span></span><br><span class=\"line\">  <span class=\"built_in\">printf</span> <span class=\"string\">\"%-10x \\n\"</span> <span class=\"variable\">$line</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Printf里的Ascll编码</span></span><br><span class=\"line\"><span class=\"comment\">##Octal -&gt; ASCLL(123456789)</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[1;36m Octal-&gt; Ascll\\e[0m\"</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> 60 61 62 63 64 65 66 67 70 71</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">        <span class=\"built_in\">printf</span> <span class=\"string\">\"Octal=<span class=\"variable\">$i</span>,Ascll=\\\\<span class=\"variable\">$i</span> \\n\"</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190722173503.png\" alt=\"WeiyiGeek.printf相互转换\" title=\"\" class=\"\">\n                <p>WeiyiGeek.printf相互转换</p>\n            </figure></p>\n<p><br></p>\n<p><strong>示例3.Shell脚本随机密码生成</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#(方式1) /dev/urandom文件是Linux内置的随机设备文件,内容有些太随机，包括很多特殊符号</span></span><br><span class=\"line\"><span class=\"comment\">#tr -dc '_A-Za-z0-9'  #将随机文件中其他的字符删除，仅保留大小写字母，数字，下划线</span></span><br><span class=\"line\">cat /dev/urandom | tr -dc <span class=\"string\">'_a-zA-Z0-9'</span> | head -c 12  <span class=\"comment\">#2hCOmV9AWAHA</span></span><br><span class=\"line\">&lt;/dev/urandom tr -dc <span class=\"string\">'!@#$%^&amp;*()-+=0-9a-zA-Z'</span>| head -c14  <span class=\"comment\">#这样的方法值得学习</span></span><br><span class=\"line\">cat /dev/urandom | tr -dc <span class=\"string\">'_a-zA-Z0-9!@#$%&amp;*.'</span> | fold -w 12 | head -1</span><br><span class=\"line\">cat /dev/urandom | tr -dc <span class=\"string\">'a-zA-Z0-9-_!@#$%^&amp;*()_+&#123;&#125;|:&lt;&gt;?='</span> | fold -w 12| head -n 4 <span class=\"comment\"># 生成四组随机密码</span></span><br><span class=\"line\">.g0VvfzPooh*</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(方式2)利用上面的随机数来生成随机密码 </span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$RANDOM</span> | md5sum | cut -c 1-8</span><br><span class=\"line\">60354ab3</span><br><span class=\"line\"><span class=\"comment\">#(方式2)生成随机密码(字串截取版本)设置变量key，存储密码的所有可能性(密码库)，如果还需要其他字符请自行添加其他密码字符</span></span><br><span class=\"line\"><span class=\"comment\">#使用$#统计密码库的长度</span></span><br><span class=\"line\">key=<span class=\"string\">\"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"</span></span><br><span class=\"line\">num=<span class=\"variable\">$&#123;#key&#125;</span> </span><br><span class=\"line\">pass=<span class=\"string\">''</span>  <span class=\"comment\">#设置初始密码为空</span></span><br><span class=\"line\"><span class=\"comment\">#循环8次，生成8为随机密码</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> &#123;1..8&#125;</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  index=$[RANDOM%num]   <span class=\"comment\">#无论怎么变都在key长度范围内</span></span><br><span class=\"line\">  pass=<span class=\"variable\">$pass</span><span class=\"variable\">$&#123;key:$index:1&#125;</span>  <span class=\"comment\">#拼接字符串</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$pass</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(方式3)生成随机密码(UUID版本，16进制密码)</span></span><br><span class=\"line\">uuidgen | cut -c 1-8</span><br><span class=\"line\">a1cb0776</span><br><span class=\"line\">uuidgen | md5sum | cut -c 1-8</span><br><span class=\"line\">70101a14</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(方式4)当前进程号生成随机密码(进程ID版本,数字密码)-并不是一定随机一个shell的终端pid</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> $$ | md5sum | cut -c 1-8</span><br><span class=\"line\">93c6b48c</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(方式5)通过openssl产生随机数</span></span><br><span class=\"line\">openssl rand -base64 8</span><br><span class=\"line\">R1NSJ4rZGXQ=</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(方式6)通过date方式获取随机数</span></span><br><span class=\"line\">date +%s%S | md5sum | cut -c 1-8</span><br><span class=\"line\"><span class=\"comment\"># 259f7c4a</span></span><br><span class=\"line\"></span><br><span class=\"line\">date +%s%S | sha1sum</span><br><span class=\"line\">date +%s%S | sha512sum | cut -c 1-8</span><br><span class=\"line\"><span class=\"comment\"># 03663f46</span></span><br></pre></td></tr></table></figure></p>\n<hr>\n\n<h2 id=\"0x04-批量操作\"><a href=\"#0x04-批量操作\" class=\"headerlink\" title=\"0x04 批量操作\"></a>0x04 批量操作</h2><h3 id=\"示例1-批量创建用户以及采用随机密码\"><a href=\"#示例1-批量创建用户以及采用随机密码\" class=\"headerlink\" title=\"示例1.批量创建用户以及采用随机密码\"></a>示例1.批量创建用户以及采用随机密码</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env bash</span></span><br><span class=\"line\"><span class=\"comment\"># Step1.采用action函数的引用</span></span><br><span class=\"line\">[ -f /etc/init.d/<span class=\"built_in\">functions</span> ] &amp;&amp; . /etc/init.d/<span class=\"built_in\">functions</span></span><br><span class=\"line\"><span class=\"comment\"># Step2.判断是否是root</span></span><br><span class=\"line\">[ <span class=\"variable\">$UID</span> -ne 0 ] &amp;&amp; &#123;</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[1;31m [+] only allow root create user \\e[0m\"</span></span><br><span class=\"line\">  <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># step3.创建主函数</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">create</span></span>()&#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> n <span class=\"keyword\">in</span> &#123;1..3&#125;;<span class=\"keyword\">do</span></span><br><span class=\"line\">    user=weiyi<span class=\"variable\">$n</span></span><br><span class=\"line\">    random=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;RANDOM&#125;</span>`date +%s%S`<span class=\"variable\">$&#123;user&#125;</span>)                      </span><br><span class=\"line\">    pass=<span class=\"string\">\"<span class=\"variable\">$(echo $random|md5sum|cut -f 2-9)</span>\"</span></span><br><span class=\"line\">    useradd <span class=\"variable\">$user</span> &amp;&gt;/dev/null &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"variable\">$pass</span> | passwd --stdin <span class=\"variable\">$user</span> &amp;&gt;/dev/null</span><br><span class=\"line\">    RETVAL=$?</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ <span class=\"variable\">$RETVAL</span> -eq 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">      action <span class=\"string\">\"useradd <span class=\"variable\">$user</span>\"</span> /bin/<span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      action <span class=\"string\">\"useradd <span class=\"variable\">$user</span>\"</span> /bin/<span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$user</span>  <span class=\"variable\">$pass</span>\"</span> &gt;&gt; ./user.txt</span><br><span class=\"line\">  <span class=\"keyword\">done</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">create</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 执行结果 ##</span></span><br><span class=\"line\">. add.sh</span><br><span class=\"line\">weiyi1-197e0f87</span><br><span class=\"line\">useradd weiyi1                                             [  OK  ]</span><br><span class=\"line\">weiyi2-65f0d13f</span><br><span class=\"line\">useradd weiyi2                                             [  OK  ]</span><br><span class=\"line\">weiyi3-7379dc89</span><br><span class=\"line\">useradd weiyi3                                             [  OK  ]</span><br></pre></td></tr></table></figure>\n<p><br/></p>\n<h3 id=\"示例2-排除A文件中每一行在B文件中存在的字符串\"><a href=\"#示例2-排除A文件中每一行在B文件中存在的字符串\" class=\"headerlink\" title=\"示例2.排除A文件中每一行在B文件中存在的字符串\"></a>示例2.排除A文件中每一行在B文件中存在的字符串</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> $(cat a.txt);<span class=\"keyword\">do</span>  </span><br><span class=\"line\">  flag=$(grep <span class=\"string\">\"<span class=\"variable\">$&#123;i&#125;</span>\"</span> b.txt -c);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ <span class=\"variable\">$flag</span> -eq 0 ];<span class=\"keyword\">then</span> </span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;i&#125;</span> &gt;&gt; c.txt;</span><br><span class=\"line\">  <span class=\"keyword\">fi</span>;</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n<hr>\n\n<h2 id=\"0x05-文件读取\"><a href=\"#0x05-文件读取\" class=\"headerlink\" title=\"0x05 文件读取\"></a>0x05 文件读取</h2><p><strong>示例1.监测网站首页是否宕掉以及首页是否被修改</strong><br>Step1.将需要监测的网站地址放入ip.txt中<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt; ip.txt &lt;&lt;END</span><br><span class=\"line\">192.168.100.197</span><br><span class=\"line\">192.168.100.198</span><br><span class=\"line\">192.168.100.199</span><br><span class=\"line\">192.168.100.200</span><br><span class=\"line\">192.168.100.201</span><br><span class=\"line\">192.168.100.202</span><br><span class=\"line\">END</span><br></pre></td></tr></table></figure></p>\n<p>Step2.写入一个监测函数思路就是利用网页的MD5指纹进行判断;<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env bash</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">check</span></span>()&#123;</span><br><span class=\"line\">    cat ip.txt|<span class=\"keyword\">while</span> <span class=\"built_in\">read</span> line</span><br><span class=\"line\">    <span class=\"keyword\">do</span></span><br><span class=\"line\">        url=<span class=\"string\">\"http://<span class=\"variable\">$&#123;line&#125;</span>:<span class=\"variable\">$1</span>/Login.do\"</span></span><br><span class=\"line\">        urlmd5=$(curl -s -m 2 <span class=\"variable\">$&#123;url&#125;</span> | md5sum | cut -f 1 -d <span class=\"string\">\" \"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> [ <span class=\"string\">\"<span class=\"variable\">$urlmd5</span>\"</span> == <span class=\"string\">\"6fc523910cb417d2247078125dd06782\"</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">            <span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$url</span> OK\"</span></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> [ <span class=\"string\">\"<span class=\"variable\">$urlmd5</span>\"</span> == <span class=\"string\">\"d41d8cd98f00b204e9800998ecf8427e\"</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">            <span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$url</span> Connect Fail\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            <span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$url</span> content change\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">check 30082</span><br><span class=\"line\">check 40082</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#执行结果</span></span><br><span class=\"line\">./check.sh</span><br><span class=\"line\">http://192.168.100.197:30082/Login.do OK</span><br><span class=\"line\">http://192.168.100.198:30082/Login.do Connect Fail</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>示例2.绑定输入与文件读取使用while语实现的三种方式</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">## read input Variable</span></span><br><span class=\"line\"><span class=\"built_in\">read</span> -t 10 -p <span class=\"string\">\"Please Input [Accounts|Password]:\"</span> user pass</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"输出的用户:<span class=\"variable\">$user</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"输入的密码:<span class=\"variable\">$pass</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 方法1：While Read Line 绑定文件描述</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[1;32m 第一个文件输出\\e[0m\"</span></span><br><span class=\"line\"><span class=\"built_in\">exec</span> 3&lt;&gt;file.txt</span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"built_in\">read</span> line&lt;&amp;3</span><br><span class=\"line\">    <span class=\"keyword\">do</span></span><br><span class=\"line\">      <span class=\"built_in\">echo</span> <span class=\"variable\">$line</span></span><br><span class=\"line\">    <span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 方法2：Cat FILE.TXT 读取文件中每一行</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[1;35m 第二个文件输出\\e[0m\"</span></span><br><span class=\"line\">cat file1.txt |\\</span><br><span class=\"line\">  <span class=\"keyword\">while</span> <span class=\"built_in\">read</span> line</span><br><span class=\"line\">  <span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"variable\">$line</span></span><br><span class=\"line\">  <span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 方法3</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> number=0</span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"built_in\">read</span> line</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  sed -i <span class=\"string\">\"3i\\  pageid: <span class=\"variable\">$&#123;number&#125;</span>\"</span> <span class=\"variable\">$line</span></span><br><span class=\"line\">  <span class=\"built_in\">let</span> number++</span><br><span class=\"line\"><span class=\"keyword\">done</span> &lt; all.md</span><br></pre></td></tr></table></figure></p>\n<p>执行结果：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"built_in\">read</span> line </span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\" - <span class=\"variable\">$&#123;line&#125;</span> - \"</span></span><br><span class=\"line\"><span class=\"keyword\">done</span> &lt; ip.txt</span><br><span class=\"line\"> - eth0      Link encap:Ethernet  HWaddr 02:42:ac:00:00:08 - </span><br><span class=\"line\"> - inet addr:172.0.0.8  Bcast:172.0.255.255  Mask:255.255.0.0 - </span><br><span class=\"line\"> - UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1 - </span><br><span class=\"line\"> - RX packets:481 errors:0 dropped:0 overruns:0 frame:0 - </span><br><span class=\"line\"> - TX packets:447 errors:0 dropped:0 overruns:0 carrier:0 - </span><br><span class=\"line\"> - collisions:0 txqueuelen:0 - </span><br><span class=\"line\"> - RX bytes:354214 (354.2 KB)  TX bytes:74829 (74.8 KB) - </span><br><span class=\"line\"> -  - </span><br><span class=\"line\"> - lo        Link encap:Local Loopback - </span><br><span class=\"line\"> - inet addr:127.0.0.1  Mask:255.0.0.0 - </span><br><span class=\"line\"> - UP LOOPBACK RUNNING  MTU:65536  Metric:1 - </span><br><span class=\"line\"> - RX packets:56 errors:0 dropped:0 overruns:0 frame:0 - </span><br><span class=\"line\"> - TX packets:56 errors:0 dropped:0 overruns:0 carrier:0 - </span><br><span class=\"line\"> - collisions:0 txqueuelen:0 - </span><br><span class=\"line\"> - RX bytes:5520 (5.5 KB)  TX bytes:5520 (5.5 KB) - </span><br><span class=\"line\"> -</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190722170336.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p><strong>示例3.读取文件中的字符串，对里面的词组进行排序及出现</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\">eng=<span class=\"string\">\"Making peace with what you don't have, that's what it's all about. I am a technical geek who is interested in learning computer technology.\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#方式1：</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$eng</span> | sed -e <span class=\"string\">'s#[ , . ]#\\n#g'</span> | sort | uniq -c | sort -nr <span class=\"comment\">#值得学习</span></span><br><span class=\"line\"><span class=\"comment\"># 2 what</span></span><br><span class=\"line\"><span class=\"comment\"># 1 you</span></span><br><span class=\"line\"><span class=\"comment\"># 1 with</span></span><br><span class=\"line\"><span class=\"comment\"># 1 who</span></span><br><span class=\"line\"><span class=\"comment\"># 1 that's</span></span><br><span class=\"line\"><span class=\"comment\"># 1 technology.</span></span><br><span class=\"line\"><span class=\"comment\"># 1 technical</span></span><br><span class=\"line\"><span class=\"comment\"># 1 peace</span></span><br><span class=\"line\"><span class=\"comment\"># 1 Making</span></span><br><span class=\"line\"><span class=\"comment\"># 1 learning</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#方式2：</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$eng</span> | tr <span class=\"string\">\" \"</span> <span class=\"string\">'\\n'</span> | sort | uniq -c | sort -nr</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#（1）读取文件中内容，将词组中的各个字母进行排序，sed -r 使用正则匹配任意字符降序排列;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$eng</span> | sed <span class=\"string\">'s# ##g'</span> | sed -r <span class=\"string\">'s#(.)#\\1\\n#g'</span> | sort |uniq -c | sort -rn -k1</span><br><span class=\"line\"><span class=\"comment\"># 13 t</span></span><br><span class=\"line\"><span class=\"comment\"># 12 e</span></span><br><span class=\"line\"><span class=\"comment\"># 12 a</span></span><br><span class=\"line\"><span class=\"comment\"># 8 n</span></span><br><span class=\"line\"><span class=\"comment\"># 8 i</span></span><br><span class=\"line\"><span class=\"comment\"># 8 h</span></span><br><span class=\"line\"><span class=\"comment\"># 7 o</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#（2）采用方式2</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$eng</span> | grep -oE <span class=\"string\">'[[:lower:]]'</span> | sort | uniq -c | sort -rn</span><br><span class=\"line\"><span class=\"comment\"># 13 t</span></span><br><span class=\"line\"><span class=\"comment\"># 12 e</span></span><br><span class=\"line\"><span class=\"comment\"># 12 a</span></span><br><span class=\"line\"><span class=\"comment\"># 8 n</span></span><br><span class=\"line\"><span class=\"comment\"># 8 i</span></span><br><span class=\"line\"><span class=\"comment\"># 8 h</span></span><br><span class=\"line\"><span class=\"comment\"># 7 o</span></span><br></pre></td></tr></table></figure></p>\n<p><strong>示例4.读取文件中的字符串，对里面的词组按照长度限定进行输出</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\">eng=<span class=\"string\">\"Making peace with what you don't have, that's what it's all about. I am a technical geek who is interested in learning computer technology.\"</span></span><br><span class=\"line\">arr=(<span class=\"variable\">$eng</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#方式1：</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> value <span class=\"keyword\">in</span> <span class=\"variable\">$eng</span></span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ <span class=\"variable\">$&#123;#value&#125;</span> -gt 6 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;#value&#125;</span>-<span class=\"variable\">$&#123;value&#125;</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#方法2：</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> value <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;arr[*]&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ <span class=\"variable\">$&#123;#value&#125;</span> -gt 6 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;#value&#125;</span>-<span class=\"variable\">$&#123;value&#125;</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#方法3：</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$eng</span> | tr <span class=\"string\">' '</span> <span class=\"string\">'\\n'</span>| awk <span class=\"string\">'&#123;len=length($1); if(len &gt; 6)&#123;print len\"-\"$1&#125;&#125;'</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#执行的结果</span></span><br><span class=\"line\">9-technical</span><br><span class=\"line\">10-interested</span><br><span class=\"line\">8-learning</span><br><span class=\"line\">8-computer</span><br><span class=\"line\">11-technology.</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h2 id=\"0x06-执行效率\"><a href=\"#0x06-执行效率\" class=\"headerlink\" title=\"0x06 执行效率\"></a>0x06 执行效率</h2><p><strong>示例1.评定一个算法的效率打印所用时间</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\">start=$(date +%s)  <span class=\"comment\">#start=`date +%s`,等号不能有空格，如果有空格，会被变量当成命令</span></span><br><span class=\"line\"><span class=\"keyword\">for</span>(( i = 0; i &lt; 5; i++ ));<span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"variable\">$i</span> &gt;/dev/null</span><br><span class=\"line\">    sleep 1</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\">end=`date +%s`</span><br><span class=\"line\">diff=$((<span class=\"variable\">$end</span>-<span class=\"variable\">$start</span>))  <span class=\"comment\">#执行时间之差</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"use times(ms):\"</span><span class=\"variable\">$diff</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"use times(ms):\"</span>$((<span class=\"variable\">$end</span>-<span class=\"variable\">$start</span>))</span><br></pre></td></tr></table></figure></p>\n<hr>\n\n<h2 id=\"0x07-安全运维\"><a href=\"#0x07-安全运维\" class=\"headerlink\" title=\"0x07 安全运维\"></a>0x07 安全运维</h2><p><strong>示例1.防止rm误删操作</strong><br>解决方法：建立类似回收站机制<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1.建立回收站目录(此步骤可省略)</span></span><br><span class=\"line\">$ mkdir ~/.trash</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.建立别名脚本</span></span><br><span class=\"line\">$ sudo vi /tmp/remove.sh</span><br><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"><span class=\"comment\">#定义文件夹目录.trash</span></span><br><span class=\"line\"><span class=\"comment\"># home=$(env | grep ^HOME= | cut -c 6-)</span></span><br><span class=\"line\">trash=<span class=\"string\">\"/.trash\"</span></span><br><span class=\"line\">deltime=$(date +%Y%m%d-%H%M%S)</span><br><span class=\"line\">TRASH_DIR=<span class=\"string\">\"<span class=\"variable\">$&#123;HOME&#125;</span><span class=\"variable\">$&#123;trash&#125;</span>/<span class=\"variable\">$&#123;deltime&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"comment\"># 建立回收站目录当不存在的时候</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -e <span class=\"variable\">$&#123;TRASH_DIR&#125;</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">   mkdir -p <span class=\"variable\">$&#123;TRASH_DIR&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> $*;<span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ <span class=\"string\">\"<span class=\"variable\">$i</span>\"</span> = <span class=\"string\">\"-rf\"</span> ];<span class=\"keyword\">then</span> <span class=\"built_in\">continue</span>;<span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"comment\">#定义秒时间戳</span></span><br><span class=\"line\">  STAMP=`date +%s`</span><br><span class=\"line\">  <span class=\"comment\">#得到文件名称(非文件夹)，参考man basename</span></span><br><span class=\"line\">  fileName=`basename <span class=\"variable\">$i</span>`</span><br><span class=\"line\">  <span class=\"comment\">#将输入的参数，对应文件mv至.trash目录，文件后缀，为当前的时间戳</span></span><br><span class=\"line\">  mv <span class=\"variable\">$i</span> <span class=\"variable\">$&#123;TRASH_DIR&#125;</span>/<span class=\"variable\">$&#123;fileName&#125;</span>.<span class=\"variable\">$&#123;STAMP&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\">sudo chmod +x /tmp/remove.sh</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3.建立别名机制</span></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> vi /etc/bashrc</span><br><span class=\"line\"><span class=\"comment\"># User specific aliases and functions</span></span><br><span class=\"line\"><span class=\"built_in\">alias</span> rm=<span class=\"string\">\"sh /home/user/tool/remove.sh\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/bashrc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4.每日03:00定时执行清空隐藏目录.trash当然您也可以清理前一天删除的</span></span><br><span class=\"line\">0 3 * * * find ~/.trash/ -mtime +1  -delete</span><br></pre></td></tr></table></figure></p>\n<hr>\n\n<h2 id=\"0x08-防火墙应用\"><a href=\"#0x08-防火墙应用\" class=\"headerlink\" title=\"0x08 防火墙应用\"></a>0x08 防火墙应用</h2><p><em>示例1.防止web的ddos攻击与反爬虫</em><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># 实现要求：</span></span><br><span class=\"line\"><span class=\"comment\"># 1.根据web日志或者网络连接数，监控某个IP并发连接数或者段时间内达到PV到100，即调用防火墙封掉对应IP；</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">main</span></span>()&#123;</span><br><span class=\"line\">  cat access.log | awk <span class=\"string\">'&#123;print $1&#125;'</span> | sort | uniq -c | sort -r &gt; a.log</span><br><span class=\"line\">  <span class=\"built_in\">exec</span>&lt;a.log</span><br><span class=\"line\">  <span class=\"keyword\">while</span> <span class=\"built_in\">read</span> line</span><br><span class=\"line\">  <span class=\"keyword\">do</span></span><br><span class=\"line\">    pv=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$line</span>|awk <span class=\"string\">'&#123;print $1&#125;'</span>)</span><br><span class=\"line\">    ip=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$line</span>|awk <span class=\"string\">'&#123;print $2&#125;'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ <span class=\"variable\">$pv</span> -gt <span class=\"variable\">$1</span> ] &amp;&amp; [ $(iptables -L -n|grep <span class=\"string\">\"<span class=\"variable\">$ip</span>\"</span>|wc -l) -eq 0];<span class=\"keyword\">then</span></span><br><span class=\"line\">      itables -A INPUT -s <span class=\"variable\">$ip</span> -j DROP </span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">done</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">main 1024</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"0x09-字符串截取\"><a href=\"#0x09-字符串截取\" class=\"headerlink\" title=\"0x09 字符串截取\"></a>0x09 字符串截取</h2><p>描述: 在shell中截取字符串的常用方法，前面基础文章也将近过此处简单的做一个总结。</p>\n<p><strong>语法示例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$&#123;#var&#125;</span>   <span class=\"comment\"># 字符串长度</span></span><br><span class=\"line\"><span class=\"variable\">$&#123;var#*/&#125;</span> <span class=\"comment\"># 获取尾部子字符串 *号在分隔符的前面，就去掉其之前的字符 (首个 / 后的值)</span></span><br><span class=\"line\"><span class=\"variable\">$&#123;var##*/&#125;</span> <span class=\"comment\"># (最尾 / 后的值)</span></span><br><span class=\"line\"><span class=\"variable\">$&#123;var%/*&#125;</span>  <span class=\"comment\"># 获取头部子字符串 *号在分隔符的前面，就去掉其之前的字符 (最尾 / 前的值)</span></span><br><span class=\"line\"><span class=\"variable\">$&#123;var%%/*&#125;</span> <span class=\"comment\"># (首个 / 前的值)</span></span><br><span class=\"line\"><span class=\"variable\">$&#123;var:start:len&#125;</span>  <span class=\"comment\"># 指定从左边第几个字符开始以及子串中字符的个数</span></span><br><span class=\"line\"><span class=\"variable\">$&#123;var:start&#125;</span>      <span class=\"comment\"># 从左边第几个字符开始一直到结束</span></span><br><span class=\"line\"><span class=\"variable\">$&#123;var:0-start:len&#125;</span> <span class=\"comment\"># 从右边第几个字符开始以及字符的个数</span></span><br><span class=\"line\"><span class=\"variable\">$&#123;var:0-start&#125;</span>     <span class=\"comment\"># 从右边第几个字符开始一直到结束</span></span><br><span class=\"line\"><span class=\"variable\">$&#123;var/dir/path&#125;</span>    <span class=\"comment\"># 表示将变量中第一个 dir 提换为 path</span></span><br><span class=\"line\"><span class=\"variable\">$&#123;var//dir/path&#125;</span>   <span class=\"comment\"># 表示将变量中全部 dir 提换为 path</span></span><br><span class=\"line\"><span class=\"variable\">$&#123;file-my.txt&#125;</span>  <span class=\"comment\"># 表示假如 $file 没设定，则使用 my.txt 作传回值。(空值及非空值时不作处理)</span></span><br><span class=\"line\"><span class=\"variable\">$&#123;file:-my.txt&#125;</span> <span class=\"comment\"># 表示假如 $file 没设定或为空值，则使用 my.txt 作传回值。 (非空值时不作处理)</span></span><br><span class=\"line\"><span class=\"variable\">$&#123;file+my.txt&#125;</span>  <span class=\"comment\"># 表示假如 $file 设为空值或非空值，均使用 my.txt 作传回值。(没设定时不作处理)</span></span><br><span class=\"line\"><span class=\"variable\">$&#123;file:+my.txt&#125;</span> <span class=\"comment\"># 表示假如 $file 为非空值，则使用 my.txt 作传回值。 (没设定及空值时不作处理)</span></span><br><span class=\"line\"><span class=\"variable\">$&#123;file=my.txt&#125;</span>  <span class=\"comment\"># 表示假如 $file 没设定，则使用 my.txt 作传回值，同时将 $file 赋值为 my.txt 。 (空值及非空值时不作处理)</span></span><br><span class=\"line\"><span class=\"variable\">$&#123;file:=my.txt&#125;</span> <span class=\"comment\"># 表示假如 $file 没设定或为空值，则使用 my.txt 作传回值，同时将 $file 赋值为 my.txt 。 (非空值时不作处理)</span></span><br><span class=\"line\"><span class=\"variable\">$&#123;file?my.txt&#125;</span>  <span class=\"comment\"># 表示假如 $file 没设定，则将 my.txt 输出至 STDERR。 (空值及非空值时不作处理)</span></span><br><span class=\"line\"><span class=\"variable\">$&#123;file:?my.txt&#125;</span> <span class=\"comment\"># 表示假如 $file 没设定或为空值，则将 my.txt 输出至 STDERR。 (非空值时不作处理)</span></span><br></pre></td></tr></table></figure></p>\n<p><strong>总结说明:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#        删除最小的匹配前缀</span></span><br><span class=\"line\"><span class=\"comment\">##       删除最大的匹配前缀</span></span><br><span class=\"line\">%        删除最小的匹配后缀</span><br><span class=\"line\">%%     删除最大的匹配后缀</span><br></pre></td></tr></table></figure></p>\n<p><strong>示例演示:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># Description: Shell总字符串截取总结.</span></span><br><span class=\"line\">str=<span class=\"string\">\"https://blog.weiyigeek.top/about/me\"</span></span><br><span class=\"line\"><span class=\"comment\"># 原字符串输出</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"string: [<span class=\"variable\">$&#123;str&#125;</span>]\"</span></span><br><span class=\"line\"><span class=\"comment\"># 获得字符串的长度</span></span><br><span class=\"line\">length=<span class=\"variable\">$&#123;#str&#125;</span>; <span class=\"built_in\">echo</span> <span class=\"string\">\"length: [<span class=\"variable\">$&#123;length&#125;</span>]\"</span></span><br><span class=\"line\"><span class=\"comment\"># 获得尾部字符串，分割符为'/'</span></span><br><span class=\"line\">substr=<span class=\"variable\">$&#123;str#*/&#125;</span>;<span class=\"built_in\">echo</span> <span class=\"string\">\"substr: [<span class=\"variable\">$&#123;substr&#125;</span>]\"</span></span><br><span class=\"line\">substr=<span class=\"variable\">$&#123;str##*/&#125;</span>;<span class=\"built_in\">echo</span> <span class=\"string\">\"substr: [<span class=\"variable\">$&#123;substr&#125;</span>]\"</span></span><br><span class=\"line\"><span class=\"comment\"># 获得头部字符串，分割符为'/'</span></span><br><span class=\"line\">headstr=<span class=\"variable\">$&#123;str%/*&#125;</span>;<span class=\"built_in\">echo</span> <span class=\"string\">\"headstr: [<span class=\"variable\">$&#123;headstr&#125;</span>]\"</span></span><br><span class=\"line\">headstr=<span class=\"variable\">$&#123;str%%/*&#125;</span>;<span class=\"built_in\">echo</span> <span class=\"string\">\"headstr: [<span class=\"variable\">$&#123;headstr&#125;</span>]\"</span></span><br><span class=\"line\"><span class=\"comment\"># 获得指定数量的字符串</span></span><br><span class=\"line\">numstr=<span class=\"variable\">$&#123;str:0:8&#125;</span>;<span class=\"built_in\">echo</span> <span class=\"string\">\"numstr: [<span class=\"variable\">$&#123;numstr&#125;</span>]\"</span></span><br><span class=\"line\">numstr=<span class=\"variable\">$&#123;str:8&#125;</span>;<span class=\"built_in\">echo</span> <span class=\"string\">\"numstr: [<span class=\"variable\">$&#123;numstr&#125;</span>]\"</span></span><br><span class=\"line\">numstr=<span class=\"variable\">$&#123;str:0-$&#123;length&#125;</span>:8&#125;;<span class=\"built_in\">echo</span> <span class=\"string\">\"numstr: [<span class=\"variable\">$&#123;numstr&#125;</span>]\"</span></span><br><span class=\"line\">numstr=<span class=\"variable\">$&#123;str:0-8&#125;</span>;<span class=\"built_in\">echo</span> <span class=\"string\">\"numstr: [<span class=\"variable\">$&#123;numstr&#125;</span>]\"</span></span><br><span class=\"line\"><span class=\"comment\"># 指定字符替换字符串中字符</span></span><br><span class=\"line\">replstr=<span class=\"variable\">$&#123;str/https/ftp&#125;</span>;<span class=\"built_in\">echo</span> <span class=\"string\">\"replstr: [<span class=\"variable\">$&#123;replstr&#125;</span>]\"</span></span><br><span class=\"line\">replstr=<span class=\"variable\">$&#123;str/./-&#125;</span>;<span class=\"built_in\">echo</span> <span class=\"string\">\"replstr: [<span class=\"variable\">$&#123;replstr&#125;</span>]\"</span></span><br><span class=\"line\">replstr=<span class=\"variable\">$&#123;str//about/index&#125;</span>;<span class=\"built_in\">echo</span> <span class=\"string\">\"replstr: [<span class=\"variable\">$&#123;replstr&#125;</span>]\"</span></span><br><span class=\"line\"><span class=\"comment\"># 针对不同的变量状态赋值 (没设定、空值、非空值)</span></span><br><span class=\"line\">appid=<span class=\"variable\">$&#123;APP_ID:-NULL&#125;</span>; <span class=\"built_in\">echo</span> <span class=\"string\">\"appid: [<span class=\"variable\">$&#123;appid&#125;</span>]\"</span>     <span class=\"comment\"># 加有 : 没设定或为空值</span></span><br><span class=\"line\">appname=<span class=\"variable\">$&#123;APP_NAME:=null&#125;</span> ;<span class=\"built_in\">echo</span> <span class=\"string\">\"appname: [<span class=\"variable\">$&#123;appname&#125;</span>]\"</span></span><br><span class=\"line\">appstderr=<span class=\"variable\">$&#123;APP_STDERR:?null&#125;</span>;<span class=\"built_in\">echo</span> <span class=\"string\">\"appstderr: [<span class=\"variable\">$&#123;appstderr&#125;</span>]\"</span></span><br><span class=\"line\">appadd=<span class=\"variable\">$&#123;APP_ADD:+null&#125;</span>;<span class=\"built_in\">echo</span> <span class=\"string\">\"appadd: [<span class=\"variable\">$&#123;appadd&#125;</span>]\"</span></span><br></pre></td></tr></table></figure></p>\n<p><strong>执行结果:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./demo.sh</span><br><span class=\"line\">string: [https://blog.weiyigeek.top/about/me]</span><br><span class=\"line\">length: [35]</span><br><span class=\"line\">substr: [/blog.weiyigeek.top/about/me]</span><br><span class=\"line\">substr: [me]</span><br><span class=\"line\">headstr: [https://blog.weiyigeek.top/about]</span><br><span class=\"line\">headstr: [https:]</span><br><span class=\"line\">numstr: [https://]</span><br><span class=\"line\">numstr: [blog.weiyigeek.top/about/me]</span><br><span class=\"line\">numstr: [https://]</span><br><span class=\"line\">numstr: [about/me]</span><br><span class=\"line\">replstr: [ftp://blog.weiyigeek.top/about/me]</span><br><span class=\"line\">replstr: [https://blog-weiyigeek.top/about/me]</span><br><span class=\"line\">replstr: [https://blog.weiyigeek.top/index/me]</span><br><span class=\"line\">appid: [NULL]</span><br><span class=\"line\">appname: [null]</span><br><span class=\"line\">./demo.sh: line 26: APP_STDERR: null</span><br></pre></td></tr></table></figure></p>\n<hr>\n<h2 id=\"0x0n-杂类脚本\"><a href=\"#0x0n-杂类脚本\" class=\"headerlink\" title=\"0x0n 杂类脚本\"></a>0x0n 杂类脚本</h2><p><strong>示例1.Linux系统信息获取</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#zhushi:Linux 系统信息获取</span></span><br><span class=\"line\"><span class=\"comment\">#Author_Name=Weiyi</span></span><br><span class=\"line\">clear</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$#</span> -eq 0 ];<span class=\"keyword\">then</span>    <span class=\"comment\"># \"$#\" 提取位置参数的个数</span></span><br><span class=\"line\">reset_terminal=$(tput sgr0)  <span class=\"comment\">#设置高亮输出</span></span><br><span class=\"line\"><span class=\"comment\">#Check OS Type (系统类型)</span></span><br><span class=\"line\">  os=$(uname -o)</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[32m'</span> <span class=\"string\">\"OS Type (系统类型):\"</span> <span class=\"variable\">$reset_terminal</span> <span class=\"variable\">$os</span></span><br><span class=\"line\"><span class=\"comment\">#Check OS Release Version and Name (系统发行版本及名字)</span></span><br><span class=\"line\">  os_Rv=$(lsb_release -a | grep <span class=\"string\">\"Description\"</span> |awk <span class=\"string\">'&#123;print $2 \" \" $3 \" \" $4 \" \"$5$6 &#125;'</span>)</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[32m'</span> <span class=\"string\">\"OS Release Version and Name (系统发行版本及名字):\"</span> <span class=\"variable\">$reset_terminal</span> <span class=\"variable\">$os_Rv</span></span><br><span class=\"line\"><span class=\"comment\">#Check Architecture (系统Cpu 386 还是 X64架构)</span></span><br><span class=\"line\">  os_Ar=$(uname -m)</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[32m'</span> <span class=\"string\">\"Architecture (系统Cpu 386 还是 X64架构):\"</span> <span class=\"variable\">$reset_terminal</span> <span class=\"variable\">$os_Ar</span></span><br><span class=\"line\"><span class=\"comment\">#Check Kernel Release (内核版本)</span></span><br><span class=\"line\">  os_Kr=$(uname -r)</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[32m'</span> <span class=\"string\">\"Kernel Release (内核版本)\"</span> <span class=\"variable\">$reset_terminal</span> <span class=\"variable\">$os_Kr</span></span><br><span class=\"line\"><span class=\"comment\">#Check hostname</span></span><br><span class=\"line\">  os_hostname=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$HOSTNAME</span>)</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[32m'</span> <span class=\"string\">\"OS Hostname (主机名):\"</span> <span class=\"variable\">$reset_terminal</span> <span class=\"variable\">$os_hostname</span></span><br><span class=\"line\"><span class=\"comment\">#Check Internal IP (内部IP)</span></span><br><span class=\"line\">  os_InIP=$(hostname -I)</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[32m'</span> <span class=\"string\">\"Internal IP (内部IP):\"</span> <span class=\"variable\">$reset_terminal</span> <span class=\"variable\">$os_InIP</span></span><br><span class=\"line\"><span class=\"comment\">#Check External IP (外部IP)</span></span><br><span class=\"line\">  os_ExIP=$(curl -s http://ipecho.net/plain)</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[32m'</span> <span class=\"string\">\"External IP (外部IP):\"</span> <span class=\"variable\">$reset_terminal</span> <span class=\"variable\">$os_ExIP</span></span><br><span class=\"line\"><span class=\"comment\">#Check DNS</span></span><br><span class=\"line\">  os_Dns=$(cat /etc/resolv.conf |grep -E <span class=\"string\">\"\\&lt;nameserver[ ]+\"</span> |awk <span class=\"string\">'&#123;print $NF&#125;'</span>)</span><br><span class=\"line\">  <span class=\"comment\"># \"\\&lt;nameserver[ ]+\" 表示匹配以nameserver开头的多个[ ]+ //空格</span></span><br><span class=\"line\">  <span class=\"comment\"># \"$NF\" 默认以空格为分割符打印他得最后一行</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[32m'</span> <span class=\"string\">\"OS DNS (系统DNS):\"</span> <span class=\"variable\">$reset_terminal</span> <span class=\"variable\">$os_Dns</span></span><br><span class=\"line\"><span class=\"comment\">#Check IF Connected To Internet or not (是否能连接英特网)</span></span><br><span class=\"line\">  ping -c 2 www.baidu.com &amp;&gt;/dev/null &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">\"Internet:Connected(正常通信)\"</span> || <span class=\"built_in\">echo</span> <span class=\"string\">\"Internet:Disconnected(不能正常通信)\"</span> </span><br><span class=\"line\"><span class=\"comment\">#Check logged In Users (当前登陆的用户)</span></span><br><span class=\"line\">  who &gt;/tmp/who</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[32m'</span> <span class=\"string\">\"Logged In Users (当前登陆的用户)\"</span> <span class=\"variable\">$reset_terminal</span> &amp;&amp; cat /tmp/who</span><br><span class=\"line\">  rm -rf /tmp/who</span><br><span class=\"line\"><span class=\"comment\">#Check Proc Information</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[35m]'</span> <span class=\"string\">\"########### Proc info (内存使用信息) ##############\\n\"</span></span><br><span class=\"line\">  system_mem_usages=$(awk <span class=\"string\">'/MemTotal/&#123;total=$2&#125;/MemFree/&#123;free=$2&#125;END&#123;print (total-free)/1024&#125;'</span> /proc/meminfo)</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[32m'</span> <span class=\"string\">\"System Mem Usages (当前系统使用内存信息-MB):\"</span> <span class=\"variable\">$reset_terminal</span> <span class=\"variable\">$system_mem_usages</span></span><br><span class=\"line\">  application_mem_usages=$(awk <span class=\"string\">'/MemTotal/&#123;total=$2&#125;/MemFree/&#123;free=$2&#125;/^Cached/&#123;cached=$2&#125;/Buffers/&#123;buffers=$2&#125;END&#123;print (total-free-cached-buffers)/1024&#125;'</span> /proc/meminfo)</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[32m'</span> <span class=\"string\">\"Application Mem Usages (当前应用使用内存信息-MB):\"</span> <span class=\"variable\">$reset_terminal</span> <span class=\"variable\">$application_mem_usages</span></span><br><span class=\"line\"><span class=\"comment\">#Check Cpu Information &gt;&gt; load average后面分别是1分钟、5分钟、15分钟的负载情况</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[35m]'</span> <span class=\"string\">\"########### Cpu load info (Cpu负载信息) ##############\\n\"</span></span><br><span class=\"line\">  load_average=$(top -n 1 -b |grep <span class=\"string\">\"load average:\"</span> |awk <span class=\"string\">'&#123;print $10 $11 $12&#125;'</span>)</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[32m'</span> <span class=\"string\">\"Cpu load info (Cpu负载信息):\"</span> <span class=\"variable\">$reset_terminal</span> <span class=\"variable\">$load_average</span></span><br><span class=\"line\"><span class=\"comment\">#Check Disk Information</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[35m]'</span> <span class=\"string\">\"########### Disk info (磁盘使用信息) ##############\\n\"</span></span><br><span class=\"line\">  disk_info=$(df -h |grep -vE <span class=\"string\">\"Filesystem|tmpfs\"</span> |awk <span class=\"string\">'&#123;printf $1 \"\\t\" $5 \"\\n\"&#125;'</span>)</span><br><span class=\"line\">  <span class=\"comment\"># -p 使用输出更紧凑</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[32m'</span> <span class=\"string\">\"Disk Usages (磁盘使用信息):\"</span> <span class=\"variable\">$reset_terminal</span> <span class=\"variable\">$disk_info</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190723091030.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p><br></p>\n<p><strong>示例2.进程监控</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#zhushi:httpd进程restart and if</span></span><br><span class=\"line\"><span class=\"built_in\">test</span>=$(ps aux | grep <span class=\"string\">\"httpd\"</span> | grep -v <span class=\"string\">\"grep\"</span>) <span class=\"comment\">#截取Httpd进程,并把结果赋予变量test</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -n <span class=\"string\">\"<span class=\"variable\">$test</span>\"</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\"><span class=\"comment\">#if test 的值不为空，则执行then中的命令</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$(date)</span> httpd is ok!\"</span> &gt;&gt; /tmp/autostart-acc.log</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"httpd服务正常\"</span></span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"http服务异常/正在重新启动httpd服务\"</span></span><br><span class=\"line\">    /etc/rc.d/init.d/httpd restart &amp;&gt; /dev/null</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$(date)</span> restart httpd!!\"</span> &gt;&gt; /tmp/autostart-err.log</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>示例3.apachelog日志分析</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#zhushi:Http status number</span></span><br><span class=\"line\"><span class=\"comment\">#author_Name:Weiyi</span></span><br><span class=\"line\"></span><br><span class=\"line\">resettem=$(tput sgr0)</span><br><span class=\"line\"><span class=\"built_in\">read</span> -t 30 -p <span class=\"string\">\"Please,Input access Httpd log pash:\"</span> logfile</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Check http status Functions</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">Check_http_status</span></span>()&#123;</span><br><span class=\"line\">  http_status_codes=$(cat <span class=\"variable\">$logfile</span> |grep -ioE <span class=\"string\">'HTTP\\/1\\.[0|1]\\\"[[:blank:]][0-9]&#123;3&#125;'</span> |awk -F <span class=\"string\">\"[ ]+\"</span> <span class=\"string\">'&#123;</span></span><br><span class=\"line\"><span class=\"string\">\t\tif ( $2&gt;100 &amp;&amp; $2&lt;200 )</span></span><br><span class=\"line\"><span class=\"string\">\t\t\t&#123;i++&#125; </span></span><br><span class=\"line\"><span class=\"string\">\t\telse if ( $2&gt;200 &amp;&amp; $2&lt;300 )</span></span><br><span class=\"line\"><span class=\"string\">\t\t\t&#123;j++&#125;</span></span><br><span class=\"line\"><span class=\"string\">\t\telse if ( $2&gt;300 &amp;&amp; $2&lt;400 )</span></span><br><span class=\"line\"><span class=\"string\">\t\t\t&#123;k++&#125;</span></span><br><span class=\"line\"><span class=\"string\">\t\telse if ( $2&gt;400 &amp;&amp; $2&lt;500 )</span></span><br><span class=\"line\"><span class=\"string\">\t\t\t&#123;n++&#125;</span></span><br><span class=\"line\"><span class=\"string\">\t\telse if ( $2&gt;500 )</span></span><br><span class=\"line\"><span class=\"string\">\t\t\t&#123;p++&#125;</span></span><br><span class=\"line\"><span class=\"string\">\t\t&#125;END&#123;</span></span><br><span class=\"line\"><span class=\"string\">\t\t\tprint i?i:0,j?j:0,k?k:0,n?n:0,p?p:0,i+j+k+n+p</span></span><br><span class=\"line\"><span class=\"string\">\t\t&#125;'</span>)</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[33m'</span> <span class=\"string\">\"The Number of http status[100+]:\"</span> <span class=\"variable\">$resettem</span> <span class=\"variable\">$&#123;http_status_codes[0]&#125;</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[33m'</span> <span class=\"string\">\"The Number of http status[200+]:\"</span> <span class=\"variable\">$resettem</span> <span class=\"variable\">$&#123;http_status_codes[1]&#125;</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[33m'</span> <span class=\"string\">\"The Number of http status[300+]:\"</span> <span class=\"variable\">$resettem</span> <span class=\"variable\">$&#123;http_status_codes[2]&#125;</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[33m'</span> <span class=\"string\">\"The Number of http status[400+]:\"</span> <span class=\"variable\">$resettem</span> <span class=\"variable\">$&#123;http_status_codes[3]&#125;</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[33m'</span> <span class=\"string\">\"The Number of http status[500+]:\"</span> <span class=\"variable\">$resettem</span> <span class=\"variable\">$&#123;http_status_codes[4]&#125;</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[33m'</span> <span class=\"string\">\"All Request numbers:\"</span> <span class=\"variable\">$resettem</span> <span class=\"variable\">$&#123;http_status_codes[5]&#125;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Check http Code 404/403 Functions</span></span><br><span class=\"line\">Check_http_code()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  http_code=$(cat <span class=\"variable\">$logfile</span> |grep -ioE <span class=\"string\">'HTTP\\/1\\.[0|1]\\\"[[:blank:]][0-9]&#123;3&#125;'</span> |awk -v total=0 -F <span class=\"string\">'[ ]+'</span> <span class=\"string\">'&#123;</span></span><br><span class=\"line\"><span class=\"string\">\t\tif ( $2 != \"\" )</span></span><br><span class=\"line\"><span class=\"string\">\t\t\t&#123;code[$2]++;total++&#125;</span></span><br><span class=\"line\"><span class=\"string\">\t\telse</span></span><br><span class=\"line\"><span class=\"string\">\t\t\t&#123;exit&#125;</span></span><br><span class=\"line\"><span class=\"string\">\t&#125;END&#123;</span></span><br><span class=\"line\"><span class=\"string\">\t\tprint code[404]?code[404]:0,code[403]?code[403]:0,total</span></span><br><span class=\"line\"><span class=\"string\">\t&#125;'</span>)</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[33m'</span> <span class=\"string\">\"The Number of http status[404]:\"</span> <span class=\"variable\">$resettem</span> <span class=\"variable\">$&#123;http_status_codes[0]&#125;</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[33m'</span> <span class=\"string\">\"The Number of http status[403]:\"</span> <span class=\"variable\">$resettem</span> <span class=\"variable\">$&#123;http_status_codes[1]&#125;</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">'\\E[33m'</span> <span class=\"string\">\"All Request numbers:\"</span> <span class=\"variable\">$resettem</span> <span class=\"variable\">$&#123;http_status_codes[2]&#125;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#调用函数</span></span><br><span class=\"line\">Check_http_status</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">'\\n'</span></span><br><span class=\"line\">Check_http_code</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>示例4.Monitor脚本设置</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># tput sgr0 终端号关闭</span></span><br><span class=\"line\">resettem=$(tput sgr0)      </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">declare</span> -A ssharray</span><br><span class=\"line\">i=0</span><br><span class=\"line\">number=<span class=\"string\">\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> script_file <span class=\"keyword\">in</span> `ls -I <span class=\"string\">\"monitor_man.sh\"</span> ./`;<span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[1;35m\"</span> <span class=\"string\">\"The script file:\"</span> <span class=\"variable\">$&#123;i&#125;</span> <span class=\"string\">'==&gt;'</span> <span class=\"variable\">$&#123;resettem&#125;</span> <span class=\"variable\">$&#123;script_file&#125;</span></span><br><span class=\"line\">    grep <span class=\"string\">\"#zhushi:\"</span> <span class=\"variable\">$&#123;script_file&#125;</span>     <span class=\"comment\"># 获取备注信息</span></span><br><span class=\"line\">    ssharray[<span class=\"variable\">$i</span>]=<span class=\"variable\">$&#123;script_file&#125;</span>        <span class=\"comment\"># 将每个文件传人数组之中</span></span><br><span class=\"line\">    number=<span class=\"string\">\"<span class=\"variable\">$&#123;number&#125;</span> | <span class=\"variable\">$&#123;i&#125;</span>\"</span>          <span class=\"comment\"># 拼接子符</span></span><br><span class=\"line\">    i=$(( i+1 ))</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"keyword\">do</span>\t</span><br><span class=\"line\">  <span class=\"built_in\">read</span> -t 30 -p <span class=\"string\">\"Please input a number[ <span class=\"variable\">$&#123;number&#125;</span> ]:\"</span> file    <span class=\"comment\"># 输出number变量</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [[ ! <span class=\"variable\">$&#123;file&#125;</span> =~ ^[0-9]+ ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 0</span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\">  /bin/sh ./<span class=\"variable\">$&#123;ssharray[$file]&#125;</span>    <span class=\"comment\"># 传入数组之中,并执行</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure></p>\n<p><strong>实例5:日志访问数量统计</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 错误输入到err.txt</span></span><br><span class=\"line\">result=0</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> &#123;20..30&#125;;</span><br><span class=\"line\"><span class=\"keyword\">do</span> </span><br><span class=\"line\">  count=$(grep -c <span class=\"string\">\"/cj/get.do?ksh=\"</span> localhost_access_log.2020-11-<span class=\"variable\">$&#123;i&#125;</span>.txt 2&gt; err.txt)</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"variable\">$count</span></span><br><span class=\"line\">  result=$(expr <span class=\"variable\">$result</span> + <span class=\"variable\">$count</span>) </span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$result</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>示例5.字符串截取之文件拷贝</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> $(cat 1.txt); <span class=\"keyword\">do</span> src=<span class=\"variable\">$&#123;i%-*&#125;</span> ; target=<span class=\"variable\">$&#123;i#*-&#125;</span>; srcname=<span class=\"string\">\"<span class=\"variable\">$&#123;src%.*&#125;</span>\"</span>; targetname=<span class=\"string\">\"<span class=\"variable\">$&#123;target%/*&#125;</span>\"</span>;mkdir -p <span class=\"variable\">$&#123;targetname&#125;</span>; find <span class=\"variable\">$&#123;srcname&#125;</span>* -<span class=\"built_in\">exec</span> cp &#123;&#125; <span class=\"variable\">$&#123;target&#125;</span> \\; ; <span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>示例6.按照身份证进行字符串分隔创建目录</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"comment\"># $ find gz2020/photo -type f &gt; ks.txt</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> id <span class=\"keyword\">in</span> $(cat ks.txt); <span class=\"keyword\">do</span> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 判断路径以及身份证类别</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [[ <span class=\"variable\">$&#123;#id&#125;</span> -ne 29 ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;id&#125;</span> &gt;&gt; exception.txt</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">  photo_name=<span class=\"string\">\"<span class=\"variable\">$&#123;id##*/&#125;</span>\"</span></span><br><span class=\"line\">  id_split=<span class=\"string\">\"<span class=\"variable\">$&#123;id:7:2&#125;</span>/<span class=\"variable\">$&#123;id:9:4&#125;</span>/<span class=\"variable\">$&#123;id:13:4&#125;</span>\"</span></span><br><span class=\"line\">  target_dir=<span class=\"string\">\"/mnt/f/2020/pz_webchat/<span class=\"variable\">$&#123;id_split&#125;</span>\"</span></span><br><span class=\"line\">  target_file=<span class=\"string\">\"<span class=\"variable\">$&#123;target_dir&#125;</span>/<span class=\"variable\">$&#123;photo_name&#125;</span>\"</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [[ ! -e <span class=\"variable\">$&#123;target_dir&#125;</span> ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    mkdir -p <span class=\"variable\">$&#123;target_dir&#125;</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 区分后缀大小写</span></span><br><span class=\"line\">  ignore_case=$(<span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$&#123;target_file&#125;</span>\"</span> | grep -c <span class=\"string\">\"JPG\"</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [[ <span class=\"variable\">$&#123;ignore_case&#125;</span> -eq 0 ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ ! -e <span class=\"variable\">$&#123;target_file&#125;</span> ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">      cp -a <span class=\"variable\">$&#123;id&#125;</span> <span class=\"variable\">$&#123;target_file&#125;</span> || <span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;id&#125;</span> &gt;&gt; notcopy.txt</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      <span class=\"built_in\">echo</span> <span class=\"string\">\"normal - <span class=\"variable\">$&#123;target_file&#125;</span>\"</span> &gt;&gt; exsit.txt</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    photo_name_case=<span class=\"string\">\"<span class=\"variable\">$&#123;photo_name%.*&#125;</span>.jpg\"</span></span><br><span class=\"line\">    target_file_case=<span class=\"string\">\"<span class=\"variable\">$&#123;target_dir&#125;</span>/<span class=\"variable\">$&#123;photo_name_case&#125;</span>\"</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ ! -e <span class=\"variable\">$&#123;target_file_case&#125;</span> ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">      cp -a <span class=\"variable\">$&#123;id&#125;</span> <span class=\"variable\">$&#123;target_file_case&#125;</span> || <span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;id&#125;</span> &gt;&gt; notcopy.txt</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      <span class=\"built_in\">echo</span> <span class=\"string\">\"case - <span class=\"variable\">$&#123;target_file&#125;</span> -&gt; <span class=\"variable\">$&#123;target_file_case&#125;</span>\"</span> &gt;&gt; exsit_case.txt</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p><strong>示例7.Jenkins与K8s集群部署脚本实现部署、回退以及覆盖部署</strong><br>脚本清单:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> K8sMaster=<span class=\"string\">\"<span class=\"variable\">$&#123;DEPLOY_USER&#125;</span>@<span class=\"variable\">$&#123;DEPLOY_HOST&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> AppName=<span class=\"string\">\"<span class=\"variable\">$&#123;APP_FILE##*/&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> FindAppName=$(find <span class=\"variable\">$&#123;WORKSPACE&#125;</span> -maxdepth 2 -<span class=\"built_in\">type</span> f -name <span class=\"variable\">$&#123;AppName&#125;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">\"<span class=\"variable\">$&#123;FindAppName&#125;</span>\"</span> != <span class=\"string\">\"\"</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"[-Msg]: <span class=\"variable\">$&#123;FindAppName&#125;</span> ./<span class=\"variable\">$&#123;APP_NAME&#125;</span> Copying....\"</span></span><br><span class=\"line\">  cp -rf <span class=\"variable\">$&#123;FindAppName&#125;</span> ./<span class=\"variable\">$&#123;APP_NAME&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"[-Error]: FindAppName param error!\"</span></span><br><span class=\"line\">  <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">judge</span></span> () &#123;</span><br><span class=\"line\">  <span class=\"built_in\">export</span> ExistResult=$(ssh -p <span class=\"variable\">$&#123;DEPLOY_PORT&#125;</span> <span class=\"variable\">$&#123;K8sMaster&#125;</span> <span class=\"string\">\"ls <span class=\"variable\">$&#123;APP_DIR&#125;</span> | grep <span class=\"variable\">$&#123;RELEASE_VERSION&#125;</span> | wc -l\"</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">deploy</span></span> () &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [[ <span class=\"variable\">$&#123;ExistResult&#125;</span> -eq 0 || <span class=\"string\">\"<span class=\"variable\">$&#123;RELEASE_VERSION&#125;</span>\"</span> == <span class=\"string\">\"master\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">    scp -P <span class=\"variable\">$&#123;DEPLOY_PORT&#125;</span> <span class=\"string\">\"<span class=\"variable\">$&#123;APP_NAME&#125;</span>\"</span> <span class=\"variable\">$&#123;K8sMaster&#125;</span>:<span class=\"variable\">$&#123;APP_DIR&#125;</span><span class=\"variable\">$&#123;APP_NAME&#125;</span></span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"[-Msg]: /<span class=\"variable\">$&#123;APP_NAME&#125;</span> current Deploy.....\"</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 部署脚本</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [[ <span class=\"string\">\"<span class=\"variable\">$&#123;RELEASE_VERSION&#125;</span>\"</span> == <span class=\"string\">\"master\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">    ssh -p <span class=\"variable\">$&#123;DEPLOY_PORT&#125;</span> <span class=\"variable\">$&#123;K8sMaster&#125;</span> <span class=\"string\">\"kubectl -n <span class=\"variable\">$&#123;K8S_NAMESPACE&#125;</span> delete pod -l <span class=\"variable\">$&#123;K8S_SELECTOR&#125;</span>\"</span></span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    ssh -p <span class=\"variable\">$&#123;DEPLOY_PORT&#125;</span> <span class=\"variable\">$&#123;K8sMaster&#125;</span> <span class=\"string\">\"kubectl apply -f <span class=\"variable\">$&#123;APP_DIR&#125;</span><span class=\"variable\">$&#123;JOB_NAME&#125;</span>.yaml\"</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">rollback</span></span> () &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [[ <span class=\"variable\">$&#123;ExistResult&#125;</span> -ne 0 ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">    ssh -p <span class=\"variable\">$&#123;DEPLOY_PORT&#125;</span> <span class=\"variable\">$&#123;K8sMaster&#125;</span> <span class=\"string\">\"kubectl apply -f <span class=\"variable\">$&#123;APP_DIR&#125;</span><span class=\"variable\">$&#123;JOB_NAME&#125;</span>.yaml\"</span></span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"[-Eroor]: /<span class=\"variable\">$&#123;APP_NAME&#125;</span> version not exsit.....\"</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">redeploy</span></span> () &#123;</span><br><span class=\"line\">  <span class=\"comment\"># 如果是以前部署过则删除以前部署的项目目录,否则重新部署;</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [[ <span class=\"string\">\"v<span class=\"variable\">$&#123;GIT_COMMIT&#125;</span>\"</span> = <span class=\"string\">\"v<span class=\"variable\">$&#123;GIT_PREVIOUS_SUCCESSFUL_COMMIT&#125;</span>\"</span> || <span class=\"variable\">$&#123;ExistResult&#125;</span> -gt 0 ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">\"[-Message]:  <span class=\"variable\">$&#123;RELEASE_VERSION&#125;</span> Version Exsit !\"</span></span><br><span class=\"line\">    ssh -p <span class=\"variable\">$&#123;DEPLOY_PORT&#125;</span> <span class=\"variable\">$&#123;K8sMaster&#125;</span> <span class=\"string\">\"find <span class=\"variable\">$&#123;APP_DIR&#125;</span> -d -maxdepth 1 -type f -name <span class=\"variable\">$&#123;APP_NAME&#125;</span>\"</span></span><br><span class=\"line\">    scp -P <span class=\"variable\">$&#123;DEPLOY_PORT&#125;</span> <span class=\"string\">\"<span class=\"variable\">$&#123;APP_NAME&#125;</span>\"</span> <span class=\"variable\">$&#123;K8sMaster&#125;</span>:<span class=\"variable\">$&#123;APP_DIR&#125;</span><span class=\"variable\">$&#123;APP_NAME&#125;</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 重新部署</span></span><br><span class=\"line\">  deploy</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 判断是否存在历史版本</span></span><br><span class=\"line\">judge</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">case</span> <span class=\"variable\">$&#123;PREJECT_OPERATION&#125;</span> <span class=\"keyword\">in</span></span><br><span class=\"line\"><span class=\"string\">\"deploy\"</span>)</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"1.deploy\"</span></span><br><span class=\"line\">  deploy</span><br><span class=\"line\">;;</span><br><span class=\"line\"><span class=\"string\">\"rollback\"</span>)</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"2.rollback\"</span></span><br><span class=\"line\">  rollback</span><br><span class=\"line\">;;</span><br><span class=\"line\"><span class=\"string\">\"redeploy\"</span>)</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"3.redeploy\"</span></span><br><span class=\"line\">  redeploy</span><br><span class=\"line\">;;</span><br><span class=\"line\">*)</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"[-Error] : params.PREJECT_OPERATION Param Error!\"</span></span><br><span class=\"line\">  <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\">;;</span><br><span class=\"line\"><span class=\"keyword\">esac</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Development","path":"api/categories/Development.json"},{"name":"Programming","path":"api/categories/Programming.json"}],"tags":[{"name":"Shell","path":"api/tags/Shell.json"}]}