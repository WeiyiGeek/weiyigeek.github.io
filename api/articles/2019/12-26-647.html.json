{"title":"PS命令之中系统日志相关信息查看与管理","slug":"编程世界/Powershell/Cmdlet/系统信息类命令/PS命令之中系统日志相关信息查看与管理","date":"2019-12-26T11:36:30.000Z","updated":"2022-04-13T02:30:55.734Z","url":"2019/12-26-647.html","path":"api/articles/2019/12-26-647.html.json","covers":null,"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"系统日志查看与管理\"><a href=\"#系统日志查看与管理\" class=\"headerlink\" title=\"系统日志查看与管理\"></a>系统日志查看与管理</h2><h3 id=\"Get-EventLog-命令-获取本地计算机或远程计算机上的事件日志或事件日志列表中的事件。\"><a href=\"#Get-EventLog-命令-获取本地计算机或远程计算机上的事件日志或事件日志列表中的事件。\" class=\"headerlink\" title=\"Get-EventLog 命令 - 获取本地计算机或远程计算机上的事件日志或事件日志列表中的事件。\"></a>Get-EventLog 命令 - 获取本地计算机或远程计算机上的事件日志或事件日志列表中的事件。</h3><p>描述: 默认情况下<code>Get EventLog</code>从本地计算机获取日志，它仅适用于Windows经典事件日志，如应用程序、系统或安全性。。</p>\n<p>Tips: 在Windows Vista和更高版本的Windows中获取使用Windows事件日志技术的日志，请使用 “get WinEvent” cmdlet。因为<code>Get EventLog</code>使用的Win32 API已弃用。</p>\n<p><br/></p>\n<p><strong>基础语法:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Get-EventLog [-LogName] &lt;System.String&gt; [[-InstanceId] &lt;System.Int64[]&gt;] [-After &lt;System.DateTime&gt;] [-AsBaseObject] [-Before &lt;System.DateTime&gt;] [-ComputerName &lt;System.String[]&gt;] [-EntryType &#123;Error | Information | FailureAudit | SuccessAudit | Warning&#125;] [-Index &lt;System.Int32[]&gt;] [-Message &lt;System.String&gt;] [-Newest &lt;System.Int32&gt;] [-Source &lt;System.String[]&gt;] [-UserName &lt;System.String[]&gt;] [&lt;CommonParameters&gt;]</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p><strong>基础示例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 1.查看本机的事件日志</span></span><br><span class=\"line\">Get-EventLog -List</span><br><span class=\"line\">  <span class=\"comment\"># Max(K) Retain OverflowAction        Entries Log</span></span><br><span class=\"line\">  <span class=\"comment\"># ------ ------ --------------        ------- ---</span></span><br><span class=\"line\">  <span class=\"comment\"># 20,480      0 OverwriteAsNeeded      12,738 Application</span></span><br><span class=\"line\">  <span class=\"comment\"># 20,480      0 OverwriteAsNeeded           0 HardwareEvents</span></span><br><span class=\"line\">  <span class=\"comment\">#    512      7 OverwriteOlder              0 Internet Explorer</span></span><br><span class=\"line\">  <span class=\"comment\"># 20,480      0 OverwriteAsNeeded           0 Key Management Service</span></span><br><span class=\"line\">  <span class=\"comment\">#    128      0 OverwriteAsNeeded          64 OAlerts</span></span><br><span class=\"line\">  <span class=\"comment\"># 20,480      0 OverwriteAsNeeded      33,075 Security</span></span><br><span class=\"line\">  <span class=\"comment\"># 20,480      0 OverwriteAsNeeded      47,497 System</span></span><br><span class=\"line\">  <span class=\"comment\"># 15,360      0 OverwriteAsNeeded      10,113 Windows PowerShell</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 2.从本地计算机上的系统事件日志获取最近的条目</span></span><br><span class=\"line\">Get-EventLog -LogName System -Newest 5</span><br><span class=\"line\">  <span class=\"comment\"># Index Time          EntryType   Source                 InstanceID Message</span></span><br><span class=\"line\">  <span class=\"comment\">#   ----- ----          ---------   ------                 ---------- -------</span></span><br><span class=\"line\">  <span class=\"comment\">#   47492 6月 21 20:53  Warning     DCOM                        10016 无法找到源“DCOM”中事件 ID“10016”的说明。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 3.在事件日志中查找特定数目项的所有源</span></span><br><span class=\"line\"><span class=\"variable\">$Events</span> = Get-EventLog -LogName System -Newest 1000</span><br><span class=\"line\"><span class=\"variable\">$Events</span> | Group-Object -Property Source -NoElement | Sort-Object -Property Count -Descending</span><br><span class=\"line\">  <span class=\"comment\"># Count Name</span></span><br><span class=\"line\">  <span class=\"comment\"># ----- ----</span></span><br><span class=\"line\">  <span class=\"comment\">#   922 Service Control Manager</span></span><br><span class=\"line\">  <span class=\"comment\">#   27 Microsoft-Windows-Kern...</span></span><br><span class=\"line\">  <span class=\"comment\">#   21 DCOM</span></span><br><span class=\"line\">  <span class=\"comment\">#   10 Microsoft-Windows-DNS-...</span></span><br><span class=\"line\">  <span class=\"comment\">#    6 Microsoft-Windows-Time...</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 4.从特定事件日志获取错误事件(Error)、失败事件(FailureAudit)、成功事件(SuccessAudit)、Information 、Warning</span></span><br><span class=\"line\">Get-EventLog -LogName Security -EntryType Error</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 5.从事件日志中获取具有InstanceId和源值的事件、或采用通配符的方式</span></span><br><span class=\"line\">Get-EventLog -LogName System -InstanceId 10016 -Source DCOM</span><br><span class=\"line\">  <span class=\"comment\"># Index Time          EntryType   Source                 InstanceID Message</span></span><br><span class=\"line\">  <span class=\"comment\"># ----- ----          ---------   ------                 ---------- -------</span></span><br><span class=\"line\">  <span class=\"comment\"># 47492 6月 21 20:53  Warning     DCOM                        10016 无法找到源“DCOM”中事件 ID“10016”的说明。  ...</span></span><br><span class=\"line\">  <span class=\"comment\"># 47</span></span><br><span class=\"line\">Get-EventLog -LogName System -Message *description*</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 6.显示事件的属性值以及按属性获取事件和分组</span></span><br><span class=\"line\"><span class=\"variable\">$A</span> = Get-EventLog -LogName System -Newest 1</span><br><span class=\"line\"><span class=\"variable\">$A</span> | Select-Object -Property *</span><br><span class=\"line\">  <span class=\"comment\"># EventID            : 7040</span></span><br><span class=\"line\">  <span class=\"comment\"># MachineName        : WeiyiGeek</span></span><br><span class=\"line\">  <span class=\"comment\"># Data               : &#123;&#125;</span></span><br><span class=\"line\">  <span class=\"comment\"># Index              : 47496</span></span><br><span class=\"line\">  <span class=\"comment\"># Category           : (0)</span></span><br><span class=\"line\">  <span class=\"comment\"># CategoryNumber     : 0</span></span><br><span class=\"line\">  <span class=\"comment\"># EntryType          : Information</span></span><br><span class=\"line\">  <span class=\"comment\"># Message            : Background Intelligent Transfer Service 服务的启动类型从 自动启动 更改为 按需启动。</span></span><br><span class=\"line\">  <span class=\"comment\"># Source             : Service Control Manager</span></span><br><span class=\"line\">  <span class=\"comment\"># ReplacementStrings : &#123;Background Intelligent Transfer Service, 自动启动, 按需启动, BITS&#125;</span></span><br><span class=\"line\">  <span class=\"comment\"># InstanceId         : 1073748864</span></span><br><span class=\"line\">  <span class=\"comment\"># TimeGenerated      : 2021/6/21 21:23:39</span></span><br><span class=\"line\">  <span class=\"comment\"># TimeWritten        : 2021/6/21 21:23:39</span></span><br><span class=\"line\">  <span class=\"comment\"># UserName           : NT AUTHORITY\\SYSTEM</span></span><br><span class=\"line\">  <span class=\"comment\"># Site               :</span></span><br><span class=\"line\"></span><br><span class=\"line\">Get-EventLog -LogName System -UserName NT* | Group-Object -Property UserName -NoElement |</span><br><span class=\"line\">  Select-Object -Property Count, Name</span><br><span class=\"line\">  <span class=\"comment\"># Count  Name</span></span><br><span class=\"line\">  <span class=\"comment\"># -----  ----</span></span><br><span class=\"line\">  <span class=\"comment\"># 6031   NT AUTHORITY\\SYSTEM</span></span><br><span class=\"line\">  <span class=\"comment\">#   42   NT AUTHORITY\\LOCAL SERVICE</span></span><br><span class=\"line\">  <span class=\"comment\">#    4   NT AUTHORITY\\NETWORK SERVICE</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 7.获取在特定日期和时间范围内发生的事件</span></span><br><span class=\"line\"><span class=\"variable\">$Begin</span> = Get-Date -Date <span class=\"string\">'6/17/2021 08:00:00'</span></span><br><span class=\"line\"><span class=\"variable\">$End</span> = Get-Date -Date <span class=\"string\">'6/18/2021 17:00:00'</span></span><br><span class=\"line\">Get-EventLog -LogName System -EntryType Error -After <span class=\"variable\">$Begin</span> -Before <span class=\"variable\">$End</span></span><br><span class=\"line\">  <span class=\"comment\"># Index Time          EntryType   Source                 InstanceID Message</span></span><br><span class=\"line\">  <span class=\"comment\"># ----- ----          ---------   ------                 ---------- -------</span></span><br><span class=\"line\">  <span class=\"comment\"># 46787 6月 18 09:21  Error       DCOM                        10001 无法找到源“DCOM”中事件 ID“10001”的说明。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 8.使用源和事件ID从事件日志获取事件</span></span><br><span class=\"line\">Get-EventLog -LogName Application -Source Outlook | Where-Object &#123;<span class=\"variable\">$_</span>.EventID -eq 63&#125; |</span><br><span class=\"line\"> Select-Object -Property Source, EventID, InstanceId, Message</span><br><span class=\"line\">  <span class=\"comment\"># Source   EventID   InstanceId   Message</span></span><br><span class=\"line\">  <span class=\"comment\"># ------   -------   ----------   -------</span></span><br><span class=\"line\">  <span class=\"comment\"># Outlook       63   1073741887   The Exchange web service request succeeded.</span></span><br></pre></td></tr></table></figure></p>\n<p><strong>企业实例</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># (1) 系统开关机时间 (日志来源：Winlogon)</span></span><br><span class=\"line\">Get-EventLog -LogName System -Source * | % &#123;<span class=\"keyword\">if</span>(<span class=\"variable\">$_</span>.EventID -eq <span class=\"string\">\"7001\"</span> -or <span class=\"variable\">$_</span>.EventID -eq <span class=\"string\">\"7002\"</span>)&#123;write-host <span class=\"string\">\"<span class=\"variable\">$($_.TimeGenerated.ToString('yyyy-MM-dd HH:mm:ss')</span>) # <span class=\"variable\">$($_.Message)</span>\"</span> &#125;&#125;</span><br><span class=\"line\">2021-06-21 20:24:57 <span class=\"comment\"># 客户体验改善计划的用户登录通知</span></span><br><span class=\"line\">2021-06-21 14:54:53 <span class=\"comment\"># 客户体验改善计划的用户注销通知</span></span><br></pre></td></tr></table></figure></p>\n<p>(Get-WinEvent -ListLog Security).ProviderNames</p>\n<p>您可以使用PowerShell获取与日志关联的提供程序列表。下面是一个示例，显示与安全日志关联的提供程序。</p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Development","path":"api/categories/Development.json"}],"tags":[{"name":"Powershell","path":"api/tags/Powershell.json"}]}