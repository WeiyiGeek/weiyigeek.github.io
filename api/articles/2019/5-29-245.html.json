{"title":"sc命令解析与实例使用","slug":"系统运维/Windows/常用命令/系统高级类命令/sc命令解析与实例使用","date":"2019-05-29T13:35:30.000Z","updated":"2022-03-29T05:39:06.301Z","url":"2019/5-29-245.html","path":"api/articles/2019/5-29-245.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190924151605.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"0x00-基础语法\"><a href=\"#0x00-基础语法\" class=\"headerlink\" title=\"0x00 基础语法\"></a>0x00 基础语法</h2><p>描述:SC 命令是用于与服务控制管理器通信的命令行程序.</p>\n<p><strong>语法参数:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sc &lt;server&gt; [<span class=\"built_in\">command</span>] [service name] &lt;option1&gt; &lt;option2&gt;   <span class=\"comment\">#选项 &lt;server&gt; 的格式为 \"\\\\ServerName\"</span></span><br><span class=\"line\">sc &lt;server&gt; config [service name] &lt;option1&gt; &lt;option2&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#sc二级命令</span></span><br><span class=\"line\">query-----------查询服务的状态，或枚举服务类型的状态。</span><br><span class=\"line\">queryex---------查询服务的扩展状态，或枚举服务类型的状态。</span><br><span class=\"line\">start-----------启动服务。</span><br><span class=\"line\">pause-----------向服务发送 PAUSE 控制请求。</span><br><span class=\"line\">interrogate-----向服务发送 INTERROGATE 控制请求。</span><br><span class=\"line\"><span class=\"built_in\">continue</span>--------向服务发送 CONTINUE 控制请求。</span><br><span class=\"line\">stop------------向服务发送 STOP 请求。</span><br><span class=\"line\">config----------更改服务的配置(永久)。</span><br><span class=\"line\">description-----更改服务的描述。</span><br><span class=\"line\">failure---------更改服务失败时执行的操作。</span><br><span class=\"line\">failureflag-----更改服务的失败操作标志。</span><br><span class=\"line\">sidtype---------更改服务的服务 SID 类型。</span><br><span class=\"line\">privs-----------更改服务的所需权限。</span><br><span class=\"line\">qc--------------查询服务的配置信息。</span><br><span class=\"line\">qdescription----查询服务的描述。</span><br><span class=\"line\">qfailure--------查询失败时服务执行的操作。</span><br><span class=\"line\">qfailureflag----查询服务的失败操作标志。</span><br><span class=\"line\">qsidtype--------查询服务的服务 SID 类型。</span><br><span class=\"line\">qprivs----------查询服务的所需权限。</span><br><span class=\"line\">qtriggerinfo----查询服务的触发器参数。</span><br><span class=\"line\">qpreferrednode--查询首选的服务 NUMA 节点。</span><br><span class=\"line\">delete----------(从注册表)删除服务。</span><br><span class=\"line\">create----------创建服务(将其添加到注册表)。</span><br><span class=\"line\">control---------向服务发送控制。</span><br><span class=\"line\">sdshow----------显示服务的安全描述符。</span><br><span class=\"line\">sdset-----------设置服务的安全描述符。</span><br><span class=\"line\">showsid---------显示相应于假定名称的 SID 字符串。</span><br><span class=\"line\">triggerinfo-----配置服务的触发器参数。</span><br><span class=\"line\">preferrednode---设置首选的服务 NUMA 节点。</span><br><span class=\"line\">GetDisplayName--获取服务的 DisplayName</span><br><span class=\"line\">GetKeyName------获取服务的 ServiceKeyName。</span><br><span class=\"line\">EnumDepend------枚举服务的依存关系。</span><br></pre></td></tr></table></figure></p>\n<p>Tips : 在 PowerShell 中sc 是 cmdlet Set-Content 的别名，应该这样使用加上 <code>.exe</code> 才能正常使用。</p>\n<hr>\n<h2 id=\"0x01-sc-命令\"><a href=\"#0x01-sc-命令\" class=\"headerlink\" title=\"0x01 sc 命令\"></a>0x01 sc 命令</h2><h3 id=\"create\"><a href=\"#create\" class=\"headerlink\" title=\"create\"></a>create</h3><p>描述: 创建一个自启/手动开启服务并写入注册表之中;<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">用法:sc &lt;server&gt; create [service name] [binPath= ] &lt;option1&gt; &lt;option2&gt;...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#注意: 选项名称包括等号。等号和值之间需要一个空格。</span></span><br><span class=\"line\"><span class=\"built_in\">type</span>= &lt;own|share|interact|kernel|filesys|rec|userown|usershare&gt;</span><br><span class=\"line\">      (默认 = own)</span><br><span class=\"line\">start= &lt;boot|system|auto|demand|disabled|delayed-auto&gt;</span><br><span class=\"line\">      (默认 = demand)</span><br><span class=\"line\">error= &lt;normal|severe|critical|ignore&gt;</span><br><span class=\"line\">      (默认 = normal)</span><br><span class=\"line\">binPath= &lt;.exe 文件的 BinaryPathName&gt;</span><br><span class=\"line\">group= &lt;LoadOrderGroup&gt;</span><br><span class=\"line\">tag= &lt;yes|no&gt;</span><br><span class=\"line\">depend= &lt;依存关系(以 / (斜杠)分隔)&gt;</span><br><span class=\"line\">obj= &lt;AccountName|ObjectName&gt;</span><br><span class=\"line\">      (默认= LocalSystem)</span><br><span class=\"line\">DisplayName= &lt;显示名称&gt;</span><br><span class=\"line\">password= &lt;密码&gt;</span><br></pre></td></tr></table></figure></p>\n<p>实例案例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装服务:NewService为创建的服务名，binPath后面是运行exe文件的所在路径</span></span><br><span class=\"line\">sc create NewService binPath=<span class=\"string\">\"C:\\Debug\\win32srvDemo.exe\"</span>  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 服务自动开启某个程序(type共享,start启动方式自动,displayname服务显示名称描述)</span></span><br><span class=\"line\">sc create NewService binPath= <span class=\"string\">\"D:\\Debug\\start1.bat -config 1.ini\"</span> <span class=\"built_in\">type</span>=share start= <span class=\"string\">\"auto\"</span> displayname= <span class=\"string\">\"BWJXServices\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Prometheus Metrics Windows Nodes Services </span></span><br><span class=\"line\">sc create prometheus_windows_exporter_service binPath= <span class=\"string\">\"d:\\pro\\windows_exporter-0.16.0-amd64.exe --config.file=d:\\pro\\config.yml\"</span> start= <span class=\"string\">\"auto\"</span> displayname= <span class=\"string\">\"prometheus_windows_exporter_service\"</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"config\"><a href=\"#config\" class=\"headerlink\" title=\"config\"></a>config</h3><p>描述:配置服务启动方式或者禁用服务,它有三种状态AUTO/DEMAND/DISABLED;</p>\n<p><strong>基础案例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#设置服务的集中方式</span></span><br><span class=\"line\">sc config 服务名 start= AUTO       (自动)</span><br><span class=\"line\">sc config 服务名 start= DEMAND     (手动)</span><br><span class=\"line\">sc config 服务名 start= DISABLED   (禁用)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#将智能卡服务禁用</span></span><br><span class=\"line\">sc config SCardSvr start= disabled</span><br><span class=\"line\">sc config SCPolicySvc start= disabled</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#在XP系统中开机便会自动启动：</span></span><br><span class=\"line\">sc config test3 start=AUTO</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"start\"><a href=\"#start\" class=\"headerlink\" title=\"start\"></a>start</h3><p>描述:用来开启已存在的服务</p>\n<p><strong>用法参数:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">```</span><br><span class=\"line\"></span><br><span class=\"line\">**基础案例:**</span><br><span class=\"line\">```bash</span><br><span class=\"line\">sc start NewService</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"stop\"><a href=\"#stop\" class=\"headerlink\" title=\"stop\"></a>stop</h3><p>描述:用来停止已开启的服务</p>\n<p><strong>用法参数:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">```</span><br><span class=\"line\"></span><br><span class=\"line\">**基础案例:**</span><br><span class=\"line\">```bash</span><br><span class=\"line\">sc stop NewService</span><br></pre></td></tr></table></figure><br><br></p>\n<h3 id=\"delete\"><a href=\"#delete\" class=\"headerlink\" title=\"delete\"></a>delete</h3><p>描述:用来删除已存在的服务</p>\n<p><strong>基础语法:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sc delete NewService</span><br></pre></td></tr></table></figure></p>\n<p><strong>基础案例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sc delete <span class=\"string\">\"Service Name\"</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"qc\"><a href=\"#qc\" class=\"headerlink\" title=\"qc\"></a>qc</h3><p>描述:查询服务的配置信息 (dependencies 依赖)<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sc qc NewService</span><br></pre></td></tr></table></figure></p>\n<p><strong>基础案例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sc qc Spooler</span><br><span class=\"line\">sc qc upnphost</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190924151605.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<hr>\n<h2 id=\"0x02-入坑-amp-出坑\"><a href=\"#0x02-入坑-amp-出坑\" class=\"headerlink\" title=\"0x02 入坑&amp;出坑\"></a>0x02 入坑&amp;出坑</h2><h3 id=\"问题1-在注册-WinService服务时，再使用-“sc-delete-服务器名称”-命令删除服务就出现“指定的服务已经标记为删除”的异常。\"><a href=\"#问题1-在注册-WinService服务时，再使用-“sc-delete-服务器名称”-命令删除服务就出现“指定的服务已经标记为删除”的异常。\" class=\"headerlink\" title=\"问题1.在注册***WinService服务时，再使用 “sc delete 服务器名称” 命令删除服务就出现“指定的服务已经标记为删除”的异常。\"></a>问题1.在注册<code>***WinService</code>服务时，再使用 “sc delete 服务器名称” 命令删除服务就出现“指定的服务已经标记为删除”的异常。</h3><p>问题原因:出现上述原因是运行删除服务项命令的时候，服务管理窗口未关闭引起的。<br>解决办法: 关闭服务管理窗口，重新删除、安装服务项即可。</p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Windows命令","path":"api/categories/Windows命令.json"}],"tags":[{"name":"系统命令","path":"api/tags/系统命令.json"}]}