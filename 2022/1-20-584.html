<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ å¦‚ä½•ä½¿ç”¨Skopeoåšä¸€ä¸ªä¼˜é›…çš„é•œåƒæ¬è¿å·¥|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Docker,Harbor,Skopeo">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>å¦‚ä½•ä½¿ç”¨Skopeoåšä¸€ä¸ªä¼˜é›…çš„é•œåƒæ¬è¿å·¥</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">å¦‚ä½•ä½¿ç”¨Skopeoåšä¸€ä¸ªä¼˜é›…çš„é•œåƒæ¬è¿å·¥</h1>
        <h5 class="subtitle">
            
                <time datetime="2022-01-20T07:37:27.000Z" itemprop="datePublished" class="page-time">
  2022-01-20
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/kubernetes/">kubernetes</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/kubernetes/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/kubernetes/Containers/OperationTools/">OperationTools</a></li></ul></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
  <article id="post-è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Harbor/Skopeoå¦‚ä½•ä¼˜é›…çš„åšä¸€ä¸ªé•œåƒæ¬è¿å·¥"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">å¦‚ä½•ä½¿ç”¨Skopeoåšä¸€ä¸ªä¼˜é›…çš„é•œåƒæ¬è¿å·¥</h1>
        <div class="post-meta">
            <time class="post-time" title="2022-01-20 15:37:27" datetime="2022-01-20T07:37:27.000Z"  itemprop="datePublished">2022-01-20</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/kubernetes/">kubernetes</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/kubernetes/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/kubernetes/Containers/OperationTools/">OperationTools</a></li></ul></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="0x00-åŸºç¡€ä»‹ç»"><a href="#0x00-åŸºç¡€ä»‹ç»" class="headerlink" title="0x00 åŸºç¡€ä»‹ç»"></a>0x00 åŸºç¡€ä»‹ç»</h2><p>æè¿°: ä½œä¸ºå…¬å¸å†…éƒ¨ PaaS toB äº§å“çš„æ‰“åŒ…å‘å¸ƒäººå‘˜ï¼Œå®¹å™¨é•œåƒå¯¹æˆ‘ä»¬æ‰“å·¥äººè€Œè¨€å°±åƒæ˜¯å·¥åœ°ä¸Šçš„ç –å¤´ ğŸ§±ï¼Œè€Œæˆ‘çš„ä¸€éƒ¨åˆ†å·¥ä½œå°±æ˜¯å°†è¿™äº›ç –å¤´åœ¨å„ä¸ªä»“åº“ä¹‹é—´æ¬æ¥æ¬å»ï¼Œæœ€ç»ˆå°†è¿™äº›ç –å¤´æ‰“åŒ…æ”¾åœ¨äº§å“çš„å®‰è£…åŒ…ä¸­ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„ PaaS äº§å“å®‰è£…åŒ…ã€‚</p>
<p><strong>Q: åœ¨ PaaS (å¹³å°å³æœåŠ¡)ä¸­çš„å¤§å®¶å¸¸è¯´çš„ToBä¸ToCåˆ°åº•æ˜¯ä»€ä¹ˆ?</strong></p>
<blockquote>
<p>ToC é¢å‘æ™®é€šç”¨æˆ·æœåŠ¡, ä¸»è¦æ˜¯è®©ç”¨æˆ·ä½“éªŒæ„Ÿå¥½ï¼Œè§£å†³ç”¨æˆ·ä½¿ç”¨æ–¹é¢çš„é—®é¢˜è®°å½•ï¼Œå¹¶è¿”å›ç»™å‰åç«¯å¼€å‘ã€‚<br>ToB æ˜¯é¢å‘ä¼ä¸šç”¨æˆ·æœåŠ¡, äº§å“å¯ç”¨ã€å…¶ä¸­æœ€å…³é”®æ˜¯è®©Bossä½¿ç”¨Happly!</p>
</blockquote>
<p><strong>Q: å‡å¦‚æœ‰å¦‚ä¸‹åœºæ™¯ï¼Œæˆ‘ä»¬ä»dockerhubå…¬å…±ä»“åº“ä¸­ä¸‹è½½ä¸€ä¸ªGBä»¥ä¸Šçš„é•œåƒï¼Œåˆ°æœ¬åœ°çš„ç§æœ‰ä»“åº“ä¸­ï¼Œæˆ‘æƒ³é€šå¸¸ä½ ä¼šè¿™æ ·åšå…ˆdocker pull åˆ°æœ¬åœ°ï¼Œç„¶åä½¿ç”¨docker tagæ›´æ”¹ä¸ºç§æœ‰ä»“åº“åœ°å€åŠ ä¸Šé•œåƒåç§°ç‰ˆæœ¬ï¼Œæœ€åå†ä½¿ç”¨docker pushä¸Šä¼ é•œåƒåˆ°ç§æœ‰ä»“åº“ä¸­ï¼Œä»¥ä¾›å…¶å®ƒå†…ç½‘æœºå™¨æ‹‰å–å¹¶ä½¿ç”¨ã€‚è™½ç„¶è¯¥æ–¹æ³•æ˜¯å¯è¡Œï¼Œä½†æ˜¯å¦‚æœæœ‰å¤šä¸ªå¤§äºGBä»¥ä¸Šçš„é•œåƒéœ€è¦ä¸Šä¼ åˆ°ç§æœ‰ä»“åº“ï¼Œæ¯æ¬¡éƒ½è¦å…ˆè§£å‹layeråˆ°æœ¬åœ°ï¼Œç„¶åå†å‹ç¼©layerä¸Šä¼ åˆ°ç§æœ‰ä»“åº“ä¸­ï¼Œä½ èƒ½æƒ³è±¡æ­¤è¿‡ç¨‹èŠ±è´¹çš„æ—¶é—´æœ‰å¤šä¹…å—? å¯¹äºæˆ‘ä»¬è¿ç»´å·¥ç¨‹å¸ˆæ¥è¯´æ—¶é—´å°±æ˜¯é‡‘é’±ï¼Œæ‰€ä»¥éœ€æƒ³å°½ä¸€åˆ‡æ–¹æ³•æ¥èŠ‚çº¦æ—¶é—´æˆæœ¬ï¼Œé‚£æœ‰æ²¡æœ‰ä¸€ç§åŠæ³•å¯ä»¥ç›´æ¥å°† registry ä¸Šçš„ blob å¤åˆ¶åˆ°å¦ä¸€ä¸ª registryï¼Œä¸­é—´è¿‡ç¨‹ä¸æ¶‰åŠå¯¹é•œåƒ layer çš„è§£å‹ç¼©ï¼Œè¿™å²‚ä¸ç¾å“‰ã€‚</strong></p>
<blockquote>
<p>è§£å†³æ–¹æ¡ˆå½“ç„¶æ˜¯å­˜åœ¨çš„ï¼Œå¦‚æœä½ ä¸æƒ³ä½¿ç”¨dockerè¿›è¡Œimagesé•œåƒæ‹‰å–ä¸Šä¼ ï¼Œæˆ‘ä»¬å®Œæˆå¯ä»¥ä½¿ç”¨skopeå·¥å…·æ¥å®Œå…¨æ›¿ä»£ docker-cli æ¥æ¬è¿é•œåƒï¼Œskopeoæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå®ç”¨ç¨‹åºï¼Œå¯å¯¹å®¹å™¨æ˜ åƒå’Œæ˜ åƒå­˜å‚¨åº“æ‰§è¡Œå„ç§æ“ä½œã€‚</p>
</blockquote>
<p><strong>ä»€ä¹ˆæ˜¯Skopeo?</strong><br>skopeo ä½¿ç”¨ APIâ€‹â€‹ V2 Registryï¼Œä¾‹å¦‚ Docker Registryã€Atomic Registryã€ç§æœ‰Registryã€æœ¬åœ°ç›®å½•å’Œæœ¬åœ° OCI é•œåƒç›®å½•ã€‚skopeo ä¸éœ€è¦è¿è¡Œå®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒå¯ä»¥æ‰§è¡Œçš„æ“ä½œåŒ…æ‹¬ï¼š</p>
<ul>
<li>é€šè¿‡å„ç§å­˜å‚¨æœºåˆ¶å¤åˆ¶é•œåƒï¼Œä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ä¸éœ€è¦ç‰¹æƒçš„æƒ…å†µä¸‹å°†é•œåƒä»ä¸€ä¸ªRegistryå¤åˆ¶åˆ°å¦ä¸€ä¸ªRegistry</li>
<li>æ£€æµ‹è¿œç¨‹é•œåƒå¹¶æŸ¥çœ‹å…¶å±æ€§ï¼ŒåŒ…æ‹¬å…¶å›¾å±‚ï¼Œæ— éœ€å°†é•œåƒæ‹‰åˆ°æœ¬åœ°</li>
<li>ä»é•œåƒåº“ä¸­åˆ é™¤é•œåƒ</li>
<li>å½“å­˜å‚¨åº“éœ€è¦æ—¶ï¼Œskopeo å¯ä»¥ä¼ é€’é€‚å½“çš„å‡­æ®å’Œè¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯</li>
</ul>
<p><strong>é•œåƒå­˜å‚¨ç‰¹ç‚¹</strong><br>æ ¹æ® Robin å¤§ä½¬åœ¨ ã€Šé•œåƒä»“åº“ä¸­é•œåƒå­˜å‚¨çš„åŸç†è§£æã€‹æ–‡ç« é‡Œå¾—å‡ºçš„ç»“è®ºï¼š</p>
<ul>
<li>é€šè¿‡ Registry API è·å¾—çš„ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ manifest ä¿¡æ¯å®Œå…¨ç›¸åŒã€‚</li>
<li>ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ manifest ä¿¡æ¯çš„å­˜å‚¨è·¯å¾„å’Œå†…å®¹å®Œå…¨ç›¸åŒã€‚</li>
<li>ä¸¤ä¸ªé•œåƒä»“åº“ä¸­ç›¸åŒé•œåƒçš„ blob ä¿¡æ¯çš„å­˜å‚¨è·¯å¾„å’Œå†…å®¹å®Œå…¨ç›¸åŒ</li>
</ul>
<p><strong>é¡¹ç›®ä¿¡æ¯</strong><br>Github å®˜æ–¹åœ°å€: <a href="https://github.com/containers/skopeo" target="_blank" rel="noopener">https://github.com/containers/skopeo</a><br>Gitee mirror: <a href="https://gitee.com/mirrors/skopeo" target="_blank" rel="noopener">https://gitee.com/mirrors/skopeo</a></p>
<p><br></p>
<h2 id="0x01-å®‰è£…ç¼–è¯‘"><a href="#0x01-å®‰è£…ç¼–è¯‘" class="headerlink" title="0x01 å®‰è£…ç¼–è¯‘"></a>0x01 å®‰è£…ç¼–è¯‘</h2><p>æè¿°: Skopeo å®˜æ–¹å®‰è£…&amp;ç¼–è¯‘æ–¹å¼å‚è€ƒæ–‡æ¡£: <a href="https://github.com/containers/skopeo/blob/main/install.md" target="_blank" rel="noopener">https://github.com/containers/skopeo/blob/main/install.md</a></p>
<p>æœ¬èŠ‚å®‰è£…å®è·µç¯å¢ƒå°†åœ¨Ubuntu 20.04 LTS ä»¥åŠ docker 20.10.12 ä¸­è¿›è¡Œå®è·µæºç ç¼–è¯‘ä»¥åŠ apt ä»“åº“æºä¸‹è½½å®‰è£…å®è·µã€‚</p>
<h3 id="1-æºç ç¼–è¯‘ï¼ˆé™æ€ï¼‰"><a href="#1-æºç ç¼–è¯‘ï¼ˆé™æ€ï¼‰" class="headerlink" title="1.æºç ç¼–è¯‘ï¼ˆé™æ€ï¼‰"></a>1.æºç ç¼–è¯‘ï¼ˆé™æ€ï¼‰</h3><p>æè¿°: è¦æ„å»º skopeo äºŒè¿›åˆ¶æ–‡ä»¶æ‚¨è‡³å°‘éœ€è¦ Go 1.12 ç‰ˆæœ¬ä»¥ä¸Š, å…¶æ¬¡æ„å»º skopeo æœ‰ä¸¤ç§æ–¹æ³•ï¼Œå³<code>åœ¨å®¹å™¨ä¸­</code>æˆ–è€…åœ¨æœ¬åœ°ç¯å¢ƒä¸­æ„å»º(å®‰è£…ç¯å¢ƒè¾ƒä¸ºå¤æ‚), æ­¤å¤„ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºå°†é‡‡ç”¨å®¹å™¨æ–¹å¼è¿›è¡Œç¼–è¯‘æ„å»ºã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.æ‹‰å–skopeoæºç åˆ°æœ¬åœ°</span></span><br><span class="line">$ git <span class="built_in">clone</span> --depth=1 https://github.com/containers/skopeo.git  <span class="comment"># https://github.com/containers/skopeo.git</span></span><br><span class="line">$ <span class="built_in">cd</span> skopeo</span><br><span class="line">$ sed -i <span class="string">'s#proxy.golang.org#https://goproxy.cn#g'</span> skopeo/Makefile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ä¸‹è½½é•œåƒæ„å»ºä¾èµ–</span></span><br><span class="line">$ sudo apt-get install go-md2man  <span class="comment"># æ„å»ºæ‰‹å†Œä¾èµ–äº go-md2manã€‚</span></span><br><span class="line">$ whereis go-md2man  <span class="comment"># è·å¾—æœ¬æœºä¸­go-md2manè·¯å¾„ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æ„å»ºé™æ€äºŒè¿›åˆ¶æ–‡ä»¶</span></span><br><span class="line">$ BUILD_IMAGE=<span class="string">"golang:latest"</span></span><br><span class="line">$ docker run --name skopeo-build -v <span class="variable">$PWD</span>:/src -v /usr/bin/go-md2man:/go/bin/go-md2man -w /src -e CGO_ENABLED=0 -e GOPROXY=https://goproxy.cn,direct <span class="variable">$&#123;BUILD_IMAGE&#125;</span> \</span><br><span class="line">sh -c <span class="string">'make BUILDTAGS=containers_image_openpgp GO_DYN_FLAGS='</span></span><br><span class="line">  <span class="comment"># CGO_CFLAGS="" CGO_LDFLAGS="" GO111MODULE=on go build -mod=vendor  -ldflags '-X main.gitCommit=df4d82b960572c19e9333381a203c0ac475766d7 ' -gcflags "" -tags  "containers_image_openpgp" -o bin/skopeo ./cmd/skopeo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.è¿è¡Œç¼–è¯‘ç”Ÿæˆçš„skopeoå¯æ‰§è¡Œæ–‡ä»¶</span></span><br><span class="line">$ <span class="built_in">cd</span> ./bin <span class="comment"># /opt/software/skopeo/bin</span></span><br><span class="line">$ ./skopeo --<span class="built_in">help</span></span><br><span class="line">  <span class="comment"># Various operations with container images and container image registries</span></span><br><span class="line">  <span class="comment"># .......</span></span><br><span class="line">  <span class="comment"># Use "skopeo [command] --help" for more information about a command.</span></span><br></pre></td></tr></table></figure></p>
<p><strong>æ„å»ºå…³é”®å‚æ•°è§£æ:</strong></p>
<ul>
<li>CGO_ENABLED=0 : è®¾ç½®è¯¥ç¯å¢ƒå˜é‡, ç¦ç”¨ CGO ä¼šå¯¼è‡´ Go åœ¨å¯èƒ½çš„æƒ…å†µä¸‹æ›´å–œæ¬¢é™æ€è¿æ¥åº“ï¼Œè€Œä¸æ˜¯åŠ¨æ€é“¾æ¥åˆ°ç³»ç»Ÿåº“ (è§£å†³å¯ä»¥åœ¨Ubuntuæˆ–è€…å…¶å®ƒlinuxå‘è¡Œç‰ˆä¸­æ‰§è¡Œç¼–è¯‘åäºŒè¿›åˆ¶æ–‡ä»¶)ã€‚</li>
<li>GOPROXY=<a href="https://goproxy.cn,direct" target="_blank" rel="noopener">https://goproxy.cn,direct</a> : Golong ä¾èµ–ä¸‹è½½é•œåƒç«™,åŠ å¿«go getä¾èµ–æ‹‰æ‹‰å–ã€‚</li>
<li>BUILDTAGS=containers_image_openpgp : è®¾ç½®è¯¥makeå‚æ•°æ¶ˆé™¤äº†å¯¹libgpgme åŠå…¶é…å¥—åº“çš„ä¾èµ–, Skopeo çš„ä¸€äº›ç‰¹æ€§ä¾èµ–äºé Go åº“ï¼Œä¾‹å¦‚ libgpgme å’Œ libdevmapperã€‚</li>
<li>GO_DYN_FLAGS= : æ¸…ç©ºè¯¥makeå‚æ•° (å¦åˆ™ä¼šå¼ºåˆ¶åˆ›å»ºåŠ¨æ€å¯æ‰§è¡Œæ–‡ä»¶)</li>
</ul>
<p><br></p>
<h3 id="2-åˆ†å‘åŒ…å®‰è£…"><a href="#2-åˆ†å‘åŒ…å®‰è£…" class="headerlink" title="2.åˆ†å‘åŒ…å®‰è£…"></a>2.åˆ†å‘åŒ…å®‰è£…</h3><p>æè¿°: skopeo å¯èƒ½å·²ç»æ‰“åŒ…åœ¨æ‚¨çš„å‘è¡Œç‰ˆä¸­ï¼Œæ­¤å¤„ä»¥ubuntu 20.04ä¸ºä¾‹è¿›è¡Œå®‰è£…ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.åªæ”¯æŒ Ubuntu 20.10 and newer å‘è¡Œç‰ˆ </span></span><br><span class="line">sudo apt-get -y update</span><br><span class="line">sudo apt-get -y install skopeo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ä½† Kubic é¡¹ç›®ä¸º Ubuntu 20.04 æä¾›äº†è½¯ä»¶åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼åœ¨æˆ‘ä»¬åŠå…¶ä¸Šè¿›è¡Œå®‰è£…ã€‚</span></span><br><span class="line">. /etc/os-release</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"deb https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/xUbuntu_<span class="variable">$&#123;VERSION_ID&#125;</span>/ /"</span> | sudo tee /etc/apt/sources.list.d/devel:kubic:libcontainers:stable.list</span><br><span class="line">curl -L https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/xUbuntu_<span class="variable">$&#123;VERSION_ID&#125;</span>/Release.key | sudo apt-key add -</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get -y upgrade</span><br><span class="line">sudo apt-get -y install skopeo</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="3-å®¹å™¨å®‰è£…è¿è¡Œ"><a href="#3-å®¹å™¨å®‰è£…è¿è¡Œ" class="headerlink" title="3.å®¹å™¨å®‰è£…è¿è¡Œ"></a>3.å®¹å™¨å®‰è£…è¿è¡Œ</h3><p>Skopeo å®¹å™¨é•œåƒå¯åœ¨ quay.io/skopeo/stable:latest è·å¾—, ä¾‹å¦‚æˆ‘ä»¬é‡‡ç”¨podmanå‘½ä»¤è¿›è¡Œå¦‚ä¸‹æ“ä½œ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">podman run docker://quay.io/skopeo/stable:latest copy --<span class="built_in">help</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="0x02-å¿«é€Ÿä¸Šæ‰‹"><a href="#0x02-å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="0x02 å¿«é€Ÿä¸Šæ‰‹"></a>0x02 å¿«é€Ÿä¸Šæ‰‹</h2><h3 id="1-å‘½ä»¤æµ…æ"><a href="#1-å‘½ä»¤æµ…æ" class="headerlink" title="1.å‘½ä»¤æµ…æ"></a>1.å‘½ä»¤æµ…æ</h3><p>æè¿°: skopen æ˜¯æ“ä½œå„ç§å®¹å™¨æ˜ åƒå’Œå®¹å™¨æ˜ åƒä»“åº“çš„å·¥å…·ï¼Œå…¶ä½¿ç”¨æ–¹æ³•åŠå…¶å¯ç”¨å‘½ä»¤å¦‚ä¸‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">./skopeo --<span class="built_in">help</span>    <span class="comment"># å­å‘½ä»¤å¯é‡‡ç”¨å¦‚ä¸‹å‘½ä»¤ skopeo [command] --help å‘½ä»¤</span></span><br><span class="line">Usage:</span><br><span class="line">  skopeo [flags]</span><br><span class="line">  skopeo [<span class="built_in">command</span>]</span><br><span class="line">Available Commands: </span><br><span class="line">  copy          <span class="comment"># å¤åˆ¶ä¸€ä¸ªé•œåƒä» A åˆ° Bï¼Œè¿™é‡Œçš„ A å’Œ B å¯ä»¥ä¸ºæœ¬åœ° docker é•œåƒæˆ–è€… registry ä¸Šçš„é•œåƒï¼›</span></span><br><span class="line">  delete        <span class="comment"># åˆ é™¤ä¸€ä¸ªé•œåƒ tagï¼Œå¯ä»¥æ˜¯æœ¬åœ° docker é•œåƒæˆ–è€… registry ä¸Šçš„é•œåƒï¼›</span></span><br><span class="line">  <span class="built_in">help</span>          <span class="comment"># å¸®åŠ©æŸ¥çœ‹</span></span><br><span class="line">  inspect       <span class="comment"># æŸ¥çœ‹ä¸€ä¸ªé•œåƒçš„ manifest æˆ–è€… image config è¯¦ç»†ä¿¡æ¯ï¼›</span></span><br><span class="line">  list-tags     <span class="comment"># åˆ—å‡ºå­˜å‚¨åº“åç§°æŒ‡å®šçš„é•œåƒçš„tag</span></span><br><span class="line">  login           <span class="comment"># ç™»é™†æŸä¸ªé•œåƒä»“åº“,ç±»ä¼¼äº docker login å‘½ä»¤</span></span><br><span class="line">  <span class="built_in">logout</span>          <span class="comment"># é€€å‡ºæŸä¸ªå·²è®¤è¯çš„é•œåƒä»“åº“, ç±»ä¼¼äº docker logout å‘½ä»¤</span></span><br><span class="line">  manifest-digest <span class="comment"># è®¡ç®—æ–‡ä»¶çš„æ¸…å•æ‘˜è¦æ˜¯ä¸€ä¸ªsha256sum å€¼</span></span><br><span class="line">  standalone-sign   <span class="comment"># ä½¿ç”¨æœ¬åœ°æ–‡ä»¶åˆ›å»ºç­¾å</span></span><br><span class="line">  standalone-verify <span class="comment"># éªŒè¯æœ¬åœ°æ–‡ä»¶çš„ç­¾å</span></span><br><span class="line">  sync              <span class="comment"># å°†ä¸€ä¸ªæˆ–å¤šä¸ªå›¾åƒä»ä¸€ä¸ªä½ç½®åŒæ­¥åˆ°å¦ä¸€ä¸ªä½ç½® (è¯¥åŠŸèƒ½éå¸¸Nice)</span></span><br><span class="line">Flags:</span><br><span class="line">    --<span class="built_in">command</span>-timeout duration   <span class="comment"># å‘½ä»¤è¶…æ—¶æ—¶é—´(å•ä½ç§’)</span></span><br><span class="line">    --debug                      <span class="comment"># å¯ç”¨debugæ¨¡å¼</span></span><br><span class="line">    --insecure-policy            <span class="comment"># åœ¨ä¸è¿›è¡Œä»»ä½•ç­–ç•¥æ£€æŸ¥çš„æƒ…å†µä¸‹è¿è¡Œè¯¥å·¥å…·ï¼ˆå¦‚æœæ²¡æœ‰é…ç½® policy çš„è¯éœ€è¦åŠ ä¸Šè¯¥å‚æ•°ï¼‰</span></span><br><span class="line">    --override-arch ARCH         <span class="comment"># å¤„ç†é•œåƒæ—¶è¦†ç›–å®¢æˆ·ç«¯ CPU ä½“ç³»æ¶æ„ï¼Œå¦‚åœ¨ amd64 çš„æœºå™¨ä¸Šç”¨ skopeo å¤„ç† arm64 çš„é•œåƒ</span></span><br><span class="line">    --override-os OS             <span class="comment"># å¤„ç†é•œåƒæ—¶è¦†ç›–å®¢æˆ·ç«¯ OS</span></span><br><span class="line">    --override-variant VARIANT   <span class="comment"># å¤„ç†é•œåƒæ—¶ä½¿ç”¨VARIANTè€Œä¸æ˜¯è¿è¡Œæ¶æ„å˜é‡</span></span><br><span class="line">    --policy string              <span class="comment"># ä¿¡ä»»ç­–ç•¥æ–‡ä»¶çš„è·¯å¾„ (ä¸ºé•œåƒé…ç½®å®‰å…¨ç­–ç•¥æƒ…å†µä¸‹ä½¿ç”¨)</span></span><br><span class="line">    --registries.d DIR           <span class="comment"># åœ¨ç›®å½•ä¸­ä½¿ç”¨Registryé…ç½®æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œç”¨äºå®¹å™¨ç­¾åå­˜å‚¨ï¼‰</span></span><br><span class="line">    --tmpdir string              <span class="comment"># ç”¨äºå­˜å‚¨ä¸´æ—¶æ–‡ä»¶çš„ç›®å½•</span></span><br><span class="line">-h, --<span class="built_in">help</span>                       <span class="built_in">help</span> <span class="keyword">for</span> skopeo </span><br><span class="line">-v, --version                    Version <span class="keyword">for</span> Skopeo</span><br></pre></td></tr></table></figure></p>
<h3 id="2-Skopeoåˆä½“éªŒ"><a href="#2-Skopeoåˆä½“éªŒ" class="headerlink" title="2.Skopeoåˆä½“éªŒ"></a>2.Skopeoåˆä½“éªŒ</h3><p>æè¿°: åœ¨ä½¿ç”¨ä½“éªŒskopeoä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€å“ˆ Skopeo å¯ä»¥åœ¨é‚£äº›å›¾åƒå’Œå­˜å‚¨åº“ç±»å‹ä¸Šæ‰§è¡Œé•œåƒæ“ä½œ(å®˜ç½‘æ–‡æ¡£èµ°ä¸€æ³¢)ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">Repository types</th>
<th>Describe</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>containers-storage:docker-reference</code></td>
<td>é€‚ç”¨äºåç«¯æ˜¯ Podman, CRI-O, Buildah çš„æƒ…å†µ</td>
<td><code>containers-storage:</code></td>
</tr>
<tr>
<td style="text-align:center"><code>dir:path</code></td>
<td>é€‚ç”¨äºå°†manifest, layer tarballs å’Œ signatures å­˜å‚¨ä¸ºå•ç‹¬æ–‡ä»¶çš„ç°æœ‰æœ¬åœ°ç›®å½•è·¯å¾„çš„æƒ…å†µ</td>
<td><code>dir:/tmp/alpine:latest</code></td>
</tr>
<tr>
<td style="text-align:center"><code>docker://docker-reference</code></td>
<td>é€‚ç”¨äºRegistryä¸­å®ç°â€Docker Registry HTTP API V2â€çš„é•œåƒçš„æƒ…å†µ</td>
<td><code>docker://harbor.weiyigeek.top/myblog:v2.8</code></td>
</tr>
<tr>
<td style="text-align:center"><code>docker-archive:path[:docker-reference]</code></td>
<td>é€‚ç”¨äºé‡‡ç”¨<code>docker save</code>å‘½ä»¤å¯¼å‡ºé•œåƒä»¥taræ ¼å¼å­˜å‚¨çš„æ–‡ä»¶çš„æƒ…å†µ</td>
<td><code>docker-archive:alpine.tar</code></td>
</tr>
<tr>
<td style="text-align:center"><code>docker-daemon:docker-reference</code></td>
<td>é€‚ç”¨äºå­˜å‚¨åœ¨ docker å®ˆæŠ¤è¿›ç¨‹å†…éƒ¨å­˜å‚¨ä¸­çš„å›¾åƒçš„æƒ…å†µ</td>
<td><code>docker-daemon:alpine:latest</code></td>
</tr>
<tr>
<td style="text-align:center"><code>oci:path:tag</code></td>
<td>é€‚ç”¨äºç¬¦åˆâ€Open Container Image Layout Specificationâ€çš„ç›®å½•ä¸­çš„å›¾åƒæ ‡è®°</td>
<td><code>oci:alpine:latest</code></td>
</tr>
</tbody>
</table>
<p>æ¸©é¦¨æç¤º: åŒä¸€ä¸ªé•œåƒå­˜åœ¨çš„æ–¹å¼æœ‰å¯èƒ½ä¸åŒï¼Œä¸åŒç±»å‹æ–¹å¼å­˜å‚¨å¯¹é•œåƒçš„ layer å¤„ç†çš„æ–¹å¼ä¹Ÿä¸ä¸€æ ·,ã€‚</p>
<p><br></p>
<p><strong>æµ‹è¯•ç¯å¢ƒè¯´æ˜</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Docker å®˜æ–¹ hub ä»“åº“ -&gt; docker.io             <span class="comment"># å®˜ç½‘åœ°å€: https://hub.docker.com/</span></span><br><span class="line">ç§æœ‰ Harbor ä»“åº“     -&gt; harbor.weiyigeek.top</span><br><span class="line">ä¸´æ—¶åˆ›å»ºçš„æœ¬åœ°ä»“åº“    -&gt; 192.168.12.111:5000   <span class="comment"># ä¸€æ¢­å­è§£å†³: docker run -d -p 5000:5000 --name registry -v /opt/data/registry:/var/lib/registry registry:2</span></span><br></pre></td></tr></table></figure></p>
<p>è¯´æ˜: ä¸Šè¿°ä»“åº“éƒ½æ˜¯åœ¨Registryä¸­æ”¯æŒDocker Registry HTTP API V2ç‰ˆæœ¬çš„ã€‚</p>
<p><br></p>
<h4 id="Skopeo-login-loout-è¿œç¨‹ä»“åº“-Auth"><a href="#Skopeo-login-loout-è¿œç¨‹ä»“åº“-Auth" class="headerlink" title="Skopeo login/loout - è¿œç¨‹ä»“åº“ Auth"></a>Skopeo login/loout - è¿œç¨‹ä»“åº“ Auth</h4><p>æè¿°: åœ¨ä½¿ç”¨ skopeo å‰å¦‚æœ src æˆ– dest é•œåƒæ˜¯åœ¨ registry ä»“åº“ä¸­çš„å¹¶ä¸”é…ç½®äº†é public çš„é•œåƒéœ€è¦ç›¸åº”çš„ auth è®¤è¯, æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>docker login</code> æˆ–è€… <code>skopeo login</code> çš„æ–¹å¼ç™»å½•åˆ° registry ä»“åº“ï¼Œç„¶åé»˜è®¤ä¼šåœ¨<code>~/.docker</code>ç›®å½•ä¸‹ç”Ÿæˆ registry ç™»å½•é…ç½®æ–‡ä»¶ config.json ,è¯¥æ–‡ä»¶é‡Œä¿å­˜äº†ç™»å½•éœ€è¦çš„éªŒè¯ä¿¡æ¯ï¼Œskopeo æ‹¿åˆ°è¯¥éªŒè¯ä¿¡æ¯æ‰æœ‰æƒé™å¾€ registry push é•œåƒã€‚</p>
<p><strong>ç™»é™†è®¤è¯</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) skopeo login ç™»é™†ç¤ºä¾‹ (ä¸¤ç§æ–¹å¼)</span></span><br><span class="line">$ skopeo login -u WeiyiGeek -p testpassword harbor.weiyigeek.top</span><br><span class="line">  <span class="comment"># Login Succeeded!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) docker login ç™»é™†ç¤ºä¾‹</span></span><br><span class="line">docker login -u WeiyiGeek docker.io</span><br><span class="line">docker login -u WeiyiGeek harbor.weiyigeek.top</span><br><span class="line">docker login -u anonymous -p anonymous 192.168.12.111:5000  <span class="comment"># å®é™…ä¸Šä¸´æ—¶ä»“åº“æ²¡æœ‰é…ç½®è®¤è¯, è´¦å·å¯†ç éšæ„å³å¯ã€‚</span></span><br><span class="line">  <span class="comment"># WARNING! Using --password via the CLI is insecure. Use --password-stdin.</span></span><br><span class="line">  <span class="comment"># WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span></span><br><span class="line">  <span class="comment"># Configure a credential helper to remove this warning. See</span></span><br><span class="line">  <span class="comment"># https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span></span><br><span class="line">  <span class="comment"># Login Succeeded</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) docker login ç”Ÿæˆçš„ registry ç™»å½•é…ç½®æ–‡ä»¶ï¼ˆbase64ç¼–ç å®‰å…¨æ€§ä¸å¤šè¯´ï¼‰</span></span><br><span class="line">cat ~/.docker/config.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"auths"</span>: &#123;</span><br><span class="line">    <span class="string">"192.168.12.111:5000"</span>: &#123;</span><br><span class="line">        <span class="string">"auth"</span>: <span class="string">"YW5v*******Q=="</span></span><br><span class="line">      &#125;,</span><br><span class="line">    <span class="string">"harbor.weiyigeek.top"</span>: &#123;</span><br><span class="line">        <span class="string">"auth"</span>: <span class="string">"YWR*******LkA="</span></span><br><span class="line">      &#125;,</span><br><span class="line">    <span class="string">"https://index.docker.io/v1/"</span>: &#123;</span><br><span class="line">        <span class="string">"auth"</span>: <span class="string">"d2Vp**************kyZA=="</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>æ³¨é”€è®¤è¯</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ skopeo <span class="built_in">logout</span> myregistrydomain.com:5000</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>æ¸©é¦¨æç¤º:</strong> å¦‚æœä¼ä¸šè‡ªå»ºharborä»“åº“(ä¸€èˆ¬éƒ½ä¼šè®¾ç½®è‡ªç­¾è¯ä¹¦)æˆ–è€…å…¶å®ƒç§æœ‰ä»“åº“é…ç½®è¯ä¹¦,ä¸ºäº†é˜²æ­¢å‡ºé”™å»ºè®®è¿›è¡Œä»¥ä¸‹æ“ä½œ(æ­£å¼ç¯å¢ƒè¯·æ ¹æ®éœ€è¦è¿›è¡Œé…ç½®)ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) åœ¨ /etc/docker/daemon.json ä¸­é…ç½®insecure-registrieså­—æ®µ,è¡¨ç¤ºå…è®¸ä¸å®‰å…¨çš„ä»“åº“ã€‚</span></span><br><span class="line"><span class="string">"insecure-registries"</span>: [<span class="string">"harbor.weiyigeek.top"</span>,<span class="string">"192.168.12.111:5000"</span>]</span><br><span class="line"> </span><br><span class="line"><span class="comment"># (2) ä»å®˜æ–¹æ–‡æ¡£å¯çŸ¥å®¢æˆ·ç«¯è¦ä½¿ç”¨tlsä¸Harboré€šä¿¡ä½¿ç”¨çš„è¿˜æ˜¯`è‡ªç­¾è¯ä¹¦`ï¼Œé‚£ä¹ˆå¿…é¡»å»ºç«‹ä¸€ä¸ªç›®å½•ï¼š`/etc/docker/certs.d`</span></span><br><span class="line"><span class="comment"># å¦‚æœé…ç½®å¯èƒ½ä¼šå‡ºç° x509: certificate signed by unknown authority é”™è¯¯æç¤ºã€‚</span></span><br><span class="line">mkdir -vp /etc/docker/certs.d/harbor.weiyigeek.top</span><br><span class="line">cp -a /deployapp/harbor/harbor.pem  /etc/docker/certs.d/harbor.weiyigeek.top/harbor.crt</span><br></pre></td></tr></table></figure></p>
<p><strong>æ¸©é¦¨æç¤º:</strong> ä¸ºäº†é˜²æ­¢åç»­æ‰§è¡Œskopeoå‘½ä»¤æ“ä½œé•œåƒæ—¶å‡ºé”™, å»ºè®®å¿½ç•¥policyç­–ç•¥å’Œè¯ä¹¦æ ¡éªŒå‚æ•°å¦‚ä¸‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--insecure-policy \</span><br><span class="line">--src-tls-verify=<span class="literal">false</span> \ </span><br><span class="line">--dest-tls-verify=<span class="literal">false</span> \</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="Skopeo-inspect-æ£€æŸ¥å­˜å‚¨åº“ä¸­çš„é•œåƒ"><a href="#Skopeo-inspect-æ£€æŸ¥å­˜å‚¨åº“ä¸­çš„é•œåƒ" class="headerlink" title="Skopeo inspect - æ£€æŸ¥å­˜å‚¨åº“ä¸­çš„é•œåƒ"></a>Skopeo inspect - æ£€æŸ¥å­˜å‚¨åº“ä¸­çš„é•œåƒ</h4><p>æè¿°: skopeo èƒ½å¤Ÿæ£€æŸ¥å®¹å™¨Registryä¸Šçš„å­˜å‚¨åº“å¹¶è·å–å›¾åƒå±‚ã€‚æ£€æŸ¥å‘½ä»¤è·å–å­˜å‚¨åº“çš„æ¸…å•ï¼Œå®ƒèƒ½å¤Ÿå‘æ‚¨æ˜¾ç¤ºæœ‰å…³æ•´ä¸ªå­˜å‚¨åº“æˆ–æ ‡ç­¾çš„ç±»ä¼¼ <code>docker inspect</code> çš„ json è¾“å‡ºã€‚ä¸ docker inspect ç›¸æ¯”,æ­¤å·¥å…·å¯å¸®åŠ©æ‚¨åœ¨æ‹‰å–å­˜å‚¨åº“æˆ–æ ‡ç­¾ä¹‹å‰æ”¶é›†æœ‰ç”¨çš„ä¿¡æ¯(ä½¿ç”¨ç£ç›˜ç©ºé—´), æ£€æŸ¥å‘½ä»¤å¯ä»¥å‘æ‚¨æ˜¾ç¤ºç»™å®šå­˜å‚¨åº“å¯ç”¨çš„æ ‡ç­¾ã€æ˜ åƒå…·æœ‰çš„æ ‡ç­¾ã€æ˜ åƒçš„åˆ›å»ºæ—¥æœŸå’Œæ“ä½œç³»ç»Ÿç­‰ã€‚</p>
<p>æ”¯æŒä¼ è¾“çš„ç±»å‹ : <code>containers-storage, dir, docker, docker-archive, docker-daemon, oci, oci-archive, ostree, tarball</code></p>
<p>æ­¥éª¤ 01.æ˜¾ç¤º busybox:latest é•œåƒçš„å±æ€§ç›¸å…³ä¿¡æ¯ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">skopeo inspect docker://docker.io/busybox:latest</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"Name"</span>: <span class="string">"docker.io/library/busybox"</span>,</span><br><span class="line">  <span class="string">"Digest"</span>: <span class="string">"sha256:5acba83a746c7608ed544dc1533b87c737a0b0fb730301639a0179f9344b1678"</span>,</span><br><span class="line">  <span class="string">"RepoTags"</span>: [</span><br><span class="line">      <span class="string">"1"</span>,</span><br><span class="line">      <span class="string">"1-glibc"</span>,</span><br><span class="line">      <span class="string">"1-musl"</span>,</span><br><span class="line">      <span class="string">"1-ubuntu"</span>,</span><br><span class="line">      <span class="string">"1-uclibc"</span>,</span><br><span class="line">      <span class="string">"1.21-ubuntu"</span>,</span><br><span class="line">      <span class="string">"1.21.0-ubuntu"</span>,</span><br><span class="line">        .......          <span class="comment"># é•œåƒå†å²tags</span></span><br><span class="line">      <span class="string">"unstable-uclibc"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"Created"</span>: <span class="string">"2021-12-30T19:19:41.006954958Z"</span>,</span><br><span class="line">  <span class="string">"DockerVersion"</span>: <span class="string">"20.10.7"</span>,</span><br><span class="line">  <span class="string">"Labels"</span>: null,</span><br><span class="line">  <span class="string">"Architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">  <span class="string">"Os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">  <span class="string">"Layers"</span>: [</span><br><span class="line">      <span class="string">"sha256:5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ­¥éª¤ 02.æ˜¾ç¤º busybox:latest é•œåƒçš„å®¹å™¨é…ç½®ç›¸å…³ä¿¡æ¯ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ skopeo inspect --config docker://docker.io/busybox:latest  | jq</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"created"</span>: <span class="string">"2021-12-30T19:19:41.006954958Z"</span>,</span><br><span class="line">  <span class="string">"architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">  <span class="string">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">  <span class="string">"config"</span>: &#123;</span><br><span class="line">    <span class="string">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"sh"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"rootfs"</span>: &#123;</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"layers"</span>,</span><br><span class="line">    <span class="string">"diff_ids"</span>: [</span><br><span class="line">      <span class="string">"sha256:01fd6df81c8ec7dd24bbbd72342671f41813f992999a3471b9d9cbc44ad88374"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"history"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"created"</span>: <span class="string">"2021-12-30T19:19:40.833034683Z"</span>,</span><br><span class="line">      <span class="string">"created_by"</span>: <span class="string">"/bin/sh -c #(nop) ADD file:6db446a57cbd2b7f4cfde1f280177b458390ed5a6d1b54c6169522bc2c4d838e in / "</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"created"</span>: <span class="string">"2021-12-30T19:19:41.006954958Z"</span>,</span><br><span class="line">      <span class="string">"created_by"</span>: <span class="string">"/bin/sh -c #(nop)  CMD [\"sh\"]"</span>,</span><br><span class="line">      <span class="string">"empty_layer"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ­¥éª¤ 03.æ˜¾ç¤ºæœªç»éªŒè¯çš„å›¾åƒ Digestï¼ˆæ‘˜è¦ï¼‰<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ skopeo inspect --format <span class="string">"Name: &#123;&#123;.Name&#125;&#125; Digest: &#123;&#123;.Digest&#125;&#125;"</span> docker://docker.io/busybox:latest</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="Skopeo-copy-ä»“åº“é•œåƒæ‹·è´"><a href="#Skopeo-copy-ä»“åº“é•œåƒæ‹·è´" class="headerlink" title="Skopeo copy - ä»“åº“é•œåƒæ‹·è´"></a>Skopeo copy - ä»“åº“é•œåƒæ‹·è´</h4><p>æè¿°: skopeo å¯ä»¥åœ¨å„ç§å­˜å‚¨æœºåˆ¶ä¹‹é—´å¤åˆ¶å®¹å™¨é•œåƒï¼Œæ”¯æŒåŒ…æ‹¬å®¹å™¨ä»“åº“(<code>The Quay, Docker Hub, OpenShift, GCR, ï¼ŒArtifactory ...</code>)ä»¥åŠå®¹å™¨å­˜å‚¨åç«¯ (<code>Podman, CRI-O, Docker</code>) ç­‰ã€æœ¬åœ°ç›®å½•ã€æœ¬åœ° OCI-layout ç›®å½•ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæ­¤å¤„æˆ‘ä»hubä»“åº“å¤åˆ¶<code>busybox:latest</code>é•œåƒåˆ°ç§æœ‰harbotä»“åº“ä¸­,åœ¨ä»ç§æœ‰harbotä»“åº“ä¸­æ‹·è´åˆ°æœ¬åœ°æŒ‡å®šç›®å½•ä¸­ã€‚</p>
<p>æ­¥éª¤ 01.ä» regsitry A åˆ° registry B å¤åˆ¶ busybox:latest é•œåƒã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">skopeo copy --insecure-policy --src-tls-verify=<span class="literal">false</span> --dest-tls-verify=<span class="literal">false</span> --dest-authfile /root/.docker/config.json docker://docker.io/busybox:latest docker://harbor.weiyigeek.top/devops/busybox:latest</span><br><span class="line">  <span class="comment"># Getting image source signatures</span></span><br><span class="line">  <span class="comment"># Copying blob 5cc84ad355aa done</span></span><br><span class="line">  <span class="comment"># Copying config beae173cca done</span></span><br><span class="line">  <span class="comment"># Writing manifest to image destination</span></span><br><span class="line">  <span class="comment"># Storing signatures</span></span><br></pre></td></tr></table></figure><br>Tips: ç”±ä¸Šè¿°æ—¥å¿—å¯ä»¥çœ‹åˆ° skopeo æ˜¯ç›´æ¥ä» registry ä¸­ copy é•œåƒ layer çš„ blob æ–‡ä»¶ï¼Œä¼ è¾“æ˜¯é•œåƒåœ¨ registry ä¸­å­˜å‚¨çš„åŸå§‹æ ¼å¼ã€‚</p>
<p><br/></p>
<p>æ­¥éª¤ 02.ä» registry B å¤åˆ¶ busybox:latest é•œåƒåˆ°æœ¬åœ° busybox:latest ç›®å½•ä¸­ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">skopeo copy --insecure-policy --src-tls-verify=<span class="literal">false</span> docker://harbor.weiyigeek.top/devops/busybox:latest dir:busybox:latest</span><br><span class="line"><span class="comment"># Getting image source signatures</span></span><br><span class="line"><span class="comment"># Copying blob 5cc84ad355aa done</span></span><br><span class="line"><span class="comment"># Copying config beae173cca done</span></span><br><span class="line"><span class="comment"># Writing manifest to image destination</span></span><br><span class="line"><span class="comment"># Storing signatures</span></span><br><span class="line"></span><br><span class="line">ls &amp;&amp; tree busybox\:latest/</span><br><span class="line">busybox:latest/</span><br><span class="line">â”œâ”€â”€ 5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa   <span class="comment"># blob å—æ–‡ä»¶ -&gt; vnd.docker.image.rootfs.diff.tar.gzip</span></span><br><span class="line">â”œâ”€â”€ beae173ccac6ad749f76713cf4440fe3d21d1043fe616dfbe30775815d1d0f6a   <span class="comment"># é•œåƒé…ç½®ä¿¡æ¯æ–‡ä»¶ -&gt; vnd.docker.container.image.v1+json </span></span><br><span class="line">â”œâ”€â”€ manifest.json</span><br><span class="line">â””â”€â”€ version</span><br><span class="line">0 directories, 4 files</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹é•œåƒçš„ manifest æ–‡ä»¶</span></span><br><span class="line">cat busybox\:latest/manifest.json</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">"schemaVersion"</span>: 2,</span><br><span class="line">   <span class="string">"mediaType"</span>: <span class="string">"application/vnd.docker.distribution.manifest.v2+json"</span>,</span><br><span class="line">   <span class="string">"config"</span>: &#123;</span><br><span class="line">      <span class="string">"mediaType"</span>: <span class="string">"application/vnd.docker.container.image.v1+json"</span>,</span><br><span class="line">      <span class="string">"size"</span>: 1456,</span><br><span class="line">      <span class="string">"digest"</span>: <span class="string">"sha256:beae173ccac6ad749f76713cf4440fe3d21d1043fe616dfbe30775815d1d0f6a"</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">"layers"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">"mediaType"</span>: <span class="string">"application/vnd.docker.image.rootfs.diff.tar.gzip"</span>,</span><br><span class="line">         <span class="string">"size"</span>: 772788,</span><br><span class="line">         <span class="string">"digest"</span>: <span class="string">"sha256:5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa"</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ® manifest æ–‡ä»¶æŸ¥çœ‹é•œåƒçš„ image config æ–‡ä»¶ (å­˜æ”¾é•œåƒBuildæŒ‡ä»¤ä¸é•œåƒç›¸å…³é…ç½®ä¿¡æ¯)</span></span><br><span class="line">jq <span class="string">'.'</span> busybox\:latest/beae173ccac6ad749f76713cf4440fe3d21d1043fe616dfbe30775815d1d0f6a</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">  <span class="string">"config"</span>: &#123;</span><br><span class="line">    <span class="string">"Hostname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"User"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"Env"</span>: [</span><br><span class="line">      <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"Cmd"</span>: [</span><br><span class="line">      <span class="string">"sh"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"Image"</span>: <span class="string">"sha256:da658412c37aa24e561eb7e16c61bc82a9711340d8fb5cf1a8f39d8e96d7f723"</span>,</span><br><span class="line">    <span class="string">"Volumes"</span>: null,</span><br><span class="line">    <span class="string">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"Entrypoint"</span>: null,</span><br><span class="line">    <span class="string">"OnBuild"</span>: null,</span><br><span class="line">    <span class="string">"Labels"</span>: null</span><br><span class="line">  &#125;,</span><br><span class="line">........</span><br><span class="line">  <span class="string">"history"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"created"</span>: <span class="string">"2021-12-30T19:19:40.833034683Z"</span>,</span><br><span class="line">      <span class="string">"created_by"</span>: <span class="string">"/bin/sh -c #(nop) ADD file:6db446a57cbd2b7f4cfde1f280177b458390ed5a6d1b54c6169522bc2c4d838e in / "</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"created"</span>: <span class="string">"2021-12-30T19:19:41.006954958Z"</span>,</span><br><span class="line">      <span class="string">"created_by"</span>: <span class="string">"/bin/sh -c #(nop)  CMD [\"sh\"]"</span>,</span><br><span class="line">      <span class="string">"empty_layer"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">  <span class="string">"rootfs"</span>: &#123;</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"layers"</span>,</span><br><span class="line">    <span class="string">"diff_ids"</span>: [</span><br><span class="line">      <span class="string">"sha256:01fd6df81c8ec7dd24bbbd72342671f41813f992999a3471b9d9cbc44ad88374"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br/></p>
<p>æ­¥éª¤ 03.å°†busybox:latesté•œåƒä» registry B å¤åˆ¶åˆ°æœ¬åœ°ç›®å½•ï¼Œå¹¶ä»¥ OCI æ ¼å¼ä¿å­˜<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ skopeo copy --insecure-policy --src-tls-verify=<span class="literal">false</span> docker://harbor.weiyigeek.top/devops/busybox:latest oci:busybox-latest</span><br><span class="line">  <span class="comment"># Getting image source signatures</span></span><br><span class="line">  <span class="comment"># Copying blob 5cc84ad355aa done</span></span><br><span class="line">  <span class="comment"># Copying config 48edd9298a done</span></span><br><span class="line">  <span class="comment"># Writing manifest to image destination</span></span><br><span class="line">  <span class="comment"># Storing signatures</span></span><br><span class="line"></span><br><span class="line">tree -h busybox-latest/</span><br><span class="line">  <span class="comment"># busybox-latest/</span></span><br><span class="line">  <span class="comment"># â”œâ”€â”€ [4.0K]  blobs</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â””â”€â”€ [4.0K]  sha256</span></span><br><span class="line">  <span class="comment"># â”‚Â Â      â”œâ”€â”€ [ 347]  1612e16ff3f6b0d09eefdc4e9d5c5c0624f63032743e016585b095b958778016</span></span><br><span class="line">  <span class="comment"># â”‚Â Â      â”œâ”€â”€ [ 575]  48edd9298a25de2c97cd574a5523026f87576c6b7202330a2b60ce7d304ec307</span></span><br><span class="line">  <span class="comment"># â”‚Â Â      â””â”€â”€ [755K]  5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa  # Blob å— -</span></span><br><span class="line">  <span class="comment"># â”œâ”€â”€ [ 186]  index.json</span></span><br><span class="line">  <span class="comment"># â””â”€â”€ [  31]  oci-layout</span></span><br><span class="line">  <span class="comment"># 2 directories, 5 files</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>æ­¥éª¤ 04.å°† <code>alpine:3.13.1</code> é•œåƒä» docker æœ¬åœ°å­˜å‚¨ï¼ˆ /var/lib/docker/imageï¼‰ push åˆ° registry Bä¸­(å®é™…ä¸Šæ›¿ä»£ docker push åŠŸèƒ½)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨  /var/lib/docker/ ç›®å½•ä¸­æ­¤å¤„ä¸»è¦å…³å¿ƒ image (ä¸»è¦å­˜æ”¾é•œåƒä¸­layerå±‚çš„å…ƒæ•°æ®) å’Œ overlay2 (å„å±‚çš„å…·ä½“ä¿¡æ¯)</span></span><br><span class="line">docker images alpine:3.13.1</span><br><span class="line">  <span class="comment"># REPOSITORY   TAG       IMAGE ID       CREATED         SIZE</span></span><br><span class="line">  <span class="comment"># alpine       3.13.1    e50c909a8df2   11 months ago   5.61MB</span></span><br><span class="line"></span><br><span class="line">skopeo copy --insecure-policy --dest-tls-verify=<span class="literal">false</span> --dest-authfile /root/.docker/config.json docker-daemon:alpine:3.13.1 docker://harbor.weiyigeek.top/devops/alpine:3.13.1</span><br><span class="line">  <span class="comment"># Getting image source signatures</span></span><br><span class="line">  <span class="comment"># Copying blob 1119ff37d4a9 done</span></span><br><span class="line">  <span class="comment"># Copying config e50c909a8d done</span></span><br><span class="line">  <span class="comment"># Writing manifest to image destination</span></span><br><span class="line">  <span class="comment"># Storing signatures</span></span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=å¦‚ä½•ä½¿ç”¨Skopeoåšä¸€ä¸ªä¼˜é›…çš„é•œåƒæ¬è¿å·¥ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20220120200048.png" target="_blank" title="WeiyiGeek.harborä»“åº“ä¸­çš„alpineé•œåƒ" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20220120200048.png" alt="WeiyiGeek.harborä»“åº“ä¸­çš„alpineé•œåƒ" title="" class=""></a>
                <p>WeiyiGeek.harborä»“åº“ä¸­çš„alpineé•œåƒ</p>
            </figure>
<p><br></p>
<h4 id="Skopeo-sync-é•œåƒåŒæ­¥å‘½ä»¤"><a href="#Skopeo-sync-é•œåƒåŒæ­¥å‘½ä»¤" class="headerlink" title="Skopeo sync - é•œåƒåŒæ­¥å‘½ä»¤"></a>Skopeo sync - é•œåƒåŒæ­¥å‘½ä»¤</h4><p>æè¿°: Skopeo syncå¯ä»¥åœ¨å®¹å™¨ä»“åº“å’Œæœ¬åœ°ç›®å½•ä¹‹é—´åŒæ­¥é•œåƒï¼Œå…¶åŠŸèƒ½ç±»ä¼¼äºé˜¿é‡Œäº‘çš„ image-syncer (<a href="https://github.com/AliyunContainerService/image-syncer" target="_blank" rel="noopener">https://github.com/AliyunContainerService/image-syncer</a>) å·¥å…·, å®é™…ä¸Šå…¶æ¯” image-syncer æ›´å¼ºå¤§ã€çµæ´»æ€§æ›´å¼ºä¸€äº›ï¼ŒåºŸè¯ä¸å¤šè¯´å®è·µä¸ºç‹ã€‚</p>
<p>skopeo sync é•œåƒåŒæ­¥æ–‡ä»¶ç¤ºä¾‹:</p>
<p>æ­¥éª¤ 01.å°†ä»“åº“ä¸­æ‰€æœ‰busyboxé•œåƒç‰ˆæœ¬åŒæ­¥åˆ°æœ¬åœ°ç›®å½•ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ skopeo sync --insecure-policy --src-tls-verify=<span class="literal">false</span> --src docker --dest dir harbor.weiyigeek.top/devops/busybox /tmp</span><br><span class="line">  <span class="comment"># INFO[0000] Tag presence check                            imagename=harbor.weiyigeek.top/devops/busybox tagged=false</span></span><br><span class="line">  <span class="comment"># INFO[0000] Getting tags                                  image=harbor.weiyigeek.top/devops/busybox</span></span><br><span class="line">  <span class="comment"># INFO[0000] Copying image ref 1/1                         from="docker://harbor.weiyigeek.top/devops/busybox:latest" to="dir:/tmp/busybox:latest"</span></span><br><span class="line">  <span class="comment"># Getting image source signatures</span></span><br><span class="line">  <span class="comment"># Copying blob 5cc84ad355aa done</span></span><br><span class="line">  <span class="comment"># Copying config beae173cca done</span></span><br><span class="line">  <span class="comment"># Writing manifest to image destination</span></span><br><span class="line">  <span class="comment"># Storing signatures</span></span><br><span class="line">  <span class="comment"># INFO[0000] Synced 1 images from 1 sources</span></span><br><span class="line"></span><br><span class="line">$ tree -h /tmp/busybox:latest</span><br><span class="line">/tmp/busybox:latest</span><br><span class="line">â”œâ”€â”€ [755K]  5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa</span><br><span class="line">â”œâ”€â”€ [1.4K]  beae173ccac6ad749f76713cf4440fe3d21d1043fe616dfbe30775815d1d0f6a</span><br><span class="line">â”œâ”€â”€ [ 527]  manifest.json</span><br><span class="line">â””â”€â”€ [  33]  version</span><br><span class="line">0 directories, 4 files</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>æ­¥éª¤ 02.ä»æœ¬åœ°ç›®å½•<code>/tmp/</code>åŒæ­¥åˆ° docker çš„ hub å®¹å™¨ä»“åº“ä¸­ï¼Œæ­¤å¤–æˆ‘ä»¬å¯ä»¥é€šè¿‡æµè§ˆå™¨çœ‹åˆ° <code>weiyigeek</code> ç”¨æˆ·ä¸‹çš„ <code>busybox</code> é•œåƒ (<a href="https://hub.docker.com/u/weiyigeek)ã€‚" target="_blank" rel="noopener">https://hub.docker.com/u/weiyigeek)ã€‚</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ skopeo sync --insecure-policy --dest-tls-verify=<span class="literal">false</span> --src dir --dest docker /tmp weiyigeek</span><br><span class="line">  <span class="comment"># INFO[0000] Copying image ref 1/1                         from="dir:/tmp/busybox:latest" to="docker://weiyigeek/busybox:latest"</span></span><br><span class="line">  <span class="comment"># Getting image source signatures</span></span><br><span class="line">  <span class="comment"># Copying blob 5cc84ad355aa skipped: already exists</span></span><br><span class="line">  <span class="comment"># Copying config beae173cca done</span></span><br><span class="line">  <span class="comment"># Writing manifest to image destination</span></span><br><span class="line">  <span class="comment"># Storing signatures</span></span><br><span class="line">  <span class="comment"># INFO[0021] Synced 1 images from 1 sources</span></span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=å¦‚ä½•ä½¿ç”¨Skopeoåšä¸€ä¸ªä¼˜é›…çš„é•œåƒæ¬è¿å·¥ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20220120204336.png" target="_blank" title="WeiyiGeek.hub-docker" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20220120204336.png" alt="WeiyiGeek.hub-docker" title="" class=""></a>
                <p>WeiyiGeek.hub-docker</p>
            </figure></p>
<p><br></p>
<p>æ­¥éª¤ 03.ä»hubå®¹å™¨ä»“åº“ä¸­åŒæ­¥alpine-jenkins-jnlp:v2.285é•œåƒåˆ°æœ¬åœ°ä¸´æ—¶å®¹å™¨ä»“åº“ä¸­ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ skopeo sync --insecure-policy --src-tls-verify=<span class="literal">false</span> --dest-tls-verify=<span class="literal">false</span> --src docker --dest docker weiyigeek/alpine-jenkins-jnlp:v2.285 192.168.12.111:5000/</span><br><span class="line">  <span class="comment"># INFO[0000] Tag presence check imagename="weiyigeek/alpine-jenkins-jnlp:v2.285" tagged=true</span></span><br><span class="line">  <span class="comment"># INFO[0000] Copying image ref 1/1 from="docker://weiyigeek/alpine-jenkins-jnlp:v2.285" to="docker://192.168.12.111:5000/alpine-jenkins-jnlp:v2.285"</span></span><br><span class="line">  <span class="comment"># Getting image source signatures</span></span><br><span class="line">  <span class="comment"># Copying blob 68517a8c32d3 [======&gt;-------------------------------] 45.0MiB / 255.7MiB</span></span><br><span class="line">  <span class="comment"># Copying blob 4c0d98bf9879 done</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>æ­¥éª¤ 04.ä»¥é…ç½®æ–‡ä»¶æ–¹å¼è¿›è¡ŒåŒæ­¥, é¦–å…ˆæˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸€ä¸ªéœ€è¦åŒæ­¥çš„èµ„æºæ¸…å•ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># YAML æ–‡ä»¶å†…å®¹ï¼ˆç”¨äº **--src yaml** çš„æºï¼‰</span></span><br><span class="line">cat &lt;&lt;<span class="string">'EOF'</span> &gt; skopeo-sync.yml</span><br><span class="line">registry.example.com:</span><br><span class="line">  images:</span><br><span class="line">    busybox: []</span><br><span class="line">    redis:</span><br><span class="line">      - <span class="string">"1.0"</span></span><br><span class="line">      - <span class="string">"2.0"</span></span><br><span class="line">      - <span class="string">"sha256:111111"</span></span><br><span class="line">  images-by-tag-regex:</span><br><span class="line">      nginx: ^1\.13\.[12]-alpine-perl$</span><br><span class="line">  credentials:</span><br><span class="line">      username: john</span><br><span class="line">      password: this is a secret</span><br><span class="line">  tls-verify: <span class="literal">true</span></span><br><span class="line">  cert-dir: /home/john/certs</span><br><span class="line">quay.io:</span><br><span class="line">  tls-verify: <span class="literal">false</span></span><br><span class="line">  images:</span><br><span class="line">    coreos/etcd:</span><br><span class="line">      - latest</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥yamlæ–‡ä»¶æ–¹å¼è¿›è¡ŒåŒæ­¥é•œåƒåˆ° my-registry.local.lan/repo/ ä»“åº“ä¸­</span></span><br><span class="line">$ skopeo sync --src yaml --dest docker skopeo-sync.yml my-registry.local.lan/repo/</span><br></pre></td></tr></table></figure></p>
<p>skopeo-sync.yml æ–‡ä»¶ä¸­é•œåƒåŒ¹é…å¤åˆ¶é•œåƒè¯´æ˜:</p>
<ul>
<li>registry.example.com/busybox : æ‰€æœ‰ç‰ˆæœ¬çš„é•œåƒ.</li>
<li>registry.example.com/redis : æ ‡è®°ä¸ºâ€œ1.0â€å’Œâ€œ2.0â€çš„å›¾åƒä»¥åŠå¸¦æœ‰æ‘˜è¦çš„å›¾åƒâ€sha256:0000000000000000000000000000000011111111111111111111111111111111â€.</li>
<li>registry.example.com/nginx : å›¾ç‰‡æ ‡è®°ä¸ºâ€œ1.13.1-alpine-perlâ€å’Œâ€œ1.13.2-alpine-perlâ€.</li>
<li>quay.io/coreos/etcd : æ‹‰å–æœ€æ–°ç‰ˆæœ¬çš„é•œåƒã€‚</li>
</ul>
<p><br></p>
<h4 id="Skopeo-list-tags-ä»“åº“ä¸­é•œåƒtagæŸ¥çœ‹"><a href="#Skopeo-list-tags-ä»“åº“ä¸­é•œåƒtagæŸ¥çœ‹" class="headerlink" title="Skopeo list-tags - ä»“åº“ä¸­é•œåƒtagæŸ¥çœ‹"></a>Skopeo list-tags - ä»“åº“ä¸­é•œåƒtagæŸ¥çœ‹</h4><p>æè¿°: åˆ©ç”¨è¯¥å‘½ä»¤æˆ‘ä»¬å¯ä»¥åˆ—å‡º registry ä¸Šçš„æŸä¸ªé•œåƒçš„æ‰€æœ‰ tag ï¼Œå®ƒæ˜¯ä½¿ç”¨æ ‡å‡†çš„ registry API æ¥è·å–é•œåƒ tagã€‚</p>
<p>ç®€å•ç¤ºä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ skopeo list-tags docker://harbor.weiyigeek.top/devops/busybox:latest</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="Skopeo-delete-åˆ é™¤ä»“åº“ä¸­é•œåƒTag"><a href="#Skopeo-delete-åˆ é™¤ä»“åº“ä¸­é•œåƒTag" class="headerlink" title="Skopeo delete - åˆ é™¤ä»“åº“ä¸­é•œåƒTag"></a>Skopeo delete - åˆ é™¤ä»“åº“ä¸­é•œåƒTag</h4><p>æè¿°: ä½¿ç”¨è¯¥å‘½ä»¤æˆ‘ä»¬å¯ä»¥åˆ é™¤é•œåƒTag,æ³¨æ„æ­¤å¤„ä»…ä»…åªæ˜¯é€šè¿‡registry API æ¥åˆ é™¤é•œåƒçš„ tagï¼ˆå³åˆ é™¤äº† tag å¯¹ manifests æ–‡ä»¶çš„å¼•ç”¨ï¼‰å¹¶éçœŸæ­£å°†é•œåƒåˆ é™¤æ‰ï¼Œå¦‚æœæƒ³è¦åˆ é™¤é•œåƒçš„ layer è¿˜æ˜¯éœ€è¦é€šè¿‡ registry GC çš„æ–¹å¼ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼1.åˆ©ç”¨skopeo delete</span></span><br><span class="line">$ skopeo delete docker://harbor.weiyigeek.top/devops/busybox:latest --debug</span><br><span class="line">  <span class="comment"># DEBU[0000] Loading registries configuration "/etc/containers/registries.conf"</span></span><br><span class="line">  <span class="comment"># DEBU[0000] Found credentials for harbor.weiyigeek.top in credential helper containers-auth.json in file /home/weiyigeek/.docker/config.json</span></span><br><span class="line">  <span class="comment"># DEBU[0000] Using registries.d directory /etc/containers/registries.d for sigstore configuration</span></span><br><span class="line">  <span class="comment"># DEBU[0000]  No signature storage configuration found for harbor.weiyigeek.top/devops/busybox:latest, using built-in default file:///home/weiyigeek/.local/share/containers/sigstore</span></span><br><span class="line">  <span class="comment"># DEBU[0000] Looking for TLS certificates and private keys in /etc/docker/certs.d/harbor.weiyigeek.top</span></span><br><span class="line">  <span class="comment"># DEBU[0000]  crt: /etc/docker/certs.d/harbor.weiyigeek.top/harbor.crt</span></span><br><span class="line">  <span class="comment"># DEBU[0000] GET https://harbor.weiyigeek.top/v2/</span></span><br><span class="line">  <span class="comment"># DEBU[0000] Ping https://harbor.weiyigeek.top/v2/ status 401</span></span><br><span class="line">  <span class="comment"># DEBU[0000] GET https://harbor.weiyigeek.top/service/token?account=WeiyiGeek&amp;scope=repository%3Adevops%2Fbusybox%3A%2A&amp;service=harbor-registry</span></span><br><span class="line">  <span class="comment"># DEBU[0000] GET https://harbor.weiyigeek.top/v2/devops/busybox/manifests/latest</span></span><br><span class="line">  <span class="comment"># DEBU[0000] DELETE https://harbor.weiyigeek.top/v2/devops/busybox/manifests/sha256:62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732dee</span></span><br><span class="line">  <span class="comment"># DEBU[0000] Deleting /home/weiyigeek/.local/share/containers/sigstore/devops/busybox@sha256=62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732dee/signature-1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2.åˆ©ç”¨curl å‘½ä»¤è¿›è¡Œregisteryè¿›è¡Œåˆ é™¤Tagã€‚</span></span><br><span class="line">curl --header <span class="string">"Accept: application/vnd.docker.distribution.manifest.v2+json"</span> -I -X GET http://192.168.12.111:5000/v2/busybox/manifests/latest</span><br><span class="line">  <span class="comment"># HTTP/1.1 200 OK</span></span><br><span class="line">  <span class="comment"># Content-Length: 527</span></span><br><span class="line">  <span class="comment"># Content-Type: application/vnd.docker.distribution.manifest.v2+json</span></span><br><span class="line">  <span class="comment"># Docker-Content-Digest: sha256:62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732dee</span></span><br><span class="line">  <span class="comment"># Docker-Distribution-Api-Version: registry/2.0</span></span><br><span class="line">  <span class="comment"># Etag: "sha256:62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732dee"</span></span><br><span class="line">  <span class="comment"># X-Content-Type-Options: nosniff</span></span><br><span class="line">  <span class="comment"># Date: Thu, 20 Jan 2022 13:18:28 GMT</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸€æŠŠæ¢­ç»‡æå®š</span></span><br><span class="line">Docker-Content-Digest=$(curl -s --header <span class="string">"Accept: application/vnd.docker.distribution.manifest.v2+json"</span> -I -X GET http://192.168.12.111:5000/v2/busybox/manifests/latest | grep <span class="string">"Docker-Content-Digest"</span> | cut -d <span class="string">' '</span> -f 2)</span><br><span class="line">curl -I -X DELETE http://192.168.12.111:5000/v2/busybox/manifests/<span class="variable">$&#123;Docker-Content-Digest&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="0x03-é•œåƒåŒæ­¥æœ€ä½³å®è·µ"><a href="#0x03-é•œåƒåŒæ­¥æœ€ä½³å®è·µ" class="headerlink" title="0x03 é•œåƒåŒæ­¥æœ€ä½³å®è·µ"></a>0x03 é•œåƒåŒæ­¥æœ€ä½³å®è·µ</h2><p>æœ¬ç« èŠ‚ï¼Œä¸»è¦å‚è€ƒæˆ‘å‰åŒäº‹æœ¨å­åšå®¢(<a href="https://blog.k8s.li/skopeo.html)ã€‚" target="_blank" rel="noopener">https://blog.k8s.li/skopeo.html)ã€‚</a></p>
<h3 id="1-æŒ‡å®šæ–‡æœ¬ä¸­é•œåƒåŒæ­¥"><a href="#1-æŒ‡å®šæ–‡æœ¬ä¸­é•œåƒåŒæ­¥" class="headerlink" title="1.æŒ‡å®šæ–‡æœ¬ä¸­é•œåƒåŒæ­¥"></a>1.æŒ‡å®šæ–‡æœ¬ä¸­é•œåƒåŒæ­¥</h3><p>å‡å¦‚,ç»™ä½ ä¸€ä¸ªé•œåƒåˆ—è¡¨ images-list.txt, å…¶æ ¼å¼å¦‚ä¸‹, æˆ‘ä»¬å¯ä»¥ç›´æ¥é‡‡ç”¨shellè„šæœ¬è°ƒç”¨skopeoè¿›è¡Œæ‰§è¡Œã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># images-list.txt</span></span><br><span class="line">cat &lt;&lt;<span class="string">'EOF'</span> &gt; images-list.txt</span><br><span class="line">kubesphere/kube-apiserver:v1.20.6</span><br><span class="line">kubesphere/kube-scheduler:v1.20.6</span><br><span class="line">kubesphere/kube-proxy:v1.20.6</span><br><span class="line">kubesphere/kube-controller-manager:v1.20.6</span><br><span class="line">kubesphere/kube-apiserver:v1.19.8</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></p>
<p><strong>åŒæ­¥çš„shellè„šæœ¬ skopeo-copy.sh</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">GREEN_COL=<span class="string">"\\033[32;1m"</span></span><br><span class="line">RED_COL=<span class="string">"\\033[1;31m"</span></span><br><span class="line">NORMAL_COL=<span class="string">"\\033[0;39m"</span></span><br><span class="line"></span><br><span class="line">SOURCE_REGISTRY=<span class="variable">$1</span></span><br><span class="line">TARGET_REGISTRY=<span class="variable">$2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># shell å˜é‡èµ‹å€¼ï¼Œå½“æ²¡æœ‰ä»å‘½ä»¤è¡Œä¸­ä¼ é€’å€¼ç»™SOURCE_REGISTRYå’ŒTARGET_REGISTRYå˜é‡æ—¶ï¼Œä¾¿é‡‡ç”¨ä¸‹è¿°å€¼è¿›è¡Œè¦†ç›–ã€‚</span></span><br><span class="line">: <span class="variable">$&#123;IMAGES_LIST_FILE:="images-list.txt"&#125;</span></span><br><span class="line">: <span class="variable">$&#123;TARGET_REGISTRY:="hub.k8s.li"&#125;</span></span><br><span class="line">: <span class="variable">$&#123;SOURCE_REGISTRY:="docker.io"&#125;</span></span><br><span class="line"></span><br><span class="line">BLOBS_PATH=<span class="string">"docker/registry/v2/blobs/sha256"</span></span><br><span class="line">REPO_PATH=<span class="string">"docker/registry/v2/repositories"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -eo pipefail</span><br><span class="line"></span><br><span class="line">CURRENT_NUM=0</span><br><span class="line">ALL_IMAGES=<span class="string">"<span class="variable">$(sed -n '/#/d;s/:/:/p' $&#123;IMAGES_LIST_FILE&#125; | sort -u)</span>"</span></span><br><span class="line">TOTAL_NUMS=$(<span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;ALL_IMAGES&#125;</span>"</span> | wc -l)</span><br><span class="line"></span><br><span class="line"><span class="comment"># shopeo æ‹·è´å‡½æ•°ï¼Œæ³¨æ„å…¶ä¼ é€’çš„å‚æ•°ï¼Œæ­¤å¤„å€¼å¾—å­¦ä¹ è®°å½•ã€‚</span></span><br><span class="line"><span class="function"><span class="title">skopeo_copy</span></span>() &#123;</span><br><span class="line"> <span class="keyword">if</span> skopeo copy --insecure-policy --src-tls-verify=<span class="literal">false</span> --dest-tls-verify=<span class="literal">false</span> \</span><br><span class="line"> --override-arch amd64 --override-os linux -q docker://<span class="variable">$1</span> docker://<span class="variable">$2</span>; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">"<span class="variable">$GREEN_COL</span> Progress: <span class="variable">$&#123;CURRENT_NUM&#125;</span>/<span class="variable">$&#123;TOTAL_NUMS&#125;</span> sync <span class="variable">$1</span> to <span class="variable">$2</span> successful <span class="variable">$NORMAL_COL</span>"</span></span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">"<span class="variable">$RED_COL</span> Progress: <span class="variable">$&#123;CURRENT_NUM&#125;</span>/<span class="variable">$&#123;TOTAL_NUMS&#125;</span> sync <span class="variable">$1</span> to <span class="variable">$2</span> failed <span class="variable">$NORMAL_COL</span>"</span></span><br><span class="line">  <span class="built_in">exit</span> 2</span><br><span class="line"> <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨æ‹·è´å‡½æ•°å¹¶è®°å½•å½“å‰æ‰§è¡Œåºå·ã€‚</span></span><br><span class="line"><span class="keyword">for</span> image <span class="keyword">in</span> <span class="variable">$&#123;ALL_IMAGES&#125;</span>; <span class="keyword">do</span></span><br><span class="line"> <span class="built_in">let</span> CURRENT_NUM=<span class="variable">$&#123;CURRENT_NUM&#125;</span>+1</span><br><span class="line"> skopeo_copy <span class="variable">$&#123;SOURCE_REGISTRY&#125;</span>/<span class="variable">$&#123;image&#125;</span> <span class="variable">$&#123;TARGET_REGISTRY&#125;</span>/<span class="variable">$&#123;image&#125;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></p>
<p><strong>æ‰§è¡Œå‘½ä»¤å’Œç»“æœ:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ bash sync.sh docker.io localhost:5000</span><br><span class="line">Progress: 1/143 sync docker.io/alpine:3.14 to localhost:5000/alpine:3.14 successful</span><br><span class="line">Progress: 2/143 sync docker.io/busybox:1.31.1 to localhost:5000/busybox:1.31.1 successful</span><br><span class="line">....</span><br><span class="line">Progress: 142/143 sync docker.io/weaveworks/scope:1.13.0 to localhost:5000/weaveworks/scope:1.13.0 successful</span><br><span class="line">Progress: 143/143 sync docker.io/wordpress:4.8-apache to localhost:5000/wordpress:4.8-apache successful</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="2-ä½¿ç”¨-registry-å­˜å‚¨ç‰¹æ€§åŒæ­¥"><a href="#2-ä½¿ç”¨-registry-å­˜å‚¨ç‰¹æ€§åŒæ­¥" class="headerlink" title="2.ä½¿ç”¨ registry å­˜å‚¨ç‰¹æ€§åŒæ­¥"></a>2.ä½¿ç”¨ registry å­˜å‚¨ç‰¹æ€§åŒæ­¥</h3><p>æè¿°: å°†é•œåƒä» registry ä¸­åŒæ­¥åˆ°æœ¬åœ°ç›®å½•ï¼Œä½¿ç”¨ registry å­˜å‚¨çš„ç‰¹æ€§ï¼Œå°†æœ¬åœ°ç›®å½•ä¸­çš„é•œåƒè½¬æ¢æˆ registry å­˜å‚¨çš„æ ¼å¼, è¿™æ ·çš„å¥½å¤„å°±æ˜¯å¯ä»¥å»é™¤ä¸€äº› skopeo dir ä¸­é‡å¤çš„ layersï¼Œå‡å°‘é•œåƒçš„æ€»å¤§å°ã€‚</p>
<p>convert-images.sh<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -eo pipefail</span><br><span class="line"></span><br><span class="line">GREEN_COL=<span class="string">"\\033[32;1m"</span></span><br><span class="line">RED_COL=<span class="string">"\\033[1;31m"</span></span><br><span class="line">NORMAL_COL=<span class="string">"\\033[0;39m"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘½ä»¤è¡Œå‚æ•°</span></span><br><span class="line">SOURCE_REGISTRY=<span class="variable">$1</span></span><br><span class="line">TARGET_REGISTRY=<span class="variable">$2</span></span><br><span class="line">IMAGES_DIR=<span class="variable">$2</span></span><br><span class="line"></span><br><span class="line">: <span class="variable">$&#123;IMAGES_DIR:="images"&#125;</span></span><br><span class="line">: <span class="variable">$&#123;IMAGES_LIST_FILE:="images-list.txt"&#125;</span></span><br><span class="line">: <span class="variable">$&#123;SOURCE_REGISTRY:="docker.io"&#125;</span></span><br><span class="line">: <span class="variable">$&#123;TARGET_REGISTRY:="hub.k8s.li"&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hub.k8s.li ä»“åº“æœåŠ¡å™¨ä¸­çš„ç›®å½•</span></span><br><span class="line">BLOBS_PATH=<span class="string">"docker/registry/v2/blobs/sha256"</span></span><br><span class="line">REPO_PATH=<span class="string">"docker/registry/v2/repositories"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®°å½•å½“å‰æ•°å’Œæ€»é•œåƒæ•°</span></span><br><span class="line">CURRENT_NUM=0</span><br><span class="line">ALL_IMAGES=<span class="string">"<span class="variable">$(sed -n '/#/d;s/:/:/p' $&#123;IMAGES_LIST_FILE&#125; | sort -u)</span>"</span></span><br><span class="line">TOTAL_NUMS=$(<span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;ALL_IMAGES&#125;</span>"</span> | wc -l)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»è¿œç¨‹ä»“åº“åŒæ­¥æŒ‡å®šé•œåƒåˆ°æœ¬åœ°ç›®å½•ä¸­ã€‚</span></span><br><span class="line"><span class="function"><span class="title">skopeo_sync</span></span>() &#123;</span><br><span class="line"> <span class="keyword">if</span> skopeo sync --insecure-policy --src-tls-verify=<span class="literal">false</span> --dest-tls-verify=<span class="literal">false</span> \</span><br><span class="line"> --override-arch amd64 --override-os linux --src docker --dest dir <span class="variable">$1</span> <span class="variable">$2</span> &gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">"<span class="variable">$GREEN_COL</span> Progress: <span class="variable">$&#123;CURRENT_NUM&#125;</span>/<span class="variable">$&#123;TOTAL_NUMS&#125;</span> sync <span class="variable">$1</span> to <span class="variable">$2</span> successful <span class="variable">$NORMAL_COL</span>"</span></span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">"<span class="variable">$RED_COL</span> Progress: <span class="variable">$&#123;CURRENT_NUM&#125;</span>/<span class="variable">$&#123;TOTAL_NUMS&#125;</span> sync <span class="variable">$1</span> to <span class="variable">$2</span> failed <span class="variable">$NORMAL_COL</span>"</span></span><br><span class="line">  <span class="built_in">exit</span> 2</span><br><span class="line"> <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">convert_images</span></span>() &#123;</span><br><span class="line"> rm -rf <span class="variable">$&#123;IMAGES_DIR&#125;</span>; mkdir -p <span class="variable">$&#123;IMAGES_DIR&#125;</span></span><br><span class="line"> <span class="keyword">for</span> image <span class="keyword">in</span> <span class="variable">$&#123;ALL_IMAGES&#125;</span>; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">let</span> CURRENT_NUM=<span class="variable">$&#123;CURRENT_NUM&#125;</span>+1</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># å– images-list.txt æ–‡æœ¬ä¸­çš„æ¯ä¸€è¡Œï¼Œå¹¶åˆ†éš”å­˜å‚¨ã€‚</span></span><br><span class="line">  image_name=<span class="variable">$&#123;image%%:*&#125;</span></span><br><span class="line">  image_tag=<span class="variable">$&#123;image##*:&#125;</span></span><br><span class="line">  image_repo=<span class="variable">$&#123;image%%/*&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># å‡½æ•°è°ƒç”¨ ä»ä»“åº“åŒæ­¥é•œåƒåˆ°æœ¬åœ°imagesç›®å½•</span></span><br><span class="line">  skopeo_sync <span class="variable">$&#123;SOURCE_REGISTRY&#125;</span>/<span class="variable">$&#123;image&#125;</span> <span class="variable">$&#123;IMAGES_DIR&#125;</span>/<span class="variable">$&#123;image_repo&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># åœ¨æœ¬åœ°imagesç›®å½•ä¸­ï¼Œå–å¾—get image manifest sha256sum ä¿¡æ¯</span></span><br><span class="line">  manifest=<span class="string">"<span class="variable">$&#123;IMAGES_DIR&#125;</span>/<span class="variable">$&#123;image&#125;</span>/manifest.json"</span></span><br><span class="line">  manifest_sha256=$(sha256sum <span class="variable">$&#123;manifest&#125;</span> | awk <span class="string">'&#123;print $1&#125;'</span>)      <span class="comment"># 62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732dee</span></span><br><span class="line">  mkdir -p <span class="variable">$&#123;BLOBS_PATH&#125;</span>/<span class="variable">$&#123;manifest_sha256:0:2&#125;</span>/<span class="variable">$&#123;manifest_sha256&#125;</span> <span class="comment"># docker/registry/v2/blobs/sha256/62/62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732dee</span></span><br><span class="line">  ln -f <span class="variable">$&#123;manifest&#125;</span> <span class="variable">$&#123;BLOBS_PATH&#125;</span>/<span class="variable">$&#123;manifest_sha256:0:2&#125;</span>/<span class="variable">$&#123;manifest_sha256&#125;</span>/data  <span class="comment">#  è¯¥ data æ–‡ä»¶å®é™…ä¸Šæ˜¯é•œåƒçš„ manifest.json æ–‡ä»¶ã€‚</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># make image repositories dir</span></span><br><span class="line">  mkdir -p <span class="variable">$&#123;REPO_PATH&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/&#123;_uploads,_layers,_manifests&#125;</span><br><span class="line">  mkdir -p <span class="variable">$&#123;REPO_PATH&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_manifests/revisions/sha256/<span class="variable">$&#123;manifest_sha256&#125;</span></span><br><span class="line">  mkdir -p <span class="variable">$&#123;REPO_PATH&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_manifests/tags/<span class="variable">$&#123;image_tag&#125;</span>/&#123;current,index/sha256&#125;</span><br><span class="line">  mkdir -p <span class="variable">$&#123;REPO_PATH&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_manifests/tags/<span class="variable">$&#123;image_tag&#125;</span>/index/sha256/<span class="variable">$&#123;manifest_sha256&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># create image tag manifest link file</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"sha256:<span class="variable">$&#123;manifest_sha256&#125;</span>"</span> &gt; <span class="variable">$&#123;REPO_PATH&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_manifests/revisions/sha256/<span class="variable">$&#123;manifest_sha256&#125;</span>/link  <span class="comment"># sha256:62ffc2ed7554e4c6d360bce40bbcf196573dd27c4ce080641a2c59867e732deer</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"sha256:<span class="variable">$&#123;manifest_sha256&#125;</span>"</span> &gt; <span class="variable">$&#123;REPO_PATH&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_manifests/tags/<span class="variable">$&#123;image_tag&#125;</span>/current/link</span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"sha256:<span class="variable">$&#123;manifest_sha256&#125;</span>"</span> &gt; <span class="variable">$&#123;REPO_PATH&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_manifests/tags/<span class="variable">$&#123;image_tag&#125;</span>/index/sha256/<span class="variable">$&#123;manifest_sha256&#125;</span>/link</span><br><span class="line"></span><br><span class="line">  <span class="comment"># link image layers file to registry blobs dir</span></span><br><span class="line">  <span class="keyword">for</span> layer <span class="keyword">in</span> $(sed <span class="string">'/v1Compatibility/d'</span> <span class="variable">$&#123;manifest&#125;</span> | grep -Eo <span class="string">"\b[a-f0-9]&#123;64&#125;\b"</span>); <span class="keyword">do</span>  <span class="comment"># åŒ¹é… manifest.json ä¸­"digest"ä¸¤ä¸ªä¸å¸¦sha256çš„å€¼</span></span><br><span class="line">    mkdir -p <span class="variable">$&#123;BLOBS_PATH&#125;</span>/<span class="variable">$&#123;layer:0:2&#125;</span>/<span class="variable">$&#123;layer&#125;</span>                 <span class="comment"># 5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa ã€ beae173ccac6ad749f76713cf4440fe3d21d1043fe616dfbe30775815d1d0f6a</span></span><br><span class="line">    mkdir -p <span class="variable">$&#123;REPO_PATH&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_layers/sha256/<span class="variable">$&#123;layer&#125;</span>  <span class="comment"># 5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa ã€ beae173ccac6ad749f76713cf4440fe3d21d1043fe616dfbe30775815d1d0f6a</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">"sha256:<span class="variable">$&#123;layer&#125;</span>"</span> &gt; <span class="variable">$&#123;REPO_PATH&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_layers/sha256/<span class="variable">$&#123;layer&#125;</span>/link  <span class="comment"># sha256:5cc84ad355aaa64f46ea9c7bbcc319a9d808ab15088a27209c9e70ef86e5a2aa</span></span><br><span class="line">    ln -f <span class="variable">$&#123;IMAGES_DIR&#125;</span>/<span class="variable">$&#123;image&#125;</span>/<span class="variable">$&#123;layer&#125;</span> <span class="variable">$&#123;BLOBS_PATH&#125;</span>/<span class="variable">$&#123;layer:0:2&#125;</span>/<span class="variable">$&#123;layer&#125;</span>/data     <span class="comment"># å¤åˆ¶imagesç›®å½•ä¸­ "application/vnd.docker.container.image.v1+json" å®¹å™¨é…ç½® config ä¸ å¤šä¸ª "application/vnd.docker.image.rootfs.diff.tar.gzip" layer </span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">convert_images</span><br></pre></td></tr></table></figure></p>
<ul>
<li>install.sh : ä½¿ç”¨è¿™ä¸ªè„šæœ¬å°† registry å­˜å‚¨ä¸­çš„é•œåƒè½¬æ¢æˆ skopeo dir çš„æ–¹å¼ï¼Œç„¶åå†å°†é•œåƒåŒæ­¥åˆ° registry ä¸­ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">REGISTRY_DOMAIN=<span class="string">"harbor.k8s.li"</span></span><br><span class="line">REGISTRY_PATH=<span class="string">"/var/lib/registry"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ° registry å­˜å‚¨ä¸»ç›®å½•ä¸‹</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$&#123;REGISTRY_PATH&#125;</span></span><br><span class="line"><span class="function"><span class="title">gen_skopeo_dir</span></span>() &#123;</span><br><span class="line">   <span class="comment"># å®šä¹‰ registry å­˜å‚¨çš„ blob ç›®å½• å’Œ repositories ç›®å½•ï¼Œæ–¹ä¾¿åé¢ä½¿ç”¨</span></span><br><span class="line">    BLOB_DIR=<span class="string">"docker/registry/v2/blobs/sha256"</span></span><br><span class="line">    REPO_DIR=<span class="string">"docker/registry/v2/repositories"</span></span><br><span class="line">    <span class="comment"># å®šä¹‰ç”Ÿæˆ skopeo ç›®å½•</span></span><br><span class="line">    SKOPEO_DIR=<span class="string">"docker/skopeo"</span></span><br><span class="line">    <span class="comment"># é€šè¿‡ find å‡º current æ–‡ä»¶å¤¹å¯ä»¥å¾—åˆ°æ‰€æœ‰å¸¦ tag çš„é•œåƒï¼Œå› ä¸ºä¸€ä¸ª tag å¯¹åº”ä¸€ä¸ª current ç›®å½•</span></span><br><span class="line">    <span class="keyword">for</span> image <span class="keyword">in</span> $(find <span class="variable">$&#123;REPO_DIR&#125;</span> -<span class="built_in">type</span> d -name <span class="string">"current"</span>); <span class="keyword">do</span></span><br><span class="line">        <span class="comment"># æ ¹æ®é•œåƒçš„ tag æå–é•œåƒçš„åå­—</span></span><br><span class="line">        name=$(<span class="built_in">echo</span> <span class="variable">$&#123;image&#125;</span> | awk -F <span class="string">'/'</span> <span class="string">'&#123;print $5"/"$6":"$9&#125;'</span>)</span><br><span class="line">        link=$(cat <span class="variable">$&#123;image&#125;</span>/link | sed <span class="string">'s/sha256://'</span>)</span><br><span class="line">        mfs=<span class="string">"<span class="variable">$&#123;BLOB_DIR&#125;</span>/<span class="variable">$&#123;link:0:2&#125;</span>/<span class="variable">$&#123;link&#125;</span>/data"</span></span><br><span class="line">        <span class="comment"># åˆ›å»ºé•œåƒçš„ç¡¬é“¾æ¥éœ€è¦çš„ç›®å½•</span></span><br><span class="line">        mkdir -p <span class="string">"<span class="variable">$&#123;SKOPEO_DIR&#125;</span>/<span class="variable">$&#123;name&#125;</span>"</span></span><br><span class="line">        <span class="comment"># ç¡¬é“¾æ¥é•œåƒçš„ manifests æ–‡ä»¶åˆ°ç›®å½•çš„ manifest æ–‡ä»¶</span></span><br><span class="line">        ln <span class="variable">$&#123;mfs&#125;</span> <span class="variable">$&#123;SKOPEO_DIR&#125;</span>/<span class="variable">$&#123;name&#125;</span>/manifest.json</span><br><span class="line">        <span class="comment"># ä½¿ç”¨æ­£åˆ™åŒ¹é…å‡ºæ‰€æœ‰çš„ sha256 å€¼ï¼Œç„¶åæ’åºå»é‡</span></span><br><span class="line">        layers=$(grep -Eo <span class="string">"\b[a-f0-9]&#123;64&#125;\b"</span> <span class="variable">$&#123;mfs&#125;</span> | sort -n | uniq)</span><br><span class="line">        <span class="keyword">for</span> layer <span class="keyword">in</span> <span class="variable">$&#123;layers&#125;</span>; <span class="keyword">do</span></span><br><span class="line">          <span class="comment"># ç¡¬é“¾æ¥ registry å­˜å‚¨ç›®å½•é‡Œçš„é•œåƒ layer å’Œ images config åˆ°é•œåƒçš„ dir ç›®å½•</span></span><br><span class="line">            ln <span class="variable">$&#123;BLOB_DIR&#125;</span>/<span class="variable">$&#123;layer:0:2&#125;</span>/<span class="variable">$&#123;layer&#125;</span>/data <span class="variable">$&#123;SKOPEO_DIR&#125;</span>/<span class="variable">$&#123;name&#125;</span>/<span class="variable">$&#123;layer&#125;</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">sync_image</span></span>() &#123;</span><br><span class="line">    <span class="comment"># ä½¿ç”¨ skopeo sync å°† dir æ ¼å¼çš„é•œåƒåŒæ­¥åˆ° harbor</span></span><br><span class="line">    <span class="keyword">for</span> project <span class="keyword">in</span> $(ls <span class="variable">$&#123;SKOPEO_DIR&#125;</span>); <span class="keyword">do</span></span><br><span class="line">        skopeo sync --insecure-policy --src-tls-verify=<span class="literal">false</span> --dest-tls-verify=<span class="literal">false</span> \</span><br><span class="line">        --src dir --dest docker <span class="variable">$&#123;SKOPEO_DIR&#125;</span>/<span class="variable">$&#123;project&#125;</span> <span class="variable">$&#123;REGISTRY_DOMAIN&#125;</span>/<span class="variable">$&#123;project&#125;</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line">gen_skopeo_dir</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>æ¸©é¦¨æç¤º: æ­¤ç§æ–¹å¼æ˜¯æœ‰äº›å¤æ‚å¯¹äºå¤§é•œåƒçš„å¤åˆ¶æ˜¯æ¨èçš„, è€Œå¯¹äºä¸€äº›å°é•œåƒä¸”æ˜¾å¾—å¤šä½™ã€‚</p>
<p><br></p>
<h3 id="3-ä»-registry-å­˜å‚¨ä¸­-select-å‡ºé•œåƒè¿›è¡ŒåŒæ­¥"><a href="#3-ä»-registry-å­˜å‚¨ä¸­-select-å‡ºé•œåƒè¿›è¡ŒåŒæ­¥" class="headerlink" title="3.ä» registry å­˜å‚¨ä¸­ select å‡ºé•œåƒè¿›è¡ŒåŒæ­¥"></a>3.ä» registry å­˜å‚¨ä¸­ select å‡ºé•œåƒè¿›è¡ŒåŒæ­¥</h3><p>æè¿°: å…ˆå°†é•œåƒåŒæ­¥åˆ°ä¸€ä¸ª registry ä¸­ï¼Œå†å°†é•œåƒä» registry å­˜å‚¨ä¸­æå‡ºæ¥ï¼Œè¯¥ registry å¯ä»¥å½“ä½œä¸€ä¸ªé•œåƒå­˜å‚¨çš„æ± å­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Linux ä¸­ç¡¬é“¾æ¥çš„ç‰¹æ€§å°†é•œåƒâ€å¤åˆ¶â€ä¸€ä»½å‡ºæ¥ï¼Œç„¶åå†æ‰“ä¸€ä¸ª tar åŒ…, è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯æ¯æ¬¡æ‰“åŒ…é•œåƒçš„æ—¶å€™éƒ½èƒ½å¤ç”¨å†å²çš„é•œåƒæ•°æ®ï¼Œè€Œä¸”æ€§èƒ½æå¿«ã€‚</p>
<p>æ­¥éª¤ 01.å…ˆå°†é•œåƒåŒæ­¥åˆ°ä¸€ä¸ªå›ºå®šçš„ registry ä¸­ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bash skopeo-copy.sh docker.io localhost:5000</span><br></pre></td></tr></table></figure></p>
<p>æ­¥éª¤ 02.ä½¿ç”¨è¯¥è„šæœ¬å°†é•œåƒä» registry å­˜å‚¨ä¸­æå‡ºæ¥<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -eo pipefail</span><br><span class="line"><span class="comment"># å‘½ä»¤è¡Œå˜é‡</span></span><br><span class="line">IMAGES_LIST=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">REGISTRY_PATH=<span class="string">"<span class="variable">$2</span>"</span></span><br><span class="line">OUTPUT_DIR=<span class="string">"<span class="variable">$3</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Registry ä»“åº“æ•°æ®ç›®å½•</span></span><br><span class="line">BLOB_DIR=<span class="string">"docker/registry/v2/blobs/sha256"</span></span><br><span class="line">REPO_DIR=<span class="string">"docker/registry/v2/repositories"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ¤æ–­è¾“å‡ºç›®å½•æ˜¯å¦å­˜åœ¨å¦‚ä¸å­˜åœ¨åˆ™ç§»é™¤ã€‚</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="variable">$&#123;OUTPUT_DIR&#125;</span> ];<span class="keyword">then</span></span><br><span class="line">  rm -rf <span class="variable">$&#123;OUTPUT_DIR&#125;</span>;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">mkdir -p <span class="variable">$&#123;OUTPUT_DIR&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> image <span class="keyword">in</span> $(find <span class="variable">$&#123;IMAGES_LIST&#125;</span> -<span class="built_in">type</span> f -name <span class="string">"*.list"</span> | xargs grep -Ev <span class="string">'^#|^/'</span> | grep <span class="string">':'</span>); <span class="keyword">do</span></span><br><span class="line">  <span class="comment"># é•œåƒåç§°å’ŒTag</span></span><br><span class="line">  image_name=<span class="variable">$&#123;image%%:*&#125;</span></span><br><span class="line">  image_tag=<span class="variable">$&#123;image##*:&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># link è·¯å¾„è·å–</span></span><br><span class="line">  tag_link=<span class="variable">$&#123;REGISTRY_PATH&#125;</span>/<span class="variable">$&#123;REPO_DIR&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_manifests/tags/<span class="variable">$&#123;image_tag&#125;</span>/current/link</span><br><span class="line">  manifest_sha256=$(sed <span class="string">'s/sha256://'</span> <span class="variable">$&#123;tag_link&#125;</span>)</span><br><span class="line">  manifest=<span class="variable">$&#123;REGISTRY_PATH&#125;</span>/<span class="variable">$&#123;BLOB_DIR&#125;</span>/<span class="variable">$&#123;manifest_sha256:0:2&#125;</span>/<span class="variable">$&#123;manifest_sha256&#125;</span>/data</span><br><span class="line">  mkdir -p <span class="variable">$&#123;OUTPUT_DIR&#125;</span>/<span class="variable">$&#123;BLOB_DIR&#125;</span>/<span class="variable">$&#123;manifest_sha256:0:2&#125;</span>/<span class="variable">$&#123;manifest_sha256&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># å¼ºåˆ¶ç¡¬é“¾æ¥åˆ°æŒ‡å®šç›®å½•</span></span><br><span class="line">  ln -f <span class="variable">$&#123;manifest&#125;</span> <span class="variable">$&#123;OUTPUT_DIR&#125;</span>/<span class="variable">$&#123;BLOB_DIR&#125;</span>/<span class="variable">$&#123;manifest_sha256:0:2&#125;</span>/<span class="variable">$&#123;manifest_sha256&#125;</span>/data</span><br><span class="line"></span><br><span class="line">  <span class="comment"># make image repositories dir</span></span><br><span class="line">  mkdir -p <span class="variable">$&#123;OUTPUT_DIR&#125;</span>/<span class="variable">$&#123;REPO_DIR&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/&#123;_uploads,_layers,_manifests&#125;</span><br><span class="line">  mkdir -p <span class="variable">$&#123;OUTPUT_DIR&#125;</span>/<span class="variable">$&#123;REPO_DIR&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_manifests/revisions/sha256/<span class="variable">$&#123;manifest_sha256&#125;</span></span><br><span class="line">  mkdir -p <span class="variable">$&#123;OUTPUT_DIR&#125;</span>/<span class="variable">$&#123;REPO_DIR&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_manifests/tags/<span class="variable">$&#123;image_tag&#125;</span>/&#123;current,index/sha256&#125;</span><br><span class="line">  mkdir -p <span class="variable">$&#123;OUTPUT_DIR&#125;</span>/<span class="variable">$&#123;REPO_DIR&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_manifests/tags/<span class="variable">$&#123;image_tag&#125;</span>/index/sha256/<span class="variable">$&#123;manifest_sha256&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># create image tag manifest link file  </span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"sha256:<span class="variable">$&#123;manifest_sha256&#125;</span>"</span> &gt; <span class="variable">$&#123;OUTPUT_DIR&#125;</span>/<span class="variable">$&#123;REPO_DIR&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_manifests/tags/<span class="variable">$&#123;image_tag&#125;</span>/current/link</span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"sha256:<span class="variable">$&#123;manifest_sha256&#125;</span>"</span> &gt; <span class="variable">$&#123;OUTPUT_DIR&#125;</span>/<span class="variable">$&#123;REPO_DIR&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_manifests/revisions/sha256/<span class="variable">$&#123;manifest_sha256&#125;</span>/link</span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">"sha256:<span class="variable">$&#123;manifest_sha256&#125;</span>"</span> &gt; <span class="variable">$&#123;OUTPUT_DIR&#125;</span>/<span class="variable">$&#123;REPO_DIR&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_manifests/tags/<span class="variable">$&#123;image_tag&#125;</span>/index/sha256/<span class="variable">$&#123;manifest_sha256&#125;</span>/link</span><br><span class="line"></span><br><span class="line">  <span class="comment"># å¼ºåˆ¶åˆ›å»º /docker/registry/v2/blobs/ å„ layer data æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ä¹‹ä¸­</span></span><br><span class="line">  <span class="keyword">for</span> layer <span class="keyword">in</span> $(sed <span class="string">'/v1Compatibility/d'</span> <span class="variable">$&#123;manifest&#125;</span> | grep -Eo <span class="string">'\b[a-f0-9]&#123;64&#125;\b'</span> | sort -u); <span class="keyword">do</span></span><br><span class="line">      mkdir -p <span class="variable">$&#123;OUTPUT_DIR&#125;</span>/<span class="variable">$&#123;BLOB_DIR&#125;</span>/<span class="variable">$&#123;layer:0:2&#125;</span>/<span class="variable">$&#123;layer&#125;</span></span><br><span class="line">      mkdir -p <span class="variable">$&#123;OUTPUT_DIR&#125;</span>/<span class="variable">$&#123;REPO_DIR&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_layers/sha256/<span class="variable">$&#123;layer&#125;</span></span><br><span class="line">      ln -f <span class="variable">$&#123;BLOB_DIR&#125;</span>/<span class="variable">$&#123;layer:0:2&#125;</span>/<span class="variable">$&#123;layer&#125;</span>/data <span class="variable">$&#123;OUTPUT_DIR&#125;</span>/<span class="variable">$&#123;BLOB_DIR&#125;</span>/<span class="variable">$&#123;layer:0:2&#125;</span>/<span class="variable">$&#123;layer&#125;</span>/data</span><br><span class="line">      <span class="built_in">echo</span> -n <span class="string">"sha256:<span class="variable">$&#123;layer&#125;</span>"</span> &gt; <span class="variable">$&#123;OUTPUT_DIR&#125;</span>/<span class="variable">$&#123;REPO_DIR&#125;</span>/<span class="variable">$&#123;image_name&#125;</span>/_layers/sha256/<span class="variable">$&#123;layer&#125;</span>/link</span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></p>

        </div>
        <!-- Google å¹¿å‘Š -->
        
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
  

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-03-29T05:39:03.676Z" itemprop="dateUpdated">2022-03-29 13:39:03</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Harbor/Skopeoå¦‚ä½•ä¼˜é›…çš„åšä¸€ä¸ªé•œåƒæ¬è¿å·¥.md" target="_blank" rel="noopener noreferrer">_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Harbor/Skopeoå¦‚ä½•ä¼˜é›…çš„åšä¸€ä¸ªé•œåƒæ¬è¿å·¥.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2022/1-20-584.html" target="_blank" rel="external">https://blog.weiyigeek.top/2022/1-20-584.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Harbor/" rel="tag">Harbor</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Skopeo/" rel="tag">Skopeo</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2022/1-20-584.html&title=ã€Šå¦‚ä½•ä½¿ç”¨Skopeoåšä¸€ä¸ªä¼˜é›…çš„é•œåƒæ¬è¿å·¥ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2022/1-20-584.html&title=ã€Šå¦‚ä½•ä½¿ç”¨Skopeoåšä¸€ä¸ªä¼˜é›…çš„é•œåƒæ¬è¿å·¥ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2022/1-20-584.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Šå¦‚ä½•ä½¿ç”¨Skopeoåšä¸€ä¸ªä¼˜é›…çš„é•œåƒæ¬è¿å·¥ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2022/1-20-584.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2022/1-20-584.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2022/2-25-668.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">ä½¿ç”¨Kuberneteså®¹å™¨å¿«é€Ÿéƒ¨ç½²å¸¸ç”¨æœåŠ¡</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2022/1-17-634.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Apache Log4j2 æ—¥å¿—è®°å½•æœåŠ¡ä¹‹è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´å®è·µä¸é˜²æŠ¤</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-åŸºç¡€ä»‹ç»"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 åŸºç¡€ä»‹ç»</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-å®‰è£…ç¼–è¯‘"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 å®‰è£…ç¼–è¯‘</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-æºç ç¼–è¯‘ï¼ˆé™æ€ï¼‰"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">1.æºç ç¼–è¯‘ï¼ˆé™æ€ï¼‰</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-åˆ†å‘åŒ…å®‰è£…"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">2.åˆ†å‘åŒ…å®‰è£…</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-å®¹å™¨å®‰è£…è¿è¡Œ"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">3.å®¹å™¨å®‰è£…è¿è¡Œ</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-å¿«é€Ÿä¸Šæ‰‹"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 å¿«é€Ÿä¸Šæ‰‹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-å‘½ä»¤æµ…æ"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">1.å‘½ä»¤æµ…æ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-Skopeoåˆä½“éªŒ"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">2.Skopeoåˆä½“éªŒ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Skopeo-login-loout-è¿œç¨‹ä»“åº“-Auth"><span class="post-toc-number">3.2.1.</span> <span class="post-toc-text">Skopeo login&#x2F;loout - è¿œç¨‹ä»“åº“ Auth</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Skopeo-inspect-æ£€æŸ¥å­˜å‚¨åº“ä¸­çš„é•œåƒ"><span class="post-toc-number">3.2.2.</span> <span class="post-toc-text">Skopeo inspect - æ£€æŸ¥å­˜å‚¨åº“ä¸­çš„é•œåƒ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Skopeo-copy-ä»“åº“é•œåƒæ‹·è´"><span class="post-toc-number">3.2.3.</span> <span class="post-toc-text">Skopeo copy - ä»“åº“é•œåƒæ‹·è´</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Skopeo-sync-é•œåƒåŒæ­¥å‘½ä»¤"><span class="post-toc-number">3.2.4.</span> <span class="post-toc-text">Skopeo sync - é•œåƒåŒæ­¥å‘½ä»¤</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Skopeo-list-tags-ä»“åº“ä¸­é•œåƒtagæŸ¥çœ‹"><span class="post-toc-number">3.2.5.</span> <span class="post-toc-text">Skopeo list-tags - ä»“åº“ä¸­é•œåƒtagæŸ¥çœ‹</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Skopeo-delete-åˆ é™¤ä»“åº“ä¸­é•œåƒTag"><span class="post-toc-number">3.2.6.</span> <span class="post-toc-text">Skopeo delete - åˆ é™¤ä»“åº“ä¸­é•œåƒTag</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x03-é•œåƒåŒæ­¥æœ€ä½³å®è·µ"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 é•œåƒåŒæ­¥æœ€ä½³å®è·µ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-æŒ‡å®šæ–‡æœ¬ä¸­é•œåƒåŒæ­¥"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">1.æŒ‡å®šæ–‡æœ¬ä¸­é•œåƒåŒæ­¥</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-ä½¿ç”¨-registry-å­˜å‚¨ç‰¹æ€§åŒæ­¥"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">2.ä½¿ç”¨ registry å­˜å‚¨ç‰¹æ€§åŒæ­¥</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-ä»-registry-å­˜å‚¨ä¸­-select-å‡ºé•œåƒè¿›è¡ŒåŒæ­¥"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">3.ä» registry å­˜å‚¨ä¸­ select å‡ºé•œåƒè¿›è¡ŒåŒæ­¥</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    


    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      

    <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
    
      <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
        
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">ä¸ªäººGithub</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">ä¸ªäººGitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">ä¸ªäººçŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘+äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2022/1-20-584.html&title=ã€Šå¦‚ä½•ä½¿ç”¨Skopeoåšä¸€ä¸ªä¼˜é›…çš„é•œåƒæ¬è¿å·¥ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2022/1-20-584.html&title=ã€Šå¦‚ä½•ä½¿ç”¨Skopeoåšä¸€ä¸ªä¼˜é›…çš„é•œåƒæ¬è¿å·¥ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2022/1-20-584.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Šå¦‚ä½•ä½¿ç”¨Skopeoåšä¸€ä¸ªä¼˜é›…çš„é•œåƒæ¬è¿å·¥ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2022/1-20-584.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2022/1-20-584.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMElEQVR42u3aQW7DMAwF0dz/0u62Rep4Pmm3EDVaFU0s62VBUCRfL7yOb4t8eryts6f4W25YMmTIWJZxfFyfv8MxZ0d//z957y/7yJAhYwMG37oG+/ydDluGDBky0iBIjkV+IBkyZMi4i0H24U/9W8CVIUPGIgwSOknCxwtt5KlH7uIyZMhYkMGr7n//9yP9DRkyZCzFOMJFeOTi2j/Jjz1lyJAxmsEDHEkWa4dGF1SygwwZMjZjpEMV6UHTsh0q7cmQIWM0497hiVrRn5f5Ln4mGTJkDGXwcnx63FrDsvZeGTJkzGbwj2ub3lW247vJkCFjHqM23MAPVCvb8T1lyJAxm8FHHPoDW7VmAHpKhgwZGzA6ZTVeRCPNAJ4Ins6MyJAhYxyjP05RC9nk2VoIliFDxjxGJx1ML8Bpoe2GBoAMGTLGMdKAWBvzSpM/BJYhQ8YGDH6JTRfKSWtd1toNWIYMGcsy+qGzUyZLx8IuWpgyZMgYx0hTtPTTWvKXjmjIkCFjB0a/xcjTyrTNGVytZciQsQGj1rzstzZ50nnxI8qQIWMbBm86BoV7HNY7tTUZMmRMZfQL/Z2D8rB+EXxlyJAxmpGGuVqhLa38pUmqDBkydmDEha1SUyFtUpL0NM5wZciQsTiDB750nCtNE4ujYzJkyJCRjmc1Gpxpu0KGDBky+IHIbulFlwxkyJAhYx9G2gwgW3fC64PlNhkyZCzIaE1qlFoLaSmtM3AmQ4aMxRlfoMbwLtYaCdMAAAAASUVORK5CYII=" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>