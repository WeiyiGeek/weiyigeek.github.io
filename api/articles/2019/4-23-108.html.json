{"title":"Windows下Email安装配置与发信","slug":"系统运维/Application/Email/Windows下Email安装配置与发信","date":"2019-04-23T11:35:30.000Z","updated":"2023-01-31T02:29:10.470Z","url":"2019/4-23-108.html","path":"api/articles/2019/4-23-108.html.json","covers":["https://img.weiyigeek.top/2020/1/20200610105130.png","https://img.weiyigeek.top/2020/1/20200610110925.png","https://img.weiyigeek.top/2020/1/20200610111519.png","https://img.weiyigeek.top/2020/1/20200610172839.png","https://img.weiyigeek.top/2020/1/20200610174303.png","https://img.weiyigeek.top/2020/1/20200610223029.png","https://img.weiyigeek.top/2020/1/20200610225731.png","https://img.weiyigeek.top/2020/1/20200611103910.png","https://img.weiyigeek.top/2020/1/20200611131647.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-简述前言\"><a href=\"#0x00-简述前言\" class=\"headerlink\" title=\"0x00 简述前言\"></a>0x00 简述前言</h4><p>描述:最近正好在学邮件发信与激活的小程序开发，顺便把邮箱发信的基础知识理一理方便后续的开发工作以及安全相关的一些知识;</p>\n<h5 id=\"1-邮箱简述\"><a href=\"#1-邮箱简述\" class=\"headerlink\" title=\"1.邮箱简述\"></a>1.邮箱简述</h5><p>Q:什么是邮件服务器?<br>答:它可以类似于现实生活中的邮局投递用户的邮件，电子邮件是Intenet基本服务之一，它主要负责接收用户投递过来的邮件，并把邮件投递到邮件接收者的电子邮箱，但是前提是需要在服务器上安装相应的邮件服务器应用; 使用电子邮件系统可以实现不受时间和空间限制的信息传递额交流；</p>\n<ul>\n<li>常见的邮件服务提供商: <code>Sina , QQ , 163 / 126 , Foxmail, 189, aliyun ，Outlook，Gmail</code> 等等;</li>\n<li>邮件服务器:按照提供的服务类型可以分为<code>发送邮件的服务器</code>和<code>接收邮件的服务器</code>。</li>\n</ul>\n<p><br></p>\n<p>Q:什么是电子邮箱?<br>答:即我们在邮件服务提供商或者说是邮件服务器上申请建立的一个账户（相当于收货地址），并且为每一个用户分配一定的空间用于保存发送的电子邮件和接收到的电子邮件;</p>\n<p><br></p>\n<p>Q:如何搭建自己的邮件服务器?需要那些技术?<br>答:这将是本文的核心思想，从下面的基础实例中的可以从搭建到使用。<br>邮件服务器需求:</p>\n<ul>\n<li>服务器</li>\n<li>邮件服务端(易邮)和客户端(foxmail)</li>\n<li>域名(DNS / A / MX / CNAME)</li>\n</ul>\n<p><em>什么是 A 记录？</em></p>\n<ul>\n<li>A （Address） 记录是用来指定主机名（或域名）对应的 IP 地址记录。用户可以将该域名下的主机名（二级域名）指向到自己的 服务器上。</li>\n</ul>\n<p><em>什么是别名记录（CNAME）？</em></p>\n<ul>\n<li>也被称为规范名字。这种记录允许您将多个名字映射到同一台计算机。 通常用于同时提供 WWW 和 MAIL 服务的计算机。例如，有一台计算机名为“host.mydomain.com”（A记录）。 它同时提供 WWW 和 MAIL 服务，为了便于用户访问服务。可以为该计算机设置两个别名（CNAME）：WWW 和 MAIL。 这两个别名的全称就是“<a href=\"http://www.mydomain.com”和“mail.mydomain.com”。实际上他们都指向“host.mydomain.com”。\" target=\"_blank\" rel=\"noopener\">www.mydomain.com”和“mail.mydomain.com”。实际上他们都指向“host.mydomain.com”。</a></li>\n</ul>\n<p><em>什么是 MX 记录？(重点)</em></p>\n<ul>\n<li>MX（Mail Exchanger）记录是邮件交换记录，它指向一个邮件服务器，用于电子邮件系统发邮件时根据收信人的地址后缀来定位邮件服务器。例如，当 Internet 上的某用户要发一封信给 <a href=\"mailto:user@mydomain.com\">user@mydomain.com</a> 时，该用户的邮件系统通过 DNS 查找 mydomain.com 这个域名的 MX 记录，如果 MX 记录存在， 用户计算机就将邮件发送到MX记录所指定的邮件服务器上。</li>\n</ul>\n<p><br></p>\n<p><strong>Q:邮件协议的介绍:</strong><br>描述:邮件协议作用是约定了邮件在网络中传输格式，便于接收发送邮件双方可以正常看到对方所发的信息(<code>实际上是解码</code>)<br>常用的邮件协议有两种(发送和接收):</p>\n<p><em>发送:</em></p>\n<ul>\n<li>SMTP 协议－发邮件协议,全称为 Simple Mail Transfer Protoco（简单邮件传输协议），它定义了邮件客户端软件与 SMTP<br>服务器之间、以及两台 SMTP 服务器之间的通讯规则。<ul>\n<li>SMTP 协议属于 TCP/IP 协议簇，它帮助每台计算机在发送或中转信件时找到下一个目的地。SMTP 服务器就是遵循 SMTP 协议的发送邮件服务器。</li>\n<li>SMTP 认证简单地说就是要求必须在提供了账户名和密码之后才可以登录 SMTP 服务器,增加 SMTP 认证的目的是为了使用户避免受到垃圾邮件的侵扰。</li>\n<li>端口: 465/994 , 25<br><em>接收:</em></li>\n</ul>\n</li>\n<li><p>POP3 协议-收邮件协议,全称为<code>Post Office Protocol</code>（邮局协议）即第3个版本，它定义了邮件客户端软件与 POP3 服务器的通讯规<br>则。</p>\n<ul>\n<li>它是因特网电子邮件的第一个离线协议标准,POP3允许用户从服务器上把邮件存储到本地主机（即自己的计算机）上,同时删除保存在邮件服务器上的邮件而POP3服务器则是遵循POP3协议的接收邮件服务器，用来接收电子邮件的。</li>\n<li>端口: 995, 110</li>\n</ul>\n</li>\n<li><p>IMAP 协议-交互式存取邮件协议,全称是 <code>Internet Mail Access Protocol</code>，它是跟POP3类似邮件访问标准协议之一。</p>\n<ul>\n<li>开启了IMAP后您在电子邮件客户端收取的邮件仍然保留在服务器上，同时在客户端上的<code>操作都会反馈到服务器</code>上，如：<code>删除邮件，标记已读等，服务器上的邮件也会做相应的动</code>作。所以无论从浏览器登录邮箱或者客户端软件登录邮箱，看到的邮件以及状态都是一致的。</li>\n<li>端口: 993, 143<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200610105130.png\" alt=\"WeiyiGeek.协议端口信息\" title=\"\" class=\"\">\n                <p>WeiyiGeek.协议端口信息</p>\n            </figure>\n</li>\n</ul>\n</li>\n</ul>\n<p><em>总结:</em></p>\n<ul>\n<li>1.POP3 与 IMAP 的区别?<blockquote>\n<p>POP3协议允许电子邮件客户端下载服务器上的邮件，但是在客户端的操作（如移动邮件、标记已读等），不会反馈到服务器上。<br>IMAP协议提供与电子邮件客户端之间的双向通信，客户端的操作都会反馈到服务器上，对邮件进行的操作服务器上的邮件也会做相应的动作。同时它也像pop3支持邮件下载服务，让用户进行离线阅读; 它还提供的摘要浏览功能可以让你在阅读完所有的邮件到达时间、主题、发件人、大小等信息后才作出是否下载的决定，更好地支持了从多个不同设备中随时访问新邮件。<br>总之IMAP 整体上为用户带来更为<code>便捷和可靠的体验</code>。POP3 更易<code>丢失邮件或多次下载相同的邮件</code>，但 IMAP 通过邮件客户端与webmail 之间的双向同步功能很好地避免了这些问题。</p>\n</blockquote>\n</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200610110925.png\" alt=\"WeiyiGeek.区别对应\" title=\"\" class=\"\">\n                <p>WeiyiGeek.区别对应</p>\n            </figure>\n<p><br></p>\n<p><strong>邮箱发送流程</strong><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200610111519.png\" alt=\"WeiyiGeek.发送流程\" title=\"\" class=\"\">\n                <p>WeiyiGeek.发送流程</p>\n            </figure></p>\n<p><br></p>\n<h5 id=\"2-MIME的编码\"><a href=\"#2-MIME的编码\" class=\"headerlink\" title=\"2.MIME的编码\"></a>2.MIME的编码</h5><p>描述:说到邮件就不得不提到MIME的编码介绍(base64)及使用的意义</p>\n<p><strong>2.1 MIME: Multipurpose Internet Mail Extensions</strong><br>描述:英国帝国大学计算机在线字典FOLDOC对MIME的解释为:<code>多部分(multi-part)、多媒体电子邮件和WWW超文本的一种编码标准，用于传送诸如图形、声音和传真等非文本数据。MIME定义于RFC1341，用MIMENCODE的方法将二进制数据转换成为一种被称为BASE64的ASCII子集的字符的组合。</code></p>\n<p>Internet上有专门讨论MIME的新闻组:<a href=\"http://www.cis.ohio-state.edu/hypertext/faq/usenet/mail/mime-faq/mime0/faq.html\" target=\"_blank\" rel=\"noopener\">comp.mail.mime</a></p>\n<ul>\n<li>MIMENCODE最早称为MMENCODE提出用MIMENCODE代替UUENCODE，是因为UUENCODE使用了一些字符在一些邮件网关（特别是那些转换ASCII和EBCDIC码的网关）中造成传输障碍,（还有一些软件不能对所有 UUENCODE 的算法进行正确解码而导致邮件的阅读困难），因此 MIME 被设计用于替代UUENCODE，但是结果是这些协议共存。</li>\n<li>在MIME出台之前，使用RFC 822只能发送基本的ASCII码文本信息，邮件内容如果要包括二进制文件、声音和动画等，实现起来非常困难。MIME提供了一种可以在邮件中附加多种不同编码文件的方法，弥补了原来的信息格式的不足。实际上不仅仅是邮件编码，现在MIME经成为HTTP协议标准的一个部分 。</li>\n</ul>\n<p><strong>2.2 MIME编码方式简介</strong><br>描述:对邮件进行编码最初的原因是因为 Internet 上的很多网关不能正确传输8bit内码的字符，比如汉字等。编码的原理就是把8bit的内容转换成7bit的形式以能正确传输，在接收方收到之后，再将其还原成8bit的内容。</p>\n<p>在MIME协议之前，邮件的编码曾经有过UUENCODE等编码方式 ，但是由于MIME协议算法简单，并且易于扩展，现在已经成为邮件编码方式的主流，不仅是用来传输8bit的字符，也可以用来传送二进制的文件，如邮件附件中的图像、音频等信息，而且扩展了很多基于MIME 的应用。<br>从编码方式来说，MIME定义了两种编码方法<code>Base64与QP(Quote-Printable)</code>。</p>\n<ul>\n<li><p>1.Base64编码<br>描述:Base64是一种通用的方法，其原理很简单，就是把三个Byte的数据用4个Byte表示。在这四个Byte中，实际用到的都只有前面6bit，这样就不存在只能传输7bit的字符的问题了。Base64的缩写一般是B。<br>Base64将输入的字符串或一段数据编码成只含有{‘A’-‘Z’, ‘a’-‘z’, ‘0’-‘9’, ‘+’, ‘/‘}这64个字符的串，’=’用于填充。<br>其编码的方法是，将输入数据流每次取6bit，用此6bit的值(0-63)作为索引去查表，输出相应字符。<br>这样每3个字节将编码为4个字符(3×8 → 4×6)；不满4个字符的以’=’填充。<br>有的场合，以<code>“=?charset?B?xxxxxxxx?=”</code>表示xxxxxxxx是Base64编码，且原文的字符集是charset。在段体内则直接编码，适当时机换行，MIME建议每行最多76个字符。<br>Base64的算法很简单，它将字符流顺序放入一个24位的缓冲区，缺字符的地方补零。<br>然后将缓冲区截断成为4个部分，高位在先，每个部分6位，用64个字符重新表示。如果输入只有一个或两个字节，那么输出将用等号“=”补足。这可以隔断附加的信息造成编码的混乱。</p>\n</li>\n<li><p>2.QP编码<br>描述:另一种方法是QP(Quote-Printable) 方法，通常缩写为“Q”方法，其原理是把一个8bit的字符用两个16进制数值表示，然后在前面加“=”。所以我们看到经过QP编码后的文件通常是这个样子：<code>=B3=C2=BF=A1=C7=E5=A3= AC=C4=FA=BA=C3=A3=A1</code>。<br>Quoted-printable根据输入的字符串或字节范围进行编码，若是不需编码的字符直接输出。若需要编码则先输出’=’后面跟着以2个字符表示的十六进制字节值。有的场合以<code>“=?charset?Q?xxxxxxxx?=”</code>表示xxxxxxxx是Quoted-printable编码，且原文的字符集是charset。在段体内则直接编码适当时机换行，换行前额外输出一个’=’。</p>\n</li>\n</ul>\n<p><strong>2.3MIME的头信息</strong><br>描述:邮件头在邮件头中有很多从RFC 822沿用的域名MIME也增加了一些。</p>\n<p>常见的标准域名和含义如下:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#域名                           含义               添加者</span></span><br><span class=\"line\">Received                      传输路径            各级邮件服务器</span><br><span class=\"line\">Return-Path                   回复地址            目标邮件服务器</span><br><span class=\"line\">Delivered-To                  发送地址            目标邮件服务器</span><br><span class=\"line\">Reply-To                      回复地址            邮件的创建者</span><br><span class=\"line\">From                          发件人地址          邮件的创建者</span><br><span class=\"line\">To                            收件人地址          邮件的创建者</span><br><span class=\"line\">Cc                            抄送地址            邮件的创建者</span><br><span class=\"line\">Bcc                           暗送地址            邮件的创建者</span><br><span class=\"line\">Date                          日期和时间          邮件的创建者</span><br><span class=\"line\">Subject                       主题               邮件的创建者</span><br><span class=\"line\">Message-ID                    消息ID             邮件的创建者</span><br><span class=\"line\">MIME-Version                  MIME版本           邮件的创建者</span><br><span class=\"line\">Content-Type                  内容的类型          邮件的创建者</span><br><span class=\"line\">Content-Transfer-Encoding     内容的传输编码方式   邮件的创建者</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#非标准的、自定义域名都以X-开头，例如X-Mailer, X-MSMail-Priority等，通常在接收和发送邮件的是同一程序时才能理解它们的意义。</span></span><br><span class=\"line\">段头</span><br><span class=\"line\"><span class=\"comment\">#在段头中，大致有如下一些域:</span></span><br><span class=\"line\"><span class=\"comment\">#域名                               含义</span></span><br><span class=\"line\">Content-Type                      段体的类型</span><br><span class=\"line\">Content-Transfer-Encoding         段体的传输编码方式</span><br><span class=\"line\">Content-Disposition               段体的安排方式</span><br><span class=\"line\">Content-ID                        段体的ID</span><br><span class=\"line\">Content-Location                  段体的位置(路径)</span><br><span class=\"line\">Content-Base                      段体的基位置</span><br><span class=\"line\">有的域除了值之外，还带有参数。值与参数、参数与参数之间以“;”分隔。参数名与参数值之间以“=”分隔。</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li>1.MIME-Version: 表示使用的MIME的版本号，一般是1.0;如:MIME-Version: 1.0</li>\n<li><p>2.Content-Type: 定义了正文的类型(“主类型/子类型”的形式)，我们实际上是通过这个标识来知道正文内是什么类型的文件。比如text/plain 表示的是无格式的文本正文，text/html 表示的 Html 文档，image/gif 表示的是 gif 格式的图片等等。</p>\n<ul>\n<li>主类型有text, image, audio, video, application, multipart, message等，分别表示文本、图片、音频、视频、应用、分段、消息等。</li>\n<li>子类型:每个主类型都可能有多个子类型，如text类型就包含plain, html, xml, css等子类型</li>\n<li>Tips:以X-开头的主类型和子类型，同样表示自定义的类型，未向IANA正式注册，但大多已经约定成俗了。如application/x-zip-compressed是ZIP文件类型。</li>\n<li>Tips:在Windows中注册表的”HKEY_CLASSES_ROOT/MIME/Database/Content Type”内列举了除multipart之外大部分已知的Content-Type。</li>\n</ul>\n</li>\n<li><p>3.关于参数的形式，RFC里有很多补充规定，有的允许带几个参数，较为常见的有:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">主类型           参数名           含义</span><br><span class=\"line\">text            charset         字符集</span><br><span class=\"line\">image           name            名称</span><br><span class=\"line\">application     name            名称</span><br><span class=\"line\">multipart       boundary        边界</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>4.multipart类型:邮件中常用到的复合类型,该类型表示正文是由多个部分组成的，后面的子类型说明的是这些部分之间的关系。<br> 邮件中用到的三个类型有:</p>\n<ul>\n<li>(1).multipart/alternative：表示正文由两个部分组成，可以选择其中的任意一个。主要作用是在征文同时有text格式和html格式时，可以在两个正文中选择一个来显示，支持 html 格式的邮件客户端软件一般会显示其 HTML 正文，而不支持的则会显示其Text正文；</li>\n<li>(2).multipart/related：表示文档的多个部分是相关的，一般用来描述 Html 正文与其相关的图片。</li>\n<li>(3).multipart/mixed：表示文档的多个部分是混合的，指正文与附件的关系。如果邮件的MIME类型是multipart/mixed，即表示邮件带有附件。</li>\n<li>Tips:multipart类型是MIME邮件的精髓。邮件体被分为多个段，每个段又包含段头和段体两部分，这两部分之间也以空行分隔。<br>它们之间的层次关系可归纳为下图所示：<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+------------------------- multipart/mixed ----------------------------+</span><br><span class=\"line\">|                                                                       |</span><br><span class=\"line\">|   +----------------- multipart/related ------------------+             |</span><br><span class=\"line\">|   |                                                       |             |</span><br><span class=\"line\">|   |   +----- multipart/alternative ------+   +----------+   |   +------+   |</span><br><span class=\"line\">|   |   |                                   |   | 内嵌资源   |   |   | 附件 |   |</span><br><span class=\"line\">|   |   |   +------------+   +------------+   |   +----------+   |   +------+   |</span><br><span class=\"line\">|   |   |   | 纯文本正文 |   | 超文本正文 |   |                 |              |</span><br><span class=\"line\">|   |   |   +------------+   +------------+   |   +----------+   |   +------+   |</span><br><span class=\"line\">|   |   |                                   |   | 内嵌资源   |   |   | 附件 |   |</span><br><span class=\"line\">|   |   +----------------------------------+   +----------+   |   +------+   |</span><br><span class=\"line\">|   |                                                       |             |</span><br><span class=\"line\">|   +------------------------------------------------------+             |</span><br><span class=\"line\">|                                                                       |</span><br><span class=\"line\">+----------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>\n补充总结:从层次关系中可以看出，如果在邮件中要添加附件必须定义multipart/mixed段；如果存在内嵌资源至少要定义multipart/related段；如果纯文本与超文本共存至少要定义multipart/alternative段。</li>\n</ul>\n</li>\n</ul>\n<p><em>什么是“至少”？</em><br>答:如果只有纯文本与超文本正文，那么在邮件头中将类型扩大化，定义为multipart/related，甚至multipart/mixed，都是允许的。<br>multipart诸类型的共同特征是，在段头指定“boundary”参数字符串，段体内的每个子段以此串定界。<code>所有的子段都以--+boundary行开始，父段则以--+boundary+--行结束</code>。段与段之间也以空行分隔。在邮件体是multipart类型的情况下，邮件体的开始部分(第一个“–” +boundary行之前)可以有一些附加的文本行，相当于注释，解码时应忽略。段间也可以有一些附加的文本行，不会显示出来。</p>\n<p>些复合类型又是可以嵌套使用的，比如说一个带有附件的邮件，同时有html与text两种格式的正文，则邮件的结构是：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Content-Type: multipart/mixed</span><br><span class=\"line\">部分一：</span><br><span class=\"line\"></span><br><span class=\"line\">Content Type : multipart/alternative：</span><br><span class=\"line\">Text 正文；</span><br><span class=\"line\">Html 格式的正文　</span><br><span class=\"line\">部分二：</span><br><span class=\"line\">附件</span><br><span class=\"line\">邮件结束符；</span><br></pre></td></tr></table></figure><br>由于复合类型由多个部分组成，因此需要一个分隔符来分隔这多个部分，这就是上面的邮件源文件中的boundary所描述的，对于每一个Contect type :multipart/* 的内容，都会有这么一个说明，表示多个部分之间的分隔。</p>\n<p>含有 MIME/BASE64编码的邮件，你查看它的源码时一般都含有:“<code>This is a multi-part message in MIME format.</code>”这样的句子。也可以被绝大多数的email程序进行解码，包括Netscape、MS Mail、Eudora等。这些程序可以正确识别邮件的正文，恢 MIME/BASE64 编码的部分为正确的文字或夹带的二进制文件。</p>\n<ul>\n<li><p>5.Content-Transfer-Encoding<br>它表示了这个部分文档的编码方式。只有识别了这个说明才能用正确的解码方式实现对其解码。</p>\n<ul>\n<li>Content-Transfer-Encoding共有Base64, Quoted-printable, 7bit, 8bit, Binary等几种。</li>\n<li>其中7bit是缺省的编码方式。电子邮件源码最初设计为全部是可打印的ASCII码的形式。</li>\n<li>非ASCII码的文本或数据要编码成要求的格式。</li>\n<li>Base64, Quoted-Printable是在非英语国家使用最广使的编码方式。</li>\n<li>Binary方式只具有象征意义，而没有任何实用价值。</li>\n</ul>\n</li>\n<li><p>6.boundary</p>\n<ul>\n<li>这个分隔符是正文中不可能出现的一串古字符的组合，在文档中，以”–”加上这个boundary 来表示一个部分的开始，在文档的结束，以”–”加boundary再在最后加上”–”来表示文档的结束。由于复合类型是可以嵌套使用的因此邮件中可能会多个boundary。</li>\n</ul>\n</li>\n</ul>\n<p><br></p>\n<h5 id=\"3-邮件原始信息\"><a href=\"#3-邮件原始信息\" class=\"headerlink\" title=\"3.邮件原始信息\"></a>3.邮件原始信息</h5><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#(1) 从那里发信到那里接收以及接收信息的收信人</span></span><br><span class=\"line\">Received: from 发信邮件服务器 (unknown [115.124.23.89])</span><br><span class=\"line\">  by 收信邮件服务器 (NewMx) with SMTP id </span><br><span class=\"line\">  <span class=\"keyword\">for</span> &lt;收信人&gt;; Fri, 05 Jun 2020 10:56:48 +0800</span><br><span class=\"line\"><span class=\"comment\">#(2) QQ相关的参数</span></span><br><span class=\"line\">X-QQ-FEAT: Nrj7KsauvmTPZQ**********Du8ZT3+WQp6dDEfYY=</span><br><span class=\"line\">X-QQ-MAILINFO: Nj4k/6lmmRCSyBQ**********/EB9mnO1izsI+o1HWNTKN+0+IWP</span><br><span class=\"line\">X-QQ-mid: mxsza48t时间戳-收信时间tfqsxubj9</span><br><span class=\"line\">X-QQ-ORGSender: system@notice.aliyun.com</span><br><span class=\"line\">X-QQ-XMAILINFO: NlBzqDjet/+1*********/lm+frv3kDP7DnqqWKEAAiP9c</span><br><span class=\"line\">DKIM-Signature:v=1; a=rsa-sha256; c=relaxed/relaxed;</span><br><span class=\"line\">  d=newsletter.aliyun.com; s=s1024;</span><br><span class=\"line\">  t=时间戳-收信时间; h=Date:From:To:Message-ID:Subject:MIME-Version:Content-Type;</span><br><span class=\"line\">  bh=wfxerPzsEEmDRDRXjMJBI13r4XrE/SOsQJOnJYilKV8=;</span><br><span class=\"line\">  b=LwKBc0owsr5zgBDFwwpZl3DadzCmLooo17myWuCBjkfWRUGVPXnQ7w2idnLigyemJe0nXeZC4CVzxRUhXBbqy+8piGBYOgBTCs+TLAorsbek0DbnFmY/5psSHTzAAbXWBmKiPhklr0FYNcD7HTpXxHi6/4meSe5rNmJRGiDmPh8=</span><br><span class=\"line\">X-EnvId: 106163880073</span><br><span class=\"line\"><span class=\"comment\"># (3) 接收到谁的发信</span></span><br><span class=\"line\">Received: from mscchannel011175060107.eu13(mailfrom:system@notice.aliyun.com fp:SMTPD_----.Wrr2.i)</span><br><span class=\"line\">          by smtp.aliyun-inc.com(127.0.0.1);</span><br><span class=\"line\">          Fri, 05 Jun 2020 10:56:47 +0800</span><br><span class=\"line\">Date: Fri, 5 Jun 2020 10:56:47 +0800 (CST)</span><br><span class=\"line\">From: =?UTF-8?B?6Zi/6YeM5LqR?= &lt;system@notice.aliyun.com&gt;</span><br><span class=\"line\">To: 收信人</span><br><span class=\"line\">Message-ID: 2710120060500404702</span><br><span class=\"line\"><span class=\"comment\"># (4) 主题base64之UTF-8编码</span></span><br><span class=\"line\">Subject: =?UTF-8?B?54mp6IGU572R5bmz5Y+w5bey5pSv5oyBU0RL5Zyo57q/6KOB5Ymq?=</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (5) 前面我们所说的版MIME本</span></span><br><span class=\"line\">MIME-Version: 1.0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (6) 文档类型：表示文档的多个部分是混合的，指正文与附件的关系</span></span><br><span class=\"line\">Content-Type: multipart/mixed; </span><br><span class=\"line\">  boundary=<span class=\"string\">\"----=_Part_2824562_163938721.时间戳-收信时间439\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (7) 文件开始标记</span></span><br><span class=\"line\">------=_Part_2824562_163938721.时间戳-收信时间439</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (8) 包含文档类型</span></span><br><span class=\"line\">Content-Type: text/html;charset=utf-8</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (9) 文档传输编码采用QR</span></span><br><span class=\"line\">Content-Transfer-Encoding: quoted-printable</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (10) 文件正文 QR 以 十六进制的ASCII码表示</span></span><br><span class=\"line\">&lt;!DOCTYPE html PUBLIC <span class=\"string\">\"-//W3C//DTD XHTML 1.0 Transitional//EN\"</span> <span class=\"string\">\"http://www.=</span></span><br><span class=\"line\"><span class=\"string\">w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"</span>&gt;</span><br><span class=\"line\">&lt;html xmlns=3D<span class=\"string\">\"http://www.w3.org/1999/xhtml\"</span>&gt;</span><br><span class=\"line\">=09&lt;head&gt;</span><br><span class=\"line\">=09=09&lt;meta http-equiv=3D<span class=\"string\">\"Content-Type\"</span> content=3D<span class=\"string\">\"text/html; charset=3Dutf=</span></span><br><span class=\"line\"><span class=\"string\">-8\"</span> /&gt;</span><br><span class=\"line\">=09=09&lt;title&gt;=E9=98=BF=E9=87=8C=E4=BA=91=E5=AE=98=E7=BD=91=E7=BB=9F=E4=B8=</span><br><span class=\"line\">=80=E4=B8=9A=E5=8A=A1=E9=82=AE=E4=BB=B6=E6=A0=B7=E5=BC=8F(=E4=B8=AD=E6=96=</span><br><span class=\"line\">=87_=E4=B8=AD=E5=9B=BD=E7=AB=99)&lt;/title&gt;</span><br><span class=\"line\">=09&lt;/head&gt;</span><br><span class=\"line\">=09&lt;img src=3D<span class=\"string\">\"http://ac.mmstat.com/aliyun.12.1?logtype=3D4&amp;type=3Demail&amp;ms=</span></span><br><span class=\"line\"><span class=\"string\">gid=3D2710120060500404702&amp;areaid=3Dcn&amp;siteId=3Dcn\"</span>/&gt;&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (11) 文档结束标准</span></span><br><span class=\"line\">------=_Part_2824562_163938721.时间戳-收信时间439--</span><br></pre></td></tr></table></figure>\n<hr>\n<h4 id=\"0x01-易邮局域网邮件服务器\"><a href=\"#0x01-易邮局域网邮件服务器\" class=\"headerlink\" title=\"0x01 易邮局域网邮件服务器\"></a>0x01 易邮局域网邮件服务器</h4><p>环境说明:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- Windows 7</span><br><span class=\"line\">- 服务端:eyoumailserversetup.exe</span><br><span class=\"line\">- 客户端:foxMail</span><br></pre></td></tr></table></figure></p>\n<p><strong>安装流程:</strong><br>Step1.运行邮件服务器软件通常一直下一步即可安装完成，完成后打开<code>C:\\EyouMailServer\\MailServer.exe</code>界面如下:<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200610172839.png\" alt=\"WeiyiGeek.步骤1\" title=\"\" class=\"\">\n                <p>WeiyiGeek.步骤1</p>\n            </figure></p>\n<p>Step2.工具-&gt;系统设置-&gt;邮箱域名设置(weiyigeek.top)<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200610174303.png\" alt=\"WeiyiGeek.步骤2\" title=\"\" class=\"\">\n                <p>WeiyiGeek.步骤2</p>\n            </figure></p>\n<p>Step3.添加新账号设置并设置密码，利用foxmail进行添加账号登陆;<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200610223029.png\" alt=\"WeiyiGeek.步骤3\" title=\"\" class=\"\">\n                <p>WeiyiGeek.步骤3</p>\n            </figure></p>\n<p><br></p>\n<h4 id=\"0x02-邮件服务测试\"><a href=\"#0x02-邮件服务测试\" class=\"headerlink\" title=\"0x02 邮件服务测试\"></a>0x02 邮件服务测试</h4><h5 id=\"1-Telnet\"><a href=\"#1-Telnet\" class=\"headerlink\" title=\"1.Telnet\"></a>1.Telnet</h5><p><strong>测试搭建的邮件服务:</strong></p>\n<ul>\n<li><p>方式1:Telnet测试发信</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># (1)连接邮件服务器smtp端口</span></span><br><span class=\"line\">telnet 10.20.172.110 25</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#220 ESMTP 易邮邮件服务器 5.2.2004.02.18 SMTP Service Ready                        </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2)helo和ehlo指令的作用是向服务器标示用户身份，返回邮件服务器身份;</span></span><br><span class=\"line\">ehlo weiyigeek.top </span><br><span class=\"line\">250-AUTH=LOGIN</span><br><span class=\"line\">250 AUTH LOGIN</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (3)验证用户使用auth login进行验证时用户名和密码是经过base64编码过后的字符</span></span><br><span class=\"line\">auth login                           </span><br><span class=\"line\">334 VXNlcm5hbWU6      </span><br><span class=\"line\">YWRtaW4=                             </span><br><span class=\"line\">334 UGFzc3dvcmQ6                     </span><br><span class=\"line\">d2VpeWlnZWVr   </span><br><span class=\"line\">235 OK <span class=\"comment\"># 表明验证成功</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (4)使用mail指令写一个邮件信息</span></span><br><span class=\"line\">mail from:&lt;admin@weiyigeek.top&gt;      </span><br><span class=\"line\">250 OK                               </span><br><span class=\"line\">rcpt to:&lt;zw@weiyigeek.top&gt;      <span class=\"comment\">#注意这里多个rcpt指令格式      </span></span><br><span class=\"line\">250 OK   </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (5)使用data指令开始写邮件内容</span></span><br><span class=\"line\">data                                 </span><br><span class=\"line\">354 send the mail data, end with .</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (6)邮件信息头与正文</span></span><br><span class=\"line\">from:&lt;admin@weiyigeek.top&gt;</span><br><span class=\"line\">to:&lt;zw@weiyigeek.top&gt;</span><br><span class=\"line\">subject:Telnet send Email</span><br><span class=\"line\"></span><br><span class=\"line\">Telnet smtp 25 port                               </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (7) 结束data指令的标志</span></span><br><span class=\"line\">.</span><br><span class=\"line\">250 </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (8) 退出Telnet邮件服务器</span></span><br><span class=\"line\">quit</span><br><span class=\"line\">221 SMTP SERVICE CLOSED</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200610225731.png\" alt=\"WeiyiGeek.telnet\" title=\"\" class=\"\">\n                <p>WeiyiGeek.telnet</p>\n            </figure>\n</li>\n<li><p>方式2:Telnet pop3 邮件查看 (常用此方法在内网中进行暴力破解)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$telnet</span> 10.20.172.110 110</span><br><span class=\"line\">Trying 10.20.172.110...</span><br><span class=\"line\">Connected to 10.20.172.110.</span><br><span class=\"line\">Escape character is <span class=\"string\">'^]'</span>.</span><br><span class=\"line\">+OK  5.2 POP3 Service Ready</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (1) pop 用户</span></span><br><span class=\"line\">user zw</span><br><span class=\"line\">+OK welcome here</span><br><span class=\"line\"><span class=\"comment\"># (2) pop 用户密码</span></span><br><span class=\"line\">pass 123456</span><br><span class=\"line\">+OK</span><br><span class=\"line\"><span class=\"comment\"># (3) 查看邮件信息可以这里看到4封邮件349212字节</span></span><br><span class=\"line\"><span class=\"built_in\">stat</span></span><br><span class=\"line\">+OK 4 349212</span><br><span class=\"line\"><span class=\"comment\"># (4) list指令列出所有的邮件</span></span><br><span class=\"line\">list</span><br><span class=\"line\">+OK 4 349212</span><br><span class=\"line\">1 445</span><br><span class=\"line\">2 345356</span><br><span class=\"line\">3 3116</span><br><span class=\"line\">4 295</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (5) 删除用dele+序号删除邮件（只是标记删除，退出后真的删除）,</span></span><br><span class=\"line\">dele 1</span><br><span class=\"line\">+OK</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (6) 用rset恢复标记的邮件</span></span><br><span class=\"line\">rset</span><br><span class=\"line\">+Ok</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (7) retr+序号查看邮件内容。</span></span><br><span class=\"line\">retr 2</span><br><span class=\"line\">+OK 345356 octets</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (8) 邮件正文信息</span></span><br><span class=\"line\">Return-Path: &lt;admin@weiyigeek.top&gt;</span><br><span class=\"line\">Received: from WeiyiGeek (unknown [10.20.172.103])</span><br><span class=\"line\">        by weiyigeek.top with CMailServer 5.2 SMTP; Thu, 11 Jun 2020 06:32:25 +0800</span><br><span class=\"line\">Date: Wed, 10 Jun 2020 22:33:12 +0800</span><br><span class=\"line\">From: <span class=\"string\">\"admin@weiyigeek.top\"</span> &lt;admin@weiyigeek.top&gt;</span><br><span class=\"line\">To: weiyigeek &lt;weiyigeek@qq.com&gt;</span><br><span class=\"line\">Cc: zw &lt;zw@weiyigeek.top&gt;</span><br><span class=\"line\">Subject: =?GB2312?B?suLK1Lei0MU=?=</span><br><span class=\"line\">X-Priority: 3</span><br><span class=\"line\">X-Has-Attach: no</span><br><span class=\"line\">X-Mailer: Foxmail 7.2.11.303[cn]</span><br><span class=\"line\">Mime-Version: 1.0  <span class=\"comment\">#信息头讲解参考上面</span></span><br><span class=\"line\">Message-ID: &lt;202006102233116226900@weiyigeek.top&gt;</span><br><span class=\"line\">Content-Type: multipart/related;</span><br></pre></td></tr></table></figure></li>\n<li>方式3.采用邮箱客户端进行登陆发信，这里不多说了（自己建的邮件服务器采用密码，如果用的是QQ采用授权码即可）;</li>\n</ul>\n<p><br></p>\n<h5 id=\"3-javamail-jar\"><a href=\"#3-javamail-jar\" class=\"headerlink\" title=\"3.javamail.jar\"></a>3.javamail.jar</h5><p>描述:老规矩我们首先需要将mail包导入到工程之中，此处采用<code>javamail-1.4.4</code>版本和类型;</p>\n<p>基础示例:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> top.weiyigeek.email;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Properties;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.mail.Authenticator;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.mail.Message;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.mail.Message.RecipientType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.mail.MessagingException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.mail.PasswordAuthentication;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.mail.Session;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.mail.Transport;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.mail.internet.AddressException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.mail.internet.InternetAddress;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.mail.internet.MimeMessage;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">emailDemo</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"meta\">@Test</span></span><br><span class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sendMail</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> AddressException, MessagingException </span>&#123;</span><br><span class=\"line\">           <span class=\"comment\">//1.服务器的设置</span></span><br><span class=\"line\">           Properties props = <span class=\"keyword\">new</span> Properties();</span><br><span class=\"line\">           props.setProperty(<span class=\"string\">\"mail.host\"</span>, <span class=\"string\">\"10.20.172.110\"</span>);</span><br><span class=\"line\">           props.setProperty(<span class=\"string\">\"mail.smtp.auth\"</span>,<span class=\"string\">\"true\"</span>);</span><br><span class=\"line\">           </span><br><span class=\"line\">           <span class=\"comment\">//2.邮箱用户账号和密码</span></span><br><span class=\"line\">           Authenticator authenticator = <span class=\"keyword\">new</span> Authenticator() &#123;</span><br><span class=\"line\">               <span class=\"meta\">@Override</span></span><br><span class=\"line\">               <span class=\"function\"><span class=\"keyword\">protected</span> PasswordAuthentication <span class=\"title\">getPasswordAuthentication</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                   <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> PasswordAuthentication(<span class=\"string\">\"admin@weiyigeek.top\"</span>, <span class=\"string\">\"weiyigeek\"</span>);</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">           &#125;;</span><br><span class=\"line\">           </span><br><span class=\"line\">           <span class=\"comment\">//3.建立联系返回session</span></span><br><span class=\"line\">           Session session = Session.getDefaultInstance(props, authenticator);</span><br><span class=\"line\">           </span><br><span class=\"line\">           <span class=\"comment\">//4.邮件编写与发送</span></span><br><span class=\"line\">           <span class=\"comment\">//4.1 邮件编写</span></span><br><span class=\"line\">           Message message = <span class=\"keyword\">new</span> MimeMessage(session);</span><br><span class=\"line\">           <span class=\"comment\">//4.2 发件人信息</span></span><br><span class=\"line\">           message.setFrom(<span class=\"keyword\">new</span> InternetAddress(<span class=\"string\">\"admin@weiyigeek.top\"</span>));</span><br><span class=\"line\">           <span class=\"comment\">//4.3 收件人 , to:收件人 cc:抄送 bcc:暗送（密送）。（模拟账号）</span></span><br><span class=\"line\">           message.setRecipient(RecipientType.TO, <span class=\"keyword\">new</span> InternetAddress(<span class=\"string\">\"zw@weiyigeek.top\"</span>));</span><br><span class=\"line\">           <span class=\"comment\">//4.4 主题</span></span><br><span class=\"line\">           message.setSubject(<span class=\"string\">\"Java-Mail测试邮件信息....\"</span>);</span><br><span class=\"line\">           <span class=\"comment\">//4.5 内容</span></span><br><span class=\"line\">           message.setContent(<span class=\"string\">\"&lt;h1 style='color:red'&gt;测试发信信息&lt;/h1&gt;\"</span>, <span class=\"string\">\"text/html;charset=UTF-8\"</span>);</span><br><span class=\"line\">           </span><br><span class=\"line\">           <span class=\"comment\">//5.将信息进行发送:Transport</span></span><br><span class=\"line\">           Transport.send(message);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>执行结果:(内部测试)<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[2020-06-11 18:30:40] SMTP 10.20.172.103 ESMTP authentication: admin@weiyigeek.top</span><br><span class=\"line\">[2020-06-11 18:30:40] SMTP 10.20.172.103 mail from admin@weiyigeek.top to zw@weiyigeek.top successfully</span><br><span class=\"line\">[2020-06-11 18:30:59] SMTP MailUndeliverable mail from admin to admin@weiyigeek.top successfully</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200611103910.png\" alt=\"WeiyiGeek.测试\" title=\"\" class=\"\">\n                <p>WeiyiGeek.测试</p>\n            </figure></p>\n<p><strong>实际案例:</strong><br>利用了RedisPool+javamail实现用户发信与激活；</p>\n<p>邮件激活发信页面:<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%@ page language=<span class=\"string\">\"java\"</span> contentType=<span class=\"string\">\"text/html; charset=UTF-8\"</span></span><br><span class=\"line\">    pageEncoding=<span class=\"string\">\"UTF-8\"</span>%&gt;</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\"> &lt;title&gt;Email邮箱验证测试&lt;/title&gt;</span><br><span class=\"line\"> &lt;meta charset=<span class=\"string\">\"utf-8\"</span>&gt;</span><br><span class=\"line\"> &lt;meta name=<span class=\"string\">\"viewport\"</span> content=<span class=\"string\">\"width=device-width, initial-scale=1\"</span>&gt;</span><br><span class=\"line\"> &lt;link rel=<span class=\"string\">\"stylesheet\"</span> href=<span class=\"string\">\"https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css\"</span>&gt;  </span><br><span class=\"line\"> &lt;script src=\"https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js\"&gt;&lt;/script&gt;</span><br><span class=\"line\"> &lt;script src=\"https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js\"&gt;&lt;/script&gt;</span><br><span class=\"line\"> &lt;script type=<span class=\"string\">\"text/javascript\"</span>&gt;</span><br><span class=\"line\">$(function()&#123;</span><br><span class=\"line\">    $(<span class=\"string\">\"#getCode\"</span>).click(function()&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> email = $(<span class=\"string\">\"#email\"</span>).val();</span><br><span class=\"line\">        console.log(email);</span><br><span class=\"line\">        $.get(<span class=\"string\">\"/Web/UserOper?method=activeEmail&amp;email=\"</span>+email,function(data,status)&#123;</span><br><span class=\"line\">            console.info(data);</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">  &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"container\"</span> id=<span class=\"string\">\"activeemail\"</span>&gt;</span><br><span class=\"line\">    &lt;h1&gt; 邮箱激活 &lt;/h1&gt;</span><br><span class=\"line\">    &lt;form <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"form-horizontal\"</span> role=<span class=\"string\">\"form\"</span> action=<span class=\"string\">\"UserOper?method=vertyEmail\"</span>&gt;</span><br><span class=\"line\">  </span><br><span class=\"line\">    &lt;label lass=\"col-sm-2 control-label\" for=\"email\"&gt;邮箱地址:&lt;/label&gt;</span><br><span class=\"line\">    &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"form-group\"</span>&gt;</span><br><span class=\"line\">        &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"col-sm-6\"</span>&gt;</span><br><span class=\"line\">        &lt;input type=<span class=\"string\">\"text\"</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"form-control\"</span> id=<span class=\"string\">\"email\"</span> value=<span class=\"string\">\"zw@weiyigeek.top\"</span> disabled&gt;\t\t   </span><br><span class=\"line\">      &lt;/div&gt;</span><br><span class=\"line\">      &lt;/div&gt;</span><br><span class=\"line\">      </span><br><span class=\"line\">     &lt;label lass=\"col-sm-2 control-label\" for=\"emailcode\"&gt;邮箱验证码:&lt;/label&gt;</span><br><span class=\"line\">      &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"form-group\"</span>&gt;</span><br><span class=\"line\">        &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"col-sm-4\"</span>&gt;</span><br><span class=\"line\">          &lt;input type=<span class=\"string\">\"text\"</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"form-control\"</span> id=<span class=\"string\">\"emailcode\"</span> placeholder=<span class=\"string\">\"请输入验证码\"</span> name=<span class=\"string\">\"emailcode\"</span>&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">         &lt;div <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"col-sm-2\"</span>&gt;</span><br><span class=\"line\">        \t&lt;input type=<span class=\"string\">\"button\"</span> <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"btn btn-default\"</span> value=<span class=\"string\">\"获取验证码\"</span> id=<span class=\"string\">\"getCode\"</span>&gt;</span><br><span class=\"line\">         &lt;/div&gt;</span><br><span class=\"line\">      &lt;/div&gt;</span><br><span class=\"line\">       &lt;button type=\"submit\" class=\"btn btn-primary\"&gt;提交验证&lt;/button&gt;</span><br><span class=\"line\">    &lt;/form&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>\n<p>请求部分servlet方法(采用反射进行实现):<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/Web/src/top/weiyigeek/baseservlet/BaseServlet.java</span><br><span class=\"line\"><span class=\"comment\">/***</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> WeiyiGeek</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@desc</span> 工具类:自建一个Servlet基础类所有继承该类的Servlet都将执行重写后的Service方法</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BaseServlet</span> <span class=\"keyword\">extends</span> <span class=\"title\">HttpServlet</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"unused\"</span>)</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">service</span><span class=\"params\">(HttpServletRequest req, HttpServletResponse resp)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"BaseServlet - 被继承的基础Servlet中的Service方法\"</span>);</span><br><span class=\"line\">        <span class=\"comment\">//1.获取请求的操作的方法</span></span><br><span class=\"line\">        String method = req.getParameter(<span class=\"string\">\"method\"</span>);</span><br><span class=\"line\">        <span class=\"comment\">//2.定义转发路径</span></span><br><span class=\"line\">        String redirection = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"comment\">//3.获取当前的字节码对象</span></span><br><span class=\"line\">        Class&lt;? extends BaseServlet&gt; clazz = <span class=\"keyword\">this</span>.getClass(); <span class=\"comment\">//此时获取的实际上是继承者的class即 UserOper.class</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//4.采用反射reflect形式获取到clazz的方法并且进行调用传入的指定方法</span></span><br><span class=\"line\">            Method md = clazz.getMethod(method, HttpServletRequest.class, HttpServletResponse.class);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> != md) &#123;</span><br><span class=\"line\">                redirection = (String) md.invoke(<span class=\"keyword\">this</span>, req, resp);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//5.当跳转路径不为空的时候返回的指定路径</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> != redirection)&#123;</span><br><span class=\"line\">               req.getRequestDispatcher(redirection).forward(req, resp);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">/Web/src/top/weiyigeek/baseservlet/UserOper.java</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserOper</span> <span class=\"keyword\">extends</span> <span class=\"title\">BaseServlet</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">1L</span>;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">UserOper</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>();</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"UserOper Servlet 构造方法!\"</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">activeEmail</span><span class=\"params\">(HttpServletRequest request,HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServerException </span>&#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"邮件发信\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"/SendMail\"</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>注册邮件发送servlet:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> top.weiyigeek.baseservlet;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Random;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServlet;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpSession;</span><br><span class=\"line\"><span class=\"keyword\">import</span> redis.clients.jedis.Jedis;</span><br><span class=\"line\"><span class=\"keyword\">import</span> top.weiyigeek.connredis.RedisDemo3;</span><br><span class=\"line\"><span class=\"keyword\">import</span> top.weiyigeek.email.Email;</span><br><span class=\"line\"><span class=\"keyword\">import</span> top.weiyigeek.utils.RedisPoolUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SendMail</span> <span class=\"keyword\">extends</span> <span class=\"title\">HttpServlet</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">1L</span>;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doGet</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//1.返回类型</span></span><br><span class=\"line\">      response.setContentType(<span class=\"string\">\"application/json;charset=utf-8\"</span>);</span><br><span class=\"line\">      <span class=\"comment\">//2.redis相关</span></span><br><span class=\"line\">      Jedis jedis = RedisPoolUtil.getJedis();</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//3.客户端session</span></span><br><span class=\"line\">        HttpSession session = request.getSession();</span><br><span class=\"line\">        String sessionid = session.getId();</span><br><span class=\"line\">   </span><br><span class=\"line\">        <span class=\"comment\">//4.获取得到的email(生成激活码)</span></span><br><span class=\"line\">        String email = request.getParameter(<span class=\"string\">\"email\"</span>);</span><br><span class=\"line\">        String emailcode = String.format(<span class=\"string\">\"%04d\"</span>, <span class=\"keyword\">new</span> Random().nextInt(<span class=\"number\">10000</span>));</span><br><span class=\"line\">        String context=<span class=\"string\">\" &lt;h3 style='color:grade'&gt;欢迎注册WeiyiGeek博客&lt;/h3&gt;&lt;br&gt;&lt;b&gt;邮箱激活验证码:\"</span>+emailcode+<span class=\"string\">\"&lt;/b&gt;\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//5.判断是否激活邮箱否则发信</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!RedisDemo3.exits(jedis, sessionid) &amp;&amp; !RedisDemo3.exits(jedis, email)) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"session:\"</span>+sessionid+<span class=\"string\">\"   emailcode:\"</span>+emailcode);</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                RedisDemo3.setKeyString(jedis, sessionid, emailcode, <span class=\"number\">360</span>);</span><br><span class=\"line\">                RedisDemo3.setKey(jedis, email, <span class=\"string\">\"false\"</span>);</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    Email.sendMail(email, <span class=\"string\">\"[注册码] weiyigeek Blog's\"</span>, context);</span><br><span class=\"line\">                    response.getWriter().append(<span class=\"string\">\"&#123;\\\"status\\\":\\\"successful\\\",\\\"msg\\\":\\\"发信成功\\\"&#125;\"</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                    response.getWriter().append(<span class=\"string\">\"&#123;\\\"status\\\":\\\"Error\\\",\\\"msg\\\":\\\"发信失败，请重试!\\\"&#125;\"</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// TODO Auto-generated catch block</span></span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">                jedis.close();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!RedisDemo3.exits(jedis, sessionid) || !RedisDemo3.getKeyString(jedis, email).equals(<span class=\"string\">\"true\"</span>)) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"session:\"</span>+sessionid+<span class=\"string\">\"--激活码:\"</span>+emailcode);</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                Email.sendMail(email, <span class=\"string\">\"[注册码] weiyigeek Blog's\"</span>, context);</span><br><span class=\"line\">                response.getWriter().append(<span class=\"string\">\"&#123;\\\"status\\\":\\\"successful\\\",\\\"msg\\\":\\\"再次发信成功\\\"&#125;\"</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                response.getWriter().append(<span class=\"string\">\"&#123;\\\"status\\\":\\\"Error\\\",\\\"msg\\\":\\\"再次发信失败，请重试!\\\"&#125;\"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span>  &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"session:\"</span>+sessionid);</span><br><span class=\"line\">            response.getWriter().append(<span class=\"string\">\"&#123;\\\"status\\\":\\\"error\\\",\\\"msg\\\":\\\"mail already active and verity！\\\"&#125;\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">//7.使用完毕后记得关闭redis连接并将其返还给资源池</span></span><br><span class=\"line\">        jedis.close();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>执行结果:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">邮件发信</span><br><span class=\"line\">当前Redis连接池被使用的数量: 1</span><br><span class=\"line\">session:0327E936C1BB849C79410E5BEA3D55ED   emailcode:8537</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200611131647.png\" alt=\"WeiyiGeek.示例\" title=\"\" class=\"\">\n                <p>WeiyiGeek.示例</p>\n            </figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"应用安装","path":"api/categories/应用安装.json"}],"tags":[{"name":"Email","path":"api/tags/Email.json"}]}