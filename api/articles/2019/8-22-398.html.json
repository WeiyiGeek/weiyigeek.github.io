{"title":"运用CDN技术的网站验证以及相关风险","slug":"网安大类/PenetrationNote/信息收集/指纹验证/运用CDN技术的网站验证以及相关风险","date":"2019-08-22T09:36:30.000Z","updated":"2023-01-31T02:29:10.674Z","url":"2019/8-22-398.html","path":"api/articles/2019/8-22-398.html.json","covers":["https://img.weiyigeek.top/2019/1/20190823145726.png","https://img.weiyigeek.top/2019/1/20190823145936.png","https://img.weiyigeek.top/2019/1/20190823150717.png","https://img.weiyigeek.top/2019/1/20190823153812.png","https://img.weiyigeek.top/2019/1/20190823151003.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-验证CDN站点\"><a href=\"#0x00-验证CDN站点\" class=\"headerlink\" title=\"0x00 验证CDN站点\"></a>0x00 验证CDN站点</h4><p>如何验证站点是否存在CDN最简单的办法如下:</p>\n<p><strong>方法一:</strong><br>描述: 使用各种多地 ping 的服务，查看对应 IP 地址是否唯一，如果不唯一多半是使用了CDN，多地 Ping 网站有：</p>\n<ul>\n<li><a href=\"http://ping.chinaz.com/\" target=\"_blank\" rel=\"noopener\">http://ping.chinaz.com/</a></li>\n<li><a href=\"http://ping.aizhan.com/\" target=\"_blank\" rel=\"noopener\">http://ping.aizhan.com/</a></li>\n<li><a href=\"http://ce.cloud.360.cn/\" target=\"_blank\" rel=\"noopener\">http://ce.cloud.360.cn/</a></li>\n</ul>\n<p><br></p>\n<p><strong>方法二：</strong><br>描述:使用 nslookup 进行检测，原理同上，如果返回域名解析对应多个 IP 地址多半是使用了 CDN。<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20190823145726.png\" alt=\"WeiyiGeek.CDN验证\" title=\"\" class=\"\">\n                <p>WeiyiGeek.CDN验证</p>\n            </figure></p>\n<p><em>注意事项：</em></p>\n<ul>\n<li>dig工具可以从该域名的官方DNS服务器上查询到精确的权威解答,而nslookup只会得到DNS解析服务器保存在Cache中的非权威解答。</li>\n<li>对于一些采用了分布式服务器和CDN技术的大型网站，使用NSlookup 查询到的结果往往会和dig命令查询到的结果不同。</li>\n</ul>\n<p><br></p>\n<p><strong>方法三:</strong><br>描述: 一般做了CDN的网站会有CNAME域名解析记录，我们可以使用各种工具帮助检测目标网站是否使用了CDN可以参见如下网站</p>\n<ul>\n<li><a href=\"http://www.cdnplanet.com/tools/cdnfinder/\" target=\"_blank\" rel=\"noopener\">http://www.cdnplanet.com/tools/cdnfinder/</a></li>\n<li><a href=\"http://www.ipip.net/ip.html\" target=\"_blank\" rel=\"noopener\">http://www.ipip.net/ip.html</a></li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20190823145936.png\" alt=\"WeiyiGeek.DNSDataView\" title=\"\" class=\"\">\n                <p>WeiyiGeek.DNSDataView</p>\n            </figure>\n<hr>\n\n<h4 id=\"0x01-查询网站真实IP\"><a href=\"#0x01-查询网站真实IP\" class=\"headerlink\" title=\"0x01 查询网站真实IP\"></a>0x01 查询网站真实IP</h4><p><strong>1.先查一下分站的域名地址</strong><br>有些cdn的服务实在是太昂贵，很多情况是主站使用了 CDN 而分站没有使用，这时候我们就可以通过子域名来get到真实的ip地址。</p>\n<p><br></p>\n<p><strong>2.大部分CDN提供商只针对国内市场</strong><br>而对国外市场几乎是不做CDN，所以有很大的几率会直接解析到真实IP。其实这个方法根本不用上国外vpn，因为你上国外vpn的ping本质，就是使用国外dns（那台vpn服务器使用的dns）查询域名而已，所以只需要：nslookup xxx.com 国外dns，就行了，例如：nslookup xxx.com 8.8.8.8，提示：你要找冷门国外DNS才行，像谷歌的DNS，国内用的人越来越多了，很多CDN提供商都把谷歌DNS作为国内市场之一，所以，你查到的结果会和国内差不了多少 （核总的原话）</p>\n<p><br></p>\n<p><strong>3.ping 命令这样写 ping xxx.com 而不是 ping <a href=\"http://www.xxx.com\" target=\"_blank\" rel=\"noopener\">www.xxx.com</a></strong><br>ping xxx.com一般都会是真实IP，因为了解到现有很多CDN厂商基本只要求把 <a href=\"http://www.xxx.com\" target=\"_blank\" rel=\"noopener\">www.xxx.com</a> cname到cdn主服务器上去。<br><a href=\"http://www.xxx.com\" target=\"_blank\" rel=\"noopener\">www.xxx.com</a> 和 xxx.com是两条独立的解析记录,一般只会把 <a href=\"http://www.xxx.com\" target=\"_blank\" rel=\"noopener\">www.xxx.com</a> 做 CDN</p>\n<p><br></p>\n<p><strong>4.看历史纪录</strong><br>指的是查找域名历史解析记录，因为域名在上CDN之前用的IP，很有可能就是CDN的真实源IP地址。<br>有个专门的网站提供域名解析历史记录查询：</p>\n<ul>\n<li><a href=\"http://www.17ce.com\" target=\"_blank\" rel=\"noopener\">http://www.17ce.com</a></li>\n<li><a href=\"http://toolbar.netcraft.com/site_report?url=www.xxx.com\" target=\"_blank\" rel=\"noopener\">http://toolbar.netcraft.com/site_report?url=www.xxx.com</a></li>\n<li><a href=\"https://dnsdb.io/zh-cn/\" target=\"_blank\" rel=\"noopener\">https://dnsdb.io/zh-cn/</a></li>\n<li><a href=\"https://x.threatbook.cn/\" target=\"_blank\" rel=\"noopener\">https://x.threatbook.cn/</a></li>\n</ul>\n<p>经过验证: <a href=\"https://x.threatbook.cn/\" target=\"_blank\" rel=\"noopener\">https://x.threatbook.cn/</a> 才能查询DNS解析历史记录，而且太早期的也没有;<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20190823150717.png\" alt=\"WeiyiGeek.DNC解析历史\" title=\"\" class=\"\">\n                <p>WeiyiGeek.DNC解析历史</p>\n            </figure></p>\n<p><br></p>\n<p><strong>5.phpinfo</strong><br>剑心说过在进行渗透扫描的时候, phpinfo();之类的探针看你路径字典强度.很容易跑出来的.</p>\n<p><br></p>\n<p><strong>6.有的服务器本地自带sendmail与mx记录查询</strong><br>注册之后会主动发一封邮件给我们。通过邮件发送地址往往也能得到服务器IP，当然这个IP也要验证是否为主站的，可以通过常看网页源代码看到IP(也有可能采用的是腾讯或阿里云的企业服务器-那您就换一条路把)。<br>有的大型互联网网站会有自己的Mailserver，应该也是处在一个网段，那个网段打开80的一个一个试。<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20190823153812.png\" alt=\"WeiyiGeek.邮箱地址\" title=\"\" class=\"\">\n                <p>WeiyiGeek.邮箱地址</p>\n            </figure> </p>\n<p><br></p>\n<p><strong>7.rss 订阅一般也会得到真实的IP地址</strong></p>\n<p><br></p>\n<p><strong>8: xss 漏洞(存储类型-还需等待生效时间)</strong><br>同6：是让服务器主动连接我们的一种方式.</p>\n<p><br></p>\n<p><strong>9.DDOS(基本上不现实)</strong><br>DDOS耗尽CDN流量、那么就会回源，这样就能得到真实IP不设防的cdn 量大就会挂，高防cdn 要增大流量。</p>\n<p><br></p>\n<p><strong>10.社会工程学</strong><br>比如勾搭卖这CDN的客服妹子，他们可能有权限或者查看域名注册方的一些信息如电话啊、邮件地址啊、姓名啊，<br>有时候会有些人注册一堆域名可以尝试从这些突破</p>\n<p><br></p>\n<p><strong>11.全网扫描</strong><br>Zmap号称44分钟扫完-全网我们首先从 apnic 获取 IP 段，然后使用 Zmap 的 banner-grab 扫描出来 80 端口开放的主机进行 banner 抓取，最后在 http-req 中的 Host 写 xiaix.me』（其中xiaix.me是需要寻找真实IP的域名）。说到这个，我就想起了shodan，zoomeye。虽然他们都很强大地能够搜索到全球的IP banner信息，http的banner信息，但是却不能搜索网页代码。</p>\n<p><br></p>\n<p><strong>13.根据HTML代码进行搜索</strong><br>友推荐一个新的IOT搜索引擎，跟前面提到的两个相似，叫FOFA / 钟馗之眼,这个东西优点是支持HTML源代码检索;</p>\n<ul>\n<li><a href=\"https://fofa.so/\" target=\"_blank\" rel=\"noopener\">https://fofa.so/</a><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#搜索CND网站的关键字</span></span><br><span class=\"line\">title=<span class=\"string\">\"xxxxxx-xxxx.com\"</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20190823151003.png\" alt=\"WeiyiGeek.fofa.so\" title=\"\" class=\"\">\n                <p>WeiyiGeek.fofa.so</p>\n            </figure>\n<p><br></p>\n<h4 id=\"0x02-CND-安全\"><a href=\"#0x02-CND-安全\" class=\"headerlink\" title=\"0x02 CND 安全\"></a>0x02 CND 安全</h4><p><em>CDN存在中间人攻击的隐患吗?</em><br>比如Cloudflare连接用Cloudflare CDN的网站可以看到SSL证书是Cloudflare的证书，所以Cloudflare可以看到所有来往信息。万一Cloudflare CDN服务器安全出问题了,或者Cloudflare本身有一些监控手段，是否意味着存在中间人攻击的安全隐患？</p>\n<p>虽然一般CDN提供商不会监控传输的一些敏感信息,但是信任并不代表CDN服务器不会出问题！</p>\n<p>CDN安全隐患肯定存在，服务器的私钥都上传到了CDN服务器上，如果被攻击者获取到并利用私钥进行下面的操作;</p>\n<ul>\n<li>看到双向的加密流量、解密的明文流量。</li>\n<li>监控双向进出的流量、甚至修改、替换、删除、注入报文，通信的双方都可能无法检测到报文已经被恶意篡改的事实。</li>\n</ul>\n<p><em>由于安全防护不足，CDN服务器沦陷了，同时沦陷的还有客户服务器证书的私钥，看看这个私钥能干掉啥有意义的事？</em></p>\n<p>RSA密钥交换算法: 使用RSA公钥算法分发的将可以使用私钥来进行</p>\n<ul>\n<li>解密现在、将来的加密流量，还可以解密历史上的所有的加密流量;</li>\n</ul>\n<p>DHE密钥交换算法: 证书的私钥只负责认证这一块,而DHE才负责双方密钥的分发。所以即使私钥泄露了，用私钥也无法从历史流量里还原出“Pre-master Key”。</p>\n<p>因为攻陷了CDN服务器，所有RSA私钥、DHE私钥，解密解密流量就如同吃哈密瓜一样轻松容易</p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"InformationGathering","path":"api/categories/InformationGathering.json"}],"tags":[{"name":"CDN","path":"api/tags/CDN.json"}]}