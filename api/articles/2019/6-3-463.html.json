{"title":"n3.Docker之Win10和Server使用实例","slug":"虚拟云容/云容器/Docker/n3.Docker之Win10和Server使用实例","date":"2019-06-03T06:36:30.000Z","updated":"2023-01-31T02:29:10.642Z","url":"2019/6-3-463.html","path":"api/articles/2019/6-3-463.html.json","covers":["https://img.weiyigeek.top/2020/1/20200312150950.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"0x00-基础设置\"><a href=\"#0x00-基础设置\" class=\"headerlink\" title=\"0x00 基础设置\"></a>0x00 基础设置</h2><p>描述:Windows安装／升级Docker客户端:</p>\n<p><strong>1) 版本选择</strong></p>\n<ul>\n<li><p>(1) 对于Windows 10以下的用户，推荐使用Docker Toolbox<br>Windows安装文件：<a href=\"http://mirrors.aliyun.com/docker-toolbox/windows/docker-toolbox/\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/docker-toolbox/windows/docker-toolbox/</a></p>\n</li>\n<li><p>(2) 对于Windows 10以上的用户 推荐使用Docker for Windows (注意需要启动Hvper-v)<br>Windows安装文件：<a href=\"http://mirrors.aliyun.com/docker-toolbox/windows/docker-for-windows/\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/docker-toolbox/windows/docker-for-windows/</a></p>\n</li>\n</ul>\n<p><br></p>\n<p><strong>2) 镜像加速</strong></p>\n<ul>\n<li>阿里云的Docker镜像加速:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#Docker Toolbox的用户</span></span><br><span class=\"line\">docker-machine create --engine-registry-mirror=https://xlx9erfu.mirror.aliyuncs.com -d virtualbox default</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Docker for Windows的用户</span></span><br><span class=\"line\"><span class=\"comment\">#在系统右下角托盘图标内右键菜单选择 Settings，打开配置窗口后左侧导航菜单选择 Docker Daemon</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"registry-mirrors\"</span>: [<span class=\"string\">\"https://xlx9erfu.mirror.aliyuncs.com\"</span>]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><em>注意事项:</em> Docker for Windows 有两种运行模式，一种运行Windows相关容器，一种运行传统的Linux容器。同一时间只能选择一种模式运行。</p>\n<p><br></p>\n<h2 id=\"0x01-安装流程\"><a href=\"#0x01-安装流程\" class=\"headerlink\" title=\"0x01 安装流程\"></a>0x01 安装流程</h2><h5 id=\"Docker-for-windows\"><a href=\"#Docker-for-windows\" class=\"headerlink\" title=\"Docker-for-windows\"></a>Docker-for-windows</h5><p>描述:在Windows10中运行Docker需要满足以下条件:</p>\n<ul>\n<li>Windows 10 64位:专业版、企业版或教育版(构建15063或更高版本),非家庭版又不支持Hyper-V(但是可以通过注册表进行修改伪装)</li>\n<li>必须启用Hyper-V和容器窗口功能。<ul>\n<li>64位处理器二级地址转换（SLAT）</li>\n<li>4GB的系统内存</li>\n<li>BIOS级别的硬件虚拟化支持必须在BIOS设置中启用</li>\n</ul>\n</li>\n</ul>\n<p><br></p>\n<ul>\n<li><p>1.安装功能完整的Hyper-V启动批处理</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"built_in\">echo</span> off</span><br><span class=\"line\"><span class=\"built_in\">pushd</span> <span class=\"string\">\"%~dp0\"</span></span><br><span class=\"line\">dir /b %SystemRoot%\\servicing\\Packages\\*Hyper-V*.mum &gt;hyper-v.txt</span><br><span class=\"line\"><span class=\"keyword\">for</span> /f %%i <span class=\"keyword\">in</span> (<span class=\"string\">'findstr /i . hyper-v.txt 2^&gt;nul'</span>) <span class=\"keyword\">do</span> dism /online /norestart /add-package:<span class=\"string\">\"%SystemRoot%\\servicing\\Packages\\%%i\"</span></span><br><span class=\"line\">del hyper-v.txt</span><br><span class=\"line\">Dism /online /<span class=\"built_in\">enable</span>-feature /featurename:Microsoft-Hyper-V-All /LimitAccess /ALL</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>2.环境依赖Hyper-V需要在程序与应用中设置开启Hyper-v服务即如下图所示:</p>\n</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200312150950.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n<ul>\n<li>3.安装后重新启动系统然后进行安装Docker-For-Windows;</li>\n</ul>\n<p><br></p>\n<h5 id=\"Docker-for-WSL\"><a href=\"#Docker-for-WSL\" class=\"headerlink\" title=\"Docker-for-WSL\"></a>Docker-for-WSL</h5><p>描述:我们可以通过WSL进行安装Docker客户端(Docker CLI)然后连接到连接到通过<code>Docker for Windows</code>或您创建的任何其他VM 运行的远程Docker守护进程,这是由于目前WSL是不支持Docker的守护进程(daemon);</p>\n<p><em>WSL Ubuntu 18.04TLS install docker-ce:</em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt update</span><br><span class=\"line\">sudo apt install libltdl7 cgroupfs-mount</span><br><span class=\"line\">curl -O https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian/dists/stretch/pool/stable/amd64/docker-ce_17.12.1~ce-0~debian_amd64.deb</span><br><span class=\"line\">sudo dpkg -i docker-ce_17.09.1~ce-0~debian_amd64.deb</span><br><span class=\"line\"><span class=\"comment\">#将该用户添加到docker组</span></span><br><span class=\"line\">sudo usermod -aG docker <span class=\"variable\">$USER</span></span><br><span class=\"line\">sudo cgroupfs-mount</span><br><span class=\"line\">sudo service docker start</span><br><span class=\"line\">docker version</span><br></pre></td></tr></table></figure>\n<p>补充方式:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">windows下安装docker无法启动:</span><br><span class=\"line\">* bcdedit /<span class=\"built_in\">set</span> hypervisorlaunchtype off</span><br><span class=\"line\">* bcdedit /<span class=\"built_in\">set</span> hypervisorlaunchtype auto</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"string\">\"<span class=\"variable\">$HOME</span>/bin:<span class=\"variable\">$HOME</span>/.local/bin:<span class=\"variable\">$PATH</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"string\">\"<span class=\"variable\">$PATH</span>:/mnt/c/Program\\ Files/Docker/Docker/resources/bin\"</span></span><br><span class=\"line\"><span class=\"built_in\">alias</span> docker=docker.exe</span><br><span class=\"line\"><span class=\"built_in\">alias</span> docker-compose=docker-compose.exe</span><br><span class=\"line\"></span><br><span class=\"line\">$ <span class=\"built_in\">echo</span> &gt;&gt; ~/.bashrc &lt;&lt;EOF</span><br><span class=\"line\"><span class=\"comment\"># Connect to Docker on Windows</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> DOCKER_CERT_PATH=/mnt/c/Users/YOUR_USERNAME/.docker/machine/certs</span><br><span class=\"line\"><span class=\"built_in\">export</span> DOCKER_TLS_VERIFY=1</span><br><span class=\"line\"><span class=\"built_in\">export</span> DOCKER_HOST=<span class=\"string\">'tcp://0.0.0.0:2375'</span></span><br><span class=\"line\">EOF</span><br><span class=\"line\">$ <span class=\"built_in\">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>\n<p><strong>参考链接:</strong></p>\n<ul>\n<li><a href=\"https://www.cnblogs.com/cheney256/articles/10831307.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/cheney256/articles/10831307.html</a></li>\n<li><a href=\"https://www.cnblogs.com/xiaoliangge/p/9134585.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/xiaoliangge/p/9134585.html</a></li>\n<li><a href=\"https://www.cnblogs.com/lexiaofei/p/6368113.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/lexiaofei/p/6368113.html</a></li>\n</ul>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Containers","path":"api/categories/Containers.json"},{"name":"OperationTools","path":"api/categories/OperationTools.json"}],"tags":[{"name":"Docker","path":"api/tags/Docker.json"}]}