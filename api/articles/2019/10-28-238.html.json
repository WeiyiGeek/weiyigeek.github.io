{"title":"系统用户信息查看设置","slug":"系统运维/Windows/常用命令/系统管理类命令/系统用户信息查看设置与日志","date":"2019-10-28T14:16:30.000Z","updated":"2023-01-31T02:29:10.468Z","url":"2019/10-28-238.html","path":"api/articles/2019/10-28-238.html.json","covers":["https://img.weiyigeek.top/2019/1/20191108151123.png","https://img.weiyigeek.top/2019/1/20191108141753.png","https://img.weiyigeek.top/2019/1/20191108142122.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"1-用户会话操作\"><a href=\"#1-用户会话操作\" class=\"headerlink\" title=\"1.用户会话操作\"></a>1.用户会话操作</h4><h5 id=\"query-命令\"><a href=\"#query-命令\" class=\"headerlink\" title=\"query 命令\"></a>query 命令</h5><p>描述:查询当前计算机或者服务器登录的用户Seesion，以及用户运行的进程和远程桌面会话信息<br>基础语法和参数:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\Users\\Administrator&gt;query /?</span><br><span class=\"line\">QUERY &#123; PROCESS | SESSION | TERMSERVER | USER &#125;</span><br></pre></td></tr></table></figure></p>\n<p>基础实例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#当前计算机登陆的用户</span></span><br><span class=\"line\">query user</span><br><span class=\"line\">query session</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#远程桌面会话查看</span></span><br><span class=\"line\">query termserver</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#用户执行的进程查看</span></span><br><span class=\"line\">query process</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191108151123.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p><br></p>\n<h5 id=\"shadow-命令\"><a href=\"#shadow-命令\" class=\"headerlink\" title=\"shadow 命令\"></a>shadow 命令</h5><p>描述：控制终端用户的操作界面，监视另一个远程桌面服务会话。<br>在默认情况下，我们是看不到终端用户的操作界面的这在某些场合很不方便，比如你想在进行远程操作的同时也让对方能够看到你的操作界面，但终端服务下他是看不到的其实可以通过一些手段让对方看到远程操作的</p>\n<p>基础语法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SHADOW &#123;sessionname | sessionid&#125; [/SERVER:servername] [/V]</span><br><span class=\"line\">arguments：</span><br><span class=\"line\">sessionname         用名称 sessionname 识别会话</span><br><span class=\"line\">sessionid           用 ID sessionid 识别会话</span><br><span class=\"line\">/SERVER:servername  含有该会话的服务器(默认值是当前值)</span><br><span class=\"line\">/V                  显示有关执行的操作的信息</span><br></pre></td></tr></table></figure></p>\n<p><em>过程：(请求远程帮助)</em><br>（1）A用户先登录远程终端服务器，然后进入进入命令行窗口<br>（2）A用户获取当前运行的会话ID。运行”query session”命令，，找出A会话的会话ID，这里是1，当前会话前有一个”&gt;”标志，Console会话表示控制台<br>（3）运行”shadow 会话ID号”，由于上面的A会话ID是1，所以要跟B他远程控制这里命令就是”shadow 2”，在A中会给出一段提示，冻结A用户当前的连接。记住不能自己跟自己shadow。<br>（4）此时B的终端服务界面会出现一个远程控制请求的对话框，如果B同意了请求，那么就可以远程控制和查看A的会话了，此时A仍能随意进行操作，A用户在远程终端的所有操作，都会在B用户的远程终端上面显示。如果要退出，则执行”Logoff”命令即可。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#查看当前计算机登录的用户</span></span><br><span class=\"line\">&gt;query user</span><br><span class=\"line\"> 用户名                会话名             ID  状态    空闲时间   登录时间</span><br><span class=\"line\">&gt;weiyigeek             console             1  运行中      无     2019/11/8 9:05</span><br><span class=\"line\">admin                  console             2  运行中      无     2019/10/8 9:05</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#请求admin远程协助，同意后admin边可以控制和查看weiyigeek账号登录的桌面；</span></span><br><span class=\"line\">shadow 2</span><br></pre></td></tr></table></figure>\n<p><br></p>\n<h5 id=\"reset-命令\"><a href=\"#reset-命令\" class=\"headerlink\" title=\"reset 命令\"></a>reset 命令</h5><p>描述:重置会话可让您从终端服务器重置（删除）会话，类似于Logoff效果<br>基础语法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reset session &#123;SessionName | SessionID&#125; [/server:ServerName] [/v]</span><br></pre></td></tr></table></figure></p>\n<p>请使用 query session 命令确定会话的名称:SessionName 、 SessionID要重置的会话名称/要重置的会话。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例要重置指定为 rdp-tcp#6 的会话，请键入：</span></span><br><span class=\"line\">reset session rdp-tcp<span class=\"comment\">#6</span></span><br><span class=\"line\">​</span><br><span class=\"line\"><span class=\"comment\">#要重置使用会话 ID 3 的会话，请键入：</span></span><br><span class=\"line\">reset session 3</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h5 id=\"logoff-命令\"><a href=\"#logoff-命令\" class=\"headerlink\" title=\"logoff 命令\"></a>logoff 命令</h5><p>描述:终止当前或者远程会话；<br>语法参数:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LOGOFF [sessionname | sessionid] [/SERVER:servername] [/V] [/VM]</span><br><span class=\"line\">  sessionname 会话名。</span><br><span class=\"line\">  sessionid 会话 ID。</span><br><span class=\"line\">  /SERVER:servername 指定含有要注销的用户会话的远程桌面服务器 (默认值是当前值)。</span><br><span class=\"line\">  /V 显示有关所执行操作的信息。</span><br><span class=\"line\">  /VM 注销服务器上或虚拟机中的会话。需要指定该会话的唯一 ID。</span><br></pre></td></tr></table></figure></p>\n<p>案例：注意LOGOFF不能终止Consol的回话<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># C:\\Users\\Administrator&gt;query session</span></span><br><span class=\"line\"><span class=\"comment\">#  会话名            用户名                   ID  状态    类型        设备</span></span><br><span class=\"line\"><span class=\"comment\">#  console                                     3  已连接</span></span><br><span class=\"line\">logoff console</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#终止其他用户的远程会话：</span></span><br><span class=\"line\">logoff rdp-tcp<span class=\"comment\">#0</span></span><br><span class=\"line\">logoff 3 /v</span><br><span class=\"line\">正在注销会话ID 3</span><br></pre></td></tr></table></figure></p>\n<hr>\n\n<h4 id=\"2-用户信息发送\"><a href=\"#2-用户信息发送\" class=\"headerlink\" title=\"2.用户信息发送\"></a>2.用户信息发送</h4><h5 id=\"finger命令\"><a href=\"#finger命令\" class=\"headerlink\" title=\"finger命令\"></a>finger命令</h5><p>描述:查看用户当前的登录信息主机信息；<br>基础语法和参数:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FINGER [-l] [user]@host [...]</span><br><span class=\"line\">  -l        以长列表格式显示信息。</span><br><span class=\"line\">  user      指定需要其信息的用户。省略 user 参数</span><br><span class=\"line\">            将显示与指定主机上所有用户有关的信息。</span><br><span class=\"line\">  @host     指定需要其用户信息的远程系统上的服务器。</span><br></pre></td></tr></table></figure><br>实际案例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">finger username @host 查看最近有哪些用户登陆</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191108141753.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p><br></p>\n<h5 id=\"msg命令\"><a href=\"#msg命令\" class=\"headerlink\" title=\"msg命令\"></a>msg命令</h5><p>描述:将消息发送给用户(Send Message to User)弹出提示窗口;</p>\n<p>基础语法和参数:<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MSG &#123;username | sessionname | sessionid | @filename | *&#125;</span><br><span class=\"line\">    [&#x2F;SERVER:servername] [&#x2F;TIME:seconds] [&#x2F;V] [&#x2F;W] [message]</span><br><span class=\"line\">@filename           识别这样一个文件，该文件含有将所发消息发送到的用户名、会话名和会话标识号的列表。</span><br><span class=\"line\">&#x2F;SERVER:servername  要联系的服务器(默认值是当前值)。</span><br><span class=\"line\">&#x2F;TIME:seconds       等待接收器确认消息的时间延迟。</span><br><span class=\"line\">&#x2F;V         显示有关执行的操作的信息。</span><br><span class=\"line\">&#x2F;W         等待用户的响应，跟 &#x2F;V 一起有用。</span><br></pre></td></tr></table></figure></p>\n<p>实际案例:<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">msg &#x2F;W &#x2F;V * &quot;Anonymouse By Hack!!&quot;</span><br><span class=\"line\">msg %username% &#x2F;time:10 &quot;内容&quot;</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191108142122.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Windows命令","path":"api/categories/Windows命令.json"}],"tags":[{"name":"系统管理","path":"api/tags/系统管理.json"}]}