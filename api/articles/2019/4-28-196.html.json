{"title":"CentOS7.x系统配置记录","slug":"系统运维/Linux/系统配置/CentOS/CentOS7.x系统配置记录","date":"2019-04-28T05:34:30.000Z","updated":"2022-11-24T02:45:01.537Z","url":"2019/4-28-196.html","path":"api/articles/2019/4-28-196.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190428173441.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190428112459.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200108173147.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200108172336.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200622173633.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210627162102.png"],"content":"<p>[TOC]<br><a id=\"more\"></a></p>\n<h3 id=\"0x00-系统初始化\"><a href=\"#0x00-系统初始化\" class=\"headerlink\" title=\"0x00 系统初始化\"></a>0x00 系统初始化</h3><p>CentOS7 初始化脚本:<code>[2020年5月8日 09:09:54]</code><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># @Desc:Centos7安装后初始化脚本</span></span><br><span class=\"line\"><span class=\"comment\"># @Author: WeiyiGeek</span></span><br><span class=\"line\"><span class=\"comment\"># @Time: 2020年5月6日 11:04:42</span></span><br><span class=\"line\"><span class=\"comment\"># @Version: 1.0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m#########\\n#网卡配置\\n##########\\e[0m\"</span></span><br><span class=\"line\">sed -i <span class=\"string\">'s/ONBOOT=no/ONBOOT=yes/g'</span> /etc/sysconfig/network-scripts/ifcfg-ens192</span><br><span class=\"line\">sed -i <span class=\"string\">'s/BOOTPROTO=dhcp/BOOTPROTO=static/g'</span> /etc/sysconfig/network-scripts/ifcfg-ens192</span><br><span class=\"line\">sed -i <span class=\"string\">'s/BOOTPROTO=\\\"dhcp\\\"/BOOTPROTO=\\\"static\\\"/g'</span> /etc/sysconfig/network-scripts/ifcfg-ens192</span><br><span class=\"line\">cat &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-ens192 &lt;&lt;EOF</span><br><span class=\"line\">IPADDR=10.10.107.192</span><br><span class=\"line\">NETMASK=255.255.255.0</span><br><span class=\"line\">GATEWAY=10.10.107.1</span><br><span class=\"line\">EOF</span><br><span class=\"line\">service network restart</span><br><span class=\"line\"><span class=\"built_in\">echo</span> nameserver 223.6.6.6 &gt;&gt; /etc/resolv.conf</span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e<span class=\"string\">\"--[网卡配置结束]--\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m#########\\n#SSH服务配置\\n#########\\e[0m\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'PermitRootLogin yes'</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'PasswordAuthentication yes'</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class=\"line\">systemctl restart sshd</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"--[SSH服务配置结束]--\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m#########\\n#Yum源设定\\n#########\\e[0m\"</span></span><br><span class=\"line\">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class=\"line\">curl -o /etc/yum.repos.d/CentOS-epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class=\"line\">yum clean all</span><br><span class=\"line\">yum makecache</span><br><span class=\"line\">yum update -y &amp;&amp; yum upgrade -y &amp;&amp;  yum -y install epel*</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"--[YUM替换更新应用软件完成]--\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m#########\\n#系统内核版本升级\\n#########\\e[0m\"</span></span><br><span class=\"line\">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br><span class=\"line\">yum -y install https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm</span><br><span class=\"line\">yum --disablerepo=<span class=\"string\">\"*\"</span> --enablerepo=elrepo-kernel repolist</span><br><span class=\"line\">yum --disablerepo=<span class=\"string\">\"*\"</span> --enablerepo=elrepo-kernel list kernel*</span><br><span class=\"line\">yum -y --enablerepo=elrepo-kernel install kernel-ml.x86_64 kernel-ml-devel.x86_64 </span><br><span class=\"line\">awk -F \\<span class=\"string\">' '</span><span class=\"variable\">$1</span>==<span class=\"string\">\"menuentry \"</span> &#123;<span class=\"built_in\">print</span> i++ <span class=\"string\">\" : \"</span> <span class=\"variable\">$2</span>&#125;<span class=\"string\">' /etc/grub2.cfg</span></span><br><span class=\"line\"><span class=\"string\">sudo grub2-set-default 0</span></span><br><span class=\"line\"><span class=\"string\">reboot</span></span><br><span class=\"line\"><span class=\"string\">#yum -y --enablerepo=elrepo-kernel install kernel-ml-tools.x86_64 </span></span><br><span class=\"line\"><span class=\"string\">#sudo grub2-set-default 0</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">echo -e \"\\n############################\\n#安装常用的运维软件\\n####################################\\n\"</span></span><br><span class=\"line\"><span class=\"string\">#编译依赖</span></span><br><span class=\"line\"><span class=\"string\">yum install -y gcc gcc-c++ openssl-devel bzip2-devel</span></span><br><span class=\"line\"><span class=\"string\">#常规软件</span></span><br><span class=\"line\"><span class=\"string\">yum install -y nano vim net-tools tree wget dos2unix unzip htop ncdu bash-completion </span></span><br><span class=\"line\"><span class=\"string\">echo \"--[安装安装完成]--\"</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">echo -e \"\\n############################\\n#bash终端美化\\n####################################\\n\"</span></span><br><span class=\"line\"><span class=\"string\">yum install -y git</span></span><br><span class=\"line\"><span class=\"string\">git clone --depth=1 \\</span></span><br><span class=\"line\"><span class=\"string\">https://github.com/Bash-it/bash-it.git \\</span></span><br><span class=\"line\"><span class=\"string\">~/.bash_it</span></span><br><span class=\"line\"><span class=\"string\">cd !$ &amp;&amp;  ./install.sh -s</span></span><br></pre></td></tr></table></figure></p>\n<hr>\n<h3 id=\"0x01-基础配置\"><a href=\"#0x01-基础配置\" class=\"headerlink\" title=\"0x01 基础配置\"></a>0x01 基础配置</h3><h4 id=\"0-CentOS镜像源\"><a href=\"#0-CentOS镜像源\" class=\"headerlink\" title=\"0. CentOS镜像源\"></a>0. CentOS镜像源</h4><p>官方镜像列表状态地址:</p>\n<ul>\n<li>CentOS：<a href=\"http://mirror-status.centos.org/#cn\" target=\"_blank\" rel=\"noopener\">http://mirror-status.centos.org/#cn</a></li>\n<li>Archlinux：<a href=\"https://www.archlinux.org/mirrors/status/\" target=\"_blank\" rel=\"noopener\">https://www.archlinux.org/mirrors/status/</a></li>\n<li>Ubuntu：<a href=\"https://launchpad.net/ubuntu/+cdmirrors\" target=\"_blank\" rel=\"noopener\">https://launchpad.net/ubuntu/+cdmirrors</a></li>\n<li>Debian：<a href=\"http://mirror.debian.org/status.html\" target=\"_blank\" rel=\"noopener\">http://mirror.debian.org/status.html</a></li>\n<li>Fedora Linux/Fedora EPEL：<a href=\"https://admin.fedoraproject.org/mirrormanager/mirrors\" target=\"_blank\" rel=\"noopener\">https://admin.fedoraproject.org/mirrormanager/mirrors</a></li>\n<li>Apache：<a href=\"http://www.apache.org/mirrors/#cn\" target=\"_blank\" rel=\"noopener\">http://www.apache.org/mirrors/#cn</a></li>\n<li>Cygwin：<a href=\"https://www.cygwin.com/mirrors.html\" target=\"_blank\" rel=\"noopener\">https://www.cygwin.com/mirrors.html</a></li>\n</ul>\n<p>建议使用阿里云的源其他发行版等同：<a href=\"http://mirrors.aliyun.com/help/centos\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/help/centos</a></p>\n<p>Aliyun下载最新的CentOS-Base.repo 到/etc/yum.repos.d/<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#备份CentOS-Base.repo</span></span><br><span class=\"line\">$ mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#下载更新源</span></span><br><span class=\"line\">CentOS 5：wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-5.repo</span><br><span class=\"line\">CentOS 6：wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo</span><br><span class=\"line\">CentOS 7：wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#清除源数据并生成镜像缓存</span></span><br><span class=\"line\">yum clean all</span><br><span class=\"line\">yum makecache</span><br><span class=\"line\">yum update</span><br></pre></td></tr></table></figure></p>\n<p>注意：不建议使用yum进行删除软件,因为他会删除多余得依赖程序,导致意外发生（运维必须注意）</p>\n<hr>\n\n<h4 id=\"1-CentOS7-x内核升级流程\"><a href=\"#1-CentOS7-x内核升级流程\" class=\"headerlink\" title=\"1. CentOS7.x内核升级流程\"></a>1. CentOS7.x内核升级流程</h4><p>系统环境：CentOS Linux release 7.6.1810 (Core)<br>升级原因：在使用 Docker 时发现其对 Linux 内核版本的最低要求是 3.10（这也刚好是 CentOS 7.6 的内核版本），但是在这个版本上有部分功能无法实现。<br>注：对于线上环境的内核版本还需要根据实际情况谨慎选择，越新的版本未来可能遇到的问题越多；</p>\n<p>Linux 内核分两种：</p>\n<ul>\n<li>官方内核（通常是内核开发人员用）<a href=\"https://www.kernel.org/\" target=\"_blank\" rel=\"noopener\">https://www.kernel.org/</a></li>\n<li>各大 Linux 发行版内核（一般用户常用）</li>\n</ul>\n<ul>\n<li>测试环境：<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#系统 \t当前内核版本 \t小版本升级</span></span><br><span class=\"line\">CentOS 7.7 \t3.10.0-957 \t3.10.0-957.5.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#系统 \t当前内核版本 \t大版本升级</span></span><br><span class=\"line\">CentOS 7.7 \t3.10.0-957 \t4.20.12-1</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>CentOS和Fedora都是基于Redhat的常见Linux分支。</p>\n<ul>\n<li>CentOS是目前企业级服务器的常用操作系统</li>\n<li>Fedora则主要面向个人桌面用户</li>\n</ul>\n<p>关于内核版本的定义：<br>版本性质：主分支版本ml(mainline)，稳定版(stable)，长期维护版lt(longterm-long term support),内核预发行版(内核预发行版本)</p>\n<p>版本命名格式为 ：A.B.C<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">A:是内核版本号：版本号只有在代码和内核的概念有重大改变的时候才会改变，历史上有两次变化：</span><br><span class=\"line\">第一次是1994年的 1.0 版，第二次是1996年的 2.0 版，第三次是2011年的 3.0 版发布，但这次在内核的概念上并没有发生大的变化</span><br><span class=\"line\"></span><br><span class=\"line\">B:是内核主版本号：主版本号根据传统的奇-偶系统版本编号来分配：奇数为开发版，偶数为稳定版</span><br><span class=\"line\"></span><br><span class=\"line\">C:是内核次版本号：次版本号是无论在内核增加安全补丁、修复bug、实现新的特性或者驱动时都会改变</span><br></pre></td></tr></table></figure></p>\n<p><strong>Linux 发行版内核</strong><br>一般来说只有从 kernel.org 下载并编译安装的内核才是官方内核;大多数 Linux 发行版提供自行维护的内核，可以通过 yum 或 rpm 等包管理系统升级(仓库升级内核);</p>\n<p>各大 Linux 发行版（RedHat、Ubuntu、CentOS 等）在内核基础上集成了其他的一系列软件，按照各自的版本规则发布;使用 uname -r 区分你用的是官方内核还是 Linux 发行版内核，横线后面有任何东西都表示这不是官方内核;<br>例如: 3.10.0-514.26.2.el7.x86_64,表示对应的 Linux 内核版本是 3.10,后面514是代表发行版规则编号;</p>\n<p><strong>虚拟文件系统</strong><br>内核空间和用户空间通过 /proc 虚拟文件系统可以通信; /proc 目录中包含一些目录和虚拟文件，这些虚拟文件可以向用户呈现内核信息或者从用户空间向内核发送信息。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@zabbix ~]<span class=\"comment\"># cat /proc/version</span></span><br><span class=\"line\">Linux version 3.10.0-957.10.1.el7.x86_64 (mockbuild@kbuilder.bsys.centos.org) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-36) (GCC) ) <span class=\"comment\">#1 SMP Mon Mar 18 15:06:45 UTC 2019</span></span><br><span class=\"line\"></span><br><span class=\"line\">cpuinfo：标识了处理器的类型和速度</span><br><span class=\"line\">pci：显示在 PCI 总线上找到的设备</span><br><span class=\"line\">modules：当前加载到内核中的模块</span><br><span class=\"line\">version：系统版本及内核版本</span><br></pre></td></tr></table></figure></p>\n<p><em>（1）小版本升级流程步骤：</em><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1.查看当前和可升级版本</span></span><br><span class=\"line\">yum list kernel</span><br><span class=\"line\">Installed Packages</span><br><span class=\"line\">kernel.x86_64  3.10.0-957.el7         @anaconda</span><br><span class=\"line\">Available Packages</span><br><span class=\"line\">kernel.x86_64  3.10.0-957.5.1.el7     updates  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2 升级</span></span><br><span class=\"line\">yum update kernel -y </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3.重启并检查</span></span><br><span class=\"line\">reboot 　　</span><br><span class=\"line\">uname -r</span><br></pre></td></tr></table></figure></p>\n<p><em>（2）大版本升级流程步骤：</em></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1. 首先更新仓库</span></span><br><span class=\"line\">yum -y update</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2. 启用 ELRepo 仓库</span></span><br><span class=\"line\"><span class=\"comment\">#ELRepo 仓库是基于社区的用于企业级 Linux 仓库，提供对 RedHat Enterprise (RHEL) 和 其他基于 RHEL的 Linux 发行版（CentOS、Scientific、Fedora 等）的支持。 </span></span><br><span class=\"line\"><span class=\"comment\">#ELRepo 聚焦于和硬件相关的软件包，包括文件系统驱动、显卡驱动、网络驱动、声卡驱动和摄像头驱动等</span></span><br><span class=\"line\"><span class=\"comment\">##--enablerepo 选项开启 CentOS 系统上的指定仓库,默认开启的是 elrepo这里用 elrepo-kernel 替换</span></span><br><span class=\"line\">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br><span class=\"line\">yum -y install https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm</span><br><span class=\"line\"><span class=\"comment\">#rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm</span></span><br><span class=\"line\"><span class=\"comment\">#rpm -Uvh http://www.elrepo.org/elrepo-release-6-6.el6.elrepo.noarch.rpm  #Centos 6 YUM源</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3.载入elrepo-kernel元数据</span></span><br><span class=\"line\">yum --disablerepo=<span class=\"string\">\"*\"</span> --enablerepo=elrepo-kernel repolist</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4.仓库启用后，你可以使用下面的命令列出可用的内核相关包</span></span><br><span class=\"line\">yum --disablerepo=<span class=\"string\">\"*\"</span> --enablerepo=elrepo-kernel list kernel*</span><br><span class=\"line\">yum --disablerepo=<span class=\"string\">\"*\"</span> --enablerepo=<span class=\"string\">\"elrepo-kernel\"</span> list available</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#长期维护版本lt为4.4，最新主线稳定版ml为5.0</span></span><br><span class=\"line\"><span class=\"comment\"># elrepo-kernel                       | 2.9 kB     00:00</span></span><br><span class=\"line\"><span class=\"comment\"># elrepo-kernel/primary_db              | 1.8 MB   00:05</span></span><br><span class=\"line\"><span class=\"comment\"># Available Packages</span></span><br><span class=\"line\"><span class=\"comment\"># kernel-lt.x86_64         4.4.179-1.el7.elrepo elrepo-kernel</span></span><br><span class=\"line\"><span class=\"comment\"># kernel-lt-devel.x86_64   4.4.179-1.el7.elrepo elrepo-kernel</span></span><br><span class=\"line\"><span class=\"comment\"># kernel-lt-doc.noarch     4.4.179-1.el7.elrepo elrepo-kernel</span></span><br><span class=\"line\"><span class=\"comment\"># kernel-lt-headers.x86_64 4.4.179-1.el7.elrepo elrepo-kernel</span></span><br><span class=\"line\"><span class=\"comment\"># kernel-lt-tools.x86_64   4.4.179-1.el7.elrepo elrepo-kernel</span></span><br><span class=\"line\"><span class=\"comment\"># kernel-lt-tools-libs.x86_64 4.4.179-1.el7.elrepo elrepo-kernel</span></span><br><span class=\"line\"><span class=\"comment\"># kernel-lt-tools-libs-devel.x86_64 4.4.179-1.el7.elrepo elrepo-kernel</span></span><br><span class=\"line\"><span class=\"comment\"># kernel-ml.x86_64         5.0.10-1.el7.elrepo  elrepo-kernel</span></span><br><span class=\"line\"><span class=\"comment\"># kernel-ml-devel.x86_64   5.0.10-1.el7.elrepo  elrepo-kernel</span></span><br><span class=\"line\"><span class=\"comment\"># kernel-ml-doc.noarch     5.0.10-1.el7.elrepo  elrepo-kernel</span></span><br><span class=\"line\"><span class=\"comment\"># kernel-ml-headers.x86_64 5.0.10-1.el7.elrepo  elrepo-kernel</span></span><br><span class=\"line\"><span class=\"comment\"># kernel-ml-tools.x86_64   5.0.10-1.el7.elrepo  elrepo-kernel</span></span><br><span class=\"line\"><span class=\"comment\"># kernel-ml-tools-libs.x86_64</span></span><br><span class=\"line\"><span class=\"comment\">#                          5.0.10-1.el7.elrepo  elrepo-kernel</span></span><br><span class=\"line\"><span class=\"comment\"># kernel-ml-tools-libs-devel.x86_64</span></span><br><span class=\"line\"><span class=\"comment\">#                          5.0.10-1.el7.elrepo  elrepo-kernel</span></span><br><span class=\"line\"><span class=\"comment\"># perf.x86_64              5.0.10-1.el7.elrepo  elrepo-kernel</span></span><br><span class=\"line\"><span class=\"comment\"># python-perf.x86_64       5.0.10-1.el7.elrepo  elrepo-kernel</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#5.我们需要安装最新的主线稳定内核，使用如下命令：(以后这台机器升级内核直接运行这句就可升级为最新稳定版)</span></span><br><span class=\"line\">yum --disablerepo=<span class=\"string\">\"*\"</span> --enablerepo=elrepo-kernel install  kernel-ml.x86_64  -y</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#6.删除旧与安装新版本工具包</span></span><br><span class=\"line\">yum remove kernel-tools-libs.x86_64 kernel-tools.x86_64  -y</span><br><span class=\"line\">yum --disablerepo=<span class=\"string\">\"*\"</span> --enablerepo=elrepo-kernel install kernel-ml-tools.x86_64  -y</span><br><span class=\"line\"><span class=\"comment\"># 删除旧内核（可选）内核有两种删除方式：通过 yum remove 命令或通过 yum-utils 工具。</span></span><br><span class=\"line\"><span class=\"comment\"># rpm -qa | grep kernel  #删除旧内核的 RPM 包</span></span><br><span class=\"line\"><span class=\"comment\">#yum remove [上面查询出来得包]</span></span><br><span class=\"line\"><span class=\"comment\">#如果安装的内核不多于 3 个yum-utils 工具不会删除任何一个，只有在安装的内核大于 3 个时，才会自动删除旧内核。</span></span><br><span class=\"line\"><span class=\"comment\"># yum install yum-utils #安装工具</span></span><br><span class=\"line\"><span class=\"comment\"># package-cleanup --oldkernels  #删除工具</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#7.一步到位</span></span><br><span class=\"line\">yum -y --enablerepo=elrepo-kernel install kernel-ml.x86_64 kernel-ml-devel.x86_64</span><br></pre></td></tr></table></figure>\n<p>内核升级完毕后，目前内核还是默认的版本，需要进行内核版本插入顺序修改:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#8.我们可以通过命令查看默认启动顺序，然后修改grub中默认的内核版本：</span></span><br><span class=\"line\">$ awk -F \\<span class=\"string\">' '</span><span class=\"variable\">$1</span>==<span class=\"string\">\"menuentry \"</span> &#123;<span class=\"built_in\">print</span> i++ <span class=\"string\">\" : \"</span> <span class=\"variable\">$2</span>&#125;<span class=\"string\">' /etc/grub2.cfg</span></span><br><span class=\"line\"><span class=\"string\">0 : CentOS Linux (4.20.12-1.el7.elrepo.x86_64) 7 (Core)</span></span><br><span class=\"line\"><span class=\"string\">1 : CentOS Linux (3.10.0-957.5.1.el7.x86_64) 7 (Core)</span></span><br><span class=\"line\"><span class=\"string\">2 : CentOS Linux (3.10.0-957.el7.x86_64) 7 (Core)</span></span><br><span class=\"line\"><span class=\"string\">3 : CentOS Linux (0-rescue-ca0f6fb3c5f24478abc0a2e275281d7a) 7 (Core)</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">#说明：</span></span><br><span class=\"line\"><span class=\"string\"># - 默认新内核是从头插入，默认启动顺序也是从0开始（当前顺序还未生效）或者使用</span></span><br><span class=\"line\"><span class=\"string\"># - 其中文件 /etc/grub2.cfg 和 /boot/grub2/grub.cfg 内容一致</span></span><br><span class=\"line\"><span class=\"string\">$ grep \"^menuentry\" /boot/grub2/grub.cfg | cut -d \"'</span><span class=\"string\">\" -f2</span></span><br><span class=\"line\"><span class=\"string\">CentOS Linux (4.20.12-1.el7.elrepo.x86_64) 7 (Core)</span></span><br><span class=\"line\"><span class=\"string\">CentOS Linux (3.10.0-957.5.1.el7.x86_64) 7 (Core)</span></span><br><span class=\"line\"><span class=\"string\">CentOS Linux (3.10.0-957.el7.x86_64) 7 (Core)</span></span><br><span class=\"line\"><span class=\"string\">CentOS Linux (0-rescue-ca0f6fb3c5f24478abc0a2e275281d7a) 7 (Core)</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">#9.查看当前实际启动顺序</span></span><br><span class=\"line\"><span class=\"string\"><span class=\"variable\">$grub2</span>-editenv list</span></span><br><span class=\"line\"><span class=\"string\">saved_entry=CentOS Linux (3.10.0-957.5.1.el7.x86_64) 7 (Core)</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">#10.设置默认启动</span></span><br><span class=\"line\"><span class=\"string\">sudo grub2-set-default 'CentOS Linux (4.20.12-1.el7.elrepo.x86_64) 7 (Core)'#方式1</span></span><br><span class=\"line\"><span class=\"string\">sudo grub2-set-default 0  #方式2</span></span><br><span class=\"line\"><span class=\"string\">grub2-editenv list</span></span><br><span class=\"line\"><span class=\"string\">saved_entry=CentOS Linux (4.20.12-1.el7.elrepo.x86_64) 7 (Core)</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">#由上面可以看出新内核(5.0.10)目前位置在0，原来的内核(3.10.0)目前位置在1，所以如果想生效最新的内核，还需要我们修改内核的启动顺序为0：</span></span><br><span class=\"line\"><span class=\"string\"># vim /etc/default/grub</span></span><br><span class=\"line\"><span class=\"string\"># GRUB_DEFAULT = 0</span></span><br><span class=\"line\"><span class=\"string\">#注：Centos 6 更改的文件相同，使用命令确定新内核位置后，然后将参数default更改为0即可。</span></span><br><span class=\"line\"><span class=\"string\">#接着运行grub2-mkconfig命令来重新创建内核配置，如下：</span></span><br><span class=\"line\"><span class=\"string\">#grub2-mkconfig -o /boot/grub2/grub.cfg</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">#11.修改grub中默认的内核版本后重新启动</span></span><br><span class=\"line\"><span class=\"string\">reboot</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190428173441.png\" alt=\"WeiyiGeek.grub\" title=\"\" class=\"\">\n                <p>WeiyiGeek.grub</p>\n            </figure></p>\n<p>补充说明:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grub2-set-default 0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#传统启动方式</span></span><br><span class=\"line\">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class=\"line\">grubby --default-kernel</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#UEFI启动方式</span></span><br><span class=\"line\">grub2-mkconfig -o /boot/efi/EFI/centos/grub.cfg</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p>方法2：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#对于一些无法上网的服务器，或者需要安装指定版本内核的需求，我们可以把kernel image的rpm包下载下来安装，下载地址如下：</span></span><br><span class=\"line\">下载指定版本 kernel： http://rpm.pbone.net/index.php3?<span class=\"built_in\">stat</span>=3&amp;<span class=\"built_in\">limit</span>=1&amp;srodzaj=3&amp;dl=40&amp;search=kernel</span><br><span class=\"line\">下载指定版本 kernel-devel：http://rpm.pbone.net/index.php3?<span class=\"built_in\">stat</span>=3&amp;<span class=\"built_in\">limit</span>=1&amp;srodzaj=3&amp;dl=40&amp;search=kernel-devel</span><br><span class=\"line\"></span><br><span class=\"line\">官方 Centos 6: http://elrepo.org/linux/kernel/el6/x86_64/RPMS/</span><br><span class=\"line\">官方 Centos 7: http://elrepo.org/linux/kernel/el7/x86_64/RPMS/</span><br><span class=\"line\">历史版本:http://mirror.rc.usf.edu/elrepo/kernel/el7/x86_64/RPMS/</span><br><span class=\"line\">历史版本:http://ftp.osuosl.org/pub/elrepo/kernel/el7/x86_64/RPMS/</span><br><span class=\"line\"></span><br><span class=\"line\">将rpm包下载上传到服务器上，使用下面的命令安装即可：</span><br><span class=\"line\"><span class=\"comment\"># yum -y install kernel-ml-devel-4.12.4-1.el7.elrepo.x86_64.rpm </span></span><br><span class=\"line\"><span class=\"comment\"># yum -y install kernel-ml-4.12.4-1.el7.elrepo.x86_64.rpm</span></span><br><span class=\"line\"><span class=\"comment\">#rpm -ivh kernel-ml-headers-5.2.4-1.el7.elrepo.x86_64.rpm</span></span><br><span class=\"line\"><span class=\"comment\">#rpm -ivh kernel-ml-devel-5.2.4-1.el7.elrepo.x86_64.rpm</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p>方法3：<br>还可以通过源码包编译安装，这种方式可定制性强但也比较复杂，有需要的可自行查找资料安装，下面只给出各系统版本内核源码包的下载地址：<a href=\"https://www.kernel.org/pub/linux/kernel/\" target=\"_blank\" rel=\"noopener\">https://www.kernel.org/pub/linux/kernel/</a></p>\n<p>补充:</p>\n<ul>\n<li>yum如何禁止内核更新?<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 在yum update的时不会更新内核</span></span><br><span class=\"line\">vim /etc/yum.conf</span><br><span class=\"line\">exclude=kernel* centos-release <span class=\"comment\">#在[main]部分加上</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<hr>\n\n<h4 id=\"2-CentOS7-x网卡名称更改\"><a href=\"#2-CentOS7-x网卡名称更改\" class=\"headerlink\" title=\"2. CentOS7.x网卡名称更改\"></a>2. CentOS7.x网卡名称更改</h4><p>系统环境：CentOS Linux release 7.6.1810 (Core)</p>\n<p><strong>默认网卡信息：</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@data1 network-scripts]<span class=\"comment\"># ip addr | grep \"enp\"</span></span><br><span class=\"line\">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class=\"line\">link/ether 08:00:27:46:9b:14 brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">3: enp0s8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class=\"line\">link/ether 08:00:27:36:63:b1 brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">4: enp0s9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class=\"line\">link/ether 08:00:27:0b:01:7d brd ff:ff:ff:ff:ff:ff</span><br></pre></td></tr></table></figure><br>目的：将上面得enp0s3/8/9 得网卡名称变成 eth0/1/2,以下是配置流程：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#网卡配置目录</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /etc/sysconfig/network-scripts</span><br><span class=\"line\"><span class=\"comment\">#1. 更改网卡名称 （目录中自留下网卡名称得ifcfg-文件，将默认得要删除）</span></span><br><span class=\"line\">[root@data1 network-scripts]<span class=\"comment\"># ls ifcfg-*</span></span><br><span class=\"line\">ifcfg-eth0  ifcfg-eth1  ifcfg-eth2  ifcfg-lo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2. 修改各个网卡得配置文件</span></span><br><span class=\"line\">sed -i <span class=\"string\">'s/NAME=enp0s3/NAME=eth1/g'</span> ifcfg-eth1</span><br><span class=\"line\">sed -i <span class=\"string\">'s/DEVICE=enp0s3/DEVICE=eth1/g'</span> ifcfg-eth1</span><br><span class=\"line\"></span><br><span class=\"line\">sed -i <span class=\"string\">'s/NAME=enp0s3/NAME=eth2/g'</span> ifcfg-eth2</span><br><span class=\"line\">sed -i <span class=\"string\">'s/DEVICE=enp0s3/DEVICE=eth2/g'</span> ifcfg-eth2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3. 关闭\"一致性网络设备命名法”</span></span><br><span class=\"line\">cp /etc/sysconfig/grub /etc/sysconfig/grub.bak</span><br><span class=\"line\">在 GRUB_CMDLINE_LINUX 添加 net.ifnames=0 biosdevname=0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#修改后更新GRUB、内核配置</span></span><br><span class=\"line\">$ grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class=\"line\">Generating grub configuration file ...</span><br><span class=\"line\">Found linux image: /boot/vmlinuz-3.10.0-957.el7.x86_64</span><br><span class=\"line\">Found initrd image: /boot/initramfs-3.10.0-957.el7.x86_64.img</span><br><span class=\"line\">Found linux image: /boot/vmlinuz-0-rescue-a21bd1at\t\t\t810ca4597ae7f6a7c26299389</span><br><span class=\"line\">Found initrd image: /boot/initramfs-0-rescue-a21bd1a810ca4597ae7f6a7c26299389.img</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4. 添加设备规则配置文件</span></span><br><span class=\"line\"><span class=\"comment\">#修改/etc/udev/rules.d/70-persistent-net.rules，没有该文件则新建文件</span></span><br><span class=\"line\"><span class=\"comment\">#注意MAC地址与NAME相匹配（可以用ip addr查看）</span></span><br><span class=\"line\">SUBSYSTEM==<span class=\"string\">\"net\"</span>, ACTION==<span class=\"string\">\"add\"</span>, DRIVERS==<span class=\"string\">\"?*\"</span>, ATTR&#123;address&#125;==<span class=\"string\">\"08:00:27:46:9b:14\"</span>, ATTR&#123;<span class=\"built_in\">type</span>&#125;==<span class=\"string\">\"1\"</span>, KERNEL==<span class=\"string\">\"eth*\"</span>, NAME=<span class=\"string\">\"eth0\"</span></span><br><span class=\"line\">SUBSYSTEM==<span class=\"string\">\"net\"</span>, ACTION==<span class=\"string\">\"add\"</span>, DRIVERS==<span class=\"string\">\"?*\"</span>, ATTR&#123;address&#125;==<span class=\"string\">\"08:00:27:36:63:b1\"</span>, ATTR&#123;<span class=\"built_in\">type</span>&#125;==<span class=\"string\">\"1\"</span>, KERNEL==<span class=\"string\">\"eth*\"</span>, NAME=<span class=\"string\">\"eth1\"</span></span><br><span class=\"line\">SUBSYSTEM==<span class=\"string\">\"net\"</span>, ACTION==<span class=\"string\">\"add\"</span>, DRIVERS==<span class=\"string\">\"?*\"</span>, ATTR&#123;address&#125;==<span class=\"string\">\"08:00:27:0b:01:7d\"</span>, ATTR&#123;<span class=\"built_in\">type</span>&#125;==<span class=\"string\">\"1\"</span>, KERNEL==<span class=\"string\">\"eth*\"</span>, NAME=<span class=\"string\">\"eth2\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#5. 配置完成后重启系统即可</span></span><br><span class=\"line\"><span class=\"variable\">$reboot</span>  <span class=\"comment\">#重启后ip addr 查看修改得网卡信息</span></span><br><span class=\"line\">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class=\"line\">    link/ether 08:00:27:46:9b:14 brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">    inet 10.0.2.15/24 brd 10.0.2.255 scope global noprefixroute dynamic eth0</span><br><span class=\"line\">3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class=\"line\">    link/ether 08:00:27:36:63:b1 brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">4: eth2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class=\"line\">    link/ether 08:00:27:0b:01:7d brd ff:ff:ff:ff:ff:ff</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190428112459.png\" alt=\"WeiyiGeek.grub修改\" title=\"\" class=\"\">\n                <p>WeiyiGeek.grub修改</p>\n            </figure></p>\n<ol start=\"6\">\n<li>脚本更改<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> RENMAE_NIC()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"built_in\">local</span> _NICNAME=$(ip addr | grep <span class=\"string\">\"^2\"</span>|awk -F <span class=\"string\">\": \"</span> <span class=\"string\">'&#123;print $2&#125;'</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [[ <span class=\"variable\">$&#123;_NICNAME&#125;</span> != <span class=\"string\">\"eth0\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[40;31m The nic name is [\\e[40;31m<span class=\"variable\">$&#123;_NICNAME&#125;</span>\\e[40;31m].\\n\\e[0m Rename nic name to 'eth0'.\\e[0m\"</span></span><br><span class=\"line\">    sed -i <span class=\"string\">'s/dhcp/static/g'</span> /etc/sysconfig/network-scripts/ifcfg-<span class=\"variable\">$&#123;_NICNAME&#125;</span></span><br><span class=\"line\">    sed -i s/<span class=\"string\">\"^NAME=.*$\"</span>/<span class=\"string\">\"NAME=eth0\"</span>/g /etc/sysconfig/network-scripts/ifcfg-<span class=\"variable\">$&#123;_NICNAME&#125;</span></span><br><span class=\"line\">    sed -i s/<span class=\"string\">\"^DEVICE=.*$\"</span>/<span class=\"string\">\"DEVICE=eth0\"</span>/g /etc/sysconfig/network-scripts/ifcfg-<span class=\"variable\">$&#123;_NICNAME&#125;</span></span><br><span class=\"line\">    sed -i <span class=\"string\">'/IPV6/d'</span> /etc/sysconfig/network-scripts/ifcfg-<span class=\"variable\">$&#123;_NICNAME&#125;</span></span><br><span class=\"line\">    mv /etc/sysconfig/network-scripts/ifcfg-<span class=\"variable\">$&#123;_NICNAME&#125;</span> /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class=\"line\">    sed -i s/<span class=\"string\">'rhgb quiet\"$'</span>/<span class=\"string\">'net.ifnames=0 biosdevname=0 rhgb quiet\"'</span>/g /etc/default/grub</span><br><span class=\"line\">    grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m The nic name has renamed.\\n Rstart Now.\\e[0m\"</span></span><br><span class=\"line\">    reboot</span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"built_in\">unset</span> <span class=\"built_in\">local</span> _NICNAME</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">RENMAE_NIC</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p><em>注意事项:</em></p>\n<ul>\n<li>如果没有”配置-4添加设备规则配置文件”这步，其他不变，系统重启后将使用eth0、eth1、eth2、…这样的网卡名，此时系统会尝试启动配置文件（eno16等）描述的网卡，但网卡不存在，这些网卡将启动失败，并且开机后无法重启网络，提示failed to start lsb:bring up/down巴拉巴拉~</li>\n<li>/etc/sysconfig/network-scripts这里目录里的网卡配置文件不要有多余的，每个ifcfg-xxxx对应且仅对应一个网卡，否则容易造成重启网络失败，提示failed to start lsb:bring up/dow</li>\n</ul>\n<hr>\n\n<h4 id=\"3-CentOS7-x密码忘记更改\"><a href=\"#3-CentOS7-x密码忘记更改\" class=\"headerlink\" title=\"3. CentOS7.x密码忘记更改\"></a>3. CentOS7.x密码忘记更改</h4><p><strong>方式1:（如有登陆次数则不行）</strong></p>\n<ul>\n<li>Step1.在GURB界面按 e 键</li>\n<li>Step2.拉到底部在 “<code>LANG=zh_cn.UTF-8</code>“ 同行后面加上“<code>init=/bin/sh</code>” </li>\n<li>Step3.按<code>Ctrl+X</code>进入“单用户模式”</li>\n<li>Step4.执行<code>passwd root</code>重新设置Root密码</li>\n<li>Step5.创建文件标签.autorelabel:<code>touch /.autorelabel</code></li>\n<li>Step6.并退出执行exit or reboot;</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200108173147.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n<p><br></p>\n<p><strong>方式2：</strong></p>\n<ul>\n<li>1.开机后在选择菜单时按下e进入编辑模式</li>\n<li>2.选择 <code>linux16 /vmlinuz-0-resuce</code> 这一行在行末尾添加 <code>rd.break</code></li>\n<li>3.执行 <code>Ctrl+x</code>  进入单用户shell模式</li>\n<li>4.重新设置root密码的shell命令<ul>\n<li>重新挂载根目录为读写模式 <code>mount -o remount, rw /sysroot</code></li>\n<li>切换到系统真正的根目录下 <code>chroot  /sysroot</code></li>\n<li>修改密码 <code>passwd root</code></li>\n<li>创建文件标签.autorelabel:<code>touch /.autorelabel</code></li>\n<li>退出编辑模式  exit（2次）</li>\n</ul>\n</li>\n<li>5.然后系统自动重启，使用新密码重新登录；</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200108172336.png\" alt=\"WeiyiGeek.centos7密码重置\" title=\"\" class=\"\">\n                <p>WeiyiGeek.centos7密码重置</p>\n            </figure>\n<hr>\n<h4 id=\"4-账号被锁定进入系统急救模式清除登陆失败次数\"><a href=\"#4-账号被锁定进入系统急救模式清除登陆失败次数\" class=\"headerlink\" title=\"4.账号被锁定进入系统急救模式清除登陆失败次数\"></a>4.账号被锁定进入系统急救模式清除登陆失败次数</h4><p>流程步骤:</p>\n<ul>\n<li>(1) 重启 Linux系统主机并出现引导界面时按下键盘上的 e 键进入内核编辑界面</li>\n<li>(2) 在Linux16参数这行后<code>追加&quot;rd.break&quot;参数</code>,然后按下<code>Ctrl + X组合键</code> 来运行修改过的内核程序，然后进入到系统的紧急救援模式;<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200622173633.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></li>\n<li>(3) 挂载系统根目录并且进行根目录的切换工作<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mount -o remount,rw /sysroot</span><br><span class=\"line\">chroot /sysroot</span><br></pre></td></tr></table></figure></li>\n<li>(4) 查看被锁定的账号并清空失败次数<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pam_tally2 --user=root</span><br><span class=\"line\">pam_tally2 --user=root --reset</span><br><span class=\"line\">pam_tally2 --user=root</span><br></pre></td></tr></table></figure></li>\n<li>(5) 补充说明:如果密码忘记此时可以采用passwd进行更换密码<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">exit</span> <span class=\"comment\">#退出</span></span><br><span class=\"line\">reboot <span class=\"comment\">#重启</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<h4 id=\"5-locale-区域语言设置\"><a href=\"#5-locale-区域语言设置\" class=\"headerlink\" title=\"5.locale 区域语言设置\"></a>5.locale 区域语言设置</h4><p>Step 1.常用Language Codes Reference<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Language\t$LANG value</span></span><br><span class=\"line\">Englist(US)\ten_US.utf8</span><br><span class=\"line\">Assamese\tas_IN.utf8</span><br><span class=\"line\">Bengali\tbn_IN.utf8</span><br><span class=\"line\">Chinese(Simplified)\tzh_CN.utf8</span><br><span class=\"line\">chinese(Traditional)\tzh_TW.utf8</span><br><span class=\"line\">French\tfr_FR.utf8</span><br><span class=\"line\">German\tde_DE.utf8</span><br><span class=\"line\">Gujarati\tgu_IN.utf8</span><br><span class=\"line\">Hindi\thi_IN.utf8</span><br><span class=\"line\">Italian\tit_IT.utf8</span><br><span class=\"line\">Japanese\tja_JP.utf8</span><br><span class=\"line\">Kannada\tkn_IN.utf8</span><br><span class=\"line\">Korean\tko_KR.utf8</span><br><span class=\"line\">Malayalam\tml_IN.utf8</span><br><span class=\"line\">Marathi\tmr_IN.utf8</span><br><span class=\"line\">Odia\tor_IN.utf8</span><br><span class=\"line\">Portuguese(Brazilian)\tpt_BR.utf8</span><br><span class=\"line\">Punjabi\tpa_IN.utf8</span><br><span class=\"line\">Russian\tru_RU.utf8</span><br><span class=\"line\">Spanish\tes_ES.utf8</span><br><span class=\"line\">Tamil\t ta_IN.utf8</span><br><span class=\"line\">Telugu te_IN.utf8</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li><p>Step 2.查看系统默认的语言设置</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ locale</span><br><span class=\"line\">  <span class=\"comment\"># LANG=en_US.utf8</span></span><br><span class=\"line\">  <span class=\"comment\"># LC_CTYPE=\"en_US.utf8\"</span></span><br><span class=\"line\">  <span class=\"comment\"># LC_NUMERIC=\"en_US.utf8\"</span></span><br><span class=\"line\">  <span class=\"comment\"># LC_TIME=\"en_US.utf8\"</span></span><br><span class=\"line\">  <span class=\"comment\"># LC_COLLATE=\"en_US.utf8\"</span></span><br><span class=\"line\">  <span class=\"comment\"># LC_MONETARY=\"en_US.utf8\"</span></span><br><span class=\"line\">  <span class=\"comment\"># LC_MESSAGES=\"en_US.utf8\"</span></span><br><span class=\"line\">  <span class=\"comment\"># LC_PAPER=\"en_US.utf8\"</span></span><br><span class=\"line\">  <span class=\"comment\"># LC_NAME=\"en_US.utf8\"</span></span><br><span class=\"line\">  <span class=\"comment\"># LC_ADDRESS=\"en_US.utf8\"</span></span><br><span class=\"line\">  <span class=\"comment\"># LC_TELEPHONE=\"en_US.utf8\"</span></span><br><span class=\"line\">  <span class=\"comment\"># LC_MEASUREMENT=\"en_US.utf8\"</span></span><br><span class=\"line\">  <span class=\"comment\"># LC_IDENTIFICATION=\"en_US.utf8\"</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Step 3.查看当前区域配置</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">~$ localectl status</span><br><span class=\"line\">  System Locale: LANG=zh_CN.utf8</span><br><span class=\"line\">    VC Keymap: cn</span><br><span class=\"line\">    X11 Layout: cn</span><br><span class=\"line\"></span><br><span class=\"line\">~$ localectl status</span><br><span class=\"line\">   System Locale: LANG=en_US.UTF-8</span><br><span class=\"line\">       VC Keymap: n/a</span><br><span class=\"line\">      X11 Layout: cn</span><br><span class=\"line\">       X11 Model: pc105</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Step 4.查看系统支持的汉语区域语言</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">localectl list-locales| grep zh </span><br><span class=\"line\">  zh_CN</span><br><span class=\"line\">  zh_CN.gb18030</span><br><span class=\"line\">  zh_CN.gb2312</span><br><span class=\"line\">  zh_CN.gbk</span><br><span class=\"line\">  zh_CN.utf8</span><br><span class=\"line\">  zh_HK</span><br><span class=\"line\">  zh_HK.big5hkscs</span><br><span class=\"line\">  zh_HK.utf8</span><br><span class=\"line\">  zh_SG</span><br><span class=\"line\">  zh_SG.gb2312</span><br><span class=\"line\">  zh_SG.gbk</span><br><span class=\"line\">  zh_SG.utf8</span><br><span class=\"line\">  zh_TW</span><br><span class=\"line\">  zh_TW.big5</span><br><span class=\"line\">  zh_TW.euctw</span><br><span class=\"line\">  zh_TW.utf8</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Step 5.设置区域语言</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">localectl <span class=\"built_in\">set</span>-locale  LANG=zh_CN.utf8</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Step 6.查看对应的配置文件之后刷新bash或者重启使设置生效</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat /etc/locale.conf </span><br><span class=\"line\">LANG=zh_CN.utf8</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<h4 id=\"6-GRUB-Bootloader-安全配置\"><a href=\"#6-GRUB-Bootloader-安全配置\" class=\"headerlink\" title=\"6.GRUB Bootloader 安全配置\"></a>6.GRUB Bootloader 安全配置</h4><p>描述: 默认GRUB启动参数可以的进入单用户模式从而修改root密码,所以为了完整的安全性我们需要给GRUB引导菜单设置密码。</p>\n<p><strong>操作流程:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.生成GRUB认证密码可以采用md5或者sha256加密</span></span><br><span class=\"line\">password           <span class=\"comment\"># 明文密码</span></span><br><span class=\"line\">grub-md5-crypt  　 <span class=\"comment\"># 生成md5密码</span></span><br><span class=\"line\">grub-crypt 　　　　 <span class=\"comment\"># 生成sha256密码</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.CentOS6在/etc/grub.conf前`title CentOS (2.6.32-642.13.1.el6.i686.debug)`，重启系统进入grub输入p此时会提示输入密码。</span></span><br><span class=\"line\">password=123456   <span class=\"comment\">#明文密码</span></span><br><span class=\"line\">password --md5 <span class=\"variable\">$1</span><span class=\"variable\">$XEWYA</span>/<span class=\"variable\">$5HUOCImxTf4UwpYQGMlue</span>/ <span class=\"comment\">#密文密码 md5密码123456</span></span><br><span class=\"line\">password --sha-256 <span class=\"variable\">$5</span><span class=\"variable\">$hwX</span>.zwZ7EMcJW0Tu<span class=\"variable\">$GaZZGQzvAAPfSUpK5mW</span>.Jq3v4hZ/1IludjcWmjwPMT3 <span class=\"comment\">#密文密码sha密码123456</span></span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h4 id=\"7-Linux-启动时-Kernel-默认版本配置\"><a href=\"#7-Linux-启动时-Kernel-默认版本配置\" class=\"headerlink\" title=\"7.Linux 启动时 Kernel 默认版本配置\"></a>7.Linux 启动时 Kernel 默认版本配置</h4><p>描述: 各位朋友常常在CentOS7中升级Kernel后，Linux系统重启时仍然会进入旧的内核版本中，这肯定不是我们想要看到的，此时你可以参照此篇文章进行<code>CentOS7</code>下Linux启动时默认内核的设置.</p>\n<p>温馨提示: 此处实践是在CentOS7 操作系统中。</p>\n<p>步骤 01.查看对应的配置文件，验证grub启动是efi模式还是legacy模式?<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EFI    模式配置文件： /boot/efi/EFI/centos/grub.cfg</span><br><span class=\"line\">Legacy 模式配置文件： /boot/grub2/grub.cfg</span><br></pre></td></tr></table></figure></p>\n<p>步骤 02.查看对应启动模式下，目前所有的centos7内核的启动项。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EFI模式:     cat /boot/efi/EFI/centos/grub.cfg | grep menuentry</span><br><span class=\"line\">legacy模式:  cat /boot/grub2/grub.cfg | grep menuentry</span><br></pre></td></tr></table></figure></p>\n<p>步骤 03.修改默认Kernel版本启动项，此处已EFI启动模式为例。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 方式一: grub2-set-default+'对应内核版本'，若遇到错误`environment block too small.`请采用方式二。</span></span><br><span class=\"line\">grub2-set-default <span class=\"string\">'CentOS Linux (4.20.13-1.el7.elrepo.x86_64) 7 (Core)'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方式二：使用 saved_entry 指定内核版本启动顺序。（未验证）</span></span><br><span class=\"line\">cat /boot/efi/EFI/centos/grub.cfg  |grep <span class=\"string\">'menuentry '</span> | cut -c1-50 | nl -v 0</span><br><span class=\"line\">0  menuentry <span class=\"string\">'CentOS Linux (3.10.0-1160.66.1.el7.x86_</span></span><br><span class=\"line\"><span class=\"string\">1  menuentry '</span>CentOS Linux (4.20.13-1.el7.elrepo.x86_</span><br><span class=\"line\">2  menuentry <span class=\"string\">'CentOS Linux (3.10.0-957.el7.x86_64) 7</span></span><br><span class=\"line\"><span class=\"string\">3  menuentry '</span>CentOS Linux (0-rescue-d9fa041058b24c51</span><br><span class=\"line\">saved_entry=1</span><br></pre></td></tr></table></figure></p>\n<p>步骤4.查看默认的内核启动项，并重启服务器验证配置即可。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grub2-editenv list</span><br><span class=\"line\">saved_entry=CentOS Linux (4.20.13-1.el7.elrepo.x86_64) 7 (Core)</span><br><span class=\"line\"></span><br><span class=\"line\">$ reboot</span><br></pre></td></tr></table></figure>\n<hr>\n<h3 id=\"0x02-入坑-amp-出坑\"><a href=\"#0x02-入坑-amp-出坑\" class=\"headerlink\" title=\"0x02.入坑&amp;出坑\"></a>0x02.入坑&amp;出坑</h3><h4 id=\"1-编译错误解决方法合集\"><a href=\"#1-编译错误解决方法合集\" class=\"headerlink\" title=\"1.编译错误解决方法合集\"></a>1.编译错误解决方法合集</h4><p>1.解决 error: the HTTP XSLT module requires the libxml2/libxslt 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install libxml2 libxml2-dev</span><br><span class=\"line\">yum -y install libxslt-devel</span><br></pre></td></tr></table></figure></p>\n<p>2.解决 error: the HTTP image filter module requires the GD library. 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install gd-devel</span><br></pre></td></tr></table></figure></p>\n<p>3.解决 error: the GeoIP module requires the GeoIP library. 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install GeoIP GeoIP-devel GeoIP-data</span><br></pre></td></tr></table></figure></p>\n<p>4.解决 error: the Google perftools module requires the Google perftools 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install gperftools</span><br></pre></td></tr></table></figure></p>\n<p>5.解决 error: libatomic_ops library was not found. 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install libuuid-devel libblkid-devel libudev-devel fuse-devel libedit-devel libatomic_ops-devel</span><br></pre></td></tr></table></figure></p>\n<p>6.解决 error trying to exec ‘cc1plus’: execvp: No such file or directory 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install gcc-c++</span><br></pre></td></tr></table></figure></p>\n<p>7.解决 error: [pool www] cannot get uid for user ‘www-data’ 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">groupadd www-data</span><br><span class=\"line\">useradd -g www-data www-data</span><br></pre></td></tr></table></figure></p>\n<p>8.解决configure: error: mbed TLS libraries not found. 错误。需要安装mbedtls，教程：<a href=\"https://www.24kplus.com/linux/281.html\" target=\"_blank\" rel=\"noopener\">https://www.24kplus.com/linux/281.html</a></p>\n<p>9.解决 error: Cannot find OpenSSL’s &lt;evp.h&gt; 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install openssl openssl-devel</span><br><span class=\"line\">ln -s /usr/lib64/libssl.so /usr/lib/</span><br></pre></td></tr></table></figure></p>\n<p>10.解决 error: Libtool library used but ‘LIBTOOL’ is undefined 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install libtool</span><br></pre></td></tr></table></figure></p>\n<p>11.解决 exec: g++: not found 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y update gcc</span><br><span class=\"line\">yum -y install gcc+ gcc-c++</span><br></pre></td></tr></table></figure></p>\n<p>12.解决 configure: error: tss lib not found: libtspi.so 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install trousers-devel</span><br></pre></td></tr></table></figure></p>\n<p>13.解决 Can’t exec “autopoint”: No such file or directory 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install gettext gettext-devel gettext-common-devel</span><br></pre></td></tr></table></figure></p>\n<p>14.解决 configure: error: libcrypto not found. 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum remove openssl-devel</span><br><span class=\"line\">yum -y install openssl-devel</span><br></pre></td></tr></table></figure></p>\n<p>15.解决 configure: error: Package requirements (libffi &gt;= 3.0.0) were not met: No package ‘libffi’ found 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install libffi-devel</span><br></pre></td></tr></table></figure></p>\n<p>16.解决 fatal error: uuid.h: No such file or directory 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install e2fsprogs-devel uuid-devel libuuid-devel</span><br></pre></td></tr></table></figure></p>\n<p>17.解决 configure: error: openssl lib not found: libcrypto.so 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install openssl-devel</span><br></pre></td></tr></table></figure></p>\n<p>18.解决 tar (child): lbzip2: Cannot exec: No such file or directory 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install bzip2</span><br></pre></td></tr></table></figure></p>\n<p>19.解决 configure: error: C++ preprocessor “/lib/cpp” fails sanity check 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install gcc-c++</span><br></pre></td></tr></table></figure></p>\n<p>20.解决 configure: error: Please reinstall the BZip2 distribution 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install bzip2 bzip2-devel</span><br></pre></td></tr></table></figure></p>\n<p>21.解决 configure: error: cURL version 7.15.5 or later is required to compile php with cURL support 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install curl-devel</span><br></pre></td></tr></table></figure></p>\n<p>22.解决 configure: error: not found. Please provide a path to MagickWand-config or Wand-config program 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install ImageMagick-devel</span><br></pre></td></tr></table></figure></p>\n<p>21.解决 configure: error: no acceptable C compiler found in $PATH 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install gcc</span><br></pre></td></tr></table></figure></p>\n<p>22.解决 configure: error: Package requirements (icu-uc &gt;= 50.1 icu-io icu-i18n) were not met: 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install libicu-devel</span><br></pre></td></tr></table></figure></p>\n<p>23.解决 configure: error: Package requirements (sqlite3 &gt; 3.7.4) were not met: No package ‘sqlite3’ found 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install sqlite-devel</span><br></pre></td></tr></table></figure></p>\n<p>24.解决 configure: error: Package requirements (oniguruma) were not met: No package ‘oniguruma’ found 错误<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install oniguruma oniguruma-devel</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h4 id=\"2-GRUB-密码忘记导致无法开机进入系统问题。\"><a href=\"#2-GRUB-密码忘记导致无法开机进入系统问题。\" class=\"headerlink\" title=\"2.GRUB 密码忘记导致无法开机进入系统问题。\"></a>2.GRUB 密码忘记导致无法开机进入系统问题。</h4><p>解决办法: </p>\n<ul>\n<li>首先挂载安装系统的镜像为启动项,在开机Menu界面选择<code>Bescure installed system</code>. </li>\n<li>选择语言以及配置的网卡,系统会自动查找磁盘中的Linux分区并尝试将其挂载到<code>/mnt/sysimage</code>目录。</li>\n<li>并选择Shell,并执行挂载命令<code>chroot /mnt/sysimage.</code></li>\n<li>执行<code>vi /etc/grup.conf</code>删除配置文件中的密码然后关机重启系统即可。</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210627162102.png\" alt=\"WeiyiGeek.CentOS-grub-密码清除\" title=\"\" class=\"\">\n                <p>WeiyiGeek.CentOS-grub-密码清除</p>\n            </figure>\n<p><br></p>\n<h4 id=\"3-CentOS7无法识别挂载NTFS格式的移动设备。\"><a href=\"#3-CentOS7无法识别挂载NTFS格式的移动设备。\" class=\"headerlink\" title=\"3.CentOS7无法识别挂载NTFS格式的移动设备。\"></a>3.CentOS7无法识别挂载NTFS格式的移动设备。</h4><p>解决办法: 安装ntfs-3g软件包,执行<code>yum install ntfs-3g</code>命令，安装完成后你会发现多了个mount.ntfs-3g的命令。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 如果更新源没有该软件包，请采用阿里云的提供的CentOS-Base.repo仓库。</span></span><br><span class=\"line\">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class=\"line\">yum clean all &amp;&amp; yum makecache</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 执行mount挂载,此时你会发现显示的类型为fuseblk，这是由于ntfs-3g并不是内核模块，而是调用fuse来挂载的。</span></span><br><span class=\"line\">$ fdisk -l | grep <span class=\"string\">\"/dev/sdb1\"</span>  <span class=\"comment\"># 查看类型</span></span><br><span class=\"line\">$ mount /dev/sdb1 /mnt</span><br><span class=\"line\">The disk contains an unclean file system (0, 0).</span><br><span class=\"line\">The file system wasnt safely closed on Windows. Fixin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 执行 `df -hT` 命令后的结果会认为是 fuseblk(blk=block).</span></span><br><span class=\"line\">$ df -Th | grep <span class=\"string\">\"/mnt/ntfs\"</span></span><br><span class=\"line\">/dev/sdb1   fuseblk   932G  437G  495G   47% /mnt/ntfs</span><br></pre></td></tr></table></figure></p>\n<p>温馨提示: 由于是采用的fuse如果系统没有安装也是不行的,建议执行如下命令查看<code>rpm -q fuse</code>。</p>\n<p><br></p>\n<h4 id=\"4-CentOS7无法识别挂载exFat格式的移动设备。\"><a href=\"#4-CentOS7无法识别挂载exFat格式的移动设备。\" class=\"headerlink\" title=\"4.CentOS7无法识别挂载exFat格式的移动设备。\"></a>4.CentOS7无法识别挂载exFat格式的移动设备。</h4><p>问题描述: 当前在Windows系统中使用的U盘或者移动设备，大多都是exFat格式默认的Linux系统一般是无法识别的我们可以按照如下方式进行挂载。<br>解决办法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装 nux repo 如果您的安装源存在 exfat-utils fuse-exfa 则不用安装。</span></span><br><span class=\"line\">yum install -y http://li.nux.ro/download/nux/dextop/el7/x86_64/nux-dextop-release-0-5.el7.nux.noarch.rpm</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装 fuse 包</span></span><br><span class=\"line\">yum install exfat-utils fuse-exfa -y</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 验证系统是否可以识别exFat格式的移动社保</span></span><br><span class=\"line\">fdisk -l</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 挂载设备到系统</span></span><br><span class=\"line\">mount -t exfat /dev/sdb1 /mnt</span><br><span class=\"line\"><span class=\"comment\"># FUSE exfat 1.2.7</span></span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]<br>","categories":[{"name":"Linux配置","path":"api/categories/Linux配置.json"}],"tags":[{"name":"CentOS","path":"api/tags/CentOS.json"}]}