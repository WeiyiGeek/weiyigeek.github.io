<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 5-Kuberneteså…¥é—¨åŸºç¡€ä¹‹æ§åˆ¶å™¨Controllerä»‹ç»|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="k8s">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>5-Kuberneteså…¥é—¨åŸºç¡€ä¹‹æ§åˆ¶å™¨Controllerä»‹ç»</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">5-Kuberneteså…¥é—¨åŸºç¡€ä¹‹æ§åˆ¶å™¨Controllerä»‹ç»</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-05-27T10:37:47.000Z" itemprop="datePublished" class="page-time">
  2020-05-27
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/5-Kuberneteså…¥é—¨åŸºç¡€ä¹‹æ§åˆ¶å™¨Controllerä»‹ç»"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">5-Kuberneteså…¥é—¨åŸºç¡€ä¹‹æ§åˆ¶å™¨Controllerä»‹ç»</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-05-27 18:37:47" datetime="2020-05-27T10:37:47.000Z"  itemprop="datePublished">2020-05-27</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[toc]</p>
<h2 id="0x00-Controller-ä»‹ç»"><a href="#0x00-Controller-ä»‹ç»" class="headerlink" title="0x00 Controller ä»‹ç»"></a>0x00 Controller ä»‹ç»</h2><p><strong>Q: ä»€ä¹ˆæ˜¯èµ„æºæ§åˆ¶å™¨(èµ„æºæ§åˆ¶å™¨ä»‹ç»)?</strong><br>ç­”ï¼šKubernetesä¸­å†…å»ºäº†å¾ˆå¤šcontrollerï¼ˆæ§åˆ¶å™¨ï¼‰ï¼Œè¿™äº›ç›¸å½“äºä¸€ä¸ªçŠ¶æ€æœºï¼Œç”¨æ¥æ§åˆ¶Podçš„å…·ä½“çŠ¶æ€å’Œè¡Œä¸ºã€‚</p>
<p><br></p>
<p><strong>Q: ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ§åˆ¶å™¨ï¼Ÿ</strong><br>ç­”: å‰é¢è¯´è¿‡Podæ˜¯k8sæœ€å°çš„éƒ¨ç½²å•å…ƒï¼Œè€Œå¦‚æœéœ€è¦<code>åˆ›å»ºæ‰¹é‡çš„Podå‰¯æœ¬å¹¶è¿›è¡Œæ‰©å®¹ç¼©ä»¥åŠPODå›é€€</code>å°±å¿…é¡»ä½¿ç”¨Controllerè¿›è¡Œå®ç°ï¼›</p>
<p><br></p>
<p><strong>Q: æœ‰é‚£äº›ç±»å‹çš„æ§åˆ¶å™¨?</strong></p>
<ul>
<li>(1) Replication Controller å’Œ ReplicaSet </li>
<li>(2) Deployment </li>
<li>(3) DaemonSet </li>
<li>(4) Job/CronJob </li>
<li>(5) StatefulSet</li>
<li>(6) Horizontal Pod Autoscaling</li>
</ul>
<hr>
<h2 id="0x01-Controller-è¯¦è¿°"><a href="#0x01-Controller-è¯¦è¿°" class="headerlink" title="0x01 Controller è¯¦è¿°"></a>0x01 Controller è¯¦è¿°</h2><h3 id="1-Replication-Controller"><a href="#1-Replication-Controller" class="headerlink" title="1.Replication Controller"></a>1.Replication Controller</h3><p><strong>Q: ä»€ä¹ˆæ˜¯Replication Controller(RC)?</strong></p>
<blockquote>
<p>ç­”: ReplicationControlleræ˜¯ä¸€ä¸ªåŸºæœ¬çš„æ§åˆ¶å™¨ç±»å‹, å®ƒå³æˆ‘ä»¬æ‰€è¯´çš„RC(<code>å‰¯æœ¬æ§åˆ¶å™¨</code>), ç”¨äºç¡®ä¿ä»»æ„æ—¶é—´éƒ½æœ‰æŒ‡å®šæ•°é‡çš„Podâ€å‰¯æœ¬â€åœ¨è¿è¡Œ;</p>
</blockquote>
<p><strong>Q: RCå®ƒæœ‰ä½•ä½œç”¨?</strong></p>
<blockquote>
<p>ç­”: ç¡®ä¿å®¹å™¨åº”ç”¨çš„å‰¯æœ¬æ•°å§‹ç»ˆä¿æŒåœ¨ç”¨æˆ·å®šä¹‰çš„å‰¯æœ¬æ•°ï¼Œå³å¦‚æœæœ‰å®¹å™¨<code>å¼‚å¸¸é€€å‡ºï¼Œä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„Pod</code>æ¥æ›¿ä»£è€Œå¦‚æœ<code>å¼‚å¸¸å¤šå‡ºæ¥çš„å®¹å™¨ä¹Ÿä¼šè‡ªåŠ¨å›æ”¶</code>ï¼›</p>
</blockquote>
<p><strong>Q: RCå·¥ä½œåŸç†</strong></p>
<blockquote>
<p>ç­”: åˆ›å»ºRCä¹‹åK8S MasterèŠ‚ç‚¹ä¸Šçš„Controller Manager(æ§åˆ¶å™¨ç®¡ç†å™¨)ç»„ä»¶æ¥åˆ°åˆ›å»ºRCçš„é€šçŸ¥è¿›è¡Œåˆ›å»ºæ»¡è¶³å‰¯æœ¬æ•°ç›¸åº”çš„Pod, ç„¶åå®ƒä¼šå®šæœŸå·¡è§†ç³»ç»Ÿå½“ä¸­çš„å­˜æ´»çš„ç›®æ ‡Pod, ç„¶åè¿›è¡Œæ ‡ç­¾åŒ¹é…æ¥ç›‘è§†å¯¹åº”çš„Podï¼Œå¹¶ç¡®ä¿ç›®æ ‡Podå®ä¾‹åˆšå¥½ç­‰äºRCä¸­å®šä¹‰çš„å‰¯æœ¬æ•°æœŸæœ›å€¼ï¼Œè€Œç›®æ ‡Podè¶…è¿‡å‰¯æœ¬æœŸæœ›å€¼å°†ä¼šè¢«é”€æ¯;</p>
</blockquote>
<p><strong>Q: RCç»„æˆéƒ¨åˆ†</strong></p>
<ul>
<li>1) Pod æœŸå¾…çš„å‰¯æœ¬æ•° Replicas</li>
<li>2) ç”¨äºç­›é€‰ç›®æ ‡Podçš„Lable Selectorï¼Œå¯¹åº”Podæ¨¡æ¿(Template)</li>
<li>3) Pod æ•°é‡å°äºå‰¯æœ¬æœŸæœ›å€¼æ—¶æ ¹æ®Podæ¨¡æ¿åˆ›å»ºç›¸åº”çš„Pod</li>
</ul>
<p><strong>Q: RCä½¿ç”¨å®ä¾‹</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rc-demo.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicationCaontroller</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">rc-demo</span>  <span class="comment"># Rc åç§°</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span>  <span class="comment"># Podå‰¯æœ¬æœŸæœ›å€¼</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">nginx</span> <span class="comment"># pod åç§° </span></span><br><span class="line"><span class="attr">      lables:</span>     <span class="comment"># Pod æ¨¡æ¿æ ‡ç­¾</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">nginx</span> <span class="comment"># KV å€¼</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">nginx</span>   <span class="comment"># å®¹å™¨åç§°</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">nginx:latest</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="attr">        - contianerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>
<p><strong>æ“ä½œå®è·µ:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»º</span></span><br><span class="line">kubectl create -f rc-demo.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–RC &amp; è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">kubectl get rc/rc-demo</span><br><span class="line">kubectl describe rc/rc-demo</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–Podçš„ä¿¡æ¯</span></span><br><span class="line">kubectl get pod -l app=nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤RCåˆ›å»ºçš„Pod (ä»–ä¼šé‡æ–°åˆ›å»ºæ»¡è¶³å…¶å‰¯æœ¬æ•°)</span></span><br><span class="line">kubectl delete pod nginx-*</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤RC (æ…ç”¨ -f å®ƒæ˜¯å¼ºåˆ¶çš„)</span></span><br><span class="line">kubectl delete -f rc-demo.yaml</span><br></pre></td></tr></table></figure></p>
<p>Tips: æˆ‘ä»¬å¯ä»¥åœ¨åˆ é™¤RCæ—¶ä¸åˆ é™¤å…¶æ„å»ºçš„Podè¿›è¡Œæ›´æ–°ä¿®æ”¹RC,å¯ä»¥é‡‡ç”¨deleteå‘½ä»¤å­å‚æ•°<code>cascade=false</code>(çº§è”),åŸRCè¢«åˆ é™¤åå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„RCæ¥æ›¿æ¢å®ƒï¼Œå‰ææ˜¯æ—§çš„å’Œæ–°.spec.selectorç›¸åŒ¹é…,é‚£ä¹ˆæ–°çš„å°†ä¼šé‡‡ç”¨æ—§çš„Pod;<br>Tips: å®˜æ–¹åœ¨æ–°ç‰ˆæœ¬çš„Kubernetesä¸­å»ºè®®èˆå¼ƒReplicationControllerï¼Œåˆ‡æ¢ä½¿ç”¨åŠŸèƒ½èƒ½æ›´å¼ºçš„ReplicaSet(RS) è¿™ä¹Ÿæ˜¯ä¸‹ä¸€èŠ‚çš„ä¸»è¦å†…å®¹;</p>
<p><br></p>
<h3 id="2-ReplicaSet"><a href="#2-ReplicaSet" class="headerlink" title="2.ReplicaSet"></a>2.ReplicaSet</h3><p><strong>Q: ä»€ä¹ˆæ˜¯ReplicaSet?</strong></p>
<blockquote>
<p>ç­”: ReplicaSetå³æ˜¯æˆ‘ä»¬è¯´çš„(RS)å‰¯æœ¬é›†, å®ƒæ˜¯åœ¨k8s v1.2å¼•å…¥å¯ä»¥å°†å®ƒçœ‹åšæ˜¯RCçš„å‡çº§ç‰ˆæœ¬; è€ŒReplicaSetè·ŸReplicationController æ²¡æœ‰æœ¬è´¨çš„ä¸åŒåªæ˜¯åå­—ä¸ä¸€æ ·ï¼Œç„¶åæ”¯æŒé›†åˆå¼(Set-Based selecor)çš„ selectorã€æ ‡ç­¾ã€‘ï¼Œè¿™ä½¿å¾—RSåœ¨èµ„æºé€‰æ‹©ä¸Šæ›´ä¸ºçµæ´»ï¼›</p>
</blockquote>
<p><strong>Q: ReplicaSetæœ‰ä½•ä½œç”¨?</strong></p>
<blockquote>
<p>ç­”: RS å’Œ RC ä¸€æ ·éƒ½èƒ½ç¡®ä¿è¿è¡Œæ»¡è¶³å‰¯æœ¬æ•°æœŸæœ›å€¼çš„Pod;<br>è™½ç„¶RSå¯ä»¥ç‹¬ç«‹ä½¿ç”¨è€Œå®ƒä¸»è¦ç”¨äºåè°ƒDeploymentå¯¹Podåˆ›å»ºã€åˆ é™¤ã€æ›´æ–°ç­‰ï¼Œå½“ä½¿ç”¨Deploymentæ—¶å€™ä¸ç”¨æ‹…å¿ƒRSå› ä¸ºå¯ä»¥ç›´æ¥é€šè¿‡Deploymentå¯¹å…¶è¿›è¡Œç®¡ç†ï¼›</p>
</blockquote>
<p>Tips : å¿«é€ŸæŸ¥çœ‹æ§åˆ¶å™¨çš„apiVsersion<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl api-versions | grep $(kubectl api-resources | grep <span class="string">"ReplicaSet"</span> | awk -F <span class="string">" "</span> <span class="string">'&#123;print $3&#125;'</span>)</span><br><span class="line">apps/v1</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>Pod èµ„æºæ–‡ä»¶ç¤ºä¾‹ï¼š<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; pod-demo.yaml &lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">pod-demo</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">pod-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">nginx-pod-demo</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">harbor.weiyigeek.top/test/nginx:v1.0</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="attr">    - containerPort:</span> <span class="number">80</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></p>
<p>ReplicaSet èµ„æºæ–‡ä»¶ç¤ºä¾‹:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; replicaset-demo.yaml &lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicaSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">replicaset-demo</span>   <span class="comment"># ReplicaSet åç§°</span></span><br><span class="line"><span class="attr">  labels:</span>                 <span class="comment"># ReplicaSet æ ‡ç­¾</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">replicaset-demo</span>   </span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span> <span class="comment"># æœ‰3ä¸ªå‰¯æœ¬</span></span><br><span class="line"><span class="attr">  selector:</span>   <span class="comment"># æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class="line"><span class="attr">    matchLabels:</span>               <span class="comment"># matchLabelsæ˜¯&#123;key,value&#125;å¯¹çš„æ˜ å°„</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">replicaset-demo</span>     <span class="comment"># æ³¨æ„: åŒ¹é…çš„æ ‡ç­¾éœ€è¦åŸæ•°æ®ä¸­çš„replicaset-demoä¸€è‡´</span></span><br><span class="line"><span class="attr">    matchExpressions:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">&#123;key:</span> <span class="string">tier,</span> <span class="attr">operator:</span> <span class="string">In,</span> <span class="attr">values:</span> <span class="string">&#123;frontend&#125;&#125;</span>  </span><br><span class="line"><span class="attr">  template:</span>   <span class="comment"># æ¨¡æ¿</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">replicaset-demo</span> </span><br><span class="line"><span class="attr">    spec:</span>     <span class="comment"># æ¨¡æ¿ç»†åˆ™</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">nginx-replicaset-demo</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">harbor.weiyigeek.top/test/nginx:v1.0</span></span><br><span class="line"><span class="attr">        command:</span> <span class="string">["sh","-c","java</span> <span class="bullet">-jar</span> <span class="string">nginx-app-$&#123;RELASE_VER&#125;.jar"]</span></span><br><span class="line"><span class="attr">        env:</span> <span class="comment"># ç¯å¢ƒå˜é‡ (æ­¤æ—¶å¯¹å®é™…ç¯å¢ƒä¸­é¡¹ç›®çš„éƒ¨ç½²å€¼å¾—å­¦ä¹ )</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">GET_HOSTS_FROM</span> </span><br><span class="line"><span class="attr">          value:</span> <span class="string">dns</span> </span><br><span class="line"><span class="attr">        - name:</span> <span class="string">RELASE_VER</span></span><br><span class="line"><span class="attr">          value:</span> <span class="number">1.3</span><span class="number">.5</span></span><br><span class="line"><span class="attr">        ports:</span> <span class="comment"># æš´éœ²ç«¯å£</span></span><br><span class="line"><span class="attr">        - containerPort:</span> <span class="number">80</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></p>
<p>æ“ä½œæµç¨‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) ä½¿ç”¨K8séƒ¨ç½²è‡ªåŠ©å¼Podä»¥åŠReplicaSetæ§åˆ¶å™¨éƒ¨ç½²Pod</span></span><br><span class="line">~/K8s/Day5/demo1$ kubectl create -f pod-demo.yaml</span><br><span class="line">  <span class="comment"># pod/pod-demo created</span></span><br><span class="line">~/K8s/Day5/demo1$ kubectl create -f replicaset-demo.yaml</span><br><span class="line">  <span class="comment"># replicaset.apps/replicaset-demo created</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æŸ¥çœ‹ Pod çš„ä¿¡æ¯</span></span><br><span class="line">~/K8s/Day5/demo1$  kubectl get pod --show-labels -o wide</span><br><span class="line">  <span class="comment"># NAME                    READY   STATUS    RESTARTS   AGE   IP            NODE          LABELS</span></span><br><span class="line">  <span class="comment"># pod-demo                1/1     Running   0          28m   10.244.1.16   k8s-node-4    app=pod-demo</span></span><br><span class="line">  <span class="comment"># replicaset-demo-9j457   1/1     Running   0          17m   10.244.1.19   k8s-node-4    tier=replicaset-demo</span></span><br><span class="line">  <span class="comment"># replicaset-demo-9sm9d   1/1     Running   0          17m   10.244.1.18   k8s-node-4    tier=replicaset-demo</span></span><br><span class="line">  <span class="comment"># replicaset-demo-zkl7t   1/1     Running   0          17m   10.244.1.17   k8s-node-4    tier=replicaset-demo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PS : å¯¹äº ReplicaSet æ§åˆ¶å™¨åˆ›å»ºçš„ Pod å¯ä»¥é‡‡ç”¨ä¸‹åˆ—å‘½ä»¤æŸ¥çœ‹</span></span><br><span class="line">$ kubectl get rs -o wide   <span class="comment"># Pod åç§°åœ¨åç§°ç©ºé—´ä¸­å¿…é¡»æ˜¯æƒŸä¸€çš„</span></span><br><span class="line">  <span class="comment"># NAME              DESIRED   CURRENT   READY   AGE     CONTAINERS(å®¹å™¨åç§°)     IMAGES(é•œåƒ)                                 SELECTOR (æ ‡ç­¾)</span></span><br><span class="line">  <span class="comment"># replicaset-demo   3         3         3       7m39s   nginx-replicaset-demo   harbor.weiyigeek.top/test/nginx:v1.0   tier=replicaset-demo</span></span><br><span class="line"><span class="comment"># PS : pod ä¸­æ‰§è¡Œå‘½ä»¤ kubectl exec replicaset-demo-9j457 -it -- /bin/sh</span></span><br><span class="line">$ kubectl <span class="built_in">exec</span> replicaset-demo-9j457 -it -- env</span><br><span class="line">  <span class="comment"># PATH=/usr/local/nginx/sbin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span></span><br><span class="line">  <span class="comment"># HOSTNAME=replicaset-demo-9j457</span></span><br><span class="line">  <span class="comment"># TERM=xterm</span></span><br><span class="line">  <span class="comment"># GET_HOSTS_FROM=dns  # å®šä¹‰çš„ GET_HOSTS_FROM ç¯å¢ƒå˜é‡</span></span><br><span class="line">  <span class="comment"># KUBERNETES_SERVICE_PORT=443</span></span><br><span class="line">  <span class="comment"># KUBERNETES_SERVICE_PORT_HTTPS=443</span></span><br><span class="line">  <span class="comment"># KUBERNETES_PORT=tcp://10.96.0.1:443</span></span><br><span class="line">  <span class="comment"># KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443</span></span><br><span class="line">  <span class="comment"># KUBERNETES_PORT_443_TCP_PROTO=tcp</span></span><br><span class="line">  <span class="comment"># KUBERNETES_PORT_443_TCP_PORT=443</span></span><br><span class="line">  <span class="comment"># KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1</span></span><br><span class="line">  <span class="comment"># KUBERNETES_SERVICE_HOST=10.96.0.1</span></span><br><span class="line">  <span class="comment"># NGINX_VERSION=1.19.4</span></span><br><span class="line">  <span class="comment"># NJS_VERSION=0.4.4</span></span><br><span class="line">  <span class="comment"># PKG_RELEASE=1~buster</span></span><br><span class="line">  <span class="comment"># IMAGE_VERSION=1.0</span></span><br><span class="line">  <span class="comment"># HOME=/root</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) è®¿é—®Podä¸­çš„å®¹å™¨</span></span><br><span class="line">~/K8s/Day5/demo1$ curl http://10.244.1.&#123;16..19&#125;/host.html</span><br><span class="line">  <span class="comment"># Hostname: pod-demo  &lt;br&gt;</span></span><br><span class="line">  <span class="comment"># Image Version: &lt;u&gt; 1.0 &lt;/u&gt;</span></span><br><span class="line">  <span class="comment"># Nginx Version: 1.19.4</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Hostname: replicaset-demo-zkl7t  &lt;br&gt;</span></span><br><span class="line">  <span class="comment"># Image Version: &lt;u&gt; 1.0 &lt;/u&gt;</span></span><br><span class="line">  <span class="comment"># Nginx Version: 1.19.4</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Hostname: replicaset-demo-9sm9d  &lt;br&gt;</span></span><br><span class="line">  <span class="comment"># Image Version: &lt;u&gt; 1.0 &lt;/u&gt;</span></span><br><span class="line">  <span class="comment"># Nginx Version: 1.19.4</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Hostname: replicaset-demo-9j457  &lt;br&gt;</span></span><br><span class="line">  <span class="comment"># Image Version: &lt;u&gt; 1.0 &lt;/u&gt;</span></span><br><span class="line">  <span class="comment"># Nginx Version: 1.19.4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) ã€é‡ç‚¹ã€‘éªŒè¯è‡ªåŠ©å¼Podä¸æ§åˆ¶å™¨å¼Podï¼ˆLabels-æ ‡ç­¾ï¼‰çš„å·®å¼‚</span></span><br><span class="line">~/K8s/Day5/demo1 $ kubectl delete pod --all  <span class="comment"># åˆ é™¤defaultåç§°ç©ºé—´ä¸‹çš„æ‰€æœ‰Pod</span></span><br><span class="line">  <span class="comment"># pod "pod-demo" deleted</span></span><br><span class="line">  <span class="comment"># pod "replicaset-demo-9j457" deleted</span></span><br><span class="line">  <span class="comment"># pod "replicaset-demo-9sm9d" deleted</span></span><br><span class="line">  <span class="comment"># pod "replicaset-demo-zkl7t" deleted</span></span><br><span class="line">~/K8s/Day5/demo1 $ kubectl get pod --show-labels -o wide  <span class="comment"># å†æ¬¡æŸ¥çœ‹ Pod ç›¸å…³ä¿¡æ¯å‘ç°å®¹å™¨åç§°ä»¥åŠIPåœ°å€å‘ç”Ÿæ”¹å˜</span></span><br><span class="line">  <span class="comment"># NAME                    READY   STATUS    RESTARTS   AGE   IP            NODE          LABELS</span></span><br><span class="line">  <span class="comment"># replicaset-demo-frfsw   1/1     Running   0          43s   10.244.1.22   k8s-node-4    tier=replicaset-demo</span></span><br><span class="line">  <span class="comment"># replicaset-demo-hh7fd   1/1     Running   0          43s   10.244.1.20   k8s-node-4    tier=replicaset-demo</span></span><br><span class="line">  <span class="comment"># replicaset-demo-lqjq8   1/1     Running   0          43s   10.244.1.21   k8s-node-4    tier=replicaset-demo</span></span><br><span class="line"><span class="comment"># PS : ç»“è®ºæ§åˆ¶å™¨åˆ›å»ºçš„Podåœ¨deleteä¼šé‡æ–°åˆ›å»ºä»¥è¾¾åˆ°èµ„æºæ¸…å•ä¸­çš„replicasæœŸæœ›å€¼</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) ç»“æŸReplicasetåˆ›å»ºçš„Podï¼ˆç®¡ç†è€…è¢«æ¸…é™¤äº†å…¶ä¸‹é¢ç®¡ç†çš„èµ„æºä¹Ÿå°†è¢«é‡Šæ”¾ï¼‰</span></span><br><span class="line">~/K8s/Day5/demo2$ kubectl delete rs replicaset-demo</span><br><span class="line">  <span class="comment"># replicaset.apps "replicaset-demo" deleted</span></span><br></pre></td></tr></table></figure></p>
<p>Tips : é™¤ééœ€è¦è‡ªå®šä¹‰æ›´æ–°ç¼–æ’æˆ–è€…æ ¹æœ¬ä¸éœ€è¦æ›´æ–°ï¼Œå¦åˆ™å»ºè®®ä½¿ç”¨Deploymentæ¥åˆ›å»ºPodè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ReplicaSetsåˆ›å»ºPod;</p>
<p><br></p>
<h3 id="3-Deployment"><a href="#3-Deployment" class="headerlink" title="3.Deployment"></a>3.Deployment</h3><p><strong>Q: ä»€ä¹ˆæ˜¯Deployment?</strong></p>
<blockquote>
<p>ç­”: Deployment ä¹Ÿæ˜¯åœ¨k8s v1.2ç‰ˆæœ¬å¼•å…¥ï¼Œå…¶å†…éƒ¨ä½¿ç”¨äº†RSè¿›è¡Œå®ç°å‰¯æœ¬æœŸæœ›å€¼æ•°é‡Podçš„åˆ›å»ºï¼Œ<code>å³é€šè¿‡RSå»åˆ›å»ºå’Œç®¡ç†å¯¹åº”çš„podåŠä¸åŒçš„RSäº¤æ›¿å»å®Œæˆæ»šåŠ¨æ›´æ–°</code>ã€‚ã€€</p>
</blockquote>
<p><strong>Q: ä¸ºä½•è¦ä½¿ç”¨Deployment?</strong></p>
<blockquote>
<p>ç­”: ä½¿ç”¨å…¶çš„ä¸»è¦åŸå› æ˜¯å…¶æ”¯æŒæ›´æ–°ã€å›æ»š(Rollback)å¯ä»¥æå¤§èŠ‚çº¦éƒ¨ç½²æ—¶é—´ä»¥åŠç®€åŒ–éƒ¨ç½²æµç¨‹, å…¨éƒ¨åœ¨å…¶æ§åˆ¶å™¨å†…éƒ¨å®Œæˆå¯¹ç”¨æˆ·æ˜¯ä¸å¯è§çš„(Pod åˆ›å»ºè¿‡ç¨‹å¯ä»¥å‚è€ƒä¸Šä¸€ç« çš„å£°æ˜å‘¨æœŸ);</p>
</blockquote>
<p><strong>Q: Deploymentç»„æˆéƒ¨åˆ†</strong></p>
<ul>
<li>1) å…¶å¯¹è±¡ç”ŸæˆRSå¹¶å®Œæˆæ»¡è¶³Podå‰¯æœ¬æ•°çš„Podåˆ›å»º</li>
<li>2) é€šè¿‡å…¶å¯¹è±¡æ–¹ä¾¿å‡çº§æˆ–è€…å›æ»šPodåº”ç”¨ ã€Deploymentè‡ªèº«å…·å¤‡çš„ç‰¹ç‚¹ã€‘</li>
<li>3) é€šè¿‡å…¶å¯¹è±¡æ–¹ä¾¿æš‚åœæˆ–å›å¤å‘å¸ƒ ã€Deploymentè‡ªèº«å…·å¤‡çš„ç‰¹ç‚¹ã€‘</li>
<li>4) é€šè¿‡å…¶å¯¹è±¡æ–¹ä¾¿æ‰©å®¹å’Œç¼©å®¹ã€RSå°±å·²ç»å®ç°ï¼ŒDeploymenté€šè¿‡RSç®¡ç†Podå› æ­¤ä¹Ÿæ”¯æŒã€‘</li>
</ul>
<p><strong>Podã€RelicationController ã€ReplicaSetã€Deploymentå…³ç³»è¯´æ˜</strong></p>
<ul>
<li>RelicationController  -&gt; Pod (ä¸€ç›´æ»¡è¶³Podå‰¯æœ¬æ•°é™¤éRCè¢«åˆ é™¤)</li>
<li>ReplicaSet -&gt; Pod (ä¸€ç›´æ»¡è¶³Podå‰¯æœ¬æ•°é™¤éRSè¢«åˆ é™¤,è¾ƒRCå…¶ä¸»è¦ç‰¹ç‚¹æ˜¯æ”¯æŒæ ‡ç­¾å¾—é›†åˆå¾—é€‰æ‹©)</li>
<li>Deployment -&gt; ReplicaSet -&gt; Pod (åœ¨RSåŸºç¡€ä¹‹ä¸Šå¯ç”¨å¿«é€Ÿå®Œæˆæ›´æ–°ã€å›æ»šã€æ‰©å®¹ã€æ”¶ç¼©ç­‰)</li>
</ul>
<figure class="image-box">
                <a rel=5-Kuberneteså…¥é—¨åŸºç¡€ä¹‹æ§åˆ¶å™¨Controllerä»‹ç» href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201110204759.png" target="_blank" title="WeiyiGeek.deployment-scale-replicas" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201110204759.png" alt="WeiyiGeek.deployment-scale-replicas" title="" class=""></a>
                <p>WeiyiGeek.deployment-scale-replicas</p>
            </figure>
<p><br/></p>
<p>Deployment èµ„æºæ–‡ä»¶ç¤ºä¾‹:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; nginx-deployment-demo.yaml&lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span>       <span class="comment"># èµ„æºç±»å‹</span></span><br><span class="line"><span class="attr">metadata:</span>              <span class="comment"># æºæ•°æ®</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nginx-deployment-demo</span>  <span class="comment"># Deployment åç§° </span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span>           <span class="comment"># å‰¯æœ¬æ•°é‡</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span>               <span class="comment"># matchLabelsæ˜¯&#123;key,value&#125;å¯¹çš„æ˜ å°„ç­‰åŒäºkey=value</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">nginx-deployment</span>    <span class="comment"># é”®å€¼å¯¹</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">nginx-deployment</span>  <span class="comment"># Pod åç§°</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span>    <span class="comment"># é•œåƒå®šä¹‰</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">nginx-deployment</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">harbor.weiyigeek.top/test/nginx:v1.0</span></span><br><span class="line"><span class="attr">        ports:</span>  <span class="comment"># å®¹å™¨ç«¯å£æš´éœ²</span></span><br><span class="line"><span class="attr">        - containerPort:</span> <span class="number">80</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></p>
<p><strong>æ¼”ç¤ºæµç¨‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) docker build dockerfileåä¸Šä¼ é•œåƒåˆ°Harborä¹‹ä¸­</span></span><br><span class="line">~/K8s/Day5/demo2$ docker push harbor.weiyigeek.top/<span class="built_in">test</span>/nginx:v1.0</span><br><span class="line">~/K8s/Day5/demo2$ docker push harbor.weiyigeek.top/<span class="built_in">test</span>/nginx:v2.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) éƒ¨ç½²</span></span><br><span class="line">~/K8s/Day5/demo2$ kubectl create -f nginx-deployment-demo.yaml --record </span><br><span class="line"><span class="comment">## --recordå‚æ•°å¯ä»¥è®°å½•å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„æŸ¥çœ‹æ¯æ¬¡ revision çš„å˜åŒ– æ›´æ–°çš„æ—¶å€™å¯ä»¥è®°å½•çŠ¶æ€ï¼Œæ¯ä¸€æ­¥æ˜¯ä½¿ç”¨ä»€ä¹ˆå‘½ä»¤è¿›è¡Œæ›´æ–°çš„   </span></span><br><span class="line">  <span class="comment"># deployment.apps/nginx-deployment-demo created</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) æŸ¥çœ‹</span></span><br><span class="line">~/K8s/Day5/demo2$ kubectl get deploy -o wide  <span class="comment"># ä½ å¯ä»¥åœ¨Deployä¸­æŸ¥çœ‹åˆ°ä¹Ÿå¯ä»¥é€šè¿‡RSæŸ¥çœ‹åˆ°åˆ›å»ºçš„Pod</span></span><br><span class="line">  <span class="comment"># NAME      READY(PodçŠ¶æ€)   UP-TO-DATE(ç”¨äºæ»šåŠ¨å‡çº§è¿‡ç¨‹ä¸­è¡¨ç¤ºå¤šå°‘å‰¯æœ¬å·²ç»æˆåŠŸå‡çº§)   AVAILABLE(å¯ç”¨)   AGE(å¥½ä¹…å‰åˆ›å»ºæˆ–è€…è¿è¡Œ)   CONTAINERS(å®¹å™¨åç§°)    IMAGES(é•œåƒ)      SELECTOR(æ ‡ç­¾é€‰æ‹©å™¨)</span></span><br><span class="line">  <span class="comment"># nginx-deployment-demo   3/3     3            3                2m33s   nginx-deployment   harbor.weiyigeek.top/test/nginx:v1.0   app=nginx-deployment</span></span><br><span class="line"></span><br><span class="line">~/K8s/Day5/demo2$ kubectl get rs  <span class="comment"># ã€é‡ç‚¹ã€‘ æ­¤å¤„å°è¯äº†Deploymentä¸æ˜¯ç›´æ¥ç®¡ç†å¹¶åˆ›å»ºPODï¼Œè€Œæ˜¯é€šè¿‡ReplicasSetç®¡ç†å¹¶åˆ›å»ºçš„POD;</span></span><br><span class="line">  <span class="comment"># NAME(æ³¨æ„ç‚¹)                      DESIRED(æœŸå¾…å¾—å‰¯æœ¬æ•°)   CURRENT(å½“å‰åˆ›å»ºå®Œæˆå¾—å‰¯æœ¬æ•°)   READY   AGE</span></span><br><span class="line">  <span class="comment"># nginx-deployment-demo-65f7d977f8   3         3         3       55s</span></span><br><span class="line"></span><br><span class="line">~/K8s/Day5/demo2$ kubectl get pod -o wide --show-labels</span><br><span class="line">  <span class="comment"># NAME(æ³¨æ„ç‚¹)                          READY   STATUS    RESTARTS   AGE   IP            NODE          LABELS</span></span><br><span class="line">  <span class="comment"># nginx-deployment-demo-65f7d977f8-285dc   1/1     Running   0          46s   10.244.1.25   k8s-node-4    app=nginx-deployment,pod-template-hash=65f7d977f8</span></span><br><span class="line">  <span class="comment"># nginx-deployment-demo-65f7d977f8-4xxf7   1/1     Running   0          46s   10.244.1.23   k8s-node-4    app=nginx-deployment,pod-template-hash=65f7d977f8</span></span><br><span class="line">  <span class="comment"># nginx-deployment-demo-65f7d977f8-dpj4p   1/1     Running   0          46s   10.244.1.24   k8s-node-4    app=nginx-deployment,pod-template-hash=65f7d977f8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) nginx è®¿é—®</span></span><br><span class="line">~/K8s/Day5/demo2$ curl http://10.244.1.&#123;23..25&#125;/host.html</span><br><span class="line">  <span class="comment"># Hostname: nginx-deployment-demo-65f7d977f8-4xxf7  &lt;br&gt;</span></span><br><span class="line">  <span class="comment"># Image Version: &lt;u&gt; 1.0 &lt;/u&gt;</span></span><br><span class="line">  <span class="comment"># Nginx Version: 1.19.4</span></span><br><span class="line">  <span class="comment"># Hostname: nginx-deployment-demo-65f7d977f8-dpj4p  &lt;br&gt;</span></span><br><span class="line">  <span class="comment"># Image Version: &lt;u&gt; 1.0 &lt;/u&gt;</span></span><br><span class="line">  <span class="comment"># Nginx Version: 1.19.4</span></span><br><span class="line">  <span class="comment"># Hostname: nginx-deployment-demo-65f7d977f8-285dc  &lt;br&gt;</span></span><br><span class="line">  <span class="comment"># Image Version: &lt;u&gt; 1.0 &lt;/u&gt;</span></span><br><span class="line">  <span class="comment"># Nginx Version: 1.19.4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) æ‰©å®¹</span></span><br><span class="line">~/K8s/Day5/demo2$ kubectl scale deployment nginx-deployment-demo --replicas 5</span><br><span class="line">  <span class="comment"># deployment.apps/nginx-deployment-demo scaled</span></span><br><span class="line"><span class="comment">#å¦‚æœé›†ç¾¤æ”¯æŒhorizontal pod autoscalingçš„è¯ï¼Œè¿˜å¯ä»¥ä¸ºDeploymentè®¾ç½®è‡ªåŠ¨æ‰©å±• </span></span><br><span class="line">kubectl autoscale deployment nginx-deployment-demo  --min=10 --max=15 --cpu-percent=80 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (6) æ›´æ–°å®¹å™¨ä¸­çš„é•œåƒ(æ³¨æ„é•œåƒåç§°æ˜¯åœ¨èµ„æºæ¸…å•ä¸­è®¾ç½®çš„)</span></span><br><span class="line">kubectl <span class="built_in">set</span> image deployment/nginx-deployment-demo nginx-deployment=harbor.weiyigeek.top/<span class="built_in">test</span>/nginx:v2.0</span><br><span class="line">  <span class="comment"># deployment.apps/nginx-deployment-demo image updated</span></span><br><span class="line">kubectl get rs -o wide  <span class="comment"># æŸ¥çœ‹ rs æ›¿æ¢å†å²ä»ä¸‹é¢å¯ä»¥çœ‹è§å·²ç»æˆåŠŸæ›¿æ¢æˆä¸ºäº†æ–°çš„é•œåƒ</span></span><br><span class="line">  <span class="comment"># NAME                               DESIRED   CURRENT   READY   AGE   CONTAINERS         IMAGES                                 SELECTOR</span></span><br><span class="line">  <span class="comment"># nginx-deployment-demo-59f9c8458c   5         5         5       88s   nginx-deployment   harbor.weiyigeek.top/test/nginx:v2.0   app=nginx-deployment,pod-template-hash=59f9c8458c</span></span><br><span class="line">  <span class="comment"># nginx-deployment-demo-65f7d977f8   0         0         0       29m   nginx-deployment   harbor.weiyigeek.top/test/nginx:v1.0   app=nginx-deployment,pod-template-hash=65f7d977f8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (7) æŸ¥çœ‹æ‰©å®¹æ›´æ–°çš„ç»“æœ</span></span><br><span class="line">~$ curl http://10.244.1.&#123;38..42&#125;/host.html</span><br><span class="line">  <span class="comment"># Hostname: nginx-deployment-demo-59f9c8458c-x8hsz  &lt;br&gt;</span></span><br><span class="line">  <span class="comment"># Image Version: &lt;u&gt; 2.0 &lt;/u&gt;  # æ³¨æ„åˆ°ç‰ˆæœ¬çš„å˜åŒ–</span></span><br><span class="line">  <span class="comment"># Nginx Version: 1.19.4</span></span><br><span class="line">  <span class="comment"># Hostname: nginx-deployment-demo-59f9c8458c-kjrjl  &lt;br&gt;</span></span><br><span class="line">  <span class="comment"># Image Version: &lt;u&gt; 2.0 &lt;/u&gt;</span></span><br><span class="line">  <span class="comment"># Nginx Version: 1.19.4</span></span><br><span class="line">  <span class="comment"># Hostname: nginx-deployment-demo-59f9c8458c-rb5nv  &lt;br&gt;</span></span><br><span class="line">  <span class="comment"># Image Version: &lt;u&gt; 2.0 &lt;/u&gt;</span></span><br><span class="line">  <span class="comment"># Nginx Version: 1.19.4</span></span><br><span class="line">  <span class="comment"># Hostname: nginx-deployment-demo-59f9c8458c-qw6h7  &lt;br&gt;</span></span><br><span class="line">  <span class="comment"># Image Version: &lt;u&gt; 2.0 &lt;/u&gt;</span></span><br><span class="line">  <span class="comment"># Nginx Version: 1.19.4</span></span><br><span class="line">  <span class="comment"># Hostname: nginx-deployment-demo-59f9c8458c-5zgdk  &lt;br&gt;</span></span><br><span class="line">  <span class="comment"># Image Version: &lt;u&gt; 2.0 &lt;/u&gt;</span></span><br><span class="line">  <span class="comment"># Nginx Version: 1.19.4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (8) å›æ»š &amp; å†å²ç‰ˆæœ¬</span></span><br><span class="line">$ kubectl rollout undo deployment/nginx-deployment-demo</span><br><span class="line">  <span class="comment"># deployment.apps/nginx-deployment-demo rolled back</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹rolloutçš„çŠ¶æ€</span></span><br><span class="line">$ kubectl rollout status deployment/nginx-deployment-demo  <span class="comment"># æˆåŠŸåçš„çŠ¶æ€</span></span><br><span class="line">  <span class="comment"># deployment "nginx-deployment-demo" successfully rolled out</span></span><br><span class="line"></span><br><span class="line">$ kubectl rollout <span class="built_in">history</span> deployment/nginx-deployment-demo</span><br><span class="line">  <span class="comment"># deployment.apps/nginx-deployment-demo</span></span><br><span class="line">  <span class="comment"># REVISION  CHANGE-CAUSE</span></span><br><span class="line">  <span class="comment"># 3         kubectl create --filename=nginx-deployment-demo.yaml --record=true</span></span><br><span class="line">  <span class="comment"># 4         kubectl create --filename=nginx-deployment-demo.yaml --record=true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (9) ä½¿ç”¨editå‘½ä»¤ç¼–è¾‘Deployment</span></span><br><span class="line">~/K8s/Day5/demo2$ kubectl edit deployment/nginx-deployment-demo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (10) æ”¶ç¼©</span></span><br><span class="line">~/K8s/Day5/demo2$ kubectl scale deployment nginx-deployment-demo --replicas 0</span><br><span class="line">  <span class="comment"># deployment.apps/nginx-deployment-demo scaled</span></span><br><span class="line">~/K8s/Day5/demo2$ kubectl get pod</span><br><span class="line">  <span class="comment"># NAME                                     READY   STATUS        RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># nginx-deployment-demo-59f9c8458c-5zgdk   1/1     Terminating   0          15m</span></span><br><span class="line">  <span class="comment"># nginx-deployment-demo-59f9c8458c-kjrjl   1/1     Terminating   0          15m</span></span><br><span class="line">  <span class="comment"># nginx-deployment-demo-59f9c8458c-qw6h7   1/1     Terminating   0          15m</span></span><br><span class="line">  <span class="comment"># nginx-deployment-demo-59f9c8458c-rb5nv   1/1     Terminating   0          15m</span></span><br><span class="line">  <span class="comment"># nginx-deployment-demo-59f9c8458c-x8hsz   1/1     Terminating   0          15m</span></span><br><span class="line">~/K8s/Day5/demo2$ kubectl get pod</span><br><span class="line">  <span class="comment"># No resources found in default namespace.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (11) åˆ é™¤Deploymentåˆ›å»ºçš„Pod</span></span><br><span class="line">~/K8s/Day5/demo2$ kubectl delete deploy nginx-deployment-demo</span><br><span class="line">  <span class="comment"># deployment.apps "nginx-deployment-demo" deleted</span></span><br><span class="line">~/K8s/Day5/demo2$ kubectl get pod   <span class="comment"># åœ¨æ²¡æœ‰æ‰§è¡Œæ”¶ç¼©ä¸º0çš„æƒ…å†µä¸‹è¿›è¡Œåœæ­¢å¹¶åˆ é™¤Deploymentæ§åˆ¶å™¨åˆ›å»ºçš„Pod</span></span><br><span class="line">  <span class="comment"># NAME                                     READY   STATUS(æ­£åœ¨ç»ˆç»“ä¸­)        RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># nginx-deployment-demo-65f7d977f8-285dc   1/1     Terminating               0          8m43s</span></span><br><span class="line">  <span class="comment"># nginx-deployment-demo-65f7d977f8-4xxf7   1/1     Terminating               0          8m43s</span></span><br><span class="line">  <span class="comment"># nginx-deployment-demo-65f7d977f8-dpj4p   1/1     Terminating               0          8m43s</span></span><br><span class="line">~/K8s/Day5/demo2$ kubectl get pod    <span class="comment"># å†æ¬¡æŸ¥çœ‹å‘ç°æ‰€ç”¨çš„Podèµ„æºå·²è¢«æ¸…ç†</span></span><br><span class="line">  <span class="comment"># No resources found in default namespace.</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>Tips : Deploymentã€ReplicaSetå’ŒPodé—´å¾—å‘½åå…³ç³»<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Deployment Name: [Name]</span><br><span class="line">ReplicaSet Name: [deployment-name]-[éšæœºå­—ç¬¦ä¸²]</span><br><span class="line">Pod Name: [replicaset-name]-[éšæœºå­—ç¬¦ä¸²]</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>Tips: Deployment æ›´æ–°ç­–ç•¥ã€å¦‚æœæˆ‘ä»¬éœ€è¦æ›´æ–°æ—¶å°†ä¼šåˆ›å»ºå‡ºä¸¤ä¸ªRSï¼Œ<code>å…¶ä¸­æ—§çš„RSä¸€æ¬¡å‡å°‘25%çš„podè€Œæ–°çš„RSä¸€æ¬¡åˆ›å»º25%çš„pod</code> ã€‘</p>
<ul>
<li>Deployment å¯ä»¥ä¿è¯åœ¨å‡çº§æ—¶åªæœ‰ä¸€å®šæ•°é‡çš„Podæ˜¯downçš„ã€‚é»˜è®¤çš„ï¼Œå®ƒä¼šç¡®ä¿è‡³å°‘æœ‰æ¯”æœŸæœ›çš„Podæ•°é‡å°‘ä¸€ä¸ªæ˜¯upçŠ¶æ€ï¼ˆæœ€å¤šä¸€ä¸ªä¸å¯ç”¨ï¼‰</li>
<li>DeploymentåŒæ—¶ä¹Ÿå¯ä»¥ç¡®ä¿åªåˆ›å»ºå‡ºè¶…è¿‡æœŸæœ›æ•°é‡çš„ä¸€å®šæ•°é‡çš„Podã€‚é»˜è®¤çš„ï¼Œå®ƒä¼šç¡®ä¿æœ€å¤šæ¯”æœŸæœ›çš„Podæ•°é‡å¤šä¸€ä¸ªçš„Podæ˜¯upçš„ï¼ˆæœ€å¤š1ä¸ªsurgeï¼‰</li>
<li>æœªæ¥çš„Kuberentes ç‰ˆæœ¬ä¸­ï¼Œå°†ä»1-1å˜æˆ25%-25%<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># deployments è¯¦ç»†æŸ¥çœ‹ ï¼ˆæ›´æ–°äº‹ä»¶æŸ¥çœ‹ï¼‰</span></span><br><span class="line">~$ kubectl describe deployments</span><br><span class="line">  <span class="comment"># Name:                   nginx-deployment-demo</span></span><br><span class="line">  <span class="comment"># Namespace:              default</span></span><br><span class="line">  <span class="comment"># CreationTimestamp:      Tue, 10 Nov 2020 21:20:57 +0800</span></span><br><span class="line">  <span class="comment"># Labels:                 &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># Annotations:            deployment.kubernetes.io/revision: 4</span></span><br><span class="line">  <span class="comment">#                         kubernetes.io/change-cause: kubectl create --filename=nginx-deployment-demo.yaml --record=true</span></span><br><span class="line">  <span class="comment"># Selector:               app=nginx-deployment</span></span><br><span class="line">  <span class="comment"># Replicas:               0 desired | 0 updated | 0 total | 0 available | 0 unavailable # å‰¯æœ¬æ•°é‡å˜åŒ–çŠ¶æ€</span></span><br><span class="line">  <span class="comment"># StrategyType:           RollingUpdate   # ç­–ç•¥ç±»å‹ ã€å…³é”®ç‚¹ã€‘</span></span><br><span class="line">  <span class="comment"># MinReadySeconds:        0</span></span><br><span class="line">  <span class="comment"># RollingUpdateStrategy:  25% max unavailable, 25% max surge # æ»šåŠ¨æ›´æ–°ç­–ç•¥ã€å…³é”®ç‚¹ã€‘</span></span><br><span class="line">  <span class="comment"># Pod Template:</span></span><br><span class="line">  <span class="comment">#   Labels:  app=nginx-deployment</span></span><br><span class="line">  <span class="comment">#   Containers:</span></span><br><span class="line">  <span class="comment">#    nginx-deployment:</span></span><br><span class="line">  <span class="comment">#     Image:        harbor.weiyigeek.top/test/nginx:v2.0</span></span><br><span class="line">  <span class="comment">#     Port:         80/TCP</span></span><br><span class="line">  <span class="comment">#     Host Port:    0/TCP</span></span><br><span class="line">  <span class="comment">#     Environment:  &lt;none&gt;</span></span><br><span class="line">  <span class="comment">#     Mounts:       &lt;none&gt;</span></span><br><span class="line">  <span class="comment">#   Volumes:        &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># Conditions:</span></span><br><span class="line">  <span class="comment">#   Type           Status  Reason</span></span><br><span class="line">  <span class="comment">#   ----           ------  ------</span></span><br><span class="line">  <span class="comment">#   Available      True    MinimumReplicasAvailable</span></span><br><span class="line">  <span class="comment">#   Progressing    True    NewReplicaSetAvailable</span></span><br><span class="line">  <span class="comment"># OldReplicaSets:  &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># NewReplicaSet:   nginx-deployment-demo-59f9c8458c (0/0 replicas created)</span></span><br><span class="line">  <span class="comment"># Events: (äº‹ä»¶) å¯æŸ¥çœ‹é‡‡ç”¨Deploymentè¿›è¡Œæ‰©ç¼©å®¹å¾—Podå®¹å™¨å‰¯æœ¬å˜åŒ–è®°å½•</span></span><br><span class="line">  <span class="comment">#   Type    Reason             Age                From                   Message</span></span><br><span class="line">  <span class="comment">#   ----    ------             ----               ----                   -------</span></span><br><span class="line">  <span class="comment">#   Normal  ScalingReplicaSet  50m                deployment-controller  Scaled up replica set nginx-deployment-demo-65f7d977f8 to 3</span></span><br><span class="line">  <span class="comment">#   Normal  ScalingReplicaSet  27m                deployment-controller  Scaled up replica set nginx-deployment-demo-849b98d6f7 to 2</span></span><br><span class="line">  <span class="comment">#   Normal  ScalingReplicaSet  24m (x2 over 27m)  deployment-controller  Scaled up replica set nginx-deployment-demo-849b98d6f7 to 3</span></span><br><span class="line">  <span class="comment">#   Normal  ScalingReplicaSet  23m (x2 over 29m)  deployment-controller  Scaled up replica set nginx-deployment-demo-65f7d977f8 to 5</span></span><br><span class="line">  <span class="comment">#   Normal  ScalingReplicaSet  23m                deployment-controller  Scaled down replica set nginx-deployment-demo-849b98d6f7 to 0</span></span><br><span class="line">  <span class="comment">#   Normal  ScalingReplicaSet  22m (x2 over 27m)  deployment-controller  Scaled down replica set nginx-deployment-demo-65f7d977f8 to 4</span></span><br><span class="line">  <span class="comment">#   Normal  ScalingReplicaSet  22m                deployment-controller  Scaled up replica set nginx-deployment-demo-59f9c8458c to 2</span></span><br><span class="line">  <span class="comment">#   Normal  ScalingReplicaSet  22m                deployment-controller  Scaled up replica set nginx-deployment-demo-59f9c8458c to 3</span></span><br><span class="line">  <span class="comment">#   Normal  ScalingReplicaSet  22m                deployment-controller  Scaled down replica set nginx-deployment-demo-65f7d977f8 to 3</span></span><br><span class="line">  <span class="comment">#   Normal  ScalingReplicaSet  22m                deployment-controller  Scaled up replica set nginx-deployment-demo-59f9c8458c to 4</span></span><br><span class="line">  <span class="comment">#   Normal  ScalingReplicaSet  22m (x4 over 22m)  deployment-controller  (combined from similar events): Scaled down replica set nginx-deployment-demo-65f7d977f8 to 0</span></span><br><span class="line">  <span class="comment">#   Normal  ScalingReplicaSet  7m14s              deployment-controller  Scaled down replica set nginx-deployment-demo-59f9c8458c to 0</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Tips : Deployment å›æ»šç­–ç•¥<code>Rolloverã€å¤šä¸ªrolloutå¹¶è¡Œã€‘</code></p>
<ul>
<li>åªè¦Deploymentçš„rolloutè¢«è§¦å‘ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªrevisionã€‚ä¹Ÿå°±æ˜¯è¯´å½“ä¸”ä»…å½“Deploymentçš„Pod template(å¦‚<code>.spec.template</code>)è¢«æ›´æ”¹ï¼Œä¾‹å¦‚æ›´æ–°templateä¸­çš„labelå’Œå®¹å™¨é•œåƒæ—¶ï¼Œå°±ä¼šåˆ›å»ºå‡ºä¸€ä¸ªæ–°çš„revisionã€‚å…¶ä»–çš„æ›´æ–°ï¼Œ</li>
<li>æ¯”å¦‚æ‰©å®¹Deploymentä¸ä¼šåˆ›å»ºrevision, å› æ­¤æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ‰‹åŠ¨æˆ–è€…è‡ªåŠ¨æ‰©å®¹ã€‚è¿™æ„å‘³ç€å½“æ‚¨å›é€€åˆ°å†å²revisionæ—¶ï¼Œåªæœ‰Deploymentä¸­çš„<code>Pod template</code>éƒ¨åˆ†æ‰ä¼šå›é€€<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è®¾ç½®é•œåƒ</span></span><br><span class="line">kubectl <span class="built_in">set</span> image deployment/Podåç§° å®¹å™¨åç§°=é•œåƒä»“åº“/åç§°:ç‰ˆæœ¬</span><br><span class="line"><span class="comment">#æŸ¥çœ‹å½“å‰æ›´æ–°çŠ¶æ€</span></span><br><span class="line">kubectl rollout status deployments nginx-deployment </span><br><span class="line">kubectl get pods </span><br><span class="line"><span class="comment">#æŸ¥çœ‹å¯å›æ»šçš„å†å²ç‰ˆæœ¬</span></span><br><span class="line">kubectl rollout <span class="built_in">history</span> deployment/nginx-deployment </span><br><span class="line">kubectl rollout undo deployment/nginx-deployment</span><br><span class="line"><span class="comment">##å¯ä»¥ä½¿ç”¨--revisionå‚æ•°æŒ‡å®šå›é€€åˆ°æŸä¸ªå†å²ç‰ˆæœ¬ </span></span><br><span class="line">kubectl rollout undo deployment/nginx-deployment --to-revision=2  </span><br><span class="line"><span class="comment">##æš‚åœ deploymentçš„æ›´æ–°</span></span><br><span class="line">kubectl rollout pause deployment/nginx-deployment</span><br></pre></td></tr></table></figure></li>
<li>æ‚¨å¯ä»¥ç”¨ <code>kubectl rollout status</code>å‘½ä»¤æŸ¥çœ‹Deploymentæ˜¯å¦å®Œæˆã€‚å¦‚æœ rolloutæˆåŠŸå®Œæˆï¼Œ<code>kubect1rollout status</code> å°†è¿”å›ä¸€ä¸ª0å€¼çš„ <code>Exit Code</code> ã€éå¸¸å€¼å¾—æ³¨æ„åœ¨è¿›è¡Œè‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬ç¼–ç¨‹æ—¶éå¸¸ä½¿ç”¨ã€‘<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubect1 rollout status deploy/nginx</span><br><span class="line">$ <span class="built_in">echo</span> $? <span class="comment"># åœ¨å®é™…è„šæœ¬å¼€å‘ä¸­å¯ä»¥åˆ¤æ–­æ˜¯å¦å›æ»šæˆåŠŸ</span></span><br><span class="line">0</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Tips : Deployment å†å²ç‰ˆæœ¬ç­–ç•¥</p>
<ul>
<li>æ‚¨å¯ä»¥é€šè¿‡è®¾ç½® .spec.revisonHistoryLimit é¡¹æ¥æŒ‡å®š deployment æœ€å¤šä¿ç•™å¤šå°‘revisionå†å²è®°å½•(ç¼ºçœ<code>revisionHistoryLimit: 10</code>), å¦‚æœå°†è¯¥é¡¹è®¾ç½®ä¸º 0 Deployment å°±ä¸å…è®¸å›é€€äº†</li>
</ul>
<p>Tips: å‘½ä»¤å¼ &amp; ç”³æ˜å¼ç¼–ç¨‹</p>
<ul>
<li>å‘½ä»¤å¼ç¼–ç¨‹ï¼ˆ<code>rs</code>ï¼‰ createï¼ˆä¼˜ï¼‰ apply<ul>
<li>å®ƒä¾§é‡äºå¦‚ä½•å®ç°ç¨‹åºï¼Œå°±åƒæˆ‘ä»¬åˆšæ¥è§¦ç¼–ç¨‹çš„æ—¶å€™é‚£æ ·ï¼Œæˆ‘ä»¬éœ€è¦æŠŠç¨‹åºçš„å®ç°è¿‡ç¨‹æŒ‰ç…§é€»è¾‘ç»“æœä¸€æ­¥æ­¥å†™ä¸‹æ¥ï¼›</li>
</ul>
</li>
<li>ç”³æ˜å¼ç¼–ç¨‹ï¼ˆ<code>Deployment</code>ï¼‰applyï¼ˆä¼˜ï¼‰    create<ul>
<li>å®ƒä¾§é‡äºå®šä¹‰æƒ³è¦ä»€ä¹ˆç„¶åå‘Šè¯‰è®¡ç®—æœº/å¼•æ“è®©ä»–å¸®ä½ å»å®ç°, ç±»ä¼¼äºSQLè¯­å¥ï¼›</li>
</ul>
</li>
</ul>
<p><br/></p>
<h3 id="4-DaemonSet"><a href="#4-DaemonSet" class="headerlink" title="4.DaemonSet"></a>4.DaemonSet</h3><p>æè¿°: å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸€å°NodeèŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ä¸ªå®¹å™¨åº”ç”¨, æˆ‘ä»¬å¯ä»¥é‡‡ç”¨k8sæä¾›çš„DaemonSetæ§åˆ¶å™¨æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚; å³ DaemonSet ç±»ä¼¼ä¸å®ˆæŠ¤è¿›ç¨‹çš„åº”ç”¨ç¨‹åºå¯ç”¨ï¼Œå®ƒèƒ½å¤Ÿè®©æ‰€æœ‰æˆ–æŒ‡å®šçš„Nodeä¸Šè¿è¡ŒåŒä¸€ä¸ªPod;</p>
<p><strong>DaemonSet åŠŸèƒ½è¯´æ˜:</strong></p>
<ul>
<li>(1) å½“ä¸€ä¸ªæ–°èŠ‚ç‚¹åŠ å…¥åˆ°k8sé›†ç¾¤ä¸­æ—¶DaemonSetåˆ›å»ºçš„Podå°†ä¼šè¢«è‡ªåŠ¨è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ä¹‹ä¸­;</li>
<li>(2) å½“ä¸€ä¸ªèŠ‚ç‚¹ä»k8sé›†ç¾¤ä¸­è¢«ç§»é™¤æ—¶DeamonSetåˆ›å»ºçš„Podä¹Ÿå°†ä¼šä»è¯¥èŠ‚ç‚¹ç§»é™¤;</li>
<li>(3) å¦‚æœåˆ é™¤æŸä¸ªåˆ›å»ºçš„DaemonSetæ‰€æœ‰è·Ÿè¿™ä¸ªDaemonSetç›¸å…³çš„Podsåœ¨å„ä¸ªèŠ‚ç‚¹éƒ½å°†ä¼šè¢«åˆ é™¤;</li>
</ul>
<p><br/></p>
<p><strong>Q:DaemonSet çš„åº”ç”¨åœºæ™¯:</strong></p>
<ul>
<li>åœ¨æ¯ä¸ªNode ä¸Šè¿è¡Œé›†ç¾¤å­˜å‚¨ daemonï¼Œä¾‹å¦‚è¿è¡Œglusterdã€ceph</li>
<li>åœ¨æ¯ä¸ªNode ä¸Šè¿è¡Œæ—¥å¿—æ”¶é›† daemonï¼Œä¾‹å¦‚fluentdã€1ogstash</li>
<li>åœ¨æ¯ä¸ªNode ä¸Šè¿è¡Œç›‘æ§daemonï¼Œä¾‹å¦‚Prometheus Node Exporter[<a href="https://github.com/prometheus/node_exporter]ã€collectdã€Datadogä»£ç†ã€New" target="_blank" rel="noopener">https://github.com/prometheus/node_exporter]ã€collectdã€Datadogä»£ç†ã€New</a> Relic ä»£ç†ï¼Œæˆ–Ganglia gmond</li>
</ul>
<p>ç¤ºä¾‹: ä¾‹å¦‚ kube-proxy ã€kube-system  åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æœ‰ä¸€ä¸ªPod;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl get daemonsets.apps --all-namespaces</span><br><span class="line">  <span class="comment"># NAMESPACE     NAME          DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE</span></span><br><span class="line">  <span class="comment"># kube-system   calico-node   7         7         7       7            7           kubernetes.io/os=linux   22d</span></span><br><span class="line">  <span class="comment"># kube-system   kube-proxy    7         7         7       7            7           kubernetes.io/os=linux   24d</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>DaemonSetçš„åˆ›å»ºå’ŒæŸ¥çœ‹</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DaemonSet æ§åˆ¶å™¨èµ„æºæ¸…å•</span></span><br><span class="line"><span class="string">cat</span> <span class="string">&gt; daemonset-example.yaml &lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">apps/v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">daemonset-example</span>       <span class="comment"># DaemonSet æ§åˆ¶åˆ›å»ºèµ„æºå¯¹è±¡çš„åç§°</span></span><br><span class="line"><span class="attr">  labels:</span> </span><br><span class="line"><span class="attr">    app:</span> <span class="string">daemonset</span> </span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  selector:</span>                     <span class="comment"># é€‰æ‹©å™¨è¿›è¡ŒåŒ¹é…æ¨¡æ¿æ ‡ç­¾</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">daemonset-example</span>   <span class="comment"># æ³¨æ„ç‚¹: åŒ¹é…çš„æ ‡ç­¾å¿…é¡»å’Œpodæºæ•°æ®nameé”®å€¼ä¸€è‡´;</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span> </span><br><span class="line"><span class="attr">        name:</span> <span class="string">daemonset-example</span></span><br><span class="line"><span class="attr">    spec:</span> </span><br><span class="line">      <span class="comment"># tolerations:   # å®¹å¿è¯´æ˜</span></span><br><span class="line">      <span class="comment">#   - key: node-role.kubernetes.io/master</span></span><br><span class="line">      <span class="comment">#     effect: NoShedule</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">daemonset-example</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">harbor.weiyigeek.top/test/nginx:v2.0</span></span><br><span class="line"><span class="attr">        imagePullPolicy:</span> <span class="string">IfNotPresent</span>   <span class="comment"># å¦‚æœæœ¬åœ°å­˜åœ¨åˆ™ä¸æ‹‰å–</span></span><br><span class="line"><span class="attr">        resources:</span>                      <span class="comment"># èµ„æºé™åˆ¶</span></span><br><span class="line"><span class="attr">          limits:</span></span><br><span class="line"><span class="attr">            cpu:</span> <span class="number">200</span><span class="string">m</span></span><br><span class="line"><span class="attr">            memory:</span> <span class="number">200</span><span class="string">Mi</span></span><br><span class="line"><span class="attr">          requests:</span></span><br><span class="line"><span class="attr">            cpu:</span> <span class="number">100</span><span class="string">m</span></span><br><span class="line"><span class="attr">            memory:</span> <span class="number">100</span><span class="string">Mi</span></span><br><span class="line"><span class="attr">      terminationGracePeriodSeconds:</span> <span class="number">30</span>  <span class="comment"># é”€æ¯å®½é™å®é™…(s)</span></span><br><span class="line"></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<p>æ“ä½œæµç¨‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) æŸ¥çœ‹ DaemonSet çš„ api èµ„æºåç§°</span></span><br><span class="line">$ kubectl api-resources | grep <span class="string">"DaemonSet"</span></span><br><span class="line">  <span class="comment"># daemonsets   ds   apps   true    DaemonSet</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) éƒ¨ç½² </span></span><br><span class="line">$ kubectl create -f daemonset-example.yaml</span><br><span class="line">  <span class="comment"># daemonset.apps/daemonset-example created</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) æŸ¥çœ‹(ç”±äºè¿™é‡Œåªæœ‰ä¸€ä¸ªnodeèŠ‚ç‚¹)</span></span><br><span class="line">~/K8s/Day5/demo3$ kubectl get ds -o wide                 <span class="comment"># daemonset æ§åˆ¶å™¨åˆ›å»ºä¿¡æ¯</span></span><br><span class="line">  <span class="comment"># NAME                DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE     CONTAINERS          IMAGES                                 SELECTOR</span></span><br><span class="line">  <span class="comment"># daemonset-example   1         1         1       1            1           &lt;none&gt;          2m26s   daemonset-example   harbor.weiyigeek.top/test/nginx:v2.0   name=daemonset-example</span></span><br><span class="line">~/K8s/Day5/demo3$ kubectl get pod -o wide --show-labels  <span class="comment"># åˆ›å»ºçš„podä¿¡æ¯</span></span><br><span class="line">  <span class="comment"># NAME                      READY   STATUS    RESTARTS   AGE   IP            NODE         LABELS</span></span><br><span class="line">  <span class="comment"># daemonset-example-858ks   1/1     Running   0          49s   10.244.1.43   k8s-node-4   controller-revision-hash=5bcf6b6794,name=daemonset-example,pod-template-generation=1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) éªŒè¯ daemonset æ˜¯å¦æœ‰ä¸Šè¿°ä½œç”¨æˆ‘ä»¬å°†masterèŠ‚ç‚¹æ±¡ç‚¹å»é™¤, ç„¶åæŸ¥çœ‹ä¸ä¸Šé¢çš„åŒºåˆ«;</span></span><br><span class="line">$ kubectl describe node k8s-master-1 | grep <span class="string">"Taints"</span></span><br><span class="line">  Taints:             node-role.kubernetes.io/master:NoSchedule</span><br><span class="line">$ kubectl taint nodes k8s-master-1 node-role.kubernetes.io/master=:NoSchedule-  </span><br><span class="line">  <span class="comment"># node/k8s-master-1 untainted  # æ— æ±¡ç‚¹çš„</span></span><br><span class="line">~/K8s/Day5/demo3$  kubectl describe node k8s-master-1 | grep <span class="string">"Taints"</span></span><br><span class="line">  Taints:             &lt;none&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) ç»“æœ</span></span><br><span class="line">~/K8s/Day5/demo3$ kubectl get ds -o wide  <span class="comment"># å¯ä»¥çœ‹è§å½“å‰daemonsetæ§åˆ¶å™¨å·²ç»ç”Ÿæˆä¸¤ä¸ªå¯ç”¨çš„pod</span></span><br><span class="line">  <span class="comment"># NAME                DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE   CONTAINERS          IMAGES                                 SELECTOR</span></span><br><span class="line">  <span class="comment"># daemonset-example   2         2         2       2            2           &lt;none&gt;          20m   daemonset-example   harbor.weiyigeek.top/test/nginx:v2.0   name=daemonset-example</span></span><br><span class="line"></span><br><span class="line">~/K8s/Day5/demo3$ kubectl get pod -o wide --show-labels  <span class="comment"># æŸ¥çœ‹åˆ°èŠ‚ç‚¹åˆ†åˆ«åœ¨MasterèŠ‚ç‚¹ä»¥åŠå·¥ä½œèŠ‚ç‚¹ä¸Šå­˜åœ¨</span></span><br><span class="line">  <span class="comment"># NAME                      READY   STATUS    RESTARTS   AGE    IP            NODE          LABELS</span></span><br><span class="line">  <span class="comment"># daemonset-example-4rvkf   1/1     Running   0          173m   10.244.0.6    k8s-master-1   controller-revision-hash=5bcf6b6794,name=daemonset-example,pod-template-generation=1</span></span><br><span class="line">  <span class="comment"># daemonset-example-858ks   1/1     Running   0          3h9m   10.244.1.43   k8s-node-4    controller-revision-hash=5bcf6b6794,name=daemonset-example,pod-template-generation=1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (6) Podè®¿é—®</span></span><br><span class="line">~/K8s/Day5/demo3$ curl http://10.244.0.6/host.html</span><br><span class="line">  <span class="comment"># Hostname: daemonset-example-4rvkf  &lt;br&gt; Image Version: &lt;u&gt; 2.0 &lt;/u&gt; Nginx Version: 1.19.4</span></span><br><span class="line">~/K8s/Day5/demo3$ curl http://10.244.1.43/host.html</span><br><span class="line">  <span class="comment"># Hostname: daemonset-example-858ks  &lt;br&gt; Image Version: &lt;u&gt; 2.0 &lt;/u&gt; Nginx Version: 1.19.4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (7) å†æ¬¡è®¾ç½®masterèŠ‚ç‚¹çš„æ±¡ç‚¹</span></span><br><span class="line">~/K8s/Day5/demo3$ kubectl taint node k8s-master-1 node-role.kubernetes.io/master=:NoSchedule</span><br><span class="line">  <span class="comment"># node/k8s-master-1 tainted</span></span><br><span class="line">~/K8s/Day5/demo3$ kubectl get ds  <span class="comment"># å…³é”®ç‚¹ æ­¤æ—¶daemonsetç®¡ç†çš„Podå·²ç»åªæœ‰ä¸€ä¸ªäº†;</span></span><br><span class="line">  <span class="comment"># NAME                DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE</span></span><br><span class="line">  <span class="comment"># daemonset-example   1         1         1       1            1           &lt;none&gt;          3h19m</span></span><br><span class="line">~$ kubectl get pod -o wide --show-labels  <span class="comment"># æ­¤æ—¶è¿è¡Œåœ¨ Master èŠ‚ç‚¹ä¸Šçš„Pod(daemonset-example-4rvkf)å˜æˆäº†è‡ªåŠ©å¼Pod</span></span><br><span class="line">  <span class="comment"># NAME                      READY   STATUS    RESTARTS   AGE     IP            NODE          LABELS</span></span><br><span class="line">  <span class="comment"># daemonset-example-4rvkf   1/1     Running   0          3h5m    10.244.0.6    k8s-master-1  controller-revision-hash=5bcf6b6794,name=daemonset-example,pod-template-generation=1</span></span><br><span class="line">  <span class="comment"># daemonset-example-858ks   1/1     Running   0          3h22m   10.244.1.43   k8s-node-4    controller-revision-hash=5bcf6b6794,name=daemonset-example,pod-template-generation=1</span></span><br><span class="line">~$ kubectl delete pod daemonset-example-4rvkf <span class="comment"># (é‡ç‚¹)åˆ é™¤åç”±äºä¸å—æ§åˆ¶å™¨ç®¡ç†åˆ™ä¸ä¼šé‡æ–°è¿è¡Œæ»¡è¶³å‰¯æœ¬æ•°çš„Pod</span></span><br><span class="line">  <span class="comment"># pod "daemonset-example-4rvkf" deleted</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (8) åˆ é™¤ daemonset æ§åˆ¶å™¨åˆ›å»ºçš„Pod(å¦‚æ·»åŠ  -cascade=false å‚æ•°åˆ™åˆ é™¤DeamonSetæ§åˆ¶å™¨åˆ›å»ºçš„èµ„æºæ—¶ä¸ä¼šå°†åˆ›å»ºçš„Podåˆ é™¤ï¼Œç›¸å -cascade=true åˆ™å°†ä¸€èµ·åˆ é™¤)</span></span><br><span class="line">$ kubectl -cascade=<span class="literal">false</span> delete ds daemonset-example</span><br><span class="line">$ kubectl -cascade=<span class="literal">true</span> delete ds daemonset-example  <span class="comment"># ç¼ºçœ</span></span><br><span class="line">  <span class="comment"># daemonset.apps "daemonset-example" deleted</span></span><br></pre></td></tr></table></figure></p>
<p>PS : ç”±äºæ±¡ç‚¹çš„åŸå› æ‰€æœ‰çš„Podä¸ä¼šè¿è¡Œåœ¨MasterèŠ‚ç‚¹ä¸­ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æˆ–è€…åœ¨èµ„æºæ¸…å•ä¸­ç”³æ˜å–æ¶ˆæ±¡ç‚¹ï¼Œæˆ–è€…åœ¨yamlèµ„æºæ¸…å•æ–‡ä»¶ä¸­çš„ <code>Â·spec</code>å¯¹è±¡ä¸­æ·»åŠ å¦‚ä¸‹;<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment"># tolerations:   # å®¹å¿è¯´æ˜</span></span><br><span class="line">      <span class="comment">#   - key: node-role.kubernetes.io/master</span></span><br><span class="line">      <span class="comment">#     effect: NoShedule</span></span><br><span class="line"><span class="string">```</span> </span><br><span class="line"></span><br><span class="line"><span class="string">**Q:</span> <span class="string">é™æ€</span> <span class="string">Pod</span> <span class="string">ä¸</span> <span class="string">DaemonSet</span> <span class="string">çš„ä¸åŒç‚¹ã€‚**</span></span><br><span class="line"><span class="string">&gt; A: å‰é¢æˆ‘ä»¬è¯´è¿‡ Static Pod ä¸å—kubectlå’Œå…¶ä»–k8s API å®¢æˆ·ç«¯ç®¡ç†ï¼Œå¹¶ä¸”ä¸ä¾èµ–äºApi Serverï¼Œè¿™ä½¿å¾—å®ƒä»¬åœ¨é›†ç¾¤å¯åŠ¨çš„æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ï¼Œå®é™…ç¯å¢ƒä¸­é™¤éæœ‰ç‰¹æ®Šåº”ç”¨è¯·ä¸è¦ä½¿ç”¨æ­¤ç§æ–¹å¼;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Tips ï¼šå¯ä»¥é€šè¿‡ `.spec.template.spec.nodeSelector` æˆ–è€… `Affinity` ç­‰é«˜çº§è°ƒåº¦ç­–ç•¥éƒ¨ç½²DaemonSetåˆ°æŒ‡å®šèŠ‚ç‚¹æˆ–è€…æ‹“æ‰‘;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;br/&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### 5.Job </span></span><br><span class="line"><span class="string">æè¿°: Job æ§åˆ¶å™¨èµ„æºå¯¹è±¡æœ‰è‡ªèº«çš„çº é”™èƒ½åŠ›, å¦‚æœJobè¿è¡Œçš„è„šæœ¬(script)æ²¡æœ‰ä»¥0çŠ¶æ€ç é€€å‡ºçš„è¯(æˆ–è€…è„šæœ¬æ‰§è¡Œ)ï¼ŒJobå°†ä¼šé‡æ–°æ‰§è¡ŒJobè´Ÿè´£æ‰¹å¤„ç†ä»»åŠ¡ï¼Œä»…æ‰§è¡Œä¸€æ¬¡çš„ä»»åŠ¡ï¼Œå®ƒä¿è¯æ‰¹å¤„ç†ä»»åŠ¡çš„ä¸€ä¸ªæˆ–å¤šä¸ªPodæˆåŠŸç»“æŸ</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å³å½“è¿”å›ç»“æœä¸ºé0çš„æƒ…å†µä¸‹å°†ä¼šé‡æ–°æ‰§è¡Œ, å¹¶ä¸”ä¿è¯æ‰¹å¤„ç†æˆåŠŸæ‰§è¡Œ;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;br/&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**Q: ä»€ä¹ˆæ˜¯Job?**</span></span><br><span class="line"><span class="string">&gt; A: Jobè´Ÿè´£æ‰¹å¤„ç†ä»»åŠ¡ï¼Œå³ä»…æ‰§è¡Œä¸€æ¬¡çš„ä»»åŠ¡ï¼Œå®ƒä¿è¯æ‰¹å¤„ç†ä»»åŠ¡çš„ä¸€ä¸ªæˆ–å¤šä¸ªPodæˆåŠŸç»“æŸ</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">èµ„æºå¯¹è±¡ç‰¹æ®Šè¯´æ˜:</span></span><br><span class="line"><span class="string">```bash</span></span><br><span class="line"><span class="string">Â·spec.template æ ¼å¼åŒPod</span></span><br><span class="line"><span class="string">Â·RestartPolicy ä»…æ”¯æŒ `Never æˆ– OnFailure` å•ä¸ªPodæ—¶ï¼Œé»˜è®¤PodæˆåŠŸè¿è¡ŒåJobå³ç»“æŸ</span></span><br><span class="line"><span class="string">.spec.completions æ ‡å¿—Jobç»“æŸéœ€è¦æˆåŠŸè¿è¡Œçš„Podä¸ªæ•°ï¼Œé»˜è®¤ä¸º1Â·</span></span><br><span class="line"><span class="string">.spec.parallelism æ ‡å¿—å¹¶è¡Œè¿è¡Œçš„Podçš„ä¸ªæ•°ï¼Œé»˜è®¤ä¸º1</span></span><br><span class="line"><span class="string">Â·spec.activeDeadlineseconds æ ‡å¿—å¤±è´¥Podçš„é‡è¯•æœ€å¤§æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ä¸ä¼šç»§ç»­é‡è¯•</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>Job &amp; CronJob æ§åˆ¶å™¨èµ„æºç±»å‹åŠç‰ˆæœ¬:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl api-resources | grep <span class="string">"Job"</span></span><br><span class="line">  <span class="comment"># jobs             batch         true         Job</span></span><br><span class="line">  <span class="comment"># cronjobs    cj   batch         true         CronJob</span></span><br><span class="line"></span><br><span class="line">$ kubectl api-versions | grep $(kubectl api-resources | grep <span class="string">" Job"</span> | awk -F <span class="string">" "</span> <span class="string">'&#123;print $2&#125;'</span>)</span><br><span class="line">  <span class="comment"># batch/v1           # jobs </span></span><br><span class="line">  <span class="comment"># batch/v1beta1      # cronjobs</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Jobèµ„æºæ–‡ä»¶ç¤ºä¾‹:</strong><br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; job-demo.yaml &lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">batch/v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">job-demo-pi</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">job-demo-pi</span> </span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">busybox-pi</span> </span><br><span class="line"><span class="attr">        image:</span> <span class="string">busybox</span></span><br><span class="line"><span class="attr">        command:</span> <span class="string">["/bin/sh","-c","date;echo</span> <span class="string">Job</span> <span class="string">Controller</span> <span class="string">Demo!"]</span>  <span class="comment">#åˆ©ç”¨Perlæ±‚å–åœ†å‘¨ç‡ å°æ•°ç‚¹åçš„2000ä½</span></span><br><span class="line"><span class="attr">        imagePullPolicy:</span> <span class="string">IfNotPresent</span>   <span class="comment"># å¦‚æœæœ¬åœ°å­˜åœ¨åˆ™ä¸æ‹‰å–</span></span><br><span class="line"><span class="attr">      restartPolicy:</span> <span class="string">Never</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></p>
<p>æ“ä½œå®ä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) Job æ§åˆ¶å™¨ åˆ›å»º Pod</span></span><br><span class="line">~/K8s/Day5/demo3$ kubectl create -f job-demo.yaml</span><br><span class="line">  <span class="comment"># job.batch/job-demo-pi created</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æŸ¥çœ‹</span></span><br><span class="line">~/K8s/Day5/demo3$ kubectl get <span class="built_in">jobs</span> -o wide --show-labels</span><br><span class="line">  <span class="comment"># NAME          COMPLETIONS   DURATION   AGE   CONTAINERS   IMAGES    SELECTOR                                              LABELS</span></span><br><span class="line">  <span class="comment"># job-demo-pi   1/1           1s         41s   busybox-pi   busybox   controller-uid=3988087c-fa65-4ca0-90e4-c23bbf01884c   controller-uid=3988087c-fa65-4ca0-90e4-c23bbf01884c,job-name=job-demo-pi</span></span><br><span class="line">~/K8s/Day5/demo3$ kubectl get pod -o wide --show-labels</span><br><span class="line">  <span class="comment"># NAME                READY   STATUS      RESTARTS   AGE   IP            NODE         LABELS</span></span><br><span class="line">  <span class="comment"># job-demo-pi-p7j59   0/1     Completed   0          60s   10.244.1.57   k8s-node-4   controller-uid=3988087c-fa65-4ca0-90e4-c23bbf01884c,job-name=job-demo-pi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) ç»“æœéªŒè¯</span></span><br><span class="line">~/K8s/Day5/demo3$ kubectl logs job-demo-pi-p7j59</span><br><span class="line">  <span class="comment"># Wed Nov 11 07:49:00 UTC 2020</span></span><br><span class="line">  <span class="comment"># Job Controller Demo!</span></span><br><span class="line">~/K8s/Day5/demo3$ kubectl describe pod job-demo-pi-p7j59</span><br><span class="line">  <span class="comment"># Events:</span></span><br><span class="line">  <span class="comment"># Type    Reason     Age    From               Message</span></span><br><span class="line">  <span class="comment"># ----    ------     ----   ----               -------</span></span><br><span class="line">  <span class="comment"># Normal  Scheduled  3m54s  default-scheduler  Successfully assigned default/job-demo-pi-p7j59 to k8s-node-4</span></span><br><span class="line">  <span class="comment"># Normal  Pulled     3m53s  kubelet            Container image "busybox" already present on machine</span></span><br><span class="line">  <span class="comment"># Normal  Created    3m53s  kubelet            Created container busybox-pi</span></span><br><span class="line">  <span class="comment"># Normal  Started    3m53s  kubelet            Started container busybox-pi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) åˆ é™¤ Jobs æ§åˆ¶å™¨åˆ›å»ºçš„èµ„æº</span></span><br><span class="line">~/K8s/Day5/demo3$ kubectl delete -f job-demo.yaml <span class="comment"># æŒ‡å®š</span></span><br><span class="line"><span class="comment"># job.batch "job-demo-pi" deleted</span></span><br><span class="line">~/K8s/Day5/demo3$ kubectl delete <span class="built_in">jobs</span> --all       <span class="comment"># åˆ é™¤æ‰€æœ‰</span></span><br><span class="line"><span class="comment"># job.batch "job-demo-pi" deleted</span></span><br><span class="line">~/K8s/Day5/demo3$ kubectl get <span class="built_in">jobs</span></span><br><span class="line">  <span class="comment"># No resources found in default namespace.</span></span><br><span class="line">~/K8s/Day5/demo3$ kubectl get pod</span><br><span class="line">  <span class="comment"># No resources found in default namespace.  # å¯ä»¥çœ‹è§å·²ç»æ‰€æœ‰Podèµ„æºå·²ç»è¢«åˆ é™¤</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="6-CronJob"><a href="#6-CronJob" class="headerlink" title="6.CronJob"></a>6.CronJob</h3><p>5.CronJobã€æœ¬è´¨ä¸Šæ˜¯åœ¨ç‰¹å®šçš„æ—¶é—´å¾ªç¯åˆ›å»ºJobå»å®ç°çš„ã€‘æ‰¹å¤„ç†è„šæœ¬ç¨‹åºå¯ç”¨<br>CronJob ç®¡ç†åŸºäºæ—¶é—´çš„Jobï¼Œå³ï¼š<br>Â·åœ¨ç»™å®šæ—¶é—´ç‚¹åªè¿è¡Œä¸€æ¬¡ <code>åˆ† æ—¶ æ—¥ æœˆ å‘¨</code><br>Â·å‘¨æœŸæ€§åœ°åœ¨ç»™å®šæ—¶é—´ç‚¹è¿è¡Œ<br>ã€€ä½¿ç”¨å‰ææ¡ä»¶ï¼š<strong>å½“å‰ä½¿ç”¨çš„Kubernetesé›†ç¾¤ï¼Œç‰ˆæœ¬&gt;=1.8ï¼ˆå¯¹Cronjobï¼‰ã€‚å¯¹äºå…ˆå‰ç‰ˆæœ¬çš„é›†ç¾¤ï¼Œç‰ˆæœ¬&lt;1.8ï¼Œå¯åŠ¨API Serveræ—¶ï¼Œé€šè¿‡ä¼ é€’é€‰é¡¹â€“runtime-config=batch/v2alpha1=true å¯ä»¥å¼€å¯batch/v2alpha1API</strong><br>ã€€å…¸å‹çš„ç”¨æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š<br>Â·åœ¨ç»™å®šçš„æ—¶é—´ç‚¹è°ƒåº¦Jobè¿è¡Œ<br>åˆ›å»ºå‘¨æœŸæ€§è¿è¡Œçš„Jobï¼Œä¾‹å¦‚ï¼šæ•°æ®åº“å¤‡ä»½ã€å‘é€é‚®ä»¶</p>
<p>CronJob Spec<br>ã€€ã€€Â·spec.templateæ ¼å¼åŒPod<br>ã€€ã€€Â·RestartPolicyä»…æ”¯æŒNeveræˆ–OnFailure Â·å•ä¸ªPodæ—¶ï¼Œé»˜è®¤PodæˆåŠŸè¿è¡ŒåJobå³ç»“æŸÂ·<br>ã€€ã€€.spec.completionsæ ‡å¿—Jobç»“æŸéœ€è¦æˆåŠŸè¿è¡Œçš„Podä¸ªæ•°ï¼Œé»˜è®¤ä¸º1Â·<br>ã€€ã€€.spec.parallelism æ ‡å¿—å¹¶è¡Œè¿è¡Œçš„Podçš„ä¸ªæ•°ï¼Œé»˜è®¤ä¸º1<br>ã€€ã€€Â·spec.activeDeadlineSeconds æ ‡å¿—å¤±è´¥Podçš„é‡è¯•æœ€å¤§æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ä¸ä¼šç»§ç»­é‡è¯•</p>
<p>ã€€ã€€.spec.scheduleï¼šè°ƒåº¦ï¼Œå¿…éœ€å­—æ®µï¼ŒæŒ‡å®šä»»åŠ¡è¿è¡Œå‘¨æœŸï¼Œæ ¼å¼åŒ CronÂ·<br>ã€€ã€€.spec.jobTemplate:Jobæ¨¡æ¿ï¼Œå¿…éœ€å­—æ®µï¼ŒæŒ‡å®šéœ€è¦è¿è¡Œçš„ä»»åŠ¡ï¼Œæ ¼å¼åŒJob<br>ã€€ã€€.spec.startingDeadlineSeconds:å¯åŠ¨Jobçš„æœŸé™ï¼ˆç§’çº§åˆ«ï¼‰ï¼Œè¯¥å­—æ®µæ˜¯å¯é€‰çš„ã€‚å¦‚æœå› ä¸ºä»»ä½•åŸå› è€Œé”™è¿‡äº†è¢«è°ƒåº¦çš„æ—¶é—´ï¼Œé‚£ä¹ˆé”™è¿‡æ‰§è¡Œæ—¶é—´çš„Jobå°†è¢«è®¤ä¸ºæ˜¯å¤±è´¥çš„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™æ²¡æœ‰æœŸé™.spec.concurrencyPolicy:å¹¶å‘ç­–ç•¥ï¼Œè¯¥å­—æ®µä¹Ÿæ˜¯å¯é€‰çš„ã€‚<br>å®ƒæŒ‡å®šäº†å¦‚ä½•å¤„ç†è¢« Cron Jobåˆ›å»ºçš„Jobçš„å¹¶å‘æ‰§è¡Œã€‚åªå…è®¸æŒ‡å®šä¸‹é¢ç­–ç•¥ä¸­çš„ä¸€ç§ï¼š<br>ã€€ã€€ã€€ã€€Allowï¼ˆé»˜è®¤ï¼‰ï¼šå…è®¸å¹¶å‘è¿è¡ŒJob<br>ã€€ã€€ã€€ã€€Forbidï¼šç¦æ­¢å¹¶å‘è¿è¡Œï¼Œå¦‚æœå‰ä¸€ä¸ªè¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™ç›´æ¥è·³è¿‡ä¸‹ä¸€ä¸ª<br>ã€€ã€€ã€€ã€€Replaceï¼šå–æ¶ˆå½“å‰æ­£åœ¨è¿è¡Œçš„Jobï¼Œç”¨ä¸€ä¸ªæ–°çš„æ¥æ›¿æ¢<br>ã€€ã€€æ³¨æ„ï¼Œå½“å‰ç­–ç•¥åªèƒ½åº”ç”¨äºåŒä¸€ä¸ªCronJobåˆ›å»ºçš„Jobã€‚å¦‚æœå­˜åœ¨å¤šä¸ªCron Jobï¼Œå®ƒä»¬åˆ›å»ºçš„Jobä¹‹é—´æ€»æ˜¯å…è®¸å¹¶å‘è¿è¡Œã€‚<br>ã€€ã€€.spec.suspendï¼šæŒ‚èµ·ï¼Œè¯¥å­—æ®µä¹Ÿæ˜¯å¯é€‰çš„ã€‚å¦‚æœè®¾ç½®ä¸ºtrueï¼Œåç»­æ‰€æœ‰æ‰§è¡Œéƒ½ä¼šè¢«æŒ‚èµ·ã€‚å®ƒå¯¹å·²ç»å¼€å§‹æ‰§è¡Œçš„Jobä¸èµ·ä½œç”¨ã€‚é»˜è®¤å€¼ä¸ºfalseã€‚<br>ã€€ã€€.spec.successfulJobsHistoryLimitå’Œ.spec.failed]obsHistoryLimit:å†å²é™åˆ¶ï¼Œæ˜¯å¯é€‰çš„å­—æ®µã€‚å®ƒä»¬æŒ‡å®šäº†å¯ä»¥ä¿ç•™å¤šå°‘å®Œæˆå’Œå¤±è´¥çš„Jobã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬åˆ†åˆ«è®¾ç½®ä¸º3å’Œ1ã€‚è®¾ç½®é™åˆ¶çš„å€¼ä¸º0ï¼Œç›¸å…³ç±»å‹çš„Jobå®Œæˆåå°†ä¸ä¼šè¢«ä¿ç•™ã€‚</p>
<p>CronJobèµ„æºæ–‡ä»¶ç¤ºä¾‹<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; cronjob-demo.yaml &lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">batch/v1beta1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">CronJob</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">cronjob-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  schedule:</span> <span class="string">"*/1 * * * *"</span>   <span class="comment"># è¡¨ç¤ºæ¯ä¸€åˆ†é’Ÿè¿è¡Œä¸€æ¬¡</span></span><br><span class="line"><span class="attr">  jobTemplate:</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      template:</span></span><br><span class="line"><span class="attr">        spec:</span>               <span class="comment"># æ¨¡æ¿é…ç½®è¯´æ˜ä¹¦</span></span><br><span class="line"><span class="attr">          containers:</span>    </span><br><span class="line"><span class="attr">          - name:</span> <span class="string">cronjob-demo</span></span><br><span class="line"><span class="attr">            image:</span> <span class="string">busybox</span> </span><br><span class="line"><span class="attr">            args:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/bin/sh</span> </span><br><span class="line"><span class="bullet">            -</span> <span class="bullet">-c</span> </span><br><span class="line"><span class="bullet">            -</span> <span class="string">date;echo</span> <span class="string">Hello</span> <span class="string">from</span> <span class="string">the</span> <span class="string">Kubernetes</span> <span class="string">cluster,</span> <span class="string">This</span> <span class="string">is</span> <span class="string">cronjob-demo;</span></span><br><span class="line"><span class="attr">            imagePullPolicy:</span> <span class="string">IfNotPresent</span>   <span class="comment"># å¦‚æœæœ¬åœ°å­˜åœ¨åˆ™ä¸æ‹‰å–</span></span><br><span class="line"><span class="attr">          restartPolicy:</span> <span class="string">OnFailure</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></p>
<p>æ“ä½œæµç¨‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) å¿˜è®°å¦‚æœç¼–å†™CronJobçš„èµ„æºæ¸…å•çš„æ—¶å€™å¯ä»¥æŒ‰ç…§ä¸‹é¢æ ¼å¼æŸ¥æ‰¾å¸®åŠ©; </span></span><br><span class="line">~$ kubectl explain CronJob.spec.jobTemplate.spec.template.spec.containers</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) åˆ›å»º</span></span><br><span class="line">~/K8s/Day5/demo3$ kubectl create -f cronjob-demo.yaml</span><br><span class="line">cronjob.batch/cronjob-demo created</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) æŸ¥çœ‹</span></span><br><span class="line">$ kubectl get cj -o wide --show-labels   <span class="comment"># cronjob æ§åˆ¶åˆ›å»º</span></span><br><span class="line">  <span class="comment"># NAME           SCHEDULE      SUSPEND(æ˜¯å¦å»¶è¿Ÿ)   ACTIVE   LAST SCHEDULE(ä¸‹ä¸€æ¬¡æ‰§è¡Œ)   AGE    CONTAINERS     IMAGES    SELECTOR   LABELS</span></span><br><span class="line">  <span class="comment"># cronjob-demo   */1 * * * *   False                 0      41s             3m3s   cronjob-demo   busybox   &lt;none&gt;     &lt;none&gt;</span></span><br><span class="line">$ kubectl get <span class="built_in">jobs</span> -o wide   <span class="comment"># å®é™…ä¸Š cronjob è°ƒç”¨ Job åˆ›å»ºpod,å¯ä»¥çœ‹è§å·²ç»å®Œæˆæœ‰ä¸‰ä¸ªjob(ç¼ºçœä¿ç•™3æ¬¡æˆåŠŸæˆ–è€…å¤±è´¥çš„Job)</span></span><br><span class="line">  <span class="comment"># NAME                      COMPLETIONS   DURATION   AGE     CONTAINERS     IMAGES    SELECTOR                                              </span></span><br><span class="line">  <span class="comment"># cronjob-demo-1605082620   1/1           2s         2m46s   cronjob-demo   busybox   controller-uid=0e44795c-d799-4a5a-8f83-4025fd966f18</span></span><br><span class="line">  <span class="comment"># cronjob-demo-1605082680   1/1           2s         106s    cronjob-demo   busybox   controller-uid=e9ccc654-ed2b-4b49-8456-e4dd2fd21950 </span></span><br><span class="line">  <span class="comment"># cronjob-demo-1605082740   1/1           2s         46s     cronjob-demo   busybox   controller-uid=7398827f-14f2-4fc9-b410-3089f9982bbe</span></span><br><span class="line">~/K8s/Day5/demo3$ kubectl get pod -o wide --show-labels</span><br><span class="line">  <span class="comment"># NAME                            READY(è¿™é‡Œç”±äºå®Œæˆåä¾¿ç«‹å³é€€å‡ºäº†)   STATUS      RESTARTS   AGE     IP            NODE         LABELS</span></span><br><span class="line">  <span class="comment"># cronjob-demo-1605082740-pfw87   0/1     Completed   0          2m32s   10.244.1.62   k8s-node-4   controller-uid=7398827f-14f2-4fc9-b410-3089f9982bbe,job-name=cronjob-demo-1605082740</span></span><br><span class="line">  <span class="comment"># cronjob-demo-1605082800-6jslj   0/1     Completed   0          92s     10.244.1.63   k8s-node-4   controller-uid=42835ca2-c28e-4c3d-b7ea-107a0acf59f3,job-name=cronjob-demo-1605082800</span></span><br><span class="line">  <span class="comment"># cronjob-demo-1605082860-2747h   0/1     Completed   0          32s     10.244.1.65   k8s-node-4   controller-uid=d4b1e587-b881-4721-8330-7a3ef78ddc69,job-name=cronjob-demo-1605082860</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) æ‰§è¡Œåé¦ˆç»“æœ</span></span><br><span class="line">~$ kubectl get pod | grep <span class="string">"cronjob"</span> | cut -d <span class="string">" "</span> -f1</span><br><span class="line">  <span class="comment"># cronjob-demo-1605083580-twsb8</span></span><br><span class="line">  <span class="comment"># cronjob-demo-1605083640-dtscf</span></span><br><span class="line">  <span class="comment"># cronjob-demo-1605083700-64g88</span></span><br><span class="line"></span><br><span class="line">~$ kubectl logs cronjob-demo-1605083580-twsb8</span><br><span class="line">  <span class="comment"># Wed Nov 11 08:33:03 UTC 2020</span></span><br><span class="line">  <span class="comment"># Hello from the Kubernetes cluster, This is cronjob-demo</span></span><br><span class="line">~$ kubectl logs cronjob-demo-1605083640-dtscf</span><br><span class="line">  <span class="comment"># Wed Nov 11 08:34:03 UTC 2020</span></span><br><span class="line">  <span class="comment"># Hello from the Kubernetes cluster, This is cronjob-demo</span></span><br><span class="line">~$ kubectl logs cronjob-demo-1605083700-64g88</span><br><span class="line">  <span class="comment"># Wed Nov 11 08:35:03 UTC 2020</span></span><br><span class="line">  <span class="comment"># Hello from the Kubernetes cluster, This is cronjob-demo</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) ä¸¤ç§æ–¹å¼åˆ é™¤CronJobæ§åˆ¶å™¨åˆ›å»ºçš„Jobä»¥åŠé™„å±çš„Podèµ„æº</span></span><br><span class="line">~/K8s/Day5/demo3$ kubectl delete cronjob --all</span><br><span class="line">~/K8s/Day5/demo3$ kubectl delete -f cronjob-demo.yaml</span><br><span class="line">  cronjob.batch <span class="string">"cronjob-demo"</span> deleted</span><br></pre></td></tr></table></figure></p>
<p>PS : Cronjob æœ¬èº«çš„ä¸€äº›é™åˆ¶åˆ›å»ºJobæ“ä½œåº”è¯¥æ˜¯å¹‚ç­‰çš„, CronJobå¹¶ä¸å¤ªå¥½å»åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æˆåŠŸï¼ŒCronJobé€šè¿‡åˆ›å»ºJobå»å®Œæˆä»»åŠ¡ï¼ŒJobæˆåŠŸä¸å¦å¯ä»¥åˆ¤æ–­ï¼Œä½†CronJobæ— æ³•é“¾æ¥åˆ°Jobå»è·å–æˆåŠŸä¸å¦ï¼ŒCronåªä¼šå®šæœŸçš„å»åˆ›å»ºJobä»…æ­¤è€Œå·²ã€‚</p>
<p><br/></p>
<h3 id="7-StatefulSet"><a href="#7-StatefulSet" class="headerlink" title="7.StatefulSet"></a>7.StatefulSet</h3><p>æè¿°: å‰é¢æˆ‘ä»¬å­¦ä¹ äº†RCã€RSã€Deploymentã€DaemonSet ä¸ Job ç­‰å®ƒä»¬éƒ½æ˜¯é¢å‘æ— çŠ¶æ€æœåŠ¡çš„ï¼Œè€Œæœ¬èŠ‚å­¦ä¹ çš„StatefulSetçš„æ§åˆ¶å™¨æ˜¯æœ‰çŠ¶æ€æœåŠ¡çš„å³ä¸»è¦ç”¨äºéƒ¨ç½²ï¼ˆæœ‰çŠ¶æ€æœåŠ¡çš„åº”ç”¨ç¨‹åºï¼‰ã€‚</p>
<p>åœ¨ K8s ä¸­ä½¿ç”¨ StatefulSet æ§åˆ¶å™¨æ¥éƒ¨ç½²æœ‰çŠ¶æ€æœåŠ¡, StatefulSet æ˜¯ä¸€ä¸ªç»™Podæä¾›å”¯ä¸€æ ‡å‡†çš„æ§åˆ¶å™¨ï¼Œå®ƒå¯ä»¥ä¿è¯éƒ¨ç½² å’Œ æ‰©å±•æ”¶ç¼©çš„é¡ºåº;</p>
<p><br/></p>
<p><strong>Q: ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€æœåŠ¡? ä»€ä¹ˆåˆæ˜¯æ— çŠ¶æ€æœåŠ¡?</strong></p>
<blockquote>
<p>A: æœåŠ¡æ‰€ç»´æŠ¤çš„ä¸å®¢æˆ·äº¤äº’æ´»åŠ¨çš„ä¿¡æ¯ç§°ä¸ºçŠ¶æ€ä¿¡æ¯<br>Stateless Serviceï¼ˆæ— çŠ¶æ€æœåŠ¡ï¼‰ï¼šåœ¨åº”ç”¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¹‹ä¸­ä¸ä¿å­˜ä»»ä½•æ•°æ®å’ŒçŠ¶æ€ä¿¡æ¯çš„æœåŠ¡ï¼›ä¾‹å¦‚ Mysql å®ƒéœ€è¦å­˜å‚¨äº§ç”Ÿçš„æ–°æ•°æ®;<br>Stataful Service (æœ‰çŠ¶æ€æœåŠ¡) : åœ¨åº”ç”¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¹‹ä¸­ä¿å­˜çš„æ•°æ®æˆ–çŠ¶æ€çš„æœåŠ¡ï¼›ä¾‹å¦‚ Nginx;</p>
</blockquote>
<p><br/></p>
<p><strong>StatefulSet ç‰¹å¾</strong></p>
<ul>
<li>(1) ç¨³å®š(å›ºå®š)çš„ç½‘ç»œæ ‡è¯†ç¬¦ï¼Œå³Podé‡æ–°è°ƒåº¦åå…¶ PodName å’Œ HostName ä¸å˜åŸºäº<code>Headless Serviceï¼ˆå³æ²¡æœ‰Cluster IPçš„Service)</code>æ¥å®ç°ï¼Œä¾‹å¦‚ä¸€ä¸ªPodå«åšmysql-0ï¼Œç¬¬äºŒä¸ªå«åšmysql-1ï¼Œç„¶åä¾æ¬¡é¡ºåºæ»¡è¶³å…¶æœŸæœ›å€¼å³nçš„ä¸€ä¸ªå«åšmysql-(n-1)ã€‚</li>
<li>(2) æœ‰åºéƒ¨ç½²å’Œæœ‰åºæ‰©å±•ï¼šåŸºäº init containers æ¥å®ç°ï¼Œåœ¨ç¬¬nä¸ªPodå¯åŠ¨ä¹‹é—´ï¼Œå‰ä¸€ä¸ªPodå¿…é¡»æ˜¯å¤„äºReadyä¸”RunningçŠ¶æ€;</li>
<li>(3) ç¨³å®šçš„æŒä¹…åŒ–å­˜å‚¨ï¼šå³Podé‡æ–°è°ƒåº¦åè¿˜æ˜¯èƒ½è®¿é—®åˆ°ç›¸åŒçš„æŒä¹…åŒ–æ•°æ®ï¼ŒåŸºäºPV/PVCã€ä»¥åŠStorageClassæ¥å®ç°ã€‚</li>
<li>(4) æœ‰åºåˆ é™¤å’Œåœæ­¢: å³ä»N-1 åˆ° 0 Terminalä¾æ¬¡é”€æ¯;</li>
</ul>
<p><br></p>
<p><strong>Statefulset å¯åœé¡ºåºè¯¦è¿°:</strong></p>
<ul>
<li>1.æœ‰åºéƒ¨ç½²: éƒ¨ç½¢Statefulsetæ—¶ï¼Œå¦‚æœæœ‰å¤šä¸ªPodå‰¯æœ¬ï¼Œå®ƒä»¬ä¼šè¢«é¡ºåºåœ°åˆ›å»ºï¼ˆä»0åˆ°N-1)å¹¶ä¸”ï¼Œåœ¨<code>ä¸‹ä¸€ä¸ªPodè¿è¡Œä¹‹å‰æ‰€æœ‰ä¹‹å‰çš„Podå¿…é¡»éƒ½æ˜¯Runningå’ŒReadyçŠ¶æ€</code>ã€‚</li>
<li>2.æœ‰åºåˆ é™¤: å½“Podè¢«åˆ é™¤æ—¶ï¼Œå®ƒä»¬è¢«ç»ˆæ­¢çš„é¡ºåºæ˜¯ä»N-1åˆ°0ã€‚</li>
<li>3.æœ‰åºæ‰©å±•: å½“å¯¹Podæ‰§è¡Œæ‰©å±•æ“ä½œæ—¶ï¼Œä¸éƒ¨ç½²ä¸€æ ·ï¼Œå®ƒå‰é¢çš„Podå¿…é¡»éƒ½å¤„äºRunningå’ŒReadyçŠ¶æ€</li>
</ul>
<p><br></p>
<p>Tips : StatefulSet é™¤äº†éœ€è¦é‡‡ç”¨PV/PVCæŒä¹…åŒ–PodçŠ¶æ€æ•°æ®ä¹‹å¤–è¿˜éœ€ä½¿ç”¨åˆ°Headless Service, è¯¥Serviceä¸ºStatefulSetæ§åˆ¶çš„æ¯ä¸ªPodåˆ›å»ºä¸€ä¸ªDNSåŸŸå,å…¶æ ¼å¼<code>PodName.HeadlessServiceName</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¾‹å¦‚ Headless Service Name = database , è€Œ StatefulSetåç§°ä¸º mysql-app åˆ™å…¶DNSåç§°ä¸º</span></span><br><span class="line">mysql-app-1.database</span><br><span class="line">mysql-app-2.database</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>æ­¤æ¬¡æ˜¯é’ˆå¯¹äºStatefulSetæ§åˆ¶å™¨åšä¸€ä¸ªç®€å•çš„äº†è§£åç»­åœ¨è¿›è¡ŒPVCæŒä¹…åŒ–å·æ•°æ®æ—¶æ¼”ç¤º;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># statefulset èµ„æºæ§åˆ¶å™¨</span></span><br><span class="line">~$ kubectl api-resources | grep <span class="string">"stateful"</span>   <span class="comment"># èµ„æº</span></span><br><span class="line">  <span class="comment"># statefulsets                      sts          apps                           true         StatefulSet</span></span><br><span class="line">~$ kubectl api-versions | grep <span class="string">"apps"</span>        <span class="comment"># api-groupsåŠå…¶ç‰ˆæœ¬</span></span><br><span class="line">  <span class="comment"># apps/v1</span></span><br><span class="line"></span><br><span class="line">~$ kubectl get storageclass</span><br><span class="line">  <span class="comment"># NAME                            PROVISIONER      RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span></span><br><span class="line">  <span class="comment"># managed-nfs-storage (default)   fuseim.pri/ifs   Delete          Immediate           false                  57d</span></span><br></pre></td></tr></table></figure></p>
<p>èµ„æºæ¸…å•ç¤ºä¾‹:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; statefulset-demo.yaml &lt;&lt;'END'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span>   </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nginx-statefulset-service</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  clusterIP:</span> <span class="string">None</span></span><br><span class="line"><span class="attr">  selector:</span> </span><br><span class="line"><span class="attr">    app:</span> <span class="string">nginx-sfs</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">80</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span>    <span class="comment"># èµ„æºæ§åˆ¶å™¨</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">web</span> </span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">nginx-sfs</span>           <span class="comment"># åŒ¹é… .spec.template.metadata.labels ä¸­çš„æ ‡ç­¾</span></span><br><span class="line"><span class="attr">  serviceName:</span> <span class="string">"nginx-statefulset-service"</span> <span class="comment"># ç»‘å®šçš„SVC ä¸ä¸Šé¢çš„ Service åç§°å¯¹åº”</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span> </span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">nginx-sfs</span>    <span class="comment"># Pod æ¨¡æ¿çš„æ ‡ç­¾ (æœ‰äº†å®ƒStatefulSetçŸ¥é“åˆ›å»ºçš„Podæ˜¯å¦åœ¨è‡ªå·±æœŸæœ›æ•°é‡ä¸­ä»¥åŠä¾¿äºSVC)</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">nginx</span> </span><br><span class="line"><span class="attr">        image:</span> <span class="attr">nginx:1.19.6</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="attr">        - containerPort:</span> <span class="number">80</span> </span><br><span class="line"><span class="attr">          name:</span> <span class="string">web</span> </span><br><span class="line"><span class="attr">        volumeMounts:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">www</span> </span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/usr/share/nginx/html</span> </span><br><span class="line"><span class="attr">  volumeClaimTemplates:</span>   <span class="comment"># volume æ¨¡æ¿ </span></span><br><span class="line"><span class="attr">  - metadata:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">www</span> </span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      accessModes:</span> <span class="string">[</span> <span class="string">"ReadWriteOnce"</span> <span class="string">]</span>         <span class="comment"># å…è®¸æ¨¡å¼ </span></span><br><span class="line"><span class="attr">      storageClassName:</span> <span class="string">"managed-nfs-storage"</span>  <span class="comment"># é‡‡ç”¨storageClassè¿›è¡ŒåŠ¨æ€åˆ›å»ºçš„PVC (åç»­å°†ä¼šè®²è¿°)</span></span><br><span class="line"><span class="attr">      resources:</span></span><br><span class="line"><span class="attr">        requests:</span></span><br><span class="line"><span class="attr">          storage:</span> <span class="number">200</span><span class="string">Mi</span></span><br><span class="line"><span class="string">END</span></span><br></pre></td></tr></table></figure></p>
<p>æ„å»ºéƒ¨ç½²ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) åˆ›å»ºPod</span></span><br><span class="line">~/K8s/Day5/demo4$ kubectl apply -f statefulset-demo.yaml</span><br><span class="line">  <span class="comment"># service/nginx-statefulset-service created</span></span><br><span class="line">  <span class="comment"># statefulset.apps/web created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æŸ¥çœ‹StatefulSetæ§åˆ¶å™¨ã€SVCã€PVC </span></span><br><span class="line">~/K8s/Day5/demo4$ kubectl get sts,pvc -o wide | egrep <span class="string">"web"</span></span><br><span class="line">  <span class="comment"># statefulset.apps/web                 3/3     6m29s   nginx        nginx:1.19.6</span></span><br><span class="line">  <span class="comment"># persistentvolumeclaim/www-web-0                                     Bound    pvc-c1352011-6bc8-450f-941c-d6369ca55ca6   200Mi      RWO            managed-nfs-storage   6m29s   Filesystem</span></span><br><span class="line">  <span class="comment"># persistentvolumeclaim/www-web-1                                     Bound    pvc-07127f78-f282-4fac-970d-e6c991242b03   200Mi      RWO            managed-nfs-storage   6m19s   Filesystem</span></span><br><span class="line">  <span class="comment"># persistentvolumeclaim/www-web-2                                     Bound    pvc-205e0dfc-6a9c-450a-be20-b3440d94a453   200Mi      RWO            managed-nfs-storage   6m      Filesystem</span></span><br><span class="line"></span><br><span class="line">~/K8s/Day5/demo4$ kubectl get svc  | grep <span class="string">"nginx-statefulset-service"</span></span><br><span class="line">  <span class="comment"># nginx-statefulset-service   ClusterIP   None            &lt;none&gt;        80/TCP           7m4s</span></span><br><span class="line">~/K8s/Day5/demo4$ kubectl get ep -o wide | grep <span class="string">"nginx-statefulset-service"</span>   <span class="comment">#  æŸ¥çœ‹ SVC ç»‘å®šçš„ Endport</span></span><br><span class="line">  <span class="comment"># nginx-statefulset-service   10.244.0.247:80,10.244.1.230:80,10.244.2.133:80         8m23s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) è®¿é—®æ­å»ºçš„Nginx</span></span><br><span class="line">~/K8s/Day5/demo4$ <span class="built_in">echo</span> <span class="string">"Web-0"</span> &gt; /nfs/data/default-www-web-0-pvc-c1352011-6bc8-450f-941c-d6369ca55ca6/index.html</span><br><span class="line">~/K8s/Day5/demo4$ curl http://10.244.0.247</span><br><span class="line">Web-0</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="8-Horizontal-Pod-Autoscaling-æ°´å¹³æ‰©å±•"><a href="#8-Horizontal-Pod-Autoscaling-æ°´å¹³æ‰©å±•" class="headerlink" title="8.Horizontal Pod Autoscaling - æ°´å¹³æ‰©å±•"></a>8.Horizontal Pod Autoscaling - æ°´å¹³æ‰©å±•</h3><p>æè¿°: å‰é¢æˆ‘ä»¬çŸ¥é“ Kubernetes é›†ç¾¤å¯ä»¥é€šè¿‡ <code>Replication Controller</code> çš„ scale æœºåˆ¶å®ŒæˆæœåŠ¡çš„æ‰©å®¹æˆ–ç¼©å®¹ï¼Œå®ç°å…·æœ‰ä¼¸ç¼©æ€§çš„æœåŠ¡, ä½†æ˜¯å…¶éœ€è¦æˆ‘ä»¬è¿›è¡Œäººå·¥å¹²é¢„ã€‚</p>
<p><br/></p>
<p><strong>Q: é‚£ä¹ˆæ˜¯å¦æœ‰è‡ªåŠ¨å®Œæˆæ‰©å®¹å’Œæ”¶ç¼©çš„æœºåˆ¶?</strong><br>ç­”: é‚£å°±æœ¬æ–‡ä¸»è¦è®²è§£çš„ HPA (<code>Horizontal Pod Autoscaling</code>) è¿›è¡ŒæœåŠ¡çš„ autoscale è‡ªåŠ¨ä¼¸ç¼©;</p>
<p>æè¿°: Horizontal Pod Autoscaling (<code>ç®€ç§°HPA</code>) è‡ªåŠ¨æ‰©å±•, å®ƒå¯ä»¥æ ¹æ®å½“å‰podèµ„æºçš„ä½¿ç”¨ç‡ï¼ˆå¦‚CPUã€ç£ç›˜ã€å†…å­˜ç­‰ï¼‰ï¼Œè¿›è¡Œå‰¯æœ¬æ•°çš„åŠ¨æ€çš„æ‰©å®¹ä¸ç¼©å®¹ï¼Œä»¥ä¾¿å‡è½»å„ä¸ªpodçš„å‹åŠ›ã€‚å½“podè´Ÿè½½è¾¾åˆ°ä¸€å®šçš„é˜ˆå€¼åï¼Œä¼šæ ¹æ®æ‰©ç¼©å®¹çš„ç­–ç•¥ç”Ÿæˆæ›´å¤šæ–°çš„podæ¥åˆ†æ‹…å‹åŠ›ï¼Œå½“podçš„ä½¿ç”¨æ¯”è¾ƒç©ºé—²æ—¶ï¼Œåœ¨ç¨³å®šç©ºé—²ä¸€æ®µæ—¶é—´åï¼Œè¿˜ä¼šè‡ªåŠ¨å‡å°‘podçš„å‰¯æœ¬æ•°é‡ã€‚</p>
<p>HPA èµ·å§‹ä½œç”¨æ˜¯ Pod æŒ‰ç…§ä¸€å®šçš„ç­–ç•¥è¿›è¡Œè‡ªåŠ¨æ‰©å®¹ç¼©ï¼Œä¾‹å¦‚æ ¹æ®CPUåˆ©ç”¨ç‡è‡ªåŠ¨ä¼¸ç¼©ä¸€ä¸ª <code>Replication Controllerã€ Deployment æˆ–è€… ReplicaSet</code>ä¸­ç®¡ç†çš„çš„Podå‰¯æœ¬æ•°é‡; æ‚¨å¯ä»¥ç®€å•ç†è§£ä¸º<code>å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªæ§åˆ¶å™¨è€Œæ˜¯ä¸€ä¸ªæ§åˆ¶å™¨çš„é™„å±å“</code>, å¯ä»¥ä½¿ç”¨å®ƒå»æ§åˆ¶å…¶ä»–çš„æ§åˆ¶å™¨ï¼Œä»è€Œä½¿å…¶ä»–çš„æ§åˆ¶å™¨å…·æœ‰è‡ªåŠ¨æ‰©å±•çš„åŠŸèƒ½;</p>
<p>Tips: è‹¥è¦å®ç°è‡ªåŠ¨æ‰©ç¼©å®¹çš„åŠŸèƒ½ï¼Œè¿˜éœ€è¦éƒ¨ç½²<code>heapster</code>æœåŠ¡ï¼Œç”¨æ¥æ”¶é›†åŠç»Ÿè®¡èµ„æºçš„åˆ©ç”¨ç‡ï¼Œ<code>æ”¯æŒkubectl topå‘½ä»¤</code>ï¼ŒheapsteræœåŠ¡é›†æˆåœ¨prometheusï¼ˆæ™®ç½—ç±³ä¿®æ–¯ï¼‰ MertricServeræœåŠ¡ä¸­ï¼Œæ‰€ä»¥è¯´ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘è¿™é‡ŒåŸºäºprometheusæœåŠ¡çš„ç¯å¢ƒä¸Šè¿›è¡Œéƒ¨ç½²HPAï¼ˆåŠ¨æ€æ‰©ç¼©å®¹ï¼‰çš„æœåŠ¡ã€‚</p>
<p><br/></p>
<p><em>é›†ç¾¤èµ„æºä¼¸ç¼©æ–¹å¼è¯´æ˜:</em></p>
<ul>
<li>sacle æ‰‹åŠ¨ä¼¸ç¼©: kubernetesèµ„æºå¯¹è±¡çš„å‡çº§ã€å›æ»šã€æ‰©å®¹ã€ç¼©å®¹;</li>
<li>autoscale è‡ªåŠ¨ä¼¸ç¼©ï¼šä¹Ÿå°±æ˜¯(æœ¬ç¯‡åšæ–‡æ‰€ä»‹ç»çš„HPA);</li>
</ul>
<p><br/></p>
<p>Kubernetes AutoScale (è‡ªåŠ¨æ‰©å±•) ä¸»è¦åˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>æ°´å¹³æ‰©å±•ï¼šé’ˆå¯¹å®ä¾‹æ•°ç›®çš„å¢å‡ï¼›</li>
<li>å‚ç›´æ‰©å±•ï¼šå³å•ä¸ªå®ä¾‹å°±å¯ä»¥ä½¿ç”¨çš„èµ„æºçš„å¢å‡ï¼Œæ¯”å¦‚å¢åŠ CPUã€å†…å­˜ï¼›</li>
</ul>
<p><strong>ç®€å•å®ä¾‹:</strong></p>
<ul>
<li><p>1) æ„å»ºæµ‹è¯•ä¸“ä¸šçš„é•œåƒ (#è¿è¡Œæ„å»ºDeploymentçš„hpaèµ„æºï¼Œåç§°ä¸ºphp-apacheï¼Œå¹¶è®¾ç½®è¯·æ±‚CPUçš„èµ„æºä¸º200må¹¶æš´éœ²ä¸€ä¸ª80ç«¯å£)</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">~/K8s/Day11$</span> <span class="string">cat</span> <span class="string">&gt; hpa-demo.yaml &lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">kind:</span> <span class="string">Deployment</span>    <span class="comment">#è¯¥é…ç½®çš„ç±»å‹ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span> <span class="comment">#ä¸k8sé›†ç¾¤ç‰ˆæœ¬æœ‰å…³ï¼Œä½¿ç”¨ kubectl api-versions å³å¯æŸ¥çœ‹å½“å‰é›†ç¾¤æ”¯æŒçš„ç‰ˆæœ¬</span></span><br><span class="line"><span class="attr">metadata:</span>           <span class="comment">#è¯‘åä¸ºå…ƒæ•°æ®ï¼Œå³ Deployment çš„ä¸€äº›åŸºæœ¬å±æ€§å’Œä¿¡æ¯</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">php-apache-deployment</span> <span class="comment"># Deployment æ§åˆ¶å™¨çš„åç§°</span></span><br><span class="line"><span class="attr">  labels:</span>        <span class="comment">#æ ‡ç­¾ï¼Œå¯ä»¥çµæ´»å®šä½ä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºï¼Œå…¶ä¸­keyå’Œvalueå‡å¯è‡ªå®šä¹‰ï¼Œå¯ä»¥å®šä¹‰å¤šç»„ï¼Œç›®å‰ä¸éœ€è¦ç†è§£</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">php-apache-deploy</span>    <span class="comment"># ä¸ºè¯¥Deploymentè®¾ç½®keyä¸ºappï¼Œvalueä¸ºnginxçš„æ ‡ç­¾</span></span><br><span class="line"><span class="attr">spec:</span>            <span class="comment">#è¿™æ˜¯å…³äºè¯¥Deploymentçš„æè¿°ï¼Œå¯ä»¥ç†è§£ä¸ºä½ æœŸå¾…è¯¥Deploymentåœ¨k8sä¸­å¦‚ä½•ä½¿ç”¨</span></span><br><span class="line">  <span class="comment"># replicas: 1    #ä½¿ç”¨è¯¥Deploymentåˆ›å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºå®ä¾‹</span></span><br><span class="line"><span class="attr">  selector:</span>      <span class="comment">#æ ‡ç­¾é€‰æ‹©å™¨ï¼Œä¸ä¸Šé¢çš„æ ‡ç­¾å…±åŒä½œç”¨ï¼Œç›®å‰ä¸éœ€è¦ç†è§£</span></span><br><span class="line"><span class="attr">    matchLabels:</span> <span class="comment">#é€‰æ‹©åŒ…å«æ ‡ç­¾app:nginxçš„èµ„æº</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">php-apache</span></span><br><span class="line"><span class="attr">    matchExpressions:</span></span><br><span class="line"><span class="attr">    - key:</span> <span class="string">app</span></span><br><span class="line"><span class="attr">      operator:</span> <span class="string">In</span></span><br><span class="line"><span class="attr">      values:</span> <span class="string">[php-apache]</span> </span><br><span class="line"><span class="attr">  template:</span>     <span class="comment">#è¿™æ˜¯é€‰æ‹©æˆ–åˆ›å»ºçš„Podçš„æ¨¡æ¿</span></span><br><span class="line"><span class="attr">    metadata:</span>   <span class="comment">#Podçš„å…ƒæ•°æ®</span></span><br><span class="line"><span class="attr">      labels:</span>   <span class="comment">#Podçš„æ ‡ç­¾ï¼Œä¸Šé¢çš„selectorå³é€‰æ‹©åŒ…å«æ ‡ç­¾app:nginxçš„Pod</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">php-apache</span></span><br><span class="line"><span class="attr">    spec:</span>              <span class="comment">#æœŸæœ›Podå®ç°çš„åŠŸèƒ½(å³åœ¨podä¸­éƒ¨ç½²)</span></span><br><span class="line"><span class="attr">      containers:</span>      <span class="comment">#ç”Ÿæˆcontainerï¼Œä¸dockerä¸­çš„containeræ˜¯åŒä¸€ç§</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">nginx</span>    <span class="comment">#containerçš„åç§°</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">mirrorgooglecontainers/hpa-example</span>  <span class="comment">#ä½¿ç”¨é•œåƒnginxæœ€æ–°ç‰ˆæœ¬åˆ›å»ºcontainerï¼Œè¯¥containeré»˜è®¤80ç«¯å£å¯è®¿é—®</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="attr">        - containerPort:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">        resources:</span>     <span class="comment"># èµ„æºçš„é™åˆ¶</span></span><br><span class="line"><span class="attr">          requests:</span>    <span class="comment"># èµ„æºç”³è¯·å€¼</span></span><br><span class="line"><span class="attr">            cpu:</span> <span class="number">128</span><span class="string">m</span></span><br><span class="line"><span class="attr">            memory:</span> <span class="number">128</span><span class="string">Mi</span></span><br><span class="line"><span class="attr">          limits:</span>      <span class="comment"># èµ„æºé™åˆ¶å€¼</span></span><br><span class="line"><span class="attr">            cpu:</span> <span class="number">200</span><span class="string">m</span></span><br><span class="line"><span class="attr">            memory:</span> <span class="number">200</span><span class="string">Mi</span></span><br><span class="line"><span class="attr">        imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">php-apache</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">ClusterIP</span>         <span class="comment"># Service ç±»å‹</span></span><br><span class="line"><span class="attr">  selector:</span>               <span class="comment"># backend ç»‘å®š</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">php-apache</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">  - protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">80</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>2) æŒ‰ç…§ä¸Šé¢çš„èµ„æºæ¸…å•æ„å»º Deloyment èµ„æºæ§åˆ¶å™¨å¹¶æŸ¥çœ‹å¯¹åº”çš„èµ„æº;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">~/K8s/Day11$ kubectl create -f hpa-demo.yaml</span><br><span class="line">  <span class="comment"># deployment.apps/php-apache-deployment created</span></span><br><span class="line">  <span class="comment"># service/php-apache created</span></span><br><span class="line">~/K8s/Day11$ kubectl get deployments -o wide</span><br><span class="line">  <span class="comment"># NAME                    READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES                               SELECTOR</span></span><br><span class="line">  <span class="comment"># php-apache-deployment   1/1     1            1           2m    nginx        mirrorgooglecontainers/hpa-example   app=php-apache</span></span><br><span class="line">~/K8s/Day11$ kubectl get svc</span><br><span class="line">  <span class="comment"># NAME             TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE</span></span><br><span class="line">  <span class="comment"># kubernetes       ClusterIP   10.96.0.1      &lt;none&gt;        443/TCP   33d</span></span><br><span class="line">  <span class="comment"># php-apache       ClusterIP   10.96.176.18   &lt;none&gt;        80/TCP    5m8s</span></span><br><span class="line">~/K8s/Day11$ kubectl get replicasets.apps -o wide</span><br><span class="line">  <span class="comment"># NAME                               DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES                               SELECTOR</span></span><br><span class="line">  <span class="comment"># php-apache-deployment-75695fbcd8   1         1         1       6m59s   nginx        mirrorgooglecontainers/hpa-example   app=php-apache,pod-template-hash=75695fbcd8</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>(3) åˆ›å»ºHPAæ§åˆ¶å™¨(<code>#å½“hpaèµ„æºçš„deploymentèµ„æºå¯¹è±¡çš„CPUä½¿ç”¨ç‡è¾¾åˆ°50%æ—¶ï¼Œå°±è¿›è¡Œæ‰©å®¹æœ€å¤šå¯ä»¥æ‰©å®¹åˆ°10ä¸ª</code>)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼1.autoscale å‘½ä»¤</span></span><br><span class="line">~/K8s/Day11$ kubectl autoscale deployment php-apache-deployment --cpu-percent=50 --min=1 --max=10</span><br><span class="line">  <span class="comment"># horizontalpodautoscaler.autoscaling/php-apache-deployment autoscaled</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># æ–¹å¼2.èµ„æºæ¸…å•</span></span><br><span class="line">~/K8s/Day11$ tee HorizontalPodAutoscaler.yaml &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">apiVersion: autoscaling/v1</span><br><span class="line">kind: HorizontalPodAutoscaler</span><br><span class="line">metadata:</span><br><span class="line">  name: php-apache-deployment</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  minReplicas: 1</span><br><span class="line">  maxReplicas: 10</span><br><span class="line">  scaleTargetRef:</span><br><span class="line">    kind: Deployment</span><br><span class="line">    name: php-apache-deployment</span><br><span class="line">    apiVersion: apps/v1</span><br><span class="line">  targetCPUUtilizationPercentage: 50</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">~/K8s/Day11$ kubectl get hpa</span><br><span class="line">  <span class="comment"># NAME                    REFERENCE                          TARGETS         MINPODS   MAXPODS   REPLICAS   AGE</span></span><br><span class="line">  <span class="comment"># php-apache-deployment   Deployment/php-apache-deployment   &lt;unknown&gt;/50%   1         10        1          19s</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>(4) æ¨¡æ‹Ÿæ¶ˆè€—php-apacheçš„èµ„æºï¼Œå¹¶éªŒè¯podæ˜¯å¦ä¼šè‡ªåŠ¨æ‰©å®¹ä¸ç¼©å®¹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–°å¼€å¯å¤šä¸ªç»ˆç«¯ï¼ˆä¹Ÿå¯ä½¿ç”¨nodeèŠ‚ç‚¹ï¼‰ï¼Œå¯¹php-apacheçš„podè¿›è¡Œæ­»å¾ªç¯è¯·æ±‚ï¼Œå¦‚ä¸‹ï¼ˆå¦‚æœä½ çš„ç³»ç»Ÿèµ„æºæ¯”è¾ƒå……è¶³ï¼Œå¯ä»¥é€‰æ‹©å¼€å¯å¤šä¸ªç»ˆç«¯ï¼Œå¯¹podè¿›è¡Œæ­»å¾ªç¯è¯·æ±‚ï¼Œæˆ‘è¿™é‡Œå¼€å¯äº†ä¸¤ä¸ªnodeçš„ç»ˆç«¯ï¼ŒåŒæ—¶è¯·æ±‚php-apacheçš„podï¼‰ï¼š</span></span><br><span class="line">$ kubectl run -i --tty load-generator --image=busybox /bin/sh </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼1.æ¨¡æ‹Ÿå¤šç”¨æˆ·å¯¹php-apacheçš„podé€ æˆçš„å¹¶å‘è¯·æ±‚</span></span><br><span class="line">$ <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> wget -q -O- http://php-apache.default.svc.cluster.local; <span class="keyword">done</span></span><br><span class="line"><span class="comment"># OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2.ä½¿ç”¨abè¿›è¡Œå‹åŠ›æµ‹è¯•</span></span><br><span class="line">$ ab -c 5000 -n 2000000 http://tomcat-svc:8080/</span><br></pre></td></tr></table></figure>
</li>
<li><p>(5) ç›‘æ§æŸ¥çœ‹hpaèµ„æºå¯¹cpuçš„å ç”¨æƒ…å†µä»¥åŠPodæ‰©å®¹ç»“æœ;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~/K8s/Day11$ watch -n 2 <span class="string">"kubectl get deployments | grep "</span>php-apache-deployment<span class="string">" &amp;&amp; kubectl get hpa &amp;&amp; kubectl top pod -l app=php-apache"</span></span><br><span class="line">  php-apache-deployment   4/4     4            4           6m46s        <span class="comment"># å¯ä»¥çœ‹è§åˆ›å»ºäº†å››ä¸ªå‰¯æœ¬</span></span><br><span class="line">  NAME                    REFERENCE                          TARGETS   MINPODS   MAXPODS   REPLICAS   AGE</span><br><span class="line">  php-apache-deployment   Deployment/php-apache-deployment   93%/50%   1         10        4          4m46s   <span class="comment"># CPU ä½¿ç”¨å€¼å·²è¶…è¿‡æˆ‘ä»¬è®¾å®šçš„é¢å®šç™¾åˆ†ç™¾50%</span></span><br><span class="line">  NAME                                     CPU(cores)   MEMORY(bytes)   <span class="comment"># åˆ›å»ºçš„Pod</span></span><br><span class="line">  php-apache-deployment-5c6b89b758-55m2m   122m         12Mi </span><br><span class="line">  php-apache-deployment-5c6b89b758-gm8rz   0m           2Mi</span><br><span class="line">  php-apache-deployment-5c6b89b758-s8ldx   118m         12Mi</span><br><span class="line">  php-apache-deployment-5c6b89b758-wdt9p   0m           0Mi</span><br><span class="line"></span><br><span class="line"><span class="comment"># PS : å½“ç„¶æœ€å¤§ä¹Ÿå°±åªå¯ä»¥äº§ç”Ÿ10ä¸ªpodï¼Œå› ä¸ºæˆ‘ä»¬ä¹‹å‰è§„å®šæœ€å¤šäº§ç”Ÿ10ä¸ªpod</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>(6) å½“åœæ­¢æ­»å¾ªç¯è¯·æ±‚åï¼Œä¹Ÿå¹¶ä¸ä¼šç«‹å³å‡å°‘podæ•°é‡ï¼Œä¼šç­‰ä¸€æ®µæ—¶é—´ï¼ˆå¤§çº¦5åˆ†åˆ†é’Ÿï¼‰åå‡å°‘podæ•°é‡ï¼ˆ5~10åˆ†é’Ÿï¼‰ï¼Œé˜²æ­¢æµé‡å†æ¬¡æ¿€å¢ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å½“åœæ­¢æ­»å¾ªç¯è¯·æ±‚åï¼Œä¹Ÿå¹¶ä¸ä¼šç«‹å³å‡å°‘podæ•°é‡ï¼Œä¼šç­‰ä¸€æ®µæ—¶é—´åå‡å°‘podæ•°é‡ï¼ˆ5~10åˆ†é’Ÿï¼‰ï¼Œé˜²æ­¢æµé‡å†æ¬¡æ¿€å¢ã€‚</span></span><br><span class="line">~/K8s/Day11$ watch -c -t -n 2 <span class="string">"kubectl get deployments | grep "</span>php-apache-deployment<span class="string">" &amp;&amp; kubectl get hpa &amp;&amp; kubectl get pod -l app=php-apache"</span></span><br><span class="line">  <span class="comment"># php-apache-deployment   1/1     1            1           17m</span></span><br><span class="line">  <span class="comment"># NAME                    REFERENCE                          TARGETS   MINPODS   MAXPODS   REPLICAS   AGE</span></span><br><span class="line">  <span class="comment"># php-apache-deployment   Deployment/php-apache-deployment   0%/50%    1         10        1          15m</span></span><br><span class="line">  <span class="comment"># NAME                                     READY   STATUS    RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># php-apache-deployment-5c6b89b758-s8ldx   1/1     Running   0          17m</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>(7) è‡³æ­¤HPAå®ç°podå‰¯æœ¬æ•°é‡çš„è‡ªåŠ¨æ‰©å®¹ä¸ç¼©å®¹å°±å®ç°äº†ï¼Œä¸‹é¢å¯ä»¥æµ‹è¯•åˆ é™¤ç­–ç•¥æ‰©å®¹HPA</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/K8s/Day11$ kubectl delete horizontalpodautoscalers.autoscaling php-apache-deployment</span><br><span class="line">  <span class="comment"># horizontalpodautoscaler.autoscaling "php-apache-deployment" deleted</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Tips: K8s 1.19.x çš„ HAP æ§åˆ¶å™¨åªèƒ½é’ˆå¯¹äº<code>Deployment, ReplicaSet, StatefulSet, or ReplicationController</code>ç­‰èµ„æºæ§åˆ¶å™¨åˆ›å»ºçš„Podèµ„æºè¿›è¡Œæ‰©å®¹ç¼©;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„è®¸å¤šCSDN æˆ–è€… åšå®¢å›­ä¸­ä¼šå†™å‡ºä»¥ä¸‹çš„æ–¹å¼éªŒè¯(å®ƒå¹¶ä¸é€‚ç”¨äºå½“å‰ç‰ˆæœ¬)</span></span><br><span class="line">kubectl create php-apache-test --image=mirrorgooglecontainers/hpa-example --requests=cpu=200m --expose --port=80</span><br><span class="line">  <span class="comment"># service/php-apache created</span></span><br><span class="line">  <span class="comment"># pod/php-apache created   # å¯ä»¥çœ‹è§å®ƒåˆ›å»ºçš„æ˜¯Pod</span></span><br><span class="line">kubectl get pod</span><br><span class="line">  <span class="comment"># NAME         READY   STATUS    RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># php-apache   1/1     Running   0          48s</span></span><br></pre></td></tr></table></figure></p>

        </div>
        
  <hr>
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>

  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>

  <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ï¼Œè½¬ä¸ªå‘ã€‘(äººé—´äº”å¤§æƒ…)</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œè°¢è°¢ï¼ã€‚</p>

  <div>
    <img src="https://www.weiyigeek.top/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul>

  <div>
    <img src="/img/wechat-search.png" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·"  width="328" height="149">
    <img src="/img/wechat-app.png" class="img-responsive" alt="æ‰«æVisit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº"  width="328" height="149">
  </div>


  <hr>
  


  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-05-17T07:42:08.580Z" itemprop="dateUpdated">2022-05-17 15:42:08</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/5-Kuberneteså…¥é—¨åŸºç¡€ä¹‹æ§åˆ¶å™¨Controllerä»‹ç».md" target="_blank" rel="noopener noreferrer">_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/5-Kuberneteså…¥é—¨åŸºç¡€ä¹‹æ§åˆ¶å™¨Controllerä»‹ç».md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2020/5-27-526.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/5-27-526.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">ğŸ‘ é’Ÿæ„ä½œè€…</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/5-27-526.html&title=ã€Š5-Kuberneteså…¥é—¨åŸºç¡€ä¹‹æ§åˆ¶å™¨Controllerä»‹ç»ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/5-27-526.html&title=ã€Š5-Kuberneteså…¥é—¨åŸºç¡€ä¹‹æ§åˆ¶å™¨Controllerä»‹ç»ã€‹ â€” WeiyiGeek Blog&source=WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ª..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/5-27-526.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š5-Kuberneteså…¥é—¨åŸºç¡€ä¹‹æ§åˆ¶å™¨Controllerä»‹ç»ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/5-27-526.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/5-27-526.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/5-27-528.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">6-Kuberneteså…¥é—¨åŸºç¡€ä¹‹æœåŠ¡å‘ç°Serviceä»‹ç»</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/5-27-529.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Ingress-Nginx æœåŠ¡æš´éœ²åŸºç¡€å­¦ä¹ ä¸å®è·µ</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-Controller-ä»‹ç»"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 Controller ä»‹ç»</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-Controller-è¯¦è¿°"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 Controller è¯¦è¿°</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-Replication-Controller"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">1.Replication Controller</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-ReplicaSet"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">2.ReplicaSet</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-Deployment"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">3.Deployment</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-DaemonSet"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">4.DaemonSet</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6-CronJob"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">6.CronJob</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7-StatefulSet"><span class="post-toc-number">2.6.</span> <span class="post-toc-text">7.StatefulSet</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#8-Horizontal-Pod-Autoscaling-æ°´å¹³æ‰©å±•"><span class="post-toc-number">2.7.</span> <span class="post-toc-text">8.Horizontal Pod Autoscaling - æ°´å¹³æ‰©å±•</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

  <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        äººé—´è‡ªæœ‰äº”å¤§æƒ…ã€ç‚¹èµã€æŠ•å¸(èµèµ)ã€æ”¶è—ã€å…³æ³¨ï¼Œè½¬å‘ã€‘, è°¢è°¢çœ‹å‹æ”¯æŒ!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

  
 <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->

  <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">ä¸ªäººGithub</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">ä¸ªäººGitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">ä¸ªäººçŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘+äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved. ITå”¯ä¸€æå®¢ ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/5-27-526.html&title=ã€Š5-Kuberneteså…¥é—¨åŸºç¡€ä¹‹æ§åˆ¶å™¨Controllerä»‹ç»ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/5-27-526.html&title=ã€Š5-Kuberneteså…¥é—¨åŸºç¡€ä¹‹æ§åˆ¶å™¨Controllerä»‹ç»ã€‹ â€” WeiyiGeek Blog&source=WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ª..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/5-27-526.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š5-Kuberneteså…¥é—¨åŸºç¡€ä¹‹æ§åˆ¶å™¨Controllerä»‹ç»ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/5-27-526.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/5-27-526.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACKklEQVR42u3a0W7DIBAEwPz/T7uvldIkexyuAoyfqsSxGSqdYI/HI76uX1fy7fV0vfpV/pYJFwYGxrKM6+31/p4c82roz58n7/3jORgYGAcw7nh0fk+HjYGBgZEwqgX3/UAxMDAwZjGqm88vLbgYGBhLMZJNbPKyPGirFvFpe3EMDIwFGXnq/v9/39LfwMDAWIpxFa/qc8YWjuVRYWBgbM3IC1yyHOxvaDvjwcDA2JWRtx6rL5sVwEWfYGBgHMPoHPzKt76dAxwvn4aBgbE1I29kVo9HdBqWY9OEgYFxAqO6jaxuSvOFZnUiMDAwTmD0GwP5bOWxXfk/gIGBsSmjczqj2qocC++iX2FgYBzAqB4nzSP7nFptUXxIDTEwMDZijIX+eesxWYDmExQ1RzEwMLZjVA9D5AU33wbn5XgwHcTAwFicMfmgQzuAG2uUYmBgnMAYq2D59jJ/ZXWCyrkgBgbGgoxOuJ/f0z/G+mGZiIGBsTUjX8xVl4+dxV/1iAYGBsYJjE5Mf0fqNThxGBgYBzDGArKx9mQeyRUmFwMD4wBGvzEwtlkdCwFvbGFiYGB8GaMf/XcGmoduH4ovBgbG1ox+O7O6sMvjuerTMDAw9maMhf7VxWK1SZk3SjEwMM5hjBW+ZJdcXSZWSz8GBgZGdeh5UyEvu4XQDQMDA6NdjvtLzMkFFwMDYylGtRmQR/md8npL3IaBgbEgo3VSY1JroRrSDY4KAwNjPcYPym1qmKXxIuIAAAAASUVORK5CYII=" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 



  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 
     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>
