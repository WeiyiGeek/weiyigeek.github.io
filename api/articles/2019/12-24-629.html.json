{"title":"PS命令之账户安全票据生成管理","slug":"编程世界/Powershell/Cmdlet/认证域控类命令/PS命令之账户安全票据生成管理","date":"2019-12-24T07:36:30.000Z","updated":"2023-01-31T02:29:10.671Z","url":"2019/12-24-629.html","path":"api/articles/2019/12-24-629.html.json","covers":["https://img.weiyigeek.top/2021/5/20210511180248.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<p>[TOC]</p>\n<h2 id=\"0x00-系统认证\"><a href=\"#0x00-系统认证\" class=\"headerlink\" title=\"0x00 系统认证\"></a>0x00 系统认证</h2><h3 id=\"Get-Credential-命令-基于用户名和密码获取凭据对象。\"><a href=\"#Get-Credential-命令-基于用户名和密码获取凭据对象。\" class=\"headerlink\" title=\"Get-Credential 命令- 基于用户名和密码获取凭据对象。\"></a>Get-Credential 命令- 基于用户名和密码获取凭据对象。</h3><p>描述: 在安全操作中使用该凭证对象;</p>\n<p><strong>语法参数:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Get-Credential</span><br><span class=\"line\">   [[-Credential] &lt;PSCredential&gt;]</span><br><span class=\"line\">   [&lt;CommonParameters&gt;]</span><br><span class=\"line\"></span><br><span class=\"line\">Get-Credential</span><br><span class=\"line\">   [-Message &lt;String&gt;]</span><br><span class=\"line\">   [[-UserName] &lt;String&gt;]</span><br><span class=\"line\">   [&lt;CommonParameters&gt;]</span><br></pre></td></tr></table></figure></p>\n<p><strong>基础示例:</strong><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.获取凭证对象并将其保存在$c变量中</span></span><br><span class=\"line\"><span class=\"variable\">$cred</span> = <span class=\"built_in\">Get-Credential</span> -Credential WEIYIGEEK\\WeiyiGeek  <span class=\"comment\"># 该`cmdlet`提示用户输入密码或用户名和密码</span></span><br><span class=\"line\">  <span class=\"comment\"># UserName                                Password</span></span><br><span class=\"line\">  <span class=\"comment\"># --------                                --------</span></span><br><span class=\"line\">  <span class=\"comment\"># WEIYIGEEK\\WeiyiGeek System.Security.SecureString</span></span><br><span class=\"line\"><span class=\"comment\"># - PowerShell 采用此种方式未复现成功(貌似已不支持-Credential参数)</span></span><br><span class=\"line\"><span class=\"comment\"># Get-CimInstance Win32_DiskDrive -ComputerName WeiyiGeek -Credential $cred</span></span><br><span class=\"line\"><span class=\"comment\"># Get-CimInstance Win32_BIOS -ComputerName WeiyiGeek -Credential (Get-Credential -Credential WEIYIGEEK\\WeiyiGeek)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.此示例创建一个凭证，其中包含一个没有域名的用户名。</span></span><br><span class=\"line\"><span class=\"variable\">$cred</span> = <span class=\"built_in\">Get-Credential</span> -credential WeiyiGeek</span><br><span class=\"line\"><span class=\"variable\">$cred</span> .username</span><br><span class=\"line\">WeiyiGeek</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.此命令使用PromptForCredential方法提示用户输入用户名和密码。该命令将生成的凭据保存在$Credential变量中。</span></span><br><span class=\"line\"><span class=\"comment\"># 使用PromptForCredential时，可以指定提示中显示的标题、消息和用户名。</span></span><br><span class=\"line\"><span class=\"variable\">$Credential</span> = <span class=\"variable\">$host</span>.ui.PromptForCredential(<span class=\"string\">\"Need credentials\"</span>, <span class=\"string\">\"Please enter your user name and password.\"</span>, <span class=\"string\">\"WeiyiGeek\"</span>, <span class=\"string\">\"NetBiosUserName\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.此示例演示如何创建与获取凭证返回的对象相同的凭证对象，而不提示用户。此方法需要纯文本密码(这可能违反某些企业的安全标准-通常不建议)。</span></span><br><span class=\"line\"><span class=\"variable\">$User</span> = <span class=\"string\">\"Domain01\\User01\"</span></span><br><span class=\"line\"><span class=\"variable\">$PWord</span> = <span class=\"built_in\">ConvertTo-SecureString</span> -String <span class=\"string\">\"P@sSwOrd\"</span> -AsPlainText -Force</span><br><span class=\"line\"><span class=\"variable\">$Credential</span> = <span class=\"built_in\">New-Object</span> -TypeName System.Management.Automation.PSCredential -ArgumentList <span class=\"variable\">$User</span>, <span class=\"variable\">$PWord</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5.此命令使用Get-Credential cmdlet的消息和用户名参数</span></span><br><span class=\"line\"><span class=\"variable\">$cred</span> = <span class=\"built_in\">Get-Credential</span> -User WeiyiGeek -Message <span class=\"string\">\"请输入安全认证密码\"</span> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 6.使用凭据进行远程主机管理必须开启 WinRM 服务并且添加远程主机信任。</span></span><br><span class=\"line\">PS &gt; <span class=\"built_in\">Get-Service</span> -Name WinRM | <span class=\"built_in\">Start-Service</span></span><br><span class=\"line\">PS &gt; <span class=\"built_in\">Set-Item</span> WSMan:localhost\\client\\trustedhosts -value <span class=\"number\">10.20</span>.<span class=\"number\">172.106</span> -Force</span><br><span class=\"line\">PS &gt; <span class=\"built_in\">Invoke-Command</span> -ComputerName <span class=\"number\">10.20</span>.<span class=\"number\">172.106</span> &#123;<span class=\"built_in\">Write-Output</span> <span class=\"string\">\"Hello\"</span> &gt; d:\\helo.txt&#125; -Credential <span class=\"variable\">$cred3</span></span><br><span class=\"line\">PS &gt; <span class=\"built_in\">Invoke-Command</span> -ComputerName <span class=\"number\">10.20</span>.<span class=\"number\">172.106</span> &#123;calc&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2021/5/20210511180248.png\" alt=\"WeiyiGeek.Credential-remote-use\" title=\"\" class=\"\">\n                <p>WeiyiGeek.Credential-remote-use</p>\n            </figure>","comments":true,"excerpt":"[TOC]","categories":[{"name":"Development","path":"api/categories/Development.json"}],"tags":[{"name":"Powershell","path":"api/tags/Powershell.json"}]}