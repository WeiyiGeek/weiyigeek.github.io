{"title":"MsSQL编程入门-待补充","slug":"数据存储/MSSQL/MsSQL编程入门","date":"2019-12-01T13:34:33.000Z","updated":"2022-04-13T14:44:35.779Z","url":"2019/12-1-42.html","path":"api/articles/2019/12-1-42.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200429173603.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<p>– 数据库版本<br>select @@version</p>\n<p>–查询数据库大小</p>\n<p>exec sp_spaceused;</p>\n<p>–查询数据库中指定表大小</p>\n<p>exec sp_spaceused ‘表名’;</p>\n<p><a href=\"https://www.cnblogs.com/rainman/p/6203065.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/rainman/p/6203065.html</a></p>\n<p>数据库操作:<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">DATABASE</span> [WeiyiGeek]</span><br><span class=\"line\"><span class=\"keyword\">ON</span></span><br><span class=\"line\">PRIMARY</span><br><span class=\"line\">(</span><br><span class=\"line\">  <span class=\"keyword\">NAME</span> = N<span class=\"string\">'WeiyiGeek'</span>,</span><br><span class=\"line\">  FILENAME = N<span class=\"string\">'D:\\ZSB\\WeiyiGeek.ndf'</span>,</span><br><span class=\"line\">  <span class=\"keyword\">SIZE</span> = <span class=\"number\">2304</span>KB,</span><br><span class=\"line\">  <span class=\"keyword\">MAXSIZE</span> = <span class=\"keyword\">UNLIMITED</span>,</span><br><span class=\"line\">  FILEGROWTH = <span class=\"number\">1</span>MB</span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">LOG</span> <span class=\"keyword\">ON</span></span><br><span class=\"line\">(</span><br><span class=\"line\">  <span class=\"keyword\">NAME</span> = N<span class=\"string\">'WeiyiGeek_log'</span>,</span><br><span class=\"line\">  FILENAME = N<span class=\"string\">'D:\\ZSB\\CZWeiyiGeek_log.ldf'</span>,</span><br><span class=\"line\">  <span class=\"keyword\">SIZE</span> = <span class=\"number\">768</span>KB,</span><br><span class=\"line\">  <span class=\"keyword\">MAXSIZE</span> = <span class=\"keyword\">UNLIMITED</span>,</span><br><span class=\"line\">  FILEGROWTH = <span class=\"number\">10</span>MB</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">GO</span></span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">DATABASE</span> [WeiyiGeek] <span class=\"keyword\">COLLATE</span> Chinese_PRC_CI_AS</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">GO</span></span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">DATABASE</span> [WeiyiGeek] <span class=\"keyword\">SET</span> <span class=\"keyword\">RECOVERY</span> <span class=\"keyword\">FULL</span></span><br></pre></td></tr></table></figure></p>\n<p><strong>用户操作:</strong></p>\n<ul>\n<li><p>1.新增</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">--创建登录用户及默认管理数据库</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> LOGIN weiyigeek <span class=\"keyword\">WITH</span> <span class=\"keyword\">PASSWORD</span>=<span class=\"string\">'Weiyi.Geek*123456'</span>,DEFAULT_DATABASE=weiyigeek</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--创建数据库用户</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">USER</span> weiyigeek <span class=\"keyword\">FOR</span> LOGIN weiyigeek <span class=\"keyword\">WITH</span> DEFAULT_SCHEMA=dbo</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>2.修改</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">--禁用登录用户</span></span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> LOGIN weiyigeek <span class=\"keyword\">DISABLE</span></span><br><span class=\"line\"><span class=\"comment\">--启用登录账户</span></span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> LOGIN weiyigeek <span class=\"keyword\">ENABLE</span></span><br><span class=\"line\"><span class=\"comment\">--登录账户改密码</span></span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> LOGIN weiyigeek <span class=\"keyword\">WITH</span> <span class=\"keyword\">PASSWORD</span>=<span class=\"string\">'复杂密码要求'</span></span><br><span class=\"line\"><span class=\"comment\">--登录账户改名</span></span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> LOGIN weiyigeek <span class=\"keyword\">WITH</span> <span class=\"keyword\">NAME</span>=Weiyi</span><br><span class=\"line\"><span class=\"comment\">--数据库用户改名</span></span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">USER</span> weiyigeek <span class=\"keyword\">WITH</span> <span class=\"keyword\">NAME</span>=Weiyi</span><br><span class=\"line\"><span class=\"comment\">--更改数据库用户 DEFAULT_SCHEMA</span></span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">USER</span> weiyigeek <span class=\"keyword\">WITH</span> DEFAULT_SCHEMA=stg</span><br><span class=\"line\"><span class=\"comment\">--删除数据库用户</span></span><br><span class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">USER</span> weiyigeek</span><br><span class=\"line\"><span class=\"comment\">--删除登录账户</span></span><br><span class=\"line\"><span class=\"keyword\">DROP</span> LOGIN weiyigeek</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><strong>权限操作:</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">--通过加入数据库角色，赋予数据库用户“db_owner”权限</span></span><br><span class=\"line\">exec sp_addrolemember 'db_owner', 'weiyigeek'</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 数据库所有者权限</span></span><br><span class=\"line\"><span class=\"comment\">-- GO</span></span><br><span class=\"line\"><span class=\"comment\">-- EXEC [WeiyiGeek].dbo.sp_changedbowner N'Sa'</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--授予用户建表权限</span></span><br><span class=\"line\"><span class=\"keyword\">GRANT</span> <span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"keyword\">to</span> weiyigeek</span><br><span class=\"line\"><span class=\"comment\">--授予角色dba对HR.Employees表的所有权限</span></span><br><span class=\"line\"><span class=\"keyword\">GRANT</span> <span class=\"keyword\">ALL</span> <span class=\"keyword\">ON</span> HR.Employees <span class=\"keyword\">to</span> weiyigeek</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--收回权限</span></span><br><span class=\"line\"><span class=\"keyword\">REVOKE</span> <span class=\"keyword\">all</span> <span class=\"keyword\">ON</span> HR.Employees <span class=\"keyword\">FROM</span> weiyigeek</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--授予角色dba对HR.Employees表的SELECT权限</span></span><br><span class=\"line\"><span class=\"keyword\">GRANT</span> <span class=\"keyword\">SELECT</span> <span class=\"keyword\">ON</span> HR.Employees <span class=\"keyword\">TO</span> weiyigeek</span><br><span class=\"line\"><span class=\"comment\">--拒绝安全账户dba对HR.Employees表的select权限(下面则相反)</span></span><br><span class=\"line\">DENY <span class=\"keyword\">SELECT</span> <span class=\"keyword\">ON</span> HR.Employees <span class=\"keyword\">to</span> weiyigeek</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--从数据库中删除安全账户,failed</span></span><br><span class=\"line\">EXEC sp_revokedbaccess <span class=\"string\">'jira'</span></span><br><span class=\"line\"><span class=\"comment\">--删除角色 r_test,failed</span></span><br><span class=\"line\">EXEC sp_droprole <span class=\"string\">'jira'</span></span><br><span class=\"line\"><span class=\"comment\">--删除登录 l_test,success</span></span><br><span class=\"line\">EXEC sp_droplogin <span class=\"string\">'jira'</span></span><br></pre></td></tr></table></figure>\n<p><em>Q:recoke和deny的区别?</em></p>\n<ul>\n<li>revoke 收回之前被授予的权限,(<code>收回权限后，可以从其他角色中重新继承权限</code>)</li>\n<li>deny 拒绝给当前数据库内的安全账户授予权限并防止安全账户通过其组或角色成员资格继承权限,(<code>拒绝权限后，不可以从其他角色继承权限</code>)</li>\n</ul>\n<p>基础示例:<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- Revoke</span></span><br><span class=\"line\"><span class=\"keyword\">GRANT</span> <span class=\"keyword\">INSERT</span> <span class=\"keyword\">ON</span> TableA <span class=\"keyword\">TO</span> RoleA      <span class=\"comment\">-- 授予角色RoleA对TableA插入权限</span></span><br><span class=\"line\">EXEC sp_addrolemember RoleA, <span class=\"string\">'UserA'</span> <span class=\"comment\">-- 用户UserA将有TableA的INSERT权限</span></span><br><span class=\"line\"><span class=\"keyword\">REVOKE</span> <span class=\"keyword\">INSERT</span> <span class=\"keyword\">ON</span> TableA <span class=\"keyword\">FROM</span> RoleA   <span class=\"comment\">-- 用户UserA将没有TableA的INSERT权限(收回权限)</span></span><br><span class=\"line\"><span class=\"keyword\">GRANT</span> <span class=\"keyword\">INSERT</span> <span class=\"keyword\">ON</span> TableA <span class=\"keyword\">TO</span> RoleA       <span class=\"comment\">-- 重新给RoleA以TableA的INSERT权限</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- Deny</span></span><br><span class=\"line\">DENY <span class=\"keyword\">INSERT</span> <span class=\"keyword\">ON</span> TableA <span class=\"keyword\">TO</span> UserA  <span class=\"comment\">-- 虽然用户UserA所在RoleA有TableA的INSERT权限，但UserA本身被DENY了，所以用户UserA将没有TableA的INSERT权限。</span></span><br></pre></td></tr></table></figure></p>\n<p><strong>章节总结:</strong><br>1.MsSQL用户与角色(<code>MsSQL 2008</code>):</p>\n<ul>\n<li>用户:<ul>\n<li>登录连接用户名: 个人建立用户与Windows用户组或用户账户(<code>SYSTEM / MSSQLSERVER / SQLSERVERAGENT / Administrator</code>), 默认最高权限系统管理员sa;<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> </span><br></pre></td></tr></table></figure></li>\n<li>数据库用户 </li>\n</ul>\n</li>\n<li>角色:<ul>\n<li>服务器角色:在服务器层次上定义的，因此它们位于从属于数据库服务器的数据库外面;<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#sysadmin: 执行SQL Server中的任何动作比如sa，只有这个角色中的成员(或一个被这个角色中的成员赋予了CREATE DATABASE权限的用户)才能够创建数据库;</span></span><br><span class=\"line\"><span class=\"comment\">#serveradmin: 配置服务器设置,比如(使表常驻于主内存中,显示或更改系统选项,更新系统过程所做的所有改动,关掉数据库服务器,用户自定义表设置选项的值)</span></span><br><span class=\"line\"><span class=\"comment\">#setupadmin: 安装复制和管理扩展过程，向该服务器角色中添加其他登录以及添加、删除或配置链接的服务器，和指向一些系统过程;</span></span><br><span class=\"line\"><span class=\"comment\">#securityadmin: 执行关于服务器访问和安全的所有动作,管理登录和CREATE DATABASE的权限以及阅读审计,读取SQL Server的错误日志</span></span><br><span class=\"line\"><span class=\"comment\">#processadmin: 管理SQL Server进程,如中止用户正在运行的查询以及执行KILL命令(以取消用户进程);</span></span><br><span class=\"line\"><span class=\"comment\">#dbcreator: 管理与数据库创建和修改有关的所有动作,比如(运行CREATE DATABASE和ALTER DATABASE语句)</span></span><br><span class=\"line\"><span class=\"comment\">#diskadmin: 用来存储数据库对象的文件和文件组有关的动作(管理磁盘文件)</span></span><br><span class=\"line\"><span class=\"comment\">#bulkadmin: 批量插入管理员，以前的SQL版本称为bulk - insert administrators</span></span><br></pre></td></tr></table></figure></li>\n<li>数据库角色:固定数据库角色在数据库层上进行定义，因此它们存在于属于数据库服务器的每个数据库中<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#db_owner : 可以执行数据库中技术所有动作的用户</span></span><br><span class=\"line\">  - 1.向其他固定数据库角色中添加成员或从其中删除成员</span><br><span class=\"line\">  - 2.运行所有的DDL语句</span><br><span class=\"line\">  - 3.运行BACKUP DATABASE和BACKUP LOG语句</span><br><span class=\"line\">  - 4.使用CHECKPOINT语句显式地启动检查点进程</span><br><span class=\"line\">  - 5.授予、取消或剥夺每一个数据库对象上的下列权限</span><br><span class=\"line\">  - 6.执行特定的系统过程进行添加用户和角色以及对任意数据库对象重新命名</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#db_accessadmin : 执行与数据库访问有关的所有动作，比如可以添加、删除用户的用户</span></span><br><span class=\"line\">  - 1.为Windows用户账户、Windows组和SQL Server登录添加或删除访问</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#db_datareader : 对数据库中的数据库对象(表或视图)具有SELECT权限，比如可以查看所有数据库中用户表内数据的用户</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#db_datawriter : 对数据库中的数据库对象(表或视图)具有INSERT、UPDATE和DELETE权限，可以添加、修改或删除所有数据库中用户表内数据的用户</span></span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\">#db_ddladmin ：可以在数据库中执行所有DDL操作的用户</span></span><br><span class=\"line\">  - 1.运行所有DDL语句</span><br><span class=\"line\">  - 2.对任何表上授予REFERENCESE权限</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#db_securityadmin : 管理数据库中的安全，可以管理数据库中与安全权限有关所有动作的用户</span></span><br><span class=\"line\">  - 1.运行与安全有关的所有Transact-SQL语句(GRANT、DENY和REVOKE)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#db_backoperator ：可以备份数据库的用户(并可以发布DBCC和CHECKPOINT语句，这两个语句一般在备份前都会被执行)</span></span><br><span class=\"line\">  - 1.运行BACKUP DATABASE和BACKUP LOG语句</span><br><span class=\"line\">  - 2.用CHECKPOINT语句显式地启动检查点进程</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#db_denydatareader:不能看到数据库中任何数据的用户，对数据库中的数据库对象(表或视图)没有SELECT权限</span></span><br><span class=\"line\"><span class=\"comment\">#db_denydatawriter:不能改变数据库中任何数据的用户，对数据库中的任何数据库对象(表或视图)没有INSERT、UPDATE和DELETE权限。</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Public: 特殊的固定数据库角色，数据库的每个合法用户都属于该角色（它为数据库中的用户提供了所有默认权限。）</span></span><br><span class=\"line\">  - 1.作用:提供一种机制即给予那些没有适当权限的所有用户以一定的(通常是有限的)权限，所以public角色不能被删除；</span><br><span class=\"line\">  - 2.允许的操作：使用某些系统过程查看并显示master数据库中的信息，执行一些不需要一些权限的语句</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n<p><em>注意事项:</em></p>\n<ul>\n<li>您不能添加、修改或删除固定服务器角色。另外，只有固定服务器角色的成员才能执行上述两个系统过程来从角色中添加或删除登录账户。</li>\n<li>在以前的SQL Server版本中不存在角色，sa登录具有所有可能的关于系统管理工作的权限。在SQL Server 2005中sa登录保持了向后兼容性是<code>固定服务器角色sysadmin中的成员</code>，并且不能从该角色中删除。</li>\n</ul>\n<p>EXEC 命令<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">--检查数据库中孤立用户</span></span><br><span class=\"line\">EXEC sp_change_users_login @action='Report'</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--对孤立用户连接到现有的登录名</span></span><br><span class=\"line\">EXEC sp_change_users_login   </span><br><span class=\"line\">    @action='update_one',   </span><br><span class=\"line\">    @usernamepattern='UserName', <span class=\"comment\">--数据库孤立用户  </span></span><br><span class=\"line\">    @loginname='LoginName'; <span class=\"comment\">--关联到sql server登录名  </span></span><br><span class=\"line\">GO</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- #系统过程添加或删除固定服务器角色成员</span></span><br><span class=\"line\">sp_addsrvrolemember</span><br><span class=\"line\">sp_dropsrvrolemember</span><br></pre></td></tr></table></figure></p>\n<p>sp_srvrolepermission - 浏览每个固定服务器角色的权限<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 语法</span></span><br><span class=\"line\">sp_srvrolepermission [[@srvrolename =] 'role']</span><br><span class=\"line\"></span><br><span class=\"line\">EXEC sp_srvrolepermission <span class=\"comment\">--当前用户角色权限</span></span><br><span class=\"line\"><span class=\"comment\">-- ServerRole\tPermission</span></span><br><span class=\"line\"><span class=\"comment\">-- bulkadmin\tAdd member to bulkadmin</span></span><br><span class=\"line\"></span><br><span class=\"line\">EXEC sp_srvrolepermission @srvrolename = 'bulkadmin'  <span class=\"comment\">-- 查看指定固定服务器角色用户的权限</span></span><br><span class=\"line\"><span class=\"comment\">-- ServerRole\tPermission</span></span><br><span class=\"line\"><span class=\"comment\">-- bulkadmin\tAdd member to bulkadmin</span></span><br><span class=\"line\"><span class=\"comment\">-- bulkadmin\tBULK INSERT</span></span><br></pre></td></tr></table></figure></p>\n<p>sp_dbfixedrolepermission - 查看每个固定数据库角色的权限<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 语法</span></span><br><span class=\"line\">sp_db.xedrolepermission [[@rolename =] 'role']</span><br><span class=\"line\"></span><br><span class=\"line\">EXEC sp_dbfixedrolepermission <span class=\"comment\">-- 当前固定数据库角色权限</span></span><br><span class=\"line\"><span class=\"comment\">-- DbFixedRole\tPermission</span></span><br><span class=\"line\"><span class=\"comment\">-- db_accessadmin\tsp_revokedbaccess</span></span><br><span class=\"line\"><span class=\"comment\">-- db_backupoperator\tBACKUP DATABASE</span></span><br><span class=\"line\"></span><br><span class=\"line\">EXEC sp_dbfixedrolepermission @rolename = 'public' <span class=\"comment\">-- 查指定数据库角色的权限</span></span><br><span class=\"line\"><span class=\"comment\">-- DbFixedRole\tPermission</span></span><br><span class=\"line\"><span class=\"comment\">-- db_owner\tAdd/drop to/from db_accessadmin</span></span><br><span class=\"line\"><span class=\"comment\">-- db_owner\tAdd/drop to/from db_backupoperator</span></span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">运 行如下的系统过程：如sp_addlinkedsrvlogin、sp_addlogin、sp_defaultdb、 sp_defaultlanguage、sp_denylogin、sp_droplinkedsrvlogin、sp_droplogin、 sp_grantlogin、sp_helplogins、sp_remoteoption和sp_revokelogin(所有这些系统过程都与系统安 全相关。)</span><br><span class=\"line\"></span><br><span class=\"line\">--db_owner</span><br><span class=\"line\">使 用下列系统过程向数据库中添加用户或角色：sp_addapprole、sp_addrole、sp_addrolemember、 sp_approlepassword、sp_changeobjectowner、sp_dropapprole、sp_droprole、 sp_droprolemember、sp_dropuser、sp_grantdbaccess</span><br><span class=\"line\"></span><br><span class=\"line\">使用系统过程sp_renamedb来修改数据库的名称</span><br><span class=\"line\"></span><br><span class=\"line\">使用系统过程sp_procoption和sp_recompile来修改任何存储过程的结构</span><br><span class=\"line\"></span><br><span class=\"line\">使用系统过程sp_rename为任何数据库对象重命名</span><br><span class=\"line\"></span><br><span class=\"line\">使用系统过程sp_tableoption和sp_changeobjectowner分别修改表的选项和任何数据库对象的拥有者</span><br></pre></td></tr></table></figure>\n<hr>\n<p>IN 字句<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1.显示姓李**的100位学生及其学校</span></span><br><span class=\"line\">SELECT top 100 XM,KDMC FROM [cj] WHERE BMH IN (SELECT BMH FROM [CJ] WHERE XM LIKE <span class=\"string\">'李__'</span>)</span><br></pre></td></tr></table></figure></p>\n<p><strong>行转列</strong><br>需求分析:当一个数据表中每一行代表了学生的某一科成绩，如何将在一行显示一位考生所有科的成绩，这是我们就需要进行列转行;<br>实现需求:<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200429173603.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p>测试示例:<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"string\">`TEST_TB_GRADE`</span> (</span><br><span class=\"line\">  <span class=\"string\">`ID`</span> <span class=\"built_in\">int</span>(<span class=\"number\">10</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> AUTO_INCREMENT,</span><br><span class=\"line\">  <span class=\"string\">`USER_NAME`</span> <span class=\"built_in\">varchar</span>(<span class=\"number\">20</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"literal\">NULL</span>,</span><br><span class=\"line\">  <span class=\"string\">`COURSE`</span> <span class=\"built_in\">varchar</span>(<span class=\"number\">20</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"literal\">NULL</span>,</span><br><span class=\"line\">  <span class=\"string\">`SCORE`</span> <span class=\"built_in\">float</span> <span class=\"keyword\">DEFAULT</span> <span class=\"string\">'0'</span>,</span><br><span class=\"line\">  PRIMARY <span class=\"keyword\">KEY</span> (<span class=\"string\">`ID`</span>)</span><br><span class=\"line\">) <span class=\"keyword\">ENGINE</span>=<span class=\"keyword\">InnoDB</span> AUTO_INCREMENT=<span class=\"number\">1</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">CHARSET</span>=utf8;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> TEST_TB_GRADE(USER_NAME, COURSE, SCORE)  <span class=\"keyword\">values</span></span><br><span class=\"line\">(<span class=\"string\">\"张三\"</span>, <span class=\"string\">\"数学\"</span>, <span class=\"number\">34</span>),</span><br><span class=\"line\">(<span class=\"string\">\"张三\"</span>, <span class=\"string\">\"语文\"</span>, <span class=\"number\">58</span>),</span><br><span class=\"line\">(<span class=\"string\">\"张三\"</span>, <span class=\"string\">\"英语\"</span>, <span class=\"number\">58</span>),</span><br><span class=\"line\">(<span class=\"string\">\"李四\"</span>, <span class=\"string\">\"数学\"</span>, <span class=\"number\">45</span>),</span><br><span class=\"line\">(<span class=\"string\">\"李四\"</span>, <span class=\"string\">\"语文\"</span>, <span class=\"number\">87</span>),</span><br><span class=\"line\">(<span class=\"string\">\"李四\"</span>, <span class=\"string\">\"英语\"</span>, <span class=\"number\">45</span>),</span><br><span class=\"line\">(<span class=\"string\">\"王五\"</span>, <span class=\"string\">\"数学\"</span>, <span class=\"number\">76</span>),</span><br><span class=\"line\">(<span class=\"string\">\"王五\"</span>, <span class=\"string\">\"语文\"</span>, <span class=\"number\">34</span>),</span><br><span class=\"line\">(<span class=\"string\">\"王五\"</span>, <span class=\"string\">\"英语\"</span>, <span class=\"number\">89</span>);</span><br></pre></td></tr></table></figure></p>\n<p>实际示例:<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 知识点:group by when-case语句 聚合函数</span></span><br><span class=\"line\"><span class=\"comment\">-- 以姓名为分组进行显示考生各科成绩以及是否考了高等数学或者大学语文</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> TOP <span class=\"number\">10</span> XM 姓名, </span><br><span class=\"line\"><span class=\"keyword\">max</span>(<span class=\"keyword\">case</span> KM1MC <span class=\"keyword\">WHEN</span> <span class=\"string\">'高等数学'</span> <span class=\"keyword\">THEN</span> CJ1 <span class=\"keyword\">else</span> <span class=\"literal\">null</span> <span class=\"keyword\">end</span>) 高等数学,</span><br><span class=\"line\"><span class=\"keyword\">max</span>(<span class=\"keyword\">case</span> KM1MC <span class=\"keyword\">WHEN</span> <span class=\"string\">'大学语文'</span> <span class=\"keyword\">THEN</span> CJ1 <span class=\"keyword\">else</span> <span class=\"literal\">null</span> <span class=\"keyword\">end</span>) 大学语文,</span><br><span class=\"line\"><span class=\"keyword\">max</span>(<span class=\"keyword\">case</span> KM2MC <span class=\"keyword\">WHEN</span> <span class=\"string\">'计算机基础'</span> <span class=\"keyword\">THEN</span> CJ2 <span class=\"keyword\">else</span> <span class=\"number\">0.0</span> <span class=\"keyword\">end</span>) 计算机基础,</span><br><span class=\"line\"><span class=\"keyword\">max</span>(<span class=\"keyword\">case</span> KM2MC <span class=\"keyword\">WHEN</span> <span class=\"string\">'大学英语'</span> <span class=\"keyword\">THEN</span> CJ3 <span class=\"keyword\">else</span> <span class=\"number\">0.0</span> <span class=\"keyword\">end</span>) 大学英语</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> [cj]</span><br><span class=\"line\"><span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> xm;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--结果</span></span><br><span class=\"line\">姓名\t高等数学\t大学语文\t计算机基础\t大学英语</span><br><span class=\"line\">WeiyiGeek\t91\t0\t77\t0</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>列转行</strong><br>需求分析:将上述图中进行逆向转换，即将一行学生包括的各门成绩进行一行一行显示<br>测试实例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select user_name, <span class=\"string\">'语文'</span> COURSE , CN_SCORE as SCORE from test_tb_grade2</span><br><span class=\"line\">union select user_name, <span class=\"string\">'数学'</span> COURSE, MATH_SCORE as SCORE from test_tb_grade2</span><br><span class=\"line\">union select user_name, <span class=\"string\">'英语'</span> COURSE, EN_SCORE as SCORE from test_tb_grade2</span><br><span class=\"line\">order by user_name,COURSE;</span><br></pre></td></tr></table></figure></p>\n<p>实际实例：<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- union 联合查询</span></span><br><span class=\"line\"><span class=\"comment\">-- 以学生姓名排序每一行显示一门课程成绩</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> top <span class=\"number\">1</span> XM, <span class=\"string\">'高等数学'</span> <span class=\"string\">'科目'</span> ,CJ1 <span class=\"string\">'成绩'</span><span class=\"keyword\">from</span> [<span class=\"number\">2019</span>cj]</span><br><span class=\"line\"><span class=\"keyword\">UNION</span> <span class=\"keyword\">SELECT</span> top <span class=\"number\">1</span> XM, <span class=\"string\">'大学语文'</span> <span class=\"string\">'科目'</span> ,CJ1 <span class=\"string\">'成绩'</span> <span class=\"keyword\">from</span> [<span class=\"number\">2019</span>cj]</span><br><span class=\"line\"><span class=\"keyword\">UNION</span> <span class=\"keyword\">SELECT</span> top <span class=\"number\">1</span> XM, <span class=\"string\">'计算机基础'</span> <span class=\"string\">'科目'</span>,CJ2 <span class=\"string\">'成绩'</span> <span class=\"keyword\">from</span> [<span class=\"number\">2019</span>cj]</span><br><span class=\"line\"><span class=\"keyword\">UNION</span> <span class=\"keyword\">SELECT</span> top <span class=\"number\">1</span> XM, <span class=\"string\">'大学英语'</span>  <span class=\"string\">'科目'</span>,CJ3 <span class=\"string\">'成绩'</span> <span class=\"keyword\">from</span> [<span class=\"number\">2019</span>cj]</span><br><span class=\"line\"><span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> XM;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--执行结果</span></span><br><span class=\"line\"><span class=\"comment\">-- 姓名\t      科目     成绩</span></span><br><span class=\"line\"><span class=\"comment\">-- WeiyiGeek\t\t高等数学  91</span></span><br><span class=\"line\"><span class=\"comment\">-- WeiyiGeek\t \t大学语文   0</span></span><br><span class=\"line\"><span class=\"comment\">-- WeiyiGeek\t  计算机基础 77</span></span><br><span class=\"line\"><span class=\"comment\">-- WeiyiGeek\t \t大学英语\t\t0</span></span><br></pre></td></tr></table></figure></p>\n<p>声明了三个变量：typeid、parentid、name，数据类型分别为：int、int、varchar(50)</p>\n<p>declare @typeid int,@parentid int,@name varchar(50) ;</p>\n<p>设置变量：name 的值为：成都市</p>\n<p>set @name=’成都市’;</p>\n<p>使用变量，变量查询赋值：使用 @name 变量，将查询出来的 typeid 字段的数据赋值给 @typeid 变量</p>\n<p>select @typeid = typeid from [logging].[dbo].[SYS_CODE] where name = @name;</p>\n<p>使用下面的代码直接输出变量：</p>\n<p>print  ‘typeid：‘+@typeid+’   name：’+ @name</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">--创建登录名</span><br><span class=\"line\">USE master</span><br><span class=\"line\">GO</span><br><span class=\"line\">--创建pbmasser,密码123456</span><br><span class=\"line\">create login weiyigeek with password=<span class=\"string\">'weiyigeek123456.'</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">GO</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">--创建数据库用户</span><br><span class=\"line\">USE E_Market</span><br><span class=\"line\">GO</span><br><span class=\"line\">--创建MasterDBUser用户名</span><br><span class=\"line\">create user MasterDBUser <span class=\"keyword\">for</span> login PbMaster   --为PbMaster数据库登录名创建</span><br><span class=\"line\">GO</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">--为使用者MasterDBUser赋予查看，新增，修改的操作权限</span><br><span class=\"line\">use E_Market</span><br><span class=\"line\">go</span><br><span class=\"line\">grant select,insert,update on UserInfo to MasterDBUser   --赋予查看，新增，修改.sderinfo表名</span><br><span class=\"line\">go</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">--将updata权限进行回收</span><br><span class=\"line\">use E_Market</span><br><span class=\"line\">GO</span><br><span class=\"line\">revoke update on userinfo to MasterDBUser</span><br><span class=\"line\">GO</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>+</code> : 该运算符用于字符串拼接,例如<code>select &quot;Name&quot;+&quot;:WeiyiGeek&quot;</code></li>\n</ul>\n<p>基础示例:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 示例1.Mssql 数据库字符串字段拼接、截取后四位和指定字符串替换</span></span><br><span class=\"line\"><span class=\"comment\">-- cmd &amp; copy (标4文5)</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"string\">'mkdir '</span>+<span class=\"keyword\">RIGHT</span>(yxdm,<span class=\"number\">4</span>) <span class=\"keyword\">from</span> t_user_info <span class=\"keyword\">where</span> xxok = <span class=\"string\">'1'</span> <span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> yxdm; </span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">REPLACE</span>(<span class=\"string\">'echo F | copy .'</span>+photo+<span class=\"string\">' ./use/'</span>+<span class=\"keyword\">RIGHT</span>(yxdm, <span class=\"number\">4</span>)+<span class=\"string\">'/'</span>+ksh2+<span class=\"string\">'.jpg'</span>, <span class=\"string\">'/'</span>, <span class=\"string\">'\\')+'</span> /Y<span class=\"string\">' FROM [dbo].[t_student_info] where xxok = '</span><span class=\"number\">1</span><span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">-- powershell &amp; copy-item</span></span><br><span class=\"line\"><span class=\"string\">SELECT REPLACE('</span>copy-Item -<span class=\"keyword\">Path</span> .<span class=\"string\">'+photo+'</span> -Destination ./<span class=\"keyword\">use</span>/<span class=\"string\">'+RIGHT(yxdm, 4)+'</span>/<span class=\"string\">'+ksh2+'</span>.jpg<span class=\"string\">', '</span>/<span class=\"string\">', '</span>\\<span class=\"string\">') FROM [dbo].[t_student_info] where xxok = '</span><span class=\"number\">1</span><span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">-- 指定ks复制到指定目录</span></span><br><span class=\"line\"><span class=\"string\">SELECT REPLACE('</span>copy-Item -<span class=\"keyword\">Path</span> ./<span class=\"string\">'+sfzh+'</span>.jpg -Destination ./<span class=\"string\">'+RIGHT(yxdm, 4)+'</span>/<span class=\"string\">'+ksh2+'</span>.jpg<span class=\"string\">', '</span>/<span class=\"string\">', '</span>\\<span class=\"string\">') FROM [dbo].[t_student_info] where  sfzh in ('</span>xxxxxx<span class=\"string\">')</span></span><br></pre></td></tr></table></figure>\n<p>Tips : 当我们将两个char、nchar、varchar、nvarchar 、binary、varbinary表达式拼接时，所生成新字符串的长度是两个表达式长度之和。</p>\n<h2 id=\"SQL-内置函数之字符串操作\"><a href=\"#SQL-内置函数之字符串操作\" class=\"headerlink\" title=\"SQL 内置函数之字符串操作\"></a>SQL 内置函数之字符串操作</h2><p>官方参考地址: <a href=\"https://docs.microsoft.com/en-us/sql/t-sql/functions\" target=\"_blank\" rel=\"noopener\">https://docs.microsoft.com/en-us/sql/t-sql/functions</a></p>\n<h3 id=\"LEFT-函数-从左边截取字符串\"><a href=\"#LEFT-函数-从左边截取字符串\" class=\"headerlink\" title=\"LEFT 函数 - 从左边截取字符串\"></a>LEFT 函数 - 从左边截取字符串</h3><h3 id=\"RIGHT-函数-从右边截取字符串\"><a href=\"#RIGHT-函数-从右边截取字符串\" class=\"headerlink\" title=\"RIGHT 函数 - 从右边截取字符串\"></a>RIGHT 函数 - 从右边截取字符串</h3><h3 id=\"SUBSTRING-函数-从指定下标开始截取多个字符\"><a href=\"#SUBSTRING-函数-从指定下标开始截取多个字符\" class=\"headerlink\" title=\"SUBSTRING 函数 - 从指定下标开始截取多个字符\"></a>SUBSTRING 函数 - 从指定下标开始截取多个字符</h3><p>描述说明: 在sql server提供了3个常用截取字符串方法它是<code>LEFT()、RIGHT()、SUBSTRING()</code><br>基础语法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LEFT(character,<span class=\"built_in\">integer</span>)  </span><br><span class=\"line\">RIGHT(character,<span class=\"built_in\">integer</span>)</span><br><span class=\"line\">SUBSTRING(character,start,length)</span><br></pre></td></tr></table></figure><br>参数说明:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- LEFT : 参数1：要截取的字符串，参数2：截取字符个数</span><br><span class=\"line\">- RIGHT : 参数1：要截取的字符串，参数2：截取字符个数</span><br><span class=\"line\">- SUBSTRING : 参数1：要截取的字符串，参数2：开始截取的下标，参数3：截取的字符长度</span><br></pre></td></tr></table></figure><br>基础示例:<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 截取字符串左边7个字符--</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">LEFT</span>(<span class=\"string\">'Welcome to China!'</span>,<span class=\"number\">7</span>) <span class=\"keyword\">as</span> 结果<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"comment\">-- 截取字符串右边6个字符--</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">RIGHT</span>(<span class=\"string\">'Welcome to China!'</span>,<span class=\"number\">6</span>) <span class=\"keyword\">as</span> 结果<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"comment\">-- 截取字符串中间2个字符（从9号下标开始）</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">SUBSTRING</span>(<span class=\"string\">'Welcome to China!'</span>,<span class=\"number\">9</span>,<span class=\"number\">2</span>) <span class=\"keyword\">as</span> 结果<span class=\"number\">3</span></span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h3 id=\"Translate-函数-实现指定字符串的批量替换\"><a href=\"#Translate-函数-实现指定字符串的批量替换\" class=\"headerlink\" title=\"Translate 函数 - 实现指定字符串的批量替换\"></a>Translate 函数 - 实现指定字符串的批量替换</h3><p>描述说明: SQL Server 2017 新增 <code>Translate</code> 函数可以实现批量替换。<br>简单语法: <code>TRANSLATE ( inputString, characters, translations )</code><br>参数说明: 要替换的源字符串,被替换字符,替换成为字符<br>基础示例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - A.用普通大括号替换方形大括号和花括号</span></span><br><span class=\"line\">SELECT TRANSLATE(<span class=\"string\">'2*[3+4]/&#123;7-2&#125;'</span>, <span class=\"string\">'[]&#123;&#125;'</span>, <span class=\"string\">'()()'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - B.将GeoJSON点转换为WKT</span></span><br><span class=\"line\">SELECT TRANSLATE(<span class=\"string\">'[137.4, 72.3]'</span> , <span class=\"string\">'[,]'</span>, <span class=\"string\">'( )'</span>) AS Point, TRANSLATE(<span class=\"string\">'(137.4 72.3)'</span> , <span class=\"string\">'( )'</span>, <span class=\"string\">'[,]'</span>) AS Coordinates;</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h3 id=\"Replace-函数-实现指定字符串的替换\"><a href=\"#Replace-函数-实现指定字符串的替换\" class=\"headerlink\" title=\"Replace 函数 - 实现指定字符串的替换\"></a>Replace 函数 - 实现指定字符串的替换</h3><p>简单语法: <code>Replace(被替换的数据库字段名称或字符串,&#39;被替换字符串&#39;,&#39;被替换的字符&#39;)</code><br>参数说明: 要替换的数据库字段名或源字符串,被替换字符,替换成为字符<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT REPLACE(body,<span class=\"string\">'&lt;span&gt;weiyigeek&lt;/span&gt;'</span>,<span class=\"string\">'&lt;span&gt;唯一极客&lt;/span&gt;'</span>) from blog.content;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"SQL-服务器信息\"><a href=\"#SQL-服务器信息\" class=\"headerlink\" title=\"SQL 服务器信息\"></a>SQL 服务器信息</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> SERVERPROPERTY(N<span class=\"string\">'edition'</span>) <span class=\"keyword\">as</span> <span class=\"keyword\">Edition</span> <span class=\"comment\">--数据版本，如企业版、开发版等</span></span><br><span class=\"line\">,SERVERPROPERTY(N<span class=\"string\">'collation'</span>) <span class=\"keyword\">as</span> <span class=\"keyword\">Collation</span> <span class=\"comment\">--数据库字符集</span></span><br><span class=\"line\">,SERVERPROPERTY(N<span class=\"string\">'servername'</span>) <span class=\"keyword\">as</span> ServerName <span class=\"comment\">--服务名</span></span><br><span class=\"line\">,@@<span class=\"keyword\">VERSION</span> <span class=\"keyword\">as</span> <span class=\"keyword\">Version</span> <span class=\"comment\">--数据库版本号</span></span><br><span class=\"line\">,@@<span class=\"keyword\">LANGUAGE</span> <span class=\"keyword\">AS</span> <span class=\"keyword\">Language</span> <span class=\"comment\">--数据库使用的语言，如us_english等</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> COLLATIONPROPERTY( <span class=\"string\">'chinese_prc_ci_as'</span>, <span class=\"string\">'codepage'</span> )</span><br></pre></td></tr></table></figure>\n<p>执行几个:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Enterprise Edition (64-bit)       </span><br><span class=\"line\">Chinese_PRC_CI_AS </span><br><span class=\"line\">WIN-2605UB613IT        </span><br><span class=\"line\">Microsoft SQL Server 2008 R2 (RTM) - 10.50.1600.1 (X64) Apr  2 2010 15:48:46 Copyright (c) Microsoft Corporation Enterprise Edition (64-bit) on Windows NT 6.2 &lt;X64&gt; (Build 9200: ) (Hypervisor)</span><br><span class=\"line\">简体中文</span><br><span class=\"line\">936</span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Database","path":"api/categories/Database.json"}],"tags":[{"name":"MsSQL","path":"api/tags/MsSQL.json"}]}