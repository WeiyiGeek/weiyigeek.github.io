{"title":"系统日志信息查看一览表","slug":"系统运维/Windows/常用命令/系统查看类命令/系统日志信息查看一览表","date":"2019-07-29T12:35:30.000Z","updated":"2023-01-31T02:29:10.468Z","url":"2019/7-29-233.html","path":"api/articles/2019/7-29-233.html.json","covers":["https://img.weiyigeek.top/2019/1/20191108145415.png","https://img.weiyigeek.top/2019/1/20191114165834.png","https://img.weiyigeek.top/2019/1/20191114171856.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"系统日志查看\"><a href=\"#系统日志查看\" class=\"headerlink\" title=\"系统日志查看\"></a>系统日志查看</h4><h5 id=\"wevtutil-命令\"><a href=\"#wevtutil-命令\" class=\"headerlink\" title=\"wevtutil 命令\"></a>wevtutil 命令</h5><p>描述:Windows 事件命令行实用程序,用于检索有关事件日志和发布者的信息，安装和卸载事件清单，运行查询以及导出、存档和清除日志。</p>\n<p>基础语法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wevtutil COMMAND [ARGUMENT [ARGUMENT] ...] [/OPTION:VALUE [/OPT]</span><br><span class=\"line\">wevtutil COMMAND /? <span class=\"comment\">#二级命令帮助</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#命令参数：</span></span><br><span class=\"line\">el | enum-logs 列出日志名称。</span><br><span class=\"line\">gl | get-log 获取日志配置信息。</span><br><span class=\"line\">sl | <span class=\"built_in\">set</span>-log 修改日志配置,为应用程序日志设置保留、自动备份和日志大小上限。(之后输出XML)</span><br><span class=\"line\">ep | enum-publishers 列出事件发布者。</span><br><span class=\"line\">gp | get-publisher 获取发布者配置信息。</span><br><span class=\"line\">    /&#123;ge | getevents&#125;:[<span class=\"literal\">true</span>|<span class=\"literal\">false</span>]  <span class=\"comment\">#获取此发布者可能引发的事件的元数据信息。</span></span><br><span class=\"line\">    /&#123;gm | getmessage&#125;:[<span class=\"literal\">true</span>|<span class=\"literal\">false</span>]  <span class=\"comment\">#显示实际消息，而不是数字消息 ID。</span></span><br><span class=\"line\">    /&#123;f | format&#125;:[XML|Text] <span class=\"comment\">#指定日志文件格式。默认值为 Text。如果指定 XML，则使用 XML 格式打印输出。如果指定 Text，则不使用 XML 标记打印输出。</span></span><br><span class=\"line\"></span><br><span class=\"line\">im | install-manifest 从清单中安装事件发布者和日志。</span><br><span class=\"line\">    /resourceFilePath)形式的选项名称。 <span class=\"comment\">#选项及其值不区分大小写。</span></span><br><span class=\"line\">    /&#123;rf | resourceFilePath&#125;:VALUE <span class=\"comment\">#要替换的清单中的提供程序元素的 ResourceFileName 属性。 #VALUE 应该是资源文件的完整路径。</span></span><br><span class=\"line\">    /&#123;mf | messageFilePath&#125;:VALUE  <span class=\"comment\">#要替换的清单中的提供程序元素的 MessageFileName 属性。VALUE 应该是消息文件的完整路径。</span></span><br><span class=\"line\">    /&#123;pf | parameterFilePath&#125;:VALUE <span class=\"comment\">#要替换的清单中的提供程序元素的 ParameterFileName 属性。VALUE 应该是参数文件的完整路径。</span></span><br><span class=\"line\"></span><br><span class=\"line\">um | uninstall-manifest 从清单中卸载事件发布者和日志。</span><br><span class=\"line\">qe | query-events 从日志或日志文件中查询事件。</span><br><span class=\"line\">    * /&#123;rd | reversedirection&#125;:[<span class=\"literal\">true</span>|<span class=\"literal\">false</span>] <span class=\"comment\">#事件读取方向。如果为 true，则先返回最近的事件。</span></span><br><span class=\"line\">    * /&#123;lf | logfile&#125;:[<span class=\"literal\">true</span>|<span class=\"literal\">false</span>] <span class=\"comment\">#如果为 true，则 &lt;PATH&gt; 是日志文件的完整路径。</span></span><br><span class=\"line\">    * /&#123;sq | structuredquery&#125;:[<span class=\"literal\">true</span>|<span class=\"literal\">false</span>] <span class=\"comment\"># 如果为 true，则 &lt;PATH&gt; 是包含结构化查询的文件的完整路径。</span></span><br><span class=\"line\">    * /&#123;q | query&#125;:VALUE <span class=\"comment\"># VALUE 是用于筛选读取的事件的 XPath 查询。如果未指定，则返回所有事件。如果 /sq 为 true，则不能使用此选项。</span></span><br><span class=\"line\">    * /&#123;bm | bookmark&#125;:VALUE <span class=\"comment\"># VALUE 是包含上一查询的书签的文件的完整路径。</span></span><br><span class=\"line\">    * /&#123;sbm | savebookmark&#125;:VALUE <span class=\"comment\">#VALUE 是用于保存此查询的书签的文件的完整路径。文件扩展名应为 .xml。</span></span><br><span class=\"line\">    * /&#123;f | format&#125;:[XML|Text|RenderedXml] <span class=\"comment\">#默认值为 XML。如果指定 Text，则使用易于读取的文本格式打印事件，而不是使用 XML 格式。</span></span><br><span class=\"line\">    * <span class=\"comment\">#如果指定 RenderedXml，则使用 XML 格式打印事件并包含呈现信息,使用 Text 或 RenderedXml 格式打印事件，比使用 XML 格式打印慢。</span></span><br><span class=\"line\">    * /&#123;l | locale&#125;:VALUE  <span class=\"comment\"># VALUE 是以特定区域设置打印事件文本的区域设置字符串。只有在使用 /f 选项以文本格式打印事件时，才能使用该字符串。</span></span><br><span class=\"line\">    * /&#123;c | count&#125;:&lt;n&gt;  <span class=\"comment\"># 要读取的最大事件数。ve</span></span><br><span class=\"line\">    * /&#123;e | element&#125;:VALUE  <span class=\"comment\">#在输出事件 XML 时，包含一个根元素以生成正确格式的 XML。VALUE 是要包含在根元素中的字符串。例如指定 /e:root 将导致使用根元素对 &lt;root&gt;&lt;/root&gt; 输出 XML。</span></span><br><span class=\"line\"></span><br><span class=\"line\">gli | get-log-info 获取日志状态信息。</span><br><span class=\"line\">epl | <span class=\"built_in\">export</span>-log 导出日志。</span><br><span class=\"line\">al | archive-log 存档导出的日志。</span><br><span class=\"line\">cl | clear-log 清除日志。</span><br><span class=\"line\">​</span><br><span class=\"line\"><span class=\"comment\">#常用选项:</span></span><br><span class=\"line\">/&#123;r | remote&#125;:VALUE  <span class=\"comment\">#如果指定，则在远程计算机上运行该命令。VALUE 是远程计算机名称。</span></span><br><span class=\"line\">/im 和 /um <span class=\"comment\">#选项不支持远程操作。</span></span><br><span class=\"line\">/&#123;u | username&#125;:VALUE <span class=\"comment\">#指定一个不同的用户以登录到远程计算机。VALUE 是 domain\\user 或 user 形式的用户名。只有在指定 /r 选项时</span></span><br><span class=\"line\">/&#123;p | password&#125;:VALUE <span class=\"comment\">#指定的用户密码。如果未指定，或者 VALUE 为 \"*\"，则会提示用户输入密码。只有在指定 /u 选项时才适用。</span></span><br><span class=\"line\">/&#123;a | authentication&#125;:[Default|Negotiate|Kerberos|NTLM] <span class=\"comment\">#用于连接到远程计算机的身份验证类型。默认值为 Negotiate。</span></span><br><span class=\"line\">/&#123;uni | unicode&#125;:[<span class=\"literal\">true</span>|<span class=\"literal\">false</span>] <span class=\"comment\">#使用 Unicode 显示输出。如果为 true，则使用 Unicode 显示输出。</span></span><br></pre></td></tr></table></figure></p>\n<p>实际案例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#Step0 基础操作</span></span><br><span class=\"line\">wevtutil el         <span class=\"comment\">#列出日志名称 Application / System / Secuirty</span></span><br><span class=\"line\">wevtutil ep         <span class=\"comment\">#列出当前计算机上的事件发布者(效果同上)</span></span><br><span class=\"line\">wevtutil gl 日志名称 <span class=\"comment\">#获取日志配置信息。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Step1 查询所有登录、注销相关的日志语法：（需查看Windows常见安全事件日志ID汇总）</span></span><br><span class=\"line\">wevtutil qe security /rd:<span class=\"literal\">true</span> /f:text /q:<span class=\"string\">\"*[system/eventid=4624 and 4623 4627]\"</span> /r:computer /u:user /p:password <span class=\"comment\">#rd读取最近的记录</span></span><br><span class=\"line\">wevtutil qe security /rd:<span class=\"literal\">true</span> /f:text /q:<span class=\"string\">\"*[system/eventid=4624 and 4623 and 4672]\"</span> /r:dc1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Step2 清空SECURITY/ SYSTEM /APPLICATION 日志</span></span><br><span class=\"line\">wevtutil cl security</span><br><span class=\"line\">wevtutil cl system</span><br><span class=\"line\">wevtutil cl application</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191108145415.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#3.使用文本格式显示应用程序日志中的三个最近的事件。</span></span><br><span class=\"line\">wevtutil qe Application /c:3 /rd:<span class=\"literal\">true</span> /f:text</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4.系统关闭和开启时间记录（注意/q需要采用XPATH路径）</span></span><br><span class=\"line\">wevtutil qe System /c:3 /rd:<span class=\"literal\">true</span> /f:text /q:<span class=\"string\">\"*[System/EventID=12]\"</span> <span class=\"comment\">#开机</span></span><br><span class=\"line\">wevtutil qe System /c:3 /rd:<span class=\"literal\">true</span> /f:text /q:<span class=\"string\">\"*[System/EventID=13]\"</span>  <span class=\"comment\">#注意时间Date与操作系统时间关键有8个小时视差</span></span><br></pre></td></tr></table></figure>\n<p><br></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#5.以下示例使用 XML 格式显示有关本地系统日志的配置信息。</span></span><br><span class=\"line\">wevtutil gl System /f:xml</span><br><span class=\"line\">wevtutil gl System /f:Text</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#6.进行日志记录设置</span></span><br><span class=\"line\">wevtutil sl Application /fm:16 /l:10 /k:<span class=\"string\">\"102400\"</span></span><br><span class=\"line\"><span class=\"comment\"># 无法保存配置或激活日志 Application。</span></span><br><span class=\"line\"><span class=\"comment\"># 拒绝访问。</span></span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191114165834.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#7.显示EventID信息以及配置信息</span></span><br><span class=\"line\">wevtutil gp Application /ge:<span class=\"literal\">true</span> /gm:<span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># name: Application</span></span><br><span class=\"line\"><span class=\"comment\"># guid: 00000000-0000-0000-0000-000000000000</span></span><br><span class=\"line\"><span class=\"comment\"># helpLink:</span></span><br><span class=\"line\"><span class=\"comment\"># message:</span></span><br><span class=\"line\"><span class=\"comment\"># channels:</span></span><br><span class=\"line\"><span class=\"comment\">#   channel:</span></span><br><span class=\"line\"><span class=\"comment\">#     name: Application</span></span><br><span class=\"line\"><span class=\"comment\">#     id: 9</span></span><br><span class=\"line\"><span class=\"comment\">#     flags: 1</span></span><br><span class=\"line\"><span class=\"comment\">#     message:</span></span><br><span class=\"line\"><span class=\"comment\"># levels:</span></span><br><span class=\"line\"><span class=\"comment\"># opcodes:</span></span><br><span class=\"line\"><span class=\"comment\"># tasks:</span></span><br><span class=\"line\"><span class=\"comment\">#   task:</span></span><br><span class=\"line\"><span class=\"comment\">#     name: 设备</span></span><br><span class=\"line\"><span class=\"comment\">#     value: 1</span></span><br><span class=\"line\"><span class=\"comment\">#     eventGUID: 00000000-0000-0000-0000-000000000000</span></span><br><span class=\"line\"><span class=\"comment\">#     message: 设备</span></span><br><span class=\"line\">wevtutil gp Microsoft-Windows-Eventlog /ge:<span class=\"literal\">true</span> /gm:<span class=\"literal\">true</span>  <span class=\"comment\">#以此来收集错误信息</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#8.以下示例从 myManifest.man 清单文件中安装发布者和日志。</span></span><br><span class=\"line\">wevtutil im myManifest.man /rf:^%systemroot^%/System32/wevtutil.exe</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191114171856.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n<p><br></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#9.查看日志的大小及其建立信息</span></span><br><span class=\"line\">C:\\Windows\\system32&gt;wevtutil gli System</span><br><span class=\"line\"><span class=\"comment\"># creationTime: 2019-07-04T05:23:47.559Z</span></span><br><span class=\"line\"><span class=\"comment\"># lastAccessTime: 2019-11-14T11:01:22.928Z</span></span><br><span class=\"line\"><span class=\"comment\"># lastWriteTime: 2019-11-14T11:01:22.928Z</span></span><br><span class=\"line\"><span class=\"comment\"># fileSize: 69632</span></span><br><span class=\"line\"><span class=\"comment\"># attributes: 32</span></span><br><span class=\"line\"><span class=\"comment\"># numberOfLogRecords: 2</span></span><br><span class=\"line\"><span class=\"comment\"># oldestRecordNumber: 1</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#10.日志导出以下示例将系统日志中的事件导出到C:\\backup\\system0506.evtx。</span></span><br><span class=\"line\">wevtutil epl System C:\\backup\\system0506.evtx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#11.要存档的日志文件。可以使用 export-log 或 clear-log 命令生成日志文件。</span></span><br><span class=\"line\">wevtutil el C:\\backup\\system0506.evtx</span><br></pre></td></tr></table></figure>","comments":true,"excerpt":"[TOC]","categories":[{"name":"Windows命令","path":"api/categories/Windows命令.json"}],"tags":[{"name":"系统命令","path":"api/tags/系统命令.json"}]}