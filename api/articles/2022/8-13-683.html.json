{"title":"网安等保-Linux服务器之最新Ubuntu-22.04-LTS系统内核优化与安全加固配置脚本分享","slug":"网安防御/Linux安全与防御/加固防御/网安等保-Linux服务器之最新Ubuntu-22.04-LTS系统内核优化与安全加固配置脚本分享","date":"2022-08-13T06:36:30.000Z","updated":"2023-01-31T02:29:10.669Z","url":"2022/8-13-683.html","path":"api/articles/2022/8-13-683.html.json","covers":["https://img.weiyigeek.top/2022/5/20220823140038.png","https://img.weiyigeek.top/2022/5/20220823140038.png","https://img.weiyigeek.top/2022/5/20220823115958.png","https://www.bilibili.com/video/BV1fe4y1o7ov"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"0x00-前言简述\"><a href=\"#0x00-前言简述\" class=\"headerlink\" title=\"0x00 前言简述\"></a>0x00 前言简述</h2><p>描述: Ubuntu 22.04 LTS 是Canonical于2022年4月21日发布的操作系统，代号为Jammy Jellyfish（果酱水母）, 其采用GNOME电源配置文件和流线型工作空间过渡，提高优化图形驱动程序上的桌面帧速率，使用新的加密算法迁移到OpenSSL v3以提高安全性,并且为内存安全的系统级编程添加了Rus。</p>\n<p>而又由于CentOS发行版在最近几年时内将不在进行维护更新了，所以为了考虑到系统的安全性、可维护性、以及后期运维成本，我们企业内部在2020年时就已经将ubuntu作为主要的服务器系统，所以在我公司新上的业务系统基本采用debian系的发行版服务器来承载基础应用业务，而使用最多当然是Ubuntu此发行版。</p>\n<p>现在 Ubuntu 推出了22.04 ， 想到原来每次都需要手动一台一台的进行主机安全加固以符合等保要求，所以了节约工作时间提高工作效率，有更多时间进行学习进步，则需要将将我们公司所使用的系统基线镜像进行更新迭代，编写适用于ubuntu 22.04系统的安全加固脚本，并且总结此篇文章并在文章末尾附上自动化安全加固脚本，谢谢大家支持。</p>\n<p>此处我依据在我从前编写的 Ubuntu 20.04 系统安全加固脚本中对其根据最新的22.04版本进行更新了等保相关规定策略，以及更新适用最新版本的 Ubuntu，针对脚本进行结构调整，更加方便大家一起参参与维护，若脚本有Bug请大家发送到我的邮箱 <a href=\"mailto:&#109;&#x61;&#x73;&#116;&#x65;&#114;&#64;&#119;&#x65;&#x69;&#121;&#105;&#103;&#x65;&#101;&#x6b;&#x2e;&#116;&#111;&#112;\">&#109;&#x61;&#x73;&#116;&#x65;&#114;&#64;&#119;&#x65;&#x69;&#121;&#105;&#103;&#x65;&#101;&#x6b;&#x2e;&#116;&#111;&#112;</a>。</p>\n<p>想要获取该加固脚本的朋友可以在WX公众号【WeiyiGeek】中回复【ubuntu系统加固】即可获得，或者访问【<a href=\"https://weiyigeek.top/wechat.html?key=ubuntu%E7%B3%BB%E7%BB%9F%E5%8A%A0%E5%9B%BA\" target=\"_blank\" rel=\"noopener\">https://weiyigeek.top/wechat.html?key=ubuntu系统加固</a>】</p>\n<p>​<br><strong>首发地址</strong>: <a href=\"https://mp.weixin.qq.com/s/dO1bV0tfXKn4ZmqlMcUrrQ\" target=\"_blank\" rel=\"noopener\">https://mp.weixin.qq.com/s/dO1bV0tfXKn4ZmqlMcUrrQ</a><br><strong>实践视频</strong>：<a href=\"https://www.bilibili.com/video/BV1fe4y1o7ov\" target=\"_blank\" rel=\"noopener\">https://www.bilibili.com/video/BV1fe4y1o7ov</a></p>\n<hr>\n<h2 id=\"0x01-加固实践\"><a href=\"#0x01-加固实践\" class=\"headerlink\" title=\"0x01 加固实践\"></a>0x01 加固实践</h2><p>描述: Ubuntu 22.04 主机系统安全加固的 <code>Ubuntu22.04-InitializeReinforce.sh</code> 脚本相关上的使用说明以及实践。</p>\n<h3 id=\"book-​-帮助文档\"><a href=\"#book-​-帮助文档\" class=\"headerlink\" title=\":book:​ 帮助文档\"></a>:book:​ 帮助文档</h3><p>描述: 本工具集主要针对于 Ubuntu 22.04 、20.04  LTS 操作系统进行安全加固以及系统初始化操作。</p>\n<p>:hammer_and_wrench: <strong>脚本说明:</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@Ubuntu-Security:/home/ubuntu/Ubuntu<span class=\"comment\"># ./Ubuntu22.04-InitializeReinforce.sh</span></span><br><span class=\"line\">     __          __  _       _  _____           _</span><br><span class=\"line\">     \\ \\        / / (_)     (_)/ ____|         | |</span><br><span class=\"line\">     \\ \\  /\\  / /__ _ _   _ _| |  __  ___  ___| | __</span><br><span class=\"line\">       \\ \\/  \\/ / _ \\ | | | | | | |_ |/ _ \\/ _ \\ |/ /</span><br><span class=\"line\">       \\  /\\  /  __/ | |_| | | |__| |  __/  __/   &lt;</span><br><span class=\"line\">         \\/  \\/ \\___|_|\\__, |_|\\_____|\\___|\\___|_|\\_\\</span><br><span class=\"line\">                      __/ |</span><br><span class=\"line\">                      |___/</span><br><span class=\"line\">======================================================================</span><br><span class=\"line\">@ Desc: Ubuntu 22.04 Security Reinforce and System initialization</span><br><span class=\"line\">@ Mail bug reports: master@weiyigeek.top or pull request (pr)</span><br><span class=\"line\">@ Author : WeiyiGeek</span><br><span class=\"line\">@ Follow me on Blog   : https://blog.weiyigeek.top/</span><br><span class=\"line\">@ Follow me on Wechat : https://weiyigeek.top/wechat.html?key=欢迎关注</span><br><span class=\"line\">@ Communication group : https://weiyigeek.top/visit.html</span><br><span class=\"line\">======================================================================</span><br><span class=\"line\"></span><br><span class=\"line\">Usage: ./Ubuntu22.04-InitializeReinforce.sh [--start ] [--network] [--<span class=\"keyword\">function</span>] [--clear] [--version] [--<span class=\"built_in\">help</span>]</span><br><span class=\"line\">Option:</span><br><span class=\"line\">  --start            Start System initialization and security reinforcement.</span><br><span class=\"line\">  --network          Configure the system network and DNS resolution server.</span><br><span class=\"line\">  --<span class=\"keyword\">function</span>         PCall the specified shell <span class=\"keyword\">function</span>.</span><br><span class=\"line\">  --clear            Clear all system logs, cache and backup files.</span><br><span class=\"line\">  --version          Print version and <span class=\"built_in\">exit</span>.</span><br><span class=\"line\">  --<span class=\"built_in\">help</span>             Print <span class=\"built_in\">help</span> and <span class=\"built_in\">exit</span>.</span><br><span class=\"line\"></span><br><span class=\"line\">Mail bug reports or suggestions to &lt;master@weiyigeek.top&gt; or pull request (pr).</span><br><span class=\"line\">current version : 1.0</span><br><span class=\"line\"></span><br><span class=\"line\">WARNING: 温馨提示：使用前先请配置机器上网环境,若没有配置请在 Ubuntu22.04.conf 文件中进行网络配置.</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2022/5/20220823140038.png\" alt=\"WeiyiGeek.运行加固脚本\" title=\"\" class=\"\">\n                <p>WeiyiGeek.运行加固脚本</p>\n            </figure>\n<p><br/></p>\n<p>:atom_symbol:<strong>脚本函数:</strong></p>\n<p>描述: 如下脚本将根据参数在 <code>Ubuntu22.04-InitializeReinforce.sh</code> 分别进行调用执行, 也可采用<code>--function</code>参数进行指定调用。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">❯ grep -r -n  <span class=\"string\">\"函数名称\"</span> -A 1 *</span><br><span class=\"line\">scripts/os-base.sh:26:<span class=\"comment\"># 函数名称: base_hostname</span></span><br><span class=\"line\">scripts/os-base.sh-27-<span class=\"comment\"># 函数用途: 主机名称设置</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-base.sh:55:<span class=\"comment\"># 函数名称: ubuntu_mirror</span></span><br><span class=\"line\">scripts/os-base.sh-56-<span class=\"comment\"># 函数用途: ubuntu 系统主机软件仓库镜像源</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-base.sh:126:<span class=\"comment\"># 函数名称: ubuntu_software</span></span><br><span class=\"line\">scripts/os-base.sh-127-<span class=\"comment\"># 函数用途: ubuntu 系统主机内核版本升级以常规软件安装</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-base.sh:153:<span class=\"comment\"># 函数名称: base_timezone</span></span><br><span class=\"line\">scripts/os-base.sh-154-<span class=\"comment\"># 函数用途: 主机时间同步校准与时区设置</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-base.sh:192:<span class=\"comment\"># 函数名称: base_banner</span></span><br><span class=\"line\">scripts/os-base.sh-193-<span class=\"comment\"># 函数用途: 远程本地登陆主机信息展示</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-base.sh:345:<span class=\"comment\"># 函数名称: base_reboot</span></span><br><span class=\"line\">scripts/os-base.sh-346-<span class=\"comment\"># 函数用途: 是否进行重启或者关闭服务器</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-clean.sh:27:<span class=\"comment\"># 函数名称: system_clean</span></span><br><span class=\"line\">scripts/os-clean.sh-28-<span class=\"comment\"># 函数用途: 删除安全加固过程临时文件清理为基线镜像做准备</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-exceptions.sh:26:<span class=\"comment\"># 函数名称: problem_usercrond</span></span><br><span class=\"line\">scripts/os-exceptions.sh-27-<span class=\"comment\"># 函数用途: 解决普通用户定时任务无法定时执行问题</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-exceptions.sh:45:<span class=\"comment\"># 函数名称: problem_multipath</span></span><br><span class=\"line\">scripts/os-exceptions.sh-46-<span class=\"comment\"># 函数用途: 解决 ubuntu multipath add missing path 错误</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-network.sh:27:<span class=\"comment\"># 函数名称: net_config</span></span><br><span class=\"line\">scripts/os-network.sh-28-<span class=\"comment\"># 函数用途: 主机IP地址与网关设置</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-network.sh:70:<span class=\"comment\"># 函数名称: net_dns</span></span><br><span class=\"line\">scripts/os-network.sh-71-<span class=\"comment\"># 函数用途: 设置主机DNS解析服务器</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-optimize.sh:27:<span class=\"comment\"># 函数名称: optimize_kernel</span></span><br><span class=\"line\">scripts/os-optimize.sh-28-<span class=\"comment\"># 函数用途: 系统内核参数的优化配置</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-optimize.sh:84:<span class=\"comment\"># 函数名称: resources_limits</span></span><br><span class=\"line\">scripts/os-optimize.sh-85-<span class=\"comment\"># 函数用途: 系统资源文件打开句柄数优化配置</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-optimize.sh:115:<span class=\"comment\"># 函数名称: swap_partition</span></span><br><span class=\"line\">scripts/os-optimize.sh-116-<span class=\"comment\"># 函数用途: 创建系统swap分区</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-security.sh:27:<span class=\"comment\"># 函数名称: sec_usercheck</span></span><br><span class=\"line\">scripts/os-security.sh-28-<span class=\"comment\"># 函数用途: 用于锁定或者删除多余的系统账户</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-security.sh:65:<span class=\"comment\"># 函数名称: sec_userconfig</span></span><br><span class=\"line\">scripts/os-security.sh-66-<span class=\"comment\"># 函数用途: 针对拥有ssh远程登陆权限的用户进行密码口令设置。</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-security.sh:131:<span class=\"comment\"># 函数名称: sec_passpolicy</span></span><br><span class=\"line\">scripts/os-security.sh-132-<span class=\"comment\"># 函数用途: 用户密码复杂性策略设置 (密码过期周期0~90、到期前15天提示、密码长度至少12、复杂度设置至少有一个大小写、数字、特殊字符、密码三次不能一样、尝试次数为三次）</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-security.sh:166:<span class=\"comment\"># 函数名称: sec_sshdpolicy</span></span><br><span class=\"line\">scripts/os-security.sh-167-<span class=\"comment\"># 函数用途: 系统sshd服务安全策略设置</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-security.sh:194:<span class=\"comment\"># 函数名称: sec_loginpolicy</span></span><br><span class=\"line\">scripts/os-security.sh-195-<span class=\"comment\"># 函数用途: 用户登陆安全策略设置</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-security.sh:230:<span class=\"comment\"># 函数名称: sec_historypolicy</span></span><br><span class=\"line\">scripts/os-security.sh-231-<span class=\"comment\"># 函数用途: 用户终端执行的历史命令记录安全策略设置</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-security.sh:261:<span class=\"comment\"># 函数名称: sec_grubpolicy</span></span><br><span class=\"line\">scripts/os-security.sh-262-<span class=\"comment\"># 函数用途: 系统 GRUB 安全设置防止物理接触从grub菜单中修改密码</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-security.sh:304:<span class=\"comment\"># 函数名称: sec_firewallpolicy</span></span><br><span class=\"line\">scripts/os-security.sh-305-<span class=\"comment\"># 函数用途: 系统防火墙策略设置, 建议操作完成后重启计算机.</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-security.sh:335:<span class=\"comment\"># 函数名称: sec_ctrlaltdel</span></span><br><span class=\"line\">scripts/os-security.sh-336-<span class=\"comment\"># 函数用途: 禁用 ctrl+alt+del 组合键对系统重启 (必须要配置我曾入过坑)</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-security.sh:355:<span class=\"comment\"># 函数名称: sec_recyclebin</span></span><br><span class=\"line\">scripts/os-security.sh-356-<span class=\"comment\"># 函数用途: 设置文件删除回收站别名(防止误删文件)(必须要配置,我曾入过坑)</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-security.sh:405:<span class=\"comment\"># 函数名称: sec_supolicy</span></span><br><span class=\"line\">scripts/os-security.sh-406-<span class=\"comment\"># 函数用途: 切换用户日志记录和切换命令更改名称为SU(可选)</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-security.sh:425:<span class=\"comment\"># 函数名称: sec_privilegepolicy</span></span><br><span class=\"line\">scripts/os-security.sh-426-<span class=\"comment\"># 函数用途: 系统用户sudo权限与文件目录创建权限策略设置</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-service.sh:26:<span class=\"comment\"># 函数名称: svc_apport</span></span><br><span class=\"line\">scripts/os-service.sh-27-<span class=\"comment\"># 函数用途: 禁用烦人的apport错误报告</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-service.sh:52:<span class=\"comment\"># 函数名称: svc_snapd</span></span><br><span class=\"line\">scripts/os-service.sh-53-<span class=\"comment\"># 函数用途: 不使用snapd容器的环境下禁用或者卸载多余的snap软件及其服务</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-service.sh:75:<span class=\"comment\"># 函数名称: svc_cloud-init</span></span><br><span class=\"line\">scripts/os-service.sh-76-<span class=\"comment\"># 函数用途: 非云的环境下禁用或者卸载多余的cloud-init软件及其服务</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-service.sh:101:<span class=\"comment\"># 函数名称: svc_debugshell</span></span><br><span class=\"line\">scripts/os-service.sh-102-<span class=\"comment\"># 函数用途: 在系统启动时禁用debug-shell服务</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-software.sh:26:<span class=\"comment\"># 函数名称: install_chrony</span></span><br><span class=\"line\">scripts/os-software.sh-27-<span class=\"comment\"># 函数用途: 安装配置 chrony 时间同步服务器</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-software.sh:79:<span class=\"comment\"># 函数名称: install_java</span></span><br><span class=\"line\">scripts/os-software.sh-80-<span class=\"comment\"># 函数用途: 安装配置java环境</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-software.sh:110:<span class=\"comment\">## 函数名称: install_docker</span></span><br><span class=\"line\">scripts/os-software.sh-111-<span class=\"comment\">## 函数用途: 在 Ubuntu 主机上安装最新版本的Docker</span></span><br><span class=\"line\">--</span><br><span class=\"line\">scripts/os-software.sh:201:<span class=\"comment\">## 函数名称: install_cockercompose</span></span><br><span class=\"line\">scripts/os-software.sh-202-<span class=\"comment\">## 函数用途: 在 Ubuntu 主机上安装最新版本的Dockercompose</span></span><br></pre></td></tr></table></figure>\n<p><br></p>\n<p>​:coffee:​ <strong>配置文件:</strong><br>描述: 在 Ubuntu22.04.conf 配置文件中定义脚本所需的安全策略以及日志、历史记录存放路径, 以模板的初始密码与防火墙配置等，其中最主要的是一定要配置好IP地址，以成功拉取软件仓库中的工具。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vim Ubuntu22.04.conf</span><br><span class=\"line\"><span class=\"comment\"># Show  Script Execute result (Y/N)</span></span><br><span class=\"line\">VAR_VERIFY_RESULT=Y</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Modify Script vertify timeout (unit s)</span></span><br><span class=\"line\">VAR_VERIFY_TIMEOUT=5</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Modify Script run time</span></span><br><span class=\"line\">VAR_RUNDATE=$(date +%Y%m%d-%s)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Modify Path to logfile.</span></span><br><span class=\"line\">LOGFILE=/var/<span class=\"built_in\">log</span>/weiyigeek-<span class=\"variable\">$&#123;VAR_RUNDATE&#125;</span>.<span class=\"built_in\">log</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Modify Path to Backup directory.</span></span><br><span class=\"line\">BACKUPDIR=/var/<span class=\"built_in\">log</span>/.backup/<span class=\"variable\">$&#123;VAR_RUNDATE&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Modify Path to history record directory.</span></span><br><span class=\"line\">HISTORYDIR=/var/<span class=\"built_in\">log</span>/.<span class=\"built_in\">history</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Modify su command execute log file path.</span></span><br><span class=\"line\">SU_LOG_FILE=<span class=\"variable\">$&#123;HISTORYDIR&#125;</span>/su.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Modify the hostname</span></span><br><span class=\"line\">VAR_HOSTNAME=<span class=\"string\">\"Ubuntu-Security\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Modify the IP/MASK and Gateway</span></span><br><span class=\"line\">VAR_IP=10.20.172.152/24</span><br><span class=\"line\">VAR_GATEWAY=10.20.172.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Modify the DNS server</span></span><br><span class=\"line\"><span class=\"comment\"># DNSPod: 119.29.29.29      Alidns: 223.5.5.5 223.6.6.6</span></span><br><span class=\"line\"><span class=\"comment\"># Google: 8.8.8.8 8.8.4.4   Cloudflare: 1.1.1.1 1.0.0.1</span></span><br><span class=\"line\"><span class=\"comment\"># Internal : Your intranet domain name resolution server</span></span><br><span class=\"line\">VAR_DNS_SERVER=(<span class=\"string\">\"223.5.5.5\"</span> <span class=\"string\">\"223.6.6.6\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Modify the SSHD server</span></span><br><span class=\"line\">VAR_SSHD_PORT=20221</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Modify the super user and normal user</span></span><br><span class=\"line\"><span class=\"comment\"># 建议将密码设置最小长度10（最好设置为12以上，等保要求），数字、大写字母、小写字母、特殊符号，密码包含三种及以上, 且无规律。</span></span><br><span class=\"line\"><span class=\"comment\"># 温馨提示: 下面设置的密码为初始密码，在系统登陆后会要求更改。</span></span><br><span class=\"line\">VAR_SUPER_USER=root</span><br><span class=\"line\">VAR_SUPER_PASS=R2022.weiyigeek.top</span><br><span class=\"line\"><span class=\"comment\"># normal user</span></span><br><span class=\"line\">VAR_USER_NAME=ubuntu</span><br><span class=\"line\">VAR_USER_PASS=U2022.weiyigeek.top</span><br><span class=\"line\"><span class=\"comment\"># low privilege application users</span></span><br><span class=\"line\">VAR_APP_USER=app</span><br><span class=\"line\">VAR_APP_PASS=A2022.weiyigeek.top</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Modify the NTP server</span></span><br><span class=\"line\">VAR_NTP_SERVER=( <span class=\"string\">\"ntp.aliyun.com\"</span> <span class=\"string\">\"ntp.tencent.com\"</span> <span class=\"string\">\"192.168.10.254\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Modify the timezone</span></span><br><span class=\"line\">VAR_TIMEZONE=Asia/Shanghai</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Modify Password policy</span></span><br><span class=\"line\"><span class=\"comment\"># 默认密码最大使用为90天、过期前15天提示, 密码最小长度为12</span></span><br><span class=\"line\">PASS_MIN_DAYS=1</span><br><span class=\"line\">PASS_MAX_DAYS=90</span><br><span class=\"line\">PASS_WARN_AGE=15</span><br><span class=\"line\">PASS_MIN_LEN=12</span><br><span class=\"line\"><span class=\"comment\"># 默认加密方式为SHA512, 重试次数为3, 新密码与旧密码至少有6个字符不同, 至少包含3种密码类型，不限制密码中包含大写字母、小写字母、数字、特殊符号的最大数量，记住三次旧密码。</span></span><br><span class=\"line\">VAR_PASS_ENCRYPT=SHA512</span><br><span class=\"line\">VAR_PASS_RETRY=3</span><br><span class=\"line\">VAR_PASS_DIFOK=6</span><br><span class=\"line\">VAR_PASS_MINCLASS=3</span><br><span class=\"line\">VAR_PASS_UCREDIT=-1</span><br><span class=\"line\">VAR_PASS_LCREDIT=-1</span><br><span class=\"line\">VAR_PASS_DCREDIT=-1</span><br><span class=\"line\">VAR_PASS_OCREDIT=-1</span><br><span class=\"line\">VAR_PASS_REMEMBER=3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 禁止没有主目录的用户登录</span></span><br><span class=\"line\">VAR_DEFAULT_HOME=no</span><br><span class=\"line\"><span class=\"comment\"># 删除用户时禁止同步删除用户组</span></span><br><span class=\"line\">VAR_USERGROUPS_ENAB=no</span><br><span class=\"line\"><span class=\"comment\"># 启用成功登录的日志记录</span></span><br><span class=\"line\">VAR_LOG_OK_LOGINS=yes</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Modify file or Dirctory privilege policy</span></span><br><span class=\"line\">VAR_UMASK=022</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Modify user login failed count policy</span></span><br><span class=\"line\"><span class=\"comment\"># 默认在5分钟之内登陆失败次数超过6次将锁定10分钟,终端超时10分钟</span></span><br><span class=\"line\">VAR_LOGIN_FAIL_COUNT=6</span><br><span class=\"line\">VAR_LOGIN_FAIL_INTERVAL=300</span><br><span class=\"line\">VAR_LOGIN_LOCK_TIME=600</span><br><span class=\"line\">VAR_LOGIN_TIMEOUT=300</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Modify history record count policy</span></span><br><span class=\"line\">VAR_HISTSIZE=128</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Modify firewall policy tcp or udp port .</span></span><br><span class=\"line\">VAR_ALLOW_PORT=(<span class=\"string\">\"22,80,443,<span class=\"variable\">$&#123;VAR_SSHD_PORT&#125;</span>/tcp\"</span> <span class=\"string\">\"53/udp\"</span>)</span><br></pre></td></tr></table></figure>\n<p><br/></p>\n<h3 id=\"​-running-​-脚本使用\"><a href=\"#​-running-​-脚本使用\" class=\"headerlink\" title=\"​:running:​ 脚本使用\"></a>​:running:​ 脚本使用</h3><ul>\n<li><p>Step 1.上传到需要加固的主机服务器中，此处我上传到ubuntu用户的家目录。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">OperatingSystem\\Security&gt; scp -r .\\Ubuntu\\ ubuntu@10.20.172.152:~</span><br><span class=\"line\">ubuntu@10.20.172.152\\<span class=\"string\">'s password:</span></span><br><span class=\"line\"><span class=\"string\">Ubuntu22.04.conf                                                                      100% 2979   976.9KB/s   00:00</span></span><br><span class=\"line\"><span class=\"string\">os-base.sh                                                                            100%   14KB   5.4MB/s   00:00</span></span><br><span class=\"line\"><span class=\"string\">os-clean.sh                                                                           100% 2446     2.1MB/s   00:00</span></span><br><span class=\"line\"><span class=\"string\">os-exceptions.sh                                                                      100% 2634     2.5MB/s   00:00</span></span><br><span class=\"line\"><span class=\"string\">os-info.sh                                                                            100% 1169     1.3MB/s   00:00</span></span><br><span class=\"line\"><span class=\"string\">os-manual.sh                                                                          100% 1860     2.0MB/s   00:00</span></span><br><span class=\"line\"><span class=\"string\">os-network.sh                                                                         100% 3774     1.8MB/s   00:00</span></span><br><span class=\"line\"><span class=\"string\">os-optimize.sh                                                                        100% 7752     3.7MB/s   00:00</span></span><br><span class=\"line\"><span class=\"string\">os-security.sh                                                                        100% 23KB     5.7MB/s   00:00</span></span><br><span class=\"line\"><span class=\"string\">os-service.sh                                                                         100% 3969     2.0MB/s   00:00</span></span><br><span class=\"line\"><span class=\"string\">os-software.sh                                                                        100% 8007     3.3MB/s   00:00</span></span><br><span class=\"line\"><span class=\"string\">Ubuntu22.04-InitializeReinforce.sh                                                    100% 7989     5.0MB/s   00:00</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Step 2.登陆服务器并切换到root用户, 查看 <code>/home/ubuntu</code> 目录下上传的加固版本。</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ssh -p 22 ubuntu@10.20.172.152</span><br><span class=\"line\">ubuntu@Ubuntu-Security:~$ tree Ubuntu/</span><br><span class=\"line\">Ubuntu/</span><br><span class=\"line\">├── Readme.assets</span><br><span class=\"line\">│   ├── image-20220823143235577.png</span><br><span class=\"line\">│   └── image-20220823143354742.png</span><br><span class=\"line\">├── Readme.md</span><br><span class=\"line\">├── Ubuntu22.04-InitializeReinforce.sh</span><br><span class=\"line\">├── config</span><br><span class=\"line\">│   └── Ubuntu22.04.conf</span><br><span class=\"line\">├── example</span><br><span class=\"line\">│   └── 22.04</span><br><span class=\"line\">│       ├── 00-custom-header</span><br><span class=\"line\">│       ├── common-auth</span><br><span class=\"line\">│       ├── common-password</span><br><span class=\"line\">│       ├── issue</span><br><span class=\"line\">│       ├── issue.net</span><br><span class=\"line\">│       ├── login.defs</span><br><span class=\"line\">│       ├── profile</span><br><span class=\"line\">│       ├── resolved.conf</span><br><span class=\"line\">│       ├── sshd_config</span><br><span class=\"line\">│       └── su</span><br><span class=\"line\">└── scripts</span><br><span class=\"line\">    ├── os-base.sh</span><br><span class=\"line\">    ├── os-clean.sh</span><br><span class=\"line\">    ├── os-exceptions.sh</span><br><span class=\"line\">    ├── os-info.sh</span><br><span class=\"line\">    ├── os-manual.sh</span><br><span class=\"line\">    ├── os-network.sh</span><br><span class=\"line\">    ├── os-optimize.sh</span><br><span class=\"line\">    ├── os-security.sh</span><br><span class=\"line\">    ├── os-service.sh</span><br><span class=\"line\">    └── os-software.sh</span><br><span class=\"line\"></span><br><span class=\"line\">ubuntu@Ubuntu-Security:~$ sudo -i</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Step 3.切换root用户后进入 <code>/home/ubuntu/Ubuntu</code>，安全加固脚本存放目录，首先将所有的sh文件赋予可执行去那些，其次需要在 <code>Ubuntu22.04.conf</code> 中进行相应配置，最后运行<code>Ubuntu22.04-InitializeReinforce.sh  --start</code>即可，最后等待系统重启即可。</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /home/ubuntu/Ubuntu</span><br><span class=\"line\">chmod +x -R *</span><br><span class=\"line\">Ubuntu22.04-InitializeReinforce.sh  --start</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2022/5/20220823140038.png\" alt=\"WeiyiGeek.运行加固脚本\" title=\"\" class=\"\">\n                <p>WeiyiGeek.运行加固脚本</p>\n            </figure>\n<ul>\n<li>Step 4.中途请根据需求输入Y/N，然后等待重启即可，在重启后请注意sshd服务端口更改为20221所以此时你需要指定ssh连接端口。</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh -p 20221 ubuntu@10.20.172.152  <span class=\"comment\"># Ubuntu22.04.conf 定义的 ubuntu 初始化密码，登陆后会提示你进行更改。</span></span><br><span class=\"line\">su - root  <span class=\"comment\"># 只能有ubuntu用户切换到root用户，其它低权限以及app用户无法通过su进行用户切换</span></span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2022/5/20220823115958.png\" alt=\"WeiyiGeek.加固结果\" title=\"\" class=\"\">\n                <p>WeiyiGeek.加固结果</p>\n            </figure>\n<p>温馨提示: 如果执行到密码更新策略时，选择输入了(N) 否将不会更新其在<code>Ubuntu22.04.conf</code>脚本中定义的密码。</p>\n<p>温馨提示：脚本中默认root密码为R2022.weiyigeek.top。</p>\n<p>温馨提示: 防火墙策略只开放了80，443，22，20221等端口。</p>\n<p><br/></p>\n<p>:hammer_and_wrench: <strong>脚本视频演示:</strong></p>\n<p>[<figure class=\"image-box\">\n                <img src=\"https://www.bilibili.com/video/BV1fe4y1o7ov\" alt=\"企业网络安全-等保2.0主机安全测评之Linux-Ubuntu22.04服务器系统安全加固实践与基线系统制作](http://i2.hdslb.com/bfs/archive/a6739f92517a8cd7b0f0e7bbbd1dd610cdf9ab12.jpg)\" title=\"\" class=\"\">\n                <p>企业网络安全-等保2.0主机安全测评之Linux-Ubuntu22.04服务器系统安全加固实践与基线系统制作](http://i2.hdslb.com/bfs/archive/a6739f92517a8cd7b0f0e7bbbd1dd610cdf9ab12.jpg)</p>\n            </figure></p>\n<iframe src=\"//player.bilibili.com/player.html?bvid=BV1fe4y1o7ov&cid=813962656&page=1\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\"></iframe>\n\n<p>温馨提示: 点击上方图像进行观看视频。</p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"安全加固","path":"api/categories/安全加固.json"},{"name":"Host_Security","path":"api/categories/Host_Security.json"}],"tags":[{"name":"Linux","path":"api/tags/Linux.json"},{"name":"Ubuntu","path":"api/tags/Ubuntu.json"}]}