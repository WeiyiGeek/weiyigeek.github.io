{"title":"BIOS与UEFI介绍与使用","slug":"基础知识/操作系统/引导启动/BIOS与UEFI介绍与使用","date":"2019-07-01T05:34:30.000Z","updated":"2023-01-31T02:29:10.675Z","url":"2019/7-1-22.html","path":"api/articles/2019/7-1-22.html.json","covers":["https://img.weiyigeek.top/2019/20190702091434.png","https://img.weiyigeek.top/2019/20190702093703.png","https://img.weiyigeek.top/2019/20190702103247.png","https://img.weiyigeek.top/2019/20190702103144.png","https://img.weiyigeek.top/2019/20190702115000.png","https://img.weiyigeek.top/2019/20190702115336.png","https://img.weiyigeek.top/2019/20190702115447.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-快速入门\"><a href=\"#0x00-快速入门\" class=\"headerlink\" title=\"0x00 快速入门\"></a>0x00 快速入门</h4><p>描述:英特尔已经宣布计划<code>在2020年之前将所有芯片组完全替换为UEFI</code>,所以说BIOS即将迎来生命周期的最后一个周期;但是我们现在UEFI附带的新电脑仍将其称为“BIOS”,符合用户的叫法;</p>\n<p>2007年，英特尔，AMD，微软和PC制造商就新的统一可扩展固件接口(UEFI)规范达成一致。 这是一个全行业标准管理的统一扩展固件接口，并不完全由英特尔推动。</p>\n<p>UEFI和BIOS都是<code>低级软件</code>，所谓低级软件就是指它们会在引导操作系统之前启动时启动，但UEFI是更现代的解决方案，<code>支持更大的硬盘驱动器，更快的启动时间</code>，更多的安全功能以及方便的图形和鼠标游标。</p>\n<p>说到操作系统的引导就不得不提到操作系统的文件系统，为下面的知识进行一个扩展；</p>\n<p><strong>File System</strong><br>File System（文件系统）是存储媒介中文件存储的组织方式。</p>\n<ul>\n<li>不同的文件系统类型有不同的速度，灵活性，安全性和占用空间。</li>\n<li>不同操作系统只支持特定的文件系统类型。<br>常见的文件系统类型有 FAT16，FAT32，NTFS，EXT3，EXT4，HFS, xfs 等。</li>\n</ul>\n<p><br></p>\n<h5 id=\"BIOS\"><a href=\"#BIOS\" class=\"headerlink\" title=\"BIOS\"></a>BIOS</h5><p><em>什么是BIOS?</em><br>答: BIOS 英文全称(Basic Input Output System)即基本输入输出系统,它是位于计算机主板上的芯片中的低级软件且已经存在很长时间了，计算机启动时BIOS加载，BIOS负责唤醒计算机的硬件组件，确保它们正常运行然后运行引导加载程序来引导Windows或任何其他已安装的操作系统。并且可以在BIOS设置屏幕中配置各种设置。诸如计算机硬件配置，系统时间和引导顺序等;<br>启动流程：</p>\n<ul>\n<li>开机-POST或者开启自检-查找引导设备上存储的主引导记录和MBR-加载BootLoader-进入系统</li>\n</ul>\n<p>局限性：</p>\n<ul>\n<li>只能从2.1TB或更少的驱动器启动,<code>限制是由于BIOS的主引导记录(MBR分区)系统的工作方式</code>。</li>\n<li>必须以16位处理器模式运行，并且只有1 MB空间可供执行,导致<code>初始化多个硬件设备时会出现问题</code>,所以就是单项单项检查导致启动时间较慢;</li>\n</ul>\n<p>补充：CMOS缩写代表互补金属氧化物半导体,指BIOS在主板上存储各种设置的以电池供电的存储器，在现代系统中这种方法已被闪存(也称为EEPROM)取代</p>\n<p>传统启动方式：即是我们所说的 Legacy 模式</p>\n<p><br></p>\n<h5 id=\"UEFI\"><a href=\"#UEFI\" class=\"headerlink\" title=\"UEFI\"></a>UEFI</h5><p><em>什么是UEFI？</em><br>答: UEFI（Unified Extensible Firmware Interface ）即通一扩展引导接口,它还以更标准化的方式引导启动EFI可执行文件，而不是从驱动器的主引导记录运行代码。</p>\n<p>特点：</p>\n<ul>\n<li>UEFI支持图形化操作包括图形和鼠标光标支持</li>\n<li>启动时间大幅缩短</li>\n<li>支持更大硬盘驱动器(2.1TB以上),理论限制为9.4ZB zettabytes</li>\n<li>UEFI可以以32位或64位模式运行，并具有比BIOS更多的可寻址地址空间，<code>意味着您的引导过程更快/BIOS设置更加清晰</code></li>\n<li>支持安全启动可以检查操作系统的有效性，以确保没有恶意软件篡改引导进程。</li>\n<li>UEFI固件本身支持网络功能<code>有助于进行远程故障排除和配置</code></li>\n</ul>\n<p><br></p>\n<p><em>常见组合：</em></p>\n<ul>\n<li>UEFI + GPT(分区)启动方案</li>\n<li>BIOS + MBR(分区)启动方案</li>\n</ul>\n<p><em>硬盘的分区结构：</em></p>\n<ul>\n<li>MBR分区表：Master Boot Record即硬盘主引导记录分区表，只支持容量在 2.1TB 以下的硬盘只能管理2.1TB，最多只支持4个主分区或三个主分区和一个扩展分区，扩展分区下可以有多个逻辑分区。 </li>\n<li>GPT分区表：GPT全局唯一标识分区表(GUID Partition Table)，与MBR最大4个分区表项的限制相比，GPT对分区数量没有限制，但Windows最大仅支持128个GPT分区，GPT可管理硬盘大小达到了18EB。<code>只有基于UEFI平台的主板才支持GPT分区引导启动</code>。 </li>\n<li>ESP分区：EFI system partition分区用于采用了EFI BIOS的电脑系统用来启动操作系统。<code>分区内存放引导管理程序、 驱动程序、系统维护工具等</code>。如果电脑采用了EFI系统或当前磁盘用于在EFI平台上启动操作系统，<code>建议ESP分区为FAT16格式，容量最好大于100M，无其他特殊要求</code>。</li>\n<li>MSR分区：即微软保留分区，是GPT磁盘上用于保留空间以备用的分区，例如在将磁盘转换为动态磁盘时需要使用这些 分区空间。 </li>\n</ul>\n<p><em>UEFI启动为什么那么快？</em><br>UEFI相比传统的启动方式少了一个启动时候自检的过程,所以启动时间大幅度缩短；<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190702091434.png\" alt=\"WeiyiGeek.启动流程\" title=\"\" class=\"\">\n                <p>WeiyiGeek.启动流程</p>\n            </figure></p>\n<p><br></p>\n<h5 id=\"对比补充\"><a href=\"#对比补充\" class=\"headerlink\" title=\"对比补充\"></a>对比补充</h5><p><strong>BIOS vs UEFI</strong><br>BIOS（Basic Input/Output System）和 UEFI（Unified Extensible Firmware Interface ）是不同的计算机启动固件（Fireware），需要硬件（通常为主板）支持，相互代替的，其中 UEFI 是比较新的方式。</p>\n<ul>\n<li><p>BIOS<br>经典的启动固件，会调用磁盘的 MBR，然后由 MBR 中的 loader 继续加载操作系统。</p>\n</li>\n<li><p>UEFI<br>UEFI 用来代替 BIOS，并克服 BIOS 的缺点，大多数的 UEFI 固件会提供兼容 BIOS 的启动方式。</p>\n</li>\n</ul>\n<p><br></p>\n<p><strong>MBR vs GPT</strong><br>描述：MBR 与 GPT 用于存储硬盘的分区信息，是不同的<code>硬盘分区表类型</code>。</p>\n<ul>\n<li>MBR<br>MBR 表示 MBR 分区表，MBR 分区表在硬盘开头处存放了特殊的启动分区，称为 MBR（Master Boot Record，主启动记录），包含 Boot Loader 和硬盘逻辑分区。MBR 支持最大约2T的硬盘，最多能划分4个主分区，更多分区需要使用拓展分区实现。<br>（MBR在行文中可以表示 MBR 分区表和主启动记录两个意思，注意甄别。）</li>\n<li>GPT<br>GPT 表示 GUID（Globally Unique Identifier） 分区表，是 UEFI 规范的一部分，用于替换 MBR 的分区方式。GPT 没有分区数和分区大小限制。<br><br></li>\n</ul>\n<p><br></p>\n<p><strong>简单描述磁盘发展史</strong><br>Wikipedia 上有许多关于磁盘的资料，在磁盘分区上，我猜测的发展脉络是这样的：</p>\n<ul>\n<li>1.磁盘跟内存一样直接物理寻址去访问数据；</li>\n<li>2.为了方便，建立数据 Index，有了 File System；</li>\n<li>3.需要多个分区，搞出了 Partition Tabel。</li>\n</ul>\n<p><em>注意事项:</em></p>\n<ul>\n<li>(1) 磁盘分区表类型与磁盘文件系统类型不是同一个事物，前者是比如指代 MBR/GPT 分区类型。后者指代NTFS；</li>\n<li>(2) BIOS/UEFI 跟 MBR/GPT 是不同层级的，BIOS/UEFI 是 Fireware，MBR/GPT 是分区表。</li>\n<li>(3) Windows 通常会要求 UEFI 的启动方式使用 GPT，不然不给继续安装。推荐的使用方式： BIOS + MBR 或 UEFI + GPT：</li>\n</ul>\n<hr>\n<h4 id=\"0x01-设置传统与UEFI模式\"><a href=\"#0x01-设置传统与UEFI模式\" class=\"headerlink\" title=\"0x01 设置传统与UEFI模式\"></a>0x01 设置传统与UEFI模式</h4><p>描述:我们需要进入BIOS或者主板启动进行设置：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#老机器引导配置 (不启动UEFI)</span></span><br><span class=\"line\">Fast Boot : Enabled</span><br><span class=\"line\">Launch CSM : Disabled</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#新机器（启用UEFI）</span></span><br><span class=\"line\">UEFI/Legacy Boot: UEFI BIOS</span><br><span class=\"line\">SECURE BOOT :Disabled  <span class=\"comment\">#关闭才能从U盘启动，Windows 8 中增加了一个新的安全功能,Secure Boot内置于UEFI BIOS中,用来对抗感染MBR、BIOS的恶意软件</span></span><br><span class=\"line\"><span class=\"comment\">#Windows 8 缺省将使用Secure Boot,在启动过程中，任何要加载的模块必须签名(强制的)，UEFI固件会进行验证， 没有签名或者无法验证的，将不会加载。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#其他方式</span></span><br><span class=\"line\">比如在Windows8以上可能需要通过Windows启动选项菜单访问UEFI设置屏幕，而不是在计算机启动时按下某个键;</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190702093703.png\" alt=\"WeiyiGeek.UEFI\" title=\"\" class=\"\">\n                <p>WeiyiGeek.UEFI</p>\n            </figure></p>\n<p>Auto(自动)/Both：自动按照启动设备列表中的顺序启动<code>优先采用UEFI方式</code>；<br>UEFI only(仅UEFI)：只选择具备UEFI启动条件的设备启动全新的启动模式<br>Legacy only(仅Legacy)：只选择具备Legacy启动条件的设备启动最传统的模式<br>CSM选项：<code>兼容模块</code>专为兼容只能在legacy模式下工作的设备以及不支持或不能完全支持UEFI的操作系统而设置(老显卡、老设备)</p>\n<p>传统BIOS模式启动引导修复：</p>\n<ul>\n<li>NTbootAutoFix引导修复工具</li>\n</ul>\n<p>流行UEFI模式启动引导修复：（需要进入UEFI模式的PE）</p>\n<ul>\n<li>UEFix(UEFI 引导修复)</li>\n<li>BOOTICE 编辑器（注意需先挂载:ESP分区）</li>\n<li>Linux 系统 UEFI 编辑工具 efibootmgr</li>\n</ul>\n<p><strong>传统BIOS引导模式改为UEFI引导模式并修复流程</strong></p>\n<p>0.对已有磁盘进行调整分区大小，将磁盘的两端各留1GB的空闲空间；</p>\n<p>1.转换该磁盘的分区表类型为GUID格式并且保存</p>\n<p>2.选择前面的1GB的空闲分区，右键再选择”建立ESP（300MB）/MSR分区”，并且格式化分区；</p>\n<pre><code>- ESP分区（UEFI System Partition）：用于才有UEFI BIOS的电脑系统来启动操作系统；分区内存存放 `引导管理程序，驱动程序，系统维护工具等等`\n- MSR分区（微软保留分区）是GPT磁盘上用于保留空间以备用的分区；例如在将磁盘转换成为冬天磁盘时候会采用这些空间；\n</code></pre><p>3.给ESP分区分配盘符，然后打开UEFI的 引导修复文件；选择刚刚分配的ESP分区的盘符，然后在选择”开始修复”，选择Window目录</p>\n<p><em>注意事项：</em></p>\n<ul>\n<li>尽量不要选择自动模式，因为在确定自己的启动方式后，安装系统所用的U盘，甚至硬盘引导都要配套</li>\n<li>VMware设置客户端操作系统 版本可以影响引导启动: <code>虚拟机设置 -&gt; 常规 - &gt; 选择客户端操作系统</code></li>\n<li>VMware 修改固件类型（支持UEFI）：<code>虚拟机设置 -&gt; 选项 -&gt; 高级 -&gt; 固件类型进行选择</code>；</li>\n</ul>\n<p><hr/></p>\n<h4 id=\"0x02-设置U盘引导\"><a href=\"#0x02-设置U盘引导\" class=\"headerlink\" title=\"0x02 设置U盘引导\"></a>0x02 设置U盘引导</h4><p>Step1.下载PE工具箱并生成引导ISO文件：<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190702103247.png\" alt=\"WeiyiGeek.生成PE引导箱\" title=\"\" class=\"\">\n                <p>WeiyiGeek.生成PE引导箱</p>\n            </figure></p>\n<p>Step2.采用软媒魔方得USB引导制作工具：<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190702103144.png\" alt=\"WeiyiGeek.多PE系统引导\" title=\"\" class=\"\">\n                <p>WeiyiGeek.多PE系统引导</p>\n            </figure></p>\n<hr>\n\n<h4 id=\"0X03-引导修复\"><a href=\"#0X03-引导修复\" class=\"headerlink\" title=\"0X03 引导修复\"></a>0X03 引导修复</h4><p><em>UEFI引导基本原理：</em></p>\n<ul>\n<li><p>efi文件结构</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#注意需要先挂载ESP分区</span></span><br><span class=\"line\">efi\\boot\\bootx64.efi</span><br><span class=\"line\">efi\\microsoft\\boot\\bcd</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>efi启动过程 ：UEFI-BIOS启动时候自动查找硬盘下ESP分区的bootx64.efi,然后又bootx64.efi引导下的BCD文件,由BCD引导指定系统文件c:\\windows\\system32\\winload.efi</p>\n</li>\n</ul>\n<p><br></p>\n<p><em>(1)采用BCDboot自动修复：</em><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#(1)指定esp分区修复环境为64位8PE，bios/uefi启动进入下都可以</span></span><br><span class=\"line\">Step1.启动64位8PE，并用esp分区挂载器或diskgenuis挂载esp分区</span><br><span class=\"line\">Step2.打开cmd命令行，输入以下命令并运行</span><br><span class=\"line\"><span class=\"variable\">$bcdboot</span> c:\\windows /s o: /f uefi /l zh-cn</span><br><span class=\"line\"><span class=\"comment\"># 其中：c:\\windows  硬盘系统目录，根据实际情况修改</span></span><br><span class=\"line\"><span class=\"comment\"># /s o:     指定esp分区所在磁盘，根据实际情况修改</span></span><br><span class=\"line\"><span class=\"comment\"># /f uefi   指定启动方式为uefi</span></span><br><span class=\"line\"><span class=\"comment\"># /l zh-cn  指定uefi启动界面语言为简体中文</span></span><br><span class=\"line\"><span class=\"comment\"># 注：64位7PE不带/s参数，故7PE不支持bios启动下修复</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(2)不指定esp分区修复</span></span><br><span class=\"line\"><span class=\"comment\">#\\环境为64位7或8PE，只有uefi启动进入PE才可以不用挂载esp分区，直接在cmd命令行下执行：</span></span><br><span class=\"line\">bcdboot c:\\windows /l zh-cn</span><br><span class=\"line\"><span class=\"comment\"># 其中 c:\\windows  硬盘系统目录，根据实际情况修改</span></span><br><span class=\"line\"><span class=\"comment\"># /l zh-cn  指定uefi启动界面语言为简体中文</span></span><br><span class=\"line\"><span class=\"comment\"># 注：在8PE中我们也可以在uefi启动进入pe后，挂载esp分区用方法</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><em>(2)采用BOOTICE进行UEFI修复</em><br>Step1.打开diskgenius软件有没有这两个分区：ESP和MSR如果没有需要建立并进行挂载;<br>Step2.打开BOOTICE引导管理,1.选择：BCD编辑2.点：其它BCD文件3.点引号内“…”打开<br>Step3.找到ESP分区盘符efi&gt;microsoft&gt;boot&gt;BCD打开BCD<br>Step4.找到后找智能编辑,如果没有启动项就需要添加新建引导保存当前系统设置，如果有则跳过<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190702115000.png\" alt=\"WeiyiGeek.智能编辑\" title=\"\" class=\"\">\n                <p>WeiyiGeek.智能编辑</p>\n            </figure><br>Step5.设置启动设备、属性等,启动分区就是系统安装的分区;<br>Step6.UEFI再点修改启动顺序:<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190702115336.png\" alt=\"WeiyiGeek.UEFI\" title=\"\" class=\"\">\n                <p>WeiyiGeek.UEFI</p>\n            </figure></p>\n<ul>\n<li>1.点：Windows boot manager（这个就是Windows启动项）。</li>\n<li>2.启动分区：选择ESP盘符。</li>\n<li>3.启动文件：\\EFI\\Microsoft\\Boot\\bootmgfw.efi，如果不是，把这串路径复制到红框3内。</li>\n<li>4.点：保存当前启动设置，最好把“下一次启动该项”打勾。<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190702115447.png\" alt=\"WeiyiGeek.bootManager\" title=\"\" class=\"\">\n                <p>WeiyiGeek.bootManager</p>\n            </figure>\n</li>\n</ul>\n<p>补充：uefi添加修复启动项设置完毕，如果是双系统需要添加启动项(安装上述即可),在修复UEFI的时候必须进入UEFI模式;<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">控制启动管理器: bcdedit  </span><br><span class=\"line\">主启动代码更新: bootsect  </span><br><span class=\"line\">启动文件修复：bcdboot</span><br></pre></td></tr></table></figure></p>\n<p><em>其它问题：</em></p>\n<ul>\n<li>1.手工运行ghost并不会修复esp分区</li>\n<li>2.用老大们的一键还原，现在慢慢加上了还原后esp引导修复功能，如实测深山的一键还原就自带esp分区uefi引导修复</li>\n<li>3.用微软原版系统光盘安装或PE下安装，当然都会自动修复esp引导。</li>\n</ul>\n<p><hr/></p>\n<h4 id=\"0x0n-补充参考\"><a href=\"#0x0n-补充参考\" class=\"headerlink\" title=\"0x0n 补充参考\"></a>0x0n 补充参考</h4><p>推荐工具：</p>\n<ul>\n<li>it天空：<a href=\"https://www.itsk.com\" target=\"_blank\" rel=\"noopener\">https://www.itsk.com</a></li>\n<li>u盘魔术师 ： <a href=\"https://www.sysceo.com\" target=\"_blank\" rel=\"noopener\">https://www.sysceo.com</a></li>\n<li>WePe ： <a href=\"http://www.wepe.com.cn/\" target=\"_blank\" rel=\"noopener\">http://www.wepe.com.cn/</a></li>\n<li>软媒魔方：<a href=\"https://mofang.ruanmei.com/\" target=\"_blank\" rel=\"noopener\">https://mofang.ruanmei.com/</a></li>\n</ul>\n<p>注意WePE安装至开机启动项详细规格:<a href=\"http://www.wepe.com.cn/learnmore.html\" target=\"_blank\" rel=\"noopener\">http://www.wepe.com.cn/learnmore.html</a></p>\n<ul>\n<li>Legacy启动时：可安装到32和64位系统开机启动项</li>\n<li>EFI启动时：只可安装到64位系统开机启动项,支持PE密码最长16位</li>\n</ul>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"基础知识","path":"api/categories/基础知识.json"}],"tags":[{"name":"引导启动","path":"api/tags/引导启动.json"}]}