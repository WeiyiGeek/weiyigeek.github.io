{"title":"1.Docker学习之基础知识","slug":"虚拟云容/云容器/Docker/1.Docker学习之基础知识","date":"2019-05-03T06:36:30.000Z","updated":"2022-09-27T14:25:52.216Z","url":"2019/5-3-455.html","path":"api/articles/2019/5-3-455.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190512195606.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190505125747.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190505131546.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190512200307.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200630214626.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190512200931.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200617143711.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190506104434.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190506111731.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190505215320.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190505215652.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190505215706.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190505215804.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190505215933.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200716151445.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211209115713.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190505220335.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20191119225356.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190506114446.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190506150159.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190506161441.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190505225957.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-Docker-快速入门\"><a href=\"#0x00-Docker-快速入门\" class=\"headerlink\" title=\"0x00 Docker 快速入门\"></a>0x00 Docker 快速入门</h4><h5 id=\"1-Docker-基础介绍\"><a href=\"#1-Docker-基础介绍\" class=\"headerlink\" title=\"1.Docker 基础介绍\"></a>1.Docker 基础介绍</h5><p>描述:Docker [ˈdɑ:kə(r)] 是一个基于Go语言开发实现的遵循Apache 2.0协议开源项目,目标是实现轻量级的操作系统虚拟化解决方案；<br>,诞生于2013年初最初发起者是dotCloud公司创始人 Solomon Hykes 在法国期间发起的一个公司内部项目,后续由于docker的发展后来也改名为Docker Inc,它是仅次于OpenStack最受欢迎的云计算开源项目;Docker 从 17.03版本之后分为 CE（Community Edition） 和 EE（Enterprise Edition）</p>\n<p>Docker 的目标是”<code>Build,Ship and Run Any App,Anywhere</code>“,通过对应用组件的封装<code>\\[Packaging]-&gt; 分发\\[Distribution] -&gt; 部署\\[Deployment] -&gt; 运行\\[Runtime]</code>等生命周期进行管理,达到应用级别”<code>一次封装,到处运行</code>“;<br>例如：它可以独立运行一个Web应用,也可以是一套数据库服务,甚至是一个操作系统或编译器;</p>\n<p>Apache 2.0 授权 Github 项目开源 : <a href=\"https://github.com/docker/docker\" target=\"_blank\" rel=\"noopener\">https://github.com/docker/docker</a></p>\n<p><br/></p>\n<p><em>Docker与OpenStack的区别？</em></p>\n<ul>\n<li>部署难度：Docker非常简单;OpenStack组件多部署繁琐</li>\n<li>启动速度：秒级;分钟级</li>\n<li>执行性能：和物理机几乎是一致;VM会占用一些资源</li>\n<li>镜像体积：镜像是MB级别的;虚拟机镜像是GB级别的</li>\n<li>管理效率：关键简单;组件相互依赖且管理复杂</li>\n<li>隔离性：隔离性高;彻底隔离</li>\n<li>可管理性：单进程;完整的系统管理</li>\n<li>网络连接：比较弱;借助于Neutron可以灵活组件各类网络架构</li>\n</ul>\n<p><br/></p>\n<p>完整的Docker由以下几部分构成:</p>\n<ul>\n<li>(1) 守护进程(Daemon)：Docker守护进程(dockerd)侦听Docker API请求并管理Docker对象,<code>可以与客户端在同一个节点或者运行在不同节点上</code>，如图像、容器、网络和卷。守护进程还可以与其他守护进程通信来管理Docker服务。</li>\n<li>(2) REST API: 主要与Docker Daemon进行交互，比如Docker Cli或者直接调用REST API；</li>\n<li>(3) 客户端(Docker Client): 它是与Docker交互的主要方式通过命令行接口(CLI)客户端(docker命令)，客户机将命令通过REST API发送给<code>守护进程dockerd</code>并执行其命令；(<code>注意:一个客户端可以与多个守护进程通信</code>)</li>\n<li>(4) Register Repository 镜像仓库: Docker注册表存储Docker镜像，可以采用Docker Hub是公共注册仓库，或者采用企业内部自建的Harbor私有仓库;</li>\n<li>(5) Image 镜像: 映像是一个只读模板，带有创建Docker容器的指令。映像通常基于另一个映像，还需要进行一些额外的定制，你可以通过Docker Hub公共镜像仓库进行拉取对应的系统或者应用镜像;</li>\n<li>(6) Container 容器: 容器是映像的可运行实例。您可以使用Docker API或CLI创建、启动、停止、移动或删除容器。您可以将一个容器连接到一个或多个网络，将存储附加到它，甚至根据它的当前状态创建一个新映像。</li>\n<li>(7) Services : Docker引擎支持集群模式服务允许您跨多个Docker守护进程(<code>一个群的每个成员都是一个Docker守护进程</code>)扩展管理容器，服务允许您定义所需的状态，例如在任何给定时间必须可用的服务副本的数量。默认情况下，服务在所有工作节点之间进行负载平衡。对于使用者来说Docker服务看起来是一个单独的应用程序；</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190512195606.png\" alt=\"WeiyiGeek.引擎图\" title=\"\" class=\"\">\n                <p>WeiyiGeek.引擎图</p>\n            </figure>\n<p><br></p>\n<p><em>Linux容器基础之LXC技术介绍：</em></p>\n<p>描述:Docker引擎的基础是Linux容器(Linux Containers,LXC)技术,容器有效的将各个操作系统管理的资源划分到孤立的组,以便更好的在孤立的组之间平衡有冲突的资源使用需求。<br>容器可以在核心CPU本地运行指令,并不需要任何专门的解释机制;最早的容器技术可以追溯到1982年Unix系列操作系统上的chroot工具;用户操作容器就像操作一个轻量级虚拟机那样简单,也可以将容器比作为一种沙盒(Sandbox);</p>\n<p><br></p>\n<p><em>Docker 优势：</em></p>\n<ul>\n<li>1.更高效的利用系统资源：Docker容器不需要进行硬件虚拟以及运行完整操作系统等额外开销(资源远远小于虚拟机);</li>\n<li>2.更快速的启动时间：直接运行于宿主内核无需启动完整的操作系统,可以做到秒级、甚至毫秒级的启动时间;</li>\n<li>3.更快速的交付和部署:实现持续集成(Continuous Integration)、持续交付、自动部署(Continuous Delivery/Deployment),大量节约开发,测试,部署的时间;</li>\n<li>4.更高效的资源利用:不需要额外的虚拟化管理程序VMM以及Hypervisor的支持;</li>\n<li>5.更容易学习、迁移和扩展:一致的运行环境Docker 可以在很多平台上运行无论是物理机、虚拟机、公有云、私有云</li>\n<li>6.更简单的更新管理:使用Dockerfile只需要小小的配置修改,可以快速创建和删除容器,Docker hub 提供镜像平台方便共享镜像;</li>\n<li>7.基于 Docker 的 CI 持续集成和 CD 持续支付</li>\n<li>8.基于 Kubernetes, Docker Swarm 的集群弹性扩容和缩容</li>\n</ul>\n<p><em>什么是虚拟化技术?</em><br>虚拟化技术是一个通用的概念,在不同的领域有不同的理解;在计算机领域一般指的是计算机虚拟化(Computer Virtualization)或者说是服务器虚拟化;虚拟化的核心是对资源进行抽象和管理,目标往往是为了在同一个主机上运行多个系统或者应用,从而提高系统资源的利用率,同时带来降低成本,方便管理和容错和容灾等好处;</p>\n<ul>\n<li>硬件虚拟化:真正意义上的基于它的技术不多见,少数网卡中的单根多IO虚拟化等技术;</li>\n<li>软件虚拟化(Virtualization)<ul>\n<li>1.应用虚拟化</li>\n<li>2.平台虚拟化:细分<ul>\n<li>2.1 完全虚拟化</li>\n<li>2.2 硬件辅助虚拟化:利用硬件CPU辅助支持虚拟化技术Intel-VT和AND-V处理铭感指令来实现完全虚拟化的功能;</li>\n<li>2.3 部分虚拟化:只对部分硬件资源进行虚拟化,客户端系统需要进行修改;</li>\n<li>2.4 准虚拟化(Paravirtualization):如xen</li>\n<li>2.5 操作系统级虚拟化:内核通过创建多个虚拟化的操作系统实例内核和库来隔离不同的进程,dokcer以及其他容器都在这个范畴之内;</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p><em>传统虚拟机的比较：</em></p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190505125747.png\" alt=\"WeiyiGeek.传统对比\" title=\"\" class=\"\">\n                <p>WeiyiGeek.传统对比</p>\n            </figure>\n<p><br></p>\n<p><em>传统虚拟化方式与Docker虚拟化方式</em></p>\n<ul>\n<li>传统虚拟化方式是在硬件层面实现虚拟化,需要有额外的虚拟机管理应用和虚拟机操作系统层，然后在该系统上运行业务所需程序;</li>\n<li>Docker虚拟化方式是在宿主系统层面上实现虚拟化,直接复用本地主机的操作系统与内核，容器内没有自己的内核，所以容器内的应用进程实际运行于宿主机内核,因此更加轻量级;</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190505131546.png\" alt=\"WeiyiGeek.Docker\" title=\"\" class=\"\">\n                <p>WeiyiGeek.Docker</p>\n            </figure>\n<ul>\n<li>虚拟机是为提供系统环境而生，容器是为了提供应用环境而生的；<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190512200307.png\" alt=\"WeiyiGeek.VM对比\" title=\"\" class=\"\">\n                <p>WeiyiGeek.VM对比</p>\n            </figure>\n</li>\n</ul>\n<p><br></p>\n<p><em>物理机-虚拟机-Docker容器容易理解的对比</em></p>\n<ul>\n<li>一栋楼一户人家,独立地基独立花园(别墅)</li>\n<li>一栋楼包含多套房,一套房一户人家,共享地基、共享花园、独立卫生间、厨房和宽度(二室一厅)</li>\n<li>一套房隔成多个小隔间,每个小隔间住一位租户(胶囊式公寓)</li>\n</ul>\n<p><br></p>\n<p><em>Docker 应用场景</em></p>\n<ul>\n<li>使用docker容器开发、测试、部署服务:自动化测试和持续集成、发布;</li>\n<li>在服务型环境中部署与扩展Webapp以及调整数据库或其他应用;</li>\n<li>统一、优化和加速本地开发和构建流程;创建隔离的运行环境,测试环境</li>\n<li>构建多用户的平台即服务(PaaS)基础设施</li>\n<li>提供软件即服务(SaaS)的应用程序</li>\n<li>高性能、超大规模的宿主机部署,web应用的自动化打包和发布</li>\n</ul>\n<p><br></p>\n<h5 id=\"2-Docker-架构\"><a href=\"#2-Docker-架构\" class=\"headerlink\" title=\"2.Docker 架构\"></a>2.Docker 架构</h5><p>描述:Docker对使用者来讲是一个C/S模式(使用客户机-服务器)的架构而Docker的后端是一个非常松耦合的架构,模块各司其职并有机组合支撑Docker的运行。</p>\n<p>具体流程:</p>\n<ul>\n<li>(1) 用户使用Docker客户机与Docker守护进程通信，后者负责构建、运行和分发Docker容器等繁重的工作。</li>\n<li>(2) Docker Daemon作为Docker架构中的主体部分,首先提供Server的功能使其可以接受Docker Client的请求；</li>\n<li>(3) Docker客户端和守护进程可以运行在同一个系统上，或者您可以将一个Docker客户端连接到一个远程Docker守护进程。</li>\n<li>(4) Docker客户机和守护进程之间通过<code>UNIX套接字</code>或网络接口<code>使用REST API进行通信</code>。</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200630214626.png\" alt=\"WeiyiGeek.架构\" title=\"\" class=\"\">\n                <p>WeiyiGeek.架构</p>\n            </figure>\n<p><br></p>\n<p>Docker 内部具体实现:</p>\n<ul>\n<li>Engine执行Docker内部的一系列工作,每一项工作都是以一个Job的形式的存在。</li>\n<li>Job的运行过程中,当需要容器镜像时,则从Docker Registry中下载镜像,并通过镜像管理驱动graphdriver将下载镜像以Graph的形式存储；</li>\n<li>当需要为Docker创建网络环境时,通过网络管理驱动networkdriver创建并配置Docker容器网络环境；</li>\n<li>当需要限制Docker容器运行资源或执行用户指令等操作时,则通过execdriver来完成。</li>\n<li>libcontainer是一项独立的容器管理包,networkdriver以及execdriver都是通过libcontainer来实现具体对容器进行的操作。</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190512200931.png\" alt=\"WeiyiGeek.组件架构图\" title=\"\" class=\"\">\n                <p>WeiyiGeek.组件架构图</p>\n            </figure>\n<p><br></p>\n<h5 id=\"3-Docker-资源隔离\"><a href=\"#3-Docker-资源隔离\" class=\"headerlink\" title=\"3.Docker 资源隔离\"></a>3.Docker 资源隔离</h5><p>Docker 本质是宿主机上的一个进程,docker通过namespace实现资源隔离以及轻量级虚拟化容器服务,通过cgroup实现了资源限制,通过写时复制技术(Copy-on-write)实现了高效的文件操作;</p>\n<p>Docker通过由内核namespace提供实现的隔离，namespace的API包括<code>clone(),sents()以及unshare()</code>还有在/proc下的部分文件</p>\n<ul>\n<li>文件系统隔离：每个容器都有自己的 root 文件系统</li>\n<li>进程隔离：每个容器都运行在自己的进程环境中</li>\n<li>网络隔离：容器间的虚拟网络接口和 IP 地址都是分开的</li>\n<li>资源隔离和分组：使用 cgroups 将 CPU 和内存之类的资源独立分配给每个 Docker 容器</li>\n</ul>\n<p>即namespace的六项隔离(<code>内核实现 namespace 资源隔离内容 - 系统调用参数</code>)如下标所示:</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">名称</th>\n<th style=\"text-align:left\">宏定义</th>\n<th style=\"text-align:left\">隔离的内容</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">IPC</td>\n<td style=\"text-align:left\">CLONE_NEWIPC</td>\n<td style=\"text-align:left\">System V IPC, POSIX message queues (since Linux 2.6.19) 信号量消息队列和共享内存</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">NETWORK</td>\n<td style=\"text-align:left\">CLONE_NEWNET</td>\n<td style=\"text-align:left\">network device interfaces, IPv4 and IPv6 protocol stacks, IP routing tables, firewall rules, the /proc/net and /sys/class/net directory trees, sockets, etc (since Linux 2.6.24)  网络设备,网络栈,端口等</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">MOUNT</td>\n<td style=\"text-align:left\">CLONE_NEWNS</td>\n<td style=\"text-align:left\">Mount points (since Linux 2.4.19) 挂载点(文件系统)</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">PID</td>\n<td style=\"text-align:left\">CLONE_NEWPID</td>\n<td style=\"text-align:left\">Process IDs (since Linux 2.6.24)  进程编号</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">User</td>\n<td style=\"text-align:left\">CLONE_NEWUSER</td>\n<td style=\"text-align:left\">User and group IDs (started in Linux 2.6.23 and completed in Linux 3.8) 用户和用户组(3.8后内核支持)</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">UTS</td>\n<td style=\"text-align:left\">CLONE_NEWUTS</td>\n<td style=\"text-align:left\">Hostname and NIS domain name (since Linux 2.6.19)    主机名与域名(自Linux 2.6.19)</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Cgroup</td>\n<td style=\"text-align:left\">CLONE_NEWCGROUP</td>\n<td style=\"text-align:left\">Cgroup root directory (since Linux 4.6)     Cgroup根目录(自Linux 4.6)</td>\n</tr>\n</tbody>\n</table>\n<p><br></p>\n<p><em>cgroup的特点与功能：</em></p>\n<ul>\n<li>cgroup的API以一个伪文件系统来实现的,用户态的程序通过文件操作实现cgroup的组织管理;</li>\n<li>cgroup的组织管理操作单元可以细粒度级别,另外用户可以创建和销毁cgroup,从而实现资源再分配和利用;</li>\n<li>所有资源管理的功能都以子吸引的方式实现接口统一,子任务创建之初与其父任务处于同一cgroup的控制组;</li>\n<li>cgroup四大功能：资源限制(资源总额进行限制),优先级分配(分配CPU时间片数量以及磁盘IO带宽大小),资源统计(CPU时长/内存用量),任务控制(执行挂起/恢复等操作);</li>\n</ul>\n<p><br></p>\n<h5 id=\"4-Docker-容器文件系统\"><a href=\"#4-Docker-容器文件系统\" class=\"headerlink\" title=\"4.Docker 容器文件系统\"></a>4.Docker 容器文件系统</h5><p>描述:从下面的图片可以看见出以下几点：</p>\n<ul>\n<li>Docker 镜像代表了容器的文件系统里的内容，是容器的基础，镜像一般是通过 Dockerfile 生成的；</li>\n<li>Docker 的镜像是分层的，所有的镜像（除了基础镜像）都是在之前镜像的基础上加上自己这层的内容生成的;</li>\n<li>Docker 中每一层镜像的元数据都是存在 json 文件中的，除了静态的文件系统之外，还会包含动态的数据;</li>\n<li>Docker 镜像生产容器后会在此基础之上加入挂载点到安装Docker宿主机文件系统之中，并提供一个读写层(Read-Write Layer)，所以容器进程的所有操作都在读写层进行;</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200617143711.png\" alt=\"WeiyiGeek.容器文件系统\" title=\"\" class=\"\">\n                <p>WeiyiGeek.容器文件系统</p>\n            </figure>\n<p><em>总结:</em> </p>\n<ul>\n<li>Docker通过为Linux容器技术提供更简洁的使用和管理方案、更高效的版本控制,Docker 让容器技术一下子变得灵活易用,随着云计算(Cloud Computing)的发展,它在Virtualization中的地位越来越重要.</li>\n<li>四大核心概念：<code>镜像 [image] / 容器 [Container] / 仓库 [Repository] / Dockerfile</code></li>\n</ul>\n<p>参考书籍:Docker技术入门与实战</p>\n<hr>\n\n<h4 id=\"0x01-Docker-安装实践\"><a href=\"#0x01-Docker-安装实践\" class=\"headerlink\" title=\"0x01 Docker 安装实践\"></a>0x01 Docker 安装实践</h4><h5 id=\"1-Linux-系统安装\"><a href=\"#1-Linux-系统安装\" class=\"headerlink\" title=\"1.Linux 系统安装\"></a>1.Linux 系统安装</h5><p>系统环境：Docker最低支持CentOS7且在64位平台上并且内核版本在3.10以上的Linux操作系统。<br>官方安装文档：<a href=\"https://docs.docker.com/install/linux/docker-ce/centos/#\" target=\"_blank\" rel=\"noopener\">https://docs.docker.com/install/linux/docker-ce/centos/#</a><br>镜像开源安装站点:<a href=\"https://mirrors.tuna.tsinghua.edu.cn/help/docker-ce/\" target=\"_blank\" rel=\"noopener\">https://mirrors.tuna.tsinghua.edu.cn/help/docker-ce/</a></p>\n<ul>\n<li>Docker Engine改为Docker CE（社区版）: 它包含了CLI客户端、后台进程/服务以及API。用户像以前以同样的方式获取。</li>\n<li>Docker Data Center改为Docker EE（企业版）: 在Docker三个定价层增加了额外的支付产品和支持。</li>\n</ul>\n<p><br></p>\n<p><strong>官方一键安装脚本</strong><br>补充时间:<code>[2020年4月22日 11:00:59]</code><br>一键安装Docker-ce以及Docker-compose:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">##[docker]</span></span><br><span class=\"line\"><span class=\"comment\">#国外</span></span><br><span class=\"line\">curl -fsSL https://get.docker.com | bash -s docker</span><br><span class=\"line\"><span class=\"comment\">#国内</span></span><br><span class=\"line\">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br><span class=\"line\">curl -fsSL https://get.docker.com -o get-docker.sh &amp;&amp; chmod +x get-docker.sh &amp;&amp; ./get-docker.sh</span><br><span class=\"line\"><span class=\"comment\">#测试安装结果</span></span><br><span class=\"line\">docker-info</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##[docker-compose]</span></span><br><span class=\"line\">sudo curl -L <span class=\"string\">\"https://github.com/docker/compose/releases/download/v2.4.1/docker-compose-<span class=\"variable\">$(uname -s)</span>-<span class=\"variable\">$(uname -m)</span>\"</span> -o /usr/<span class=\"built_in\">local</span>/bin/docker-compose &amp;&amp; chmod +x /usr/<span class=\"built_in\">local</span>/bin/docker-compose</span><br><span class=\"line\"><span class=\"comment\">#测试安装结果</span></span><br><span class=\"line\">docker-compose version</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>CentOS 中利用 yum 安装 Docker / Docker-compose</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># (1) 卸载机器上docker或者docker-engine旧版本以及相关的依赖项 </span></span><br><span class=\"line\">yum remove -y  docker \\</span><br><span class=\"line\">  docker-client \\</span><br><span class=\"line\">  docker-client-latest \\</span><br><span class=\"line\">  docker-common \\</span><br><span class=\"line\">  docker-latest \\</span><br><span class=\"line\">  docker-latest-logrotate \\</span><br><span class=\"line\">  docker-logrotate \\</span><br><span class=\"line\">  docker-engine</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2) 在新主机上首次安装 Docker Engine 之前，您需要 设置 Docker 稳定的存储库。</span></span><br><span class=\"line\">sudo yum install -y yum-utils</span><br><span class=\"line\">sudo yum-config-manager \\</span><br><span class=\"line\">    --add-repo \\</span><br><span class=\"line\">    https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class=\"line\"><span class=\"comment\"># 或者手动设置官方源</span></span><br><span class=\"line\"><span class=\"comment\"># sudo tee /etc/yum.repos.d/docker.repo &lt;&lt;-'EOF'</span></span><br><span class=\"line\"><span class=\"comment\"># [dockerrepo]</span></span><br><span class=\"line\"><span class=\"comment\"># name=Docker Repository</span></span><br><span class=\"line\"><span class=\"comment\"># baseurl=https://yum.dockerproject.org/repo/main/centos/$releasever/</span></span><br><span class=\"line\"><span class=\"comment\"># enabled=1</span></span><br><span class=\"line\"><span class=\"comment\"># gpgcheck=1</span></span><br><span class=\"line\"><span class=\"comment\"># gpgkey=https://yum.dockerproject.org/gpg</span></span><br><span class=\"line\"><span class=\"comment\"># EOF</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装最新版本的 Docker Engine  和 containerd</span></span><br><span class=\"line\"><span class=\"comment\"># Docker Community Edition (CE) 对于希望开始使用Docker并尝试基于容器的应用程序的开发人员和小型团队来说非常理想。</span></span><br><span class=\"line\"><span class=\"comment\"># 如果提示接受 GPG 密钥，请验证指纹是否匹配 060A 61C5 1B55 8A7F 742B 77AA C52F EB6B 621E 9F35，如果是，接受它。 </span></span><br><span class=\"line\">sudo yum install docker-ce docker-ce-cli containerd.io docker-compose  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装特定版本的 Docker Engine，请在列出可用版本中选择并安装,</span></span><br><span class=\"line\"><span class=\"comment\"># 即 包名（ docker-ce) 加上版本字符串（第二列） 从第一个冒号 ( :)，直到第一个连字符，由 一个连字符 ( -）。 例如 docker-ce-18.09.1. </span></span><br><span class=\"line\">yum list docker-ce --showduplicates | sort -r</span><br><span class=\"line\">  <span class=\"comment\"># docker-ce.x86_64            3:18.09.5-3.el7                    docker-ce-stable</span></span><br><span class=\"line\">  <span class=\"comment\"># docker-ce.x86_64            3:18.09.5-3.el7                    @docker-ce-stable  #当前使用版本</span></span><br><span class=\"line\">  <span class=\"comment\"># docker-ce.x86_64            3:19.03.15-3.el7                    docker-ce-stable</span></span><br><span class=\"line\">  <span class=\"comment\"># docker-ce.x86_64            3:19.03.14-3.el7                    docker-ce-stable</span></span><br><span class=\"line\">sudo yum install -y docker-ce-19.03.15  docker-ce-cli-19.03.15 containerd.io docker-compose</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 更新docker-ceDocker CE有三种更新通道是稳定通道、测试通道和夜间通道</span></span><br><span class=\"line\">yum -y upgrade docker-ce</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Docker 是一个 C/S 架构的服务,安装好 docker 之后需要启动 docker 软件后才能使用 docker 命令;</span></span><br><span class=\"line\">systemctl start/status docker  <span class=\"comment\"># 启动docker-ce</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看docker启动状态</span></span><br><span class=\"line\">docker version</span><br><span class=\"line\">Client:</span><br><span class=\"line\"> Version:           18.09.5</span><br><span class=\"line\"> API version:       1.39</span><br><span class=\"line\"> Go version:        go1.10.8</span><br><span class=\"line\"> Git commit:        e8ff056</span><br><span class=\"line\"> Built:             Thu Apr 11 04:43:34 2019</span><br><span class=\"line\"> OS/Arch:           linux/amd64</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 移出docker-ce</span></span><br><span class=\"line\">$ sudo yum remove docker-ce</span><br><span class=\"line\"><span class=\"comment\">#主机上的映像、容器、卷或自定义配置文件不会自动删除。删除所有图像、容器和卷:</span></span><br><span class=\"line\">$ sudo rm -rf /var/lib/docker</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 通过运行以下命令拉取并运行hello-world镜像验证 Docker Engine 是否已正确安装 </span></span><br><span class=\"line\">docker pull hello-world</span><br><span class=\"line\">docker images</span><br><span class=\"line\">docker run hello-world</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190506104434.png\" alt=\"WeiyiGeek.DockerCentosOK\" title=\"\" class=\"\">\n                <p>WeiyiGeek.DockerCentosOK</p>\n            </figure></p>\n<p><br></p>\n<p><strong>Ubuntu 中利用 apt 安装 Docker / Docker-compose</strong></p>\n<p>Ubuntu安装Docker参考: <a href=\"https://docs.docker.com/install/linux/docker-ce/ubuntu/\" target=\"_blank\" rel=\"noopener\">https://docs.docker.com/install/linux/docker-ce/ubuntu/</a><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\"># 1.卸载旧版本 </span></span><br><span class=\"line\">  sudo apt-get remove docker docker-engine docker.io containerd runc</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\"># 2.更新apt包索引并安装包以允许apt在HTTPS上使用存储库</span></span><br><span class=\"line\">  sudo apt-get install -y \\</span><br><span class=\"line\">    apt-transport-https \\</span><br><span class=\"line\">    ca-certificates \\</span><br><span class=\"line\">    curl \\</span><br><span class=\"line\">    gnupg-agent \\</span><br><span class=\"line\">    software-properties-common</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 3.添加Docker官方GPG密钥 # -fsSL</span></span><br><span class=\"line\">  sudo curl  https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 4.通过搜索指纹的最后8个字符进行密钥验证</span></span><br><span class=\"line\">  sudo apt-key fingerprint 0EBFCD88</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 5.设置稳定存储库</span></span><br><span class=\"line\">  sudo add-apt-repository \\</span><br><span class=\"line\">   <span class=\"string\">\"deb [arch=amd64] https://download.docker.com/linux/ubuntu \\</span></span><br><span class=\"line\"><span class=\"string\">   <span class=\"variable\">$(lsb_release -cs)</span> \\</span></span><br><span class=\"line\"><span class=\"string\">   stable\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 6.Install Docker Engine 默认最新版本</span></span><br><span class=\"line\">  sudo apt-get update &amp;&amp; sudo apt-get install -y docker-ce=5:20.10.7~3-0~ubuntu-focal docker-ce-cli=5:20.10.7~3-0~ubuntu-focal containerd.io docker-compose</span><br><span class=\"line\">  <span class=\"comment\"># sudo apt-get update &amp;&amp; sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-compose</span></span><br><span class=\"line\">  <span class=\"comment\"># - 强制IPv4</span></span><br><span class=\"line\">  <span class=\"comment\"># sudo apt-get -o Acquire::ForceIPv4=true  install -y docker-ce=5:19.03.15~3-0~ubuntu-focal docker-ce-cli=5:19.03.15~3-0~ubuntu-focal containerd.io docker-compose</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 7.安装特定版本的Docker引擎，请在repo中列出可用的版本</span></span><br><span class=\"line\">  apt-cache madison docker-ce</span><br><span class=\"line\">  <span class=\"comment\"># docker-ce | 5:20.10.6~3-0~ubuntu-focal| https://download.docker.com/linux/ubuntu focal/stable amd64 Packages</span></span><br><span class=\"line\">  <span class=\"comment\"># docker-ce | 5:19.03.15~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu  xenial/stable amd64 Packages</span></span><br><span class=\"line\">  <span class=\"comment\"># 使用第二列中的版本字符串安装特定的版本，例如:5:18.09.1~3-0~ubuntu-xenial。</span></span><br><span class=\"line\">  <span class=\"comment\"># $sudo apt-get install docker-ce=&lt;VERSION_STRING&gt; docker-ce-cli=&lt;VERSION_STRING&gt; containerd.io</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#8.将当前用户加入docker用户组然后重新登陆当前用户使得低权限用户</span></span><br><span class=\"line\">  sudo gpasswd -a <span class=\"variable\">$&#123;USER&#125;</span> docker</span><br><span class=\"line\">  <span class=\"comment\"># sudo gpasswd -a weiyigeek docker</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#9.加速器建立</span></span><br><span class=\"line\">  mkdir -vp /etc/docker/</span><br><span class=\"line\">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class=\"string\">'EOF'</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"data-root\"</span>:<span class=\"string\">\"/var/lib/docker\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"registry-mirrors\"</span>: [<span class=\"string\">\"https://xlx9erfu.mirror.aliyuncs.com\"</span>],</span><br><span class=\"line\">  <span class=\"string\">\"exec-opts\"</span>: [<span class=\"string\">\"native.cgroupdriver=systemd\"</span>],</span><br><span class=\"line\">  <span class=\"string\">\"storage-driver\"</span>: <span class=\"string\">\"overlay2\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"log-driver\"</span>: <span class=\"string\">\"json-file\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"log-level\"</span>: <span class=\"string\">\"warn\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"log-opts\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"max-size\"</span>: <span class=\"string\">\"100m\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"max-file\"</span>: <span class=\"string\">\"10\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">\"live-restore\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"string\">\"dns\"</span>: [<span class=\"string\">\"223.6.6.6\"</span>],</span><br><span class=\"line\">  <span class=\"string\">\"insecure-registries\"</span>: [<span class=\"string\">\"harbor.weiyigeek.top\"</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 9.自启与启动</span></span><br><span class=\"line\">  sudo systemctl daemon-reload</span><br><span class=\"line\">  sudo systemctl <span class=\"built_in\">enable</span> docker </span><br><span class=\"line\">  sudo systemctl restart docker</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p>docker-compose的安装补充时间:<code>[2020年1月22日 10:54:55]</code>，可能随着时间推移最新版本与下述版本不同，请安装最新的docker-compose版本即可。</p>\n<ul>\n<li>方式1：安装 docker-compose: [需要安装大于或者等于1.6版本的 Docker ]<br><a href=\"https://docs.docker.com/compose/\" target=\"_blank\" rel=\"noopener\">https://docs.docker.com/compose/</a>  -&gt; 选择InstallCompose<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190506111731.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#安装docker-compose</span></span><br><span class=\"line\"><span class=\"comment\">#切换为root权限下载并安装docker-compose ( current stable release (v1.25.0)  )</span></span><br><span class=\"line\">$ curl -L <span class=\"string\">\"https://github.com/docker/compose/releases/download/1.25.5/docker-compose-<span class=\"variable\">$(uname -s)</span>-<span class=\"variable\">$(uname -m)</span>\"</span> &gt; /usr/<span class=\"built_in\">local</span>/bin/docker-compose  </span><br><span class=\"line\">$ chmod +x /usr/<span class=\"built_in\">local</span>/bin/docker-compose    <span class=\"comment\">#添加执行权限</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>方式2：安装Docker-Compose<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#在centos7中使用python-pip安装docker-compose</span></span><br><span class=\"line\"><span class=\"variable\">$yum</span> install -y python3</span><br><span class=\"line\"><span class=\"variable\">$pip3</span> install pip --upgrade</span><br><span class=\"line\">[root@vm-1575613390 ~]<span class=\"comment\"># pip --version</span></span><br><span class=\"line\">pip 19.3.1 from /usr/<span class=\"built_in\">local</span>/lib/python3.6/site-packages/pip (python 3.6)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$pip3</span> install docker-compose</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>补充说明:<code>[2020年4月22日 10:58:21]</code></p>\n<ul>\n<li>目前最新版本的 docker 默认优先采用 overlay2 的存储驱动，对于已支持该驱动的 Linux 发行版，不需要任何进行任何额外的配置</li>\n</ul>\n<p><br></p>\n<h5 id=\"2-Windows-系统安装\"><a href=\"#2-Windows-系统安装\" class=\"headerlink\" title=\"2.Windows 系统安装\"></a>2.Windows 系统安装</h5><p>Windows 下安装 Docker：<a href=\"https://www.docker.com/products/docker-desktop\" target=\"_blank\" rel=\"noopener\">https://www.docker.com/products/docker-desktop</a><br>使用CPU虚拟化检测工具(LeoMoon CPU-V)检测环境：<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190505215320.png\" alt=\"WeiyiGeek.cpu-v\" title=\"\" class=\"\">\n                <p>WeiyiGeek.cpu-v</p>\n            </figure></p>\n<p><br></p>\n<p><strong>window 7 - 已经不适用</strong><br>Step 1.下载 docker Tool box 进行全安装FULL Installation<br>Step 2.安装成功后会在桌面出现virtual VM,docker,Kitematic(Alpha)等等</p>\n<ul>\n<li>Kitematic(Alpha):是一个Docker GUi工具.用户可能运行命令(docker run hello-world)在Docker客户端启动一个容器,在Kitematic中能观察结果. 用GitHub账号登陆.就可以看到自己创建的镜像,或是在GitHub上down下来的镜像.<br>Oracle VM VirtualBox:虚拟机管理器,可以创建虚拟机;也可对当前正在运行的虚拟机进行管理.</li>\n</ul>\n<p>Step 3.点击 Docker Quickstart Terminal进行下载boot2docker.iso 运气好不报错的话可以说明安装完成<br>Step 4.而我win7启动 Docker Quickstart Terminal报错,解决方法也是很简单<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190505215652.png\" alt=\"WeiyiGeek.报错\" title=\"\" class=\"\">\n                <p>WeiyiGeek.报错</p>\n            </figure></p>\n<p>下载后放在C:\\Users\\WeiyiGeek.docker\\machine\\cache\\boot2docker.iso即可<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190505215706.png\" alt=\"WeiyiGeek.下载boot2docker\" title=\"\" class=\"\">\n                <p>WeiyiGeek.下载boot2docker</p>\n            </figure></p>\n<p>解决上述问题后,验证安装：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull hello-world</span><br><span class=\"line\">docker images</span><br><span class=\"line\">docker run hello-world</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190505215804.png\" alt=\"WeiyiGeek.安装成功\" title=\"\" class=\"\">\n                <p>WeiyiGeek.安装成功</p>\n            </figure></p>\n<p>Step 5.安装后的docker是可以通过ssh连接的,boot2docker用户和密码<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker\ttcuser\tssh</span><br><span class=\"line\">root\t<span class=\"built_in\">command</span>：sudo -i (docker用户下执行)</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190505215933.png\" alt=\"WeiyiGeek.dockerssh\" title=\"\" class=\"\">\n                <p>WeiyiGeek.dockerssh</p>\n            </figure></p>\n<p><br></p>\n<p><strong>window 10 - 官方提供的 Docker Desktop for Windows</strong><br>描述: 现在在<code>Windows 10 Pro, Enterprise, and Education</code>等系统版本中可以进行下载安装<code>Docker Desktop for Windows</code><a href=\"https://hub.docker.com/editions/community/docker-ce-desktop-windows/\" target=\"_blank\" rel=\"noopener\">下载地址-当前版本2.3.0.3</a>，它可以进行使用的界面来操作查看docker中的容器，以此来简化了学习成本;<br>Step 1.设置docker进行安装,加入到PATH之中<br>Step 2.安装成功,关闭窗口<br>Step 3.安装后利用powershell进行查看docker版本<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; docker version</span><br><span class=\"line\">&gt; docker run hello-world</span><br></pre></td></tr></table></figure><br>Step 4.查看docker pull下来得镜像,并且运行<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; docker images  <span class=\"comment\">#查看镜像</span></span><br><span class=\"line\">&gt; docker run -it hello-world</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200716151445.png\" alt=\"WeiyiGeek.desktop for windows\" title=\"\" class=\"\">\n                <p>WeiyiGeek.desktop for windows</p>\n            </figure>\n<p>Tips: 如果在VMware中安装的虚拟机需要开启VT-X，如果Desktop无法启动则尝试以下解决方法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.查看系统中的VM,如果没有开启过就是false状态。</span></span><br><span class=\"line\">Get-VM</span><br><span class=\"line\">Get-VMProcessor -VMName Server2019 | fl</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\"># 2.显示未True就是已经开启嵌套虚拟化了，但是这个功能只针对Hyper-V虚拟机，所以，为什么要装虚拟机到Hyper-V中</span></span><br><span class=\"line\">Set-VMProcessor -ExposeVirtualizationExtensions <span class=\"variable\">$true</span> -VMName Server2019</span><br></pre></td></tr></table></figure></p>\n<p>Tips: 利用Docker Desktop部署blog<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS C:\\&gt; mkdir github; <span class=\"built_in\">cd</span> .\\github\\</span><br><span class=\"line\">PS C:\\github&gt; Invoke-WebRequest -Uri https://github.com/WeiyiGeek/WeiyiGeek/archive/refs/heads/master.zip -OutFile blog.zip</span><br><span class=\"line\">PS C:\\github&gt; Expand-Archive -Path .\\blog.zip -DestinationPath .</span><br><span class=\"line\">PS C:\\github&gt; mv .\\WeiyiGeek-master\\ blog</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211209115713.png\" alt=\"WeiyiGeek.Docker Desktop\" title=\"\" class=\"\">\n                <p>WeiyiGeek.Docker Desktop</p>\n            </figure>\n<p><br></p>\n<h5 id=\"3-Mac-系统安装\"><a href=\"#3-Mac-系统安装\" class=\"headerlink\" title=\"3.Mac 系统安装\"></a>3.Mac 系统安装</h5><p>描述: Mac安装请参考Docker官方文档，由于企业中服务器一般是采用Linux操作系统作为基础环境，Mac 多用于开发测试电脑，所以此处不再进行安装实践讲解。<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190505220335.png\" alt=\"WeiyiGeek.mac\" title=\"\" class=\"\">\n                <p>WeiyiGeek.mac</p>\n            </figure></p>\n<p><br></p>\n<h5 id=\"4-镜像加速器配置\"><a href=\"#4-镜像加速器配置\" class=\"headerlink\" title=\"4.镜像加速器配置\"></a>4.镜像加速器配置</h5><p><strong>Q: Docker 镜像站（加速器配置）是什么，我需要使用吗？</strong><br>描述: 使用 Docker 的时候，需要经常从官方获取镜像，但是由于显而易见的网络原因，拉取镜像的过程非常耗时，严重影响使用 Docker 的体验。因此为你的Docker服务配置Docker镜像站(加速)是非常必要的，通过智能路由和缓存机制，极大提升了国内网络访问 Docker Hub 的速度，如果您是在国内的网络环境使用 Docker，那么 Docker 镜像站一定能帮助到您。</p>\n<p><strong>方式1：使用DaoCloud加速器</strong><br>简介：DaoCloud 加速器 是广受欢迎的 Docker 工具,解决了国内用户访问 Docker Hub 缓慢的问题。DaoCloud 加速器结合国内的 CDN 服务与协议层优化,成倍的提升了下载速度。<br>DaoCloud官网：<br><a href=\"https://www.daocloud.io/mirror#accelerator-doc\" target=\"_blank\" rel=\"noopener\">https://www.daocloud.io/mirror#accelerator-doc</a></p>\n<p>配置方式:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 方式1</span></span><br><span class=\"line\">curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://f1361db2.m.daocloud.io</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方式2</span></span><br><span class=\"line\">sudo mkdir -p /etc/docker</span><br><span class=\"line\">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class=\"string\">'EOF'</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"registry-mirrors\"</span>: [<span class=\"string\">\"http://f1361db2.m.daocloud.io\"</span>,<span class=\"string\">\"https://xlx9erfu.mirror.aliyuncs.com\"</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>方式2：使用阿里云容器镜像服务加速器</strong><br>推荐安装1.10.0以上版本的Docker客户端,您可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#方法1.常规加速</span></span><br><span class=\"line\">sudo mkdir -p /etc/docker</span><br><span class=\"line\">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class=\"string\">'EOF'</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"registry-mirrors\"</span>: [<span class=\"string\">\"https://xlx9erfu.mirror.aliyuncs.com\"</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#方法2：对于 1.12 以前的版本， dockerd 换成 docker daemon </span></span><br><span class=\"line\"><span class=\"comment\">#注：编辑docker.service文件</span></span><br><span class=\"line\">ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --registry-mirrors=https://xlx9erfu.mirror.aliyuncs.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#方法3:Docker-CE17.12版本以及之后(CentOS7.0)</span></span><br><span class=\"line\">vi /usr/lib/systemd/system/docker.service</span><br><span class=\"line\">ExecStart=/usr/bin/dockerd --registry-mirror=https://xlx9erfu.mirror.aliyuncs.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#通用启动</span></span><br><span class=\"line\">sudo systemctl daemon-reload   <span class=\"comment\">#重载守护</span></span><br><span class=\"line\">sudo systemctl restart docker</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#检查加速器是否生效</span></span><br><span class=\"line\">sudo ps -ef | grep dockerd</span><br><span class=\"line\">root 5346 1 0 19:03 ? 00:00:00 /usr/bin/dockerd --registry-mirror=https://jxus37ad.mirror.aliyuncs.com</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20191119225356.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p>补充一键配置:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Docker中国 mirror</span></span><br><span class=\"line\"><span class=\"comment\"># export REGISTRY_MIRROR=\"https://registry.docker-cn.com\"</span></span><br><span class=\"line\"><span class=\"comment\"># 腾讯云 docker hub mirror</span></span><br><span class=\"line\"><span class=\"comment\"># export REGISTRY_MIRROR=\"https://mirror.ccs.tencentyun.com\"</span></span><br><span class=\"line\"><span class=\"comment\"># 华为云镜像</span></span><br><span class=\"line\"><span class=\"comment\"># export REGISTRY_MIRROR=\"https://05f073ad3c0010ea0f4bc00b7105ec20.mirror.swr.myhuaweicloud.com\"</span></span><br><span class=\"line\"><span class=\"comment\"># DaoCloud 镜像</span></span><br><span class=\"line\"><span class=\"comment\"># export REGISTRY_MIRROR=\"http://f1361db2.m.daocloud.io\"</span></span><br><span class=\"line\"><span class=\"comment\"># 阿里云 docker hub mirror</span></span><br><span class=\"line\"><span class=\"comment\"># export REGISTRY_MIRROR=https://registry.cn-hangzhou.aliyuncs.com</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> REGISTRY_MIRROR=https://xlx9erfu.mirror.aliyuncs.com</span><br><span class=\"line\">curl -sSL https://kuboard.cn/install-script/set_mirror.sh | sh -s <span class=\"variable\">$&#123;REGISTRY_MIRROR&#125;</span></span><br></pre></td></tr></table></figure></p>\n<hr>\n\n<h4 id=\"0x02-Docker-核心概念\"><a href=\"#0x02-Docker-核心概念\" class=\"headerlink\" title=\"0x02 Docker 核心概念\"></a>0x02 Docker 核心概念</h4><p>描述：Docker的三大核心概念镜像/容器和仓库, 通过三大对象核心概念所构建的高效工作流程;</p>\n<h5 id=\"1-镜像-image\"><a href=\"#1-镜像-image\" class=\"headerlink\" title=\"1.镜像 [image]\"></a>1.镜像 [image]</h5><p>描述：images 类似于虚拟机镜像，借鉴了Git利用分成分层优点，通过文件系统分层的概念实现了分层复用，极大的节约了磁盘空间；简单的您可以将它理解成为一个面向Docker引擎的只读模板包含文件系统;</p>\n<ul>\n<li>镜像是创建Docker容器的基础,然后通过版本管理和增量的文件系统;</li>\n<li>用户基于镜像来运行自己的容器,镜像是基于 Union 文件系统的层式结构;</li>\n</ul>\n<p>Docker运行容器前本地必须存在对应的镜像,如果不指定镜像名将会默认自动采用Docker Hub公共注册服务器仓库中该名称的镜像;<br>Docker 镜像使用帮助:<a href=\"https://lug.ustc.edu.cn/wiki/mirrors/help/docker\" target=\"_blank\" rel=\"noopener\">https://lug.ustc.edu.cn/wiki/mirrors/help/docker</a></p>\n<p>基础知识:</p>\n<ul>\n<li>1.镜像名称格式:<code>Repository address/Namespace/ImageName:tag</code>即<code>hub.weiyigeek.top/Test/alpine-apps:1.0</code></li>\n<li>2.典型Linux启动需要运行两个FS即:<code>Kernel &gt; Bootfs &gt; Rootfs</code></li>\n<li>3.镜像的分层结构: 新镜像是从Base镜像一层一层叠加的，每安装一个软件就在现有镜像基础上增加一层;</li>\n</ul>\n<p><br/></p>\n<p>镜像操作常用命令：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker search --no-trunc=<span class=\"literal\">false</span> [镜像名称] <span class=\"comment\">#搜索关于Archlinux镜像,输出信息不截断显示</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#仓库名(Repository) 或者 标签名[不指定着默认latest,即最新]</span></span><br><span class=\"line\">docker pull name/[repository[:tag]] <span class=\"comment\">#获取Hub镜像如果不指定TAG将默认选择仓库中最新颁布的镜像</span></span><br><span class=\"line\">docker push DockerHubUser用户/<span class=\"built_in\">test</span>:latest  <span class=\"comment\">#上传到docker仓库</span></span><br><span class=\"line\"></span><br><span class=\"line\">docker images   <span class=\"comment\">#列出本机已有镜像</span></span><br><span class=\"line\"></span><br><span class=\"line\">docker tag 原仓库[:标签] 新仓库名[:标签]  <span class=\"comment\">#为本地镜像添加一个新标签 [注意仓库名称必须小写]</span></span><br><span class=\"line\">docker tag &lt;image id&gt; username/name:devel <span class=\"comment\">#修改镜像的标签</span></span><br><span class=\"line\"></span><br><span class=\"line\">docker inspect [image id]  <span class=\"comment\">#获取镜像的详细信息</span></span><br><span class=\"line\">docker inspect -f &#123;&#123;<span class=\"string\">\".Architecture\"</span>&#125;&#125; 550(images Id 前面3位)  <span class=\"comment\">#-f 获取单个属性 返回JSON</span></span><br><span class=\"line\">  </span><br><span class=\"line\">docker rmi [&lt;image id&gt;|&lt;repository&gt; ]   <span class=\"comment\">#删除镜像 镜像id|仓库名称</span></span><br><span class=\"line\">docker rmi -f &lt;images id&gt;   <span class=\"comment\">#不建议强行删除正在容器中运行的镜像文件</span></span><br><span class=\"line\"></span><br><span class=\"line\">docker save -o 保存文件名.tar  [repository[:tag]]  <span class=\"comment\">#将镜像文件打包存出到磁盘</span></span><br><span class=\"line\">docker save [repository[:tag]] &gt; 保存文件名 <span class=\"comment\">#将镜像文件打包存出到磁盘</span></span><br><span class=\"line\"></span><br><span class=\"line\">docker load --input 保存文件名.tar   <span class=\"comment\">#将打包的镜像文件进行载人</span></span><br><span class=\"line\">docker load &lt; 保存文件名.tar</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><em>运行案例:</em><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo docker pull ubuntu:16.04                <span class=\"comment\">#下载14.04 tag的镜像</span></span><br><span class=\"line\">Using default tag: latest</span><br><span class=\"line\">latest: Pulling from library/ubuntu</span><br><span class=\"line\"><span class=\"comment\">#从下面可以看出镜像文件一般是由若干组成,行首f476d66f5408代表了各层的ID,下载过程中会获取并输出镜像各层信息</span></span><br><span class=\"line\"><span class=\"comment\">#层(Layer)其实是AUFS(Advanced Union File System联合文件系统)重要概率是实现增量保存于更新的基础</span></span><br><span class=\"line\">f476d66f5408: Pulling fs layer</span><br><span class=\"line\">8882c27f669e: Pulling fs layer</span><br><span class=\"line\">d9af21273955: Pulling fs layer</span><br><span class=\"line\">f5029279ec12: Waiting</span><br><span class=\"line\"></span><br><span class=\"line\">$ sudo docker pull registry.hub.docker.com:5000/ubuntu   <span class=\"comment\">#从指定长仓库进行下载</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ sudo docker run -t -i Ubuntu /bin/bash        <span class=\"comment\">#利用dockerubuntu镜像创建一个容器 仓库后面是接的命令</span></span><br><span class=\"line\">root@634e7ed26d76:/<span class=\"comment\"># w</span></span><br><span class=\"line\">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class=\"line\"> 03:34:47 up  1:59,  0 users,  load average: 0.00, 0.05, 0.06</span><br><span class=\"line\">root@634e7ed26d76:/<span class=\"comment\"># cat /etc/os-release</span></span><br><span class=\"line\">NAME=<span class=\"string\">\"Ubuntu\"</span></span><br><span class=\"line\">VERSION=<span class=\"string\">\"18.04.2 LTS (Bionic Beaver)\"</span></span><br><span class=\"line\">ID=ubuntu</span><br><span class=\"line\">ID_LIKE=debian</span><br><span class=\"line\">PRETTY_NAME=<span class=\"string\">\"Ubuntu 18.04.2 LTS\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">$ sudo docker images   <span class=\"comment\">#列出镜像</span></span><br><span class=\"line\"><span class=\"comment\">#其中Image id的信息十分重要,它唯一标示了镜像,Tag信息来区分发行版本(如14.04,16.04) </span></span><br><span class=\"line\">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">ubuntu              latest              d131e0fa2585        9 days ago          102MB</span><br><span class=\"line\">centos              latest              9f38484d220f        7 weeks ago         202MB</span><br><span class=\"line\"><span class=\"comment\">#REPOSITORY (来自哪个仓库)  TAG (镜像的标签信息)   IMAGE ID (镜像的ID号,唯一)    CREATED [Created:建立时间] VIRTUAL SIZE (镜像大小)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">$ sudo docker tag ubuntu:latest ubuntu18.04:latest <span class=\"comment\">#修改镜像名称使用该方式进行添加新标签原来的不会被删除</span></span><br><span class=\"line\">$ sudo docker tag d131e0fa2585 ubuntutls:latest</span><br><span class=\"line\">$ sudo docker images</span><br><span class=\"line\"><span class=\"comment\">#更改后镜像的ID是完全一致的,其实都指向了同一个镜像文件相当于别名而已；</span></span><br><span class=\"line\">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">ubuntutls           latest              d131e0fa2585        9 days ago          102MB</span><br><span class=\"line\">ubuntu18.04         latest              d131e0fa2585        9 days ago          102MB </span><br><span class=\"line\"></span><br><span class=\"line\">$ sudo docker inspect d131e0fa2585 <span class=\"comment\">#获取该镜像的详细信息</span></span><br><span class=\"line\">$ sudo docker inspect -f &#123;&#123;<span class=\"string\">\".Architecture\"</span>&#125;&#125; d131  <span class=\"comment\">#获取系统架构 通常使用镜像ID的前三位</span></span><br><span class=\"line\">amd64</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190506114446.png\" alt=\"WeiyiGeek.inspect\" title=\"\" class=\"\">\n                <p>WeiyiGeek.inspect</p>\n            </figure></p>\n<p>当该镜像在容器运行存在的时候,镜像文件默认是无法被删除的;必须停止/删除容器ID才能删除镜像文件;<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#当同一个镜像有多个标签的时候rmi命令只是删错了该进行的标签而且,并不影响镜像文件</span></span><br><span class=\"line\"><span class=\"comment\">#但当只剩下一个标签的时候就要小心了,如果在停止的状态下再次使用rmi命令则会删除该镜像</span></span><br><span class=\"line\">$ sudo docker rmi ubuntu18.04</span><br><span class=\"line\">Untagged: ubuntu18.04:latest</span><br><span class=\"line\">$ sudo docker rmi ubuntu ubuntutls</span><br><span class=\"line\">Untagged: ubuntu:latest </span><br><span class=\"line\">Untagged:  <span class=\"comment\">#删除了这个镜像文件的所有AUFS层</span></span><br><span class=\"line\">ubuntu@sha256:d26d529daa4d8567167181d9d569f2a85da3c5ecaf539cace2c6223355d69981</span><br><span class=\"line\"></span><br><span class=\"line\">$ sudo docker rmi -f ubuntutls  <span class=\"comment\">#强制删除</span></span><br><span class=\"line\">Untagged: ubuntutls:latest</span><br><span class=\"line\">Deleted: sha256:d131e0fa2585a7efbfb187f70d648aa50e251d9d3b7031edf4730ca6154e221e</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p><strong>创建镜像有三种办法：</strong></p>\n<ul>\n<li>1.从已有镜像的容器创建</li>\n<li>2.基于本地模板导入：使用操作系统模板导入一个镜像文件;这里推荐使用OpenVZ提供的模板来常见</li>\n<li>3.基于Dockerfile导入</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">######### 从已有镜像创建 ############</span></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> docker commit [option-选项] ContainerId [Repository[:Tag]]</span><br><span class=\"line\"><span class=\"variable\">$sudo</span> docker commit -m <span class=\"string\">\"xx\"</span> -a <span class=\"string\">\"oo\"</span> ContainerID(被修改过的ID) [Repository[:Tag]] </span><br><span class=\"line\"><span class=\"comment\"># -a,--author=\"作者\"</span></span><br><span class=\"line\"><span class=\"comment\"># -m,--message=\"更改信息\"</span></span><br><span class=\"line\"><span class=\"comment\"># -p,--pause=ture 提交时暂停容器Container运行</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> docker run -it centos:latest /bin/bash</span><br><span class=\"line\">[root@32a481e170c6 ~]$ touch &#123;1..10&#125;.txt  <span class=\"comment\">#上面这个容器ID非常重要在进行修改之后</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> docker container ls -a   <span class=\"comment\">#查看容器记录</span></span><br><span class=\"line\"><span class=\"comment\">#创建一个新的镜像</span></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> docker commit -m <span class=\"string\">\"Zabbix base in Centos7\"</span> -a <span class=\"string\">\"Weiyigeek\"</span> 32a481e170c6 centoszabbix:latest</span><br><span class=\"line\">sha256:680ddb57c4b80c625ef68e113f553ee932a06f25d4685d25a0b6464cf5d60982  <span class=\"comment\">#成功会给出一个镜像ID</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">######### 从本地模板导入 ############</span></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> cat ubuntu-14.04.tar.gz | docker import - ubuntu:14.04  <span class=\"comment\">#本地导入镜像命令</span></span><br></pre></td></tr></table></figure>\n<p><br></p>\n<p>存出和载人镜像并上传镜像到DockerHub中实例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$docker</span> save -o zabbixcentos.tar centoszabbix:latest</span><br><span class=\"line\">ls -alh zabbixcentos.tar</span><br><span class=\"line\">-rw------- 1 root root 200M 5月   6 13:16 zabbixcentos.tar</span><br><span class=\"line\"><span class=\"variable\">$docker</span> load --input zabbixcentos.tar</span><br><span class=\"line\">Loaded image: centoszabbix:latest</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$docker</span> images</span><br><span class=\"line\">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">centoszabbix (上面从已有镜像文件中创建)       latest              622b7661c06b        13 minutes ago      202MB</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#用户需要在DockerHub网站注册后才能进行上传镜像</span></span><br><span class=\"line\"><span class=\"variable\">$docker</span> login  <span class=\"comment\">#在及其上进行登录</span></span><br><span class=\"line\"><span class=\"comment\"># Login with your Docker ID to push and pull images from Docker Hub. If you don have a Docker ID, head over to https://hub.docker.com to create one.</span></span><br><span class=\"line\"><span class=\"comment\"># Username: weiyigeek</span></span><br><span class=\"line\"><span class=\"comment\"># Password: 输入hub密码</span></span><br><span class=\"line\"><span class=\"comment\"># WARNING! 账号密码base64编码存放于 /root/.docker/config.json 文件中</span></span><br><span class=\"line\"><span class=\"comment\"># echo \"d2VpeW********VrO***ldlaXllMjAxOQ==\" | base64 -d</span></span><br><span class=\"line\"><span class=\"comment\"># weiyigeek:Docker</span></span><br><span class=\"line\"><span class=\"comment\"># https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span></span><br><span class=\"line\">Login Succeeded  <span class=\"comment\">#表示登录成功</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$docker</span> push weiyigeek/czabbix:latest</span><br><span class=\"line\">The push refers to repository [docker.io/weiyigeek/czabbix]</span><br><span class=\"line\">484404f26982: Pushed</span><br><span class=\"line\">d69483a6face: Mounted from library/centos</span><br><span class=\"line\">latest: digest: sha256:c1d891c2d56a0677ff28639189fa7252790d3b8ef417816570fb3a7654bc4e05 size: 736  <span class=\"comment\">#表示上传成功返回的票据</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190506150159.png\" alt=\"WeiyiGeek.hub镜像上传成功\" title=\"\" class=\"\">\n                <p>WeiyiGeek.hub镜像上传成功</p>\n            </figure></p>\n<p><br></p>\n<p><strong>镜像的F&amp;Q相关问题</strong></p>\n<p>Q:Docker 镜像是怎么实现增量的修改和维护的？<br>答：每个镜像都由很多层次构成，Docker 使用 Union FS 将这些不同的层结合到一个镜像中去。<br>通常 Union FS 有两个用途：(Docker 在 AUFS 上构建的容器也是利用了类似的原理)</p>\n<ul>\n<li>一方面可以实现不借助 LVM、RAID 将多个 disk 挂到同一个目录下</li>\n<li>就是将一个只读的分支和一个可写的分支联合在一起，Live CD 正是基于此方法可以允许在镜像不变的基础上允许用户在其上进行一些写操作</li>\n</ul>\n<p>Q: 什么是虚悬镜像？<br>答: 虚悬镜像(dangling image)，在使用docker images 查看镜像既没有仓库名，也没有标签只是显示一个<code>&lt;none&gt;</code>的镜像<br>产生原因：由于新旧镜像同名，旧镜像名称被取消，从而出现仓库名、标签均为 的镜像。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看与删除虚悬镜像</span></span><br><span class=\"line\">$ docker images -f dangling=<span class=\"literal\">true</span></span><br><span class=\"line\">$ docker rmi $(docker images -q -f dangling=<span class=\"literal\">true</span>)</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p>Q: 什么是镜像写时复制?<br>答: 比如典型的Linux启动首先会将rootfs置为readonly再进行一系列检查后将其切换为readwrite供用户使用，当在Docker中起初也是将rootfs置为readonly，然后利用union mount将一个readwrite文件系统挂载只读的rootfs之上，并且运行再次将下层的文件系统设置为readonly并且向上叠加，我们把这样一组readonly和一个writeable的结构构成一个容器的运行目录，每一个被称为一个Layer;<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Writable : Container  (可以向上叠加同时它变成一层Image)</span><br><span class=\"line\">add Apache : Image (Reference parent-引用父)</span><br><span class=\"line\">add Emacs : Image  (Reference parent-引用父)</span><br><span class=\"line\">Debian : Base Image</span><br><span class=\"line\">&gt; Bootfs</span><br><span class=\"line\">lxc,aufs,brtfs : Kernel</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p>Q: Docker 中 save 和 export 命令的区别?<br>答: 我们先简单的说一下其区别，在随后的的例子中使您更快的理解;</p>\n<ul>\n<li>1.save 与 load 命令对应即导出与导入镜像，而export与import命令对应即导出导入容器;</li>\n<li>2.save 保存后 load 加载的镜像没有丢失历史和层(Layer),而容器export导出然后import导入时所有的提交历史将会丢失，这意味着您无法回滚到之前的层;</li>\n<li>3.补充:通过import导入的方式镜像只有一层，而通过commit的方式生成的镜像实际是在原有的Base Image(即复写层)上又生成了一层；</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.在一个正在运行的容器上创建一个目录然后commit</span></span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> -it test1 mkdir /tmp/demo</span><br><span class=\"line\">docker commit -a <span class=\"string\">\"WeiyiGeek\"</span> -m <span class=\"string\">\"create /tmp/demo directory\"</span> test1 <span class=\"built_in\">test</span>:1.2 <span class=\"comment\">#加上tag镜像名称:版本防止玄虚镜像</span></span><br><span class=\"line\">sha256:30a048249000dd36561bffaa9fecc7690a45ef12096849c77afd4543b0d2d9b0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.采用save命令进行导出提交的镜像</span></span><br><span class=\"line\">docker save -o save.tar 30a048</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.采用export进行导出正则运行的容器</span></span><br><span class=\"line\">docker ps</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class=\"line\">25d2d645bfc9        test1               <span class=\"string\">\"top -b -d 2\"</span>       2 weeks ago         Up 3 days                               test1</span><br><span class=\"line\">docker <span class=\"built_in\">export</span> test1 &gt; export.tar <span class=\"comment\"># 或者 docker export 25d &gt; export.tar</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.在另外一台机器上进行分别导入 save.tar 与 export.tar</span></span><br><span class=\"line\">docker load -i save.tar <span class=\"comment\">#此时默认导入会导致虚悬镜像</span></span><br><span class=\"line\">Loaded image ID: sha256:30a048249000dd36561bffaa9fecc7690a45ef12096849c77afd4543b0d2d9b0</span><br><span class=\"line\">cat export.tar | docker import - test1:1.0</span><br><span class=\"line\">sha256:cdd65e7054be9e1928fe8133380817e81ff12b8493b40e2f9106efedac5ee572</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5.查看导入情况</span></span><br><span class=\"line\">docker images</span><br><span class=\"line\">REPOSITORY                            TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">&lt;none&gt;                                &lt;none&gt;              30a048249000        2 minutes ago       7.37MB</span><br><span class=\"line\">test1                                 1.0                 cdd65e7054be        3 minutes ago       7.35MB</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 6.查看异同</span></span><br><span class=\"line\">[root@master-01 ~]$ docker <span class=\"built_in\">history</span> 30a <span class=\"comment\"># save 方式 存在历史层信息</span></span><br><span class=\"line\"><span class=\"comment\"># IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span></span><br><span class=\"line\"><span class=\"comment\"># 30a048249000        22 minutes ago      -d 2                                            193B                create /tmp/demo directory</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;missing&gt;           2 weeks ago         /bin/sh -c #(nop)  CMD [\"-d\" \"2\"]               0B</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;missing&gt;           2 weeks ago         /bin/sh -c #(nop)  ENTRYPOINT [\"top\" \"-b\"]      0B</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;missing&gt;           2 weeks ago         /bin/sh -c echo \"http://mirrors.huaweicloud\".…   1.8MB</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;missing&gt;           2 weeks ago         /bin/sh -c #(nop)  MAINTAINER WeiyiGeek mast…   0B</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;missing&gt;           2 weeks ago         /bin/sh -c #(nop)  LABEL Author=WeiyiGeek De…   0B</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;missing&gt;           5 weeks ago         /bin/sh -c #(nop)  CMD [\"/bin/sh\"]              0B</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;missing&gt;           5 weeks ago         /bin/sh -c #(nop) ADD file:c92c248239f8c7b9b…   5.57MB</span></span><br><span class=\"line\">[root@master-01 ~]$ docker <span class=\"built_in\">history</span> cdd <span class=\"comment\"># export 方式无历史层信息且只有一层</span></span><br><span class=\"line\"><span class=\"comment\"># IMAGE               CREATED             CREATED BY          SIZE                COMMENT</span></span><br><span class=\"line\"><span class=\"comment\"># cdd65e7054be        23 minutes ago                          7.35MB              Imported from -</span></span><br></pre></td></tr></table></figure>\n<hr>\n<h5 id=\"2-容器-Container\"><a href=\"#2-容器-Container\" class=\"headerlink\" title=\"2.容器 [Container]\"></a>2.容器 [Container]</h5><p>描述：Docker容器Container类似于一个轻量级的沙箱,也可以看做一个简易版的Linux系统环境;因为容器是运行应用程序的,所以必须得先有一个操作系统为基础</p>\n<p>Docker利用容器来运行和隔离应用;</p>\n<ul>\n<li>容器是从镜像创建的应用独立运行的实例;</li>\n<li>可以进行启动/开始/停止/删除容器,而这些容器都是相互隔离,互不可见的;</li>\n<li>镜像自身只读的,容器从镜像启动的时候会在镜像的最上层创建一个可写层,镜像本身将保持不变;</li>\n<li>创建容器、启动容器、终止容器、进入容器、删除容器、导入导出容器实现容器迁移;</li>\n</ul>\n<p>当创建并运行容器时候Docker在后台运行的标准操作包括：</p>\n<ul>\n<li>检查本地是否存在指定镜像,不存在就从公有仓库下载</li>\n<li>利用镜像创建并启动一个容器</li>\n<li>分配一个文件系统,并在只读的镜像层外面挂载一个可读写层</li>\n<li>从宿主主机配置的网桥接口中桥接一个虚拟接口到容器中去</li>\n<li>从地址池配置一个IP地址给容器</li>\n<li>执行用户指定的应用程序</li>\n<li>执行完毕后容器被终止</li>\n</ul>\n<p>启动容器有两种方式：</p>\n<ul>\n<li>一种是基于镜像新建一个容器并启动</li>\n<li>另外一个是将在终止状态（stopped）的容器重新启动。</li>\n</ul>\n<p>容器操作常用命令：：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker create -it repository[:tag] <span class=\"comment\">#创建容器但处于停止状态</span></span><br><span class=\"line\"></span><br><span class=\"line\">docker start -a -i &lt;container id&gt;   <span class=\"comment\">#启动创建的容器</span></span><br><span class=\"line\"><span class=\"comment\"># -a 参数   连接容器并打印输出或错误 -</span></span><br><span class=\"line\"><span class=\"comment\"># -i 参数   启动容器并进入交互模式</span></span><br><span class=\"line\"></span><br><span class=\"line\">docker run -t -i repository[:tag]  /bin/bash <span class=\"comment\">#创建并启动容器 等同于上面两条命令</span></span><br><span class=\"line\"><span class=\"comment\"># -t:让Docker分配一个伪终端(pseudo-tty)并绑定在容器的标准输入上.</span></span><br><span class=\"line\"><span class=\"comment\"># -i:则让容器的标准输入保持打开.</span></span><br><span class=\"line\"><span class=\"comment\"># CTRL+Z 和 Exit 则退出容器Container</span></span><br><span class=\"line\">docker run -d repository[:tag] /bin/sh -C <span class=\"string\">\"echo hello word\"</span> <span class=\"comment\">#守护态运行</span></span><br><span class=\"line\"><span class=\"comment\"># -d 参数即可后台运行,用户无法看到容器中的信息</span></span><br><span class=\"line\"><span class=\"comment\"># -c 执行的Command</span></span><br><span class=\"line\"><span class=\"comment\"># --rm 添加这个标记,容器会在停止后立即删除自身   (注意：与-d不能同时使用)</span></span><br><span class=\"line\"><span class=\"comment\"># --name 使用--name web 标记可以为容器重新命名</span></span><br><span class=\"line\"></span><br><span class=\"line\">docker logs &lt;Container-id&gt;      <span class=\"comment\">#获取容器的输出信息</span></span><br><span class=\"line\"></span><br><span class=\"line\">docker attach [names]  <span class=\"comment\">#采用ps -a NAMES 进入容器</span></span><br><span class=\"line\"></span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> -it &lt;Container-id&gt;  /bin/bash  <span class=\"comment\">#docker exec 至1.3版本起可以在容器中运行命令</span></span><br><span class=\"line\"></span><br><span class=\"line\">docker ps -aq   <span class=\"comment\">#显示本机上的所有容器ID运行的容器ID信息</span></span><br><span class=\"line\"></span><br><span class=\"line\">docker restart &lt;container id&gt;  <span class=\"comment\">#重启容器</span></span><br><span class=\"line\"></span><br><span class=\"line\">docker stop &lt;container id&gt;  <span class=\"comment\">#停止容器</span></span><br><span class=\"line\">docker <span class=\"built_in\">kill</span> &lt;cantainer id&gt;  <span class=\"comment\">#强行终止容器 可以直接发送SIGKILL信号来终止容器</span></span><br><span class=\"line\"></span><br><span class=\"line\">docker rm &lt;container id&gt;    <span class=\"comment\">#删除容器删除依赖该镜像的容器ID,前3位即可</span></span><br><span class=\"line\"><span class=\"comment\"># -f,--force=false 强制终止并删除一个运行中的容器[默认会发生SIGKILL信号]</span></span><br><span class=\"line\"><span class=\"comment\"># -l,--link=false  删除容器连接但保留容器</span></span><br><span class=\"line\"><span class=\"comment\"># -v,--volumes=false  删除容器挂载的数据卷</span></span><br><span class=\"line\"></span><br><span class=\"line\">docker <span class=\"built_in\">export</span> &lt;container id&gt; &gt;导出文件.tar  <span class=\"comment\">#导出容器</span></span><br><span class=\"line\"></span><br><span class=\"line\">docker import - repository[:tag] <span class=\"comment\">#导入容器</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190506161441.png\" alt=\"WeiyiGeek.run与start的区别\" title=\"\" class=\"\">\n                <p>WeiyiGeek.run与start的区别</p>\n            </figure></p>\n<p>命令实践：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#创建容器</span></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> docker create -it weiyigeek/czabbix  </span><br><span class=\"line\">2b72a3410be576aeb9023ef2c41488e7b2630cf2282b8a0b1dddce771f22231f</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#启动容器ID执行交换登录,start可以进入到任何在容器中运行</span></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> docker start -i 2b7  </span><br><span class=\"line\"><span class=\"comment\"># [root@2b72a3410be5 /]# whoami</span></span><br><span class=\"line\"><span class=\"comment\"># root</span></span><br><span class=\"line\"><span class=\"comment\"># [root@2b72a3410be5 /]# exit</span></span><br><span class=\"line\"><span class=\"comment\">#对于创建后的容器采用exit命令退出后该容器自动处于终止状态;</span></span><br><span class=\"line\"><span class=\"comment\">#提示：正常退出不关闭容器请按Ctrl+P+Q进行退出容器</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> docker ps -a  <span class=\"comment\">#显示本机上存在的所有容器</span></span><br><span class=\"line\"><span class=\"comment\"># CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                           PORTS               NAMES</span></span><br><span class=\"line\"><span class=\"comment\"># 634e7ed26d76        d131e0fa2585        \"/bin/bash\"         About an hour ago   Exited (130) About an hour ago                       recursing_goodall</span></span><br><span class=\"line\"><span class=\"comment\"># b72a3410be5        weiyigeek/czabbix   \"/bin/bash\"         41 seconds ago      Up 21 seconds                           priceless_chaplygin</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$docker</span> run -t -i centos /bin/bash  <span class=\"comment\">#创建容器并且运行</span></span><br><span class=\"line\"><span class=\"comment\"># [root@0b9aef4876d3 /]# hostname</span></span><br><span class=\"line\"><span class=\"comment\"># 0b9aef4876d3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$ddocker</span> run -d centoszabbix /bin/sh -c <span class=\"string\">\"echo Hello World,Docker Container\"</span></span><br><span class=\"line\">4e62768b1d9196fc79fd740c103df79c8e3bb09d9c6810aa43976abeda036a26</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$ddocker</span> logs 4e62  <span class=\"comment\">#获取容器输出的信息</span></span><br><span class=\"line\">Hello World,Docker Container</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$docker</span> attach priceless_chaplygin  <span class=\"comment\">#通过上面的ps -a 中names进入想对应的容器</span></span><br><span class=\"line\"><span class=\"comment\">#当多个窗口同时 attach 到同一个容器的时候 所有窗口都会同步显示 。当某个窗口因命令阻塞时,其他窗口也无法执行操作了</span></span><br><span class=\"line\"><span class=\"comment\"># [root@b72a3410be5 /]$ hostname</span></span><br><span class=\"line\"><span class=\"comment\"># b72a3410be5</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$docker</span> <span class=\"built_in\">exec</span> -ti b72 /bin/<span class=\"built_in\">echo</span> <span class=\"string\">\"whoami\"</span>   <span class=\"comment\">#可以通过exec直接执行命令和进入shell</span></span><br><span class=\"line\"><span class=\"comment\"># whoami</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#停止容器</span></span><br><span class=\"line\"><span class=\"comment\">#当需要删除一个在容器中运行的镜像的时候,会导致不能删除镜像[Image]这时候必须先停止再删除容器[container]：</span></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> docker stop 634e7ed26d76  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#镜像的容器ID,前3位即可,然后在删除镜像</span></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> docker rm 634      <span class=\"comment\">#此时再用镜像ID来删除进行,成功则会打印出删除各层信息</span></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> docker rmi -f d131e0fa2585     <span class=\"comment\">#镜像的容器ID,前3位即可,然后在删除镜像</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#导出镜像</span></span><br><span class=\"line\"><span class=\"variable\">$sudo</span> docker <span class=\"built_in\">export</span> 092 &gt; czabbix.tar</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#导入镜像</span></span><br><span class=\"line\"><span class=\"variable\">$cat</span> czabbix.tar | docker import - <span class=\"built_in\">test</span>:latest</span><br><span class=\"line\">sha256:bbb9dbcaa5fff9c5b1b99c978df4dcaeeca3d2200d82fc466f5064931bd3bba2</span><br><span class=\"line\">[root@zabbix ~]<span class=\"comment\"># docker images</span></span><br><span class=\"line\">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\"><span class=\"built_in\">test</span>                latest              bbb9dbcaa5ff        14 seconds ago      202MB</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>补充：使用nsenter工具进入Docker容器</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#获取容器的PID</span></span><br><span class=\"line\"><span class=\"variable\">$PID</span>=$(docker inspect --format <span class=\"string\">\"&#123;&#123; .State.Pid&#125;&#125;\"</span> &lt;container id&gt;)</span><br><span class=\"line\"><span class=\"comment\">#通过得到的这个PID,就可以连接到这个容器：</span></span><br><span class=\"line\"><span class=\"variable\">$nsenter</span> --target <span class=\"variable\">$PID</span> --mount --uts --ipc --net --pid</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#手动获取docker container 运行的PID</span></span><br><span class=\"line\">[root@zabbix ~]$ docker ps -a</span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND             CREATED</span><br><span class=\"line\">092d1b82c6a0        weiyigeek/czabbix   <span class=\"string\">\"/bin/bash\"</span>         17 minutes ago      ck</span><br><span class=\"line\">[root@zabbix ~]$ docker inspect --format <span class=\"string\">\"&#123;&#123; .State.Pid&#125;&#125;\"</span> 092</span><br><span class=\"line\">9030</span><br><span class=\"line\">[root@zabbix ~]$ nsenter --target 9030 --mount --uts --ipc --net --pid</span><br><span class=\"line\">[root@092d1b82c6a0 /]$ cat /etc/redhat-release</span><br><span class=\"line\">CentOS Linux release 7.6.1810 (Core)</span><br><span class=\"line\"><span class=\"comment\">#成功进入该容器,9030就是容器092d1b82c6a0的进程PID</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>Docker load 与 Docker import 的比较</strong><br>描述：导入容器和导入镜像是差不多的但是实际上又是有所区别的</p>\n<ul>\n<li>load：导入镜像存储文件到本地镜像库 而 import：导入一个容器快照到本地镜像库</li>\n<li>容器快照：文件将丢失所有的历史记录和元数据信息(即保留容器当时的快照状态),导入的时候还需要重新制定标签等元数据信息;</li>\n<li>镜像存储：文件将保存完整的记录,并且体积也要大;</li>\n</ul>\n<p><em>总结：</em></p>\n<ul>\n<li>容器的名称是唯一性的如果不指定名称,将会自动生成一个容器名称;</li>\n<li>容器是直接提供应用服务的组件,也是Docker实现快速启停和高效服务器性能的基础</li>\n<li>在生产环境中因为容器自身的轻量性,建议在容器前段引入HA(高可靠性)机制,当出现错误的时候能快速切换到其他容器之中,还能自动重启故障容器;</li>\n</ul>\n<p><br></p>\n<h5 id=\"3-仓库-Repository\"><a href=\"#3-仓库-Repository\" class=\"headerlink\" title=\"3.仓库 [Repository]\"></a>3.仓库 [Repository]</h5><p>描述：Docker 仓库(Repository)类似于代码仓库,是Docker集中存放镜像文件的场所;该概念的引入为Docker镜像文件的分发和管理提供了便捷的途径。<br>仓库注册地址:<a href=\"https://hub.docker.com/\" target=\"_blank\" rel=\"noopener\">https://hub.docker.com/</a><br>安装帮助文档:<a href=\"http://www.widuu.com/docker/installation/ubuntu.html\" target=\"_blank\" rel=\"noopener\">http://www.widuu.com/docker/installation/ubuntu.html</a></p>\n<p>注册服务器是存放仓库的地方,其上往往存放着多个仓库,每个仓库集中存放某一类镜像,往往包括多个镜像文件,通过不同的标签[TAG]来进行区分;</p>\n<ul>\n<li>目前最大的公开仓库是 Docker Hub 存放了数量庞大的镜像提供用户下载</li>\n<li>国内的公开仓库包括Docker Pool等等可以提供稳定的国内访问。</li>\n</ul>\n<p>例如:对于仓库地址dl.dockerpool.com/ubuntu来说,dl.dockerpool.com是注册服务器,ubuntu是仓库名;<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190505225957.png\" alt=\"WeiyiGeek.仓库注册服务器\" title=\"\" class=\"\">\n                <p>WeiyiGeek.仓库注册服务器</p>\n            </figure></p>\n<p>Docker 仓库分类：</p>\n<ul>\n<li>公开仓库(Public)</li>\n<li>私有仓库(Private)</li>\n</ul>\n<p><em>官方与用户提供的镜像比较：</em></p>\n<ul>\n<li>官方：centos 由Docker维护的基础或根镜像;</li>\n<li>个人：user/centos 表示由user用户维护的centos基础镜像;</li>\n</ul>\n<p>镜像仓库操作常用命令:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker login   <span class=\"comment\">#连接并初始化hub仓库 需要输入用户名和密码认证,然后存放于/root/.docker/config.json 文件中</span></span><br><span class=\"line\">docker pull [repository]  <span class=\"comment\">#下载指定仓库到本地</span></span><br><span class=\"line\">docker push [imges]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#实例</span></span><br><span class=\"line\"><span class=\"variable\">$docker</span> pull dl.dockerpool.com:5000/ubuntu:12.04 <span class=\"comment\">#连接其他的注册服务器</span></span><br><span class=\"line\"><span class=\"variable\">$docker</span> images</span><br><span class=\"line\"><span class=\"variable\">$docker</span> tag dl.dockerpool.com:5000/ubuntu:12.04 ubuntu:12.04   <span class=\"comment\">#更新标签与官方标签保持一致</span></span><br><span class=\"line\"><span class=\"variable\">$docker</span> push dl.dockerpool.com:5000/ubuntu:12.04  <span class=\"comment\">#上传到私有镜像</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>（1）创建和使用私有仓库：</strong><br>最快捷还是搭建本地的仓库服务器(注意：配置不当会导致漏洞)<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker run -d -p 5000:5000 registry</span><br><span class=\"line\"><span class=\"comment\">#默认情况下仓库创建在容器的/tmp/register目录下,-v 通过镜像文件存放在宿主机本地的指定路径/opt/data/registry上;</span></span><br><span class=\"line\">$ docker run -d -p 5000:5000 -v /opt/data/registry:/tmp/registry registry </span><br><span class=\"line\"><span class=\"comment\"># -d:容器启动后会进入后台,用户无法看到容器中的信息.</span></span><br><span class=\"line\"><span class=\"comment\"># -p:指定仓库镜像的端口.</span></span><br><span class=\"line\"><span class=\"comment\"># -v:将镜像的存放位置放在本地指定的路径上.</span></span><br></pre></td></tr></table></figure><br>此时会在本地启动一个私有仓库服务,监听端口为5000; 更新标签本地仓库地址并上传到私有仓库之中：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$docker</span> tag ubuntu:14.04 10.0.2.2:5000/<span class=\"built_in\">test</span>  <span class=\"comment\">#更改镜像的标签</span></span><br><span class=\"line\"><span class=\"variable\">$docker</span> pull 10.0.2.2:5000/<span class=\"built_in\">test</span>              <span class=\"comment\">#下载镜像</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#可以以这个来测试是不是存在docker 5000未授权访问漏洞</span></span><br><span class=\"line\">$ curl http://10.0.2.2:5000/v1/search  <span class=\"comment\">#上传成功后可以查看到返回的json字符串</span></span><br></pre></td></tr></table></figure>\n<p><br></p>\n<p><strong>（2）自动创建[Automated Builds]</strong><br>该功能是对于需要经常升级镜像内程序来说十分的方便,用户创建镜像发生更改的时候进行手动更新镜像,并能通过自动创建功能跟踪目标网络,一旦项目发现新的提交则自动执行创建;配置自动创建步骤如下：</p>\n<ul>\n<li>创建登录Docker Hub 绑定Github;</li>\n<li>在Docker Hub中配置一个自动创建</li>\n<li>选取一个目标网站中的项目(需要Dockerfile和分支)</li>\n<li>指定Dockerfile的位置并提交创建,可以在”自动创建页面”跟踪每次创建的状态;</li>\n</ul>\n<p><em>总结：</em></p>\n<ul>\n<li>仓库管理镜像的设计理论与Git差不多,工作流程为文件分发和合作带来的众多优势。</li>\n</ul>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Containers","path":"api/categories/Containers.json"},{"name":"OperationTools","path":"api/categories/OperationTools.json"}],"tags":[{"name":"Docker","path":"api/tags/Docker.json"}]}