<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ Supervisorè¿›ç¨‹ç®¡ç†å·¥å…·å¿«é€Ÿå…¥é—¨ä¸ä½¿ç”¨|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="supervisor">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
        
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>Supervisorè¿›ç¨‹ç®¡ç†å·¥å…·å¿«é€Ÿå…¥é—¨ä¸ä½¿ç”¨</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">Supervisorè¿›ç¨‹ç®¡ç†å·¥å…·å¿«é€Ÿå…¥é—¨ä¸ä½¿ç”¨</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-05-22T11:35:30.000Z" itemprop="datePublished" class="page-time">
  2019-05-22
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/OperationTools/">OperationTools</a></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
  <article id="post-ç³»ç»Ÿè¿ç»´/Application/monitor/Supervisorè¿›ç¨‹ç®¡ç†å·¥å…·å¿«é€Ÿå…¥é—¨ä¸ä½¿ç”¨"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">Supervisorè¿›ç¨‹ç®¡ç†å·¥å…·å¿«é€Ÿå…¥é—¨ä¸ä½¿ç”¨</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-05-22 19:35:30" datetime="2019-05-22T11:35:30.000Z"  itemprop="datePublished">2019-05-22</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/OperationTools/">OperationTools</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]<br><a id="more"></a></p>
<h4 id="0x00-å¿«é€Ÿå…¥é—¨"><a href="#0x00-å¿«é€Ÿå…¥é—¨" class="headerlink" title="0x00 å¿«é€Ÿå…¥é—¨"></a>0x00 å¿«é€Ÿå…¥é—¨</h4><p>æè¿°ï¼šSupervisoræ˜¯ä¸€ä¸ªè¿›ç¨‹ç®¡ç†å·¥å…·,æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯/æœåŠ¡å™¨ç³»ç»Ÿï¼Œå…è®¸å…¶ç”¨æˆ·åœ¨ç±»UNIXæ“ä½œç³»ç»Ÿä¸Šæ§åˆ¶è®¸å¤šè¿›ç¨‹(å®˜æ–¹è§£é‡Š)ã€‚<br>Supervisoræ˜¯ç”¨Pythonå¼€å‘çš„ä¸€å¥—é€šç”¨çš„è¿›ç¨‹ç®¡ç†ç¨‹åºï¼Œèƒ½å°†ä¸€ä¸ªæ™®é€šçš„å‘½ä»¤è¡Œè¿›ç¨‹å˜ä¸ºåå°daemonï¼Œå¹¶ç›‘æ§è¿›ç¨‹çŠ¶æ€ï¼Œå¼‚å¸¸é€€å‡ºæ—¶èƒ½è‡ªåŠ¨é‡å¯è¿˜èƒ½é€šè¿‡ç½‘é¡µç«¯è¿›è¡Œæ§åˆ¶;</p>
<p>å®˜æ–¹ç½‘ç«™ï¼š<a href="http://supervisord.org/" target="_blank" rel="noopener">http://supervisord.org/</a></p>
<p>åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>è„šæœ¬éœ€è¦é€šè¿‡åå°è¿›ç¨‹è¿è¡Œä¸”ä¿è¯å¼‚å¸¸ä¸­æ–­åé‡å¯æœåŠ¡,</li>
</ul>
<p>åŸç†ï¼š<br>å®ƒæ˜¯é€šè¿‡fork/execçš„æ–¹å¼æŠŠè¿™äº›è¢«ç®¡ç†çš„è¿›ç¨‹å½“ä½œsupervisorçš„å­è¿›ç¨‹æ¥å¯åŠ¨ï¼Œè¿™æ ·åªè¦åœ¨supervisorçš„é…ç½®æ–‡ä»¶ä¸­ï¼ŒæŠŠè¦ç®¡ç†çš„è¿›ç¨‹çš„å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„å†™è¿›å»å³å¯ã€‚</p>
<ul>
<li>å®ç°å½“å­è¿›ç¨‹æŒ‚æ‰çš„æ—¶å€™ï¼Œçˆ¶è¿›ç¨‹å¯ä»¥å‡†ç¡®è·å–å­è¿›ç¨‹æŒ‚æ‰çš„ä¿¡æ¯çš„ï¼Œå¯ä»¥é€‰æ‹©æ˜¯å¦è‡ªå·±å¯åŠ¨å’ŒæŠ¥è­¦ã€‚</li>
<li>å¯ä»¥ä¸ºsupervisordæˆ–è€…æ¯ä¸ªå­è¿›ç¨‹ï¼Œè®¾ç½®ä¸€ä¸ªérootçš„userï¼Œè¿™ä¸ªuserå°±å¯ä»¥ç®¡ç†å®ƒå¯¹åº”çš„è¿›ç¨‹ã€‚</li>
</ul>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>ç®€å•ï¼šä¸ç”¨æ‚¨æ‰‹åŠ¨çš„å»ç¼–å†™shellè„šæœ¬æ”¾åœ¨/etc/init.d/ç›®å½•ä¸‹</li>
<li>ç²¾ç¡®ï¼šsupervisorç›‘æ§å­è¿›ç¨‹ï¼Œå¾—åˆ°çš„å­è¿›ç¨‹çŠ¶æ€æ— ç–‘æ˜¯å‡†ç¡®çš„</li>
<li>è¿›ç¨‹ç»„ï¼šå¯ä»¥å¯¹è¿›ç¨‹ç»„ç»Ÿä¸€ç®¡ç†,æŠŠè¿™ä¸ªç»„ä½œä¸ºä¸€ä¸ªå¯¹è±¡è¿›è¡Œç®¡ç†ï¼Œå¦‚å¯åŠ¨ï¼Œåœæ­¢ï¼Œé‡å¯ç­‰ç­‰æ“ä½œ;</li>
<li>é›†ä¸­å¼ç®¡ç†: supervisorç®¡ç†çš„è¿›ç¨‹ï¼Œè¿›ç¨‹ç»„ä¿¡æ¯ï¼Œå…¨éƒ¨éƒ½å†™åœ¨ä¸€ä¸ªiniæ ¼å¼çš„æ–‡ä»¶,è€Œä¸”supervisoræä¾›äº†ä¸€ä¸ªwebç•Œé¢</li>
<li>æœ‰æ•ˆæ€§ï¼šå½“supervisorçš„å­è¿›ç¨‹æŒ‚æ‰çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¼šç›´æ¥ç»™supervisorå‘ä¿¡å·</li>
<li>å¯æ‰©å±•æ€§ï¼šsupervisoræ˜¯ä¸€ä¸ªå¼€æºçš„è½¯ä»¶,æˆ‘ä»¬å¯ä»¥é€šè¿‡eventæœºåˆ¶ä¸xml_rpcå»æ‰©å±•</li>
<li>æƒé™ï¼šä¸ºsupervisordæˆ–è€…æ¯ä¸ªå­è¿›ç¨‹è®¾ç½®ä¸€ä¸ªérootçš„user,è¯¥userç®¡ç†å¯¹åº”çš„è¿›ç¨‹;</li>
<li>å…¼å®¹æ€§ï¼šç”±äºé‡‡ç”¨Pythonç¼–å†™,é€šç”¨æ€§é«˜</li>
</ul>
<p><strong>1.å®‰è£…supervisor</strong><br>ç”±äºsupervisoræ˜¯ä¾èµ–äºpythonç¯å¢ƒçš„,æˆ‘ä»¬åº”è¯¥æå‰å‡†å¤‡è¿™æ ·çš„ç¯å¢ƒ;<br>å®‰è£…ç¯å¢ƒï¼šCentOS Linux release 7.6.1810 (Core)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å®‰è£…æ—¶éœ€è¦ä½¿ç”¨åˆ°easy_installå‘½ä»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå®‰è£…å®ƒ</span></span><br><span class="line"><span class="variable">$yum</span> install -y python-setuptools</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ­£å¼å®‰è£…supervisoræˆ–è€…pipå®‰è£…éƒ½å¯ä»¥</span></span><br><span class="line"><span class="variable">$easy_install</span> supervisor</span><br><span class="line">Finished processing dependencies <span class="keyword">for</span> supervisor  <span class="comment">#æ˜¾ç¤ºåˆ™å®‰è£…å®Œæˆ</span></span><br><span class="line"><span class="comment">#æˆåŠŸå®‰è£…åå¯ä»¥ç™»é™†pythonæ§åˆ¶å°è¾“å…¥import supervisor æŸ¥çœ‹æ˜¯å¦èƒ½æˆåŠŸåŠ è½½ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼šDebian / Ubuntuå¯ä»¥ç›´æ¥é€šè¿‡aptå®‰è£…ï¼š</span></span><br><span class="line">apt-get install supervisor</span><br><span class="line"></span><br><span class="line">supervisoré»˜è®¤çš„å®‰è£…è·¯å¾„ï¼š</span><br><span class="line">&gt; /usr/lib/python2.7/site-packages/supervisor-4.0.3-py2.7.egg/supervisor</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>2.å·¥å…·ä»‹ç»</strong><br>Supervisor å››ä¸ªç»„ä»¶ä»‹ç»ï¼š</p>
<ul>
<li>supervisord :æœåŠ¡å™¨ç«¯éƒ¨åˆ†ç”¨æ¥å¯åŠ¨supervisorå¹¶åˆ¶å®šé…ç½®æ–‡ä»¶,<ul>
<li>å¯åŠ¨supervisorç®¡ç†çš„å­è¿›ç¨‹ï¼Œ</li>
<li>åº”æ¥è‡ªclientsçš„è¯·æ±‚</li>
<li>é‡å¯é—ªé€€æˆ–å¼‚å¸¸é€€å‡ºçš„å­è¿›ç¨‹</li>
<li>æŠŠå­è¿›ç¨‹çš„stderræˆ–stdoutè®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ä¸­</li>
<li>ç”Ÿæˆå’Œå¤„ç†Event</li>
</ul>
</li>
<li>supervisorctlï¼šå‘½ä»¤è¡Œå®¢æˆ·ç«¯(å¯ä»¥è¿æ¥åˆ°è¿œç«¯supervisorä¸Š),<ul>
<li>åˆ©ç”¨å®ƒæ¥æŸ¥çœ‹å­è¿›ç¨‹çŠ¶æ€ï¼Œå¯åŠ¨/åœæ­¢/é‡å¯å­è¿›ç¨‹ï¼Œè·å–runningå­è¿›ç¨‹çš„åˆ—è¡¨;</li>
</ul>
</li>
<li>Web Serverï¼šé€šè¿‡XML_RPCæ¥å®ç°çš„,å¯ä»¥å‘supervisorè¯·æ±‚æ•°æ®,ä¹Ÿå¯ä»¥æ§åˆ¶supervisoråŠå­è¿›ç¨‹</li>
<li>XML_RPCæ¥å£ ï¼šç•™ç»™ç¬¬ä¸‰æ–¹é›†æˆçš„æ¥å£ï¼Œä½ çš„æœåŠ¡å¯ä»¥åœ¨è¿œç¨‹è°ƒç”¨è¿™äº›XML-RPCæ¥å£æ¥æ§åˆ¶supervisordç®¡ç†çš„å­è¿›ç¨‹ï¼Œä¸Šé¢çš„WebæœåŠ¡å™¨å…¶å®ä¹Ÿæ˜¯é€šè¿‡è¿™ä¸ªXML-RPCæ¥å£å®ç°çš„ã€‚</li>
</ul>
<p>å‘½ä»¤è¯¦ç»†<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä»¥ä¸‹å¯åŠ¨é¡ºåºç”±ä¸Šåˆ°ä¸‹ä¼˜å…ˆçº§ï¼Œä¾æ¬¡é€’å‡</span></span><br><span class="line"><span class="variable">$CWD</span>/supervisord.conf</span><br><span class="line"><span class="variable">$CWD</span>/etc/supervisord.conf</span><br><span class="line">/etc/supervisord.conf</span><br><span class="line">/etc/supervisor/supervisord.conf (since Supervisor 3.3.0)</span><br><span class="line">../etc/supervisord.conf (Relative to the executable)</span><br><span class="line">../supervisord.conf (Relative to the executable)</span><br><span class="line"></span><br><span class="line">supervisord -c /etc/supervisor/supervisord.conf</span><br><span class="line"><span class="comment">#é»˜è®¤å»æ‰¾$CWD/supervisord.confï¼Œä¹Ÿå°±æ˜¯å½“å‰ç›®å½•</span></span><br><span class="line"><span class="comment">#é»˜è®¤$CWD/etc/supervisord.confï¼Œä¹Ÿå°±å½“å‰ç›®å½•ä¸‹çš„etcç›®å½•</span></span><br><span class="line"><span class="comment">#é»˜è®¤å»æ‰¾/etc/supervisord.confçš„é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment">#æœ€ååˆ°æŒ‡å®šè·¯å¾„ä¸‹å»æ‰¾é…ç½®æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><br><br></p>
<p>å®¢æˆ·ç«¯å‘½ä»¤supervisorctlï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åŸºç¡€å‘½ä»¤</span></span><br><span class="line">supervisorctl [Options]</span><br><span class="line"><span class="comment"># -c, --configuration é…ç½®æ–‡ä»¶è·¯å¾„(é»˜è®¤/etc/supervisor .conf)</span></span><br><span class="line"><span class="comment"># -i, --interactive äº¤äº’å¼shell</span></span><br><span class="line"><span class="comment"># -s, --serverurl URL  (default â€œhttp://localhost:9001â€) #éœ€è¦å¯¹ç«¯å¼€å¯ç›‘å¬</span></span><br><span class="line"><span class="comment"># -u, --username 	è¿œç¨‹çš„supervisor serverè´¦å·</span></span><br><span class="line"><span class="comment"># -p, --password 	è¿œç¨‹çš„supervisor serverå¯†ç </span></span><br><span class="line"><span class="comment"># -r, --history-file  ä¿æŒreadlineå†å²è®°å½•(å¦‚æœreadlineå¯ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åŠ¨ä½œå‘½ä»¤</span></span><br><span class="line">supervisorctl <span class="built_in">help</span> &lt;action&gt;</span><br><span class="line">supervisorctl add/remove &lt;name&gt;  <span class="comment">#æ¿€æ´»æˆ–è€…ç§»å‡º è¿›ç¨‹/ç»„é…ç½®ä¸­çš„ä»»ä½•æ›´æ–°</span></span><br><span class="line">supervisorctl start/update/stop/status/clear/pid/restart  all</span><br><span class="line"><span class="comment">#ä¸Šé¢çš„å‚æ•°é™¤äº†allï¼šæ‰€æœ‰ä»¥å¤–è¿˜æœ‰</span></span><br><span class="line"><span class="comment">#&lt;gname&gt; / &lt;name&gt;  :æŒ‡å®šç»„ã€ç”¨æˆ·</span></span><br><span class="line"><span class="comment">#update:é‡æ–°åŠ è½½é…ç½®å’Œæ·»åŠ /åˆ é™¤å¿…è¦çš„ï¼Œå¹¶å°†é‡æ–°å¯åŠ¨å—å½±å“çš„ç¨‹åº</span></span><br><span class="line"><span class="comment">#pid : å¾—åˆ°ä¸»æ§åˆ¶å™¨çš„PIDã€‚</span></span><br><span class="line"></span><br><span class="line">supervisorctl <span class="built_in">fg</span> &lt;process&gt; <span class="comment">#è¯‘æ–‡ï¼šè¿æ¥åˆ°å‰å°æ¨¡å¼ä¸‹çš„è¿›ç¨‹ï¼ŒæŒ‰Ctrl+Cé€€å‡ºå‰å°</span></span><br><span class="line">supervisorctl reload/reread/signal/shutdown <span class="comment">#é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment">#reread:é‡æ–°åŠ è½½å®ˆæŠ¤è¿›ç¨‹çš„é…ç½®æ–‡ä»¶ï¼Œæ— éœ€æ·»åŠ /åˆ é™¤(æ— éœ€é‡æ–°å¯åŠ¨)</span></span><br><span class="line"></span><br><span class="line">supervisorctl tail [-f] &lt;name&gt; [stdout|stderr] (default stdout) <span class="comment">#è¾“å‡ºè¿›ç¨‹æ—¥å¿—çš„æœ€åä¸€éƒ¨åˆ†Ex</span></span><br></pre></td></tr></table></figure></p>
<p>Signals é…ç½®ï¼š<br>ç›‘æ§å™¨ç¨‹åºå¯èƒ½ä¼šè¢«å‘é€ä¿¡å·ï¼Œä½¿å…¶åœ¨è¿è¡Œæ—¶æ‰§è¡ŒæŸäº›æ“ä½œ,æ‚¨å¯ä»¥å°†è¿™äº›ä¿¡å·ä¸­çš„ä»»ä½•ä¸€ä¸ªå‘é€åˆ°å•ä¸ªä¸»è¿›ç¨‹id,ä½†æ˜¯éœ€è¦åœ¨supervisorçš„é…ç½®æ–‡ä»¶è¿›è¡Œæ›´æ”¹;<br>é…ç½®æ–‡ä»¶ï¼š[supervisord]å‚æ•°éƒ¨åˆ†,å°†supervisord.pidå‚æ•°å‰é¢çš„;å»æ‰</p>
<ul>
<li>SIGTERM : ç›‘æ§å™¨åŠå…¶æ‰€æœ‰å­è¿›ç¨‹å°†å…³é—­ã€‚è¿™å¯èƒ½éœ€è¦å‡ ç§’é’Ÿã€‚</li>
<li>SIGINT :</li>
<li>SIGQUIT : åŒä¸Š</li>
<li>SIGHUP ï¼š ç›‘æ§å™¨å°†åœæ­¢æ‰€æœ‰è¿›ç¨‹ï¼Œä»å®ƒæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªé…ç½®æ–‡ä»¶é‡æ–°åŠ è½½é…ç½®ï¼Œå¹¶å¯åŠ¨æ‰€æœ‰è¿›ç¨‹(é‡å¯)ã€‚</li>
<li>SIGUSR2 ï¼šç›‘æ§å™¨å°†å…³é—­å¹¶é‡æ–°æ‰“å¼€ä¸»æ´»åŠ¨æ—¥å¿—å’Œæ‰€æœ‰å­æ—¥å¿—æ–‡ä»¶ã€‚</li>
</ul>
<p><br></p>
<h4 id="0x01-é…ç½®æ–‡ä»¶"><a href="#0x01-é…ç½®æ–‡ä»¶" class="headerlink" title="0x01 é…ç½®æ–‡ä»¶"></a>0x01 é…ç½®æ–‡ä»¶</h4><p>Supervisorå®‰è£…åä¸ä¼šè‡ªåŠ¨ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œéœ€è¦ä½¿ç”¨å‘½ä»¤ echo_supervisord_conf æ¥ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼š<br>å¸¸è§„è·¯å¾„ï¼š</p>
<ul>
<li>supervisorçš„é…ç½®æ–‡ä»¶ï¼š/etc/supervisor/supervisord.conf </li>
<li>ç®¡ç†çš„å­è¿›ç¨‹é…ç½®æ–‡ä»¶ï¼š/etc/supervisor/conf.d/*.ini <ul>
<li>å¼€å§‹ç»™è‡ªå·±éœ€è¦çš„è„šæœ¬ç¨‹åºç¼–å†™ä¸€ä¸ªå­è¿›ç¨‹é…ç½®æ–‡ä»¶ï¼Œè®©supervisoræ¥ç®¡ç†å®ƒ</li>
</ul>
</li>
</ul>
<p><em>ä¸»é…ç½®æ–‡ä»¶</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line">[root@Szabbix ~]<span class="comment"># mkdir -vp  /etc/supervisor/conf.d/</span></span><br><span class="line">mkdir: å·²åˆ›å»ºç›®å½• <span class="string">"/etc/supervisor/conf.d"</span></span><br><span class="line">[root@Szabbix ~]<span class="comment"># echo_supervisord_conf &gt; /etc/supervisor/supervisor.conf</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸»é…ç½®æ–‡ä»¶è®²è§£ windowsé…ç½®æ–‡ä»¶é£æ ¼</span></span><br><span class="line">; Sample supervisor config file.</span><br><span class="line">; http://supervisord.org/configuration.html.</span><br><span class="line"></span><br><span class="line">[unix_http_server]</span><br><span class="line">file=/tmp/supervisor.sock   ; <span class="comment">#å»ºè®®ä¿®æ”¹ä¸º /var/run ç›®å½•,é¿å…è¢«ç³»ç»Ÿåˆ é™¤åŒ…æ‹¬ pid / </span></span><br><span class="line">;chmod=0700                 ; socket file mode (default 0700)</span><br><span class="line">;chown=nobody:nogroup       ; socket file uid:gid owner</span><br><span class="line">username=user              ; default is no username (open server)  <span class="comment">#è®¾ç½®sockè´¦å·å¯†ç </span></span><br><span class="line">password=123               ; default is no password (open server)</span><br><span class="line"></span><br><span class="line">[inet_http_server]         ; inet (TCP) server disabled by default</span><br><span class="line">port=192.168.56.102:9001        ; ip_address:port specifier, *:port <span class="keyword">for</span> all iface</span><br><span class="line">username=user              ; default is no username (open server)</span><br><span class="line">password=123               ; default is no password (open server)</span><br><span class="line"></span><br><span class="line">[supervisord]</span><br><span class="line">logfile=/tmp/supervisord.log ; main <span class="built_in">log</span> file; default <span class="variable">$CWD</span>/supervisord.log</span><br><span class="line">logfile_maxbytes=50MB        ; æœ€å¤§ä¸»æ—¥å¿—æ–‡ä»¶å­—èŠ‚;é»˜è®¤50 mb</span><br><span class="line">logfile_backups=10           ; ä¸»æ—¥å¿—æ–‡ä»¶å¤‡ä»½;0è¡¨ç¤ºæ²¡æœ‰ï¼Œé»˜è®¤ä¸º10</span><br><span class="line">loglevel=info                ; <span class="built_in">log</span> level; default info; others: debug,warn,trace</span><br><span class="line">pidfile=/tmp/supervisord.pid ; supervisord pidfile; default supervisord.pid</span><br><span class="line">nodaemon=<span class="literal">false</span>               ; start <span class="keyword">in</span> foreground <span class="keyword">if</span> <span class="literal">true</span>; default <span class="literal">false</span></span><br><span class="line">minfds=1024                  ; min. avail startup file descriptors; default 1024</span><br><span class="line">minprocs=200                 ; min. avail process descriptors;default 200</span><br><span class="line"><span class="built_in">umask</span>=022                   ; process file creation <span class="built_in">umask</span>; default 022</span><br><span class="line">;user=supervisord            ; setuid to this UNIX account at startup; recommended <span class="keyword">if</span> root</span><br><span class="line">;identifier=supervisor       ; supervisord identifier, default is <span class="string">'supervisor'</span></span><br><span class="line">;directory=/tmp              ; default is not to <span class="built_in">cd</span> during start</span><br><span class="line">;nocleanup=<span class="literal">true</span>              ; don<span class="string">'t clean up tempfiles at start; default false'</span></span><br><span class="line">;childlogdir=/tmp            ; <span class="string">'AUTO'</span> child <span class="built_in">log</span> dir, default <span class="variable">$TEMP</span></span><br><span class="line">;environment=KEY=<span class="string">"value"</span>     ; key value pairs to add to environment</span><br><span class="line">;strip_ansi=<span class="literal">false</span>            ; strip ansi escape codes <span class="keyword">in</span> logs; def. <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">; The rpcinterface:supervisor éƒ¨åˆ†å¿…é¡»ä¿ç•™åœ¨é…ç½®æ–‡ä»¶ä¸­</span><br><span class="line">ï¼›ä»¥ä¾¿RPC (supervisorctl/web interface)å·¥ä½œã€‚</span><br><span class="line">ï¼›å¯ä»¥é€šè¿‡åœ¨å•ç‹¬çš„[rpcinterface:x]å°èŠ‚ä¸­å®šä¹‰å®ƒä»¬æ¥æ·»åŠ å…¶ä»–æ¥å£ã€‚</span><br><span class="line"></span><br><span class="line">[rpcinterface:supervisor]</span><br><span class="line">supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface</span><br><span class="line"></span><br><span class="line">; The supervisorctl section ï¼šè®¾ç½®supervisorctlè¿æ¥äº¤äº’åˆ°æœ¬æœºçš„å‚æ•°</span><br><span class="line">; supervisord.  configure it match the settings <span class="keyword">in</span> either the unix_http_server inet_http_server section.</span><br><span class="line"></span><br><span class="line">[supervisorctl]</span><br><span class="line">serverurl=unix:///tmp/supervisor.sock ; use a unix:// URL  <span class="keyword">for</span> a unix socket</span><br><span class="line">;serverurl=http://127.0.0.1:9001 ; use an http:// url to specify an inet socket</span><br><span class="line">;username=chris              ; should be same as <span class="keyword">in</span> [*_http_server] <span class="keyword">if</span> <span class="built_in">set</span></span><br><span class="line">;password=123                ; should be same as <span class="keyword">in</span> [*_http_server] <span class="keyword">if</span> <span class="built_in">set</span></span><br><span class="line">;prompt=mysupervisor         ; cmd line prompt (default <span class="string">"supervisor"</span>)</span><br><span class="line">;history_file=~/.sc_history  ; use readline <span class="built_in">history</span> <span class="keyword">if</span> available</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸‹é¢çš„ç¤ºä¾‹ç¨‹åºå°èŠ‚æ˜¾ç¤ºäº†éœ€è¦ç›‘æ§ç¨‹åºçš„è®¾ç½®é¡¹,æ³¨æ„è®¾ç½®çš„åç§°æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œç®¡ç†</span></span><br><span class="line">;[program:theprogramname]  <span class="comment">#é¡¹ç›®å</span></span><br><span class="line">;<span class="built_in">command</span>=/bin/cat              ; <span class="comment">#è„šæœ¬æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">;process_name=%(program_name)s ; <span class="comment">#é»˜è®¤è¿›ç¨‹åç§°æ˜¯æˆ‘ä¸Šé¢è®¾ç½®çš„é¡¹ç›®åç§°</span></span><br><span class="line">;numprocs=1                    ; <span class="comment">#å¯åŠ¨è¿›ç¨‹çš„æ•°ç›®ã€‚å½“ä¸ä¸º1æ—¶ï¼Œå°±æ˜¯è¿›ç¨‹æ± çš„æ¦‚å¿µï¼Œæ³¨æ„process_nameçš„è®¾ç½®é»˜è®¤ä¸º1  ï¼› éå¿…é¡»è®¾ç½®</span></span><br><span class="line">;directory=/tmp                ; <span class="comment">#è„šæœ¬å¯åŠ¨è¿è¡Œç›®å½•</span></span><br><span class="line">;<span class="built_in">umask</span>=022                     ; <span class="built_in">umask</span> <span class="keyword">for</span> process (default None)</span><br><span class="line">;priority=999                  ; <span class="comment">#å­è¿›ç¨‹å¯åŠ¨å…³é—­ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§ä½çš„æœ€å…ˆå¯åŠ¨ï¼Œå…³é—­çš„æ—¶å€™æœ€åå…³é—­</span></span><br><span class="line">;autostart=<span class="literal">true</span>                ; <span class="comment">#supervisorå¯åŠ¨çš„æ—¶å€™æ˜¯å¦éšç€åŒæ—¶å¯åŠ¨ï¼Œé»˜è®¤True</span></span><br><span class="line">;startsecs=1                   ; <span class="comment">#è¿™ä¸ªé€‰é¡¹æ˜¯å­è¿›ç¨‹å¯åŠ¨å¤šå°‘ç§’ä¹‹åï¼Œæ­¤æ—¶çŠ¶æ€å¦‚æœæ˜¯runningï¼Œåˆ™æˆ‘ä»¬è®¤ä¸ºå¯åŠ¨æˆåŠŸäº†ã€‚é»˜è®¤å€¼ä¸º1</span></span><br><span class="line">;startretries=3                ; <span class="comment">#å¯åŠ¨æ—¶ä¸²è¡Œå¯åŠ¨å¤±è´¥å°è¯•çš„æœ€å¤šæ¬¡æ•°(é»˜è®¤3æ¬¡)ï¼Œè¶…è¿‡åsupervisorå°†æŠŠæ­¤è¿›ç¨‹çš„çŠ¶æ€ç½®ä¸ºFAIL</span></span><br><span class="line"></span><br><span class="line">;autorestart=unexpected        ;<span class="comment">#è®¾ç½®å­è¿›ç¨‹æŒ‚æ‰åè‡ªåŠ¨é‡å¯çš„æƒ…å†µï¼Œå½“ç¨‹åºexitçš„æ—¶å€™ï¼Œè¿™ä¸ªprogramä¸ä¼šè‡ªåŠ¨é‡å¯,é»˜è®¤unexpected</span></span><br><span class="line"><span class="comment">#æœ‰ä¸‰ä¸ªé€‰é¡¹ï¼Œfalse,unexpectedå’Œtrueã€‚å¦‚æœä¸ºfalseçš„æ—¶å€™ï¼Œæ— è®ºä»€ä¹ˆæƒ…å†µä¸‹ï¼Œéƒ½ä¸ä¼šè¢«é‡æ–°å¯åŠ¨ï¼Œå¦‚æœä¸ºunexpectedï¼Œåªæœ‰å½“è¿›ç¨‹çš„é€€å‡ºç ä¸åœ¨ä¸‹é¢çš„exitcodesé‡Œé¢å®šä¹‰çš„</span></span><br><span class="line"><span class="comment"># ;å¦‚æœä¸ºfalseçš„æ—¶å€™ï¼Œæ— è®ºä»€ä¹ˆæƒ…å†µä¸‹ï¼Œéƒ½ä¸ä¼šè¢«é‡æ–°å¯åŠ¨ï¼Œ</span></span><br><span class="line"><span class="comment"># ;å¦‚æœä¸ºunexpectedï¼Œåªæœ‰å½“è¿›ç¨‹çš„é€€å‡ºç ä¸åœ¨ä¸‹é¢çš„exitcodesé‡Œé¢å®šä¹‰çš„é€€å‡ºç çš„æ—¶å€™ï¼Œæ‰ä¼šè¢«è‡ªåŠ¨é‡å¯</span></span><br><span class="line"><span class="comment"># ;å½“ä¸ºtrueçš„æ—¶å€™ï¼Œåªè¦å­è¿›ç¨‹æŒ‚æ‰ï¼Œå°†ä¼šè¢«æ— æ¡ä»¶çš„é‡å¯</span></span><br><span class="line">;exitcodes=0                   ; <span class="comment">#æ³¨æ„å’Œä¸Šé¢çš„çš„autorestart=unexpectedå¯¹åº”ï¼Œexitcodesé‡Œé¢çš„å®šä¹‰çš„é€€å‡ºç æ˜¯expectedçš„ã€‚</span></span><br><span class="line"></span><br><span class="line">;stopsignal=QUIT               ; <span class="comment">#ç¨‹åœæ­¢ä¿¡å·å¯ä»¥ä¸ºTERM, HUP, INT, QUIT, KILL, USR1, or USR2ç­‰ä¿¡å·,é»˜è®¤ä¸ºTERM ã€‚å½“ç”¨è®¾å®šçš„ä¿¡å·å»å¹²æ‰è¿›ç¨‹ï¼Œé€€å‡ºç ä¼šè¢«è®¤ä¸ºæ˜¯expectedéå¿…é¡»è®¾ç½®</span></span><br><span class="line">;stopwaitsecs=10               ; <span class="comment">#å½“æˆ‘ä»¬å‘å­è¿›ç¨‹å‘é€stopsignalä¿¡å·åï¼Œåˆ°ç³»ç»Ÿè¿”å›ä¿¡æ¯ç»™supervisordï¼Œæ‰€ç­‰å¾…çš„æœ€å¤§æ—¶é—´è¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œsupervisordä¼šå‘è¯¥å­è¿›ç¨‹å‘é€ä¸€ä¸ªå¼ºåˆ¶killçš„ä¿¡å·ã€‚</span></span><br><span class="line"></span><br><span class="line">;stopasgroup=<span class="literal">false</span>             ; <span class="comment">#ç®¡ç†çš„å­è¿›ç¨‹ï¼Œè¿™ä¸ªå­è¿›ç¨‹æœ¬èº«è¿˜æœ‰å­è¿›ç¨‹ </span></span><br><span class="line"><span class="comment">#å¦‚æœä»…ä»…å¹²æ‰supervisordçš„å­è¿›ç¨‹çš„è¯ï¼Œå­è¿›ç¨‹çš„å­è¿›ç¨‹æœ‰å¯èƒ½ä¼šå˜æˆå­¤å„¿è¿›ç¨‹,æ‰€ä»¥å’±ä»¬å¯ä»¥è®¾ç½®å¯ä¸ªé€‰é¡¹ï¼ŒæŠŠæ•´ä¸ªè¯¥å­è¿›ç¨‹çš„æ•´ä¸ªè¿›ç¨‹ç»„éƒ½å¹²æ‰ã€‚ </span></span><br><span class="line"><span class="comment">#è®¾ç½®ä¸ºtrueçš„è¯ï¼Œä¸€èˆ¬killasgroupä¹Ÿä¼šè¢«è®¾ç½®ä¸ºtrueã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥é€‰é¡¹å‘é€çš„æ˜¯stopä¿¡å·ï¼Œé»˜è®¤ä¸ºfalseã€‚ã€‚éå¿…é¡»è®¾ç½®</span></span><br><span class="line">;killasgroup=<span class="literal">false</span>             ; SIGKILL the UNIX process group (def <span class="literal">false</span>),åŒä¸è¿‡ä¸Šå‘é€çš„æ˜¯KILLä¿¡å·</span><br><span class="line">;user=chrism                   ; <span class="comment">#è„šæœ¬è¿è¡Œçš„ç”¨æˆ·èº«ä»½ </span></span><br><span class="line">;redirect_stderr=<span class="literal">true</span>          ; <span class="comment">#å¦‚æœä¸ºtrueï¼Œåˆ™stderrçš„æ—¥å¿—ä¼šè¢«å†™å…¥stdoutæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œé»˜è®¤ false </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ ‡å‡†è¾“å‡º æ—¥å¿—</span></span><br><span class="line">;stdout_logfile=/a/path        ; stdout <span class="built_in">log</span> path, NONE <span class="keyword">for</span> none; default AUTO</span><br><span class="line">;stdout_logfile_maxbytes=1MB   ; max <span class="comment"># logfile bytes b4 rotation (default 50MB)</span></span><br><span class="line">;stdout_logfile_backups=10     ; <span class="comment"># of stdout logfile backups (0 means none, default 10)</span></span><br><span class="line">;stdout_capture_maxbytes=1MB   ; number of bytes <span class="keyword">in</span> <span class="string">'capturemode'</span> (default 0)</span><br><span class="line">;stdout_events_enabled=<span class="literal">false</span>   ; emit events on stdout writes (default <span class="literal">false</span>)</span><br><span class="line">;stdout_syslog=<span class="literal">false</span>           ; send stdout to syslog with process name (default <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ ‡å‡†é”™è¯¯ æ—¥å¿—</span></span><br><span class="line">;stderr_logfile=/a/path        ; stderr <span class="built_in">log</span> path, NONE <span class="keyword">for</span> none; default AUTO</span><br><span class="line">;stderr_logfile_maxbytes=1MB   ; max <span class="comment"># logfile bytes b4 rotation (default 50MB)</span></span><br><span class="line">;stderr_logfile_backups=10     ; <span class="comment"># of stderr logfile backups (0 means none, default 10)</span></span><br><span class="line">;stderr_capture_maxbytes=1MB   ; number of bytes <span class="keyword">in</span> <span class="string">'capturemode'</span> (default 0)</span><br><span class="line">;stderr_events_enabled=<span class="literal">false</span>   ; emit events on stderr writes (default <span class="literal">false</span>)</span><br><span class="line">;stderr_syslog=<span class="literal">false</span>           ; send stderr to syslog with process name (default <span class="literal">false</span>)</span><br><span class="line">;environment=A=<span class="string">"1"</span>,B=<span class="string">"2"</span>       ; process environment additions (def no adds) ï¼Œè¯¥å­è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ï¼Œå’Œåˆ«çš„å­è¿›ç¨‹æ˜¯ä¸å…±äº«çš„</span><br><span class="line">;serverurl=AUTO                ; override serverurl computation (childutils)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">; The sample eventlistener section below shows all possible eventlistener</span><br><span class="line">; subsection values.  Create one or more <span class="string">'real'</span> eventlistener: sections to be</span><br><span class="line">; able to handle event notifications sent by supervisord.</span><br><span class="line"></span><br><span class="line">;[eventlistener:theeventlistenername]</span><br><span class="line">;<span class="built_in">command</span>=/bin/eventlistener    ; the program (relative uses PATH, can take args)</span><br><span class="line">;process_name=%(program_name)s ; process_name expr (default %(program_name)s)</span><br><span class="line">;numprocs=1                    ; number of processes copies to start (def 1)</span><br><span class="line">;events=EVENT                  ; event notif. types to subscribe to (req<span class="string">'d)'</span></span><br><span class="line">;buffer_size=10                ; event buffer queue size (default 10)</span><br><span class="line">;directory=/tmp                ; directory to cwd to before <span class="built_in">exec</span> (def no cwd)</span><br><span class="line">;<span class="built_in">umask</span>=022                     ; <span class="built_in">umask</span> <span class="keyword">for</span> process (default None)</span><br><span class="line">;priority=-1                   ; the relative start priority (default -1)</span><br><span class="line">;autostart=<span class="literal">true</span>                ; start at supervisord start (default: <span class="literal">true</span>)</span><br><span class="line">;startsecs=1                   ; <span class="comment"># of secs prog must stay up to be running (def. 1)</span></span><br><span class="line">;startretries=3                ; max <span class="comment"># of serial start failures when starting (default 3)</span></span><br><span class="line">;autorestart=unexpected        ; autorestart <span class="keyword">if</span> exited after running (def: unexpected)</span><br><span class="line">;exitcodes=0                   ; <span class="string">'expected'</span> <span class="built_in">exit</span> codes used with autorestart (default 0)</span><br><span class="line">;stopsignal=QUIT               ; signal used to <span class="built_in">kill</span> process (default TERM)</span><br><span class="line">;stopwaitsecs=10               ; max num secs to <span class="built_in">wait</span> b4 SIGKILL (default 10)</span><br><span class="line">;stopasgroup=<span class="literal">false</span>             ; send stop signal to the UNIX process group (default <span class="literal">false</span>)</span><br><span class="line">;killasgroup=<span class="literal">false</span>             ; SIGKILL the UNIX process group (def <span class="literal">false</span>)</span><br><span class="line">;user=chrism                   ; setuid to this UNIX account to run the program</span><br><span class="line">;redirect_stderr=<span class="literal">false</span>         ; redirect_stderr=<span class="literal">true</span> is not allowed <span class="keyword">for</span> eventlisteners</span><br><span class="line">;stdout_logfile=/a/path        ; stdout <span class="built_in">log</span> path, NONE <span class="keyword">for</span> none; default AUTO</span><br><span class="line">;stdout_logfile_maxbytes=1MB   ; max <span class="comment"># logfile bytes b4 rotation (default 50MB)</span></span><br><span class="line">;stdout_logfile_backups=10     ; <span class="comment"># of stdout logfile backups (0 means none, default 10)</span></span><br><span class="line">;stdout_events_enabled=<span class="literal">false</span>   ; emit events on stdout writes (default <span class="literal">false</span>)</span><br><span class="line">;stdout_syslog=<span class="literal">false</span>           ; send stdout to syslog with process name (default <span class="literal">false</span>)</span><br><span class="line">;stderr_logfile=/a/path        ; stderr <span class="built_in">log</span> path, NONE <span class="keyword">for</span> none; default AUTO</span><br><span class="line">;stderr_logfile_maxbytes=1MB   ; max <span class="comment"># logfile bytes b4 rotation (default 50MB)</span></span><br><span class="line">;stderr_logfile_backups=10     ; <span class="comment"># of stderr logfile backups (0 means none, default 10)</span></span><br><span class="line">;stderr_events_enabled=<span class="literal">false</span>   ; emit events on stderr writes (default <span class="literal">false</span>)</span><br><span class="line">;stderr_syslog=<span class="literal">false</span>           ; send stderr to syslog with process name (default <span class="literal">false</span>)</span><br><span class="line">;environment=A=<span class="string">"1"</span>,B=<span class="string">"2"</span>       ; process environment additions</span><br><span class="line">;serverurl=AUTO                ; override serverurl computation (childutils)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;è®¾ç½®æˆ‘ä»¬ä¸Šé¢ç¨‹åºè®¾ç½®æ§åˆ¶,å¹¶å°†å®ƒä»¬æ”¾å…¥ç‰¹å®šå¾—æˆ‘ç»„</span><br><span class="line"></span><br><span class="line">;[group:thegroupname]</span><br><span class="line">;programs=progname1,progname2  ; each refers to <span class="string">'x'</span> <span class="keyword">in</span> [program:x] definitions</span><br><span class="line">;priority=999                  ; ç›¸å¯¹å¯åŠ¨ä¼˜å…ˆçº§(é»˜è®¤999)</span><br><span class="line"></span><br><span class="line">; The [include] section can just contain the <span class="string">"files"</span> setting.  This</span><br><span class="line">; setting can list multiple files (separated by whitespace or</span><br><span class="line">; newlines).  It can also contain wildcards.  The filenames are</span><br><span class="line">; interpreted as relative to this file.  Included files *cannot*</span><br><span class="line">; include files themselves.</span><br><span class="line"></span><br><span class="line">[include]</span><br><span class="line">files = conf.d/*.ini</span><br></pre></td></tr></table></figure></p>
<p><br><br><em>å­è¿›ç¨‹ç®¡ç†é…ç½®æ–‡ä»¶ç¤ºä¾‹</em><br>å¦‚ä»»æ„å®šä¹‰ä¸€ä¸ªå’Œè„šæœ¬ç›¸å…³çš„é¡¹ç›®åç§°çš„é€‰é¡¹ç»„ï¼ˆ/etc/supervisor/conf.d/test.confï¼‰ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[program:weiyigeek] <span class="comment">#è¯´æ˜åŒä¸Š</span></span><br><span class="line">directory=/opt/bin </span><br><span class="line"><span class="built_in">command</span>=/usr/bin/python /opt/bin/weiyigeek.py </span><br><span class="line">autostart=<span class="literal">true</span> </span><br><span class="line">autorestart=<span class="literal">false</span> </span><br><span class="line">stderr_logfile=/tmp/weiyigeek_stderr.log </span><br><span class="line">stdout_logfile=/tmp/weiyigeek_stdout.log </span><br><span class="line"><span class="comment">#user = weiyigeek</span></span><br></pre></td></tr></table></figure></p>
<h4 id="0x02-supervisorå®æˆ˜"><a href="#0x02-supervisorå®æˆ˜" class="headerlink" title="0x02 supervisorå®æˆ˜"></a>0x02 supervisorå®æˆ˜</h4><p>æ¯”å¦‚ï¼šæˆ‘ä»¬å†™ä¸€ä¸ªshellè„šæœ¬æ¥ç›‘æ§ç»Ÿè®¡TCPè¿æ¥çš„æ•°é‡<br>nano tcpCount.sh<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  count=$(netstat -tlnp|wc -l)</span><br><span class="line">  count=$((count - 2))</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"å½“å‰TCPè¿æ¥æ•°é‡ï¼š<span class="variable">$&#123;count&#125;</span>"</span></span><br><span class="line">  sleep 3</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></p>
<p>Step 1.æˆ‘ä»¬åœ¨è¿›ç¨‹ç®¡ç†é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®å­è¿›ç¨‹ç›‘æ§<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æˆ‘ä»¬éœ€è¦åœ¨ä¸»é…ç½®æ–‡ä»¶ä¸­å»æ‰ [include] å‚æ•°çš„ ;</span></span><br><span class="line">[include]</span><br><span class="line">files = conf.d/*.ini</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¼–è¾‘æˆ‘ä»¬ç›‘æ§é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$nano</span> /etc/supervisor/conf.d/test.ini</span><br><span class="line">[program:weiyigeek]</span><br><span class="line">process_name=%(program_name)s</span><br><span class="line">directory=/tmp/</span><br><span class="line"><span class="built_in">command</span>=/bin/bash tcpCount.sh</span><br><span class="line">autostart=<span class="literal">true</span></span><br><span class="line">autorestart=<span class="literal">false</span></span><br><span class="line">redirect_stderr=<span class="literal">true</span></span><br><span class="line">stdout_logfile=/tmp/weiyigeek.stderr.log</span><br></pre></td></tr></table></figure></p>
<p>Step 2.å¯åŠ¨supervisorå¹¶æŸ¥çœ‹çŠ¶æ€<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯åŠ¨supervisoræœåŠ¡</span></span><br><span class="line">supervisord -c /etc/supervisor/supervisor.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#äº¤äº’å¼è¿æ¥sockè¿›è¡ŒæŸ¥çœ‹</span></span><br><span class="line"><span class="comment">#[supervisorctl] éœ€è¦è¿›è¡Œè®¾ç½®æ˜¯å¦æ˜¯éœ€è¦å…¶ä»–ä¸»æœºè¿æ¥æŸ¥çœ‹</span></span><br><span class="line"><span class="variable">$supervisorctl</span> -s unix:///tmp/supervisor.sock status</span><br><span class="line">weiyigeek                        STOPPED   May 25 11:18 AM</span><br><span class="line"></span><br><span class="line"><span class="variable">$supervisorctl</span> -s unix:///tmp/supervisor.sock  -u user  -p 123 -i</span><br><span class="line">supervisor&gt; <span class="built_in">help</span></span><br><span class="line">default commands (<span class="built_in">type</span> <span class="built_in">help</span> &lt;topic&gt;):</span><br><span class="line">=====================================</span><br><span class="line">add    <span class="built_in">exit</span>      open  reload  restart   start   tail</span><br><span class="line">avail  <span class="built_in">fg</span>        pid   remove  shutdown  status  update</span><br><span class="line">clear  maintail  quit  reread  signal    stop    version</span><br><span class="line"></span><br><span class="line">supervisor&gt; version</span><br><span class="line">4.0.3</span><br><span class="line"></span><br><span class="line">supervisor&gt; status</span><br><span class="line">weiyigeek                        RUNNING   pid 4220, uptime 0:05:11</span><br><span class="line"></span><br><span class="line">supervisor&gt; tail -f weiyigeek  <span class="comment">#æŸ¥çœ‹æ ‡å‡†è¾“å‡º</span></span><br><span class="line">==&gt; Press Ctrl-C to <span class="built_in">exit</span> &lt;==</span><br><span class="line">å½“å‰TCPè¿æ¥æ•°é‡ï¼š4</span><br><span class="line">å½“å‰TCPè¿æ¥æ•°é‡ï¼š4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#è‡ªèº«çš„pidä¸å­è¿›ç¨‹çš„pid</span></span><br><span class="line">supervisor&gt; pid</span><br><span class="line">4219</span><br><span class="line">supervisor&gt; pid weiyigeek</span><br><span class="line">4220</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœæ­¢è¿›ç¨‹</span></span><br><span class="line">supervisor&gt; stop weiyigeek</span><br><span class="line">weiyigeek: stopped</span><br></pre></td></tr></table></figure></p>
<p>Step3.é€šè¿‡supervisorç½‘é¡µç«¯è¿›è¡Œç®¡ç†</p>
<blockquote>
<p><a href="http://192.168.56.102:9001/logtail/weiyigeek" target="_blank" rel="noopener">http://192.168.56.102:9001/logtail/weiyigeek</a> å¯ä»¥çœ‹åˆ°æ‰“å°çš„æ—¥å¿—</p>
</blockquote>
<figure class="image-box">
                <a rel=Supervisorè¿›ç¨‹ç®¡ç†å·¥å…·å¿«é€Ÿå…¥é—¨ä¸ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190525110422.png" target="_blank" title="WeiyiGeek.supervisor" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190525110422.png" alt="WeiyiGeek.supervisor" title="" class=""></a>
                <p>WeiyiGeek.supervisor</p>
            </figure>
<p><br/></p>
<p><em>æ³¨æ„äº‹é¡¹ï¼š</em></p>
<ul>
<li>supervisor æ¯”è¾ƒé€‚åˆç›‘æ§ä¸šåŠ¡åº”ç”¨ï¼Œä¸”åªèƒ½ç›‘æ§å‰å°ç¨‹åºï¼Œå¦‚æœä½ çš„ç¨‹åºæ˜¯ä»¥daemonçš„æ–¹å¼å¯åŠ¨ï¼Œé‚£ä¹ˆæ‰§è¡Œï¼šsupervisor status ä¼šæç¤ºï¼šBACKOFF  Exited too quickly (process log may have details)ã€‚</li>
</ul>
<hr>

<h4 id="0x03-supervisoræ’ä»¶"><a href="#0x03-supervisoræ’ä»¶" class="headerlink" title="0x03 supervisoræ’ä»¶"></a>0x03 supervisoræ’ä»¶</h4><p>1ï¼‰æ’ä»¶ï¼š<a href="https://github.com/ouqiang/supervisor-event-listener" target="_blank" rel="noopener">https://github.com/ouqiang/supervisor-event-listener</a><br>supervisor-event-listenerï¼ŒSupervisoräº‹ä»¶é€šçŸ¥, æ”¯æŒé‚®ä»¶, Slack, WebHook</p>
<p>2ï¼‰å¯è§†åŒ–å·¥å…· - å®æµ‹è¯•ç”¨å…¶ä¸­CESIä¸é”™ï¼Œæ¨èä½¿ç”¨<br>ç¨‹åºæ¥æºï¼š<a href="https://github.com/Gamegos/cesi" target="_blank" rel="noopener">https://github.com/Gamegos/cesi</a><br><a href="http://ae.koroglu.org/centralized-supervisor-interface-cesi/" target="_blank" rel="noopener">http://ae.koroglu.org/centralized-supervisor-interface-cesi/</a><br><figure class="image-box">
                <a rel=Supervisorè¿›ç¨‹ç®¡ç†å·¥å…·å¿«é€Ÿå…¥é—¨ä¸ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190525231033.png" target="_blank" title="WeiyiGeek.CESI" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190525231033.png" alt="WeiyiGeek.CESI" title="" class=""></a>
                <p>WeiyiGeek.CESI</p>
            </figure></p>
<hr>

<h4 id="0x04-æ‰©å±•ä¹‹xml-rpc"><a href="#0x04-æ‰©å±•ä¹‹xml-rpc" class="headerlink" title="0x04 æ‰©å±•ä¹‹xml_rpc"></a>0x04 æ‰©å±•ä¹‹xml_rpc</h4><p>supervisoræä¾›çš„ä¸¤ç§ç®¡ç†æ–¹å¼,supervisorctlå’Œwebå…¶å®éƒ½æ˜¯é€šè¿‡xml_rpcæ¥å®ç°çš„,xml_rpcå…¶å®å°±æ˜¯æœ¬åœ°å¯ä»¥å»è°ƒç”¨è¿œç«¯çš„å‡½æ•°æ–¹æ³•,ç„¶åå‡½æ•°æ–¹æ³•ç»è¿‡ä¸€ç•ªå¤„ç†åï¼ŒæŠŠç»“æœè¿”å›ç»™æˆ‘ä»¬ã€‚</p>
<p>åœ¨è®¾ç½®æ‰©å±•çš„æ—¶å€™éœ€è¦åœ¨supervisor.confé…ç½®æ–‡ä»¶ä¸­è¿›è¡Œå®šä¹‰ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é€šè¿‡åœ¨ç®¡ç†å™¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ [rpcinterface:x]èŠ‚ï¼Œå¯ä»¥å°†é™„åŠ RPCæ¥å£é…ç½®åˆ°ç®¡ç†å™¨å®‰è£…ä¸­ã€‚</span></span><br><span class="line">[rpcinterface:supervisor]</span><br><span class="line">supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface</span><br><span class="line"></span><br><span class="line">[rpcinterface:myrpc]</span><br><span class="line">supervisor.rpcinterface_factory = myrpc.rpc:my_rpc</span><br><span class="line">args = 1  <span class="comment">#è¡¨ç¤ºä¼ å…¥my_rpcè¿™ä¸ªç­¾åå‡½æ•°çš„å‚æ•°</span></span><br></pre></td></tr></table></figure></p>
<p>åœ¨pythoné‡Œé¢å®ç°xml_rpcå°±æ›´åŠ çš„ç®€å•ï¼Œç”¨SimpleXMLRPCServerå’Œxmlrpclibè¿™ä¸¤ä¸ªæ¨¡å—å°±å¯ä»¥åˆ†åˆ«å®ç°æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯äº†ã€‚<br>PYthonçš„æ¨¡å—ä½¿ç”¨ä¸rpcè¿æ¥ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python 2â€™s xmlrpclib</span></span><br><span class="line">import xmlrpclib</span><br><span class="line">server = xmlrpclib.Server(<span class="string">'http://user:123@localhost:9001/RPC2'</span>) <span class="comment">#åœ¨è®¾ç½®äº†è´¦å·å¯†ç è®¤è¯çš„æ—¶å€™</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Python 3â€™s xmlrpc.client</span></span><br><span class="line">from xmlrpc.client import ServerProxy</span><br><span class="line">server = ServerProxy(<span class="string">'http://localhost:9001/RPC2'</span>)</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å°è¯•è¿æ¥å’Œè·å–rpcæä¾›çš„æ–¹æ³•,supervisoræœ¬èº«æä¾›çš„xml_rpcæ–¹æ³•è¿˜æ˜¯æ¯”è¾ƒå¤šçš„:åŒ…æ‹¬æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€ï¼Œå¯åŠ¨/åœæ­¢/é‡å¯è¿›ç¨‹ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼Œå‘é€eventç­‰ç­‰<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> xmlrpclib</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>server = xmlrpclib.Server(<span class="string">'http://user:123@192.168.56.102:9001/RPC2'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span>  server.system.listMethods():  <span class="comment">#æŸ¥çœ‹æ–¹æ³•</span></span><br><span class="line"><span class="meta">... </span>    print(i)</span><br><span class="line">supervisor.addProcessGroup</span><br><span class="line">supervisor.clearAllProcessLogs</span><br><span class="line">supervisor.clearLog</span><br><span class="line">supervisor.clearProcessLog</span><br><span class="line">supervisor.clearProcessLogs</span><br><span class="line">supervisor.getAPIVersion   <span class="comment">#ä½¿ç”¨çš„RPC APIçš„ç‰ˆæœ¬</span></span><br><span class="line">supervisor.getAllConfigInfo  <span class="comment">#è·å–æ‰€æœ‰çš„é…ç½®ä¿¡æ¯</span></span><br><span class="line">supervisor.getAllProcessInfo  <span class="comment">#è·å–æ‰€æœ‰çš„çº¿ç¨‹ä¿¡æ¯</span></span><br><span class="line">supervisor.getIdentification  <span class="comment"># #è¿”å›æ ‡è¯†ä¸»é”®å­—ç¬¦ä¸²</span></span><br><span class="line">supervisor.getPID         <span class="comment">#è·å–è¿”å›supervisorçš„PID</span></span><br><span class="line">supervisor.getProcessInfo</span><br><span class="line">supervisor.getState   <span class="comment">#ä»¥ç»“æ„å½¢å¼è¿”å›å½“å‰çš„ç›‘æ§çŠ¶æ€</span></span><br><span class="line">supervisor.getSupervisorVersion   <span class="comment">#supervisorè½¯ä»¶åŒ…çš„ç‰ˆæœ¬</span></span><br><span class="line">supervisor.getVersion</span><br><span class="line">supervisor.readLog(offset, length)  <span class="comment">#ä»åç§»é‡å¼€å§‹ä»supervisoræ—¥å¿—è¯»å–é•¿åº¦å­—èŠ‚</span></span><br><span class="line">supervisor.readMainLog</span><br><span class="line">supervisor.readProcessLog</span><br><span class="line">supervisor.readProcessStderrLog</span><br><span class="line">supervisor.readProcessStdoutLog</span><br><span class="line">supervisor.reloadConfig</span><br><span class="line">supervisor.removeProcessGroup</span><br><span class="line">supervisor.restart    <span class="comment">#é‡å¯supervisorç®¡ç†å™¨è¿›ç¨‹</span></span><br><span class="line">supervisor.sendProcessStdin(name, chars)  <span class="comment">#å°†ä¸€ä¸²å­—ç¬¦å‘é€åˆ°è¿›ç¨‹åçš„stdinã€‚å¦‚æœå‘é€çš„æ˜¯é7ä½æ•°æ®(unicode)ï¼Œåˆ™åœ¨å‘é€åˆ°è¿›ç¨‹' stdinä¹‹å‰å°†å…¶ç¼–ç ä¸ºutf-8</span></span><br><span class="line">supervisor.sendRemoteCommEvent(type, data) <span class="comment">#å‘é€ä¸€ä¸ªäº‹ä»¶ï¼Œè®¢é˜…RemoteCommunicationEventçš„äº‹ä»¶ä¾¦å¬å™¨å­è¿›ç¨‹å°†æ¥æ”¶è¯¥äº‹ä»¶ã€‚</span></span><br><span class="line">supervisor.shutdown  <span class="comment">#å…³é—­supervisorç®¡ç†å™¨è¿›ç¨‹</span></span><br><span class="line">supervisor.signalAllProcesses</span><br><span class="line">supervisor.signalProcess</span><br><span class="line">supervisor.signalProcessGroup</span><br><span class="line">supervisor.startAllProcesses</span><br><span class="line">supervisor.startProcess</span><br><span class="line">supervisor.startProcessGroup</span><br><span class="line">supervisor.stopAllProcesses</span><br><span class="line">supervisor.stopProcess</span><br><span class="line">supervisor.stopProcessGroup</span><br><span class="line">supervisor.tailProcessLog</span><br><span class="line">supervisor.tailProcessStderrLog(name, offset, length)</span><br><span class="line">supervisor.tailProcessStdoutLog(name, offset, length)</span><br><span class="line">system.listMethods</span><br><span class="line">system.methodHelp</span><br><span class="line">system.methodSignature</span><br><span class="line">system.multicall(&#123;<span class="string">'methodName'</span>: string, <span class="string">'params'</span>: array&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>server.system.methodHelp(<span class="string">'supervisor.startProcess'</span>)  <span class="comment">#æŸ¥çœ‹æ–¹æ³•çš„å¸®åŠ©</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>server.supervisor.getAPIVersion()</span><br><span class="line"><span class="string">'3.0'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>server.supervisor.getSupervisorVersion()</span><br><span class="line"><span class="string">'4.0.3'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>server.supervisor.getProcessInfo(<span class="string">'weiyigeek'</span>)  <span class="comment">#è·å–ç›‘æ§é¡¹çš„ä¿¡æ¯</span></span><br><span class="line">&#123;<span class="string">'now'</span>: <span class="number">1558764355</span>, <span class="string">'group'</span>: <span class="string">'weiyigeek'</span>, <span class="string">'description'</span>: <span class="string">'May 25 01:09 PM'</span>, <span class="string">'pid'</span>: <span class="number">0</span>, <span class="string">'stderr_logfile'</span>: <span class="string">''</span>, <span class="string">'stop'</span>: <span class="number">1558760940</span>, <span class="string">'statename'</span>: <span class="string">'STOPPED'</span>, <span class="string">'start'</span>: <span class="number">1558759539</span>, <span class="string">'state'</span>: <span class="number">0</span>, <span class="string">'stdout_logfile'</span>: <span class="string">'/tmp/weiyigeek.stderr.log'</span>, <span class="string">'logfile'</span>: <span class="string">'/tmp/weiyigeek.stderr.log'</span>, <span class="string">'exitstatus'</span>: <span class="number">-1</span>, <span class="string">'spawnerr'</span>: <span class="string">''</span>, <span class="string">'name'</span>: <span class="string">'weiyigeek'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> key <span class="keyword">in</span> server.supervisor.getAllConfigInfo():  <span class="comment">#æ‰€ä»¥çš„é…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> keyname,value <span class="keyword">in</span> key.items():</span><br><span class="line"><span class="meta">... </span>            print(keyname,value)</span><br><span class="line">...</span><br><span class="line">(<span class="string">'stopsignal'</span>, <span class="number">15</span>)</span><br><span class="line">(<span class="string">'group_prio'</span>, <span class="number">999</span>)</span><br><span class="line">(<span class="string">'stderr_logfile_maxbytes'</span>, <span class="number">52428800</span>)</span><br><span class="line">(<span class="string">'group'</span>, <span class="string">'weiyigeek'</span>)</span><br><span class="line">(<span class="string">'stdout_capture_maxbytes'</span>, <span class="number">0</span>)</span><br><span class="line">(<span class="string">'startsecs'</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="string">'autostart'</span>, <span class="literal">True</span>)</span><br><span class="line">(<span class="string">'stdout_events_enabled'</span>, <span class="literal">False</span>)</span><br><span class="line">(<span class="string">'stderr_capture_maxbytes'</span>, <span class="number">0</span>)</span><br><span class="line">(<span class="string">'stderr_logfile'</span>, <span class="string">'none'</span>)</span><br><span class="line">(<span class="string">'stdout_syslog'</span>, <span class="literal">False</span>)</span><br><span class="line">(<span class="string">'process_prio'</span>, <span class="number">999</span>)</span><br><span class="line">(<span class="string">'exitcodes'</span>, [<span class="number">0</span>])</span><br><span class="line">(<span class="string">'stderr_events_enabled'</span>, <span class="literal">False</span>)</span><br><span class="line">(<span class="string">'name'</span>, <span class="string">'weiyigeek'</span>)</span><br><span class="line">(<span class="string">'inuse'</span>, <span class="literal">True</span>)</span><br><span class="line">(<span class="string">'redirect_stderr'</span>, <span class="literal">True</span>)</span><br><span class="line">(<span class="string">'stopwaitsecs'</span>, <span class="number">10</span>)</span><br><span class="line">(<span class="string">'killasgroup'</span>, <span class="literal">False</span>)</span><br><span class="line">(<span class="string">'stdout_logfile_maxbytes'</span>, <span class="number">52428800</span>)</span><br><span class="line">(<span class="string">'stderr_syslog'</span>, <span class="literal">False</span>)</span><br><span class="line">(<span class="string">'stdout_logfile_backups'</span>, <span class="number">10</span>)</span><br><span class="line">(<span class="string">'command'</span>, <span class="string">'/bin/bash tcpCount.sh'</span>)</span><br><span class="line">(<span class="string">'startretries'</span>, <span class="number">3</span>)</span><br><span class="line">(<span class="string">'stderr_logfile_backups'</span>, <span class="number">10</span>)</span><br><span class="line">(<span class="string">'stdout_logfile'</span>, <span class="string">'/tmp/weiyigeek.stderr.log'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>server.supervisor.getState()  <span class="comment">#æ“ä½œçŠ¶æ€</span></span><br><span class="line">&#123;<span class="string">'statename'</span>: <span class="string">'RUNNING'</span>, <span class="string">'statecode'</span>: <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>server.supervisor.readLog(<span class="number">1</span>,<span class="number">1024</span>)</span><br><span class="line"><span class="string">"019-05-24 15:53:38,086 CRIT Supervisor is running as root.  Privileges were not dropped because no user is specified in the config file.  If you intend to run as root, you can set user=root in the config file to avoid this message.\n2019-05-24 15:53:38,190 INFO RPC interface 'su'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt;&gt;&gt; server.supervisor.tailProcessLog('weiyigeek',1,1024)  #æŒ‡å®šç›‘æ§åç§°äº§ç”Ÿçš„çº¿ç¨‹æ—¥å¿—</span></span><br><span class="line"><span class="string">[u' should be root.)\n\u5f53\u524dTCP\u8fde\u63a5\u6570\u91cf\uff1a4\n(No info could be read for "</span>-p<span class="string">": geteuid()=994 but you should be root.)\n\u5f53\u524dTCP\u8fde\u63a5\u6570\u91cf\uff1a4\n(No info could be read for "</span>-p<span class="string">": geteuid()=994 but you should be root.)\n\u5f53\u524dTCP\</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt;&gt;&gt; server.supervisor.startAllProcesses();  #å¯åŠ¨æ‰€æœ‰çº¿ç¨‹</span></span><br><span class="line"><span class="string">[&#123;'status': 80, 'group': 'weiyigeek', 'name': 'weiyigeek', 'description': 'OK'&#125;]</span></span><br></pre></td></tr></table></figure></p>
<p>è‡ªå®šä¹‰XMLRPCçš„æ¥å£ï¼š<br><a href="http://supervisord.org/configuration.html" target="_blank" rel="noopener">http://supervisord.org/configuration.html</a></p>
<p>Hereâ€™s an example of a factory function, created in the <strong>init</strong>.py file of the Python package my.package.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[rpcinterface:another]</span><br><span class="line">supervisor.rpcinterface_factory &#x3D; my.package:make_another_rpcinterface</span><br><span class="line">retries &#x3D; 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class AnotherRPCInterface(object):</span><br><span class="line">    def __init__(self,supervisord,args):</span><br><span class="line">        self.supervisord &#x3D; supervisord</span><br><span class="line">        self.args &#x3D; args</span><br><span class="line"></span><br><span class="line">    def walk_args(self):</span><br><span class="line">        return self.walk</span><br><span class="line"></span><br><span class="line">def make_another_rpcinterface(supervisord, **config):</span><br><span class="line">    retries &#x3D; int(config.get(&#39;retries&#39;, 0))</span><br><span class="line">    another_rpc_interface &#x3D; AnotherRPCInterface(supervisord, retries)</span><br><span class="line">    return another_rpc_inte</span><br></pre></td></tr></table></figure></p>
<hr>

<h4 id="0x05-æ‰©å±•ä¹‹event"><a href="#0x05-æ‰©å±•ä¹‹event" class="headerlink" title="0x05 æ‰©å±•ä¹‹event"></a>0x05 æ‰©å±•ä¹‹event</h4><p>supervisorçš„eventæœºåˆ¶å°±æ˜¯ä¸€ä¸ªç›‘æ§/é€šçŸ¥çš„æ¡†æ¶,æŠ›å¼€æ¡†æ¶æ¥è¯´eventå…¶å®å°±æ˜¯ä¸€ä¸²æ•°æ®ï¼Œè¿™ä¸²æ•°æ®é‡Œé¢æœ‰headå’Œbodyä¸¤éƒ¨åˆ†ã€‚</p>
<p>headeræ•°æ®ç»“æ„:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#[header]</span></span><br><span class="line"><span class="comment">#è¡¨ç¤ºeventåè®®çš„ç‰ˆæœ¬ï¼Œç›®å‰æ˜¯3.0</span></span><br><span class="line">ver:3.0 </span><br><span class="line"><span class="comment">#è¡¨ç¤ºsupervisorçš„æ ‡è¯†ç¬¦ï¼Œä¹Ÿå°±æ˜¯å’±ä»¬ä¸Šä¸€ç¯‡ä¸­[supervisord]å—ä¸­çš„identifieré€‰é¡¹ä¸­çš„ä¸œè¥¿</span></span><br><span class="line">server:supervisor </span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™ä¸ªä¸œè¥¿æ˜¯æ¯ä¸ªeventçš„åºåˆ—å·ï¼Œsupervisordåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå‘é€çš„ç¬¬ä¸€ä¸ªeventçš„åºåˆ—å·å°±æ˜¯1ï¼Œæ¥ä¸‹æ¥çš„eventä¾æ¬¡ç±»æ¨</span></span><br><span class="line">serial:21 </span><br><span class="line"></span><br><span class="line"><span class="comment">#æ˜¯ä½ çš„listenerçš„poolçš„åå­—ï¼Œä¸€èˆ¬ä½ çš„listeneråªå¯åŠ¨ä¸€ä¸ªè¿›ç¨‹çš„çš„è¯ï¼Œå…¶å®ä¹Ÿå°±æ²¡æœ‰ poolçš„æ¦‚å¿µäº†</span></span><br><span class="line">pool:listener </span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸Šé¢çš„serialæ˜¯supervisordç»™æ¯ä¸ªeventçš„ç¼–å·ã€‚ è€Œpoolserialåˆ™æ˜¯ï¼Œeventpoolç»™å‘é€åˆ°æˆ‘è¿™ä¸ªpoolè¿‡æ¥çš„eventç¼–çš„å·</span></span><br><span class="line">poolserial:10 </span><br><span class="line"></span><br><span class="line"><span class="comment">#æ˜¯eventçš„ç±»å‹åç§°</span></span><br><span class="line">eventname:PROCESS_COMMUNICATION_STDOUT</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¡¨ç¤ºçš„æ˜¯headeråé¢çš„bodyéƒ¨åˆ†çš„é•¿åº¦</span></span><br><span class="line">len:54</span><br></pre></td></tr></table></figure></p>
<p><br/><br>bodyçš„æ•°æ®ç»“æ„:<br>å…¶å®æ˜¯å’Œeventçš„å…·ä½“ç±»å‹ç›¸å…³çš„ï¼Œä¸åŒçš„eventçš„ç±»å‹ï¼Œheaderçš„ç»“æ„éƒ½ä¸€æ ·ä½†æ˜¯bodyçš„ç»“æ„å¤§å¤šå°±ä¸ä¸€æ ·äº†</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#PROCESS_STATE_EXITEDå…¶å®å°±æ˜¯ï¼Œå½“supervisordç®¡ç†çš„å­è¿›ç¨‹é€€å‡ºçš„æ—¶å€™ï¼Œsupervisordå°±ä¼šäº§ç”ŸPROCESS_STATE_EXITEDè¿™ä¹ˆä¸ªeventã€‚</span></span><br><span class="line">processname:cat   <span class="comment">#è¿›ç¨‹åå­—ï¼Œè¿™é‡Œåå­—ä¸æ˜¯æˆ‘ä»¬å®é™…è¿›ç¨‹çš„åå­—è€Œæ˜¯å’±ä»¬[program:x]é…ç½®æˆçš„åå­—</span></span><br><span class="line">groupname:cat      <span class="comment">#ç»„å</span></span><br><span class="line">from_state:RUNNING   <span class="comment">#è¿›ç¨‹é€€å‡ºå‰çš„çŠ¶æ€æ˜¯ä»€ä¹ˆçŠ¶æ€</span></span><br><span class="line">expected:0       <span class="comment">#é»˜è®¤æƒ…å†µä¸‹exitcodesæ˜¯0å’Œ2ï¼Œä¹Ÿå°±æ˜¯è¯´0å’Œ2æ˜¯expected</span></span><br><span class="line">pid:2766   <span class="comment">#çŸ¥é“äº†eventçš„äº§ç”Ÿï¼Œç„¶åç»™æˆ‘ä»¬çš„listenerè¿™ä¹ˆä¸€ç§ç»“æ„çš„æ•°æ®</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ¥æ”¶çš„æ•°æ®ï¼ŒåŠ å·¥åè¿›è¡ŒæŠ¥è­¦ç­‰ç­‰æ“ä½œ,å¤„ç†æ•°æ®ä¹‹å‰å’±ä»¬è¿˜å¾—è¦æ¥äº†è§£ä¸€ä¸‹,listenerå’Œsupervisordä¹‹é—´çš„é€šä¿¡è¿‡ç¨‹:<br>åœ¨è¿™é‡Œæˆ‘ä»¬é¦–å…ˆè¦ææ¸…æ¥šï¼Œeventçš„å‘èµ·æ–¹å’Œæ¥æ”¶æ–¹ã€‚</p>
<ul>
<li>å‘èµ·æ–¹æ˜¯supervisordè¿›ç¨‹</li>
<li>æ¥æ”¶æ–¹æ˜¯listener(éœ€è¦é…ç½®)</li>
</ul>
<p>å…¶å®eventè¿˜æœ‰å¦å¤–ä¸€ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬çš„programä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦ç®¡ç†çš„è¿›ç¨‹ï¼Œä¹Ÿå¯ä»¥å‘é€eventè¿›è€Œå’Œsupervisordä¸»åŠ¨é€šä¿¡ã€‚<br>åè®®å…¶å®å¾ˆç®€å•:</p>
<ul>
<li>å½“supervisordå¯åŠ¨çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬çš„listeneré…ç½®ä¸ºautostart=trueçš„è¯ï¼Œlistenerå°±ä¼šä½œä¸ºsupervisorçš„å­è¿›ç¨‹è¢«å¯åŠ¨ã€‚</li>
<li>listenerè¢«å¯åŠ¨ä¹‹åï¼Œä¼šå‘è‡ªå·±çš„stdoutå†™ä¸€ä¸ªâ€READYâ€çš„æ¶ˆæ¯,æ­¤æ—¶çˆ¶è¿›ç¨‹ä¹Ÿå°±æ˜¯supervisordè¯»å–åˆ°è¿™æ¡æ¶ˆæ¯åï¼Œä¼šè®¤ä¸ºlistenerå¤„äºå°±ç»ªçŠ¶æ€ã€‚</li>
<li>listenerå¤„äºå°±ç»ªçŠ¶æ€åï¼Œå½“supervisordäº§ç”Ÿçš„eventåœ¨listenerçš„é…ç½®çš„å¯æ¥å—çš„eventsä¸­æ—¶ï¼Œsupervisordå°±ä¼šæŠŠè¯¥eventå‘é€ç»™è¯¥listenerã€‚  </li>
<li>listeneræ¥æ”¶åˆ°eventåï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®eventçš„headï¼Œbodyé‡Œé¢çš„æ•°æ®ï¼Œåšä¸€äº›åˆ—çš„å¤„ç†äº†ã€‚æˆ‘ä»¬æ ¹æ®eventçš„å†…å®¹ï¼Œåˆ¤æ–­ï¼Œæå–ï¼ŒæŠ¥è­¦ç­‰ç­‰æ“ä½œã€‚</li>
<li>è¯¥å¹²çš„æ´»éƒ½å¹²å®Œä¹‹åï¼Œlisteneréœ€è¦å‘è‡ªå·±çš„stdoutå†™ä¸€ä¸ªæ¶ˆæ¯â€RESULT\nOKâ€ï¼Œsupervisordæ¥å—åˆ°è¿™æ¡æ¶ˆæ¯åã€‚å°±çŸ¥é“listenerå¤„ç†eventå®Œæ¯•äº†ã€‚</li>
</ul>
<p>æ¡ˆä¾‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="comment">#childutilsè¿™ä¸ªæ¨¡å—æ˜¯supervisorçš„ä¸€ä¸ªæ¨¡å‹ï¼Œå¯ä»¥æ–¹ä¾¿æˆ‘ä»¬å¤„ç†eventæ¶ˆæ¯ã€‚ã€‚ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±æŒ‰ç…§åè®®ï¼Œç”¨ä»»ä½•è¯­è¨€æ¥å†™listenerï¼Œåªä¸è¿‡ç”¨childutilsæ›´åŠ ç®€ä¾¿ç½¢äº†</span></span><br><span class="line"><span class="keyword">from</span> supervisor <span class="keyword">import</span> childutils</span><br><span class="line"><span class="keyword">from</span> optparse <span class="keyword">import</span> OptionParser</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> fcntl</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"> </span><br><span class="line">__doc__ = <span class="string">"\033[32m%s,æ•è·PROCESS_STATE_EXITEDäº‹ä»¶ç±»å‹,å½“å¼‚å¸¸é€€å‡ºæ—¶è§¦å‘æŠ¥è­¦\033[0m"</span> % sys.argv[<span class="number">0</span>]</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_stdout</span><span class="params">(s)</span>:</span></span><br><span class="line">    sys.stdout.write(s)</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line"><span class="comment">#å®šä¹‰å¼‚å¸¸ï¼Œæ²¡å•¥å¤§ç”¨å…¶å®</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CallError</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,value)</span>:</span></span><br><span class="line">        self.value = value</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> repr(self.value)</span><br><span class="line"><span class="comment">#å®šä¹‰å¤„ç†eventçš„ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProcessesMonitor</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.stdin = sys.stdin</span><br><span class="line">        self.stdout = sys.stdout</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">runforever</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#å®šä¹‰ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œå¯ä»¥å¾ªç¯å¤„ç†eventï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸ç”¨å¾ªç¯ï¼ŒæŠŠlistenerçš„autorestart#é…ç½®ä¸ºtrueï¼Œå¤„ç†å®Œä¸€æ¬¡eventå°±è®©è¯¥listeneré€€å‡ºï¼Œ</span></span><br><span class="line">        <span class="comment">#ç„¶åsupervisordé‡å¯è¯¥listenerï¼Œè¿™æ ·listenerå°±å¯ä»¥å¤„ç†æ–°çš„eventäº†</span></span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            <span class="comment">#ä¸‹é¢è¿™ä¸ªä¸œè¥¿ï¼Œæ˜¯å‘stdoutå‘é€"READY"ï¼Œç„¶åå°±é˜»å¡åœ¨è¿™é‡Œï¼Œä¸€ç›´ç­‰åˆ°æœ‰eventå‘è¿‡æ¥</span></span><br><span class="line">            <span class="comment">#headers,payloadåˆ†åˆ«æ˜¯æ¥æ”¶åˆ°çš„headerå’Œbodyçš„å†…å®¹</span></span><br><span class="line">            headers, payload = childutils.listener.wait(self.stdin, self.stdout)</span><br><span class="line">            <span class="comment">#åˆ¤æ–­eventæ˜¯å¦æ˜¯å’±ä»¬éœ€è¦çš„ï¼Œä¸æ˜¯çš„è¯ï¼Œå‘stdoutå†™å…¥"RESULT\NOK"ï¼Œå¹¶è·³è¿‡å½“å‰</span></span><br><span class="line">            <span class="comment">#å¾ªç¯çš„å‰©ä½™éƒ¨åˆ†</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> headers[<span class="string">'eventname'</span>] == <span class="string">'PROCESS_STATE_EXITED'</span>:</span><br><span class="line">                childutils.listener.ok(self.stdout)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"> </span><br><span class="line">            pheaders,pdata = childutils.eventdata(payload+<span class="string">'\n'</span>)</span><br><span class="line">            <span class="comment">#åˆ¤è¯»eventæ˜¯å¦æ˜¯expectedæ˜¯å¦æ˜¯expectedçš„ï¼Œexpectedçš„è¯ä¸º1ï¼Œå¦åˆ™ä¸º0</span></span><br><span class="line">            <span class="comment">#è¿™é‡Œçš„åˆ¤æ–­æ˜¯è¿‡æ»¤æ‰expectedçš„event</span></span><br><span class="line">            <span class="keyword">if</span> int(pheaders[<span class="string">'expected'</span>]):</span><br><span class="line">                childutils.listener.ok(self.stdout)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"> </span><br><span class="line">            ip = self.get_ip(<span class="string">'eth0'</span>)</span><br><span class="line">            <span class="comment">#æ„é€ æŠ¥è­¦ä¿¡æ¯ç»“æ„</span></span><br><span class="line">            msg = <span class="string">"[Host:%s][Process:%s][pid:%s][exited unexpectedly fromstate:%s]"</span> % (ip,pheaders[<span class="string">'processname'</span>],pheaders[<span class="string">'pid'</span>],pheaders[<span class="string">'from_state'</span>])</span><br><span class="line">            <span class="comment">#è°ƒç”¨æŠ¥è­¦æ¥å£ï¼Œè¿™ä¸ªæ¥å£æ˜¯æˆ‘ä»¬å…¬å¸è‡ªå·±å¼€å‘çš„ï¼Œå¤§ä¼™ä¸èƒ½ç”¨çš„ï¼Œè¦æ¢æˆè‡ªå·±çš„æ¥å£</span></span><br><span class="line">            subprocess.call(<span class="string">"/usr/local/bin/alert.py -m '%s'"</span> % msg,shell=<span class="literal">True</span>)</span><br><span class="line">            <span class="comment">#stdoutå†™å…¥"RESULT\nOK"ï¼Œå¹¶è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯</span></span><br><span class="line">            childutils.listener.ok(self.stdout)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="string">'''def check_user(self):</span></span><br><span class="line"><span class="string">        userName = os.environ['USER']</span></span><br><span class="line"><span class="string">        if userName != 'root':</span></span><br><span class="line"><span class="string">            try:</span></span><br><span class="line"><span class="string">                raise MyError('must be run by root!')</span></span><br><span class="line"><span class="string">            except MyError as e:</span></span><br><span class="line"><span class="string">                write_stderr( "Error occurred,value:%s\n" % e.value)</span></span><br><span class="line"><span class="string">                sys.exit(255)</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_ip</span><span class="params">(self,ifname)</span>:</span></span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">        inet = fcntl.ioctl(s.fileno(), <span class="number">0x8915</span>, struct.pack(<span class="string">'256s'</span>, ifname[:<span class="number">15</span>]))</span><br><span class="line">        ret = socket.inet_ntoa(inet[<span class="number">20</span>:<span class="number">24</span>])</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    parser = OptionParser()</span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">if</span> sys.argv[<span class="number">1</span>] == <span class="string">'-h'</span> <span class="keyword">or</span> sys.argv[<span class="number">1</span>] == <span class="string">'--help'</span>:</span><br><span class="line">            <span class="keyword">print</span> __doc__</span><br><span class="line">            sys.exit(<span class="number">0</span>)</span><br><span class="line">    <span class="comment">#(options, args) = parser.parse_args()</span></span><br><span class="line">    <span class="comment">#ä¸‹é¢è¿™ä¸ªï¼Œè¡¨ç¤ºåªæœ‰supervisordæ‰èƒ½è°ƒç”¨è¯¥listenerï¼Œå¦åˆ™é€€å‡º</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="string">'SUPERVISOR_SERVER_URL'</span> <span class="keyword">in</span> os.environ:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">raise</span> CallError(<span class="string">"%s must be run as a supervisor event"</span> % sys.argv[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">except</span> CallError <span class="keyword">as</span> e:</span><br><span class="line">            write_stderr(<span class="string">"Error occurred,value: %s\n"</span> % e.value)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"> </span><br><span class="line">    prog = ProcessesMonitor()</span><br><span class="line">    prog.runforever()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p>

        </div>
        <!-- Google å¹¿å‘Š -->
          

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-07-15T11:23:44.373Z" itemprop="dateUpdated">2022-07-15 19:23:44</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç³»ç»Ÿè¿ç»´/Application/monitor/Supervisorè¿›ç¨‹ç®¡ç†å·¥å…·å¿«é€Ÿå…¥é—¨ä¸ä½¿ç”¨.md" target="_blank" rel="noopener noreferrer">_posts/ç³»ç»Ÿè¿ç»´/Application/monitor/Supervisorè¿›ç¨‹ç®¡ç†å·¥å…·å¿«é€Ÿå…¥é—¨ä¸ä½¿ç”¨.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2019/5-22-111.html" target="_blank" rel="external">https://blog.weiyigeek.top/2019/5-22-111.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/supervisor/" rel="tag">supervisor</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/5-22-111.html&title=ã€ŠSupervisorè¿›ç¨‹ç®¡ç†å·¥å…·å¿«é€Ÿå…¥é—¨ä¸ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/5-22-111.html&title=ã€ŠSupervisorè¿›ç¨‹ç®¡ç†å·¥å…·å¿«é€Ÿå…¥é—¨ä¸ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/5-22-111.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠSupervisorè¿›ç¨‹ç®¡ç†å·¥å…·å¿«é€Ÿå…¥é—¨ä¸ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/5-22-111.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/5-22-111.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/5-25-426.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">SupervisoræœåŠ¡è„†å¼±æ€§</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/5-22-481.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">äº‘åŸç”Ÿä¸å®¹å™¨æµ…æåŸºç¡€çŸ¥è¯†</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x00-å¿«é€Ÿå…¥é—¨"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å¿«é€Ÿå…¥é—¨</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x01-é…ç½®æ–‡ä»¶"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 é…ç½®æ–‡ä»¶</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x02-supervisorå®æˆ˜"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 supervisorå®æˆ˜</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x03-supervisoræ’ä»¶"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 supervisoræ’ä»¶</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x04-æ‰©å±•ä¹‹xml-rpc"><span class="post-toc-number">5.</span> <span class="post-toc-text">0x04 æ‰©å±•ä¹‹xml_rpc</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x05-æ‰©å±•ä¹‹event"><span class="post-toc-number">6.</span> <span class="post-toc-text">0x05 æ‰©å±•ä¹‹event</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    


    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      

    <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
    
      <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½çœ‹å‹,æ¬¢è¿å…³æ³¨åšä¸»å¾®ä¿¡å…¬ä¼—å·å“Ÿ! â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘å³å¯å…³é—­ç»§ç»­æµè§ˆæ–‡ç« .<br>  <b style="color:red;"> æ¸©é¦¨æç¤º: æœªè§£é”çš„ç”¨æˆ·ä¸èƒ½ç²˜è´´å¤åˆ¶æ–‡ç« å†…å®¹å“Ÿ!</b> <br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
        
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/search-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/5-22-111.html&title=ã€ŠSupervisorè¿›ç¨‹ç®¡ç†å·¥å…·å¿«é€Ÿå…¥é—¨ä¸ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/5-22-111.html&title=ã€ŠSupervisorè¿›ç¨‹ç®¡ç†å·¥å…·å¿«é€Ÿå…¥é—¨ä¸ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/5-22-111.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠSupervisorè¿›ç¨‹ç®¡ç†å·¥å…·å¿«é€Ÿå…¥é—¨ä¸ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/5-22-111.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/5-22-111.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACNElEQVR42u3aQW7jQAxEUd//0so6CFr6RUoxxP5aBROPzedFpZvk54OfY/H8/e3q9av3XH3K54lHhgwZr2Ucp895WRyzKn31Prw2GTJk7MOovfV5UJKP77NlyJAhg4RgGrjnhcqQIUPGXQz+kSSUvxa4MmTIeBWDXGJ5c4002tIQv+0uLkOGjBcyeNf9/39+ZL4hQ4aMVzGO8LmrPdev5Nd7ypAhYzSDB1ynuc8vtLV6ZMiQMZvRWXEgsH4DDv2LDBkyRjM6g0NeKGn691t+MmTImMqolcujtjOwDL4mGTJkbMDgDXoerxxGwvfiD4MMGTJGM87L5asPfKkr/eKCAacMGTK2YXQCN55IhGF98b9kyJAxlNEZSZKlUhLKvNyLdpsMGTJGM/ghjJTO1zVq4Y62RWTIkDGIUbvQ8hWKTqOtdSSVIUPGIEZnAFkbGPCvKTiwypAhYzQjza4bLpw47jutPRkyZExipCOBNC7TMWcauzJkyNiBwRcsOkPKtMWWrmjIkCFjB0btOJiGJnk9D/GLnREZMmRswCBNrrTd37+HXhwTZciQsQ2j1kTrh2ynIShDhozZjCN8arxayPLDqAwZMmYz0pgj7f70sto5Jha33mTIkPFCRu1gd+8SGBkkXBwTZciQsQGjU1A6SQxu2HhQKkOGDBmkiHSdgscuqkeGDBkyStfRNKD5YXF5iZUhQ8ZoRq2hxgefabw+2G6TIUPGCxmtTQ38ytpKWXr0lCFDxjjGDyCfslDqhF7kAAAAAElFTkSuQmCC" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// ç«™ç‚¹è¿è¡Œæ—¶é—´
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + "å¤©" + RunHours + "æ—¶" + RunMinutes + "åˆ†" + RunSeconds + "ç§’";
  document.getElementById(id).innerHTML = "ç½‘ç«™å·²åœ¨é£é›¨ä¸­å‹‰å‹‰å¼ºå¼ºè¿è¡Œäº†ã€" + RunTime + "ã€‘";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
</body>
</html>