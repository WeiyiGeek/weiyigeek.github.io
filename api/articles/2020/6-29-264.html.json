{"title":"PhantomJSä¹‹ç½‘ç«™è‡ªåŠ¨åŒ–è¿ç»´æµ‹è¯•ç›‘æ§åˆ©å™¨","slug":"ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–æµ‹è¯•/Phantomjs/PhantomJSä¹‹ç½‘ç«™è‡ªåŠ¨åŒ–è¿ç»´æµ‹è¯•ç›‘æ§åˆ©å™¨","date":"2020-06-29T06:34:30.000Z","updated":"2023-01-12T07:07:45.368Z","url":"2020/6-29-264.html","path":"api/articles/2020/6-29-264.html.json","covers":["https://img.weiyigeek.top/2022/10/20230110150041.png","https://img.weiyigeek.top/2022/10/20230110180300.png","https://img.weiyigeek.top/2022/10/20230111095803.png","https://img.weiyigeek.top/2022/10/20230111101451.png","https://img.weiyigeek.top/2022/10/20230111120117.png","https://img.weiyigeek.top/2022/10/20230111172323.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"0x00-å‰è¨€åˆè¯†\"><a href=\"#0x00-å‰è¨€åˆè¯†\" class=\"headerlink\" title=\"0x00 å‰è¨€åˆè¯†\"></a>0x00 å‰è¨€åˆè¯†</h2><h3 id=\"1-PhantomJS-ä»‹ç»\"><a href=\"#1-PhantomJS-ä»‹ç»\" class=\"headerlink\" title=\"1.PhantomJS ä»‹ç»\"></a>1.PhantomJS ä»‹ç»</h3><p><strong>ä»€ä¹ˆæ˜¯PhantomJS?</strong></p>\n<blockquote>\n<p>Phantomjs(<code>/ËˆfÃ¦ntÉ™m/js</code>) æ˜¯ä¸€ä¸ªåŸºäºWebKitåº“çš„æ— å¤´ï¼ˆæ²¡æœ‰æ˜¾ç¤ºç•Œé¢ï¼‰çš„JavaScript APIï¼Œå³åƒåœ¨webæµè§ˆå™¨ä¸Šè¿è¡Œä¸€æ ·ï¼Œæ‰€ä»¥æ ‡å‡†çš„DOMè„šæœ¬å’ŒCSSé€‰æ‹©å™¨å·¥ä½œæ­£å¸¸ï¼Œç”¨äºè‡ªåŠ¨åŒ–Webæµè§ˆå™¨æ“ä½œï¼Œæ˜¯ä¸€ä¸ªå…è´¹å¼€æºçš„è½»é‡çº§æœåŠ¡å™¨è§£å†³æ–¹æ¡ˆã€‚<br>å®ƒå¯ä»¥åœ¨Windowsã€macOSã€Linuxå’ŒFreeBSDä¸Šè¿è¡Œ, å¹¶ä¸”ä½¿ç”¨QtWebKitä½œä¸ºåç«¯ï¼Œå®ƒä¸ºå„ç§webæ ‡å‡†æä¾›äº†å¿«é€Ÿçš„æœ¬åœ°æ”¯æŒï¼šDOMå¤„ç†ã€CSSé€‰æ‹©å™¨ã€JSONã€ç”»å¸ƒå’ŒSVGã€‚</p>\n</blockquote>\n<p><strong>PhantomJSæœ‰ä»€ä¹ˆç”¨?</strong></p>\n<blockquote>\n<p>å®ƒå¯ä»¥ç”¨æ¥æµ‹è¯•åŠ¨æ€å†…å®¹, æ¯”å¦‚ AJAXå†…å®¹ã€æˆªå±ï¼Œä»¥åŠè½¬æ¢ä¸ºPDFå’ŒåŸå‹å›¾ï¼Œå®ƒä¹Ÿå¯ä»¥æ‰§è¡Œè·¨æµè§ˆå™¨çš„JavaScriptæµ‹è¯•ï¼Œå¯ä»¥æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿã€ç½‘é¡µæˆªå±ã€é¡µé¢è®¿é—®è‡ªåŠ¨åŒ–ä»¥åŠæ•è·ç½‘ç»œè„šæœ¬çš„é”™è¯¯å’Œè­¦å‘Šç­‰ã€‚<br>å®ƒä¸ä»…æ˜¯ä¸ªéšå½¢çš„æµè§ˆå™¨, è¿˜æä¾›äº†è¯¸å¦‚CSSé€‰æ‹©å™¨ã€æ”¯æŒWebæ ‡å‡†ã€DOMæ“ä½œã€JSONã€HTML5ã€Canvasã€SVGç­‰ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†å¤„ç†æ–‡ä»¶I/Oçš„æ“ä½œï¼Œä»è€Œä½¿ä½ å¯ä»¥å‘æ“ä½œç³»ç»Ÿè¯»å†™æ–‡ä»¶ç­‰ã€‚<br>ç®€å•çš„è¯´, PhantomJS é€‚åˆæ‰§è¡Œå„ç§é¡µé¢è‡ªåŠ¨åŒ–ç›‘æ§ã€æµ‹è¯•ä»»åŠ¡ç­‰ã€‚</p>\n</blockquote>\n<h3 id=\"2-å‚è€ƒæ¥æº\"><a href=\"#2-å‚è€ƒæ¥æº\" class=\"headerlink\" title=\"2.å‚è€ƒæ¥æº\"></a>2.å‚è€ƒæ¥æº</h3><ul>\n<li>å®˜æ–¹åœ°å€: <a href=\"http://phantomjs.org/\" target=\"_blank\" rel=\"noopener\">http://phantomjs.org/</a></li>\n<li>PhantomJS GitHubï¼š<a href=\"https://github.com/ariya/phantomjs/\" target=\"_blank\" rel=\"noopener\">https://github.com/ariya/phantomjs/</a></li>\n<li>PhantomJSå®˜æ–¹APIï¼š<a href=\"http://phantomjs.org/api/\" target=\"_blank\" rel=\"noopener\">http://phantomjs.org/api/</a></li>\n<li>PhantomJSå®˜æ–¹ç¤ºä¾‹ï¼š<a href=\"http://phantomjs.org/examples/\" target=\"_blank\" rel=\"noopener\">http://phantomjs.org/examples/</a></li>\n</ul>\n<hr>\n<h2 id=\"0x01-PhantomJS-å®‰è£…\"><a href=\"#0x01-PhantomJS-å®‰è£…\" class=\"headerlink\" title=\"0x01 PhantomJS å®‰è£…\"></a>0x01 PhantomJS å®‰è£…</h2><p>æè¿°: æˆ‘ä»¬çŸ¥é“ <code>PhantomJS</code> å®ƒå¯ä»¥åœ¨ <code>Windowsã€macOSã€Linuxå’ŒFreeBSD</code>ä¸Šè¿è¡Œï¼Œä½ å¯ä»¥å‚è€ƒå®˜ç½‘ä¸­å®‰è£…è¯´æ˜è¿›è¡Œå¿«é€Ÿå®‰è£… (PS: è½¯ä»¶ä¸‹è½½åœ°å€ <a href=\"https://phantomjs.org/download.html\" target=\"_blank\" rel=\"noopener\">https://phantomjs.org/download.html</a> )ã€‚</p>\n<p>ä¸‹é¢ä¼šæ ¹æ®ä½¿ç”¨åœºæ™¯ï¼Œä»æœ€å¸¸ç”¨çš„Windows ä»¥åŠ Linux ç³»ç»Ÿå‘è¡Œç‰ˆæœ¬é‡Œå®‰è£…PhantomJSæµç¨‹è¿›è¡Œç®€å•è¯´æ˜:</p>\n<h3 id=\"1-Windows\"><a href=\"#1-Windows\" class=\"headerlink\" title=\"1.Windows\"></a>1.Windows</h3><p>æè¿°:é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸‹è½½ Windows ç‰ˆæœ¬çš„ PhantomJS å‹ç¼©åŒ… , é€‰æ‹© Windows è¿è¡Œçš„ç‰ˆæœ¬è¿›è¡Œä¸‹è½½ç„¶åæ”¾åœ¨ä¸€ä¸ªæŒ‡å®šç›®å½•ä¸­ï¼Œä¾‹å¦‚æ­¤å¤„çš„<code>F:\\WeiyiGeek\\Tools</code>ï¼ˆå»ºè®®åŠ ä¸Šç¯å¢ƒå˜é‡ï¼‰ï¼›</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># PowerShell ä¸‹è½½ Phantomjs-2.1.1-windows.zip å¹¶è§£å‹</span></span><br><span class=\"line\"><span class=\"variable\">$InstallPath</span>=<span class=\"string\">\"F:\\WeiyiGeek\\Tools\"</span></span><br><span class=\"line\">mkdir <span class=\"variable\">$InstallPath</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$InstallUrl</span>=<span class=\"string\">\"https://bitbucket.org/ariya/phantomjs/downloads/phantomjs-2.1.1-windows.zip\"</span></span><br><span class=\"line\"><span class=\"variable\">$down</span>=<span class=\"built_in\">New-Object</span> <span class=\"string\">\"System.Net.WebClient\"</span></span><br><span class=\"line\"><span class=\"variable\">$down</span>.DownloadFile(<span class=\"variable\">$InstallUrl</span>,<span class=\"string\">\"$&#123;InstallPath&#125;\\phantomjs-2.1.1-windows.zip\"</span>)</span><br><span class=\"line\">Expand-Archive -Path <span class=\"string\">\"$&#123;InstallPath&#125;/phantomjs-2.1.1-windows.zip\"</span> -DestinationPath <span class=\"variable\">$InstallPath</span> -Force</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># PowerShell è®¾ç½® Phantomjs çš„ç¯å¢ƒå˜é‡</span></span><br><span class=\"line\"><span class=\"variable\">$systempath</span> = [System.Environment]::GetEnvironmentVariable(<span class=\"string\">\"PATH\"</span>,<span class=\"string\">\"Machine\"</span>)</span><br><span class=\"line\"><span class=\"variable\">$systempath</span> = <span class=\"variable\">$systempath</span> + <span class=\"string\">\";\"</span> + <span class=\"variable\">$InstallPath</span> + <span class=\"string\">\"\\phantomjs-2.1.1-windows\\bin\"</span></span><br><span class=\"line\">[System.Environment]::setEnvironmentVariable(<span class=\"string\">\"PATH\"</span>,<span class=\"variable\">$systempath</span>,<span class=\"string\">\"Machine\"</span>)</span><br></pre></td></tr></table></figure>\n<p>éªŒè¯å®‰è£…:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># æ–¹å¼1.å‘½ä»¤è¡Œ</span></span><br><span class=\"line\">phantomjs-2.1.1-windows\\bin&gt;phantomjs.exe -v</span><br><span class=\"line\">2.1.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ–¹å¼2.äº¤äº’å¼</span></span><br><span class=\"line\">phantomjs</span><br><span class=\"line\">phantomjs&gt; phantom.version</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">   <span class=\"string\">\"major\"</span>: 2,</span><br><span class=\"line\">   <span class=\"string\">\"minor\"</span>: 1,</span><br><span class=\"line\">   <span class=\"string\">\"patch\"</span>: 1</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">phantomjs&gt; var system = require(<span class=\"string\">'system'</span>)</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"2-Linux\"><a href=\"#2-Linux\" class=\"headerlink\" title=\"2.Linux\"></a>2.Linux</h3><p>æ­¤å¤„æ¼”ç¤ºåœ¨ CentOS7/Ubuntu x64ä½ (Linux 64-bit)ç³»ç»Ÿä¸­å®‰è£… phantomjs æµç¨‹ï¼Œè‹¥æ˜¯å…¶ä»–å‘è¡Œç‰ˆä¹Ÿå¯å‚ç…§å®‰è£…ã€‚</p>\n<p>æ¸©é¦¨æç¤º: It however still relies on Fontconfig (the package fontconfig or libfontconfig, depending on the distribution). The system must have GLIBCXX_3.4.9 and GLIBC_2.7.</p>\n<p>å®‰è£…è„šæœ¬:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åŸºç¡€ä¾èµ–è½¯ä»¶å®‰è£…</span></span><br><span class=\"line\">apt install jq bzip2 || yum install jq bzip2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç”±äºå…¶å®ƒä»ç„¶ä¾èµ– Fontconfig æˆ‘ä»¬è¿˜éœ€å®‰è£…å¦‚ä¸‹ä¾èµ–ï¼ˆåŒ…Fontconfigæˆ–libfontconfigï¼Œå–å†³äºå‘è¡Œç‰ˆï¼‰</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -f /etc/redhat-release ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"comment\"># å®‰è£…å­—ä½“ç›¸å…³çš„ä¾èµ–åŒ…å¹¶åˆ·æ–°å­—ä½“ç¼“å­˜</span></span><br><span class=\"line\">  yum install fontconfig freetype2 -y</span><br><span class=\"line\">  yum install bitmap-fonts bitmap-fonts-cjk -y</span><br><span class=\"line\">  yum groupinstall <span class=\"string\">\"fonts\"</span> -y</span><br><span class=\"line\">  <span class=\"built_in\">fc</span>-cache </span><br><span class=\"line\"><span class=\"keyword\">else</span> </span><br><span class=\"line\">  <span class=\"comment\"># å®‰è£…ç³»ç»Ÿå­—ä½“ç›¸å…³å·¥å…·</span></span><br><span class=\"line\">  sudo apt update</span><br><span class=\"line\">  sudo apt install -y fontconfig libfreetype6 libfreetype6-dev mkfontscale</span><br><span class=\"line\">  sudo apt-get install build-essential chrpath libssl-dev libxft-dev</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># æ‹·è´windowså­—ä½“(C:\\Windows\\Fonts)è‡³/usr/share/fonts/Windows-Fonts, </span></span><br><span class=\"line\">  mkdir /usr/share/fonts/Windows-Fonts</span><br><span class=\"line\">  chmod -R 644 /usr/share/fonts/Windows-Fonts &amp;&amp; <span class=\"built_in\">cd</span> /usr/share/fonts/Windows-Fonts</span><br><span class=\"line\">  mkfontscale;mkfontdir;<span class=\"built_in\">fc</span>-cache</span><br><span class=\"line\">  ln -s /usr/share/fonts/Windows-Fonts /usr/lib/x86_64-linux-gnu/fonts</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…è§£å‹</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /tmp</span><br><span class=\"line\">wget https://bitbucket.org/ariya/phantomjs/downloads/phantomjs-2.1.1-linux-x86_64.tar.bz2</span><br><span class=\"line\">tar -jxvf phantomjs-2.1.1-linux-x86_64.tar.bz2</span><br><span class=\"line\">mv phantomjs-2.1.1-linux-x86_64/ /usr/<span class=\"built_in\">local</span>/src/phantomjs</span><br><span class=\"line\">ln -sf /usr/<span class=\"built_in\">local</span>/src/phantomjs/bin/phantomjs /usr/<span class=\"built_in\">local</span>/bin/phantomjs</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…æµ‹è¯•</span></span><br><span class=\"line\">phantomjs -v </span><br><span class=\"line\">phantomjs /usr/<span class=\"built_in\">local</span>/src/phantomjs/examples/hello.js</span><br></pre></td></tr></table></figure></p>\n<hr>\n<h2 id=\"0x02-å¿«é€Ÿä½¿ç”¨\"><a href=\"#0x02-å¿«é€Ÿä½¿ç”¨\" class=\"headerlink\" title=\"0x02 å¿«é€Ÿä½¿ç”¨\"></a>0x02 å¿«é€Ÿä½¿ç”¨</h2><h3 id=\"1-ç‰›åˆ€å°è¯•\"><a href=\"#1-ç‰›åˆ€å°è¯•\" class=\"headerlink\" title=\"1.ç‰›åˆ€å°è¯•\"></a>1.ç‰›åˆ€å°è¯•</h3><p>ä¸‹é¢æ¥çœ‹ä¸€ä¸ªç®€å•ç¤ºä¾‹, å®ƒæ˜¯å‚è€ƒæ•´åˆ PhantomJS å®˜ç½‘ çš„æ¼”ç¤ºä»£ç ï¼Œå®ç°ç»ˆç«¯è¾“å‡ºã€å‘½ä»¤è¡Œå‚æ•°è·å–ã€è¯·æ±‚æŒ‡å®šurlè·å–ç«™ç‚¹Domç›¸å…³ä¿¡æ¯ä»¥åŠç«™ç‚¹ä»»ä½•æ§åˆ¶å°æ¶ˆæ¯ï¼Œä¸è¾“å‡ºç«™ç‚¹é¦–é¡µæˆªå›¾å¹¶ä¿å­˜ä¸ºåŸŸå.pngå›¾ç‰‡ã€‚</p>\n<p>æ¸©é¦¨æç¤º: ä¸‹è¿°æ¼”ç¤ºä»£ç éƒ½èƒ½åœ¨ <a href=\"https://github.com/WeiyiGeek/SecOpsDev/tree/master/AutomatedTesting/Web/phantomjs\" target=\"_blank\" rel=\"noopener\">https://github.com/WeiyiGeek/SecOpsDev/tree/master/AutomatedTesting/Web/phantomjs</a> æ‰¾åˆ°</p>\n<p><strong>ç¤ºä¾‹ä»£ç :</strong><br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// hello-PhantomJS.js.js</span></span><br><span class=\"line\"><span class=\"comment\">// å‚è€ƒåœ°å€: https://phantomjs.org/quick-start.html</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¾“å‡ºæ–‡å­—å­—ç¬¦åˆ°ç»ˆç«¯</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'Hello, world! PhantomJS Demo!'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å¯ä»¥é€šè¿‡åˆ›å»ºç½‘é¡µå¯¹è±¡æ¥åŠ è½½ã€åˆ†æå’Œå‘ˆç°ç½‘é¡µã€‚</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> page = <span class=\"built_in\">require</span>(<span class=\"string\">'webpage'</span>).create(),</span><br><span class=\"line\">system = <span class=\"built_in\">require</span>(<span class=\"string\">'system'</span>),</span><br><span class=\"line\">t, url;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ä¼ å…¥å‘½ä»¤è¡Œå‚æ•°æ•°é‡æ£€æµ‹</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (system.args.length === <span class=\"number\">1</span> ) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Usage: hello-PhantomJS.js [some URL]'</span>);</span><br><span class=\"line\">  <span class=\"comment\">// ç»ˆæ­¢æ‰§è¡Œ</span></span><br><span class=\"line\">  phantom.exit();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// è·å–å½“å‰æ—¶é—´</span></span><br><span class=\"line\">t = <span class=\"built_in\">Date</span>.now();</span><br><span class=\"line\"><span class=\"comment\">// è·å–å‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°</span></span><br><span class=\"line\">url = system.args[<span class=\"number\">1</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ä½¿ç”¨onConsoleMessageå›è°ƒæ˜¾ç¤ºæ¥è‡ªç½‘é¡µçš„ä»»ä½•æ§åˆ¶å°æ¶ˆæ¯ï¼Œå³ç«™ç‚¹consoleè¾“å‡ºçš„ä¿¡æ¯ã€‚</span></span><br><span class=\"line\">page.onConsoleMessage = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">msg</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Console output : '</span> + msg);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¯·æ±‚è®¿é—®ç«™ç‚¹</span></span><br><span class=\"line\">page.open(url, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">status</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (status !== <span class=\"string\">'success'</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'FAIL to load the address : '</span> + url);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    t = <span class=\"built_in\">Date</span>.now() - t;</span><br><span class=\"line\">    <span class=\"comment\">// ä½¿ç”¨evaluateè·å–JSåDomæ–‡æ¡£å¯¹è±¡</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> title = page.evaluate(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">document</span>.title;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"----------------------------------------------\"</span>)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Status: \"</span> + status);  </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Loading '</span> + url + <span class=\"string\">', Title '</span> + title );</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Loading time '</span> + t + <span class=\"string\">' msec'</span>);</span><br><span class=\"line\">    page.render(url.split(<span class=\"string\">\"//\"</span>)[<span class=\"number\">1</span>]+<span class=\"string\">'.png'</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// ç»ˆæ­¢æ‰§è¡Œ</span></span><br><span class=\"line\">  phantom.exit();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>æ‰§è¡Œç»“æœ:<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">phantomjs<span class=\"number\">-2.1</span><span class=\"number\">.1</span>-windows\\bin&gt; CHCP <span class=\"number\">65001</span> <span class=\"comment\">// å°†å½“å‰cmdçª—å£çš„å½“å‰ä»£ç é¡µè®¾ç½®ä¸ºutf-8</span></span><br><span class=\"line\">phantomjs<span class=\"number\">-2.1</span><span class=\"number\">.1</span>-windows\\bin&gt; .\\phantomjs.exe .\\hello-PhantomJS.js https:<span class=\"comment\">//weiyigeek.top</span></span><br><span class=\"line\">Hello, world! PhantomJS Demo!</span><br><span class=\"line\">Console output : ç”µè„‘</span><br><span class=\"line\">Console output : Welcome to WeiyiGeek<span class=\"string\">'Index Site - [https://www.weiyigeek.top].</span></span><br><span class=\"line\"><span class=\"string\">èŠ±å¼€å ªæŠ˜ç›´é¡»æŠ˜ï¼Œè«å¾…æ— èŠ±ç©ºæŠ˜æ!</span></span><br><span class=\"line\"><span class=\"string\">Console output : %cå¸Œæœ›ä¸å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·ç•™ä¸‹æ‚¨å®è´µçš„çŸ¥è¯†å»ºè®®ï¼Œæˆ–è€…é€šè¿‡é‚®ç®±ã€master#weiyigeek.topã€‘è”ç³»æˆ‘å“Ÿï¼ color:white</span></span><br><span class=\"line\"><span class=\"string\">Console output : %cä¸“æ ä¹¦å†™ä¸æ˜“,å¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„,è¯·ç»™è¿™ç¯‡ä¸“æ  ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ï¼Œè½¬ä¸ªå‘ã€‘(äººé—´äº”å¤§æƒ…),è¿™å°†å¯¹æˆ‘çš„è‚¯å®š,è°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) â¤ï¼ color:red</span></span><br><span class=\"line\"><span class=\"string\">----------------------------------------------</span></span><br><span class=\"line\"><span class=\"string\">Status: success</span></span><br><span class=\"line\"><span class=\"string\">Loading https://weiyigeek.top, Title ğŸŒ WeiyiGeek|å”¯ä¸€æå®¢-Geek-ITç½‘ç»œå®‰å…¨æŠ€æœ¯çŸ¥è¯†åˆ†äº«-ä¸»é¡µç«™ç‚¹</span></span><br><span class=\"line\"><span class=\"string\">Loading time 684 msec</span></span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2022/10/20230110150041.png\" alt=\"WeiyiGeek.phantomjs-ç‰›åˆ€å°è¯•å›¾\" title=\"\" class=\"\">\n                <p>WeiyiGeek.phantomjs-ç‰›åˆ€å°è¯•å›¾</p>\n            </figure>\n<p><br/></p>\n<p><strong>æ‰©å±•äº†è§£</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç½‘é¡µå®ä¾‹æ–¹æ³•ä¸äº‹ä»¶</span></span><br><span class=\"line\"><span class=\"comment\"># Suppose you have an instance of the webpage:</span></span><br><span class=\"line\">var page = require(<span class=\"string\">'webpage'</span>).create();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Functions</span></span><br><span class=\"line\">  page.childFramesCount</span><br><span class=\"line\">  page.childFramesName</span><br><span class=\"line\">  page.close</span><br><span class=\"line\">  page.currentFrameName</span><br><span class=\"line\">  page.deleteLater</span><br><span class=\"line\">  page.destroyed</span><br><span class=\"line\">  page.evaluate</span><br><span class=\"line\">  page.initialized</span><br><span class=\"line\">  page.injectJs</span><br><span class=\"line\">  page.javaScriptAlertSent</span><br><span class=\"line\">  page.javaScriptConsoleMessageSent</span><br><span class=\"line\">  page.loadFinished</span><br><span class=\"line\">  page.loadStarted</span><br><span class=\"line\">  page.openUrl</span><br><span class=\"line\">  page.release</span><br><span class=\"line\">  page.render</span><br><span class=\"line\">  page.resourceError</span><br><span class=\"line\">  page.resourceReceived</span><br><span class=\"line\">  page.resourceRequested</span><br><span class=\"line\">  page.uploadFile</span><br><span class=\"line\">  page.sendEvent</span><br><span class=\"line\">  page.setContent</span><br><span class=\"line\">  page.switchToChildFrame</span><br><span class=\"line\">  page.switchToMainFrame</span><br><span class=\"line\">  page.switchToParentFrame</span><br><span class=\"line\">  page.addCookie</span><br><span class=\"line\">  page.deleteCookie</span><br><span class=\"line\">  page.clearCookies</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Handlers/Callbacks</span></span><br><span class=\"line\"><span class=\"comment\"># List of all the page events:</span></span><br><span class=\"line\">  onInitialized</span><br><span class=\"line\">  onLoadStarted</span><br><span class=\"line\">  onLoadFinished</span><br><span class=\"line\">  onUrlChanged</span><br><span class=\"line\">  onNavigationRequested</span><br><span class=\"line\">  onRepaintRequested</span><br><span class=\"line\">  onResourceRequested</span><br><span class=\"line\">  onResourceReceived</span><br><span class=\"line\">  onResourceError</span><br><span class=\"line\">  onResourceTimeout</span><br><span class=\"line\">  onAlert</span><br><span class=\"line\">  onConsoleMessage</span><br><span class=\"line\">  onClosing</span><br></pre></td></tr></table></figure></p>\n<p>å‚è€ƒåœ°å€: <a href=\"https://phantomjs.org/api/webpage/\" target=\"_blank\" rel=\"noopener\">https://phantomjs.org/api/webpage/</a></p>\n<p><strong>æ¸©é¦¨æç¤º:</strong> æ›´å¤šçš„PhantomJSç¤ºä¾‹å°½åœ¨ <code>phantomjs-2.1.1-windows\\examples</code> ç›®å½•ä¹‹ä¸­ï¼Œæ–‡ä»¶è¯´æ˜å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ ï¼ˆ<a href=\"https://phantomjs.org/examples\" target=\"_blank\" rel=\"noopener\">https://phantomjs.org/examples</a> ï¼‰ï¼Œå¤§å®¶å¯ä»¥åœ¨å¼€å‘æ—¶å¤šå¤šå‚è€ƒã€‚<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Basic examples</span></span><br><span class=\"line\">  arguments.js shows the arguments passed to the script</span><br><span class=\"line\">  countdown.js prints a 10 second countdown</span><br><span class=\"line\">  echoToFile.js writes the <span class=\"built_in\">command</span> line arguments to a file</span><br><span class=\"line\">  fibo.js lists the first few numbers <span class=\"keyword\">in</span> the Fibonacci sequence</span><br><span class=\"line\">  hello.js displays the famous message</span><br><span class=\"line\">  module.js and universe.js demonstrate the use of module system</span><br><span class=\"line\">  outputEncoding.js displays a string <span class=\"keyword\">in</span> various encodings</span><br><span class=\"line\">  printenv.js displays the systemâ€™s environment variables</span><br><span class=\"line\">  scandir.js lists all files <span class=\"keyword\">in</span> a directory and its subdirectories</span><br><span class=\"line\">  sleepsort.js sorts integers and delays display depending on their values</span><br><span class=\"line\">  version.js prints out PhantomJS version number</span><br><span class=\"line\">  page_events.js prints out page events firing: useful to better grasp page.on* callbacks</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Rendering/rasterization</span></span><br><span class=\"line\">  colorwheel.js creates a color wheel using HTML5 canvas</span><br><span class=\"line\">  rasterize.js rasterizes a web page to image or PDF</span><br><span class=\"line\">  render_multi_url.js renders multiple web pages to images</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Page automation</span></span><br><span class=\"line\">  injectme.js injects itself into a web page context</span><br><span class=\"line\">  phantomwebintro.js uses jQuery to <span class=\"built_in\">read</span> .version element text from phantomjs.org</span><br><span class=\"line\">  unrandomize.js modifies a global object at page initialization</span><br><span class=\"line\">  waitfor.js waits until a <span class=\"built_in\">test</span> condition is <span class=\"literal\">true</span> or a timeout occurs</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Network</span></span><br><span class=\"line\">  detectsniff.js detects <span class=\"keyword\">if</span> a web page sniffs the user agent</span><br><span class=\"line\">  loadspeed.js computes the loading speed of a web site</span><br><span class=\"line\">  netlog.js dumps all network requests and responses</span><br><span class=\"line\">  netsniff.js captures network traffic <span class=\"keyword\">in</span> HAR format</span><br><span class=\"line\">  post.js sends an HTTP POST request to a <span class=\"built_in\">test</span> server</span><br><span class=\"line\">  postserver.js starts a web server and sends an HTTP POST request to it</span><br><span class=\"line\">  server.js starts a web server and sends an HTTP GET request to it</span><br><span class=\"line\">  serverkeepalive.js starts a web server <span class=\"built_in\">which</span> answers <span class=\"keyword\">in</span> plain text</span><br><span class=\"line\">  simpleserver.js starts a web server <span class=\"built_in\">which</span> answers <span class=\"keyword\">in</span> HTML</span><br><span class=\"line\"></span><br><span class=\"line\">Testing</span><br><span class=\"line\">  run-jasmine.js runs Jasmine based tests</span><br><span class=\"line\">  run-qunit.js runs QUnit based tests</span><br><span class=\"line\"></span><br><span class=\"line\">Browser</span><br><span class=\"line\">  features.js detects browser features using modernizr.js</span><br><span class=\"line\">  useragent.js changes the browserâ€™s user agent property</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h3 id=\"2-DOM-æ“ä½œå¹¶è·å–å…ƒç´ å±æ€§\"><a href=\"#2-DOM-æ“ä½œå¹¶è·å–å…ƒç´ å±æ€§\" class=\"headerlink\" title=\"2.DOM æ“ä½œå¹¶è·å–å…ƒç´ å±æ€§\"></a>2.DOM æ“ä½œå¹¶è·å–å…ƒç´ å±æ€§</h3><p>æè¿°: ä½¿ç”¨æ ‡å‡†DOM APIæˆ–jQueryç­‰å¸¸ç”¨åº“è®¿é—®ç½‘é¡µå¹¶æå–ä¿¡æ¯ã€‚</p>\n<p><strong>ç¤ºä¾‹ä»£ç </strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// hello-page-automation.js</span></span><br><span class=\"line\"><span class=\"comment\">// DOM æ“ä½œ,ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•è¯»å–è·³è½¬åclassä¸ºpost-card-titleçš„å…ƒç´ çš„textContentå±æ€§</span></span><br><span class=\"line\"><span class=\"comment\">// å¯ä»¥é€šè¿‡åˆ›å»ºç½‘é¡µå¯¹è±¡æ¥åŠ è½½ã€åˆ†æå’Œå‘ˆç°ç½‘é¡µã€‚</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> page = <span class=\"built_in\">require</span>(<span class=\"string\">'webpage'</span>).create(),</span><br><span class=\"line\">system = <span class=\"built_in\">require</span>(<span class=\"string\">'system'</span>),</span><br><span class=\"line\">url,textContent;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ£€æŸ¥ä¼ å…¥å‘½ä»¤è¡Œå‚æ•°æ•°é‡</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (system.args.length === <span class=\"number\">1</span> ) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Usage: hello-PhantomJS.js [some URL]'</span>);</span><br><span class=\"line\">  phantom.exit();</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// è·å–å‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°</span></span><br><span class=\"line\">  url = system.args[<span class=\"number\">1</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è®¾ç½® è¯·æ±‚çš„UserAgent</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'The default user agent is '</span> + page.settings.userAgent);</span><br><span class=\"line\">page.settings.userAgent = <span class=\"string\">'WeiyiGeekAgent'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¯·æ±‚è®¿é—®ç«™ç‚¹</span></span><br><span class=\"line\">page.open(url, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">status</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"----------------- åˆ†éš”çº¿ -------------------------\"</span>)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Status: \"</span> + status);  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (status !== <span class=\"string\">'success'</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Unable to access site : '</span> + url);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123; </span><br><span class=\"line\">  <span class=\"comment\">// æ¸²æŸ“å»¶è¿Ÿ200msæ—¶é—´è¿›è¡Œæˆªå›¾ï¼Œç­‰å¾…ç½‘ç«™æ¸²æŸ“å®Œæˆ</span></span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ä½¿ç”¨evaluateè·å–JSåDomæ–‡æ¡£å¯¹è±¡</span></span><br><span class=\"line\">    textContent = page.evaluate(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">document</span>.getElementsByClassName(<span class=\"string\">\"post-card-title\"</span>)[<span class=\"number\">0</span>].textContent ;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'textContent ï¼š'</span> + textContent );</span><br><span class=\"line\">    <span class=\"comment\">// console.log('page plainText : ' + page.plainText);</span></span><br><span class=\"line\">    page.render(url.split(<span class=\"string\">\"//\"</span>)[<span class=\"number\">1</span>]+<span class=\"string\">'.png'</span>);</span><br><span class=\"line\">    <span class=\"comment\">// ç»ˆæ­¢æ‰§è¡Œ</span></span><br><span class=\"line\">    phantom.exit();</span><br><span class=\"line\">  &#125;, <span class=\"number\">2000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'page Title : '</span> + page.title);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'page Url : '</span> + page.url);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'page Cookies :'</span> + page.cookies[<span class=\"number\">1</span>].name + <span class=\"string\">\" : \"</span> + page.cookies[<span class=\"number\">1</span>].value);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'page ZoomFactor : '</span> + page.zoomFactor);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'page OfflineStoragePath : '</span> + page.offlineStoragePath);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'page LibraryPath : '</span> + page.libraryPath);</span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"comment\">// ä»1.6ç‰ˆå¼€å§‹ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨page.includeJså°†jQueryåŒ…å«åˆ°é¡µé¢ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</span></span><br><span class=\"line\">  page.includeJs(<span class=\"string\">\"https://blog.weiyigeek.top/js/jquery/2.1.0-jquery.min.js?v=1.6.6\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> Title =  page.evaluate(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"comment\">// æ¨¡æ‹Ÿç‚¹å‡»è¯·æ±‚</span></span><br><span class=\"line\">      $(<span class=\"string\">\"a\"</span>)[<span class=\"number\">10</span>].click();</span><br><span class=\"line\">      <span class=\"comment\">// document.getElementsByTagName('a')[10].click()</span></span><br><span class=\"line\">       <span class=\"keyword\">return</span> <span class=\"built_in\">document</span>.title;</span><br><span class=\"line\">     &#125;);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Blog Title : \"</span> + Title);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>æ‰§è¡Œç»“æœ:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">phantomjs-2.1.1-windows\\bin&gt;phantomjs.exe 1.page-automation.js https://weiyigeek.top</span><br><span class=\"line\">The default user agent is Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/538.1 (KHTML, like Gecko) PhantomJS/2.1.1 Safari/538.1</span><br><span class=\"line\">----------------- åˆ†éš”çº¿ -------------------------</span><br><span class=\"line\">Status: success</span><br><span class=\"line\">page Title : ğŸŒ WeiyiGeek|å”¯ä¸€æå®¢-Geek-ITç½‘ç»œå®‰å…¨æŠ€æœ¯çŸ¥è¯†åˆ†äº«-ä¸»é¡µç«™ç‚¹</span><br><span class=\"line\">page Url : https://weiyigeek.top/</span><br><span class=\"line\">page Cookies :Hm_lvt_8bb888f4c802ff4cd2fdbc10d8ab7069 : 1673344341,1673344489,1673344525,1673344554</span><br><span class=\"line\">page ZoomFactor : 1</span><br><span class=\"line\">page OfflineStoragePath : C:/Users/WeiyiGeek/AppData/Local/Ofi Labs/PhantomJS</span><br><span class=\"line\">page LibraryPath : L:/DevOps/è‡ªåŠ¨åŒ–æµ‹è¯•/æ¨¡æ‹Ÿæµè§ˆå™¨è®¿é—®/PhantomJS/phantomjs-2.1.1-windows/bin</span><br><span class=\"line\">Blog Title : ğŸŒ WeiyiGeek|å”¯ä¸€æå®¢-Geek-ITç½‘ç»œå®‰å…¨æŠ€æœ¯çŸ¥è¯†åˆ†äº«-ä¸»é¡µç«™ç‚¹</span><br><span class=\"line\">textContent ï¼šå”¯ä¸€æå®¢çš„å­¦ä¹ ä¹‹è·¯æ±‡æ€»</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€šè¿‡nginxè¯·æ±‚æ—¥å¿—å¯ä»¥çœ‹åˆ° userAgent ä¹Ÿå‘ç”Ÿå˜åŒ–äº†</span></span><br><span class=\"line\">IP - - [10/Jan/2023:17:56:16 +0800] <span class=\"string\">\"GET /2018/1-1-1.html HTTP/1.1\"</span> 200 16602 <span class=\"string\">\"https://weiyigeek.top/\"</span> <span class=\"string\">\"WeiyiGeekAgent\"</span> <span class=\"string\">\"-\"</span> rt=0.000 urt=-</span><br><span class=\"line\">IP - - [10/Jan/2023:17:56:17 +0800] <span class=\"string\">\"GET /search.xml HTTP/1.1\"</span> 200 30200 <span class=\"string\">\"https://blog.weiyigeek.top/2018/1-1-1.html\"</span> <span class=\"string\">\"WeiyiGeekAgent\"</span> <span class=\"string\">\"-\"</span> rt=0.000 urt=-</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2022/10/20230110180300.png\" alt=\"WeiyiGeek.ä½¿ç”¨è¿›è¡Œ phantomjs DOM æ“ä½œå¹¶è·å–å…ƒç´ å±æ€§å›¾\" title=\"\" class=\"\">\n                <p>WeiyiGeek.ä½¿ç”¨è¿›è¡Œ phantomjs DOM æ“ä½œå¹¶è·å–å…ƒç´ å±æ€§å›¾</p>\n            </figure>\n<p><br></p>\n<h3 id=\"3-ç½‘é¡µå±å¹•æˆªå›¾\"><a href=\"#3-ç½‘é¡µå±å¹•æˆªå›¾\" class=\"headerlink\" title=\"3.ç½‘é¡µå±å¹•æˆªå›¾\"></a>3.ç½‘é¡µå±å¹•æˆªå›¾</h3><p>æè¿°: ç”±äºPhantomJSä½¿ç”¨çš„æ˜¯WebKitï¼Œè¿™æ˜¯ä¸€ä¸ªçœŸæ­£çš„å¸ƒå±€å’Œæ¸²æŸ“å¼•æ“ï¼Œå®ƒå¯ä»¥å°†ç½‘é¡µæ•è·ä¸ºå±å¹•æˆªå›¾, å› ä¸ºPhantomJSå¯ä»¥åœ¨ç½‘é¡µä¸Šå‘ˆç°ä»»ä½•å†…å®¹ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç”¨æ¥è½¬æ¢CSSæ ·å¼çš„HTMLå†…å®¹ï¼Œä¹Ÿå¯ä»¥è½¬æ¢SVGã€å›¾åƒå’ŒCanvaså…ƒç´ ã€‚</p>\n<p>å®é™…ä¸Šåœ¨å‰é¢çš„æ¡ˆä¾‹ä¸­, æˆ‘ä»¬å·²ç»ä½¿ç”¨ PhantomJS å±å¹•æˆªå›¾è¿™ä¸€åŠŸèƒ½, æ­¤å¤„åœ¨æ·±å…¥è®²è§£ä¸€ä¸‹å¯¼å‡ºä¸ºpdfæ ¼å¼ã€‚</p>\n<p>åœ¨ examples å­ç›®å½•ï¼Œè¿˜æœ‰ä¸€ä¸ªè„šæœ¬ <code>rasterize.js</code> è¿™è¡¨æ˜æ›´åŠ å®Œæ•´å‘ˆç° PhantomJS ç‰¹å¾, ä¸‹è¿°ä¹Ÿç½—åˆ—ä½œè€…åœ¨ä½¿ç”¨ä¸­æ‰€é‡åˆ°è¿‡çš„é—®é¢˜ã€‚</p>\n<p>å¦‚ä½•å»¶è¿Ÿæˆªå›¾ï¼Œé¡µé¢è¯·æ±‚çš„èµ„æºï¼Œå¦‚å›¾ç‰‡ã€å¼‚æ­¥cgiã€jsç­‰ï¼Œè¿”å›çš„æ—¶é—´ä»¥åŠæ‰§è¡Œçš„é•¿çŸ­éƒ½æ˜¯ä¸ç¡®å®šçš„ï¼Œå¦‚æœæˆªå›¾è¿‡æ—©ï¼Œå¯èƒ½å¾ˆå¤šç©ºç™½åŒºåŸŸï¼Œå› æ­¤éœ€è¦å®šæ—¶æˆªå›¾ï¼Œåœ¨æ‰“å¼€é¡µé¢åï¼Œä½¿ç”¨setTimeoutæ¥å»¶è¿Ÿæˆªå›¾<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ç‰‡æ®µç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"built_in\">window</span>.setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;  </span><br><span class=\"line\">  page.render(<span class=\"string\">\"weiyigeek.top.png\"</span>);  </span><br><span class=\"line\">  phantom.exit();  </span><br><span class=\"line\">&#125;, <span class=\"number\">1000</span>);</span><br></pre></td></tr></table></figure></p>\n<p>å¦‚ä½•ä¿è¯ç½‘é¡µç«™ç‚¹å®Œæ•´æˆªå›¾ã€‚<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// è®¾ç½® viewPortSize å±æ€§è®¾ç½®å¸ƒå±€è¿‡ç¨‹çš„è§†å£å¤§å°ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">// åœ¨åŠ è½½é¡µé¢ä¹‹å‰è®¾ç½®é¦–é€‰çš„åˆå§‹å¤§å°éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚åœ¨â€œæ¨ªå‘â€å’Œâ€œçºµå‘â€ä¹‹é—´è¿›è¡Œé€‰æ‹©ã€‚</span></span><br><span class=\"line\">page.viewportSize = &#123;<span class=\"attr\">width</span>: <span class=\"number\">1024</span>,<span class=\"attr\">height</span>: <span class=\"number\">720</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è®¾ç½® clipRect å®šä¹‰è¦å…‰æ …åŒ–çš„ç½‘é¡µçš„çŸ©å½¢åŒºåŸŸï¼Œè‹¥æœªè®¾ç½®å‰ªåˆ‡çŸ©å½¢ page.render å°†æˆªå–å¤„ç†æ•´ä¸ªç½‘é¡µã€‚</span></span><br><span class=\"line\">page.clipRect = &#123;</span><br><span class=\"line\">  top: <span class=\"number\">14</span>,</span><br><span class=\"line\">  left: <span class=\"number\">3</span>,</span><br><span class=\"line\">  width: <span class=\"number\">400</span>,</span><br><span class=\"line\">  height: <span class=\"number\">300</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è®¾ç½® paperSize  å±æ€§å®šä¹‰å‘ˆç°ä¸ºPDFæ—¶ç½‘é¡µçš„å¤§å°ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">// Supported dimension units are: 'mm', 'cm', 'in', 'px'. No unit means 'px'.</span></span><br><span class=\"line\">page.paperSize = &#123;</span><br><span class=\"line\">  width: <span class=\"string\">'5in'</span>,</span><br><span class=\"line\">  height: <span class=\"string\">'7in'</span>,</span><br><span class=\"line\">  margin: &#123;</span><br><span class=\"line\">    top: <span class=\"string\">'50px'</span>,</span><br><span class=\"line\">    left: <span class=\"string\">'20px'</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// JS åŸç”Ÿæ–¹æ³•è·å–å½“å‰é¡µé¢å°ºå¯¸</span></span><br><span class=\"line\"><span class=\"comment\">// é€šè¿‡BOMæ–¹æ³•æ“ä½œæ»šåŠ¨æ¡</span></span><br><span class=\"line\"><span class=\"built_in\">window</span>.scrollTo(<span class=\"number\">0</span>,<span class=\"number\">10000</span>);</span><br><span class=\"line\"><span class=\"comment\">// é€‚åº”çš„é«˜åº¦</span></span><br><span class=\"line\"><span class=\"built_in\">window</span>.document.body.scrollTop = <span class=\"built_in\">document</span>.body.scrollHeight;</span><br></pre></td></tr></table></figure></p>\n<p>ç®€å•ç¤ºä¾‹:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç«™ç‚¹å¯¼å‡ºä¸ºPDFæ–‡ä»¶</span></span><br><span class=\"line\">phantomjs.exe ..\\examples\\rasterize.js https://blog.weiyigeek.top blog.weiyigeek.pdf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å¤šç«™ç‚¹å¯¼å‡ºä¸ºpngå›¾ç‰‡</span></span><br><span class=\"line\">phantomjs.exe ..\\examples\\render_multi_url.js https://weiyigeek.top https://blog.weiyigeek.top</span><br><span class=\"line\">Rendered <span class=\"string\">'https://weiyigeek.top'</span> at <span class=\"string\">'rendermulti-1.png'</span></span><br><span class=\"line\">Rendered <span class=\"string\">'https://blog.weiyigeek.top'</span> at <span class=\"string\">'rendermulti-2.png'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç«™ç‚¹å¤šå°ºå¯¸å¯¼å‡ºä¸ºpngå›¾ç‰‡</span></span><br><span class=\"line\">phantomjs.exe ..\\examples\\responsive-screenshot.js https://blog.weiyigeek.top</span><br><span class=\"line\">Saving blog.weiyigeek.top/2023-1-11_09-39-25-297_320.png</span><br><span class=\"line\">Saving blog.weiyigeek.top/2023-1-11_09-39-26-934_480.png</span><br><span class=\"line\">Saving blog.weiyigeek.top/2023-1-11_09-39-27-816_768.png</span><br><span class=\"line\">Saving blog.weiyigeek.top/2023-1-11_09-39-28-852_1024.png</span><br><span class=\"line\">Saving blog.weiyigeek.top/2023-1-11_09-39-33-267_1200.png</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h3 id=\"4-ç½‘é¡µç«™ç‚¹è¯·æ±‚\"><a href=\"#4-ç½‘é¡µç«™ç‚¹è¯·æ±‚\" class=\"headerlink\" title=\"4.ç½‘é¡µç«™ç‚¹è¯·æ±‚\"></a>4.ç½‘é¡µç«™ç‚¹è¯·æ±‚</h3><p>ç”±äºPhantomJSå…è®¸æ£€æŸ¥ç½‘ç»œæµé‡ï¼Œå› æ­¤å®ƒé€‚åˆäºå¯¹ç½‘ç»œè¡Œä¸ºå’Œæ€§èƒ½è¿›è¡Œå„ç§åˆ†æï¼Œå¯ä»¥ä½¿ç”¨onResourceRequestedå’ŒonResourceReceivedå—…æ¢æ‰€æœ‰èµ„æºè¯·æ±‚å’Œå“åº”ã€‚è„šæœ¬netlog.jsä¸­è¯´æ˜äº†è®°å½•æ¯ä¸ªè¯·æ±‚å’Œå“åº”çš„ä¸€ä¸ªéå¸¸ç®€å•çš„ç¤ºä¾‹ï¼š<br><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> page = <span class=\"built_in\">require</span>(<span class=\"string\">'webpage'</span>).create();</span><br><span class=\"line\">page.onResourceRequested = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">request</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Request '</span> + <span class=\"built_in\">JSON</span>.stringify(request, <span class=\"literal\">undefined</span>, <span class=\"number\">4</span>));</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">page.onResourceReceived = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Receive '</span> + <span class=\"built_in\">JSON</span>.stringify(response, <span class=\"literal\">undefined</span>, <span class=\"number\">4</span>));</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">page.open(url);</span><br></pre></td></tr></table></figure></p>\n<p><strong>ç®€å•ç¤ºä¾‹:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä»¥HARæ ¼å¼æ•è·ç½‘ç»œæµé‡ï¼Œå¹¶ä¸”å¯ä»¥å¯¼å…¥åˆ° har views è¿›è¡Œå¯è§†åŒ–æŸ¥çœ‹</span></span><br><span class=\"line\">phantomjs.exe ..\\examples\\netsniff.js https://www.weiyigeek.top</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºç«™ç‚¹è¯·æ±‚ç­‰å¾…ã€ä¼ è¾“çš„æ—¶é—´</span></span><br><span class=\"line\">timings: &#123;</span><br><span class=\"line\">  blocked: 0,</span><br><span class=\"line\">  dns: -1,</span><br><span class=\"line\">  connect: -1,</span><br><span class=\"line\">  send: 0,</span><br><span class=\"line\">  <span class=\"built_in\">wait</span>: startReply.time - request.time,</span><br><span class=\"line\">  receive: endReply.time - startReply.time,</span><br><span class=\"line\">  ssl: -1</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è½¬å‚¨æ‰€æœ‰ç½‘ç»œè¯·æ±‚å’Œå“åº”</span></span><br><span class=\"line\">phantomjs.exe ..\\examples\\netlog.js https://weiyigeek.top | more</span><br><span class=\"line\">requested: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"headers\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Accept\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"value\"</span>: <span class=\"string\">\"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">\"name\"</span>: <span class=\"string\">\"User-Agent\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"value\"</span>: <span class=\"string\">\"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/538.1 (KHTML, like Gecko) PhantomJS/2.1.1 Safari/538.1\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">\"id\"</span>: 1,</span><br><span class=\"line\">    <span class=\"string\">\"method\"</span>: <span class=\"string\">\"GET\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"time\"</span>: <span class=\"string\">\"2023-01-11T01:46:10.579Z\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"url\"</span>: <span class=\"string\">\"https://weiyigeek.top/\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">received: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"body\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"bodySize\"</span>: 14489,</span><br><span class=\"line\">    <span class=\"string\">\"contentType\"</span>: <span class=\"string\">\"text/html; charset=utf-8\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"headers\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">\"name\"</span>: <span class=\"string\">\"Server\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"value\"</span>: <span class=\"string\">\"nginx\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">....</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>å¯¼å…¥.ç¤ºä¾‹1ç”Ÿæˆçš„HARåˆ°å¯è§†åŒ–vieweræ˜¾ç¤ºï¼ˆ<a href=\"http://www.softwareishard.com/har/viewer/\" target=\"_blank\" rel=\"noopener\">http://www.softwareishard.com/har/viewer/</a> ï¼‰: </p>\n<p><img src=\"https://img.weiyigeek.top/2022/10/20230111095803.png\" alt=\"WeiyiGeek.HARå¯è§†åŒ–vieweræ˜¾ç¤ºå›¾\"></p>\n<p><br/></p>\n<h3 id=\"5-ç®€å•çš„WebæœåŠ¡\"><a href=\"#5-ç®€å•çš„WebæœåŠ¡\" class=\"headerlink\" title=\"5.ç®€å•çš„WebæœåŠ¡\"></a>5.ç®€å•çš„WebæœåŠ¡</h3><p>ä½¿ç”¨ PhantomJS æˆ‘ä»¬å¾ˆå®¹æ˜“å®ç°ä¸€ä¸ª Web Server, ä¸‹é¢æˆ‘ä»¬æ¥å®è·µçœ‹çœ‹ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">\"use strict\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> port, server, service,</span><br><span class=\"line\">    system = <span class=\"built_in\">require</span>(<span class=\"string\">'system'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (system.args.length !== <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Usage: simpleserver.js &lt;portnumber&gt;'</span>);</span><br><span class=\"line\">    phantom.exit(<span class=\"number\">1</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    port = system.args[<span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"comment\">// æ³¨æ„,æ­¤å¤„ä½¿ç”¨ä¾èµ– webserver API ï¼Œå…¶ä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒå®˜ç½‘ API</span></span><br><span class=\"line\">    server = <span class=\"built_in\">require</span>(<span class=\"string\">'webserver'</span>).create();</span><br><span class=\"line\"></span><br><span class=\"line\">    service = server.listen(port, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">request, response</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'Request at '</span> + <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>());</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"built_in\">JSON</span>.stringify(request, <span class=\"literal\">null</span>, <span class=\"number\">4</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        response.statusCode = <span class=\"number\">200</span>;</span><br><span class=\"line\">        response.headers = &#123;</span><br><span class=\"line\">            <span class=\"string\">'Cache'</span>: <span class=\"string\">'no-cache'</span>,</span><br><span class=\"line\">            <span class=\"string\">'Content-Type'</span>: <span class=\"string\">'text/html'</span></span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        response.write(<span class=\"string\">'&lt;html&gt;'</span>);</span><br><span class=\"line\">        response.write(<span class=\"string\">'&lt;head&gt;'</span>);</span><br><span class=\"line\">        response.write(<span class=\"string\">'&lt;title&gt;Hello, world!&lt;/title&gt;'</span>);</span><br><span class=\"line\">        response.write(<span class=\"string\">'&lt;/head&gt;'</span>);</span><br><span class=\"line\">        response.write(<span class=\"string\">'&lt;body&gt;'</span>);</span><br><span class=\"line\">        response.write(<span class=\"string\">'&lt;p&gt;This is from PhantomJS web server.&lt;/p&gt;'</span>);</span><br><span class=\"line\">        response.write(<span class=\"string\">'&lt;p&gt;Request data:&lt;/p&gt;'</span>);</span><br><span class=\"line\">        response.write(<span class=\"string\">'&lt;pre&gt;'</span> + <span class=\"built_in\">JSON</span>.stringify(request, <span class=\"literal\">null</span>, <span class=\"number\">4</span>)+<span class=\"string\">'&lt;/pre&gt;'</span>);</span><br><span class=\"line\">        response.write(<span class=\"string\">'&lt;p&gt;response data:&lt;/p&gt;'</span>);</span><br><span class=\"line\">        response.write(<span class=\"string\">'&lt;pre&gt;'</span> + <span class=\"built_in\">JSON</span>.stringify(response, <span class=\"literal\">null</span>, <span class=\"number\">4</span>)+<span class=\"string\">'&lt;/pre&gt;'</span>);</span><br><span class=\"line\">        response.write(<span class=\"string\">'&lt;/body&gt;'</span>);</span><br><span class=\"line\">        response.write(<span class=\"string\">'&lt;/html&gt;'</span>);</span><br><span class=\"line\">        response.close();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (service) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'Web server running on port '</span> + port);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'Error: Could not create web server listening on port '</span> + port);</span><br><span class=\"line\">        phantom.exit();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// è‡ªå·±è¯·æ±‚è‡ªå·±</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> url = <span class=\"string\">\"http://localhost:\"</span> + port + <span class=\"string\">\"/foo/bar.php?asdf=true\"</span>;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"SENDING REQUEST TO:\"</span>);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(url);</span><br><span class=\"line\">    page.open(url, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">status</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (status !== <span class=\"string\">'success'</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'FAIL to load the address'</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">\"GOT REPLY FROM SERVER:\"</span>);</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(page.content);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">       phantom.exit();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2022/10/20230111101451.png\" alt=\"WeiyiGeek.simpleserverå›¾\" title=\"\" class=\"\">\n                <p>WeiyiGeek.simpleserverå›¾</p>\n            </figure>\n<hr>\n<h2 id=\"0x03-é¡¹ç›®å®è·µ\"><a href=\"#0x03-é¡¹ç›®å®è·µ\" class=\"headerlink\" title=\"0x03 é¡¹ç›®å®è·µ\"></a>0x03 é¡¹ç›®å®è·µ</h2><h3 id=\"1-ä½¿ç”¨Java-phantomjså®ç°ç«™ç‚¹æˆªå›¾æ•è·å¹¶å°†aæ ‡ç­¾é“¾æ¥æ ‡çº¢ã€‚\"><a href=\"#1-ä½¿ç”¨Java-phantomjså®ç°ç«™ç‚¹æˆªå›¾æ•è·å¹¶å°†aæ ‡ç­¾é“¾æ¥æ ‡çº¢ã€‚\" class=\"headerlink\" title=\"1.ä½¿ç”¨Java+phantomjså®ç°ç«™ç‚¹æˆªå›¾æ•è·å¹¶å°†aæ ‡ç­¾é“¾æ¥æ ‡çº¢ã€‚\"></a>1.ä½¿ç”¨Java+phantomjså®ç°ç«™ç‚¹æˆªå›¾æ•è·å¹¶å°†aæ ‡ç­¾é“¾æ¥æ ‡çº¢ã€‚</h3><p>æ­¤å¤„ï¼Œåœ¨Windowså¹³å°ä¸‹å®è·µï¼Œå½“ç„¶Linuxä¸‹æ‰§è¡Œä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½ å¯ä»¥éœ€è¦å®‰è£…ç›¸åº”çš„javaç¯å¢ƒè€Œå·²ã€‚</p>\n<p><strong>2.screen-capture.js ç¤ºä¾‹æ–‡ä»¶:</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// # @Filename: 2.screen-capture.js</span></span><br><span class=\"line\"><span class=\"comment\">// # @Author: WeiyiGeek</span></span><br><span class=\"line\"><span class=\"comment\">// # @Description: æŒ‡å®šç½‘é¡µç«™ç‚¹æˆªå–å¹¶ç”Ÿæˆpdfä¸pngä¸¤ç§æ ¼å¼</span></span><br><span class=\"line\"><span class=\"comment\">// # @Create Time: 2023å¹´1æœˆ11æ—¥ 12:39:06</span></span><br><span class=\"line\"><span class=\"comment\">// # @Last Modified time: 2023å¹´1æœˆ11æ—¥ 12:39:09</span></span><br><span class=\"line\"><span class=\"comment\">// # @E-mail: master@weiyigeek.top</span></span><br><span class=\"line\"><span class=\"comment\">// # @Blog: https://www.weiyigeek.top</span></span><br><span class=\"line\"><span class=\"comment\">// # @wechat: WeiyiGeeker</span></span><br><span class=\"line\"><span class=\"comment\">// # @Github: https://github.com/WeiyiGeek/SecOpsDev/AutomatedTesting/Web/phantomjs</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> page = <span class=\"built_in\">require</span>(<span class=\"string\">'webpage'</span>).create(),</span><br><span class=\"line\">system = <span class=\"built_in\">require</span>(<span class=\"string\">'system'</span>),</span><br><span class=\"line\">url,outputType,size,nowTime;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>( system.args.length == <span class=\"number\">1</span> )&#123;  </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Usage: screen-capture.js url [png|pdf] [paperwidth*paperheight|paperformat] [zoom]\"</span>)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'  paper (pdf output) examples: \"5in*7.5in\", \"10cm*20cm\", \"A4\", \"Letter\"'</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'  image (png/jpg output) examples: \"1920px\" entire page, window width 1920px'</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'                                   \"800px*600px\" window, clipped to 800x600'</span>);</span><br><span class=\"line\">  phantom.exit();  </span><br><span class=\"line\">&#125;<span class=\"keyword\">else</span>&#123;  </span><br><span class=\"line\">  url = system.args[<span class=\"number\">1</span>];</span><br><span class=\"line\">  outputType = system.args[<span class=\"number\">2</span>];</span><br><span class=\"line\"> </span><br><span class=\"line\">  nowTime = <span class=\"built_in\">Date</span>.now();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// é»˜è®¤å®½åº¦ä¸é«˜åº¦</span></span><br><span class=\"line\">  pageWidth = <span class=\"number\">1024</span>;</span><br><span class=\"line\">  pageHeight = <span class=\"number\">720</span>;</span><br><span class=\"line\">  page.viewportSize = &#123; <span class=\"attr\">width</span>: pageWidth, <span class=\"attr\">height</span>: pageHeight &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (system.args.length &gt; <span class=\"number\">3</span> &amp;&amp; outputType === <span class=\"string\">\"pdf\"</span>) &#123;</span><br><span class=\"line\">    size = system.args[<span class=\"number\">3</span>].split(<span class=\"string\">'*'</span>);</span><br><span class=\"line\">    page.paperSize = size.length === <span class=\"number\">2</span> ? &#123; <span class=\"attr\">width</span>: size[<span class=\"number\">0</span>], <span class=\"attr\">height</span>: size[<span class=\"number\">1</span>], <span class=\"attr\">margin</span>: <span class=\"string\">'0px'</span> &#125;</span><br><span class=\"line\">                                       : &#123; <span class=\"attr\">format</span>: <span class=\"string\">'A4'</span>, <span class=\"attr\">orientation</span>: <span class=\"string\">'portrait'</span>, <span class=\"attr\">margin</span>: <span class=\"string\">'1cm'</span> &#125;;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (system.args.length &gt; <span class=\"number\">3</span> &amp;&amp; system.args[<span class=\"number\">3</span>].substr(<span class=\"number\">-2</span>) === <span class=\"string\">\"px\"</span>) &#123;</span><br><span class=\"line\">    size = system.args[<span class=\"number\">3</span>].split(<span class=\"string\">'*'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (size.length === <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">      pageWidth = <span class=\"built_in\">parseInt</span>(size[<span class=\"number\">0</span>], <span class=\"number\">10</span>);</span><br><span class=\"line\">      pageHeight = <span class=\"built_in\">parseInt</span>(size[<span class=\"number\">1</span>], <span class=\"number\">10</span>);</span><br><span class=\"line\">      page.viewportSize = &#123; <span class=\"attr\">width</span>: pageWidth, <span class=\"attr\">height</span>: pageHeight &#125;;</span><br><span class=\"line\">      <span class=\"comment\">// page.clipRect = &#123; top: 0, left: 0, width: pageWidth, height: pageHeight &#125;;</span></span><br><span class=\"line\">      page.clipRect = &#123; <span class=\"attr\">top</span>: <span class=\"number\">0</span>, <span class=\"attr\">left</span>: <span class=\"number\">0</span>, <span class=\"attr\">width</span>: pageWidth &#125;;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">\"size:\"</span>, system.args[<span class=\"number\">3</span>]);</span><br><span class=\"line\">      pageWidth = <span class=\"built_in\">parseInt</span>(system.args[<span class=\"number\">3</span>], <span class=\"number\">10</span>);</span><br><span class=\"line\">      pageHeight = <span class=\"built_in\">parseInt</span>(pageWidth * <span class=\"number\">3</span>/<span class=\"number\">4</span>, <span class=\"number\">10</span>); <span class=\"comment\">// it's as good an assumption as any</span></span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log (<span class=\"string\">\"pageHeight:\"</span>,pageHeight);</span><br><span class=\"line\">      page.viewportSize = &#123; <span class=\"attr\">width</span>: pageWidth, <span class=\"attr\">height</span>: pageHeight &#125;;</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (system.args.length &gt; <span class=\"number\">4</span>) &#123;</span><br><span class=\"line\">    page.zoomFactor = system.args[<span class=\"number\">4</span>];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// è¯·æ±‚æŒ‡å®šç«™ç‚¹å‡½æ•°</span></span><br><span class=\"line\">  page.open(url, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">status</span>)</span>&#123;  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (status != <span class=\"string\">\"success\"</span>)&#123;  </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'FAIL to load the address'</span>);  </span><br><span class=\"line\">    phantom.exit();  </span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// è¯·æ±‚ç«™ç‚¹ç›®æ ‡é¡µé¢ä¸Šä¸‹æ–‡ç¯å¢ƒ</span></span><br><span class=\"line\">    page.evaluate(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; </span><br><span class=\"line\">      <span class=\"comment\">//æ»šåŠ¨åˆ°åº•éƒ¨  </span></span><br><span class=\"line\">      <span class=\"built_in\">window</span>.scrollTo(<span class=\"number\">0</span>,<span class=\"built_in\">document</span>.body.scrollHeight);</span><br><span class=\"line\">    </span><br><span class=\"line\">      <span class=\"comment\">// DOM æ“ä½œç»™æ‰€æœ‰Aæ ‡ç­¾åŠ ä¸Šä¸€ä¸ªè¾¹æ¡†</span></span><br><span class=\"line\">      <span class=\"built_in\">window</span>.setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;  </span><br><span class=\"line\">        <span class=\"keyword\">var</span> plist = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">\"a\"</span>);  </span><br><span class=\"line\">        <span class=\"keyword\">var</span> len = plist.length;  </span><br><span class=\"line\">        <span class=\"keyword\">while</span>(len)  </span><br><span class=\"line\">        &#123;  </span><br><span class=\"line\">            len--;  </span><br><span class=\"line\">            <span class=\"keyword\">var</span> el = plist[len];  </span><br><span class=\"line\">            el.style.border = <span class=\"string\">\"1px solid red\"</span>;  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">      &#125;, <span class=\"number\">2000</span>);  </span><br><span class=\"line\">  &#125;);  </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">window</span>.setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>)</span>&#123;  </span><br><span class=\"line\">      <span class=\"comment\">// åœ¨æœ¬åœ°ç”Ÿæˆæˆªå›¾ä»¥åŠPDF</span></span><br><span class=\"line\">      filename = url.split(<span class=\"string\">\"//\"</span>)[<span class=\"number\">1</span>]+<span class=\"string\">\"_\"</span>+nowTime+<span class=\"string\">\".\"</span>+outputType;</span><br><span class=\"line\">      page.render(filename);</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Output : \"</span> + filename);</span><br><span class=\"line\">      <span class=\"comment\">// æ‰“å°htmlå†…å®¹</span></span><br><span class=\"line\">      <span class=\"comment\">// console.log(page.content); </span></span><br><span class=\"line\">      phantom.exit();  </span><br><span class=\"line\">    &#125;, <span class=\"number\">3000</span>);      </span><br><span class=\"line\">    &#125;;  </span><br><span class=\"line\">  &#125;); </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å‘½ä»¤è¡Œæ‰§è¡Œ:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; phantomjs.exe 2.screen-capture.js</span><br><span class=\"line\">Usage: screen-capture.js url [png|pdf|jpeg|bmp|ppm|gif] [paperwidth*paperheight|paperformat] [zoom]</span><br><span class=\"line\">  paper (pdf output) examples: <span class=\"string\">\"5in*7.5in\"</span>, <span class=\"string\">\"10cm*20cm\"</span>, <span class=\"string\">\"A4\"</span>, <span class=\"string\">\"Letter\"</span></span><br><span class=\"line\">  image (png/jpg output) examples: <span class=\"string\">\"1920px\"</span> entire page, window width 1920px</span><br><span class=\"line\">                                   <span class=\"string\">\"800px*600px\"</span> window, clipped to 800x600</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; phantomjs.exe 2.screen-capture.js https://blog.weiyigeek.top/2018/1-1-1.html png 1024px*720px</span><br><span class=\"line\">Output : blog.weiyigeek.top/2018/1-1-1.html_1673407992804.png</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; phantomjs.exe 2.screen-capture.js https://blog.weiyigeek.top/2018/1-1-1.html pdf 1024px*720px</span><br><span class=\"line\">Output : blog.weiyigeek.top/2018/1-1-1.html_1673408871418.pdf</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2022/10/20230111120117.png\" alt=\"WeiyiGeek.ç”ŸæˆPDFä¸PNGå›¾ç‰‡\" title=\"\" class=\"\">\n                <p>WeiyiGeek.ç”ŸæˆPDFä¸PNGå›¾ç‰‡</p>\n            </figure>\n<p><br/></p>\n<p>æ­¤å¤„ä½¿ç”¨javaæ“ä½œphantomjsçš„ä»£ç ç¤ºä¾‹:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> top.weiyigeek.weixin;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedReader;  </span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;  </span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;  </span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\">/** </span></span><br><span class=\"line\"><span class=\"comment\"> * ç±»åï¼š DownLoad </span></span><br><span class=\"line\"><span class=\"comment\"> * åŒ…åï¼š top.weiyigeek.weixin </span></span><br><span class=\"line\"><span class=\"comment\"> * ä½œè€…ï¼š  </span></span><br><span class=\"line\"><span class=\"comment\"> * æ—¶é—´ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"> * æè¿°ï¼š TODO(è¿™é‡Œç”¨ä¸€å¥è¯æè¿°è¿™ä¸ªç±»çš„ä½œç”¨)  </span></span><br><span class=\"line\"><span class=\"comment\"> */</span>  </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DynamicDownLoad</span> </span>&#123;  </span><br><span class=\"line\">    <span class=\"comment\">/** </span></span><br><span class=\"line\"><span class=\"comment\">     * æ–¹æ³•åï¼šgetSrcContent </span></span><br><span class=\"line\"><span class=\"comment\">     * ä½œè€…ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">     * åˆ›å»ºæ—¶é—´ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">     * æè¿°ï¼šæ ¹æ®ä¼ å…¥çš„urlï¼Œè°ƒç”¨phantomjsè¿›è¡Œä¸‹è½½ï¼Œå¹¶è¿”å›æºç ä¿¡æ¯ </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> url </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">     */</span>  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">getSrcContent</span><span class=\"params\">(String url, String type)</span></span>&#123;  </span><br><span class=\"line\">      <span class=\"comment\">//windowsä¸‹phantomjsä½ç½®  </span></span><br><span class=\"line\">      String path = <span class=\"string\">\"L:/DevOps/è‡ªåŠ¨åŒ–æµ‹è¯•/æ¨¡æ‹Ÿæµè§ˆå™¨è®¿é—®/PhantomJS/phantomjs-2.1.1-windows/bin\"</span>;  </span><br><span class=\"line\">      Runtime rt = Runtime.getRuntime();  </span><br><span class=\"line\">      Process process = <span class=\"keyword\">null</span>;  </span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;  </span><br><span class=\"line\">        process = rt.exec(path + <span class=\"string\">\"phantomjs.exe L:/example/2.screen-capture.js\"</span> + url.trim() + <span class=\"string\">\" \"</span> + type.trim());  </span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;  </span><br><span class=\"line\">        <span class=\"comment\">// TODO è¿™é‡Œå†™å¼‚å¸¸å¤„ç†çš„ä»£ç   </span></span><br><span class=\"line\">        e.printStackTrace();  </span><br><span class=\"line\">      &#125;  </span><br><span class=\"line\">      InputStream is = process.getInputStream();  </span><br><span class=\"line\">      BufferedReader br = <span class=\"keyword\">new</span> BufferedReader(<span class=\"keyword\">new</span> InputStreamReader(is));  </span><br><span class=\"line\">      StringBuffer sbf = <span class=\"keyword\">new</span> StringBuffer();  </span><br><span class=\"line\">      String tmp = <span class=\"string\">\"\"</span>;  </span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;  </span><br><span class=\"line\">        <span class=\"keyword\">while</span>((tmp = br.readLine())!=<span class=\"keyword\">null</span>)&#123;    </span><br><span class=\"line\">          sbf.append(tmp);    </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;  </span><br><span class=\"line\">        <span class=\"comment\">// TODO è¿™é‡Œå†™å¼‚å¸¸å¤„ç†çš„ä»£ç   </span></span><br><span class=\"line\">        e.printStackTrace();  </span><br><span class=\"line\">      &#125;  </span><br><span class=\"line\">      <span class=\"keyword\">return</span> sbf.toString();  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">      </span><br><span class=\"line\">    <span class=\"comment\">/** </span></span><br><span class=\"line\"><span class=\"comment\">     * æ–¹æ³•åï¼šmain </span></span><br><span class=\"line\"><span class=\"comment\">     * ä½œè€…ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">     * åˆ›å»ºæ—¶é—´ï¼š</span></span><br><span class=\"line\"><span class=\"comment\">     * æè¿°ï¼šTODO (è¿™é‡Œç”¨ä¸€å¥è¯æè¿°è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨) </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> args </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> IOException  </span></span><br><span class=\"line\"><span class=\"comment\">     */</span>  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span></span>&#123;  </span><br><span class=\"line\">      <span class=\"comment\">// TODO Auto-generated method stub  </span></span><br><span class=\"line\">      String src = DynamicDownLoad.getSrcContent(<span class=\"string\">\"https://weiyigeek.top\"</span>,<span class=\"string\">\"pdf\"</span>,<span class=\"string\">\"1024px*720px\"</span>);  </span><br><span class=\"line\">      System.out.println(src);</span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>è¡¥å……ï¼šå¯¹äºå»¶è¿Ÿæˆªå›¾ï¼Œè¿˜æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ— æ³•ç›‘å¬ajaxæˆ–è€…èµ„æºæ˜¯å¦å®Œæ•´åŠ è½½å¯¼è‡´é¡µé¢ä¸å…¨ï¼›è§£å†³æ–¹æ¡ˆ viewportè®¾ç½®ä¸€ä¸ªæ¯”æˆªå›¾é«˜åº¦çš„çŸ®ï¼Œé€šè¿‡æ¯”è¾ƒç”Ÿäº§å›¾ç‰‡çš„é«˜åº¦æ¥åˆ¤æ–­æˆªå–å›¾ç‰‡çš„ç»“æœ</p>\n<h3 id=\"2-ç›‘æ§ç½‘ç«™ä¸»é¡µå˜åŒ–å¹¶æˆªå›¾åˆ°ä¼ä¸šå¾®ä¿¡é¢„è­¦\"><a href=\"#2-ç›‘æ§ç½‘ç«™ä¸»é¡µå˜åŒ–å¹¶æˆªå›¾åˆ°ä¼ä¸šå¾®ä¿¡é¢„è­¦\" class=\"headerlink\" title=\"2.ç›‘æ§ç½‘ç«™ä¸»é¡µå˜åŒ–å¹¶æˆªå›¾åˆ°ä¼ä¸šå¾®ä¿¡é¢„è­¦\"></a>2.ç›‘æ§ç½‘ç«™ä¸»é¡µå˜åŒ–å¹¶æˆªå›¾åˆ°ä¼ä¸šå¾®ä¿¡é¢„è­¦</h3><p>å¥½ï¼Œä¸‹é¢æ¥åˆ°äº†æˆ‘ä»¬é¡¹ç›®å®è·µäº†ï¼Œä¸»è¦å®ç°çš„åŠŸèƒ½æ˜¯åˆ©ç”¨Shellè„šæœ¬ä»¥åŠcrontabå®šæ—¶ä»»åŠ¡ä»¥åŠ PhantomJS æ¥ç›‘æ§ç½‘ç«™é¦–é¡µçš„å˜åŒ–ï¼Œå¹¶ä»¥æˆªå›¾çš„æ–¹å¼é€šçŸ¥ç»™ä¼ä¸šå¾®ä¿¡å¯¹åº”è¿ç»´ç¾¤ï¼ŒåŠæ—¶äº†è§£ç½‘ç«™è¿è¡Œå®‰å…¨ï¼Œé˜²æ­¢ç½‘ç«™ä¸»é¡µè¢«é»‘ã€è¢«åŠ«æŒçš„é£é™©ã€‚</p>\n<p>æ­¤å¤„æˆ‘æ˜¯åœ¨CentOS7ä¸­å®ç°çš„ï¼Œå®‰è£…æ–¹æ³•è¯·å‚è€ƒå‰é¢ç« èŠ‚ã€‚</p>\n<p>é¡¹ç›®åœ°å€: <a href=\"https://github.com/WeiyiGeek/SecOpsDev/tree/master/AutomatedTesting/Web/phantomjs/Project/Shell\" target=\"_blank\" rel=\"noopener\">https://github.com/WeiyiGeek/SecOpsDev/tree/master/AutomatedTesting/Web/phantomjs/Project/Shell</a></p>\n<p>(PS: æ–‡ç« ä¸­ç¤ºä¾‹ä»£ç å¯èƒ½éšç€æ—¶é—´æ¨ç§»ä¼šæœ‰æ›´æ–°ï¼Œå»ºè®®å°ä¼™ä¼´é€šè¿‡ä¸Šé¢ğŸ‘†Githubåœ°å€è·å–å“Ÿ!)</p>\n<p><strong>é¡¹ç›®è„šæœ¬ä¸PhantomJSè„šæœ¬æ–‡ä»¶</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/GitProject/SecOpsDev1/AutomatedTesting/Web/phantomjs/Project/Shell </span><br><span class=\"line\">1.WebScreenCapture.sh  screen-capture.js</span><br><span class=\"line\"></span><br><span class=\"line\">mkdir /usr/<span class=\"built_in\">local</span>/src/phantomjs/custom</span><br><span class=\"line\">cp screen-capture.js /usr/<span class=\"built_in\">local</span>/src/phantomjs/custom</span><br><span class=\"line\"><span class=\"comment\"># æ³¨æ„ï¼Œæ­¤å¤„å»ºè®®å°† screen-capture.js æ”¾åœ¨ /usr/local/src/phantomjs/custom ç›®å½•ä¸­</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>Shell è„šæœ¬ WebMonitorScreenCapture.sh</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">## @Title: ä½¿ç”¨phantomjsé’ˆå¯¹ç½‘ç«™é¦–é¡µç›‘æ§é¢„ä¸ç›‘æ§æ£€æµ‹å¹¶è¿›è¡Œä¼ä¸šå¾®ä¿¡é¢„è­¦</span></span><br><span class=\"line\"><span class=\"comment\">## @Author: WeiyiGeek</span></span><br><span class=\"line\"><span class=\"comment\">## @CreateTime: 2023å¹´1æœˆ11æ—¥ 15ç‚¹34åˆ†</span></span><br><span class=\"line\"><span class=\"comment\">## @å¾®ä¿¡: WeiyiGeeker</span></span><br><span class=\"line\"><span class=\"comment\">## @Blog: https://blog.weiyigeek.top</span></span><br><span class=\"line\"><span class=\"comment\">## @Version: 1.3</span></span><br><span class=\"line\"><span class=\"comment\"># set -e</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç›‘æ§ç›®æ ‡ç«™ç‚¹é…ç½®æ–‡ä»¶</span></span><br><span class=\"line\">MONITORSITE=/tmp/target.txt</span><br><span class=\"line\">cat &gt; <span class=\"variable\">$&#123;MONITORSITE&#125;</span> &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\">https://www.weiyigeek.top</span><br><span class=\"line\">https://blog.weiyigeek.top</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å…¨å±€å˜é‡</span></span><br><span class=\"line\"><span class=\"comment\"># è¯·å°†æ­¤å¤„ä¿®æ”¹ä¸ºä½ ä¼ä¸šå¾®ä¿¡æœºå™¨äººwebhookåœ°å€</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> WXMSGURL=<span class=\"string\">\"https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=51648169-7638-43a4-97d6-dfd39b48ea23\"</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> NETTYPE=<span class=\"string\">\"å¤–ç½‘è®¿é—®\"</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> HCMSG=<span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> XKMSG=<span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> ZHCXMSG=<span class=\"string\">\"\"</span></span><br><span class=\"line\"><span class=\"comment\"># å®‰è£…ä½¿ç”¨phantomjsæ—¶æŠ¥ ` libproviders.so: cannot open shared object file:` é”™è¯¯æ—¶éœ€è¦å–æ¶ˆå¦‚ä¸‹æ³¨é‡Šã€‚</span></span><br><span class=\"line\"><span class=\"comment\"># export OPENSSL_CONF=/dev/null</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">################################</span></span><br><span class=\"line\"><span class=\"comment\"># åç§°: DependencyCheck</span></span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜: è„šæœ¬è¿è¡Œä¾èµ–æ£€æµ‹</span></span><br><span class=\"line\"><span class=\"comment\">################################</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">DependencyCheck</span></span>()&#123;</span><br><span class=\"line\">  phantomjs -v &gt; /dev/null 2&gt;&amp;1</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [[ <span class=\"string\">\"$?\"</span> != <span class=\"string\">\"0\"</span> ]];<span class=\"keyword\">then</span> <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[31m[Error] Phantomjs NotFound,Please Install this! \\e[0m\"</span>;<span class=\"built_in\">exit</span> 0;<span class=\"keyword\">fi</span></span><br><span class=\"line\">  jq --version &gt; /dev/null 2&gt;&amp;1</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [[ <span class=\"string\">\"$?\"</span> != <span class=\"string\">\"0\"</span> ]];<span class=\"keyword\">then</span> <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[31m[Error] Phantomjs jq,Please Install jq! \\n$ yum install jq \\e[0m\"</span>;<span class=\"built_in\">exit</span> 0;<span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">################################</span></span><br><span class=\"line\"><span class=\"comment\"># åç§°: SendWXMsg</span></span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜: ä¼ä¸šå¾®ä¿¡æ¶ˆæ¯æœºå™¨äººæ¶ˆæ¯å‘é€</span></span><br><span class=\"line\"><span class=\"comment\">################################</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">SendWXMsg</span></span>()&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [[ <span class=\"string\">\"<span class=\"variable\">$1</span>\"</span> == <span class=\"string\">\"text\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"comment\">#text æ ¼å¼</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"variable\">$2</span> <span class=\"keyword\">in</span> </span><br><span class=\"line\">    <span class=\"string\">\"1\"</span>)</span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">'&#123;\"msgtype\":\"text\",\"text\":&#123;\"mentioned_list\":[\"@all\"],\"content\":\"è®¿é—®ç±»å‹:'</span><span class=\"variable\">$&#123;NETTYPE&#125;</span><span class=\"string\">'\\næŠ¥è­¦ç±»å‹:'</span><span class=\"variable\">$3</span><span class=\"string\">'\\nç›‘æ§åœ°å€:'</span><span class=\"variable\">$&#123;TARGETURL&#125;</span><span class=\"string\">'\\næŠ¥è­¦ä¿¡æ¯:'</span><span class=\"variable\">$4</span><span class=\"string\">'\"&#125;&#125;'</span> &gt; text.json</span><br><span class=\"line\">       ;;</span><br><span class=\"line\">    <span class=\"string\">\"2\"</span>)</span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">'&#123;\"msgtype\":\"text\",\"text\":&#123;\"mentioned_list\":[\"@all\"],\"content\":\"è®¿é—®ç±»å‹:'</span><span class=\"variable\">$&#123;NETTYPE&#125;</span><span class=\"string\">'\\næŠ¥è­¦ç±»å‹:'</span><span class=\"variable\">$3</span><span class=\"string\">'\\nç›‘æ§åœ°å€:'</span><span class=\"variable\">$&#123;TARGETURL&#125;</span><span class=\"string\">'\\næŠ¥è­¦ä¿¡æ¯:'</span><span class=\"variable\">$4</span><span class=\"string\">'å¼‚å¸¸æ ‡è¯†æ ¡éªŒå€¼:'</span><span class=\"variable\">$5</span><span class=\"string\">'\\nå¤‡æ³¨:ç½‘ç«™é¢„è§ˆå›¾ç”Ÿæˆä¸Šä¼ ä¸­.\"&#125;&#125;'</span> &gt; text.json</span><br><span class=\"line\">      ;;</span><br><span class=\"line\">    *)</span><br><span class=\"line\">        sleep 1</span><br><span class=\"line\">      ;;</span><br><span class=\"line\">    <span class=\"keyword\">esac</span></span><br><span class=\"line\">    sed -i <span class=\"string\">'s#_#\\\\n#g'</span> text.json</span><br><span class=\"line\">    curl <span class=\"variable\">$&#123;WXMSGURL&#125;</span> -X POST -H <span class=\"string\">\"Content-Type:application/json\"</span> -d@text.json</span><br><span class=\"line\">  <span class=\"keyword\">elif</span> [[ <span class=\"string\">\"<span class=\"variable\">$1</span>\"</span> == <span class=\"string\">\"image\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"comment\">#image æ ¼å¼</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">'&#123;\"msgtype\":\"image\",\"image\":&#123;\"base64\":\"'</span><span class=\"variable\">$2</span><span class=\"string\">'\",\"md5\":\"'</span><span class=\"variable\">$3</span><span class=\"string\">'\"&#125;&#125;'</span> &gt; data.json</span><br><span class=\"line\">    curl <span class=\"variable\">$&#123;WXMSGURL&#125;</span> -X POST -H <span class=\"string\">\"Content-Type:application/json\"</span> -d@data.json</span><br><span class=\"line\">  <span class=\"keyword\">elif</span> [[ <span class=\"string\">\"<span class=\"variable\">$1</span>\"</span> == <span class=\"string\">\"markdown\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"comment\">#markdown æ ¼å¼</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ <span class=\"string\">\"<span class=\"variable\">$2</span>\"</span> == <span class=\"string\">\"1\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">      <span class=\"built_in\">echo</span> <span class=\"string\">'&#123;\"msgtype\":\"markdown\",\"markdown\":&#123;\"content\":\"**'</span><span class=\"variable\">$3</span><span class=\"string\">'**\\n&gt; è®¿é—®ç±»å‹:'</span><span class=\"variable\">$&#123;NETTYPE&#125;</span><span class=\"string\">'è®¿é—®\\n&gt; åº”ç”¨çŠ¶æ€ä¿¡æ¯:&lt;font color=\\\"info\\\"&gt;\\n'</span><span class=\"variable\">$4</span><span class=\"string\">'&lt;/font&gt;\"&#125;&#125;'</span> &gt; markdown.json</span><br><span class=\"line\">      sed -i <span class=\"string\">'s#_#\\\\n#g'</span> markdown.json</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">     curl <span class=\"variable\">$&#123;WXMSGURL&#125;</span> -X POST -H <span class=\"string\">\"Content-Type:application/json\"</span> -d@markdown.json</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    sleep</span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">################################</span></span><br><span class=\"line\"><span class=\"comment\"># åç§°: TargetMD5</span></span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜: ç›®æ ‡ç«™ç‚¹é¦–é¡µçš„MD5å€¼ç”Ÿæˆ</span></span><br><span class=\"line\"><span class=\"comment\">################################</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">TargetMD5</span></span>()&#123;</span><br><span class=\"line\">  <span class=\"comment\"># åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [[ ! -d <span class=\"string\">\"<span class=\"variable\">$&#123;TARGETDIR&#125;</span>\"</span> ]];<span class=\"keyword\">then</span> <span class=\"built_in\">echo</span> <span class=\"string\">\"Create directory <span class=\"variable\">$&#123;TARGETDIR&#125;</span>.....\"</span>;mkdir -p <span class=\"variable\">$TARGETDIR</span>; <span class=\"keyword\">fi</span> </span><br><span class=\"line\">  <span class=\"keyword\">if</span> [[ ! -f <span class=\"string\">\"<span class=\"variable\">$&#123;TARGETFILE&#125;</span>\"</span> ]]; <span class=\"keyword\">then</span> curl -m 15 <span class=\"variable\">$&#123;TARGETURL&#125;</span> -o <span class=\"variable\">$&#123;TARGETFILE&#125;</span>; <span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"built_in\">export</span> TARGETFILEMD5=$(md5sum <span class=\"variable\">$&#123;TARGETFILE&#125;</span> | awk -F <span class=\"string\">' '</span> <span class=\"string\">'&#123;print $1&#125;'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">################################</span></span><br><span class=\"line\"><span class=\"comment\"># åç§°: Record</span></span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜: ç½‘ç«™é¦–é¡µæŒ‡çº¹(md5å€¼)æ¯”å¯¹ä»¥åŠç½‘é¡µæˆªå›¾</span></span><br><span class=\"line\"><span class=\"comment\">################################</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">Record</span></span>()&#123; </span><br><span class=\"line\">   curl -m 20 <span class=\"variable\">$&#123;TARGETURL&#125;</span> -o <span class=\"variable\">$&#123;RECORDFILE&#125;</span></span><br><span class=\"line\">   <span class=\"built_in\">export</span> RECORDFILEMD5=<span class=\"string\">\"<span class=\"variable\">$(md5sum $_ | awk -F '  ' '&#123;print $1&#125;')</span>\"</span>  </span><br><span class=\"line\">   <span class=\"keyword\">if</span> [[ <span class=\"string\">\"<span class=\"variable\">$&#123;TARGETFILEMD5&#125;</span>MD5\"</span> != <span class=\"string\">\"<span class=\"variable\">$&#123;RECORDFILEMD5&#125;</span>MD5\"</span> ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">      <span class=\"comment\"># å¼‚å¸¸ä¿¡æ¯è®°å½•</span></span><br><span class=\"line\">      <span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$&#123;RECORDFILE&#125;</span>-<span class=\"variable\">$&#123;RECORDFILEMD5&#125;</span>\"</span> &gt;&gt; <span class=\"variable\">$&#123;TARGETDIR&#125;</span>exception.log</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\"># å·®å¼‚æ¯”å¯¹</span></span><br><span class=\"line\">      DIFFTEXT=$(diff --normal <span class=\"variable\">$&#123;TARGETFILE&#125;</span> <span class=\"variable\">$&#123;RECORDFILE&#125;</span> | egrep <span class=\"string\">\"^[0-9]\"</span> | tr <span class=\"string\">'\\n'</span> <span class=\"string\">'__'</span> )</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\"># ä½¿ç”¨ phantomjs ç”Ÿæˆæˆªå›¾</span></span><br><span class=\"line\">      /usr/<span class=\"built_in\">local</span>/bin/phantomjs /usr/<span class=\"built_in\">local</span>/src/phantomjs/custom/screen-capture.js <span class=\"variable\">$&#123;TARGETURL&#125;</span> <span class=\"variable\">$&#123;RECORDFILE&#125;</span>.png</span><br><span class=\"line\">      IMGMD5=<span class=\"string\">\"<span class=\"variable\">$(md5sum $&#123;RECORDFILE&#125;.png| awk -F '  ' '&#123;print $1&#125;')</span>\"</span></span><br><span class=\"line\">      IMGBASE64=<span class=\"string\">\"<span class=\"variable\">$(base64 -w 0 &lt; $&#123;RECORDFILE&#125;.png)</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\"># ä¿¡æ¯å‘é€</span></span><br><span class=\"line\">      SendWXMsg <span class=\"string\">\"text\"</span> <span class=\"string\">\"2\"</span> <span class=\"string\">\"ç½‘ç«™ä¿®æ”¹æé†’\"</span> <span class=\"string\">\"è¢«ä¿®æ”¹çš„è¡Œæ•°:\\n<span class=\"variable\">$&#123;DIFFTEXT&#125;</span>\"</span> <span class=\"string\">\"<span class=\"variable\">$&#123;RECORDFILEMD5&#125;</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">      sleep 1</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\"># ç½‘é¡µæˆªå›¾å‘é€ (å¤–ç½‘å‘é€)</span></span><br><span class=\"line\">      SendWXMsg <span class=\"string\">\"image\"</span> <span class=\"string\">\"<span class=\"variable\">$&#123;IMGBASE64&#125;</span>\"</span> <span class=\"string\">\"<span class=\"variable\">$&#123;IMGMD5&#125;</span>\"</span> </span><br><span class=\"line\">      cp -f <span class=\"variable\">$&#123;RECORDFILE&#125;</span> <span class=\"variable\">$&#123;TARGETFILE&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\"># å‘é€è­¦å‘Šæ¬¡æ•°</span></span><br><span class=\"line\">      RCOUNT=RCOUNT<span class=\"variable\">$&#123;FLAG&#125;</span></span><br><span class=\"line\">      <span class=\"built_in\">let</span> <span class=\"variable\">$&#123;RCOUNT&#125;</span>+=1</span><br><span class=\"line\">      <span class=\"built_in\">export</span> <span class=\"variable\">$&#123;RCOUNT&#125;</span>=<span class=\"variable\">$&#123;!RCOUNT&#125;</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> [[ <span class=\"variable\">$&#123;!RCOUNT&#125;</span> -eq 1 ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">        cp -f <span class=\"variable\">$&#123;RECORDFILE&#125;</span> <span class=\"variable\">$&#123;TARGETFILE&#125;</span></span><br><span class=\"line\">        <span class=\"built_in\">export</span> <span class=\"variable\">$&#123;RCOUNT&#125;</span>=0</span><br><span class=\"line\">      <span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span> </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">################################</span></span><br><span class=\"line\"><span class=\"comment\"># åç§°: SiteMonitorCheck</span></span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜: ç½‘ç«™è®¿é—®å¼‚å¸¸æ£€æµ‹</span></span><br><span class=\"line\"><span class=\"comment\">################################</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">SiteMonitorCheck</span></span> ()&#123;</span><br><span class=\"line\">    STATUS=$(curl -I -m 10 -s -o /dev/null -w <span class=\"string\">\"%&#123;http_code&#125;\"</span> <span class=\"variable\">$&#123;TARGETURL&#125;</span> )</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ $? -ne 0 ]];<span class=\"keyword\">then</span> STATUS=<span class=\"string\">\"CLOSE\"</span>;<span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"comment\"># å½“ç³»ç»Ÿæ•…éšœå…³é—­ååªæ¨é€ä¸‰æ¬¡ï¼Œç„¶åæ¢å¤æ­£å¸¸æ—¶å€™åˆé‡æ–°è®¡æ•°</span></span><br><span class=\"line\">    COUNT=COUNT<span class=\"variable\">$&#123;FLAG&#125;</span></span><br><span class=\"line\">    <span class=\"built_in\">let</span> <span class=\"variable\">$&#123;COUNT&#125;</span>+=1</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ <span class=\"string\">\"<span class=\"variable\">$STATUS</span>\"</span> == <span class=\"string\">\"200\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">      Record</span><br><span class=\"line\">    <span class=\"keyword\">elif</span> [[ <span class=\"string\">\"<span class=\"variable\">$STATUS</span>\"</span> == <span class=\"string\">\"200\"</span> &amp;&amp; <span class=\"variable\">$&#123;!COUNT&#125;</span> -gt 2 ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">      <span class=\"built_in\">export</span> <span class=\"variable\">$&#123;COUNT&#125;</span>=0</span><br><span class=\"line\">    <span class=\"keyword\">elif</span> [[ <span class=\"string\">\"<span class=\"variable\">$STATUS</span>\"</span> == <span class=\"string\">\"302\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">      <span class=\"built_in\">local</span> LOCATION=$(curl -I -m 10 -s  <span class=\"variable\">$&#123;TARGETURL&#125;</span> | egrep <span class=\"string\">\"^Location\"</span> | tr -d <span class=\"string\">'\\r'</span> | cut -d <span class=\"string\">\"/\"</span> -f 3)</span><br><span class=\"line\">      SendWXMsg <span class=\"string\">\"text\"</span> <span class=\"string\">\"1\"</span> <span class=\"string\">\"è¯·æ±‚è·³è½¬å¼‚å¸¸åœ°å€\"</span> <span class=\"string\">\"_HTTPå“åº”ç :<span class=\"variable\">$&#123;STATUS&#125;</span>_è·³è½¬åœ°å€:<span class=\"variable\">$&#123;LOCATION&#125;</span>\"</span></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> [[ <span class=\"string\">\"<span class=\"variable\">$STATUS</span>\"</span> == <span class=\"string\">\"CLOSE\"</span> &amp;&amp; <span class=\"variable\">$&#123;mcount&#125;</span> -le 2 ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">      SendWXMsg <span class=\"string\">\"text\"</span> <span class=\"string\">\"1\"</span> <span class=\"string\">\"è®¿é—®å¼‚å¸¸\"</span> <span class=\"string\">\"å¤–ç½‘æ— æ³•è®¿é—®è¯¥ç½‘ç«™\"</span> </span><br><span class=\"line\">      <span class=\"built_in\">export</span> <span class=\"variable\">$&#123;COUNT&#125;</span>=<span class=\"variable\">$&#123;!COUNT&#125;</span></span><br><span class=\"line\">      <span class=\"built_in\">continue</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> [[ <span class=\"string\">\"<span class=\"variable\">$&#123;STATUS&#125;</span>\"</span> == <span class=\"string\">\"403\"</span> &amp;&amp; <span class=\"string\">\"<span class=\"variable\">$(echo $&#123;TARGETURL&#125; | egrep -c \"40081|30081\")</span> == '1'\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">       Record</span><br><span class=\"line\">       <span class=\"built_in\">continue</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span></span><br><span class=\"line\">        SendWXMsg <span class=\"string\">\"text\"</span> <span class=\"string\">\"1\"</span> <span class=\"string\">\"è¯·æ±‚è¿”å›å“åº”ç å¼‚å¸¸\"</span> <span class=\"string\">\"HTTPå“åº”ç [<span class=\"variable\">$&#123;STATUS&#125;</span>]\"</span></span><br><span class=\"line\">      <span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">################################</span></span><br><span class=\"line\"><span class=\"comment\"># åç§°: HealthCheck</span></span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜: ç½‘é¡µç«™ç‚¹å¤–ç½‘è®¿é—®æ£€æµ‹</span></span><br><span class=\"line\"><span class=\"comment\">################################</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">HealthCheck</span></span>()&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [[ <span class=\"string\">\"<span class=\"variable\">$NETTYPE</span>\"</span> == <span class=\"string\">\"å¤–ç½‘\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">local</span> CHECK=$(curl -m 15 -o /dev/null -s -w <span class=\"string\">\"DNSè§£æè€—æ—¶: \"</span>%&#123;time_namelookup&#125;<span class=\"string\">\"s_é‡å®šå‘è€—æ—¶: \"</span>%&#123;time_redirect&#125;<span class=\"string\">\"s_TCPè¿æ¥è€—æ—¶: \"</span>%&#123;time_connect&#125;<span class=\"string\">\"s_è¯·æ±‚å‡†å¤‡è€—æ—¶: \"</span>%&#123;time_pretransfer&#125;<span class=\"string\">\"s_åº”ç”¨è¿æ¥è€—æ—¶: \"</span>%&#123;time_appconnect&#125;<span class=\"string\">\"s_ä¼ è¾“è€—æ—¶: \"</span>%&#123;time_starttransfer&#125;<span class=\"string\">\"s_ä¸‹è½½é€Ÿåº¦: \"</span>%&#123;speed_download&#125;<span class=\"string\">\"byte/s_æ•´ä½“è¯·æ±‚å“åº”è€—æ—¶: \"</span>%&#123;time_total&#125;<span class=\"string\">\"s\"</span> <span class=\"string\">\"<span class=\"variable\">$&#123;TARGETURL&#125;</span>\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ $? -eq 0 ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">      SendWXMsg <span class=\"string\">\"markdown\"</span> <span class=\"string\">\"1\"</span> <span class=\"string\">\"<span class=\"variable\">$&#123;NETTYPE&#125;</span>-æ£€æŸ¥ç½‘ç«™è¿æ¥çŠ¶æ€\"</span> <span class=\"string\">\"__&gt; <span class=\"variable\">$&#123;CHECK&#125;</span>\"</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      SendWXMsg <span class=\"string\">\"markdown\"</span> <span class=\"string\">\"1\"</span> <span class=\"string\">\"<span class=\"variable\">$&#123;NETTYPE&#125;</span>-æ£€æŸ¥ç½‘ç«™è¿æ¥çŠ¶æ€\"</span> <span class=\"string\">\"å·¡æ£€åœ°å€: <span class=\"variable\">$&#123;TARGETURL&#125;</span>__&gt; å·¡æ£€ä¿¡æ¯: è®¿é—®å¼‚å¸¸\"</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"built_in\">local</span> CHECK=$(curl -m 10 -o /dev/null -s -w <span class=\"string\">\"%&#123;http_code&#125;\"</span> <span class=\"string\">\"<span class=\"variable\">$&#123;TARGETURL&#125;</span>\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ $? -ne 0 || <span class=\"string\">\"<span class=\"variable\">$CHECK</span>\"</span> != <span class=\"string\">\"200\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">      <span class=\"built_in\">export</span> HCMSG=<span class=\"string\">\"<span class=\"variable\">$&#123;HCMSG&#125;</span>__&gt; å·¡æ£€åœ°å€: <span class=\"variable\">$&#123;TARGETURL&#125;</span>_å·¡æ£€ä¿¡æ¯: å¼‚å¸¸\"</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      <span class=\"comment\"># export HCMSG=\"$&#123;HCMSG&#125;__&gt; å·¡æ£€åœ°å€: $&#123;TARGETURL&#125;_å·¡æ£€ä¿¡æ¯: æ­£å¸¸\"</span></span><br><span class=\"line\">      <span class=\"built_in\">echo</span> .</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">################################</span></span><br><span class=\"line\"><span class=\"comment\"># åç§°: XKservice</span></span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜: æŒ‡å®šåº”ç”¨ç›‘æ§åŸ‹ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\">################################</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">XKservice</span></span>()&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [[ <span class=\"string\">\"<span class=\"variable\">$NETTYPE</span>\"</span> == <span class=\"string\">\"å¤–ç½‘\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">local</span> CHECK=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$TARGETURL</span> | egrep -c <span class=\"string\">\"xk\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[  <span class=\"string\">\"<span class=\"variable\">$CHECK</span>\"</span> == <span class=\"string\">\"1\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">      curl -m 15 -s <span class=\"string\">\"<span class=\"variable\">$&#123;TARGETURL&#125;</span>/app/version\"</span> -o xk.json</span><br><span class=\"line\">      <span class=\"built_in\">local</span> STATUS=$(jq <span class=\"string\">'\"åº”ç”¨çŠ¶æ€:\"+(.code|tostring)+\"_åº”ç”¨ä¿¡æ¯:\"+(.msg|tostring)+\"_å½“å‰åº”ç”¨ç‰ˆæœ¬:\"+(.data.version)'</span> xk.json  | tr -d <span class=\"string\">'\"'</span>)</span><br><span class=\"line\">      SendWXMsg <span class=\"string\">\"markdown\"</span> <span class=\"string\">\"1\"</span> <span class=\"string\">\"åº”ç”¨åŸ‹ç‚¹ç›‘æ§\"</span> <span class=\"string\">\"__&gt; <span class=\"variable\">$&#123;STATUS&#125;</span>\"</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"built_in\">local</span> CHECK=$(<span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$&#123;TARGETURL&#125;</span>\"</span> | egrep -c <span class=\"string\">\"8010|9010\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ <span class=\"string\">\"<span class=\"variable\">$CHECK</span>\"</span> == <span class=\"string\">\"1\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">      curl -m 15 -s <span class=\"string\">\"<span class=\"variable\">$&#123;TARGETURL&#125;</span>/app/version\"</span> -o xk.json</span><br><span class=\"line\">      <span class=\"built_in\">local</span> STATUS=$(jq -M <span class=\"string\">'\"_Status:\"+(.code|tostring)+\"_Msg:\"+(.msg|tostring)+\"_Version:\"+(.data.version)'</span> xk.json  | tr -d <span class=\"string\">'\"'</span>)</span><br><span class=\"line\">      <span class=\"built_in\">export</span> XKMSG=<span class=\"string\">\"<span class=\"variable\">$&#123;XKMSG&#125;</span>__&gt; åº”ç”¨åœ°å€:<span class=\"variable\">$&#123;TARGETURL&#125;</span>_<span class=\"variable\">$&#123;STATUS&#125;</span>\"</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">################################</span></span><br><span class=\"line\"><span class=\"comment\"># åç§°: InnerAppServices</span></span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜: å†…éƒ¨åº”ç”¨æœåŠ¡ç›‘æ§åŸ‹ç‚¹</span></span><br><span class=\"line\"><span class=\"comment\">################################</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">InnerAppServices</span></span>()&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [[ <span class=\"string\">\"<span class=\"variable\">$(echo $TARGETURL| egrep -c '40081|30081')</span>\"</span> == <span class=\"string\">\"1\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">    curl -m 15 -s <span class=\"string\">\"<span class=\"variable\">$&#123;TARGETURL&#125;</span>/user/getVersion.htmls\"</span> -o innerApp.json</span><br><span class=\"line\">    STATUS=$(jq -M <span class=\"string\">'\"_Status:\"+(.db|tostring)+\"_Version:\"+(.version|tostring)'</span> innerApp.json | tr -d <span class=\"string\">'\"'</span>)</span><br><span class=\"line\">    <span class=\"built_in\">export</span> ZHCXMSG=<span class=\"string\">\"<span class=\"variable\">$&#123;ZHCXMSG&#125;</span>__&gt; åº”ç”¨åœ°å€:<span class=\"variable\">$&#123;TARGETURL&#125;</span>_<span class=\"variable\">$&#123;STATUS&#125;</span>\"</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">################################</span></span><br><span class=\"line\"><span class=\"comment\"># åç§°: main</span></span><br><span class=\"line\"><span class=\"comment\"># è¯´æ˜: è„šæœ¬ä¸»æ‰§è¡Œå…¥å£</span></span><br><span class=\"line\"><span class=\"comment\"># å‚æ•°: æ— </span></span><br><span class=\"line\"><span class=\"comment\"># è¿”å›å€¼: æ— </span></span><br><span class=\"line\"><span class=\"comment\">################################</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">main</span></span>()&#123;</span><br><span class=\"line\">  <span class=\"comment\"># ä¾èµ–æ£€æµ‹</span></span><br><span class=\"line\">  DependencyCheck</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># ç›®æ ‡ç›‘æ§</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> $(cat <span class=\"variable\">$&#123;MONITORSITE&#125;</span>);<span class=\"keyword\">do</span></span><br><span class=\"line\">    CHECK=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$i</span> | egrep -c <span class=\"string\">\"^#\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ <span class=\"string\">\"<span class=\"variable\">$CHECK</span>\"</span> == <span class=\"string\">\"1\"</span> ]];<span class=\"keyword\">then</span> <span class=\"built_in\">continue</span>;<span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"built_in\">export</span> TARGETURL=<span class=\"variable\">$i</span></span><br><span class=\"line\">    <span class=\"built_in\">export</span> URL=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$i</span>|cut -f 3 -d <span class=\"string\">'/'</span>)</span><br><span class=\"line\">    <span class=\"built_in\">export</span> TARGETDIR=<span class=\"string\">\"/var/log/WebScreenCapture/<span class=\"variable\">$&#123;URL&#125;</span>/\"</span></span><br><span class=\"line\">    <span class=\"built_in\">export</span> TARGETFILE=<span class=\"string\">\"<span class=\"variable\">$&#123;TARGETDIR&#125;</span>index.html\"</span></span><br><span class=\"line\">    <span class=\"built_in\">export</span> RECORDFILE=<span class=\"string\">\"<span class=\"variable\">$&#123;TARGETDIR&#125;</span><span class=\"variable\">$(date +%Y%m%d%H%M%S)</span>-index.html\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># ç›®æ ‡MD5å€¼</span></span><br><span class=\"line\">    TargetMD5</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ <span class=\"string\">\"<span class=\"variable\">$1</span>\"</span> == <span class=\"string\">\"H\"</span>  ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">      HealthCheck</span><br><span class=\"line\">      XKservice</span><br><span class=\"line\">      InnerAppServices</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      <span class=\"built_in\">let</span> FLAG+=1</span><br><span class=\"line\">      <span class=\"built_in\">export</span> FLAG=<span class=\"variable\">$&#123;FLAG&#125;</span></span><br><span class=\"line\">      SiteMonitorCheck</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># æŒ‡å®šåº”ç”¨æ‰§è¡Œå®Œæ¯•å</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [[ <span class=\"string\">\"<span class=\"variable\">$1</span>\"</span>  == <span class=\"string\">\"H\"</span> &amp;&amp; <span class=\"string\">\"<span class=\"variable\">$NETTYPE</span>\"</span> == <span class=\"string\">\"å†…ç½‘\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ <span class=\"string\">\"<span class=\"variable\">$&#123;#HCMSG&#125;</span>\"</span> != <span class=\"string\">\"0\"</span> ]];<span class=\"keyword\">then</span> </span><br><span class=\"line\">      SendWXMsg <span class=\"string\">\"markdown\"</span> <span class=\"string\">\"1\"</span> <span class=\"string\">\"<span class=\"variable\">$&#123;NETTYPE&#125;</span>-ä¸šåŠ¡åº”ç”¨è¿è¡Œæƒ…å†µå·¡æŸ¥\"</span> <span class=\"string\">\"<span class=\"variable\">$&#123;HCMSG&#125;</span>_æ£€æµ‹æ—¶é—´:<span class=\"variable\">$(date +%Y-%m-%d~%H:%M:%S)</span>\"</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      SendWXMsg <span class=\"string\">\"markdown\"</span> <span class=\"string\">\"1\"</span> <span class=\"string\">\"<span class=\"variable\">$&#123;NETTYPE&#125;</span>-ä¸šåŠ¡åº”ç”¨è¿è¡Œæƒ…å†µå·¡æŸ¥\"</span> <span class=\"string\">\"æ‰€æœ‰è¢«ç›‘æ§ä¸šåŠ¡æ­£å¸¸_æ£€æµ‹æ—¶é—´:<span class=\"variable\">$(date +%Y-%m-%d~%H:%M:%S)</span>\"</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ <span class=\"string\">\"<span class=\"variable\">$&#123;#XKMSG&#125;</span>\"</span> != <span class=\"string\">\"0\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">      SendWXMsg <span class=\"string\">\"markdown\"</span> <span class=\"string\">\"1\"</span> <span class=\"string\">\"<span class=\"variable\">$&#123;NETTYPE&#125;</span>-xkåº”ç”¨ç³»ç»Ÿç›‘æ§\"</span> <span class=\"string\">\"<span class=\"variable\">$&#123;XKMSG&#125;</span>_æ£€æµ‹æ—¶é—´:<span class=\"variable\">$(date +%Y-%m-%d~%H:%M:%S)</span>\"</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ <span class=\"string\">\"<span class=\"variable\">$&#123;#ZHCXMSG&#125;</span>\"</span> != <span class=\"string\">\"0\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">      <span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;ZHCXKMSG&#125;</span></span><br><span class=\"line\">      SendWXMsg <span class=\"string\">\"markdown\"</span> <span class=\"string\">\"1\"</span> <span class=\"string\">\"<span class=\"variable\">$&#123;NETTYPE&#125;</span>-zhcxåº”ç”¨ç³»ç»Ÿç›‘æ§\"</span> <span class=\"string\">\"<span class=\"variable\">$&#123;ZHCXMSG&#125;</span>_æ£€æµ‹æ—¶é—´:<span class=\"variable\">$(date +%Y-%m-%d~%H:%M:%S)</span>\"</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">main <span class=\"variable\">$1</span></span><br><span class=\"line\"><span class=\"comment\"># export HCMSG=\"\"</span></span><br><span class=\"line\"><span class=\"comment\"># export XKMSG=\"\"</span></span><br><span class=\"line\"><span class=\"comment\"># export ZHCXMSG=\"\"</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> FLAG=0</span><br></pre></td></tr></table></figure></p>\n<p>è„šæœ¬æ‰§è¡ŒåŠå…¶ç»“æœ:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ä»£ç æ‰§è¡Œ</span></span><br><span class=\"line\">chmod +x /1.WebScreenCapture.sh</span><br><span class=\"line\">./1.WebScreenCapture.sh</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /var/<span class=\"built_in\">log</span>/WebScreenCapture/www.baidu.com</span><br><span class=\"line\">ls /var/<span class=\"built_in\">log</span>/WebScreenCapture/www.com</span><br><span class=\"line\">20230111172153-index.html  20230111172153-index.html.png  20230111173604-index.html  data.json  exception.log  index.html  text.json</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2022/10/20230111172323.png\" alt=\"WeiyiGeek.PhantomJSç½‘ç«™ç›‘æ§é¢„è­¦å›¾\" title=\"\" class=\"\">\n                <p>WeiyiGeek.PhantomJSç½‘ç«™ç›‘æ§é¢„è­¦å›¾</p>\n            </figure></p>\n<p><strong>è¡¥å……æ‰©å±•</strong>: æˆ‘ä»¬å¯ä»¥å°†è¯¥è„šæœ¬åŠ å…¥åˆ°cronä¸­å®šæ—¶æ¯ä¸€åˆ†é’Ÿæˆ–3åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ç›‘æ§ã€‚</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ crontab -e</span><br><span class=\"line\"><span class=\"comment\"># m h  dom mon dow   command</span></span><br><span class=\"line\">*/1 * * * * bash -c /tmp/1.WebScreenCapture.sh</span><br></pre></td></tr></table></figure>\n<p>æ¸©é¦¨æç¤º: å½“ç„¶ä½ ä¹Ÿå¯ä»¥å°†è„šæœ¬è¿›è¡Œä¿®æ”¹ï¼Œæ”¯æŒé’‰é’‰æœºå™¨äººä»¥åŠè‡ªå·±ç¼–å†™çš„webhookå®ç°QQæˆ–è€…å¾®ä¿¡é¢„è­¦ã€‚</p>\n<p>è‡³æ­¤å®Œæ¯•ï¼Œå®Œæ¯•æ›´å¤šè¿ç»´å¥‡æŠ€æ·«å·§ï¼Œè¯·å…³æ³¨ ã€WeiyiGeekã€‘å“Ÿã€‚</p>\n<p><br/></p>\n<h2 id=\"0x0n-å…¥å‘å‡ºå‘\"><a href=\"#0x0n-å…¥å‘å‡ºå‘\" class=\"headerlink\" title=\"0x0n å…¥å‘å‡ºå‘\"></a>0x0n å…¥å‘å‡ºå‘</h2><h3 id=\"é—®é¢˜1-åœ¨Ubuntu-22-04ä¸­å®‰è£…phantomjsæ—¶æŠ¥-libproviders-so-cannot-open-shared-object-file-é”™è¯¯ã€‚\"><a href=\"#é—®é¢˜1-åœ¨Ubuntu-22-04ä¸­å®‰è£…phantomjsæ—¶æŠ¥-libproviders-so-cannot-open-shared-object-file-é”™è¯¯ã€‚\" class=\"headerlink\" title=\"é—®é¢˜1.åœ¨Ubuntu 22.04ä¸­å®‰è£…phantomjsæ—¶æŠ¥ libproviders.so: cannot open shared object file: é”™è¯¯ã€‚\"></a>é—®é¢˜1.åœ¨Ubuntu 22.04ä¸­å®‰è£…phantomjsæ—¶æŠ¥ <code>libproviders.so: cannot open shared object file:</code> é”™è¯¯ã€‚</h3><ul>\n<li>é”™è¯¯ä¿¡æ¯:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ phantomjs -v</span><br><span class=\"line\">Auto configuration failed</span><br><span class=\"line\">139744413173696:error:25066067:DSO support routines:DLFCN_LOAD:could not load the shared library:dso_dlfcn.c:185:filename(libproviders.so): libproviders.so: cannot open shared object file: No such file or directory</span><br><span class=\"line\">139744413173696:error:25070067:DSO support routines:DSO_load:could not load the shared library:dso_lib.c:244:</span><br><span class=\"line\">139744413173696:error:0E07506E:configuration file routines:MODULE_LOAD_DSO:error loading dso:conf_mod.c:285:module=providers, path=providers</span><br><span class=\"line\">139744413173696:error:0E076071:configuration file routines:MODULE_RUN:unknown module name:conf_mod.c:222:module=providers</span><br></pre></td></tr></table></figure></li>\n<li>é—®é¢˜åŸå› : å› ä¸ºUbuntu 22.04 ä½¿ç”¨æ–°çš„ OpenSSL ç‰ˆæœ¬ 3.0.2 è€Œä¸æ˜¯æ—§çš„ OpenSSL ç‰ˆæœ¬ 1.1.1 ,è¿™äº› OpenSSL ç‰ˆæœ¬ä¸å®Œå…¨å‘åå…¼å®¹ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ‚¨åœ¨ PhantomJS å°è¯•è‡ªåŠ¨é…ç½® SSL/TLS è®¾ç½®æ—¶çœ‹åˆ°æ­¤é”™è¯¯çš„åŸå› ã€‚</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl version</span><br><span class=\"line\">OpenSSL 3.0.2 15 Mar 2022 (Library: OpenSSL 3.0.2 15 Mar 2022)</span><br></pre></td></tr></table></figure>\n<ul>\n<li>è§£å†³åŠæ³•: <code>export OPENSSL_CONF=/dev/null</code></li>\n</ul>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"è‡ªåŠ¨åŒ–æµ‹è¯•","path":"api/categories/è‡ªåŠ¨åŒ–æµ‹è¯•.json"},{"name":"è¿ç»´å·¥å…·","path":"api/categories/è¿ç»´å·¥å…·.json"}],"tags":[{"name":"PhantomJS","path":"api/tags/PhantomJS.json"}]}