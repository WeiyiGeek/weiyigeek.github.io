{"title":"3.Prometheus监控入门之指标与标签使用说明","slug":"虚拟云容/云容器/Kubernetes/功能组件/Prometheus/3.Prometheus监控入门之指标命名与数据查看说明","date":"2021-04-25T09:37:47.000Z","updated":"2021-10-01T16:08:37.451Z","url":"2021/4-25-553.html","path":"api/articles/2021/4-25-553.html.json","covers":null,"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<hr>\n<h2 id=\"0x00-监控指标\"><a href=\"#0x00-监控指标\" class=\"headerlink\" title=\"0x00 监控指标\"></a>0x00 监控指标</h2><h3 id=\"1-指标介绍\"><a href=\"#1-指标介绍\" class=\"headerlink\" title=\"1.指标介绍\"></a>1.指标介绍</h3><p><strong>Q: 什么是Prometheus指标(<code>Metrics</code>)?</strong></p>\n<blockquote>\n<p>答: 在Prometheus中指标是基础它标志着采集或抓取监控项,并且指标的数值是有上升或者下降的变化,从而使得监控某一个时间段中某个监控项的变化分布情况。<br>此时此刻,可能你对”指标”这个词有些混乱，在Prometheus中它根据不同的上下文表示不同的含义，它可以是指标系列、子项或者时间序列, 然而对于Gauge类型数据来说都是代表的一个含义。</p>\n</blockquote>\n<p>基础示例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#@ 1.时间序列</span></span><br><span class=\"line\">latency_seconds_sum&#123;path=<span class=\"string\">\"/bar\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#@ 2.子项包含了_sum/_count 时序</span></span><br><span class=\"line\">latency_seconds&#123;path=<span class=\"string\">\"/bar\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#@ 3.指标系列(只包含指标名称)</span></span><br><span class=\"line\">latency_seconds</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h3 id=\"2-指标命名\"><a href=\"#2-指标命名\" class=\"headerlink\" title=\"2.指标命名\"></a>2.指标命名</h3><p>描述: 在使用prometheus时常常会给导出器采集的数据配置一个指标名称，所以指标命名对于数据采集或者使用有一定的重要性，即构建指标标准名称可以按照以下规则进行。</p>\n<p>指标名称整体结构: <code>library_name_unit_suffix</code></p>\n<p><strong>规则语法:</strong></p>\n<ul>\n<li>1) 蛇形命名法: 指标名称的每个部分都应该是小写的并采用下划线进行分隔，如<code>node_uname_info</code>。</li>\n<li><p>2) 名称字母: 指标名称必须以字母开头并且可以跟着任意数目的字母、数字和下划线，如<code>[a-zA-Z_:][a-zA-Z0-9_:]</code>正则表达式</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 正常示例</span></span><br><span class=\"line\">node_cpu_core_throttles_total</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 在测控指标名称时不建议使用冒号(__),因为它是prometheus内部使用而保留的。</span></span><br><span class=\"line\">bottomk(__rank_number__, __input_vector__)</span><br><span class=\"line\">__meta_kubernetes_node_address_InternalIP=<span class=\"string\">\"192.168.12.226\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 在测控指标名称时不建议使用冒号(:),因为它是为用户在记录规则中使用而保留的。</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>3) 指标名称: 指标所代表的含义应该是名字本身，需要实现通过指标名称就能快速知道该值得含义，并且一个名称最好通过下划线进行分割并且通常是从左到右含义越具体越好，如<code>http_request_duration_seconds_sum</code>，注意不要再指标名称中添加标签名(可能会导致聚合查询是出错)。</p>\n</li>\n<li><p>4) 指标后缀: 常规得<code>_total、_count_,__sum,__bucket</code>等后缀是留给counter和summary和histogram指标类型使用得。<code>所以除了在counter类型指标上始终具有_total后缀之外不要将这些后缀放在指标名称得末尾</code>如<code>http_request_duration_seconds_sum</code>。</p>\n</li>\n<li><p>5) 指标单位: 为了避免某个指标究竟是以秒作为单位还是以毫秒为单位应该在命名中带上单位，如<code>container_cpu_system_seconds_total</code>。(Prometheus本身使用秒、毫秒、微秒和纳秒作为指标名称)</p>\n</li>\n<li><p>6) 库: 指标名称是个有效得全局命名空间它可以避免库之间得冲突并指出指标出处，如<code>prometheus_http_requests_total或者go_gc_duration_seconds</code>表示指标通过prometheus以及go库中得到，注意不能将应用名称作为应用中所有指标得前缀。</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"0x01-指标标签\"><a href=\"#0x01-指标标签\" class=\"headerlink\" title=\"0x01 指标标签\"></a>0x01 指标标签</h2><h3 id=\"1-标签介绍\"><a href=\"#1-标签介绍\" class=\"headerlink\" title=\"1.标签介绍\"></a>1.标签介绍</h3><p>描述: Label能够让我们知道监控项目的来源端口方法等等, 同时<code>label</code>也为prometheus提供了<code>丰富的聚合和查询</code>等功能。</p>\n<p><strong>标签分类</strong><br>一类是测控标签，另一类是目标标签，在使用PromSQL查询时没有什么区别但是为了更好有效的使用标签，区分二者就更好了。</p>\n<ul>\n<li>1) 测控标签: 表面意思来自测控设置的标签中,可以在应用程序或者库内部模块中设置。例如收到的HTTP请求类比、以及访问的数据库。</li>\n<li>2) 目标标签: 它是确定了特定的监控目标即Prometheus抓取指标数据的目标，其标签作为抓取指标过程中的一部分。</li>\n</ul>\n<p><br></p>\n<p><strong>标签模式</strong><br>描述: Prometheus 支持64位的浮点数作为时序数据，不支持如字符串等其它数据类型，但是标签值是字符串类型我们可以将其使用某些特征信息展示中，并可以采用PromQL表达式。</p>\n<p>Tips : 你可以为指标设置一个或多个标签并且标签是无序的，所以你可以安装任何给定标签聚合而忽略其它标签，甚至一次性聚合多个标签。</p>\n<p>Tips ：注意保留标签<code>(以下划线开头)</code>和<code>__name__</code>(它实际上是表达式up的语法糖格式)不要进行使用应该避免此类命名。</p>\n<p><br/></p>\n<h3 id=\"2-标签应用\"><a href=\"#2-标签应用\" class=\"headerlink\" title=\"2.标签应用\"></a>2.标签应用</h3><p>描述: 在 Prometheus 中标签往往有以下几种应用场景:</p>\n<ul>\n<li>1) 在 Prometheus 采集时进行数据指标的分类，并按照一定的规则保留或者丢弃采集的数据。</li>\n<li>2) 在 Prometheus UI 界面上采用<code>PromQL表达式</code>设置不同标签进行监控项的找寻,并且可以进行聚合以及求取平均值。</li>\n<li>3) 在 Prometheus 中进行了静态设置采集节点时使用。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[&#123;<span class=\"string\">\"targets\"</span>: [<span class=\"string\">\"127.0.0.1:9100\"</span>],<span class=\"string\">\"labels\"</span>: &#123;<span class=\"string\">\"instance\"</span>: <span class=\"string\">\"test\"</span>,<span class=\"string\">\"idc\"</span>: <span class=\"string\">\"beijing\"</span>&#125;&#125;]</span><br></pre></td></tr></table></figure></li>\n<li>4) 在 alertmanager 警报时按照设置的标签名称和值进行判断并执行相对应的报警通知。</li>\n</ul>\n<p>其中最常用的就是在网站的<code>Http Rquest</code>请求统计中需要记录http路径访问的次数, 为了解决多种同类型、同工作的指标的数量，我们通常采用标签来进行处理, 例如<code>http_requests_total{path=&quot;/login&quot;}</code></p>\n<p>Tips: 汇总指标的分位数打破了有关总和或平均值的规则，因此你无法对分为数进行数学运算。</p>\n<p>Tips: job 和 instance 是目标始终以及默认具有的两个标签，job默认来自job_name配置选项。</p>\n<p><br/></p>\n<h3 id=\"3-标签使用实例\"><a href=\"#3-标签使用实例\" class=\"headerlink\" title=\"3.标签使用实例\"></a>3.标签使用实例</h3><p>描述: 在Prometheus中进行自动发现设置时利用<code>relabel_configs</code>来保留或者丢弃匹配到的标签指标。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 函数用法</span></span><br><span class=\"line\">label_replace() </span><br><span class=\"line\">label_join()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 基础示例：支持 replace、labelmap、keep、drop 等许多操作</span></span><br><span class=\"line\">relabel_configs</span><br><span class=\"line\">- source_labels: [] <span class=\"comment\"># 使用默认值简洁的删除team标签。</span></span><br><span class=\"line\">  target_label: team</span><br><span class=\"line\">- source_labels: [__mata_consul_tag] <span class=\"comment\"># 使用prod、staging和dev标记填充env标签。</span></span><br><span class=\"line\">  regex: <span class=\"string\">'.*,(prod|staging|dev),.*'</span></span><br><span class=\"line\">  target_lable: env</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 1.简单匹配替换</span></span><br><span class=\"line\">- source_labels: []      <span class=\"comment\"># 为所有目标添加上k8s_cluster=3标签</span></span><br><span class=\"line\">  replacement: 3</span><br><span class=\"line\">  target_label: <span class=\"string\">\"k8s_cluster\"</span></span><br><span class=\"line\">  action: replace</span><br><span class=\"line\">- source_labels: [team]  <span class=\"comment\"># 重置标签将team=monitoring替换为team=monitor</span></span><br><span class=\"line\">  regex: monitoring</span><br><span class=\"line\">  replacement: monitor</span><br><span class=\"line\">  target_label: team</span><br><span class=\"line\">  action: replace</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 2.匹配到该标签时保留该目标 ( 正 则 匹 配 )</span></span><br><span class=\"line\">- source_labels: [__meta_kubernetes_endpoints_label_app_kubernetes_io_name]</span><br><span class=\"line\">  action: keep</span><br><span class=\"line\">  regex: ^(kube-state-metrics)$</span><br><span class=\"line\">- source_labels: [team]</span><br><span class=\"line\">  regex: dev|testing|monitor  <span class=\"comment\"># Tips: 使用 | 管道符号替代逐个操作。</span></span><br><span class=\"line\">  action: keep </span><br><span class=\"line\">- source_labels: [__meta_consul_tag]  <span class=\"comment\"># 仅仅包含prod标签的Consul服务。</span></span><br><span class=\"line\">  regex: <span class=\"string\">'.*,prod,.*'</span></span><br><span class=\"line\">  action: keep</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 3.匹配到该标签时丢弃 ( 正 则 匹 配 )</span></span><br><span class=\"line\">- source_labels: [__meta_kubernetes_endpoints_label_app_kubernetes_io_name]</span><br><span class=\"line\">  regex: ^(kube-state-metrics)$</span><br><span class=\"line\">  action: drop</span><br><span class=\"line\">- source_labels: [job, team]    <span class=\"comment\"># 不监控monitor团队的prom的相关任务目标 (使用多个source标签)</span></span><br><span class=\"line\">  regex: prom;monitor  </span><br><span class=\"line\">  action: drop</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 4.正则替换 ( 将匹配到的源数据进行替换到目标标签之中 )</span></span><br><span class=\"line\">- source_label: [__meta_consul_address]  <span class=\"comment\"># 使用 consul的IP和9100端口作为地址。</span></span><br><span class=\"line\">  regex: <span class=\"string\">'(.*)'</span></span><br><span class=\"line\">  replacement: <span class=\"string\">'$&#123;1&#125;:9100'</span></span><br><span class=\"line\">  target_label: __address__</span><br><span class=\"line\">- source_label: [__meta_consul_node]     <span class=\"comment\"># 在实例标签中使用节点名称。</span></span><br><span class=\"line\">  regex: <span class=\"string\">'(.*)'</span></span><br><span class=\"line\">  replacement: <span class=\"string\">'$&#123;1&#125;:9100'</span></span><br><span class=\"line\">  target_label: instance</span><br><span class=\"line\">- source_labels: [__address__,__meta_kubernetes_pod_annotation_prometheus_io_port]</span><br><span class=\"line\">  action: replace</span><br><span class=\"line\">  regex: ([^:]+)(?::\\d+)?;(\\d+)</span><br><span class=\"line\">  replacement: <span class=\"variable\">$1</span>:<span class=\"variable\">$2</span></span><br><span class=\"line\">  target_label: __address__</span><br><span class=\"line\">- source_labels: [team]  <span class=\"comment\"># 使用replace重置标签操作将team标签中的ing去除 (利用了元组的方式)</span></span><br><span class=\"line\">  regex: <span class=\"string\">'(.*)ing'</span></span><br><span class=\"line\">  replacement: <span class=\"string\">'$&#123;1&#125;'</span></span><br><span class=\"line\">  target_label: team</span><br><span class=\"line\">  action: replace</span><br><span class=\"line\">- source_labels: []      <span class=\"comment\"># 使用替换重置操作删除team标签</span></span><br><span class=\"line\">  regex: <span class=\"string\">'(.*)'</span></span><br><span class=\"line\">  replacement: <span class=\"string\">'$&#123;1&#125;'</span></span><br><span class=\"line\">  target_label: team</span><br><span class=\"line\">  action: replace</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 5.匹配正则表达式`所有的标签名称然后将匹配标签的值复制到`replacement` </span></span><br><span class=\"line\">- action: labelmap</span><br><span class=\"line\">  regex: __meta_kubernetes_pod_label_(.+)</span><br><span class=\"line\">  replacement: <span class=\"string\">'$&#123;1&#125;'</span></span><br><span class=\"line\">  action: labelmap</span><br></pre></td></tr></table></figure></p>\n<p>Tips : 指标重新标记<code>metric-relabel_configs</code>作用于从目标中抓取时间序列的重新标记，前面我们看到的<code>keep/drop/replace/labelmap</code>还有<code>labeldrop/labelkeep</code>(适用于标签名称而不是标签值)等操作都可以在<code>metric_relabel_configs</code>中使用。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">metric-relabel_configs:</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># -1. 删除代价大的指标</span></span><br><span class=\"line\">- source_labels: [__name__]</span><br><span class=\"line\">  regex: http_request_size_bytes</span><br><span class=\"line\">  action: drop</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 2.删除直方图桶以减少数据大小</span></span><br><span class=\"line\">- source_labels: [__name__, le]</span><br><span class=\"line\">  regex: <span class=\"string\">'prometheus_tsdb_compaction_duration_seconds_bucket;(4|32|256)'</span></span><br><span class=\"line\">  action: drop</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 3.使用labeldrop删除具有给定前缀的所有标签</span></span><br><span class=\"line\">- regex: <span class=\"string\">'container_label_.*'</span></span><br><span class=\"line\">  action: labledrop</span><br><span class=\"line\">-</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"4-导出器指标说明\"><a href=\"#4-导出器指标说明\" class=\"headerlink\" title=\"4.导出器指标说明\"></a>4.导出器指标说明</h3><h4 id=\"4-1-Linux主机监控指标\"><a href=\"#4-1-Linux主机监控指标\" class=\"headerlink\" title=\"4.1 Linux主机监控指标\"></a>4.1 Linux主机监控指标</h4><p>项目地址: <a href=\"https://github.com/prometheus/node_exporter\" target=\"_blank\" rel=\"noopener\">https://github.com/prometheus/node_exporter</a></p>\n<p><strong>默认开启的功能</strong><br>|    名称    | 说明                                                         | 系统                                                        |<br>| :——–: | :———————————————————– | :———————————————————- |<br>|    arp     | 从 /proc/net/arp 中收集 ARP 统计信息                         | Linux                                                       |<br>| conntrack  | 从 /proc/sys/net/netfilter/ 中收集 conntrack 统计信息        | Linux                                                       |<br>|    cpu     | 收集 cpu 统计信息                                            | Darwin, Dragonfly, FreeBSD, Linux                           |<br>| diskstats  | 从 /proc/diskstats 中收集磁盘 I/O 统计信息                   | Linux                                                       |<br>|    edac    | 错误检测与纠正统计信息                                       | Linux                                                       |<br>|  entropy   | 可用内核熵信息                                               | Linux                                                       |<br>|    exec    | execution 统计信息                                           | Dragonfly, FreeBSD                                          |<br>|   filefd   | 从 /proc/sys/fs/file-nr 中收集文件描述符统计信息             | Linux                                                       |<br>| filesystem | 文件系统统计信息，例如磁盘已使用空间                         | Darwin, Dragonfly, FreeBSD, Linux, OpenBSD                  |<br>|   hwmon    | 从 /sys/class/hwmon/ 中收集监控器或传感器数据信息            | Linux                                                       |<br>| infiniband | 从 InfiniBand 配置中收集网络统计信息                         | Linux                                                       |<br>|  loadavg   | 收集系统负载信息                                             | Darwin, Dragonfly, FreeBSD, Linux, NetBSD, OpenBSD, Solaris |<br>|   mdadm    | 从 /proc/mdstat 中获取设备统计信息                           | Linux                                                       |<br>|  meminfo   | 内存统计信息                                                 | Darwin, Dragonfly, FreeBSD, Linux                           |<br>|   netdev   | 网口流量统计信息，单位 bytes                                 | Darwin, Dragonfly, FreeBSD, Linux, OpenBSD                  |<br>|  netstat   | 从 /proc/net/netstat 收集网络统计数据，等同于 netstat -s     | Linux                                                       |<br>|  sockstat  | 从 /proc/net/sockstat 中收集 socket 统计信息                 | Linux                                                       |<br>|    stat    | 从 /proc/stat 中收集各种统计信息，包含系统启动时间，forks, 中断等 | Linux                                                       |<br>|  textfile  | 通过 –collector.textfile.directory 参数指定本地文本收集路径，收集文本信息 | any                                                |<br>|    time    | 系统当前时间                                                 | any                                                         |<br>|   uname    | 通过 uname 系统调用, 获取系统信息                            | any                                                         |<br>|   vmstat   | 从 /proc/vmstat 中收集统计信息                               | Linux                                                       |<br>|    wifi    | 收集 wifi 设备相关统计数据                                   | Linux                                                       |<br>|    xfs     | 收集 xfs 运行时统计信息                                      | Linux (kernel 4.4+)                                         |<br>|    zfs     | 收集 zfs 性能统计信息                                        | Linux                                                       |</p>\n<p><br/></p>\n<p><strong>默认关闭的功能</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">名称</th>\n<th style=\"text-align:left\">说明</th>\n<th style=\"text-align:left\">系统</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">bonding</td>\n<td style=\"text-align:left\">收集系统配置以及激活的绑定网卡数量</td>\n<td style=\"text-align:left\">Linux</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">buddyinfo</td>\n<td style=\"text-align:left\">从 /proc/buddyinfo 中收集内存碎片统计信息</td>\n<td style=\"text-align:left\">Linux</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">devstat</td>\n<td style=\"text-align:left\">收集设备统计信息</td>\n<td style=\"text-align:left\">Dragonfly, FreeBSD</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">drbd</td>\n<td style=\"text-align:left\">收集远程镜像块设备（DRBD）统计信息</td>\n<td style=\"text-align:left\">Linux</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">interrupts</td>\n<td style=\"text-align:left\">收集更具体的中断统计信息</td>\n<td style=\"text-align:left\">Linux，OpenBSD</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">ipvs</td>\n<td style=\"text-align:left\">从 /proc/net/ip_vs 中收集 IPVS 状态信息，从 /proc/net/ip_vs_stats 获取统计信息</td>\n<td style=\"text-align:left\">Linux</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">ksmd</td>\n<td style=\"text-align:left\">从 /sys/kernel/mm/ksm 中获取内核和系统统计信息</td>\n<td style=\"text-align:left\">Linux</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">logind</td>\n<td style=\"text-align:left\">从 logind 中收集会话统计信息</td>\n<td style=\"text-align:left\">Linux</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">meminfo_numa</td>\n<td style=\"text-align:left\">从 /proc/meminfo_numa 中收集内存统计信息</td>\n<td style=\"text-align:left\">Linux</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">mountstats</td>\n<td style=\"text-align:left\">从 /proc/self/mountstat 中收集文件系统统计信息，包括 NFS 客户端统计信息</td>\n<td style=\"text-align:left\">Linux</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">nfs</td>\n<td style=\"text-align:left\">从 /proc/net/rpc/nfs 中收集 NFS 统计信息，等同于 nfsstat -c</td>\n<td style=\"text-align:left\">Linux</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">qdisc</td>\n<td style=\"text-align:left\">收集队列推定统计信息</td>\n<td style=\"text-align:left\">Linux</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">runit</td>\n<td style=\"text-align:left\">收集 runit 状态信息</td>\n<td style=\"text-align:left\">any</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">supervisord</td>\n<td style=\"text-align:left\">收集 supervisord 状态信息</td>\n<td style=\"text-align:left\">any</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">systemd</td>\n<td style=\"text-align:left\">从 systemd 中收集设备系统状态信息</td>\n<td style=\"text-align:left\">Linux</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">tcpstat</td>\n<td style=\"text-align:left\">从 /proc/net/tcp 和 /proc/net/tcp6 收集 TCP 连接状态信息</td>\n<td style=\"text-align:left\">Linux</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">wifi</td>\n<td style=\"text-align:left\">Exposes WiFi device and station statistics.</td>\n<td style=\"text-align:left\">Linux</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">zoneinfo</td>\n<td style=\"text-align:left\">Exposes NUMA memory zone metrics.</td>\n<td style=\"text-align:left\">Linux</td>\n</tr>\n</tbody>\n</table>\n<p><br/></p>\n<p>Tips：简单的指标说明：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node_boot_time： 系统启动时间</span><br><span class=\"line\">node_cpu： 系统CUP使用情况</span><br><span class=\"line\">node_disk_*： 磁盘io</span><br><span class=\"line\">node_filesystem_*： 文件系统使用量</span><br><span class=\"line\">node_load1： 系统负载</span><br><span class=\"line\">node_memory_*： 系统内存使用量</span><br><span class=\"line\">node_network_*： 网络宽带</span><br><span class=\"line\">node_time： 当前系统时间</span><br><span class=\"line\">go_*： node exporter中go相关指标</span><br><span class=\"line\">*process_ ：node exporter自身进程相关指标</span><br></pre></td></tr></table></figure><br><br/></p>\n<h4 id=\"4-2-Windows主机监控指标\"><a href=\"#4-2-Windows主机监控指标\" class=\"headerlink\" title=\"4.2 Windows主机监控指标\"></a>4.2 Windows主机监控指标</h4><p>指标参考: <a href=\"https://github.com/prometheus-community/windows_exporter#collectors\" target=\"_blank\" rel=\"noopener\">https://github.com/prometheus-community/windows_exporter#collectors</a></p>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Description</th>\n<th>Enabled by default</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.ad.md\" target=\"_blank\" rel=\"noopener\">ad</a></td>\n<td>Active Directory Domain Services</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.adfs.md\" target=\"_blank\" rel=\"noopener\">adfs</a></td>\n<td>Active Directory Federation Services</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.cache.md\" target=\"_blank\" rel=\"noopener\">cache</a></td>\n<td>Cache metrics</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.cpu.md\" target=\"_blank\" rel=\"noopener\">cpu</a></td>\n<td>CPU usage</td>\n<td>✓</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.cpu_info.md\" target=\"_blank\" rel=\"noopener\">cpu_info</a></td>\n<td>CPU Information</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.cs.md\" target=\"_blank\" rel=\"noopener\">cs</a></td>\n<td>“Computer System” metrics (system properties, num cpus/total memory)</td>\n<td>✓</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.container.md\" target=\"_blank\" rel=\"noopener\">container</a></td>\n<td>Container metrics</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.dfsr.md\" target=\"_blank\" rel=\"noopener\">dfsr</a></td>\n<td>DFSR metrics</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.dhcp.md\" target=\"_blank\" rel=\"noopener\">dhcp</a></td>\n<td>DHCP Server</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.dns.md\" target=\"_blank\" rel=\"noopener\">dns</a></td>\n<td>DNS Server</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.exchange.md\" target=\"_blank\" rel=\"noopener\">exchange</a></td>\n<td>Exchange metrics</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.fsrmquota.md\" target=\"_blank\" rel=\"noopener\">fsrmquota</a></td>\n<td>Microsoft File Server Resource Manager (FSRM) Quotas collector</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.hyperv.md\" target=\"_blank\" rel=\"noopener\">hyperv</a></td>\n<td>Hyper-V hosts</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.iis.md\" target=\"_blank\" rel=\"noopener\">iis</a></td>\n<td>IIS sites and applications</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.logical_disk.md\" target=\"_blank\" rel=\"noopener\">logical_disk</a></td>\n<td>Logical disks, disk I/O</td>\n<td>✓</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.logon.md\" target=\"_blank\" rel=\"noopener\">logon</a></td>\n<td>User logon sessions</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.memory.md\" target=\"_blank\" rel=\"noopener\">memory</a></td>\n<td>Memory usage metrics</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.msmq.md\" target=\"_blank\" rel=\"noopener\">msmq</a></td>\n<td>MSMQ queues</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.mssql.md\" target=\"_blank\" rel=\"noopener\">mssql</a></td>\n<td><a href=\"https://docs.microsoft.com/en-us/sql/relational-databases/performance-monitor/use-sql-server-objects#SQLServerPOs\" target=\"_blank\" rel=\"noopener\">SQL Server Performance Objects</a> metrics</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.netframework_clrexceptions.md\" target=\"_blank\" rel=\"noopener\">netframework_clrexceptions</a></td>\n<td>.NET Framework CLR Exceptions</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.netframework_clrinterop.md\" target=\"_blank\" rel=\"noopener\">netframework_clrinterop</a></td>\n<td>.NET Framework Interop Metrics</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.netframework_clrjit.md\" target=\"_blank\" rel=\"noopener\">netframework_clrjit</a></td>\n<td>.NET Framework JIT metrics</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.netframework_clrloading.md\" target=\"_blank\" rel=\"noopener\">netframework_clrloading</a></td>\n<td>.NET Framework CLR Loading metrics</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.netframework_clrlocksandthreads.md\" target=\"_blank\" rel=\"noopener\">netframework_clrlocksandthreads</a></td>\n<td>.NET Framework locks and metrics threads</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.netframework_clrmemory.md\" target=\"_blank\" rel=\"noopener\">netframework_clrmemory</a></td>\n<td>.NET Framework Memory metrics</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.netframework_clrremoting.md\" target=\"_blank\" rel=\"noopener\">netframework_clrremoting</a></td>\n<td>.NET Framework Remoting metrics</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.netframework_clrsecurity.md\" target=\"_blank\" rel=\"noopener\">netframework_clrsecurity</a></td>\n<td>.NET Framework Security Check metrics</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.net.md\" target=\"_blank\" rel=\"noopener\">net</a></td>\n<td>Network interface I/O</td>\n<td>✓</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.os.md\" target=\"_blank\" rel=\"noopener\">os</a></td>\n<td>OS metrics (memory, processes, users)</td>\n<td>✓</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.process.md\" target=\"_blank\" rel=\"noopener\">process</a></td>\n<td>Per-process metrics</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.remote_fx.md\" target=\"_blank\" rel=\"noopener\">remote_fx</a></td>\n<td>RemoteFX protocol (RDP) metrics</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.service.md\" target=\"_blank\" rel=\"noopener\">service</a></td>\n<td>Service state metrics</td>\n<td>✓</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.smtp.md\" target=\"_blank\" rel=\"noopener\">smtp</a></td>\n<td>IIS SMTP Server</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.system.md\" target=\"_blank\" rel=\"noopener\">system</a></td>\n<td>System calls</td>\n<td>✓</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.tcp.md\" target=\"_blank\" rel=\"noopener\">tcp</a></td>\n<td>TCP connections</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.time.md\" target=\"_blank\" rel=\"noopener\">time</a></td>\n<td>Windows Time Service</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.thermalzone.md\" target=\"_blank\" rel=\"noopener\">thermalzone</a></td>\n<td>Thermal information</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.terminal_services.md\" target=\"_blank\" rel=\"noopener\">terminal_services</a></td>\n<td>Terminal services (RDS)</td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.textfile.md\" target=\"_blank\" rel=\"noopener\">textfile</a></td>\n<td>Read prometheus metrics from a text file</td>\n<td>✓</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/prometheus-community/windows_exporter/blob/master/docs/collector.vmware.md\" target=\"_blank\" rel=\"noopener\">vmware</a></td>\n<td>Performance counters installed by the Vmware Guest agent</td>\n</tr>\n</tbody>\n</table>\n<p><br/></p>\n<h4 id=\"4-3-容器监控指标说明\"><a href=\"#4-3-容器监控指标说明\" class=\"headerlink\" title=\"4.3 容器监控指标说明\"></a>4.3 容器监控指标说明</h4><p>项目地址: <a href=\"https://github.com/google/cadvisor\" target=\"_blank\" rel=\"noopener\">https://github.com/google/cadvisor</a><br>指标参考: <a href=\"https://github.com/google/cadvisor/blob/master/docs/storage/prometheus.md\" target=\"_blank\" rel=\"noopener\">https://github.com/google/cadvisor/blob/master/docs/storage/prometheus.md</a></p>\n<p><strong>cAdvisor 常用监控指标</strong><br>| 指标名称                               |  类型   | 含义                                         |<br>| ————————————– | :—–: | ——————————————– |<br>| container_cpu_load_average_10s         |  gauge  | 过去10秒容器CPU的平均负载                    |<br>| container_cpu_usage_seconds_total      | counter | 容器在每个CPU内核上的累积占用时间 (单位：秒) |<br>| container_cpu_system_seconds_total     | counter | System CPU累积占用时间（单位：秒）           |<br>| container_cpu_user_seconds_total       | counter | User CPU累积占用时间（单位：秒）             |<br>| container_fs_usage_bytes               |  gauge  | 容器中文件系统的使用量(单位：字节)           |<br>| container_fs_limit_bytes               |  gauge  | 容器可以使用的文件系统总量(单位：字节)       |<br>| container_fs_reads_bytes_total         | counter | 容器累积读取数据的总量(单位：字节)           |<br>| container_fs_writes_bytes_total        | counter | 容器累积写入数据的总量(单位：字节)           |<br>| container_memory_max_usage_bytes       |  gauge  | 容器的最大内存使用量（单位：字节）           |<br>| container_memory_usage_bytes           |  gauge  | 容器当前的内存使用量（单位：字节             |<br>| container_spec_memory_limit_bytes      |  gauge  | 容器的内存使用量限制                       |<br>| machine_memory_bytes                   |  gauge  | 当前主机的内存总量                         |<br>| container_network_receive_bytes_total  | counter | 容器网络累积接收数据总量（单位：字节）       |<br>| container_network_transmit_bytes_total | counter | 容器网络累积传输数据总量（单位：字节）       |</p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"monitor","path":"api/categories/monitor.json"},{"name":"kubernetes","path":"api/categories/kubernetes.json"},{"name":"OperationTools","path":"api/categories/OperationTools.json"}],"tags":[{"name":"Prometheus","path":"api/tags/Prometheus.json"}]}