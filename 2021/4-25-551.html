<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 2.Prometheusç›‘æ§å…¥é—¨ä¹‹ç›‘æ§é…ç½®è¯´æ˜|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Prometheus">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>2.Prometheusç›‘æ§å…¥é—¨ä¹‹ç›‘æ§é…ç½®è¯´æ˜</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">2.Prometheusç›‘æ§å…¥é—¨ä¹‹ç›‘æ§é…ç½®è¯´æ˜</h1>
        <h5 class="subtitle">
            
                <time datetime="2021-04-25T09:37:47.000Z" itemprop="datePublished" class="page-time">
  2021-04-25
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/monitor/">monitor</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/monitor/kubernetes/">kubernetes</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/monitor/kubernetes/OperationTools/">OperationTools</a></li></ul></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/åŠŸèƒ½ç»„ä»¶/Prometheus/2.Prometheusç›‘æ§å…¥é—¨ä¹‹ç›‘æ§é…ç½®è¯´æ˜åŠå…¶å®ä¾‹"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">2.Prometheusç›‘æ§å…¥é—¨ä¹‹ç›‘æ§é…ç½®è¯´æ˜</h1>
        <div class="post-meta">
            <time class="post-time" title="2021-04-25 17:37:47" datetime="2021-04-25T09:37:47.000Z"  itemprop="datePublished">2021-04-25</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/monitor/">monitor</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/monitor/kubernetes/">kubernetes</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/monitor/kubernetes/OperationTools/">OperationTools</a></li></ul></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<hr>
<h2 id="0x00-ç»„ä»¶ä»‹ç»"><a href="#0x00-ç»„ä»¶ä»‹ç»" class="headerlink" title="0x00 ç»„ä»¶ä»‹ç»"></a>0x00 ç»„ä»¶ä»‹ç»</h2><h3 id="Prometheus"><a href="#Prometheus" class="headerlink" title="Prometheus"></a>Prometheus</h3><p>æè¿°: å¦‚æœæˆ‘ä»¬é‡‡ç”¨<code>prometheus</code>æä¾›çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œæ­å»ºprometheusæœåŠ¡å™¨,å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æµç¨‹è¿›è¡Œæ“ä½œè¿è¡Œï¼ŒäºŒè¿›åˆ¶Releaseä¸‹è½½åœ°å€: <a href="https://github.com/prometheus/prometheus/releases" target="_blank" rel="noopener">https://github.com/prometheus/prometheus/releases</a></p>
<p><strong>ç®€å•æµç¨‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) ä¸‹è½½äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶</span></span><br><span class="line">wget https://github.com/prometheus/prometheus/releases/download/v2.26.0/prometheus-2.26.0.linux-amd64.tar.gz</span><br><span class="line">tar -zxvf prometheus-2.26.0.linux-amd64.tar.gz  -C /usr/<span class="built_in">local</span>/</span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/prometheus-2.26.0.linux-amd64</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) åå°å¯åŠ¨å¹¶ä¿®æ”¹å¼€æ”¾ç«¯å£</span></span><br><span class="line">nohup ./prometheus --config.file=prometheus.yml --web.enable-lifecycle  --web.listen-address=:30090 &amp; </span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) æŸ¥çœ‹å¯åŠ¨çŠ¶æ€</span></span><br><span class="line">ps -ef | grep prometheus </span><br><span class="line">lsof -i:19908</span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) æŸ¥çœ‹å¯åŠ¨çš„å‘½ä»¤è¡Œå‚æ•°</span></span><br><span class="line">./prometheus -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) å¼ºè¡Œå…³é—­ Prometheus</span></span><br><span class="line">lsof -i:19908</span><br><span class="line"><span class="built_in">kill</span> -9 pid</span><br><span class="line"></span><br><span class="line"><span class="comment"># (6) è¡¥å……ç³»ç»ŸæœåŠ¡è¿›è¡Œå¯åŠ¨Prometheus</span></span><br><span class="line">sudo tee /usr/lib/systemd/system/prometheus.service &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Prometheus Server Systemd</span><br><span class="line">Documentation=https://prometheus.io</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">StandardError=journal</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/prometheus/prometheus --config.file=/usr/<span class="built_in">local</span>/prometheus/prometheus.yml  --web.listen-address=:9090 --storage.tsdb.path=/app/prometheus_data --storage.tsdb.retention.time=7d --web.enable-lifecycle --web.enable-admin-api	</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=3s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload &amp;&amp; systemctl restart prometheus.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># (7) è‡ªåŠ¨å‘ç°æ—¥å¿—æ–‡ä»¶é…ç½®</span></span><br><span class="line">mkdir /etc/prometheus/ &amp;&amp; touch /etc/prometheus/WeiyiGeek_linux_nodes.yml</span><br></pre></td></tr></table></figure></p>
<p><strong>å¯åŠ¨å‚æ•°:</strong> è¿è¡Œåæˆ‘ä»¬å¯ä»¥è®¿é—®<code>http://192.168.12.107:30090/classic/flags</code>æŸ¥çœ‹åˆ°è‡ªå®šä¹‰æˆ–è€…é»˜è®¤çš„å¯åŠ¨å‚æ•°ã€‚</p>
<table>
<thead>
<tr>
<th>Command-Line Flags - å‚æ•°åç§°</th>
<th>å‚æ•°å€¼</th>
<th style="text-align:left">å‚æ•°è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>alertmanager.notification-queue-capacity</td>
<td>10000</td>
</tr>
<tr>
<td>alertmanager.timeout</td>
<td></td>
</tr>
<tr>
<td>config.file</td>
<td>/etc/prometheus/prometheus.yml</td>
<td style="text-align:left">æŒ‡å®š prometheus.ymlé…ç½®æ–‡ä»¶</td>
</tr>
<tr>
<td>enable-feature</td>
<td></td>
</tr>
<tr>
<td>log.format</td>
<td>logfmt</td>
<td style="text-align:left">è®¾ç½®æ‰“å°æ—¥å¿—çš„æ ¼å¼ï¼Œè‹¥æœ‰è‡ªåŠ¨åŒ–æ—¥å¿—æå–å·¥å…·å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‚æ•°è§„èŒƒæ—¥å¿—æ‰“å°çš„æ ¼å¼<code>logger:stderr</code></td>
</tr>
<tr>
<td>log.level</td>
<td>info</td>
</tr>
<tr>
<td>query.lookback-delta</td>
<td>5m</td>
</tr>
<tr>
<td>query.max-concurrency</td>
<td>20</td>
</tr>
<tr>
<td>query.max-samples</td>
<td>50000000</td>
</tr>
<tr>
<td>query.timeout</td>
<td>2m</td>
</tr>
<tr>
<td>rules.alert.for-grace-period</td>
<td>10m</td>
</tr>
<tr>
<td>rules.alert.for-outage-tolerance</td>
<td>1h</td>
</tr>
<tr>
<td>rules.alert.resend-delay</td>
<td>1m</td>
</tr>
<tr>
<td>scrape.adjust-timestamps</td>
<td>true</td>
</tr>
<tr>
<td>storage.exemplars.exemplars-limit</td>
<td>0</td>
</tr>
<tr>
<td>storage.remote.flush-deadline</td>
<td>1m</td>
</tr>
<tr>
<td>storage.remote.read-concurrent-limit</td>
<td>10</td>
</tr>
<tr>
<td>storage.remote.read-max-bytes-in-frame</td>
<td>1048576</td>
</tr>
<tr>
<td>storage.remote.read-sample-limit</td>
<td>50000000</td>
</tr>
<tr>
<td>storage.tsdb.allow-overlapping-blocks</td>
<td>false</td>
</tr>
<tr>
<td>storage.tsdb.max-block-duration</td>
<td>1d12h</td>
</tr>
<tr>
<td>storage.tsdb.min-block-duration</td>
<td>2h</td>
</tr>
<tr>
<td>storage.tsdb.no-lockfile</td>
<td>false</td>
<td style="text-align:left">å¦‚æœç”¨k8sçš„deployment ç®¡ç†è¦è®¾ç½®ä¸ºtue</td>
</tr>
<tr>
<td>storage.tsdb.path</td>
<td>data/</td>
<td style="text-align:left">æŒ‡å®štsdbæ•°æ®å­˜å‚¨è·¯å¾„(å®¹å™¨ä¸­é»˜è®¤æ˜¯/prometheus/data)</td>
</tr>
<tr>
<td>storage.tsdb.retention</td>
<td>0s</td>
</tr>
<tr>
<td>storage.tsdb.retention.size</td>
<td>0B</td>
<td style="text-align:left"><code>[EXPERIMENTAL]</code>è¦ä¿ç•™çš„æœ€å¤§å­˜å‚¨å—å­—èŠ‚æ•°,æœ€æ—§çš„æ•°æ®å°†é¦–å…ˆè¢«åˆ é™¤é»˜è®¤ä¸º0æˆ–ç¦ç”¨ã€‚</td>
</tr>
<tr>
<td>storage.tsdb.retention.time</td>
<td>0s</td>
<td style="text-align:left">æŒ‡å®šæ•°æ®å­˜å‚¨æ—¶é—´å³ä½•æ—¶åˆ é™¤æ—§æ•°æ®(æ¨è7d)</td>
</tr>
<tr>
<td>storage.tsdb.wal-compression</td>
<td>true</td>
<td style="text-align:left">å¯ç”¨å‹ç¼©é¢„å†™æ—¥å¿—ï¼ˆWALï¼‰,æ ¹æ®æ‚¨çš„æ•°æ®æ‚¨å¯ä»¥é¢„æœŸWALå¤§å°å°†å‡å°‘ä¸€åŠè€Œé¢å¤–çš„CPUè´Ÿè½½å´å¾ˆå°‘</td>
</tr>
<tr>
<td>storage.tsdb.wal-segment-size</td>
<td>0B</td>
</tr>
<tr>
<td>web.config.file</td>
<td></td>
</tr>
<tr>
<td>web.console.libraries</td>
<td>console_libraries</td>
</tr>
<tr>
<td>web.console.templates</td>
<td>consoles</td>
</tr>
<tr>
<td>web.cors.origin</td>
<td>.*</td>
</tr>
<tr>
<td>web.enable-admin-api</td>
<td>false</td>
<td style="text-align:left">æ˜¯å¦å¯ç”¨ admin api çš„è®¿é—®æƒé™(TSDBç®¡ç†API)</td>
</tr>
<tr>
<td>web.enable-lifecycle</td>
<td>true</td>
<td style="text-align:left">æ˜¯å¦å¯ç”¨ APIï¼Œå¯ç”¨APIåï¼Œå¯ä»¥é€šè¿‡ APIæŒ‡ä»¤å®Œæˆ Prometheus çš„ åœæ­¢ã€çƒ­åŠ è½½é…ç½®æ–‡ä»¶ ç­‰</td>
</tr>
<tr>
<td>web.external-url</td>
<td></td>
</tr>
<tr>
<td>web.listen-address</td>
<td>0.0.0.0:9090</td>
<td style="text-align:left">ç›‘å¬åœ°å€å’Œæä¾›æœåŠ¡ç«¯å£</td>
</tr>
<tr>
<td>web.max-connections</td>
<td>512</td>
</tr>
<tr>
<td>web.page-title</td>
<td>Prometheus Time Series Collection and Processing Server</td>
</tr>
<tr>
<td>web.read-timeout</td>
<td>5m</td>
</tr>
<tr>
<td>web.route-prefix</td>
<td>/</td>
</tr>
<tr>
<td>web.user-assets</td>
</tr>
</tbody>
</table>
<p>Tips ï¼š å½“æˆ‘ä»¬å¯ç”¨äº† API æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥çœ‹å½“å‰<code>prometheus.yml</code>ä¸­çš„é…ç½®å’Œåˆ©ç”¨POSTè¯·æ±‚é‡è½½é…ç½®ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰é…ç½®,å¦‚æœä½¿ä¿®æ”¹åçš„prometheus.ymlé…ç½®ç”Ÿæ•ˆå¯å‚ç…§ä¸‹é¢å¾—æ–¹å¼(åœ¨ä¹Ÿä¸ç”¨é‡å¯å®¹å™¨äº†)</span></span><br><span class="line">curl http://192.168.12.107:30090/api/v1/status/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼1.å¦‚æœåœ¨æœ¬æœºäºŒè¿›åˆ¶å¯æ‰§è¡Œæ—¶å¯ä»¥é€šè¿‡ä½¿ç”¨SIGHUPæ¥é‡è½½Prometheusè€Œä¸ç”¨é‡å¯(ctrl+c)</span></span><br><span class="line"><span class="built_in">kill</span> -SIGHUP prometheus</span><br><span class="line"><span class="comment"># æ–¹å¼2.Yes, sending SIGHUP to the Prometheus process or an HTTP POST request to the /-/reload endpoint </span></span><br><span class="line">curl -X POST http://192.168.12.107:30090/-/reload</span><br><span class="line">  <span class="comment"># level=info ts=2021-05-08T06:37:53.793Z caller=main.go:944 msg="Loading configuration file" filename=/etc/prometheus/prometheus.yml</span></span><br><span class="line">  <span class="comment"># level=info ts=2021-05-08T06:37:53.799Z caller=main.go:975 msg="Completed loading of configuration file" filename=/etc/prometheus/prometheus.yml totalDuration=6.025725ms remote_storage=2.732Âµs web_handler=617ns query_engine=1.456Âµs scrape=124.866Âµs scrape_sd=55.119Âµs notify=1.099Âµs notify_sd=1.377Âµs rules=4.424043ms</span></span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=2.Prometheusç›‘æ§å…¥é—¨ä¹‹ç›‘æ§é…ç½®è¯´æ˜ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210507165748.png" target="_blank" title="WeiyiGeek.status-config" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210507165748.png" alt="WeiyiGeek.status-config" title="" class=""></a>
                <p>WeiyiGeek.status-config</p>
            </figure>
<p><br></p>
<h3 id="Exporter-amp-Collectors"><a href="#Exporter-amp-Collectors" class="headerlink" title="Exporter&amp;Collectors"></a>Exporter&amp;Collectors</h3><p>æè¿°: Prometheus ç»™æˆ‘ä»¬æä¾›äº†å¤šç§åœºæ™¯çš„ç›‘æ§ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>https://github.com/prometheus?q=_export&amp;type=&amp;language=&amp;sort=</code>Prometheus Gitlabé¡¹ç›®ä¸­æŸ¥çœ‹åˆ°ã€‚</p>
<ul>
<li>(0) node_export : Node ä¸»è¦ç›‘æ§ä¸»æœºç¡¬ä»¶å’Œç³»ç»Ÿèµ„æºç›¸å…³æŒ‡æ ‡ï¼Œå»ºè®®Windowsç”¨æˆ·ä½¿ç”¨Windows exporterã€‚<br>é¡¹ç›®åœ°å€: <a href="https://github.com/prometheus/node_exporter" target="_blank" rel="noopener">https://github.com/prometheus/node_exporter</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç«¯å£: 9100</span></span><br><span class="line"><span class="comment"># Docker</span></span><br><span class="line">docker run -d --net=<span class="string">"host"</span> --pid=<span class="string">"host"</span> -v <span class="string">"/:/host:ro,rslave"</span> quay.io/prometheus/node-exporter:latest --path.rootfs=/host</span><br><span class="line"></span><br><span class="line"><span class="comment"># Docker compose</span></span><br><span class="line">---</span><br><span class="line">version: <span class="string">'3.8'</span></span><br><span class="line">services:</span><br><span class="line">  node_exporter:</span><br><span class="line">    image: prom/node-exporter:latest</span><br><span class="line">    container_name: node_exporter</span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">      - <span class="string">'--path.rootfs=/host'</span></span><br><span class="line">    network_mode: host</span><br><span class="line">    pid: host</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="string">'/:/host:ro,rslave'</span></span><br><span class="line"><span class="comment"># Using the binary execute file</span></span><br><span class="line"><span class="comment"># Auth ä¸ SSL é…ç½®å‚è€ƒ: https://github.com/prometheus/exporter-toolkit/blob/v0.1.0/https/README.md</span></span><br><span class="line">./node_exporter --web.config=<span class="string">"web-config.yml"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨æŸäº›ç³»ç»Ÿä¸Šï¼Œtimexæ”¶é›†å™¨éœ€è¦ä¸€ä¸ªé™„åŠ çš„Dockeræ ‡å¿—-cap-add=SYS_TIMEï¼Œä»¥ä¾¿è®¿é—®æ‰€éœ€çš„ç³»ç»Ÿè°ƒç”¨ã€‚</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>è¡¥å……:Linuxé…ç½®SystemdæœåŠ¡å¯åŠ¨<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">ftp -v -n 192.168.12.31&lt;&lt;EOF</span><br><span class="line">user WeiyiGeektemp</span><br><span class="line">binary</span><br><span class="line">lcd /tmp</span><br><span class="line">prompt</span><br><span class="line">get node_exporter-1.1.2.linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">bye</span></span><br><span class="line">EOF</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"download from ftp successfully"</span></span><br><span class="line">sudo tar -zxvf /tmp/node_exporter-1.1.2.linux-amd64.tar.gz -C /usr/<span class="built_in">local</span>/</span><br><span class="line">sudo ln -s /usr/<span class="built_in">local</span>/node_exporter-1.1.2.linux-amd64/node_exporter /usr/<span class="built_in">local</span>/bin/node_exporter</span><br><span class="line">sudo tee /usr/lib/systemd/system/node_exporter.service &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Node Exporter Clinet</span><br><span class="line">Documentation=https://prometheus.io/</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">StandardError=journal</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/bin/node_exporter --web.listen-address=:9100</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=3s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line">sudo chmod 754 /usr/lib/systemd/system/node_exporter.service</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> node_exporter.service</span><br><span class="line">sudo systemctl start node_exporter.service</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<ul>
<li>(1) windows_exporter : è¯¥é‡‡é›†å™¨ä¸»è¦é’ˆå¯¹äºWindowsçš„æœºå™¨ã€‚<br>é¡¹ç›®åœ°å€: <a href="https://github.com/prometheus-community/windows_exporter" target="_blank" rel="noopener">https://github.com/prometheus-community/windows_exporter</a><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç«¯å£: 9182</span></span><br><span class="line"><span class="comment"># Usage</span></span><br><span class="line"><span class="comment"># - ä»…å¯ç”¨service collectorå¹¶æŒ‡å®šè‡ªå®šä¹‰æŸ¥è¯¢</span></span><br><span class="line">.\windows_exporter.exe --collectors.enabled <span class="string">"service"</span> --collector.service.services-where <span class="string">"Name='windows_exporter'"</span></span><br><span class="line"><span class="comment"># - ä»…å¯ç”¨process collectorå¹¶æŒ‡å®šè‡ªå®šä¹‰æŸ¥è¯¢</span></span><br><span class="line">.\windows_exporter.exe --collectors.enabled <span class="string">"process"</span> --collector.process.whitelist=<span class="string">"firefox.+"</span></span><br><span class="line"><span class="comment"># - å°†[defaults]ä¸--collectors.enabledå‚æ•°ä¸€èµ·ä½¿ç”¨ï¼Œè¯¥å‚æ•°å°†ä¸æ‰€æœ‰é»˜è®¤æ”¶é›†å™¨ä¸€èµ·å±•å¼€ã€‚</span></span><br><span class="line">.\windows_exporter.exe --collectors.enabled <span class="string">"[defaults],process,container"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Using a configuration file</span></span><br><span class="line">.\windows_exporter.exe --config.file=config.yml</span><br><span class="line"><span class="variable">$config</span> = <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">collectors:</span></span><br><span class="line"><span class="string">  enabled: cpu,cs,logical_disk,net,os,system,service,logon,process,tcp</span></span><br><span class="line"><span class="string">collector:</span></span><br><span class="line"><span class="string">  service:</span></span><br><span class="line"><span class="string">    services-where: Name='windows_exporter'</span></span><br><span class="line"><span class="string">log:</span></span><br><span class="line"><span class="string">  level: error</span></span><br><span class="line"><span class="string">scrape:</span></span><br><span class="line"><span class="string">  timeout-margin: 0.5</span></span><br><span class="line"><span class="string">telemetry:</span></span><br><span class="line"><span class="string">  addr: "</span>:<span class="number">9182</span><span class="string">"</span></span><br><span class="line"><span class="string">  path: /metrics</span></span><br><span class="line"><span class="string">  max-requests: 5</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br><span class="line">echo <span class="variable">$config</span> &gt; config.yml</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>è¡¥å……:</strong> é‡‡ç”¨PowerShellå’Œbatæ·»åŠ è‡ªå¯åŠ¨æœåŠ¡å’Œè®¾ç½®é˜²ç«å¢™æ”¾è¡Œã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - PowerShell</span></span><br><span class="line"><span class="comment">#####################################</span></span><br><span class="line"><span class="comment"># Prometheus Metrics Nodes Services #</span></span><br><span class="line"><span class="comment"># Prometheus Exporter firewall Rule #</span></span><br><span class="line"><span class="comment"># Author: WeiyiGeek                 #</span></span><br><span class="line"><span class="comment"># Desc: éœ€è¦å°†è¯¥è„šæœ¬ä»¥åŠwindows_exporter-$&#123;exporterVersion&#125;-amd64.exeæ–‡ä»¶æ”¾å…¥åˆ°d:\proä¸­</span></span><br><span class="line"><span class="comment">#####################################</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$exporterVersion</span>=<span class="string">"0.16.0"</span></span><br><span class="line"><span class="variable">$currentPath</span>=(Get-Location).path</span><br><span class="line"><span class="variable">$serviceName</span>=<span class="string">"prometheus_exporter_service"</span></span><br><span class="line">@<span class="string">"</span></span><br><span class="line"><span class="string">collectors:</span></span><br><span class="line"><span class="string">  enabled: cpu,cs,logical_disk,net,os,system,service,logon,process,tcp</span></span><br><span class="line"><span class="string">collector:</span></span><br><span class="line"><span class="string">  service:</span></span><br><span class="line"><span class="string">    services-where: Name='windows_exporter'</span></span><br><span class="line"><span class="string">log:</span></span><br><span class="line"><span class="string">  level: error</span></span><br><span class="line"><span class="string">scrape:</span></span><br><span class="line"><span class="string">  timeout-margin: 0.5</span></span><br><span class="line"><span class="string">telemetry:</span></span><br><span class="line"><span class="string">  addr: "</span>:9100<span class="string">"</span></span><br><span class="line"><span class="string">  path: /metrics</span></span><br><span class="line"><span class="string">  max-requests: 5</span></span><br><span class="line"><span class="string">"</span>@ | Out-File config.yml -Encoding utf8</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæœåŠ¡å­˜åœ¨åˆ™åœæ­¢ä»¥åŠåˆ é™¤æ—§æœåŠ¡</span></span><br><span class="line"><span class="keyword">if</span> (Get-Service -Name <span class="variable">$&#123;serviceName&#125;</span> -ErrorAction Ignore ) </span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"æ³¨æ„: æ“ä½œæ—¶éœ€è¦å…³é—­ç³»ç»Ÿä¸­å…¨éƒ¨services.mscæœåŠ¡çª—å£"</span></span><br><span class="line">  sc stop <span class="variable">$&#123;serviceName&#125;</span> </span><br><span class="line">  sc delete <span class="variable">$&#123;serviceName&#125;</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># - æœåŠ¡åˆ›å»º</span></span><br><span class="line"><span class="variable">$params</span> = @&#123;</span><br><span class="line">  Name = <span class="variable">$&#123;serviceName&#125;</span></span><br><span class="line">  BinaryPathName = <span class="string">"<span class="variable">$currentPath</span>\windows_exporter-<span class="variable">$&#123;exporterVersion&#125;</span>-amd64.exe --config.file=<span class="variable">$currentPath</span>\config.yml"</span></span><br><span class="line">  DisplayName = <span class="string">"prometheus_windows_exporter_service"</span></span><br><span class="line">  StartupType = <span class="string">"Automatic"</span></span><br><span class="line">  Description = <span class="string">"windows exporter service open 9100 port!"</span></span><br><span class="line">&#125;</span><br><span class="line">New-Service @params</span><br><span class="line"></span><br><span class="line"><span class="comment"># - å¯åŠ¨åŠæœåŠ¡æŸ¥çœ‹</span></span><br><span class="line">Get-Service -Name <span class="string">"prometheus_windows_exporter_service"</span> | Start-Service -PassThru</span><br><span class="line"></span><br><span class="line"><span class="comment"># - é˜²ç«å¢™è§„åˆ™è®¾ç½®ï¼ˆåªå…è®¸10.0.30.200æœºå™¨è®¿é—®ï¼‰</span></span><br><span class="line">New-NetFirewallRule -Name <span class="string">"prometheus_windows_exporter_service"</span> -DisplayName <span class="string">"prometheus_windows_exporter_service"</span> -Description <span class="string">"prometheus_windows_exporter_service"</span> -Direction Inbound -LocalPort 9100 -RemoteAddress 10.0.30.200 -Protocol TCP -Action Allow -Enabled True</span><br><span class="line">Get-NetFirewallRule -Name <span class="string">"prometheus_windows_exporter_service"</span>  | Format-Table</span><br><span class="line"><span class="comment"># - bat</span></span><br><span class="line">sc create prometheus_windows_exporter_service binPath= <span class="string">"d:\weiyigeek\windows_exporter-0.16.0-amd64.exe --config.file=d:\weiyigeek\config.yml"</span> start= <span class="string">"auto"</span> displayname= <span class="string">"prometheus_windows_exporter_service"</span></span><br><span class="line">sc start prometheus_windows_exporter_service</span><br><span class="line">netsh advfirewall firewall add rule name=<span class="string">"prometheus_windows_exporter_service"</span> dir=<span class="keyword">in</span> protocol=tcp localport=9100 action=allow remoteip=10.0.30.2 <span class="built_in">enable</span>=yes</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>è¡¥å……ï¼š</strong>é‡‡ç”¨msiæ ¼å¼è¿›è¡Œå®‰è£…éƒ¨ç½²<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msiexec /i <span class="string">"D:\weiyigeek\windoes_exporter.msi"</span> ENABELD_COLLECTORS=<span class="string">"os,cpu,cs.logical_disk,net,system,process"</span> LISTEN_PORT=<span class="string">"9182"</span> EXTRA_FLAGS=<span class="string">"--collector.process.whitelist=abc|windows_exporter"</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<ul>
<li>(2) blackbox_exporter : Blackbox å…è®¸é€šè¿‡HTTPã€HTTPSã€DNSã€TCPå’ŒICMPå¯¹ç«¯ç‚¹è¿›è¡Œé»‘ç›’æ¢æµ‹(å…¶æ”¯æŒTLSå’ŒåŸºæœ¬èº«ä»½éªŒè¯)ã€‚<br>é¡¹ç›®åœ°å€: <a href="https://github.com/prometheus/blackbox_exporter" target="_blank" rel="noopener">https://github.com/prometheus/blackbox_exporter</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç«¯å£: 9115</span></span><br><span class="line"><span class="comment"># Using the docker image</span></span><br><span class="line">docker run --rm -d -p 9115:9115 --name blackbox_exporter -v `<span class="built_in">pwd</span>`:/config prom/blackbox-exporter:master --config.file=/config/blackbox.yml</span><br><span class="line"></span><br><span class="line"><span class="comment"># Checking the results</span></span><br><span class="line">curl http://localhost:9115/probe?target=google.com&amp;module=http_2xx</span><br><span class="line"></span><br><span class="line"><span class="comment"># Prometheus Configuration</span></span><br><span class="line"><span class="comment"># é»‘ç›’å¯¼å‡ºå™¨éœ€è¦ä½œä¸ºå‚æ•°ä¼ é€’ç»™ç›®æ ‡ï¼Œè¿™å¯ä»¥é€šè¿‡é‡æ–°æ ‡è®°æ¥å®Œæˆã€‚</span></span><br><span class="line">scrape_configs:</span><br><span class="line">  - job_name: <span class="string">'blackbox'</span></span><br><span class="line">    metrics_path: /probe</span><br><span class="line">    params:</span><br><span class="line">      module: [http_2xx]  <span class="comment"># Look for a HTTP 200 response.</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - http://prometheus.io    <span class="comment"># Target to probe with http.</span></span><br><span class="line">        - https://prometheus.io   <span class="comment"># Target to probe with https.</span></span><br><span class="line">        - http://example.com:8080 <span class="comment"># Target to probe with http on port 8080.</span></span><br><span class="line">    relabel_configs:</span><br><span class="line">      - source_labels: [__address__]</span><br><span class="line">        target_label: __param_target</span><br><span class="line">      - source_labels: [__param_target]</span><br><span class="line">        target_label: instance</span><br><span class="line">      - target_label: __address__</span><br><span class="line">        replacement: 127.0.0.1:9115  <span class="comment"># The blackbox exporter's real hostname:port.</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>(3) statsd_exporter: è¯¥é‡‡é›†å™¨æ¥æ”¶StatsDæ ·å¼çš„æŒ‡æ ‡ï¼Œå¹¶å°†å…¶å¯¼å‡ºä¸ºPrometheusæŒ‡æ ‡ã€‚<br>é¡¹ç›®åœ°å€: <a href="https://github.com/prometheus/statsd_exporter" target="_blank" rel="noopener">https://github.com/prometheus/statsd_exporter</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç«¯å£: 9125</span></span><br><span class="line"><span class="comment"># Using Docker</span></span><br><span class="line">docker pull prom/statsd-exporter</span><br><span class="line">docker run -d -p 9102:9102 -p 9125:9125 -p 9125:9125/udp \</span><br><span class="line">        -v <span class="variable">$PWD</span>/statsd_mapping.yml:/tmp/statsd_mapping.yml \</span><br><span class="line">        prom/statsd-exporter --statsd.mapping-config=/tmp/statsd_mapping.yml</span><br></pre></td></tr></table></figure>
Tips : ä½¿ç”¨æˆ–è€…ä¸ä½¿ç”¨ StatsD<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - ä½¿ç”¨ StatsD : è¦å°†æŒ‡æ ‡ä»ç°æœ‰çš„StatsDç¯å¢ƒå¯¼å…¥Prometheusï¼Œè¯·é…ç½®StatsDçš„è½¬å‘å™¨åç«¯ï¼Œä»¥å°†æ‰€æœ‰æ¥æ”¶åˆ°çš„æŒ‡æ ‡é‡å¤åˆ°statsd_exporter æµç¨‹ä¸­ã€‚</span></span><br><span class="line"><span class="comment"># è¯¥å¯¼å‡ºå™¨é€šè¿‡é…ç½®çš„æ˜ å°„è§„åˆ™å°†StatsDæŒ‡æ ‡è½¬æ¢ä¸ºPrometheusæŒ‡æ ‡ã€‚</span></span><br><span class="line">+----------+                         +-------------------+                        +--------------+</span><br><span class="line">|  StatsD  |---(UDP/TCP repeater)---&gt;|  statsd_exporter  |&lt;---(scrape /metrics)---|  Prometheus  |</span><br><span class="line">+----------+                         +-------------------+                        +--------------+</span><br><span class="line"><span class="comment"># - æ²¡æœ‰StatsD ï¼šç”±äºStatsDå¯¼å‡ºå™¨ä½¿ç”¨ä¸StatsDæœ¬èº«ç›¸åŒçš„çº¿è·¯åè®®ï¼Œå› æ­¤æ‚¨è¿˜å¯ä»¥é…ç½®åº”ç”¨ç¨‹åºä»¥å°†StatsDæŒ‡æ ‡ç›´æ¥å‘é€åˆ°å¯¼å‡ºå™¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨ä¸å†éœ€è¦è¿è¡ŒStatsDæœåŠ¡å™¨ã€‚</span></span><br><span class="line"><span class="comment"># æˆ‘ä»¬å»ºè®®ä»…å°†æ­¤ä½œä¸ºä¸­é—´è§£å†³æ–¹æ¡ˆï¼Œå¹¶å»ºè®®é•¿æœŸä½¿ç”¨æœ¬æœºPrometheusä»ªå™¨ã€‚</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>(4) snmp_exporter : å»ºè®®ä½¿ç”¨æ­¤å¯¼å‡ºå™¨ä»¥Prometheuså¯ä»¥æå–çš„æ ¼å¼å…¬å¼€SNMPæ•°æ®,å°½ç®¡SNMPä½¿ç”¨åˆ†å±‚æ•°æ®ç»“æ„ï¼Œè€ŒPrometheusä½¿ç”¨nç»´çŸ©é˜µï¼Œæ‰€ä»¥ä¸¤ä¸ªç³»ç»Ÿå¯ä»¥å®Œç¾åœ°æ˜ å°„è€Œæ— éœ€æ‰‹å·¥éå†æ•°æ® ;<br>é¡¹ç›®åœ°å€: <a href="https://github.com/prometheus/snmp_exporter" target="_blank" rel="noopener">https://github.com/prometheus/snmp_exporter</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç«¯å£: 9116</span></span><br><span class="line"><span class="comment"># Using : äºŒè¿›åˆ¶æ–‡ä»¶å¯ä»¥ä»Githubå‘å¸ƒé¡µé¢ä¸‹è½½ä¸éœ€è¦ç‰¹æ®Šå®‰è£…ã€‚</span></span><br><span class="line">./snmp_exporter</span><br><span class="line"><span class="comment"># http://localhost:9116/snmp?target=1.2.3.4 </span></span><br><span class="line"><span class="comment"># http://localhost:9116/snmp?module=if_mib&amp;target=1.2.3.4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Prometheus Configuration: ç›®æ ‡å’Œæ¨¡å—å¯ä»¥é€šè¿‡é‡æ–°æ ‡è®°ä½œä¸ºå‚æ•°ä¼ é€’ã€‚</span></span><br><span class="line">scrape_configs:</span><br><span class="line">  - job_name: <span class="string">'snmp'</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - 192.168.1.2  <span class="comment"># SNMP device.</span></span><br><span class="line">        - switch.local <span class="comment"># SNMP device.</span></span><br><span class="line">    metrics_path: /snmp</span><br><span class="line">    params:</span><br><span class="line">      module: [if_mib]</span><br><span class="line">    relabel_configs:</span><br><span class="line">      - source_labels: [__address__]</span><br><span class="line">        target_label: __param_target</span><br><span class="line">      - source_labels: [__param_target]</span><br><span class="line">        target_label: instance</span><br><span class="line">      - target_label: __address__</span><br><span class="line">        replacement: 127.0.0.1:9116  <span class="comment"># The SNMP exporter's real hostname:port.</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Tips : SNMP OID Tree æ„æˆè¯´æ˜, SNMPç”±OIDæ ‘æ„æˆï¼Œç”±MIBæè¿°ï¼ŒOIDå­æ ‘åœ¨æ ‘ä¸­çš„ä¸åŒä½ç½®å…·æœ‰ç›¸åŒçš„é¡ºåºã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ•°å­—æ˜¯OIDï¼Œæ‹¬å·ä¸­çš„åç§°æ˜¯MIBçš„åç§°</span></span><br><span class="line">1.3.6.1.2.1.2.2.1.1 (ifIndex)</span><br><span class="line">1.3.6.1.2.1.2.2.1.2 (ifDescr)</span><br><span class="line">1.3.6.1.2.1.31.1.1.1.10 (ifHCOutOctets)</span><br></pre></td></tr></table></figure><br>Tips: Prometheusèƒ½å¤Ÿå°†SNMPç´¢å¼•å®ä¾‹æ˜ å°„åˆ°æ ‡ç­¾ã€‚ä¾‹å¦‚ifEntryæŒ‡å®šçš„INDEX ifIndexã€‚è¿™æˆä¸ºifIndexPrometheusä¸­çš„æ ‡ç­¾ã€‚</p>
<p><br/></p>
<ul>
<li>(5) consul_exporter : è¯¥é‡‡é›†å™¨æ”¯æŒå¤–æ¥é…ç½®ä¸­å¿ƒï¼Œå°†é¢†äº‹æœåŠ¡è¿è¡ŒçŠ¶å†µå¯¼å‡ºåˆ°Prometheusã€‚<br>é¡¹ç›®åœ°å€: <a href="https://github.com/prometheus/consul_exporter" target="_blank" rel="noopener">https://github.com/prometheus/consul_exporter</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç«¯å£: 9107</span></span><br><span class="line"><span class="comment"># - Using Source</span></span><br><span class="line">make</span><br><span class="line">./consul_exporter [flags]</span><br><span class="line"><span class="comment"># - Using Docker</span></span><br><span class="line">docker pull prom/consul-exporter</span><br><span class="line">docker run -d -p 9107:9107 prom/consul-exporter --consul.server=172.17.0.1:8500</span><br><span class="line"><span class="comment"># å¦‚æœæ‚¨çš„å®¹å™¨éœ€è¦èƒ½å¤Ÿä¸ConsulæœåŠ¡å™¨æˆ–ä»£ç†è¿›è¡Œé€šä¿¡ã€‚ä½¿ç”¨å¯ä»å®¹å™¨è®¿é—®çš„IPæˆ–è®¾ç½®å‘½ä»¤çš„--dnså’Œ--dns-searché€‰é¡¹docker run å‘½ä»¤</span></span><br><span class="line">docker run -d -p 9107:9107 --dns=172.17.0.1 --dns-search=service.consul prom/consul-exporter --consul.server=consul:8500</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>(6) DCGM-Exporter : è¯¥é‡‡é›†å™¨ä¸»è¦é’ˆå¯¹äº NVIDIA GPU ç›¸å…³çš„æŒ‡æ ‡è¿›è¡Œé‡‡é›†å·¥å…·ã€‚<br>æ­¤å­˜å‚¨åº“åŒ…å«Golangç»‘å®šå’ŒDCGMå¯¼å‡ºå™¨ï¼Œç”¨äºåœ¨Kubernetesä¸­æ”¶é›†GPUé¥æµ‹æ•°æ®ã€‚é¡¹ç›®åœ°å€:<a href="https://github.com/NVIDIA/gpu-monitoring-tools#dcgm-exporter" target="_blank" rel="noopener">https://github.com/NVIDIA/gpu-monitoring-tools#dcgm-exporter</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç«¯å£: 9400</span></span><br><span class="line"><span class="comment"># Usage</span></span><br><span class="line"><span class="comment"># - Quickstartï¼šè¦åœ¨GPUèŠ‚ç‚¹ä¸Šæ”¶é›†æŒ‡æ ‡ï¼Œåªéœ€å¯åŠ¨dcgm exporterå®¹å™¨ï¼š</span></span><br><span class="line">$ docker run -d --gpus all --rm -p 9400:9400 nvcr.io/nvidia/k8s/dcgm-exporter:2.0.13-2.1.2-ubuntu18.04</span><br><span class="line">$ curl localhost:9400/metrics</span><br><span class="line"><span class="comment"># - Quickstart on Kubernetes : è€ƒè™‘ä½¿ç”¨ NVIDIA GPU Operator è€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨DCGMå¯¼å‡ºå™¨ã€‚</span></span><br><span class="line">$ helm repo add gpu-helm-charts \</span><br><span class="line">  https://nvidia.github.io/gpu-monitoring-tools/helm-charts</span><br><span class="line">$ helm repo update</span><br><span class="line">$ helm install --generate-name gpu-helm-charts/dcgm-exporter</span><br><span class="line">$ kubectl create -f https://raw.githubusercontent.com/NVIDIA/gpu-monitoring-tools/master/dcgm-exporter.yaml</span><br><span class="line">$ NAME=$(kubectl get pods -l <span class="string">"app.kubernetes.io/name=dcgm-exporter"</span> -o <span class="string">"jsonpath=&#123; .items[0].metadata.name&#125;"</span>)</span><br><span class="line">$ kubectl port-forward <span class="variable">$NAME</span> 8080:9400 &amp;</span><br><span class="line"><span class="comment"># - Building from Source</span></span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/NVIDIA/gpu-monitoring-tools.git</span><br><span class="line">$ <span class="built_in">cd</span> gpu-monitoring-tools</span><br><span class="line">$ make binary</span><br><span class="line">$ sudo make install</span><br><span class="line">$ dcgm-exporter &amp;</span><br><span class="line">$ curl localhost:9400/metrics</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>(7) mysqld_exporter : Prometheus exporter for MySQLæœåŠ¡å™¨åº¦é‡,æ”¯æŒç‰ˆæœ¬è¯´æ˜<code>MySQL &gt;= 5.6</code>å’Œ<code>MariaDB &gt;= 10.2</code>ã€‚<br>é¡¹ç›®åœ°å€: <a href="https://github.com/prometheus/mysqld_exporter" target="_blank" rel="noopener">https://github.com/prometheus/mysqld_exporter</a><br>æ³¨æ„ï¼šMySQL/MariaDB&lt;5.6å¹¶ä¸æ”¯æŒæ‰€æœ‰çš„æ”¶é›†æ–¹æ³•</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç«¯å£: 9104</span></span><br><span class="line"><span class="comment"># Required Grants</span></span><br><span class="line">CREATE USER <span class="string">'exporter'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'XXXXXXXX'</span> WITH MAX_USER_CONNECTIONS 3;</span><br><span class="line">GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO <span class="string">'exporter'</span>@<span class="string">'localhost'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using Binary</span></span><br><span class="line"><span class="built_in">export</span> DATA_SOURCE_NAME=<span class="string">'user:password@(hostname:3306)/'</span></span><br><span class="line">./mysqld_exporter &lt;flags&gt;</span><br><span class="line"><span class="comment">#  &lt;General flags&gt; å‚è€ƒåœ°å€ : https://github.com/prometheus/mysqld_exporter#general-flags</span></span><br><span class="line"><span class="comment"># Example format for flags for version &gt; 0.10.0:</span></span><br><span class="line"><span class="comment"># --collect.auto_increment.columns</span></span><br><span class="line"><span class="comment"># --no-collect.auto_increment.columns</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Using Docker</span></span><br><span class="line">docker network create my-mysql-network</span><br><span class="line">docker pull prom/mysqld-exporter</span><br><span class="line">docker run -d -p 9104:9104 </span><br><span class="line">  --network my-mysql-network  \</span><br><span class="line">  -e DATA_SOURCE_NAME=<span class="string">"user:password@(hostname:3306)/"</span> \</span><br><span class="line">  prom/mysqld-exporter</span><br></pre></td></tr></table></figure>
<p>è¡¥å……è¯´æ˜:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - mysqld_exporterå‚æ•°é…ç½®æ–‡ä»¶</span></span><br><span class="line">sudo tee /etc/mysqld_exporter.cnf<span class="string">'EOF'</span></span><br><span class="line">[client]</span><br><span class="line">user=mysql_exporter</span><br><span class="line">password=123456</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># - å°†mysqld_exporterä½œä¸ºç³»ç»ŸæœåŠ¡è¿›è¡Œå¯åŠ¨ã€‚</span></span><br><span class="line">sudo tee /usr/lib/systemd/system/mysqld_exporter.service &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=MySQL exporter Clinet</span><br><span class="line">Documentation=https://github.com/prometheus/mysqld_exporter</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">StandardError=journal</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/bin/mysqld_exporter --config.my-cnf=/etc/mysqld_exporter.cnf</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=3s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">chmod 754 /usr/lib/systemd/system/mysqld_exporter.service</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload &amp;&amp; systemctl <span class="built_in">enable</span> mysqld_exporter.service &amp;&amp; systemctl start mysqld_exporter.service &amp;&amp; systemctl status mysqld_exporter</span><br><span class="line">systemctl daemon-reload &amp;&amp; systemctl restart mysqld_exporter.service &amp;&amp; systemctl status mysqld_exporter</span><br><span class="line"></span><br><span class="line">systemctl status mysqld_exporter</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<ul>
<li>(8) memcached_exporter : è¯¥å¯¼å‡ºå™¨ä¸»è¦é’ˆå¯¹äº memcached å†…å­˜æ•°æ®åº“ã€‚<br>é¡¹ç›®åœ°å€:<a href="https://github.com/prometheus/memcached_exporter" target="_blank" rel="noopener">https://github.com/prometheus/memcached_exporter</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç«¯å£: 9150</span></span><br><span class="line"><span class="comment"># Using source</span></span><br><span class="line">make</span><br><span class="line">./memcached_exporter</span><br><span class="line"><span class="comment"># Using Docker</span></span><br><span class="line">docker run -p 9150:9150 quay.io/prometheus/memcached-exporter:latest</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>(9) influxdb_exporter : ä»0.9.0å¼€å§‹ä½¿ç”¨çš„InfluxDBæ ¼å¼æŒ‡æ ‡çš„å¯¼å‡ºå™¨ã€‚å®ƒé€šè¿‡HTTP APIæ”¶é›†åœ¨çº¿åè®®ä¸­çš„æŒ‡æ ‡ï¼Œ å¯¹å…¶è¿›è¡Œè½¬æ¢å¹¶å°†å…¶å…¬å¼€ä»¥ä¾›Prometheusä½¿ç”¨ã€‚æ­¤å¯¼å‡ºå™¨æ”¯æŒfloatï¼Œintå’Œbooleanå­—æ®µã€‚æ ‡ç­¾å°†è½¬æ¢ä¸ºPrometheusæ ‡ç­¾ã€‚<br>é»˜è®¤æƒ…å†µä¸‹å¯¼å‡ºå™¨è¿˜ä¼šç›‘å¬UDPå¥—æ¥å­—ï¼ˆç«¯å£9122ï¼‰ï¼Œåœ¨è¯¥å¥—æ¥å­—ä¸Šä½¿ç”¨/metricsç«¯ç‚¹å…¬å¼€influxDBæŒ‡æ ‡ï¼Œå¹¶åœ¨ç«¯ç‚¹ä¸Šå…¬å¼€å¯¼å‡ºç¨‹åºçš„è‡ªæˆ‘æŒ‡æ ‡<code>/metrics/exporter</code>ã€‚<br>é¡¹ç›®åœ°å€: <a href="https://github.com/prometheus/influxdb_exporter" target="_blank" rel="noopener">https://github.com/prometheus/influxdb_exporter</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç«¯å£: 9122</span></span><br><span class="line"><span class="comment"># Using</span></span><br><span class="line"><span class="comment"># influxdb_exporteræ˜¾ç¤ºä¸ºæ™®é€šçš„InfluxDBæœåŠ¡å™¨ã€‚</span></span><br><span class="line"><span class="comment"># ä¾‹å¦‚è¦ä¸Telegrafä¸€èµ·ä½¿ç”¨ï¼Œè¯·å°†ä»¥ä¸‹å†…å®¹æ”¾å…¥æ‚¨çš„ä¸­</span></span><br><span class="line">[[outputs.influxdb]]</span><br><span class="line">  urls = [<span class="string">"http://localhost:9122"</span>]</span><br><span class="line"><span class="comment"># æˆ–è€…å¦‚æœæ‚¨æƒ³ä½¿ç”¨UDPï¼š</span></span><br><span class="line">[[outputs.influxdb]]</span><br><span class="line">  urls = [<span class="string">"udp://localhost:9122"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># example</span></span><br><span class="line"><span class="comment"># é»˜è®¤æƒ…å†µä¸‹ï¼Œå…¬å¼€çš„æŒ‡æ ‡æ²¡æœ‰åŸå§‹æ—¶é—´æˆ³</span></span><br><span class="line">http_requests_total&#123;method=<span class="string">"post"</span>,code=<span class="string">"200"</span>&#125; 1027</span><br><span class="line">http_requests_total&#123;method=<span class="string">"post"</span>,code=<span class="string">"400"</span>&#125;    3</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ ‡å¿— --timestamps å°†åŸå§‹æ—¶é—´æˆ³æ·»åŠ åˆ°å…¬å¼€çš„æŒ‡æ ‡ä¸­</span></span><br><span class="line">http_requests_total&#123;method=<span class="string">"post"</span>,code=<span class="string">"200"</span>&#125; 1027 1395066363000</span><br><span class="line">http_requests_total&#123;method=<span class="string">"post"</span>,code=<span class="string">"400"</span>&#125;    3 1395066363000</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Tips : è¯·æ³¨æ„Telegrafå·²ç»æ”¯æŒé€šè¿‡HTTPé€šè¿‡HTTPè¾“å‡ºPrometheusåº¦é‡æ ‡å‡† outputs.prometheus_clientï¼Œä»è€Œé¿å…äº†ä¹Ÿå¿…é¡»è¿è¡Œinfluxdb_exporterã€‚<br>Tips : å¦‚æœå¤šæ¬¡æäº¤æˆ–å¤šæ¬¡é‡‡é›†äº†è¯¥æŒ‡æ ‡ï¼Œåˆ™åªä¼šå­˜å‚¨æœ€åä¸€ä¸ªå€¼å’Œæ—¶é—´æˆ³ã€‚</p>
<p><br/></p>
<ul>
<li>(10) graphite_exporter : Graphiteçº¯æ–‡æœ¬åè®®ä¸­å¯¼å‡ºçš„åº¦é‡æ ‡å‡†çš„å¯¼å‡ºå™¨ã€‚å®ƒé€šè¿‡TCPå’ŒUDPæ¥æ”¶æ•°æ®ï¼Œå¹¶è¿›è¡Œè½¬æ¢å¹¶å°†å…¶å…¬å¼€ä»¥ä¾›Prometheusä½¿ç”¨ã€‚æ­¤å¯¼å‡ºå™¨å¯¹äºä»ç°æœ‰Graphiteè®¾ç½®å¯¼å‡ºåº¦é‡æ ‡å‡†ä»¥åŠæ ¸å¿ƒPrometheuså¯¼å‡ºå™¨ï¼ˆä¾‹å¦‚Node Exporterï¼‰æœªæ¶µç›–çš„åº¦é‡å¾ˆæœ‰ç”¨(å³è„šæœ¬è‡ªå®šä¹‰æ”¶é›†å‚æ•°å€¼åé¦ˆ)ã€‚<br>é¡¹ç›®åœ°å€: <a href="https://github.com/prometheus/graphite_exporter" target="_blank" rel="noopener">https://github.com/prometheus/graphite_exporter</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç«¯å£: 9108 / 9109 (Tcp|Udp)</span></span><br><span class="line"><span class="comment"># Using Docker</span></span><br><span class="line">docker pull prom/graphite-exporter</span><br><span class="line">docker run -d -p 9108:9108 -p 9109:9109 -p 9109:9109/udp \</span><br><span class="line">  -v <span class="variable">$&#123;PWD&#125;</span>/graphite_mapping.conf:/tmp/graphite_mapping.conf \</span><br><span class="line">  prom/graphite-exporter --graphite.mapping-config=/tmp/graphite_mapping.confsing Docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># Usage</span></span><br><span class="line">make</span><br><span class="line">./graphite_exporter</span><br><span class="line"><span class="comment"># é…ç½®ç°æœ‰ç›‘è§†ä»¥å°†Graphiteçº¯æ–‡æœ¬æ•°æ®å‘é€åˆ°UDPæˆ–TCPä¸Šçš„ç«¯å£9109,ä½œä¸ºä¸€ä¸ªç®€å•çš„æ¼”ç¤ºï¼š</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"test_tcp 1234 <span class="variable">$(date +%s)</span>"</span> | nc localhost 9109</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"test_udp 1234 <span class="variable">$(date +%s)</span>"</span> | nc -u -w1 localhost 9109</span><br><span class="line"><span class="comment"># ä¸ºé¿å…ä½¿ç”¨æ— é™åˆ¶çš„å†…å­˜ï¼ŒæŒ‡æ ‡å°†åœ¨æœ€åä¸€æ¬¡æ¨é€åˆ°äº”åˆ†é’Ÿåè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå¯é€šè¿‡`--graphite.sample-expiry`è®¾ç½®;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»“æœéªŒè¯:</span></span><br><span class="line">http://localhost:9108/metrics</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>(11) collectd_exporter : å®ƒæ¥å—collectedçš„ç½‘ç»œæ’ä»¶å‘é€çš„collectedçš„ äºŒè¿›åˆ¶ç½‘ç»œåè®® ï¼Œ å¹¶é€šè¿‡collectedçš„write_httpæ’ä»¶å‘é€çš„HTTP POSTæ¥å—JSONæ ¼å¼çš„JSONæ ¼å¼çš„ åº¦é‡ï¼Œå¹¶å°†å…¶è½¬æ¢å¹¶å…¬å¼€ä»¥ä¾›Prometheusä½¿ç”¨ã€‚è¯¥å¯¼å‡ºå™¨å¯¹äºä»ç°æœ‰æ”¶é›†çš„è®¾ç½®ä¸­å¯¼å‡ºåº¦é‡æ ‡å‡†ä»¥åŠæ ¸å¿ƒPrometheuså¯¼å‡ºå™¨ï¼ˆå¦‚Node Exporterï¼‰æœªæ¶µç›–çš„åº¦é‡å¾ˆæœ‰ç”¨ã€‚<br>æè¿°:  <a href="https://github.com/prometheus/collectd_exporter" target="_blank" rel="noopener">https://github.com/prometheus/collectd_exporter</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç«¯å£: 9103 ã€25826(UDP)</span></span><br><span class="line"><span class="comment"># Using Docker</span></span><br><span class="line">docker pull prom/collectd-exporter</span><br><span class="line">docker run -d -p 9103:9103 -p 25826:25826/udp prom/collectd-exporter --collectd.listen-address=<span class="string">":25826"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Binary network protocol</span></span><br><span class="line">LoadPlugin network</span><br><span class="line">&lt;Plugin network&gt;</span><br><span class="line">  Server <span class="string">"prometheus.example.com"</span> <span class="string">"25826"</span></span><br><span class="line">&lt;/Plugin&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># JSON format (å€¼å¾—å­¦ä¹ )</span></span><br><span class="line">LoadPlugin write_http</span><br><span class="line">&lt;Plugin write_http&gt;</span><br><span class="line">  &lt;Node <span class="string">"collectd_exporter"</span>&gt;</span><br><span class="line">    URL <span class="string">"http://localhost:9103/collectd-post"</span></span><br><span class="line">    Format <span class="string">"JSON"</span></span><br><span class="line">    StoreRates <span class="literal">false</span></span><br><span class="line">  &lt;/Node&gt;</span><br><span class="line">&lt;/Plugin&gt;</span><br></pre></td></tr></table></figure>
<p><br/></p>
<ul>
<li>(12) haproxy_exporter : ç®€å•çš„æœåŠ¡å™¨ï¼Œå®ƒå¯ä»¥æŠ“å–HAProxyæ•°æ®å¹¶é€šè¿‡HTTPå°†å®ƒä»¬å¯¼å‡ºï¼Œä¾›Prometheusä½¿ç”¨ã€‚æ³¨æ„ï¼šè‡ªHAProxy 2.0.0èµ·ï¼Œå®˜æ–¹èµ„æºåŒ…æ‹¬Prometheuså¯¼å‡ºå™¨æ¨¡å—ï¼Œè¯¥æ¨¡å—å¯åœ¨æ„å»ºæœŸé—´é€šè¿‡å•ä¸ªæ ‡å¿—å†…ç½®åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œå¹¶æä¾›æ— å¯¼å‡ºå™¨çš„Prometheusç«¯ç‚¹ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç«¯å£: 9101</span></span><br><span class="line"><span class="comment"># Using Binary</span></span><br><span class="line">./haproxy_exporter [flags]</span><br><span class="line"><span class="comment"># Using Socket : ä½œä¸ºlocalhost HTTPçš„æ›¿ä»£æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨statså¥—æ¥å­—ã€‚åœ¨HAProxyä¸­å¯ç”¨statså¥—æ¥å­—ï¼Œä¾‹å¦‚ï¼š</span></span><br><span class="line">stats socket /run/haproxy/admin.sock mode 660 level admin</span><br><span class="line">haproxy_exporter --haproxy.scrape-uri=unix:/run/haproxy/admin.sock</span><br><span class="line"><span class="comment"># Using Docker</span></span><br><span class="line">docker run -p 9101:9101 quay.io/prometheus/haproxy-exporter:v0.12.0 --haproxy.scrape-uri=<span class="string">"http://user:pass@haproxy.example.com/haproxy?stats;csv"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Usage : HTTPç»Ÿè®¡URL</span></span><br><span class="line">haproxy_exporter --haproxy.scrape-uri=<span class="string">"http://localhost:5000/baz?stats;csv"</span></span><br><span class="line">haproxy_exporter --haproxy.scrape-uri=<span class="string">"http://haproxy.example.com/haproxy?stats;csv"</span></span><br><span class="line">haproxy_exporter --haproxy.scrape-uri=<span class="string">"http://user:pass@haproxy.example.com/haproxy?stats;csv"</span>  <span class="comment"># å¸¦æœ‰è®¤è¯</span></span><br><span class="line">haproxy_exporter --no-haproxy.ssl-verify --haproxy.scrape-uri=<span class="string">"https://haproxy.example.com/haproxy?stats;csv"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>(13) jmx_exporter : è¯¥æ”¶é›†å™¨å¯é…ç½®åœ°æŠ“å–å’Œå…¬å¼€JMXç›®æ ‡çš„mBean, è¯¥å¯¼å‡ºç¨‹åºæ—¨åœ¨ä½œä¸ºJavaä»£ç†è¿è¡Œï¼Œå…¬å¼€HTTPæœåŠ¡å™¨å¹¶æä¾›æœ¬åœ°JVMçš„åº¦é‡ã€‚å®ƒä¹Ÿå¯ä»¥ä½œä¸ºç‹¬ç«‹çš„HTTPæœåŠ¡å™¨è¿è¡Œï¼Œå¹¶åˆ®æ“¦è¿œç¨‹JMXç›®æ ‡ï¼Œä½†è¿™æœ‰è®¸å¤šç¼ºç‚¹ï¼Œä¾‹å¦‚éš¾ä»¥é…ç½®å¹¶ä¸”æ— æ³•å…¬å¼€è¿‡ç¨‹æŒ‡æ ‡ï¼ˆä¾‹å¦‚ï¼Œå†…å­˜å’ŒCPUä½¿ç”¨ç‡ï¼‰ã€‚å› æ­¤ï¼Œå¼ºçƒˆå»ºè®®å°†å¯¼å‡ºç¨‹åºä½œä¸ºJavaä»£ç†è¿è¡Œã€‚<br>é¡¹ç›®åœ°å€: <a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">https://github.com/prometheus/jmx_exporter</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç«¯å£: 8080</span></span><br><span class="line">java -javaagent:./jmx_prometheus_javaagent-0.15.0.jar=8080:config.yaml -jar yourJar.jar</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using : To run as a javaagent download the jar and run:</span></span><br><span class="line">java -javaagent:./jmx_prometheus_javaagent-0.15.0.jar=8080:config.yaml -jar yourJar.jar</span><br><span class="line"><span class="comment"># Configuration</span></span><br><span class="line">---</span><br><span class="line">startDelaySeconds: 0</span><br><span class="line">hostPort: 127.0.0.1:1234</span><br><span class="line">username: </span><br><span class="line">password: </span><br><span class="line">jmxUrl: service:jmx:rmi:///jndi/rmi://127.0.0.1:1234/jmxrmi</span><br><span class="line">ssl: <span class="literal">false</span></span><br><span class="line">lowercaseOutputName: <span class="literal">false</span></span><br><span class="line">lowercaseOutputLabelNames: <span class="literal">false</span></span><br><span class="line">whitelistObjectNames: [<span class="string">"org.apache.cassandra.metrics:*"</span>]</span><br><span class="line">blacklistObjectNames: [<span class="string">"org.apache.cassandra.metrics:type=ColumnFamily,*"</span>]</span><br><span class="line">rules:</span><br><span class="line">  - pattern: <span class="string">'org.apache.cassandra.metrics&lt;type=(\w+), name=(\w+)&gt;&lt;&gt;Value: (\d+)'</span></span><br><span class="line">    name: cassandra_<span class="variable">$1_</span><span class="variable">$2</span></span><br><span class="line">    value: <span class="variable">$3</span></span><br><span class="line">    valueFactor: 0.001</span><br><span class="line">    labels: &#123;&#125;</span><br><span class="line">    <span class="built_in">help</span>: <span class="string">"Cassandra metric <span class="variable">$1</span> <span class="variable">$2</span>"</span></span><br><span class="line">    cache: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: GAUGE</span><br><span class="line">    attrNameSnakeCase: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Test</span></span><br><span class="line">curl http://localhost:8080/metrics</span><br><span class="line"></span><br><span class="line"><span class="comment"># run_sample_httpserver.sh</span></span><br><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"><span class="comment"># Script to run a java application for testing jmx4prometheus.</span></span><br><span class="line">version=$(sed -n -e <span class="string">'s#.*&lt;version&gt;\(.*-SNAPSHOT\)&lt;/version&gt;#\1#p'</span> pom.xml)</span><br><span class="line"><span class="comment"># Note: You can use localhost:5556 instead of 5556 for configuring socket hostname.</span></span><br><span class="line">java -Dcom.sun.management.jmxremote.ssl=<span class="literal">false</span> -Dcom.sun.management.jmxremote.authenticate=<span class="literal">false</span> -Dcom.sun.management.jmxremote.port=5555 -jar jmx_prometheus_httpserver/target/jmx_prometheus_httpserver-<span class="variable">$&#123;version&#125;</span>-jar-with-dependencies.jar 5556 example_configs/httpserver_sample_config.yml</span><br></pre></td></tr></table></figure>
<p><br></p>
<ul>
<li>(13) exporter-toolkit : Prometheuså‡ºå£å•†å·¥å…·åŒ…(Goåº“), è¯¥å­˜å‚¨åº“æ—¨åœ¨ä¸client_golangå­˜å‚¨åº“ç»“åˆä½¿ç”¨ ã€‚å¦‚æœè¦æ£€æµ‹ç°æœ‰çš„Goåº”ç”¨ç¨‹åºï¼Œåˆ™ client_golangæ˜¯æ‚¨è¦æŸ¥æ‰¾çš„å­˜å‚¨åº“ã€‚</li>
</ul>
<p>é¡¹ç›®åœ°å€: <a href="https://github.com/prometheus/exporter-toolkit" target="_blank" rel="noopener">https://github.com/prometheus/exporter-toolkit</a></p>
<p><br></p>
<ul>
<li>(14) redis_exporter : Prometheus Redis æŒ‡æ ‡é‡‡é›†å™¨æ”¯æŒç‰ˆæœ¬<code>Redis 2.x, 3.x, 4.x, 5.x, and 6.x</code></li>
</ul>
<p>é¡¹ç›®åœ°å€: <a href="https://github.com/oliver006/redis_exporter/" target="_blank" rel="noopener">https://github.com/oliver006/redis_exporter/</a><br>å‘½ä»¤è¡Œå‚æ•°å‚è€ƒ: <a href="https://github.com/oliver006/redis_exporter/#command-line-flags" target="_blank" rel="noopener">https://github.com/oliver006/redis_exporter/#command-line-flags</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Build &amp;&amp; Run Binary</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/oliver006/redis_exporter.git</span><br><span class="line"><span class="built_in">cd</span> redis_exporter</span><br><span class="line">go build .</span><br><span class="line">./redis_exporter --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run Docker</span></span><br><span class="line">docker run -d --name redis_exporter -p 9121:9121 -e REDIS_ADDR=<span class="string">"redis://192.168.12.1doc85:6379"</span>  -e REDIS_PASSWORD=<span class="string">"weiyigeek.top"</span> oliver006/redis_exporter:alpine</span><br><span class="line">docker run -d --name redis_exporter --network host -e REDIS_ADDR=<span class="string">"redis://192.168.12.1doc85:6379"</span>  -e REDIS_PASSWORD=<span class="string">"weiyigeek.top"</span> oliver006/redis_exporter</span><br><span class="line"></span><br><span class="line"><span class="comment"># Kubernetes éƒ¨ç½²é…ç½®ç¤ºä¾‹</span></span><br><span class="line"><span class="comment"># k8s-redis-and-exporter-deployment.yaml</span></span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:</span><br><span class="line">  name: redis</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  namespace: redis</span><br><span class="line">  name: redis</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: redis</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      annotations:</span><br><span class="line">        prometheus.io/scrape: <span class="string">"true"</span></span><br><span class="line">        prometheus.io/port: <span class="string">"9121"</span></span><br><span class="line">      labels:</span><br><span class="line">        app: redis</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: redis</span><br><span class="line">        image: redis:4</span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 100m</span><br><span class="line">            memory: 100Mi</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 6379</span><br><span class="line">      - name: redis-exporter</span><br><span class="line">        image: oliver006/redis_exporter:latest</span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 100m</span><br><span class="line">            memory: 100Mi</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 9121</span><br></pre></td></tr></table></figure>
<p>Configuration &amp;&amp; é…ç½®:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸºæœ¬æ„å‹</span></span><br><span class="line">scrape_configs:</span><br><span class="line">  - job_name: redis_exporter</span><br><span class="line">    static_configs:</span><br><span class="line">    - targets: [<span class="string">'localhost:9121'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®åˆ®å¤šä¸ªRedisä¸»æœº</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨å‘½ä»¤è¡Œæ ‡å¿—redis.addr=è¿è¡Œå¯¼å‡ºç¨‹åºï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šåœ¨æ¯æ¬¡åˆ®å–/metricsç«¯ç‚¹æ—¶éƒ½å°è¯•è®¿é—®æœ¬åœ°å®ä¾‹ã€‚</span></span><br><span class="line">scrape_configs:</span><br><span class="line">  - job_name: <span class="string">'redis_exporter_targets'</span></span><br><span class="line">    file_sd_configs:</span><br><span class="line">      - files:</span><br><span class="line">        - targets-redis-instances.yml</span><br><span class="line">    metrics_path: /scrape</span><br><span class="line">    relabel_configs:</span><br><span class="line">      - source_labels: [__address__]</span><br><span class="line">        target_label: __param_target</span><br><span class="line">      - source_labels: [__param_target]</span><br><span class="line">        target_label: instance</span><br><span class="line">      - target_label: __address__</span><br><span class="line">        replacement: &lt;&lt;REDIS-EXPORTER-HOSTNAME&gt;&gt;:9121</span><br><span class="line"></span><br><span class="line">  <span class="comment">## config for scraping the exporter itself</span></span><br><span class="line">  - job_name: <span class="string">'redis_exporter'</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - &lt;&lt;REDIS-EXPORTER-HOSTNAME&gt;&gt;:9121</span><br><span class="line"></span><br><span class="line"><span class="comment"># targets-redis-instances.yml</span></span><br><span class="line">- targets: [ <span class="string">"redis://redis-host-01:6379"</span>, <span class="string">"redis://redis-host-02:6379"</span> ]</span><br><span class="line">  <span class="string">"labels"</span>: &#123; <span class="string">'env'</span>: <span class="string">'prod'</span> &#125;</span><br></pre></td></tr></table></figure></p>
<p>è¡¥å……è¯´æ˜:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /usr/lib/systemd/system/redis_exporter.service &lt;&lt; EOF</span><br><span class="line">[Unit]</span><br><span class="line">Description=redis_exporter</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/redis_exporter-v1.20.0.linux-amd64/redis_exporter -redis.addr=IP:6379  -redis.password=passwd </span><br><span class="line">Restart=on-failure</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">chmod 754 /usr/lib/systemd/system/redis_exporter.service</span><br><span class="line">systemctl daemon-reload &amp;&amp; systemctl <span class="built_in">enable</span> redis_exporter .service &amp;&amp; systemctl start redis_exporter .service &amp;&amp; systemctl status redis_exporter </span><br><span class="line">systemctl daemon-reload &amp;&amp; systemctl restart redis_exporter .service &amp;&amp; systemctl status redis_exporter </span><br><span class="line">systemctl status redis_exporter</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="Alertmanager"><a href="#Alertmanager" class="headerlink" title="Alertmanager"></a>Alertmanager</h3><p>æè¿°: Alertmanagerå¤„ç†å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼ˆå¦‚PrometheusæœåŠ¡å™¨ï¼‰å‘é€çš„è­¦æŠ¥ã€‚å®ƒè´Ÿè´£é‡å¤æ•°æ®æ¶ˆé™¤ã€åˆ†ç»„ï¼Œå¹¶å°†å®ƒä»¬è·¯ç”±åˆ°æ­£ç¡®çš„æ¥æ”¶å™¨é›†æˆï¼Œå¦‚ç”µå­é‚®ä»¶ã€PagerDutyæˆ–OpsGenie,åŒæ—¶å®ƒè¿˜è´Ÿè´£æ²‰é»˜å’ŒæŠ‘åˆ¶è­¦æŠ¥ã€‚</p>
<p>é¡¹ç›®åœ°å€: <a href="https://github.com/prometheus/alertmanager" target="_blank" rel="noopener">https://github.com/prometheus/alertmanager</a><br>æ–‡æ¡£å¸®åŠ©: <a href="http://prometheus.io/docs/alerting/alertmanager/" target="_blank" rel="noopener">http://prometheus.io/docs/alerting/alertmanager/</a></p>
<p><br/></p>
<figure class="image-box">
                <a rel=2.Prometheusç›‘æ§å…¥é—¨ä¹‹ç›‘æ§é…ç½®è¯´æ˜ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210520100107.png" target="_blank" title="WeiyiGeek.Alertmanager-ç»„ä»¶æ¶æ„" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210520100107.png" alt="WeiyiGeek.Alertmanager-ç»„ä»¶æ¶æ„" title="" class=""></a>
                <p>WeiyiGeek.Alertmanager-ç»„ä»¶æ¶æ„</p>
            </figure>
<p><br/></p>
<p><strong>æ ‡ç­¾ åœ¨ Alertmanager ä¸»è¦å…³é”®ä½œç”¨:</strong></p>
<ul>
<li>1) é™å™ª: å‘é€æ›´é«˜çº§çš„å‘Šè­¦ä»è€Œå¿½ç•¥æŸäº›å‘Šè­¦ã€‚</li>
<li>2) é™éŸ³: çŸ¥é“æŸä¸ªå‘Šè­¦å¹¶ä¸”æ­£åœ¨å¤„ç†ï¼Œæ— éœ€å†æ¬¡æŠ¥è­¦ï¼Œä¾‹å¦‚åœ¨<code>Alertmanager</code>ä¸­è®¾ç½®<code>Silences</code>é™é»˜ã€‚</li>
<li>3) è·¯ç”±: ä½¿ç”¨å¤šä¸ªè·¯ç”±æ ‘ï¼Œå°†å‘Šè­¦é€šè¿‡å„ç§æ–¹å¼è¿›è¡Œå‘é€ã€‚</li>
<li>4) åˆ†ç»„: ä½¿å¾—æŸä¸€ç‰¹å¾çš„æ ‡ç­¾å®ä¾‹å‘é€ä¸€ä¸ªé€šçŸ¥ã€‚</li>
<li>5) æŠ‘åˆ¶é‡å¤: å¦‚æœå·²ç»å‘é€äº†è­¦å‘Šå¯ä»¥è®¾ç½®æŠ¥è­¦é—´éš”æ—¶é—´ä»¥è¾¾åˆ°æŠ‘åˆ¶é‡å¤è­¦å‘Šã€‚</li>
<li>6) é€šçŸ¥: é€šè¿‡æ¨¡æ¿æˆ–è€…é‚®ä»¶ã€Webhookã€ä¼ä¸šå¾®ä¿¡è¿›è¡Œå‘é€é€šçŸ¥ã€‚</li>
</ul>
<p><br/></p>
<p><strong>ç®€å•æµç¨‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç«¯å£: 9093</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install</span></span><br><span class="line"><span class="comment"># - Docker images</span></span><br><span class="line">$ docker run --name alertmanager -d -p 127.0.0.1:9093:9093 quay.io/prometheus/alertmanager</span><br><span class="line"><span class="comment"># - Compiling the binary</span></span><br><span class="line">$ mkdir -p <span class="variable">$GOPATH</span>/src/github.com/prometheus</span><br><span class="line">$ <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/prometheus</span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/prometheus/alertmanager.git</span><br><span class="line">$ <span class="built_in">cd</span> alertmanager</span><br><span class="line">$ make build</span><br><span class="line">$ ./alertmanager --config.file=&lt;your_file&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Usage</span></span><br><span class="line">usage: alertmanager [&lt;flags&gt;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (6) è¡¥å……ç³»ç»ŸæœåŠ¡è¿›è¡Œå¯åŠ¨alertmanager</span></span><br><span class="line">sudo tee /usr/lib/systemd/system/alertmanager.service &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Prometheus Alertmanager Server Systemd</span><br><span class="line">Documentation=https://prometheus.io</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">StandardError=journal</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/alertmanager/alertmanager --config.file=/usr/<span class="built_in">local</span>/alertmanager/alertmanager.yml --web.listen-address=:9093 --storage.path=/monitor/alertmanager/data</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=3s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload &amp;&amp; systemctl restart alertmanager.service</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>å¯åŠ¨å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 nobody    7:47 /bin/alertmanager --config.file=/etc/alertmanager.yaml --storage.path=/alertmanager</span></span><br><span class="line">Flags:</span><br><span class="line">--config.file=<span class="string">"alertmanager.yml"</span>  Alertmanager configuration file name.</span><br><span class="line">--storage.path=<span class="string">"data/"</span>     Base path <span class="keyword">for</span> data storage.</span><br><span class="line">--data.retention=120h      How long to keep data <span class="keyword">for</span>.</span><br><span class="line">--alerts.gc-interval=30m   Interval between alert GC.</span><br><span class="line">--web.external-url=WEB.EXTERNAL-URL The URL under <span class="built_in">which</span> Alertmanager is externally reachable (<span class="keyword">for</span> example, <span class="keyword">if</span> Alertmanager is served via a reverse proxy). Used <span class="keyword">for</span> generating relative and</span><br><span class="line">                            absolute links back to Alertmanager itself. If the URL has a path portion, it will be used to prefix all HTTP endpoints served by Alertmanager. If omitted,</span><br><span class="line">                            relevant URL components will be derived automatically.</span><br><span class="line">--web.route-prefix=WEB.ROUTE-PREFIX  Prefix <span class="keyword">for</span> the internal routes of web endpoints. Defaults to path of --web.external-url.</span><br><span class="line">--web.listen-address=<span class="string">":9093"</span>  Address to listen on <span class="keyword">for</span> the web interface and API.</span><br><span class="line">--web.get-concurrency=0    Maximum number of GET requests processed concurrently. If negative or zero, the <span class="built_in">limit</span> is GOMAXPROC or 8, whichever is larger.</span><br><span class="line">--web.timeout=0            Timeout <span class="keyword">for</span> HTTP requests. If negative or zero, no timeout is <span class="built_in">set</span>.</span><br><span class="line">--cluster.listen-address=<span class="string">"0.0.0.0:9094"</span>  Listen address <span class="keyword">for</span> cluster. Set to empty string to <span class="built_in">disable</span> HA mode.</span><br><span class="line">--cluster.advertise-address=CLUSTER.ADVERTISE-ADDRESS Explicit address to advertise <span class="keyword">in</span> cluster.</span><br><span class="line">--cluster.peer=CLUSTER.PEER ... Initial peers (may be repeated).</span><br><span class="line">--cluster.peer-timeout=15s Time to <span class="built_in">wait</span> between peers to send notifications.</span><br><span class="line">--cluster.gossip-interval=200ms Interval between sending gossip messages. By lowering this value (more frequent) gossip messages are propagated across the cluster more quickly at the expenseof increased bandwidth.</span><br><span class="line">--cluster.pushpull-interval=1m0s Interval <span class="keyword">for</span> gossip state syncs. Setting this interval lower (more frequent) will increase convergence speeds across larger clusters at the expense of ncreased bandwidth usage.</span><br><span class="line">--cluster.tcp-timeout=10s  Timeout <span class="keyword">for</span> establishing a stream connection with a remote node <span class="keyword">for</span> a full state sync, and <span class="keyword">for</span> stream <span class="built_in">read</span> and write operations.</span><br><span class="line">--cluster.probe-timeout=500ms Timeout to <span class="built_in">wait</span> <span class="keyword">for</span> an ack from a probed node before assuming it is unhealthy. This should be <span class="built_in">set</span> to 99-percentile of RTT (round-trip time) on your network.</span><br><span class="line">--cluster.probe-interval=1s Interval between random node probes. Setting this lower (more frequent) will cause the cluster to detect failed nodes more quickly at the expense of increased bandwidth usage.</span><br><span class="line">--cluster.settle-timeout=1m0s Maximum time to <span class="built_in">wait</span> <span class="keyword">for</span> cluster connections to settle before evaluating notifications.</span><br><span class="line">--cluster.reconnect-interval=10s Interval between attempting to reconnect to lost peers.</span><br><span class="line">--cluster.reconnect-timeout=6h0m0s Length of time to attempt to reconnect to a lost peer.</span><br><span class="line">--log.level=info           Only <span class="built_in">log</span> messages with the given severity or above. One of: [debug, info, warn, error]</span><br><span class="line">--log.format=logfmt        Output format of <span class="built_in">log</span> messages. One of: [logfmt, json]</span><br><span class="line">--version                  Show application version.</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>Tips ï¼šamtoolæ˜¯ç”¨äºä¸Alertmanager APIäº¤äº’çš„cliå·¥å…·ï¼Œå®ƒä¸Alertmanagerçš„æ‰€æœ‰ç‰ˆæœ¬æ†ç»‘åœ¨ä¸€èµ·ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.Install</span></span><br><span class="line">go get github.com/prometheus/alertmanager/cmd/amtool</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.Examples</span></span><br><span class="line"><span class="comment"># - æŸ¥çœ‹æ‰€æœ‰å½“å‰è§¦å‘çš„è­¦æŠ¥ï¼š</span></span><br><span class="line">$ amtool alert</span><br><span class="line">  Alertname        Starts At                Summary</span><br><span class="line">  Test_Alert       2017-08-02 18:30:18 UTC  This is a testing alert!</span><br><span class="line">  Test_Alert       2017-08-02 18:30:18 UTC  This is a testing alert!</span><br><span class="line">  Check_Foo_Fails  2017-08-02 18:30:18 UTC  This is a testing alert!</span><br><span class="line">  Check_Foo_Fails  2017-08-02 18:30:18 UTC  This is a testing alert!</span><br><span class="line"></span><br><span class="line"><span class="comment"># - é€šè¿‡æ‰©å±•è¾“å‡ºæŸ¥çœ‹æ‰€æœ‰å½“å‰è§¦å‘çš„è­¦æŠ¥ï¼š</span></span><br><span class="line">amtool -o extended alert</span><br><span class="line">  Labels                                        Annotations                                                    Starts At                Ends At                  Generator URL</span><br><span class="line">  alertname=<span class="string">"Test_Alert"</span> instance=<span class="string">"node0"</span>       link=<span class="string">"https://example.com"</span> summary=<span class="string">"This is a testing alert!"</span>  2017-08-02 18:31:24 UTC  0001-01-01 00:00:00 UTC  http://my.testing.script.local</span><br><span class="line"></span><br><span class="line"><span class="comment"># - ä½¿ç”¨Alertmanageræä¾›çš„ä¸°å¯ŒæŸ¥è¯¢è¯­æ³•ï¼š</span></span><br><span class="line">$ amtool -o extended alert query alertname=<span class="string">"Test_Alert"</span></span><br><span class="line">$ amtool -o extended alert query alertname=~<span class="string">"Test.*"</span> instance=~<span class="string">".+1"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - æš‚åœè­¦æŠ¥(Silence an alert)ä¸æŸ¥çœ‹é™éŸ³çš„è­¦æŠ¥</span></span><br><span class="line">$ amtool silence add alertname=<span class="string">"Test_Alert"</span> instance=~<span class="string">".+0"</span></span><br><span class="line">$ amtool silence query</span><br><span class="line">  ID                                    Matchers              Ends At                  Created By  Comment</span><br><span class="line">  b3ede22e-ca14-4aa0-932c-ca2f3445f926  alertname=Test_Alert  2017-08-02 19:54:50 UTC  kellel</span><br><span class="line">$ amtool silence query</span><br><span class="line"></span><br><span class="line"><span class="comment"># - å¯åŠ¨è­¦æŠ¥(ä¹Ÿå¯ä»¥è¿›è¡ŒåŒ¹é…å¯åŠ¨)æˆ–è€…ç»ˆæ­¢æ‰€æœ‰æ²‰é»˜</span></span><br><span class="line">$ amtool silence expire b3ede22e-ca14-4aa0-932c-ca2f3445f926</span><br><span class="line">$ amtool silence expire $(amtool silence -q query instance=~<span class="string">".+0"</span>)</span><br><span class="line">$ amtool silence expire $(amtool silence query -q)</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="Pushgateway"><a href="#Pushgateway" class="headerlink" title="Pushgateway"></a>Pushgateway</h3><p>æè¿°: PushGateway ä½œä¸º Prometheus ç”Ÿæ€ä¸­çš„ä¸€ä¸ªé‡è¦ä¸€å‘˜ï¼Œå®ƒå…è®¸ä»»ä½•å®¢æˆ·ç«¯å‘å…¶ Push ç¬¦åˆè§„èŒƒçš„è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡ï¼Œå¹¶ä¸”å¯ä»¥å…è®¸ä¸´æ—¶ä»»åŠ¡å’Œæ‰¹å¤„ç†ä½œä¸šå‘ Prometheus å…¬å¼€å…¶æŒ‡æ ‡ï¼Œå†ç»“åˆ Prometheus ç»Ÿä¸€æ”¶é›†ç›‘æ§ã€‚ä¾‹å¦‚è¢«é‡‡é›†çš„ä¸»æœºç”±äºç½‘ç»œç¯å¢ƒçš„é™åˆ¶æ— æ³•ç›´æ¥åˆ°è¾¾Prometheus server,å› æ­¤å¯ä»¥å°†å…¶æŒ‡æ ‡æ¨é€åˆ° Pushgateway ,ç„¶ååœ¨ç”± Pushgateway å°†è¿™äº›æŒ‡æ ‡å…¬å¼€ç»™ Prometheusï¼Œå…¶æ¬¡æ˜¯åœ¨ç›‘æ§ä¸šåŠ¡æ•°æ®çš„æ—¶å€™éœ€è¦å°†ä¸åŒæ•°æ®æ±‡æ€», ç”± Prometheus ç»Ÿä¸€æ”¶é›†ã€‚<br>é¡¹ç›®åœ°å€: <a href="https://github.com/prometheus/pushgateway" target="_blank" rel="noopener">https://github.com/prometheus/pushgateway</a></p>
<p><br></p>
<p><strong>åº”ç”¨åœºæ™¯:</strong> Prometheus é‡‡ç”¨å®šæ—¶ Pull æ¨¡å¼ï¼Œå¯èƒ½ç”±äºå­ç½‘ç»œæˆ–è€…é˜²ç«å¢™çš„åŸå› ï¼Œä¸èƒ½ç›´æ¥æ‹‰å–å„ä¸ª Target çš„æŒ‡æ ‡æ•°æ®ï¼Œæ­¤æ—¶å¯ä»¥é‡‡ç”¨å„ä¸ª Target å¾€ PushGateway ä¸Š Push æ•°æ®ï¼Œç„¶å Prometheus å» PushGateway ä¸Šå®šæ—¶ pullã€‚å…¶æ¬¡åœ¨ç›‘æ§å„ä¸ªä¸šåŠ¡æ•°æ®æ—¶ï¼Œéœ€è¦å°†å„ä¸ªä¸åŒçš„ä¸šåŠ¡æ•°æ®è¿›è¡Œç»Ÿä¸€æ±‡æ€»ï¼Œæ­¤æ—¶ä¹Ÿå¯ä»¥é‡‡ç”¨ PushGateway æ¥ç»Ÿä¸€æ”¶é›†ï¼Œç„¶å Prometheus æ¥ç»Ÿä¸€æ‹‰å–ã€‚</p>
<p><br></p>
<p><strong>Pushgateway æ¶æ„è¯´æ˜:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Batch Job - <span class="string">"Single push before exiting"</span> -&gt; Pushgateway &lt;-  <span class="string">"Regular Scrapes - Prometheus</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>Pushgateway å®‰è£…é…ç½®è¯´æ˜:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç«¯å£ï¼š9091</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Using Docker</span></span><br><span class="line">docker pull prom/pushgateway</span><br><span class="line">docker run -d -p 9091:9091 prom/pushgateway</span><br><span class="line"></span><br><span class="line"><span class="comment">#  è¡¥å……ç³»ç»ŸæœåŠ¡è¿›è¡Œå¯åŠ¨alertmanager</span></span><br><span class="line">sudo tee /usr/lib/systemd/system/pushgateway.service &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Prometheus pushgateway Server Systemd</span><br><span class="line">Documentation=https://prometheus.io</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">StandardError=journal</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/pushgateway/pushgateway --web.listen-address=:9091</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=3s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload &amp;&amp; systemctl restart pushgateway.service</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><strong>Pushgateway è¡¥å……è¯´æ˜:</strong></p>
<ul>
<li>1) æŒ‡æ ‡æ•°æ®ä¸Šä¼ : é€šè¿‡æ”¯æŒPrometheusçš„å¤šç§ç¼–ç¨‹è¯­è¨€æ¨¡å—è¿›è¡Œå®ç°ï¼Œä¾‹å¦‚Pythonä¸­Prometheus_clientä¸­çš„<code>push_to_gateway / pushadd_to_gateway / delete_from_gateway</code>ç­‰å‡½æ•°ï¼Œæˆ–è€…åˆ©ç”¨httpè¯·æ±‚è¿›è¡Œä¸Šä¼ ä¾‹å¦‚linuxä¸­curl(åé¢å®æˆ˜éƒ¨åˆ†ä¼šè¿›è¡Œè®²è§£)ã€‚</li>
<li>2) æ¡¥æ¥: å› ä¸ºæµ‹æ§å’Œå±•ç¤ºæ˜¯ç‹¬ç«‹çš„ä¸¤ä»¶äº‹ï¼Œä¾‹å¦‚å¯ä»¥é€šè¿‡Goã€pythonã€Javaå®¢æˆ·ç«¯ä¸­Graphiteæ¡¥æ¥å®ç°å°†æŒ‡æ ‡è¾“å‡ºæ•°æ®è½¬åŒ–ä¸ºå…¶ä»–éPrometheusæ ¼å¼çš„æ•°æ®ï¼Œä»è€Œä½¿å¾—å°†æŒ‡æ ‡è½¬æ¢ä¸ºGraphiteèƒ½å¤Ÿè§£è¯»çš„æ ¼å¼æ•°æ®è¾“å‡ºã€‚</li>
<li>3) è§£æå™¨: åœ¨å®¢æˆ·ç«¯åº“æ³¨å†Œè¡¨ä¸­è®¿é—®åˆ°æŒ‡æ ‡è¾“å‡ºå†…å®¹ï¼Œä»¥å°†Prometheusçš„æŒ‡æ ‡æ•°æ®è¾“å…¥åˆ°å…¶ä»–ç›‘æ§ç³»ç»Ÿæˆ–è€…æœ¬åœ°å·¥å…·ä¸­ï¼Œä¾‹å¦‚DataDogã€InfluxDBã€Sensuå’ŒMetricbeatè¯¥ç±»ç³»ç»Ÿç”±ç›¸åº”çš„ç»„ä»¶å¯ä»¥è§£æè¿™ç±»è„šæœ¬ã€‚</li>
<li>4) æŒ‡æ ‡ç±»å‹: æˆ‘ä»¬å¯ä»¥åœ¨Prometheusé‡Œçš„<code>/metrics</code>çœ‹åˆ°æŒ‡æ ‡çš„HELP(å¯¹æŒ‡æ ‡å«ä¹‰çš„æè¿°)å’ŒTYPE(è¯¥æŒ‡æ ‡çš„æ ¼å¼)ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HELP promhttp_metric_handler_requests_in_flight Current number of scrapes being served.</span></span><br><span class="line"><span class="comment"># TYPE promhttp_metric_handler_requests_in_flight gauge</span></span><br><span class="line">promhttp_metric_handler_requests_in_flight 1</span><br></pre></td></tr></table></figure></li>
<li>5) æŒ‡æ ‡æ ‡ç­¾: ä¸ºè¯¥æŒ‡æ ‡æ‰“ä¸Šæ ‡ç­¾å¹¶ä¸”æ ‡ç­¾çš„æ’åºå¹¶ä¸é‡è¦ï¼Œä½†æ˜¯å‰ç¼€æŒ‡æ ‡ç›¸åŒçš„æŒ‡æ ‡å»ºè®®æ”¾åœ¨ä¸€å¤„ä¹‹ä¸­ï¼Œå¯ç¡®ä¿Prometheusæœ€ä½³çš„å†™å…¥æ€§èƒ½ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">prometheus_test_seconds_sum&#123;label=<span class="string">"bar"</span>,baz=<span class="string">"qu"</span>&#125; 0</span><br><span class="line">prometheus_test_seconds_count&#123;label=<span class="string">"bar"</span>,baz=<span class="string">"quu"</span>&#125; 1</span><br><span class="line">prometheus_test_seconds_sum&#123;label=<span class="string">"flar"</span>,baz=<span class="string">"qu"</span>&#125; 2</span><br><span class="line">prometheus_test_seconds_count&#123;label=<span class="string">"flar"</span>,baz=<span class="string">"quu"</span>&#125; 3</span><br></pre></td></tr></table></figure></li>
<li>6) ç¼–ç æ ¼å¼: é»˜è®¤çš„ä¸Šä¼ æŒ‡æ ‡ä¸­çš„HELPå’Œæ ‡ç­¾å€¼å‡å®éªŒå®Œæ•´çš„UTF-8ç¼–ç ï¼Œå› æ­¤éœ€è¦åæ–œæ æ¥è¿›è¡Œè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œ<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HELP : ä¸‹å¤„æ˜¯æ¢è¡Œå’Œåæ–œæ </span></span><br><span class="line">HELP escaping Test newline \\n and backslash \\ escaped</span><br><span class="line">TYPE escaping gauge</span><br><span class="line"><span class="comment"># LABLE : ä¸‹å¤„æ˜¯æ¢è¡Œç¬¦ã€åæ–œæ å’ŒåŒå¼•å·</span></span><br><span class="line">escaping&#123;foo=<span class="string">"newline \n backslash \\ double quote \" "</span>&#125; 1</span><br></pre></td></tr></table></figure></li>
<li>7) æ—¶é—´æˆ³: åœ¨ä¸Šä¼ çš„æŒ‡æ ‡æ•°æ®ä¸­å¯ä»¥æ ‡æ˜æ—¶é—´æˆ³(ä»¥æ¯«ç§’ä¸ºå•ä½çš„æ•´æ•°å€¼ï¼Œå®ƒè‡ªUNIXçºªå…ƒä¹‹åç®—èµ·)ï¼Œä½†æ˜¯é€šå¸¸ä¸è¦ä½¿ç”¨å±•ç¤ºæ ¼å¼çš„æ—¶é—´æˆ³ï¼Œè€Œæ˜¯é€šè¿‡eæŒ‡æ•°æ¥è¡¨ç¤ºã€‚</li>
<li>8) æŒ‡æ ‡è§£ææ£€æŸ¥: æˆ‘ä»¬å¯ä»¥é‡‡ç”¨promtoolè¿›è¡Œæ£€æµ‹æˆ‘ä»¬ä¸Šä¼ åˆ°pushgatewayä¸­çš„æŒ‡æ ‡æ•°æ®çš„æ ¼å¼æ˜¯å¦æœ‰æ•ˆï¼Œæ‰€ä»¥é€šè¿‡ä¸Šä¼ çš„æŒ‡æ ‡å¯ä»¥è¢«æŠ“å–ä½†å¹¶ä¸æ„å‘³è¯¥æŒ‡æ ‡ç¬¦åˆæ ¼å¼è¦æ±‚ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ curl -s http://10.10.107.249:9091/metrics | promtool check metrics</span><br><span class="line">test_metric counter metrics should have <span class="string">"_total"</span> suffix</span><br><span class="line">test_metric no <span class="built_in">help</span> text</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<p><strong>PushGateway å¸¸ç”¨ RestFul æ¥å£:</strong><br>æè¿°: å¸¸ç”¨æ–¹æ³•æœ‰POST/PUTä»¥åŠDELETEæ ¼å¼ä¸º<code>http://10.10.107.249:9091/metrics/job/{å·¥ä½œåç§°}/æ ‡ç­¾åç§°/æ ‡ç­¾å†…å®¹</code>ï¼Œæ³¨æ„<code>&lt;å·¥ä½œåç§°&gt;</code>æ˜¯jobæ ‡ç­¾çš„å€¼ï¼Œåé¢è·Ÿä»»æ„æ•°é‡çš„æ ‡ç­¾å¯¹ï¼Œinstanceæ ‡ç­¾å¯ä»¥æœ‰ä¹Ÿå¯ä»¥æ²¡æœ‰ã€‚</p>
<p>ç®€å•ç¤ºä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - 1) Push a single sample(å•ä¸ª) into the group identified by &#123;job="some_job"&#125; ä»¥åŠæŒ‡å®šæŒ‡æ ‡çš„å‚æ•°æ ‡ç­¾:</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"some_metric 3.14"</span> | curl --data-binary @- http://10.10.107.249:9091/metrics/job/some_job</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"some_metric 3.14"</span> | curl --data-binary @- http://10.10.107.249:9091/metrics/job/some_job/labels/demo_test</span><br><span class="line">  <span class="comment"># è¾“å‡ºç»“æœ</span></span><br><span class="line">  <span class="comment"># # TYPE some_metric untyped  # æ³¨æ„è¿™é‡Œçš„ç±»å‹ã€‚</span></span><br><span class="line">  <span class="comment"># some_metric&#123;instance="",job="some_job",labels="demo_test"&#125; 3.14</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - 2) Push something more complex (å¤æ‚å¤šä¸ª) into the group identified by &#123;job="some_job",instance="some_instance"&#125;:</span></span><br><span class="line">cat &lt;&lt;EOF | curl --data-binary @- http://10.10.107.249:9091/metrics/job/some_job/instance/some_instance</span><br><span class="line"><span class="comment"># TYPE some_metric counter</span></span><br><span class="line">some_metric&#123;label=<span class="string">"val1"</span>&#125; 42</span><br><span class="line"><span class="comment"># TYPE another_metric gauge</span></span><br><span class="line"><span class="comment"># HELP another_metric Just an example.</span></span><br><span class="line">another_metric 2398.283</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># - 3) åˆ é™¤ç”±æ ‡è¯†çš„ç»„ä¸­çš„æ‰€æœ‰åº¦é‡ &#123;job="some_job",instance="some_instance"&#125; :</span></span><br><span class="line">curl -X DELETE http://10.10.107.249:9091/metrics/job/some_job/instance/some_instance</span><br><span class="line"></span><br><span class="line"><span class="comment"># - 4) åˆ é™¤ç”±æ ‡è¯†çš„ç»„ä¸­çš„æ‰€æœ‰æŒ‡æ ‡&#123;job="some_job"&#125;ï¼ˆè¯·æ³¨æ„&#123;job="some_job",instance="some_instance"&#125;ï¼Œå³ä½¿è¿™äº›æŒ‡æ ‡å…·æœ‰ç›¸åŒçš„ä½œä¸šæ ‡ç­¾ï¼Œè¯¥ç¤ºä¾‹ä¸­ä¹Ÿä¸åŒ…æ‹¬è¯¥ç»„ä¸­çš„æŒ‡æ ‡ï¼‰ï¼š</span></span><br><span class="line">curl -X DELETE http://10.10.107.249:9091/metrics/job/some_job</span><br><span class="line"></span><br><span class="line"><span class="comment"># - 5) åˆ é™¤æ‰€æœ‰ç»„ä¸­çš„æ‰€æœ‰æŒ‡æ ‡ï¼ˆè¦æ±‚é€šè¿‡å‘½ä»¤è¡Œæ ‡å¿—å¯ç”¨admin API --web.enable-admin-apiï¼‰</span></span><br><span class="line">curl -X PUT http://10.10.107.249:9091/api/v1/admin/wipe</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=2.Prometheusç›‘æ§å…¥é—¨ä¹‹ç›‘æ§é…ç½®è¯´æ˜ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210510123823.png" target="_blank" title="WeiyiGeek.åˆ©ç”¨CURLä¸Šä¼ æ•°æ®åˆ°pushgatewayä¹‹ä¸­" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210510123823.png" alt="WeiyiGeek.åˆ©ç”¨CURLä¸Šä¼ æ•°æ®åˆ°pushgatewayä¹‹ä¸­" title="" class=""></a>
                <p>WeiyiGeek.åˆ©ç”¨CURLä¸Šä¼ æ•°æ®åˆ°pushgatewayä¹‹ä¸­</p>
            </figure>
<p>Tips : Pushgatewayæ˜¾ç„¶ä¸æ˜¯èšåˆå™¨æˆ–åˆ†å¸ƒå¼è®¡æ•°å™¨è€Œæ˜¯æŒ‡æ ‡ç¼“å­˜,é€‚ç”¨äºæœåŠ¡çº§åˆ«æŒ‡æ ‡ã€‚</p>
<p>Tips : Pushgatewayå¿…é¡»è¢«é…ç½®ä¸ºä¸€ä¸ªç›®æ ‡ï¼Œç”±Prometheusä½¿ç”¨ä¸€ç§å¸¸ç”¨çš„æ–¹æ³•è¿›è¡ŒæŠ“å–ã€‚ä½†æ˜¯æ‚¨åº”è¯¥å§‹ç»ˆåœ¨scrape configä¸­è®¾ç½®<code>honor_labels: true</code></p>
<p>Tips : ä¸ºäº†é˜²æ­¢ pushgateway é‡å¯æˆ–æ„å¤–æŒ‚æ‰ï¼Œå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œå¯ä»¥é€šè¿‡ <code>-persistence.file</code> å’Œ <code>-persistence.interval</code> å‚æ•°å°†æ•°æ®æŒä¹…åŒ–ä¸‹æ¥ã€‚</p>
<p>Tips : APIæ‰€æœ‰çš„æ¨é€éƒ½æ˜¯é€šè¿‡HTTPå®Œæˆçš„ç•Œé¢æœ‰ç‚¹åƒREST,ä¾‹å¦‚:<code>/metrics/job/&lt;JOB_NAME&gt;{/&lt;LABEL_NAME&gt;/&lt;LABEL_VALUE&gt;}</code>, å‚è€ƒåœ°å€:<a href="https://github.com/prometheus/pushgateway#apiã€‚" target="_blank" rel="noopener">https://github.com/prometheus/pushgateway#apiã€‚</a></p>
<hr>
<h2 id="0x01-é…ç½®æ–‡ä»¶"><a href="#0x01-é…ç½®æ–‡ä»¶" class="headerlink" title="0x01 é…ç½®æ–‡ä»¶"></a>0x01 é…ç½®æ–‡ä»¶</h2><h3 id="Prometheus-yml"><a href="#Prometheus-yml" class="headerlink" title="Prometheus.yml"></a>Prometheus.yml</h3><p>æè¿°: è¯¥é…ç½®æ–‡ä»¶ä¸ºPrometheusçš„æœåŠ¡ç«¯é…ç½®æ–‡ä»¶,è®¾ç½®é‡‡é›†æ•°æ®çš„ä¸»æœºä»¥åŠé‡‡é›†å™¨ç›¸å…³å‚æ•°ï¼Œåœ¨Prometheuså¯åŠ¨æ—¶å¸¸å¸¸ä½¿ç”¨e <code>--config.file</code> å‚æ•°æŒ‡å®šè¯¥é…ç½®æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚<br>å¸®åŠ©æ–‡æ¡£: <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/" target="_blank" rel="noopener">https://prometheus.io/docs/prometheus/latest/configuration/configuration/</a></p>
<p>Tips : è¯¥æ–‡ä»¶ä»¥YAMLæ ¼å¼ç¼–å†™ï¼Œç”±ä¸‹é¢æè¿°çš„æ–¹æ¡ˆå®šä¹‰ã€‚æ‹¬å·è¡¨ç¤ºå‚æ•°æ˜¯å¯é€‰çš„ã€‚å¯¹äºéåˆ—è¡¨å‚æ•°ï¼Œè¯¥å€¼è®¾ç½®ä¸ºæŒ‡å®šçš„é»˜è®¤å€¼ã€‚<br>Configuration file ä¸»è¦é…ç½®å¯¹è±¡:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">* &lt;scrape_config&gt;</span><br><span class="line">  * &lt;tls_config&gt;</span><br><span class="line">  * &lt;azure_sd_config&gt;</span><br><span class="line">  * &lt;consul_sd_config&gt;</span><br><span class="line">  * &lt;digitalocean_sd_config&gt;</span><br><span class="line">  * &lt;dockerswarm_sd_config&gt;</span><br><span class="line">  * &lt;dns_sd_config&gt;</span><br><span class="line">  * &lt;ec2_sd_config&gt;</span><br><span class="line">  * &lt;openstack_sd_config&gt;</span><br><span class="line">  * &lt;file_sd_config&gt;</span><br><span class="line">  * &lt;gce_sd_config&gt;</span><br><span class="line">  * &lt;hetzner_sd_config&gt;</span><br><span class="line">  * &lt;kubernetes_sd_config&gt;</span><br><span class="line">  * &lt;marathon_sd_config&gt;</span><br><span class="line">  * &lt;nerve_sd_config&gt;</span><br><span class="line">  * &lt;serverset_sd_config&gt;</span><br><span class="line">  * &lt;triton_sd_config&gt;</span><br><span class="line">  * &lt;eureka_sd_config&gt;</span><br><span class="line">  * &lt;scaleway_sd_config&gt;</span><br><span class="line">  * &lt;static_config&gt;</span><br><span class="line">  * &lt;relabel_config&gt;</span><br><span class="line">  * &lt;metric_relabel_configs&gt;</span><br><span class="line">* &lt;alert_relabel_configs&gt;</span><br><span class="line">* &lt;alertmanager_config&gt;</span><br><span class="line">* &lt;remote_write&gt;</span><br><span class="line">* &lt;remote_read&gt;</span><br></pre></td></tr></table></figure></p>
<p>Tips : é€šç”¨å ä½ç¬¦å®šä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>&lt;boolean&gt;</code>: a boolean that can take the values true or false</li>
<li><code>&lt;duration&gt;</code>: a duration matching the regular expression <code>((([0-9]+)y)?(([0-9]+)w)?(([0-9]+)d)?(([0-9]+)h)?(([0-9]+)m)?(([0-9]+)s)?(([0-9]+)ms)?|0)</code>, e.g. 1d, 1h30m, 5m, 10s</li>
<li><code>&lt;filename&gt;</code>: a valid path in the current working directory</li>
<li><code>&lt;host&gt;</code>: a valid string consisting of a hostname or IP followed by an optional port number</li>
<li><code>&lt;int&gt;</code>: an integer value</li>
<li><code>&lt;labelname&gt;:</code> a string matching the regular expression [a-zA-Z_][a-zA-Z0-9_]*</li>
<li><code>&lt;labelvalue&gt;</code>: a string of unicode characters</li>
<li><code>&lt;path&gt;</code>: a valid URL path</li>
<li><code>&lt;scheme&gt;</code>: a string that can take the values http or https</li>
<li><code>&lt;secret&gt;</code>: a regular string that is a secret, such as a password</li>
<li><code>&lt;string&gt;</code>: a regular string</li>
<li><code>&lt;tmpl_string&gt;:</code> a string which is template-expanded before usage</li>
</ul>
<p><br/></p>
<h4 id="1-è¯­æ³•æ ¼å¼"><a href="#1-è¯­æ³•æ ¼å¼" class="headerlink" title="(1) è¯­æ³•æ ¼å¼"></a>(1) è¯­æ³•æ ¼å¼</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - å…¨å±€é…ç½®æŒ‡å®šåœ¨æ‰€æœ‰å…¶ä»–é…ç½®ä¸Šä¸‹æ–‡ä¸­æœ‰æ•ˆçš„å‚æ•°</span></span><br><span class="line">global:</span><br><span class="line">  [ scrape_interval: &lt;duration&gt; | default = 1m ]     <span class="comment"># é»˜è®¤æƒ…å†µä¸‹åˆ®å–ç›®æ ‡çš„é¢‘ç‡ã€‚</span></span><br><span class="line">  [ scrape_timeout: &lt;duration&gt; | default = 10s ]     <span class="comment"># åˆ®å–è¯·æ±‚è¶…æ—¶çš„æ—¶é—´ã€‚</span></span><br><span class="line">  [ evaluation_interval: &lt;duration&gt; | default = 1m ] <span class="comment"># è¯„ä¼°è§„åˆ™çš„é¢‘ç‡ã€‚</span></span><br><span class="line">  external_labels: <span class="comment"># ä¸ä»»ä½•æ—¶é—´åºåˆ—æˆ–è­¦æŠ¥é€šä¿¡æ—¶è¦æ·»åŠ çš„æ ‡ç­¾,å¤–éƒ¨ç³»ç»Ÿï¼ˆè”åˆã€è¿œç¨‹å­˜å‚¨ã€Alertmanagerï¼‰ã€‚</span></span><br><span class="line">    [ &lt;labelname&gt;: &lt;labelvalue&gt; ... ]</span><br><span class="line">  [ query_log_file: &lt;string&gt; ] <span class="comment"># #PromQLæŸ¥è¯¢è®°å½•åˆ°çš„æ–‡ä»¶,é‡æ–°åŠ è½½é…ç½®å°†é‡æ–°æ‰“å¼€æ–‡ä»¶ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - ä»æ‰€æœ‰åŒ¹é…çš„æ–‡ä»¶ä¸­è¯»å–ç›‘æ§è§„åˆ™ä¸è­¦æŠ¥è§„åˆ™ã€‚</span></span><br><span class="line">rule_files:</span><br><span class="line">  [ - &lt;filepath_glob&gt; ... ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#- è­¦æŠ¥æŒ‡å®šä¸Alertmanagerç›¸å…³çš„è®¾ç½®ã€‚</span></span><br><span class="line">alerting:</span><br><span class="line">  alert_relabel_configs: <span class="comment"># - è­¦æŠ¥é‡æ–°æ ‡è®°åœ¨å‘é€åˆ°Alertmanagerä¹‹å‰åº”ç”¨äºè­¦æŠ¥,ç”¨é€”æ˜¯ç¡®ä¿ä¸€å¯¹å…·æœ‰ä¸åŒå¤–éƒ¨æ ‡ç­¾çš„PrometheusæœåŠ¡å™¨å‘é€ç›¸åŒçš„è­¦æŠ¥ã€‚</span></span><br><span class="line">  alertmanagers:</span><br><span class="line">    [ timeout: &lt;duration&gt; | default = 10s ]     <span class="comment"># Per-target Alertmanager timeout when pushing alerts.</span></span><br><span class="line">    [ api_version: &lt;string&gt; | default = v2 ]    <span class="comment"># The api version of Alertmanager.</span></span><br><span class="line">    [ path_prefix: &lt;path&gt; | default = / ]       <span class="comment"># Prefix for the HTTP path alerts are pushed to.</span></span><br><span class="line">    [ scheme: &lt;scheme&gt; | default = http ]       <span class="comment"># Configures the protocol scheme used for requests.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - ä¸è¿œç¨‹å†™å…¥åŠŸèƒ½ç›¸å…³çš„è®¾ç½®ã€‚å°†å…¶åº”ç”¨åˆ°è¿œç¨‹ç«¯ç‚¹,å†™é‡æ–°æ ‡è®°åº”ç”¨äºå¤–éƒ¨æ ‡ç­¾ä¹‹åè¿˜å¯é™åˆ¶å‘é€çš„æ ·æœ¬</span></span><br><span class="line">remote_write:</span><br><span class="line">  [ name: &lt;string&gt; ] <span class="comment"># è¿œç¨‹å†™å…¥é…ç½®çš„åç§°ï¼Œå¦‚æœæŒ‡å®šï¼Œåˆ™è¯¥åç§°åœ¨è¿œç¨‹å†™å…¥é…ç½®ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚</span></span><br><span class="line">  url: &lt;string&gt;      <span class="comment"># è¦å‘å…¶å‘é€ç¤ºä¾‹çš„ç»ˆç»“ç‚¹çš„URLã€‚</span></span><br><span class="line">  [ remote_timeout: &lt;duration&gt; | default = 30s ]</span><br><span class="line">  headers:  <span class="comment"># ä¸æ¯ä¸ªè¿œç¨‹å†™å…¥è¯·æ±‚ä¸€èµ·å‘é€çš„è‡ªå®šä¹‰HTTPå¤´ï¼Œä¸»è¦è‡ªå·±è®¾ç½®çš„æ ‡é¢˜ä¸èƒ½è¢«è¦†ç›–ã€‚</span></span><br><span class="line">    [ &lt;string&gt;: &lt;string&gt; ... ]</span><br><span class="line">  write_relabel_configs:  <span class="comment"># #è¿œç¨‹å†™é‡æ–°æ ‡è®°é…ç½®çš„åˆ—è¡¨ã€‚</span></span><br><span class="line">    [ - &lt;relabel_config&gt; ... ]</span><br><span class="line">  queue_config:    <span class="comment"># é…ç½®ç”¨äºå†™å…¥è¿œç¨‹å­˜å‚¨çš„é˜Ÿåˆ—ã€‚ </span></span><br><span class="line">  <span class="comment"># Number of samples to buffer per shard before we block reading of more</span></span><br><span class="line">  <span class="comment"># samples from the WAL. It is recommended to have enough capacity in each</span></span><br><span class="line">  <span class="comment"># shard to buffer several requests to keep throughput up while processing</span></span><br><span class="line">  <span class="comment"># occasional slow remote requests.</span></span><br><span class="line">  [ capacity: &lt;int&gt; | default = 2500 ]</span><br><span class="line">  <span class="comment"># Maximum number of shards, i.e. amount of concurrency.</span></span><br><span class="line">  [ max_shards: &lt;int&gt; | default = 200 ]</span><br><span class="line">  <span class="comment"># Minimum number of shards, i.e. amount of concurrency.</span></span><br><span class="line">  [ min_shards: &lt;int&gt; | default = 1 ]</span><br><span class="line">  <span class="comment"># Maximum number of samples per send.</span></span><br><span class="line">  [ max_samples_per_send: &lt;int&gt; | default = 500]</span><br><span class="line">  <span class="comment"># Maximum time a sample will wait in buffer.</span></span><br><span class="line">  [ batch_send_deadline: &lt;duration&gt; | default = 5s ]</span><br><span class="line">  <span class="comment"># Initial retry delay. Gets doubled for every retry.</span></span><br><span class="line">  [ min_backoff: &lt;duration&gt; | default = 30ms ]</span><br><span class="line">  <span class="comment"># Maximum retry delay.</span></span><br><span class="line">  [ max_backoff: &lt;duration&gt; | default = 100ms ]</span><br><span class="line">  <span class="comment"># Retry upon receiving a 429 status code from the remote-write storage.</span></span><br><span class="line">  <span class="comment"># This is experimental and might change in the future.</span></span><br><span class="line">  [ retry_on_http_429: &lt;boolean&gt; | default = <span class="literal">false</span> ]</span><br><span class="line"></span><br><span class="line">  metadata_config:   <span class="comment"># é…ç½®å‘è¿œç¨‹å­˜å‚¨å‘é€åºåˆ—å…ƒæ•°æ®(éšæ—¶å¯èƒ½æ›´æ”¹æˆ–åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­åˆ é™¤ã€‚)</span></span><br><span class="line">    <span class="comment"># Whether metric metadata is sent to remote storage or not.</span></span><br><span class="line">    [ send: &lt;boolean&gt; | default = <span class="literal">true</span> ]</span><br><span class="line">    <span class="comment"># How frequently metric metadata is sent to remote storage.</span></span><br><span class="line">    [ send_interval: &lt;duration&gt; | default = 1m ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># - ä¸è¿œç¨‹è¯»å–åŠŸèƒ½ç›¸å…³çš„è®¾ç½®(é”®å€¼å¯¹å‚æ•°è®¾ç½®ä¸ä¸Šè¿°åŸºæœ¬ä¸€è‡´)</span></span><br><span class="line">remote_read:</span><br><span class="line">  [ - &lt;remote_read&gt; ... ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># - æŒ‡å®šäº†ä¸€ç»„ç›®æ ‡å’Œæè¿°å¦‚ä½•è·å–å®ƒä»¬çš„å‚æ•°(åˆ®æ“¦é…ç½®åˆ—è¡¨)ã€‚</span></span><br><span class="line">scrape_configs:</span><br><span class="line">  [ - &lt;scrape_config&gt; ... ]</span><br><span class="line">    job_name: &lt;job_name&gt;     <span class="comment"># é‡‡é›†å¯¹è±¡çš„ä½œä¸šåç§°ã€‚</span></span><br><span class="line">    [ scrape_interval: &lt;duration&gt; | default = &lt;global_config.scrape_interval&gt; ] <span class="comment"># jobå±€éƒ¨åˆ®å–ç›®æ ‡çš„é¢‘ç‡ã€‚</span></span><br><span class="line">    [ scrape_timeout: &lt;duration&gt; | default = &lt;global_config.scrape_timeout&gt; ]   <span class="comment"># jobå±€éƒ¨è¯·æ±‚è¶…æ—¶çš„æ—¶é—´ã€‚</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># honor_labels å¤„ç†æ ‡ç­¾ä¹‹é—´çš„å†²çªæ³¨æ„(â€œä½œä¸šâ€å’Œâ€œå®ä¾‹â€æ ‡ç­¾ï¼Œæ‰‹åŠ¨é…ç½®çš„ç›®æ ‡æ ‡ç­¾ï¼Œä»¥åŠç”±æœåŠ¡å‘ç°å®ç°ç”Ÿæˆçš„æ ‡ç­¾ï¼‰ã€‚</span></span><br><span class="line">    <span class="comment"># å°†pushu labelsè®¾ç½®ä¸ºâ€œtrueâ€å¯¹äºè¯¸å¦‚è”åˆå’Œæ¸…é™¤Pushgatewayä¹‹ç±»çš„ç”¨ä¾‹éå¸¸æœ‰ç”¨ï¼Œåœ¨è¿™äº›ç”¨ä¾‹ä¸­ï¼Œåº”è¯¥ä¿ç•™åœ¨ç›®æ ‡ä¸­æŒ‡å®šçš„æ‰€æœ‰æ ‡ç­¾ã€‚</span></span><br><span class="line">    [ honor_labels: &lt;boolean&gt; | default = <span class="literal">false</span> ]  <span class="comment"># å¦‚ä¸ºtrueåˆ™ä¿å­˜å†²çªæ ‡ç­¾</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># honor_timestamps æ˜¯å¦ä¿¡ä»»è¢«åˆ®å–çš„æ•°æ®ä¸Šçš„æ—¶é—´æˆ³ã€‚</span></span><br><span class="line">    [ honor_timestamps: &lt;boolean&gt; | default = <span class="literal">true</span> ]   <span class="comment"># å¦‚æœå°†timestampsè®¾ç½®ä¸ºâ€œtrueâ€ï¼Œåˆ™å°†ä½¿ç”¨ç›®æ ‡å…¬å¼€çš„åº¦é‡çš„æ—¶é—´æˆ³ã€‚</span></span><br><span class="line"></span><br><span class="line">    [ scheme: &lt;scheme&gt; | default = http ]         <span class="comment"># ç›®æ ‡æ‹‰å–åè®®(https|http)</span></span><br><span class="line">    [ metrics_path: &lt;path&gt; | default = /metrics ] <span class="comment"># ä»ç›®æ ‡è·å–åº¦é‡çš„HTTPèµ„æºè·¯å¾„ã€‚</span></span><br><span class="line">    params:                                       <span class="comment"># (å¯é€‰çš„)HTTP URLå‚æ•°ã€‚</span></span><br><span class="line">      [ &lt;string&gt;: [&lt;string&gt;, ...] ]</span><br><span class="line">    authorization:     <span class="comment"># ä½¿ç”¨é…ç½®çš„å‡­æ®åœ¨æ¯ä¸ªscrapeè¯·æ±‚ä¸Šè®¾ç½®â€œAuthorizationâ€å¤´ã€‚</span></span><br><span class="line">      <span class="comment"># Sets the authentication type of the request.</span></span><br><span class="line">      [ <span class="built_in">type</span>: &lt;string&gt; | default: Bearer ]</span><br><span class="line">      <span class="comment"># Sets the credentials of the request. It is mutually exclusive with `credentials_file`.</span></span><br><span class="line">      [ credentials: &lt;secret&gt; ]</span><br><span class="line">      <span class="comment"># Sets the credentials of the request with the credentials read from the  configured file. It is mutually exclusive with `credentials`.</span></span><br><span class="line">      [ credentials_file: &lt;filename&gt; ]</span><br><span class="line">    basic_auth:  <span class="comment"># ä½¿ç”¨é…ç½®çš„ç”¨æˆ·åå’Œå¯†ç åœ¨æ¯ä¸ªscrapeè¯·æ±‚ä¸Šè®¾ç½®â€œAuthorizationâ€å¤´ã€‚</span></span><br><span class="line">      [ username: &lt;string&gt; ]</span><br><span class="line">      [ password: &lt;secret&gt; ]  <span class="comment"># å¯†ç å’Œå¯†ç æ–‡ä»¶æ˜¯äº’æ–¥çš„ã€‚</span></span><br><span class="line">      [ password_file: &lt;string&gt; ]</span><br><span class="line"></span><br><span class="line">    [ follow_redirects: &lt;bool&gt; | default = <span class="literal">true</span> ] <span class="comment"># é…ç½®åˆ®å–è¯·æ±‚æ˜¯å¦éµå¾ªHTTP 3xxé‡å®šå‘ã€‚</span></span><br><span class="line"></span><br><span class="line">    tls_config:             <span class="comment"># è¯·æ±‚ç«™ç‚¹çš„SSLè¯ä¹¦(tlsè¿æ¥)è®¾ç½®</span></span><br><span class="line">      [ &lt;tls_config&gt; ]</span><br><span class="line">        [ ca_file: &lt;filename&gt; ]     <span class="comment"># ç”¨äºéªŒè¯APIæœåŠ¡å™¨è¯ä¹¦çš„CAè¯ä¹¦ã€‚</span></span><br><span class="line">        [ cert_file: &lt;filename&gt; ]   <span class="comment"># ç”¨äºå‘æœåŠ¡å™¨è¿›è¡Œå®¢æˆ·ç«¯è¯ä¹¦èº«ä»½éªŒè¯çš„è¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶ã€‚</span></span><br><span class="line">        [ key_file: &lt;filename&gt; ]</span><br><span class="line">        [ server_name: &lt;string&gt; ]   <span class="comment"># ç”¨äºæŒ‡ç¤ºæœåŠ¡å™¨çš„åç§°(https://tools.ietf.org/html/rfc4366#section-3.1)</span></span><br><span class="line">        [ insecure_skip_verify: &lt;boolean&gt; ] <span class="comment"># ç¦ç”¨æœåŠ¡å™¨è¯ä¹¦éªŒè¯ã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    [ proxy_url: &lt;string&gt; ]  <span class="comment"># ä»£ç†è®¾ç½®</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># - è®¾ç½®å¤šç§æœåŠ¡å‘ç°æ–¹å¼(è¯¦æƒ…å‚è€ƒä¸Šé¢çš„URL),è¿™é‡Œä¸»è¦è®²è§£æœ€å¸¸ç”¨çš„file_sd_configå’Œkubernetes_sd_configsé…ç½®</span></span><br><span class="line">    <span class="comment"># åŸºäºæ–‡ä»¶çš„æœåŠ¡å‘ç°æä¾›äº†ä¸€ç§æ›´é€šç”¨çš„æ–¹æ³•æ¥é…ç½®é™æ€ç›®æ ‡ï¼Œå¹¶å……å½“æ’å…¥è‡ªå®šä¹‰æœåŠ¡å‘ç°æœºåˆ¶çš„æ¥å£(æ–‡ä»¶å¯ä»¥YAMLæˆ–JSONæ ¼å¼æä¾›,æ ¼å¼æ ·ä¾‹çœ‹ä¸‹é¢çš„tips)ã€‚</span></span><br><span class="line">    file_sd_configs:  <span class="comment">#å®ƒè¯»å–ä¸€ç»„åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ª&lt;static_config&gt;åˆ—è¡¨çš„æ–‡ä»¶ã€‚</span></span><br><span class="line">      - files:</span><br><span class="line">        - my/path/tg_*.json</span><br><span class="line">        [ refresh_interval: &lt;duration&gt; | default = 5m ] <span class="comment"># è¯¥é™æ€æ–‡ä»¶åˆ·æ–°æ—¶é—´é—´éš”</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŸºäºkubernetesçš„æœåŠ¡å‘ç°,å…è®¸ä» Kubernetes' REST API æ‹‰å–é›†ç¾¤podç›¸å…³ä¿¡æ¯å¹¶æ—¶åˆ»ä¿æŒåŒæ­¥ã€‚</span></span><br><span class="line">    kubernetes_sd_configs:</span><br><span class="line">      [ api_server: &lt;host&gt; ]  </span><br><span class="line">      role: &lt;string&gt;  <span class="comment"># One of endpoints, service, pod, node, or ingress.</span></span><br><span class="line">      namespaces:     <span class="comment">#å¯é€‰å‘½åç©ºé—´å‘ç°ã€‚å¦‚æœçœç•¥åˆ™ä½¿ç”¨æ‰€æœ‰åç§°ç©ºé—´ã€‚</span></span><br><span class="line">        names:</span><br><span class="line">          [ - &lt;string&gt; ]</span><br><span class="line">      <span class="comment"># å¯é€‰çš„æ ‡ç­¾å’Œå­—æ®µé€‰æ‹©å™¨ï¼Œç”¨äºå°†å‘ç°è¿‡ç¨‹é™åˆ¶ä¸ºå¯ç”¨èµ„æºçš„å­é›†ã€‚</span></span><br><span class="line">      [ selectors:</span><br><span class="line">        [ - role: &lt;string&gt;</span><br><span class="line">          [ label: &lt;string&gt; ]</span><br><span class="line">          [ field: &lt;string&gt; ] ]]</span><br><span class="line"></span><br><span class="line">      <span class="comment"># ç”¨äºå‘APIæœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯çš„å¯é€‰èº«ä»½éªŒè¯ä¿¡æ¯ã€‚</span></span><br><span class="line">      tls_config:  <span class="comment"># tls è®¿é—®å¿…é¡»è®¾ç½®</span></span><br><span class="line">        [ &lt;tls_config&gt; ]</span><br><span class="line">      basic_auth:</span><br><span class="line">        [ username: &lt;string&gt; ]</span><br><span class="line">        [ password: &lt;secret&gt; ] | [ password_file: &lt;string&gt; ]</span><br><span class="line">      authorization:</span><br><span class="line">      <span class="comment"># Sets the authentication type.</span></span><br><span class="line">      [ <span class="built_in">type</span>: &lt;string&gt; | default: Bearer ]  <span class="comment"># è®¾ç½®èº«ä»½éªŒè¯ç±»å‹ã€‚</span></span><br><span class="line">      <span class="comment"># è®¾ç½®å‡­æ®ã€‚å®ƒä¸â€œå‡­è¯æ–‡ä»¶â€äº’æ–¥ã€‚</span></span><br><span class="line">      [ credentials: &lt;secret&gt; ] | [ credentials_file: &lt;filename&gt; ]</span><br><span class="line">      </span><br><span class="line">    <span class="comment"># ----------------------------------------------------------------------- #</span></span><br><span class="line">    <span class="comment"># List of Azure service discovery configurations.</span></span><br><span class="line">    azure_sd_configs:</span><br><span class="line">      [ - &lt;azure_sd_config&gt; ... ]</span><br><span class="line">    <span class="comment"># List of Consul service discovery configurations.</span></span><br><span class="line">    consul_sd_configs:</span><br><span class="line">      [ - &lt;consul_sd_config&gt; ... ]</span><br><span class="line">    <span class="comment"># List of DigitalOcean service discovery configurations.</span></span><br><span class="line">    digitalocean_sd_configs:</span><br><span class="line">      [ - &lt;digitalocean_sd_config&gt; ... ]</span><br><span class="line">    <span class="comment"># List of Docker Swarm service discovery configurations.</span></span><br><span class="line">    dockerswarm_sd_configs:</span><br><span class="line">      [ - &lt;dockerswarm_sd_config&gt; ... ]</span><br><span class="line">    <span class="comment"># List of DNS service discovery configurations.</span></span><br><span class="line">    dns_sd_configs:</span><br><span class="line">      [ - &lt;dns_sd_config&gt; ... ]</span><br><span class="line">    <span class="comment"># List of EC2 service discovery configurations.</span></span><br><span class="line">    ec2_sd_configs:</span><br><span class="line">      [ - &lt;ec2_sd_config&gt; ... ]</span><br><span class="line">    <span class="comment"># List of Eureka service discovery configurations.</span></span><br><span class="line">    eureka_sd_configs:</span><br><span class="line">      [ - &lt;eureka_sd_config&gt; ... ]</span><br><span class="line">    <span class="comment"># List of GCE service discovery configurations.</span></span><br><span class="line">    gce_sd_configs:</span><br><span class="line">      [ - &lt;gce_sd_config&gt; ... ]</span><br><span class="line">    <span class="comment"># List of Hetzner service discovery configurations.</span></span><br><span class="line">    hetzner_sd_configs:</span><br><span class="line">      [ - &lt;hetzner_sd_config&gt; ... ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># List of Marathon service discovery configurations.</span></span><br><span class="line">    marathon_sd_configs:</span><br><span class="line">      [ - &lt;marathon_sd_config&gt; ... ]</span><br><span class="line">    <span class="comment"># List of AirBnB's Nerve service discovery configurations.</span></span><br><span class="line">    nerve_sd_configs:</span><br><span class="line">      [ - &lt;nerve_sd_config&gt; ... ]</span><br><span class="line">    <span class="comment"># List of OpenStack service discovery configurations.</span></span><br><span class="line">    openstack_sd_configs:</span><br><span class="line">      [ - &lt;openstack_sd_config&gt; ... ]</span><br><span class="line">    <span class="comment"># List of Scaleway service discovery configurations.</span></span><br><span class="line">    scaleway_sd_configs:</span><br><span class="line">      [ - &lt;scaleway_sd_config&gt; ... ]</span><br><span class="line">    <span class="comment"># List of Zookeeper Serverset service discovery configurations.</span></span><br><span class="line">    serverset_sd_configs:</span><br><span class="line">      [ - &lt;serverset_sd_config&gt; ... ]</span><br><span class="line">    <span class="comment"># List of Triton service discovery configurations.</span></span><br><span class="line">    triton_sd_configs:</span><br><span class="line">      [ - &lt;triton_sd_config&gt; ... ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># - åœ¨scrapeé…ç½®ä¸­æŒ‡å®šé™æ€ç›®æ ‡çš„è§„èŒƒæ–¹æ³•,å…è®¸æŒ‡å®šç›®æ ‡åˆ—è¡¨å’Œå®ƒä»¬çš„å…¬å…±æ ‡ç­¾é›†</span></span><br><span class="line">    static_configs:</span><br><span class="line">    - targets: [<span class="string">'localhost:9090'</span>, <span class="string">'localhost:9191'</span>]</span><br><span class="line">      labels:</span><br><span class="line">        [ &lt;labelname&gt;: &lt;labelvalue&gt; ... ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># - é‡æ–°æ ‡è®°æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥åœ¨ç›®æ ‡è¢«åˆ®é™¤ä¹‹å‰åŠ¨æ€é‡å†™å®ƒçš„æ ‡ç­¾é›†(é‡ç‚¹)</span></span><br><span class="line">    relabel_configs:</span><br><span class="line">      [ source_labels: <span class="string">'['</span> &lt;labelname&gt; [, ...] <span class="string">']'</span> ]       <span class="comment"># æºæ ‡ç­¾ä»ç°æœ‰æ ‡ç­¾ä¸­é€‰æ‹©å€¼</span></span><br><span class="line">      [ separator: &lt;string&gt; | default = ; ]      <span class="comment"># æºæ ‡ç­¾ä»ç°æœ‰æ ‡ç­¾ä¸­é€‰æ‹©å€¼</span></span><br><span class="line">      [ regex: &lt;regex&gt; | default = (.*);([^:].) ] <span class="comment"># ä¸æå–çš„å€¼åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</span></span><br><span class="line">      [ modulus: &lt;int&gt; ]  <span class="comment"># å–æºæ ‡ç­¾å€¼æ•£åˆ—çš„æ¨¡æ•°ã€‚</span></span><br><span class="line">      [ replacement: &lt;string&gt; | default = <span class="variable">$1</span> ] <span class="comment"># - å¦‚æœæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œåˆ™å¯¹å…¶æ‰§è¡Œæ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢çš„æ›¿æ¢å€¼ã€‚</span></span><br><span class="line">      [ action: &lt;relabel_action&gt; | default = replace ] <span class="comment"># åŸºäºæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ‰§è¡Œçš„æ“ä½œ, å¯é€‰actions (replace, keep, drop, labelmap,labeldrop and labelkeep) æœ€åè¯¦ç»†ä»‹ç»ã€‚</span></span><br><span class="line">      [ target_label: &lt;labelname&gt; ]  <span class="comment"># åœ¨æ›¿æ¢æ“ä½œä¸­å†™å…¥ç»“æœå€¼çš„æ ‡ç­¾,å¯¹äºæ›¿æ¢æ“ä½œæ˜¯å¼ºåˆ¶æ€§çš„</span></span><br><span class="line"></span><br><span class="line">    metric_relabel_configs:   <span class="comment"># - å…¬åˆ¶é‡æ–°æ ‡è®°é…ç½®çš„åˆ—è¡¨,ç”¨é€”æ˜¯æ’é™¤æˆæœ¬å¤ªé«˜è€Œæ— æ³•æ‘„å–çš„æ—¶é—´åºåˆ—ã€‚</span></span><br><span class="line"></span><br><span class="line">    [ sample_limit: &lt;int&gt; | default = 0 ]  <span class="comment"># æ¯æ¬¡åˆ®å–å°†è¢«æ¥å—çš„åˆ®å–æ ·å“æ•°é‡é™åˆ¶(0 means no limit)ã€‚</span></span><br><span class="line">    [ target_limit: &lt;int&gt; | default = 0 ]  <span class="comment"># æ¯ä¸ªscrapeé…ç½®å°†æ¥å—çš„å”¯ä¸€ç›®æ ‡æ•°é™åˆ¶(0 means no limit)ã€‚</span></span><br></pre></td></tr></table></figure>
<p>Tips : æ–‡ä»¶å¿…é¡»åŒ…å«ä½¿ç”¨ä»¥ä¸‹æ ¼å¼çš„é™æ€é…ç½®åˆ—è¡¨;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JSON json [ &#123; <span class="string">"targets"</span>: [ <span class="string">"&lt;host&gt;"</span>, ... ], <span class="string">"labels"</span>: &#123; <span class="string">"&lt;labelname&gt;"</span>: <span class="string">"&lt;labelvalue&gt;"</span>, ... &#125; &#125;, ... ]</span><br><span class="line">YAML yaml - targets: [ - <span class="string">'&lt;host&gt;'</span> ] labels: [ &lt;labelname&gt;: &lt;labelvalue&gt; ... ]</span><br></pre></td></tr></table></figure></p>
<p>Tips : åœ¨ Prometheusç›‘æ§kuberneteså…è®¸ä»ä»¥ä¸‹roleä¹‹ä¸€æ–¹å¼è¿›è¡Œç›®æ ‡çš„å‘ç°;</p>
<ul>
<li><p><code>node</code> : ä¸ºæ¯ä¸ªç¾¤é›†èŠ‚ç‚¹å‘ç°ä¸€ä¸ªç›®æ ‡ï¼Œå…¶åœ°å€é»˜è®¤ä¸ºKubeletçš„HTTPç«¯å£ï¼Œåœ°å€ç±»å‹é¡ºåº: <code>NodeInternalIP, NodeExternalIP, NodeLegacyHostIP, and NodeHostName.</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Available meta labels: æ­¤å¤–instanceèŠ‚ç‚¹çš„æ ‡ç­¾å°†è®¾ç½®ä¸ºä»APIæœåŠ¡å™¨æ£€ç´¢åˆ°çš„èŠ‚ç‚¹åã€‚</span></span><br><span class="line">__meta_kubernetes_node_nameï¼šèŠ‚ç‚¹å¯¹è±¡çš„åç§°</span><br><span class="line">__meta_kubernetes_node_label_&lt;labelname&gt;ï¼šèŠ‚ç‚¹å¯¹è±¡ä¸­çš„æ¯ä¸ªæ ‡ç­¾ã€‚</span><br><span class="line">__meta_kubernetes_node_labelpresent_&lt;labelname&gt; :æ˜¯çš„å¯¹äºèŠ‚ç‚¹å¯¹è±¡ä¸­çš„æ¯ä¸ªæ ‡ç­¾ã€‚</span><br><span class="line">__meta_kubernetes_node_annotation_&lt;annotationname&gt;ï¼šæ¥è‡ªèŠ‚ç‚¹å¯¹è±¡çš„æ¯ä¸ªæ³¨é‡Šã€‚</span><br><span class="line">__meta_kubernetes_node_annotationpresent_&lt;annotationname&gt; :æ˜¯çš„å¯¹äºèŠ‚ç‚¹å¯¹è±¡ä¸­çš„æ¯ä¸ªæ³¨é‡Šã€‚</span><br><span class="line">__meta_kubernetes_node_address_&lt;address_type&gt;ï¼šæ¯ä¸ªèŠ‚ç‚¹åœ°å€ç±»å‹çš„ç¬¬ä¸€ä¸ªåœ°å€ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>service</code> : ä¸ºæ¯ä¸ªæœåŠ¡çš„æ¯ä¸ªæœåŠ¡ç«¯å£å‘ç°ä¸€ä¸ªç›®æ ‡ã€‚è¿™å¯¹äºæœåŠ¡çš„é»‘ç›’ç›‘è§†é€šå¸¸å¾ˆæœ‰ç”¨ã€‚åœ°å€å°†è®¾ç½®ä¸ºæœåŠ¡çš„Kubernetes DNSåç§°å’Œç›¸åº”çš„æœåŠ¡ç«¯å£ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__meta_kubernetes_namespaceï¼šæœåŠ¡å¯¹è±¡çš„å‘½åç©ºé—´ã€‚</span><br><span class="line">__meta_kubernetes_service_annotation_&lt;annotationname&gt;ï¼šæ¥è‡ªæœåŠ¡å¯¹è±¡çš„æ¯ä¸ªæ‰¹æ³¨ã€‚</span><br><span class="line">__meta_kubernetes_service_annotationpresent_&lt;annotationname&gt;ï¼šâ€œ<span class="literal">true</span>â€è¡¨ç¤ºæœåŠ¡å¯¹è±¡çš„æ¯ä¸ªæ³¨é‡Šã€‚</span><br><span class="line">__meta_kubernetes_service_cluster_ipï¼šæœåŠ¡çš„ç¾¤é›†IPåœ°å€(ä¸é€‚ç”¨äºExternalNameç±»å‹çš„æœåŠ¡ï¼‰</span><br><span class="line">__meta_kubernetes_service_external_nameï¼šæœåŠ¡çš„DNSåç§°(é€‚ç”¨äºExternalNameç±»å‹çš„æœåŠ¡ï¼‰</span><br><span class="line">__meta_kubernetes_service_label_&lt;labelname&gt;ï¼šæ¥è‡ªæœåŠ¡å¯¹è±¡çš„æ¯ä¸ªæ ‡ç­¾ã€‚</span><br><span class="line">__meta_kubernetes_service_labelpresent_&lt;labelname&gt; :æ˜¯çš„å¯¹äºæœåŠ¡å¯¹è±¡çš„æ¯ä¸ªæ ‡ç­¾ã€‚</span><br><span class="line">__meta_kubernetes_service_nameï¼šæœåŠ¡å¯¹è±¡çš„åç§°</span><br><span class="line">__meta_kubernetes_service_port_nameï¼šç›®æ ‡çš„æœåŠ¡ç«¯å£çš„åç§°ã€‚</span><br><span class="line">__meta_kubernetes_service_port_protocolï¼šç›®æ ‡çš„æœåŠ¡ç«¯å£çš„åè®®ã€‚</span><br><span class="line">__meta_kubernetes_service_typeï¼šæœåŠ¡çš„ç±»å‹</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>pod</code> : å‘ç°æ‰€æœ‰podå¹¶å°†å…¶å®¹å™¨ä½œä¸ºç›®æ ‡å…¬å¼€ã€‚å¯¹äºå®¹å™¨çš„æ¯ä¸ªå£°æ˜ç«¯å£ï¼Œç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„ç›®æ ‡ã€‚å¦‚æœå®¹å™¨æ²¡æœ‰æŒ‡å®šçš„ç«¯å£ï¼Œåˆ™ä¸ºæ¯ä¸ªå®¹å™¨åˆ›å»ºä¸€ä¸ªç«¯å£ç©ºé—²ç›®æ ‡ï¼Œä»¥ä¾¿é€šè¿‡é‡æ–°æ ‡è®°æ‰‹åŠ¨æ·»åŠ ç«¯å£ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">__meta_kubernetes_namespaceï¼špodå¯¹è±¡çš„å‘½åç©ºé—´ã€‚</span><br><span class="line">__meta_kubernetes_pod_nameï¼špodå¯¹è±¡çš„åç§°</span><br><span class="line">__meta_kubernetes_pod_ipï¼špodå¯¹è±¡çš„pod IPã€‚</span><br><span class="line">__meta_kubernetes_pod_label_&lt;labelname&gt;ï¼špodå¯¹è±¡ä¸­çš„æ¯ä¸ªæ ‡ç­¾ã€‚</span><br><span class="line">__meta_kubernetes_pod_labelpresent_&lt;labelname&gt; :æ˜¯çš„å¯¹äºpodå¯¹è±¡ä¸­çš„æ¯ä¸ªæ ‡ç­¾ã€‚</span><br><span class="line">__meta_kubernetes_pod_annotation_&lt;annotationname&gt;ï¼špodå¯¹è±¡ä¸­çš„æ¯ä¸ªæ³¨é‡Šã€‚</span><br><span class="line">__meta_kubernetes_pod_annotationpresent_&lt;annotationname&gt; :æ˜¯çš„å¯¹äºpodå¯¹è±¡çš„æ¯ä¸ªæ³¨é‡Šã€‚</span><br><span class="line">__meta_kubernetes_pod_container_init :æ˜¯çš„å¦‚æœå®¹å™¨æ˜¯ åˆå§‹åŒ–å®¹å™¨</span><br><span class="line">__meta_kubernetes_pod_container_nameï¼šç›®æ ‡åœ°å€æŒ‡å‘çš„å®¹å™¨çš„åç§°ã€‚</span><br><span class="line">__meta_kubernetes_pod_container_port_nameï¼šå®¹å™¨ç«¯å£çš„åç§°</span><br><span class="line">__meta_kubernetes_pod_container_port_numberï¼šé›†è£…ç®±ç«¯å£å·</span><br><span class="line">__meta_kubernetes_pod_container_port_protocolï¼šé›†è£…ç®±æ¸¯å£çš„åè®®</span><br><span class="line">__meta_kubernetes_pod_readyï¼šè®¾ç½®ä¸ºæ˜¯çš„æˆ–<span class="literal">false</span>åŠèˆ±å‡†å¤‡å°±ç»ª</span><br><span class="line">__meta_kubernetes_pod_phaseï¼šè®¾ç½®ä¸ºæ‚¬è€Œæœªå†³çš„ ,Running ,æˆåŠŸ ,Failedæˆ–æœªçŸ¥åœ¨ç”Ÿå‘½å‘¨æœŸ .</span><br><span class="line">__meta_kubernetes_pod_node_nameï¼špodè¢«è°ƒåº¦åˆ°çš„èŠ‚ç‚¹çš„åç§°ã€‚</span><br><span class="line">__meta_kubernetes_pod_host_ipï¼špodå¯¹è±¡çš„å½“å‰ä¸»æœºIPã€‚</span><br><span class="line">__meta_kubernetes_pod_uidï¼špodå¯¹è±¡çš„UIDã€‚</span><br><span class="line">__meta_kubernetes_pod_controller_kindï¼špodæ§åˆ¶å™¨çš„å¯¹è±¡ç±»å‹ã€‚</span><br><span class="line">__meta_kubernetes_pod_controller_nameï¼šåŠèˆ±æ§åˆ¶å™¨çš„åç§°</span><br></pre></td></tr></table></figure>
</li>
<li><p>endpoints : ä»æœåŠ¡çš„åˆ—å‡ºçš„ç»ˆç»“ç‚¹å‘ç°ç›®æ ‡ã€‚å¯¹äºæ¯ä¸ªendpointaddressï¼Œæ¯ä¸ªç«¯å£éƒ½ä¼šå‘ç°ä¸€ä¸ªç›®æ ‡ã€‚å¦‚æœç«¯ç‚¹ç”±ä¸€ä¸ªpodæ”¯æŒï¼Œé‚£ä¹ˆpodçš„æ‰€æœ‰é™„åŠ å®¹å™¨ç«¯å£ï¼ˆæœªç»‘å®šåˆ°ç«¯ç‚¹ç«¯å£ï¼‰ä¹Ÿä¼šè¢«å‘ç°ä½œä¸ºç›®æ ‡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">__meta_kubernetes_namespaceï¼šendpointså¯¹è±¡çš„å‘½åç©ºé—´ã€‚</span><br><span class="line">__meta_kubernetes_endpoints_nameï¼šendpointså¯¹è±¡çš„åç§°ã€‚</span><br><span class="line">å¯¹äºç›´æ¥ä»ç«¯ç‚¹åˆ—è¡¨ä¸­å‘ç°çš„æ‰€æœ‰ç›®æ ‡ï¼ˆæœªä»åº•å±‚PODä¸­é¢å¤–æ¨æ–­å‡ºçš„ç›®æ ‡ï¼‰ï¼Œå°†é™„åŠ ä»¥ä¸‹æ ‡ç­¾ï¼š</span><br><span class="line">__meta_kubernetes_endpoint_hostnameï¼šç»ˆç»“ç‚¹çš„ä¸»æœºå</span><br><span class="line">__meta_kubernetes_endpoint_node_nameï¼šæ‰¿è½½ç»ˆç»“ç‚¹çš„èŠ‚ç‚¹çš„åç§°ã€‚</span><br><span class="line">__meta_kubernetes_endpoint_readyï¼šè®¾ç½®ä¸ºæ˜¯çš„æˆ–<span class="literal">false</span>å¯¹äºç«¯ç‚¹çš„å°±ç»ªçŠ¶æ€</span><br><span class="line">__meta_kubernetes_endpoint_port_nameï¼šç»ˆç»“ç‚¹ç«¯å£çš„åç§°</span><br><span class="line">__meta_kubernetes_endpoint_port_protocolï¼šç»ˆç»“ç‚¹ç«¯å£çš„åè®®</span><br><span class="line">__meta_kubernetes_endpoint_address_target_kindï¼šç»ˆç»“ç‚¹åœ°å€ç›®æ ‡çš„ç±»å‹ã€‚</span><br><span class="line">__meta_kubernetes_endpoint_address_target_nameï¼šç»ˆç»“ç‚¹åœ°å€ç›®æ ‡çš„åç§°ã€‚</span><br><span class="line">å¦‚æœç«¯ç‚¹å±äºæœåŠ¡ï¼Œåˆ™role: serviceå‘ç°å·²é™„åŠ </span><br><span class="line">å¯¹äºç”±åŠèˆ±æ”¯æŒçš„æ‰€æœ‰ç›®æ ‡role: podå‘ç°å·²é™„åŠ </span><br></pre></td></tr></table></figure>
</li>
<li><p>ingress : ä¸ºæ¯ä¸ªå…¥å£çš„æ¯ä¸ªè·¯å¾„å‘ç°ä¸€ä¸ªç›®æ ‡ã€‚è¿™é€šå¸¸å¯¹é»‘ç›’ç›‘æ§å…¥å£å¾ˆæœ‰ç”¨åœ°å€å°†è®¾ç½®ä¸ºå…¥å£è§„èŒƒä¸­æŒ‡å®šçš„ä¸»æœºã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__meta_kubernetes_namespaceï¼šingresså¯¹è±¡çš„å‘½åç©ºé—´ã€‚</span><br><span class="line">__meta_kubernetes_ingress_name -å…¥å£å¯¹è±¡çš„åç§°</span><br><span class="line">__meta_kubernetes_ingress_label_&lt;labelname&gt;ï¼šæ¥è‡ªingresså¯¹è±¡çš„æ¯ä¸ªæ ‡ç­¾ã€‚</span><br><span class="line">__meta_kubernetes_ingress_labelpresent_&lt;labelname&gt; :æ˜¯çš„å¯¹äºingresså¯¹è±¡ä¸­çš„æ¯ä¸ªæ ‡ç­¾ã€‚</span><br><span class="line">__meta_kubernetes_ingress_annotation_&lt;annotationname&gt;ï¼šæ¥è‡ªingresså¯¹è±¡çš„æ¯ä¸ªæ³¨é‡Šã€‚</span><br><span class="line">__meta_kubernetes_ingress_annotationpresent_&lt;annotationname&gt; :æ˜¯çš„å¯¹äºingresså¯¹è±¡çš„æ¯ä¸ªæ³¨é‡Šã€‚</span><br><span class="line">__meta_kubernetes_ingress_schemeï¼šå…¥å£åè®®æ–¹æ¡ˆï¼Œhttpså¦‚æœè®¾ç½®äº†TLSconfigã€‚é»˜è®¤ä¸ºhttp .</span><br><span class="line">__meta_kubernetes_ingress_pathï¼šä»å…¥å£è§„èŒƒçš„è·¯å¾„é»˜è®¤ä¸º / .</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Tips : relabel_config å¯¹è±¡ä¸­<code>&lt;relabel_action&gt;</code>ç¡®å®šè¦æ‰§è¡Œçš„é‡æ–°æ ‡è®°æ“ä½œï¼š</p>
<ul>
<li><code>replace</code>ï¼šåŒ¹é…<code>æ­£åˆ™è¡¨è¾¾å¼</code>é’ˆå¯¹ä¸²è”çš„<code>source_labels</code>. ç„¶åï¼Œé›†åˆ<code>ç›®æ ‡_æ ‡ç­¾</code>åˆ°<code>replacement</code>ï¼Œå…·æœ‰åŒ¹é…ç»„å¼•ç”¨(<code>${1}</code> ,<code>${2}</code>ï¼Œâ€¦ï¼‰åœ¨<code>æ›¿æ¢</code>è¢«å®ƒä»¬çš„ä»·å€¼æ‰€å–ä»£ã€‚å¦‚æœ<code>regex</code>ä¸åŒ¹é…ï¼Œä¸è¿›è¡Œæ›¿æ¢</li>
<li><code>keep</code>ä¸ºå“ªä¸ªç›®æ ‡åˆ é™¤<code>æ­£åˆ™è¡¨è¾¾å¼</code>ä¸è¿æ¥çš„ä¸åŒ¹é…<code>source_labels</code> .</li>
<li><code>drop</code>ä¸ºå“ªä¸ªç›®æ ‡åˆ é™¤<code>æ­£åˆ™è¡¨è¾¾å¼</code>åŒ¹é…è¿æ¥çš„<code>source_labels</code> .</li>
<li><code>hashmod</code>ï¼šå¥—<code>ç›®æ ‡_æ ‡ç­¾</code>è‡´<code>modulus</code> è¿æ¥çš„<code>æºä»£ç æ ‡ç­¾</code> .</li>
<li><code>labelmap</code>ï¼šåŒ¹é…<code>æ­£åˆ™è¡¨è¾¾å¼</code>æ‰€æœ‰çš„æ ‡ç­¾åç§°ï¼Œç„¶åå°†åŒ¹é…æ ‡ç­¾çš„å€¼å¤åˆ¶åˆ°<code>replacement</code>å…·æœ‰åŒ¹é…ç»„å¼•ç”¨(<code>${1}</code> ,<code>${2}</code>ï¼Œâ€¦ï¼‰åœ¨<code>æ›¿æ¢</code>è¢«å®ƒä»¬çš„ä»·å€¼æ‰€å–ä»£</li>
<li><code>labeldrop</code>ï¼šåŒ¹é…<code>æ­£åˆ™è¡¨è¾¾å¼</code>æ‰€æœ‰çš„æ ‡ç­¾åç§°ã€‚ä»»ä½•åŒ¹é…çš„æ ‡ç­¾éƒ½å°†ä»æ ‡ç­¾é›†ä¸­åˆ é™¤ã€‚</li>
<li><code>labelkeep</code>ï¼šåŒ¹é…<code>æ­£åˆ™è¡¨è¾¾å¼</code>æ‰€æœ‰çš„æ ‡ç­¾åç§°ã€‚ä»»ä½•ä¸åŒ¹é…çš„æ ‡ç­¾å°†ä»æ ‡ç­¾é›†ä¸­åˆ é™¤ã€‚</li>
</ul>
<p>å¿…é¡»å°å¿ƒ<code>labeldrop</code>å’Œ<code>labelkeep</code>ä»¥ç¡®ä¿ä¸€æ—¦æ ‡ç­¾è¢«ç§»é™¤ï¼Œåº¦é‡ä»ç„¶æ˜¯å”¯ä¸€çš„ã€‚</p>
<p><br/></p>
<h4 id="2-åŸºç¡€ç¤ºä¾‹"><a href="#2-åŸºç¡€ç¤ºä¾‹" class="headerlink" title="(2) åŸºç¡€ç¤ºä¾‹"></a>(2) åŸºç¡€ç¤ºä¾‹</h4><ul>
<li>2.1) åŸºæœ¬å¸¸è§„ç›‘æ§ global config çš„yamlæ–‡ä»¶ç¤ºä¾‹<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - å…¨å±€é…ç½®</span></span><br><span class="line"><span class="attr">global:</span></span><br><span class="line"><span class="attr">  scrape_interval:</span> <span class="number">60</span><span class="string">s</span></span><br><span class="line"><span class="attr">  scrape_timeout:</span> <span class="number">10</span><span class="string">s</span></span><br><span class="line"><span class="attr">  evaluation_interval:</span> <span class="number">30</span><span class="string">s</span></span><br><span class="line"><span class="attr">  external_labels:</span></span><br><span class="line"><span class="attr">    monitor:</span> <span class="string">codelab</span></span><br><span class="line"><span class="attr">    foo:</span>     <span class="string">bar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - ç›‘æ§æŠ¥è­¦è§„åˆ™</span></span><br><span class="line"><span class="attr">rule_files:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">"mysql-alter.rules"</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">"./rules/*-alter.rules"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - æŠ¥è­¦ç®¡ç†æœåŠ¡è®¾ç½®</span></span><br><span class="line"><span class="attr">alerting:</span></span><br><span class="line"><span class="attr">  alertmanagers:</span></span><br><span class="line"><span class="attr">  - scheme:</span> <span class="string">http</span></span><br><span class="line"><span class="attr">    static_configs:</span></span><br><span class="line"><span class="attr">    - targets:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">["1.2.3.4:9093","1.2.3.5:9093","1.2.3.6:9093"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - åœ¨ä½¿ç”¨ pushgateway ç»„ä»¶æ—¶ä½¿ç”¨</span></span><br><span class="line"><span class="attr">remote_write:</span></span><br><span class="line"><span class="attr">  - url:</span> <span class="attr">http://remote1/push</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">drop_expensive</span></span><br><span class="line"><span class="attr">    write_relabel_configs:</span></span><br><span class="line"><span class="attr">    - source_labels:</span> <span class="string">[__name__]</span></span><br><span class="line"><span class="attr">      regex:</span>         <span class="string">expensive.*</span></span><br><span class="line"><span class="attr">      action:</span>        <span class="string">drop</span></span><br><span class="line"><span class="attr">  - url:</span> <span class="attr">https://remote2/push</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">rw_tls</span></span><br><span class="line"><span class="attr">    headers:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">value</span></span><br><span class="line"><span class="attr">    tls_config:</span></span><br><span class="line"><span class="attr">      cert_file:</span> <span class="string">valid_cert_file</span></span><br><span class="line"><span class="attr">      key_file:</span> <span class="string">valid_key_file</span> </span><br><span class="line"></span><br><span class="line"><span class="attr">remote_read:</span></span><br><span class="line"><span class="attr">  - url:</span> <span class="attr">http://remote1/read</span></span><br><span class="line"><span class="attr">    read_recent:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">  - url:</span> <span class="attr">https://remote3/read</span></span><br><span class="line"><span class="attr">    read_recent:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">read_special</span></span><br><span class="line"><span class="attr">    required_matchers:</span></span><br><span class="line"><span class="attr">      job:</span> <span class="string">special</span></span><br><span class="line"><span class="attr">    tls_config:</span></span><br><span class="line"><span class="attr">      cert_file:</span> <span class="string">valid_cert_file</span></span><br><span class="line"><span class="attr">      key_file:</span> <span class="string">valid_key_file</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - scrape é…ç½® (é‡ç‚¹)</span></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line"><span class="comment"># - å·¥ä½œä»»åŠ¡1</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">prometheus</span></span><br><span class="line">  <span class="comment"># scrape_interval is defined by the configured global (60s).</span></span><br><span class="line">  <span class="comment"># scrape_timeout is defined by the global default (10s).</span></span><br><span class="line"><span class="attr">  honor_labels:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  metrics_path:</span> <span class="string">'/metrics'</span></span><br><span class="line"><span class="attr">  scheme:</span> <span class="string">'http'</span></span><br><span class="line"><span class="attr">  file_sd_configs:</span></span><br><span class="line"><span class="attr">    - files:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">foo/*.slow.json</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">foo/*.slow.yml</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">single/file.yml</span></span><br><span class="line"><span class="attr">      refresh_interval:</span> <span class="number">10</span><span class="string">m</span></span><br><span class="line"><span class="attr">    - files:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">bar/*.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  static_configs:</span></span><br><span class="line"><span class="attr">  - targets:</span> <span class="string">['localhost:9090',</span> <span class="string">'localhost:9191'</span><span class="string">]</span></span><br><span class="line"><span class="attr">    labels:</span></span><br><span class="line"><span class="attr">      key1:</span> <span class="string">label</span></span><br><span class="line"><span class="attr">      your:</span> <span class="string">label</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  relabel_configs:</span></span><br><span class="line"><span class="attr">  - source_labels:</span> <span class="string">[job,</span> <span class="string">__meta_dns_name]</span></span><br><span class="line"><span class="attr">    regex:</span>         <span class="string">(.*)some-[regex]</span></span><br><span class="line"><span class="attr">    target_label:</span>  <span class="string">job</span></span><br><span class="line"><span class="attr">    replacement:</span>   <span class="string">foo-$&#123;1&#125;</span></span><br><span class="line"><span class="attr">    action:</span> <span class="string">'replace'</span></span><br><span class="line"><span class="attr">  - source_labels:</span> <span class="string">[abc]</span></span><br><span class="line"><span class="attr">    target_label:</span>  <span class="string">cde</span></span><br><span class="line"><span class="attr">  - replacement:</span>   <span class="string">static</span></span><br><span class="line"><span class="attr">    target_label:</span>  <span class="string">abc</span></span><br><span class="line"><span class="attr">  - regex:</span></span><br><span class="line"><span class="attr">    replacement:</span>   <span class="string">static</span></span><br><span class="line"><span class="attr">    target_label:</span>  <span class="string">abc</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  authorization:</span></span><br><span class="line"><span class="attr">    credentials_file:</span> <span class="string">valid_token_file</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - å·¥ä½œä»»åŠ¡2</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">service-x</span></span><br><span class="line"><span class="attr">  scrape_interval:</span> <span class="number">50</span><span class="string">s</span></span><br><span class="line"><span class="attr">  scrape_timeout:</span>  <span class="number">5</span><span class="string">s</span></span><br><span class="line"><span class="attr">  sample_limit:</span> <span class="number">1000</span></span><br><span class="line"><span class="attr">  metrics_path:</span> <span class="string">/my_path</span></span><br><span class="line"><span class="attr">  scheme:</span> <span class="string">https</span></span><br><span class="line"><span class="attr">  basic_auth:</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">admin_name</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">"multiline\nmysecret\ntest"</span></span><br><span class="line"><span class="attr">  dns_sd_configs:</span></span><br><span class="line"><span class="attr">  - refresh_interval:</span> <span class="number">15</span><span class="string">s</span></span><br><span class="line"><span class="attr">    names:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">first.dns.address.domain.com</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">second.dns.address.domain.com</span></span><br><span class="line"><span class="attr">  - names:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">first.dns.address.domain.com</span></span><br><span class="line">    <span class="comment"># refresh_interval defaults to 30s.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  relabel_configs:</span></span><br><span class="line"><span class="attr">  - source_labels:</span> <span class="string">[job]</span></span><br><span class="line"><span class="attr">    regex:</span>         <span class="string">(.*)some-[regex]</span></span><br><span class="line"><span class="attr">    action:</span>        <span class="string">drop</span></span><br><span class="line"><span class="attr">  - source_labels:</span> <span class="string">[__address__]</span></span><br><span class="line"><span class="attr">    modulus:</span>       <span class="number">8</span></span><br><span class="line"><span class="attr">    target_label:</span>  <span class="string">__tmp_hash</span></span><br><span class="line"><span class="attr">    action:</span>        <span class="string">hashmod</span></span><br><span class="line"><span class="attr">  - source_labels:</span> <span class="string">[__tmp_hash]</span></span><br><span class="line"><span class="attr">    regex:</span>         <span class="number">1</span></span><br><span class="line"><span class="attr">    action:</span>        <span class="string">keep</span></span><br><span class="line"><span class="attr">  - action:</span>        <span class="string">labelmap</span></span><br><span class="line"><span class="attr">    regex:</span>         <span class="number">1</span></span><br><span class="line"><span class="attr">  - action:</span>        <span class="string">labeldrop</span></span><br><span class="line"><span class="attr">    regex:</span>         <span class="string">d</span></span><br><span class="line"><span class="attr">  - action:</span>        <span class="string">labelkeep</span></span><br><span class="line"><span class="attr">    regex:</span>         <span class="string">k</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  metric_relabel_configs:</span></span><br><span class="line"><span class="attr">  - source_labels:</span> <span class="string">[__name__]</span></span><br><span class="line"><span class="attr">    regex:</span>         <span class="string">expensive_metric.*</span></span><br><span class="line"><span class="attr">    action:</span>        <span class="string">drop</span></span><br><span class="line"><span class="attr">  - source_labels:</span> <span class="string">[pod_name]</span></span><br><span class="line"><span class="attr">    separator:</span> <span class="string">;</span></span><br><span class="line"><span class="attr">    regex:</span> <span class="string">(.+)</span></span><br><span class="line"><span class="attr">    target_label:</span> <span class="string">pod</span></span><br><span class="line"><span class="attr">    replacement:</span> <span class="string">$1</span></span><br><span class="line"><span class="attr">    action:</span> <span class="string">replace</span></span><br><span class="line"><span class="comment"># - å·¥ä½œä»»åŠ¡2 - consul æœåŠ¡å‘ç°</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">service-y</span></span><br><span class="line"><span class="attr">  consul_sd_configs:</span></span><br><span class="line"><span class="attr">  - server:</span> <span class="string">'localhost:1234'</span></span><br><span class="line"><span class="attr">    token:</span> <span class="string">mysecret</span></span><br><span class="line"><span class="attr">    services:</span> <span class="string">['nginx',</span> <span class="string">'cache'</span><span class="string">,</span> <span class="string">'mysql'</span><span class="string">]</span></span><br><span class="line"><span class="attr">    tags:</span> <span class="string">["canary",</span> <span class="string">"v1"</span><span class="string">]</span></span><br><span class="line"><span class="attr">    node_meta:</span></span><br><span class="line"><span class="attr">      rack:</span> <span class="string">"123"</span></span><br><span class="line"><span class="attr">    allow_stale:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    scheme:</span> <span class="string">https</span></span><br><span class="line"><span class="attr">    tls_config:</span></span><br><span class="line"><span class="attr">      ca_file:</span> <span class="string">valid_ca_file</span></span><br><span class="line"><span class="attr">      cert_file:</span> <span class="string">valid_cert_file</span></span><br><span class="line"><span class="attr">      key_file:</span>  <span class="string">valid_key_file</span></span><br><span class="line"><span class="attr">      insecure_skip_verify:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  relabel_configs:</span></span><br><span class="line"><span class="attr">  - source_labels:</span> <span class="string">[__meta_sd_consul_tags]</span></span><br><span class="line"><span class="attr">    separator:</span>     <span class="string">','</span></span><br><span class="line"><span class="attr">    regex:</span>         <span class="attr">label:([^=]+)=([^,]+)</span></span><br><span class="line"><span class="attr">    target_label:</span>  <span class="string">$&#123;1&#125;</span></span><br><span class="line"><span class="attr">    replacement:</span>   <span class="string">$&#123;2&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - å·¥ä½œä»»åŠ¡3</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">service-z</span></span><br><span class="line"><span class="attr">  tls_config:</span></span><br><span class="line"><span class="attr">    cert_file:</span> <span class="string">valid_cert_file</span></span><br><span class="line"><span class="attr">    key_file:</span> <span class="string">valid_key_file</span></span><br><span class="line"><span class="attr">  authorization:</span></span><br><span class="line"><span class="attr">    credentials:</span> <span class="string">mysecret</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - å·¥ä½œä»»åŠ¡4 - kubernetes ç›¸å…³æœåŠ¡å‘ç°(é‡ç‚¹)</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">service-kubernetes</span></span><br><span class="line"><span class="attr">  kubernetes_sd_configs:</span></span><br><span class="line"><span class="attr">  - role:</span> <span class="string">endpoints</span></span><br><span class="line"><span class="attr">    api_server:</span> <span class="string">'https://localhost:1234'</span></span><br><span class="line"><span class="attr">    tls_config:</span></span><br><span class="line"><span class="attr">      cert_file:</span> <span class="string">valid_cert_file</span></span><br><span class="line"><span class="attr">      key_file:</span> <span class="string">valid_key_file</span></span><br><span class="line"><span class="attr">    basic_auth:</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">'myusername'</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">'mysecret'</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">service-kubernetes-namespaces</span></span><br><span class="line"><span class="attr">  kubernetes_sd_configs:</span></span><br><span class="line"><span class="attr">  - role:</span> <span class="string">endpoints</span></span><br><span class="line"><span class="attr">    api_server:</span> <span class="string">'https://localhost:1234'</span></span><br><span class="line"><span class="attr">    namespaces:</span></span><br><span class="line"><span class="attr">      names:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">default</span></span><br><span class="line"><span class="attr">  basic_auth:</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">'myusername'</span></span><br><span class="line"><span class="attr">    password_file:</span> <span class="string">valid_password_file</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - å·¥ä½œä»»åŠ¡5</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">service-marathon</span></span><br><span class="line"><span class="attr">  marathon_sd_configs:</span></span><br><span class="line"><span class="attr">  - servers:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">'https://marathon.example.com:443'</span></span><br><span class="line"><span class="attr">    auth_token:</span> <span class="string">"mysecret"</span></span><br><span class="line"><span class="attr">    tls_config:</span></span><br><span class="line"><span class="attr">      cert_file:</span> <span class="string">valid_cert_file</span></span><br><span class="line"><span class="attr">      key_file:</span> <span class="string">valid_key_file</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - å·¥ä½œä»»åŠ¡6</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">service-ec2</span></span><br><span class="line"><span class="attr">  ec2_sd_configs:</span></span><br><span class="line"><span class="attr">    - region:</span> <span class="string">us-east-1</span></span><br><span class="line"><span class="attr">      access_key:</span> <span class="string">access</span></span><br><span class="line"><span class="attr">      secret_key:</span> <span class="string">mysecret</span></span><br><span class="line"><span class="attr">      profile:</span> <span class="string">profile</span></span><br><span class="line"><span class="attr">      filters:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="attr">tag:environment</span></span><br><span class="line"><span class="attr">          values:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">prod</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="attr">tag:service</span></span><br><span class="line"><span class="attr">          values:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">web</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">db</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - å·¥ä½œä»»åŠ¡7</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">service-azure</span></span><br><span class="line"><span class="attr">  azure_sd_configs:</span></span><br><span class="line"><span class="attr">    - environment:</span> <span class="string">AzurePublicCloud</span></span><br><span class="line"><span class="attr">      authentication_method:</span> <span class="string">OAuth</span></span><br><span class="line"><span class="attr">      subscription_id:</span> <span class="number">11</span><span class="string">AAAA11-A11A-111A-A111-1111A1111A11</span></span><br><span class="line"><span class="attr">      tenant_id:</span> <span class="string">BBBB222B-B2B2-2B22-B222-2BB2222BB2B2</span></span><br><span class="line"><span class="attr">      client_id:</span> <span class="number">333333</span><span class="string">CC-3C33-3333-CCC3-33C3CCCCC33C</span></span><br><span class="line"><span class="attr">      client_secret:</span> <span class="string">mysecret</span></span><br><span class="line"><span class="attr">      port:</span> <span class="number">9100</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - å·¥ä½œä»»åŠ¡8</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">service-nerve</span></span><br><span class="line"><span class="attr">  nerve_sd_configs:</span></span><br><span class="line"><span class="attr">    - servers:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">localhost</span></span><br><span class="line"><span class="attr">      paths:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/monitoring</span></span><br><span class="line"><span class="comment"># - å·¥ä½œä»»åŠ¡9</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="number">0123</span><span class="string">service-xxx</span></span><br><span class="line"><span class="attr">  metrics_path:</span> <span class="string">/metrics</span></span><br><span class="line"><span class="attr">  static_configs:</span></span><br><span class="line"><span class="attr">    - targets:</span></span><br><span class="line"><span class="attr">      - localhost:</span><span class="number">9090</span></span><br><span class="line"><span class="comment"># - å·¥ä½œä»»åŠ¡10</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">badfederation</span></span><br><span class="line"><span class="attr">  honor_timestamps:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  metrics_path:</span> <span class="string">/federate</span></span><br><span class="line"><span class="attr">  static_configs:</span></span><br><span class="line"><span class="attr">    - targets:</span></span><br><span class="line"><span class="attr">      - localhost:</span><span class="number">9090</span></span><br><span class="line"><span class="comment"># - å·¥ä½œä»»åŠ¡11(æ”¯æŒä¸­æ–‡å’Œç¹æ–‡)</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">æµ‹è¯•</span></span><br><span class="line"><span class="attr">  metrics_path:</span> <span class="string">/metrics</span></span><br><span class="line"><span class="attr">  static_configs:</span></span><br><span class="line"><span class="attr">    - targets:</span></span><br><span class="line"><span class="attr">      - localhost:</span><span class="number">9090</span></span><br><span class="line"><span class="comment"># - å·¥ä½œä»»åŠ¡12</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">service-triton</span></span><br><span class="line"><span class="attr">  triton_sd_configs:</span></span><br><span class="line"><span class="attr">  - account:</span> <span class="string">'testAccount'</span></span><br><span class="line"><span class="attr">    dns_suffix:</span> <span class="string">'triton.example.com'</span></span><br><span class="line"><span class="attr">    endpoint:</span> <span class="string">'triton.example.com'</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">9163</span></span><br><span class="line"><span class="attr">    refresh_interval:</span> <span class="number">1</span><span class="string">m</span></span><br><span class="line"><span class="attr">    version:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">    tls_config:</span></span><br><span class="line"><span class="attr">      cert_file:</span> <span class="string">valid_cert_file</span></span><br><span class="line"><span class="attr">      key_file:</span> <span class="string">valid_key_file</span></span><br><span class="line"><span class="comment"># - å·¥ä½œä»»åŠ¡13</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">digitalocean-droplets</span></span><br><span class="line"><span class="attr">  digitalocean_sd_configs:</span></span><br><span class="line"><span class="attr">    - authorization:</span></span><br><span class="line"><span class="attr">        credentials:</span> <span class="string">abcdef</span></span><br><span class="line"><span class="comment"># - å·¥ä½œä»»åŠ¡14</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">dockerswarm</span></span><br><span class="line"><span class="attr">  dockerswarm_sd_configs:</span></span><br><span class="line"><span class="attr">  - host:</span> <span class="attr">http://127.0.0.1:2375</span></span><br><span class="line"><span class="attr">    role:</span> <span class="string">nodes</span></span><br><span class="line"><span class="comment"># - å·¥ä½œä»»åŠ¡15 - (openstack)</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">service-openstack</span></span><br><span class="line"><span class="attr">  openstack_sd_configs:</span></span><br><span class="line"><span class="attr">  - role:</span> <span class="string">instance</span></span><br><span class="line"><span class="attr">    region:</span> <span class="string">RegionOne</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">    refresh_interval:</span> <span class="number">1</span><span class="string">m</span></span><br><span class="line"><span class="attr">    tls_config:</span></span><br><span class="line"><span class="attr">      ca_file:</span> <span class="string">valid_ca_file</span></span><br><span class="line"><span class="attr">      cert_file:</span> <span class="string">valid_cert_file</span></span><br><span class="line"><span class="attr">      key_file:</span>  <span class="string">valid_key_file</span></span><br><span class="line"><span class="comment"># - å·¥ä½œä»»åŠ¡16</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">hetzner</span></span><br><span class="line"><span class="attr">  hetzner_sd_configs:</span></span><br><span class="line"><span class="attr">    - role:</span> <span class="string">hcloud</span></span><br><span class="line"><span class="attr">      authorization:</span></span><br><span class="line"><span class="attr">        credentials:</span> <span class="string">abcdef</span></span><br><span class="line"><span class="attr">    - role:</span> <span class="string">robot</span></span><br><span class="line"><span class="attr">      basic_auth:</span></span><br><span class="line"><span class="attr">        username:</span> <span class="string">abcdef</span></span><br><span class="line"><span class="attr">        password:</span> <span class="string">abcdef</span></span><br><span class="line"><span class="comment"># - å·¥ä½œä»»åŠ¡17</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">service-eureka</span></span><br><span class="line"><span class="attr">  eureka_sd_configs:</span></span><br><span class="line"><span class="attr">    - server:</span> <span class="string">'http://eureka.example.com:8761/eureka'</span></span><br><span class="line"><span class="comment"># - å·¥ä½œä»»åŠ¡18</span></span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">scaleway</span></span><br><span class="line"><span class="attr">  scaleway_sd_configs:</span></span><br><span class="line"><span class="attr">    - role:</span> <span class="string">instance</span></span><br><span class="line"><span class="attr">      project_id:</span> <span class="number">11111111</span><span class="bullet">-1111</span><span class="bullet">-1111</span><span class="bullet">-1111</span><span class="bullet">-111111111112</span></span><br><span class="line"><span class="attr">      access_key:</span> <span class="string">SCWXXXXXXXXXXXXXXXXX</span></span><br><span class="line"><span class="attr">      secret_key:</span> <span class="number">11111111</span><span class="bullet">-1111</span><span class="bullet">-1111</span><span class="bullet">-1111</span><span class="bullet">-111111111111</span></span><br><span class="line"><span class="attr">    - role:</span> <span class="string">baremetal</span></span><br><span class="line"><span class="attr">      project_id:</span> <span class="number">11111111</span><span class="bullet">-1111</span><span class="bullet">-1111</span><span class="bullet">-1111</span><span class="bullet">-111111111112</span></span><br><span class="line"><span class="attr">      access_key:</span> <span class="string">SCWXXXXXXXXXXXXXXXXX</span></span><br><span class="line"><span class="attr">      secret_key:</span> <span class="number">11111111</span><span class="bullet">-1111</span><span class="bullet">-1111</span><span class="bullet">-1111</span><span class="bullet">-111111111111</span></span><br></pre></td></tr></table></figure></li>
<li><p>2.2) kubernetes é›†ç¾¤ç›‘æ§æœåŠ¡å‘ç°é…ç½®: <a href="https://github.com/prometheus/prometheus/blob/release-2.26/documentation/examples/prometheus-kubernetes.yml" target="_blank" rel="noopener">https://github.com/prometheus/prometheus/blob/release-2.26/documentation/examples/prometheus-kubernetes.yml</a></p>
</li>
<li><p>2.3) # - è¡¥å……: å®é™…å·¥ä½œä»»åŠ¡ç¤ºä¾‹19</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- job_name:</span> <span class="string">'prometheus'</span>Â  <span class="comment">###è¿™ä¸ªå¿…é¡»é…ç½®ï¼Œè¿™ä¸ªåœ°å€æŠ“å–çš„æ‰€æœ‰æ•°æ®ä¼šè‡ªåŠ¨åŠ ä¸Š`job=prometheus`çš„æ ‡ç­¾Â  Â </span></span><br><span class="line">  <span class="comment"># metrics_path defaults to '/metrics' #æŠ“å–ç›‘æ§ç›®æ ‡çš„è·¯å¾„ï¼Œé»˜è®¤æ˜¯/metrics å¯ä»¥æ ¹æ®è‡ªå·±ä¸šåŠ¡çš„éœ€è¦è¿›è¡Œä¿®Â  </span></span><br><span class="line">  <span class="comment"># scheme defaults to 'http'.Â  Â  </span></span><br><span class="line"><span class="attr">  static_configs:</span> Â  <span class="comment">#è¿™æ˜¯é€šè¿‡é™æ€æ–‡ä»¶çš„é…ç½®æ–¹æ³•ï¼šè¿™ç§æ–¹æ³•ç›´æ¥æŒ‡å®šè¦æŠ“å»ç›®æ ‡çš„ipå’Œç«¯å£Â  Â  </span></span><br><span class="line"><span class="attr">  - targets:</span> <span class="string">['localhost:9090']</span>Â </span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">gateway</span>Â  Â  </span><br><span class="line"><span class="attr">  static_configs:</span>Â Â  Â  </span><br><span class="line"><span class="attr">  - targets:</span> <span class="string">['127.0.0.1:9091']</span>Â  Â  Â  </span><br><span class="line"><span class="attr">  labels:</span> Â  <span class="comment"># æ‰“ä¸Šæ ‡ç­¾ instanceä¼šè¢«æŒ‡å®šä¸º'gataway'</span></span><br><span class="line"><span class="attr">    instance:</span> <span class="string">gataway</span>Â  </span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">node_export</span>Â  Â  </span><br><span class="line"><span class="attr">  file_sd_configs:</span>Â Â  Â  Â  </span><br><span class="line"><span class="attr">    refresh_interval:</span> <span class="number">1</span><span class="string">m</span>   <span class="comment"># åˆ·æ–°å‘ç°æ–‡ä»¶çš„æ—¶é—´é—´éš”Â  Â  Â  </span></span><br><span class="line"><span class="attr">    - files:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">/data/prometheus-2.12.0.linux-amd64/node_discovery.json</span>Â  </span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">mysql_discovery</span></span><br><span class="line"><span class="attr">  file_sd_configs:</span></span><br><span class="line"><span class="attr">  refresh_interval:</span> <span class="number">1</span><span class="string">m</span> <span class="comment"># åˆ·æ–°å‘ç°æ–‡ä»¶çš„æ—¶é—´é—´éš”Â  Â  Â </span></span><br><span class="line"><span class="attr">  - files:</span>Â  Â  Â  Â  </span><br><span class="line"><span class="bullet">    -</span> <span class="string">/data/prometheus-2.12.0.linux-amd64/mysql_discovery.json</span>Â  </span><br><span class="line"><span class="attr">- job_name:</span> <span class="string">redis_discovery</span>Â  Â  </span><br><span class="line"><span class="attr">  file_sd_configs:</span>Â Â  Â  Â  </span><br><span class="line"><span class="attr">  refresh_interval:</span> <span class="number">1</span><span class="string">m</span> <span class="comment"># åˆ·æ–°å‘ç°æ–‡ä»¶çš„æ—¶é—´é—´éš”Â  Â  Â </span></span><br><span class="line"><span class="attr">  - files:</span>Â  <span class="comment"># å¤‡æ³¨ï¼šå°½é‡ä½¿ç”¨åŠ¨æ€å‘ç°çš„é…ç½®ä»¥å…é…ç½®æ–‡ä»¶è¿‡é•¿</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">/data/prometheus-2.12.0.linux-amd64/redis_discovery.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################# discovery files æ¨¡ç‰ˆç¤ºä¾‹ #################</span></span><br><span class="line"><span class="comment"># æ–¹å¼1./data/prometheus-2.12.0.linux-amd64/node_discovery.jsonÂ  </span></span><br><span class="line"><span class="string">[</span></span><br><span class="line">  <span class="string">&#123;"targets":</span> <span class="string">["127.0.0.1:9100"],"labels":</span> <span class="string">&#123;"instance":</span> <span class="string">"test"</span><span class="string">,"idc":</span> <span class="string">"beijing"</span><span class="string">&#125;&#125;,</span></span><br><span class="line">  <span class="string">&#123;"targets":</span> <span class="string">["127.0.0.1:9101"],"labels":</span> <span class="string">&#123;"instance":</span> <span class="string">"test2"</span><span class="string">,"idc":</span> <span class="string">"beijing"</span><span class="string">&#125;&#125;</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2./data/prometheus-2.12.0.linux-amd64/redis_discovery.yaml</span></span><br><span class="line"><span class="attr">- targets:</span> <span class="string">[</span> <span class="string">'127.0.0.1:9199'</span><span class="string">,'192.168.1.1:9199'</span> <span class="string">]</span> </span><br><span class="line"><span class="attr">  labels:</span> <span class="string">&#123;</span> <span class="string">"env"</span><span class="string">:</span> <span class="string">"production"</span><span class="string">,"instance":</span> <span class="string">"node-1"</span> <span class="string">&#125;</span></span><br><span class="line"><span class="attr">- targets:</span> <span class="string">[</span> <span class="string">'192.168.1.3:9199'</span><span class="string">,'192.168.1.3:9199'</span> <span class="string">]</span> </span><br><span class="line"><span class="attr">  labels:</span> <span class="string">&#123;</span> <span class="string">"env"</span><span class="string">:</span> <span class="string">"production"</span><span class="string">,"instance":</span> <span class="string">"node-2"</span> <span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h4 id="3-API-Rsetful"><a href="#3-API-Rsetful" class="headerlink" title="(3) API Rsetful"></a>(3) API Rsetful</h4><p>æè¿°: Prometheus åœ¨ 2.0 ç‰ˆæœ¬ä»¥åå·²ç»æä¾›äº†ä¸€ä¸ªç®€å•çš„ç®¡ç†æ¥å£ï¼Œå¯ä»¥æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œå¯¹Prometheusæ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥ï¼Œæ³¨æ„å¦‚æœè¦ä½¿ç”¨APIå°±å¿…é¡»æ·»åŠ å¯åŠ¨å‚æ•°<code>--web.enable-admin-api</code>é»˜è®¤æ˜¯å…³é—­çš„ã€‚</p>
<p>ä¸‹è¿°æ˜¯<code>Prometheus</code>å¸¸ç”¨çš„API RESTfulæ¥å£ç¤ºä¾‹,å¦‚æœæƒ³è¦ä½¿ç”¨:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) æŸ¥è¯¢æŒ‡å®šå‚æ•°è¿”å›çš„æŒ‡æ ‡åç§°å’Œå€¼</span></span><br><span class="line">http://192.168.12.107:30090/api/v1/series?match[]=up</span><br><span class="line">http://192.168.12.107:30090/api/v1/series?match[]=&#123;service_name=%22kube-state-metrics%22&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æŸ¥è¯¢æŒ‡å®šæ ‡ç­¾çš„Valueså€¼</span></span><br><span class="line">http://192.168.12.107:30090/api/v1/label/instance/values</span><br><span class="line">  <span class="comment"># status	"success"</span></span><br><span class="line">  <span class="comment"># data	[â€¦]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) åˆ é™¤tsdbä¸­æŒ‡å®šJob Nameçš„metric</span></span><br><span class="line">http://localhost:30090/api/v1/admin/tsdb/delete_series?match[]=up&amp;match[]=&#123;job=~<span class="string">'kubernetes-kube-state'</span>&#125;<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># (4) é€šè¿‡APIæ¥å£è¿›è¡Œé‡è½½Prometheusé…ç½®</span></span><br><span class="line"><span class="string">http://localhost:30090/-/reload</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="Alert-rules"><a href="#Alert-rules" class="headerlink" title="Alert.rules"></a>Alert.rules</h3><p>æè¿°: è¯¥æ–‡ä»¶ä¸»è¦æ˜¯è®°å½•(Recording)è§„åˆ™å’Œè­¦æŠ¥(Alert)è§„åˆ™æ–‡ä»¶,å°†PrometheusæœåŠ¡ç«¯pullä¸‹æ¥çš„ç›‘æ§æŒ‡æ ‡å‚æ•°è¿›è¡ŒåŒ¹é…å¯¹æ¯”,å¦‚åŒ¹é…ä¸Šåˆ™æŠ¥è­¦æˆ–è€…ä¾‹åˆ©ç”¨Alertmanagerå‘é€æŠ¥è­¦ä¿¡æ¯ã€‚</p>
<p>Prometheus æ”¯æŒä¸¤ç§ç±»å‹çš„è§„åˆ™å¯ä»¥é…ç½®ç„¶åå®šæœŸè¯„ä¼°ï¼šè®°å½•è§„åˆ™å’Œè­¦æŠ¥è§„åˆ™, è¦åœ¨Prometheusä¸­åŒ…å«è§„åˆ™è¯·åˆ›å»ºä¸€ä¸ªåŒ…å«å¿…è¦è§„åˆ™è¯­å¥çš„æ–‡ä»¶, å¹¶è®©Prometheusé€šè¿‡Prometheusé…ç½®ä¸­çš„<code>rule_files</code>å­—æ®µåŠ è½½è¯¥æ–‡ä»¶(YAMLæ ¼å¼)ã€‚</p>
<h4 id="1-è¯­æ³•æ ¼å¼-1"><a href="#1-è¯­æ³•æ ¼å¼-1" class="headerlink" title="(1) è¯­æ³•æ ¼å¼"></a>(1) è¯­æ³•æ ¼å¼</h4><ul>
<li>1.å½•åˆ¶è§„åˆ™(<code>Defining recording rules</code>): å½•åˆ¶è§„åˆ™å…è®¸æ‚¨é¢„è®¡ç®—ç»å¸¸éœ€è¦æˆ–è®¡ç®—ä»£ä»·é«˜æ˜‚çš„è¡¨è¾¾å¼ï¼Œå¹¶å°†å…¶ç»“æœä¿å­˜ä¸ºä¸€ç»„æ–°çš„æ—¶é—´åºåˆ—ã€‚<ul>
<li>æŸ¥è¯¢é¢„è®¡ç®—ç»“æœé€šå¸¸æ¯”æ¯æ¬¡éœ€è¦æ—¶æ‰§è¡ŒåŸå§‹è¡¨è¾¾å¼å¿«å¾—å¤š, è¿™å¯¹äºä»ªè¡¨æ¿å°¤å…¶æœ‰ç”¨,ç”±äºä»ªè¡¨æ¿æ¯æ¬¡åˆ·æ–°æ—¶éƒ½éœ€è¦é‡å¤æŸ¥è¯¢ç›¸åŒçš„è¡¨è¾¾å¼ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Syntax-checking rules </span></span><br><span class="line">promtool check rules /path/to/example.rules.yml</span><br><span class="line"></span><br><span class="line"><span class="comment"># Syntax</span></span><br><span class="line">groups:</span><br><span class="line">  <span class="comment"># The name of the group. Must be unique within a file.</span></span><br><span class="line">  name: &lt;string&gt;</span><br><span class="line">  <span class="comment"># How often rules in the group are evaluated.</span></span><br><span class="line">  [ interval: &lt;duration&gt; | default = global.evaluation_interval ]</span><br><span class="line"></span><br><span class="line">rules:</span><br><span class="line">  <span class="comment"># ------- å½•åˆ¶è§„åˆ™çš„è¯­æ³•ä¸ºï¼š---------</span></span><br><span class="line">  <span class="comment"># The name of the time series to output to. Must be a valid metric name.</span></span><br><span class="line">  record: &lt;string&gt;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># The PromQL expression to evaluate. Every evaluation cycle this is</span></span><br><span class="line">  <span class="comment"># evaluated at the current time, and the result recorded as a new set of</span></span><br><span class="line">  <span class="comment"># time series with the metric name as given by 'record'.</span></span><br><span class="line">  expr: &lt;string&gt;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Labels to add or overwrite before storing the result.</span></span><br><span class="line">  labels:</span><br><span class="line">    [ &lt;labelname&gt;: &lt;labelvalue&gt; ]</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p><br/></p>
<ul>
<li>2.è­¦æŠ¥è§„åˆ™(<code>Alerting rules</code>)ï¼šå…è®¸æ‚¨åŸºäº <code>Prometheus expression</code>è¯­è¨€è¡¨è¾¾å¼å®šä¹‰è­¦æŠ¥æ¡ä»¶ï¼Œå¹¶å‘å¤–éƒ¨æœåŠ¡å‘é€æœ‰å…³è§¦å‘è­¦æŠ¥çš„é€šçŸ¥ã€‚æ¯å½“è­¦æŠ¥è¡¨è¾¾å¼åœ¨ç»™å®šçš„æ—¶é—´ç‚¹äº§ç”Ÿä¸€ä¸ªæˆ–å¤šä¸ªå‘é‡å…ƒç´ æ—¶ï¼Œè­¦æŠ¥å°†å¯¹è¿™äº›å…ƒç´ çš„æ ‡ç­¾é›†è®¡ä¸ºæ´»åŠ¨ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Syntax</span></span><br><span class="line">groups:</span><br><span class="line">  <span class="comment"># The name of the group. Must be unique within a file.</span></span><br><span class="line">  name: &lt;string&gt;</span><br><span class="line">  <span class="comment"># How often rules in the group are evaluated.</span></span><br><span class="line">  [ interval: &lt;duration&gt; | default = global.evaluation_interval ]</span><br><span class="line"></span><br><span class="line">rules:</span><br><span class="line">  <span class="comment"># ------- è­¦æŠ¥è§„åˆ™çš„è¯­æ³•æ˜¯ï¼š---------</span></span><br><span class="line">  <span class="comment"># The name of the alert. Must be a valid label value.</span></span><br><span class="line">  alert: &lt;string&gt;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># The PromQL expression to evaluate. Every evaluation cycle this is</span></span><br><span class="line">  <span class="comment"># evaluated at the current time, and all resultant time series become</span></span><br><span class="line">  <span class="comment"># pending/firing alerts.</span></span><br><span class="line">  expr: &lt;string&gt;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Alerts are considered firing once they have been returned for this long.</span></span><br><span class="line">  <span class="comment"># Alerts which have not yet fired for long enough are considered pending.</span></span><br><span class="line">  [ <span class="keyword">for</span>: &lt;duration&gt; | default = 0s ]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Labels to add or overwrite for each alert.</span></span><br><span class="line">  labels:</span><br><span class="line">    [ &lt;labelname&gt;: &lt;tmpl_string&gt; ]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Annotations to add to each alert.</span></span><br><span class="line">  annotations:</span><br><span class="line">    [ &lt;labelname&gt;: &lt;tmpl_string&gt; ]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h4 id="2-åŸºç¡€ç¤ºä¾‹-1"><a href="#2-åŸºç¡€ç¤ºä¾‹-1" class="headerlink" title="(2) åŸºç¡€ç¤ºä¾‹"></a>(2) åŸºç¡€ç¤ºä¾‹</h4><ul>
<li><p>1) Defining recording rules: A simple example rules file would be:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">groups:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">example</span></span><br><span class="line"><span class="attr">    rules:</span></span><br><span class="line"><span class="attr">    - record:</span> <span class="attr">job:http_inprogress_requests:sum</span></span><br><span class="line"><span class="attr">      expr:</span> <span class="string">sum</span> <span class="string">by</span> <span class="string">(job)</span> <span class="string">(http_inprogress_requests)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -- K8s Recording rule</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">k8s.rules</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">  - expr:</span> <span class="string">sum(rate(container_cpu_usage_seconds_total[5m]))</span> <span class="string">by</span> <span class="string">(namespace)</span></span><br><span class="line"><span class="attr">    record:</span> <span class="attr">namespace:container_memory_usage_bytes:sum</span></span><br><span class="line"><span class="attr">  - expr:</span> <span class="string">sum(container_memory_usage_bytes)</span> <span class="string">by</span> <span class="string">(namespace)</span></span><br><span class="line"><span class="attr">    record:</span> <span class="attr">namespace:container_memory_usage_bytes:sum</span></span><br><span class="line"><span class="attr">  - expr:</span> <span class="string">sum</span> <span class="string">by</span> <span class="string">(namespace,pod_name,container_name)(rate(container_cpu_usage_seconds_total[5m]))</span></span><br><span class="line"><span class="attr">    record:</span> <span class="attr">namespace_pod_name_container_name:container_cpu_usage_seconds_total:sum_rate</span></span><br><span class="line"><span class="string">```</span>  </span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="number">2</span><span class="string">)</span> <span class="string">Defining</span> <span class="string">alerting</span> <span class="attr">rules:</span> <span class="string">An</span> <span class="string">example</span> <span class="string">rules</span> <span class="string">file</span> <span class="string">with</span> <span class="string">an</span> <span class="string">alert</span> <span class="string">would</span> <span class="attr">be:</span></span><br><span class="line"><span class="string">```yaml</span></span><br><span class="line"><span class="attr">groups:</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">example</span>  <span class="comment"># æŠ¥è­¦åˆ†ç»„</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">  - alert:</span> <span class="string">HighRequestLatency</span>  <span class="comment"># æŠ¥è­¦åç§°</span></span><br><span class="line"><span class="attr">    expr:</span> <span class="attr">job:request_latency_seconds:mean5m&#123;job="myjob"&#125;</span> <span class="string">&gt; 0.5  # è§„åˆ™è¡¨è¾¾å¼</span></span><br><span class="line"><span class="string"></span><span class="attr">    for:</span> <span class="number">10</span><span class="string">m</span>   <span class="comment"># æŒç»­æ—¶é—´å¦‚æœåœ¨10må†…å¤šæ¬¡æ”¶åˆ°æŠ¥è­¦åˆ™è¿›è¡Œå‘é€æŠ¥è­¦ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="attr">    labels:</span>    <span class="comment"># è§„åˆ™æ ‡ç­¾</span></span><br><span class="line"><span class="attr">      severity:</span> <span class="string">critical</span> <span class="comment"># æŠ¥è­¦çº§åˆ«</span></span><br><span class="line"><span class="attr">    annotations:</span>  <span class="comment"># æ³¨é‡Š å¯ä»¥åŠ å…¥labelå€¼å’Œvalueå€¼ </span></span><br><span class="line"><span class="attr">      summary:</span> <span class="string">"Instance <span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> High request latency"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>3) å®è·µç¯å¢ƒä¸­çš„æŠ¥è­¦è§„åˆ™</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">groups:</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">èŠ‚ç‚¹ç›‘æ§åŸºç¡€è§„åˆ™(Basic</span> <span class="string">Rules)</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">  - alert:</span> <span class="string">èŠ‚ç‚¹çŠ¶æ€å®•æœº</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">expr:</span> <span class="string">up</span> <span class="string">==</span> <span class="number">0</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">for:</span> <span class="number">2</span><span class="string">m</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">labels:</span></span><br><span class="line"><span class="attr">      severity:</span> <span class="string">critical</span></span><br><span class="line"><span class="attr">      status:</span> <span class="string">down</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">annotations:</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">summary:</span> <span class="string">"æ¥è‡ª <span class="template-variable">&#123;&#123; $labels.job &#125;&#125;</span> Job,èŠ‚ç‚¹ <span class="template-variable">&#123;&#123;$labels.instance&#125;&#125;</span> çŠ¶æ€å®•æœº"</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">description:</span> <span class="string">"èŠ‚ç‚¹ <span class="template-variable">&#123;&#123;$labels.instance&#125;&#125;</span> å®•æœºå·²è¶…è¿‡2åˆ†é’Ÿè¯·è¿›è¡Œäººå·¥å¤„ç†ã€‚"</span></span><br><span class="line"><span class="attr">  - alert:</span> <span class="string">CPU</span> <span class="string">ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">expr:</span> <span class="number">100</span><span class="bullet">-(avg(irate(node_cpu_seconds_total&#123;mode="idle"&#125;[5m]))</span> <span class="string">by(instance)*</span> <span class="number">100</span><span class="string">)</span> <span class="string">&gt; 70</span></span><br><span class="line"><span class="string">â€‹      for: 5m</span></span><br><span class="line"><span class="string">â€‹      labels:</span></span><br><span class="line"><span class="string"></span><span class="attr">      severity:</span> <span class="string">generality</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">status:</span> <span class="string">warning</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">annotations:</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">summary:</span> <span class="string">"èŠ‚ç‚¹ <span class="template-variable">&#123;&#123;$labels.mountpoint&#125;&#125;</span> CPU ä½¿ç”¨ç‡è¿‡é«˜ï¼"</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">description:</span> <span class="string">"èŠ‚ç‚¹ <span class="template-variable">&#123;&#123;$labels.mountpoint &#125;&#125;</span> CPUå·²æŒç»­3åˆ†é’Ÿä½¿ç”¨å¤§äº 70% (ç›®å‰ä½¿ç”¨:<span class="template-variable">&#123;&#123;$value&#125;&#125;</span>%)"</span></span><br><span class="line"><span class="attr">  - alert:</span> <span class="string">Memory</span> <span class="string">ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">expr:</span> <span class="number">100</span> <span class="bullet">-</span> <span class="string">(node_memory_MemTotal_bytes</span> <span class="bullet">-</span> <span class="string">node_memory_MemFree_bytes+node_memory_Buffers_bytes+node_memory_Cached_bytes</span> <span class="string">)</span> <span class="string">/</span> <span class="string">node_memory_MemTotal_bytes</span> <span class="string">*</span> <span class="number">100</span> <span class="string">&gt; 80</span></span><br><span class="line"><span class="string">â€‹      for: 1m</span></span><br><span class="line"><span class="string">â€‹      labels:</span></span><br><span class="line"><span class="string"></span><span class="attr">      severity:</span> <span class="string">generality</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">status:</span> <span class="string">warning</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">annotations:</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">summary:</span> <span class="string">"<span class="template-variable">&#123;&#123;$labels.mountpoint&#125;&#125;</span> å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ï¼"</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">description:</span> <span class="string">"<span class="template-variable">&#123;&#123;$labels.mountpoint &#125;&#125;</span> å†…å­˜ä½¿ç”¨å¤§äº80%(ç›®å‰ä½¿ç”¨:<span class="template-variable">&#123;&#123;$value&#125;&#125;</span>%)"</span></span><br><span class="line"><span class="attr">  - alert:</span> <span class="string">IO</span> <span class="string">æ€§èƒ½æƒ…å†µ</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">expr:</span> <span class="number">100</span> <span class="bullet">-</span> <span class="string">(avg(irate(node_disk_io_time_seconds_total[5m]))</span> <span class="string">by(instance)*</span> <span class="number">100</span><span class="string">)</span> <span class="string">&lt;</span> <span class="number">30</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">for:</span> <span class="number">2</span><span class="string">m</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">labels:</span></span><br><span class="line"><span class="attr">      severity:</span> <span class="string">generality</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">status:</span> <span class="string">warning</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">annotations:</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">summary:</span> <span class="string">"<span class="template-variable">&#123;&#123;$labels.mountpoint&#125;&#125;</span> æµå…¥ç£ç›˜IOä½¿ç”¨ç‡è¿‡é«˜ï¼"</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">description:</span> <span class="string">"<span class="template-variable">&#123;&#123;$labels.mountpoint &#125;&#125;</span> æµå…¥ç£ç›˜IOå¤§äº70%(ç›®å‰ä½¿ç”¨:<span class="template-variable">&#123;&#123;$value&#125;&#125;</span>)"</span></span><br><span class="line"><span class="attr">  - alert:</span> <span class="string">Network</span> <span class="string">æ¥æ”¶(receive)æƒ…å†µ</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">expr:</span> <span class="string">((sum(rate</span> <span class="string">(node_network_receive_bytes_total&#123;device!~'tap.*|veth.*|br.*|docker.*|virbr*|lo*'&#125;[5m]))</span> <span class="string">by</span> <span class="string">(instance))</span> <span class="string">/</span> <span class="number">100</span><span class="string">)</span> <span class="string">&gt; 102400</span></span><br><span class="line"><span class="string">â€‹      for: 5m</span></span><br><span class="line"><span class="string">â€‹      labels:</span></span><br><span class="line"><span class="string"></span><span class="attr">      severity:</span> <span class="string">generality</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">status:</span> <span class="string">warning</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">annotations:</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">summary:</span> <span class="string">"<span class="template-variable">&#123;&#123;$labels.mountpoint&#125;&#125;</span> æµå…¥ç½‘ç»œå¸¦å®½è¿‡é«˜ï¼"</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">description:</span> <span class="string">"<span class="template-variable">&#123;&#123;$labels.mountpoint &#125;&#125;</span> æµå…¥ç½‘ç»œå¸¦å®½æŒç»­5åˆ†é’Ÿé«˜äº100M. RXå¸¦å®½ä½¿ç”¨ç‡<span class="template-variable">&#123;&#123;$value&#125;&#125;</span>"</span></span><br><span class="line"><span class="attr">  - alert:</span> <span class="string">Network</span> <span class="string">ä¼ è¾“(transmit)æƒ…å†µ</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">expr:</span> <span class="string">((sum(rate</span> <span class="string">(node_network_transmit_bytes_total&#123;device!~'tap.*|veth.*|br.*|docker.*|virbr*|lo*'&#125;[5m]))</span> <span class="string">by</span> <span class="string">(instance))</span> <span class="string">/</span> <span class="number">100</span><span class="string">)</span> <span class="string">&gt; 102400</span></span><br><span class="line"><span class="string">â€‹      for: 1m</span></span><br><span class="line"><span class="string">â€‹      labels:</span></span><br><span class="line"><span class="string"></span><span class="attr">      severity:</span> <span class="string">generality</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">status:</span> <span class="string">warning</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">annotations:</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">summary:</span> <span class="string">"<span class="template-variable">&#123;&#123;$labels.mountpoint&#125;&#125;</span> æµå‡ºç½‘ç»œå¸¦å®½è¿‡é«˜ï¼"</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">description:</span> <span class="string">"<span class="template-variable">&#123;&#123;$labels.mountpoint &#125;&#125;</span>æµå‡ºç½‘ç»œå¸¦å®½æŒç»­2åˆ†é’Ÿé«˜äº100M. RXå¸¦å®½ä½¿ç”¨ç‡<span class="template-variable">&#123;&#123;$value&#125;&#125;</span>"</span></span><br><span class="line"><span class="attr">  - alert:</span> <span class="string">TCPä¼šè¯</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">expr:</span> <span class="string">node_netstat_Tcp_CurrEstab</span> <span class="string">&gt; 1000</span></span><br><span class="line"><span class="string">â€‹      for: 1m</span></span><br><span class="line"><span class="string">â€‹      labels:</span></span><br><span class="line"><span class="string"></span><span class="attr">      severity:</span> <span class="string">generality</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">status:</span> <span class="string">warning</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">annotations:</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">summary:</span> <span class="string">"<span class="template-variable">&#123;&#123;$labels.mountpoint&#125;&#125;</span> TCP_ESTABLISHEDè¿‡é«˜ï¼"</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">description:</span> <span class="string">"<span class="template-variable">&#123;&#123;$labels.mountpoint &#125;&#125;</span> TCP_ESTABLISHEDå¤§äº1000%(ç›®å‰ä½¿ç”¨:<span class="template-variable">&#123;&#123;$value&#125;&#125;</span>%)"</span></span><br><span class="line"><span class="attr">  - alert:</span> <span class="string">ç£ç›˜å®¹é‡</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">expr:</span> <span class="number">100</span><span class="bullet">-(node_filesystem_free_bytes&#123;fstype=~"ext4|xfs"&#125;/node_filesystem_size_bytes</span> <span class="string">&#123;fstype=~"ext4|xfs"&#125;*100)</span> <span class="string">&gt; 80</span></span><br><span class="line"><span class="string">â€‹      for: 1m</span></span><br><span class="line"><span class="string">â€‹      labels:</span></span><br><span class="line"><span class="string"></span><span class="attr">      severity:</span> <span class="string">generality</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">status:</span> <span class="string">warning</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">annotations:</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">summary:</span> <span class="string">"<span class="template-variable">&#123;&#123;$labels.mountpoint&#125;&#125;</span> ç£ç›˜åˆ†åŒºä½¿ç”¨ç‡è¿‡é«˜ï¼"</span></span><br><span class="line"><span class="string">â€‹</span>        <span class="attr">description:</span> <span class="string">"<span class="template-variable">&#123;&#123;$labels.mountpoint &#125;&#125;</span> ç£ç›˜åˆ†åŒºä½¿ç”¨å¤§äº80%(ç›®å‰ä½¿ç”¨:<span class="template-variable">&#123;&#123;$value&#125;&#125;</span>%)"</span></span><br><span class="line"><span class="comment"># -- ä¸šåŠ¡ç›‘æ§è§„åˆ™</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">ä¸šåŠ¡ç›‘æ§(Business</span> <span class="string">monitoring)</span></span><br><span class="line"><span class="attr">  - alert:</span> <span class="string">APIHighRequestLatency</span>  <span class="comment">#å¯¹è¯·æ±‚å»¶è¿Ÿä¸­å€¼å¤§äº1sçš„ä»»ä½•å®ä¾‹å‘å‡ºè­¦æŠ¥ã€‚</span></span><br><span class="line"><span class="attr">    expr:</span> <span class="string">api_http_request_latencies_second&#123;quantile="0.5"&#125;</span> <span class="string">&gt; 1</span></span><br><span class="line"><span class="string"></span><span class="attr">    for:</span> <span class="number">10</span><span class="string">m</span></span><br><span class="line"><span class="attr">    labels:</span></span><br><span class="line"><span class="attr">      severity:</span> <span class="string">generality</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">status:</span> <span class="string">warning</span></span><br><span class="line"><span class="attr">    annotations:</span></span><br><span class="line"><span class="attr">      summary:</span> <span class="string">"High request latency on <span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span>"</span></span><br><span class="line"><span class="attr">      description:</span> <span class="string">"<span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> has a median request latency above 1s (current value: <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>s)"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -- æ•°æ®åº“ç›‘æ§è§„åˆ™</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">RedisAlert</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">  - alert:</span> <span class="string">Redis</span> <span class="string">å†…å­˜æƒ…å†µ</span></span><br><span class="line"><span class="attr">    expr:</span> <span class="number">100</span> <span class="string">*</span> <span class="string">(redis_memory_used_bytes</span> <span class="string">/</span> <span class="string">redis_config_maxmemory)</span> <span class="string">&gt; 90</span></span><br><span class="line"><span class="string"></span><span class="attr">    for:</span> <span class="number">1</span><span class="string">m</span></span><br><span class="line"><span class="attr">    labels:</span></span><br><span class="line"><span class="attr">      severity:</span> <span class="string">generality</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">status:</span> <span class="string">warning</span></span><br><span class="line"><span class="attr">    annotations:</span></span><br><span class="line"><span class="attr">      summary:</span> <span class="string">"Redis <span class="template-variable">&#123;&#123; $labels.instance &#125;&#125;</span> memory userd over 90"</span></span><br><span class="line"><span class="attr">      description:</span> <span class="string">"Redis memory used over 90 duration above 1m"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -- é˜Ÿåˆ—ç›‘æ§è§„åˆ™</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">KafkaAlert</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">  - alert:</span> <span class="string">kafka</span> <span class="string">æ¶ˆè´¹è€…(Consumer)group_lagæƒ…å†µ</span></span><br><span class="line"><span class="attr">    expr:</span> <span class="string">sum(kafka_consumergroup_lag&#123;instance</span> <span class="string">!=</span> <span class="string">"kafka-dev"</span> <span class="string">&#125;)</span> <span class="string">by</span> <span class="string">(instance,</span> <span class="string">consumergroup,topic)</span> <span class="string">&gt; 500</span></span><br><span class="line"><span class="string"></span><span class="attr">    for:</span> <span class="number">5</span><span class="string">m</span></span><br><span class="line"><span class="attr">    labels:</span></span><br><span class="line"><span class="attr">      severity:</span> <span class="string">generality</span></span><br><span class="line"><span class="string">â€‹</span>      <span class="attr">status:</span> <span class="string">warning</span></span><br><span class="line"><span class="attr">    annotations:</span></span><br><span class="line"><span class="attr">      summary:</span> <span class="string">"kafka <span class="template-variable">&#123;&#123; $labels.topic &#125;&#125;</span> æ¶ˆè´¹å»¶è¿ŸæŠ¥è­¦"</span></span><br><span class="line"><span class="attr">      description:</span> <span class="string">"kafka æ¶ˆè´¹å»¶è¿Ÿæœ‰ <span class="template-variable">&#123;&#123; $value&#125;&#125;</span> é˜Ÿåˆ—æ•°"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Tips : è§„åˆ™æ£€æµ‹é¢‘ç‡æ—¶é—´æ˜¯ä¸å…¨å±€å˜é‡ä¸­çš„<code>evaluation_interval</code>è®¾ç½®ç›¸å…³ã€‚<br>Tips : æ ‡ç­¾å’Œæ³¨é‡Šå€¼å¯ä»¥ä½¿ç”¨æ§åˆ¶å°æ¨¡æ¿è¿›è¡Œæ¨¡æ¿åŒ–ã€‚<code>$labels</code>å˜é‡ä¿å­˜è­¦æŠ¥å®ä¾‹çš„æ ‡ç­¾é”®/å€¼å¯¹,å¯ä»¥é€šè¿‡<code>$externalLabels</code>å˜é‡è®¿é—®é…ç½®çš„å¤–éƒ¨æ ‡ç­¾, <code>$value</code>å˜é‡ä¿å­˜è­¦æŠ¥å®ä¾‹çš„è¯„ä¼°å€¼ã€‚<br>Tips : æŒ‰ç…§<code>evaluation_interval</code>é…ç½®è¯¥å‘Šè­¦è§„åˆ™30sæ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœæŒç»­<code>for:2m</code>å³2åˆ†é’Ÿå†…æ”¶åˆ°æ•°æ®åˆ™è¯¥è­¦å‘Šä¼šè¢«è§¦å‘ï¼Œå¹¶ä¸”åœ¨è¾¾åˆ°è®¾å®šå¾—æ—¶é—´é•¿åº¦å‰è¯¥å‘Šè­¦å°†å¤„äºpendingçŠ¶æ€ã€‚<br><br/></p>
<h3 id="Alertmanager-yml"><a href="#Alertmanager-yml" class="headerlink" title="Alertmanager.yml"></a>Alertmanager.yml</h3><p>æè¿°: Alertmanageræ˜¯é€šè¿‡å‘½ä»¤è¡Œæ ‡å¿—å’Œé…ç½®æ–‡ä»¶é…ç½®çš„ã€‚å½“å‘½ä»¤è¡Œæ ‡å¿—é…ç½®ä¸å¯å˜çš„ç³»ç»Ÿå‚æ•°æ—¶ï¼Œé…ç½®æ–‡ä»¶å®šä¹‰ç¦æ­¢è§„åˆ™ã€é€šçŸ¥è·¯ç”±å’Œé€šçŸ¥æ¥æ”¶å™¨(<code>Prometheusçš„æŠ¥è­¦é€šçŸ¥é…ç½®æ–‡ä»¶</code>),è¦æŒ‡å®šè¦åŠ è½½çš„é…ç½®æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨â€“config.fileæ ‡å¿—<code>./alertmanager --config.file=alertmanager.yml</code>ã€‚</p>
<p>Alertmanager.yml Configuration file ä¸»è¦é…ç½®å¯¹è±¡:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - å…¨å±€é…ç½®: åŒ…æ‹¬æŠ¥è­¦è§£å†³åçš„è¶…æ—¶æ—¶é—´ã€SMTP ç›¸å…³é…ç½®ã€å„ç§æ¸ é“é€šçŸ¥çš„ API åœ°å€ç­‰ç­‰ã€‚</span></span><br><span class="line">* &lt;global&gt;</span><br><span class="line">  * &lt;http_config&gt;</span><br><span class="line">  * &lt;tls_config&gt;</span><br><span class="line"><span class="comment"># - ç”¨æ¥è®¾ç½®æŠ¥è­¦çš„åˆ†å‘ç­–ç•¥ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼ŒæŒ‰ç…§æ·±åº¦ä¼˜å…ˆä»å·¦å‘å³çš„é¡ºåºè¿›è¡ŒåŒ¹é…ã€‚</span></span><br><span class="line">* &lt;route&gt;</span><br><span class="line"><span class="comment"># - æŠ‘åˆ¶è§„åˆ™é…ç½®ï¼Œå½“å­˜åœ¨ä¸å¦ä¸€ç»„åŒ¹é…çš„è­¦æŠ¥ï¼ˆæºï¼‰æ—¶ï¼ŒæŠ‘åˆ¶è§„åˆ™å°†ç¦ç”¨ä¸ä¸€ç»„åŒ¹é…çš„è­¦æŠ¥ï¼ˆç›®æ ‡ï¼‰ã€‚</span></span><br><span class="line">* &lt;inhibit_rule&gt;</span><br><span class="line">* &lt;templates&gt;</span><br><span class="line"><span class="comment"># - é…ç½®å‘Šè­¦æ¶ˆæ¯æ¥å—è€…ä¿¡æ¯ï¼Œä¾‹å¦‚å¸¸ç”¨çš„ emailã€wechatã€slackã€webhook ç­‰æ¶ˆæ¯é€šçŸ¥æ–¹å¼ã€‚</span></span><br><span class="line">* &lt;receiver&gt;</span><br><span class="line">  * &lt;email_config&gt;</span><br><span class="line">  * &lt;pagerduty_config&gt;</span><br><span class="line">    * &lt;image_config&gt;</span><br><span class="line">    * &lt;link_config&gt;</span><br><span class="line">  * &lt;pushover_config&gt;</span><br><span class="line">  * &lt;slack_config&gt;</span><br><span class="line">    * &lt;action_config&gt;</span><br><span class="line">    * &lt;field_config&gt;</span><br><span class="line">  * &lt;opsgenie_config&gt;</span><br><span class="line">    * &lt;responder&gt;</span><br><span class="line">  * &lt;victorops_config&gt;</span><br><span class="line">  * &lt;webhook_config&gt;</span><br><span class="line">  * &lt;wechat_config&gt;</span><br></pre></td></tr></table></figure></p>
<p>Tips: é€šç”¨å ä½ç¬¦å®šä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>&lt;duration&gt;</code>ï¼šä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æŒç»­æ—¶é—´ <code>[0-9]+(ms|[smhdwy])</code></li>
<li><code>&lt;labelname&gt;</code>ï¼šä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å­—ç¬¦ä¸²<code>[a-zA-Z_][a-zA-Z0-9_]*</code></li>
<li><code>&lt;labelvalue&gt;</code>ï¼šä¸€ä¸²unicodeå­—ç¬¦</li>
<li><code>&lt;filepath&gt;</code>ï¼šå½“å‰å·¥ä½œç›®å½•ä¸­çš„æœ‰æ•ˆè·¯å¾„</li>
<li><code>&lt;boolean&gt;</code>ï¼šå¯ä»¥æ¥å—å€¼çš„å¸ƒå°”å€¼trueæˆ–false</li>
<li><code>&lt;string&gt;</code>ï¼šå¸¸è§„å­—ç¬¦ä¸²</li>
<li><code>&lt;secret&gt;</code>ï¼šæ˜¯ç§˜å¯†çš„å¸¸è§„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚å¯†ç </li>
<li><code>&lt;tmpl_string&gt;</code>ï¼šä½¿ç”¨å‰å·²æ¨¡æ¿æ‰©å±•çš„å­—ç¬¦ä¸²</li>
<li><code>&lt;tmpl_secret&gt;</code>ï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåœ¨ä½¿ç”¨å‰ä¼šè¿›è¡Œæ¨¡æ¿æ‰©å±•ï¼Œè¿™æ˜¯ä¸€ä¸ªç§˜å¯†</li>
<li><code>&lt;int&gt;</code>ï¼šä¸€ä¸ªæ•´æ•°å€¼</li>
</ul>
<p><br></p>
<h4 id="1-è¯­æ³•æ ¼å¼-2"><a href="#1-è¯­æ³•æ ¼å¼-2" class="headerlink" title="(1) è¯­æ³•æ ¼å¼"></a>(1) è¯­æ³•æ ¼å¼</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - å…¨å±€é…ç½®æŒ‡å®šåœ¨æ‰€æœ‰å…¶ä»–é…ç½®ä¸Šä¸‹æ–‡ä¸­æœ‰æ•ˆçš„å‚æ•°,å®ƒä»¬ä¹Ÿå¯ä»¥ä½œä¸ºå…¶ä»–é…ç½®éƒ¨åˆ†çš„é»˜è®¤å€¼ã€‚</span></span><br><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="comment"># The default SMTP From header field.</span></span><br><span class="line">  <span class="string">[</span> <span class="attr">smtp_from:</span> <span class="string">&lt;tmpl_string&gt;</span> <span class="string">]</span></span><br><span class="line">  <span class="comment"># The default SMTP smarthost used for sending emails, including port number.</span></span><br><span class="line">  <span class="comment"># Port number usually is 25, or 587 for SMTP over TLS (sometimes referred to as STARTTLS).</span></span><br><span class="line">  <span class="string">[</span> <span class="attr">smtp_smarthost:</span> <span class="string">&lt;string&gt;</span> <span class="string">]</span>    <span class="comment"># Example: smtp.example.org:587</span></span><br><span class="line">  <span class="comment"># The default hostname to identify to the SMTP server.</span></span><br><span class="line">  <span class="string">[</span> <span class="attr">smtp_hello:</span> <span class="string">&lt;string&gt;</span> <span class="string">| default = "localhost" ]</span></span><br><span class="line"><span class="string">  # SMTP Auth using CRAM-MD5, LOGIN and PLAIN. If empty, Alertmanager doesn't authenticate to the SMTP server.</span></span><br><span class="line"><span class="string">  [ smtp_auth_username: &lt;string&gt; ]</span></span><br><span class="line"><span class="string">  # SMTP Auth using LOGIN and PLAIN.</span></span><br><span class="line"><span class="string">  [ smtp_auth_password: &lt;secret&gt; ]</span></span><br><span class="line"><span class="string">  # SMTP Auth using PLAIN.</span></span><br><span class="line"><span class="string">  [ smtp_auth_identity: &lt;string&gt; ]</span></span><br><span class="line"><span class="string">  # SMTP Auth using CRAM-MD5.</span></span><br><span class="line"><span class="string">  [ smtp_auth_secret: &lt;secret&gt; ]</span></span><br><span class="line"><span class="string">  # The default SMTP TLS requirement.</span></span><br><span class="line"><span class="string">  # Note that Go does not support unencrypted connections to remote SMTP endpoints.</span></span><br><span class="line"><span class="string">  [ smtp_require_tls: &lt;bool&gt; | default = true ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  # ç”¨äºå»¶è¿Ÿé€šçŸ¥çš„API URL</span></span><br><span class="line"><span class="string">  [ slack_api_url: &lt;secret&gt; ]</span></span><br><span class="line"><span class="string">  [ victorops_api_key: &lt;secret&gt; ]</span></span><br><span class="line"><span class="string">  [ victorops_api_url: &lt;string&gt; | default = "https://alert.victorops.com/integrations/generic/20131114/alert/" ]</span></span><br><span class="line"><span class="string">  [ pagerduty_url: &lt;string&gt; | default = "https://events.pagerduty.com/v2/enqueue" ]</span></span><br><span class="line"><span class="string">  [ opsgenie_api_key: &lt;secret&gt; ]</span></span><br><span class="line"><span class="string">  [ opsgenie_api_url: &lt;string&gt; | default = "https://api.opsgenie.com/" ]</span></span><br><span class="line"><span class="string">  [ wechat_api_url: &lt;string&gt; | default = "https://qyapi.weixin.qq.com/cgi-bin/" ]</span></span><br><span class="line"><span class="string">  [ wechat_api_secret: &lt;secret&gt; ]</span></span><br><span class="line"><span class="string">  [ wechat_api_corp_id: &lt;string&gt; ]</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  # - é»˜è®¤çš„HTTPå®¢æˆ·ç«¯é…ç½®</span></span><br><span class="line"><span class="string">  # Note that `basic_auth`, `bearer_token` and `bearer_token_file` options are mutually exclusive(ç›¸äº’æ’æ–¥).</span></span><br><span class="line"><span class="string">  [ http_config: &lt;http_config&gt; ]                </span></span><br><span class="line"><span class="string">    # Sets the `Authorization` header with the configured username and password.</span></span><br><span class="line"><span class="string">    # password and password_file are mutually exclusive.</span></span><br><span class="line"><span class="string"></span><span class="attr">    basic_auth:</span></span><br><span class="line">      <span class="string">[</span> <span class="attr">username:</span> <span class="string">&lt;string&gt;</span> <span class="string">]</span></span><br><span class="line">      <span class="string">[</span> <span class="attr">password:</span> <span class="string">&lt;secret&gt;</span> <span class="string">]</span></span><br><span class="line">      <span class="string">[</span> <span class="attr">password_file:</span> <span class="string">&lt;string&gt;</span> <span class="string">]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Sets the `Authorization` header with the configured bearer token.</span></span><br><span class="line">    <span class="string">[</span> <span class="attr">bearer_token:</span> <span class="string">&lt;secret&gt;</span> <span class="string">]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Sets the `Authorization` header with the bearer token read from the configured file.</span></span><br><span class="line">    <span class="string">[</span> <span class="attr">bearer_token_file:</span> <span class="string">&lt;filepath&gt;</span> <span class="string">]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Configures the TLS settings.</span></span><br><span class="line"><span class="attr">    tls_config:</span></span><br><span class="line">      <span class="comment"># CA certificate to validate the server certificate with.</span></span><br><span class="line">      <span class="string">[</span> <span class="attr">ca_file:</span> <span class="string">&lt;filepath&gt;</span> <span class="string">]</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># Certificate and key files for client cert authentication to the server.</span></span><br><span class="line">      <span class="string">[</span> <span class="attr">cert_file:</span> <span class="string">&lt;filepath&gt;</span> <span class="string">]</span></span><br><span class="line">      <span class="string">[</span> <span class="attr">key_file:</span> <span class="string">&lt;filepath&gt;</span> <span class="string">]</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># ServerName extension to indicate the name of the server.</span></span><br><span class="line">      <span class="comment"># http://tools.ietf.org/html/rfc4366#section-3.1</span></span><br><span class="line">      <span class="string">[</span> <span class="attr">server_name:</span> <span class="string">&lt;string&gt;</span> <span class="string">]</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># Disable validation of the server certificate.</span></span><br><span class="line">      <span class="string">[</span> <span class="attr">insecure_skip_verify:</span> <span class="string">&lt;boolean&gt;</span> <span class="string">| default = false]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # Optional proxy URL.</span></span><br><span class="line"><span class="string">    [ proxy_url: &lt;string&gt; ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  [ resolve_timeout: &lt;duration&gt; | default = 5m ] # é»˜è®¤çš„HTTPå®¢æˆ·ç«¯é…ç½®</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># - ä»ä¸­è¯»å–è‡ªå®šä¹‰é€šçŸ¥æ¨¡æ¿å®šä¹‰çš„æ–‡ä»¶,æœ€åä¸€ä¸ªç»„ä»¶å¯ä»¥ä½¿ç”¨é€šé…ç¬¦åŒ¹é…å™¨,ä¾‹å¦‚â€œtemplates/*.tmplâ€ã€‚</span></span><br><span class="line"><span class="string"></span><span class="attr">templates:</span></span><br><span class="line">  <span class="string">[</span> <span class="bullet">-</span> <span class="string">&lt;filepath&gt;</span> <span class="string">...</span> <span class="string">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - è·¯ç”±å—å®šä¹‰è·¯ç”±æ ‘ä¸­çš„èŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹ã€‚å¦‚æœæœªè®¾ç½®åˆ™ä»å…¶çˆ¶èŠ‚ç‚¹ç»§æ‰¿å…¶å¯é€‰é…ç½®å‚æ•°ã€‚</span></span><br><span class="line"><span class="attr">route:</span> <span class="string">&lt;route&gt;</span></span><br><span class="line">  <span class="string">[</span> <span class="attr">receiver:</span> <span class="string">&lt;string&gt;</span> <span class="string">]</span> </span><br><span class="line">  <span class="comment"># ç”¨äºå°†ä¼ å…¥è­¦æŠ¥åˆ†ç»„åœ¨ä¸€èµ·çš„æ ‡ç­¾ã€‚ä¾‹å¦‚ï¼Œcluster=Aå’Œalertname=LatencyHighçš„å¤šä¸ªè­¦æŠ¥å°†è¢«æ‰¹å¤„ç†åˆ°å•ä¸ªç»„ä¸­ã€‚</span></span><br><span class="line">  <span class="comment"># To aggregate by all possible labels use the special value '...' as the sole label name, for example:</span></span><br><span class="line">  <span class="comment"># group_by: ['...']</span></span><br><span class="line">  <span class="comment"># è¿™å°†æœ‰æ•ˆåœ°å®Œå…¨ç¦ç”¨èšåˆï¼ŒæŒ‰åŸæ ·ä¼ é€’æ‰€æœ‰è­¦æŠ¥ã€‚è¿™ä¸å¤ªå¯èƒ½æ˜¯æ‚¨æƒ³è¦çš„ï¼Œé™¤éæ‚¨çš„è­¦æŠ¥é‡éå¸¸ä½ï¼Œæˆ–è€…æ‚¨çš„ä¸Šæ¸¸é€šçŸ¥ç³»ç»Ÿæ‰§è¡Œè‡ªå·±çš„åˆ†ç»„ã€‚</span></span><br><span class="line">  <span class="string">[</span> <span class="attr">group_by:</span> <span class="string">[</span> <span class="string">&lt;labelname&gt;,</span> <span class="string">...</span> <span class="string">]</span> <span class="string">]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># è­¦æŠ¥æ˜¯å¦åº”ç»§ç»­åŒ¹é…åç»­åŒçº§èŠ‚ç‚¹ã€‚</span></span><br><span class="line">  <span class="string">[</span> <span class="attr">continue:</span> <span class="string">&lt;boolean&gt;</span> <span class="string">| default = false ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  # è­¦æŠ¥å¿…é¡»æ»¡è¶³çš„ä¸€ç»„ç›¸ç­‰åŒ¹é…å™¨æ‰èƒ½åŒ¹é…èŠ‚ç‚¹ã€‚</span></span><br><span class="line"><span class="string"></span><span class="attr">  match:</span></span><br><span class="line">    <span class="string">[</span> <span class="string">&lt;labelname&gt;:</span> <span class="string">&lt;labelvalue&gt;,</span> <span class="string">...</span> <span class="string">]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># è­¦æŠ¥å¿…é¡»æ»¡è¶³çš„ä¸€ç»„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å™¨æ‰èƒ½åŒ¹é…èŠ‚ç‚¹ã€‚</span></span><br><span class="line"><span class="attr">  match_re:</span></span><br><span class="line">    <span class="string">[</span> <span class="string">&lt;labelname&gt;:</span> <span class="string">&lt;regex&gt;,</span> <span class="string">...</span> <span class="string">]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ä¸ºä¸€ç»„è­¦æŠ¥å‘é€é€šçŸ¥çš„åˆå§‹ç­‰å¾…æ—¶é—´ã€‚å…è®¸ç­‰å¾…ç¦æ­¢è­¦æŠ¥åˆ°è¾¾æˆ–ä¸ºåŒä¸€ç»„æ”¶é›†æ›´å¤šåˆå§‹è­¦æŠ¥(é€šå¸¸æ˜¯0åˆ°å‡ åˆ†é’Ÿã€‚ï¼‰</span></span><br><span class="line">  <span class="string">[</span> <span class="attr">group_wait:</span> <span class="string">&lt;duration&gt;</span> <span class="string">| default = 30s ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  # åœ¨å‘é€æœ‰å…³æ·»åŠ åˆ°å·²å‘é€åˆå§‹é€šçŸ¥çš„è­¦æŠ¥ç»„ä¸­çš„æ–°è­¦æŠ¥çš„é€šçŸ¥ä¹‹å‰è¦ç­‰å¾…å¤šé•¿æ—¶é—´(é€šå¸¸çº¦5åˆ†é’Ÿæˆ–ä»¥ä¸Šã€‚ï¼‰</span></span><br><span class="line"><span class="string">  [ group_interval: &lt;duration&gt; | default = 5m ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  # å¦‚æœè­¦æŠ¥å·²æˆåŠŸå‘é€ï¼Œåˆ™åœ¨å†æ¬¡å‘é€é€šçŸ¥ä¹‹å‰è¦ç­‰å¾…å¤šé•¿æ—¶é—´(é€šå¸¸çº¦3å°æ—¶æˆ–ä»¥ä¸Šï¼‰ã€‚</span></span><br><span class="line"><span class="string">  [ repeat_interval: &lt;duration&gt; | default = 4h ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  # é›¶ä¸ªæˆ–å¤šä¸ªå­è·¯ç”±ã€‚</span></span><br><span class="line"><span class="string"></span><span class="attr">  routes:</span></span><br><span class="line">    <span class="string">[</span> <span class="bullet">-</span> <span class="string">&lt;route&gt;</span> <span class="string">...</span> <span class="string">]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šçŸ¥æ¥æ”¶è€…åˆ—è¡¨ï¼šReceiveræ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªé€šçŸ¥é›†æˆçš„å‘½åé…ç½®ï¼ˆæ­¤å¤„æ­£å¯¹äºwebhookä¸wechatè¯¦ç»†è®²è§£ï¼‰ã€‚</span></span><br><span class="line"><span class="attr">receivers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">&lt;string&gt;</span>  <span class="comment">#  æ¥æ”¶æ–¹çš„å”¯ä¸€åç§°ã€‚</span></span><br><span class="line">  <span class="comment"># å¤šä¸ªé€šçŸ¥é›†æˆçš„é…ç½®ã€‚</span></span><br><span class="line"><span class="attr">  webhook_configs:</span> <span class="comment"># - webhookæ¥æ”¶å™¨å…è®¸é…ç½®é€šç”¨æ¥æ”¶å™¨ã€‚</span></span><br><span class="line">    <span class="string">[</span> <span class="attr">send_resolved:</span> <span class="string">&lt;boolean&gt;</span> <span class="string">| default = true ] # æ˜¯å¦é€šçŸ¥å·²è§£å†³çš„è­¦æŠ¥ã€‚</span></span><br><span class="line"><span class="string"></span><span class="attr">    url:</span> <span class="string">&lt;string&gt;</span>  <span class="comment"># POST è¯·æ±‚åœ°å€</span></span><br><span class="line">    <span class="string">[</span> <span class="attr">http_config:</span> <span class="string">&lt;http_config&gt;</span> <span class="string">| default = global.http_config ]  # HTTPå®¢æˆ·ç«¯çš„é…ç½®ã€‚</span></span><br><span class="line"><span class="string">    [ max_alerts: &lt;int&gt; | default = 0 ]  # å•ä¸ªwebhookæ¶ˆæ¯ä¸­åŒ…å«çš„æœ€å¤§è­¦æŠ¥æ•°, å°†å…¶ä¿ç•™ä¸ºé»˜è®¤å€¼ 0 åŒ…æ‹¬æ‰€æœ‰è­¦æŠ¥ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span><span class="attr">  wechat_configs:</span> <span class="comment"># - å¾®ä¿¡é€šçŸ¥é€šè¿‡å¾®ä¿¡APIå‘é€ã€‚</span></span><br><span class="line">    <span class="string">[</span> <span class="attr">send_resolved:</span> <span class="string">&lt;boolean&gt;</span> <span class="string">| default = false ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # The API key to use when talking to the WeChat API.</span></span><br><span class="line"><span class="string">    [ api_secret: &lt;secret&gt; | default = global.wechat_api_secret ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # The WeChat API URL.</span></span><br><span class="line"><span class="string">    [ api_url: &lt;string&gt; | default = global.wechat_api_url ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # The corp id for authentication.</span></span><br><span class="line"><span class="string">    [ corp_id: &lt;string&gt; | default = global.wechat_api_corp_id ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # API request data as defined by the WeChat API.</span></span><br><span class="line"><span class="string">    # [ message: &lt;tmpl_string&gt; | default = '<span class="template-variable">&#123;&#123; template "wechat.default.message" . &#125;&#125;</span>' ]</span></span><br><span class="line"><span class="string">    # [ agent_id: &lt;string&gt; | default = '<span class="template-variable">&#123;&#123; template "wechat.default.agent_id" . &#125;&#125;</span>' ]</span></span><br><span class="line"><span class="string">    # [ to_user: &lt;string&gt; | default = '<span class="template-variable">&#123;&#123; template "wechat.default.to_user" . &#125;&#125;</span>' ]</span></span><br><span class="line"><span class="string">    # [ to_party: &lt;string&gt; | default = '<span class="template-variable">&#123;&#123; template "wechat.default.to_party" . &#125;&#125;</span>' ]</span></span><br><span class="line"><span class="string">    # [ to_tag: &lt;string&gt; | default = '<span class="template-variable">&#123;&#123; template "wechat.default.to_tag" . &#125;&#125;</span>' ]</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string"></span><span class="attr">  email_configs:</span>  </span><br><span class="line">    <span class="string">[</span> <span class="bullet">-</span> <span class="string">&lt;email_config&gt;,</span> <span class="string">...</span> <span class="string">]</span></span><br><span class="line"><span class="attr">  victorops_configs:</span></span><br><span class="line">    <span class="string">[</span> <span class="bullet">-</span> <span class="string">&lt;victorops_config&gt;,</span> <span class="string">...</span> <span class="string">]</span></span><br><span class="line"><span class="attr">  pagerduty_configs:</span> <span class="comment"># PagerDutyé€šçŸ¥é€šè¿‡PagerDuty APIå‘é€</span></span><br><span class="line">    <span class="string">[</span> <span class="bullet">-</span> <span class="string">&lt;pagerduty_config&gt;,</span> <span class="string">...</span> <span class="string">]</span></span><br><span class="line"><span class="attr">  pushover_configs:</span></span><br><span class="line">    <span class="string">[</span> <span class="bullet">-</span> <span class="string">&lt;pushover_config&gt;,</span> <span class="string">...</span> <span class="string">]</span></span><br><span class="line"><span class="attr">  slack_configs:</span></span><br><span class="line">    <span class="string">[</span> <span class="bullet">-</span> <span class="string">&lt;slack_config&gt;,</span> <span class="string">...</span> <span class="string">]</span></span><br><span class="line"><span class="attr">  opsgenie_configs:</span></span><br><span class="line">    <span class="string">[</span> <span class="bullet">-</span> <span class="string">&lt;opsgenie_config&gt;,</span> <span class="string">...</span> <span class="string">]</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment"># - æŠ‘åˆ¶è§„åˆ™åˆ—è¡¨: å½“å­˜åœ¨ä¸å¦ä¸€ç»„åŒ¹é…å™¨åŒ¹é…çš„è­¦æŠ¥ï¼ˆæºï¼‰æ—¶ï¼Œç¦æ­¢è§„åˆ™ä¼šä½¿ä¸ä¸€ç»„åŒ¹é…å™¨åŒ¹é…çš„è­¦æŠ¥ï¼ˆç›®æ ‡ï¼‰é™éŸ³ã€‚å¯¹äºç›¸ç­‰åˆ—è¡¨ä¸­çš„æ ‡ç­¾åç§°ï¼Œç›®æ ‡è­¦æŠ¥å’Œæºè­¦æŠ¥å¿…é¡»å…·æœ‰ç›¸åŒçš„æ ‡ç­¾å€¼ã€‚</span></span><br><span class="line"><span class="attr">inhibit_rules:</span></span><br><span class="line">  <span class="comment"># Matchers that have to be fulfilled in the alerts to be muted.</span></span><br><span class="line"><span class="attr">  target_match:</span></span><br><span class="line">    <span class="string">[</span> <span class="string">&lt;labelname&gt;:</span> <span class="string">&lt;labelvalue&gt;,</span> <span class="string">...</span> <span class="string">]</span></span><br><span class="line"><span class="attr">  target_match_re:</span></span><br><span class="line">    <span class="string">[</span> <span class="string">&lt;labelname&gt;:</span> <span class="string">&lt;regex&gt;,</span> <span class="string">...</span> <span class="string">]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Matchers for which one or more alerts have to exist for the</span></span><br><span class="line">  <span class="comment"># inhibition to take effect.</span></span><br><span class="line"><span class="attr">  source_match:</span></span><br><span class="line">    <span class="string">[</span> <span class="string">&lt;labelname&gt;:</span> <span class="string">&lt;labelvalue&gt;,</span> <span class="string">...</span> <span class="string">]</span></span><br><span class="line"><span class="attr">  source_match_re:</span></span><br><span class="line">    <span class="string">[</span> <span class="string">&lt;labelname&gt;:</span> <span class="string">&lt;regex&gt;,</span> <span class="string">...</span> <span class="string">]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Labels that must have an equal value in the source and target</span></span><br><span class="line">  <span class="comment"># alert for the inhibition to take effect.</span></span><br><span class="line">  <span class="string">[</span> <span class="attr">equal:</span> <span class="string">'['</span> <span class="string">&lt;labelname&gt;,</span> <span class="string">...</span> <span class="string">']'</span> <span class="string">]</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="2-åŸºç¡€ç¤ºä¾‹-2"><a href="#2-åŸºç¡€ç¤ºä¾‹-2" class="headerlink" title="(2) åŸºç¡€ç¤ºä¾‹"></a>(2) åŸºç¡€ç¤ºä¾‹</h4><ul>
<li><p>1.å®˜æ–¹ç¤ºä¾‹: <a href="https://github.com/prometheus/alertmanager/blob/master/doc/examples/simple.yml" target="_blank" rel="noopener">https://github.com/prometheus/alertmanager/blob/master/doc/examples/simple.yml</a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="comment"># The smarthost and SMTP sender used for mail notifications.</span></span><br><span class="line"><span class="attr">  smtp_smarthost:</span> <span class="string">'localhost:25'</span></span><br><span class="line"><span class="attr">  smtp_from:</span> <span class="string">'alertmanager@example.org'</span></span><br><span class="line"><span class="attr">  smtp_auth_username:</span> <span class="string">'alertmanager'</span></span><br><span class="line"><span class="attr">  smtp_auth_password:</span> <span class="string">'password'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The directory from which notification templates are read.</span></span><br><span class="line"><span class="attr">templates:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">'/etc/alertmanager/template/*.tmpl'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The root route on which each incoming alert enters.</span></span><br><span class="line"><span class="attr">route:</span></span><br><span class="line"><span class="attr">  receiver:</span> <span class="string">'default-receiver'</span>  <span class="comment"># é»˜è®¤æ¥æ”¶å™¨</span></span><br><span class="line"><span class="attr">  group_by:</span> <span class="string">['alertname',</span> <span class="string">'cluster'</span><span class="string">,</span> <span class="string">'service'</span><span class="string">]</span> <span class="comment"># ç”¨äºå°†ä¼ å…¥è­¦æŠ¥åˆ†ç»„åœ¨ä¸€èµ·çš„æ ‡ç­¾ã€‚</span></span><br><span class="line"><span class="attr">  group_wait:</span> <span class="number">30</span><span class="string">s</span>    <span class="comment"># å½“ä¼ å…¥è­¦æŠ¥åˆ›å»ºæ–°çš„è­¦æŠ¥ç»„æ—¶ï¼Œè¯·è‡³å°‘ç­‰å¾…â€œgroup_waitâ€ä»¥å‘é€åˆå§‹é€šçŸ¥ã€‚\</span></span><br><span class="line"><span class="attr">  group_interval:</span> <span class="number">5</span><span class="string">m</span>  <span class="comment"># å‘é€ç¬¬ä¸€ä¸ªé€šçŸ¥æ—¶ï¼Œè¯·ç­‰å¾…â€œgroup_intervalâ€ä»¥å‘é€ä¸€æ‰¹æ–°è­¦æŠ¥ï¼Œè¿™äº›è­¦æŠ¥å·²å¼€å§‹ä¸ºè¯¥ç»„è§¦å‘ã€‚</span></span><br><span class="line"><span class="attr">  repeat_interval:</span> <span class="number">3</span><span class="string">h</span> <span class="comment"># å¦‚æœè­¦æŠ¥å·²æˆåŠŸå‘é€ï¼Œè¯·ç­‰å¾…â€œé‡å¤é—´éš”â€å‘é€è­¦æŠ¥ã€‚</span></span><br><span class="line">  <span class="comment"># - æ‰€æœ‰ä¸Šè¿°å±æ€§éƒ½ç”±æ‰€æœ‰å­è·¯ç”±ç»§æ‰¿ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ¯ä¸ªå­è·¯ç”±ä¸Šè¦†ç›–ã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment"># å­è·¯ç”±è®¾ç½® </span></span><br><span class="line"><span class="attr">  routes:</span></span><br><span class="line">  <span class="comment"># æ­¤è·¯ç”±å¯¹è­¦æŠ¥æ ‡ç­¾æ‰§è¡Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œä»¥æ•è·ä¸æœåŠ¡åˆ—è¡¨ç›¸å…³çš„è­¦æŠ¥ã€‚</span></span><br><span class="line"><span class="attr">  - match_re:</span> <span class="comment"># è¯¥æœåŠ¡æœ‰ä¸€ä¸ªå­è·¯ç”±ç”¨äºå…³é”®è­¦æŠ¥ï¼Œå³ä»»ä½•ä¸åŒ¹é…çš„è­¦æŠ¥ï¼Œå³ severity != criticalï¼Œé€€å›åˆ°çˆ¶èŠ‚ç‚¹å¹¶å‘é€åˆ°â€œteam-X-Mailâ€</span></span><br><span class="line"><span class="attr">      service:</span> <span class="string">^(foo1|foo2|baz)$</span></span><br><span class="line"><span class="attr">    receiver:</span> <span class="string">team-X-mails</span>  </span><br><span class="line"><span class="attr">    routes:</span></span><br><span class="line"><span class="attr">    - match:</span></span><br><span class="line"><span class="attr">        severity:</span> <span class="string">critical</span></span><br><span class="line"><span class="attr">      receiver:</span> <span class="string">team-X-pager</span></span><br><span class="line"><span class="attr">  - match:</span>  <span class="comment"># åŒ¹é…åˆ°  service == files å¹¶ä¸” severity == critical é‡‡ç”¨ team-Y-pager æ¥æ”¶å™¨å‘é€ä¿¡æ¯</span></span><br><span class="line"><span class="attr">      service:</span> <span class="string">files</span></span><br><span class="line"><span class="attr">    receiver:</span> <span class="string">team-Y-mails</span></span><br><span class="line"><span class="attr">    routes:</span></span><br><span class="line"><span class="attr">    - match:</span></span><br><span class="line"><span class="attr">        severity:</span> <span class="string">critical</span></span><br><span class="line"><span class="attr">      receiver:</span> <span class="string">team-Y-pager</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  - match:</span>   <span class="comment"># æ­¤è·¯ç”±å¤„ç†æ¥è‡ªæ•°æ®åº“æœåŠ¡çš„æ‰€æœ‰è­¦æŠ¥ã€‚å¦‚æœæ²¡æœ‰å›¢é˜Ÿæ¥å¤„ç†åˆ™é»˜è®¤ä¸ºDBå›¢é˜Ÿã€‚</span></span><br><span class="line"><span class="attr">      service:</span> <span class="string">database</span></span><br><span class="line"><span class="attr">    receiver:</span> <span class="string">team-DB-pager</span></span><br><span class="line"><span class="attr">    group_by:</span> <span class="string">[alertname,</span> <span class="string">cluster,</span> <span class="string">database]</span> <span class="comment"># è¿˜æŒ‰å—å½±å“çš„æ•°æ®åº“å¯¹è­¦æŠ¥è¿›è¡Œåˆ†ç»„ã€‚</span></span><br><span class="line"><span class="attr">    routes:</span></span><br><span class="line"><span class="attr">    - match:</span></span><br><span class="line"><span class="attr">        owner:</span> <span class="string">team-X</span></span><br><span class="line"><span class="attr">      receiver:</span> <span class="string">team-X-pager</span></span><br><span class="line"><span class="attr">      continue:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    - match:</span></span><br><span class="line"><span class="attr">        owner:</span> <span class="string">team-Y</span></span><br><span class="line"><span class="attr">      receiver:</span> <span class="string">team-Y-pager</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># æ‰€æœ‰service=mysqlæˆ–service=cassandraçš„è­¦æŠ¥éƒ½ä¼šè¢«å‘é€åˆ°æ•°æ®åº“å¯»å‘¼æœºã€‚</span></span><br><span class="line"><span class="attr">  - receiver:</span> <span class="string">'database-pager'</span></span><br><span class="line"><span class="attr">    group_wait:</span> <span class="number">10</span><span class="string">s</span></span><br><span class="line"><span class="attr">    match_re:</span></span><br><span class="line"><span class="attr">      service:</span> <span class="string">mysql|cassandra</span></span><br><span class="line">  <span class="comment"># æ‰€æœ‰å¸¦æœ‰team=frontendæ ‡ç­¾çš„è­¦æŠ¥éƒ½ä¸æ­¤å­è·¯ç”±åŒ¹é…ã€‚å®ƒä»¬æŒ‰äº§å“å’Œç¯å¢ƒåˆ†ç»„ï¼Œè€Œä¸æ˜¯æŒ‰é›†ç¾¤å’Œè­¦æŠ¥åç§°åˆ†ç»„ã€‚</span></span><br><span class="line"><span class="attr">  - receiver:</span> <span class="string">'frontend-pager'</span></span><br><span class="line"><span class="attr">    group_by:</span> <span class="string">[product,</span> <span class="string">environment]</span></span><br><span class="line"><span class="attr">    match:</span></span><br><span class="line"><span class="attr">      team:</span> <span class="string">frontend</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœå¦ä¸€ä¸ªè­¦æŠ¥æ­£åœ¨è§¦å‘ï¼ŒæŠ‘åˆ¶è§„åˆ™å…è®¸å°†ä¸€ç»„è­¦æŠ¥é™éŸ³ã€‚å¦‚æœåŒä¸€ä¸ªè­¦æŠ¥å·²ç»å¾ˆä¸¥é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥ç¦ç”¨ä»»ä½•è­¦å‘Šçº§åˆ«çš„é€šçŸ¥ã€‚</span></span><br><span class="line"><span class="attr">inhibit_rules:</span></span><br><span class="line"><span class="attr">- source_match:</span></span><br><span class="line"><span class="attr">    severity:</span> <span class="string">'critical'</span></span><br><span class="line"><span class="attr">  target_match:</span></span><br><span class="line"><span class="attr">    severity:</span> <span class="string">'warning'</span></span><br><span class="line">  <span class="comment"># å¦‚æœalertnameç›¸åŒï¼Œåˆ™åº”ç”¨æŠ‘åˆ¶ã€‚</span></span><br><span class="line">  <span class="comment"># æ³¨æ„ï¼šå¦‚æœæºè­¦æŠ¥å’Œç›®æ ‡è­¦æŠ¥ä¸­éƒ½ç¼ºå°‘â€œequalâ€ä¸­åˆ—å‡ºçš„æ‰€æœ‰æ ‡ç­¾åç§°ï¼Œåˆ™å°†åº”ç”¨ç¦æ­¢è§„åˆ™ï¼</span></span><br><span class="line"><span class="attr">  equal:</span> <span class="string">['alertname',</span> <span class="string">'cluster'</span><span class="string">,</span> <span class="string">'service'</span><span class="string">]</span></span><br><span class="line"></span><br><span class="line"><span class="attr">receivers:</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">'team-X-mails'</span>  <span class="comment"># team-X-mails æ¥æ”¶å™¨</span></span><br><span class="line"><span class="attr">  email_configs:</span></span><br><span class="line"><span class="attr">  - to:</span> <span class="string">'team-X+alerts@example.org'</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">'team-X-pager'</span>  <span class="comment"># team-X-pager æ¥æ”¶å™¨</span></span><br><span class="line"><span class="attr">  email_configs:</span></span><br><span class="line"><span class="attr">  - to:</span> <span class="string">'team-X+alerts-critical@example.org'</span></span><br><span class="line"><span class="attr">  pagerduty_configs:</span></span><br><span class="line"><span class="attr">  - service_key:</span> <span class="string">&lt;team-X-key&gt;</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">'team-Y-mails'</span></span><br><span class="line"><span class="attr">  email_configs:</span></span><br><span class="line"><span class="attr">  - to:</span> <span class="string">'team-Y+alerts@example.org'</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">'team-Y-pager'</span></span><br><span class="line"><span class="attr">  pagerduty_configs:</span></span><br><span class="line"><span class="attr">  - service_key:</span> <span class="string">&lt;team-Y-key&gt;</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">'team-DB-pager'</span></span><br><span class="line"><span class="attr">  pagerduty_configs:</span></span><br><span class="line"><span class="attr">  - service_key:</span> <span class="string">&lt;team-DB-key&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>2.è‡ªå®šä¹‰å¸¸ç”¨ç¤ºä¾‹:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line"><span class="attr">  group_wait:</span> <span class="number">30</span><span class="string">s</span>Â  </span><br><span class="line"><span class="attr">  group_interval:</span> <span class="number">10</span><span class="string">m</span>Â  </span><br><span class="line"><span class="attr">  repeat_interval:</span> <span class="number">10</span><span class="string">m</span>Â  </span><br><span class="line"><span class="attr">  resolve_timeout:</span> <span class="number">5</span><span class="string">m</span></span><br><span class="line"><span class="attr">  group_by:</span> <span class="string">['alertname','cluster']</span></span><br><span class="line"><span class="attr">templates:</span></span><br><span class="line">Â  <span class="bullet">-</span> <span class="string">'demo.tmpl'</span></span><br><span class="line"><span class="attr">route:</span>Â  </span><br><span class="line"><span class="attr">  receiver:</span> <span class="string">webhook</span>Â  </span><br><span class="line"><span class="attr">  group_wait:</span> <span class="number">30</span><span class="string">s</span>Â  </span><br><span class="line"><span class="attr">  group_interval:</span> <span class="number">10</span><span class="string">m</span>Â  </span><br><span class="line"><span class="attr">  repeat_interval:</span> <span class="number">10</span><span class="string">m</span>Â  </span><br><span class="line"><span class="attr">  group_by:</span> <span class="string">['alertname']</span>Â  </span><br><span class="line"><span class="attr">  routes:</span>Â  </span><br><span class="line"><span class="attr">  - receiver:</span> <span class="string">webhook</span>Â  Â  </span><br><span class="line"><span class="attr">    group_wait:</span> <span class="number">10</span><span class="string">s</span>Â  Â </span><br><span class="line"><span class="attr">    match:</span>Â  Â  Â  </span><br><span class="line"><span class="attr">      job_name:</span> <span class="string">mysql|kubernetes</span>Â  </span><br><span class="line"><span class="attr">  - receiver:</span> <span class="string">'webhook-kafka'</span>Â  Â  </span><br><span class="line"><span class="attr">    group_by:</span> <span class="string">[instance,</span> <span class="string">alertname]</span>Â  Â </span><br><span class="line"><span class="attr">    match_re:</span>Â  Â  Â  </span><br><span class="line"><span class="attr">      instance:</span> <span class="string">^kafka-(.*)</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># alertmanageræŠ‘åˆ¶	</span></span><br><span class="line"><span class="attr">inhibit_rules:</span></span><br><span class="line"><span class="attr">  - source_match:</span></span><br><span class="line"><span class="attr">      altername:</span> <span class="string">'Dingtaik api è°ƒç”¨è¿‡å¤š'</span></span><br><span class="line"><span class="attr">      severity:</span> <span class="string">'critical'</span></span><br><span class="line"><span class="attr">    target_macth:</span></span><br><span class="line"><span class="attr">      severity:</span> <span class="string">'warning'</span></span><br><span class="line"><span class="attr">    equal:</span> <span class="string">['alertname','instance']</span></span><br><span class="line"></span><br><span class="line"><span class="attr">receivers:</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">webhook</span>Â  </span><br><span class="line"><span class="attr">  webhook_configs:</span>Â  </span><br><span class="line"><span class="attr">  - url:</span> <span class="attr">http://localhost:8060/dingtalk/ops_dingding/send</span>Â Â  Â  </span><br><span class="line"><span class="attr">    send_resolved:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">webhook-kafka</span>Â  </span><br><span class="line"><span class="attr">  webhook_configs:</span>Â  </span><br><span class="line"><span class="attr">  - url:</span> <span class="attr">http://localhost:8062/dingtalk/ops_59/send</span>Â  Â </span><br><span class="line"><span class="attr">    send_resolved:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Tips : æˆ‘ä»¬æ²¡æœ‰ä¸»åŠ¨æ·»åŠ æ–°çš„æ¥æ”¶å™¨ï¼Œå»ºè®®é€šè¿‡<a href="https://prometheus.io/docs/alerting/latest/configuration/#webhook_config" target="_blank" rel="noopener">webhook</a>æ¥æ”¶å™¨å®ç°è‡ªå®šä¹‰é€šçŸ¥é›†æˆã€‚</p>

        </div>
        
  <hr>
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>

  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>

  <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ï¼Œè½¬ä¸ªå‘ã€‘(äººé—´äº”å¤§æƒ…)</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œè°¢è°¢ï¼ã€‚</p>

  <div>
    <img src="https://www.weiyigeek.top/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul>

  <div>
    <img src="/img/wechat-search.png" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·"  width="328" height="149">
    <img src="/img/wechat-app.png" class="img-responsive" alt="æ‰«æVisit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº"  width="328" height="149">
  </div>


  <hr>
  


  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-03-29T05:39:03.674Z" itemprop="dateUpdated">2022-03-29 13:39:03</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/åŠŸèƒ½ç»„ä»¶/Prometheus/2.Prometheusç›‘æ§å…¥é—¨ä¹‹ç›‘æ§é…ç½®è¯´æ˜åŠå…¶å®ä¾‹.md" target="_blank" rel="noopener noreferrer">_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/åŠŸèƒ½ç»„ä»¶/Prometheus/2.Prometheusç›‘æ§å…¥é—¨ä¹‹ç›‘æ§é…ç½®è¯´æ˜åŠå…¶å®ä¾‹.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2021/4-25-551.html" target="_blank" rel="external">https://blog.weiyigeek.top/2021/4-25-551.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">ğŸ‘ é’Ÿæ„ä½œè€…</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Prometheus/" rel="tag">Prometheus</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2021/4-25-551.html&title=ã€Š2.Prometheusç›‘æ§å…¥é—¨ä¹‹ç›‘æ§é…ç½®è¯´æ˜ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2021/4-25-551.html&title=ã€Š2.Prometheusç›‘æ§å…¥é—¨ä¹‹ç›‘æ§é…ç½®è¯´æ˜ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2021/4-25-551.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š2.Prometheusç›‘æ§å…¥é—¨ä¹‹ç›‘æ§é…ç½®è¯´æ˜ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2021/4-25-551.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2021/4-25-551.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2021/4-25-554.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">4.Prometheusç›‘æ§å…¥é—¨ä¹‹PromQLè¡¨è¾¾å¼è¯­æ³•å­¦ä¹ </h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2021/4-22-550.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">1.Prometheusç›‘æ§å…¥é—¨ä¹‹ä»‹ç»æ•´ä½“æ¶æ„åŠå®‰è£…</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-ç»„ä»¶ä»‹ç»"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 ç»„ä»¶ä»‹ç»</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Prometheus"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">Prometheus</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Exporter-amp-Collectors"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">Exporter&amp;Collectors</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Alertmanager"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">Alertmanager</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Pushgateway"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">Pushgateway</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-é…ç½®æ–‡ä»¶"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 é…ç½®æ–‡ä»¶</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Prometheus-yml"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">Prometheus.yml</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-è¯­æ³•æ ¼å¼"><span class="post-toc-number">2.1.1.</span> <span class="post-toc-text">(1) è¯­æ³•æ ¼å¼</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-åŸºç¡€ç¤ºä¾‹"><span class="post-toc-number">2.1.2.</span> <span class="post-toc-text">(2) åŸºç¡€ç¤ºä¾‹</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-API-Rsetful"><span class="post-toc-number">2.1.3.</span> <span class="post-toc-text">(3) API Rsetful</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Alert-rules"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">Alert.rules</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-è¯­æ³•æ ¼å¼-1"><span class="post-toc-number">2.2.1.</span> <span class="post-toc-text">(1) è¯­æ³•æ ¼å¼</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-åŸºç¡€ç¤ºä¾‹-1"><span class="post-toc-number">2.2.2.</span> <span class="post-toc-text">(2) åŸºç¡€ç¤ºä¾‹</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Alertmanager-yml"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">Alertmanager.yml</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-è¯­æ³•æ ¼å¼-2"><span class="post-toc-number">2.3.1.</span> <span class="post-toc-text">(1) è¯­æ³•æ ¼å¼</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-åŸºç¡€ç¤ºä¾‹-2"><span class="post-toc-number">2.3.2.</span> <span class="post-toc-text">(2) åŸºç¡€ç¤ºä¾‹</span></a></li></ol></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

  <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        äººé—´è‡ªæœ‰äº”å¤§æƒ…ã€ç‚¹èµã€æŠ•å¸(èµèµ)ã€æ”¶è—ã€å…³æ³¨ï¼Œè½¬å‘ã€‘, è°¢è°¢çœ‹å‹æ”¯æŒ!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

  
 <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->

  <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">ä¸ªäººGithub</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">ä¸ªäººGitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">ä¸ªäººçŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘+äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved. ITå”¯ä¸€æå®¢ ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2021/4-25-551.html&title=ã€Š2.Prometheusç›‘æ§å…¥é—¨ä¹‹ç›‘æ§é…ç½®è¯´æ˜ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2021/4-25-551.html&title=ã€Š2.Prometheusç›‘æ§å…¥é—¨ä¹‹ç›‘æ§é…ç½®è¯´æ˜ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2021/4-25-551.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š2.Prometheusç›‘æ§å…¥é—¨ä¹‹ç›‘æ§é…ç½®è¯´æ˜ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2021/4-25-551.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2021/4-25-551.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMUlEQVR42u3aS27DMAxFUe9/0+m0RWDhPjJuIPF6VKSJrKMBwY+uCz+vt+fuv+T7v7+zXufDjwwZMrZlvJbPeqMcc/er98/Xx3FLlSFDxgAGX3r9gtp3OmwZMmTISBlkW2RlGTJkyOgw0mJ1XaB+LeDKkCFjQwYJnaQpxhtt5DgeqcVlyJCxIYN33f//70fmGzJkyNiK8QofwiOFa38nf9aUIUPG0Qwe4EiyWNs0KlDJCjJkyBjGqF3qSi94kQYc/0SGDBmnMtJ0kDfu06Z/OuyMM1wZMmQcxOikeiRYd2C3BypDhowBjDThC7LOUqKZHoQMGTLOZvQngMFrwrYdX1OGDBlnM2rlKN9ifxiAfiVDhowBjHWrq1bE8iYa/7zYbpMhQ8bmjFouydNEkoB2SuKrVm3LkCFjK0Z6GYI3+nnI5uEYnb0MGTKOY/D2/afKXZL81cafMmTImMDohFGS9pGgyQ8rCL4yZMg4glELpqTFRkhpm6/VYpMhQ8a2jE7A7Tf30xUCjAwZMg5i9Nv0aVHKx5zBOEGGDBkDGPx6RHo5o1O+BocrQ4aMAYxaiEzDaNqAC8auMmTIOJRRa/R/aqP9Y5IhQ8YERhrm1qVsJwR3xg8yZMiYwKilhumL0yFlGrJlyJAxgVELfHx4EGwIh34ZMmTIqA01+wNOnowGpyhDhgwZjbBLKmyElCFDxgAGKWJro4JOeH2k3SZDhowNGa2bGqXRQpr2dS6cyZAhY3PGD0moapiDAgcUAAAAAElFTkSuQmCC" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 



  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 
     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>
