{"title":"BookStack企业团队小型Wiki(知识库网站)基础安装与使用","slug":"系统运维/Application/Wiki/BookStack企业团队小型WIKI基础安装与使用","date":"2020-05-11T04:34:30.000Z","updated":"2022-03-29T05:39:06.309Z","url":"2020/5-11-131.html","path":"api/articles/2020/5-11-131.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200514142545.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200511165928.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200511235956.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200511233754.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200512223115.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-背景前述\"><a href=\"#0x00-背景前述\" class=\"headerlink\" title=\"0x00 背景前述\"></a>0x00 背景前述</h4><p>描述:由于个人与公司团队有需求搭建一个团队共享的知识库,方便团队的技术沉淀积累与同时也方便新人入职学习了解各项工作,通过一天的找寻在网上最终入坑了BookStack方案;</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200514142545.png\" alt=\"WeiyiGeek.bookstack\" title=\"\" class=\"\">\n                <p>WeiyiGeek.bookstack</p>\n            </figure>\n<p><strong>其它方案参考</strong></p>\n<ul>\n<li>1.Flarum轻论坛:<a href=\"https://flarum.org/\" target=\"_blank\" rel=\"noopener\">https://flarum.org/</a></li>\n<li>2.各种共享笔记:Wiz (私有版本支持5用户系统要求高显得笨重)/ OneNote (公司内部使用不方便且不能存储敏感信息) / 有道云笔记 (感觉不好用)</li>\n<li>3.在线文档:阿里提供的语雀(企业空间需要5999元/年-我们只是一个小Team) / 看云文档 / <a href=\"https://www.showdoc.cc/\" target=\"_blank\" rel=\"noopener\">开源软件ShowDoc</a> (UI界面轻量级) / 腾讯在线文档 (个人还是偏向于自建)</li>\n<li>4.Wiki软件: DokuWiki (搭建使用简单无数据库)和 MediaWiki </li>\n<li>5.Wiki应用: <a href=\"https://www.iminho.me/\" target=\"_blank\" rel=\"noopener\">Mindoc</a> / Bookstack 两则都是基于 PHP 框架 laravel 开发，但个人更推荐后者使用简单UI更加大气;</li>\n</ul>\n<p><strong>Bookstack简单介绍</strong><br>描述:BookStack是一个简单的、自托管的、易于使用的组织和存储信s息的平台(<code>Simple &amp; Free Wiki Software</code>)。</p>\n<p>产品特点:</p>\n<ul>\n<li>免费和开源</li>\n<li>简单API,简单的接口:WYSIWYG interface(所见即所得)</li>\n<li>全文搜索和连接</li>\n<li>可自定义配置</li>\n<li>简单的要求，跨书分类、页面修订和图像管理功能</li>\n<li>完整的角色和权限系统</li>\n<li>支持多语言: <code>BookStack include EN, FR, DE, ES, IT, JA, NL, PL, RU and more.</code></li>\n<li>支持Markdown: Markdown Editor</li>\n<li>集成身份验证: 第三方 GitHub, Google, Slack, AzureAD 与 Okta 和 LDAP ;</li>\n</ul>\n<hr>\n<h4 id=\"0x01-安装\"><a href=\"#0x01-安装\" class=\"headerlink\" title=\"0x01 安装\"></a>0x01 安装</h4><p>官网手册:<a href=\"https://www.bookstackapp.com/docs/admin/installation/\" target=\"_blank\" rel=\"noopener\">https://www.bookstackapp.com/docs/admin/installation/</a><br>环境需求:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PHP &gt;= 7.2: Required Extensions: OpenSSL, PDO, MBstring, Tokenizer, GD, MySQL, Tidy, SimpleXML &amp; DOM</span><br><span class=\"line\">MySQL &gt;= 5.6: Mariadb也是可以的;</span><br><span class=\"line\">Nginx 轻量级代理web</span><br><span class=\"line\">Git 版本控制: 更新</span><br></pre></td></tr></table></figure></p>\n<p><strong>安装方法:(三类)</strong></p>\n<ul>\n<li>手动安装</li>\n<li>脚本安装</li>\n<li>docker安装</li>\n</ul>\n<p><strong>(1) 手动安装</strong><br>在安装之前，请确保满足上述要求。<br>此项目当前使用 BookStack GitHub 存储库的分支作为提供更新的稳定通道(<code>或许后面变得更加简单</code>)<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/BookStackApp/BookStack.git --branch release --single-branch</span><br></pre></td></tr></table></figure></p>\n<p>URL 重写规则<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#Apache</span></span><br><span class=\"line\">Options +FollowSymLinks</span><br><span class=\"line\">RewriteEngine On</span><br><span class=\"line\">RewriteCond %&#123;REQUEST_FILENAME&#125; !-d</span><br><span class=\"line\">RewriteCond %&#123;REQUEST_FILENAME&#125; !-f</span><br><span class=\"line\">RewriteRule ^ index.php [L]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Nginx</span></span><br><span class=\"line\">location / &#123;</span><br><span class=\"line\">    try_files <span class=\"variable\">$uri</span> <span class=\"variable\">$uri</span>/ /index.php?<span class=\"variable\">$query_string</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br>参考:<a href=\"https://www.bookstackapp.com/docs/admin/installation/#manual\" target=\"_blank\" rel=\"noopener\">https://www.bookstackapp.com/docs/admin/installation/#manual</a></p>\n<p><br/></p>\n<p><strong>(2) 脚本安装</strong><br><em>Ubuntu 20.04 Installation Script</em><br>此脚本仅适用于新操作系统，它将安装<code>Apache、MySQL 8.0和PHP-7.4</code>，并可能覆盖机器上的任何现有web设置。<br>脚本查看:<a href=\"https://github.com/BookStackApp/devops/blob/master/scripts/installation-ubuntu-20.04.sh\" target=\"_blank\" rel=\"noopener\">https://github.com/BookStackApp/devops/blob/master/scripts/installation-ubuntu-20.04.sh</a><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://raw.githubusercontent.com/BookStackApp/devops/master/scripts/installation-ubuntu-20.04.sh</span><br><span class=\"line\">chmod a+x !$:t</span><br><span class=\"line\">./!$:t</span><br></pre></td></tr></table></figure></p>\n<p>CentOS8:<br>安装参考:<a href=\"https://github.com/blogmotion/bm-bookstack-install/blob/master/bookstack-install-centos8.sh\" target=\"_blank\" rel=\"noopener\">https://github.com/blogmotion/bm-bookstack-install/blob/master/bookstack-install-centos8.sh</a><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># bm-bookstack-install : Installation de BookStack pour Centos 8.x</span></span><br><span class=\"line\"><span class=\"comment\"># License : Creative Commons http://creativecommons.org/licenses/by-nd/4.0/deed.fr</span></span><br><span class=\"line\"><span class=\"comment\"># Website : http://blogmotion.fr/internet/bookstack-script-installation-centos-8-18255</span></span><br><span class=\"line\"><span class=\"comment\"># BookStack : https://www.bookstackapp.com/</span></span><br><span class=\"line\"><span class=\"comment\"># Adapted from : https://deviant.engineer/2017/02/bookstack-centos7/</span></span><br><span class=\"line\"><span class=\"comment\">#set -xe</span></span><br><span class=\"line\">VERSION=<span class=\"string\">\"2020.04.01\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### VARIABLES #######################################################################################################################</span></span><br><span class=\"line\">VARWWW=<span class=\"string\">\"/var/www\"</span></span><br><span class=\"line\">BOOKSTACK_DIR=<span class=\"string\">\"<span class=\"variable\">$&#123;VARWWW&#125;</span>/BookStack\"</span></span><br><span class=\"line\">TMPROOTPWD=<span class=\"string\">\"/tmp/DB_ROOT.delete\"</span></span><br><span class=\"line\">REMIRPM=<span class=\"string\">\"http://rpms.remirepo.net/enterprise/8/remi/x86_64/remi-release-8.1-2.el8.remi.noarch.rpm\"</span></span><br><span class=\"line\"><span class=\"comment\">#CURRENT_IP=$(ip addr | grep 'state UP' -A2 | tail -n1 | awk '&#123;print $2&#125;' | cut -f1  -d'/')</span></span><br><span class=\"line\">CURRENT_IP=$(hostname -i)</span><br><span class=\"line\">blanc=<span class=\"string\">\"\\033[1;37m\"</span>; gris=<span class=\"string\">\"\\033[0;37m\"</span>; magenta=<span class=\"string\">\"\\033[0;35m\"</span>; rouge=<span class=\"string\">\"\\033[1;31m\"</span>; vert=<span class=\"string\">\"\\033[1;32m\"</span>; jaune=<span class=\"string\">\"\\033[1;33m\"</span>; bleu=<span class=\"string\">\"\\033[1;34m\"</span>; rescolor=<span class=\"string\">\"\\033[0m\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### START SCRIPT #################################################################################################################### </span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"<span class=\"variable\">$&#123;vert&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"#########################################################\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"#                                                       #\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"#                BookStack Installation                 #\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"#                                                       #\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"#              Tested on Centos 8.1 (x64)               #\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"#                      by @xhark                        #\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"#                                                       #\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"###################### <span class=\"variable\">$&#123;VERSION&#125;</span> #######################\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"<span class=\"variable\">$&#123;rescolor&#125;</span>\\n\\n\"</span></span><br><span class=\"line\">sleep 3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n<span class=\"variable\">$&#123;jaune&#125;</span>SELinux disable and firewall settings ...<span class=\"variable\">$&#123;rescolor&#125;</span>\"</span> &amp;&amp; sleep 1</span><br><span class=\"line\">sed -i s/^SELINUX=.*$/SELINUX=disabled/ /etc/selinux/config &amp;&amp; setenforce 0</span><br><span class=\"line\">firewall-cmd --add-service=http --permanent &amp;&amp; firewall-cmd --add-service=https --permanent &amp;&amp; firewall-cmd --reload</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### PACKAGES INSTALLATION ##########################################################################################################</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n<span class=\"variable\">$&#123;jaune&#125;</span>Packages installation ...<span class=\"variable\">$&#123;rescolor&#125;</span>\"</span> &amp;&amp; sleep 1</span><br><span class=\"line\">yum -y update</span><br><span class=\"line\">yum -y install epel-release <span class=\"comment\"># (Extra Packages for Enterprise Linux)</span></span><br><span class=\"line\">yum -y install git mariadb-server nginx php php-cli php-fpm php-json php-gd php-mysqlnd php-xml php-openssl php-tokenizer php-mbstring php-mysqlnd</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Add REMI repo</span></span><br><span class=\"line\">yum install -y <span class=\"variable\">$REMIRPM</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [[ $? -ne 0 ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\t <span class=\"variable\">$&#123;rouge&#125;</span> ERROR on Remi RPM, please check RPM URL : <span class=\"variable\">$REMIRPM</span> <span class=\"variable\">$&#123;rescolor&#125;</span>\"</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\t <span class=\"variable\">$&#123;gris&#125;</span> script aborted, please restart after fix it <span class=\"variable\">$&#123;rescolor&#125;</span>\"</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">dnf --enablerepo=remi install -y php72-php-tidy php72-php-json</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># create symlink tidy.so and enable extension in php.ini</span></span><br><span class=\"line\">ln -s /opt/remi/php72/root/usr/lib64/php/modules/tidy.so /usr/lib64/php/modules/tidy.so</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"extension=tidy\"</span> &gt;&gt; /etc/php.ini</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### Database setup ###############################################################################################################</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n<span class=\"variable\">$&#123;jaune&#125;</span>Database installation ...<span class=\"variable\">$&#123;rescolor&#125;</span>\"</span> &amp;&amp; sleep 1</span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> --now mariadb.service</span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">\"\\n n\\n n\\n n\\n y\\n y\\n y\\n\"</span> | mysql_secure_installation</span><br><span class=\"line\"></span><br><span class=\"line\">mysql --execute=<span class=\"string\">\"</span></span><br><span class=\"line\"><span class=\"string\">CREATE DATABASE IF NOT EXISTS bookstackdb DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;</span></span><br><span class=\"line\"><span class=\"string\">GRANT ALL PRIVILEGES ON bookstackdb.* TO 'bookstackuser'@'localhost' IDENTIFIED BY 'bookstackpass' WITH GRANT OPTION;</span></span><br><span class=\"line\"><span class=\"string\">FLUSH PRIVILEGES;</span></span><br><span class=\"line\"><span class=\"string\">quit\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Set root password</span></span><br><span class=\"line\">DB_ROOT=$(cat /dev/urandom | tr -<span class=\"built_in\">cd</span> <span class=\"string\">'A-Za-z0-9'</span> | head -c 14)</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"MariaDB root:<span class=\"variable\">$&#123;DB_ROOT&#125;</span>\"</span> &gt;&gt; TMPROOTPWD &amp;&amp; cat <span class=\"variable\">$TMPROOTPWD</span></span><br><span class=\"line\"><span class=\"comment\"># mysqladmin -u root password $&#123;DB_ROOT&#125;</span></span><br><span class=\"line\">mysql -e <span class=\"string\">\"SET PASSWORD FOR root@localhost = PASSWORD('<span class=\"variable\">$&#123;DB_ROOT&#125;</span>');FLUSH PRIVILEGES;\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### PHP-FPM setup ###############################################################################################################</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n<span class=\"variable\">$&#123;jaune&#125;</span>PHP-FPM configuration ...<span class=\"variable\">$&#123;rescolor&#125;</span>\"</span> &amp;&amp; sleep 1</span><br><span class=\"line\">fpmconf=/etc/php-fpm.d/www.conf</span><br><span class=\"line\">sed -i <span class=\"string\">\"s|^listen =.*$|listen = /var/run/php-fpm.sock|\"</span> <span class=\"variable\">$fpmconf</span></span><br><span class=\"line\">sed -i <span class=\"string\">\"s|^;listen.owner =.*$|listen.owner = nginx|\"</span> <span class=\"variable\">$fpmconf</span></span><br><span class=\"line\">sed -i <span class=\"string\">\"s|^;listen.group =.*$|listen.group = nginx|\"</span> <span class=\"variable\">$fpmconf</span></span><br><span class=\"line\">sed -i <span class=\"string\">\"s|^user = apache.*$|user = nginx ; PHP-FPM running user|\"</span> <span class=\"variable\">$fpmconf</span></span><br><span class=\"line\">sed -i <span class=\"string\">\"s|^group = apache.*$|group = nginx ; PHP-FPM running group|\"</span> <span class=\"variable\">$fpmconf</span></span><br><span class=\"line\">sed -i <span class=\"string\">\"s|^php_value\\[session.save_path\\].*$|php_value[session.save_path] = <span class=\"variable\">$&#123;VARWWW&#125;</span>/sessions|\"</span> <span class=\"variable\">$fpmconf</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### NGINX SETUP #################################################################################################################</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n<span class=\"variable\">$&#123;jaune&#125;</span>nginx configuration ...<span class=\"variable\">$&#123;rescolor&#125;</span>\"</span> &amp;&amp; sleep 1</span><br><span class=\"line\">mv /etc/nginx/nginx.conf /etc/nginx/nginx.conf.BAK</span><br><span class=\"line\"></span><br><span class=\"line\">cat &lt;&lt; <span class=\"string\">'_EOF_'</span> &gt; /etc/nginx/nginx.conf</span><br><span class=\"line\">user nginx;</span><br><span class=\"line\">worker_processes auto;</span><br><span class=\"line\">error_log /var/<span class=\"built_in\">log</span>/nginx/error.log;</span><br><span class=\"line\">pid /run/nginx.pid;</span><br><span class=\"line\">include /usr/share/nginx/modules/*.conf;</span><br><span class=\"line\">events &#123;</span><br><span class=\"line\">    worker_connections 1024;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">http &#123;</span><br><span class=\"line\">    log_format  main  <span class=\"string\">'$remote_addr - $remote_user [$time_local] \"$request\" '</span></span><br><span class=\"line\">                      <span class=\"string\">'$status $body_bytes_sent \"$http_referer\" '</span></span><br><span class=\"line\">                      <span class=\"string\">'\"$http_user_agent\" \"$http_x_forwarded_for\"'</span>;</span><br><span class=\"line\">    access_log  /var/<span class=\"built_in\">log</span>/nginx/access.log  main;</span><br><span class=\"line\">    sendfile            on;</span><br><span class=\"line\">    tcp_nopush          on;</span><br><span class=\"line\">    tcp_nodelay         on;</span><br><span class=\"line\">    keepalive_timeout   65;</span><br><span class=\"line\">    types_hash_max_size 2048;</span><br><span class=\"line\">    include             /etc/nginx/mime.types;</span><br><span class=\"line\">    default_type        application/octet-stream;</span><br><span class=\"line\">    include /etc/nginx/conf.d/*.conf;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">_EOF_</span><br><span class=\"line\"></span><br><span class=\"line\">cat &lt;&lt; <span class=\"string\">'_EOF_'</span> &gt; /etc/nginx/conf.d/bookstack.conf</span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">  listen 80;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">#HTTP conf:</span></span><br><span class=\"line\">  <span class=\"comment\">#listen 443 ssl;</span></span><br><span class=\"line\">  <span class=\"comment\">#ssl_certificate /etc/pki/tls/blogmotion/monserveur.crt;</span></span><br><span class=\"line\">  <span class=\"comment\">#ssl_certificate_key /etc/pki/tls/blogmotion/monserveur.key;</span></span><br><span class=\"line\">  <span class=\"comment\">#ssl_protocols TLSv1.2;</span></span><br><span class=\"line\">  <span class=\"comment\">#ssl_prefer_server_ciphers on;</span></span><br><span class=\"line\">  server_name _;</span><br><span class=\"line\">  root /var/www/BookStack/public;</span><br><span class=\"line\">  access_log  /var/<span class=\"built_in\">log</span>/nginx/bookstack_access.log;</span><br><span class=\"line\">  error_log  /var/<span class=\"built_in\">log</span>/nginx/bookstack_error.log;</span><br><span class=\"line\">  client_max_body_size 1G;</span><br><span class=\"line\">  fastcgi_buffers 64 4K;</span><br><span class=\"line\">  index  index.php;</span><br><span class=\"line\">  location / &#123;</span><br><span class=\"line\">    try_files <span class=\"variable\">$uri</span> <span class=\"variable\">$uri</span>/ /index.php?<span class=\"variable\">$query_string</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  location ~ ^/(?:\\.htaccess|data|config|db_structure\\.xml|README) &#123;</span><br><span class=\"line\">    deny all;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  location ~ \\.php(?:$|/) &#123;</span><br><span class=\"line\">    fastcgi_split_path_info ^(.+\\.php)(/.+)$;</span><br><span class=\"line\">    include fastcgi_params;</span><br><span class=\"line\">    fastcgi_param SCRIPT_FILENAME <span class=\"variable\">$document_root</span><span class=\"variable\">$fastcgi_script_name</span>;</span><br><span class=\"line\">    fastcgi_param PATH_INFO <span class=\"variable\">$fastcgi_path_info</span>;</span><br><span class=\"line\">    fastcgi_pass unix:/var/run/php-fpm.sock;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  location ~* \\.(?:jpg|jpeg|gif|bmp|ico|png|css|js|swf)$ &#123;</span><br><span class=\"line\">    expires 30d;</span><br><span class=\"line\">    access_log off;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">_EOF_</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable and start services</span></span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> --now nginx.service</span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> --now php-fpm.service</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### BOOKSTACK INSTALLATION ################################################################################################################</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n<span class=\"variable\">$&#123;jaune&#125;</span>BookStack installation ...<span class=\"variable\">$&#123;rescolor&#125;</span>\"</span> &amp;&amp; sleep 1</span><br><span class=\"line\">mkdir -p <span class=\"variable\">$&#123;VARWWW&#125;</span>/sessions <span class=\"comment\"># php sessions</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Clone the latest from the release branch</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/BookStackApp/BookStack.git --branch release --single-branch <span class=\"variable\">$&#123;BOOKSTACK_DIR&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># let composer do it's things</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/<span class=\"built_in\">local</span>/bin</span><br><span class=\"line\">curl -sS https://getcomposer.org/installer | php</span><br><span class=\"line\">mv composer.phar composer</span><br><span class=\"line\"><span class=\"built_in\">cd</span> <span class=\"variable\">$&#123;BOOKSTACK_DIR&#125;</span></span><br><span class=\"line\">composer install</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Config file injection</span></span><br><span class=\"line\">cp .env.example .env</span><br><span class=\"line\">sed -i <span class=\"string\">\"s|^DB_DATABASE=.*$|DB_DATABASE=bookstackdb|\"</span> .env</span><br><span class=\"line\">sed -i <span class=\"string\">\"s|^DB_USERNAME=.*$|DB_USERNAME=bookstackuser|\"</span> .env</span><br><span class=\"line\">sed -i <span class=\"string\">\"s|^DB_PASSWORD=.*$|DB_PASSWORD=bookstackpass|\"</span> .env</span><br><span class=\"line\">sed -i <span class=\"string\">\"s|^MAIL_PORT=.*$|MAIL_PORT=25|\"</span> .env</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Set in French if locale is FR</span></span><br><span class=\"line\">lang=$(locale | grep LANG | cut -d= -f2 | cut -d_ -f1)</span><br><span class=\"line\"><span class=\"keyword\">if</span> [[ <span class=\"variable\">$lang</span> -eq <span class=\"string\">\"fr\"</span> ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  sed -i <span class=\"string\">\"s|^# Application URL.*$|APP_LANG=fr\\n# Application URL|\"</span> .env</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Generate and update APP_KEY in .env</span></span><br><span class=\"line\">php artisan key:generate --force</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Generate database tables and other settings</span></span><br><span class=\"line\">php artisan migrate --force</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Fix rights</span></span><br><span class=\"line\">chown -R nginx:nginx /var/www/&#123;BookStack,sessions&#125;</span><br><span class=\"line\">chmod -R 755 bootstrap/cache public/uploads storage</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n\\n\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\t * 1 * <span class=\"variable\">$&#123;vert&#125;</span>PLEASE NOTE the MariaDB password root:<span class=\"variable\">$&#123;DB_ROOT&#125;</span> <span class=\"variable\">$&#123;rescolor&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\t * 2 * <span class=\"variable\">$&#123;rouge&#125;</span>AND DELETE the file <span class=\"variable\">$&#123;TMPROOTPWD&#125;</span> <span class=\"variable\">$&#123;rescolor&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\t * 3 * <span class=\"variable\">$&#123;bleu&#125;</span>Logon http://<span class=\"variable\">$&#123;HOSTNAME&#125;</span> or http://<span class=\"variable\">$&#123;CURRENT_IP&#125;</span> -&gt; admin@admin.com:password <span class=\"variable\">$&#123;rescolor&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n\\t<span class=\"variable\">$&#123;magenta&#125;</span> --- END OF SCRIPT (v<span class=\"variable\">$&#123;VERSION&#125;</span>) ---  \\n\\n\\n <span class=\"variable\">$&#123;rescolor&#125;</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">exit</span> 0</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p><strong>(3) Docker安装</strong><br>基础Docker安装BookStack:<br>Docker Hub:<a href=\"https://hub.docker.com/r/linuxserver/bookstack\" target=\"_blank\" rel=\"noopener\">https://hub.docker.com/r/linuxserver/bookstack</a></p>\n<p>环境说明:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#Docker与Docker-Compose安装参考我Docker记录的笔记</span></span><br><span class=\"line\">[root@weiyigeek tmp]$ docker --version</span><br><span class=\"line\">Docker version 19.03.8, build afacb8b</span><br><span class=\"line\">[root@weiyigeek tmp]$ docker-compose -v</span><br><span class=\"line\">docker-compose version 1.25.5, build 8a1c60f6</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p>Step1.持久化目录建议以及docker专有网络<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -vp /app/bookstack/&#123;data,web&#125;</span><br><span class=\"line\">docker network create bookstack</span><br><span class=\"line\"><span class=\"comment\">#573b6beffe0cf80c4718bcaec356006b5814e8a76482fe58fdc0456cd27cd56b</span></span><br><span class=\"line\">docker network ls</span><br><span class=\"line\"><span class=\"comment\"># NETWORK ID          NAME                DRIVER              SCOPE</span></span><br><span class=\"line\"><span class=\"comment\"># 573b6beffe0c        bookstack           bridge              local</span></span><br><span class=\"line\"><span class=\"comment\"># 222e290b6d38        bridge              bridge              local</span></span><br><span class=\"line\"><span class=\"comment\"># 5ff53ab796aa        host                host                local</span></span><br><span class=\"line\"><span class=\"comment\"># 665c6dab3999        none                null                local</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#将bookstack网络地址加入防火墙信任即可容器间相互通信</span></span><br><span class=\"line\">docker network inspect bookstack</span><br><span class=\"line\">firewall-cmd --zone=trusted --add-source=172.18.0.1/16 --permanent</span><br><span class=\"line\">firewall-cmd --reload</span><br></pre></td></tr></table></figure></p>\n<p>Step2.BookStack 关键参数设置参看官网（<a href=\"https://github.com/BookStackApp/BookStack/blob/master/.env.example\" target=\"_blank\" rel=\"noopener\">env</a>）<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt;.env&lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\"><span class=\"comment\"># User Permiss</span></span><br><span class=\"line\">PUID=1000</span><br><span class=\"line\">PGID=1000</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Database Setting</span></span><br><span class=\"line\">DB_HOST=bookstack_db</span><br><span class=\"line\">DB_PORT=3306</span><br><span class=\"line\">DB_DATABASE=bookstackapp</span><br><span class=\"line\">DB_USERNAME=bookstack</span><br><span class=\"line\">DB_PASSWORD=WeiyiGeek</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Basic Setting</span></span><br><span class=\"line\">APP_TIMEZONE=Asia/Shanghai</span><br><span class=\"line\">APP_LANG=zh_CN</span><br><span class=\"line\">APP_ENV=production</span><br><span class=\"line\">WKHTMLTOPDF=/usr/bin/wkhtmltopdf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Debug: Error File laravel.log</span></span><br><span class=\"line\"><span class=\"comment\">#APP_DEBUG=true</span></span><br><span class=\"line\">APP_URL=http://my.weiyigeek.top <span class=\"comment\">#optional</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># LDAP General auth (有些许<span class=\"doctag\">BUG:</span>v.29)</span></span><br><span class=\"line\"><span class=\"comment\">#AUTH_METHOD=ldap</span></span><br><span class=\"line\"><span class=\"comment\">#LDAP_SERVER=10.10.107.245:389</span></span><br><span class=\"line\"><span class=\"comment\">#LDAP_BASE_DN=dc=weiyigeek,dc=cn</span></span><br><span class=\"line\"><span class=\"comment\">#LDAP_DN=cn=admin,dc=weiyigeek,dc=cn</span></span><br><span class=\"line\"><span class=\"comment\">#LDAP_PASS=Password2020</span></span><br><span class=\"line\"><span class=\"comment\">#LDAP_USER_FILTER=(&amp;(uid=*))</span></span><br><span class=\"line\"><span class=\"comment\">#LDAP_VERSION=3</span></span><br><span class=\"line\"><span class=\"comment\">#LDAP_DISPLAY_NAME_ATTRIBUTE=cn</span></span><br><span class=\"line\"><span class=\"comment\">#LDAP_ID_ATTRIBUTE=uid</span></span><br><span class=\"line\"><span class=\"comment\">#LDAP_EMAIL_ATTRIBUTE=mail</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Mail Setting</span></span><br><span class=\"line\"><span class=\"comment\">#- MAIL_DRIVER=smtp</span></span><br><span class=\"line\"><span class=\"comment\">#- MAIL_FROM=service@example.com</span></span><br><span class=\"line\"><span class=\"comment\">#- MAIL_FROM_NAME=\"XXXX知识库\"</span></span><br><span class=\"line\"><span class=\"comment\"># SMTP mail options</span></span><br><span class=\"line\"><span class=\"comment\">#- MAIL_HOST=smtpdm.aliyun.com</span></span><br><span class=\"line\"><span class=\"comment\">#- MAIL_PORT=465</span></span><br><span class=\"line\"><span class=\"comment\">#- MAIL_USERNAME=service@example.com</span></span><br><span class=\"line\"><span class=\"comment\">#- MAIL_PASSWORD=password</span></span><br><span class=\"line\"><span class=\"comment\">#- MAIL_ENCRYPTION=ssl</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Application key:Used for encryption where needed.</span></span><br><span class=\"line\"><span class=\"comment\"># Run `php artisan key:generate` to generate a valid key. </span></span><br><span class=\"line\"><span class=\"comment\"># The only supported ciphers are AES-128-CBC and AES-256-CBC with the correct key lengths 16 . </span></span><br><span class=\"line\"><span class=\"comment\"># APP_KEY=base64:v2qr11Dmf+wWw9j6j09udZPhSHJHw9lZ2xA7dz24YPA=</span></span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure></p>\n<p>Step3.容器docker-compose.yaml<br><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">\"3.0\"</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\"><span class=\"attr\">  bookstack:</span></span><br><span class=\"line\"><span class=\"attr\">    image:</span> <span class=\"string\">linuxserver/bookstack</span></span><br><span class=\"line\"><span class=\"attr\">    container_name:</span> <span class=\"string\">bookstack</span></span><br><span class=\"line\"><span class=\"attr\">    env_file:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">./.env</span></span><br><span class=\"line\"><span class=\"attr\">    volumes:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">/app/bookstack/web:/config</span></span><br><span class=\"line\"><span class=\"attr\">    ports:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"number\">80</span><span class=\"string\">:80</span></span><br><span class=\"line\"><span class=\"attr\">    restart:</span> <span class=\"string\">unless-stopped</span></span><br><span class=\"line\"><span class=\"attr\">    depends_on:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">bookstack_db</span></span><br><span class=\"line\"><span class=\"attr\">    networks:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">bookstack</span></span><br><span class=\"line\">     </span><br><span class=\"line\"><span class=\"attr\">  bookstack_db:</span></span><br><span class=\"line\"><span class=\"attr\">    image:</span> <span class=\"string\">linuxserver/mariadb</span></span><br><span class=\"line\"><span class=\"attr\">    container_name:</span> <span class=\"string\">bookstack_db</span></span><br><span class=\"line\"><span class=\"attr\">    environment:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">PUID=1000</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">PGID=1000</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">TZ=Asia/Shanghai</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">MYSQL_ROOT_PASSWORD=WeiyiGeek</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">MYSQL_DATABASE=bookstackapp</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">MYSQL_USER=bookstack</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">MYSQL_PASSWORD=WeiyiGeek</span></span><br><span class=\"line\"><span class=\"attr\">    volumes:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">/app/bookstack/data:/config</span></span><br><span class=\"line\"><span class=\"attr\">    restart:</span> <span class=\"string\">unless-stopped</span></span><br><span class=\"line\"><span class=\"attr\">    ports:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"number\">3366</span><span class=\"string\">:3306</span></span><br><span class=\"line\"><span class=\"attr\">    networks:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">bookstack</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#自定义已存在的外部网络</span></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\"><span class=\"attr\">  bookstack:</span></span><br><span class=\"line\"><span class=\"attr\">    external:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure></p>\n<p>Step4.运行指令构建容器<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose up -d</span><br><span class=\"line\"><span class=\"comment\">#构建成功特征</span></span><br><span class=\"line\">bookstack       | Migrated:  2019_07_07_112515_add_template_support (0.04 seconds)</span><br><span class=\"line\">bookstack       | Migrating: 2019_08_17_140214_add_user_invites_table</span><br><span class=\"line\">bookstack       | Migrated:  2019_08_17_140214_add_user_invites_table (0.05 seconds)</span><br><span class=\"line\">bookstack       | Migrating: 2019_12_29_120917_add_api_auth</span><br><span class=\"line\">bookstack       | Migrated:  2019_12_29_120917_add_api_auth (0.07 seconds)</span><br><span class=\"line\">bookstack       | [services.d] starting services</span><br><span class=\"line\">bookstack       | [services.d] <span class=\"keyword\">done</span>.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$docker</span> ps</span><br><span class=\"line\">CONTAINER ID        IMAGE                   COMMAND             CREATED             STATUS              PORTS                           NAMES</span><br><span class=\"line\">2ff08e960aa2        linuxserver/bookstack   <span class=\"string\">\"/init\"</span>             5 hours ago         Up 5 hours          443/tcp, 0.0.0.0:9000-&gt;80/tcp   bookstack</span><br><span class=\"line\">5b8d5dd33af0        linuxserver/mariadb     <span class=\"string\">\"/init\"</span>             5 hours ago         Up 5 hours          3306/tcp                        bookstack_db</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#查看生效的环境变量</span></span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> -it bookstack env</span><br></pre></td></tr></table></figure></p>\n<p>Step5.访问登陆系统:<code>http://xxx.xxx.xx.x:9000</code>,默认账号密码<br>用户电子邮件地址:<a href=\"mailto:admin@admin.com\">admin@admin.com</a><br>密码:password<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200511165928.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<hr>\n<h4 id=\"0x02-基础设置\"><a href=\"#0x02-基础设置\" class=\"headerlink\" title=\"0x02 基础设置\"></a>0x02 基础设置</h4><h5 id=\"1-安全设置\"><a href=\"#1-安全设置\" class=\"headerlink\" title=\"1.安全设置\"></a>1.安全设置</h5><ul>\n<li>1.修改初始用户的密码和电子邮件地址</li>\n<li>2.低权限用户BookStack 的数据库用户具有仅访问用于 BookStack 数据的数据库的有限权限。</li>\n<li>3.禁用”目录索引”，以防止未知用户能够浏览图像。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#Nginx</span></span><br><span class=\"line\"><span class=\"comment\"># By default indexes are disabled on Nginx but if you have them enabled</span></span><br><span class=\"line\"><span class=\"comment\"># add this to your BookStack server block</span></span><br><span class=\"line\">location /uploads &#123;</span><br><span class=\"line\">       autoindex off;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Apache</span></span><br><span class=\"line\">&lt;Location <span class=\"string\">\"/uploads\"</span>&gt;</span><br><span class=\"line\">    Options -Indexes</span><br><span class=\"line\">&lt;/Location&gt;</span><br></pre></td></tr></table></figure></li>\n<li>4.Web爬网器控制:”设置自动控制。可以通过设置或在文件中覆盖此功能，如果要自定义规则，可以通过主题重写完成此操作。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#.env</span></span><br><span class=\"line\">ALLOW_ROBOTS=<span class=\"literal\">false</span></span><br></pre></td></tr></table></figure></li>\n<li>5.使用 Cookie 跟踪会话、记住登录次数和 XSRF 保护(需要生成申请证书)<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#.env</span></span><br><span class=\"line\">SESSION_SECURE_COOKIE=<span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h5 id=\"2-多实例部署\"><a href=\"#2-多实例部署\" class=\"headerlink\" title=\"2.多实例部署\"></a>2.多实例部署</h5><p>目前，BookStack 不支持一个安装中的多个实例，但您可以通过创建多个安装并适当地配置 Web 服务器在同一服务器上设置多个实例。</p>\n<p>按照每个实例的标准安装说明，从克隆 BookStack 到下面面创建的每个文件夹中开始<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/var/www/user-docs/</span><br><span class=\"line\">/var/www/admin-docs/</span><br></pre></td></tr></table></figure></p>\n<p>Ubuntu 16.04：Apache<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /etc/apaches/sites-available/user-docs.conf</span></span><br><span class=\"line\"> &lt;VirtualHost *:80&gt;</span><br><span class=\"line\">        ServerName user-docs.example.com</span><br><span class=\"line\">        DocumentRoot /var/www/user-docs/public</span><br><span class=\"line\">        &lt;Directory <span class=\"string\">\"/var/www/user-docs/public\"</span>&gt;</span><br><span class=\"line\">                AllowOverride All</span><br><span class=\"line\">                Require all granted</span><br><span class=\"line\">        &lt;/Directory&gt;</span><br><span class=\"line\">&lt;/VirtualHost&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#命令启用每个站点</span></span><br><span class=\"line\">sudo a2ensite &lt;config-file-name&gt;</span><br><span class=\"line\">sudo a2ensite user-docs.conf <span class=\"comment\">#/etc/apache/sites-enabled/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#完成此操作后，重新启动 apache 以重新加载配置</span></span><br><span class=\"line\">sudo service apache2 restart</span><br></pre></td></tr></table></figure></p>\n<p>Ubuntu 16.04:Nginx<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /etc/nginx/sites-available/user-docs.conf</span></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">  listen 80;</span><br><span class=\"line\">  listen [::]:80;</span><br><span class=\"line\"></span><br><span class=\"line\">  root /var/www/user-docs/public;</span><br><span class=\"line\">  index index.php;</span><br><span class=\"line\"></span><br><span class=\"line\">  server_name user-docs.example.com;</span><br><span class=\"line\"></span><br><span class=\"line\">  location / &#123;</span><br><span class=\"line\">      try_files <span class=\"variable\">$uri</span> <span class=\"variable\">$uri</span>/ /index.php?<span class=\"variable\">$query_string</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  location ~ \\.php$ &#123;</span><br><span class=\"line\">      try_files <span class=\"variable\">$uri</span> /index.php =404;</span><br><span class=\"line\">      fastcgi_split_path_info ^(.+\\.php)(/.+)$;</span><br><span class=\"line\">      fastcgi_pass unix:/run/php/php7.2-fpm.sock;</span><br><span class=\"line\">      fastcgi_index index.php;</span><br><span class=\"line\">      fastcgi_param SCRIPT_FILENAME <span class=\"variable\">$document_root</span><span class=\"variable\">$fastcgi_script_name</span>;</span><br><span class=\"line\">      include fastcgi_params;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">sudo ln -s /etc/nginx/sites-available/user-docs.conf /etc/nginx/sites-enabled/user-docs.conf</span><br><span class=\"line\">nginx -t</span><br><span class=\"line\">sudo service nginx restart</span><br></pre></td></tr></table></figure></p>\n<h5 id=\"3-备份还原\"><a href=\"#3-备份还原\" class=\"headerlink\" title=\"3.备份还原\"></a>3.备份还原</h5><p>BookStack 目前没有用于备份和还原的内置方法，但可以通过命令行相当简单完成(当您更新程序时候必须要备份后操作)</p>\n<p><span style='color:red'>警告：执行以下任何操作之前，请创建数据库备份，以防止潜在的数据丢失。</span></p>\n<p>备份有两种类型:<code>静态文件</code>与<code>数据库记录</code>:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># MySQL Command Syntax</span></span><br><span class=\"line\">mysqldump -u &#123;mysql_user&#125; -p &#123;database_name&#125; &gt; &#123;output_file_name&#125;</span><br><span class=\"line\">mysqldump -u bookstack bookstackapp &gt; bookstack.backup.sql</span><br></pre></td></tr></table></figure></p>\n<p>文件:下面是包含应备份的数据的文件和文件夹的列表<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.env <span class=\"comment\">#包含重要的配置信息。</span></span><br><span class=\"line\">&lt;bookstack_install_dir&gt;/public/uploads/images <span class=\"comment\">#图像上传位置文件夹包含任何上传的图像（如果不使用 amazon s3）-在Docker不同</span></span><br><span class=\"line\">&lt;bookstack_install_dir&gt;/storage/uploads/files <span class=\"comment\">#附件上传位置文件夹包含上传的页面附件（仅自 BookStack v0.13 起存在） -在Docker不同</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># BookStack v0.13+:将其复制到安全的地方，最好是在不同的设备上。</span></span><br><span class=\"line\">tar -czvf bookstack-files-backup.tar.gz .env public/uploads storage/uploads</span><br></pre></td></tr></table></figure></p>\n<p>如果要从头开始还原，请先按照安装说明进行安装，以便设置新的 BookStack 实例，但是在参照安装的时候请不要执行<code>php artisan migrate</code>，同时如果是安装比当前数据库备份时候高的新版本的需要在导入数据执行<code>php artisan migrate</code>;<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Syntax</span></span><br><span class=\"line\">mysql -u &#123;mysql_user&#125; -p &#123;database_name&#125; &lt; &#123;backup_file_name&#125;</span><br><span class=\"line\"><span class=\"comment\">## Only specify the -p if the user provided has a password</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Example</span></span><br><span class=\"line\">mysql -u benny -p bookstack &lt; bookstack.backup.sql</span><br></pre></td></tr></table></figure></p>\n<p>还原文件，只需将它们从备份存档复制到原始位置即可：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#如果发生错误请检查文件权限</span></span><br><span class=\"line\">tar -xvzf bookstack-files-backup.tar.gz</span><br></pre></td></tr></table></figure></p>\n<h5 id=\"4-更新\"><a href=\"#4-更新\" class=\"headerlink\" title=\"4.更新\"></a>4.更新</h5><p>BookStack 定期更新，仍处于测试阶段，尽管我们尝试保持平台和升级路径尽可能稳定；<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#拉取更新</span></span><br><span class=\"line\">git pull origin release &amp;&amp; composer install --no-dev &amp;&amp; php artisan migrate</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#清除缓存</span></span><br><span class=\"line\">php artisan cache:clear</span><br><span class=\"line\">php artisan view:clear</span><br></pre></td></tr></table></figure></p>\n<h5 id=\"5-主题设置\"><a href=\"#5-主题设置\" class=\"headerlink\" title=\"5.主题设置\"></a>5.主题设置</h5><p>描述:Bookstack另外一个强大的地方在于它可以使用自定义主题，而这些主题可以在github中找寻您喜欢的样式;</p>\n<ul>\n<li><a href=\"https://www.bookstackapp.com/docs/admin/visual-customisation/\" target=\"_blank\" rel=\"noopener\">主题设置说明</a></li>\n<li><a href=\"https://codemirror.net/demo/theme.html#base16-light\" target=\"_blank\" rel=\"noopener\">更多主题</a></li>\n</ul>\n<p>更改代码块主题：<br>将代码插入页面或使用 Markdown 编辑器时，您输入的文本将采用默认代码镜像配色方案突出显示;<br>在 BookStack 设置中，查找”自定义 HTML 头内容”设置并添加以下代码：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;link rel=<span class=\"string\">\"stylesheet\"</span> href=<span class=\"string\">\"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.29.0/theme/cobalt.min.css\"</span>/&gt;</span><br><span class=\"line\">&lt;script&gt;window.codeTheme=<span class=\"string\">'cobalt'</span>;&lt;/script&gt;</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200511235956.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<h5 id=\"6-第三方身份验证\"><a href=\"#6-第三方身份验证\" class=\"headerlink\" title=\"6.第三方身份验证\"></a>6.第三方身份验证</h5><p>BookStack 目前支持通过一系列第三方和社交应用程序登录。</p>\n<p>支持第三方社交应用:</p>\n<ul>\n<li>Google</li>\n<li>GitHub (<code>下面实践</code>)</li>\n<li>Twitter</li>\n<li>Facebook</li>\n<li>Slack</li>\n<li>AzureAD (Microsoft)</li>\n<li>Okta</li>\n<li>GitLab</li>\n<li>Twitch</li>\n<li>Discord</li>\n</ul>\n<p><br></p>\n<p><strong>Github第三方平台身份验证设置</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1.自动注册:从登录屏幕自动注册用户</span></span><br><span class=\"line\">GITHUB_AUTO_REGISTER=<span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.如果您信任第三方登录服务，您可以启用自动电子邮件确认</span></span><br><span class=\"line\">GITHUB_AUTO_CONFIRM_EMAIL=<span class=\"literal\">false</span></span><br></pre></td></tr></table></figure><br>3.GitHub Token 获取与设置</p>\n<ul>\n<li>Step1.登录时，打开GitHub 开发人员应用程序。</li>\n<li>Step2.单击”注册新应用程序”。输入应用程序名称（”BookStack”或自定义集名称）、”主页 URL”下指向应用实例的链接以及 BookStack 实例托管的 URL 的”授权回调 URL”，然后单击”注册应用程序”。</li>\n<li><p>Step3.将显示”客户端 ID”和”客户端机密”值。将这两个值添加到 和 变量，替换 BookStack 根文件夹中的”.env”文件中的默认假值。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GITHUB_APP_ID=4915**************</span><br><span class=\"line\">GITHUB_APP_SECRET=446da*************e0fc*************43a0995</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200511233754.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n</li>\n<li><p>Step4.将”APP_URL”环境变量设置为与步骤 3 中输入的域相同即<a href=\"http://wiki.weiyigeek.top。\" target=\"_blank\" rel=\"noopener\">http://wiki.weiyigeek.top。</a></p>\n</li>\n<li>Step5.都做完了！用户现在应该能够链接他们的社交帐户在他们的帐户配置文件页，也使用他们的Github帐户注册/登录。</li>\n</ul>\n<p>更多第三方平台配置参考:</p>\n<ul>\n<li><a href=\"https://www.bookstackapp.com/docs/admin/third-party-auth/\" target=\"_blank\" rel=\"noopener\">third-party-auth</a></li>\n</ul>\n<p><br></p>\n<h5 id=\"7-LDAP-身份验证\"><a href=\"#7-LDAP-身份验证\" class=\"headerlink\" title=\"7.LDAP 身份验证\"></a>7.LDAP 身份验证</h5><p>描述:BookStack 可以配置为允许基于 LDAP 的用户登录。<code>启用 LDAP 登录名时，您不能使用标准用户/密码登录登录，并且将禁用新用户注册</code>。</p>\n<p>当 LDAP 用户首次登录到 BookStack 时，将创建其 BookStack 配置文件，并在应用程序设置中的”注册后默认用户角色”选项下为其提供默认角色集。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#.env</span></span><br><span class=\"line\"><span class=\"comment\"># General auth</span></span><br><span class=\"line\">AUTH_METHOD=ldap</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># The LDAP host, Adding a port is optional</span></span><br><span class=\"line\">LDAP_SERVER=example.com:389</span><br><span class=\"line\"><span class=\"comment\"># If using LDAP over SSL you should also define the protocol:</span></span><br><span class=\"line\"><span class=\"comment\"># LDAP_SERVER=ldaps://example.com:636</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># The base DN from where users will be searched within</span></span><br><span class=\"line\">LDAP_BASE_DN=ou=People,dc=example,dc=com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># The full DN and password of the user used to search the server</span></span><br><span class=\"line\"><span class=\"comment\"># Can both be left as false to bind anonymously(否则匿名访问|注意DN需要输入完整的cn=admin + LDAP_BASE_DN)</span></span><br><span class=\"line\">LDAP_DN=<span class=\"literal\">false</span></span><br><span class=\"line\">LDAP_PASS=<span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># A filter to use when searching for users</span></span><br><span class=\"line\"><span class=\"comment\"># The user-provided user-name used to replace any occurrences of '$&#123;user&#125;'</span></span><br><span class=\"line\">LDAP_USER_FILTER=(&amp;(uid=\\<span class=\"variable\">$&#123;user&#125;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Set the LDAP version to use when connecting to the server</span></span><br><span class=\"line\">LDAP_VERSION=3.0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Set the property to use as a unique identifier for this user.</span></span><br><span class=\"line\"><span class=\"comment\"># Stored and used to match LDAP users with existing BookStack users.</span></span><br><span class=\"line\"><span class=\"comment\"># Prefixing the value with 'BIN;' will assume the LDAP service provides the attribute value as</span></span><br><span class=\"line\"><span class=\"comment\"># binary data and BookStack will convert the value to a hexidecimal representation.</span></span><br><span class=\"line\"><span class=\"comment\"># Defaults to 'uid'.</span></span><br><span class=\"line\">LDAP_ID_ATTRIBUTE=uid</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Set the default 'email' attribute. Defaults to 'mail'</span></span><br><span class=\"line\">LDAP_EMAIL_ATTRIBUTE=mail</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Set the property to use for a user's display name. Defaults to 'cn'</span></span><br><span class=\"line\">LDAP_DISPLAY_NAME_ATTRIBUTE=cn</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># If you need to allow untrusted LDAPS certificates, add the below and uncomment (remove the #)</span></span><br><span class=\"line\"><span class=\"comment\"># Only set this option if debugging or you're absolutely sure it's required for your setup.</span></span><br><span class=\"line\"><span class=\"comment\">#LDAP_TLS_INSECURE=true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># If you need to debug the details coming from your LDAP server, add the below and uncomment (remove the #)</span></span><br><span class=\"line\"><span class=\"comment\"># Only set this option if debugging since it will block logins and potentially show private details.</span></span><br><span class=\"line\"><span class=\"comment\">#LDAP_DUMP_USER_DETAILS=true</span></span><br></pre></td></tr></table></figure></p>\n<p>LDAP 组同步：BookStack 能够将 LDAP 用户组与 BookStack 角色同步。</p>\n<ul>\n<li>默认情况下，将 LDAP 组名称与忽略大小写的大小写名称的 BookStack 角色显示名称匹配。可以通过启用 LDAP 身份验证时在编辑角色时看到的”外部身份验证 ID”字段来覆盖</li>\n<li>此字段可以使用帐户或组的常见名称 （CN） 填充。如果填充，将使用此字段中的 CN，并将忽略角色名称。您可以通过用逗号分隔多个 CN 来匹配它们。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Enable LDAP group sync, Set to 'true' to enable.</span></span><br><span class=\"line\">LDAP_USER_TO_GROUPS=<span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># LDAP user attribute containing groups, Defaults to 'memberOf'.</span></span><br><span class=\"line\">LDAP_GROUP_ATTRIBUTE=<span class=\"string\">\"memberOf\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Remove users from roles that don't match LDAP groups.</span></span><br><span class=\"line\">LDAP_REMOVE_FROM_GROUPS=<span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200512223115.png\" alt=\"WeiyiGeek.LDAP\" title=\"\" class=\"\">\n                <p>WeiyiGeek.LDAP</p>\n            </figure>\n<p>注意事项:</p>\n<ul>\n<li>1.需要在系统上安装 php-ldap 扩展,建议配置得时候将APP_DEBUG进行开启，等到没有问题得时候再关闭即可;</li>\n<li>2.LDAP Group Sync 需要在LDAP中设置<code>memberOf attribute</code>的条目属性;</li>\n</ul>\n<h5 id=\"8-上传设置\"><a href=\"#8-上传设置\" class=\"headerlink\" title=\"8.上传设置\"></a>8.上传设置</h5><p>在 BookStack 中有几个用于存储文件的不同选项：</p>\n<ul>\n<li>local（默认） - 文件存储在运行 BookStack 的服务器上。图像可以公开访问，由您的 Websever 提供，但附件在 BookStack 身份验证后是安全的。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#.env</span></span><br><span class=\"line\">STORAGE_TYPE=<span class=\"built_in\">local</span></span><br><span class=\"line\"></span><br><span class=\"line\">图像上传位置： .&lt;bookstack_install_dir&gt;/public/uploads/images</span><br><span class=\"line\">附件上传位置： .&lt;bookstack_install_dir&gt;/storage/uploads/files</span><br></pre></td></tr></table></figure></li>\n<li>local_secure - 与本地选项相同，但 BookStack 提供图像，从而启用对映像请求的身份验证。提供更高的安全性，但系统资源密集度较高，并可能导致性能问题。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#.env</span></span><br><span class=\"line\">STORAGE_TYPE=<span class=\"built_in\">local</span></span><br><span class=\"line\"><span class=\"comment\">#如果要从默认存储系统切换到此选项，首先需要将现有图像上载迁移到上面列出的图像文件夹</span></span><br><span class=\"line\">图像上传位置： .&lt;bookstack_install_dir&gt;/storage/uploads/images</span><br><span class=\"line\">附件上传位置： .&lt;bookstack_install_dir&gt;/storage/uploads/files</span><br></pre></td></tr></table></figure></li>\n<li>s3 - 在 Amazon S3 上将文件存储在外部。图片在上传时可公开访问。</li>\n</ul>\n<p><em>单独的图像和附件存储方式:</em><br>希望通过不同的存储选项存储图像和附件，可以使用以下选项来存储图像和附件<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#图像采用 Local 存储</span></span><br><span class=\"line\">STORAGE_IMAGE_TYPE=<span class=\"built_in\">local</span> </span><br><span class=\"line\"><span class=\"comment\">#附件采用 Local Secure 存储</span></span><br><span class=\"line\">STORAGE_ATTACHMENT_TYPE=local_secure</span><br></pre></td></tr></table></figure></p>\n<p><em>更改上传限制</em></p>\n<ul>\n<li>PHP:两个主要变量 <code>post_max_size</code> 与 <code>upload_max_filesize</code>更新后需要重启 Web 服务器和 PHP；<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">post_max_size = 10M</span><br><span class=\"line\">upload_max_filesize = 10M</span><br></pre></td></tr></table></figure></li>\n<li>Nginx:默认情况下，NGINX 的文件上载限制为 1MB 关键参数:<code>client_max_body_size</code><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http &#123;</span><br><span class=\"line\">  <span class=\"comment\">#...</span></span><br><span class=\"line\">        client_max_body_size 100m;</span><br><span class=\"line\">        client_body_timeout 120s; <span class=\"comment\"># Default is 60, May need to be increased for very large uploads</span></span><br><span class=\"line\">  <span class=\"comment\">#...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li>Apache:没有任何内置限制，您需要更改，但需要注意的是，如果您使用 apache 并启用了启用的文件mod_php，则可以在文件中设置上述 PHP 变量;<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#.htaccess</span></span><br><span class=\"line\">php_value upload_max_filesize 10M</span><br><span class=\"line\">php_value post_max_size 10M</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>在 BookStack 设置中，查找”自定义 HTML 头内容”设置并添加以下代码：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"actionscript\"><span class=\"comment\">//#文件上传超时</span></span></span><br><span class=\"line\"><span class=\"actionscript\"><span class=\"comment\">//#BookStack 中的文件上载使用默认上传超时为 60 秒的 JavaScript 库</span></span></span><br><span class=\"line\"><span class=\"actionscript\"><span class=\"comment\">//#Set the file upload timeout to 120 seconds.</span></span></span><br><span class=\"line\"><span class=\"actionscript\"><span class=\"comment\">//#You can change '120' to be the number of seconds you want the timeout to be. </span></span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"built_in\">window</span>.uploadTimeout = <span class=\"number\">120</span> * <span class=\"number\">1000</span>;</span></span><br><span class=\"line\"><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"actionscript\"><span class=\"comment\">//#文件上传限制</span></span></span><br><span class=\"line\"><span class=\"actionscript\"><span class=\"comment\">//#BookStack 中的文件上传使用默认上载大小限制为 256MB 的 JavaScript 库。</span></span></span><br><span class=\"line\"><span class=\"actionscript\"><span class=\"comment\">//#Set the file upload limit to 1.5GB.</span></span></span><br><span class=\"line\"><span class=\"actionscript\"><span class=\"comment\">//#The value is defined in MB. </span></span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"built_in\">window</span>.uploadLimit = <span class=\"number\">1500</span>;</span></span><br><span class=\"line\"><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<h5 id=\"9-导出设置\"><a href=\"#9-导出设置\" class=\"headerlink\" title=\"9.导出设置\"></a>9.导出设置</h5><p>BookStack使用以下两种方式进行PDF渲染（<code>将页面导出为PDF文档</code>）:</p>\n<ul>\n<li>Dompdf: 使用DomPDF的好处是它不需要任何其他安装或设置，但是呈现功能受到一定程度的限制(缺省)。</li>\n<li>wkhtmltopdf:使用Qt WebKit呈现引擎来提供更准确的总体结果(推荐),wkhtmltopdf的预编译二进制文件可以在其网站的<a href=\"http://wkhtmltopdf.org/downloads.html\" target=\"_blank\" rel=\"noopener\">下载页面</a>上找到。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#.env</span></span><br><span class=\"line\">WKHTMLTOPDF=/home/user/bins/wkhtmltopdf</span><br><span class=\"line\"><span class=\"comment\">#Docker</span></span><br><span class=\"line\">WKHTMLTOPDF=/usr/bin/wkhtmltopdf</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><strong>UTF8mb4 / Emoji支持</strong><br>描述:从BookStack v0.17开始UTF8mb4，默认的数据库字符集和排序规则允许表情符号支持<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># BookStack v0.17.2或更高版本更改生成SQL</span></span><br><span class=\"line\"><span class=\"comment\"># Generate the upgrade sql and output to a 'dbupgrade.sql' file</span></span><br><span class=\"line\">php artisan bookstack:db-utf8mb4 &gt; dbupgrade.sql</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Run the SQL via MySQL (Using root account)</span></span><br><span class=\"line\">mysql -u root &lt; dbupgrade.sql</span><br></pre></td></tr></table></figure></p>\n<p>补充:</p>\n<ul>\n<li>关于“密钥过长”错误:在这种情况下如果要完全支持表情符号，则最好重新创建数据库<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1.转储数据库中的所有数据（仅数据）</span></span><br><span class=\"line\"><span class=\"comment\"># Change 'bookstack_db' to your bookstack database name</span></span><br><span class=\"line\">mysqldump -u root --no-create-info bookstack_db &gt; bookstack_data.sql</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.重新创建数据库或创建一个新的数据库。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3.在BookStack文件夹中运行迁移数据库并重新创建所有表</span></span><br><span class=\"line\">php artisan migrate</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4.还原数据库并且再次运行以确保数据库是最新的。</span></span><br><span class=\"line\">mysql -u root &lt; bookstack_data.sql</span><br><span class=\"line\">php artisan migrate</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>更多使用技巧参考:</p>\n<ul>\n<li>Hacking BookStack:<a href=\"https://www.bookstackapp.com/docs/admin/hacking-bookstack/\" target=\"_blank\" rel=\"noopener\">https://www.bookstackapp.com/docs/admin/hacking-bookstack/</a></li>\n</ul>\n<hr>\n<h4 id=\"0x03-内置命令\"><a href=\"#0x03-内置命令\" class=\"headerlink\" title=\"0x03 内置命令\"></a>0x03 内置命令</h4><p>BookStack 具有一些命令行操作，可帮助进行维护和常见操作，此处基于Laravel 框架获得，只需从 BookStack 安装文件夹中运行即可；</p>\n<p>BookStack 特定命令的列表(<code>-h:选项来列出命令的详细信息和选项</code>):<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Create a new admin user</span></span><br><span class=\"line\">php artisan bookstack:create-admin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Delete all activity history from the system</span></span><br><span class=\"line\">php artisan bookstack:clear-activity</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Delete all page revisions from the system</span></span><br><span class=\"line\">php artisan bookstack:clear-revisions</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Delete all page revisions from the system including update drafts</span></span><br><span class=\"line\">php artisan bookstack:clear-revisions -a</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Delete all page views from the system</span></span><br><span class=\"line\">php artisan bookstack:clear-views</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Search and remove images that are not used in page content</span></span><br><span class=\"line\">php artisan bookstack:cleanup-images</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Generate SQL commands that will upgrade the database to UTF8mb4</span></span><br><span class=\"line\"><span class=\"comment\"># See https://www.bookstackapp.com/docs/admin/ut8mb4-support/</span></span><br><span class=\"line\">php artisan bookstack:db-utf8mb4</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Rebuild the search index</span></span><br><span class=\"line\"><span class=\"comment\"># Useful if manually inserting pages into the system</span></span><br><span class=\"line\">php artisan bookstack:regenerate-search</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Regenerate access permissions - Used mostly in development</span></span><br><span class=\"line\">php artisan bookstack:regenerate-permissions</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Delete all users from the system that are not \"admin\" or system users</span></span><br><span class=\"line\">php artisan bookstack:delete-users</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Copy the permission settings of a specified, or all, shelf to their child books</span></span><br><span class=\"line\">php artisan bookstack:copy-shelf-permissions --all</span><br><span class=\"line\">php artisan bookstack:copy-shelf-permissions --slug=my_shelf_slug</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Update a URL in the database content of your BookStack instance.</span></span><br><span class=\"line\"><span class=\"comment\"># Searches for &lt;oldUrl&gt; and replaces it with &lt;newUrl&gt;</span></span><br><span class=\"line\">php artisan bookstack:update-url &lt;oldUrl&gt; &lt;newUrl&gt;</span><br><span class=\"line\"><span class=\"comment\"># Example:</span></span><br><span class=\"line\">php artisan bookstack:update-url http://docs.example.com https://demo.bookstackapp.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Regenerate the stored HTML content for comments from their original text content</span></span><br><span class=\"line\">php artisan bookstack:regenerate-comment-content</span><br></pre></td></tr></table></figure></p>\n<hr>\n<h3 id=\"0x04-补充说明\"><a href=\"#0x04-补充说明\" class=\"headerlink\" title=\"0x04 补充说明\"></a>0x04 补充说明</h3><h4 id=\"1-离线迁移图片路径处理\"><a href=\"#1-离线迁移图片路径处理\" class=\"headerlink\" title=\"1.离线迁移图片路径处理\"></a>1.离线迁移图片路径处理</h4><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">--- (1) 查看那些图片路径为 10.10.107.202 服务器的信息进行更改</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> * <span class=\"keyword\">from</span> pages <span class=\"keyword\">WHERE</span> html <span class=\"keyword\">like</span> <span class=\"string\">\"%10.10.107.202%\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--- (2) 替换服务器路径为wiki.weiyigeek.top</span></span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> pages <span class=\"keyword\">set</span> html = <span class=\"keyword\">REPLACE</span>(html,<span class=\"string\">\"10.10.107.202\"</span>,<span class=\"string\">\"wiki.weiyigeek.top\"</span>);</span><br></pre></td></tr></table></figure>","comments":true,"excerpt":"[TOC]","categories":[{"name":"Wiki","path":"api/categories/Wiki.json"}],"tags":[{"name":"BookStack","path":"api/tags/BookStack.json"}]}