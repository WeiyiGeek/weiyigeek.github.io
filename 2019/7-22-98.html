<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="gitlab">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-07-22T12:35:30.000Z" itemprop="datePublished" class="page-time">
  2019-07-22
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Git/">Git</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Git/%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93/">ä»£ç ä»“åº“</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
  <article id="post-ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/Gitlab/1.GitLabä¼ä¸šç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-07-22 20:35:30" datetime="2019-07-22T12:35:30.000Z"  itemprop="datePublished">2019-07-22</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Git/">Git</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Git/%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93/">ä»£ç ä»“åº“</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="0x00-å‰è¨€ç®€è¿°"><a href="#0x00-å‰è¨€ç®€è¿°" class="headerlink" title="0x00 å‰è¨€ç®€è¿°"></a>0x00 å‰è¨€ç®€è¿°</h2><p>PS: åœ¨å¼€æºä¸–ç•Œä¸­ï¼Œæ˜¯æ²¡æœ‰ç»ˆç»“çš„å°½å¤´ï¼</p>
<p>æè¿°:GitLab æ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„å¼€æºé¡¹ç›®ï¼ŒåŸºäºRuby on Railså¼€å‘çš„å¼€æºåº”ç”¨ç¨‹åºã€‚å®ƒå…è®¸ç”¨æˆ·åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šè¿è¡Œç±»ä¼¼äº GitHub çš„é¡¹ç›®ç®¡ç†ç³»ç»Ÿï¼Œå®ç°ä¸€ä¸ªè‡ªæ‰˜ç®¡ç§æœ‰çš„Gité¡¹ç›®ä»“åº“ï¼Œå¯é€šè¿‡Webç•Œé¢è¿›è¡Œè®¿é—®å…¬å¼€çš„æˆ–è€…ç§äººçš„é¡¹ç›®Gitlabèƒ½å¤Ÿæµè§ˆæºä»£ç ï¼Œç®¡ç†ç¼ºé™·å’Œæ³¨é‡Šã€‚</p>
<p>å®˜ç½‘åœ°å€:<a href="https://about.gitlab.com/" target="_blank" rel="noopener">https://about.gitlab.com/</a><br>å¸®åŠ©æ–‡æ¡£:<a href="https://about.gitlab.com/install/" target="_blank" rel="noopener">https://about.gitlab.com/install/</a><br>ç»„ä»¶å‚è€ƒ:<a href="https://docs.gitlab.com/ce/development/architecture.html" target="_blank" rel="noopener">https://docs.gitlab.com/ce/development/architecture.html</a></p>
<p>GitLab é‡‡ç”¨ä¼ ç»Ÿçš„å¼€æºå•†ä¸šæ¨¡å¼,ä»–ä»¬æœ‰ä¸¤ç§äº§å“ï¼š</p>
<ul>
<li>å…è´¹çš„å¼€æºè½¯ä»¶ï¼Œç”¨æˆ·å¯ä»¥åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šå®‰è£…ï¼Œä»¥åŠç±»ä¼¼äº GitHub çš„æ‰˜ç®¡æœåŠ¡ã€‚</li>
<li>å…è´¹çš„ç¤¾åŒºç‰ˆ<code>Gitlab CE</code>å’Œä»˜è´¹ä¼ä¸šç‰ˆ<code>Gitlab EE</code><ul>
<li>ä¼ä¸šç‰ˆåŸºäºç¤¾åŒºç‰ˆä½†é™„å¸¦é’ˆå¯¹ä¼ä¸šå®¢æˆ·çš„å…¶ä»–åŠŸèƒ½,å®ƒæˆ–å¤šæˆ–å°‘ä¸ WordPress.org æˆ– Wordpress.com æä¾›çš„æœåŠ¡ç±»ä¼¼ã€‚</li>
</ul>
</li>
</ul>
<p>Q: Gitlab ä¼˜åŠ¿åŠåº”ç”¨åœºæ™¯?</p>
<ul>
<li>1.å¼€æºå…è´¹ï¼Œæ­å»ºç®€å•ï¼Œç»´æŠ¤æˆæœ¬ä½ï¼Œé€‚åˆä¸­å°å‹å…¬å¸;</li>
<li>2.æƒé™ç®¡ç†ï¼Œèƒ½å®ç°ä»£ç å¯¹éƒ¨åˆ†äººå¯è§ï¼Œç¡®ä¿é¡¹ç›®çš„å®‰å…¨æ€§ï¼›</li>
<li>3.ç¦»çº¿åŒæ­¥ï¼Œä¿è¯æˆ‘ä»¬ä¸åœ¨å®æ—¶ä¾èµ–ç½‘ç»œç¯å¢ƒè¿›è¡Œä»£ç æäº¤ï¼›</li>
</ul>
<p>Gitlabä¼˜ç‚¹ï¼š</p>
<ul>
<li>æœ‰å¼€æºå…è´¹çš„ç‰ˆæœ¬ï¼Œå¯ä»¥è¿›è¡Œç§æœ‰å¼€å‘ä¸Šä¼ ä¸æ‹‰å–;</li>
<li>ç¤¾åŒºç‰ˆå…·æœ‰é«˜åº¦å¯æ‰©å±•æ€§ï¼Œå¯ä»¥åœ¨å•ä¸ªæœåŠ¡å™¨æˆ–ç¾¤é›†ä¸Šæ”¯æŒ 25000 ä¸ªç”¨æˆ·</li>
<li>GitLab çš„ä¸€äº›åŠŸèƒ½åŒ…æ‹¬ï¼šGit ä»“åº“ç®¡ç†ï¼Œä»£ç è¯„è®ºï¼Œé—®é¢˜è·Ÿè¸ªï¼Œæ´»åŠ¨æºå’Œç»´åŸº</li>
<li>å®ƒé…å¤‡äº† GitLab CIï¼Œç”¨äºæŒç»­é›†æˆå’Œäº¤ä»˜</li>
</ul>
<hr>
<h2 id="0x01-ç¯å¢ƒå®‰è£…"><a href="#0x01-ç¯å¢ƒå®‰è£…" class="headerlink" title="0x01 ç¯å¢ƒå®‰è£…"></a>0x01 ç¯å¢ƒå®‰è£…</h2><h3 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h3><p>Gitlab åŸºç¡€è¦æ±‚:è‡³å°‘4GBçš„ç©ºé—²RAMæ¥è¿è¡ŒGitLab</p>
<ul>
<li>ç³»ç»Ÿ:CentOS Linux release 8.0.1905 (Core)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GitLab 12.9.2 (ac5568eb5d8)</span><br><span class="line">GitLab Shell 12.0.0</span><br><span class="line">GitLab Workhorse v8.25.1</span><br><span class="line">GitLab APIv 4</span><br><span class="line">Ruby 2.6.5p114</span><br><span class="line">Rails 6.0.2</span><br><span class="line">PostgreSQL 10.12</span><br><span class="line">Gitaly Servers</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Gitlab å®‰è£…æ–¹å¼:</p>
<ul>
<li>å®˜æ–¹æ¨èä½¿ç”¨Omnibuså¿«é€Ÿå®‰è£…ï¼ˆé‡‡ç”¨rpmè½¯ä»¶åŒ…è¿›è¡Œå®‰è£…éƒ¨ç½²ï¼ˆå›½å†…æ¨èç›´æ¥é•œåƒæºä¸‹è½½ï¼‰ï¼‰;<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ­¤å¤„ä»¥ç¤¾åŒºç‰ˆæœ¬ä¸ºä¾‹</span></span><br><span class="line">curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash</span><br><span class="line">sudo EXTERNAL_URL=<span class="string">"https://gitlab.example.com"</span> dnf install -y gitlab-ee</span><br></pre></td></tr></table></figure></li>
<li>é‡‡ç”¨yumè¿›è¡Œå®‰è£…éƒ¨ç½²;</li>
</ul>
<p><br/></p>
<p><strong>å®‰è£…æµç¨‹:</strong><br>Step1.é‡‡ç”¨rpmè¿›è¡Œå®‰è£…ç¤¾åŒºç‰ˆgitlab(æ›¿æ¢æ›´æ–°æºè‡ªå·±é€‰æ‹©å³å¯):<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo dn8 install -y curl policycoreutils openssh-server wget</span><br><span class="line"><span class="comment">#å¯ä»¥ä½¿ç”¨ wget çš„æ–¹å¼æŠŠ rpm åŒ…ä¸‹è½½ä¸‹æ¥å®‰è£…</span></span><br><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el8/gitlab-ce-12.9.2-ce.0.el8.x86_64.rpm</span><br><span class="line"><span class="comment">#dnf install gitlab-ce-12.9.2-ce.0.el8.x86_64.rpm</span></span><br><span class="line">rpm -ivh gitlab-ce-12.9.2-ce.0.el8.x86_64.rpm</span><br></pre></td></tr></table></figure></p>
<p>Step2.å®‰è£…å®Œæˆåæ˜¾ç¤ºä»¥ä¸‹åˆ™è¯´æ˜å®‰è£…æˆåŠŸ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Thank you for installing GitLab!</span></span><br><span class="line"><span class="comment"># GitLab was unable to detect a valid hostname for your instance.</span></span><br><span class="line"><span class="comment"># Please configure a URL for your GitLab instance by setting `external_url`</span></span><br><span class="line"><span class="comment"># configuration in /etc/gitlab/gitlab.rb file.</span></span><br><span class="line"><span class="comment"># Then, you can start your GitLab instance by running the following command:</span></span><br><span class="line"><span class="comment"># sudo gitlab-ctl reconfigure</span></span><br></pre></td></tr></table></figure></p>
<p>Step3.ä¿®æ”¹ gitlab é»˜è®¤é…ç½®<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$vim</span> /etc/gitlab/gitlab.rb</span><br><span class="line"><span class="comment"># (1) ç«™ç‚¹åŸŸåé…ç½®ï¼Œä¿®æ”¹ä¸ºä½ è‡ªå·±çš„åŸŸåæˆ–è€… IPï¼Œæ˜¯å•å¼•å·ï¼Œè€Œä¸”å‰é¢çš„ http ä¸è¦æ”¹ ï¼ˆå¹¶ä¸”å°†è¯¥åŸŸååŠ å…¥åˆ°hostsä¸­ï¼‰</span></span><br><span class="line">external_url <span class="string">'http://gitlab.weiyigeek.top'</span>    </span><br><span class="line"></span><br><span class="line"><span class="comment"># é‚®ä»¶é…ç½®</span></span><br><span class="line"><span class="comment"># å¯åŠ¨ smtp</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_enable'</span>] = <span class="literal">false</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_address'</span>] = <span class="string">"smtp.qq.com"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_port'</span>] = 587 <span class="comment">#SSL</span></span><br><span class="line"><span class="comment"># è´¦æˆ·é‚®ç®±å¯†ç </span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_user_name'</span>] = <span class="string">"weiyigeek"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_password'</span>] = <span class="string">"password"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_authentication'</span>] = <span class="string">":plain"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_enable_starttls_auto'</span>] = <span class="literal">true</span></span><br><span class="line"><span class="comment"># gitlab_rails['smtp_tls'] =</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘ä»¶äººé‚®ç®±å³æ˜¾ç¤ºåç§°</span></span><br><span class="line"><span class="comment"># PS:æ²¡æœ‰é‚®ä»¶æœåŠ¡å™¨å¯ä»¥å…³é—­é‚®ä»¶æœåŠ¡åŠŸèƒ½</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_enabled'</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_from'</span>] = <span class="string">"master#weiyigeek.top"</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_display_name'</span>] = <span class="string">'GitLab-System-WeiyiGeek'</span></span><br></pre></td></tr></table></figure></p>
<p>Step4.å®Œæˆä¿®æ”¹åéœ€è¦é‡æ–°åŠ è½½é…ç½®ç„¶åé‡å¯å³å¯;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">$ gitlab-ctl reconfigure</span><br><span class="line"><span class="comment"># [2020-04-15T10:33:44+08:00] WARN: Please install an English UTF-8 locale for Chef to use, falling back to C locale and disabling UTF-8 support. #å¦‚æœçœ‹ç€ä¸èˆ’æœè‡ªå·±è®¾ç½®ç³»ç»Ÿè¯­ç³»å³å¯</span></span><br><span class="line"><span class="comment"># [2020-04-15T10:33:45+08:00] WARN: Please install an English UTF-8 locale for Chef to use, falling back to C locale and disabling UTF-8 support.</span></span><br><span class="line"><span class="comment"># Starting Chef Client, version 14.14.29</span></span><br><span class="line"><span class="comment"># resolving cookbooks for run list: ["gitlab"]</span></span><br><span class="line"><span class="comment"># Synchronizing Cookbooks:</span></span><br><span class="line"><span class="comment">#   - redis (0.1.0)</span></span><br><span class="line"><span class="comment">#   - package (0.1.0)</span></span><br><span class="line"><span class="comment">#   - postgresql (0.1.0)</span></span><br><span class="line"><span class="comment">#   - mattermost (0.1.0)</span></span><br><span class="line"><span class="comment">#   - consul (0.1.0)</span></span><br><span class="line"><span class="comment">#   - letsencrypt (0.1.0)</span></span><br><span class="line"><span class="comment">#   - gitlab (0.0.1)</span></span><br><span class="line"><span class="comment">#   - runit (4.3.0)</span></span><br><span class="line"><span class="comment">#   - monitoring (0.1.0)</span></span><br><span class="line"><span class="comment">#   - praefect (0.1.0)</span></span><br><span class="line"><span class="comment">#   - gitaly (0.1.0)</span></span><br><span class="line"><span class="comment">#   - registry (0.1.0)</span></span><br><span class="line"><span class="comment">#   - acme (4.1.1)</span></span><br><span class="line"><span class="comment">#   - nginx (0.1.0)</span></span><br><span class="line"><span class="comment">#   - crond (0.1.0)</span></span><br><span class="line"><span class="comment"># Running handlers:</span></span><br><span class="line"><span class="comment"># Running handlers complete</span></span><br><span class="line"><span class="comment"># Chef Client finished, 541/1460 resources updated in 03 minutes 14 seconds</span></span><br><span class="line"><span class="comment"># gitlab Reconfigured!</span></span><br><span class="line"></span><br><span class="line">$ gitlab-ctl restart</span><br><span class="line"><span class="comment"># [2020-04-15T10:37:51+08:00] WARN: Please install an English UTF-8 locale for Chef to use, falling back to C locale and disabling UTF-8 support.</span></span><br><span class="line"><span class="comment"># ok: run: alertmanager: (pid 21410) 1s</span></span><br><span class="line"><span class="comment"># ok: run: gitaly: (pid 21422) 0s</span></span><br><span class="line"><span class="comment"># ok: run: gitlab-exporter: (pid 21429) 1s</span></span><br><span class="line"><span class="comment"># ok: run: gitlab-workhorse: (pid 21444) 0s</span></span><br><span class="line"><span class="comment"># ok: run: grafana: (pid 21463) 0s</span></span><br><span class="line"><span class="comment"># ok: run: logrotate: (pid 21474) 0s</span></span><br><span class="line"><span class="comment"># ok: run: nginx: (pid 21480) 0s</span></span><br><span class="line"><span class="comment"># ok: run: node-exporter: (pid 21563) 1s</span></span><br><span class="line"><span class="comment"># ok: run: postgres-exporter: (pid 21569) 0s</span></span><br><span class="line"><span class="comment"># ok: run: postgresql: (pid 21580) 0s</span></span><br><span class="line"><span class="comment"># ok: run: prometheus: (pid 21589) 0s</span></span><br><span class="line"><span class="comment"># ok: run: redis: (pid 21601) 0s</span></span><br><span class="line"><span class="comment"># ok: run: redis-exporter: (pid 21708) 0s</span></span><br><span class="line"><span class="comment"># ok: run: sidekiq: (pid 21716) 0s</span></span><br><span class="line"><span class="comment"># ok: run: unicorn: (pid 21727) 0s</span></span><br></pre></td></tr></table></figure></p>
<p>Step5.å¦‚æœ reconfigure å¤±è´¥ï¼Œåˆ™éœ€è¦ <code>systemctl enable gitlab-runsvdir &amp;&amp; systemctl restart gitlab-runsvdir</code> é‡å¯ä¸€ä¸‹ gitlab-runsvdir æœåŠ¡</p>
<p>Step6.æ‰“å¼€æµè§ˆå™¨è¿›è¡Œåˆå§‹åŒ–è´¦æˆ·è®¾å®šå¯†ç ï¼Œè¿™ä¸ªå¯†ç ä¸º root ç®¡ç†å‘˜è´¦æˆ·çš„å¯†ç ã€‚è®¾ç½®å®Œå¯†ç ä¹‹åä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åº”ç”¨:http://gitlab.weiyigeek.top/</span><br><span class="line">è´¦å·:root</span><br><span class="line">å¯†ç :WeiyiGeek <span class="comment">#8ä½åŠä»¥ä¸Š</span></span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415105119.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415105119.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure></p>
<p>Step7.ç™»å½•æˆåŠŸçš„ç•Œé¢,æ˜¯ä¸æ˜¯æœ‰ç§ç–¯ç‹‚çš„æƒ³å†™ä»£ç çš„å†²åŠ¨;<br><figure class="image-box">
                <a rel=GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415105613.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415105613.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure></p>
<p>Step8.è‹±æ–‡å¯èƒ½å¯¹è‹±è¯­ä¸å¥½çš„æ–°æ‰‹å¯èƒ½ä¸å‹å¥½ï¼Œæˆ‘ä»¬è¿›è¡Œæ±‰åŒ–ï¼ˆ<code>æ³¨æ„:é«˜äº12.3.5çš„ç‰ˆæœ¬æ— éœ€æ±‰åŒ–ï¼Œç›´æ¥åœ¨ç”¨æˆ·è®¾ç½®é‡Œé¢è¿›è¡Œè®¾ç½®è‡ªå®šä¹‰è¯­è¨€é€‰æ‹©ç®€ä½“ä¸­æ–‡</code>ï¼‰;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åœæ­¢gitlab</span></span><br><span class="line">gitlab-ctl stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å½“å‰å®‰è£…çš„ç‰ˆæœ¬è¡¥ä¸</span></span><br><span class="line">git <span class="built_in">clone</span> https://gitlab.com/xhang/gitlab.git</span><br><span class="line"><span class="built_in">cd</span> gitlab</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å…¨éƒ¨åˆ†æ”¯ç‰ˆæœ¬</span></span><br><span class="line">git branch -a</span><br><span class="line">gitlab_version=$(cat /opt/gitlab/embedded/service/gitlab-rails/VERSION)</span><br><span class="line"><span class="comment"># æ¯”è¾ƒæ±‰åŒ–æ ‡ç­¾å’ŒåŸæ ‡ç­¾ï¼Œå¯¼å‡ºpatchç”¨çš„diffæ–‡ä»¶</span></span><br><span class="line"><span class="comment">#git diff v$&#123;gitlab_version&#125; v$&#123;gitlab_version&#125;-zh &gt; ../$&#123;gitlab_version&#125;-zh.diff</span></span><br><span class="line">git diff remotes/origin/12-3-stable remotes/origin/12-3-stable-zh &gt; ../<span class="variable">$&#123;gitlab_version&#125;</span>-zh.diff</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰“è¡¥ä¸çš„æ—¶å€™ä¼šæç¤ºä¸€äº›è¡¥ä¸æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¸€å®šè¦è·³è¿‡è¿™äº›æ–‡ä»¶ï¼Œä¸ç„¶åé¢reconfigçš„æ—¶å€™ä¼šæŠ¥é”™çš„ã€‚</span></span><br><span class="line">patch -d /opt/gitlab/embedded/service/gitlab-rails -p1 &lt; ../<span class="variable">$&#123;gitlab_version&#125;</span>-zh.diff</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡æ–°ç¼–è¯‘å’Œå¯åŠ¨</span></span><br><span class="line">gitlab-ctl reconfigure</span><br><span class="line">gitlab-ctl start</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><p>æè¿°: é‡‡ç”¨é‡‡ç”¨ä¸€ä¸ªä½æƒé™ç”¨æˆ·è¿›è¡Œç®¡ç†dockerä»¥åŠåˆ©ç”¨dockeréƒ¨ç½²gitlabæœåŠ¡;</p>
<p>ç¯å¢ƒè¯´æ˜:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$lsb_release</span> -a</span><br><span class="line">Description:    Ubuntu 20.04.1 LTS</span><br><span class="line">Release:        20.04</span><br><span class="line">Codename:       focal</span><br><span class="line"></span><br><span class="line"><span class="variable">$docker</span> version</span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           19.03.13</span><br><span class="line"> API version:       1.40</span><br><span class="line"> Go version:        go1.13.15</span><br><span class="line"> Git commit:        4484c46d9d</span><br><span class="line"> Built:             Wed Sep 16 17:02:52 2020</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          19.03.13</span><br><span class="line">  API version:      1.40 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.13.15</span><br><span class="line">  Git commit:       4484c46d9d</span><br><span class="line">  Built:            Wed Sep 16 17:01:20 2020</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     <span class="literal">false</span></span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.3.7</span><br><span class="line">  GitCommit:        8fba4e9a7d01810a393d5d25a3621dc101981175</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.0-rc10</span><br><span class="line">  GitCommit:        dc9208a3303feef5b3839f4323d9beb36df0a9dd</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.18.0</span><br><span class="line">  GitCommit:        fec3683</span><br></pre></td></tr></table></figure></p>
<p>æ“ä½œæµç¨‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.æ–°å»ºä½æƒé™ç”¨æˆ·å¹¶å°†è¯¥ç”¨æˆ·åŠ å…¥åˆ°dockerç»„</span></span><br><span class="line">sudo useradd -m -g docker WeiyiGeek-gitlab &amp;&amp; sudo passwd WeiyiGeek-gitlab</span><br><span class="line">sudo gpasswd -a WeiyiGeek-gitlab docker</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.åˆ‡æ¢åˆ°ä½æƒé™çš„WeiyiGeek-gitlabç”¨æˆ·æ‹‰å»æœ€æ–°ç¤¾åŒºç‰ˆæœ¬çš„gitlab</span></span><br><span class="line">WeiyiGeek-gitlab@gitlab-WeiyiGeek:~$ docker pull gitlab/gitlab-ce:13.6.3-ce.0</span><br><span class="line"><span class="comment"># Using default tag: latest</span></span><br><span class="line"><span class="comment"># latest: Pulling from gitlab/gitlab-ce</span></span><br><span class="line"><span class="comment"># 4f53fa4d2cf0: Pull complete</span></span><br><span class="line"><span class="comment"># 6af7c939e38e: Pull complete</span></span><br><span class="line"><span class="comment"># 903d0ffd64f6: Pull complete</span></span><br><span class="line"><span class="comment"># 04feeed388b7: Pull complete</span></span><br><span class="line"><span class="comment"># 25d5e5c7360d: Pull complete</span></span><br><span class="line"><span class="comment"># 0cc025692f2b: Pull complete</span></span><br><span class="line"><span class="comment"># eac308723fda: Pull complete</span></span><br><span class="line"><span class="comment"># 2135ce2185ba: Pull complete</span></span><br><span class="line"><span class="comment"># 3d2db784a8b0: Pull complete</span></span><br><span class="line"><span class="comment"># d2942fac7230: Pull complete</span></span><br><span class="line"><span class="comment"># Digest: sha256:b7daf0c109a62e776f5f72b728a01191059a51f43b5df82c53ef997e877a784f</span></span><br><span class="line"><span class="comment"># Status: Downloaded newer image for gitlab/gitlab-ce:latest</span></span><br><span class="line"><span class="comment"># docker.io/gitlab/gitlab-ce:latest</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.è®¾ç½®æŒä¹…åŒ–ç›®å½•å¹¶è¿è¡Œgitlab-server</span></span><br><span class="line">$ mkdir -vp ~/&#123;config,logs,data,backups&#125;</span><br><span class="line"><span class="comment"># mkdir: created directory '/home/WeiyiGeek-gitlab/config'</span></span><br><span class="line"><span class="comment"># mkdir: created directory '/home/WeiyiGeek-gitlab/logs'</span></span><br><span class="line"><span class="comment"># mkdir: created directory '/home/WeiyiGeek-gitlab/data'</span></span><br><span class="line">$ docker run -d -p 443:443 -p 80:80 -p 22:22 --name gitlab-server --restart always -v /home/WeiyiGeek-gitlab/config:/etc/gitlab -v /home/WeiyiGeek-gitlab/config/backups:/var/opt/gitlab/backups -v /home/WeiyiGeek-gitlab/logs:/var/<span class="built_in">log</span>/gitlab -v /home/WeiyiGeek-gitlab/data:/var/opt/gitlab gitlab/gitlab-ce:13.6.3-ce.0</span><br><span class="line">docker run -d -p 443:443 -p 80:80 -p 22:22 --name gitlab-server --restart always -v /home/weiyigeek/config:/etc/gitlab -v /home/weiyigeek/config/backups:/var/opt/gitlab/backups -v /home/weiyigeek/logs:/var/<span class="built_in">log</span>/gitlab -v /home/weiyigeek/data:/var/opt/gitlab gitlab/gitlab-ce:13.6.3-ce.0</span><br><span class="line">512c45077bafaf1c617ddd6e43f4b8a9a147ca3c8b9e8e889b14d58f151647fe</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.åˆ©ç”¨docker logsæŸ¥çœ‹gitlab åˆå§‹åŒ–æ˜¯å¦å®Œæˆ</span></span><br><span class="line">WeiyiGeek-gitlab@gitlab-WeiyiGeek:~$ docker logs -f --tail 100 512c</span><br><span class="line">==&gt; /var/<span class="built_in">log</span>/gitlab/puma/puma_stdout.log &lt;==</span><br><span class="line">&#123;<span class="string">"timestamp"</span>:<span class="string">"2020-10-10T06:14:37.385Z"</span>,<span class="string">"pid"</span>:767,<span class="string">"message"</span>:<span class="string">"PumaWorkerKiller: Consuming 3219.65625 mb with master and 4 workers."</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.ä¸»æœºåç§°é…ç½®</span></span><br><span class="line">sudo tee /etc/hosts &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">192.168.10.222 gitlab.weiyigeek.top</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></p>
<p>PS: é…ç½®æ–‡ä»¶åœ°å€<code>/etc/WeiyiGeek-gitlab/config</code>å¦‚ä½•é…ç½®è¯·å‚è€ƒä¸‹é¢æ–‡ç« ï¼Œæ­¤å¤„ä¸å†å¤šåšå™è¿°;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹çš„é”®å€¼å¯¹</span></span><br><span class="line">sudo egrep -v <span class="string">"^#|^$"</span> /home/WeiyiGeek-gitlab/config/gitlab.rb</span><br><span class="line">[sudo] password <span class="keyword">for</span> WeiyiGeek:</span><br><span class="line"></span><br><span class="line">external_url <span class="string">'http://gitlab.WeiyiGeek.top'</span></span><br><span class="line">user[<span class="string">'git_user_name'</span>] = <span class="string">"Gitlab"</span></span><br><span class="line">user[<span class="string">'git_user_email'</span>] = <span class="string">"gitlab@WeiyiGeek.top"</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_ssh_host'</span>] = <span class="string">'gitlab.WeiyiGeek.top'</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_shell_ssh_port'</span>] = 2222</span><br><span class="line">gitlab_rails[<span class="string">'gitlab_shell_git_timeout'</span>] = 800</span><br><span class="line">gitlab_rails[<span class="string">'time_zone'</span>] = <span class="string">'Asia/Shanghai'</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_enabled'</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_from'</span>] = <span class="string">'gitlab@WeiyiGeek.top'</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_display_name'</span>] = <span class="string">'Gitlab'</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_reply_to'</span>] = <span class="string">'weiyigeek@WeiyiGeek.top'</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_subject_suffix'</span>] = <span class="string">'WeiyiGeek-IT'</span></span><br><span class="line">gitlab_rails[<span class="string">'object_store'</span>][<span class="string">'enabled'</span>] = <span class="literal">false</span></span><br><span class="line">gitlab_rails[<span class="string">'object_store'</span>][<span class="string">'connection'</span>] = &#123;&#125;</span><br><span class="line">gitlab_rails[<span class="string">'object_store'</span>][<span class="string">'storage_options'</span>] = &#123;&#125;</span><br><span class="line">gitlab_rails[<span class="string">'object_store'</span>][<span class="string">'proxy_download'</span>] = <span class="literal">false</span></span><br><span class="line">gitlab_rails[<span class="string">'object_store'</span>][<span class="string">'objects'</span>][<span class="string">'artifacts'</span>][<span class="string">'bucket'</span>] = nil</span><br><span class="line">gitlab_rails[<span class="string">'object_store'</span>][<span class="string">'objects'</span>][<span class="string">'external_diffs'</span>][<span class="string">'bucket'</span>] = nil</span><br><span class="line">gitlab_rails[<span class="string">'object_store'</span>][<span class="string">'objects'</span>][<span class="string">'lfs'</span>][<span class="string">'bucket'</span>] = nil</span><br><span class="line">gitlab_rails[<span class="string">'object_store'</span>][<span class="string">'objects'</span>][<span class="string">'uploads'</span>][<span class="string">'bucket'</span>] = nil</span><br><span class="line">gitlab_rails[<span class="string">'object_store'</span>][<span class="string">'objects'</span>][<span class="string">'packages'</span>][<span class="string">'bucket'</span>] = nil</span><br><span class="line">gitlab_rails[<span class="string">'object_store'</span>][<span class="string">'objects'</span>][<span class="string">'dependency_proxy'</span>][<span class="string">'bucket'</span>] = nil</span><br><span class="line">gitlab_rails[<span class="string">'object_store'</span>][<span class="string">'objects'</span>][<span class="string">'terraform_state'</span>][<span class="string">'bucket'</span>] = nil</span><br><span class="line">gitlab_rails[<span class="string">'smtp_enable'</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_address'</span>] = <span class="string">"smtp.exmail.qq.com"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_port'</span>] = 465</span><br><span class="line">gitlab_rails[<span class="string">'smtp_user_name'</span>] = <span class="string">"gitlab@WeiyiGeek.top"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_password'</span>] = <span class="string">"Hm595Yb"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_domain'</span>] = <span class="string">"WeiyiGeek.com.top"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_authentication'</span>] = <span class="string">"login"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_tls'</span>] = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹åé‡å¯gitlabå®¹å™¨å³å¯</span></span><br><span class="line">$ docker restart gitlab</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="0x02-æ“ä½œè¯´æ˜"><a href="#0x02-æ“ä½œè¯´æ˜" class="headerlink" title="0x02 æ“ä½œè¯´æ˜"></a>0x02 æ“ä½œè¯´æ˜</h2><p>Gitlabç›¸å…³æ“ä½œåŠè¯´æ˜ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹Gitlabç‰ˆæœ¬</span></span><br><span class="line">cat /opt/gitlab/embedded/service/gitlab-rails/VERSION</span><br><span class="line"></span><br><span class="line">/etc/gitlab/gitlab.rb          <span class="comment">#gitlabé…ç½®æ–‡ä»¶</span></span><br><span class="line">/opt/gitlab                    <span class="comment">#gitlabçš„ç¨‹åºå®‰è£…ç›®å½•</span></span><br><span class="line">/var/opt/gitlab                <span class="comment">#gitlabç›®å½•æ•°æ®ç›®å½•(é€šè¿‡gitlab.rbä¿®æ”¹çš„å­æ¨¡å—é…ç½®æ–‡ä»¶å­˜æ”¾çš„)</span></span><br><span class="line">/var/opt/gitlab/git-data       <span class="comment">#å­˜æ”¾ä»“åº“æ•°æ®</span></span><br><span class="line">/var/opt/gitlab/backups        <span class="comment">#é»˜è®¤å¤‡ä»½ç›®å½•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Gitlabçš„æœåŠ¡æ„æˆï¼š</span></span><br><span class="line">gitlab-shell:ç”¨äºå¤„ç†Gitå‘½ä»¤å’Œä¿®æ”¹authorized keysåˆ—è¡¨</span><br><span class="line">gitlab-workhorse:è½»é‡çº§çš„åå‘ä»£ç†æœåŠ¡å™¨</span><br><span class="line">logrotate:æ—¥å¿—æ–‡ä»¶ç®¡ç†å·¥å…·</span><br><span class="line">nginx:é™æ€webæœåŠ¡å™¨</span><br><span class="line">postgresql:æ•°æ®åº“</span><br><span class="line">redis:ç¼“å­˜æ•°æ®åº“</span><br><span class="line">sidekiq:ç”¨äºåœ¨åå°æ‰§è¡Œé˜Ÿåˆ—ä»»åŠ¡(å¼‚æ­¥æ‰§è¡Œ)</span><br><span class="line">unicorn:GitLab Railsåº”ç”¨æ˜¯æ‰˜ç®¡åœ¨è¿™ä¸ªæœåŠ¡å™¨ä¸Šé¢çš„ã€‚</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="gitlab-ctl-å‘½ä»¤"><a href="#gitlab-ctl-å‘½ä»¤" class="headerlink" title="gitlab-ctl å‘½ä»¤"></a>gitlab-ctl å‘½ä»¤</h3><p>åŸºç¡€å‘½ä»¤:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¸¸ç”¨å‘½ä»¤</span></span><br><span class="line">gitlab-ctl reconfigure         <span class="comment">#ç”Ÿæˆé…ç½®å¹¶é‡æ–°å¯åŠ¨æœåŠ¡</span></span><br><span class="line">gitlab-ctl start               <span class="comment">#å¯åŠ¨æ‰€æœ‰ gitlab ç»„ä»¶ï¼š</span></span><br><span class="line">gitlab-ctl status              <span class="comment">#æŸ¥çœ‹å½“å‰gitlabæ‰€æœ‰æœåŠ¡è¿è¡ŒçŠ¶æ€</span></span><br><span class="line">gitlab-ctl stop                <span class="comment">#åœæ­¢gitlabæœåŠ¡</span></span><br><span class="line">gitlab-ctl pg-upgrade          <span class="comment">#å‡çº§PostgreSQLæœ€æ–°ç‰ˆæœ¬</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å•ç‹¬å¯åŠ¨|åœæ­¢|é‡å¯æŸä¸ªæœåŠ¡</span></span><br><span class="line">gitlab-ctl start nginx            <span class="comment">#å¯åŠ¨nginxç»„ä»¶</span></span><br><span class="line">gitlab-ctl stop postgresql        <span class="comment">#åœæ­¢æ‰€æœ‰ gitlab postgresql ç»„ä»¶ï¼š</span></span><br><span class="line">gitlab-ctl restart unicorn        <span class="comment">#é‡å¯ç›¸å…³æ•°æ®è¿æ¥æœåŠ¡</span></span><br><span class="line">gitlab-ctl restart sidekiq        <span class="comment">#é‡å¯ç›¸å…³æ•°æ®è¿æ¥æœåŠ¡</span></span><br><span class="line">gitlab-ctl restart  gitlab-workhorse <span class="comment"># é‡å¯æ‰€æœ‰ gitlab gitlab-workhorse ç»„ä»¶ï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ—¥å¿—ç®¡ç†</span></span><br><span class="line">gitlab-ctl tail         <span class="comment">#æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çš„æ—¥å¿—</span></span><br><span class="line">gitlab-ctl tail redis   <span class="comment">#å®æ—¶æ£€æŸ¥redisçš„æ—¥å¿—ï¼ˆå»¶ä¼¸æŸä¸ªæœåŠ¡ä¹Ÿæ˜¯ä¸€æ ·å¾—ï¼‰</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="gitlab-rails-å‘½ä»¤"><a href="#gitlab-rails-å‘½ä»¤" class="headerlink" title="gitlab-rails å‘½ä»¤"></a>gitlab-rails å‘½ä»¤</h3><p>åŸºç¡€ç¤ºä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#gitlabé‡ç½®å¯†ç </span></span><br><span class="line">gitlab-rails console </span><br><span class="line">&gt; u=User.where(id:1).first        <span class="comment">#è¿™ä¸ªæ˜¯ç®¡ç†å‘˜çš„ï¼Œä¹Ÿå¯ä»¥ç”¨emailç­‰</span></span><br><span class="line">&gt; u.password = <span class="string">'your_password'</span>    <span class="comment">#å¯†ç æœ‰æ ¼å¼é™åˆ¶ï¼Œæˆ‘åªçŸ¥é“8ä½ä»¥ä¸Šå¦åˆ™ä¼šä¿å­˜å¤±è´¥</span></span><br><span class="line">&gt; u.password_confirmation = <span class="string">'your_password'</span></span><br><span class="line">&gt; u.save</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="gitlab-rake-å‘½ä»¤"><a href="#gitlab-rake-å‘½ä»¤" class="headerlink" title="gitlab-rake å‘½ä»¤"></a>gitlab-rake å‘½ä»¤</h3><p>åŸºç¡€ç¤ºä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gitlab-rake gitlab:check SANITIZE=<span class="literal">true</span> --trace <span class="comment"># æ£€æŸ¥gitlab</span></span><br><span class="line">gitlab-rake db:migrate <span class="comment"># æ•°æ®åº“å…³ç³»å‡çº§</span></span><br><span class="line">gitlab-rake cache:clear <span class="comment"># æ¸…ç†redisç¼“å­˜</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="release-cli-å‘½ä»¤"><a href="#release-cli-å‘½ä»¤" class="headerlink" title="release-cli å‘½ä»¤"></a>release-cli å‘½ä»¤</h3><p>æè¿°: release-cli ä¸€ä¸ªä¸GitLabå‘å¸ƒAPIäº¤äº’çš„CLIå·¥å…·ã€‚</p>
<p>å®˜æ–¹æ–‡æ¡£: <a href="https://gitlab.com/gitlab-org/release-cli/-/blob/master/docs/index.md#usage" target="_blank" rel="noopener">https://gitlab.com/gitlab-org/release-cli/-/blob/master/docs/index.md#usage</a><br>å‚è€ƒåœ°å€: <a href="https://docs.gitlab.com/ee/api/releases/" target="_blank" rel="noopener">https://docs.gitlab.com/ee/api/releases/</a></p>
<p><strong>è¯­æ³•åŸºå‚ &amp; Syntax</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># USAGE</span></span><br><span class="line"><span class="built_in">help</span> [global options] <span class="built_in">command</span> [<span class="built_in">command</span> options] [arguments...]</span><br><span class="line"></span><br><span class="line"><span class="comment"># GLOBAL OPTIONS:</span></span><br><span class="line">--server-url value     The base URL of the GitLab instance, including protocol and port, <span class="keyword">for</span> example https://gitlab.example.com:8080 [<span class="variable">$CI_SERVER_URL</span>]</span><br><span class="line">--job-token value      Job token used <span class="keyword">for</span> authenticating with the GitLab Releases API [<span class="variable">$CI_JOB_TOKEN</span>]</span><br><span class="line">--project-id value     The current project unique ID; used by GitLab CI internally [<span class="variable">$CI_PROJECT_ID</span>]</span><br><span class="line">--timeout value        HTTP client timeout <span class="keyword">in</span> Go duration format https://golang.org/pkg/time/<span class="comment">#ParseDuration (default: 30s) [$RELEASE_CLI_TIMEOUT]</span></span><br><span class="line">--private-token value  Private token used <span class="keyword">for</span> authenticating with the GitLab Releases API, requires api scope https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html, overrides job-token [<span class="variable">$GITLAB_PRIVATE_TOKEN</span>]</span><br><span class="line">--<span class="built_in">help</span>, -h             Show <span class="built_in">help</span> (default: <span class="literal">false</span>)</span><br><span class="line">--version, -v          Print the version (default: <span class="literal">false</span>)</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>åŸºæœ¬å‘½ä»¤ - COMMANDS</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">create: Create a Release using GitLab Releases API https://docs.gitlab.com/ee/api/releases/<span class="comment">#create-a-release</span></span><br><span class="line">USAGE:</span><br><span class="line">  <span class="built_in">help</span> create [<span class="built_in">command</span> options] [arguments...]</span><br><span class="line">OPTIONS:</span><br><span class="line">  --name value               <span class="comment"># å‘å¸ƒåç§°ä¾‹å¦‚ app_Version-1.14</span></span><br><span class="line">  --description value        <span class="comment"># ç”¨æ¥è¯»å–æè¿°å†…å®¹çš„æ–‡ä»¶ï¼Œå¿…é¡»å­˜åœ¨äºå·¥ä½œç›®å½•å†…;å¦‚æœå®ƒåŒ…å«ä»»ä½•ç©ºæ ¼ï¼Œå®ƒå°†è¢«è§†ä¸ºå­—ç¬¦ä¸²</span></span><br><span class="line">  --tag-name value           <span class="comment"># å‘å¸ƒç‰ˆæœ¬å°†ä»ä¸­åˆ›å»ºçš„æ ‡è®°[$CI_COMMIT_TAG] ä¾‹å¦‚v1.14</span></span><br><span class="line">  --ref value                <span class="comment"># å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªæäº¤SHAã€å¦ä¸€ä¸ªæ ‡è®°åæˆ–ä¸€ä¸ªåˆ†æ”¯å [$CI_COMMIT_SHA]</span></span><br><span class="line">  --assets-links-name value  <span class="comment"># DEPRECATED</span></span><br><span class="line">  --assets-links-url value   <span class="comment"># DEPRECATEDe.g. --assets-links-name "asset 1" --assets-links-url "https://example.com/url/1" --assets-links-name "asset 2" --assets-links-url "https://example.com/url/2")</span></span><br><span class="line">  --assets-link value        <span class="comment"># JSONå­—ç¬¦ä¸²è¡¨ç¤ºçš„èµ„äº§é“¾æ¥ç”¨äºæ›¿ä»£--assets-links-name/url ( e.g. --assets-link='&#123;"name": "Asset1", "url":"https://&lt;domain&gt;/some/location/1", "type": "other", "filepath": "xzy" &#125;'</span></span><br><span class="line">  --milestone value          <span class="comment"># ä¸å‘è¡Œç‰ˆç›¸å…³çš„æ¯ä¸ªé‡Œç¨‹ç¢‘çš„æ ‡é¢˜åˆ—è¡¨ (é‡Œç¨‹ç¢‘å¿…é¡»å­˜åœ¨)</span></span><br><span class="line">  --released-at value        <span class="comment"># ä»–æ ‡æ˜äº†å‘è¡Œçš„æ—¥æœŸ;é»˜è®¤ä¸ºå½“å‰æ—¶é—´;æœŸæœ›ISO 8601æ ¼å¼ (2019-03-15T08:00:00Z)</span></span><br><span class="line">  --<span class="built_in">help</span>, -h                 Show <span class="built_in">help</span> (default: <span class="literal">false</span>)</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>ç®€å•ç¤ºä¾‹ - Example</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼1.å‘½ä»¤è¡Œå‘å¸ƒ</span></span><br><span class="line">release-cli --server-url https://gitlab.com --job-token=SOME_JOB_TOKEN --project-id 12345 create <span class="built_in">help</span></span><br><span class="line">release-cli --server-url https://gitlab.mydomain.com --private-token <span class="string">"my-private-token"</span> create --name <span class="string">"My Release"</span> --description <span class="string">"This is a new release for my amazing tool"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2.Gitlab-CI å‘å¸ƒ</span></span><br><span class="line">release-branch:</span><br><span class="line">  stage: release</span><br><span class="line">  image: registry.gitlab.com/gitlab-org/release-cli</span><br><span class="line">  when: manual</span><br><span class="line">  <span class="comment"># We recommend the use of `rules` to prevent these pipelines</span></span><br><span class="line">  <span class="comment"># from running. See the notes section below for details.</span></span><br><span class="line">  rules:</span><br><span class="line">    - <span class="keyword">if</span>: <span class="variable">$CI_COMMIT_TAG</span></span><br><span class="line">      when: never</span><br><span class="line">  script:</span><br><span class="line">    - &gt;</span><br><span class="line">      release-cli create --name release-branch-<span class="variable">$CI_JOB_ID</span> --description release-branch-<span class="variable">$CI_COMMIT_REF_NAME</span>-<span class="variable">$CI_JOB_ID</span></span><br><span class="line">      --tag-name job-<span class="variable">$CI_JOB_ID</span> --ref <span class="variable">$CI_COMMIT_SHA</span></span><br><span class="line">      --assets-link <span class="string">'&#123;"name":"Asset1","url":"https://&lt;domain&gt;/some/location/1","link_type":"other","filepath":"xzy"&#125;'</span></span><br><span class="line">      --assets-link <span class="string">'&#123;"name":"Asset2","url":"https://&lt;domain&gt;/some/location/2"&#125;'</span></span><br><span class="line">      --milestone <span class="string">"v1.0.0"</span> --milestone <span class="string">"v1.0.0-rc"</span></span><br><span class="line">      --released-at <span class="string">"2020-06-30T07:00:00Z"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»¼åˆå®è·µ</span></span><br><span class="line">$ release-cli create \ </span><br><span class="line">  --name <span class="string">"Release <span class="variable">$CI_COMMIT_TAG</span>"</span> \</span><br><span class="line">  --description <span class="string">"Notes: <span class="variable">$EXTRA_DESCRIPTION</span>"</span> \</span><br><span class="line">  --tag-name <span class="variable">$CI_COMMIT_TAG</span> --ref <span class="variable">$CI_COMMIT_SHA</span> \</span><br><span class="line">  --assets-link <span class="string">'&#123;"name":"Asset1","url":"https://&lt;domain&gt;/some/location/1","link_type":"other","filepath":"xzy"&#125;'</span> \</span><br><span class="line">  --assets-link <span class="string">'&#123;"name":"Asset2","url":"https://&lt;domain&gt;/some/location/2"&#125;'</span> --milestone <span class="string">"m1"</span> --milestone <span class="string">"m2"</span> --released-at <span class="string">"2020-08-20T6:42:00Z"</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>åŸºç¡€å®ä¾‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) æè¿°ä¿¡æ¯</span></span><br><span class="line">~ $ release-cli --server-url http://gitlab.weiyigeek.top --private-token <span class="string">"fYyHzos-zEPPP8PDsxLa"</span>  --project-id 45 create create --name <span class="string">"My Release"</span> --description <span class="string">"This is a new release for my amazing tool"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æŒ‡å®šç‰ˆæœ¬</span></span><br><span class="line">~ $ release-cli --server-url http://gitlab.weiyigeek.top --private-token <span class="string">"fYyHzos-zEPPP8PDsxLa"</span>  --project-id 45 create --tag-name <span class="string">"v1.15"</span> --name <span class="string">"My Release"</span> --description <span class="string">"This is a new release for my amazing tool"</span></span><br><span class="line"><span class="comment"># INFO[0000] Creating Release...  </span></span><br><span class="line"><span class="comment"># cli=release-cli command=create name="My Release" project-id=45 ref= server-url="http://gitlab.weiyigeek.top" tag-name=v1.15 version=0.6.0</span></span><br><span class="line"><span class="comment"># Tag: v1.15</span></span><br><span class="line"><span class="comment"># Name: My Release</span></span><br><span class="line"><span class="comment"># Description: This is a new release for my amazing tool</span></span><br><span class="line"><span class="comment"># Created At: 2021-02-10 14:52:17.08 +0800 CST</span></span><br><span class="line"><span class="comment"># Released At: 2021-02-10 14:52:17.08 +0800 CST</span></span><br><span class="line"><span class="comment"># See all available releases here: /-/releases</span></span><br><span class="line"><span class="comment"># INFO[0001] release created successfully!  </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ï¼ˆ3ï¼‰æŒ‡å®šRELEASEçš„å¤–éƒ¨URL</span></span><br><span class="line">~ $ release-cli --server-url http://gitlab.weiyigeek.top --private-token <span class="string">"fYyHzos-zEPPP8PDsxLa"</span>  --project-id 45 create --tag-name <span class="string">"v1.14"</span> --name <span class="string">"v1.15"</span> --description <span class="string">"This is a new release for my amazing tool"</span> --assets-link <span class="string">'&#123;"name":</span></span><br><span class="line"><span class="string">"info-student-rebuid","url":"http://192.168.12.107:30001/job/HelloWorld/19/artifact/target/info-student-rebuild-0.0.2-SNAPSHOT.jar","link_type":"other","filepath":"/binaries/linux-amd64"&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># INFO[0000] Creating Release... </span></span><br><span class="line"><span class="comment"># cli=release-cli command=create name=v1.15 project-id=45 ref= server-url="http://gitlab.weiyigeek.top" tag-name=v1.14 version=0.6.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Tag: v1.14</span></span><br><span class="line"><span class="comment"># Name: v1.15</span></span><br><span class="line"><span class="comment"># Description: This is a new release for my amazing tool</span></span><br><span class="line"><span class="comment"># Created At: 2021-02-10 14:57:07.358 +0800 CST</span></span><br><span class="line"><span class="comment"># Released At: 2021-02-10 14:57:07.358 +0800 CST</span></span><br><span class="line"><span class="comment"># Asset::Link::Name: info-student-rebuid</span></span><br><span class="line"><span class="comment"># Asset::Link::URL: http://192.168.12.107:30001/job/HelloWorld/19/artifact/target/info-student-rebuild-0.0.2-SNAPSHOT.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># See all available releases here: /-/releases</span></span><br><span class="line"><span class="comment"># INFO[0002] release created successfully!  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) æŒ‡å®šRELEASEçš„å¤šä¸ªå¤–éƒ¨URL</span></span><br><span class="line">~ $ /usr/<span class="built_in">local</span>/bin/release-cli --server-url http://gitlab.weiyigeek.top --private-token <span class="string">"fYyHzos-zEPPP8PDsxLa"</span>  --project-id 45 create --tag-name <span class="string">"v1.12"</span> --name <span class="string">"v1.12"</span> --description <span class="string">"This is a new release for my amazing tool"</span> --assets-link <span class="string">'&#123;"name":</span></span><br><span class="line"><span class="string">"info-student-rebuid","url":"http://192.168.12.107:30001/job/HelloWorld/19/artifact/target/info-student-rebuild-0.0.2-SNAPSHOT.jar","link_type":"other"&#125;'</span> --assets-link <span class="string">'&#123;"name":"Asset2","url":"http://192.168.12.107:30001/job/HelloWor</span></span><br><span class="line"><span class="string">ld/19/artifact/target/info-student-rebuild-0.0.1-SNAPSHOT.jar"&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># INFO[0000] Creating Release</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Tag: v1.12</span></span><br><span class="line"><span class="comment"># Name: v1.12</span></span><br><span class="line"><span class="comment"># Description: This is a new release for my amazing tool</span></span><br><span class="line"><span class="comment"># Created At: 2021-02-10 15:06:23.059 +0800 CST</span></span><br><span class="line"><span class="comment"># Released At: 2021-02-10 15:06:23.059 +0800 CST</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Asset::Link::Name: Asset2</span></span><br><span class="line"><span class="comment"># Asset::Link::URL: http://192.168.12.107:30001/job/HelloWorld/19/artifact/target/info-student-rebuild-0.0.1-SNAPSHOT.jar</span></span><br><span class="line"><span class="comment"># Asset::Link::Name: info-student-rebuid</span></span><br><span class="line"><span class="comment"># Asset::Link::URL: http://192.168.12.107:30001/job/HelloWorld/19/artifact/target/info-student-rebuild-0.0.2-SNAPSHOT.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># See all available releases here: /-/releases</span></span><br><span class="line"><span class="comment"># INFO[0002] release created successfully!                 </span></span><br><span class="line"><span class="comment"># cli=release-cli command=create name=v1.12 project-id=45 ref= server-url="http://gitlab.weiyigeek.top" tag-name=v1.12 version=0.6.0</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>è¡¥å……è¯´æ˜:</strong></p>
<ul>
<li><p>1) å‘å¸ƒçš„ç‰ˆæœ¬åˆ—è¡¨æŒ‰released_atæ’åºã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ curl -s --header <span class="string">"PRIVATE-TOKEN: fYyHzos-zEPPP8PDsxLa"</span> <span class="string">"http://gitlab.weiyigeek.top/api/v4/projects/45/releases"</span> | jq .[].tag_name</span><br><span class="line"><span class="string">"v1.12"</span></span><br><span class="line"><span class="string">"v1.14"</span></span><br><span class="line"><span class="string">"v1.15"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  éªŒè¯å‘å¸ƒç‰ˆæœ¬çš„ evidence (é‡Šæ”¾) </span></span><br><span class="line"><span class="comment">#  Create Evidence for an existing Release. </span></span><br><span class="line">$ curl -s --request POST  --header <span class="string">"PRIVATE-TOKEN: fYyHzos-zEPPP8PDsxLa"</span> <span class="string">"http://gitlab.weiyigeek.top/api/v4/projects/45/releases/v1.12/evidence"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>2) æŸ¥çœ‹å‘å¸ƒçš„æŒ‡å®šç‰ˆæœ¬çš„releaseçš„ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ curl -s --header <span class="string">"PRIVATE-TOKEN: fYyHzos-zEPPP8PDsxLa"</span> <span class="string">"http://gitlab.weiyigeek.top/api/v4/projects/45/releases/v1.12"</span> | jq <span class="string">'.assets.links[] | select (.id == 5 or .id == 4) | .url'</span></span><br><span class="line"><span class="string">"http://192.168.12.107:30001/job/HelloWorld/19/artifact/target/info-student-rebuild-0.0.1-SNAPSHOT.jar"</span></span><br><span class="line"><span class="string">"http://192.168.12.107:30001/job/HelloWorld/19/artifact/target/info-student-rebuild-0.0.2-SNAPSHOT.jar"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>3) åˆ©ç”¨httpè¯·æ±‚åˆ›å»ºä¸€ä¸ªç‰ˆæœ¬ã€‚<br>æè¿°: åˆ›å»ºå‘å¸ƒéœ€è¦å¼€å‘äººå‘˜å¯¹é¡¹ç›®çš„è®¿é—®ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ curl --header <span class="string">'Content-Type: application/json'</span> --header <span class="string">"PRIVATE-TOKEN: fYyHzos-zEPPP8PDsxLa"</span> \</span><br><span class="line">  --data <span class="string">'&#123; "name": "New release", "tag_name": "v1.13", "description": "Super nice release", "milestones": ["v1.13", "v1.13-rc"], "assets": &#123; "links": [&#123; "name": "hoge", "url": "https://google.com", "filepath": "/binaries/linux-amd64", "link_type":"other" &#125;] &#125; &#125;'</span> \</span><br><span class="line">  --request POST <span class="string">"http://gitlab.weiyigeek.top/api/v4/projects/45/releases"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>4) æ›´æ–°å·²å‘å¸ƒçš„ release ç‰ˆæœ¬ (åŸºç¡€ä¿¡æ¯)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹å‰</span></span><br><span class="line">$ curl -s --header <span class="string">"PRIVATE-TOKEN: fYyHzos-zEPPP8PDsxLa"</span> <span class="string">"http://gitlab.weiyigeek.top/api/v4/projects/45/releases/v1.12"</span> | jq .<span class="string">"description"</span></span><br><span class="line"><span class="string">"This is a new release for my amazing tool"</span></span><br><span class="line"></span><br><span class="line">$  curl -s --header <span class="string">'Content-Type: application/json'</span> --request PUT --data <span class="string">'&#123;"name": "Release - v1.12", "description": "æ›´æ–°æµ‹è¯•", "milestones": ["v1.12"]&#125;'</span> --header <span class="string">"PRIVATE-TOKEN: fYyHzos-zEPPP8PDsxLa"</span> <span class="string">"http://gitlab.weiyigeek.top/api/v4/projects/45/releases/v1.12"</span> | jq .</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"Release - v1.12"</span>,</span><br><span class="line">  <span class="string">"tag_name"</span>: <span class="string">"v1.12"</span>,</span><br><span class="line">  <span class="string">"description"</span>: <span class="string">"æ›´æ–°æµ‹è¯•"</span>,</span><br><span class="line">....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹å</span></span><br><span class="line">~$ curl -s --header <span class="string">"PRIVATE-TOKEN: fYyHzos-zEPPP8PDsxLa"</span> <span class="string">"http://gitlab.weiyigeek.top/api/v4/projects/45/releases/v1.12"</span> | jq .<span class="string">"description"</span></span><br><span class="line"><span class="string">"æ›´æ–°æµ‹è¯•"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>5) åˆ é™¤ä¸€ä¸ªå‘å¸ƒçš„ç‰ˆæœ¬ã€‚<br>æè¿°: åˆ é™¤ä¸€ä¸ªç‰ˆæœ¬å¹¶ä¸ä¼šåˆ é™¤ç›¸å…³çš„æ ‡ç­¾, æ³¨æ„åˆ é™¤ä¸€ä¸ªç‰ˆæœ¬éœ€è¦<code>å¯¹é¡¹ç›®çš„ç»´æŠ¤è€…çº§åˆ«çš„è®¿é—®</code>ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~$ curl --request DELETE --header <span class="string">"PRIVATE-TOKEN: fYyHzos-zEPPP8PDsxLa"</span> <span class="string">"http://gitlab.weiyigeek.top/api/v4/projects/45/releases/v1.12"</span></span><br><span class="line">&#123;<span class="string">"name"</span>:<span class="string">"Release - v1.12"</span>,<span class="string">"tag_name"</span>:<span class="string">"v1.12"</span>,<span class="string">"description"</span>:<span class="string">"æ›´æ–°æµ‹è¯•"</span>,<span class="string">"description_html"</span>:<span class="string">"\u003cp data-sourcepos=\"1:1-1:12\" dir=\"auto\"\u003eæ›´æ–°æµ‹è¯•\u003c/p\u003e"</span>,<span class="string">"created_at"</span>:<span class="string">"2021-02-10T15:06:23.059+08:00"</span>,<span class="string">"released_at"</span>:<span class="string">"2021-02-10T15:06:23.059+08:00"</span>,<span class="string">"author"</span>:&#123;<span class="string">"id"</span>:11,<span class="string">"name"</span>:<span class="string">"weiyigeek"</span>,<span class="string">"username"</span>:<span class="string">"weiyigeek"</span>,<span class="string">"state"</span>:<span class="string">"active"</span>,<span class="string">"avatar_url"</span>:<span class="string">"http://gitlab.weiyigeek.top/uploads/-/system/user/avatar/11/avatar.png"</span>,<span class="string">"web_url"</span>:<span class="string">"http://gitlab.weiyigeek.top/weiyigeek"</span>&#125;,<span class="string">"commit"</span>:&#123;<span class="string">"id"</span>:<span class="string">"334c630d2944461ac271a2d92f49496dcf30f443"</span>,<span class="string">"short_id"</span>:<span class="string">"334c630d"</span>,<span class="string">"created_at"</span>:<span class="string">"2021-02-02T13:34:45.000+08:00"</span>,<span class="string">"parent_ids"</span>:[<span class="string">"f1d2cd8126c8f181b66bc562f94ffff0a4460067"</span>],<span class="string">"title"</span>:<span class="string">"RELEASE v1.12 jenkins"</span>,<span class="string">"message"</span>:<span class="string">"RELEASE v1.12 jenkins\n"</span>,<span class="string">"author_name"</span>:<span class="string">"WeiyiGeek"</span>,<span class="string">"author_email"</span>:<span class="string">"1564362804@qq.com"</span>,<span class="string">"authored_date"</span>:<span class="string">"2021-02-02T13:34:45.000+08:00"</span>,<span class="string">"committer_name"</span>:<span class="string">"WeiyiGeek"</span>,<span class="string">"committer_email"</span>:<span class="string">"1564362804@qq.com"</span>,<span class="string">"committed_date"</span>:<span class="string">"2021-02-02T13:34:45.000+08:00"</span>,<span class="string">"web_url"</span>:<span class="string">"http://gitlab.weiyigeek.top/weiyigeek/helloworld/-/commit/334c630d2944461ac271a2d92f49496dcf30f443"</span>&#125;,<span class="string">"upcoming_release"</span>:<span class="literal">false</span>,<span class="string">"commit_path"</span>:<span class="string">"/weiyigeek/helloworld/-/commit/334c630d2944461ac271a2d92f49496dcf30f443"</span>,<span class="string">"tag_path"</span>:<span class="string">"/weiyigeek/helloworld/-/tags/v1.12"</span>,<span class="string">"assets"</span>:&#123;<span class="string">"count"</span>:4,<span class="string">"sources"</span>:[&#123;<span class="string">"format"</span>:<span class="string">"zip"</span>,<span class="string">"url"</span>:<span class="string">"http://gitlab.weiyigeek.top/weiyigeek/helloworld/-/archive/v1.12/helloworld-v1.12.zip"</span>&#125;,&#123;<span class="string">"format"</span>:<span class="string">"tar.gz"</span>,<span class="string">"url"</span>:<span class="string">"http://gitlab.weiyigeek.top/weiyigeek/helloworld/-/archive/v1.12/helloworld-v1.12.tar.gz"</span>&#125;,&#123;<span class="string">"format"</span>:<span class="string">"tar.bz2"</span>,<span class="string">"url"</span>:<span class="string">"http://gitlab.weiyigeek.top/weiyigeek/helloworld/-/archive/v1.12/helloworld-v1.12.tar.bz2"</span>&#125;,&#123;<span class="string">"format"</span>:<span class="string">"tar"</span>,<span class="string">"url"</span>:<span class="string">"http://gitlab.weiyigeek.top/weiyigeek/helloworld/-/archive/v1.12/helloworld-v1.12.tar"</span>&#125;],<span class="string">"links"</span>:[]&#125;,<span class="string">"evidences"</span>:[],<span class="string">"_links"</span>:&#123;<span class="string">"self"</span>:<span class="string">"http://gitlab.weiyigeek.top/weiyigeek/helloworld/-/releases/v1.12"</span>,<span class="string">"edit_url"</span>:<span class="string">"http://gitlab.weiyigeek.top/weiyigeek/helloworld/-/releases/v1.12/edit"</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line">~$ curl --request DELETE --header <span class="string">"PRIVATE-TOKEN: fYyHzos-zEPPP8PDsxLa"</span> <span class="string">"http://gitlab.weiyigeek.top/api/v4/projects/45/releases/v1.12"</span></span><br><span class="line">&#123;<span class="string">"message"</span>:<span class="string">"403 Forbidden"</span>&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="0x03-åŸºç¡€é…ç½®"><a href="#0x03-åŸºç¡€é…ç½®" class="headerlink" title="0x03 åŸºç¡€é…ç½®"></a>0x03 åŸºç¡€é…ç½®</h2><h3 id="Gitlabåˆå§‹åŒ–è®¾ç½®"><a href="#Gitlabåˆå§‹åŒ–è®¾ç½®" class="headerlink" title="Gitlabåˆå§‹åŒ–è®¾ç½®"></a>Gitlabåˆå§‹åŒ–è®¾ç½®</h3><p><strong>0) ç”¨æˆ·ä¸»é¢˜ä¸è¯­è¨€è®¾ç½®</strong><br>æµç¨‹:å³ä¸Šè§’ä¸ªäººå¤´åƒ-&gt;settings-&gt;Preferences-&gt;<code>ä¸»é¢˜è®¾ç½®|è¯­æ³•é«˜äº®ä¸»é¢˜|è‡ªå®šä¹‰è¯­è¨€å’ŒåŒºåŸŸç›¸å…³è®¾ç½®</code></p>
<p><strong>1) å…³é—­Gravatarå¤´åƒåŠŸèƒ½è¿›è¡Œç½‘ç»œåŠ é€Ÿ</strong><br>Setting -&gt; Gravatar enabled(å±•å¼€Expand) -&gt; <code>not Checked Gravatar enabled</code> -&gt; Sava Changes</p>
<figure class="image-box">
                <a rel=GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415163112.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415163112.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure>
<p><strong>2) ç”¨æˆ·ç®¡ç†ä¸æ³¨å†Œç›¸å…³è®¾ç½®</strong><br>æè¿°:æ˜¯å¦ç”¨æˆ·è‡ªå·±è¿›è¡Œæ³¨å†Œä»¥åŠè®¾ç½®å¯†ç ç­–ç•¥å’Œæ³¨å†Œé‚®ç®±åŸŸå(ç™½|é»‘åå•)ç­‰ä¿¡æ¯,å¦‚æœå…³é—­åé¦–é¡µå°†ä¸æ˜¾ç¤ºæ³¨å†Œ;<br><figure class="image-box">
                <a rel=GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415173638.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415173638.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure></p>
<ul>
<li>åˆ›å»ºç”¨æˆ·:<code>Admin Area</code>-&gt; User -&gt; New User -&gt; é¡¹ç›®é™åˆ¶(åˆ›å»ºå¾—æ•°é‡é»˜è®¤å³å¯) -&gt;  <code>Can create group</code>(ä¼ä¸šå†…éƒ¨å»ºè®®å–æ¶ˆ) -&gt;  åˆ›å»ºç”¨æˆ· (ç”¨æˆ·é‚®ç®±å°†ä¼šæ”¶åˆ°ä¸€ä»½æ³¨å†Œé‚®ä»¶)</li>
<li>æ¨¡ä»¿ç”¨æˆ· impersonate: å¯ä»¥æ¨¡ä»¿ç”¨æˆ·ç™»å½•ï¼Œä¸ç”¨é€€å‡ºå†ç™»å½•;<figure class="image-box">
                <a rel=GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200416112358.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200416112358.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure>
</li>
</ul>
<p>Q: Gitlab çš„ç”¨æˆ· ã€ç»„ã€é¡¹ç›®ä¹‹é—´çš„å…³ç³»;</p>
<blockquote>
<p>1.é¡¹ç›®ï¼šå¯åˆ†é…åˆ°ç»„ æˆ–è€… æŒ‡å®šç”¨æˆ·<br>2.ç»„: å¯ä¸åŒ…å«æŒ‡å®šç”¨æˆ·ï¼Œè€Œæ‹¥æœ‰è¯¥ç»„çš„ç”¨æˆ·æ‹¥æœ‰ç›¸åŒçš„æƒé™ï¼›(æ¨èåˆ›å»ºåˆ©ç”¨ç»„æ¥é…å¯¹åº”çš„é¡¹ç›®è®¾ç½®äººå‘˜çš„ç›¸åº”æƒé™)<br>3.ç”¨æˆ·: æˆ‘ä»¬çš„æ³¨å†Œäººå‘˜åŒ…æ‹¬å¼€å‘è€…ã€è¿ç»´ã€ä¸»ç®¡ç­‰</p>
</blockquote>
<p>ç»„ä¸é¡¹ç›®ç»‘å®šæµç¨‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.å…ˆåˆ›å»ºç»„;</span><br><span class="line">2.åˆ›å»ºé¡¹ç›®å¹¶è®©è¯¥é¡¹ç›®éš¶å±äºè¯¥ç»„;</span><br><span class="line">3.åˆ›å»ºç”¨æˆ·å¹¶æ·»åŠ ç»„å¹¶åˆ†é…æƒé™</span><br></pre></td></tr></table></figure></p>
<p>Q: å¦‚æœæœ‰æ–°æˆå‘˜éœ€è¦åŠ å…¥è¯¥é¡¹ç›®æ€ä¹ˆåŠ?</p>
<blockquote>
<p>1.å…ˆç»™æ–°æˆå‘˜åˆ›å»ºç”¨æˆ·ç»„ï¼›<br>2.å†å°†æˆå‘˜åŠ å…¥ç»„ï¼Œæ­¤æ—¶è¯¥ç”¨æˆ·å°±èƒ½çœ‹åˆ°å¯¹åº”çš„é¡¹ç›®ï¼›<br>3.æ·»åŠ å…¬é’¥ï¼Œç„¶åä½¿ç”¨<code>git clone</code>æµ‹è¯•æ˜¯å¦èƒ½æ‹‰å–ä»£ç ;<br>4.æœ€åæ›´æ–°å†…å®¹ï¼Œæµ‹è¯•èƒ½å¦è¿›è¡Œä»»åŠ¡æäº¤;</p>
</blockquote>
<p><strong>3) ä»£ç æ¨é€æé†’åŠŸèƒ½</strong><br>æè¿°:æ·»åŠ ä¸€ä¸ªé¡¹ç›®æœ‰ä»£ç æäº¤åå‘é‚®ä»¶ç»™æŒ‡å®šçš„é‚®ç®±æé†’é€šçŸ¥ï¼Œè¿™ä¸ªå¯¹äºä»£ç å®¡æ ¸è¿˜æ˜¯æœ‰å¸®åŠ©çš„ï¼Œè‡³å°‘çŸ¥é“è°ä»€ä¹ˆæ—¶å€™æ¨é€æ–°ä»£ç äº†ï¼Œæ›´æ–°äº†å“ªäº›å†…å®¹ç­‰ï¼›</p>
<p>ç®¡ç†å‘˜ç™»é™†åˆ°gitlabç•Œé¢ <code>Admin area-&gt; Service Templates -&gt; Emails on push</code>, å‹¾é€‰Activeï¼ŒRecipientså¡«å†™æœ¬é¡¹ç›®æ›´æ–°éœ€è¦æ¨é€çŸ¥æ™“çš„äººå‘˜ï¼Œå¤šä¸ªç”¨ç©ºæ ¼æˆ–è€…é€—å·éš”å¼€;</p>
<figure class="image-box">
                <a rel=GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415214715.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415214715.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure>
<p><strong>4) è®¾ç½®ssh shellçš„ç«¯å£</strong><br>ç”¨äºå¤„ç†Gitå‘½ä»¤å’Œä¿®æ”¹authorized keysåˆ—è¡¨<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab_rails[<span class="string">'gitlab_shell_ssh_port'</span>] = 9022</span><br></pre></td></tr></table></figure></p>
<p><strong>5) ä¿®æ”¹gitlabçš„ä»“åº“(repositories)å­˜æ”¾ç›®å½•</strong><br>æè¿°:å®‰è£…å¥½åè¦å°†ä»“åº“(repositories)æ”¾åœ¨ä¸€ä¸ªå¤§ç¡¬ç›˜ä¸Šï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹ä»“åº“å¯¹åº”çš„ç›®å½•ã€‚<br>(æ³¨ï¼šæˆ‘æ˜¯å…ˆå°†æ‰€ä»¥çš„repositoriesåˆ é™¤å†ä½œä»¥ä¸‹æ“ä½œçš„ï¼Œè¿˜æŠŠ <code>/var/opt/gitlab/git-data/repositories/ç”¨æˆ·å</code> ç›®å½•ä¸‹æ‰€æœ‰ç”¨æˆ·åä¸‹çš„æ–‡ä»¶å…¨åˆ é™¤ï¼Œç›®å½•åˆ çš„åªå‰©ä¸‹ç©ºæ–‡ä»¶å¤¹ï¼‰<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹ç£ç›˜ç©ºé—´å¤§å°(å¯ä»¥æ ¹æ®æ‚¨è‡ªå·±æ·»åŠ çš„ç£ç›˜è¿›è¡Œæ“ä½œ)</span></span><br><span class="line"><span class="variable">$df</span> -h</span><br><span class="line">/dev/mapper/cl-home   24G  954M   24G    4% /home</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–°å»ºæ–°ä»“åº“ç›®å½•</span></span><br><span class="line"><span class="variable">$mkdir</span> -p /home/gitlab/git-data</span><br><span class="line"></span><br><span class="line"><span class="comment">#é…ç½®gitlabçš„æ•°æ®å­˜å‚¨ä½ç½®ä¸º/homeç›®å½•ä¸‹</span></span><br><span class="line"><span class="variable">$vi</span> /etc/gitlab/gitlab.rb</span><br><span class="line">git_data_dirs(&#123; <span class="string">"default"</span> =&gt; &#123; <span class="string">"path"</span> =&gt; <span class="string">"/home/gitlab/git-data"</span> &#125; &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡æ–°åŠ è½½é…ç½®</span></span><br><span class="line"><span class="variable">$sudo</span> gitlab-ctl reconfigure</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡è½½åå‘ç°æˆ‘ä»¬æ›´æ”¹çš„ä»“åº“åœ°å€ä¸‹é¢æœ‰æ•°æ®å­˜æ”¾äº†</span></span><br><span class="line"><span class="variable">$ls</span> /home/gitlab/git-data/</span><br><span class="line">repositories</span><br></pre></td></tr></table></figure></p>
<p><strong>6) åˆ›å»ºä¸€ä¸ªå¼€å‘ç»„</strong><br>åœ¨Gitlabç™»å½•åçš„ä¸»é¡µé¢ä¸Šç‚¹å‡»<code>Create a group</code>-&gt;è¾“å…¥ç›¸å…³ç»„ä¿¡æ¯åˆ›å»ºå³å¯ï¼›<br>é‚€è¯·æˆå‘˜åŠ å…¥åˆ°ç»„:<code>Members</code>-&gt;<code>Group members</code>-&gt;<code>Invite memeber</code> -&gt; é€‰æ‹©ç”¨æˆ·åŠ å…¥åˆ°åˆšåˆ›å»ºçš„ç»„ä»¥åŠè§’è‰²æƒé™ï¼›</p>
<figure class="image-box">
                <a rel=GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200416113914.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200416113914.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure>
<p><strong>7) é¡¹ç›®åˆ›å»ºä¸åˆå§‹åŒ–</strong><br>Gitlabçš„gitåœ°å€ç»„æˆä¸githubæ˜¯ä¸€è‡´(åˆ«å‘Šè¯‰æˆ‘æ‚¨ä¸çŸ¥é“): <code>gitlabåœ°å€+ç”¨æˆ·/ç¾¤ç»„+è‡ªå®šä¹‰åå­—</code></p>
<p>Gitlabé¡¹ç›®çš„å¯è§ç±»å‹æœ‰ä¸‰ç§çº§åˆ«ã€‚</p>
<ul>
<li>Private project: è¯¥çº§åˆ«æ˜¯åªæœ‰é¡¹ç›®æ‹¥æœ‰è€…æˆ–è€…å·²ç»å¾—åˆ°æˆæƒçš„äººå¯ä»¥è®¿é—®è¯¥é¡¹ç›®ï¼Œæˆ–è€…è¿™äº›äººæ˜¯è¯¥é¡¹ç›®ç»„çš„æˆå‘˜ã€‚</li>
<li>Internal project: åªè¦æœ‰ç”¨æˆ·åå’Œå¯†ç ï¼Œ<code>å¯ä»¥ç™»é™†è¯¥é¡¹ç›®æ‰€åœ¨çš„GitlabæœåŠ¡å™¨çš„</code>ï¼Œå‡å¯è®¿é—®è¯¥é¡¹ç›®ã€‚</li>
<li>public projects: åªè¦çŸ¥é“è¯¥é¡¹ç›®çš„å…·ä½“ä½ç½®å°±æ˜¯è·¯å¾„ï¼Œéƒ½å¯ä»¥è®¿é—®è¯¥é¡¹ç›®, <code>å®ƒä»¬é»˜è®¤çš„ä½¿ç”¨çš„æ˜¯guestæƒé™</code>ã€‚</li>
</ul>
<p>æ¯”å¦‚æˆ‘ä»¬åœ¨ä¸Šé¢çš„å¼€å‘ç»„é¡¹ç›®ä¸­è¿›è¡Œåˆ›å»ºé¡¹ç›®æ“ä½œæµç¨‹å¦‚ä¸‹:<br>1.è¿›å…¥å¼€å‘ç»„-&gt;New Project-&gt;è®¾ç½®é¡¹ç›®åç§°-&gt;åˆ›å»ºé¡¹ç›®<br>2.å»ºè®®æ·»åŠ SSHå¯†é’¥åˆ°Gitlabä¸­å…å¯†ç æ¨é€ä¸æ‹‰å–<a href="mailto:`git@gitlab.weiyigeek.top">`git@gitlab.weiyigeek.top</a>:newproject/secopsdev.git`:Setting -&gt; SSH;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls ~/.ssh/</span><br><span class="line">id_ed25519  id_ed25519.pub  id_rsa  id_rsa.pub  known_hosts</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200416131432.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200416131432.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure></p>
<p>3.é¡¹ç›®çš„åˆå§‹åŒ–:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åŸºç¡€è®¾ç½®(å‰æä½ éœ€è¦ä¸‹è½½git)</span></span><br><span class="line">git config --global user.name <span class="string">"WeiyiGeek"</span></span><br><span class="line">git config --global user.email <span class="string">"weiyigeek@qq.com"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ›å»ºä¸€ä¸ªæ–°çš„å­˜å‚¨åº“</span></span><br><span class="line">git <span class="built_in">clone</span> git@gitlab.weiyigeek.top:newproject/secopsdev.git</span><br><span class="line"><span class="built_in">cd</span> secopsdev</span><br><span class="line">touch README.md</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m <span class="string">"add README"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¨é€ç°æœ‰æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="built_in">cd</span> existing_folder</span><br><span class="line">git init</span><br><span class="line">git remote add origin http://gitlab.weiyigeek.top/newproject/secopsdev.git</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">"Initial commit"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¨åŠ¨ç°æœ‰çš„Gitå­˜å‚¨åº“</span></span><br><span class="line"><span class="built_in">cd</span> existing_repo</span><br><span class="line">git remote rename origin old-origin  <span class="comment">#å°†æœ¬åœ°åˆ†æ”¯æ”¹å</span></span><br><span class="line">git remote add origin http://gitlab.weiyigeek.top/newproject/secopsdev.git</span><br></pre></td></tr></table></figure></p>
<p>4.éœ€è¦æ³¨æ„é»˜è®¤æ˜¯æ— æ³•è¿›è¡Œæäº¤çš„è¿™æ˜¯ç”±äºMasterä¸»åˆ†æ”¯è¢«ä¿æŠ¤æ‰€å¯¼è‡´çš„,å¦‚æœæƒ³ç›´æ¥å¯¹ä¸»åˆ†æ”¯è¿›è¡Œæ›´æ”¹è€Œåˆä¸æƒ³åˆ›å»ºå­åˆ†æ”¯å¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹å¼ï¼Œå‰ææ˜¯å¿…é¡»é‡‡ç”¨<code>Maintainersçš„ç”¨æˆ·ä¸Šä¼ Masteråˆ†æ”¯åè¿›è¡Œè®¾ç½®</code>;<br>Project -&gt; Settings -&gt; Repository -&gt; Brach (<code>åˆ†æ”¯æƒé™è®¾ç½®</code>) æˆ–è€… åˆ é™¤ä¿æŠ¤;<br><figure class="image-box">
                <a rel=GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200416134004.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200416134004.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure></p>
<p><strong>8) ç”¨æˆ·é¡¹ç›®æƒé™æ§åˆ¶</strong><br>æƒé™ç®¡ç†ç†è§£ï¼š</p>
<ul>
<li>(1).æ–°å»ºç”¨æˆ·çš„æ—¶å€™é€‰æ‹©ä¸€ä¸ªæ™®é€šæƒé™å’Œç®¡ç†å‘˜æƒé™ä¹‹åˆ†å³å¯</li>
<li>(2).å»ºgitåº“çš„æ—¶å€™å¯ä»¥å…³è”ä¸€ä¸ªç»„æˆ–è€…ä¸€ä¸ªæˆå‘˜</li>
<li>(3).æ·»åŠ åˆ°ç»„é‡Œé¢çš„äººå‘˜å¯ä»¥è®¾å®šGuest Reporter Developer Master Owner</li>
<li>(4).ä¸åŒgitåº“é‡Œé¢çš„å…³è”åŒä¸€ä¸ªæˆå‘˜å¯ä»¥è®¾ç½®ä¸åŒæƒé™</li>
<li>(5).ä¸åŒgitåº“é‡Œé¢çš„å…³è”åŒä¸€ä¸ªç»„æ— æ³•è®¾ç½®ä¸åŒæƒé™</li>
<li>(6).ä¸€ä¸ªgitåº“åªèƒ½å…³è”ä¸€ä¸ªç»„æˆå‘˜</li>
<li>(7).ä¸€ä¸ªç»„æˆå‘˜å¯ä»¥è¢«å¤šä¸ªgitåº“å…³è”ï¼Œä¸”æƒé™ä¸€æ ·</li>
<li>(8).ä¸€ä¸ªæˆå‘˜å¯ä»¥è¢«å¤šä¸ªgitåº“æˆ–ç»„æˆå‘˜å…³è”ï¼Œä¸”æƒé™å¯ä»¥ä¸ä¸€æ ·</li>
<li>(9).Reporterä»¥ä¸Šæ‰æœ‰ä¸‹ä»£ç æƒé™</li>
<li>(10).ä¼ä¸šæƒé™æ§åˆ¶:<ul>
<li>å¼€å‘äººå‘˜ï¼šdeveloperæƒé™</li>
<li>ä»£ç å®¡æ ¸MDEï¼šmasteræƒé™</li>
</ul>
</li>
</ul>
<p>é¡¹ç›®ç»„&amp;xé¡¹ç›®æƒé™ç®¡ç†:</p>
<ul>
<li>Project Name -&gt; Memebers-&gt; ç”¨æˆ·æˆå‘˜ä¸<code>Choose a role permission</code> -&gt; ä»¥åŠå¤±æ•ˆæ—¥æœŸè®¾ç½®<br><a href="http://gitlab.com/help/user/permissions#project-members-permissions" target="_blank" rel="noopener">å‚è€ƒå®˜æ–¹æ–‡æ¡£ç½‘ç«™</a>åˆ—å‡ºäº†<code>Guest,Reporter,Developer,Maintainer(Master),Owner</code>å¯¹åº”çš„æƒé™,æ¯”å¦‚ä¸Šé¢æˆ‘ä»¬è®¾ç½®çš„Devé»˜è®¤å¯¹ä¿æŠ¤åˆ†æ”¯æ˜¯æ²¡æœ‰pushæƒé™çš„;</li>
</ul>
<p><strong>9) å¹¿æ’­ä¿¡æ¯è®¾ç½®</strong><br>æè¿°: å¹¿æ’­ä¿¡æ¯ä¼šæ˜¾ç¤ºç»™å…¨éƒ¨ç”¨æˆ·ï¼Œå¯ä»¥ç”¨äºé€šçŸ¥ç”¨æˆ·ç³»ç»Ÿå®šæœŸç»´æŠ¤ã€è¿‘æœŸè®¡åˆ’å‡çº§ç­‰ä¿¡æ¯ï¼Œ<code>åœ¨ç”¨æˆ·ç™»é™†ç•Œé¢ä»¥åŠç”¨æˆ·æäº¤ä»£ç çš„æ—¶å€™ä¼šæœ‰æ˜¾ç¤º</code>ã€‚<br>Area Admin -&gt; Messages -&gt; Broadcast Information (è®¾ç½®å³å¯)</p>
<figure class="image-box">
                <a rel=GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200416151412.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200416151412.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure>
<p><br/></p>
<h3 id="Gitlabæˆå‘˜æƒé™è¯´æ˜"><a href="#Gitlabæˆå‘˜æƒé™è¯´æ˜" class="headerlink" title="Gitlabæˆå‘˜æƒé™è¯´æ˜"></a>Gitlabæˆå‘˜æƒé™è¯´æ˜</h3><p>åŸºç¡€æ¦‚å¿µ: ç”¨æˆ·å…·æœ‰ä¸åŒçš„èƒ½åŠ›ï¼Œå…·ä½“å–å†³äºä»–ä»¬åœ¨ç‰¹å®šç»„æˆ–é¡¹ç›®ä¸­çš„è®¿é—®çº§åˆ«ã€‚å¦‚æœç”¨æˆ·åŒæ—¶åœ¨ç»„çš„é¡¹ç›®å’Œé¡¹ç›®æœ¬èº«ä¸­ï¼Œåˆ™ä½¿ç”¨æœ€é«˜æƒé™çº§åˆ«ã€‚åœ¨å…¬å…±å’Œå†…éƒ¨é¡¹ç›®ä¸­ï¼Œä¸ä¼šå¼ºåˆ¶å®æ–½Guestè§’è‰², æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥åˆ›å»ºé—®é¢˜ï¼Œå‘è¡¨è¯„è®ºï¼Œå…‹éš†æˆ–ä¸‹è½½é¡¹ç›®ä»£ç ã€‚å½“æˆå‘˜ç¦»å¼€å›¢é˜Ÿæ—¶ï¼Œå°†è‡ªåŠ¨å–æ¶ˆåˆ†é…æ‰€æœ‰åˆ†é…çš„é—®é¢˜å’Œåˆå¹¶è¯·æ±‚ã€‚</p>
<p>Tips ï¼šGitlabç”¨æˆ·åœ¨ç»„ä¸­æœ‰äº”ç§æƒé™ï¼šGuestã€Reporterã€Developerã€<code>Master (åœ¨ 11.0 ç‰ˆæœ¬ä¸­å·²é‡å‘½åä¸º Maintainer) - ç»´æŠ¤è€…</code>ã€Owner</p>
<p><strong>æˆå‘˜æƒé™è¯´æ˜:</strong></p>
<ul>
<li>Guestï¼šå¯ä»¥åˆ›å»ºissueã€å‘è¡¨è¯„è®ºï¼Œä¸èƒ½è¯»å†™ç‰ˆæœ¬åº“</li>
<li>Reporterï¼šå¯ä»¥å…‹éš†ä»£ç ï¼Œä¸èƒ½æäº¤ï¼ŒQAã€PMå¯ä»¥èµ‹äºˆè¿™ä¸ªæƒé™</li>
<li>Developerï¼šå¯ä»¥å…‹éš†ä»£ç ã€å¼€å‘ã€æäº¤ã€pushï¼ŒRDå¯ä»¥èµ‹äºˆè¿™ä¸ªæƒé™</li>
<li>Maintainerï¼šå¯ä»¥åˆ›å»ºé¡¹ç›®ã€æ·»åŠ tagã€ä¿æŠ¤åˆ†æ”¯ã€æ·»åŠ é¡¹ç›®æˆå‘˜ã€ç¼–è¾‘é¡¹ç›®ï¼Œæ ¸å¿ƒRDè´Ÿè´£äººå¯ä»¥èµ‹äºˆè¿™ä¸ªæƒé™</li>
<li>Ownerï¼šå¯ä»¥è®¾ç½®é¡¹ç›®è®¿é—®æƒé™ - Visibility Levelã€åˆ é™¤é¡¹ç›®ã€è¿ç§»é¡¹ç›®ã€ç®¡ç†ç»„æˆå‘˜ï¼Œå¼€å‘ç»„leaderå¯ä»¥èµ‹äºˆè¿™ä¸ªæƒé™</li>
<li>Gitlabä¸­çš„ç»„å’Œé¡¹ç›®æœ‰ä¸‰ç§è®¿é—®æƒé™ï¼šPrivateã€Internalã€Public</li>
</ul>
<p><strong>é¡¹ç›®æƒé™è¯´æ˜:</strong><br>Privateï¼šåªæœ‰ç»„æˆå‘˜æ‰èƒ½çœ‹åˆ°<br>Internalï¼šåªè¦ç™»å½•çš„ç”¨æˆ·å°±èƒ½çœ‹åˆ°,<code>å¼€æºé¡¹ç›®å’Œç»„è®¾ç½®çš„æ˜¯Internal</code><br>Publicï¼šæ‰€æœ‰äººéƒ½èƒ½çœ‹åˆ°</p>
<p>å‚è€ƒåœ°å€: <a href="https://docs.gitlab.com/ee/user/permissions.html" target="_blank" rel="noopener">https://docs.gitlab.com/ee/user/permissions.html</a></p>
<hr>
<h2 id="0x04-åŸºç¡€ä½¿ç”¨"><a href="#0x04-åŸºç¡€ä½¿ç”¨" class="headerlink" title="0x04 åŸºç¡€ä½¿ç”¨"></a>0x04 åŸºç¡€ä½¿ç”¨</h2><h3 id="Gitlabæ·»åŠ å‘ä¿¡é‚®ç®±"><a href="#Gitlabæ·»åŠ å‘ä¿¡é‚®ç®±" class="headerlink" title="Gitlabæ·»åŠ å‘ä¿¡é‚®ç®±"></a>Gitlabæ·»åŠ å‘ä¿¡é‚®ç®±</h3><p>é‚®ä»¶æ‰¾å›å¯†ç :<br>1)å› ä¸ºgitlabä¸€ç›´éƒ½åœ¨è¿è¡Œç€ï¼Œæ‰€ä»¥è¦ä¿®æ”¹å‰è®°å½•å¤‡ä»½ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼›<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/gitlab/gitlab.rb&#123;,.bak&#125;</span><br></pre></td></tr></table></figure><br>2)ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š/etc/gitlab/gitlab.rb è¿™é‡Œä½¿ç”¨å…¬å¸çš„ä¼ä¸šé‚®ç®±æ¥å‘é‚®ä»¶ï¼›</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$egrep</span> -v <span class="string">"^$|^#"</span> /etc/gitlab/gitlab.rb </span><br><span class="line">external_url <span class="string">'http://gitlab.weiyigeek.top'</span></span><br><span class="line">gitlab_rails[<span class="string">'time_zone'</span>] = <span class="string">'Asia/Shanghai'</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_enabled'</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_from'</span>] = <span class="string">'public@weiyigeek.top'</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_display_name'</span>] = <span class="string">'Gitlab CE'</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_reply_to'</span>] = <span class="string">'gitlab@weiyigeek.top'</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_enable'</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_address'</span>] = <span class="string">"smtp.exmail.qq.com"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_port'</span>] = 465</span><br><span class="line">gitlab_rails[<span class="string">'smtp_user_name'</span>] = <span class="string">"public@weiyigeek.top"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_password'</span>] = <span class="string">"é‚®ç®±å¯†ç "</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_domain'</span>] = <span class="string">"weiyigeek.top"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_authentication'</span>] = <span class="string">"login"</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_enable_starttls_auto'</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_tls'</span>] = <span class="literal">true</span></span><br><span class="line">user[<span class="string">'git_user_email'</span>] = <span class="string">"public@weiyigeek.top"</span></span><br></pre></td></tr></table></figure>
<p>3)ä¿å­˜ä¿®æ”¹ï¼Œæ›´æ–°é…ç½®ï¼›<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åªæ˜¯æŠŠä¿®æ”¹è¿‡çš„é…ç½®æ–‡ä»¶ä¿¡æ¯ï¼Œåˆ·æ–°åˆ°é…ç½®æ–‡ä»¶ä¸­</span></span><br><span class="line">gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure><br>å…¶å®ä¸Šé¢ä¿®æ”¹ä¸€ä¸ªé…ç½®æ–‡ä»¶gitlab.rb å®ƒé‡Œé¢çš„é…ç½®ä¼šè¢«æ­¤å‘½ä»¤è°ƒç”¨ç¼–å†™æˆå¤šä¸ªé…ç½®æ–‡ä»¶åˆ°å®‰è£…ç›®å½•ä¸‹ï¼š<code>/var/opt/gitlab/gitlab-rails/etc/</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ls</span> /var/opt/gitlab/gitlab-rails/etc/</span><br><span class="line">database.yml         gitlab_shell_secret      gitlab.yml      resque.yml   smtp_settings.rb <span class="comment">#ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹</span></span><br><span class="line">gitlab_pages_secret  gitlab_workhorse_secret  rack_attack.rb  secrets.yml  unicorn.rb</span><br></pre></td></tr></table></figure><br>å¦‚æœç›´æ¥ä¿®æ”¹<code>smtp_settings.rb</code>æ–‡ä»¶å°±åªè¦é‡å¯ä¸€ä¸‹<code>gitlab-ctl restart</code>å³å¯ã€‚</p>
<p>4)æ§åˆ¶å°æŸ¥çœ‹é…ç½®ä¸æµ‹è¯•å‘ä¿¡<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$gitlab</span>-rails console</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line"> GitLab:       12.9.2 (ac5568eb5d8) FOSS</span><br><span class="line"> GitLab Shell: 12.0.0</span><br><span class="line"> PostgreSQL:   10.12</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Loading production environment (Rails 6.0.2)</span><br><span class="line"></span><br><span class="line">irb(main):001:0&gt; ActionMailer::Base.delivery_method</span><br><span class="line">=&gt; :smtp</span><br><span class="line"></span><br><span class="line">irb(main):002:0&gt; ActionMailer::Base.smtp_settings</span><br><span class="line">=&gt; &#123;:authentication=&gt;:login, :address=&gt;<span class="string">"smtp.exmail.qq.com"</span>, :port=&gt;465, :user_name=&gt;<span class="string">"public@weiyigeek.top"</span>, :password=&gt;<span class="string">"Pa****20"</span>, :domain=&gt;<span class="string">"weiyigeek.top"</span>, :enable_starttls_auto=&gt;<span class="literal">true</span>, :tls=&gt;<span class="literal">true</span>, :ca_file=&gt;<span class="string">"/opt/gitlab/embedded/ssl/certs/cacert.pem"</span>&#125;</span><br><span class="line"></span><br><span class="line">irb(main):003:0&gt; Notify.test_email(<span class="string">'291238737@qq.com'</span>, <span class="string">'GitLabæµ‹è¯•é‚®ä»¶'</span>, <span class="string">'GitLab é¡µé¢ä¿¡æ¯'</span>).deliver_now</span><br><span class="line">Notify<span class="comment">#test_email: processed outbound mail in 2.0ms</span></span><br><span class="line">Delivered mail 5e9708455a809_6b023fce629dd99085b8@Developement.mail (1543.7ms)</span><br><span class="line">Date: Wed, 15 Apr 2020 21:12:37 +0800</span><br><span class="line">From: Gitlab CE &lt;public@weiyigeek.top&gt;</span><br><span class="line">Reply-To: Gitlab CE &lt;noreply@gitlab.weiyigeek.top&gt;</span><br></pre></td></tr></table></figure></p>
<p>å®Œæˆä¸Šé¢æ“ä½œåï¼Œå›åˆ°ç™»é™†é¡µé¢ï¼Œé€‰æ‹©Forgot your password? è¾“å…¥ä½ å¸å·çš„é‚®ç®±åœ°å€å³å¯æ”¶åˆ°é‚®ä»¶ï¼Œæ ¹æ®é‚®ä»¶åœ°å€ä¿®æ”¹æ–°å¯†ç å³å¯ï¼›</p>
<figure class="image-box">
                <a rel=GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415212316.png" target="_blank" title="WeiyiGeek.sendemail" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415212316.png" alt="WeiyiGeek.sendemail" title="" class=""></a>
                <p>WeiyiGeek.sendemail</p>
            </figure>
<p><em>è¡¥å……è¯´æ˜:</em></p>
<ul>
<li>åœ¨æŸäº›ECSä¸“æœ‰ç½‘ç»œä¸»æœºä¸Šé…ç½®äº†ä¸€ä¸ªgitlabä»“åº“ï¼Œå› ä¸ºé»˜è®¤è¿™äº›ä¸“æœ‰ç½‘ç»œçš„ECSä¸»æœºéƒ½æ˜¯ç¦ç”¨äº†25ç«¯å£çš„ï¼Œæ‰€ä»¥è¿™ä¸ªgitlab.rbçš„é…ç½®å°±æœ‰åšç›¸åº”çš„æ”¹å˜ï¼Œä½¿ç”¨465åè®®ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åªä¿®æ”¹ä»¥ä¸‹ä¸¤è¡Œå³å¯ï¼Œä¿®æ”¹å®Œè¦æ›´æ–°é…ç½®</span></span><br><span class="line">gitlab_rails[<span class="string">'smtp_port'</span>] = 25  </span><br><span class="line">gitlab_rails[<span class="string">'smtp_tls'</span>] = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h3 id="Gitlabæ·»åŠ LDAPè®¤è¯"><a href="#Gitlabæ·»åŠ LDAPè®¤è¯" class="headerlink" title="Gitlabæ·»åŠ LDAPè®¤è¯"></a>Gitlabæ·»åŠ LDAPè®¤è¯</h3><p>LDAPé…ç½®è¯´æ˜:<a href="http://gitlab.weiyigeek.top/help/administration/auth/ldap" target="_blank" rel="noopener">http://gitlab.weiyigeek.top/help/administration/auth/ldap</a></p>
<p>Step1.ä¿®æ”¹gitlabé…ç½®æ–‡ä»¶è®¾ç½®è¿æ¥LDAPæœåŠ¡å™¨å‚æ•°å³DNäºbindPass<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/gitlab/gitlab.rb</span><br><span class="line">gitlab_rails[<span class="string">'ldap_enabled'</span>] = <span class="literal">true</span></span><br><span class="line"><span class="comment"># gitlab_rails['prevent_ldap_sign_in'] = false</span></span><br><span class="line"><span class="comment">#! **remember to close this block with 'EOS' below**</span></span><br><span class="line">gitlab_rails[<span class="string">'ldap_servers'</span>] = YAML.load &lt;&lt;-<span class="string">'EOS'</span></span><br><span class="line">   main: <span class="comment"># 'main' is the GitLab 'provider ID' of this LDAP server</span></span><br><span class="line">     label: <span class="string">'LDAP'</span></span><br><span class="line">     host: <span class="string">'10.10.107.245'</span></span><br><span class="line">     port: 389</span><br><span class="line">     timeout: 10</span><br><span class="line">     uid: <span class="string">'uid'</span></span><br><span class="line">     bind_dn: <span class="string">'cn=admin,dc=WeiyiGeek,dc=com,dc=cn'</span></span><br><span class="line">     password: <span class="string">'WeiyiGeek'</span></span><br><span class="line">     encryption: <span class="string">'plain'</span> <span class="comment"># "start_tls" or "simple_tls" or "plain"</span></span><br><span class="line">     verify_certificates: <span class="literal">false</span></span><br><span class="line">     smartcard_auth: <span class="literal">false</span></span><br><span class="line">     active_directory: <span class="literal">true</span></span><br><span class="line">     allow_username_or_email_login: <span class="literal">true</span></span><br><span class="line">     lowercase_usernames: <span class="literal">false</span></span><br><span class="line">     block_auto_created_users: <span class="literal">false</span></span><br><span class="line">     base: <span class="string">'dc=WeiyiGeek,dc=com,dc=cn'</span></span><br><span class="line">     <span class="comment">#user_filter: '(&amp;(objectclass=inetOrgPerson)(memberof=cn=gitlab,ou=Group,dc=WeiyiGeek,dc=com,dc=cn))'</span></span><br><span class="line">     attribute:</span><br><span class="line">       username: [<span class="string">'uid'</span>]</span><br><span class="line">       email: [<span class="string">'mail'</span>]</span><br><span class="line">       name: <span class="string">'cn'</span></span><br><span class="line">       first_name: [<span class="string">'sn'</span>]</span><br><span class="line">EOS</span><br></pre></td></tr></table></figure></p>
<p>Step2.LDAPå»ºç«‹<code>groupOfUniqueNameså±æ€§</code>å¾—ç”¨æˆ·ç»„ä»¥åŠç»‘å®šç”¨æˆ·;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">dn: cn=gitlab,ou=Group,dc=WeiyiGeek,dc=com,dc=cn</span><br><span class="line">uniqueMember: uid=gituser,ou=People,dc=WeiyiGeek,dc=com,dc=cn</span><br><span class="line"></span><br><span class="line">dn: uid=gituser,ou=People,dc=WeiyiGeek,dc=com,dc=cn</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: inetOrgPerson</span><br><span class="line">objectClass: organizationalPerson</span><br><span class="line">objectClass: person</span><br><span class="line">loginShell: /bin/bash</span><br><span class="line">homeDirectory: /home/gituser</span><br><span class="line">userPassword:: e1NTSEF9UGVyM21xc1dJcnV3K1d2bWRiVmVpd3RWZHVVeVN6Tks=</span><br><span class="line">uid: gituser</span><br><span class="line">cn: gituser</span><br><span class="line">uidNumber: 10000</span><br><span class="line">gidNumber: 10000</span><br><span class="line">sn: gituser</span><br><span class="line">mail: gituser@weiyigeek.top</span><br></pre></td></tr></table></figure></p>
<p>Step3.ç™»é™†æµ‹è¯•å¦‚æœLDAPç”¨æˆ·ä¸å­˜åœ¨æˆ–è€…filterçš„æ¡ç›®ä¸å­˜åœ¨ä¼šæŠ¥é”™<code>Could not authenticate you from Ldapmain because &quot;Invalid credentials for jenkuser&quot;.</code></p>
<figure class="image-box">
                <a rel=GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415172031.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415172031.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure>
<p>Step4.ç™»é™†æˆåŠŸç•Œé¢å¦‚ä¸‹:</p>
<figure class="image-box">
                <a rel=GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415172222.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415172222.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure>
<p><br/></p>
<h3 id="Gitlabå¤‡ä»½å‡çº§è¿ç§»æ¢å¤"><a href="#Gitlabå¤‡ä»½å‡çº§è¿ç§»æ¢å¤" class="headerlink" title="Gitlabå¤‡ä»½å‡çº§è¿ç§»æ¢å¤"></a>Gitlabå¤‡ä»½å‡çº§è¿ç§»æ¢å¤</h3><p>æè¿°ï¼šGitLabä½œä¸ºå…¬å¸é¡¹ç›®ä»£ç çš„ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿï¼Œæ•°æ®éå¸¸é‡è¦æ‰€ä»¥å¿…é¡»åšå¥½å¤‡ä»½ã€‚</p>
<p>ä½¿ç”¨Gitlab å¤‡ä»½æ¢å¤ä¸è¿ç§»ä¹Ÿéå¸¸ç®€å•. ä½¿ç”¨ä¸€æ¡å‘½ä»¤å³å¯åˆ›å»ºå®Œæ•´çš„Gitlabå¤‡ä»½:<code>gitlab-rake gitlab:backup:create</code></p>
<p>ä½¿ç”¨ä»¥ä¸Šå‘½ä»¤é»˜è®¤ä¼šåœ¨<code>/var/opt/gitlab/backups</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåç§°ç±»ä¼¼ä¸º<code>1481598919_gitlab_backup.tar</code>çš„å‹ç¼©åŒ…, è¿™ä¸ªå‹ç¼©åŒ…å°±æ˜¯Gitlabæ•´ä¸ªçš„å®Œæ•´éƒ¨åˆ†, å…¶ä¸­å¼€å¤´çš„1481598919æ˜¯å¤‡ä»½åˆ›å»ºçš„æ—¥æœŸ</p>
<p>Gitlabæä¾›äº†ä¸¤ç§å¤‡ä»½:</p>
<ul>
<li>æœ¬åœ°å¤‡ä»½: é‡‡ç”¨gitlab-rake gitlab:backup:create</li>
<li>è¿œç¨‹å¤‡ä»½: å®é™…æ˜¯è¿œç¨‹æœºå™¨è¿æ¥åˆ°gitlabæœåŠ¡å™¨ä¸Šè¿›è¡Œè„šæœ¬çš„æ‰§è¡Œ;</li>
</ul>
<p>å…³é”®æ€§é…ç½®æ–‡ä»¶å¤‡ä»½:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/gitlab/gitlab.rb é…ç½®æ–‡ä»¶é¡»å¤‡ä»½</span><br><span class="line">/var/opt/gitlab/nginx/conf nginxé…ç½®æ–‡ä»¶</span><br><span class="line">/etc/postfix/main.cfpostfix é‚®ä»¶é…ç½®å¤‡ä»½</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>æœ¬åœ°å¤‡ä»½</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.GitLabå¤‡ä»½çš„é»˜è®¤ç›®å½•æ˜¯ </span></span><br><span class="line">/var/opt/gitlab/backups </span><br><span class="line"></span><br><span class="line"><span class="comment">#2.ä¿®æ”¹æ”¹å¤‡ä»½ç›®å½•</span></span><br><span class="line"><span class="variable">$vim</span> /etc/gitlab/gitlab.rb</span><br><span class="line">gitlab_rails[<span class="string">'manage_backup_path'</span>] = <span class="literal">false</span>   <span class="comment"># å¦‚ä¸éœ€è¿œç¨‹æ¥æ‰‹åŠ¨ç®¡ç†å¤‡ä»½åˆ™è®¾ç½®ä¸ºfalse</span></span><br><span class="line">gitlab_rails[<span class="string">'backup_path'</span>] = <span class="string">'/home/backups'</span></span><br><span class="line">gitlab_rails[<span class="string">'backup_keep_time'</span>] = 604800    <span class="comment"># å¤‡ä»½ä¿ç•™7å¤© 2419200</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3.ä¿®æ”¹é…ç½®åé‡è½½é…ç½®</span></span><br><span class="line"><span class="variable">$gitlab</span>-ctl reconfigure</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.æ‰§è¡Œå¤‡ä»½å‘½ä»¤</span></span><br><span class="line"><span class="variable">$gitlab</span>-rake gitlab:backup:create </span><br><span class="line"><span class="comment"># 2020-04-16 09:44:52 +0800 -- Dumping database ...</span></span><br><span class="line"><span class="comment"># Dumping PostgreSQL database gitlabhq_production ... [DONE]</span></span><br><span class="line"><span class="comment"># 2020-04-16 09:44:53 +0800 -- done</span></span><br><span class="line"><span class="comment"># 2020-04-16 09:44:53 +0800 -- Dumping repositories ...</span></span><br><span class="line"><span class="comment"># 2020-04-16 09:44:53 +0800 -- done</span></span><br><span class="line"><span class="comment"># 2020-04-16 09:44:53 +0800 -- Dumping uploads ...</span></span><br><span class="line"><span class="comment"># 2020-04-16 09:44:53 +0800 -- done</span></span><br><span class="line"><span class="comment"># 2020-04-16 09:44:53 +0800 -- Dumping builds ...</span></span><br><span class="line"><span class="comment"># 2020-04-16 09:44:53 +0800 -- done</span></span><br><span class="line"><span class="comment"># 2020-04-16 09:44:53 +0800 -- Dumping artifacts ...</span></span><br><span class="line"><span class="comment"># 2020-04-16 09:44:53 +0800 -- done</span></span><br><span class="line"><span class="comment"># 2020-04-16 09:44:53 +0800 -- Dumping pages ...</span></span><br><span class="line"><span class="comment"># 2020-04-16 09:44:53 +0800 -- done</span></span><br><span class="line"><span class="comment"># 2020-04-16 09:44:53 +0800 -- Dumping lfs objects ...</span></span><br><span class="line"><span class="comment"># 2020-04-16 09:44:53 +0800 -- done</span></span><br><span class="line"><span class="comment"># 2020-04-16 09:44:53 +0800 -- Dumping container registry images ...</span></span><br><span class="line"><span class="comment"># 2020-04-16 09:44:53 +0800 -- [DISABLED]</span></span><br><span class="line"><span class="comment"># Creating backup archive: 1587001493_2020_04_16_12.9.2_gitlab_backup.tar ... done</span></span><br><span class="line"><span class="comment"># Uploading backup archive to remote storage  ... skipped</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#5.æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶,å‹ç¼©åŒ…åŒ…æ‹¬GitLabæ•´ä¸ªçš„å®Œæ•´éƒ¨åˆ†,å¤§æ¦‚æ ¼å¼xxxxxxxx_gitlab_backup.tar</span></span><br><span class="line"><span class="variable">$ls</span> /var/opt/gitlab/backups</span><br><span class="line">1587001493_2020_04_16_12.9.2_gitlab_backup.tar</span><br></pre></td></tr></table></figure></p>
<p><strong>è¡¥å……è¯´æ˜:</strong></p>
<ul>
<li>(1) é€šè¿‡ä»»åŠ¡è®¡åˆ’crontab å®ç°è‡ªåŠ¨å¤‡ä»½<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯å¤©å‡Œæ™¨ä¸¤ç‚¹è¿›è¡Œä¸€æ¬¡è‡ªåŠ¨å¤‡ä»½;</span></span><br><span class="line">sudo crontab -e  </span><br><span class="line">0 2 * * * /opt/gitlab/bin/gitlab-rake gitlab:backup:create</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡å¯æœåŠ¡</span></span><br><span class="line">systemctl restart crond</span><br></pre></td></tr></table></figure></li>
<li>(2) å€¼å¾—æ³¨æ„çš„æ˜¯ç”±äº<code>gitlab.rb and gitlab-secrets.json</code>åŒ…å«æ•æ„Ÿæ•°æ®ï¼Œé‡‡ç”¨ä¸Šé¢å¤‡ä»½çš„å½¢å¼ä¸èƒ½å°†å®ƒä»¬è¿›è¡Œå¤‡ä»½ï¼Œåªèƒ½é€šè¿‡<code>æ‰‹åŠ¨å¤‡ä»½</code>çš„æ–¹å¼;<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Warning: Your gitlab.rb and gitlab-secrets.json files contain sensitive data</span><br><span class="line">and are not included <span class="keyword">in</span> this backup. You will need these files to restore a backup.</span><br><span class="line">Please back them up manually.</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<p><strong>è¿œç¨‹å¤‡ä»½</strong><br>æè¿°:å®é™…ä¸Šå°±æ˜¯åœ¨gitlabæœåŠ¡å™¨ä¸Šæ·»åŠ å¤‡ä»½æœåŠ¡å™¨çš„pubå…¬é’¥ï¼Œç„¶åå¤‡ä»½æœåŠ¡å™¨è®¿é—®GitlabæœåŠ¡å™¨è¿›è¡Œæ‹‰å–ï¼Œå½“ç„¶æ‚¨ä¹Ÿå¯ä»¥é‡‡ç”¨rsyncè¿›è¡Œå¤‡ä»½ï¼›<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å‡è®¾ç¯å¢ƒå¦‚ä¸‹:</span></span><br><span class="line"><span class="comment">#å¤‡ä»½æœåŠ¡å™¨: 192.168.1.2</span></span><br><span class="line"><span class="comment">#GitLabæœåŠ¡å™¨: 192.168.1.250</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#1.å¤‡ä»½æœåŠ¡å™¨åˆ›å»ºauthorized_keysæ–‡ä»¶</span></span><br><span class="line">mkdir -p /root/.ssh</span><br><span class="line">touch /root/.ssh/authorized_keys </span><br><span class="line">chmod 400 /root/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.GitlabæœåŠ¡å™¨ç”Ÿæˆrsaå…¬é’¥å¹¶å°†è¯ä¹¦ä¸Šä¼ åˆ°å¤‡ä»½æœåŠ¡å™¨ï¼ˆå®é™…ç¯å¢ƒä¸­å»ºè®®æœ€å°æƒé™ç”¨æˆ·ï¼‰</span></span><br><span class="line"><span class="variable">$ssh</span>-keygen -t rsa -C <span class="string">"gitlab@weiyigeek.top"</span></span><br><span class="line"><span class="comment"># Enter file in which to save the key (/root/.ssh/id_rsa):  æŠ¥é”™è·¯å¾„</span></span><br><span class="line"><span class="comment"># Enter passphrase (empty for no passphrase): å…¬é’¥å¯†ç </span></span><br><span class="line"><span class="comment"># Enter same passphrase again: éªŒè¯å¯†ç </span></span><br><span class="line"><span class="comment"># Your public key has been saved in /root/.ssh/id_rsa.pub. #ä¿å­˜è·¯å¾„</span></span><br><span class="line"><span class="comment"># The key fingerprint is:</span></span><br><span class="line"><span class="comment"># SHA256:YahioDs7XZ9No********RS9jWX1NNXo04i4ZHOLY WeiyiGeek@weiyigeek.top</span></span><br><span class="line"><span class="comment"># The key's randomart image is:</span></span><br><span class="line"><span class="comment"># +---[RSA 2048]----+</span></span><br><span class="line"><span class="comment"># |         .   . ++|</span></span><br><span class="line"><span class="comment"># |       .+ . o o.+|</span></span><br><span class="line"><span class="comment"># |.    o.oo= . +  .|</span></span><br><span class="line"><span class="comment"># |..  ..=.E.+ +    |</span></span><br><span class="line"><span class="comment"># |o o..+ oS= . .   |</span></span><br><span class="line"><span class="comment"># |.=+.+ o . .      |</span></span><br><span class="line"><span class="comment"># |+*.. = +         |</span></span><br><span class="line"><span class="comment"># |oo= o o .        |</span></span><br><span class="line"><span class="comment"># |.o.+             |</span></span><br><span class="line"><span class="comment"># +----[SHA256]-----+</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$ls</span> /root/.ssh/</span><br><span class="line">id_rsa  id_rsa.pub</span><br><span class="line"></span><br><span class="line"><span class="variable">$scp</span> /root/.ssh/id_rsa.pub root@192.168.1.2:/root/.ssh/</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.å¤‡ä»½æœåŠ¡å™¨å°†id_rsa.pubæ–‡ä»¶å†…å®¹è¿½åŠ åˆ°authorized_keys æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”ä¿®æ”¹authorized_keysæ–‡ä»¶çš„æƒé™</span></span><br><span class="line"><span class="variable">$cat</span> /root/.ssh/id_rsa.pub &gt;&gt; /root/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.gitlabå¤‡ä»½è„šæœ¬(ä¸»è¦æ‰§è¡Œæƒé™å‘¼å)å°†å¤‡ä»½æ–‡ä»¶æ‹·è´åˆ°æœåŠ¡å™¨ç«¯</span></span><br><span class="line"><span class="variable">$cat</span> &gt; /home/gitlab/auto_backup_to_remote.sh&lt;&lt;<span class="string">'END'</span></span><br><span class="line">DATE=`date +<span class="string">"%Y_%m_%d"</span>`</span><br><span class="line">BackupIP=192.168.1.2</span><br><span class="line">BackupUser=root</span><br><span class="line">BackupPATH=/var/opt/gitlab/backups</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ é™¤æœ¬åœ°7å¤©å‰å¾—å¤‡ä»½</span></span><br><span class="line">find <span class="variable">$&#123;BackupPATH&#125;</span> -<span class="built_in">type</span> f -mtime +7 -name <span class="string">'*.tar'</span> -<span class="built_in">exec</span> rm &#123;&#125; \;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœä¸éœ€è¦å¤‡ä»½æ–‡ä»¶æ‚¨ä¹Ÿå¯ä»¥å¤‡ä»½ä»“æˆ¿ç›®å½•</span></span><br><span class="line">find <span class="variable">$&#123;BackupPATH&#125;</span> -name *<span class="variable">$&#123;DATE&#125;</span>* -<span class="built_in">exec</span> scp -r &#123;&#125; <span class="variable">$&#123;root&#125;</span>@<span class="variable">$&#123;BackupIP&#125;</span>:/tmp/ \;</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line"><span class="variable">$chmod</span> +x /home/gitlab/auto_backup_to_remote.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#5.æ·»åŠ å®šæ—¶è®¡åˆ’(æ¯å¤©å‡Œæ™¨1ç‚¹æ‰§è¡Œ)ï¼Œé‡å¯crondæœåŠ¡</span></span><br><span class="line">cat &gt;&gt; /etc/crontab &lt;&lt;ENDtop</span><br><span class="line">0 1 * * * /home/gitlab/auto_backup_to_remote.sh</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line">systemctl restart crond</span><br></pre></td></tr></table></figure></p>
<p>PS : åœ¨Docker å®¹å™¨ä¸­åˆ©ç”¨execå‘½ä»¤æ‰§è¡Œå¤‡ä»½å‘½ä»¤<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it gitlab-server sh -c <span class="string">"/opt/gitlab/bin/gitlab-rake gitlab:backup:create"</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>Gitlabæ¢å¤</strong><br>æ¯”å¦‚:ä¸Šé¢æˆ‘ä»¬å¾—å¤‡ä»½:<code>/var/opt/gitlab/backups/1587001493_2020_04_16_12.9.2_gitlab_backup.tar</code>;<br>æ“ä½œæµç¨‹å¦‚ä¸‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åœæ­¢ç›¸å…³æ•°æ®è¿æ¥æœåŠ¡ï¼ˆä¿è¯æ•°æ®åº“æ²¡æœ‰æ–°çš„è¿æ¥ä¸ä¼šæœ‰å†™æ•°æ®æƒ…å†µï¼‰</span></span><br><span class="line">gitlab-ctl stop unicorn</span><br><span class="line">gitlab-ctl stop sidekiq</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šæ¢å¤æ–‡ä»¶ä¼šè‡ªåŠ¨å»å¤‡ä»½ç›®å½•æ‰¾æ ¼å¼`1587001493_2020_04_16_12.9.2`</span></span><br><span class="line"><span class="comment"># æ³¨æ„ä¸åŠ _gitlab_backup.tar</span></span><br><span class="line"><span class="built_in">cd</span> /var/opt/gitlab/backups/ &amp;&amp; chmod -R 777 *</span><br><span class="line">gitlab-rake gitlab:backup:restore BACKUP=1587001493_2020_04_16_12.9.2</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨Gitlab</span></span><br><span class="line">gitlab-ctl restart</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>Gitlabè¿ç§»</strong><br>æè¿°: è¿ç§»å¦‚åŒå¤‡ä»½ä¸æ¢å¤çš„æ­¥éª¤ä¸€æ ·, åªéœ€è¦å°†è€æœåŠ¡å™¨<code>/var/opt/gitlab/backupsç›®å½•ä¸‹çš„å¤‡ä»½æ–‡ä»¶æ‹·è´åˆ°æ–°æœåŠ¡å™¨ä¸Šçš„/var/opt/gitlab/backups</code>å³å¯(å¦‚æœä½ æ²¡ä¿®æ”¹è¿‡é»˜è®¤å¤‡ä»½ç›®å½•çš„è¯).</p>
<p style="color:red"> PS : ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯æ–°æœåŠ¡å™¨ä¸Šçš„Gitlabçš„ç‰ˆæœ¬å¿…é¡»ä¸åˆ›å»ºå¤‡ä»½æ—¶çš„Gitlabç‰ˆæœ¬å·ç›¸åŒ. æ¯”å¦‚æ–°æœåŠ¡å™¨å®‰è£…çš„æ˜¯æœ€æ–°çš„10.8.3ç‰ˆæœ¬çš„Gitlabé‚£ä¹ˆè¿ç§»ä¹‹å‰, æœ€å¥½å°†è€æœåŠ¡å™¨çš„Gitlabå‡çº§ä¸º10.8.3ï¼ŒåŸºäºæœ€æ–°ç‰ˆæœ¬çš„çŠ¶æ€åœ¨è¿›è¡Œå¤‡ä»½ã€‚ </p>

<p>å…³é”®æ–‡ä»¶:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/gitlab/gitlab.rb <span class="comment">#gitlab é…ç½®æ–‡ä»¶é¡»è¿ç§»,è¿ç§»åéœ€è¦è°ƒæ•´æ•°æ®å­˜æ”¾ç›®å½•</span></span><br><span class="line">/var/opt/gitlab/nginx/conf <span class="comment">#nginx é…ç½®æ–‡ä»¶ç›®å½•é¡»è¿ç§»</span></span><br></pre></td></tr></table></figure></p>
<p>å°†æ—§æœºå™¨ä¸Šçš„å¤‡ä»½æ–‡ä»¶åŒæ­¥è¿‡æ¥åçš„æ“ä½œæ­¥éª¤:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl stop unicorn</span><br><span class="line"><span class="comment"># ok: down: unicorn: 0s, normally up</span></span><br><span class="line">gitlab-ctl stop sidekiq</span><br><span class="line"><span class="comment"># ok: down: sidekiq: 0s, normally up</span></span><br><span class="line">chmod 777 /var/opt/gitlab/backups/1528102291_2018_06_04_10.8.3_gitlab_backup.tar</span><br><span class="line">gitlab-rake gitlab:backup:restore BACKUP=1528102291_2018_06_04_10.8.3</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>Gitlabå‡çº§</strong><br>1.å…³é—­gitlabæœåŠ¡<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl stop unicorn</span><br><span class="line">gitlab-ctl stop sidekiq</span><br><span class="line">gitlab-ctl stop nginx</span><br></pre></td></tr></table></figure></p>
<p>2.å¤‡ä»½gitlab<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-rake gitlab:backup:create</span><br></pre></td></tr></table></figure></p>
<p>3.ä¸‹è½½gitlabçš„RPMåŒ…å¹¶è¿›è¡Œå‡çº§<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//ç›´æ¥å®‰è£…é«˜ç‰ˆæœ¬</span><br><span class="line">yum install gitlab-ce-8.12.13-ce.0.el7.x86_64</span><br><span class="line"></span><br><span class="line">//æŠ¥é”™.</span><br><span class="line">Error executing action `run` on resource <span class="string">'ruby_block[directory resource: /var/opt/gitlab/git-data/repositories]'</span></span><br><span class="line"></span><br><span class="line">//è§£å†³æ–¹æ³•:</span><br><span class="line">chmod 2770 /var/opt/gitlab/git-data/repositories</span><br></pre></td></tr></table></figure></p>
<p>4.å¯åŠ¨å¹¶æŸ¥çœ‹gitlabç‰ˆæœ¬ä¿¡æ¯<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl reconfigure</span><br><span class="line">gitlab-ctl restart</span><br><span class="line">head -1 /opt/gitlab/version-manifest.txt</span><br><span class="line">gitlab-ce 10.8.3</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="Gitlabæ›´æ”¹é»˜è®¤Nginx"><a href="#Gitlabæ›´æ”¹é»˜è®¤Nginx" class="headerlink" title="Gitlabæ›´æ”¹é»˜è®¤Nginx"></a>Gitlabæ›´æ”¹é»˜è®¤Nginx</h3><p>æè¿°: æ›´æ¢gitlabè‡ªå¸¦Nginx, ä½¿ç”¨è‡ªè¡Œå®‰è£…çš„Nginxæ¥ç®¡ç†gitlabæœåŠ¡ã€‚</p>
<p>1.ç¼–è¾‘gitlabé…ç½®æ–‡ä»¶ç¦ç”¨è‡ªå¸¦NignxæœåŠ¡å™¨<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/gitlab/gitlab.rb</span><br><span class="line">...</span><br><span class="line"><span class="comment">#è®¾ç½®nginxä¸ºfalse,å…³é—­è‡ªå¸¦Nginx</span></span><br><span class="line">nginx[<span class="string">'enable'</span>] = <span class="literal">false</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>2.æ£€æŸ¥é»˜è®¤nginxé…ç½®æ–‡ä»¶ï¼Œå¹¶è¿ç§»è‡³æ–°NginxæœåŠ¡<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/var/opt/gitlab/nginx/conf/nginx.conf          <span class="comment">#nginxé…ç½®æ–‡ä»¶,åŒ…å«gitlab-http.confæ–‡ä»¶</span></span><br><span class="line">/var/opt/gitlab/nginx/conf/gitlab-http.conf    <span class="comment">#gitlabæ ¸å¿ƒnginxé…ç½®æ–‡ä»¶</span></span><br></pre></td></tr></table></figure></p>
<p>3.é‡å¯nginxã€gitlabæœåŠ¡<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab-ce ~]<span class="comment"># gitlab-ctl reconfigure</span></span><br><span class="line">[root@gitlab-ce ~]<span class="comment"># systemctl start nginx</span></span><br></pre></td></tr></table></figure></p>
<p>å¼‚å¸¸è§£å†³: è®¿é—®æŠ¥ 502 åŸå› æ˜¯nginxç”¨æˆ·æ— æ³•è®¿é—® gitlab ç”¨æˆ·çš„socketæ–‡ä»¶,æ­¤æ—¶éœ€è¦é‡å¯gitlabå¹¶éœ€è¦é‡æ–°æˆæƒ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod -R o+x /var/opt/gitlab/gitlab-rails</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="0x05-å…¥å‘è§£å†³"><a href="#0x05-å…¥å‘è§£å†³" class="headerlink" title="0x05 å…¥å‘è§£å†³"></a>0x05 å…¥å‘è§£å†³</h2><p><strong>(0) ç”¨æˆ·pullä¸pushä»£ç åˆ°gitlabå¸¸è§é”™è¯¯</strong></p>
<ul>
<li>é”™è¯¯1:<code>The requested URL returned error: 403</code><ul>
<li>åŸå› :è¡¨ç¤ºæˆ‘ä»¬æ²¡æœ‰æƒé™æ¥pull/pushç›¸å…³ä»£ç éœ€è¦ä¿®æ”¹ç›¸å…³gitlabè´¦å·çš„æƒé™ä¸º<code>Developmentæˆ–è€…Maintianer</code>;</li>
</ul>
</li>
<li>é”™è¯¯2:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">To gitlab.weiyigeek.top:newproject/secopsdev.git</span><br><span class="line"> ! [remote rejected] master -&gt; master (pre-receive hook declined)</span><br><span class="line">error: failed to push some refs to <span class="string">'git@gitlab.weiyigeek.top:newproject/secopsdev.git'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>åŸå› :ç”±äºä¸Šä¼ ä»£ç çš„gitlabç”¨æˆ·æƒé™ä¸ºå¼€å‘è€…è€Œé»˜è®¤åˆ›å»ºçš„æ˜¯ç§æœ‰çš„é¡¹ç›®ï¼Œé»˜è®¤æ˜¯å¯¹masteråˆ†æ”¯å¼€å¯äº†ä¿æŠ¤æœºåˆ¶ï¼Œéœ€è¦å¯¹å…¶é¡¹ç›®çš„Branchåˆ†æ”¯è®¾ç½® <code>Allowed to merge | Allowed to push</code>ä¸ºDevelopment+Maintiner;<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æœ€ç»ˆä¸»åˆ†æ”¯ä»¥åŠdevåˆ†æ”¯éƒ½æµ‹è¯•ä¸Šæ¬¡æˆåŠŸ</span></span><br><span class="line">remote:</span><br><span class="line">To gitlab.weiyigeek.top:newproject/secopsdev.git</span><br><span class="line"> * [new branch]      dev -&gt; dev</span><br><span class="line">Branch <span class="string">'dev'</span> <span class="built_in">set</span> up to track remote branch <span class="string">'dev'</span> from <span class="string">'origin'</span>.</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p><br/></p>
<p><strong>(1) gitlabå¯†ç å¿˜è®°æ‰¾å›é‡ç½®æ–¹æ³•</strong></p>
<ul>
<li><p>æ–¹å¼1:é€šè¿‡gitlab-railsè¿›è¡Œé‡ç½®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$gitlab</span>-rails console </span><br><span class="line">Loading production environment (Rails 6.0.2)</span><br><span class="line">&gt; u=User.where(id:1).first        <span class="comment">#è¿™ä¸ªæ˜¯ç®¡ç†å‘˜çš„ï¼Œä¹Ÿå¯ä»¥ç”¨emailç­‰</span></span><br><span class="line">&gt; u.password = <span class="string">'your_password'</span>    <span class="comment">#å¯†ç æœ‰æ ¼å¼é™åˆ¶ï¼Œæˆ‘åªçŸ¥é“8ä½ä»¥ä¸Šå¦åˆ™ä¼šä¿å­˜å¤±è´¥</span></span><br><span class="line">&gt; u.password_confirmation = <span class="string">'your_password'</span></span><br><span class="line">&gt; u.save</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ–¹å¼2:é€šè¿‡åˆå§‹åŒ–è®¾ç½®é‚®ä»¶è¿›è¡Œæ‰¾å›ç®¡ç†å‘˜æˆ–è€…åœ¨æœ¬åœ° postfix ä¸­æŸ¥çœ‹æœªå‘é€å¾—é‚®ä»¶ï¼Œæ­¤å¤„ä»¥rootç”¨æˆ·çš„<a href="mailto:admin@example.com">admin@example.com</a>ä¸ºä¾‹ï¼Œä¸€èˆ¬é»˜è®¤éƒ½æ²¡æ”¹(åªæ˜¯ä¸€ç§æ–¹å¼å®é™…ä¸­æ²¡å¤šå¤§æ„ä¹‰);</p>
</li>
</ul>
<p>æ­¤å¤„å‡è®¾æœåŠ¡ä¸èƒ½é“¾æ¥åˆ°å¤–ç½‘ä¹‹ä¸­(ä¸ºäº†å¤ç°ä¸‹åˆ—æ“ä½œ);<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ï¼ˆ1ï¼‰æŸ¥çœ‹æ— æ³•å‘é€å‡ºå»çš„é‚®ä»¶é˜Ÿåˆ—</span></span><br><span class="line"><span class="variable">$postqueue</span> -p</span><br><span class="line">-Queue ID-  --Size-- ----Arrival Time---- -Sender/Recipient-------</span><br><span class="line"><span class="comment">#å› ä¸ºä¸å­˜åœ¨æ­¤åœ°å€å°±æ— æ³•å‘é€å‡ºå»ï¼Œåªèƒ½åœç•™åœ¨é‚®ä»¶çš„åˆ—é˜Ÿä¸­ã€‚</span></span><br><span class="line">908DCCAC62     6871 Wed Apr 15 19:54:32  gitlab@gitlab.weiyigeek.top <span class="comment">#(å®é™…å°±æ˜¯æˆ‘ä»¬æ‰¾å›å¯†ç é‚®ä»¶)</span></span><br><span class="line">(Host or domain name not found. Name service error <span class="keyword">for</span> name=example.com <span class="built_in">type</span>=MX: Host not found, try again)</span><br><span class="line">admin@example.com</span><br><span class="line"></span><br><span class="line"><span class="comment">#ï¼ˆ2ï¼‰é‚®ä»¶é˜Ÿåˆ—å­˜å‚¨ä½ç½®</span></span><br><span class="line"><span class="variable">$postconf</span> -d | grep queue_directory  <span class="comment">#é»˜è®¤æƒ…å†µä¸‹æ˜¯æ²¡æœ‰ä¿®æ”¹çš„</span></span><br><span class="line">queue_directory = /var/spool/postfix</span><br><span class="line"></span><br><span class="line"><span class="comment">#ï¼ˆ3ï¼‰è¿›åˆ°ç›®å½•ä¸‹ï¼ŒæŸ¥æ‰¾ä¸Šé¢é‚£å°é‚®ä»¶çš„é˜Ÿåˆ—IDå·</span></span><br><span class="line"><span class="variable">$find</span> /var/spool/postfix/ -name 908DCCAC62</span><br><span class="line">/var/spool/postfix/defer/9/908DCCAC62</span><br><span class="line">/var/spool/postfix/deferred/9/908DCCAC62</span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) åˆ©ç”¨postfixè‡ªå¸¦çš„å·¥å…·æŸ¥çœ‹é‚®ä»¶çš„å†…å®¹ï¼Œæ‰¾åˆ°ä¿®æ”¹å¯†ç çš„åœ°</span></span><br><span class="line"><span class="variable">$postcat</span> /var/spool/postfix/deferred/9/908DCCAC62</span><br><span class="line">*** ENVELOPE RECORDS /var/spool/postfix/deferred/9/908DCCAC62 ***</span><br><span class="line">message_size:            6871             274               1               0            6871               0</span><br><span class="line">message_arrival_time: Wed Apr 15 19:54:32 2020</span><br><span class="line">create_time: Wed Apr 15 19:54:32 2020</span><br><span class="line">named_attribute: rewrite_context=<span class="built_in">local</span></span><br><span class="line">sender: gitlab@gitlab.weiyigeek.top</span><br><span class="line">named_attribute: dsn_orig_rcpt=rfc822;admin@example.com</span><br><span class="line">original_recipient: admin@example.com</span><br><span class="line">.....</span><br><span class="line">If you did not perform this request, you can safely ignore this email.</span><br><span class="line">Otherwise, click the link below to complete the process:</span><br><span class="line"><span class="comment">#æ‰¾åˆ°å¦‚ä¸‹å¯†ç ä¿®æ”¹è¿æ¥ï¼Œå¹¶å°†å…¶å¤åˆ¶å‡ºæ¥åˆ°æµè§ˆå™¨ä¸­é‡ç½®å¯†ç </span></span><br><span class="line">http://gitlab.weiyigeek.top/users/password/edit?reset_password_token=gd9MyL7FaSt5R2F3_qA_</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415201032.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415201032.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure>
<p><br/></p>
<p><strong>(2)GitLabæ•°æ®åº“å¼•èµ·çš„502é”™è¯¯é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</strong><br>æè¿°:æ‰“å¼€GitLabçš„ä¸»é¡µåœ°å€http:/gitlab.weiyigeek.top/æŠ¥é”™502,é‡å¯æˆ–æ£€æŸ¥çŠ¶æ€å‘ç°éƒ½æ­£å¸¸<code>sudo gitlab-ctl status</code>,å¹¶ä¸”æ£€æŸ¥äº†ç«¯å£å·å¹¶æ²¡è¢«å ç”¨,æ£€æŸ¥åˆ·æ–°é…ç½®<code>gitlab-ctl reconfigure</code>å‘ç°äº†é”™è¯¯;</p>
<p>é”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#gitlab-ctl reconfigure </span></span><br><span class="line">Running handlers:</span><br><span class="line">There was an error running gitlab-ctl reconfigure:</span><br><span class="line"></span><br><span class="line">bash[migrate gitlab-rails database] (gitlab::database_migrations line 51) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to <span class="built_in">exit</span> with [0], but received <span class="string">'1'</span></span><br><span class="line">---- Begin output of <span class="string">"bash"</span>  <span class="string">"/tmp/chef-script20190308-65247-12ck9rp"</span> ----</span><br><span class="line">STDOUT: rake aborted!</span><br><span class="line">PG::ConnectionBad: could not connect to server: No such file or directory</span><br><span class="line"> Is the server running locally and accepting</span><br><span class="line"> connections on Unix domain socket <span class="string">"/var/opt/gitlab/postgresql/.s.PGSQL.5432"</span>?</span><br><span class="line">/opt/gitlab/embedded/service/gitlab-rails/lib/tasks/gitlab/db.rake:52:<span class="keyword">in</span> `block (3 levels) <span class="keyword">in</span> &lt;top (required)&gt;</span><br><span class="line">/opt/gitlab/embedded/bin/bundle:23:<span class="keyword">in</span> `load<span class="string">'</span></span><br><span class="line"><span class="string">/opt/gitlab/embedded/bin/bundle:23:in `&lt;main&gt;'</span></span><br><span class="line">Tasks: TOP =&gt; gitlab:db:configure</span><br><span class="line">(See full trace by running task with --trace)</span><br><span class="line">STDERR:</span><br><span class="line">---- End output of <span class="string">"bash"</span>  <span class="string">"/tmp/chef-script20190308-65247-12ck9rp"</span> ----</span><br><span class="line">Ran <span class="string">"bash"</span>  <span class="string">"/tmp/chef-script20190308-65247-12ck9rp"</span> returned 1</span><br><span class="line"></span><br><span class="line"><span class="comment">#gitlab-ctl tail</span></span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415221141.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200415221141.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure>
<p><br></p>
<p><strong>(3) gitlab-ceç‰ˆæœ¬å‡çº§è®°å½•</strong><br>æˆ‘ä»¬ä¸ºäº†ä¿è¯æ•°æ®å®‰å…¨ï¼Œä¸€æ­¥æ­¥æ¥æ…¢æ…¢å‡çº§,ä½¿ç”¨å®˜æ–¹çš„æºå¯èƒ½æ¯”è¾ƒæ…¢ï¼Œå¯ä»¥ä½¿ç”¨å›½å†…çš„æºï¼ˆé‡‡ç”¨Omnibusæ–¹å¼è¿›è¡Œå‡çº§ç›´æ¥rpmåŒ…éƒ¨ç½²ï¼‰ï¼š<a href="https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum</a> </p>
<p>å‡çº§æ–¹æ³•ï¼šå…ˆå‡çº§åˆ°å½“å‰å¤§ç‰ˆæœ¬æœ€åä¸€ç‰ˆ(è¿™é‡Œæ˜¯æˆ‘çš„å»ºè®®ï¼Œä¸€èˆ¬å·®ä¸å¤šæœ€åå‡ ç‰ˆå°±å¯ä»¥äº†)ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è·¨å¤§ç‰ˆæœ¬çš„å‡çº§ï¼Œå…ˆä»å¤§ç‰ˆæœ¬çš„ä½ç‰ˆå‡çº§ï¼Œå†åˆ°æœ€åç‰ˆæœ¬å‡çº§ï¼Œä»¥æ­¤ç±»æ¨ï¼› å› ä¸ºæˆ‘ä¸­é—´å°è¯•è¿‡ç›´æ¥è·¨å¤ªå¤šä¸ªç‰ˆæœ¬å‡çº§ï¼Œå‡ºç°è¿‡å¼‚å¸¸ï¼Œå…¶å®ä¸»è¦æ˜¯æ•°æ®åº“çš„æ•°æ®å¯¼å…¥å¤‡ä»½é—®é¢˜ï¼Œå¦‚æœæ–°ç‰ˆæœ¬è·Ÿæ—§ç‰ˆç›¸å…³å¤ªå¤§çš„è¯å°±ä¼šæŠ¥é”™äº†ã€‚</p>
<p>æ¯”å¦‚æˆ‘çš„å‡çº§è¿‡ç¨‹å¾ˆé•¿ï¼ŒåŒæ—¶ä¹Ÿåšäº†ç®€å•çš„æµ‹è¯•<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å‡çº§ç‰ˆæœ¬</span></span><br><span class="line">8.3.1--&gt;8.3.7--&gt;8.8.5--&gt;8.17.4--&gt;9.5.6--&gt;10.0.6--&gt;10.8.5--&gt;11.0.3</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœæ­¢æœåŠ¡</span></span><br><span class="line">gitlab-ctl stop unicorn</span><br><span class="line">gitlab-ctl stop sidekiq</span><br><span class="line">gitlab-ctl stop nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ›å»ºæ•°æ®å¤‡ä»½ï¼Œé˜²æ­¢æ›´æ–°å¤±è´¥(éå¸¸é‡è¦)</span></span><br><span class="line">gitlab-rake gitlab:backup:create</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®‰è£…å‡çº§åŒ…</span></span><br><span class="line"><span class="comment">#yum update gitlab-ce # å‡çº§GitLab-ce ç‰ˆæœ¬(ä¸å»ºè®®é‡‡ç”¨æ­¤ç§æ–¹å¼)</span></span><br><span class="line">rpm -Uvh gitlab-7.4.2_omnibus-1.el6.x86_64.rpm </span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡æ–°åŠ è½½é…ç½®&amp;é‡å¯GitlabæœåŠ¡</span></span><br><span class="line">gitlab-ctl reconfigure</span><br><span class="line">gitlab-ctl restart</span><br></pre></td></tr></table></figure><br>æ¯”å¦‚ï¼šé¡¹ç›®å¤‡ä»½çš„æ•°æ®çš„æ˜¯å¦æœ‰å¼‚å¸¸ï¼Œç”¨æˆ·ä¿¡æ¯ï¼Œå“åº”é€Ÿåº¦ç­‰ç­‰ï¼Œä¸ªäººè®¤ä¸ºè¿˜æ˜¯æ¯”è¾ƒé æ™®çš„ã€‚</p>
<p>å…¶å®åªè¦æˆ‘ä»¬ä¹‹å‰æœ‰å‡çº§è¿‡å°±ä¸ä¼šç°åœ¨è¿™æ ·äº†ï¼Œä¸€ä¸‹å­ä»è¿™ä¹ˆä½çš„ç‰ˆæœ¬å‡çº§ä¸Šæ¥ã€‚ä¸€èˆ¬å»ºè®®ä¿æŒåœ¨ç›¸åŒçš„å¤§ç‰ˆæœ¬å·å°±å¥½äº†ã€‚å¤ªæ–°å¯èƒ½ä¹Ÿä¼šæœ‰Bugï¼Œå¤ªæ—§äº†ä¹Ÿä¼šæœ‰å¾ˆå¤šå†å²é—ç•™çš„é—®é¢˜ã€‚</p>
<p>å‡çº§å®Œæˆåä½ ä¼šå‘ç°å¤šäº†å¥½å‡ ä¸ªè¿›ç¨‹ã€‚å¯èƒ½ä¼šå¯¹ç³»ç»Ÿç¡¬ä»¶è¦æ±‚æ›´é«˜äº†ï¼Œæ¯”å¦‚å†…å­˜ä¼šè¦æ±‚æ›´é«˜äº†ã€‚<br>å»ºè®®ï¼šå¦‚æœéå¿…è¦çš„åŠŸèƒ½éœ€æ±‚ï¼Œåªæ˜¯ç®€å•çš„è¦ä¸€ä¸ªä»£ç ä»“åº“çš„è¯ï¼Œä¸ªäººå»ºç«‹ä½¿ç”¨åœ¨<code>11.x.-12.3.x</code>ä¹‹é—´ä¹Ÿä¸é”™äº†ã€‚</p>
<p><br></p>
<p><strong>(4) gitlab-rails databaseåˆå§‹åŒ–å¤±è´¥</strong><br>ç¯å¢ƒè¯´æ˜<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Centos7: 3.10.0-327.el7.x86_64</span><br><span class="line">gitlabç‰ˆæœ¬ï¼šåŸæ¥æ˜¯8.8.5ç‰ˆæœ¬ç°å‡çº§åˆ°è¾ƒæ–°çš„ç‰ˆæœ¬;</span><br></pre></td></tr></table></figure></p>
<p>é—®é¢˜ï¼šåœ¨åŒä¸€å°Centos7æœºå™¨ä¸Šå¸è½½äº†æ—§ç‰ˆæœ¬çš„gitlabåï¼Œæ¥ç€åˆé‡æ–°å®‰è£…æ–°ç‰ˆæœ¬çš„gitlab-ce åœ¨å®‰è£…å®Œåä¿®æ”¹é…ç½®ï¼Œåˆå§‹åŒ–é…ç½®æ—¶å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Running handlers:</span><br><span class="line">There was an error running gitlab-ctl reconfigure:</span><br><span class="line"></span><br><span class="line">bash[migrate gitlab-rails database] (gitlab::database_migrations line 49) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to <span class="built_in">exit</span> with [0], but received <span class="string">'1'</span></span><br><span class="line">---- Begin output of <span class="string">"bash"</span>  <span class="string">"/tmp/chef-script20190628-7065-vx17en"</span> ----</span><br><span class="line">STDOUT: rake aborted!</span><br><span class="line">PG::ConnectionBad: could not connect to server: No such file or directory</span><br><span class="line">    Is the server running locally and accepting</span><br><span class="line">    connections on Unix domain socket <span class="string">"/var/opt/gitlab/postgresql/.s.PGSQL.5432"</span>?</span><br><span class="line">/opt/gitlab/embedded/service/gitlab-rails/lib/tasks/gitlab/db.rake:49:<span class="keyword">in</span> `block (3 levels) <span class="keyword">in</span> &lt;top (required)&gt;<span class="string">'</span></span><br><span class="line"><span class="string">/opt/gitlab/embedded/bin/bundle:23:in `load'</span></span><br><span class="line">/opt/gitlab/embedded/bin/bundle:23:<span class="keyword">in</span> `&lt;main&gt;<span class="string">'</span></span><br><span class="line"><span class="string">Tasks: TOP =&gt; gitlab:db:configure</span></span><br><span class="line"><span class="string">(See full trace by running task with --trace)</span></span><br><span class="line"><span class="string">STDERR:</span></span><br><span class="line"><span class="string">---- End output of "bash"  "/tmp/chef-script20190628-7065-vx17en" ----</span></span><br><span class="line"><span class="string">Ran "bash"  "/tmp/chef-script20190628-7065-vx17en" returned 1</span></span><br></pre></td></tr></table></figure></p>
<p>åŸå› :å› ä¸ºåœ¨å¸è½½æ—§ç‰ˆæœ¬çš„æ—¶å€™æ²¡æœ‰æŠŠæ—§çš„æ•°æ®åˆ é™¤ï¼Œæ‰€ä»¥ç›´æ¥å®‰è£…æ—¶ï¼Œç¨‹åºæ£€æµ‹åˆ°é…ç½®æ–‡ä»¶ï¼Œæ•°æ®æ–‡ä»¶æ—¶å°±ä¼šè·³è¿‡æ²¡æœ‰è¦†ç›–ï¼Œæ–°ç‰ˆæœ¬ä½¿ç”¨æ—§ç‰ˆæœ¬çš„æ•°æ®æ–‡ä»¶[å› ä¸ºç‰ˆæœ¬ç›¸å·®å¤ªå¤šäº†]å°±ä¼šæ— æ³•è¯†åˆ«å¯¼è‡´ã€‚</p>
<p>è§£å†³æ–¹æ³•:å¸è½½å®Œæ—§ç‰ˆæœ¬åï¼Œè®°å¾—åˆ é™¤æ—§çš„å®‰è£…æ•°æ®<code>é…ç½®æ–‡ä»¶ï¼Œå®‰è£…ç›®å½•ï¼Œæ•°æ®ç›®å½•ç­‰</code>ï¼Œé‡æ–°å®‰è£…æ–°ç‰ˆçš„gitlab-ceå³å¯æ­£å¸¸å¯åŠ¨ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /var/opt/gitlab/ /opt/gitlab/ /etc/gitlab/</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>(5) Gitlabçš„æ•°æ®åº“postgresqlæ›´æ–°å¸å·ä¿¡æ¯</strong><br>é—®é¢˜æè¿°:ç”±äºå†…éƒ¨çš„Ldapè®¤è¯æœåŠ¡å™¨ç¡¬ç›˜åæ‰äº†ï¼Œå¯¼è‡´åœ¨ä¸Šé¢è·‘çš„LdapæœåŠ¡æ— æ³•å¯¹Jenkinså’ŒGitlabå¹³å°åšé›†ä¸­è®¤è¯äº†ï¼Œå¯¼è‡´åœ¨Gitlabä¸Šçš„å¸å·æ— æ³•ç™»é™†åˆ°å¹³å°ä¸Šï¼Œä¹Ÿå°±æ— æ³•æäº¤æ‹‰å–ä»£ç äº†ã€‚</p>
<p><em>è§£å†³æ€è·¯ï¼š</em></p>
<ul>
<li>æ–¹æ³•ä¸€ã€é‡æ–°é…ç½®ä¸€ä¸ªLdapæœåŠ¡æŠŠä¹‹å‰çš„æ•°æ®åº“å¯¼è¿›æ¥ï¼Œè¿ç§»åˆ°æ–°çš„æœºå™¨ä¸Šç„¶åä¿®æ”¹Gitlabçš„è®¤è¯æœåŠ¡åœ°å€ã€‚</li>
<li>æ–¹æ³•äºŒã€ç›´æ¥ä¿®æ”¹Gitlabçš„æ•°æ®åº“ï¼Œå¯¹å¸å·çš„è®¤è¯æ–¹å¼ä¿®æ”¹ã€‚</li>
</ul>
<p>æ­¤å¤„é€‰æ‹©æ–¹å¼2è¿›è¡Œæ“ä½œå…¶æµç¨‹å¦‚ä¸‹:</p>
<ul>
<li>Step1.ä¿®æ”¹gitlabçš„æ•°æ®åº“é…ç½®ï¼Œå¼€å¯è¿œç¨‹è®¿é—®(é»˜è®¤æœ¬æœºè®¿é—®)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.ä¿®æ”¹é…ç½®æ–‡ä»¶æ·»åŠ æœ€åä¸¤è¡Œ</span></span><br><span class="line">egrep -v <span class="string">"^#|^$"</span> /var/opt/gitlab/postgresql/data/pg_hba.conf</span><br><span class="line"><span class="built_in">local</span>   all         all                               peer map=gitlab</span><br><span class="line">host    all             all             127.0.0.1/32            trust</span><br><span class="line">host    all             all             0.0.0.0/0               trust</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.ä¿®æ”¹postgresqlé…ç½®æ–‡ä»¶å°†listen_addressesæŠŠå®ƒæ”¹æˆ*å·</span></span><br><span class="line"><span class="variable">$vim</span> /var/opt/gitlab/postgresql/data/postgresql.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># CONNECTIONS AND AUTHENTICATION</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># - Connection Settings -</span></span><br><span class="line">listen_addresses = <span class="string">'*'</span>    <span class="comment"># what IP address(es) to listen on;</span></span><br><span class="line">          <span class="comment"># comma-separated list of addresses;</span></span><br><span class="line">          <span class="comment"># defaults to 'localhost', '*' = all</span></span><br><span class="line">          <span class="comment"># (change requires restart)</span></span><br><span class="line">port = 5432        <span class="comment"># (change requires restart)</span></span><br><span class="line">max_connections = 200      <span class="comment"># (change requires restart)</span></span><br><span class="line"><span class="comment"># Note:  Increasing max_connections costs ~400 bytes of shared memory per</span></span><br><span class="line"><span class="comment"># connection slot, plus lock space (see max_locks_per_transaction).</span></span><br><span class="line"><span class="comment">#superuser_reserved_connections = 3 # (change requires restart)</span></span><br><span class="line">unix_socket_directories = <span class="string">'/var/opt/gitlab/postgresql'</span>   <span class="comment"># (change requires restart)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3.é‡å¯postgresqlæœåŠ¡</span></span><br><span class="line">gitlab-ctl restart postgresql</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.ä½¿ç”¨Navicatå·¥å…·è¿postgresqlæ¥æ•°æ®åº“ï¼Œä¸‹è¾¹çš„åˆå§‹æ•°æ®åº“gitlabhq_productionå’Œç”¨æˆ·åéƒ½æ˜¯é»˜è®¤çš„ï¼Œå¯†ç ä¸ºç©º</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>è¿æ¥ä¸Šåæ‰¾åˆ°å¯¹åº”çš„identitiesè¡¨ä¿®æ”¹å¯¹åº”çš„å­—æ®µï¼Œå…¶å®å°±æ˜¯æŠŠå­—æ®µä¸­çš„user_idä¿®æ”¹æ‰ï¼Œæˆ‘è¿™é‡Œåšæ³•å°±æ˜¯æŠŠç”¨æˆ·çš„user_idæ”¹æˆäº†è´Ÿæ•°ï¼Œè¿™æ ·åœ¨Ldapè®¤è¯æ—¶å°±æ‰¾ä¸åˆ°äº†ï¼Œä»è€Œèµ°æ ‡å‡†è®¤è¯ï¼ˆè¿™æ˜¯åœ¨ä¸é‡å¯Gitlabçš„æƒ…å†µä¸‹è¿›è¡Œï¼‰ã€‚<br><figure class="image-box">
                <a rel=GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200416162240.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200416162240.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure></p>
<p>è¡¥å……è¯´æ˜:</p>
<ul>
<li>æ›´æ–°åå¦‚æœç”¨æˆ·è¿˜å­˜åœ¨ç™»é™†ä¸äº†çš„é—®é¢˜ï¼Œè¿™æ—¶å€™å¯ä»¥è®©ç”¨æˆ·è‡ªå·±å»Webç«¯ç™»é™†gitlabï¼Œé€‰æ‹©å¿˜è®°å¯†ç ï¼Œé€šè¿‡å¿˜è®°å¯†ç æ¥é‡æ–°è®¾ç½®ä¸€ä¸ªå¯†ç ã€‚(å‰ææ˜¯ä½ å®ç°äº†å¯†ç æ‰¾å›åŠŸèƒ½)</li>
<li>å®Œæˆæ‰€æœ‰æ“ä½œåè®°å¾—è¦æŠŠè¿œç¨‹çš„é…ç½®æ³¨é‡Šæ‰æˆ–è€…åˆ é™¤äº†ï¼Œç„¶åé‡å¯postgresqlæœåŠ¡å³å¯ã€‚</li>
</ul>
<p><br></p>
<p><strong>(5) Gitlab é…ç½®ä¸­å…³é—­ Promethes / grafana</strong><br>æè¿°: å…³é—­ Prometheus / Grafana è§£å†³çš„é—®é¢˜å½“ä¸»æœºå†…å­˜è¾ƒå°æ—¶å¯ä»¥å°†å…¶å…³é—­ï¼Œä½†æ˜¯ç°åœ¨æœåŠ¡å™¨å†…å­˜ä¸€èˆ¬éƒ½æ˜¯å¤Ÿç”¨çš„;<br>é…ç½®å…³é”®é¡¹: /etc/gitlab/gitlab.rb<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Prometheus</span></span><br><span class="line">prometheus[<span class="string">'enable'</span>] = <span class="literal">false</span></span><br><span class="line"><span class="comment">#  gitlab_monitor['enable'] = false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Grafana</span></span><br><span class="line">grafana[<span class="string">'enable'</span>] = <span class="literal">false</span></span><br></pre></td></tr></table></figure></p>
<p>PS : ä¿®æ”¹é…ç½®æ–‡ä»¶åä¸€å®šè¦é‡æ–°åˆå§‹åŒ–GitlabæœåŠ¡å¹¶å¯åŠ¨å…¶æœåŠ¡æ‰§è¡Œ <code>gitlab-ctl reconfigure &amp;&amp; gitlab-ctl start</code> å‘½ä»¤;</p>
<p><strong>(6) sidekiq_cluster has been deprecated since 13.6 and will be removed in 14.0</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Deprecations:</span><br><span class="line">* sidekiq_cluster[<span class="string">'experimental_queue_selector'</span>] has been deprecated since 13.6 and will be removed <span class="keyword">in</span> 14.0. The experimental_queue_selector option is now called queue_selector.</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="0x06-è¡¥å……é™„å½•"><a href="#0x06-è¡¥å……é™„å½•" class="headerlink" title="0x06 è¡¥å……é™„å½•"></a>0x06 è¡¥å……é™„å½•</h2><h3 id="å®‰è£…é…ç½®è„šæœ¬"><a href="#å®‰è£…é…ç½®è„šæœ¬" class="headerlink" title="å®‰è£…é…ç½®è„šæœ¬"></a>å®‰è£…é…ç½®è„šæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Desc: Gitlabä»£ç æœåŠ¡å™¨è‡ªåŠ¨åŒ–éƒ¨ç½²</span></span><br><span class="line"><span class="comment">#Author:WeiyiGeek</span></span><br><span class="line"><span class="comment">#SupportOS:CentOS7 / CentOS8</span></span><br><span class="line"></span><br><span class="line">GITLAB_BASEDOMAIN=weiyigeek.top</span><br><span class="line">GITLAB_VERSION=12.9.2</span><br><span class="line">GITlABOS7=gitlab-ce-<span class="variable">$&#123;GITLAB_VERSION&#125;</span>-ce.0.el7.x86_64.rpm</span><br><span class="line">GITlABOS8=gitlab-ce-<span class="variable">$&#123;GITLAB_VERSION&#125;</span>-ce.0.el8.x86_64.rpm</span><br><span class="line"></span><br><span class="line">GITLABRUNNER_VERSION=12.9.0-1</span><br><span class="line">GITLABRUNNER_NAME=gitlab-runner-<span class="variable">$&#123;GITLABRUNNER_VERSION&#125;</span>.x86_64.rpm	</span><br><span class="line">CheckOSVersion=$(uname -r | grep -c el8)</span><br><span class="line"></span><br><span class="line"><span class="comment">## [é•œåƒæºè®¾ç½®]</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">repoChange</span></span>()&#123;</span><br><span class="line">  mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.$(date +<span class="string">"%Y%m%d"</span>).backup</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$CheckOSVersion</span> -eq 1 ];<span class="keyword">then</span></span><br><span class="line">    <span class="comment"># CentOS8 æº</span></span><br><span class="line">    curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-8.repo</span><br><span class="line">    <span class="comment"># å®‰è£… epel é…ç½®åŒ…å¹¶åœ°å€æ›¿æ¢ä¸ºé˜¿é‡Œäº‘é•œåƒç«™åœ°å€</span></span><br><span class="line">    dnf install -y https://mirrors.aliyun.com/epel/epel-release-latest-8.noarch.rpm</span><br><span class="line">    sed -i <span class="string">'s|^#baseurl=https://download.fedoraproject.org/pub|baseurl=https://mirrors.aliyun.com|'</span> /etc/yum.repos.d/epel*</span><br><span class="line">    sed -i <span class="string">'s|^metalink|#metalink|'</span> /etc/yum.repos.d/epel*</span><br><span class="line">    dnf clean all</span><br><span class="line">    dnf makecache</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="comment"># CentOS7 æº</span></span><br><span class="line">    curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">    sed -i -e <span class="string">'/mirrors.cloud.aliyuncs.com/d'</span> -e <span class="string">'/mirrors.aliyuncs.com/d'</span> /etc/yum.repos.d/CentOS-Base.repo</span><br><span class="line">    wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line"><span class="comment">#æ·»åŠ ä¿¡ä»» GitLab é‡Œçš„ GPG å…¬é’¥</span></span><br><span class="line">sudo cat &gt; /etc/yum.repos.d/gitlab-ce.repo &lt;&lt;EOF</span><br><span class="line">[gitlab-ce]</span><br><span class="line">name=Gitlab CE Repository</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://packages.gitlab.com/gpg.key</span><br><span class="line">EOF</span><br><span class="line">  yum clean all</span><br><span class="line">  yum makecache</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#[yum æ–¹å¼å®‰è£…]</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">yumInstall</span></span>()&#123;</span><br><span class="line">  <span class="comment"># æŸ¥çœ‹å¯ç”¨çš„ç‰ˆæœ¬neng'b</span></span><br><span class="line">  yum list gitlab-ce --showduplicates</span><br><span class="line">  <span class="comment"># é»˜è®¤å®‰è£…æœ€æ–°çš„ç‰ˆæœ¬</span></span><br><span class="line">  yum install -y gitlab-ce</span><br><span class="line">  <span class="comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬ 12.3.5</span></span><br><span class="line">  <span class="comment"># yum install gitlab-ce-12.3.5-ce.0.el7.x86_64.rpm</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#[rpm æ–¹å¼å®‰è£…-æ¨èæ–¹å¼]</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">OmnibusInstall</span></span>()&#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$CheckOSVersion</span> -eq 1 ];<span class="keyword">then</span></span><br><span class="line">    wget -O <span class="variable">$GITlABOS8</span> https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el8/<span class="variable">$&#123;GITlABOS8&#125;</span></span><br><span class="line">    rpm -i <span class="variable">$GITlABOS8</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    wget -O <span class="variable">$GITlABOS7</span> https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/<span class="variable">$&#123;GITlABOS7&#125;</span></span><br><span class="line">    rpm -i  <span class="variable">$GITlABOS7</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">gitlabSetting</span></span>()&#123;</span><br><span class="line">  sed -i <span class="string">"s#example.com#<span class="variable">$&#123;GITLAB_BASEDOMAIN&#125;</span>#g"</span> /etc/gitlab/gitlab.rb</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"127.0.0.1 gitlab.<span class="variable">$&#123;GITLAB_BASEDOMAIN&#125;</span>"</span> &gt; /etc/hosts</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">useage</span></span>()&#123;</span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">"\e[32m# Description: Gitlab è‡ªåŠ¨åŒ–å®‰è£…éƒ¨ç½²è„šæœ¬"</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">"usage: <span class="variable">$0</span> [rpm|yum] #æŒ‡å®šrpmå®‰è£…è¿˜æ˜¯yumå®‰è£…"</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">"Author:WeiyiGeek\e[0m"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#[ä½äº 12.3.x ç‰ˆæœ¬çš„æ‰è¿›è¡Œè®¾ç½®]</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Chinesization</span></span>()&#123;</span><br><span class="line">  <span class="comment">#åœæ­¢gitlab</span></span><br><span class="line">  gitlab-ctl stop</span><br><span class="line"></span><br><span class="line">  <span class="comment">#è·å–å½“å‰å®‰è£…çš„ç‰ˆæœ¬è¡¥ä¸</span></span><br><span class="line">  git <span class="built_in">clone</span> https://gitlab.com/xhang/gitlab.git</span><br><span class="line">  <span class="built_in">cd</span> gitlab</span><br><span class="line">  gitlab_version=$(cat /opt/gitlab/embedded/service/gitlab-rails/VERSION)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># ç”Ÿæˆå¯¹åº”ç‰ˆæœ¬è¡¥ä¸æ–‡ä»¶</span></span><br><span class="line">  git diff remotes/origin/12-3-stable remotes/origin/12-3-stable-zh &gt; ../<span class="variable">$&#123;gitlab_version&#125;</span>-zh.diff</span><br><span class="line"></span><br><span class="line">  <span class="comment"># æ‰“è¡¥ä¸çš„æ—¶å€™ä¼šæç¤ºä¸€äº›è¡¥ä¸æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¸€å®šè¦è·³è¿‡è¿™äº›æ–‡ä»¶ï¼Œä¸ç„¶åé¢reconfigçš„æ—¶å€™ä¼šæŠ¥é”™çš„ã€‚</span></span><br><span class="line">  patch -d /opt/gitlab/embedded/service/gitlab-rails -p1 &lt; ../<span class="variable">$&#123;gitlab_version&#125;</span>-zh.diff</span><br><span class="line">  gitlab-ctl reconfigure</span><br><span class="line">  gitlab-ctl restart</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## [å®‰è£…é…ç½®è„šæœ¬å…¥å£å‡½æ•°]</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">  <span class="comment">#å…³é—­Sellinux</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"å½“å‰Selinux: <span class="variable">$(getenforce)</span>"</span></span><br><span class="line">  setenforce 0</span><br><span class="line">  sed -i <span class="string">'s/SELINUX=enforcing/SELINUX=disabled/g'</span> /etc/selinux/config</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"è®¾ç½®Selinux: <span class="variable">$(getenforce)</span>"</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#ç¯å¢ƒä¾èµ–å®‰è£…</span></span><br><span class="line">  repoChange</span><br><span class="line">  sudo yum install -y curl policycoreutils openssh-server wget postfix git htop ncdu net-tools</span><br><span class="line">  systemctl <span class="built_in">enable</span> postfix</span><br><span class="line">  systemctl start postfix</span><br><span class="line"></span><br><span class="line">  <span class="comment">#é˜²æŠ¤å¢™è®¾ç½®</span></span><br><span class="line">  sudo firewall-cmd --permanent --add-service=http</span><br><span class="line">  sudo firewall-cmd --permanent --add-service=https</span><br><span class="line">  sudo systemctl reload firewalld</span><br><span class="line"></span><br><span class="line">  <span class="comment">#é€‰æ‹©å®‰è£…æ–¹å¼</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$1</span> == <span class="string">"rpm"</span> ];<span class="keyword">then</span></span><br><span class="line">    OmnibusInstall</span><br><span class="line">  <span class="keyword">elif</span> [ <span class="variable">$1</span> == <span class="string">"yum"</span> ];<span class="keyword">then</span> </span><br><span class="line">    yumInstall</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    usage</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  gitlabSetting</span><br><span class="line">  gitlab-ctl reconfigure</span><br><span class="line">  gitlab-ctl start</span><br><span class="line">  gitlab-ctl status</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#[å‚æ•°éªŒè¯]</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -ne 1 ];<span class="keyword">then</span></span><br><span class="line">  usage</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">  main <span class="variable">$1</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

        </div>

         
          <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
        
  
        
  <hr>
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>

  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>

  <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ï¼Œè½¬ä¸ªå‘ã€‘(äººé—´äº”å¤§æƒ…)</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œè°¢è°¢ï¼ã€‚</p>

  <div>
    <img src="https://www.weiyigeek.top/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul>

  <div>
    <img src="/img/wechat-search.png" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·"  width="380" height="170">
    <img src="/img/wechat-app.png" class="img-responsive" alt="æ‰«æVisit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº"  width="385" height="170">
  </div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-07-20T08:23:11.593Z" itemprop="dateUpdated">2022-07-20 16:23:11</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/Gitlab/1.GitLabä¼ä¸šç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨.md" target="_blank" rel="noopener noreferrer">_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/Gitlab/1.GitLabä¼ä¸šç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2019/7-22-98.html" target="_blank" rel="external">https://blog.weiyigeek.top/2019/7-22-98.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">ğŸ‘ é’Ÿæ„ä½œè€…</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gitlab/" rel="tag">gitlab</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/7-22-98.html&title=ã€ŠGitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/7-22-98.html&title=ã€ŠGitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/7-22-98.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠGitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/7-22-98.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/7-22-98.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/7-23-229.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">åº”ç”¨å‘½ä»¤å’Œæ–‡ä»¶æ‰§è¡Œæƒé™è¯¦ç»†</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/7-22-99.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">GitæœåŠ¡å™¨ç«¯æ­å»º</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-å‰è¨€ç®€è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å‰è¨€ç®€è¿°</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-ç¯å¢ƒå®‰è£…"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 ç¯å¢ƒå®‰è£…</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#CentOS"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">CentOS</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Docker"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">Docker</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-æ“ä½œè¯´æ˜"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 æ“ä½œè¯´æ˜</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#gitlab-ctl-å‘½ä»¤"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">gitlab-ctl å‘½ä»¤</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#gitlab-rails-å‘½ä»¤"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">gitlab-rails å‘½ä»¤</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#gitlab-rake-å‘½ä»¤"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">gitlab-rake å‘½ä»¤</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#release-cli-å‘½ä»¤"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">release-cli å‘½ä»¤</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x03-åŸºç¡€é…ç½®"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 åŸºç¡€é…ç½®</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Gitlabåˆå§‹åŒ–è®¾ç½®"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">Gitlabåˆå§‹åŒ–è®¾ç½®</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Gitlabæˆå‘˜æƒé™è¯´æ˜"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">Gitlabæˆå‘˜æƒé™è¯´æ˜</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x04-åŸºç¡€ä½¿ç”¨"><span class="post-toc-number">5.</span> <span class="post-toc-text">0x04 åŸºç¡€ä½¿ç”¨</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Gitlabæ·»åŠ å‘ä¿¡é‚®ç®±"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">Gitlabæ·»åŠ å‘ä¿¡é‚®ç®±</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Gitlabæ·»åŠ LDAPè®¤è¯"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">Gitlabæ·»åŠ LDAPè®¤è¯</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Gitlabå¤‡ä»½å‡çº§è¿ç§»æ¢å¤"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">Gitlabå¤‡ä»½å‡çº§è¿ç§»æ¢å¤</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Gitlabæ›´æ”¹é»˜è®¤Nginx"><span class="post-toc-number">5.4.</span> <span class="post-toc-text">Gitlabæ›´æ”¹é»˜è®¤Nginx</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x05-å…¥å‘è§£å†³"><span class="post-toc-number">6.</span> <span class="post-toc-text">0x05 å…¥å‘è§£å†³</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x06-è¡¥å……é™„å½•"><span class="post-toc-number">7.</span> <span class="post-toc-text">0x06 è¡¥å……é™„å½•</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#å®‰è£…é…ç½®è„šæœ¬"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">å®‰è£…é…ç½®è„šæœ¬</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    


    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¿˜è¯·æ”¯æŒä¸€ä¸‹åšä¸»å“Ÿ, è°¢è°¢å„ä½çœ‹å‹â™¥!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      

    <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
    
      <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
        
</article>
</div>

    </main>
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9134434519967436" data-ad-slot="3629930963" data-ad-format="auto" data-full-width-responsive="true"></ins>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">ä¸ªäººGithub</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">ä¸ªäººGitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">ä¸ªäººçŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘+äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/7-22-98.html&title=ã€ŠGitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/7-22-98.html&title=ã€ŠGitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/7-22-98.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠGitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/7-22-98.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/7-22-98.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJ0lEQVR42u3aS27DMAxF0ex/0y7QaSr3PlIuGupqFDRGrKMCBD96vfC6vtfq8/t6f/L9+dVbVt9uWDJkyPhYxnW7+s/cH0TtmH6gypAh4wAGCbL3rydBlsDuwcu/y5AhQwZI13YhZciQIaPP+CVFw+VoLYmUIUPGyYxOCYpegwPx47W4DBkyPpDRHww89/lP5xsyZMj4l4wrXP0gmI450a5kyJAxmsGLSbKVv4n9QYYrQ4aM0Yy9SR6/kEEOd1kMy5AhYyjj/gpFutH+qKB2EDJkyDiBQX6CF5/p6DEtktEMVoYMGYMYaSMsHWH2k784cMuQIWM0I23TkwDNEz7+awgvQ4aMcYy4P4dvO3SSSF7QypAhYzaDbPqRkyslmkG7TYYMGYMYtZIyvZzRHwwEwVqGDBnjGCSlq40z06K0VhLLkCHjBEYtsUvB/He2pYYyZMgYxCBJWFqI8ksSvFSO/wMyZMg4gNEZA/BrHLuGEDJkyJjNqLXJeHnJkTxwL8EyZMgYyuCBr9+Mey6Uy5Ah4xxGZ6N7B5/x8cmQIWM0I70SkRaiaWH8AkuGDBmnMa5wpU20vUEcFbEyZMgYx+CLJ3A8BD8yzpQhQ8ZQBgmyndDcCdPkSRkyZJzD4EGwE4JrrTq0KxkyZMgIN0SQ/Ft0lDJkyJCBL1XU2mR8hLAsiWXIkHEAgxexZEM84eOhfHO7TYYMGR/FaJWO+NpE7cW1pp4MGTIGMb4A6Xxlqyrs7xIAAAAASUVORK5CYII=" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>