<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Ansible">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-06-28T06:34:30.000Z" itemprop="datePublished" class="page-time">
  2019-06-28
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/">è‡ªåŠ¨åŒ–è¿ç»´</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E5%9F%BA%E7%A1%80/">è¿ç»´åŸºç¡€</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/Ansible/Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-06-28 14:34:30" datetime="2019-06-28T06:34:30.000Z"  itemprop="datePublished">2019-06-28</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/">è‡ªåŠ¨åŒ–è¿ç»´</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E5%9F%BA%E7%A1%80/">è¿ç»´åŸºç¡€</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h4 id="0x00-å¿«é€Ÿå…¥é—¨"><a href="#0x00-å¿«é€Ÿå…¥é—¨" class="headerlink" title="0x00 å¿«é€Ÿå…¥é—¨"></a>0x00 å¿«é€Ÿå…¥é—¨</h4><p><strong>åŸºç¡€æ¦‚å¿µ</strong><br><em>ä»€ä¹ˆæ˜¯ansibleï¼Ÿ</em><br>ç­”ï¼šå®ƒæ˜¯ä¸€ä¸ªLinuxç³»ç»Ÿä¸Šçš„â€è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·â€ï¼Œç±»ä¼¼ä¸€ä¸ªâ€é…ç½®ç®¡ç†å·¥å…·â€; </p>
<p><em>ansibleèƒ½åšä»€ä¹ˆï¼Ÿ</em><br>æ­£å¦‚å…¶ä»–é…ç½®ç®¡ç†å·¥å…·ä¸€æ ·ï¼Œansibleå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆä¸€äº›æ‰¹é‡ä»»åŠ¡ï¼Œæˆ–è€…å®Œæˆä¸€äº›éœ€è¦ç»å¸¸é‡å¤çš„å·¥ä½œã€‚</p>
<ul>
<li>æ¯”å¦‚ï¼šåŒæ—¶åœ¨100å°æœåŠ¡å™¨ä¸Šå®‰è£…nginxæœåŠ¡ï¼Œå¹¶åœ¨å®‰è£…åå¯åŠ¨å®ƒä»¬ã€‚</li>
<li>æ¯”å¦‚ï¼šå°†æŸä¸ªæ–‡ä»¶ä¸€æ¬¡æ€§æ‹·è´åˆ°100å°æœåŠ¡å™¨ä¸Šã€‚</li>
<li>æ¯”å¦‚ï¼šæ¯å½“æœ‰æ–°æœåŠ¡å™¨åŠ å…¥å·¥ä½œç¯å¢ƒæ—¶ï¼Œä½ éƒ½è¦ä¸ºæ–°æœåŠ¡å™¨éƒ¨ç½²redisæœåŠ¡ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ éœ€è¦ç»å¸¸é‡å¤çš„å®Œæˆç›¸åŒçš„å·¥ä½œã€‚</li>
</ul>
<p><em>ansibleä¼˜ç§€çš„ç‰¹æ€§</em>:</p>
<ul>
<li>â€œå¹‚ç­‰æ€§â€:å¯ä»¥ä¿è¯æˆ‘ä»¬é‡å¤çš„æ‰§è¡ŒåŒä¸€é¡¹æ“ä½œæ—¶å¾—åˆ°çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚<ul>
<li>ä¸¾ä¸ªä¾‹å­:ä½ æƒ³æŠŠä¸€ä¸ªæ–‡ä»¶æ‹·è´åˆ°ç›®æ ‡ä¸»æœºçš„æŸä¸ªç›®å½•ä¸Šï¼Œä½†æ˜¯ä½ ä¸ç¡®å®šæ­¤ç›®å½•ä¸­æ˜¯å¦å·²ç»å­˜åœ¨æ­¤æ–‡ä»¶ï¼Œå½“ä½ ä½¿ç”¨ansibleå®Œæˆè¿™é¡¹ä»»åŠ¡æ—¶ï¼Œå°±éå¸¸ç®€å•äº†ï¼Œå› ä¸ºå¦‚æœç›®æ ‡ä¸»æœºçš„å¯¹åº”ç›®å½•ä¸­å·²ç»å­˜åœ¨æ­¤æ–‡ä»¶ï¼Œé‚£ä¹ˆansibleåˆ™ä¸ä¼šè¿›è¡Œä»»ä½•æ“ä½œï¼Œå¦‚æœç›®æ ‡ä¸»æœºçš„å¯¹åº”ç›®å½•ä¸­å¹¶ä¸å­˜åœ¨æ­¤æ–‡ä»¶ï¼Œansibleå°±ä¼šå°†æ–‡ä»¶æ‹·è´åˆ°å¯¹åº”ç›®å½•ä¸­;</li>
<li>ansibleæ˜¯â€ä»¥ç»“æœä¸ºå¯¼å‘çš„â€ï¼Œæˆ‘ä»¬æŒ‡å®šäº†ä¸€ä¸ªâ€ç›®æ ‡çŠ¶æ€â€ï¼Œansibleä¼šè‡ªåŠ¨åˆ¤æ–­ï¼Œâ€å½“å‰çŠ¶æ€â€æ˜¯å¦ä¸â€ç›®æ ‡çŠ¶æ€â€ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™ä¸è¿›è¡Œä»»ä½•æ“ä½œï¼Œå¦‚æœä¸ä¸€è‡´é‚£ä¹ˆå°±å°†â€å½“å‰çŠ¶æ€â€å˜æˆâ€ç›®æ ‡çŠ¶æ€â€</li>
</ul>
</li>
<li>å‰§æœ¬</li>
<li>æ¨¡æ¿</li>
<li>è§’è‰²</li>
</ul>
<p>å…¶ä»–çš„ä¸€äº›è¿ç»´é…ç½®ç®¡ç†å·¥å…·è¿˜æœ‰puppetæˆ–è€…saltstackè€Œansibleç›¸æ¯”è¾ƒäºä»–ä»¬çš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li>ä½¿ç”¨puppetç®¡ç†100å°ä¸»æœºï¼Œå°±è¦åœ¨è¿™100å°ä¸»æœºä¸Šå®‰è£…puppetå¯¹åº”çš„agentï¼ˆå®¢æˆ·ç«¯ä»£ç†ç¨‹åºï¼‰ï¼Œæ¯”è¾ƒç¹ç;</li>
<li>ä¸åŒä¹‹å¤„åœ¨äºansibleåªéœ€è¦ä¾èµ–sshå³å¯æ­£å¸¸å·¥ä½œï¼Œä¸ç”¨åœ¨å—ç®¡ä¸»æœºä¸Šå®‰è£…agentï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦ä½ èƒ½é€šè¿‡sshè¿æ¥åˆ°å¯¹åº”ä¸»æœºï¼Œä½ å°±å¯ä»¥é€šè¿‡ansibleç®¡ç†å¯¹åº”çš„ä¸»æœºã€‚</li>
<li>ä¸ºäº†å¥½åˆ†è¾¨åé¢å°†Ansibleä¸»æœºå°±æ˜¯ç®¡ç†ä¸»æœº,å—ç®¡ç†çš„ä¸»æœºå«åšå—æ§ä¸»æœº;</li>
</ul>
<p>å‚è€ƒæ–‡æ¡£å¸®åŠ©ï¼š<a href="https://docs.ansible.com/ansible/latest/index.html" target="_blank" rel="noopener">https://docs.ansible.com/ansible/latest/index.html</a></p>
<p><br></p>
<h5 id="1-ç¯å¢ƒå®‰è£…ä¸è®¾ç½®"><a href="#1-ç¯å¢ƒå®‰è£…ä¸è®¾ç½®" class="headerlink" title="1.ç¯å¢ƒå®‰è£…ä¸è®¾ç½®"></a>1.ç¯å¢ƒå®‰è£…ä¸è®¾ç½®</h5><p>ç¯å¢ƒè®¾ç½®ï¼šé‡‡ç”¨VMWARE-playeræ¨¡æ‹Ÿç¯å¢ƒå®ç°;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10.10.107.222  Master-Ansibleç®¡ç†ç«¯</span><br><span class="line">10.10.107.234  Slave-Ansible å—æ§ç«¯(Ubuntu)</span><br><span class="line">10.20.172.235  Slave-Ansible å—æ§ç«¯(Centos)</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>(1) CentOSä¸‹Ansibleå®‰è£…ï¼š</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Step1.æˆ‘ä½¿ç”¨yumæºçš„æ–¹å¼å®‰è£…ansibleï¼Œå› ä¸ºå®‰è£…ansibleéœ€è¦epelæºï¼Œæ‰€ä»¥æˆ‘é…ç½®äº†é˜¿é‡Œçš„epelæºå’Œcentos7ç³»ç»Ÿé•œåƒæºï¼Œ</span></span><br><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/etc/yum.repos.d</span><br><span class="line"> </span><br><span class="line"><span class="comment"># cat aliBase.repo</span></span><br><span class="line">[aliBase]</span><br><span class="line">name=aliBase</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/RPM-GPG-KEY-CentOS-<span class="variable">$releasever</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># cat aliEpel.repo</span></span><br><span class="line">[aliEpel]</span><br><span class="line">name=aliEpel</span><br><span class="line">baseurl=https://mirrors.aliyun.com/epel/<span class="variable">$releasever</span>\Server/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Step2.yumæºé…ç½®å®Œæˆåï¼Œå®‰è£…ansible</span></span><br><span class="line">yum install ansible  <span class="comment">#æ­¤æ—¶yumæºä¸­å¯¹åº”çš„ç‰ˆæœ¬ä¸ºansible-2.8.1-1.el7.noarch.rpm</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Step3.éªŒè¯å®‰è£…</span></span><br><span class="line"><span class="variable">$ansible</span> 127.0.0.1 -m ping  <span class="comment">#ä½¿ç”¨ansibleå»pingæœ¬æœº,</span></span><br><span class="line">127.0.0.1 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">"changed"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"ping"</span>: <span class="string">"pong"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å®‰è£…æˆåŠŸåå¦‚æœæƒ³è¦é€šè¿‡ansibleç®¡ç†æŸä¸»æœºï¼Œä½¿ç”¨ansibleç®¡ç†å¿…é¡»åŒæ—¶æ»¡è¶³ä¸¤ä¸ªæœ€åŸºæœ¬çš„æ¡ä»¶å¦‚ä¸‹</p>
<ul>
<li>æ¡ä»¶ä¸€ã€ansibleæ‰€åœ¨çš„ä¸»æœºå¯ä»¥é€šè¿‡sshè¿æ¥åˆ°å—ç®¡ä¸»æœºã€‚</li>
<li>æ¡ä»¶äºŒã€å—ç®¡ä¸»æœºçš„IPåœ°å€ç­‰ä¿¡æ¯å·²ç»æ·»åŠ åˆ°ansibleçš„â€ç®¡ç†æ¸…å•â€ä¸­ï¼Œå¦‚æœæ¸…å•ä¸­æ²¡æœ‰çš„ä¸»æœºæ— æ³•é€šè¿‡ansibleè¿›è¡Œé…ç½®ç®¡ç†;</li>
</ul>
<p>ansibleæä¾›ä¸€ä¸ªé»˜è®¤çš„â€æ¸…å•â€æ–‡ä»¶ /etc/ansible/hostså¹¶ä¸”é‡‡ç”¨inié£æ ¼é‡Œé¢æœ‰é»˜è®¤çš„é…ç½®ç¤ºä¾‹ä½¿ç”¨æç¤º;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç”±äºansibleå·¥ä½œæ–¹å¼,éœ€è¦å°†å—ç®¡ä¸»æœºçš„IPåœ°å€ã€sshç«¯å£å·ç­‰ä¿¡æ¯æ·»åŠ åˆ°ä¸€ä¸ªè¢«ç§°ä½œä¸º"æ¸…å•(Inventory)"çš„é…ç½®æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="comment"># ansible_port ç”¨äºé…ç½®å¯¹åº”ä¸»æœºä¸Šçš„sshdæœåŠ¡ç«¯å£å·é»˜è®¤çš„22å·ç«¯å£ï¼Œ</span></span><br><span class="line"><span class="comment"># ansible_user ç”¨äºé…ç½®è¿æ¥åˆ°å¯¹åº”ä¸»æœºæ—¶æ‰€ä½¿ç”¨çš„ç”¨æˆ·åç§°ã€‚</span></span><br><span class="line"><span class="comment"># ansible_ssh_pass ç”¨äºé…ç½®å¯¹åº”ç”¨æˆ·çš„è¿æ¥å¯†ç ã€‚</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"10.10.107.234 ansible_port=22 ansible_user=root ansible_ssh_pass=ubuntu"</span> &gt;&gt; /etc/ansible/hosts  <span class="comment">#é€šè¿‡ansibleä¸»æœºç®¡ç†234ä¸»æœº</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å½“ä¸ºä¸»æœºé…ç½®åˆ«åæ—¶ï¼Œä¸»æœºçš„IPåœ°å€å¿…é¡»ä½¿ç”¨anible_hostå…³é”®å­—è¿›è¡ŒæŒ‡æ˜ï¼Œå¦åˆ™ansibleå°†æ— æ³•æ­£ç¡®çš„è¯†åˆ«å¯¹åº”çš„ä¸»æœºã€‚</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"test ansible_host=10.20.172.104 ansible_port=22 ansible_user=root ansible_ssh_pass=2019"</span> &gt;&gt; /etc/ansible/hosts  <span class="comment">#è®¾ç½®åˆ«åçš„æ–¹å¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼šä¸Šè¿°é…ç½®å‚æ•°éƒ½æ˜¯ansible2.0ç‰ˆæœ¬ä»¥åçš„å†™æ³•ï¼Œ2.0ç‰ˆæœ¬ä¹‹å‰ï¼Œåº”éµä»å¦‚ä¸‹å†™æ³•</span></span><br><span class="line">ansible_port <span class="comment">#åº”è¯¥å†™æˆansible_ssh_port</span></span><br><span class="line">ansible_user <span class="comment">#åº”è¯¥å†™æˆansible_ssh_user/pass</span></span><br><span class="line">ansible_host <span class="comment">#åº”è¯¥å†™æˆansible_ssh_host</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#éªŒè¯æ¸…å•é…ç½®(ä¸¤å°æœºå™¨éƒ½æ˜¯OKçš„)</span></span><br><span class="line"><span class="variable">$ansible</span> 10.10.107.234 -m ping</span><br><span class="line">10.10.107.234 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">"ansible_facts"</span>: &#123;</span><br><span class="line">        <span class="string">"discovered_interpreter_python"</span>: <span class="string">"/usr/bin/python"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"changed"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"ping"</span>: <span class="string">"pong"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ansible <span class="built_in">test</span> -m ping</span><br><span class="line"><span class="built_in">test</span> | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">"ansible_facts"</span>: &#123;</span><br><span class="line">        <span class="string">"discovered_interpreter_python"</span>: <span class="string">"/usr/bin/python"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"changed"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"ping"</span>: <span class="string">"pong"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><em>ansibleä¸»æ§ç«¯å¦‚ä½•é‡‡ç”¨å¯†åŒ™æ¥ç™»å½•å—æ§ç«¯ï¼Ÿ</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é¦–å…ˆï¼Œç”Ÿæˆé»˜è®¤æ ¼å¼çš„å¯†é’¥å¯¹ï¼Œç§é’¥ä¸å…¬é’¥ã€‚</span></span><br><span class="line">ssh-keygen</span><br><span class="line"><span class="comment">#ç„¶åå°†ç”Ÿæˆçš„å…¬é’¥åŠ å…¥åˆ°10.10.107.234çš„è®¤è¯åˆ—è¡¨</span></span><br><span class="line">ssh-copy-id -i /root/.ssh/id_rsa.pub root@10.10.107.234</span><br><span class="line"><span class="comment">#å¥½äº†å…¬é’¥è®¤è¯çš„ç›¸å…³æ“ä½œé…ç½®å®Œæˆï¼Œæ­¤åˆ»ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥é€šè¿‡ansibleä¸»æœºå…å¯†ç è¿æ¥åˆ°ä¸»æœº60ä¸­äº†ã€‚</span></span><br></pre></td></tr></table></figure></p>
<p>å› ä¸ºé…ç½®äº†å¯†é’¥è®¤è¯ï¼Œæ‰€ä»¥å¯ä»¥å®ç°å…å¯†ç åˆ›å»ºsshè¿æ¥ï¼Œæ—¢ç„¶å·²ç»èƒ½å¤Ÿå…å¯†ç åˆ›å»ºsshè¿æ¥ï¼Œé‚£ä¹ˆåœ¨é…ç½®â€ä¸»æœºæ¸…å•â€æ—¶ï¼Œå°±æ²¡æœ‰å¿…è¦å†æä¾›å¯¹åº”ä¸»æœºçš„ç”¨æˆ·åä¸å¯†ç äº†ï¼Œæ‰€ä»¥åœ¨å®Œæˆäº†å¯†é’¥è®¤è¯çš„ç›¸å…³é…ç½®åï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¸…å•ä¸­çš„é…ç½®ç²¾ç®€ä¸ºå¦‚ä¸‹æ ¼å¼ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">10.10.107.234 ansible_port=22 <span class="comment">#ç²¾ç®€æ¨¡å¼ï¼ˆé»˜è®¤ä¹Ÿæ˜¯çš„22å·ç«¯å£ï¼Œæ‰€ä»¥å¯ä»¥å¿½ç•¥ï¼‰</span></span><br><span class="line"><span class="built_in">test</span> ansible_host=10.10.107.234 ansible_port=22 <span class="comment">#åˆ«åæ¨¡å¼</span></span><br></pre></td></tr></table></figure></p>
<p><em>å®‰è£…æ€»ç»“ï¼š</em></p>
<ul>
<li>åœ¨ä¸Šé¢æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯sshè´¦å·å¯†ç ç™»å½•,ä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸ºäº†æé«˜å®‰å…¨æ€§ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåŸºäºå¯†é’¥è¿›è¡Œsshè®¤è¯ç”šè‡³ä¼šç¦ç”¨å¯†ç è®¤è¯;</li>
<li>åœ¨æ¥å…¥ä¹‹å‰éœ€è¦å°†å—æ§ç«¯çš„å…¬åŒ™å†™å…¥ansibleçš„kown_hostsä¸­;</li>
</ul>
<p><br></p>
<p><strong>(2) Ubuntuä¸‹Ansibleå®‰è£…ï¼š</strong></p>
<p>å®‰è£…æ–¹å¼:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å®˜ç½‘å®‰è£…æ–¹å¼(è¦æœ‰æ¢¯å­)</span></span><br><span class="line">$ sudo apt update</span><br><span class="line">$ sudo apt install software-properties-common</span><br><span class="line">$ sudo apt-add-repository --yes --update ppa:ansible/ansible</span><br><span class="line">$ sudo apt install ansible</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æˆ‘ä»¬å°†ä½¿ç”¨é»˜è®¤çš„Ubuntuå­˜å‚¨åº“å®‰è£…ï¼ˆç‰ˆæœ¬å¯èƒ½éæœ€æ–°ï¼‰</span></span><br><span class="line">sudo apt update  <span class="comment"># é¦–å…ˆä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ·æ–°ç³»ç»Ÿçš„è½¯ä»¶åŒ…ç´¢å¼•å®Œæˆæ­¤æ›´æ–°åæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•</span></span><br><span class="line">sudo apt install ansible <span class="comment"># å®‰è£…Ansibleè½¯ä»¶ï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.å®‰è£…åç‰ˆæœ¬æŸ¥çœ‹</span></span><br><span class="line">ansible --version</span><br><span class="line">ansible 2.9.6</span><br><span class="line">  config file = /etc/ansible/ansible.cfg</span><br><span class="line">  configured module search path = [<span class="string">'/home/weiyigeek/.ansible/plugins/modules'</span>, <span class="string">'/usr/share/ansible/plugins/modules'</span>]</span><br><span class="line">  ansible python module location = /usr/lib/python3/dist-packages/ansible</span><br><span class="line">  executable location = /usr/bin/ansible</span><br><span class="line">  python version = 3.8.5 (default, Jul 28 2020, 12:59:40) [GCC 9.3.0]</span><br></pre></td></tr></table></figure></p>
<p>è‡³æ­¤ç°åœ¨ï¼Œæ‚¨çš„Ansibleæ§åˆ¶èŠ‚ç‚¹å…·æœ‰ç®¡ç†ä¸»æœºæ‰€éœ€çš„æ‰€æœ‰è½¯ä»¶;</p>
<p><br></p>
<h5 id="2-æ¸…å•é…ç½®è¯¦è§£"><a href="#2-æ¸…å•é…ç½®è¯¦è§£" class="headerlink" title="2.æ¸…å•é…ç½®è¯¦è§£"></a>2.æ¸…å•é…ç½®è¯¦è§£</h5><p>æè¿°:è¯¥æ¸…å•æ–‡ä»¶åŒ…å«æœ‰å…³ä½ ä¼šAnsibleç®¡ç†çš„ä¸»æœºä¿¡æ¯</p>
<ul>
<li>æ¸…å•æ–‡ä»¶ä¸­åŒ…æ‹¬ä»ä¸€åˆ°æ•°ç™¾å°æœåŠ¡å™¨çš„ä»»ä½•ä½ç½®ï¼Œå¹¶ä¸”å¯ä»¥å°†ä¸»æœºç»„ç»‡ä¸ºç»„å’Œå­ç»„ã€‚</li>
<li>æ¸…å•æ–‡ä»¶é€šå¸¸è¿˜ç”¨äºè®¾ç½®ä»…å¯¹ç‰¹å®šä¸»æœºæˆ–ç»„æœ‰æ•ˆçš„å˜é‡ï¼Œä»¥ä¾¿åœ¨å‰§æœ¬å’Œæ¨¡æ¿ä¸­ä½¿ç”¨ã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ansibleæä¾›çš„æ¸…å•é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®æˆ‘ä»¬ä»¥è¯¥æ–‡ä»¶è¿›è¡Œè®²è§£<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$vim</span> /etc/ansible/hosts</span><br><span class="line"><span class="comment"># This is the default ansible 'hosts' file.</span></span><br><span class="line"><span class="comment"># It should live in /etc/ansible/hosts</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹1.æ¸…å•æ”¯æŒ"åˆ†ç»„"åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å°†æŸäº›ä¸»æœºåˆ†ä¸ºä¸€ç»„ï¼Œç„¶åé€šè¿‡ç»„åå»ç®¡ç†ç»„å†…çš„æ‰€æœ‰ä¸»æœºã€‚</span></span><br><span class="line"><span class="comment"># æ¯”å¦‚ï¼Œä¸»æœº234å’Œä¸»æœº235éƒ½å±äºAæ¨¡å—çš„æœåŠ¡å™¨ï¼Œä¸»æœº221å±äºBæ¨¡å—çš„æœåŠ¡å™¨ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥åœ¨æ¸…å•ä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®</span></span><br><span class="line">[A]</span><br><span class="line">10.10.107.234</span><br><span class="line">10.10.107.235</span><br><span class="line"></span><br><span class="line">[B]</span><br><span class="line">10.10.107.221</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2.å¦‚æœä¸¤å°ä¸»æœºçš„IPåœ°å€æ˜¯è¿ç»­çš„æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´ç®€æ´çš„æ–¹æ³•ï¼Œé…ç½®Aç»„ä¸­çš„å—ç®¡ä¸»æœºï¼Œç¤ºä¾‹å¦‚ä¸‹</span></span><br><span class="line">[A]</span><br><span class="line">10.10.107.[234:235]</span><br><span class="line"></span><br><span class="line">[B]</span><br><span class="line">10.10.107.221</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹3. ä½¿ç”¨ä¸»æœºåé…ç½®å—ç®¡ä¸»æœºçš„å‰ææ˜¯ansibleä¸»æœºå¯ä»¥æ­£ç¡®è§£æå¯¹åº”çš„ä¸»æœºåï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³è¦é€šè¿‡ä¸»æœºåé…ç½®ä¸¤å°ä¸»æœºï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</span></span><br><span class="line">[A]</span><br><span class="line">db01.weiyigeek.net</span><br><span class="line">db02.weiyigeek.net</span><br><span class="line"></span><br><span class="line">[B]</span><br><span class="line">db0[1:2].weiyigeek.net</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹4.ä¸ºäº†æ›´åŠ çš„çµæ´»çš„ç®¡ç†å—ç®¡ä¸»æœºï¼Œå¯èƒ½éœ€è¦åœ¨ç»„å†…åµŒå¥—ç»„ã€‚</span></span><br><span class="line"><span class="comment">#æ¯”å¦‚ï¼ŒæœåŠ¡å™¨ç¯å¢ƒä»å¤§ç±»ä¸Šå¯ä»¥åˆ†ä¸º"ç”Ÿäº§ç¯å¢ƒ"å’Œ"æµ‹è¯•ç¯å¢ƒ"ï¼ŒæŠŠä¸»æœºåˆ†æˆäº†ä¸¤ç»„ç”Ÿäº§ç»„å’Œæµ‹è¯•ç»„ï¼Œä½†æ˜¯ç”Ÿäº§ç¯å¢ƒåˆåŒ…å«å¾ˆå¤šä¸šåŠ¡æ¨¡å—ï¼Œ</span></span><br><span class="line"><span class="comment">#æ¯”å¦‚ï¼ŒAæ¨¡å—ç”Ÿäº§ç»„ã€Bæ¨¡å—ç”Ÿäº§ç»„ï¼ŒåŒç†æµ‹è¯•ç¯å¢ƒä¸­ä¹Ÿä¼šæœ‰åŒæ ·çš„é—®é¢˜ï¼Œæ¯”å¦‚Aæ¨¡å—æµ‹è¯•ç¯å¢ƒç»„ï¼ŒBæ¨¡å—æµ‹è¯•ç»„ï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦æ›´åŠ ç»†åŒ–çš„è¿›è¡Œåˆ†ç»„ï¼Œç¤ºä¾‹å¦‚ä¸‹</span></span><br><span class="line">[testA]</span><br><span class="line">10.10.107.1</span><br><span class="line"></span><br><span class="line">[testB]</span><br><span class="line">10.10.107.2</span><br><span class="line"></span><br><span class="line"><span class="comment">#è€Œmasterç»„ä¸­åŒ…å«"å­ç»„"ï¼Œæ²¡é”™ï¼Œ"children"å…³é”®å­—è¡¨ç¤ºå½“å‰ç»„ä¸­å­˜åœ¨å­ç»„å°±æ˜¯testAç»„å’ŒtestBç»„</span></span><br><span class="line">[Master:children]</span><br><span class="line"><span class="built_in">test</span>[A:B]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹4.åˆ†ç»„ä¸å­ç»„ä¸ç»„çš„å˜é‡å£°æ˜</span></span><br><span class="line">[manager]</span><br><span class="line">admin ansible_host=10.10.107.202 ansible_port=20211 ansible_user=WeiyiGeeker ansible_sudo_pass=<span class="string">'123456'</span></span><br><span class="line"></span><br><span class="line">[master]</span><br><span class="line">k8s-master-1 ansible_host=10.10.107.210</span><br><span class="line">k8s-master-2 ansible_host=10.10.107.211</span><br><span class="line">k8s-master-3 ansible_host=10.10.107.212</span><br><span class="line"></span><br><span class="line">[node]</span><br><span class="line">k8s-node-1 ansible_host=10.10.107.213</span><br><span class="line">k8s-node-2 ansible_host=10.20.172.220</span><br><span class="line">k8s-node-3 ansible_host=10.20.172.221</span><br><span class="line"></span><br><span class="line"><span class="comment"># k8s ç»„åŒ…å«çš„ å­ç»„</span></span><br><span class="line">[k8s:children]</span><br><span class="line">master</span><br><span class="line">node</span><br><span class="line"></span><br><span class="line"><span class="comment"># k8s ç»„å†…æ‰€å…±äº«çš„å±€éƒ¨å˜é‡è®¾ç½®ä¼˜å…ˆçº§é«˜(å…¨å±€è®¾ç½®åœ¨`/etc/ansible/ansible.cfg`)</span></span><br><span class="line">[k8s:vars]</span><br><span class="line">ansible_port=20211</span><br><span class="line">ansible_user=WeiyiGeeker</span><br><span class="line">ansible_become=<span class="literal">true</span></span><br><span class="line">ansible_become_method=sudo</span><br><span class="line">ansible_become_pass=<span class="string">'123456'</span></span><br><span class="line"></span><br><span class="line">[all:vars]</span><br><span class="line">ansible_python_interpreter=/usr/bin/python3</span><br></pre></td></tr></table></figure></p>
<p><em>éªŒè¯é…ç½®ç»“æœï¼š</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#éªŒè¯1.Aç»„ä¸­åŒ…å«ä¸»æœº60ä¸61ï¼ŒBç»„ä¸­åŒ…å«ä¸»æœº70ï¼Œç»è¿‡ä¸Šè¿°é…ç½®åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»„åå»ç®¡ç†ç»„å†…çš„æ‰€æœ‰ä¸»æœºï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</span></span><br><span class="line">ansible A -m ping</span><br><span class="line">ansible B -m ping</span><br><span class="line">ansible all -m ping <span class="comment">#å°†é…ç½®æ–‡ä»¶ä¸­æ‰€æœ‰çš„ä¸»æœºè¿›è¡Œpingæ“ä½œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#éªŒè¯4.å¦‚æˆ‘ä»¬éœ€è¦é’ˆå¯¹ç”Ÿäº§ç¯å¢ƒä¸­çš„æ‰€æœ‰ä¸»æœºè¿›è¡Œæ“ä½œæ—¶ï¼Œè°ƒç”¨masterç»„å³å¯</span></span><br><span class="line">ansible Master -m ping</span><br><span class="line"></span><br><span class="line"><span class="comment">#éªŒè¯5.é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹åŒ…å«æ¸…å•æ–‡ä»¶ä¸­å®šä¹‰çš„è‡ªå·±çš„æœåŠ¡å™¨åŸºç¡€ç»“æ„</span></span><br><span class="line"><span class="variable">$ansible</span>-inventory --list -y</span><br><span class="line">all:</span><br><span class="line">  children:</span><br><span class="line">    k8s:</span><br><span class="line">      children:</span><br><span class="line">        master:</span><br><span class="line">          hosts:</span><br><span class="line">            k8s-master-1:</span><br><span class="line">              ansible_become: <span class="string">'true'</span></span><br><span class="line">              ansible_become_method: sudo</span><br><span class="line">              ansible_become_pass: 123456</span><br><span class="line">              ansible_host: 10.10.107.210</span><br><span class="line">              ansible_port: 20211</span><br><span class="line">              ansible_python_interpreter: /usr/bin/python3</span><br><span class="line">              ansible_user: WeiyiGeeker</span><br><span class="line">            k8s-master-2:</span><br><span class="line">              ansible_become: <span class="string">'true'</span></span><br><span class="line">              ansible_become_method: sudo</span><br><span class="line">              ansible_become_pass: 123456</span><br><span class="line">              ansible_host: 10.10.107.211</span><br><span class="line">              ansible_port: 20211</span><br><span class="line">              ansible_python_interpreter: /usr/bin/python3</span><br><span class="line">              ansible_user: WeiyiGeeker</span><br><span class="line">            k8s-master-3:</span><br><span class="line">              ansible_become: <span class="string">'true'</span></span><br><span class="line">              ansible_become_method: sudo</span><br><span class="line">              ansible_become_pass: 123456</span><br><span class="line">              ansible_host: 10.10.107.212</span><br><span class="line">              ansible_port: 20211</span><br><span class="line">              ansible_python_interpreter: /usr/bin/python3</span><br><span class="line">              ansible_user: WeiyiGeeker</span><br><span class="line">        node:</span><br><span class="line">          hosts:</span><br><span class="line">            k8s-node-1:</span><br><span class="line">              ansible_become: <span class="string">'true'</span></span><br><span class="line">              ansible_become_method: sudo</span><br><span class="line">              ansible_become_pass: 123456</span><br><span class="line">              ansible_host: 10.10.107.213</span><br><span class="line">              ansible_port: 20211</span><br><span class="line">              ansible_python_interpreter: /usr/bin/python3</span><br><span class="line">              ansible_user: WeiyiGeeker</span><br><span class="line">            k8s-node-2:</span><br><span class="line">              ansible_become: <span class="string">'true'</span></span><br><span class="line">              ansible_become_method: sudo</span><br><span class="line">              ansible_become_pass: 123456</span><br><span class="line">              ansible_host: 10.20.172.220</span><br><span class="line">              ansible_port: 20211</span><br><span class="line">              ansible_python_interpreter: /usr/bin/python3</span><br><span class="line">              ansible_user: WeiyiGeeker</span><br><span class="line">            k8s-node-3:</span><br><span class="line">              ansible_become: <span class="string">'true'</span></span><br><span class="line">              ansible_become_method: sudo</span><br><span class="line">              ansible_become_pass: 123456</span><br><span class="line">              ansible_host: 10.20.172.221</span><br><span class="line">              ansible_port: 20211</span><br><span class="line">              ansible_python_interpreter: /usr/bin/python3</span><br><span class="line">              ansible_user: WeiyiGeeker</span><br><span class="line">    manager:</span><br><span class="line">      hosts:</span><br><span class="line">        admin:</span><br><span class="line">          ansible_host: 10.10.107.202</span><br><span class="line">          ansible_port: 20211</span><br><span class="line">          ansible_python_interpreter: /usr/bin/python3</span><br><span class="line">          ansible_sudo_pass: 123456</span><br><span class="line">          ansible_user: WeiyiGeeker</span><br><span class="line">    ungrouped: &#123;&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190626144613.png" target="_blank" title="WeiyiGeek.éªŒè¯1" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190626144613.png" alt="WeiyiGeek.éªŒè¯1" title="" class=""></a>
                <p>WeiyiGeek.éªŒè¯1</p>
            </figure>
<p><br></p>
<p>å…¶å®Ansibleçš„æ¸…å•æ–‡ä»¶/etc/ansible/hostsä¸ä»…èƒ½å¤Ÿè¯†åˆ«INIçš„é…ç½®è¯­æ³•è¿˜èƒ½å¤Ÿè¯†åˆ«â€YAMLâ€çš„é…ç½®è¯­æ³•ã€‚<br>æ³¨æ„ï¼Œä¸ºäº†ä½¿ç¼©è¿›æ˜¾å¾—æ›´åŠ æ˜æ˜¾ï¼Œæ­¤å¤„æ¯æ¬¡ç¼©è¿›ä½¿ç”¨ä¸¤ä¸ªç©ºæ ¼<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$vim</span> /etc/ansible/hosts</span><br><span class="line"><span class="comment">#ä½¿ç”¨YAMLè¯­æ³•é…ç½®çš„ä¸»æœºæ¸…å•éå¸¸ç®€å•ä¸‹é¢å°±æ˜¯ä»–çš„é…ç½®ç¤ºä¾‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¤ºä¾‹1.æ‰€æœ‰å—ç®¡ç†ç»„æ¼”ç¤º</span></span><br><span class="line">all:   <span class="comment">#ç®¡ç†æ¸…å•ä¸­çš„æ‰€æœ‰ä¸»æœºçš„ä¸€ä¸ªç»„ï¼Œè¿™é‡Œçš„"all:"å°±æ˜¯è¿™ä¸ªå«ä¹‰</span></span><br><span class="line"> hosts:  <span class="comment">#ç¬¬äºŒè¡Œå¼€å¤´ä½¿ç”¨ä¸€ä¸ªç©ºæ ¼ä½œä¸ºç¼©è¿›ï¼Œä½¿ç”¨hostså…³é”®å­—ï¼Œè¡¨ç¤ºhostså±äºallçš„ä¸‹ä¸€çº§ï¼Œï¼ˆåé¢çš„éƒ½æ˜¯é‡‡ç”¨ä¸¤ä¸ªç©ºæ ¼ï¼‰</span></span><br><span class="line">   10.10.107.1</span><br><span class="line">   10.10.107.2</span><br><span class="line"><span class="comment">#ä¸Šä¾‹ç›¸å½“äºå¦‚ä¸‹INIé…ç½®</span></span><br><span class="line">10.1.1.60</span><br><span class="line">10.1.1.61</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¤ºä¾‹2.inié£æ ¼å¯¹æ¯”yaml</span></span><br><span class="line"><span class="comment">#å…ˆçœ‹ä¸€ä¸ªINIé£æ ¼çš„é…ç½®è¡¨ç¤ºå½“å‰æ¸…å•ä¸­æœ‰3å°å—ç®¡ä¸»æœºï¼Œä¸»æœº61ä¸å±äºä»»ä½•ç»„ï¼Œä¸»æœº60å±äºtest1ç»„ï¼Œä¸»æœº70å±äºtest2ç»„</span></span><br><span class="line">10.1.1.61</span><br><span class="line"></span><br><span class="line">[test1]</span><br><span class="line">10.1.1.60</span><br><span class="line"></span><br><span class="line">[test2]</span><br><span class="line">10.1.1.70</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨YAMLè¯­æ³•è¿›è¡ŒåŒç­‰æ•ˆæœçš„é…ç½®å¦‚ä¸‹</span></span><br><span class="line"><span class="comment">#å½“ç›´æ¥åœ¨æ¸…å•ä¸­åˆ›å»ºç»„æ—¶ï¼Œéœ€è¦åœ¨allå…³é”®å­—å†…ä½¿ç”¨childrenå…³é”®å­—ï¼Œè€Œå®šä¹‰æ¯ä¸ªç»„æ—¶ï¼Œæœ‰å¿…é¡»ä½¿ç”¨hostså…³é”®å­—ï¼ŒæŒ‡æ˜ç»„å†…çš„ä¸»æœº</span></span><br><span class="line">all:</span><br><span class="line">  hosts:</span><br><span class="line">    10.1.1.61:</span><br><span class="line">  children:  <span class="comment">#åˆ†ç»„éƒ½æ˜¯children</span></span><br><span class="line">    test1:</span><br><span class="line">      hosts:</span><br><span class="line">        10.1.1.60:</span><br><span class="line">    test2:</span><br><span class="line">      hosts:</span><br><span class="line">        10.1.1.70:</span><br><span class="line"><span class="comment">#ä»ä¸Šä¾‹å¯ä»¥çœ‹å‡ºï¼Œ</span></span><br></pre></td></tr></table></figure></p>
<p>ç»„ä¸­åµŒå¥—æ—¶å€™ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä»ç„¶å…ˆå†™å‡ºINIé£æ ¼çš„ç¤ºä¾‹ä»¥ä½œå¯¹æ¯”ï¼Œå¦‚ä¸‹</span></span><br><span class="line">[proA]</span><br><span class="line">10.1.1.60</span><br><span class="line"></span><br><span class="line">[proB]</span><br><span class="line">10.1.1.70</span><br><span class="line"></span><br><span class="line">[pro:children]</span><br><span class="line">proA</span><br><span class="line">proB</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¹åº”YAMLæ ¼å¼çš„é…ç½®å¦‚ä¸‹proç»„æœ‰ä¸¤ä¸ªå­ç»„ï¼Œåˆ†åˆ«ä¸ºproAç»„å’ŒproBç»„ï¼Œè€Œè¿™ä¸¤ä¸ªç»„åˆ†åˆ«æœ‰è‡ªå·±ç»„å†…çš„ä¸»æœºã€‚</span></span><br><span class="line">all:</span><br><span class="line">  children:</span><br><span class="line">    pro:</span><br><span class="line">      children:</span><br><span class="line">        proA:</span><br><span class="line">          hosts:</span><br><span class="line">            10.1.1.60</span><br><span class="line">        proB:</span><br><span class="line">          hosts:</span><br><span class="line">            10.1.1.70</span><br></pre></td></tr></table></figure><br>å½“æˆ‘ä»¬ä½¿ç”¨YAMLè¯­æ³•é…ç½®æ¸…å•æ—¶ï¼Œæ— éæ˜¯<code>ä½¿ç”¨hostsã€children</code>ç­‰å…³é”®å­—ä¸æˆ‘ä»¬çš„è‡ªå®šä¹‰åç§°è¿›è¡Œæ’åˆ—ç»„åˆç½¢äº†ã€‚</p>
<p>è®¤è¯ç®¡ç†yamlé…ç½®ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#iniæ ¼å¼å¦‚ä¸‹ï¼š</span></span><br><span class="line">10.1.1.6</span><br><span class="line">test7 ansible_host=10.1.1.7 ansible_port=22</span><br><span class="line">localhost ansible_connection=<span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#yamlçš„é…ç½®è¯­æ³•</span></span><br><span class="line">all:</span><br><span class="line">  hosts:</span><br><span class="line">    10.1.1.6</span><br><span class="line">    test7:</span><br><span class="line">      ansible_host: 10.1.1.7 <span class="comment">#æ³¨æ„å†’å·åéƒ½æœ‰ç©ºæ ¼ï¼Œæ³¨æ„yamlè¯­æ³•</span></span><br><span class="line">      ansible_port: 22</span><br><span class="line">    localhost:</span><br><span class="line">      ansible_connection: <span class="built_in">local</span></span><br></pre></td></tr></table></figure></p>
<p>ç»¼åˆç¤ºä¾‹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä»¥ä¸‹æ˜¯å¦‚ä½•ç«‹å³éƒ¨ç½²åˆ°åˆ›å»ºçš„å®¹å™¨çš„ç¤ºä¾‹</span></span><br><span class="line">- name: create jenkins container</span><br><span class="line">  docker_container:</span><br><span class="line">    docker_host: myserver.net:4243</span><br><span class="line">    name: my_jenkins</span><br><span class="line">    image: jenkins</span><br><span class="line"></span><br><span class="line">- name: add container to inventory</span><br><span class="line">  add_host:</span><br><span class="line">    name: my_jenkins</span><br><span class="line">    ansible_connection: docker</span><br><span class="line">    ansible_docker_extra_args: <span class="string">"--tlsverify --tlscacert=/path/to/ca.pem --tlscert=/path/to/client-cert.pem --tlskey=/path/to/client-key.pem -H=tcp://myserver.net:4243"</span>  <span class="comment">#è®¾ç½®å®ˆæŠ¤è¿›ç¨‹</span></span><br><span class="line">    ansible_user: jenkins</span><br><span class="line">  changed_when: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">- name: create directory <span class="keyword">for</span> ssh keys</span><br><span class="line">  delegate_to: my_jenkins</span><br><span class="line">  file:</span><br><span class="line">    path: <span class="string">"/var/jenkins_home/.ssh/jupiter"</span></span><br><span class="line">    state: directory</span><br></pre></td></tr></table></figure><br>å‚è€ƒabsibleçš„yamlè¯­æ³•ï¼š<a href="https://docs.ansible.com/ansible/2.4/intro_inventory.html#id7" target="_blank" rel="noopener">https://docs.ansible.com/ansible/2.4/intro_inventory.html#id7</a></p>
<hr>

<h4 id="0x01-å‘½ä»¤è¯¦è§£"><a href="#0x01-å‘½ä»¤è¯¦è§£" class="headerlink" title="0x01 å‘½ä»¤è¯¦è§£"></a>0x01 å‘½ä»¤è¯¦è§£</h4><p>æè¿°ï¼šä¸»è¦æ˜¯æè¿°ansibleå‘½ä»¤ä¸ansible-docå‘½ä»¤å‚æ•°</p>
<p>è¯­æ³•å‚æ•°:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ansible [ä¸»æœº] [é€‰é¡¹] [ä¸»æœºè¿ä¸è®¤è¯]</span><br><span class="line"><span class="comment">#[option]</span></span><br><span class="line">-a <span class="comment">#ç”¨äºä¼ é€’æ¨¡å—æ‰€éœ€è¦ä½¿ç”¨çš„å‚æ•° -a "src=/etc/fstab dest=/testdir/ansible/"è¡¨ç¤ºä¸ºfetchæ¨¡å—ä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line">-m <span class="comment">#é€‰é¡¹ç”¨äºè°ƒç”¨æŒ‡å®šçš„æ¨¡å—ï¼Œ-m fetch"è¡¨ç¤ºè°ƒç”¨fetchæ¨¡å—;</span></span><br><span class="line">-e <span class="comment">#æŒ‡å®šå‚æ•°å˜é‡ä»¥ä¾›æ¨¡å—ä½¿ç”¨</span></span><br></pre></td></tr></table></figure><br><br></p>
<p>è¡¥å……å‘½ä»¤1ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ansible-doc  <span class="comment">#æ¨¡æ¿å¸®åŠ©ä»¥åŠæ¨¡å—å‘½ä»¤ä½œç”¨æŸ¥çœ‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å‚æ•°</span></span><br><span class="line">-l,--list æ¨¡å—ç®€ä»‹ä¸å…¨éƒ¨æ¨¡å—</span><br><span class="line">-s æ¨¡å—è¯¦æƒ…</span><br></pre></td></tr></table></figure><br><br></p>
<p>è¡¥å……å‘½ä»¤2ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook <span class="comment">#è¿è¡Œå‰§æœ¬é…ç½®æ–‡ä»¶è„šæœ¬</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å‚æ•°</span></span><br><span class="line">--syntax-check <span class="comment">#è¯­æ³•éªŒè¯ </span></span><br><span class="line">--check   <span class="comment">#æ¨¡æ‹ŸéªŒè¯æ‰§è¡Œ </span></span><br><span class="line">--list-tags <span class="comment">#æ¦‚è§ˆä¸€ä¸‹playbookä¸­éƒ½æœ‰å“ªäº›æ ‡ç­¾</span></span><br><span class="line">--tags [tagname]  <span class="comment">#æŒ‡å®šæ‰§è¡Œtagnameçš„ä»»åŠ¡</span></span><br><span class="line">--skip-tags [tagname]  <span class="comment">#è·³è¿‡æ‰§è¡Œtagnameçš„ä»»åŠ¡è€Œæ‰§è¡Œå…¶ä»–ä»»åŠ¡;</span></span><br><span class="line">-e,--extra-vars           <span class="comment">#æŒ‡å®šåœ¨playä¸­ä½¿ç”¨çš„å˜é‡ä¼ å…¥å¤š/å•ä¸ªå˜é‡,è¿˜å¯ä»¥é€šè¿‡jsonå­—ç¬¦ä¸²å½¢å¼ä¼ å…¥;</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>å‘½ä»¤ç¤ºä¾‹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ansible-playbookè¿›è¡Œymlé…ç½®è¯­æ³•æ£€æŸ¥</span></span><br><span class="line">ansible-playbook --syntax-check test.yml</span><br><span class="line"></span><br><span class="line"><span class="comment">#ansible-playbookè¿›è¡Œymlé…ç½®æ¨¡æ‹Ÿæ‰§è¡Œ</span></span><br><span class="line">ansible-playbook --check test.yml</span><br><span class="line"></span><br><span class="line"><span class="comment">#åªæœ‰æ ‡ç­¾å¯¹åº”çš„ä»»åŠ¡ä¼šè¢«æ‰§è¡Œï¼Œå…¶ä»–ä»»åŠ¡éƒ½ä¸ä¼šè¢«æ‰§è¡Œ</span></span><br><span class="line">ansible-playbook --tags task1 test.yml</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŒ‡å®š"ä¸æ‰§è¡Œçš„ä»»åŠ¡",task1æ ‡ç­¾çš„ä»»åŠ¡å°†ä¸è¢«æ‰§è¡Œ</span></span><br><span class="line">ansible-playbook --skip-tags task1 test.yml</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŒ‡å®šåœ¨playä¸­ä½¿ç”¨çš„å˜é‡(ä¼ å…¥å•ä¸ªå˜é‡ / diphenhydramineå˜é‡)</span></span><br><span class="line">ansible-playbook cmdvar.yml --extra-vars <span class="string">"pass_var=cmdline pass var"</span></span><br><span class="line">ansible-playbook cmdvar.yml -e <span class="string">'pass_var="test"  pass_var1="test1"'</span></span><br><span class="line">ansible-playbook cmdvar.yml -e <span class="string">'&#123;"testvar":"test","testvar1":"test1"&#125;'</span></span><br><span class="line">ansible-playbook cmdvar.yml -e <span class="string">'&#123;"countlist":["one","two","three","four"]&#125;'</span> <span class="comment">#è·å–å€¼ä½¿ç”¨å¦‚ä¸‹ä¸¤ç§è¯­æ³•å¼•ç”¨å˜é‡ &#123;&#123;countlist[0]&#125;&#125; æˆ–è€… &#123;&#123;countlist.0&#125;&#125;</span></span><br></pre></td></tr></table></figure></p>
<hr>

<h4 id="0x02-Ansibleæ¨¡å—åŸºç¡€ä½¿ç”¨"><a href="#0x02-Ansibleæ¨¡å—åŸºç¡€ä½¿ç”¨" class="headerlink" title="0x02 Ansibleæ¨¡å—åŸºç¡€ä½¿ç”¨"></a>0x02 Ansibleæ¨¡å—åŸºç¡€ä½¿ç”¨</h4><p>å½“æˆ‘ä»¬ä½¿ç”¨ansibleå®Œæˆå®é™…ä»»åŠ¡æ—¶ï¼Œéœ€è¦ä¾é ansibleçš„å„ä¸ªæ¨¡å—ï¼Œæ¯”å¦‚å‰çš„pingæ¨¡å—<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pingæ¨¡å—ä½¿ç”¨</span></span><br><span class="line"><span class="variable">$ansible</span> all -m ping</span><br><span class="line"></span><br><span class="line">ansible-doc -l <span class="comment">#è·å–åˆ°çš„æ¨¡å—ä¿¡æ¯æ¯”è¾ƒæ¦‚æ‹¬(æŸ¥çœ‹absibleå½“å‰æ‰€æœ‰æ¨¡å—)</span></span><br><span class="line">ansible-doc -s ping <span class="comment">#pingæ¨¡å—çš„è¯¦ç»†ä½¿ç”¨</span></span><br><span class="line">ansible-doc -s fetch <span class="comment">#æˆ‘ä»¬éœ€è¦å°†å—ç®¡ä¸»æœºä¸­çš„æ–‡ä»¶æ‹‰å–åˆ°ansibleä¸»æœºæ—¶åˆ™å¯ä»¥ä½¿ç”¨æ­¤æ¨¡å—</span></span><br></pre></td></tr></table></figure></p>
<p>æ¯”å¦‚ï¼šæŸ¥çœ‹fetchæ¨¡å—çš„ä½¿ç”¨å¸®åŠ©<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ansible-doc -s fetch</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">Fetch</span> <span class="string">files</span> <span class="string">from</span> <span class="string">remote</span> <span class="string">nodes</span></span><br><span class="line"><span class="attr">  fetch:</span></span><br><span class="line"><span class="attr">      dest:</span>  <span class="comment"># (required - å¿…é¡»å‚æ•°) æŒ‡å®šå­˜å…¥åˆ°ansibleä¸»æœºä¸Šæ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="attr">      src:</span>   <span class="comment"># (required - å¿…é¡»å‚æ•°) æŒ‡å®šè¿œç¨‹ä¸»æœºæ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="attr">      validate_checksum:</span> <span class="comment">#Verify checksums</span></span><br><span class="line"><span class="attr">      fail_on_missing:</span> <span class="comment">#é»˜è®¤yes,åªæœ‰å†æ–‡ä»¶ä¸å­˜åœ¨çš„æ—¶å€™å¤±è´¥</span></span><br><span class="line"><span class="attr">      flat:</span>  <span class="comment">#æ–‡ä»¶é‡å†™è¦†ç›–</span></span><br></pre></td></tr></table></figure></p>
<p>åŸºç¡€ç¤ºä¾‹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸»æœºæ¸…å•-yamlæ–‡ä»¶</span></span><br><span class="line">all:</span><br><span class="line">  hosts:</span><br><span class="line">    <span class="built_in">local</span>:</span><br><span class="line">      ansible_host: 10.10.107.222</span><br><span class="line">      ansible_user: root</span><br><span class="line">      ansible_ssh_pass: root@2019</span><br><span class="line">  children:</span><br><span class="line">    ops:</span><br><span class="line">      children:</span><br><span class="line">        testA:</span><br><span class="line">          hosts:</span><br><span class="line">            10.10.107.221</span><br><span class="line">        testB:</span><br><span class="line">          hosts:</span><br><span class="line">            10.20.172.179</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¤ºä¾‹ï¼šæ‹‰å–opsç»„ä¸­æ‰€æœ‰ä¸»æœºçš„/etc/fstabæ–‡ä»¶æ‹‰å–åˆ°æœ¬åœ°</span></span><br><span class="line">ansible ops -m fetch -a <span class="string">"src=/etc/fstab dest=/tmp/ansible/"</span>  <span class="comment">#åˆæ¬¡æ‹‰å–</span></span><br><span class="line"><span class="comment">#é»„è‰²æç¤ºï¼Œå¹¶ä¸”å‘ç”Ÿæ”¹å˜</span></span><br><span class="line">10.10.107.221 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>,  <span class="comment">#å…³é”®ç‚¹</span></span><br><span class="line">    <span class="string">"checksum"</span>: <span class="string">"2b8323413e9c5a3067f61c27ca5ea21378bae582"</span>,  <span class="comment">#è¿œç¨‹MD5æ ¡éªŒ</span></span><br><span class="line">    <span class="string">"dest"</span>: <span class="string">"/tmp/ansible/10.10.107.221/etc/fstab"</span>,  <span class="comment">#(ä¼šä»¥ä¸»æœºåç§°å»ºç«‹æ–‡ä»¶å¤¹ï¼Œç„¶åå†å­˜å…¥)</span></span><br><span class="line">    <span class="string">"md5sum"</span>: <span class="string">"edf31ba4fd10068f6310f4343855af89"</span>,  <span class="comment">#æœ¬åœ°MD5</span></span><br><span class="line">    <span class="string">"remote_checksum"</span>: <span class="string">"2b8323413e9c5a3067f61c27ca5ea21378bae582"</span>,  <span class="comment">#è¿œç¨‹MD5æ ¡éªŒ</span></span><br><span class="line">    <span class="string">"remote_md5sum"</span>: null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190724154311.png" target="_blank" title="WeiyiGeek.fetch" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190724154311.png" alt="WeiyiGeek.fetch" title="" class=""></a>
                <p>WeiyiGeek.fetch</p>
            </figure></p>
<p><strong>è¿”å›æç¤ºé¢œè‰²æ¥çœ‹å¹‚ç­‰æ€§</strong></p>
<ul>
<li>å½“è¿”å›ä¿¡æ¯ä¸ºç»¿è‰²æ—¶ï¼Œâ€changedâ€ä¸ºfalseï¼Œè¡¨ç¤ºansibleæ²¡æœ‰è¿›è¡Œä»»ä½•æ“ä½œï¼Œæ²¡æœ‰â€æ”¹å˜ä»€ä¹ˆâ€ã€‚</li>
<li>å½“è¿”å›ä¿¡æ¯ä¸ºé»„è‰²æ—¶ï¼Œâ€changedâ€ä¸ºtrueï¼Œè¡¨ç¤ºansibleæ‰§è¡Œäº†æ“ä½œï¼Œâ€å½“å‰çŠ¶æ€â€å·²ç»è¢«ansibleæ”¹å˜æˆäº†â€ç›®æ ‡çŠ¶æ€â€ã€‚</li>
</ul>
<p>æ¯”å¦‚:è¿™æ—¶å€™æˆ‘æŠŠ10.10.107.221çš„fstabè¿›è¡Œæ›´æ”¹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">" "</span> &gt;&gt; /etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="comment">#å†æ¬¡è¿›è¡Œæ–‡ä»¶æ‹‰å–æŸ¥çœ‹æ•ˆæœ</span></span><br><span class="line">10.10.107.221 | CHANGED =&gt; &#123;  <span class="comment">#å¯¹æ¯”ç‚¹</span></span><br><span class="line">    <span class="string">"changed"</span>: <span class="literal">true</span>,  <span class="comment">#å¯¹æ¯”ç‚¹ (Yellow)</span></span><br><span class="line">    <span class="string">"checksum"</span>: <span class="string">"e0719b31dd9445c5da3dd5e04f13ed44855aacd0"</span>,</span><br><span class="line">    <span class="string">"dest"</span>: <span class="string">"/tmp/ansible/10.10.107.221/etc/fstab"</span>,</span><br><span class="line">    <span class="string">"md5sum"</span>: <span class="string">"631e37410fac691ead3c90e6938494ef"</span>,</span><br><span class="line">    <span class="string">"remote_checksum"</span>: <span class="string">"e0719b31dd9445c5da3dd5e04f13ed44855aacd0"</span>,  <span class="comment">#æ¯”å¯¹ç‚¹</span></span><br><span class="line">    <span class="string">"remote_md5sum"</span>: null</span><br><span class="line">&#125;</span><br><span class="line">10.20.172.179 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">"changed"</span>: <span class="literal">false</span>, <span class="comment"># ç”±äºç»ˆç«¯çš„é—®é¢˜æˆ‘æ˜¯ç™½è‰²çš„(Green)</span></span><br><span class="line">    <span class="string">"checksum"</span>: <span class="string">"39ffc633a100c2b2d06a3d9d0e625dff1ca7043c"</span>,</span><br><span class="line">    <span class="string">"dest"</span>: <span class="string">"/tmp/ansible/10.20.172.179/etc/fstab"</span>,</span><br><span class="line">    <span class="string">"file"</span>: <span class="string">"/etc/fstab"</span>,</span><br><span class="line">    <span class="string">"md5sum"</span>: <span class="string">"c63b434a7a09baea8b7b59fce8cb807b"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190724154958.png" target="_blank" title="WeiyiGeek.å¹‚ç­‰æ€§å·®åˆ«" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190724154958.png" alt="WeiyiGeek.å¹‚ç­‰æ€§å·®åˆ«" title="" class=""></a>
                <p>WeiyiGeek.å¹‚ç­‰æ€§å·®åˆ«</p>
            </figure></p>
<p>_æ€»ç»“_ï¼š</p>
<ul>
<li>æ³¨é‡Šä¸­åŒ…å« â€œrequiredâ€ å­—æ ·åˆ™è¡¨ç¤ºä½¿ç”¨æ¨¡å—ä¸­çš„å‚æ•°å¿…é¡»è¦è®¾ç½®;</li>
<li>æ³¨æ„å¹‚ç­‰æ€§çš„åŒºåˆ«ç‚¹,ä»¥åŠyamlé…ç½®å—ç®¡ä¸»æœºæ¸…å•</li>
</ul>
<hr>

<h4 id="0x03-PlayBook-å‰§æœ¬"><a href="#0x03-PlayBook-å‰§æœ¬" class="headerlink" title="0x03 PlayBook(å‰§æœ¬)"></a>0x03 PlayBook(å‰§æœ¬)</h4><p>æè¿°ï¼šå°†æˆ‘ä»¬å‰é¢æ‰€å­¦åˆ°çš„æ¨¡å—çš„çŸ¥è¯†ç‚¹åº”ç”¨åˆ°å·¥ä½œåœºæ™¯,è¿›ä¸€æ­¥ç†è§£ä¸ä½¿ç”¨ansible</p>
<h5 id="å‰§æœ¬ymlè¯­æ³•"><a href="#å‰§æœ¬ymlè¯­æ³•" class="headerlink" title="å‰§æœ¬ymlè¯­æ³•"></a>å‰§æœ¬ymlè¯­æ³•</h5><p>å‡è®¾ï¼Œæˆ‘ä»¬æƒ³è¦åœ¨test70ä¸»æœºä¸Šå®‰è£…nginxå¹¶å¯åŠ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ansibleä¸»æœºä¸­æ‰§è¡Œå¦‚ä¸‹3æ¡å‘½ä»¤<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç¡®å®šYUMæº ä½¿ç”¨yumæ¨¡å—å®‰è£…nginx è¿”å›å†å¯åŠ¨nginxæœåŠ¡</span></span><br><span class="line">ansible test70 -m yum_repository -a <span class="string">'name=aliEpel description="alibaba EPEL" baseurl=https://mirrors.aliyun.com/epel/$releasever\Server/$basearch/'</span></span><br><span class="line">ansible test70 -m yum -a <span class="string">'name=nginx disable_gpg_check=yes enablerepo=aliEpel'</span></span><br><span class="line">ansible test70 -m service -a <span class="string">"name=nginx state=started"</span></span><br></pre></td></tr></table></figure></p>
<p><em>ä½†æ˜¯åœ¨å®é™…çš„å·¥ä½œç¯å¢ƒä¸­æˆ‘ä»¬å¯èƒ½éœ€è¦ç»å¸¸åœ¨æ–°ä¸»æœºä¸Šå®‰è£…nginxï¼Œéš¾é“æ¯æ¬¡æœ‰æ–°çš„æœåŠ¡å™¨åŠ å…¥å·¥ä½œç¯å¢ƒï¼Œæˆ‘ä»¬éƒ½è¦ä¿®æ”¹ä¸Šè¿°3æ¡å‘½ä»¤ä¸­çš„ä¸»æœºåå¹¶ä¸”é‡æ–°å°†æ¯ä¸€æ¡å‘½ä»¤æ‰§è¡Œä¸€éå—ï¼Ÿ</em></p>
<p>è¿™æ ·ä¼¼ä¹æœ‰äº›éº»çƒ¦ï¼Œè‚¯å®šæœ‰æ›´å¥½çš„åŠæ³•ï¼Œæ²¡é”™æˆ‘ä»¬å¯ä»¥å°†ä¸Šè¿°å‘½ä»¤å†™æˆè„šæœ¬ï¼Œæ¯æ¬¡ä¿®æ”¹ä¸€äº›å˜é‡ç„¶åæ‰§è¡Œè„šæœ¬å°±è¡Œäº†ï¼Œè€Œansibleå¤©ç”Ÿå°±<code>æä¾›äº†è¿™ç§ç±»ä¼¼&quot;è„šæœ¬&quot;çš„åŠŸèƒ½</code>ï¼Œåœ¨ansibleä¸­ç±»ä¼¼â€è„šæœ¬â€çš„æ–‡ä»¶è¢«ç§°ä½œâ€å‰§æœ¬â€ï¼Œâ€™å‰§æœ¬â€™çš„è‹±æ–‡åç§°ä¸ºâ€™playbookâ€™ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¦åšçš„äº‹æƒ…ç¼–å†™æˆplaybookï¼ŒæŠŠä¸åŒçš„æ¨¡å—æŒ‰ç…§é¡ºåºç¼–æ’åœ¨å‰§æœ¬ä¸­ï¼Œansibleå°±ä¼šæŒ‰ç…§å‰§æœ¬ä¸€æ­¥ä¸€æ­¥çš„æ‰§è¡Œï¼Œæœ€ç»ˆè¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ï¼Œè™½ç„¶playbookçš„åŠŸèƒ½ä¸è„šæœ¬ç±»ä¼¼ï¼Œä½†æ˜¯<code>å‰§æœ¬å¹¶ä¸æ˜¯ç®€å•çš„å°†ad-hocå‘½ä»¤æŒ‰ç…§é¡ºåºå †ç Œåœ¨ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œç¼–å†™å‰§æœ¬éœ€è¦éµå¾ªYAMLè¯­æ³•</code>;</p>
<p>ä¸€ä¸ªâ€™playbookâ€™æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªâ€™playâ€™ç»„æˆçš„ï¼Œè¿™æ ·è¯´å¯èƒ½ä¸å¤ªå®¹æ˜“ç†è§£ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰“ä¸ªæ¯”æ–¹ï¼Œ<code>ä¸€ä¸ª&#39;å‰§æœ¬&#39;æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ª&#39;æ¡¥æ®µ&#39;ç»„æˆçš„ï¼Œæ¯ä¸ªæ¡¥æ®µéƒ½æœ‰ä¸åŒçš„åœºæ™¯ã€äººç‰©ã€æ•…äº‹</code>ï¼Œæ‰€æœ‰çš„æ¡¥æ®µç»„åˆåœ¨ä¸€èµ·ï¼Œç»„æˆä¸€ä¸ªå®Œæ•´çš„å‰§æœ¬ï¼Œå‰§æœ¬å°±æ˜¯playbookæ¡¥æ®µå°±æ˜¯play;å½“ç„¶â€™æ¡¥æ®µâ€™åªæ˜¯æˆ‘è‡ªå·±ä¸ºäº†æ–¹ä¾¿ç†è§£ç»™â€™playâ€™èµ·çš„ä¸­æ–‡åï¼Œå®˜æ–¹åç§°åªå«\â€play\â€ã€‚</p>
<p><br></p>
<p><strong>å‰§æœ¬åˆè¯†-å•ä¸ªplay</strong><br>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªYAMLæ ¼å¼çš„playbookæ–‡ä»¶,playbookæ–‡ä»¶ä»¥â€.yamlâ€æˆ–è€…â€.ymlâ€ä½œä¸ºæ–‡ä»¶ååç¼€ï¼Œæ­¤å¤„æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸ºâ€test.ymlâ€çš„å‰§æœ¬æ–‡ä»¶ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ¯”å¦‚ï¼šå¯¹æœ¬åœ°ä¸»æœºé‡‡ç”¨pingæ¨¡å—,ç„¶åé‡‡ç”¨fileæ¨¡å—å†ä¸»æœºä¸Šåˆ›å»ºç›®å½•;</span></span><br><span class="line">ansible <span class="built_in">local</span> -m ping</span><br><span class="line">ansible <span class="built_in">local</span> -m file -a <span class="string">"path=/testdir/test state=directory"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#yamlé…ç½®æ–‡ä»¶å†™æ³• test.yml</span></span><br><span class="line">---</span><br><span class="line">- hosts: <span class="built_in">local</span>,testA</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks: </span><br><span class="line">  - name: ping The host</span><br><span class="line">    ping: </span><br><span class="line">  - name: make directory <span class="built_in">test</span></span><br><span class="line">    file: </span><br><span class="line">      path: /tmp/ansible-playbook</span><br><span class="line">      state: directory</span><br></pre></td></tr></table></figure></p>
<p>ymlé…ç½®æ–‡ä»¶è§£æï¼š</p>
<ul>
<li>ç¬¬ä¸€è¡Œï¼š<code>---</code>è¡¨ç¤ºymlæ–‡æ¡£çš„å¼€å§‹</li>
<li>ç¬¬äºŒè¡Œï¼š<code>-</code> ä½œä¸ºå¼€å¤´è¡¨ç¤ºä¸€ä¸ªå—åºåˆ—çš„èŠ‚ç‚¹;hostå…³é”®å­—æŒ‡å®šè¦æ“ä½œçš„ä¸»æœºæˆ–è€…ç»„ï¼Œå¤šå°ä¸»æœºæˆ–è€…ç»„é‡‡ç”¨<code>,</code>åˆ†å‰²</li>
<li>ç¬¬ä¸‰è¡Œï¼šremote_userå…³é”®å­—ä¸hostså…³é”®å­—å¯¹é½è¡¨ç¤ºå®ƒä»¬æ˜¯å¹³çº§çš„ï¼Œä½¿ç”¨remote_userå…³é”®å­—å¯ä»¥æŒ‡å®šåœ¨è¿›è¡Œè¿œç¨‹æ“ä½œæ—¶ä½¿ç”¨å“ªä¸ªç”¨æˆ·è¿›è¡Œæ“ä½œ</li>
<li>ç¬¬å››è¡Œï¼šä½¿ç”¨taskså…³é”®å­—æŒ‡æ˜è¦è¿›è¡Œæ“ä½œçš„ä»»åŠ¡åˆ—è¡¨ä¹‹åçš„è¡Œéƒ½å±äºtasksé”®å€¼å¯¹ä¸­çš„å€¼ï¼›æ•´ä¸ªä»»åŠ¡åˆ—è¡¨ä¸€å…±æœ‰ä¸¤ä¸ªä»»åŠ¡ç»„æˆï¼Œæ¯ä¸ªä»»åŠ¡éƒ½ä»¥\â€- \â€å¼€å¤´ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æœ‰è‡ªå·±çš„åå­—ï¼Œä»»åŠ¡åä½¿ç”¨nameå…³é”®å­—è¿›è¡ŒæŒ‡å®š<ul>
<li>ç¬¬ä¸€ä¸ªä»»åŠ¡ä½¿ç”¨pingæ¨¡å—ï¼Œä½¿ç”¨pingæ¨¡å—æ—¶æ²¡æœ‰æŒ‡å®šä»»ä½•å‚æ•°ã€‚</li>
<li>ç¬¬äºŒä¸ªä»»åŠ¡ä½¿ç”¨fileæ¨¡å—ï¼Œä½¿ç”¨fileæ¨¡å—æ—¶ï¼ŒæŒ‡å®šäº†pathå‚æ•°ä¸stateå‚æ•°çš„å€¼ã€‚</li>
</ul>
</li>
</ul>
<p>é‡‡ç”¨<code>&#39;ansible-playbook&#39;å‘½ä»¤</code>æµ‹è¯•è¿è¡Œå‰§æœ¬(è„šæœ¬):<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># ansible-playbook test.yml</span></span><br></pre></td></tr></table></figure><br>playbookæ‰§è¡Œåè¿”å›äº†ä¸€äº›ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯æ˜¯è¿™æ¬¡å‰§æœ¬è¿è¡Œçš„æ¦‚å†µ:<br><figure class="image-box">
                <a rel=Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190729094942.png" target="_blank" title="WeiyiGeek.playbook" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190729094942.png" alt="WeiyiGeek.playbook" title="" class=""></a>
                <p>WeiyiGeek.playbook</p>
            </figure></p>
<ul>
<li>â€˜make directory ansible-playbookâ€™ä»»åŠ¡è¿”å›çš„ä¿¡æ¯æ˜¯ç»¿è‰²çš„ï¼Œå¦‚æœå¯¹åº”çš„ç›®å½•å¹¶ä¸å­˜åœ¨</li>
<li>â€˜make directory ansible-playbookâ€™ä»»åŠ¡è¿”å›çš„ä¿¡æ¯åº”è¯¥æ˜¯<code>é»„è‰²çš„</code>ï¼Œè¿™æ˜¯å› ä¸ºå¹‚ç­‰æ€§çš„ç¼˜æ•…,æ¯”å¦‚è¿™æ¬¡localä¸»æœº</li>
</ul>
<p><em>æˆ‘ä»¬åœ¨playbookä¸­æ˜æ˜åªå†™äº†ä¸¤ä¸ªä»»åŠ¡ï¼Œä¸ºä»€ä¹ˆæœ€åæ‰§è¡Œæ—¶å´æœ‰ä¸‰ä¸ªä»»åŠ¡å‘¢ï¼Ÿ</em><br>ç­”:å› ä¸ºæ¯ä¸ªplayåœ¨æ‰§è¡Œæ—¶éƒ½ä¼šå…ˆæ‰§è¡Œä¸€ä¸ªé»˜è®¤ä»»åŠ¡ï¼Œâ€™Gathering Factsâ€™ä»»åŠ¡ä¼šæ”¶é›†å½“å‰playå¯¹åº”çš„ç›®æ ‡ä¸»æœºçš„ç›¸å…³ä¿¡æ¯ï¼Œæ”¶é›†å®Œè¿™äº›åŸºç¡€ä¿¡æ¯åæ‰ä¼šæ‰§è¡Œæˆ‘ä»¬æŒ‡å®šçš„ä»»åŠ¡ï¼Œ</p>
<p><em>è¡¥å……è¯´æ˜</em>ï¼š</p>
<ul>
<li>è„šæœ¬è¯­æ³•éªŒè¯</li>
<li>è„šæœ¬æ¨¡æ‹Ÿæ‰§è¡Œ : æˆ‘ä»¬å¹¶ä¸èƒ½å®Œå…¨ä»¥â€™æ¨¡æ‹Ÿâ€™çš„åé¦ˆç»“æœä½œä¸ºplaybookæ˜¯å¦èƒ½å¤Ÿæ­£å¸¸è¿è¡Œçš„åˆ¤æ–­ä¾æ®ï¼Œåªèƒ½é€šè¿‡â€™æ¨¡æ‹Ÿâ€™å¤§æ¦‚çš„â€™é¢„ä¼°â€™ä¸€ä¸‹è€Œå·²<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ansible</span>-playbook --syntax-check test.yml <span class="comment">#è¯­æ³•</span></span><br><span class="line"><span class="variable">$ansible</span>-playbook --syntax-check demo.yml <span class="comment">#è¯­æ³•</span></span><br><span class="line">playbook: demo.yml  <span class="comment">#è¯´æ˜æ²¡é—®é¢˜</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$ansible</span>-playbook --check test.yml  <span class="comment">#éªŒè¯</span></span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190729105928.png" target="_blank" title="WeiyiGeek.playbook--check" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190729105928.png" alt="WeiyiGeek.playbook--check" title="" class=""></a>
                <p>WeiyiGeek.playbook--check</p>
            </figure>
</li>
</ul>
<p><br></p>
<p><strong>å‰§æœ¬åˆè¯†-å¤šä¸ªplay</strong><br>æ¯”å¦‚æˆ‘ä»¬æŠŠä¸Šé¢çš„ä¸»æœºæˆ–è€…ç»„åˆ†åˆ«åˆ†æˆä¸¤ä¸ªä¸åŒçš„åœºæ™¯ï¼šå¯¹äºLocalä¸»æœºæ¨¡å—æ˜¯ä¸å˜åŒ–çš„ï¼Œå¯¹äºä¸»æœºç»„Bé‡‡ç”¨fileæ¨¡å—ä»¥åŠuseræ¨¡å—æ¥åˆ›å»ºæ–‡ä»¶å’Œå»ºç«‹ç”¨æˆ·<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">demo.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  tasks:</span> </span><br><span class="line"><span class="attr">  - name:</span> <span class="string">ping</span> <span class="string">The</span> <span class="string">host</span></span><br><span class="line"><span class="attr">    ping:</span> </span><br><span class="line"><span class="attr">  - name:</span> <span class="string">make</span> <span class="string">directory</span> <span class="string">test</span></span><br><span class="line"><span class="attr">    file:</span> </span><br><span class="line"><span class="attr">      path:</span> <span class="string">/tmp/ansible-playbook</span></span><br><span class="line"><span class="attr">      state:</span> <span class="string">directory</span> </span><br><span class="line"></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">testB</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">touch</span> <span class="string">file</span></span><br><span class="line"><span class="attr">    file:</span></span><br><span class="line"><span class="attr">      path:</span> <span class="string">/tmp/file.txt</span></span><br><span class="line"><span class="attr">      state:</span> <span class="string">touch</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">create</span> <span class="string">user</span> <span class="string">demo</span></span><br><span class="line"><span class="attr">    user:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">demo</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">"$6$ygRbo7Fj.mMU2KY0$OEqihCCn5UfOsvMyzPNPBgx3bzAtwrOFyFvacgUmA374XOAEtUCrdjbW5Ip.Zqo491o3kD5I.HaC9nLhh6x741"</span></span><br><span class="line"><span class="attr">      uid:</span> <span class="number">1024</span></span><br><span class="line"><span class="attr">      mode:</span> <span class="number">0700</span></span><br></pre></td></tr></table></figure><br>è„šæœ¬(å‰§æœ¬æ‰§è¡Œ):<code>ansible-playbook demo.yml</code>,æ‰§è¡Œåçš„ç»“æœéªŒè¯ï¼š</p>
<figure class="image-box">
                <a rel=Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190729100309.png" target="_blank" title="WeiyiGeek.playbookdemo.yml" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190729100309.png" alt="WeiyiGeek.playbookdemo.yml" title="" class=""></a>
                <p>WeiyiGeek.playbookdemo.yml</p>
            </figure>
<p>å…¶ä»–ymlé…ç½®æ–‡ä»¶å½¢å¼è¯´æ˜:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å½¢å¼1ï¼šä½¿ç”¨äº†"ç­‰å·"ï¼Œæ¯ä¸ªå‚æ•°ä¹‹é—´ä½¿ç”¨ç©ºæ ¼éš”å¼€è¿™ç§æ ¼å¼ä¹Ÿæ˜¯å®Œå…¨æ­£ç¡®çš„,0.8ç‰ˆæœ¬ä»¥åçš„ansibleæ¨èçš„ä¹¦å†™æ ¼å¼</span></span><br><span class="line">tasks:</span><br><span class="line">- name: make testfile</span><br><span class="line">  file: path=/testdir/testfile state=touch mode=0700</span><br><span class="line">- name: make testfile</span><br><span class="line">  file: path=/testdir/testfile  <span class="comment">#å³ä½¿æŠŠå¤šä¸ªå‚æ•°åˆ†è¡Œå†™ï¼Œä¹Ÿéœ€è¦æ³¨æ„ç¼©è¿›</span></span><br><span class="line">        state=touch mode=0700</span><br><span class="line"></span><br><span class="line"><span class="comment">#å½¢å¼2ï¼š</span></span><br><span class="line"><span class="comment">#åœ¨0.8ç‰ˆæœ¬ä¹‹å‰ï¼Œä½¿ç”¨actionå…³é”®å­—è°ƒç”¨æ¨¡å—ï¼Œç¤ºä¾‹å¦‚ä¸‹(2.8.1å‘ä¸‹å…¼å®¹)ï¼š</span></span><br><span class="line">---</span><br><span class="line">- hosts: <span class="built_in">local</span></span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">  - name: make file</span><br><span class="line">    action: file path=/tmp/test.yml state=touch mode=0700</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190729111106.png" target="_blank" title="WeiyiGeek.2.8.1å‘ä¸‹å…¼å®¹" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190729111106.png" alt="WeiyiGeek.2.8.1å‘ä¸‹å…¼å®¹" title="" class=""></a>
                <p>WeiyiGeek.2.8.1å‘ä¸‹å…¼å®¹</p>
            </figure></p>
<p>åœ¨å‰é¢ç¤ºä¾‹ä¸­æˆ‘ä»¬å¯¹æ¯ä¸ªä»»åŠ¡éƒ½æŒ‡å®šäº†å¯¹åº”çš„åç§°ï¼Œå³æ¯ä¸ªtaskéƒ½æœ‰å¯¹åº”çš„nameï¼Œ<code>å½“æˆ‘ä»¬çœç•¥nameæ—¶ï¼Œé»˜è®¤ä»¥å½“å‰ä»»åŠ¡è°ƒç”¨çš„æ¨¡å—çš„åç§°ä½œä¸ºä»»åŠ¡çš„åç§°ï¼Œä¸è¿‡å»ºè®®ä¸è¦çœç•¥name</code>ï¼Œå› ä¸ºå½“ä»»åŠ¡å­˜åœ¨nameæ—¶å¯è¯»æ€§æ¯”è¾ƒé«˜ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å†™æ³•ä¸€ï¼š(æ¨èæ–¹å¼)</span></span><br><span class="line">tasks:</span><br><span class="line">- name: make testfile</span><br><span class="line">  file: path=/testdir/testfile</span><br><span class="line">        state=touch</span><br><span class="line">        mode=0700</span><br><span class="line"> </span><br><span class="line"><span class="comment">#å†™æ³•äºŒï¼š</span></span><br><span class="line">tasks:</span><br><span class="line">- file: path=/testdir/testfile</span><br><span class="line">        state=touch</span><br><span class="line">        mode=0700</span><br><span class="line">  name: make testfile</span><br></pre></td></tr></table></figure><br>å„å±æ€§é¡ºåºè™½ç„¶æ²¡æœ‰è¦æ±‚ï¼Œä½†æ˜¯ä»ç„¶éœ€è¦ä¸¥æ ¼æŒ‰ç…§ç¼©è¿›è¿›è¡Œå¯¹é½ã€‚</p>
<p><br></p>
<h5 id="handlers-ç”¨æ³•"><a href="#handlers-ç”¨æ³•" class="headerlink" title="handlers ç”¨æ³•"></a>handlers ç”¨æ³•</h5><p>æè¿°ï¼šå…ˆæ¥æè¿°ä¸€ä¸ªå·¥ä½œåœºæ™¯å½“æˆ‘ä»¬ä¿®æ”¹äº†æŸäº›ç¨‹åºçš„é…ç½®æ–‡ä»¶ä»¥åï¼Œæœ‰å¯èƒ½éœ€è¦é‡å¯åº”ç”¨ç¨‹åºï¼Œä»¥ä¾¿èƒ½å¤Ÿä½¿æ–°çš„é…ç½®ç”Ÿæ•ˆï¼Œ<em>é‚£ä¹ˆå¦‚æœä½¿ç”¨playbookæ¥å®ç°è¿™ä¸ªç®€å•çš„åŠŸèƒ½è¯¥æ€æ ·ç¼–å†™playbookå‘¢ï¼Ÿ</em></p>
<p>å‡è®¾æˆ‘ä»¬æƒ³è¦å°†nginxä¸­çš„æŸä¸ªserverçš„ç«¯å£ä»8080æ”¹æˆ8088ï¼Œå¹¶ä¸”åœ¨ä¿®æ”¹é…ç½®ä»¥åé‡å¯nginxï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç¼–å†™å¦‚ä¸‹å‰§æœ¬ã€‚<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">test70</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">Modify</span> <span class="string">the</span> <span class="string">configuration</span></span><br><span class="line"><span class="attr">    lineinfile:</span></span><br><span class="line">      <span class="string">path=/etc/nginx/conf.d/test.conf</span></span><br><span class="line">      <span class="string">regexp="listen(.*)</span> <span class="number">8080</span> <span class="string">(.*)"</span></span><br><span class="line">      <span class="string">line="listen\1</span> <span class="number">8088</span> <span class="string">\2"</span></span><br><span class="line">      <span class="string">backrefs=yes</span></span><br><span class="line">      <span class="string">backup=yes</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">    service:</span></span><br><span class="line">      <span class="string">name=nginx</span></span><br><span class="line">      <span class="string">state=restarted</span></span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190729112518.png" target="_blank" title="WeiyiGeek.restarnginx" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190729112518.png" alt="WeiyiGeek.restarnginx" title="" class=""></a>
                <p>WeiyiGeek.restarnginx</p>
            </figure><br><br></p>
<p><em>é‚£ä¹ˆé—®é¢˜æ¥äº†</em>ï¼Ÿ</p>
<ul>
<li>ç¬¬ä¸€æ¬¡æ‰§è¡Œä¿®æ”¹åé‡æ–°æ˜¯æ²¡æœ‰ä»€ä¹ˆé—®é¢˜,ä½†æ˜¯åœ¨ç¬¬äºŒ/næ¬¡è¿è¡Œæ—¶å€™ä¼šè¿›è¡Œè¡Œæ›¿æ¢åŒ¹é…è€Œä¸å‘ç”Ÿæ”¹å˜(ç”±äºå¹‚ç­‰æ€§),è€Œæ˜¯æœ‰ä¸€æ¬¡æ‰§è¡Œäº†restartæ¥é‡å¯äº†nginxæœåŠ¡;ç®€å•çš„è¯´å°±æ˜¯é…ç½®æœªå‘ç”Ÿä»»ä½•å˜åŒ–å´è¿›è¡Œäº†æœåŠ¡é‡å¯;</li>
</ul>
<p><em>è§£å†³é—®é¢˜çš„æ–¹æ³•ï¼šé‡‡ç”¨ handlers æ–¹æ³•</em></p>
<ul>
<li>handlersçš„æ¦‚å¿µï¼šä½ å¯ä»¥æŠŠhandlersç†è§£æˆå¦ä¸€ç§tasksï¼ˆå¹³çº§ï¼‰ï¼Œhandlersæ˜¯å¦ä¸€ç§â€™ä»»åŠ¡åˆ—è¡¨â€™ï¼Œhandlersä¸­çš„ä»»åŠ¡ä¼šè¢«tasksä¸­çš„ä»»åŠ¡è¿›è¡Œ\â€è°ƒç”¨\â€ï¼Œä½†æ˜¯è¢«\â€è°ƒç”¨\â€å¹¶ä¸æ„å‘³ç€ä¸€å®šä¼šæ‰§è¡Œï¼Œ<code>åªæœ‰å½“tasksä¸­çš„ä»»åŠ¡&quot;çœŸæ­£æ‰§è¡Œ&quot;ä»¥åï¼ˆçœŸæ­£çš„è¿›è¡Œå®é™…æ“ä½œï¼Œé€ æˆäº†å®é™…çš„æ”¹å˜ï¼‰</code>ï¼Œhandlersä¸­è¢«è°ƒç”¨çš„ä»»åŠ¡æ‰ä¼šæ‰§è¡Œï¼Œå¦‚æœtasksä¸­çš„ä»»åŠ¡å¹¶æ²¡æœ‰åšå‡ºä»»ä½•å®é™…çš„æ“ä½œï¼Œé‚£ä¹ˆhandlersä¸­çš„ä»»åŠ¡å³ä½¿è¢«â€™è°ƒç”¨â€™ï¼Œä¹Ÿå¹¶ä¸ä¼šæ‰§è¡Œã€‚</li>
</ul>
<p>handlersç¤ºä¾‹ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">test70</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">Modify</span> <span class="string">the</span> <span class="string">configuration</span></span><br><span class="line"><span class="attr">    lineinfile:</span></span><br><span class="line">      <span class="string">path=/etc/nginx/conf.d/test.conf</span></span><br><span class="line">      <span class="string">regexp="listen(.*)</span> <span class="number">8080</span><span class="string">(.*)"</span></span><br><span class="line">      <span class="string">line="listen\1</span> <span class="number">8088</span><span class="string">\2"</span></span><br><span class="line">      <span class="string">backrefs=yes</span></span><br><span class="line">      <span class="string">backup=yes</span></span><br><span class="line"><span class="attr">    notify:</span></span><br><span class="line">      <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆ‘ä»¬ä½¿ç”¨notifyå…³é”®å­—'è°ƒç”¨'handlersä¸­çš„ä»»åŠ¡ï¼Œæˆ–è€…è¯´é€šè¿‡notifyå…³é”®å­—'é€šçŸ¥'handlersä¸­çš„ä»»åŠ¡</span></span><br><span class="line"><span class="comment"># ä»¬ä½¿ç”¨handlerså…³é”®å­—ï¼ŒæŒ‡æ˜å“ªäº›ä»»åŠ¡å¯ä»¥è¢«'è°ƒç”¨',ä¸tasksæ˜¯å¹³çº§çš„çŠ¶æ€</span></span><br><span class="line"><span class="attr">  handlers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">restart</span> <span class="string">nginx</span>  <span class="comment">#ä»»åŠ¡çš„åç§°ä¸º"restart nginx"</span></span><br><span class="line"><span class="attr">    service:</span></span><br><span class="line">      <span class="string">name=nginx</span></span><br><span class="line">      <span class="string">state=restarted</span></span><br></pre></td></tr></table></figure><br>æ‰€ä»¥ç»¼ä¸Šæ‰€è¿°ä¸Šä¾‹ä¸­çš„playè¡¨ç¤ºï¼Œå¦‚æœ<code>&quot;Modify the configuration&quot;</code>çœŸæ­£çš„ä¿®æ”¹äº†é…ç½®æ–‡ä»¶ï¼ˆå®é™…çš„æ“ä½œï¼‰ï¼Œé‚£ä¹ˆåˆ™æ‰§è¡Œ<code>&quot;restart nginx&quot;ä»»åŠ¡</code>ï¼Œå¦‚æœ<code>&quot;Modify the configuration&quot;</code>å¹¶æ²¡æœ‰è¿›è¡Œä»»ä½•å®é™…çš„æ”¹åŠ¨ï¼Œ<code>åˆ™ä¸æ‰§è¡Œ&quot;restart nginx&quot;</code>é€šå¸¸æ¥è¯´ï¼Œä»»åŠ¡æ‰§è¡Œåå¦‚æœåšå‡ºäº†å®é™…çš„æ“ä½œï¼Œä»»åŠ¡æ‰§è¡Œåçš„çŠ¶æ€ä¸ºchangedåˆ™ä¼šæ‰§è¡Œå¯¹åº”çš„handlersï¼Œ</p>
<p>handlersæ˜¯å¦ä¸€ç§ä»»åŠ¡åˆ—è¡¨å¹¶ä¸”å¯ä»¥æœ‰å¤šä¸ªä»»åŠ¡ï¼Œè¢«tasksä¸­ä¸åŒçš„ä»»åŠ¡notifyï¼Œ</p>
<ul>
<li>é»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰taskæ‰§è¡Œå®Œæ¯•åæ‰ä¼šæ‰§è¡Œå„ä¸ªhandlerï¼Œ<code>å¹¶ä¸æ˜¯æ‰§è¡Œå®ŒæŸä¸ªtaskåï¼Œç«‹å³æ‰§è¡Œå¯¹åº”çš„handler</code></li>
<li>å¦‚æœä½ æƒ³è¦åœ¨æ‰§è¡Œå®ŒæŸäº›taskä»¥åç«‹å³æ‰§è¡Œå¯¹åº”çš„handlerï¼Œåˆ™éœ€è¦ä½¿ç”¨metaæ¨¡å—</li>
</ul>
<p>ç¤ºä¾‹å¦‚ä¸‹ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">make</span> <span class="string">testfile1</span></span><br><span class="line"><span class="attr">    file:</span> <span class="string">path=/tmp/testfile1</span></span><br><span class="line">          <span class="string">state=directory</span></span><br><span class="line"><span class="attr">    notify:</span> <span class="string">ht2</span>  <span class="comment">#è°ƒç”¨handlersä¸­çš„ht2çš„ä»»åŠ¡</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">make</span> <span class="string">testfile2</span></span><br><span class="line"><span class="attr">    file:</span> <span class="string">path=/tmp/testfile2</span></span><br><span class="line">          <span class="string">state=directory</span></span><br><span class="line"><span class="attr">    notify:</span> <span class="string">ht1</span>  <span class="comment">#è°ƒç”¨handlersä¸­çš„ht1çš„ä»»åŠ¡</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">  - meta:</span> <span class="string">flush_handlers</span>  <span class="comment">#è®¾ç½®åœ¨æ‰§è¡Œå®Œå‰é¢æŸäº›taskä»¥åç«‹å³æ‰§è¡Œè°ƒç”¨å¯¹åº”çš„handler</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">task3</span></span><br><span class="line"><span class="attr">    file:</span> <span class="string">path=/tmp/testfile3</span></span><br><span class="line">          <span class="string">state=directory</span></span><br><span class="line"><span class="attr">    notify:</span> <span class="string">ht3</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  handlers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">ht1</span>  <span class="comment">#è®¾ç½®handlersä»»åŠ¡åç§°(å½“tasksä»»åŠ¡æ‰§è¡Œæ—¶å€™æ‰å‡ºå¦)</span></span><br><span class="line"><span class="attr">    file:</span> <span class="string">path=/tmp/testfile1/ht1</span></span><br><span class="line">          <span class="string">state=touch</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">ht2</span></span><br><span class="line"><span class="attr">    file:</span> <span class="string">path=/tmp/testfile2/ht2</span></span><br><span class="line">          <span class="string">state=touch</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">ht3</span></span><br><span class="line"><span class="attr">    file:</span> <span class="string">path=/tmp/testfile3/ht3</span></span><br><span class="line">          <span class="string">state=touch</span>     </span><br><span class="line">          </span><br><span class="line"><span class="comment">#æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="string">PLAY</span> <span class="string">[local]</span> </span><br><span class="line"><span class="string">TASK</span> <span class="string">[Gathering</span> <span class="string">Facts]</span></span><br><span class="line"></span><br><span class="line"><span class="string">TASK</span> <span class="string">[make</span> <span class="string">testfile1]</span> </span><br><span class="line"><span class="string">TASK</span> <span class="string">[make</span> <span class="string">testfile2]</span> </span><br><span class="line"></span><br><span class="line"><span class="string">RUNNING</span> <span class="string">HANDLER</span> <span class="string">[ht1]</span> </span><br><span class="line"><span class="string">RUNNING</span> <span class="string">HANDLER</span> <span class="string">[ht2]</span> </span><br><span class="line"><span class="comment">#ç”±äºè¿™é‡Œé‡‡ç”¨metaæ¨¡å—ä¼šæŠŠä¸Šé¢tasksä¸­notifyè°ƒç”¨å®Œæˆåæ‰§è¡Œï¼Œä¸‹é¢çš„tasksä»»åŠ¡</span></span><br><span class="line"><span class="string">TASK</span> <span class="string">[task3]</span> </span><br><span class="line"><span class="string">RUNNING</span> <span class="string">HANDLER</span> <span class="string">[ht3]</span> </span><br><span class="line"></span><br><span class="line"><span class="string">PLAY</span> <span class="string">RECAP</span></span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190729123011.png" target="_blank" title="WeiyiGeek.metaæ¨¡å—ä¸handler" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190729123011.png" alt="WeiyiGeek.metaæ¨¡å—ä¸handler" title="" class=""></a>
                <p>WeiyiGeek.metaæ¨¡å—ä¸handler</p>
            </figure></p>
<p>åœ¨ä¸€ä¸ªtaskä¸­ä¸€æ¬¡æ€§notifyå¤šä¸ªhandler,<code>å½“å¤šä¸ªhandlerçš„nameç›¸åŒæ—¶åªæœ‰ä¸€ä¸ªhandlerä¼šè¢«æ‰§è¡Œ</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶ä¸èƒ½é€šè¿‡è¿™ç§æ–¹å¼notifyå¤šä¸ªhandlerï¼Œ</p>
<p>å¦‚æœæƒ³è¦ä¸€æ¬¡notifyå¤šä¸ªhandlerå°±éœ€è¦è®¾ç½®ç»„åæ¥è¿›è¡Œhandlerså¤šä»»åŠ¡çš„è°ƒç”¨ï¼Œåˆ™éœ€è¦<code>å€ŸåŠ©å¦ä¸€ä¸ªå…³é”®å­—å®ƒå°±æ˜¯&#39;listen&#39;ç†è§£æˆ&quot;ç»„å&quot;ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå¤šä¸ªhandleråˆ†æˆ&quot;ç»„&quot;</code>ï¼Œå½“æˆ‘ä»¬éœ€è¦ä¸€æ¬¡æ€§notifyå¤šä¸ªhandleræ—¶ï¼Œåªè¦å°†å¤šä¸ªhandleråˆ†ä¸ºâ€ä¸€ç»„â€ï¼Œä½¿ç”¨ç›¸åŒçš„â€ç»„åâ€å³å¯ï¼Œ<code>å½“notifyå¯¹åº”çš„å€¼&quot;ç»„å&quot;æ—¶ï¼Œ&quot;ç»„&quot;å†…çš„æ‰€æœ‰handleréƒ½ä¼šè¢«notify</code></p>
<p>ä¸€ä¸ªnotifyè°ƒç”¨å¤šä¸ªhandlerä¸­çš„ä»»åŠ¡:<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">test70</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">task1</span></span><br><span class="line"><span class="attr">    file:</span> <span class="string">path=/tmp/test</span></span><br><span class="line">          <span class="string">state=directory</span></span><br><span class="line"><span class="attr">    notify:</span> <span class="string">handler</span> <span class="string">group1</span>  <span class="comment">#å…³é”®ç‚¹ å½“task1ä¸­notifyçš„å€¼ä¸ºhandler group1æ—¶ï¼Œhandler1ä¸handler2éƒ½ä¼šè¢«notify</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#andler1ä¸handler2çš„listençš„å€¼éƒ½æ˜¯handler group1</span></span><br><span class="line"><span class="attr">  handlers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">handler1</span></span><br><span class="line"><span class="attr">    listen:</span> <span class="string">handler</span> <span class="string">group1</span>  <span class="comment">#å…³é”®ç‚¹(ç›‘å¬ç»„)</span></span><br><span class="line"><span class="attr">    file:</span> <span class="string">path=/tmp/test/ht1</span></span><br><span class="line">          <span class="string">state=touch</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">handler2</span></span><br><span class="line"><span class="attr">    listen:</span> <span class="string">handler</span> <span class="string">group1</span></span><br><span class="line"><span class="attr">    file:</span> <span class="string">path=/tmp/test/ht2</span></span><br><span class="line">          <span class="string">state=touch</span></span><br></pre></td></tr></table></figure><br>ç›‘æµ‹ä¸æ‰§è¡Œï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ansible</span>-playbook --syntax-check notify.yml</span><br><span class="line">playbook: notify.yml</span><br><span class="line"></span><br><span class="line">ansible-playbook notify.yml</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190729124615.png" target="_blank" title="WeiyiGeek.notify-nutil-handlers" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190729124615.png" alt="WeiyiGeek.notify-nutil-handlers" title="" class=""></a>
                <p>WeiyiGeek.notify-nutil-handlers</p>
            </figure></p>
<p><br></p>
<p><em>handleræ€»ç»“</em>ï¼š</p>
<ul>
<li>handleræ‰§è¡Œçš„é¡ºåºä¸handleråœ¨playbookä¸­å®šä¹‰çš„é¡ºåºæ˜¯ç›¸åŒçš„ï¼Œä¸â€handlerè¢«notifyâ€çš„é¡ºåºæ— å…³ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨metaæ¨¡å—æ¥æ‰§è¡Œå®ŒæŸäº›taskä»¥åç«‹å³æ‰§è¡Œå¯¹åº”çš„handler;å¦‚æœæƒ³è¦æ¯ä¸ªtaskåœ¨å®é™…æ“ä½œåéƒ½ç«‹é©¬æ‰§è¡Œå¯¹åº”handlersï¼Œåˆ™å¯ä»¥åœ¨æ¯ä¸ªä»»åŠ¡ä¹‹åéƒ½æ·»åŠ ä¸€ä¸ªmetaä»»åŠ¡å¹¶å°†å…¶å€¼è®¾ç½®ä¸ºflush_handlers </li>
<li>é‡‡ç”¨tasksé»˜è®¤éƒ½notifyåªèƒ½è°ƒç”¨ä¸€ä¸ªhandlersä»»åŠ¡,å¦‚æœæƒ³è°ƒç”¨å¤šä¸ªhandlersä»»åŠ¡å°±é‡‡ç”¨listenå…³é”®å­—æ¥è®¾ç½®ç›‘å¬ç»„</li>
</ul>
<p><br></p>
<h5 id="tags-ç”¨æ³•"><a href="#tags-ç”¨æ³•" class="headerlink" title="tags ç”¨æ³•"></a>tags ç”¨æ³•</h5><p>æè¿°ï¼š<br>åœ¨å®é™…ä½¿ç”¨è¿™ä¸ªå‰§æœ¬æ—¶ä½ å¯èƒ½åªæ˜¯æƒ³è¦æ‰§è¡Œå…¶ä¸­çš„ä¸€éƒ¨åˆ†ä»»åŠ¡è€Œå·²ï¼Œæˆ–è€…ä½ åªæƒ³è¦æ‰§è¡Œå…¶ä¸­ä¸€ç±»ä»»åŠ¡è€Œå·²ï¼Œè€Œå¹¶éæƒ³è¦æ‰§è¡Œæ•´ä¸ªå‰§æœ¬ä¸­çš„å…¨éƒ¨ä»»åŠ¡</p>
<p><em>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</em><br>ç­”ï¼šå¯ä»¥å€ŸåŠ©tagså®ç°è¿™ä¸ªéœ€æ±‚,è§åçŸ¥ä¹‰<code>tagså¯ä»¥å¸®åŠ©æˆ‘ä»¬å¯¹ä»»åŠ¡è¿›è¡Œ&#39;æ‰“æ ‡ç­¾&#39;çš„æ“ä½œ</code>ï¼Œå½“ä»»åŠ¡å­˜åœ¨æ ‡ç­¾ä»¥åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æ‰§è¡Œplaybookæ—¶ï¼Œ<code>å€ŸåŠ©æ ‡ç­¾æŒ‡å®šæ‰§è¡Œå“ªäº›ä»»åŠ¡ï¼Œæˆ–è€…æŒ‡å®šä¸æ‰§è¡Œå“ªäº›ä»»åŠ¡äº†</code>;</p>
<p>ç¤ºä¾‹ï¼šplayä¸­æœ‰3ä¸ªtaskæ¯ä¸ªtaskéƒ½æœ‰å¯¹åº”çš„tagsï¼Œæˆ‘åªæ˜¯ç®€å•çš„æŠŠtagsçš„å€¼å†™æˆäº†t1ã€t2ã€t3å½“ç„¶æ‚¨ä¹Ÿå¯ä»¥å®šä¹‰æˆä¸ºå…¶ä»–;<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">task1</span></span><br><span class="line"><span class="attr">    file:</span></span><br><span class="line"><span class="attr">      path:</span> <span class="string">/tmp/t1</span></span><br><span class="line"><span class="attr">      state:</span> <span class="string">touch</span></span><br><span class="line"><span class="attr">    tags:</span> <span class="string">t1</span>   <span class="comment">#æ ‡ç­¾1 - æ‰§è¡Œtask1ä»»åŠ¡</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">task2</span></span><br><span class="line"><span class="attr">    file:</span> <span class="string">path=/tmp/t2</span></span><br><span class="line">          <span class="string">state=touch</span></span><br><span class="line"><span class="attr">    tags:</span> <span class="string">t2</span>   <span class="comment">#æ ‡ç­¾2 - æ‰§è¡Œtask2ä»»åŠ¡</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">task3</span></span><br><span class="line"><span class="attr">    file:</span> <span class="string">path=/tmp/t3</span></span><br><span class="line">          <span class="string">state=touch</span></span><br><span class="line"><span class="attr">    tags:</span> <span class="string">t3</span>   <span class="comment">#æ ‡ç­¾3 - æ‰§è¡Œtask3ä»»åŠ¡</span></span><br></pre></td></tr></table></figure><br>ä¸‹é¢åˆ©ç”¨ansible-playbookä¸­<code>--tagsé€‰é¡¹</code>ä»¥åŠ<code>--skip-tagsé€‰é¡¹</code>æ¥æ‰§è¡ŒæŒ‡å®šçš„taskä»»åŠ¡ä»¥åŠè·³è¿‡ä»»åŠ¡æ‰§è¡Œï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç¤ºä¾‹0.åœ¨è°ƒç”¨æ ‡ç­¾ä¹‹å‰ï¼Œå¦‚æœä½ æƒ³è¦æ¦‚è§ˆä¸€ä¸‹playbookä¸­éƒ½æœ‰å“ªäº›æ ‡ç­¾</span></span><br><span class="line">ansible-playbook --list-tags testhttpd.yml</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¤ºä¾‹1.åªæ‰§è¡Œæ ‡ç­¾ä¸ºt2çš„task2ä»»åŠ¡,åªæœ‰æ ‡ç­¾å¯¹åº”çš„ä»»åŠ¡ä¼šè¢«æ‰§è¡Œï¼Œå…¶ä»–ä»»åŠ¡éƒ½ä¸ä¼šè¢«æ‰§è¡Œï¼Œ</span></span><br><span class="line">ansible-playbook --tags=t2 testtag.yml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¤ºä¾‹2.é€‰é¡¹æŒ‡å®š"ä¸æ‰§è¡Œçš„ä»»åŠ¡"ï¼Œæ¯”å¦‚ä¸‹é¢çš„å‘½ä»¤task1å’Œtask3ä¼šæ‰§è¡Œè·³è¿‡äº†task2ä¸ä¼šæ‰§è¡Œï¼Œ</span></span><br><span class="line">ansible-playbook --skip-tags=<span class="string">'t2'</span> testtag.yml</span><br></pre></td></tr></table></figure></p>
<p>é™¤äº†ä½¿ç”¨ä¸Šä¾‹ä¸­çš„è¯­æ³•æŒ‡å®šæ ‡ç­¾ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªä»»åŠ¡æ·»åŠ å¤šä¸ªæ ‡ç­¾ä¸‰ç§è¯­æ³•æ·»åŠ å¤šä¸ªæ ‡ç­¾çš„ç¤ºä¾‹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¯­æ³•ä¸€ï¼š</span></span><br><span class="line">tags:</span><br><span class="line"> - testtag</span><br><span class="line"> - t1</span><br><span class="line"> </span><br><span class="line"><span class="comment">#è¯­æ³•äºŒï¼š</span></span><br><span class="line">tags: tag1,tag2</span><br><span class="line"> </span><br><span class="line"><span class="comment">#è¯­æ³•ä¸‰ï¼š</span></span><br><span class="line">tags: [<span class="string">'tagtest'</span>,<span class="string">'t2'</span>]</span><br></pre></td></tr></table></figure><br><br></p>
<p>å°†ä¸Šé¢æ‰€å­¦çŸ¥è¯†çš„è¿›è¡Œç»¼åˆæ¼”ç¤ºï¼Œå®ç°æ ‡ç­¾çš„å¸¸è§„ç”¨æ³•,å½“æ‹¥æœ‰å…±åŒçš„æ ‡ç­¾æ—¶å€™å°†ä¸»tagsæ ‡ç­¾æå–å‡ºæ¥ä¸tasksåŒçº§ï¼Œè¿˜å¯ä»¥åœ¨tasksé‡Œé¢å»ºç«‹å­æ ‡ç­¾ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  tags:</span> <span class="string">command</span>  <span class="comment">#å…³é”®ç‚¹-å½¢å¼0</span></span><br><span class="line"><span class="attr">  tasks:</span> </span><br><span class="line"><span class="attr">  - name:</span> <span class="string">show</span> <span class="string">ip</span> <span class="string">address</span></span><br><span class="line"><span class="attr">    tags:</span> <span class="string">['ip']</span>  <span class="comment">#å…³é”®ç‚¹-å½¢å¼1</span></span><br><span class="line"><span class="attr">    shell:</span> <span class="string">ifconfig</span> <span class="string">&gt; /tmp/ipaddr.txt   #å€¼å¾—æ³¨æ„(shellæ¨¡å—åœ¨playä¸­çš„ä½¿ç”¨)</span></span><br><span class="line"><span class="string"></span><span class="attr">  - name:</span> <span class="string">mkdir</span> <span class="string">directory</span></span><br><span class="line"><span class="attr">    tags:</span> </span><br><span class="line"><span class="bullet">      -</span> <span class="string">createdir</span>  <span class="comment">#å…³é”®ç‚¹-å½¢å¼2</span></span><br><span class="line"><span class="attr">    file:</span></span><br><span class="line"><span class="attr">      path:</span> <span class="string">/tmp/createdir</span></span><br><span class="line"><span class="attr">      state:</span> <span class="string">directory</span></span><br><span class="line"></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">testA</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  tags:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">  tasks:</span> </span><br><span class="line"><span class="attr">  - name:</span> <span class="string">install</span> <span class="string">nginx</span> <span class="string">package</span></span><br><span class="line"><span class="attr">    tags:</span> <span class="string">['package']</span></span><br><span class="line"><span class="attr">    yum:</span> <span class="string">name=httpd</span> <span class="string">state=latest</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">start</span> <span class="string">up</span> <span class="string">nginx</span> <span class="string">server</span></span><br><span class="line"><span class="attr">    tags:</span> </span><br><span class="line"><span class="bullet">      -</span> <span class="string">startservices</span></span><br><span class="line"><span class="attr">    service:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">      state:</span> <span class="string">started</span></span><br></pre></td></tr></table></figure><br>å½“tagså†™åœ¨playä¸­è€Œétaskä¸­æ—¶ï¼Œplayä¸­çš„æ‰€æœ‰taskä¼šç»§æ‰¿å½“å‰playä¸­çš„tagsï¼Œè€Œä¸Šä¾‹ä¸­<code>ä¸¤ä¸ªä»»åŠ¡éƒ½ä¼šç»§æ‰¿httpdæ ‡ç­¾ï¼ŒåŒæ—¶è¿˜æœ‰æ‹¥æœ‰è‡ªå·±çš„æ ‡ç­¾</code>ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç¤ºä¾‹1.æ¦‚è§ˆä¸€ä¸‹playbookçš„ymlè„šæœ¬ä¸­éƒ½æœ‰å“ªäº›æ ‡ç­¾</span></span><br><span class="line">ansible-playbook --list-tags tag.yml</span><br><span class="line">playbook: tag.yml</span><br><span class="line">  play <span class="comment">#1 (local): local        TAGS: [command]</span></span><br><span class="line">      TASK TAGS: [<span class="built_in">command</span>, createdir, ip]</span><br><span class="line"></span><br><span class="line">  play <span class="comment">#2 (testA): testA        TAGS: [nginx]</span></span><br><span class="line">      TASK TAGS: [nginx, package, startservices]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¤ºä¾‹2.åœ¨è°ƒç”¨æ ‡ç­¾æ—¶ï¼Œä¹Ÿå¯ä»¥ä¸€æ¬¡æ€§æŒ‡å®šå¤šä¸ªæ ‡ç­¾æ¥è°ƒç”¨å¤šä¸ªæ ‡ç­¾éœ€è¦ç”¨é€—å·éš”å¼€</span></span><br><span class="line"><span class="comment">#playæ‰§è¡Œé¡ºåºé»˜è®¤æ˜¯ä»ä¸‹åˆ°ä¸‹æ‰§è¡Œ</span></span><br><span class="line">ansible-playbook --tags package,startservices testhttpd.yml</span><br><span class="line">ansible-playbook --tags <span class="built_in">command</span>,nginx tag.yml</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190729152819.png" target="_blank" title="WeiyiGeek.tags-demo" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190729152819.png" alt="WeiyiGeek.tags-demo" title="" class=""></a>
                <p>WeiyiGeek.tags-demo</p>
            </figure>
<p><br></p>
<p>ansibleç‰¹æ®Šé¢„ç½®5ä¸ªtagï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ ‡ç­¾ç¤ºä¾‹</span></span><br><span class="line">tags: t3,always,nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------åˆ†å‰²çº¿--------------------</span></span><br><span class="line">* always ï¼š æŠŠä»»åŠ¡çš„tagsçš„å€¼æŒ‡å®šä¸ºalwaysæ—¶ä»»åŠ¡å°±æ€»æ˜¯ä¼šè¢«æ‰§è¡Œï¼Œé™¤éä½ ä½¿ç”¨<span class="string">'--skip-tags'</span>é€‰é¡¹æ˜ç¡®æŒ‡å®šä¸æ‰§è¡Œå¯¹åº”çš„ä»»åŠ¡</span><br><span class="line">ansible-playbook --skip-tags always testtag.yml <span class="comment">#åªæœ‰è¿™æ ·æ‰èƒ½è·³è¿‡æ‰§è¡Œ,å¦‚æœplayä¸­æœ‰å¤šä¸ªä»»åŠ¡éƒ½æœ‰alwaysæ ‡ç­¾å°†éƒ½ä¸ä¼šè¢«æ‰§è¡Œ;</span></span><br><span class="line"></span><br><span class="line">ansible-playbook --skip-tags t3 testtag.yml <span class="comment">#å¦å¤–ä¸€ç§æƒ…å†µ;åªè·³è¿‡task3å…¶ä»–å¸¦æœ‰alwaysæ ‡ç­¾çš„ä»»åŠ¡ä¸ä¼šè·³è¿‡ï¼Œå‰ææ˜¯task3æœ‰é™¤äº†alwaysä»¥å¤–çš„è‡ªå®šä¹‰æ ‡ç­¾æ¯”å¦‚è¿™é‡Œçš„t3ã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------åˆ†å‰²çº¿--------------------</span></span><br><span class="line">* never(2.5ç‰ˆæœ¬ä¸­æ–°åŠ å…¥çš„ç‰¹æ®Štag): ä»å­—é¢ä¸Šç†è§£neverçš„ä½œç”¨åº”è¯¥ä¸alwaysæ­£å¥½ç›¸å</span><br><span class="line">ansible-playbook --tags never testtag.yml   <span class="comment">#æŒ‡å®šæ‰ä¼šè¢«æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------------åˆ†å‰²çº¿--------------------</span></span><br><span class="line"><span class="comment">#å‰©ä¸‹çš„ä¸‰ä¸ªç‰¹æ®Šæ ‡ç­¾å¹¶éåƒalwaysä¸€æ ·alwaysä½œä¸ºæ ‡ç­¾å€¼å­˜åœ¨ï¼Œè€Œè¿™ä¸‰ä¸ªç‰¹æ®Šæ ‡ç­¾åˆ™æ˜¯åœ¨è°ƒç”¨æ ‡ç­¾æ—¶ä½¿ç”¨</span></span><br><span class="line">* tagged</span><br><span class="line">ansible-playbook --tags tagged testtag.yml  <span class="comment">#åªæ‰§è¡Œæœ‰æ ‡ç­¾çš„ä»»åŠ¡ï¼Œæ²¡æœ‰ä»»ä½•æ ‡ç­¾çš„ä»»åŠ¡ä¸ä¼šè¢«æ‰§è¡Œ</span></span><br><span class="line">ansible-playbook --skip-tags tagged testtag.yml <span class="comment">#è¡¨ç¤ºè·³è¿‡åŒ…å«æ ‡ç­¾çš„ä»»åŠ¡ï¼Œå³ä½¿å¯¹åº”çš„ä»»åŠ¡åŒ…å«alwaysæ ‡ç­¾ï¼Œä¹Ÿä¼šè¢«è·³è¿‡ã€‚</span></span><br><span class="line"></span><br><span class="line">* untagged</span><br><span class="line">ansible-playbook --tags untagged testtag.yml  <span class="comment">#åªæ‰§è¡Œæ²¡æœ‰æ ‡ç­¾çš„ä»»åŠ¡ï¼Œä½†æ˜¯å¦‚æœæŸäº›ä»»åŠ¡åŒ…å«alwaysæ ‡ç­¾ï¼Œé‚£ä¹ˆè¿™äº›ä»»åŠ¡ä¹Ÿä¼šè¢«æ‰§è¡Œã€‚</span></span><br><span class="line">ansible-playbook --skip-tags untagged testtag.yml <span class="comment">#è¡¨ç¤ºè·³è¿‡æ²¡æœ‰æ ‡ç­¾çš„ä»»åŠ¡ã€‚</span></span><br><span class="line"></span><br><span class="line">* all: è¡¨ç¤ºæ‰€æœ‰ä»»åŠ¡ä¼šè¢«æ‰§è¡Œï¼Œä¸ç”¨æŒ‡å®šï¼Œé»˜è®¤æƒ…å†µä¸‹å°±æ˜¯ä½¿ç”¨è¿™ä¸ªæ ‡ç­¾ã€‚</span><br></pre></td></tr></table></figure></p>

        </div>
        
  <hr>
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>

  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>

  <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ï¼Œè½¬ä¸ªå‘ã€‘(äººé—´äº”å¤§æƒ…)</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œè°¢è°¢ï¼ã€‚</p>

  <div>
    <img src="https://www.weiyigeek.top/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul>

  <div>
    <img src="/img/wechat-search.png" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·"  width="328" height="149">
    <img src="/img/wechat-app.png" class="img-responsive" alt="æ‰«æVisit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº"  width="328" height="149">
  </div>


  <hr>
  


  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-03-29T05:39:06.298Z" itemprop="dateUpdated">2022-03-29 13:39:06</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/Ansible/Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1.md" target="_blank" rel="noopener noreferrer">_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/Ansible/Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2019/6-28-266.html" target="_blank" rel="external">https://blog.weiyigeek.top/2019/6-28-266.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">ğŸ‘ é’Ÿæ„ä½œè€…</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ansible/" rel="tag">Ansible</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/6-28-266.html&title=ã€ŠAnsibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/6-28-266.html&title=ã€ŠAnsibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/6-28-266.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠAnsibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/6-28-266.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/6-28-266.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/6-28-132.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">shellè„šæœ¬ç¼–ç¨‹ä¹‹è·¯1</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/6-28-275.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Pythonè¿ç»´å°å·¥å…·å¼€å‘å®è·µ</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x00-å¿«é€Ÿå…¥é—¨"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å¿«é€Ÿå…¥é—¨</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x01-å‘½ä»¤è¯¦è§£"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 å‘½ä»¤è¯¦è§£</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x02-Ansibleæ¨¡å—åŸºç¡€ä½¿ç”¨"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 Ansibleæ¨¡å—åŸºç¡€ä½¿ç”¨</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x03-PlayBook-å‰§æœ¬"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 PlayBook(å‰§æœ¬)</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

  <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        äººé—´è‡ªæœ‰äº”å¤§æƒ…ã€ç‚¹èµã€æŠ•å¸(èµèµ)ã€æ”¶è—ã€å…³æ³¨ï¼Œè½¬å‘ã€‘, è°¢è°¢çœ‹å‹æ”¯æŒ!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

  
 <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->

  <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">ä¸ªäººGithub</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">ä¸ªäººGitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">ä¸ªäººçŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘+äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved. ITå”¯ä¸€æå®¢ ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/6-28-266.html&title=ã€ŠAnsibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/6-28-266.html&title=ã€ŠAnsibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/6-28-266.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠAnsibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°1ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/6-28-266.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/6-28-266.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMElEQVR42u3aQZKDMAxEUe5/6eQAE5PfskmNrc9qKmGAx0KR2r4ufLwGx99vR+ePrjm6y/XEIUOGjG0Zr9ujds79J/ek9L4yZMjow6hd+r5QktvPs2XIkCEjLYLzJViGDBkyfllwyYC6we+GDBky/g2DlE5ecEnQRuK5R2ZxGTJkbMjgqfvv/35kfUOGDBlbMWqlkxfKWuMYP5UMGTKOZvACNxOo8YG29jwyZMjowCCbtNJhdVUAxz+RIUPGqYx0dOTBfRr6p4udHzpcGTJkNGDwdjAt0yksXsKUIUNGA0ZtBE0/568jfREyZMg4m8EvdP/PtTP5BBq0sDJkyDiUMR/QpzsiZq4T97kyZMjYnJFurajF96T1nNnwKkOGjA4MHnWRxUse3pF7ocItQ4aMNoxa0M8fNw3agsZRhgwZRzNmRk2+nLA2qkMLGDJkyGjASG9QG1zTl1iME2XIkHEQg2xxIMucZFglhXuq25UhQ8ahDN4CpsPqzFYMHgXKkCHjbEZaFsnD8WWAWikf7hmRIUNGG0Ya9JNobFWJH7aJMmTIaMDgUVo6xMaxPgZftTcnQ4aMrRi1yCyN4WpFlrwIGTJkdGA8tzLIh9X5sE+GDBkdGKsau1pIx4O8L22iDBkyGjDWLmSmm734L8DwajJkyJCBz6kVXF6+ZciQIaMWh/FFynTQ5dtBZMiQ0YFBhlh0uUXl9cG4TYYMGRsyZnZqfNmqFQZtvKEsLmTKkCFjP8YbIvzRPylcNrUAAAAASUVORK5CYII=" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 



  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 
     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>
