{"title":"系统管理查看一览","slug":"系统运维/Linux/常用命令/系统管理类命令/系统管理查看一览","date":"2019-06-03T11:35:30.000Z","updated":"2023-01-31T02:29:09.175Z","url":"2019/6-3-167.html","path":"api/articles/2019/6-3-167.html.json","covers":["https://img.weiyigeek.top/2019/20190604092005.png","https://img.weiyigeek.top/2019/20190604095713.png","https://img.weiyigeek.top/2019/20190604100232.png","https://img.weiyigeek.top/2019/20190604100307.png","https://img.weiyigeek.top/2019/20190604100508.png","https://img.weiyigeek.top/2019/20190604101417.png","https://img.weiyigeek.top/2019/20190617170359.png","https://img.weiyigeek.top/2020/1/20200528234525.png","https://img.weiyigeek.top/2019/20190604102453.png","https://img.weiyigeek.top/2020/1/20200412120141.png","https://img.weiyigeek.top/2020/1/20200412123205.png","https://img.weiyigeek.top/2019/1/20190819123847.png","https://img.weiyigeek.top/2019/1/20190819124835.png","https://img.weiyigeek.top/2019/20190604103912.png","https://img.weiyigeek.top/2019/20190604105034.png","https://img.weiyigeek.top/2019/20190604114028.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-快速入门\"><a href=\"#0x00-快速入门\" class=\"headerlink\" title=\"0x00 快速入门\"></a>0x00 快速入门</h4><p>主要是对系统资源进行操作管理显示的命令,在Linux中是非常重要的;</p>\n<p>系统常用快捷键：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctrl+c\t停止执行 当前命令或者脚本</span><br><span class=\"line\">ctrl+z\t暂停执行 当前脚本或者任务</span><br><span class=\"line\">ctrl+l\t清屏</span><br><span class=\"line\">ctrl+a\t光标移动到命令行首</span><br><span class=\"line\">ctrl+e\t光标移动到命令行尾</span><br><span class=\"line\">`ctrl+u\t光标所在位置删除到行首`</span><br><span class=\"line\">`ctrl+w  光标所在位置删除到行首`</span><br><span class=\"line\">`ctrl+k  从光标处向后删除指令串`</span><br><span class=\"line\">ctrl+d  删除光标后的字符 </span><br><span class=\"line\">ctrl+r\t在历史命令中搜索</span><br><span class=\"line\">ctrl+t\t将字符右移动</span><br><span class=\"line\">ctrl+s\t停止滚屏</span><br><span class=\"line\">ctrl+q\t恢复滚屏</span><br><span class=\"line\">ctrl+p  上一条命令</span><br></pre></td></tr></table></figure></p>\n<p><br><br>Linux操作系统的核心kernel具有模块化的特性，应此在编译核心时，务须把全部的功能都放入核心。<br>加载内核驱动的通常流程：</p>\n<ul>\n<li>1.先将.ko文件拷贝到/lib/module/<code>uname -r</code>（内核版本号）/kernel/driver/…目录下，<br>根据具体用途的区别分为net、ide、scsi、usb、video、parport、md、block、ata等等。</li>\n<li>2.运行depmod -a 更新模块依赖新主要是更新modules.dep文件</li>\n<li>3.运行modprobe加载内核模块</li>\n</ul>\n<p><br></p>\n<h5 id=\"shutdown-命令-控制系统重启与关键\"><a href=\"#shutdown-命令-控制系统重启与关键\" class=\"headerlink\" title=\"shutdown 命令 - 控制系统重启与关键\"></a>shutdown 命令 - 控制系统重启与关键</h5><p>描述：使用该命令可以进设置行定时计算机重启和关机，还可以进行自定义关机消息或者发送警告信息;</p>\n<p>语法和参数<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">shutdown -t [秒] [选项] 时间 [警告信息]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 参数说明</span></span><br><span class=\"line\">-t 加上秒数表示过几秒后关机</span><br><span class=\"line\">-k 不关机发送警告信息</span><br><span class=\"line\">-c 取消前一个关机或者重启命令(正在进行shutdown命令)</span><br><span class=\"line\">-h 系统服务停止后关机</span><br><span class=\"line\">-r 系统服务停止后重启</span><br><span class=\"line\">-n 不经过init程序直接运行shutdown关键功能</span><br><span class=\"line\">-f 开关机后略过fsck磁盘检查</span><br><span class=\"line\">-F 关机后强制进行fsck磁盘检查</span><br></pre></td></tr></table></figure></p>\n<p>实例演示：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1：使用date命令看系统日期,表示在凌晨5点30分重启，此时进入倒计时状态，无法再操作，通过ctrl+c取消.</span></span><br><span class=\"line\">shutdown -r 05:30 <span class=\"comment\">#指定时间重启</span></span><br><span class=\"line\">shutdown -r now   <span class=\"comment\">#表示现在就重启</span></span><br><span class=\"line\">shutdown -h now   <span class=\"comment\">#表示现在就关闭系统</span></span><br><span class=\"line\">shutdown -h +30   <span class=\"comment\">#指三十分钟后关闭系统</span></span><br><span class=\"line\"><span class=\"comment\">#补充：在最后加上&amp;，使命令在后台执行不占用操作界面，两次回车后继续自己的操作，此时如果不想在后台执行这条命令，可以用shutdown -c来取消</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 实例2.十分钟后关机并提示信息</span></span><br><span class=\"line\">shutdown -h 10 <span class=\"string\">'I will shutdown after 10 mins'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 实例3.仅仅发送警告信息给在线用户而不会关机</span></span><br><span class=\"line\">shutdown -k now <span class=\"string\">'Dangers will current users login'</span></span><br></pre></td></tr></table></figure></p>\n<p><strong>补充说明:</strong></p>\n<ul>\n<li>1.shutdown命令的优点是依据目前已启动的服务逐次关闭各服务后关机;</li>\n<li>2.建议执行下面的命令前执行sync命令<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1) 其他关机命令:但这三者都不太安全</span></span><br><span class=\"line\">halt : 不理会目前系统状态下进行硬件关键的特殊功能;</span><br><span class=\"line\">poweroff</span><br><span class=\"line\">init 0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2) 其他重启命令:</span></span><br><span class=\"line\">reboot <span class=\"comment\">#比较安全</span></span><br><span class=\"line\">init 6 <span class=\"comment\">#不安全(可能导致数据丢失)</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<h5 id=\"init-命令\"><a href=\"#init-命令\" class=\"headerlink\" title=\"init 命令\"></a>init 命令</h5><p>描述：init命令主要是向init守护进程发送控制命令。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">init  &lt;表示调用某个级别|COMMAND&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#代表系统运行的七个级别：</span></span><br><span class=\"line\">0 关机</span><br><span class=\"line\">1 单用户，可以看做win中的安全模式，用来做系统修复</span><br><span class=\"line\">2 不完全多用户，不含NFS服务（文件共享服务）</span><br><span class=\"line\">3 完全多用户(就是黑底白字的字符界面)</span><br><span class=\"line\">4 未分配</span><br><span class=\"line\">5 图形界面</span><br><span class=\"line\">6 重启</span><br><span class=\"line\"></span><br><span class=\"line\">其他参数：</span><br><span class=\"line\">1, s, S        Enter rescue mode  <span class=\"comment\">#进入救援模式(安全模式)</span></span><br><span class=\"line\">q, Q           Reload init daemon configuration <span class=\"comment\">#重新加载init守护进程配置</span></span><br><span class=\"line\">u, U           Reexecute init daemon  <span class=\"comment\"># 重新执行init守护进程</span></span><br></pre></td></tr></table></figure></p>\n<p>实例演示：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1.使用runlevel来看系统到底运行在哪个级别，Mac OS不支持，并且改变系统开机默认级别</span></span><br><span class=\"line\">runlevel</span><br><span class=\"line\"><span class=\"comment\"># N 3</span></span><br><span class=\"line\">systemctl get-default   <span class=\"comment\">#获取当前运行等级</span></span><br><span class=\"line\"><span class=\"comment\"># multi-user.target</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例2.设置系统开机级别</span></span><br><span class=\"line\">cat /etc/inittab <span class=\"comment\">#修改的配置文件，以Debian和CentOS7为例</span></span><br><span class=\"line\"><span class=\"comment\">#Centos 6的配置：找到文件中的id:3:initdefault字段，修改数字，改变系统开机默认级别</span></span><br><span class=\"line\">multi-user.target  <span class=\"comment\">#类似  level 3</span></span><br><span class=\"line\">graphical.target   <span class=\"comment\">#类似  level 5</span></span><br><span class=\"line\">systemctl get-default   <span class=\"comment\">##当前运行等级 || 上面那种也可以</span></span><br><span class=\"line\">systemctl <span class=\"built_in\">set</span>-dafault multi-user.target   <span class=\"comment\">#设置默认为字符界面</span></span><br></pre></td></tr></table></figure><br><em>非常注意：</em> 在/etc/inittab中绝对不能设为0和6,会导致不断重启;</p>\n<p><br></p>\n<h5 id=\"logout-命令\"><a href=\"#logout-命令\" class=\"headerlink\" title=\"logout 命令\"></a>logout 命令</h5><p>描述：主要是退出shell终端,相当于windows下的logoff;</p>\n<p><br></p>\n<h5 id=\"lsb-release-命令\"><a href=\"#lsb-release-命令\" class=\"headerlink\" title=\"lsb_release 命令\"></a>lsb_release 命令</h5><p>描述：查看打印当前linux系统的发行版本(Centos默认没有没有，但是Debian得还有)<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 示例1.系统信息查看</span></span><br><span class=\"line\">$ lsb_release -a</span><br><span class=\"line\">Distributor ID: Kali</span><br><span class=\"line\">Description:    Kali GNU/Linux Rolling</span><br><span class=\"line\">Release:        2019.2</span><br><span class=\"line\">Codename:       n/a</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 实例2.发行版信息查看</span></span><br><span class=\"line\">$ lsb_release </span><br><span class=\"line\">focal</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 示例3.其他几种查看系统信息命令</span></span><br><span class=\"line\"><span class=\"variable\">$cat</span> /etc/system-release</span><br><span class=\"line\">CentOS Linux release 7.7.1908 (Core)</span><br><span class=\"line\"><span class=\"variable\">$cat</span> /etc/redhat-release</span><br><span class=\"line\">CentOS Linux release 7.7.1908 (Core)</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h5 id=\"uname-命令\"><a href=\"#uname-命令\" class=\"headerlink\" title=\"uname 命令\"></a>uname 命令</h5><p>描述：查看系统与内核相关信息<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uname [选项]</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190604092005.png\" alt=\"WeiyiGeek.uname参数\" title=\"\" class=\"\">\n                <p>WeiyiGeek.uname参数</p>\n            </figure></p>\n<p>示例案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># (1) 系统版本及其内核信息</span></span><br><span class=\"line\">uname -a</span><br><span class=\"line\">  <span class=\"comment\"># Linux localhost.localdomain 3.10.0-957.12.2.el7.x86_64 #1 SMP Tue May 14 21:24:32 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class=\"line\"><span class=\"comment\"># - 文件方式查看系统类型</span></span><br><span class=\"line\">cat /proc/version</span><br><span class=\"line\">  <span class=\"comment\"># Linux version 5.4.0-74-generic (buildd@lgw01-amd64-038) (gcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04)) #83-Ubuntu SMP Sat May 8 02:35:39 UTC 2021</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2) 其他参数效果</span></span><br><span class=\"line\"><span class=\"variable\">$uname</span> -r</span><br><span class=\"line\">3.10.0-957.12.2.el7.x86_64</span><br><span class=\"line\"><span class=\"variable\">$uname</span> -n</span><br><span class=\"line\">localhost.localdomain</span><br><span class=\"line\"><span class=\"variable\">$uname</span> -p</span><br><span class=\"line\">x86_64</span><br><span class=\"line\"><span class=\"variable\">$uname</span> -o</span><br><span class=\"line\">GNU/Linux</span><br><span class=\"line\"><span class=\"variable\">$uname</span> -r</span><br><span class=\"line\">3.10.0-957.12.2.el7.x86_64</span><br><span class=\"line\"><span class=\"variable\">$uname</span> -s</span><br><span class=\"line\">Linux</span><br><span class=\"line\"><span class=\"variable\">$uname</span> -m</span><br><span class=\"line\">x86_64</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h5 id=\"dmesg-命令\"><a href=\"#dmesg-命令\" class=\"headerlink\" title=\"dmesg 命令\"></a>dmesg 命令</h5><p>描述：开机时内核检测信息-硬件信息,dmesg命令被用于检查和控制内核的环形缓冲区，kernel会将开机信息存储在ring buffer中<br>您若是开机时来不及查看信息，可利用dmesg来查看，开机信息保存文件;<br>当有硬盘坏道时，通常在dmesg输出的信息中会有 Buffer I/O Error，所以经常检查dmesg的输出可以及时发现是否存在硬盘问题。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#选项语法</span></span><br><span class=\"line\">dmesg [选项]</span><br><span class=\"line\">选项：</span><br><span class=\"line\"> -C, --clear                 清除内核环形缓冲区(ring butter)</span><br><span class=\"line\"> -c, --<span class=\"built_in\">read</span>-clear            读取并清除所有消息</span><br><span class=\"line\"> -D, --console-off           禁止向终端打印消息</span><br><span class=\"line\"> -d, --show-delta            显示打印消息之间的时间差</span><br><span class=\"line\"> -e, --reltime               以易读格式显示本地时间和时间差</span><br><span class=\"line\"> -E, --console-on            启用向终端打印消息</span><br><span class=\"line\"> -F, --file &lt;文件&gt;           用 文件 代替内核日志缓冲区</span><br><span class=\"line\"> -f, --facility &lt;列表&gt;       将输出限制为定义的设施</span><br><span class=\"line\"> -H, --human                 易读格式输出</span><br><span class=\"line\"> -k, --kernel                显示内核消息</span><br><span class=\"line\"> -L, --color                 显示彩色消息</span><br><span class=\"line\"> -l, --level &lt;列表&gt;          限制输出级别</span><br><span class=\"line\"> -n, --console-level &lt;级别&gt;  设置打印到终端的消息级别</span><br><span class=\"line\"> -P, --nopager               不将输出通过管道传递给分页程序</span><br><span class=\"line\"> -r, --raw                   打印原生消息缓冲区</span><br><span class=\"line\"> -S, --syslog                强制使用 syslog(2) 而非 /dev/kmsg</span><br><span class=\"line\"> -s, --buffer-size &lt;大小&gt;    查询内核环形缓冲区所用的&lt;缓冲区大小&gt;：预设置为8196，刚好等于ring buffer的大小</span><br><span class=\"line\"> -T, --ctime                 显示易读的时间戳(如果您使用了</span><br><span class=\"line\">                                SUSPEND/RESUME 则可能不准)</span><br><span class=\"line\"> -t, --notime                不打印消息时间戳</span><br><span class=\"line\"> -u, --userspace             显示用户空间消息</span><br><span class=\"line\"> -w, --follow                等待新消息</span><br><span class=\"line\"> -x, --decode                将设施和级别解码为可读的字符串</span><br><span class=\"line\"></span><br><span class=\"line\"> -h, --<span class=\"built_in\">help</span>     显示此帮助并退出</span><br><span class=\"line\"> -V, --version  输出版本信息并退出</span><br><span class=\"line\"></span><br><span class=\"line\">支持的日志设施：</span><br><span class=\"line\">    kern - 内核消息</span><br><span class=\"line\">    user - 随机的用户级消息</span><br><span class=\"line\">    mail - 邮件系统</span><br><span class=\"line\">  daemon - 系统守护进程</span><br><span class=\"line\">    auth - 安全/认证消息</span><br><span class=\"line\">  syslog - syslogd 内部生成的消息</span><br><span class=\"line\">     lpr - 行打印机子系统</span><br><span class=\"line\">    news - 网络新闻子系统</span><br><span class=\"line\"></span><br><span class=\"line\">支持的日志级别(优先级)：</span><br><span class=\"line\">   emerg - 系统无法使用</span><br><span class=\"line\">   alert - 操作必须立即执行</span><br><span class=\"line\">    crit - 紧急条件</span><br><span class=\"line\">     err - 错误条件</span><br><span class=\"line\">    warn - 警告条件</span><br><span class=\"line\">  notice - 正常但重要的条件</span><br><span class=\"line\">    info - 信息</span><br><span class=\"line\">   debug - 调试级别的消息</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># cat /var/log/dmesg | grep \"CPU\"</span></span><br><span class=\"line\">/var/<span class=\"built_in\">log</span>/dmesg</span><br></pre></td></tr></table></figure></p>\n<p>实际案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1.信息查看</span></span><br><span class=\"line\">dmesg | grep CPU</span><br><span class=\"line\">dmesg | grep <span class=\"string\">\"Linux version\"</span> </span><br><span class=\"line\">dmesg | head</span><br><span class=\"line\">[    0.000000] Linux version 3.10.0-957.12.2.el7.x86_64 (mockbuild@kbuilder.bsys.centos.org) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-36) (GCC) ) <span class=\"comment\">#1 SMP Tue May 14 21:24:32 UTC 2019</span></span><br><span class=\"line\">[    0.000000] Command line: BOOT_IMAGE=/vmlinuz-3.10.0-957.12.2.el7.x86_64 root=/dev/mapper/centos-root ro crashkernel=auto rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet LANG=zh_CN.UTF-8</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#其他方式查看CPU信息</span></span><br><span class=\"line\">cat /proc/cpuinfo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例2.清除dmesg信息</span></span><br><span class=\"line\">dmesg -c</span><br><span class=\"line\">dmesg -C</span><br></pre></td></tr></table></figure><br><br></p>\n<h5 id=\"lscpu-命令-显示CPU信息实际是美化显示cpuinfo中的内容\"><a href=\"#lscpu-命令-显示CPU信息实际是美化显示cpuinfo中的内容\" class=\"headerlink\" title=\"lscpu 命令  - 显示CPU信息实际是美化显示cpuinfo中的内容\"></a>lscpu 命令  - 显示CPU信息实际是美化显示cpuinfo中的内容</h5><p>描述：查看系统的CPU信息和<code>cat /proc/cpuinfo</code> 输出结果类似。相当于 Linux 下的 CPU-Z </p>\n<p>使用帮助：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">man 1 lscpu</span><br><span class=\"line\"><span class=\"comment\">#参数</span></span><br><span class=\"line\">-e，——extended[=&lt;list&gt;]打印出扩展的可读格式</span><br><span class=\"line\">-p，——parse[=&lt;list&gt;]打印出可解析格式</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#list Available columns:(使用时候小写)</span></span><br><span class=\"line\">           CPU  logical CPU number</span><br><span class=\"line\">          CORE  logical core number</span><br><span class=\"line\">        SOCKET  logical socket number</span><br><span class=\"line\">          NODE  logical NUMA node number</span><br><span class=\"line\">          BOOK  logical book number</span><br><span class=\"line\">        DRAWER  logical drawer number</span><br><span class=\"line\">         CACHE  shows how caches are shared between CPUs</span><br><span class=\"line\">  POLARIZATION  CPU dispatching mode on virtual hardware</span><br><span class=\"line\">       ADDRESS  physical address of a CPU</span><br><span class=\"line\">    CONFIGURED  shows <span class=\"keyword\">if</span> the hypervisor has allocated the CPU</span><br><span class=\"line\">        ONLINE  shows <span class=\"keyword\">if</span> Linux currently makes use of the CPU</span><br><span class=\"line\">        MAXMHZ  shows the maximum MHz of the CPU</span><br><span class=\"line\">        MINMHZ  shows the minimum MHz of the CPU</span><br></pre></td></tr></table></figure></p>\n<p>实际案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1.查看CPU信息</span></span><br><span class=\"line\"><span class=\"variable\">$lscpu</span></span><br><span class=\"line\">Architecture:          x86_64</span><br><span class=\"line\">CPU op-mode(s):        32-bit, 64-bit</span><br><span class=\"line\">Byte Order:            Little Endian <span class=\"comment\">#小端|低位优先</span></span><br><span class=\"line\">CPU(s):                4   <span class=\"comment\">#CPU物理个数</span></span><br><span class=\"line\">On-line CPU(s) list:   0-3 <span class=\"comment\">#CPU逻辑个数</span></span><br><span class=\"line\">Thread(s) per core:    1   <span class=\"comment\">#线程数:每个core有1个threads</span></span><br><span class=\"line\">Core(s) per socket:    1   <span class=\"comment\">#核心数:每个socket有1个cores</span></span><br><span class=\"line\">Socket(s):             4   <span class=\"comment\">#4个sockets</span></span><br><span class=\"line\">NUMA node(s):          1</span><br><span class=\"line\">Vendor ID:             GenuineIntel <span class=\"comment\">#供应商代码</span></span><br><span class=\"line\">CPU family:            6    <span class=\"comment\">#处理器系列 6 代</span></span><br><span class=\"line\">Model:                 85   <span class=\"comment\">#处理器模型 (0x55)</span></span><br><span class=\"line\">Model name:            Intel Xeon Processor (Skylake, IBRS) <span class=\"comment\">#处理器名称</span></span><br><span class=\"line\">Stepping:              4 <span class=\"comment\">#分级鉴别产品数据转换规范，“步进”编号用来标识一系列CPU的设计或生产制造版本数据,标识CPU不同的“修订”;</span></span><br><span class=\"line\">CPU MHz:               2294.614  <span class=\"comment\">#处理器主频</span></span><br><span class=\"line\">BogoMIPS:              4589.22   <span class=\"comment\">#CPU性能测试参数(Bogo是Bogus(伪)的意思；MIPS是每秒百万条指令)</span></span><br><span class=\"line\">Hypervisor vendor:     KVM  <span class=\"comment\">#管理供应商</span></span><br><span class=\"line\">Virtualization <span class=\"built_in\">type</span>:   full <span class=\"comment\">#虚拟化类型</span></span><br><span class=\"line\">L1d cache:             32K  <span class=\"comment\">#1-3级缓存</span></span><br><span class=\"line\">L1i cache:             32K  <span class=\"comment\">#冯诺依曼+哈弗体系结构</span></span><br><span class=\"line\">L2 cache:              4096K</span><br><span class=\"line\">L3 cache:              16384K</span><br><span class=\"line\">NUMA node0 CPU(s):     0-3 <span class=\"comment\">#解决core分组的问题 </span></span><br><span class=\"line\">Flags:                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl xtopology eagerfpu pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch invpcid_single ssbd ibrs ibpb stibp fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm mpx avx512f avx512dq rdseed adx smap clflushopt clwb avx512cd avx512bw avx512vl xsaveopt xsavec xgetbv1 arat pku ospke spec_ctrl intel_stibp</span><br><span class=\"line\"><span class=\"comment\">#threads数计算:4(sockets)×1(node)×1(cores)×1(threads) = 4核4线程</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例2.查询指定CPU扩展信息</span></span><br><span class=\"line\"><span class=\"variable\">$lscpu</span> -a -e=cpu,node,book,core,cache,address,drawer</span><br><span class=\"line\">CPU NODE BOOK CORE L1d:L1i:L2:L3 ADDRESS DRAWER</span><br><span class=\"line\">0   0    -    0    0:0:0:0       -</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例3.格式化查询信息</span></span><br><span class=\"line\"><span class=\"variable\">$lscpu</span> -p=cpu,node,cache</span><br><span class=\"line\"><span class=\"comment\"># The following is the parsable format, which can be fed to other</span></span><br><span class=\"line\"><span class=\"comment\"># programs. Each different item in every column has an unique ID</span></span><br><span class=\"line\"><span class=\"comment\"># starting from zero.</span></span><br><span class=\"line\"><span class=\"comment\"># CPU,Node,L1d:L1i:L2:L3</span></span><br><span class=\"line\">0,0,0:0:0:0</span><br></pre></td></tr></table></figure></p>\n<p>文件 <code>/proc/cpuinfo</code> 信息说明:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat /proc/cpuinfo</span><br><span class=\"line\">processor       : 0   <span class=\"comment\">#处理器序号</span></span><br><span class=\"line\">vendor_id       : GenuineIntel <span class=\"comment\">#处理器生产厂家</span></span><br><span class=\"line\">cpu family      : 6  <span class=\"comment\">#CPU产品系列代号</span></span><br><span class=\"line\">model           : 85 <span class=\"comment\">#CPU属于其系列中的哪一代的代号</span></span><br><span class=\"line\">model name      : Intel Xeon Processor (Skylake, IBRS) <span class=\"comment\">#CPU属于的名字及其编号、标称主频</span></span><br><span class=\"line\">stepping        : 4 <span class=\"comment\">#修订版本</span></span><br><span class=\"line\">microcode       : 0x1</span><br><span class=\"line\">cpu MHz         : 2294.614  <span class=\"comment\">#主频</span></span><br><span class=\"line\">cache size      : 16384 KB</span><br><span class=\"line\">physical id     : 0</span><br><span class=\"line\">siblings        : 1</span><br><span class=\"line\">core id         : 0</span><br><span class=\"line\">cpu cores       : 1</span><br><span class=\"line\">apicid          : 0</span><br><span class=\"line\">initial apicid  : 0</span><br><span class=\"line\">fpu             : yes</span><br><span class=\"line\">fpu_exception   : yes</span><br><span class=\"line\">cpuid level     : 13</span><br><span class=\"line\">wp              : yes</span><br><span class=\"line\">flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl xtopology eagerfpu pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch invpcid_single ssbd ibrs ibpb stibp fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm mpx avx512f avx512dq rdseed adx smap clflushopt clwb avx512cd avx512bw avx512vl xsaveopt xsavec xgetbv1 arat pku ospke spec_ctrl intel_stibp</span><br><span class=\"line\">bogomips        : 4589.22 <span class=\"comment\">#CPU性能值</span></span><br><span class=\"line\">clflush size    : 64</span><br><span class=\"line\">cache_alignment : 64</span><br><span class=\"line\">address sizes   : 46 bits physical, 48 bits virtual</span><br><span class=\"line\">power management:  <span class=\"comment\">#电源管理</span></span><br></pre></td></tr></table></figure></p>\n<p>补充知识: /etc/cpuinfo 参数说明</p>\n<ul>\n<li><p>1.CPU ID:CPU生产厂家为识别不同类型的CPU，而为CPU制订的不同的单一的代码；其CPU ID定义也是不同的；如 “0F24”（Inter处理器）、“681H”（AMD处理器）</p>\n<ul>\n<li><code>Inter处理器的CPU ID是以十六进制表示的:如“0F24”，从左至右分别表示 Type（类型）、Family（系列）、Mode（型号）和Stepping（步进编号）以及新增Brand ID（品种标识）</code></li>\n<li><code>AMD处理器一般分为三位，如“681”，从左至右分别表示为Family（系列）、Mode（型号）和 Stepping（步进编号）.</code> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Type（类型）:类型标识用来区别INTEL微处理器是用于由最终用户安装，还是由专业个人计算机系 统集成商、服务公司或制作商安装；</span><br><span class=\"line\">  - 1.数字“1”标识所测试的微处理器是用于由用户安装的(通常)</span><br><span class=\"line\">  - 2.数字“0”标识所测试的微处理器是用于由专业个人计算机系统集成 商、服务公司或制作商安装的;</span><br><span class=\"line\"></span><br><span class=\"line\">Family（系列）:系列标识可用来确定处理器属于那一代产品;</span><br><span class=\"line\">  - 1.如6系列的INTEL处理器包括Pentium Pro、Pentium II、Pentium II Xeon、Pentium III和Pentium III Xeon处理器,5系列（第五代）包括Pentium处理器和采用 MMX技术的Pentium处理器</span><br><span class=\"line\">  - 2.AMD的6系列实际指有K7系列CPU，有DURON和ATHION两大类</span><br><span class=\"line\"></span><br><span class=\"line\">Mode（型号）:确定处理器的制作技术以及属于该系列的第几代设计（或核心），型号与系列通常是相互配合使用的，用于确定计算机所安装的处理器是属于某系列处理器的哪种特 定类型</span><br><span class=\"line\">  - 1.如可确定Celerom处理器是Coppermine还是Tualutin核心</span><br><span class=\"line\">  - 2.Athlon XP处理器是Paiomino还是 Thorouhgbred核心</span><br><span class=\"line\"></span><br><span class=\"line\">Stepping（步进编号）:步进编号用来标识处理器的设计或制作版本，有助于控制和跟踪处理器的更 改，步进还可以让最终用户更具体地识别其系统安装的处理器版本，确定微处理器的内部设计或制作特性</span><br><span class=\"line\">  - 1.步进编号和核心步进是密切联系的,步进编号就好比处理器的小版本号如CPUID为 “686”和“686A”就好比WINZIP8.0和8.1的关系</span><br><span class=\"line\"></span><br><span class=\"line\">Brand ID（品种标识）</span><br><span class=\"line\">  - INTEL从Coppermine核心的处理器开始引入Brand ID作为CPU的辅助识别手段。</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li><p>2.vendor_id(CPU制造商ID):Intel处理器的vendor字符串为“GenuineIntel”</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CYRIX：CyrixInstead</span><br><span class=\"line\">AMD：AuthenticAMD</span><br><span class=\"line\">UMC：UMC UMC UMC</span><br><span class=\"line\">NEXGEN：NexGenDriven</span><br><span class=\"line\">CENTAUR：CentaurHauls</span><br><span class=\"line\">RISE：RiseRiseRise</span><br><span class=\"line\">TRANSMETA：GenuineTMx86</span><br><span class=\"line\">TRANSMETA：TransmetaCPU</span><br><span class=\"line\">NSC：Geode by NSC</span><br><span class=\"line\">SiS：SiS SiS SiS</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>3.cpu family：CPU产品系列代号，6系列(第六代)包括众多处理器，如<code>Celeron，Pentium 2，Pentium 3，Core i5&amp;i7，Atom系列(E3000t系列、Z3600系列、C2000系列</code>等等)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">“1”表示为8086和80186级芯片；</span><br><span class=\"line\">“2”表示为286级芯片；</span><br><span class=\"line\">“3”表示为386级芯片； </span><br><span class=\"line\">“4”表示为486级芯片(SX、DX、：DX2、DX4)； </span><br><span class=\"line\">“5”表示为P5级芯片(Pentium处理器和含MMX技术的Pentium处理器)；</span><br><span class=\"line\">“6”表示为P6级芯片(包括Celeron、Pentium II、PenfiumIII系列)； </span><br><span class=\"line\">“F”代表Xeon处理器、Pentium 4处理器。</span><br></pre></td></tr></table></figure></li>\n<li>4.CPU属于的名字及其编号、标称主频</li>\n<li>5.model name:CPU属于的名字及其编号、标称主频</li>\n<li>6.stepping:CPU属于制作更新版本</li>\n</ul>\n<p><br></p>\n<h5 id=\"lsmem\"><a href=\"#lsmem\" class=\"headerlink\" title=\"lsmem\"></a>lsmem</h5><p>描述：查看系统内存的信息,使用与lscpu差不多</p>\n<p>实际案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1.查看内存信息</span></span><br><span class=\"line\"><span class=\"variable\">$lsmem</span></span><br><span class=\"line\">RANGE                                 SIZE  STATE REMOVABLE BLOCK</span><br><span class=\"line\">0x0000000000000000-0x000000007fffffff   2G online        no  0-15</span><br><span class=\"line\"></span><br><span class=\"line\">Memory block size:       128M</span><br><span class=\"line\">Total online memory:       2G</span><br><span class=\"line\">Total offline memory:      0B</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例2.输出指定的要查询的内存列</span></span><br><span class=\"line\">lsmem -o STATE,SIZE,ZONES,BLOCK</span><br><span class=\"line\"> STATE SIZE ZONES BLOCK</span><br><span class=\"line\">online   2G     -  0-15</span><br><span class=\"line\"></span><br><span class=\"line\">Memory block size:       128M</span><br><span class=\"line\">Total online memory:       2G</span><br><span class=\"line\">Total offline memory:      0B</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h4 id=\"0x01-系统性能查看\"><a href=\"#0x01-系统性能查看\" class=\"headerlink\" title=\"0x01 系统性能查看\"></a>0x01 系统性能查看</h4><h5 id=\"vmstat-命令\"><a href=\"#vmstat-命令\" class=\"headerlink\" title=\"vmstat 命令\"></a>vmstat 命令</h5><p>描述：显示虚拟内存状态（“Virtual Memor Statics”），但是它可以报告关于进程、内存、I/O等系统整体运行状态。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># vmstat [刷新延时 刷新次数]</span></span><br><span class=\"line\"><span class=\"comment\">#参数：</span></span><br><span class=\"line\">- 时间间隔：状态信息刷新的时间间隔</span><br><span class=\"line\">- 次数：显示报告次数</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190604095713.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p>实际案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1.显示系统信息并刷新三次</span></span><br><span class=\"line\"><span class=\"variable\">$vmstat</span> 1 3</span><br><span class=\"line\"><span class=\"comment\">#显示的数据与TOP差不多</span></span><br><span class=\"line\">procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----</span><br><span class=\"line\"> r  b   swpd   free   buff  cache   si   so    bi    bo   <span class=\"keyword\">in</span>   cs us sy id wa st</span><br><span class=\"line\"> 2  0      0 1392956   3140 368760    0    0     4     2   21   29  0  0 100  0  0</span><br><span class=\"line\"> 0  0      0 1392956   3140 368760    0    0     0     0  193  134  0  0 100  0  0</span><br><span class=\"line\"> 0  0      0 1392988   3140 368756    0    0     0     0   33   34  0  0 100  0  0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># st[(Steal time)虚拟时间百分比]</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190604100232.png\" alt=\"WeiyiGeek.数据说明\" title=\"\" class=\"\">\n                <p>WeiyiGeek.数据说明</p>\n            </figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190604100307.png\" alt=\"WeiyiGeek.SWAP/IO\" title=\"\" class=\"\">\n                <p>WeiyiGeek.SWAP/IO</p>\n            </figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190604100508.png\" alt=\"WeiyiGeek.SYSTEM.CPU\" title=\"\" class=\"\">\n                <p>WeiyiGeek.SYSTEM.CPU</p>\n            </figure></p>\n<p><br></p>\n<h5 id=\"free-命令-列出系统当前内存与swap使用情况\"><a href=\"#free-命令-列出系统当前内存与swap使用情况\" class=\"headerlink\" title=\"free 命令 - 列出系统当前内存与swap使用情况\"></a>free 命令 - 列出系统当前内存与swap使用情况</h5><p>描述:free命令查看内存使用状态,也能查看swap分区启用状况</p>\n<p><em>系统使用的内存与应用使用内存得区别</em>:<br>Buffer(缓冲区)  –   加速写入  –  （缓存于主要项，Inddle等文件夹块）<br>Cached(缓存区) –   加速读取  –  （缓存主要用于打开的文件）</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#基础语法</span></span><br><span class=\"line\">free [-b|-k|-m|-g]</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190604101417.png\" alt=\"WeiyiGeek.free参数\" title=\"\" class=\"\">\n                <p>WeiyiGeek.free参数</p>\n            </figure>\n<p>案例示例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1.以mb显示空间剩余</span></span><br><span class=\"line\">free -m</span><br><span class=\"line\">              total        used        free      shared  buff/cache   available</span><br><span class=\"line\">Mem:           1838         115        1360           8         363        1556</span><br><span class=\"line\">Swap:          2047           0        2047</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#第一行：total时内存数，used是已经使用的内存数，free是空闲的内存数，shared是多个进程共享的内存总数,缓冲/缓冲,可以利用的内存树.</span></span><br><span class=\"line\">关系：total = used + free</span><br><span class=\"line\">系统使用内存 = Total - Free</span><br><span class=\"line\">应用使用内存 = Total -(Free+Cache+Buffer)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#第二部分(-/+ buffers/cache)解释:</span></span><br><span class=\"line\">(-buffers/cache) used内存数：第一部分Mem行中的 used – buffers – cached</span><br><span class=\"line\">(+buffers/cache) free内存数: 第一部分Mem行中的 free + buffers + cached</span><br><span class=\"line\"><span class=\"comment\">#可见-buffers/cache反映的是被程序实实在在吃掉的内存，而+buffers/cache反映的是可以挪用的内存总数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#第三行：total是swap的总数；used是已经使用的swap数，free是空闲的swap数，默认单位KB这里是MB</span></span><br></pre></td></tr></table></figure></p>\n<p>系统使用的内存、应用使用的内存计算:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$awk</span> <span class=\"string\">'/MemTotal/&#123;total=$2&#125; /MemFree/&#123;free=$2&#125;END&#123;print (total-free)/1024i \"MB\"&#125;'</span> /proc/meminfo </span><br><span class=\"line\">576.105MB</span><br><span class=\"line\"></span><br><span class=\"line\">awk <span class=\"string\">'/MemTotal/&#123;total=$2&#125; /MemFree/&#123;free=$2&#125; /^Cached/&#123;cached=$2&#125; /Buffers/&#123;buffers=$2&#125; END&#123; print (total-free-cached-buffers)/1024 \"MB\"&#125;'</span> /proc/meminfo</span><br><span class=\"line\">382.781MB</span><br><span class=\"line\"><span class=\"comment\">#注意这里的Cached需要用正则，因为有重复包含Cached的一</span></span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190617170359.png\" alt=\"WeiyiGeek.内存技术\" title=\"\" class=\"\">\n                <p>WeiyiGeek.内存技术</p>\n            </figure>\n<p><br></p>\n<h5 id=\"uptime-命令\"><a href=\"#uptime-命令\" class=\"headerlink\" title=\"uptime 命令\"></a>uptime 命令</h5><p>描述:uptime命令能够显示系统的启动时间和平均负载，也就是top命令的第一行w命令也可以看这个数据；</p>\n<p>Linux中CPU相关信息说明(<code>重点逻辑cpu个数和物理cpu个数</code>):<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">公式:逻辑CPU个数=物理CPU个数 * 每颗物理CPU的核数 * 超线程数</span><br><span class=\"line\"><span class=\"comment\"># 1.物理CPU个数</span></span><br><span class=\"line\">cat /proc/cpuinfo| grep <span class=\"string\">\"physical id\"</span> | sort | uniq | wc -l</span><br><span class=\"line\"><span class=\"comment\"># 2.查询CPU核心数</span></span><br><span class=\"line\">cat /proc/cpuinfo| grep <span class=\"string\">\"cpu cores\"</span> | uniq</span><br><span class=\"line\"><span class=\"comment\"># 3.逻辑CPU线程 (常用表述) </span></span><br><span class=\"line\">grep -c <span class=\"string\">'processor'</span> /proc/cpuinfo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># CPU型号的查询以及物理CPU和逻辑CPU数目</span></span><br><span class=\"line\">grep name /proc/cpuinfo | cut -f2 -d: | uniq -c</span><br><span class=\"line\"><span class=\"comment\"># 128  Intel(R) Xeon(R) Gold 6130 CPU @ 2.10GHz</span></span><br><span class=\"line\">cat /proc/cpuinfo | grep <span class=\"string\">\"physical id\"</span> | sort | uniq | wc -l   <span class=\"comment\"># 物理 # 4</span></span><br><span class=\"line\">cat /proc/cpuinfo | grep <span class=\"string\">\"core id\"</span> | sort | uniq | wc -l       <span class=\"comment\"># 核心 # 16 </span></span><br><span class=\"line\">cat /proc/cpuinfo | grep <span class=\"string\">\"processor\"</span> | sort | uniq | wc -l     <span class=\"comment\"># 线程 # 128</span></span><br><span class=\"line\"><span class=\"comment\"># 由上可知是 4颗物理CPU, 16核128线程</span></span><br></pre></td></tr></table></figure></p>\n<p><em>那这几个概念区别是什么？</em></p>\n<ul>\n<li>1.CPU：独立的中央处理单元，体现在主板上是有多个CPU的槽位。  </li>\n<li>2.CPU cores：在每一个CPU上都可能有多个核（core），每一个核中都有独立的一套<code>ALU、FPU、Cache</code>等组件，所以这个概念也被称作物理核。  </li>\n<li>3.processor：这个主要得益于超线程技术可以让一个物理核模拟出多个逻辑核即processor，我们常说几核就是说得它;</li>\n</ul>\n<p>简单来说就是，当有多个计算任务时，可以让其中一个计算任务使用ALU的时候另一个则去使用FPU。这样就可以充分利用物理核中的各个部件，使得同一个物理核中也可以并行处理多个计算任务。<br>理论上来说，对于计算密集型的任务，线程数应该和CPU所能提供的并行数一致，补充一下AMDcpu并行执行效率和性能高于Intel处理器，并且AMD为发烧友提供了一定得超频空间；</p>\n<p><em>那这里的“并行数”应该采取物理核数还是processor数呢？</em><br>描述:从下面可以看到线程数超过<code>processor数量（48）或者小于物理核数量（24）</code>，吞吐量都会收到较大影响<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200528234525.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p><em>那么什么是系统平均负载呢？</em><br>答：系统平均负载是指在特定时间间隔内运行队列中的平均进程数， 如果每个CPU内核的当前活动进程数不大于3的话，那么系统的性能是良好的。<br>举个例子:如果每个CPU内核的任务数大于5，那么这台机器的性能有严重问题， 如果你的linux主机是<code>1个双核CPU * 3 = Load Average 为6</code>的时候说明机器已经被充分使用了。</p>\n<p>案例演示：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$uptime</span></span><br><span class=\"line\">10:23:42 up 19:37,  1 user,  load average: 0.00, 0.01, 0.05 <span class=\"comment\">#注意单核CPU一般不要超过5</span></span><br><span class=\"line\"><span class=\"comment\">#uptime命令可以显示的信息显示依次为：现在时间、系统已经运行了多长时间、目前有多少登陆用户、系统在过去的1分钟、5分钟和15分钟内的平均负载。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$w</span></span><br><span class=\"line\">10:23:45 up 19:37,  1 user,  load average: 0.00, 0.01, 0.05</span><br><span class=\"line\">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class=\"line\">root     pts/0    10.10.107.112    08:53    1.00s  0.15s  0.00s w</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190604102453.png\" alt=\"WeiyiGeek.uptime说明\" title=\"\" class=\"\">\n                <p>WeiyiGeek.uptime说明</p>\n            </figure></p>\n<p><br></p>\n<h5 id=\"top-命令\"><a href=\"#top-命令\" class=\"headerlink\" title=\"top 命令\"></a>top 命令</h5><p>描述：可以实时动态地查看系统的整体运行情况，是一个综合了多方信息监测系统性能和运行信息的实用工具，通过top命令所提供的互动式界面，用热键可以管理</p>\n<p>基础语法：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">top -hv | -bcHiOSs -d secs -n max -u|U user -p pid(s) -o field -w [cols]</span><br><span class=\"line\">- 缓冲(buffer)：加速数据的写入write</span><br><span class=\"line\">- 缓存(cached)：加快数据的读取<span class=\"built_in\">read</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">-b：以批处理模式操作；</span><br><span class=\"line\">-c：显示完整的治命令；</span><br><span class=\"line\">-d &lt;时间&gt;：屏幕刷新间隔时间；</span><br><span class=\"line\">-I：忽略失效过程；</span><br><span class=\"line\">-s：保密模式；</span><br><span class=\"line\">-S：累积模式；</span><br><span class=\"line\">-i：使top不显示任何闲置或者僵死进程。</span><br><span class=\"line\">-u&lt;用户名&gt;：指定用户名；</span><br><span class=\"line\">-p&lt;进程号&gt;：指定进程；</span><br><span class=\"line\">-n&lt;次数&gt;：循环显示的次数。</span><br><span class=\"line\">-H: 查看进程的子线程信息</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#top交互命令</span></span><br><span class=\"line\"><span class=\"comment\">#如果在命令行中使用了-s选项， 其中一些命令可能会被屏蔽。</span></span><br><span class=\"line\">h：显示帮助画面，给出一些简短的命令总结说明；</span><br><span class=\"line\">k：终止一个进程；</span><br><span class=\"line\">i：忽略闲置和僵死进程，这是一个开关式命令；</span><br><span class=\"line\">q：退出程序；</span><br><span class=\"line\">r：重新安排一个进程的优先级别；</span><br><span class=\"line\">S：切换到累计模式；</span><br><span class=\"line\">s：改变两次刷新之间的延迟时间（单位为s），如果有小数，就换算成ms。输入0值则系统将不断刷新，默认值是5s；</span><br><span class=\"line\">f或者F：从当前显示中添加或者删除项目；</span><br><span class=\"line\">o或者O：改变显示项目的顺序；</span><br><span class=\"line\">l：切换显示平均负载和启动时间信息；</span><br><span class=\"line\">m：切换显示内存信息；</span><br><span class=\"line\">t：切换显示进程和CPU状态信息；</span><br><span class=\"line\">c：切换显示命令名称和完整命令行；</span><br><span class=\"line\">M：根据驻留内存大小进行排序；</span><br><span class=\"line\">P：根据CPU使用百分比大小进行排序；</span><br><span class=\"line\">T：根据时间/累计时间进行排序；</span><br><span class=\"line\">W: 将当前设置写入~/.toprc文件中。这是写top配置文件的推荐方法。</span><br></pre></td></tr></table></figure></p>\n<p>实际案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#实际输出值解释：</span></span><br><span class=\"line\"><span class=\"variable\">$top</span></span><br><span class=\"line\"><span class=\"comment\"># top - 15:21:39 up 1 day,  4:45,  1 user,  load average: 0.00, 0.01, 0.05</span></span><br><span class=\"line\"><span class=\"comment\"># Tasks: 159 total,   1 running, 158 sleeping,   0 stopped,   0 zombie</span></span><br><span class=\"line\"><span class=\"comment\"># %Cpu(s):  6.2 us,  0.0 sy,  0.0 ni, 93.8 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span></span><br><span class=\"line\"><span class=\"comment\"># KiB Mem :  1882620 total,  1399708 free,   124212 used,   358700 buff/cache</span></span><br><span class=\"line\"><span class=\"comment\"># KiB Swap:  2097148 total,  2097148 free,        0 used.  1584276 avail Mem</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#   PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND</span></span><br><span class=\"line\"><span class=\"comment\">#     1 root      20   0  125436   3952   2608 S  0.0  0.2   0:01.82 systemd</span></span><br></pre></td></tr></table></figure></p>\n<ol>\n<li>第一排：<blockquote>\n<p>top - 09:44:56[当前系统时间],16 days[系统已经运行了16天],1 user[个用户当前登录],load average: 9.59, 4.75, 1.92[系统负载，即任务队列的平均长度]</p>\n</blockquote>\n</li>\n</ol>\n<ul>\n<li>1分前平均负载 5分前平均负载 15分前平均负载：平均负载指的是15分钟内内存和CPU占比的平均值这个值多大算好</li>\n<li>应该按CPU的核数来判断,如果是2核这个数不应该大于2,如果是4核不应该大于4,如果大于4其他指标都正常这个值也没问题；</li>\n</ul>\n<ol start=\"2\">\n<li>第二排：<blockquote>\n<p>Tasks: 145 total[总进程数],2 running[正在运行的进程数],143 sleeping[睡眠的进程数],0 stopped[停止的进程数],0 zombie[冻结/僵尸进程数]</p>\n</blockquote>\n</li>\n</ol>\n<ol start=\"3\">\n<li>第三排：<blockquote>\n<p>Cpu(s):<br>6.2%us[用户空间占用CPU百分比], 通常用户态 CPU 高表示有应用程序比较繁忙;<br>0.1%sy[内核空间占用CPU百分比], 通常内核态 CPU 越低越好，否则表示系统存在某些瓶颈<br>0.0%ni[用户进程空间内改变过优先级的进程占用CPU百分比],nice 是一个进程优先级的修正值，如果进程通过它修改了优先级，则会单独统计 CPU 开销<br>0.2%id[空闲CPU百分比], 此时CPU 会执行一个特定的虚拟进程，名为 System Idle Process。<br>0.0%wa[等待I/O操作完成所花费的时间],通常该指标越低越好，否则表示 I/O 存在瓶颈，可以用 iostat 等命令做进一步分析。<br>0.0%hi[硬hard中断请求服务占用百分比],<code>硬中断是由外设硬件（如键盘控制器、硬件传感器等）发出的，需要有中断控制器参与，特点是快速执行</code>。<br>0.0%si[软soft中断请求服务占用百分比],<code>软中断是由软件程序（如网络收发、定时调度等）发出的中断信号，特点是延迟执行</code>。<br>0.0%st[(Steal time)被虚拟占用时间百分比]，仅出现在多虚拟机场景，如果该指标过高，可以检查下宿主机或其他虚拟机是否异常。</p>\n</blockquote>\n</li>\n</ol>\n<ol start=\"4\">\n<li>第四排：单位KB<blockquote>\n<p>Mem: 4147888k total[物理physical内存总量],<br>2493092k used[使用的物理内存总量],<br>1654796k free[空闲内存总量],<br>158188k buffers[用作内核缓冲的内存量]</p>\n</blockquote>\n</li>\n</ol>\n<ol start=\"5\">\n<li><p>第五排：</p>\n<blockquote>\n<p>Swap:5144568k total[交换区总量],<br>56k used[使用的交换区总量],<br>5144512k free[空闲内存总量],<br>2013180k cached[缓存的交换区总量];内存中的内容被换出到交换区，然后又被换入到内存，但是使用过的交换区没有被覆盖，交换区的这些内容已存在于内存中的交换区的大小，相应的内存再次被换出时可不必再对交换区写入。</p>\n</blockquote>\n</li>\n<li><p>第六排:进程信息区</p>\n<blockquote>\n<p>PID:进程id<br>PPID:父进程id<br>RUSER:Real user name（看了好多，都是这样写，也不知道和user有什么区别，欢迎补充此处）<br>UID:进程所有者的id<br>USER:进程所有者的用户名<br>GROUP:进程所有者的组名<br>TTY:启动进程的终端名。不是从终端启动的进程则显示为?<br>PR:优先级<br>NI:nice值<code>负值表示高优先级，正值表示低优先级</code><br>P:最后使用的CPU，仅在多CPU环境下有意义<br>%CPU:上次更新到现在的CPU时间占用百分比<br>TIME:进程使用的CPU时间总计，单位秒<br>TIME+：进程所使用的CPU时间总计，单位1/100秒<br>%MEM:进程使用的物理内存百分比<br>VIRT:进程使用的虚拟内存总量，单位kb。VIRT=SWAP+RES<br>SWAP:进程使用的虚拟内存中被被换出的大小<br>RES:进程使用的、未被换出的物理内存的大小<br>CODE:可执行代码占用的物理内存大小<br>DATA:可执行代码以外的部分（数据段+栈）占用的物理内存大小<br>SHR:共享内存大小<br>nFLT:页面错误次数<br>nDRT:最后一次写入到现在，被修改过的页面数<br>S:进程状态:<code>D=不可中断的睡眠状态，R=运行，S=睡眠，T=跟踪/停止，Z=僵尸进程</code><br>COMMAND:命令名/行<br>WCHAN:若该进程在睡眠，则显示睡眠中的系统函数名<br>Flags:任务标志</p>\n</blockquote>\n</li>\n</ol>\n<p><strong>基础实例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1.进入执行top命令然后按1即可显示每个CPU使用及其负载情况；</span></span><br><span class=\"line\">PS:这里看到的CPU0~CPUn数量其实是processor数即逻辑CPU。</span><br><span class=\"line\">top</span><br><span class=\"line\"><span class=\"comment\"># top - 23:04:20 up 1 day,  7:01,  1 user,  load average: 0.00, 0.01, 0.05</span></span><br><span class=\"line\"><span class=\"comment\"># Tasks: 135 total,   1 running, 134 sleeping,   0 stopped,   0 zombie</span></span><br><span class=\"line\"><span class=\"comment\"># %Cpu0  :  0.3 us,  0.3 sy,  0.0 ni, 99.3 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span></span><br><span class=\"line\"><span class=\"comment\"># %Cpu1  :  0.3 us,  0.3 sy,  0.0 ni, 99.3 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span></span><br><span class=\"line\"><span class=\"comment\"># %Cpu2  :  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span></span><br><span class=\"line\"><span class=\"comment\"># %Cpu3  :  0.3 us,  0.3 sy,  0.0 ni, 99.3 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例2.输出top信息到文件批处理方式</span></span><br><span class=\"line\"><span class=\"variable\">$top</span> -b -n 1</span><br><span class=\"line\"><span class=\"variable\">$top</span> -d 5  <span class=\"comment\">#刷新间隔</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例3.TOP中交互参数的使用 (注意大小写)</span></span><br><span class=\"line\">N:以PID排序（从大到小）</span><br><span class=\"line\">k:终止进程</span><br><span class=\"line\">m:内存信息</span><br><span class=\"line\">t:cpu信息</span><br><span class=\"line\">KiB Mem : 16.2/1882620  [     ]</span><br><span class=\"line\">KiB Swap:  0.0/2097148  [     ]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例4.利用top命令查看优先级:</span></span><br><span class=\"line\">NI      进程优先级-数值越大，占用CPU时间越少.</span><br><span class=\"line\">+---&lt;   高优先级</span><br><span class=\"line\">+---N   低优先级</span><br><span class=\"line\">+---L   有些页被锁进内存</span><br><span class=\"line\">+---s   包含子进程</span><br><span class=\"line\">+---+   位于后台的进程组；</span><br><span class=\"line\">+---l   多线程，克隆线程  multi-threaded (using CLONE_THREAD, likeNPTL pthreads <span class=\"keyword\">do</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#实例5.显示子进程</span></span><br><span class=\"line\"><span class=\"variable\">$top</span> -Hp 8607</span><br><span class=\"line\">PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND</span><br><span class=\"line\">8608 root      20   0  114692  23364   6356 S  0.3  0.6   1:36.69 frps</span><br><span class=\"line\">8607 root      20   0  114692  23364   6356 S  0.0  0.6   0:14.23 frps</span><br><span class=\"line\">8609 root      20   0  114692  23364   6356 S  0.0  0.6   0:48.21 frps</span><br><span class=\"line\">8610 root      20   0  114692  23364   6356 S  0.0  0.6   0:47.08 frps</span><br></pre></td></tr></table></figure></p>\n<p><strong>补充:如何正确理解 CPU 使用率和平均负载的关系？</strong><br>简述:<code>CPU（Central Processing Unit）</code>是计算机系统的运算和控制核心，是信息处理、程序运行的最终执行单元，相当于系统的“大脑”</p>\n<p><em>什么是CPU 的物理核与逻辑核?</em></p>\n<blockquote>\n<p>一台机器可能包含多块 CPU 芯片之间通过系统总线通信，而一块 CPU 芯片可能包含多个物理核，每个物理核都是一个实打实的运算核心（包括运算器、存储器等）。</p>\n</blockquote>\n<p>衍生知识超线程（Hyper-Threading）</p>\n<blockquote>\n<p>该技术可以让一个物理核在单位时间内<code>同时处理两个线程，变成两个逻辑核</code>。但它不会拥有传统单核 2 倍的处理能力，也不可能提供完整的并行处理能力。</p>\n</blockquote>\n<p>举个例子，假设一个 CPU 芯片就是一个班级；它有 2 个物理核，也就是 2 个同学，老师让他们分别担任班长和体育委员；过了一段时间，校长要求每个班级还要有学习委员和生活委员，理论上还需要 2 位同学，但是这个班级只有 2 个人，最后老师只能让班长和体育委员兼任。<br>这样一来，对于不了解的人来说，这个班级有班长、体育委员、学习委员和生活委员 4 个职位，应该有 4 个人，每个职位就是一个逻辑核；但是，实际上这个班级只有 2 位同学，也就是只有 2 个物理核，虽然他们可以做 4 份工作，但是不能把他们当做 4 个人。</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200412120141.png\" alt=\"WeiyiGeek.Hyper-Threading实例\" title=\"\" class=\"\">\n                <p>WeiyiGeek.Hyper-Threading实例</p>\n            </figure>\n<p><em>如何查询 CPU 信息？</em><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#查看 CPU 个数：</span></span><br><span class=\"line\">cat /proc/cpuinfo | grep <span class=\"string\">'physical id'</span> | sort | uniq | wc -l</span><br><span class=\"line\"><span class=\"comment\">#查看 CPU 物理核数：</span></span><br><span class=\"line\">cat /proc/cpuinfo | grep <span class=\"string\">'cpu cores'</span> | sort | uniq</span><br><span class=\"line\"><span class=\"comment\">#查看 CPU 逻辑核数：</span></span><br><span class=\"line\">cat /proc/cpuinfo | grep <span class=\"string\">'siblings'</span> | sort | uniq</span><br></pre></td></tr></table></figure></p>\n<p><em>什么是 CPU 使用率？</em><br>描述:CPU 使用率就是 CPU 非空闲态运行的时间占比，它反映了 CPU 的繁忙程度;</p>\n<blockquote>\n<p>比如单核 CPU 1s 内非空闲态运行时间为 0.8s，那么它的 CPU 使用率就是 80%；<br>比如双核 CPU 1s 内非空闲态运行时间分别为 0.4s 和 0.6s，那么总体 CPU 使用率就是 <code>(0.4s + 0.6s) / (1s * 2) = 50%</code>，其中 2 表示 CPU 核数，多核 CPU 同理。</p>\n</blockquote>\n<p>使用 top 查看 CPU 使用情况：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#参数解释看前面</span></span><br><span class=\"line\">%Cpu(s):  0.0 us,  0.0 sy,  0.0 ni, 99.9 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br></pre></td></tr></table></figure><br>由于 CPU 有多种非空闲态，因此 CPU 使用率计算公式可以总结为：<code>CPU 使用率 = (1 - 空闲态运行时间/总运行时间) * 100%</code>；根据经验法则建议生产系统的 CPU 总使用率不要超过 70%，但是注意与核心数有关。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(1 - 99.9%) * 100% = 0.1%</span><br></pre></td></tr></table></figure></p>\n<p><em>什么是平均负载？</em><br>描述:平均负载（Load Average）是指单位时间内，系统处于 <code>可运行状态（Running / Runnable） 和 不可中断态 的平均进程数</code>，也就是平均活跃进程数。</p>\n<blockquote>\n<p>可运行状态:正在使用 CPU 或者等待 CPU 的进程;<br>不可中断态:是指处于内核态关键流程中的进程，并且该流程不可被打断;<code>本质上是系统对进程和硬件设备的一种保护机制。</code></p>\n</blockquote>\n<p>比如：当进程向磁盘写数据时，如果被打断，就可能出现磁盘数据与进程数据不一致。</p>\n<p>使用 top 命令查看平均负载该值越小，表示系统工作量越少，负荷越低；反之负荷越高。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#表示 1分钟、5分钟、15分钟内系统的平均负载</span></span><br><span class=\"line\">load average: 0.00, 0.01, 0.05</span><br></pre></td></tr></table></figure></p>\n<p>理想情况下每个 CPU 应该满负荷工作，并且没有等待进程，此时<code>平均负载 = CPU 逻辑核数</code>。但是在实际生产系统中，不建议系统满负荷运行。<br>通用的经验法则是：<code>平均负载 = 0.7 * CPU 逻辑核数</code>,此处以单核CPU为例。</p>\n<ul>\n<li>当平均负载持续大于 0.7 * CPU 逻辑核数，就需要开始调查原因，防止系统恶化；</li>\n<li>当平均负载持续大于 1.0 * CPU 逻辑核数，必须寻找解决办法，降低平均负载；</li>\n<li>当平均负载持续大于 5.0 * CPU 逻辑核数，表明系统已出现严重问题，长时间未响应，或者接近死机。</li>\n</ul>\n<p>平均负载的变化趋势两层含义: 一是 load1、load5、load15 之间的变化趋势, 二是历史的变化趋势;</p>\n<ul>\n<li>当 load1、load5、load15 三个值非常接近，<code>表明短期内系统负载比较平稳。此时，应该将其与昨天或上周同时段的历史负载进行比对，观察是否有显著上升</code>。</li>\n<li>当 load1 远小于 load5 或 load15 时，<code>表明系统最近 1 分钟的负载在降低，而过去 5 分钟或 15 分钟的平均负载却很高</code>。</li>\n<li>当 load1 远大于 load5 或 load15 时，<code>表明系统负载在急剧升高，如果不是临时性抖动，而是持续升高，特别是当 load5 都已超过 0.7 * CPU 逻辑核数时，应调查原因，降低系统负载</code>。</li>\n</ul>\n<p><em>CPU 使用率与平均负载的关系总结</em></p>\n<blockquote>\n<p>1.CPU 使用率是单位时间内 CPU 繁忙程度的统计<br>2.平均负载不仅包括正在使用 CPU 的进程，还包括等待 CPU 或 I/O 的进程</p>\n</blockquote>\n<p>因此，两者不能等同，有两种常见的场景如下所述：</p>\n<ul>\n<li><code>CPU 密集型应用</code>，大量进程在等待或使用 CPU，此时 CPU 使用率与平均负载呈正相关状态。</li>\n<li><code>I/O 密集型应用</code>，大量进程在等待 I/O，此时平均负载会升高，但 CPU 使用率不一定很高。</li>\n</ul>\n<p>例子：假设现在有一个电话亭，有 4 个人在等待打电话，电话亭同一时刻只能容纳 1 个人打电话，只有拿起电话筒才算是真正使用。<br>那么 CPU 使用率就是<code>拿起电话筒的时间占比</code>，它只取决于在电话亭里的人的行为，与平均负载没有非常直接的关系。而<code>平均负载是指在电话亭里的人加上排队的总人数</code>，如下图所示:</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200412123205.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n<p><br></p>\n<h5 id=\"htop-命令\"><a href=\"#htop-命令\" class=\"headerlink\" title=\"htop 命令\"></a>htop 命令</h5><p>描述：htop 是Linux系统中的一个互动的进程查看器，一个文本模式的应用程序(在控制台或者X终端中)，需要ncurses。<br>与Linux传统的top相比，htop更加人性化。它可让用户交互式操作，支持颜色主题，可横向或纵向滚动浏览进程列表，并支持鼠标操作。<br>优点：</p>\n<ul>\n<li>可以横向或纵向滚动浏览进程列表，以便看到所有的进程和完整的命令行。</li>\n<li>在启动上，比top 更快。</li>\n<li>杀进程时不需要输入进程号。</li>\n<li>htop 支持鼠标操作。</li>\n<li>top 已经很老了。</li>\n</ul>\n<p>htop 官网：<a href=\"http://htop.sourceforge.net/\" target=\"_blank\" rel=\"noopener\">http://htop.sourceforge.net/</a></p>\n<p>htop安装：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#Centos Yum安装</span></span><br><span class=\"line\">yum install -y htop</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Debian/Ubuntu 自带htop</span></span><br></pre></td></tr></table></figure></p>\n<p>htop语法和参数:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#命令行</span></span><br><span class=\"line\">-d --delay=DELAY　　　　 设置延迟更新时间，单位秒</span><br><span class=\"line\">-h --<span class=\"built_in\">help</span>　　　　　　  　　 显示htop 命令帮助信息</span><br><span class=\"line\">-u --user=USERNAME　　  只显示一个给定的用户的过程</span><br><span class=\"line\">-p --pid=PID,PID…　　　    只显示给定的PIDs</span><br><span class=\"line\">-s --sort-key COLUMN　    依此列来排序</span><br><span class=\"line\">-v –version　　　　　　　   显示版本信息</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#交互式</span></span><br><span class=\"line\">Shortcut Key \tFunction Key \tDescription \t中文说明</span><br><span class=\"line\">h, ? \tF1 \tInvoke htop Help \t查看htop使用说明</span><br><span class=\"line\">S \tF2 \tHtop Setup Menu \thtop 设定</span><br><span class=\"line\">/ \tF3 \tSearch <span class=\"keyword\">for</span> a Process \t搜索进程  <span class=\"comment\">#常用</span></span><br><span class=\"line\">\\ \tF4 \tIncremental process filtering \t增量进程过滤器 <span class=\"comment\">#常用</span></span><br><span class=\"line\">t \tF5 \tTree View \t显示树形结构 <span class=\"comment\">#常用</span></span><br><span class=\"line\">&lt;, &gt; \tF6 \tSort by a column \t选择排序方式</span><br><span class=\"line\">[ \tF7 \tNice - (change priority) \t可减少nice值，这样就可以提高对应进程的优先级</span><br><span class=\"line\">] \tF8 \tNice + (change priority) \t可增加nice值，这样就可以降低对应进程的优先级</span><br><span class=\"line\">k \tF9 \tKill a Process \t可对进程传递信号</span><br><span class=\"line\">q \tF10 \tQuit htop \t结束htop</span><br><span class=\"line\">上下键或PgUP, PgDn <span class=\"comment\">#选定想要的进程，左右键或Home, End 移动字段，当然也可以直接用鼠标选定进程；</span></span><br><span class=\"line\">Space    标记/取消标记一个进程。命令可以作用于多个进程，例如 <span class=\"string\">\"kill\"</span>，将应用于所有已标记的进程</span><br><span class=\"line\">U    取消标记所有进程</span><br><span class=\"line\">s    选择某一进程，按s:用strace追踪进程的系统调用</span><br><span class=\"line\">l    显示进程打开的文件: 如果安装了lsof，按此键可以显示进程所打开的文件</span><br><span class=\"line\">I    倒转排序顺序，如果排序是正序的，则反转成倒序的，反之亦然</span><br><span class=\"line\">+, -    When <span class=\"keyword\">in</span> tree view mode, expand or collapse subtree. When a subtree is collapsed a <span class=\"string\">\"+\"</span> sign shows to the left of the process name.</span><br><span class=\"line\">a (在有多处理器的机器上)    设置 CPU affinity: 标记一个进程允许使用哪些CPU</span><br><span class=\"line\">u    显示特定用户进程</span><br><span class=\"line\">M    按Memory 使用排序</span><br><span class=\"line\">P    按CPU 使用排序</span><br><span class=\"line\">T    按Time+ 使用排序</span><br><span class=\"line\">F    跟踪进程: 如果排序顺序引起选定的进程在列表上到处移动，让选定条跟随该进程。这对监视一个进程非常有用：通过这种方式，你可以让一个进程在屏幕上一直可见。使用方向键会停止该功能。</span><br><span class=\"line\">K    显示/隐藏内核线程</span><br><span class=\"line\">H    显示/隐藏用户线程</span><br><span class=\"line\">Ctrl-L    刷新</span><br><span class=\"line\">Numbers    PID 查找: 输入PID，光标将移动到相应的进程上</span><br></pre></td></tr></table></figure></p>\n<p>基础实例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1.只显示root用户进程信息</span></span><br><span class=\"line\">htop -u root</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#上面左上角显示CPU、内存、交换区的使用情况，右边显示任务、负载、开机时间，下面就是进程实时状况。</span></span><br><span class=\"line\"><span class=\"comment\">#下面是 F1~F10 的功能和对应的字母快捷键。</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20190819123847.png\" alt=\"WeiyiGeek.htop\" title=\"\" class=\"\">\n                <p>WeiyiGeek.htop</p>\n            </figure></p>\n<p>htop配置设定:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#鼠标点击Setup或者按下F2之后进入htop设定的页面</span></span><br><span class=\"line\">Meters <span class=\"comment\">#页面设定了顶端的一些信息显示，顶端的显示又分为左右两侧,选择新增显示新增到上方左侧（F5）或是右侧（F6）</span></span><br><span class=\"line\">Display option <span class=\"comment\">#显示选项可要根据管理者自己的需要来设定。</span></span><br><span class=\"line\">Color <span class=\"comment\">#配色方案除了基本的颜色显示之外，还提供了换面板的功能;</span></span><br><span class=\"line\">Columns <span class=\"comment\">#在一般htop 指令进来希望可以看到的什么样的数据及信息，字段的调整可以在这边做个人化的设定</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20190819124835.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p>补充：也许你用惯了top，我们也可以用top来打开htop。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#添加一个别名来解决编辑/root/.bashrc文件，添加如下代码</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -f /usr/<span class=\"built_in\">local</span>/bin/htop ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">alias</span> top=’/usr/<span class=\"built_in\">local</span>/bin/htop’</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"built_in\">source</span> /root/.bashrc</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h5 id=\"bashtop-命令\"><a href=\"#bashtop-命令\" class=\"headerlink\" title=\"bashtop 命令\"></a>bashtop 命令</h5><p>描述: bashtop 相比于 htop 有种王者的气息，其炫酷无比, 它是一个二进制 shell可执行文件, 直接使用 curl 或者 wget 命令下载到本地并赋予 +x 权限即可;</p>\n<p>安装地址:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 科学地址</span></span><br><span class=\"line\">curl -fsSL https://raw.githubusercontent.com/aristocratos/bashtop/master/bashtop -o /usr/bin/bashtop &amp;&amp; chmod +x /usr/bin/bashtop</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 国内推荐使用 jsdelivr.net CDN</span></span><br><span class=\"line\">curl -fsSL https://cdn.jsdelivr.net/gh/aristocratos/bashtop/bashtop -o /usr/bin/bashtop ;chmod +x /usr/bin/bashtop</span><br></pre></td></tr></table></figure></p>\n<p>注意事项:</p>\n<ul>\n<li>(1) Bash版本需要在4.4及以上进行使用否则运行将会提示<code>ERROR: Bash 4.4 or later is required (you are using Bash 4.2).</code></li>\n</ul>\n<p><br></p>\n<h4 id=\"0x02-系统内核模块查看修改\"><a href=\"#0x02-系统内核模块查看修改\" class=\"headerlink\" title=\"0x02 系统内核模块查看修改\"></a>0x02 系统内核模块查看修改</h4><h5 id=\"sysctl-命令\"><a href=\"#sysctl-命令\" class=\"headerlink\" title=\"sysctl 命令\"></a>sysctl 命令</h5><p>描述：sysctl命令被用于在内核运行时动态地修改内核的运行参数，可用的内核参数在目录/proc/sys中,用sysctl可以读取设置超过五百个系统变量。<br>它包含一些TCP/ip堆栈和虚拟内存系统的高级选项,这可以让有经验的管理员提高引人注目的系统性能。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#语法</span></span><br><span class=\"line\">sysctl (选项) (参数)  <span class=\"comment\">#变量=值：设置内核参数对应的变量值。</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190604103912.png\" alt=\"WeiyiGeek.参数\" title=\"\" class=\"\">\n                <p>WeiyiGeek.参数</p>\n            </figure></p>\n<p>实际案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1. 查看所有可读变量</span></span><br><span class=\"line\">sysctl -a | head</span><br><span class=\"line\"><span class=\"comment\"># abi.vsyscall32 = 1</span></span><br><span class=\"line\">sysctl -a -n | more</span><br><span class=\"line\"><span class=\"comment\"># 1  #仅仅打印值</span></span><br><span class=\"line\">sysctl -a -N | more</span><br><span class=\"line\"><span class=\"comment\"># abi.vsyscall32 #仅仅打印名称</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例2.读一个指定的变量，例如abi.vsyscall32： </span></span><br><span class=\"line\">sysctl abi.vsyscall32</span><br><span class=\"line\">abi.vsyscall32 = 1</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例3.设置一个指定的内核变量</span></span><br><span class=\"line\">sysctl kernel.maxfiles=5000  <span class=\"comment\">#要设置一个指定的变量，直接用variable=value这样的语法：</span></span><br><span class=\"line\">kern.maxfiles: 2088 -&gt; 5000</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例4.使用sysctl修改系统变量，也可以通过编辑sysctl.conf文件来修改系统变量，/etc/sysctl.conf看起来很像rc.conf</span></span><br><span class=\"line\">sysctl -w net.ipv4.tcp_max_syn_backlog=256   <span class=\"comment\">#设置环境变量</span></span><br><span class=\"line\">sysctl -p   <span class=\"comment\">#立马生效,默认在/etc/sysctl.conf,也可以已自己指定配置文件</span></span><br><span class=\"line\"><span class=\"comment\"># sysctl变量的设置通常是字符串、数字或者布尔型，（布尔型(Boole)用 1 来表示'yes'，用 0 来表示'no'）。</span></span><br><span class=\"line\">sysctl -w kernel.sysrq=0 </span><br><span class=\"line\">sysctl -w kernel.core_uses_pid=1 </span><br><span class=\"line\">sysctl -w net.ipv4.conf.default.accept_redirects=0 </span><br><span class=\"line\">sysctl -w net.ipv4.conf.default.accept_source_route=0 </span><br><span class=\"line\">sysctl -w net.ipv4.conf.default.rp_filter=1 </span><br><span class=\"line\">sysctl -w net.ipv4.tcp_syncookies=1 </span><br><span class=\"line\">sysctl -w net.ipv4.tcp_max_syn_backlog=2048 </span><br><span class=\"line\">sysctl -w net.ipv4.tcp_fin_timeout=30 </span><br><span class=\"line\">sysctl -w net.ipv4.tcp_synack_retries=2 </span><br><span class=\"line\">sysctl -w net.ipv4.tcp_keepalive_time=3600 </span><br><span class=\"line\">sysctl -w net.ipv4.tcp_window_scaling=1 </span><br><span class=\"line\">sysctl -w net.ipv4.tcp_sack=1</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例5.如果希望屏蔽别人 ping 你的主机，则加入以下代码</span></span><br><span class=\"line\"><span class=\"comment\"># Disable ping requests </span></span><br><span class=\"line\">sysctl -w net.ipv4.icmp_echo_ignore_all=1</span><br><span class=\"line\">sysctl -w net.ipv4.ip_default_ttl=215  <span class=\"comment\">#设置默认的ping的TTL值</span></span><br><span class=\"line\"><span class=\"comment\">#编辑完成后，请执行以下命令使变动立即生效：</span></span><br><span class=\"line\">/sbin/sysctl -p </span><br><span class=\"line\">/sbin/sysctl -w net.ipv4.route.flush=1</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190604105034.png\" alt=\"WeiyiGeek.案例测试\" title=\"\" class=\"\">\n                <p>WeiyiGeek.案例测试</p>\n            </figure></p>\n<p>补充：编辑sysctl配置文件来改变系统内核模块 /etc/sysctl.conf (可直接更改参数)</p>\n<p><br/></p>\n<h5 id=\"lsmod-命令\"><a href=\"#lsmod-命令\" class=\"headerlink\" title=\"lsmod 命令\"></a>lsmod 命令</h5><p>功能：该命令用于显示已经加载到内核中的模块的状态信息(<code>列出系统内核模块</code>-在做grub引导时候您会遇见它), 以美观的方式列出/proc/modules的内容。</p>\n<p>实际案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1.lsmod 介绍</span></span><br><span class=\"line\"><span class=\"variable\">$lsmod</span> | more</span><br><span class=\"line\">Module(模块名)    Size(模块大小)   Used by(被…使用)</span><br><span class=\"line\"><span class=\"comment\"># dm_mod                124501  0</span></span><br><span class=\"line\"><span class=\"comment\"># nls_utf8               12557  0</span></span><br><span class=\"line\"><span class=\"comment\"># isofs                  39844  0</span></span><br><span class=\"line\"><span class=\"comment\"># nfit                   55479  0</span></span><br><span class=\"line\"><span class=\"comment\"># libnvdimm             155545  1 nfit</span></span><br><span class=\"line\"><span class=\"comment\"># iosf_mbi               15582  0</span></span><br><span class=\"line\"><span class=\"comment\"># crc32_pclmul           13133  0</span></span><br><span class=\"line\"><span class=\"comment\"># ghash_clmulni_intel    13273  0</span></span><br><span class=\"line\"><span class=\"comment\"># ppdev                  17671  0</span></span><br><span class=\"line\"><span class=\"comment\"># aesni_intel           189456  0</span></span><br><span class=\"line\"><span class=\"comment\"># lrw                    13286  1 aesni_intel</span></span><br><span class=\"line\"><span class=\"comment\"># gf128mul               15139  1 lrw</span></span><br><span class=\"line\"><span class=\"comment\"># glue_helper            13990  1 aesni_intel</span></span><br><span class=\"line\"><span class=\"comment\"># sg                     40719  0</span></span><br><span class=\"line\"><span class=\"comment\"># ablk_helper            13597  1 aesni_intel</span></span><br><span class=\"line\"><span class=\"comment\"># cryptd                 21190  3 ghash_clmulni_intel,aesni_intel,ablk_helper</span></span><br><span class=\"line\"><span class=\"comment\"># i2c_piix4              22401  0</span></span><br><span class=\"line\"><span class=\"comment\"># parport_pc             28205  0</span></span><br><span class=\"line\"><span class=\"comment\"># parport                46395  2 ppdev,parport_pc</span></span><br><span class=\"line\"><span class=\"comment\"># virtio_balloon         18015  0</span></span><br><span class=\"line\"><span class=\"comment\"># joydev                 17389  0</span></span><br><span class=\"line\"><span class=\"comment\"># pcspkr                 12718  0</span></span><br><span class=\"line\"><span class=\"comment\"># ip_tables              27126  0</span></span><br><span class=\"line\"><span class=\"comment\"># xfs                   993020  1</span></span><br><span class=\"line\"><span class=\"comment\"># libcrc32c              12644  1 xfs</span></span><br><span class=\"line\"><span class=\"comment\"># sr_mod                 22416  0</span></span><br><span class=\"line\"><span class=\"comment\"># cdrom                  42556  1 sr_mod</span></span><br><span class=\"line\"><span class=\"comment\"># ata_generic            12923  0</span></span><br><span class=\"line\"><span class=\"comment\"># pata_acpi              13053  0</span></span><br><span class=\"line\"><span class=\"comment\"># virtio_net             28063  0</span></span><br><span class=\"line\"><span class=\"comment\"># virtio_console         28076  1</span></span><br><span class=\"line\"><span class=\"comment\"># virtio_blk             18323  2</span></span><br><span class=\"line\"><span class=\"comment\"># cirrus                 24171  1</span></span><br><span class=\"line\"><span class=\"comment\"># drm_kms_helper        186531  1 cirrus</span></span><br><span class=\"line\"><span class=\"comment\"># syscopyarea            12529  1 drm_kms_helper</span></span><br><span class=\"line\"><span class=\"comment\"># sysfillrect            12701  1 drm_kms_helper</span></span><br><span class=\"line\"><span class=\"comment\"># sysimgblt              12640  1 drm_kms_helper</span></span><br><span class=\"line\"><span class=\"comment\"># fb_sys_fops            12703  1 drm_kms_helper</span></span><br><span class=\"line\"><span class=\"comment\"># ttm                    96673  1 cirrus</span></span><br><span class=\"line\"><span class=\"comment\"># drm                   456166  4 ttm,drm_kms_helper,cirrus</span></span><br><span class=\"line\"><span class=\"comment\"># ata_piix               35052  0</span></span><br><span class=\"line\"><span class=\"comment\"># crct10dif_pclmul       14307  0</span></span><br><span class=\"line\"><span class=\"comment\"># crct10dif_common       12595  1 crct10dif_pclmul</span></span><br><span class=\"line\"><span class=\"comment\"># libata                243133  3 pata_acpi,ata_generic,ata_piix</span></span><br><span class=\"line\"><span class=\"comment\"># crc32c_intel           22094  1</span></span><br><span class=\"line\"><span class=\"comment\"># serio_raw              13434  0</span></span><br><span class=\"line\"><span class=\"comment\"># virtio_pci             22985  0</span></span><br><span class=\"line\"><span class=\"comment\"># virtio_ring            22746  5 virtio_blk,virtio_net,virtio_pci,virtio_balloon,virtio_console</span></span><br><span class=\"line\"><span class=\"comment\"># drm_panel_orientation_quirks    17180  1 drm</span></span><br><span class=\"line\"><span class=\"comment\"># virtio                 14959  5 virtio_blk,virtio_net,virtio_pci,virtio_balloon,virtio_console</span></span><br><span class=\"line\"><span class=\"comment\"># floppy                 69432  0</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例2.在/proc/modules中相应的是：</span></span><br><span class=\"line\"><span class=\"variable\">$cat</span> /proc/modules | head</span><br><span class=\"line\">(模块名，模块大小，被…使用，模块地址(猜的，以后确认))</span><br><span class=\"line\"><span class=\"comment\"># binfmt_misc 17468 1 - Live 0xffffffffc039d000</span></span><br><span class=\"line\"><span class=\"comment\"># coretemp 13444 0 - Live 0xffffffffc0470000</span></span><br><span class=\"line\"><span class=\"comment\"># iosf_mbi 15582 0 - Live 0xffffffffc045c000</span></span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h5 id=\"depmod-命令\"><a href=\"#depmod-命令\" class=\"headerlink\" title=\"depmod 命令\"></a>depmod 命令</h5><p>功能：分析可加载模块的依赖性，生成modules.dep文件和映射文件。<br>Linux内核模块可以为其它模块提供提供服务(在代码中使用EXPORT_SYMBOL)，这种服务被称作”symbols”。若第二个模块使用了这个symbol，则该模块很明显依赖于第一个模块，依赖关系是非常繁杂的。</p>\n<p>depmod读取在/lib/modules/version 目录下的所有模块，并检查每个模块导出的symbol和需要的symbol，然后创建一个依赖关系列表。</p>\n<ul>\n<li>默认地该列表写入到/lib/moudules /version目录下的modules.dep文件中。</li>\n<li>若命令中的filename有指定的话，则仅检查这些指定的模块(不是很有用)。</li>\n<li>若命令中提供了version参数，则会使用version所指定的目录生成依赖，而不是当前内核的版本(uname -r 返回的)。</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#用法：</span></span><br><span class=\"line\">depmod [-b basedir] [-e] [-F System.map] [-n] [-v] [version] [-A]</span><br><span class=\"line\">depmod [-e] [-F System.map] [-n] [-v] [version] [filename...]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#选项：</span></span><br><span class=\"line\">-b basedir  –basedir basedir  若你的模块并没有正确的在/lib/mdules/version下，可以指定目录生成依赖。</span><br><span class=\"line\">-e  –errsyms  和-F选项一起使用，当一个模块需要的symbol在其它模块里面没有提供时，做出报告。正常情况下，模块没有提供的symbol都在内核中有提供。</span><br><span class=\"line\">-F  –filesyms System.map 提供一个System.map文件(在内核编译时生成的)许-e选项报告出unresolved symbol。</span><br><span class=\"line\">-n  –dry_run  将结果modules.dep和各种映射文件输出到标准输出(stdout)，而不是写到模块目录下。</span><br><span class=\"line\">-A –quick  检查是否有模块比modues.dep中的模块新，若没有，则退出不重新生成文件。</span><br></pre></td></tr></table></figure>\n<p><br/></p>\n<h5 id=\"modprobe-命令-重要\"><a href=\"#modprobe-命令-重要\" class=\"headerlink\" title=\"modprobe 命令(重要)\"></a>modprobe 命令(重要)</h5><p>功能：modprobe可智能地添加和删除Linux内核模块(为简便起见，模块名中’_’和’-‘是一样的)</p>\n<p>modprobe会查看模块 目录/lib/modules/’uname -r’里面的所有模块和文件，除了可选的/etc/modprobe.conf配置文件和/etc/modprobe.d目录外。<br>modprobe需要一个最新的modules.dep文件，可以用depmod来生成。该文件列出了每一个模块需要的其他模块，modprobe使用这个去自动添加或删除模块的依赖。</p>\n<p>语法与参数：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">modprobe [ -v ] [ -V ] [-C config-file] [ -n ] [ -i ] [ -q ] [ -o modulename] [ modulename ] [ module parameters ... ]</span><br><span class=\"line\">modprobe [ -r ] [ -v ] [ -n ] [ -i ] [ modulename ... ]</span><br><span class=\"line\">modprobe [ -l ] [ -t dirname ] [ wildcard ]</span><br><span class=\"line\">modprobe [ -c ]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#选项：</span></span><br><span class=\"line\">-v –verbose  显示程序在干什么，通常在出问题的情况下，modprobe才显示信息。</span><br><span class=\"line\">-C –config  重载(^_^,意思取C++的重载)默认配置文件(/etc/modprobe.conf或/etc/modprobe.d)。</span><br><span class=\"line\">-c –showconfig  输出配置文件并退出</span><br><span class=\"line\">-n –dry-run  可以和-v选项一起使用，调试非常有用</span><br><span class=\"line\">-i –ignore-install –ignore-remove 该选项会使得modprobe忽略配置文件中的，在命令行上输入的install和remove命令。</span><br><span class=\"line\">-q –quiet 一般modprobe删除或插入一个模块时，若没有找到会提示错误。使用该选项，会忽略指定的模块，并不提示任何错误信息。</span><br><span class=\"line\">-r –remove  该选项会导致modprobe去删除，而不是插入一个模块。通常没有没有理由去删除内核模块，除非是一些有bug的模块。你的内核也不一定支持模块的卸载。</span><br><span class=\"line\">-V –verssion 版本信息</span><br><span class=\"line\">-f –force  和同时使用–force-vermagic ，–force-modversion一样。使用该选项是比较危险的。</span><br><span class=\"line\">-l –list 列出所有模块</span><br><span class=\"line\">-a –all 插入所有命令行中的模块</span><br><span class=\"line\">-t –<span class=\"built_in\">type</span> 强制 -l 显示dirname中的模块</span><br><span class=\"line\">-s –syslog 错误信息写入syslog</span><br></pre></td></tr></table></figure></p>\n<p>案例示例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1.前面的导入drbd模块并且验证是否导入</span></span><br><span class=\"line\"><span class=\"variable\">$modprobe</span> drbd &amp;&amp; lsmod | grep drbd  <span class=\"comment\">#临时生效,重启由需要添加 可用加入到 /etc/rc.local</span></span><br><span class=\"line\">drbd                  485533  0</span><br><span class=\"line\">libcrc32c                841  1 drbd</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例2.查看模块依赖（lsmod查询模块名称）</span></span><br><span class=\"line\"><span class=\"variable\">$modprobe</span> -D binfmt_misc</span><br><span class=\"line\">insmod /lib/modules/3.10.0-957.12.2.el7.x86_64/kernel/fs/binfmt_misc.ko.xz</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h5 id=\"modinfo-命令-重要\"><a href=\"#modinfo-命令-重要\" class=\"headerlink\" title=\"modinfo 命令(重要)\"></a>modinfo 命令(重要)</h5><p>功能：显示内核模块中命令行指定的模块的信息。若模块名不是一个文件名，则会在/lib/modules/version 目录中搜索，就像modprobe一样。<br>modinfo默认情况下，为了便于阅读，以下面的格式列出模块的每个属性：fieldname : value。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#用法：</span></span><br><span class=\"line\">modinfo [ -0 ] [ -F field] [modulename | filename ... ]</span><br><span class=\"line\">modinfo -V</span><br><span class=\"line\">modinfo -h</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#选项：</span></span><br><span class=\"line\">-V –version 版本</span><br><span class=\"line\">-F –field 仅在一行上显示field值，这对于脚本较为有用。常用的field有：author, description, licence, param, depends, <span class=\"built_in\">alias</span>, filename。</span><br><span class=\"line\">-0 –NULL 使用’/0′字符分隔field值，而不是一个新行。对脚本比较有用。</span><br><span class=\"line\">-a -d -l -p -n 这些分别是author, description, license, param ,filename的简短形式。</span><br></pre></td></tr></table></figure></p>\n<p>实际案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1.显示模块信息</span></span><br><span class=\"line\"><span class=\"variable\">$modinfo</span> binfmt_misc</span><br><span class=\"line\">filename:       /lib/modules/3.10.0-957.12.2.el7.x86_64/kernel/fs/binfmt_misc.ko.xz</span><br><span class=\"line\">license:        GPL</span><br><span class=\"line\"><span class=\"built_in\">alias</span>:          fs-binfmt_misc</span><br><span class=\"line\">retpoline:      Y</span><br><span class=\"line\">rhelversion:    7.6</span><br><span class=\"line\">srcversion:     94E4CE2E390B0EECC8654D6</span><br><span class=\"line\">depends:</span><br><span class=\"line\">intree:         Y</span><br><span class=\"line\">vermagic:       3.10.0-957.12.2.el7.x86_64 SMP mod_unload modversions</span><br><span class=\"line\">signer:         CentOS Linux kernel signing key</span><br><span class=\"line\">sig_key:        8D:E6:4F:B5:96:9B:55:7E:DC:7F:03:2E:EA:BC:BE:4F:37:17:7F:4E</span><br><span class=\"line\">sig_hashalgo:   sha256</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h5 id=\"insmod-命令\"><a href=\"#insmod-命令\" class=\"headerlink\" title=\"insmod 命令\"></a>insmod 命令</h5><p>功能：Linux insmod(insert module)命令用于载入模块，在Linux中有许多功能是通过模块的方式，在需要时才载入kernel。<br>如此可使kernel较为精简，进而提高效率，以及保有较大的弹性。这类可载入的模块，通常是设备驱动程序。补充Linux内核中插入一个模块,若文件名是一个连字符’-‘，模块从标准输入输入。大多数用户使用modprobe 因为它比较智能化。</p>\n<p>基础语法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 基础语法</span></span><br><span class=\"line\">insmod [-fkmpsvxX][-o &lt;模块名称&gt;][模块文件][符号名称 = 符号值]</span><br><span class=\"line\">insmod [filename] [modue options ...]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 参数说明</span></span><br><span class=\"line\">-f 　不检查目前kernel版本与模块编译时的kernel版本是否一致，强制将模块载入。</span><br><span class=\"line\">-k 　将模块设置为自动卸除。</span><br><span class=\"line\">-m 　输出模块的载入信息。</span><br><span class=\"line\">-o&lt;模块名称&gt; 指定模块的名称，可使用模块文件的文件名。</span><br><span class=\"line\">-p 　测试模块是否能正确地载入kernel。</span><br><span class=\"line\">-s 　将所有信息记录在系统记录文件中。</span><br><span class=\"line\">-v 　执行时显示详细的信息。</span><br><span class=\"line\">-x 　不要汇出模块的外部符号。</span><br><span class=\"line\">-X 　汇出模块所有的外部符号，此为预设置。</span><br></pre></td></tr></table></figure></p>\n<p>基础实例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.向内核加载模块</span></span><br><span class=\"line\">insmod led.o </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.grub 使用到的模块加载到内核之中</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> load_video &#123;</span><br><span class=\"line\">  <span class=\"comment\"># 载入模块</span></span><br><span class=\"line\">  insmod efi_gop</span><br><span class=\"line\">  insmod efi_uga</span><br><span class=\"line\">  insmod video_bochs</span><br><span class=\"line\">  insmod video_cirrus</span><br><span class=\"line\">  insmod all_video</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h5 id=\"rmmod-命令\"><a href=\"#rmmod-命令\" class=\"headerlink\" title=\"rmmod 命令\"></a>rmmod 命令</h5><p>功能：rmmod是一个可以从内核中删除模块的小程序，大多数用户使用modprobe -r去删除模块。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">用法：rmmod [ -f ] [ -w ] [ -s ] [ -v ] [ modulename ]</span><br><span class=\"line\">选项：</span><br><span class=\"line\">-v –verbose  显示程序正在做些什么，一般只显示执行时的错误信息。</span><br><span class=\"line\">-f –force  该选项是非常危险：除非编译内核时，CONFIG_MODULE_FORCE_UNLOAD被设置该命令才有效果，否则没效果。用该选项可以删除正在被使用的模块，设计为不能删除的模块，或者标记为unsafe的模块。</span><br><span class=\"line\">-w –<span class=\"built_in\">wait</span> 通常，rmmod拒绝删除正在被使用的模块。使用该选项后，指定的模块会被孤立起来，直到不被使用。</span><br><span class=\"line\">-s  –syslog  将错误信息写入syslog，而不是标准错误(stderr)。</span><br><span class=\"line\">-V  –version 版本信息</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"capsh-命令-能力外壳包装工具\"><a href=\"#capsh-命令-能力外壳包装工具\" class=\"headerlink\" title=\"capsh 命令 - 能力外壳包装工具\"></a>capsh 命令 - 能力外壳包装工具</h4><p>描述: Linux capability 的支持和使用可以通过这个工具进行探索和限制。这个工具为某些类型的功能测试和环境创建提供了一个方便的包装器，它还提供了一些用于总结功能状态的调试功能。</p>\n<p><strong>overview of Linux capabilities 参考地址</strong>: <a href=\"https://man7.org/linux/man-pages/man7/capabilities.7.html\" target=\"_blank\" rel=\"noopener\">https://man7.org/linux/man-pages/man7/capabilities.7.html</a></p>\n<p>从内核 2.2 开始，Linux 划分权限传统上与超级用户相关联成不同的单元称为功能，可以独立启用和禁用，功能是每个线程的属性, 它打破了UNIX/LINUX操作系统中超级用户/普通用户的概念,由普通用户也可以做只有超级用户可以完成的工作。</p>\n<p>Capabilities的主要思想在于分割root用户的特权，即将root的特权分割成不同的能力，每种能力代表一定的特权操作。</p>\n<blockquote>\n<p>例如： CAP_SYS_MODULE 表示用户能够加载(或卸载)内核模块的特权操作，而CAP_SETUID表示用户能够修改进程用户身份的特权操作。在Capbilities中系统将根据进程拥有的能力来进行特权操作的访问控制</p>\n</blockquote>\n<p>在Capilities中<code>只有进程</code>和<code>可执行文件</code>才具有能力，每个进程拥有三组能力集，分别称为<code>cap_effective, cap_inheritable, cap_permitted</code> (分别简记为:pE,pI,pP)，可执行文件也拥有三组能力集，分别称为<code>cap_effective, cap_allowed 和 cap_forced</code>（分别简记为fE,fI,fP）</p>\n<p><strong>进程拥有三组能力集</strong><br>cap_permitted : 表示进程所拥有的最大能力集。<br>cap_inheitable : 表示进程可以传递给其子进程的能力集<br>cap_effective : 表示进程当前可用的能力集。(<code>为cap_permitted的子集</code>)</p>\n<p><strong>可执行文件拥有三组能力集</strong><br>cap_allowed : 表示程序运行时可从原进程的cap_inheritable中集成的能力集，cap_forced : 表示运行文件时必须拥有才能完成其服务的能力集；<br>cap_effective ::表示文件开始运行时可以使用的能力。</p>\n<p>补充说明: 你可能会常常看见 <code>cap_chown=eip</code>, 它是将 chown 的能力以 <code>cap_effective(e), cap_inheritable(i), cap_permitted(p)</code> 三种位图的方式授权给相关的程序文件.</p>\n<p><br/></p>\n<p><strong>常见的 Linux capability 列表:</strong></p>\n<ul>\n<li>CAP_AUDIT_CONTROL （自 Linux 2.6.11 起）启用和禁用内核审计, 更改审核过滤器规则, 检索审核状态和过滤规则。 </li>\n<li>CAP_AUDIT_READ （自 Linux 3.16 起）允许通过多播网络链接读取审核日志插座。 </li>\n<li>CAP_AUDIT_WRITE （自 Linux 2.6.11 起）将记录写入内核审计日志。 </li>\n<li>CAP_BLOCK_SUSPEND （自 Linux 3.5 起）使用可以阻止系统挂起的功能</li>\n<li>CAP_BPF （自 Linux 5.8 起） 使用特权 BPF 操作</li>\n<li>CAP_CHECKPOINT_RESTORE （自 Linux 5.9 起） ；更新 /proc/sys/kernel/ns_last_pid, 使用 set_tid 的特征, 读取符号链接的内容 </li>\n<li>CAP_CHOWN: 对文件 UID 和 GID 进行任意更改</li>\n<li>CAP_DAC_OVERRIDE: 绕过文件读取、写入和执行权限检查。DAC是“discretionary access”的缩写 控制”</li>\n<li>CAP_DAC_READ_SEARCH: 绕过文件读取权限检查和目录读取并执行权限检查；</li>\n<li>CAP_FOWNER：忽略文件属主ID必须和进程用户ID相匹配的限制</li>\n<li>CAP_FSETID: 允许设置文件的setuid位和setgid。</li>\n<li>CAP_KILL: 允许对不属于自己的进程发送信号</li>\n<li>CAP_SETGID: 允许改变进程的组ID</li>\n<li>CAP_SETUID: 允许改变进程的用户ID</li>\n<li>CAP_SETPCAP: 允许向其他进程转移能力以及删除其他进程的能力</li>\n<li>CAP_LINUX_IMMUTABLE: 允许修改文件的IMMUTABLE和APPEND属性标志</li>\n<li>CAP_NET_BIND_SERVICE: 允许绑定到小于1024的端口</li>\n<li>CAP_NET_BROADCAST: 允许网络广播和多播访问</li>\n<li>CAP_NET_ADMIN: 允许执行网络管理任务,接口配置,管理 IP 防火墙、伪装和会计,修改路由表,绑定到任何地址进行透明代理,设置服务类型（TOS）,设置混杂模式,启用多播；</li>\n<li>CAP_NET_RAW: 允许使用原始套接字</li>\n<li>CAP_IPC_LOCK: 允许锁定共享内存片段,使用大页面分配内存。</li>\n<li>CAP_IPC_OWNER: 忽略IPC所有权检查</li>\n<li>CAP_SYS_MODULE: 允许插入和删除内核模块</li>\n<li>CAP_SYS_RAWIO: 允许直接访问/devport,/dev/mem,/dev/kmem及原始块设备</li>\n<li>CAP_SYS_CHROOT: 允许使用chroot()系统调用,更改挂载命名空间</li>\n<li>CAP_SYS_PTRACE: 允许跟踪任何进程</li>\n<li>CAP_SYS_PACCT: 允许执行进程的BSD式审计</li>\n<li>CAP_SYS_ADMIN: 允许执行系统管理任务，如加载或卸载文件系统、设置磁盘配额等</li>\n<li>CAP_SYS_BOOT: 允许重新启动系统</li>\n<li>CAP_SYS_NICE: 允许提升优先级及设置其他进程的优先级</li>\n<li>CAP_SYS_RESOURCE: 忽略资源限制</li>\n<li>CAP_SYS_TIME: 允许改变系统时钟</li>\n<li>CAP_SYS_TTY_CONFIG: 允许配置TTY设备</li>\n<li>CAP_MKNOD: 允许使用mknod()系统调用</li>\n<li>CAP_LEASE: 允许修改文件锁的FL_LEASE标志</li>\n</ul>\n<p><br/></p>\n<p><strong>语法&amp;参数</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># capsh [OPTION]...</span></span><br><span class=\"line\">--<span class=\"built_in\">print</span>   <span class=\"comment\"># 显示主要能力和相关状态。</span></span><br><span class=\"line\">-- [args] <span class=\"comment\"># 使用尾随参数执行/bin/bash，注意对于特定命令，可以使用-c“command to execute”。   </span></span><br><span class=\"line\">==        <span class=\"comment\"># 使用剩余参数再次执行capsh。                  </span></span><br><span class=\"line\">--caps=<span class=\"built_in\">cap</span>-set   <span class=\"comment\"># 将流行的过程能力设置为由 cap-set 指定的那些。</span></span><br><span class=\"line\">--drop=<span class=\"built_in\">cap</span>-list  <span class=\"comment\"># 从流行的边界集中删除列出的功能。 这些功能是由 cap_from_name(3) 函数识别的以逗号分隔的功能列表。 </span></span><br><span class=\"line\">--inh=<span class=\"built_in\">cap</span>-list   <span class=\"comment\"># 将当前进程的可继承功能集设置为与逗号分隔列表中提供的相同，要使此操作成功，主流进程应该已经在当前可继承和允许的能力集的联合中拥有这些能力中的每一个，或者 capsh 程序在其有效集中使用 CAP_SETPCAP 运行。</span></span><br><span class=\"line\"></span><br><span class=\"line\">--user=username  <span class=\"comment\"># s使用假定命名用户的身份，执行此命令后，有效功能将被清除，但允许的设置不会被清除，因此正在运行的程序仍然具有特权。</span></span><br><span class=\"line\">--modes       <span class=\"comment\"># 列出 --mode 支持的所有 libcap 模式。          </span></span><br><span class=\"line\">--mode=&lt;mode&gt; <span class=\"comment\"># 强制程序进入 cap_set_mode(3) 安全模式。 这是一组为其预先确定的安全立场推荐的安全位和普遍的能力安排。        </span></span><br><span class=\"line\">--inmode=&lt;mode&gt;  <span class=\"comment\"># 确认流行模式是这样命名的，或者以状态 1 退出。     </span></span><br><span class=\"line\">--uid=id         <span class=\"comment\"># 使用 setuid(2) 系统调用强制所有 uid 值等于 id。</span></span><br><span class=\"line\">--<span class=\"built_in\">cap</span>-uid=&lt;uid&gt;  <span class=\"comment\"># 使用 cap_setuid(3) 函数设置当前进程的 uid。    </span></span><br><span class=\"line\">--is-uid=&lt;id&gt;    <span class=\"comment\"># 除非当前 uid 等于 &lt;id&gt;，否则以状态 1 退出。     </span></span><br><span class=\"line\">--gid=&lt;id&gt;       <span class=\"comment\"># 使用 setgid(2) 系统调用强制所有 gid 值等于 id。     </span></span><br><span class=\"line\">--is-gid=&lt;id&gt;    <span class=\"comment\"># 以状态 1 退出，除非当前 gid 等于 &lt;id&gt;。    </span></span><br><span class=\"line\">--groups=&lt;gid-list&gt; <span class=\"comment\"># 将补充组设置为提供的数字列表。  </span></span><br><span class=\"line\">--keep=&lt;0|1&gt;     <span class=\"comment\"># 在非纯能力模式下，内核为超级用户提供自由权限,设置为1将导致保持上限处于活动状态,设置为0将导致当前进程停用保持上限。    </span></span><br><span class=\"line\">--chroot=path  <span class=\"comment\"># 使用等于路径的新根目录 (/) 执行 chroot(2) 系统调用。       </span></span><br><span class=\"line\">--forkfor=sec  <span class=\"comment\"># 该命令设置 程序 fork 一个子进程的秒数。    </span></span><br><span class=\"line\">--killit=sig   <span class=\"comment\"># 导致 --forkfor 子进程使用指定的信号被 kill(2)d。       </span></span><br><span class=\"line\">--decode=N     <span class=\"comment\"># 解码在/proc/&lt;pid&gt;/status中查看查看到的CapInh、CapPrm、CapEff、CapBnd</span></span><br><span class=\"line\">--supports=xxx <span class=\"comment\"># 随着内核的发展会添加更多功能，此选项可用于验证系统上是否存在功能。       </span></span><br><span class=\"line\">--has-p=xxx    <span class=\"comment\"># 以状态1退出，除非允许向量具有提升的能力。</span></span><br><span class=\"line\">--has-ambient  <span class=\"comment\"># 执行检查以查看正在运行的内核是否支持环境功能。否则，capsh命令将以状态1退出。</span></span><br><span class=\"line\">--has<span class=\"_\">-a</span>=xxx    <span class=\"comment\"># 以状态1退出，除非环境向量具有提升的能力。</span></span><br><span class=\"line\">--addamb=xxx   <span class=\"comment\"># 将特定的环境功能添加到正在运行的进程中。       </span></span><br><span class=\"line\">--delamb=xxx   <span class=\"comment\"># 从正在运行的进程中删除指定的环境容量。      </span></span><br><span class=\"line\">--noamb        <span class=\"comment\">#  从正在运行的进程中删除所有环境功能。</span></span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p><strong>基础示例</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 示例1.查看当前系统支持的 capability 。</span></span><br><span class=\"line\">$ capsh --<span class=\"built_in\">print</span></span><br><span class=\"line\">  <span class=\"comment\"># Current: =ep</span></span><br><span class=\"line\">  <span class=\"comment\"># Bounding set =cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,cap_audit_read</span></span><br><span class=\"line\">  <span class=\"comment\"># Ambient set =</span></span><br><span class=\"line\">  <span class=\"comment\"># Securebits: 00/0x0/1'b0</span></span><br><span class=\"line\">  <span class=\"comment\"># secure-noroot: no (unlocked)</span></span><br><span class=\"line\">  <span class=\"comment\"># secure-no-suid-fixup: no (unlocked)</span></span><br><span class=\"line\">  <span class=\"comment\"># secure-keep-caps: no (unlocked)</span></span><br><span class=\"line\">  <span class=\"comment\"># secure-no-ambient-raise: no (unlocked)</span></span><br><span class=\"line\">  <span class=\"comment\"># uid=0(root) euid=0(root)</span></span><br><span class=\"line\">  <span class=\"comment\"># gid=0(root)</span></span><br><span class=\"line\">  <span class=\"comment\"># groups=0(root)</span></span><br><span class=\"line\">  <span class=\"comment\"># Guessed mode: UNCERTAIN (0)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 示例2.查看docker守护进程支持的能力，使用--decode=参数进行能力解码。</span></span><br><span class=\"line\">$ cat /proc/`pidof dockerd`/status | grep Cap</span><br><span class=\"line\"><span class=\"comment\"># CapInh: 0000000000000000</span></span><br><span class=\"line\"><span class=\"comment\"># CapPrm: 0000003fffffffff</span></span><br><span class=\"line\"><span class=\"comment\"># CapEff: 0000003fffffffff</span></span><br><span class=\"line\"><span class=\"comment\"># CapBnd: 0000003fffffffff</span></span><br><span class=\"line\"><span class=\"comment\"># CapAmb: 0000000000000000</span></span><br><span class=\"line\">$ capsh --decode=0x3fffffffff</span><br><span class=\"line\"><span class=\"comment\"># 0x0000003fffffffff=cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,cap_audit_read</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 示例3.列出 --mode 支持的所有 libcap 模式。</span></span><br><span class=\"line\">$ capsh --modes</span><br><span class=\"line\">`<span class=\"comment\"># Supported modes: NOPRIV PURE1E_INIT PURE1E</span></span><br></pre></td></tr></table></figure></p>\n<hr/>\n\n<h4 id=\"0x03-环境变量\"><a href=\"#0x03-环境变量\" class=\"headerlink\" title=\"0x03 环境变量\"></a>0x03 环境变量</h4><h5 id=\"set-命令\"><a href=\"#set-命令\" class=\"headerlink\" title=\"set 命令\"></a>set 命令</h5><p>描述：set命令作用主要是显示系统中已经存在的shell变量，以及设置shell变量的新变量值,使用set更改shell特性时，符号”+”和”-“的作用分别是打开和关闭指定的模式.</p>\n<p>Tips : set命令不能够定义新的shell变量,如果要定义新的变量，可以使用declare命令以变量名=值的格式进行定义即可,<code>set/env</code>命令可以查看所有的shell变量，其中包括环境变量</p>\n<p>常见的环境变量：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$USER</span> 查看账户信息</span><br><span class=\"line\"><span class=\"variable\">$logname</span> 登录相关信息</span><br><span class=\"line\"><span class=\"variable\">$UID</span></span><br><span class=\"line\"><span class=\"variable\">$Shell</span></span><br><span class=\"line\"><span class=\"variable\">$HOME</span> 家目录</span><br><span class=\"line\"><span class=\"variable\">$pwd</span></span><br><span class=\"line\"><span class=\"variable\">$PATH</span> 用户所输入的命令是在哪些目录中查找</span><br><span class=\"line\"><span class=\"variable\">$PS1</span></span><br><span class=\"line\"><span class=\"variable\">$PS2</span></span><br><span class=\"line\"><span class=\"variable\">$RANDOM</span> 随机数</span><br></pre></td></tr></table></figure></p>\n<p>语法参数:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#语法</span></span><br><span class=\"line\"><span class=\"built_in\">set</span>: <span class=\"built_in\">set</span> [-abefhkmnptuvxBCHP] [-o option-name] [--] [arg ...]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#选项</span></span><br><span class=\"line\">-/+ x :执行时候显示参数和命令开启/关闭调试</span><br><span class=\"line\">-/+ v :当命令进入读取时候显示输入/禁止打印输入</span><br><span class=\"line\">-n : 读取命令但不执行命令</span><br><span class=\"line\">-a : 设置为环境变量</span><br><span class=\"line\">-e : 如果命令执行出现非零状态,则立即退出。</span><br><span class=\"line\">-u : 命令后系统会明确提示没有变量(验证变量)</span><br><span class=\"line\"></span><br><span class=\"line\">Options:</span><br><span class=\"line\">  -a  Mark variables <span class=\"built_in\">which</span> are modified or created <span class=\"keyword\">for</span> <span class=\"built_in\">export</span>.</span><br><span class=\"line\">  -b  Notify of job termination immediately.</span><br><span class=\"line\">  -e  Exit immediately <span class=\"keyword\">if</span> a <span class=\"built_in\">command</span> exits with a non-zero status.</span><br><span class=\"line\">  -f  Disable file name generation (globbing).</span><br><span class=\"line\">  -h  Remember the location of commands as they are looked up.</span><br><span class=\"line\">  -k  All assignment arguments are placed <span class=\"keyword\">in</span> the environment <span class=\"keyword\">for</span> a <span class=\"built_in\">command</span>, not just those that precede the <span class=\"built_in\">command</span> name.</span><br><span class=\"line\">  -m  Job control is enabled.</span><br><span class=\"line\">  -n  Read commands but <span class=\"keyword\">do</span> not execute them.</span><br><span class=\"line\">  -p  Turned on whenever the real and effective user ids <span class=\"keyword\">do</span> not match.</span><br><span class=\"line\">      Disables processing of the <span class=\"variable\">$ENV</span> file and importing of shell</span><br><span class=\"line\">      <span class=\"built_in\">functions</span>.  Turning this option off causes the effective uid and</span><br><span class=\"line\">      gid to be <span class=\"built_in\">set</span> to the real uid and gid.</span><br><span class=\"line\">  -t  Exit after reading and executing one <span class=\"built_in\">command</span>.</span><br><span class=\"line\">  -u  Treat <span class=\"built_in\">unset</span> variables as an error when substituting.</span><br><span class=\"line\">  -v  Print shell input lines as they are <span class=\"built_in\">read</span>.</span><br><span class=\"line\">  -x  Print commands and their arguments as they are executed.</span><br><span class=\"line\">  -B  the shell will perform brace expansion</span><br><span class=\"line\">  -C  If <span class=\"built_in\">set</span>, disallow existing regular files to be overwritten by redirection of output.</span><br><span class=\"line\">  -E  If <span class=\"built_in\">set</span>, the ERR <span class=\"built_in\">trap</span> is inherited by shell <span class=\"built_in\">functions</span>.</span><br><span class=\"line\">  -H  Enable ! style <span class=\"built_in\">history</span> substitution.  This flag is on by default when the shell is interactive.</span><br><span class=\"line\">  -P  If <span class=\"built_in\">set</span>, <span class=\"keyword\">do</span> not resolve symbolic links when executing commands such as <span class=\"built_in\">cd</span> <span class=\"built_in\">which</span> change the current directory.</span><br><span class=\"line\">  -T  If <span class=\"built_in\">set</span>, the DEBUG and RETURN traps are inherited by shell <span class=\"built_in\">functions</span>.</span><br><span class=\"line\">  --  Assign any remaining arguments to the positional parameters.</span><br><span class=\"line\">      If there are no remaining arguments, the positional parameters</span><br><span class=\"line\">      are <span class=\"built_in\">unset</span>.</span><br><span class=\"line\">  -   Assign any remaining arguments to the positional parameters.</span><br><span class=\"line\">      The -x and -v options are turned off.</span><br><span class=\"line\">  -o option-name</span><br><span class=\"line\">    Set the variable corresponding to option-name:</span><br><span class=\"line\">        allexport    same as -a</span><br><span class=\"line\">        braceexpand  same as -B</span><br><span class=\"line\">        emacs        use an emacs-style line editing interface</span><br><span class=\"line\">        errexit      same as -e</span><br><span class=\"line\">        errtrace     same as -E</span><br><span class=\"line\">        functrace    same as -T</span><br><span class=\"line\">        hashall      same as -h</span><br><span class=\"line\">        histexpand   same as -H</span><br><span class=\"line\">        <span class=\"built_in\">history</span>      <span class=\"built_in\">enable</span> <span class=\"built_in\">command</span> <span class=\"built_in\">history</span></span><br><span class=\"line\">        ignoreeof    the shell will not <span class=\"built_in\">exit</span> upon reading EOF</span><br><span class=\"line\">        interactive-comments  allow comments to appear <span class=\"keyword\">in</span> interactive commands</span><br><span class=\"line\">        keyword      same as -k</span><br><span class=\"line\">        monitor      same as -m</span><br><span class=\"line\">        noclobber    same as -C</span><br><span class=\"line\">        noexec       same as -n</span><br><span class=\"line\">        <span class=\"built_in\">noglob</span>       same as -f</span><br><span class=\"line\">        nolog        currently accepted but ignored</span><br><span class=\"line\">        notify       same as -b</span><br><span class=\"line\">        nounset      same as -u</span><br><span class=\"line\">        onecmd       same as -t</span><br><span class=\"line\">        physical     same as -P</span><br><span class=\"line\">        pipefail     the <span class=\"built_in\">return</span> value of a pipeline is the status ofthe last <span class=\"built_in\">command</span> to <span class=\"built_in\">exit</span> with a non-zero status,or zero <span class=\"keyword\">if</span> no <span class=\"built_in\">command</span> exited with a non-zero status</span><br><span class=\"line\">        posix        change the behavior of bash <span class=\"built_in\">where</span> the default operation differs from the Posix standard to match the standard</span><br><span class=\"line\">        privileged   same as -p</span><br><span class=\"line\">        verbose      same as -v</span><br><span class=\"line\">        vi           use a vi-style line editing interface</span><br><span class=\"line\">        xtrace       same as -x</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190604114028.png\" alt=\"WeiyiGeek.set参数\" title=\"\" class=\"\">\n                <p>WeiyiGeek.set参数</p>\n            </figure>\n<p>实际案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1.set新定义变量输出为shell环境变量</span></span><br><span class=\"line\"><span class=\"variable\">$declare</span> <span class=\"built_in\">test</span>=<span class=\"string\">\"setdemo\"</span></span><br><span class=\"line\"><span class=\"variable\">$env</span> | grep <span class=\"string\">\"test\"</span> <span class=\"comment\"># #环境变量为空</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$set</span> -a <span class=\"built_in\">test</span>  <span class=\"comment\">#设置后用户环境变量不为空</span></span><br><span class=\"line\"><span class=\"variable\">$env</span> | grep <span class=\"string\">\"test\"</span>  <span class=\"comment\">#系统环境变量为空</span></span><br><span class=\"line\"><span class=\"variable\">$set</span> | grep <span class=\"string\">\"test\"</span>  <span class=\"comment\">#shell变量 存在</span></span><br><span class=\"line\">BASH_ARGV=([0]=<span class=\"string\">\"test.sh\"</span>)</span><br><span class=\"line\">BASH_SOURCE=([0]=<span class=\"string\">\"test.sh\"</span>)</span><br><span class=\"line\"><span class=\"built_in\">test</span>=setdemo</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例2.验证变量是否存在</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> -u <span class=\"variable\">$test</span>  <span class=\"comment\"># 如果设定此选项，调用未声明变量时会报错（默认调用未声明变量是为空）</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> -u <span class=\"variable\">$testww</span></span><br><span class=\"line\">-bash: wwww：未绑定的变量</span><br><span class=\"line\"><span class=\"built_in\">echo</span> $?</span><br><span class=\"line\">1</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例3.shell脚本自身已经包含了调式选项，能都打印出脚本接受的参数和输入。</span></span><br><span class=\"line\"><span class=\"comment\">#仅在 -x 和 +x 的区域中才会显示调式信息</span></span><br><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> &#123;1..5&#125;</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> -x   <span class=\"comment\">#开启调试</span></span><br><span class=\"line\"> <span class=\"built_in\">echo</span> <span class=\"variable\">$i</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> +x   <span class=\"comment\">#关闭调试</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"end\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#调试信息</span></span><br><span class=\"line\">. ./www.sh</span><br><span class=\"line\">++ <span class=\"built_in\">echo</span> 1</span><br><span class=\"line\">1</span><br><span class=\"line\">++ <span class=\"built_in\">set</span> +x</span><br><span class=\"line\">++ <span class=\"built_in\">echo</span> 2</span><br><span class=\"line\">2</span><br><span class=\"line\">++ <span class=\"built_in\">set</span> +x</span><br><span class=\"line\">++ <span class=\"built_in\">echo</span> 3</span><br><span class=\"line\">3</span><br><span class=\"line\">++ <span class=\"built_in\">set</span> +x</span><br><span class=\"line\">++ <span class=\"built_in\">echo</span> 4</span><br><span class=\"line\">4</span><br><span class=\"line\">++ <span class=\"built_in\">set</span> +x</span><br><span class=\"line\">++ <span class=\"built_in\">echo</span> 5</span><br><span class=\"line\">5</span><br><span class=\"line\">++ <span class=\"built_in\">set</span> +x</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 示例4.脚本错误机制</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> -o errexit  <span class=\"comment\"># 如果命令以非零状态退出，请立即退出。</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> -o pipefail <span class=\"comment\"># 管道的返回值是最后一个以非零状态退出的命令的状态，如果没有命令以非零状态退出，则返回零</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> -o xtrace   <span class=\"comment\"># 在执行命令时打印命令及其参数。</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 示例5.位置参数设置</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> -- 1 2 3 whoami id</span><br><span class=\"line\">~$ <span class=\"built_in\">echo</span> <span class=\"variable\">$@</span></span><br><span class=\"line\"><span class=\"comment\"># 1 2 3 whoami id</span></span><br><span class=\"line\">~$ <span class=\"variable\">$5</span></span><br><span class=\"line\">uid=1000(app) gid=1000(app) groups=1000(app),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),116(lxd),998(docker)</span><br></pre></td></tr></table></figure></p>\n<p><em>补充知识点</em>：</p>\n<ul>\n<li>与bash -x相比，set -x可以缩小调试的作用域;</li>\n</ul>\n<p><br></p>\n<h5 id=\"unset-命令\"><a href=\"#unset-命令\" class=\"headerlink\" title=\"unset 命令\"></a>unset 命令</h5><p>描述：用于删除已定义的shell变量（包括环境变量）和shell函数.<br>注意：unset命令不能够删除具有只读属性的shell变量和环境变量.<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">unset</span> (选项) (参数)  <span class=\"comment\">#参数指定要删除的shell变量或shell函数</span></span><br><span class=\"line\"><span class=\"comment\">#选项：</span></span><br><span class=\"line\">-f: 仅仅删除函数</span><br><span class=\"line\">-v：仅删除变量名</span><br></pre></td></tr></table></figure></p>\n<p>实际案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1.删除指定环境变量注意（在Centos7或者说内核在3.10版本上是区分了shell变量和系统变量的）</span></span><br><span class=\"line\"><span class=\"built_in\">unset</span> -v <span class=\"built_in\">test</span></span><br><span class=\"line\"><span class=\"built_in\">unset</span> -f function_name   <span class=\"comment\">#放在调用的前面！！！</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> | grep <span class=\"string\">\"test\"</span>  <span class=\"comment\">#删除set中shell环境变量</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h5 id=\"export-命令\"><a href=\"#export-命令\" class=\"headerlink\" title=\"export 命令\"></a>export 命令</h5><p>描述：用于将shell变量输出为环境变量，或者将shell函数输出为环境变量,还可用于传递一个或多个变量的值到任何后继脚本。</p>\n<p>在配置交叉编译工具链的时候需要指定编译工具的路径此时就需要设置环境变量,比如配置JAVA环境以及MYSQL环境;</p>\n<p>一个变量创建时，它不会自动地为在它之后创建的shell进程所知，当一个shell脚本调用并执 行时它不会自动得到原为脚本（调用者）里定义的变量的访问权，除非这些变量已经被显式地设置为可用，<code>而命令export可以向后面的shell传递变量的值</code>。</p>\n<p>语法参数：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#语法</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> [参数] 变量名=变量值</span><br><span class=\"line\"><span class=\"comment\">#或者</span></span><br><span class=\"line\">变量名=变量值;<span class=\"built_in\">export</span> 遍历名 </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#选项</span></span><br><span class=\"line\">-f：代表[变量名称]中为函数名称；</span><br><span class=\"line\">-n：删除指定的变量。变量实际上并未删除，只是不会输出到后续指令的执行环境中；</span><br><span class=\"line\">-p：列出所有的shell赋予程序的环境变量。</span><br></pre></td></tr></table></figure></p>\n<p>实际案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1.查看已经存在的环境变量</span></span><br><span class=\"line\"><span class=\"built_in\">export</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> -p</span><br><span class=\"line\"><span class=\"comment\"># declare -x HISTCONTROL=\"ignoredups\"</span></span><br><span class=\"line\"><span class=\"comment\"># declare -x HISTSIZE=\"1000\"</span></span><br><span class=\"line\"><span class=\"comment\"># declare -x HOME=\"/root\"</span></span><br><span class=\"line\"><span class=\"comment\"># declare -x HOSTNAME=\"master\"</span></span><br><span class=\"line\"><span class=\"comment\"># declare -x LANG=\"zh_CN.UTF-8\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例2.</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> -f <span class=\"comment\">#查看函数名称</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> -n TEST <span class=\"comment\">#删除环境变量</span></span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Linux命令","path":"api/categories/Linux命令.json"}],"tags":[{"name":"系统命令","path":"api/tags/系统命令.json"}]}