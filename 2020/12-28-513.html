<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½²|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Jenkins">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½²</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½²</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-12-28T04:34:30.000Z" itemprop="datePublished" class="page-time">
  2020-12-28
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevOps/">DevOps</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevOps/CI-CD/">CI-CD</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/Jenkins/1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½²"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½²</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-12-28 12:34:30" datetime="2020-12-28T04:34:30.000Z"  itemprop="datePublished">2020-12-28</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevOps/">DevOps</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevOps/CI-CD/">CI-CD</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="0x00-å‰è¨€ç®€è¿°"><a href="#0x00-å‰è¨€ç®€è¿°" class="headerlink" title="0x00 å‰è¨€ç®€è¿°"></a>0x00 å‰è¨€ç®€è¿°</h2><h3 id="Jenkins-ä»‹ç»"><a href="#Jenkins-ä»‹ç»" class="headerlink" title="Jenkins ä»‹ç»"></a>Jenkins ä»‹ç»</h3><p>Q: ä»€ä¹ˆæ˜¯Jenkins?</p>
<blockquote>
<p>ç­”: Jenkins æ˜¯ä¸€ä¸ªå¼€æºæŒç»­é›†æˆçš„å·¥å…·ï¼ˆ<code>CI&amp;CD</code>ï¼‰ç”±Javaå¼€å‘è€Œæˆ, ç”¨äºè‡ªåŠ¨åŒ–å„ç§ä»»åŠ¡ï¼ŒåŒ…æ‹¬æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²è½¯ä»¶(<code>è‡ªåŠ¨åŒ–æœåŠ¡å™¨</code>); Jenkins æ”¯æŒå„ç§è¿è¡Œæ–¹å¼ï¼Œå¯é€šè¿‡ç³»ç»ŸåŒ…ã€Docker æˆ–è€… é€šè¿‡ä¸€ä¸ªç‹¬ç«‹çš„Javaç¨‹åº;<br>å®˜æ–¹ä»‹ç» : å…¨çƒé¢†å…ˆçš„å¼€æºè‡ªåŠ¨åŒ–æœåŠ¡å™¨,Jenkins æä¾›äº†æ•°ä»¥ç™¾è®¡çš„æ’ä»¶æ¥æ”¯æŒæ„å»ºã€éƒ¨ç½²å’Œè‡ªåŠ¨åŒ–ä»»ä½•é¡¹ç›®<br>å®˜æ–¹æ ‡è¯­ : â€œBuild great things at any scaleâ€-â€œå»ºé€ ä¼Ÿå¤§çš„äº‹æƒ…ä»¥ä»»ä½•è§„æ¨¡â€</p>
</blockquote>
<p>Tips ï¼šä¸ªäººç†è§£ Jenkins æ˜¯ä¸€ä¸ªè°ƒåº¦å¹³å°ï¼Œæœ¬èº«ä¸éœ€è¦å¤„ç†ä»»ä½•äº‹æƒ…ï¼Œè€Œæ˜¯é€šè¿‡ä¼—å¤šçš„æ’ä»¶æ¥å®Œæˆæ‰€æœ‰çš„å·¥ä½œ;</p>
<p><strong>Q: ä¸ºä»€ä¹ˆè¦ç”¨Jenkins?</strong></p>
<blockquote>
<p>ç­”: Jenkinsçš„å‰èº«æ˜¯Hudson, æ˜¯åŸºäºJavaå¼€å‘çš„ä¸€ç§æŒç»­é›†æˆå·¥å…·ï¼Œç”¨äºç›‘æ§ç§©åºé‡å¤çš„å·¥ä½œ, å®ƒæ˜¯å¯ä»¥å°†å„ä¸ªå¼€æºçš„è½¯ä»¶è¿›è¡Œé›†æˆçš„è°ƒåº¦å¹³å°ï¼Œä¾‹å¦‚( <code>Gitlab/SVN ã€Mavenã€Sonarqubeã€Shellã€é’‰é’‰é€šçŸ¥ã€é¡¹ç›®ç›‘æ§</code> )ç­‰ï¼›</p>
</blockquote>
<p><strong>Jenkins å‘è¡Œçº¿ç‰ˆæœ¬è¯´æ˜:</strong></p>
<ul>
<li>TLS é•¿æœŸæ”¯æŒç‰ˆæœ¬: æ¯12å‘¨ä»å¸¸è§„ç‰ˆæœ¬æµä¸­é€‰æ‹©ï¼Œä½œä¸ºè¯¥æ—¶é—´æ®µçš„ç¨³å®šç‰ˆæœ¬ã€‚ æ¯éš” 4 å‘¨ï¼Œæˆ‘ä»¬ä¼šå‘å¸ƒç¨³å®šç‰ˆæœ¬ï¼Œå…¶ä¸­åŒ…æ‹¬é”™è¯¯å’Œå®‰å…¨ä¿®å¤åå‘ç§»æ¤ã€‚</li>
<li>æ¯å‘¨æ›´æ–°ç‰ˆæœ¬: æ¯å‘¨éƒ½ä¼šå‘å¸ƒä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼Œä¸ºç”¨æˆ·å’Œæ’ä»¶å¼€å‘äººå‘˜æä¾›é”™è¯¯ä¿®å¤å’ŒåŠŸèƒ½ã€‚ </li>
</ul>
<p><br/></p>
<h3 id="Jenkins-ç‰¹æ€§"><a href="#Jenkins-ç‰¹æ€§" class="headerlink" title="Jenkins ç‰¹æ€§"></a>Jenkins ç‰¹æ€§</h3><ul>
<li>å¼€æºçš„javaè¯­è¨€å¼€å‘æŒç»­é›†æˆå·¥å…·ï¼Œæ”¯æŒCIï¼ŒCDï¼›</li>
<li>æ˜“äºå®‰è£…éƒ¨ç½²é…ç½®ï¼šå¯é€šè¿‡yumå®‰è£…,æˆ–ä¸‹è½½waråŒ…ä»¥åŠé€šè¿‡dockerå®¹å™¨ç­‰å¿«é€Ÿå®ç°å®‰è£…éƒ¨ç½²ï¼Œå¯æ–¹ä¾¿webç•Œé¢é…ç½®ç®¡ç†ï¼›</li>
<li>æ¶ˆæ¯é€šçŸ¥åŠæµ‹è¯•æŠ¥å‘Šï¼šé›†æˆRSS/E-mailé€šè¿‡RSSå‘å¸ƒæ„å»ºç»“æœæˆ–å½“æ„å»ºå®Œæˆæ—¶é€šè¿‡e-mailé€šçŸ¥ï¼Œç”ŸæˆJUnit/TestNGæµ‹è¯•æŠ¥å‘Šï¼›</li>
<li>åˆ†å¸ƒå¼æ„å»ºï¼šæ”¯æŒJenkinsèƒ½å¤Ÿè®©å¤šå°è®¡ç®—æœºä¸€èµ·æ„å»º/æµ‹è¯•ï¼›</li>
<li>æ–‡ä»¶è¯†åˆ«:Jenkinsèƒ½å¤Ÿè·Ÿè¸ªå“ªæ¬¡æ„å»ºç”Ÿæˆå“ªäº›jarï¼Œå“ªæ¬¡æ„å»ºä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„jarç­‰ï¼›</li>
<li>ä¸°å¯Œçš„æ’ä»¶æ”¯æŒ:æ”¯æŒæ‰©å±•æ’ä»¶ï¼Œä½ å¯ä»¥å¼€å‘é€‚åˆè‡ªå·±å›¢é˜Ÿä½¿ç”¨çš„å·¥å…·ï¼Œå¦‚gitï¼Œsvnï¼Œmavenï¼Œdocker</li>
</ul>
<p><br/></p>
<h3 id="Jenkins-åº”ç”¨åœºæ™¯"><a href="#Jenkins-åº”ç”¨åœºæ™¯" class="headerlink" title="Jenkins åº”ç”¨åœºæ™¯"></a>Jenkins åº”ç”¨åœºæ™¯</h3><ul>
<li>1) åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œæ‰‹åŠ¨æ„å»ºï¼Œå®Œæˆç®€å•ä»»åŠ¡ï¼Œæ¯”å¦‚æ‹‰å–ä»£ç è¿›è¡Œç¼–è¯‘ï¼ˆæŒç»­é›†æˆï¼‰ã€‚</li>
<li>2) ç¼–è¯‘å¤±è´¥é€šçŸ¥ç”¨æˆ·</li>
<li>3) å‚æ•°åŒ–æ„å»º</li>
<li>4) ä»£ç æ”¹åŠ¨è‡ªåŠ¨è§¦å‘æ„å»ºæˆ–è€…å®šæ—¶è§¦å‘æ„å»º</li>
<li>5) ä¸€ä¸ªé¡¹ç›®æ„å»ºå®Œæˆåè‡ªåŠ¨è°ƒç”¨å¦ä¸€ä¸ªé¡¹ç›®çš„æ„å»ºï¼Œå®Œæˆä¸€è¿ä¸²ä»»åŠ¡</li>
<li>6) å¹¶å‘æ„å»º</li>
<li>7) é›†ç¾¤åŒ–éƒ¨ç½²å¼€å‘ï¼ˆCI/CDï¼‰</li>
</ul>
<p><br/></p>
<h3 id="Jenkins-Job-ç±»å‹"><a href="#Jenkins-Job-ç±»å‹" class="headerlink" title="Jenkins Job ç±»å‹"></a>Jenkins Job ç±»å‹</h3><ul>
<li>1) Freestyle project : è‡ªç”±é£æ ¼é¡¹ç›®ï¼Œä¸»è¦çš„é¡¹ç›®ç±»å‹</li>
<li>2) Maven project : mavené¡¹ç›®ä¸“æœ‰ï¼Œç±»ä¼¼freestyleï¼Œæ›´ç®€å•</li>
<li>3) Multiconfigration project : å¤šé…ç½®é¡¹ç›®ï¼Œé€‚åˆå¤§é‡ä¸åŒé…ç½®ï¼ˆç¯å¢ƒã€å¹³å°ç­‰ï¼‰æ„å»º</li>
<li>4) Pipeline : æµæ°´çº¿é¡¹ç›®ï¼Œé€‚åˆä½¿ç”¨pipeline æ’ä»¶åŠŸèƒ½æ„å»ºæµæ°´çº¿ä»»åŠ¡ï¼Œæˆ–è€…ä½¿ç”¨freestyle projectä¸å®¹æ˜“å®ç°çš„è´Ÿè´£ä»»åŠ¡</li>
<li>5) Multibranch pipeline : å¤šåˆ†æ”¯æµæ°´çº¿é¡¹ç›®ï¼Œæ ¹æ®SCMä»“åº“ä¸­çš„åˆ†æ”¯åˆ›å»ºå¤šä¸ªpipelineé¡¹ç›®</li>
</ul>
<hr>
<h2 id="0x01-å®‰è£…é…ç½®"><a href="#0x01-å®‰è£…é…ç½®" class="headerlink" title="0x01 å®‰è£…é…ç½®"></a>0x01 å®‰è£…é…ç½®</h2><p><strong>å®‰è£…æ–¹å¼</strong><br>å®‰è£…å‚è€ƒ: <a href="https://www.jenkins.io/zh/doc/book/installing/" target="_blank" rel="noopener">https://www.jenkins.io/zh/doc/book/installing/</a></p>
<ul>
<li>Windowsï¼ˆJar ã€Warï¼‰ã€Linuxï¼ˆyum|rpm ã€apt|dpkgï¼‰ã€Mac</li>
<li>Docker</li>
</ul>
<p>PS : Jenkinsé€šå¸¸ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„åº”ç”¨ç¨‹åºåœ¨å…¶è‡ªå·±çš„æµç¨‹ä¸­è¿è¡Œï¼Œ å†…ç½®Java servlet å®¹å™¨/åº”ç”¨ç¨‹åºæœåŠ¡å™¨ï¼ˆJettyï¼‰ã€‚</p>
<p><strong>ç³»ç»Ÿè¦æ±‚</strong><br>æœ€ä½æ¨èé…ç½®:</p>
<ul>
<li>256MB å¯ç”¨å†…å­˜</li>
<li>1GB å¯ç”¨ç£ç›˜ç©ºé—´(ä½œä¸ºä¸€ä¸ªDockerå®¹å™¨è¿è¡Œjenkinsçš„è¯æ¨è10GB)</li>
</ul>
<p>å°å›¢é˜Ÿæ¨èçš„ç¡¬ä»¶é…ç½®:</p>
<ul>
<li>1 GB+ å¯ç”¨å†…å­˜</li>
<li>50 GB+ å¯ç”¨ç£ç›˜ç©ºé—´</li>
</ul>
<p>è½¯ä»¶é…ç½®: Java 8â€”â€‹æ— è®ºæ˜¯Javaè¿è¡Œæ—¶ç¯å¢ƒï¼ˆJREï¼‰è¿˜æ˜¯Javaå¼€å‘å·¥å…·åŒ…ï¼ˆJDKï¼‰éƒ½å¯ä»¥</p>
<p>Tips : å®‰è£…æœ€ä½é…ç½®ï¼šä¸å°‘äº256Må†…å­˜ï¼Œä¸ä½äº1Gç£ç›˜ï¼ŒJDKç‰ˆæœ¬&gt;=8ï¼ˆopenjdkä¹Ÿå¯ä»¥ï¼‰ã€‚</p>
<p>PS : Jenkins ä¾èµ–äº Java ç¯å¢ƒ, å¦‚æœæ˜¯åœ¨ä¸ä½¿ç”¨Dockerå®‰è£…Jenkinsæ—¶å°±éœ€è¦å®‰è£…é…ç½®Javaç¯å¢ƒ;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Jenkins ç‰ˆæœ¬ä¸ Javaç‰ˆæœ¬ä¾èµ–å…³ç³»</span></span><br><span class="line">2.164 (2019-02) and newer: Java 8 or Java 11</span><br><span class="line">2.54 (2017-04) and newer: Java 8</span><br><span class="line">1.612 (2015-05) and newer: Java 7</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h3><p>Jenkinsçš„<code>Debian Package Repository</code>ï¼Œä»¥è‡ªåŠ¨åŒ–å®‰è£…å’Œå‡çº§ã€‚è¦ä½¿ç”¨æ­¤å­˜å‚¨åº“ï¼Œè¯·å…ˆå°†é”®æ·»åŠ åˆ°ç³»ç»Ÿï¼š<br>Jenkins Debian Packagesï¼š<a href="https://pkg.jenkins.io/debian-stable/" target="_blank" rel="noopener">https://pkg.jenkins.io/debian-stable/</a></p>
<p>å®˜æ–¹å®‰è£…:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ   gpg key</span></span><br><span class="line">wget -q -O - https://pkg.jenkins.io/debian-stable/jenkins.io.key | sudo apt-key add -</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ /etc/apt/sources.list ä¸­æ·»åŠ ä»¥ä¸‹æ¡ç›® deb https://pkg.jenkins.io/debian-stable binary/</span></span><br><span class="line">sudo sh -c <span class="string">'echo deb http://pkg.jenkins.io/debian-stable binary/ &gt; /etc/apt/sources.list.d/jenkins.list'</span></span><br><span class="line"><span class="comment"># æ›´æ–°æ‚¨çš„æœ¬åœ°åŒ…ç´¢å¼•ï¼Œç„¶åæœ€ç»ˆå®‰è£…Jenkinsï¼š</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install jenkins</span><br></pre></td></tr></table></figure></p>
<p>å›½å†…å®‰è£…:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Java ç¯å¢ƒå®‰è£…é…ç½® jdk-8u211-linux-x64.tar.gz</span></span><br><span class="line"><span class="comment"># ä¸‹è½½åœ°å€: https://www.oracle.com/cn/java/technologies/javase-downloads.html</span></span><br><span class="line">sudo mkdir /opt/app/ &amp;&amp; <span class="built_in">cd</span> <span class="variable">$_</span></span><br><span class="line">tar -zxvf jdk-8u211-linux-x64.tar.gz -C /usr/<span class="built_in">local</span>/</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¯å¢ƒå˜é‡è®¾ç½®ï¼ˆä¸´æ—¶ç”Ÿæ•ˆï¼‰ set oracle jdk environment</span></span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/jdk1.8.0_211/bin/java /usr/bin/java</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/jdk1.8.0_211 <span class="comment">## è¿™é‡Œè¦æ³¨æ„ç›®å½•è¦æ¢æˆè‡ªå·±è§£å‹çš„jdk ç›®å½•</span></span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre  </span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib  </span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¯å¢ƒå®‰è£…æµ‹è¯•</span></span><br><span class="line">root@jenkins:/usr/<span class="built_in">local</span>/jdk1.8.0_211<span class="comment"># java -version</span></span><br><span class="line">  <span class="comment"># java version "1.8.0_211"</span></span><br><span class="line">  <span class="comment"># Java(TM) SE Runtime Environment (build 1.8.0_211-b12)</span></span><br><span class="line">  <span class="comment"># Java HotSpot(TM) 64-Bit Server VM (build 25.211-b12, mixed mode)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Jenkins ä¸‹è½½&amp; å®‰è£…</span></span><br><span class="line">sudo wget https://mirrors.aliyun.com/jenkins/debian-stable/jenkins_2.263.1_all.deb </span><br><span class="line">sudo dpkg -i jenkins_2.263.1_all.deb</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°ç«™ç‚¹é…ç½® </span></span><br><span class="line">sed -i <span class="string">"s#updates.jenkins.io#mirrors.tuna.tsinghua.edu.cn/jenkins/updates/#g"</span> /var/lib/jenkins/hudson.model.UpdateCenter.xml</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨ Jenkins å¹¶æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">systemctl restart jenkins</span><br><span class="line">systemctl status jenkins</span><br><span class="line">  <span class="comment"># â— jenkins.service - LSB: Start Jenkins at boot time</span></span><br><span class="line">  <span class="comment">#      Loaded: loaded (/etc/init.d/jenkins; generated)</span></span><br><span class="line">  <span class="comment">#      Active: active (exited) since Wed 2020-12-23 14:10:12 UTC; 6s ago</span></span><br><span class="line">  <span class="comment">#        Docs: man:systemd-sysv-generator(8)</span></span><br><span class="line">  <span class="comment">#     Process: 357567 ExecStart=/etc/init.d/jenkins start (code=exited, status=0/SUCCESS)</span></span><br></pre></td></tr></table></figure></p>
<p><strong>å®‰è£…åè®¾ç½®å‘å¯¼:</strong><br>å‚è€ƒåœ°å€: <a href="https://www.jenkins.io/zh/doc/book/installing/#setup-wizard" target="_blank" rel="noopener">https://www.jenkins.io/zh/doc/book/installing/#setup-wizard</a></p>
<ul>
<li>(1) è§£é” Jenkins<br>å½“æ‚¨ç¬¬ä¸€æ¬¡è®¿é—®æ–°çš„Jenkinså®ä¾‹æ—¶ï¼Œç³»ç»Ÿä¼šè¦æ±‚æ‚¨ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„å¯†ç å¯¹å…¶è¿›è¡Œè§£é”ã€‚<br>æµè§ˆåˆ° <a href="http://localhost:8080ï¼ˆæˆ–å®‰è£…æ—¶ä¸ºJenkinsé…ç½®çš„ä»»ä½•ç«¯å£ï¼‰ï¼Œå¹¶ç­‰å¾…è§£é”">http://localhost:8080ï¼ˆæˆ–å®‰è£…æ—¶ä¸ºJenkinsé…ç½®çš„ä»»ä½•ç«¯å£ï¼‰ï¼Œå¹¶ç­‰å¾…è§£é”</a> Jenkins é¡µé¢å‡ºç°ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Jenkinsæ§åˆ¶å°æ—¥å¿—æ˜¾ç¤ºå¯ä»¥è·å–å¯†ç çš„ä½ç½®ï¼ˆåœ¨Jenkinsä¸»ç›®å½•ä¸­ï¼‰</span></span><br><span class="line">cat /var/lib/jenkins/secrets/initialAdminPassword</span><br><span class="line"><span class="comment"># 23092528120a45488a73ff4e7565e06f</span></span><br></pre></td></tr></table></figure>
<ul>
<li>(2) è‡ªå®šä¹‰jenkinsæ’ä»¶<br>è§£é” Jenkinsä¹‹åï¼Œåœ¨ Customize Jenkins é¡µé¢å†…ï¼Œ æ‚¨å¯ä»¥å®‰è£…ä»»ä½•æ•°é‡çš„æœ‰ç”¨æ’ä»¶ä½œä¸ºæ‚¨åˆå§‹æ­¥éª¤çš„ä¸€éƒ¨åˆ†ã€‚<br>ä¸¤ä¸ªé€‰é¡¹å¯ä»¥è®¾ç½®:<ul>
<li>å®‰è£…æ¨èçš„æ’ä»¶ - å®‰è£…æ¨èçš„ä¸€ç»„æ’ä»¶ï¼Œè¿™äº›æ’ä»¶åŸºäºæœ€å¸¸è§çš„ç”¨ä¾‹.</li>
<li>é€‰æ‹©æ’ä»¶æ¥å®‰è£… - é€‰æ‹©å®‰è£…çš„æ’ä»¶é›†ã€‚å½“ä½ ç¬¬ä¸€æ¬¡è®¿é—®æ’ä»¶é€‰æ‹©é¡µé¢æ—¶ï¼Œé»˜è®¤é€‰æ‹©å»ºè®®çš„æ’ä»¶ã€‚(<code>æ–°æ‰‹é¦–æ¬¡æ­å»ºå»ºè®®é€‰æ‹©æ­¤é¡¹</code>)</li>
</ul>
</li>
</ul>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201223223703.png" target="_blank" title="WeiyiGeek.é€‰æ‹©å®‰è£…çš„æ’ä»¶" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201223223703.png" alt="WeiyiGeek.é€‰æ‹©å®‰è£…çš„æ’ä»¶" title="" class=""></a>
                <p>WeiyiGeek.é€‰æ‹©å®‰è£…çš„æ’ä»¶</p>
            </figure>
<p>PS : å¦‚æœæ‚¨ä¸ç¡®å®šéœ€è¦å“ªäº›æ’ä»¶ï¼Œè¯·é€‰æ‹©<code>å®‰è£…å»ºè®®çš„æ’ä»¶</code> ã€‚ æ‚¨å¯ä»¥é€šè¿‡Jenkinsä¸­çš„<code>Manage Jenkins &gt; Manage Plugins</code>é¡µé¢åœ¨ç¨åçš„æ—¶é—´ç‚¹å®‰è£…ï¼ˆæˆ–åˆ é™¤ï¼‰å…¶ä»–Jenkinsæ’ä»¶ ã€‚ </p>
<ul>
<li>(3) ä¸å®‰è£…ä»»ä½•æ’ä»¶è¿›å…¥<code>æ’ä»¶åˆ—è¡¨</code>ç‚¹å‡»å³ä¸Šè§’çš„<code>x</code>å…³é—­çª—å£,æ˜¾ç¤ºå¦‚ä¸‹é¡µé¢åˆ™è·³è¿‡äº†ç®¡ç†å‘˜ç”¨æˆ·å¯†ç é‡è®¾;</li>
</ul>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201223224050.png" target="_blank" title="WeiyiGeek.åˆå§‹åŒ–æˆåŠŸé¡µé¢" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201223224050.png" alt="WeiyiGeek.åˆå§‹åŒ–æˆåŠŸé¡µé¢" title="" class=""></a>
                <p>WeiyiGeek.åˆå§‹åŒ–æˆåŠŸé¡µé¢</p>
            </figure>
<p>PS : ä¸€æ—¦åˆå§‹å®‰è£…å®Œæˆåï¼Œå¯é€šè¿‡æ’ä»¶ç®¡ç†å™¨å®‰è£…å…¶ä»–æ’ä»¶</p>
<ul>
<li>(4) è¿›å…¥ Jenkins æ§åˆ¶å°å®‰è£…æˆåŠŸï¼Œç„¶åç¬¬ä¸€ä¸ªç®¡ç†å‘˜ç”¨æˆ·ï¼›<br>ç‚¹å‡» Dashboard -&gt; admin -&gt; Configure -&gt; Password è¿›è¡Œç®¡ç†å‘˜å¯†ç è®¾ç½®;<br>ä»è¿™æ—¶èµ·ï¼ŒJenkinsç”¨æˆ·ç•Œé¢åªèƒ½é€šè¿‡æä¾›æœ‰æ•ˆçš„ç”¨æˆ·åå’Œå¯†ç å‡­è¯æ¥è®¿é—®ã€‚ </li>
</ul>
<p><a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201223224305.png" target="_blank" title="WeiyiGeek.Jenkins" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201223224305.png" alt="WeiyiGeek.Jenkins"></a></p>
<p><br></p>
<p>Ubuntu ä¸‹ Jenkins ç›¸å…³æ–‡ä»¶åŠå…¶ç›®å½•(ç›®å½•ç»“æ„)ä¸€è§ˆ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®æ–‡ä»¶</span></span><br><span class="line">/etc/default/jenkins</span><br><span class="line"><span class="comment"># /etc/sysconfig/jenkins # CentOS</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®¶ç›®å½•&amp;æ’ä»¶ç›®å½•&amp;æ„å»ºå·¥ä½œç›®å½•</span></span><br><span class="line">/var/lib/jenkins/</span><br><span class="line">/var/lib/jenkins/config.xml  <span class="comment"># jenkins root configuration</span></span><br><span class="line">/var/lib/jenkins/userContent  <span class="comment"># è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶å°†åœ¨http://server/userContent/ä¸‹æä¾›</span></span><br><span class="line">/var/lib/jenkins/plugins   <span class="comment"># æ’ä»¶</span></span><br><span class="line">/var/lib/jenkins/logs      <span class="comment"># å­˜æ”¾jenkinsç›¸å…³çš„æ—¥å¿—</span></span><br><span class="line">/var/lib/jenkins/fingerprints  <span class="comment"># å­˜å‚¨æŒ‡çº¹è®°å½•</span></span><br><span class="line">/var/lib/jenkins/secrets   <span class="comment"># å¯†ç ç§˜é’¥æ‰€åœ¨ç›®å½•</span></span><br><span class="line">/var/lib/jenkins/workspace <span class="comment"># å„ä»»åŠ¡çš„æ„å»ºå·¥ä½œç›®å½•</span></span><br><span class="line">/var/lib/jenkins/<span class="built_in">jobs</span>      <span class="comment"># æµè§ˆå™¨ä¸Šé¢åˆ›å»ºçš„ä»»åŠ¡éƒ½ä¼šå­˜æ”¾åœ¨è¿™é‡Œ</span></span><br><span class="line">          +- [JOBNAME]          <span class="comment"># æ¯ä¸ªä½œä¸šJobçš„å­ç›®å½•</span></span><br><span class="line">              +- config.xml     <span class="comment"># (job configuration file)</span></span><br><span class="line">              +- workspace      <span class="comment"># (working directory for the version control system)</span></span><br><span class="line">              +- latest         <span class="comment"># (symbolic link to the last successful build)</span></span><br><span class="line">              +- builds</span><br><span class="line">                +- [BUILD_ID]      <span class="comment"># (for each build)</span></span><br><span class="line">                  +- build.xml     <span class="comment"># (build result summary)</span></span><br><span class="line">                  +- <span class="built_in">log</span>           <span class="comment"># (log file)</span></span><br><span class="line">                  +- changelog.xml  <span class="comment"># (change log)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨æ–‡ä»¶ &#123;start|stop|status|restart|force-reload&#125;</span></span><br><span class="line">/etc/init.d/jenkins</span><br><span class="line"></span><br><span class="line"><span class="comment"># systemd ç®¡ç†çš„serice</span></span><br><span class="line">/run/systemd/generator.late/jenkins.service</span><br><span class="line">/run/systemd/generator.late/graphical.target.wants/jenkins.service</span><br><span class="line">/run/systemd/generator.late/multi-user.target.wants/jenkins.service</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>æ–‡ä»¶å†…å®¹&amp;ç›®å½•ç»“æ„è¯¦ç»†è¯´æ˜</strong></p>
<ul>
<li><p>1.config.xml æ ¸å¿ƒé…ç½®æ–‡ä»¶: åŒ…å«äº†Jenkinsçš„ç‰ˆæœ¬ä¿¡æ¯ã€æƒé™è®¤è¯è§„åˆ™ã€workspaceç›®å½•å®šä¹‰ã€buildsç›®å½•å®šä¹‰ã€è§†å›¾ä¿¡æ¯ç­‰ç­‰ã€‚å…¶ä»–çš„ xml æ–‡ä»¶æ˜¯ Jekins æœåŠ¡æ‰©å±•åŠŸèƒ½çš„é…ç½®ä¿¡æ¯æ–‡ä»¶ã€‚</p>
</li>
<li><p>2.plugins æ’ä»¶ç›®å½•: å·²ç»å®‰è£…çš„Jenkinsæ’ä»¶éƒ½å¯ä»¥åœ¨é‡Œé¢æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ã€‚æ¯ä¸€ä¸ªæ’ä»¶åŸºæœ¬æ˜¯ç”±ä¸€ä¸ªç›®å½•å’Œä¸€ä¸ªä¸ç›®å½•åŒåçš„æ–‡ä»¶é…å¯¹ç»„æˆã€‚</p>
</li>
<li><p>3.jobs æ‰§è¡Œä»»åŠ¡å­˜å‚¨ç›®å½•: è¯¥ç›®å½•æ˜¯ Jenkins ç®¡ç†çš„æ‰€æœ‰<code>æ„å»ºä»»åŠ¡çš„é…ç½®ç»†èŠ‚ã€æ„å»ºåçš„äº§ç‰©å’Œæ•°æ®</code>ã€‚Jenkins æœåŠ¡æ‰€æœ‰çš„ Job éƒ½ä¼šåœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªä»¥ Job åç§°å‘½åçš„æ–‡ä»¶å¤¹ã€‚<br>job ä»»åŠ¡çš„æ–‡ä»¶å¤¹ä¸­å­˜å‚¨çš„æ–‡ä»¶æœ‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">config.xml ä»»åŠ¡çš„XMLæ ¼å¼å£°æ˜ä¿¡æ¯ã€‚</span><br><span class="line">nextBuildNumber æ–‡ä»¶è®°å½•ä¸‹æ¬¡æ„å»ºæ—¶çš„ buildNumber</span><br><span class="line">builds ç›®å½•å­˜å‚¨æ­¤ Job æ„å»ºçš„å†å²ã€‚</span><br><span class="line"></span><br><span class="line">~ $ ls &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;jobs&#x2F;</span><br><span class="line">HelloWorld  Kubernetes-jenkins-slave  pineline-use-node</span><br></pre></td></tr></table></figure>
</li>
<li><p>4.workspace å·¥ä½œç©ºé—´ç›®å½•: åŒ…å«äº†è¿™ä¸ªæ„å»ºä½œä¸šçš„æºä»£ç , Jenkinså­˜æ”¾é¡¹ç›®çš„å·¥ä½œç©ºé—´ã€‚è¿›å…¥è¿™ä¸ªworkspaceç›®å½•ï¼Œé‡Œé¢å°±æ˜¯ä½ ä¹‹å‰åˆ›å»ºçš„é¡¹ç›®çš„ç›®å½•ã€‚åœ¨æ„å»ºè¿‡ç¨‹ä¸­Jenkinsä¼šæ ¹æ®é¡¹ç›®ä¸­é…ç½®çš„è¿œç¨‹ä»£ç ä»“åº“çš„åœ°å€å»æ‹‰å–æºç åˆ°é¡¹ç›®ç›®å½•ä¸­å¹¶åœ¨è¿™é‡Œå®Œæˆæ‰“åŒ…ã€‚ä¹‹å‰æˆ‘ä»¬åœ¨æ‰“åŒ…çš„è„šæœ¬ä¸­ç”¨åˆ°çš„<code>$WORKSPACE</code>è¡¨ç¤ºçš„å°±æ˜¯workspaceä¸‹å¯¹åº”é¡¹ç›®çš„ç›®å½•ã€‚</p>
</li>
</ul>
<ul>
<li>5.tools å·¥å…·ç›®å½•: Jenkins æœåŠ¡è®¾ç½®å®‰è£… tools ï¼Œä¼šå®‰è£…åœ¨è¿™ä¸ªç›®å½•ä¸­ã€‚å®‰è£…å·¥å…·çš„æ–¹å¼æ˜¯ï¼šã€Manage Jenkinsã€‘ -&gt; ã€Global Tool Configurationã€‘ é¡µé¢ã€‚</li>
</ul>
<ul>
<li><p>6.updates æ›´æ–°ç›®å½•: ç”¨æ¥å­˜æ”¾å¯ç”¨çš„æ’ä»¶æ›´æ–°ã€‚</p>
</li>
<li><p>7.users ç”¨æˆ·ä¿¡æ¯ç›®å½•: å­˜å‚¨ç”¨æˆ·çš„è´¦å·ä¿¡æ¯ã€‚</p>
</li>
<li><p>8.nodes èŠ‚ç‚¹ç›®å½•: Jenkins åœ¨é…ç½®äº†ä¸»ä»æˆ–è€…å·¥ä½œèŠ‚ç‚¹ä¹‹åä¼šåœ¨è¿™é‡Œæœ‰ç›¸åº”çš„ä¿¡æ¯ã€‚</p>
</li>
<li><p>9.userContent ç”¨æˆ·ç”Ÿæˆçš„æ–‡ä»¶: ç”¨äºå­˜å‚¨åœ¨ Jenkins ç®¡ç†è¿‡ç¨‹ä¸­ç”Ÿæˆçš„æ–‡ä»¶ï¼›æ¯”å¦‚ä½¿ç”¨<code>Convert To Pipeline æ’ä»¶</code>å¯ä»¥å°† JOB è½¬æ¢æˆ Pipelineï¼Œç”Ÿæˆçš„ Pipeline çš„å†…å®¹ä¼šä»¥æ–‡ä»¶çš„å½¢å¼å­˜å‚¨åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚</p>
</li>
<li><p>10.fingerprints æ–‡ä»¶æŒ‡çº¹ç›®å½•: <code>æ–‡ä»¶æŒ‡çº¹ï¼ˆfingerprintsï¼‰</code>æ˜¯ä¸€ä¸ªç®€å•çš„MD5æ ¡éªŒå’Œã€‚Jenkinsç»´æŠ¤äº†ä¸€ä¸ªmd5sumæ•°æ®åº“ï¼Œç”¨äºæ–‡ä»¶æŒ‡çº¹æ ¡éªŒã€‚å¯¹äºæ¯ä¸ªmd5sumï¼ŒJenkinsè®°å½•äº†å“ªäº›é¡¹ç›®çš„å“ªäº›æ„å»ºä½¿ç”¨äº†ä»–ã€‚åœ¨æ¯æ¬¡æ„å»ºè¿è¡Œå’Œæ–‡ä»¶è¢«é‡‡é›†æŒ‡çº¹æ—¶è¿™ä¸ªæ•°æ®åº“ä¼šæ›´æ–°ã€‚ä¸ºäº†é¿å…è¿‡å¤šçš„ç£ç›˜ä½¿ç”¨ï¼ŒJenkinsä¸å­˜å‚¨å®é™…çš„æ–‡ä»¶ã€‚ç›¸åå®ƒåªå­˜å‚¨md5sumå’Œå®ƒçš„ä½¿ç”¨è®°å½•ã€‚</p>
</li>
<li><p>11.logs æ—¥å¿—ç›®å½•: ç”¨äºå­˜å‚¨ Jenkins æœåŠ¡çš„æ—¥å¿—ï¼Œä¸»è¦æ˜¯äº‹ä»¶æ—¥å¿—å’Œå·¥ä½œæ—¥å¿—ã€‚</p>
</li>
<li><p>12.war ç›®å½•: å¦‚æœæ˜¯ä»¥WARåŒ…å½¢å¼è¿è¡Œçš„Jenkinsï¼Œè¯¥ç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯è§£å‹åçš„WARåŒ…ã€‚</p>
</li>
<li><p>13.Jenkins æœåŠ¡å¦å¤–çš„æ–‡ä»¶ç›®å½•:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">secrets</span><br><span class="line">init.groovy.d</span><br><span class="line">workflow-libs</span><br><span class="line">scriptler</span><br><span class="line">config-history</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Tips: jenkinså­˜æ”¾æ•°æ®ä¸ä¾é æ•°æ®åº“æ‰€ä»¥åœ¨ç§»æ¤æ—¶åªéœ€è¦æ‹·è´æ•´ä¸ªç¨‹åºä¸»ç›®å½•å³å¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯jobså’Œpluginsç›®å½•æ¯”è¾ƒé‡è¦</p>
<p><br></p>
<h3 id="Docker-å®‰è£…"><a href="#Docker-å®‰è£…" class="headerlink" title="Docker å®‰è£…"></a>Docker å®‰è£…</h3><p>æè¿°: ä½¿ç”¨å®¹å™¨åŒ–çš„æ–¹å¼éƒ¨ç½² Jenkins Master èŠ‚ç‚¹ï¼Œå¯ä»¥é€‰æ‹©è‡ªè¡Œæ„å»ºé•œåƒï¼Œæ¨èä½¿ç”¨ Jenkins å®˜æ–¹æä¾›çš„é•œåƒã€‚</p>
<p>Jenkins æœåŠ¡å®˜æ–¹åœ¨ dockerhub å¹³å°å‘å¸ƒå®˜æ–¹é•œåƒ<a href="https://hub.docker.com/u/jenkins" target="_blank" rel="noopener">https://hub.docker.com/u/jenkins</a></p>
<p><strong>1.Jenkins Master é•œåƒåŸºç¡€ä½¿ç”¨</strong></p>
<ul>
<li>Jenkins Web æœåŠ¡ç›‘å¬çš„ç«¯å£ä¸º 8080</li>
<li>Jenkins ä½¿ç”¨JNLP è¿æ¥ Agent èŠ‚ç‚¹ä½¿ç”¨çš„ç«¯å£ä¸º 5000</li>
<li>Jenkins åœ¨ /var/jenkins_home ç›®å½•ä¸­ä¿å­˜workspaceä¸­çš„æ•°æ®ï¼ŒåŒ…æ‹¬æ’ä»¶å’Œé…ç½®ä¿¡æ¯</li>
<li>Jenkins æœåŠ¡é»˜è®¤ä½¿ç”¨jenkins ç”¨æˆ·è¿è¡Œï¼Œuidä¸º1000ï¼›è¯·æ³¨æ„æ–‡ä»¶æƒé™é—®é¢˜</li>
</ul>
<p><br></p>
<p><strong>2.Jenkins Master ä½¿ç”¨å’Œå‡çº§</strong><br>ä½¿ç”¨ Jenkins çš„é•œåƒæ„å»ºå®¹å™¨æ—¶ï¼Œè‡³å°‘è¦å°†ç«¯å£æ˜ å°„å‡ºå»ï¼Œå°†/var/jenkins_home ç›®å½•åšæŒä¹…åŒ–ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹ï¼šç”¨ jenkinsï¼š2.107.3 åˆ›å»ºå®¹å™¨å¹¶è¿è¡Œã€‚</span></span><br><span class="line">docker volume create jenkins-data</span><br><span class="line">docker run --name jenkins-production \</span><br><span class="line">           --detach \</span><br><span class="line">           -p 50000:50000 \</span><br><span class="line">           -p 8080:8080 \</span><br><span class="line">           -v jenkins-data:/var/jenkins_home \</span><br><span class="line">           jenkins/jenkins:2.275-alpine</span><br><span class="line"><span class="comment"># If run for the first time, just run the following to get the admin</span></span><br><span class="line"><span class="comment"># password once it has finished starting</span></span><br><span class="line">docker <span class="built_in">exec</span> jenkins-production bash -c <span class="string">'cat $JENKINS_HOME/secrets/initialAdminPassword'</span></span><br></pre></td></tr></table></figure></p>
<p>åœ¨éœ€è¦å¯¹ Jenkins æœåŠ¡å‡çº§æ—¶ï¼Œåªéœ€è¦ä½¿ç”¨æ–°çš„é•œåƒæ›¿æ¢å³å¯ï¼›æŒä¹…åŒ–å­˜å‚¨å’Œç«¯å£æ˜ å°„æ“ä½œç›¸åŒã€‚<br>ç¤ºä¾‹ï¼šå°† Jenkins æœåŠ¡å‡çº§åˆ° 2.121.3<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker stop jenkins-production</span><br><span class="line">docker rm jenkins-production </span><br><span class="line"><span class="comment"># just temporarily docker rename it instead if that makes you worried</span></span><br><span class="line">docker run --name jenkins-production \</span><br><span class="line">           --detach \</span><br><span class="line">           -p 50000:50000 \</span><br><span class="line">           -p 8080:8080 \</span><br><span class="line">           -v jenkins-data:/var/jenkins_home \</span><br><span class="line">           jenkins/jenkins:2.277-alpine</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>3.Jenkins Master èŠ‚ç‚¹é…ç½®æ‰©å±•(äº†è§£å³å¯)</strong></p>
<ul>
<li><p>3.1 è®¾ç½®Master èŠ‚ç‚¹çš„æ‰§è¡Œè€… executors æ•°é‡<br>æè¿°: ä½¿ç”¨groovyè„šæœ¬æŒ‡å®šå¹¶è®¾ç½®Jenkins Master å®ä¾‹çš„æ‰§è¡Œç¨‹åºæ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒè®¾ç½®ä¸º2ä¸ªæ‰§è¡Œè€…ï¼Œä½†æ˜¯æ‚¨å¯ä»¥æ‰©å±•æ˜ åƒå¹¶å°†å…¶æ›´æ”¹ä¸ºæ‰€éœ€çš„æ‰§è¡Œè€…æ•°:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">executors.groovy</span><br><span class="line">import jenkins.model.*</span><br><span class="line">Jenkins.instance.setNumExecutors(5)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å’Œ Dockerfile</span></span><br><span class="line"></span><br><span class="line">FROM jenkins/jenkins:lts</span><br><span class="line">COPY executors.groovy /usr/share/jenkins/ref/init.groovy.d/executors.groovy</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.2 ä¼ é€’ JVM çš„å¯åŠ¨å‚æ•°<br>æè¿°: æ‚¨å¯èƒ½éœ€è¦è‡ªå®šä¹‰è¿è¡ŒJenkinsçš„ JVMï¼Œé€šå¸¸æ˜¯ä¸ºäº†ä¼ é€’ç³»ç»Ÿå±æ€§ï¼ˆpropsåˆ—è¡¨ï¼‰æˆ–è°ƒæ•´å †å†…å­˜è®¾ç½®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨JAVA_OPTSç¯å¢ƒå˜é‡ï¼š</span></span><br><span class="line">docker run --name myjenkins -p 8080:8080 -p 50000:50000 --env JAVA_OPTS=-Dhudson.footerURL=http://mycompany.com jenkins/jenkins:lts</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.3 ç»™ Jenkins å¯åŠ¨å™¨ä¼ é€’å‚æ•°<br>æè¿°: æ‚¨ä¼ é€’ç»™è¿è¡Œ Jenkins é•œåƒçš„ docker çš„å‚æ•°å°†ä¼ é€’ç»™ jenkins å¯åŠ¨å™¨ ï¼Œä¾‹å¦‚è¿è¡Œ <code>docker run jenkins/jenkins:lts --version</code> å°†æ˜¾ç¤ºJenkinsç‰ˆæœ¬</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡å®šä¹‰Jenkinså‚æ•° JENKINS_OPTS</span></span><br><span class="line">ç¤ºä¾‹1.Dockerfileä½¿ç”¨æ­¤é€‰é¡¹æ¥å¼ºåˆ¶å°†HTTPSä¸æ˜ åƒä¸­åŒ…å«çš„è¯ä¹¦ä¸€èµ·ä½¿ç”¨ã€‚</span><br><span class="line">FROM jenkins/jenkins:lts</span><br><span class="line">COPY https.pem /var/lib/jenkins/cert</span><br><span class="line">COPY https.key /var/lib/jenkins/pk</span><br><span class="line">ENV JENKINS_OPTS --httpPort=-1 --httpsPort=8083 --httpsCertificate=/var/lib/jenkins/cert --httpsPrivateKey=/var/lib/jenkins/pk</span><br><span class="line">EXPOSE 8083</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡å®šä¹‰Jenkinså‚æ•° JENKINS_SLAVE_AGENT_PORT</span></span><br><span class="line">ç¤ºä¾‹2.Dockerfileä¸­å®šä¹‰æ¥æ›´æ”¹jenkinsçš„é»˜è®¤ä»å±ä»£ç†ç«¯å£ã€‚</span><br><span class="line">FROM jenkins/jenkins:lts</span><br><span class="line">ENV JENKINS_SLAVE_AGENT_PORT 50001</span><br><span class="line"><span class="comment"># æˆ–ä½œä¸ºdockerçš„å‚æ•°</span></span><br><span class="line">docker run --name myjenkins -p 8080:8080 -p 50001:50001 --env JENKINS_SLAVE_AGENT_PORT=50001 jenkins/jenkins:lts</span><br></pre></td></tr></table></figure>
<p>Tips ï¼šæ­¤ç¯å¢ƒå˜é‡å°†ç”¨äºè®¾ç½®å°†ç³»ç»Ÿå±æ€§æ·»åŠ <code>jenkins.model.Jenkins.slaveAgentPort</code>åˆ°JAVA_OPTSçš„ç«¯å£ ã€‚</p>
</li>
<li><p>3.4 é…ç½®æ—¥å¿—è®°å½•<br>æè¿°: å¯ä»¥é€šè¿‡å±æ€§æ–‡ä»¶å’Œ<code>java.util.logging.config.fileJava</code>å±æ€§æ¥é…ç½®Jenkinsæ—¥å¿—è®°å½•ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mkdir data</span><br><span class="line"></span><br><span class="line">cat &gt; data/log.properties &lt;&lt;EOF</span><br><span class="line">handlers=java.util.logging.ConsoleHandler</span><br><span class="line">jenkins.level=FINEST</span><br><span class="line">java.util.logging.ConsoleHandler.level=FINEST</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">docker run --name myjenkins -p 8080:8080 -p 50000:50000 \</span><br><span class="line">--env JAVA_OPTS=<span class="string">"-Djava.util.logging.config.file=/var/jenkins_home/log.properties"</span>\</span><br><span class="line"> - v `<span class="built_in">pwd</span>`/data:/var/jenkins_home jenkins/jenkins:lts</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.5 è°ƒæ•´Jenkins æµè§ˆå™¨è®¿é—®çš„è·¯å¾„path<br>æè¿°: å¦‚æœæ‚¨éœ€è¦åœ¨æµè§ˆå™¨ä¸­è®¿é—® Jenkins æœåŠ¡æ—¶è¦æ·»åŠ ä¸€ä¸ª path è·¯å¾„ï¼Œåˆ™éœ€è¦æ·»åŠ ç¯å¢ƒå˜é‡<code>JENKINS_OPTS=&quot;--prefix=/jenkins&quot;</code>ã€‚</p>
</li>
</ul>
<p><br></p>
<p>Tips : å®¹å™¨ä¸­ Docker å®¢æˆ·ç«¯é…ç½®</p>
<ul>
<li><p>1.æ„å»º NodeJS ä»»åŠ¡æ‰§è¡Œé•œåƒçš„ Dockerfile æ–‡ä»¶å†…å®¹:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM docker.io/node:alpine</span><br><span class="line">run apk add --no-cache git docker-cli</span><br><span class="line">RUN yarn config <span class="built_in">set</span> registry <span class="string">"https://registry.npmmirror.com"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>2.é…ç½® Docker å®¢æˆ·ç«¯è¿æ¥è¿œç¨‹çš„ Docker æœåŠ¡ç«¯:ä½¿ç”¨ä¸€ä¸ªç¯å¢ƒå˜é‡å°±å¯ä»¥å®ç°è¿™ä¸ªé…ç½®ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">env:</span><br><span class="line">- name: DOCKER_HOST</span><br><span class="line">  value: tcp:&#x2F;&#x2F;docker.example.com:2375</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Tips : é…ç½®é•œåƒä»“åº“çš„è®¤è¯ä¿¡æ¯,è®¤è¯ä¿¡æ¯ä¸€èˆ¬å­˜å‚¨åœ¨ <code>/root/.docker/config.json</code> æ–‡ä»¶ä¸­ã€‚è¿™é‡Œå¯ä»¥æ¨¡ä»¿å‰é¢ Maven æœåŠ¡çš„ settings.xml æ–‡ä»¶çš„é…ç½®æ–¹å¼é…ç½®, ç„¶åå°±å¯ä»¥å®ç°äº†è¿æ¥ Docker Server ç«¯æ„å»ºé•œåƒï¼Œå¯¹é•œåƒæ‰“ tag çš„æ“ä½œ, ç„¶åå°†åˆ¶ä½œå¥½çš„é•œåƒæ¨é€åˆ°è¿œç¨‹çš„é•œåƒä»“åº“ä¸­ï¼Œä¾‹å¦‚Harborã€‚</p>
<p><br></p>
<h3 id="Kubernetes-å®‰è£…"><a href="#Kubernetes-å®‰è£…" class="headerlink" title="Kubernetes å®‰è£…"></a>Kubernetes å®‰è£…</h3><p>è¯·å‚è€ƒåç»­çš„ <code>&lt;(2) é›†ç¾¤æ­å»ºJenkins Master èŠ‚ç‚¹&gt;</code> ç« èŠ‚çš„æ–‡ç« ã€‚</p>
<hr>
<h2 id="0x02-åŸºç¡€çŸ¥è¯†"><a href="#0x02-åŸºç¡€çŸ¥è¯†" class="headerlink" title="0x02 åŸºç¡€çŸ¥è¯†"></a>0x02 åŸºç¡€çŸ¥è¯†</h2><h3 id="Jenkins-ç¯å¢ƒå˜é‡"><a href="#Jenkins-ç¯å¢ƒå˜é‡" class="headerlink" title="Jenkins ç¯å¢ƒå˜é‡"></a>Jenkins ç¯å¢ƒå˜é‡</h3><p>æè¿°: ç¯å¢ƒå˜é‡å¯ä»¥è¢«çœ‹ä½œæ˜¯pipelineä¸Jenkinsäº¤äº’çš„åª’ä»‹, ç¯å¢ƒå˜é‡å¯ä»¥åˆ†ä¸º<code>Jenkinså†…ç½®å˜é‡</code>å’Œ<code>è‡ªå®šä¹‰å˜é‡</code>ä»¥åŠ<code>è‡ªå®šä¹‰å…¨å±€ç¯å¢ƒå˜é‡</code>ã€‚</p>
<p>æ¯”å¦‚ï¼Œå¯ä»¥åœ¨ pipeline ä¸­é€šè¿‡ BUILD_NUMBER å˜é‡çŸ¥é“æ„å»ºä»»åŠ¡çš„å½“å‰æ„å»ºæ¬¡æ•°ã€‚</p>
<p><strong>1.å†…ç½®å˜é‡</strong><br>æè¿°: åœ¨pipelineæ‰§è¡Œæ—¶ï¼ŒJenkinsé€šè¿‡ä¸€ä¸ªåä¸º env çš„å…¨å±€å˜é‡ï¼Œå°†Jenkinså†…ç½®ç¯å¢ƒå˜é‡æš´éœ²å‡ºæ¥ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;env.BUILD_NUMBER&#125;</span> æ–¹å¼ä¸€ï¼Œæ¨èä½¿ç”¨</span><br><span class="line"><span class="variable">$env</span>.BUILD_NUMBER æ–¹å¼äºŒ,</span><br><span class="line"><span class="variable">$&#123;BUILD_NUMBER&#125;</span> æ–¹å¼ä¸‰ï¼Œä¸æ¨èä½¿ç”¨</span><br></pre></td></tr></table></figure></p>
<p>ä¾‹å¦‚:åœ¨å®é™…å·¥ä½œä¸­ç»å¸¸ç”¨åˆ°çš„å˜é‡ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BUILD_URLï¼šå½“å‰æ„å»ºçš„é¡µé¢URLã€‚</span><br><span class="line">BUILD_NUMBERï¼šæ„å»ºå·ï¼Œç´¯åŠ çš„æ•°å­—ã€‚</span><br><span class="line">BRANCH_NAMEï¼šå¤šåˆ†æ”¯pipelineé¡¹ç›®æ”¯æŒã€‚</span><br><span class="line">GIT_BRANCHï¼šé€šè¿‡gitæ‹‰å–çš„æºç æ„å»ºçš„é¡¹ç›®æ‰ä¼šæœ‰æ­¤å˜é‡ã€‚</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>2.è‡ªå®šä¹‰ç¯å¢ƒå˜é‡</strong><br>æè¿°: å½“ pipeline å˜å¾—å¤æ‚æ—¶ï¼Œæˆ‘ä»¬å°±ä¼šæœ‰å®šä¹‰è‡ªå·±çš„ç¯å¢ƒå˜é‡çš„éœ€æ±‚ã€‚å£°æ˜å¼ pipeline æä¾›äº†environment æŒ‡ä»¤ï¼Œæ–¹ä¾¿è‡ªå®šä¹‰å˜é‡ã€‚</p>
<p>å¦å¤– environment æŒ‡ä»¤å¯ä»¥åœ¨pipelineä¸­å®šä¹‰ï¼Œä»£è¡¨å˜é‡ä½œç”¨åŸŸä¸ºæ•´ä¸ª pipelineï¼›ä¹Ÿå¯ä»¥åœ¨ stage ä¸­å®šä¹‰ï¼Œä»£è¡¨å˜é‡åªåœ¨è¯¥é˜¶æ®µæœ‰æ•ˆã€‚</p>
<p>Tips : å¦‚æœåœ¨environmentä¸­å®šä¹‰çš„å˜é‡ä¸envä¸­çš„å˜é‡é‡åï¼Œé‚£ä¹ˆè¢«é‡åçš„å˜é‡çš„å€¼ä¼šè¢«è¦†ç›–æ‰ã€‚</p>
<p><br></p>
<p><strong>3.è‡ªå®šä¹‰å…¨å±€ç¯å¢ƒå˜é‡</strong><br>æè¿°: å¦‚æœæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€äº›å…¨å±€çš„è·¨pipelineçš„è‡ªå®šä¹‰å˜é‡ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥è¿›å…¥ <code>Manage Jenkinsâ†’Configure Systemâ†’Global properties</code> é¡µï¼Œå‹¾é€‰<code>â€œEnvironment variablesâ€å¤é€‰æ¡†</code>ï¼Œå•å‡»â€œAddâ€æŒ‰é’®ï¼Œåœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥å˜é‡åå’Œå˜é‡å€¼å³å¯ï¼Œ</p>
<p>Tips : è‡ªå®šä¹‰å…¨å±€ç¯å¢ƒå˜é‡ä¼šè¢«åŠ å…¥ env å±æ€§åˆ—è¡¨ä¸­ï¼Œæ‰€ä»¥ï¼Œä½¿ç”¨è‡ªå®šä¹‰å…¨å±€ç¯å¢ƒå˜é‡ä¸ä½¿ç”¨Jenkinså†…ç½®å˜é‡çš„æ–¹æ³•æ— å¼‚ã€‚</p>
<p>Tips : Jenkins å†…ç½®å˜é‡å‚è€ƒ è¯·çœ‹è¡¥å……è¯´æ˜ä¸­çš„å†…ç½®ç¯å¢ƒå˜é‡</p>
<p><br/></p>
<h3 id="Jenkins-å‚æ•°æ„å»ºç±»å‹"><a href="#Jenkins-å‚æ•°æ„å»ºç±»å‹" class="headerlink" title="Jenkins å‚æ•°æ„å»ºç±»å‹"></a>Jenkins å‚æ•°æ„å»ºç±»å‹</h3><p>ä¸»è¦ç¼ºçœå‚æ•°ç±»å‹å¦‚ä¸‹å‡ ç±»:</p>
<ul>
<li>Boolean å‚æ•°</li>
<li>Choice å‚æ•°  (å¸¸ç”¨)</li>
<li>String å‚æ•° ï¼ˆå¸¸ç”¨ï¼‰</li>
<li>File å‚æ•°</li>
<li>å¯†ç  å‚æ•°</li>
<li>å‡­æ® å‚æ•°</li>
<li>å…¶ä»– å‚æ•°</li>
<li>è¿è¡Œæ—¶ å‚æ•°</li>
</ul>
<p>é¢å¤–çš„æˆ‘ä»¬éœ€è¦å®‰è£…Extended Choice Parameter å’Œ git Parameterï¼Œä»¥ä¾¿å‘ Choice å‚æ•°æ·»åŠ æ‰©å±•åŠŸèƒ½ ä»¥åŠ ä½¿ç”¨Gitå‚æ•°æ¥è·å–åˆ†æ”¯ã€‚</p>
<p><strong>ä½¿ç”¨è¿‡ç¨‹</strong><br>åœ¨å‚æ•°åŒ–æ„å»ºè¿‡ç¨‹ -&gt; æ„å»ºå‚æ•°æ·»åŠ  -&gt; æ„å»ºå‚æ•°çš„å˜é‡ -&gt;é€šè¿‡ <code>$paramater æˆ–è€… ${paramater}</code>çš„å½¢å¼ä½¿ç”¨</p>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210126172832.png" target="_blank" title="WeiyiGeek.æ„å»ºå‚æ•°" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210126172832.png" alt="WeiyiGeek.æ„å»ºå‚æ•°" title="" class=""></a>
                <p>WeiyiGeek.æ„å»ºå‚æ•°</p>
            </figure>
<p>Tips ï¼š ç¯å¢ƒå˜é‡ç”Ÿæ•ˆçš„é¡ºåº<code>å…¨å±€ç¯å¢ƒå˜é‡ &lt; slaveé…ç½®ç¯å¢ƒå˜é‡ &lt; JOBå‚æ•° &lt; JOB injectedç¯å¢ƒå˜é‡</code></p>
<p>å®˜ç½‘åœ°å€: <a href="https://www.jenkins.io/" target="_blank" rel="noopener">https://www.jenkins.io/</a><br>å®˜æ–¹æ–‡æ¡£: <a href="https://www.jenkins.io/zh/doc/" target="_blank" rel="noopener">https://www.jenkins.io/zh/doc/</a></p>
<p><br></p>
<h3 id="Jenkins-å¹¶å‘æ„å»º"><a href="#Jenkins-å¹¶å‘æ„å»º" class="headerlink" title="Jenkins å¹¶å‘æ„å»º"></a>Jenkins å¹¶å‘æ„å»º</h3><p>æè¿°: æˆ‘ä»¬åˆ›å»ºJobå¯ä»¥è¿›è¡Œå¹¶å‘æ„å»ºï¼Œæ¯ä¸ªå¹¶å‘æ„å»ºä½¿ç”¨å•ç‹¬çš„workspaceï¼Œé»˜è®¤æ˜¯<code>&lt;workspace path&gt;@&lt;num&gt;</code></p>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210126173532.png" target="_blank" title="WeiyiGeek.å¹¶å‘æ„å»º" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210126173532.png" alt="WeiyiGeek.å¹¶å‘æ„å»º" title="" class=""></a>
                <p>WeiyiGeek.å¹¶å‘æ„å»º</p>
            </figure>
<p>Tips : slave ä¹Ÿå¯ä»¥è¿›è¡Œå¹¶å‘æ„å»ºå‰ææ˜¯éœ€è¦<code>Node and Label parameter plugin</code>æ’ä»¶ï¼Œå¹¶ä¸”éœ€è¦é…ç½®nodeç±»å‹å‚æ•°;</p>
<p><br></p>
<h3 id="Jenkins-è‡ªåŠ¨åŒ–æ„å»º"><a href="#Jenkins-è‡ªåŠ¨åŒ–æ„å»º" class="headerlink" title="Jenkins è‡ªåŠ¨åŒ–æ„å»º"></a>Jenkins è‡ªåŠ¨åŒ–æ„å»º</h3><p><strong>å¸¸è§çš„triggerså‡ ç§:</strong></p>
<ul>
<li>Build periodically : è®¾å®šç±»ä¼¼cronå‘¨æœŸæ€§æ—¶é—´è§¦å‘æ„å»º</li>
<li>poll SCM : è®¾å®šç±»ä¼¼ cron å‘¨æœŸæ€§æ—¶é—´è§¦å‘æ£€æŸ¥ä»£ç å˜åŒ–ï¼Œåªæœ‰ä»£ç å˜åŠ¨æ—¶æ‰è§¦å‘æ„å»º</li>
<li>Hooks : ç”¨è¿‡SVNçš„éƒ½çŸ¥é“é’©å­ <code>Github hooks / Gitlab hooks</code></li>
<li>Events : Gerrit event</li>
</ul>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210127092748.png" target="_blank" title="WeiyiGeek.triggers" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210127092748.png" alt="WeiyiGeek.triggers" title="" class=""></a>
                <p>WeiyiGeek.triggers</p>
            </figure>
<p><strong>build periodically</strong><br>æè¿°: H ä»£è¡¨ jenkins è‡ªå·±åˆ†é…æ—¶é—´ä¸å»æŒ‡å®šå®¢è§‚æ—¶é—´, æ³¨æ„ä¸€èˆ¬éƒ½æ˜¯Jenkinsæ ¹æ®ç›‘æ§èµ„æºåˆ©ç”¨ç‡ç®—æ³•åˆ†é…çš„ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># * * * * *</span></span><br><span class="line"><span class="comment"># ç¬¬ä¸€é¢—*è¡¨ç¤ºåˆ†é’Ÿï¼Œå–å€¼0~59</span></span><br><span class="line"><span class="comment"># ç¬¬äºŒé¢—*è¡¨ç¤ºå°æ—¶ï¼Œå–å€¼0~23</span></span><br><span class="line"><span class="comment"># ç¬¬ä¸‰é¢—*è¡¨ç¤ºä¸€ä¸ªæœˆçš„ç¬¬å‡ å¤©ï¼Œå–å€¼1~31</span></span><br><span class="line"><span class="comment"># ç¬¬å››é¢—*è¡¨ç¤ºç¬¬å‡ æœˆï¼Œå–å€¼1~12</span></span><br><span class="line"><span class="comment"># ç¬¬äº”é¢—*è¡¨ç¤ºä¸€å‘¨ä¸­çš„ç¬¬å‡ å¤©ï¼Œå–å€¼0~7ï¼Œå…¶ä¸­0å’Œ7ä»£è¡¨çš„éƒ½æ˜¯å‘¨æ—¥</span></span><br><span class="line"></span><br><span class="line">1.æ¯30åˆ†é’Ÿæ„å»ºä¸€æ¬¡ï¼šH/30 * * * *</span><br><span class="line"></span><br><span class="line">2.æ¯2ä¸ªå°æ—¶æ„å»ºä¸€æ¬¡ H H/2 * * *</span><br><span class="line"></span><br><span class="line">3.æ¯å¤©æ—©ä¸Š8ç‚¹æ„å»ºä¸€æ¬¡: 0 8 * * *</span><br><span class="line"></span><br><span class="line">4.æ¯å¤©çš„8ç‚¹ï¼Œ12ç‚¹ï¼Œ22ç‚¹ï¼Œä¸€å¤©æ„å»º3æ¬¡ 0 8,12,22 * * *</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤šä¸ªæ—¶é—´ç‚¹ï¼Œä¸­é—´ç”¨é€—å·éš”å¼€</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>Poll SCM</strong><br>æè¿°: ä»–ä¼šå®šæ—¶æ£€æŸ¥æºç å˜æ›´ï¼ˆæ ¹æ®SCMè½¯ä»¶çš„ç‰ˆæœ¬å·ï¼‰ï¼Œå¦‚æœæœ‰æ›´æ–°å°±checkoutæœ€æ–°codeä¸‹æ¥ç„¶åæ‰§è¡Œæ„å»ºåŠ¨ä½œï¼›</p>
<p>æ¯”å¦‚: ä½ å¯ä»¥å¦‚æœæˆ‘æƒ³æ¯éš”30åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æºç å˜åŒ–æœ‰å˜åŒ–å°±æ‰§è¡Œ;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">H/30 * * * *</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="Jenkins-ä¸Šä¸‹æ¸¸æ„å»º"><a href="#Jenkins-ä¸Šä¸‹æ¸¸æ„å»º" class="headerlink" title="Jenkins ä¸Šä¸‹æ¸¸æ„å»º"></a>Jenkins ä¸Šä¸‹æ¸¸æ„å»º</h3><p>è§¦å‘ä¸‹æ¸¸æ„å»ºï¼š</p>
<ul>
<li>1) å…¶ä»–é¡¹ç›®æ„å»ºåè§¦å‘: â€œBuild other projectsâ€ under â€œPost build actionsâ€ -&gt; è¾“å…¥é¡¹ç›®åç§°</li>
<li>2) åˆ©ç”¨ Parameterized Trigger æ’ä»¶ å‚æ•°åŒ–æ„å»º -&gt; åœ¨æ„å»ºåæ“ä½œæ­¥éª¤ä¸­ -&gt; <code>Trigger Parameterized build on other peoject</code> -&gt; <code>Restrict matrix execuson to a subset</code></li>
</ul>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210127094803.png" target="_blank" title="WeiyiGeek.ä¸Šä¸‹æ¸¸æ„å»º" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210127094803.png" alt="WeiyiGeek.ä¸Šä¸‹æ¸¸æ„å»º" title="" class=""></a>
                <p>WeiyiGeek.ä¸Šä¸‹æ¸¸æ„å»º</p>
            </figure>
<p><br/></p>
<h3 id="Jenkins-è°ƒç”¨API"><a href="#Jenkins-è°ƒç”¨API" class="headerlink" title="Jenkins è°ƒç”¨API"></a>Jenkins è°ƒç”¨API</h3><p>æè¿°: Jenkins æœåŠ¡æä¾›äº†å¾ˆå¤šç±»å‹çš„APIï¼›å› ä¸ºå·¥ä½œéœ€è¦è¿™é‡Œåªè®°å½•ä¸€ä¸‹æ‰§è¡Œjobçš„APIä½¿ç”¨CURLè°ƒç”¨çš„æ–¹å¼ã€‚</p>
<p><strong>Jenkins API ä»‹ç»</strong></p>
<ul>
<li><p>1.Jenkins API ä»çº§åˆ«ä¸Šåˆ†ç±»</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* ç«™ç‚¹ APIï¼šåˆ›å»ºJobã€å¤åˆ¶Jobã€Build é˜Ÿåˆ—ã€é‡å¯Jenkinsç­‰</span><br><span class="line">* Job APIï¼šä¿®æ”¹Jobã€åˆ é™¤Jobã€è·å– Build ä¿¡æ¯ã€Build Jobã€ç¦ç”¨Jobã€å¯ç”¨Job</span><br><span class="line">* Build Job: æ ¹æ® Build Number è·å–Build ä¿¡æ¯ï¼Œè·å–Build æ§åˆ¶å°çš„è¾“å‡ºæ—¥å¿—</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.ä¼ è¾“æ•°æ®æ ¼å¼: POST ä¼ è¾“æ•°æ®æ”¯æŒçš„æ ¼å¼æœ‰<code>XML,JSON,PYTHON</code></p>
</li>
<li><p>3.å®‰å…¨å¤„ç†: å¯ä»¥æ‰¾åˆ°ä¸€äº›å¼€å‘è¯­è¨€ç¼–å†™çš„APIå°è£…åŒ…ï¼Œç»“åˆåˆ°è‡ªå·±çš„è„šæœ¬ä¸­ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* CSRF è·¨åŸŸæ”»å‡»ä¿æŠ¤ï¼šå¯ä»¥åœ¨å…¨å±€å®‰å…¨ä¸­è®¾ç½®ã€‚</span><br><span class="line">* ç”¨æˆ·éªŒè¯è®¾ç½®ï¼šå¯ä»¥ä½¿ç”¨ç”¨æˆ·çš„å¯†ç ï¼Œä¹Ÿå¯ä»¥ä¸ºç”¨æˆ·åˆ›å»ºtokenã€‚</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>CURL è°ƒç”¨ API æ‰§è¡Œ Job å®ä¾‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Curl Api è°ƒç”¨</span></span><br><span class="line">CURL -X POST <span class="variable">$&#123;JOB_URI&#125;</span> </span><br><span class="line">--user <span class="variable">$&#123;user_name&#125;</span>:<span class="variable">$&#123;user_password&#125;</span>|<span class="variable">$&#123;user_token&#125;</span> </span><br><span class="line">--data-urlencode json=<span class="string">"&#123;\"parameter\":<span class="variable">$&#123;JSON_DATA&#125;</span>,\"statusCode\":\"303\",\"redirectTo\":\".\"&#125;"</span></span><br></pre></td></tr></table></figure></p>
<p><strong>å‚æ•°è§£æ:</strong></p>
<ul>
<li>JOB_URL: å°±æ˜¯Job çš„è®¿é—®URLåœ°å€ã€‚åœ¨Job é¡µé¢ä¸­ç‚¹å‡»<code>â€Build with Parametersâ€</code>å°±å¯ä»¥è·å–åˆ°åœ°å€ã€‚ä¸€èˆ¬ä»¥â€build?delay=0secâ€œç»“å°¾; ç¤ºä¾‹: <code>http://192.168.1.1/job/HelloWorld/build?delay=0sec</code></li>
<li>user_name,user_password,user_token ç”¨æˆ·éªŒè¯ä¿¡æ¯</li>
<li>JSON_DATAï¼šJob è¿è¡Œæ—¶ï¼Œéœ€è¦ä¼ é€’çš„å‚æ•°ï¼Œç”±Json ç»“æ„å°è£…ï¼›ç¤ºä¾‹ï¼š<code>[{\&quot;name\&quot;:\&quot;branchName\&quot;,\&quot;value\&quot;:\&quot;origin/dev\&quot;},{\&quot;name\&quot;:\&quot;projectName\&quot;,\&quot;value\&quot;:\&quot;helloworld\&quot;}]</code></li>
</ul>
<p><br/></p>
<hr>
<h2 id="0x03-åŸºç¡€é…ç½®"><a href="#0x03-åŸºç¡€é…ç½®" class="headerlink" title="0x03 åŸºç¡€é…ç½®"></a>0x03 åŸºç¡€é…ç½®</h2><h3 id="è§†å›¾ç®¡ç†"><a href="#è§†å›¾ç®¡ç†" class="headerlink" title="è§†å›¾ç®¡ç†"></a>è§†å›¾ç®¡ç†</h3><p>æè¿°: å½“Jobåˆ›å»ºæ•°é‡è¾¾åˆ°ä¸€å®šæ—¶æˆ‘ä»¬éœ€è¦åœ¨Jenkinsä¸­å»ºç«‹è§†å›¾ï¼ˆåˆ†ç±»ï¼‰,å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ‰¾åˆ°æŸä¸ªæ‰€éœ€Job;<br>å®é™…ä¸ŠJobçš„è§†å›¾ç±»ä¼¼äºæˆ‘ä»¬ç”µè„‘ä¸Šçš„æ–‡ä»¶å¤¹å¯ä»¥é€šè¿‡ä¸€äº›è¿‡æ»¤è§„åˆ™ï¼Œå°†å·²ç»åˆ›å»ºå¥½çš„Jobè¿‡æ»¤åˆ°è§†å›¾ä¹‹ä¸­,ä¹Ÿå¯ä»¥åœ¨è§†å›¾ä¸­ç›´æ¥åˆ›å»ºæˆ‘ä»¬çš„Job;</p>
<p>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨<code>View</code>æˆ–è€…<code>directory</code>æ–‡ä»¶ä¸¤ç§æ–¹å¼è¿›è¡Œç®¡ç†:</p>
<ul>
<li>views - è§†å›¾æ–¹å¼<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">viewsè§†å›¾æ›´åŠ çµæ´»ï¼Œä¸æ”¹å˜jobçš„è·¯å¾„</span><br><span class="line">viewsæœ‰å¤šç§å½¢å¼ã€å±‚çº§ã€çœ‹æ¿ï¼Œæµæ°´çº¿ç­‰å¤šæ ·åŒ–</span><br></pre></td></tr></table></figure></li>
<li>directory - æ–‡ä»¶å¤¹æ–¹å¼ (åç§°ç©ºé—´éš”ç¦»)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ–‡ä»¶å¤¹é€‚åˆå¤šä¸ªå›¢é˜Ÿå…±ç”¨Jenkins</span><br><span class="line">æ€§èƒ½æ›´å¥½ï¼Œæ‰§è¡Œé€Ÿåº¦æ›´å¿«</span><br><span class="line">æ”¯æŒRBACæƒé™ç®¡ç†</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>ä¸¤åˆ™å¼‚åŒè¯´æ˜: æ–‡ä»¶å¤¹åˆ›å»ºä¸€ä¸ªå¯ä»¥åµŒå¥—å­˜å‚¨çš„å®¹å™¨åˆ©ç”¨å®ƒå¯ä»¥è¿›è¡Œåˆ†ç»„ï¼Œ<code>è€Œè§†å›¾ä»…ä»…æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œå…¶æ¬¡æ–‡ä»¶å¤¹åˆ™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å‘½åç©ºé—´</code>ï¼Œå› æ­¤ä½ å¯ä»¥æœ‰å¤šä¸ªç›¸åŒåç§°çš„çš„å†…å®¹ï¼Œåªè¦å®ƒä»¬åœ¨ä¸åŒçš„æ–‡ä»¶å¤¹é‡Œå³å¯ã€‚</p>
<p><br></p>
<p><strong>views - è§†å›¾æ–¹å¼</strong><br>åˆ›å»ºæµç¨‹ï¼š</p>
<ul>
<li><p>Step 1.æˆ‘çš„è§†å›¾ -&gt; ç‚¹å‡»æ‰€æœ‰æ—è¾¹ + å· -&gt; è®¾ç½®è§†å›¾åç§° -&gt; é€‰æ‹©ä¸‰ç§ç±»å‹<code>åˆ—è¡¨è§†å›¾/åŒ…æ‹¬å…¨å±€è§†å›¾/æˆ‘çš„è§†å›¾</code><br>åˆ—è¡¨è§†å›¾ : æ˜¾ç¤ºç®€å•åˆ—è¡¨ã€‚ä½ å¯ä»¥ä»ä¸­é€‰æ‹©ä»»åŠ¡æ¥æ˜¾ç¤ºåœ¨æŸä¸ªè§†å›¾ä¸­<br>åŒ…æ‹¬å…¨å±€è§†å›¾ : Shows the content of a global view.<br>æˆ‘çš„è§†å›¾ : è¯¥è§†å›¾è‡ªåŠ¨æ˜¾ç¤ºå½“å‰ç”¨æˆ·æœ‰æƒé™è®¿é—®çš„ä»»åŠ¡</p>
</li>
<li><p>Step 2.æ­¤å¤„è®¾ç½®åˆ—è¡¨è§†å›¾ä¸ºä¾‹ -&gt; é€‰æ‹©ä»»åŠ¡åˆ—è¡¨ -&gt; å¢åŠ æˆ–è€…åˆ é™¤æŒ‡å®šæ˜¾ç¤ºåˆ—</p>
</li>
</ul>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210127100635.png" target="_blank" title="WeiyiGeek.views" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210127100635.png" alt="WeiyiGeek.views" title="" class=""></a>
                <p>WeiyiGeek.views</p>
            </figure>
<p><br/></p>
<p><strong>directory - æ–‡ä»¶å¤¹æ–¹å¼</strong><br>åˆ›å»ºæµç¨‹:</p>
<ul>
<li>Step 1.åˆ›å»ºJob -&gt; é€‰æ‹©<code>æ–‡ä»¶å¤¹</code> -&gt; è¾“å…¥ä»»åŠ¡åç§°<code>directory-test</code></li>
<li>Step 2.åœ¨<code>directory-test</code>æ–‡ä»¶å¤¹ä¸‹ -&gt; å¯ä»¥ç»§ç»­åˆ›å»ºè§†å›¾<code>(+ )</code> -&gt; é€‰æ‹©(<code>åˆ—è¡¨è§†å›¾/åŒ…æ‹¬å…¨å±€è§†å›¾/æˆ‘çš„è§†å›¾</code>)</li>
</ul>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210127142346.png" target="_blank" title="WeiyiGeek.directory" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210127142346.png" alt="WeiyiGeek.directory" title="" class=""></a>
                <p>WeiyiGeek.directory</p>
            </figure>
<p><br/></p>
<h3 id="æ’ä»¶ç®¡ç†"><a href="#æ’ä»¶ç®¡ç†" class="headerlink" title="æ’ä»¶ç®¡ç†"></a>æ’ä»¶ç®¡ç†</h3><p><strong>(1) æ’ä»¶å®‰è£…åŠ é€Ÿ</strong><br>Q: åœ¨å®‰è£…æ’ä»¶æ—¶å¦‚ä½•è¿›è¡Œé…ç½®å®‰è£…åŠ é€Ÿ?</p>
<blockquote>
<p>ç­”: é€‰æ‹©å›½å†…æ¸…åå¤§å­¦çš„Jenkinsæ’ä»¶æ›´æ–°æº <code>https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</code></p>
</blockquote>
<p>é…ç½®ä½ç½®:  <code>Dashboard &gt; Plugin Manager &gt; Advanced &gt; Update Site</code></p>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201223225625.png" target="_blank" title="WeiyiGeek.æ’ä»¶å®‰è£…åŠ é€Ÿ" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201223225625.png" alt="WeiyiGeek.æ’ä»¶å®‰è£…åŠ é€Ÿ" title="" class=""></a>
                <p>WeiyiGeek.æ’ä»¶å®‰è£…åŠ é€Ÿ</p>
            </figure>
<p><br/></p>
<p><strong>ï¼ˆ2ï¼‰æ’ä»¶å®‰è£…çš„å‡ ç§æ–¹å¼</strong></p>
<ul>
<li>Step 1.é‡‡ç”¨æ’ä»¶æ›´æ–°æºæœç´¢è¿›è¡Œåœ¨çº¿å®‰è£…ï¼Œä¾‹å¦‚ä¸‹é¢å¯¹Jenkinsè¿›è¡Œæ±‰åŒ–æ’ä»¶çš„å®‰è£…, æœç´¢ <code>Localization: Chinese (Simplified)</code> æ’ä»¶å®‰è£…å³å¯;<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201223230224.png" target="_blank" title="WeiyiGeek.Jenkins æ±‰åŒ–æ’ä»¶å®‰è£…" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201223230224.png" alt="WeiyiGeek.Jenkins æ±‰åŒ–æ’ä»¶å®‰è£…" title="" class=""></a>
                <p>WeiyiGeek.Jenkins æ±‰åŒ–æ’ä»¶å®‰è£…</p>
            </figure>
</li>
</ul>
<p>å½“å®‰è£…æ’ä»¶å®‰è£…å®Œæˆæ—¶å€™å¯ä»¥é€‰æ‹©é‡å¯ Jenkins æˆ– è·³è½¬åˆ°é¦–é¡µ, æ­¤å¤„æˆ‘é‡å¯ Jenkins å¦‚ä¸‹å›¾æ‰€ç¤ºæ±‰åŒ–æˆåŠŸ;</p>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201223230527.png" target="_blank" title="WeiyiGeek.Jenkins æ±‰åŒ–ç•Œé¢" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201223230527.png" alt="WeiyiGeek.Jenkins æ±‰åŒ–ç•Œé¢" title="" class=""></a>
                <p>WeiyiGeek.Jenkins æ±‰åŒ–ç•Œé¢</p>
            </figure>
<ul>
<li>Step 2.é€šè¿‡Webé¡µé¢ä¸Šä¼ .hpiæ–‡ä»¶è¿›è¡Œæ’ä»¶å®‰è£…<br>æ¸…åå¤§å­¦ jenkins æ’ä»¶ä¸‹è½½: <a href="https://mirrors.tuna.tsinghua.edu.cn/jenkins/plugins/" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/jenkins/plugins/</a><br>ä¾‹å¦‚ä¸‹é¢è¿›è¡Œ <a href="https://mirrors.tuna.tsinghua.edu.cn/jenkins/plugins/git/4.5.0/git.hpi" target="_blank" rel="noopener">git æ’ä»¶ä¸‹è½½</a> è¿›è¡Œä¸Šä¼ å…¶ <code>git.hpi</code> æ–‡ä»¶è¿›è¡Œæ’ä»¶å®‰è£…ï¼Œä¹‹åä¸Šä¼ å³å¯;</li>
</ul>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201223231315.png" target="_blank" title="WeiyiGeek.Jenkins git æ’ä»¶å®‰è£…" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201223231315.png" alt="WeiyiGeek.Jenkins git æ’ä»¶å®‰è£…" title="" class=""></a>
                <p>WeiyiGeek.Jenkins git æ’ä»¶å®‰è£…</p>
            </figure>
<ul>
<li>Step 3.å¯¼å…¥ä¹‹å‰æœåŠ¡å™¨å·²å®‰è£…çš„æ’ä»¶è¿›è¡Œç¦»çº¿å®‰è£…ï¼›<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) Jenkins å·²å®‰è£…çš„æ’ä»¶ç›®å½•</span></span><br><span class="line">/var/lib/jenkins/plugins$ ls</span><br><span class="line">  <span class="comment"># apache-httpcomponents-client-4-api      display-url-api      jdk-tool                  localization-zh-cn      script-security      trilead-api</span></span><br><span class="line">  <span class="comment"># apache-httpcomponents-client-4-api.jpi  display-url-api.jpi  jdk-tool.jpi              localization-zh-cn.jpi  script-security.jpi  trilead-api.jpi</span></span><br><span class="line">  <span class="comment"># command-launcher                        git                  jsch                      mailer                  ssh-credentials      workflow-scm-step</span></span><br><span class="line">  <span class="comment"># command-launcher.jpi                    git-client           jsch.jpi                  mailer.jpi              ssh-credentials.jpi  workflow-scm-step.jpi</span></span><br><span class="line">  <span class="comment"># credentials                             git-client.jpi       localization-support      scm-api                 structs              workflow-step-api</span></span><br><span class="line">  <span class="comment"># credentials.jpi                         git.jpi              localization-support.jpi  scm-api.jpi             structs.jpi          workflow-step-api.jpi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æ‰“åŒ…æ’ä»¶ç›®å½•å¹¶ä¸Šä¼ åˆ°å¦å¤–ä¸€å°åŒç‰ˆæœ¬çš„JenkinsæœåŠ¡å™¨(PS:ä¸åŒç‰ˆæœ¬é—´å¯èƒ½ä¼šå‡ºç°æ’ä»¶ä¸å…¼å®¹çš„æƒ…å†µ) </span></span><br><span class="line">tar -zcvf jenkins_2.263.1_plugins.tar.gz /var/lib/jenkins/plugins</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) è§£å‹æ’ä»¶ç›®å½•å¹¶è¿›è¡Œæ‰€å±è€…ç»„ä¿®æ”¹</span></span><br><span class="line">tar -zxvf jenkins_2.263.1_plugins.tar.gz </span><br><span class="line">chown -R jenkins:jenkins /var/lib/jenkins/plugins</span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) å¯åŠ¨ Jenkins æœåŠ¡</span></span><br><span class="line">systemctl stop jenkins</span><br><span class="line">systemctl start jenkins</span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) å¯åŠ¨ æ—¥å¿— æŸ¥çœ‹</span></span><br><span class="line">tail -f /var/<span class="built_in">log</span>/jenkins/jenkins.log</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<h3 id="æƒé™ç®¡ç†"><a href="#æƒé™ç®¡ç†" class="headerlink" title="æƒé™ç®¡ç†"></a>æƒé™ç®¡ç†</h3><p>æè¿°: ç”±äº<code>jenkins</code>é»˜è®¤çš„æƒé™ç®¡ç†ä½“ç³»ä¸æ”¯æŒç”¨æˆ·ç»„æˆ–è§’è‰²çš„é…ç½®ï¼Œå› æ­¤éœ€è¦å®‰è£…ç¬¬ä¸‰å‘æ’ä»¶æ¥æ”¯æŒè§’è‰²çš„é…ç½®ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>Role-based Authorization Strategy</code>æ’ä»¶ï¼Œå®‰è£…è¯·å‚è€ƒå‰é¢æ’ä»¶ç®¡ç†ç« èŠ‚ã€‚</p>
<p>æ’ä»¶åŠŸèƒ½ç‰¹ç‚¹:</p>
<ul>
<li>æŒ‰è§’è‰²åˆ†æƒé™</li>
<li>æŒ‰é¡¹ç›®åˆ†æƒé™</li>
</ul>
<p><br/></p>
<ul>
<li><p>Step 1.æ’ä»¶å®‰è£…åæˆ‘ä»¬å…ˆå¯ç”¨è¯¥æ’ä»¶ç®¡ç†Jenkinsæƒé™ -&gt; é¢æ¿ -&gt; å…¨å±€å®‰å…¨é…ç½®ï¼ˆ<code>Global Security</code>ï¼‰-&gt; æˆæƒç­–ç•¥ -&gt; æ‰¾åˆ°å¹¶é€‰ä¸­ <code>Role-Based Strategy</code> -&gt; ç„¶ååº”ç”¨ä¿å­˜ ã€‚</p>
</li>
<li><p>Step 2.ç®¡ç†Jenkins -&gt; å®‰å…¨ -&gt; <code>Manage and Assign Roles</code> -&gt; å¯ä»¥è¿›è¡Œè§’è‰²æƒé™ç®¡ç†ä¸åˆ†é… -&gt; æ­¤å¤„æ·»åŠ ä¸€ä¸ªtestè§’è‰²å¹¶è®¾ç½®å…¶æƒé™ -&gt; åº”ç”¨ -&gt; ä¿å­˜;<br>Â·</p>
</li>
<li>Step 3.Assign Roles -&gt; Global roles(æŒ‰è§’è‰²)ã€Item roles(æŒ‰é¡¹ç›®)ã€Node roles(æŒ‰èŠ‚ç‚¹) -&gt; ç”¨æˆ·æ·»åŠ (åŒæ—¶æ‚¨éœ€è¦åœ¨Jenkinsç”¨æˆ·ä¸­æ–°å¢ä¸€ä¸ªè¯¥ç”¨æˆ·) -&gt; ä¿å­˜åº”ç”¨<ul>
<li>æ·»åŠ ç”¨æˆ·å’Œç»„ã€‚é»˜è®¤æƒ…å†µä¸‹ç”¨æˆ·/ç»„åæ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼Œå› æ­¤å®ƒéœ€è¦ä¸æ‚¨åœ¨<code>Configure Global Security-&gt;Access Control-&gt;Security Realm</code>ä¸‹çš„ç”¨æˆ·/ç»„å®šä¹‰åŒ¹é…ã€‚</li>
</ul>
</li>
</ul>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210127145609.png" target="_blank" title="WeiyiGeek.jenkinsæƒé™ç®¡ç†" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210127145609.png" alt="WeiyiGeek.jenkinsæƒé™ç®¡ç†" title="" class=""></a>
                <p>WeiyiGeek.jenkinsæƒé™ç®¡ç†</p>
            </figure>
<p><br/></p>
<h3 id="æ„å»ºå·¥å…·ç®¡ç†"><a href="#æ„å»ºå·¥å…·ç®¡ç†" class="headerlink" title="æ„å»ºå·¥å…·ç®¡ç†"></a>æ„å»ºå·¥å…·ç®¡ç†</h3><p>åœ¨ Jenkins æœåŠ¡ä¸­è¿è¡Œ Pipeline ç­‰ä»»åŠ¡è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä¾èµ–ä¸€äº›å·¥å…·ï¼ˆç¯å¢ƒéœ€æ±‚ï¼‰ï¼›æ¯”å¦‚ JDK,MAVENæˆ–è€…golang æˆ–è€… python ç¯å¢ƒã€‚</p>
<p>æ„å»ºå·¥å…·çš„å®‰è£…æ–¹å¼æœ‰ä¸‰ç§:</p>
<ul>
<li><p>1) è‡ªè¡Œå®‰è£…å·¥å…·: å³è‡ªè¡Œåœ¨æœåŠ¡å™¨ä¸Šå®‰è£…é…ç½®ï¼Œç„¶ååœ¨ Jenkins æœåŠ¡ä¸­é…ç½®å¥½è¿™äº›å·¥å…·çš„å®‰è£…ä¿¡æ¯å°±å¯ä»¥ä½¿ç”¨äº†ã€‚é…ç½®è·¯å¾„ï¼š<code>Manage Jenkinsâ†’Global Tool Configuration</code></p>
</li>
<li><p>2) Jenkins è‡ªåŠ¨å®‰è£…å·¥å…·: åˆ©ç”¨ Jenkins æœåŠ¡æä¾›çš„ã€å·¥å…·è‡ªåŠ¨å®‰è£…åŠŸèƒ½ã€‘ï¼Œå®ç°å·¥å…·çš„å¿«é€Ÿé…ç½®ã€‚</p>
</li>
<li><p>3) tools æŒ‡ä»¤å®‰è£…å·¥å…·:å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨ä¸‹è½½å¹¶å®‰è£…æ‰€æŒ‡å®šçš„æ„å»ºå·¥å…·ï¼Œå¹¶å°†å…¶åŠ å…¥ PATH å˜é‡ä¸­ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨shæ­¥éª¤é‡Œç›´æ¥ä½¿ç”¨äº†, ä½†åœ¨agent noneçš„æƒ…å†µä¸‹ä¸ä¼šç”Ÿæ•ˆã€‚</p>
</li>
</ul>
<p>Tips :  toolsæŒ‡ä»¤é»˜è®¤æ”¯æŒ3ç§å·¥å…·ï¼šJDKã€Mavenã€Gradleã€‚é€šè¿‡å®‰è£…æ’ä»¶ï¼Œtools æŒ‡ä»¤è¿˜å¯ä»¥æ”¯æŒæ›´å¤šçš„å·¥å…·ã€‚</p>
<hr>
<h2 id="0x04-åŸºç¡€ä½¿ç”¨"><a href="#0x04-åŸºç¡€ä½¿ç”¨" class="headerlink" title="0x04 åŸºç¡€ä½¿ç”¨"></a>0x04 åŸºç¡€ä½¿ç”¨</h2><h3 id="HelloWorld-è‡ªç”±é£æ ¼è½¯ä»¶é¡¹ç›®"><a href="#HelloWorld-è‡ªç”±é£æ ¼è½¯ä»¶é¡¹ç›®" class="headerlink" title="HelloWorld è‡ªç”±é£æ ¼è½¯ä»¶é¡¹ç›®"></a>HelloWorld è‡ªç”±é£æ ¼è½¯ä»¶é¡¹ç›®</h3><p>Q: Jenkins Free Style åŸºæœ¬ä½¿ç”¨?<br>ç›®çš„: æ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®, è¿™æ˜¯Jenkinsçš„ä¸»è¦åŠŸèƒ½Jenkinså°†ä¼šç»“åˆä»»ä½•SCMå’Œä»»ä½•æ„å»ºç³»ç»Ÿæ¥æ„å»ºä½ çš„é¡¹ç›®, ç”šè‡³å¯ä»¥æ„å»ºè½¯ä»¶ä»¥å¤–çš„ç³»ç»Ÿ.</p>
<p><strong>æ“ä½œæµç¨‹:</strong></p>
<p>Step 1.é¡¹ç›®åˆ›å»º</p>
<blockquote>
<p>(1) é¢æ¿ -&gt; æ–°å»ºä¸€ä¸ªä»»åŠ¡ -&gt; ä»»åŠ¡åç§° freestyle-helloworld -&gt; ä¿å­˜<br>(2) Dashboard -&gt; é¡¹ç›®åç§° freestyle-helloworld -&gt; General</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡è¦çš„é…ç½®é¡¹</span></span><br><span class="line">ä¸¢å¼ƒæ—§çš„æ„å»ºï¼š(ä¿æŒæ„å»ºçš„å¤©æ•° / ä¿æŒæ„å»ºçš„æœ€å¤§ä¸ªæ•°)</span><br><span class="line">å‚æ•°åŒ–æ„å»ºè¿‡ç¨‹: æ¯”å¦‚æ·»åŠ çš„ç¯å¢ƒå˜é‡æˆ–è€…APIå¯†é’¥ç­‰ç­‰</span><br></pre></td></tr></table></figure>
<blockquote>
<p>(3) Dashboard -&gt; é¡¹ç›®åç§° freestyle-helloworld &gt; æ„å»º &gt; æ‰§è¡Œ Shell å‘½ä»¤<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"FreeStyle - HelloWorld"</span></span><br><span class="line">touch hello-world.txt</span><br></pre></td></tr></table></figure></p>
</blockquote>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201224093941.png" target="_blank" title="WeiyiGeek.è‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201224093941.png" alt="WeiyiGeek.è‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®" title="" class=""></a>
                <p>WeiyiGeek.è‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®</p>
            </figure>
<p><br/></p>
<p>Step 2.å·¥ç¨‹ <code>freestyle-helloworld</code> æ„å»ºä¸æ§åˆ¶å°è¾“å‡ºæŸ¥çœ‹;<br><figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201224094449.png" target="_blank" title="WeiyiGeek.å·¥ç¨‹æ„å»ºä¸æ§åˆ¶å°è¾“å‡º" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201224094449.png" alt="WeiyiGeek.å·¥ç¨‹æ„å»ºä¸æ§åˆ¶å°è¾“å‡º" title="" class=""></a>
                <p>WeiyiGeek.å·¥ç¨‹æ„å»ºä¸æ§åˆ¶å°è¾“å‡º</p>
            </figure></p>
<p>PS : å¦‚æœæ˜¯è“è‰²åœ†ç‚¹è¡¨ç¤ºæ„å»ºæˆåŠŸ, å¦‚æœæ˜¯çº¢è‰²åœ†ç‚¹è¡¨ç¤ºæ„å»ºå¤±è´¥!</p>
<p><br/></p>
<p>Step 3.æ„å»ºåçš„å·¥ä½œåŒºå­˜æ”¾ç›®å½•<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jenkins:/var/lib/jenkins/workspace/freestyle-helloworld$ ls</span><br><span class="line">  <span class="comment"># hello-world.txt</span></span><br><span class="line">jenkins:/var/lib/jenkins/workspace/freestyle-helloworld$ cat hello-world.txt</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="Gitlab-é›†æˆé…ç½®ä¸å®è·µ"><a href="#Gitlab-é›†æˆé…ç½®ä¸å®è·µ" class="headerlink" title="Gitlab é›†æˆé…ç½®ä¸å®è·µ"></a>Gitlab é›†æˆé…ç½®ä¸å®è·µ</h3><p><strong>ç®€å•è¯´æ˜ï¼š</strong><br>Q: Jenkins ä¸ºå•¥è¦é›†æˆGitlab?</p>
<blockquote>
<p>ç­”ï¼šç”±äºæˆ‘ä»¬éœ€è¦ä¾æ‰˜äºJenkinså°†Gitlabä¸Šçš„é¡¹ç›®è·å–è‡³æœ¬åœ°ï¼Œä¸ºåç»­ç½‘ç«™çš„ä»£ç å‘å¸ƒå·¥ä½œåšå¥½å‡†å¤‡;</p>
</blockquote>
<p>Q: Jenkins å¦‚ä½•é›†æˆGitlab?</p>
<blockquote>
<p>ç­”: ç”±äºJenkins åªæ˜¯ä¸€ä¸ªè°ƒåº¦å¹³å°ï¼Œæ‰€ä»¥éœ€è¦å®‰è£…å’ŒGitlabç›¸å…³çš„æ’ä»¶å³å¯å®Œæˆé›†æˆ;</p>
</blockquote>
<p>Jenkins ä¸ Gitlab é›†æˆæ€è·¯</p>
<ul>
<li><p>1.å¼€å‘æäº¤ä»£ç  è‡³ Gitlab</p>
</li>
<li><p>2.Jenkins å®‰è£… Gitlab æ‰€éœ€æ’ä»¶</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Credentials Plugin (2.3.14) - This plugin allows you to store credentials <span class="keyword">in</span> Jenkins.</span><br><span class="line">Git client plugin (3.6.0) - Utility plugin <span class="keyword">for</span> Git support <span class="keyword">in</span> Jenkins</span><br><span class="line">Git plugin (4.5.0) - This plugin integrates Git with Jenkins.</span><br><span class="line">Gitlab Authentication plugin (1.10) - This is the an authentication plugin using gitlab OAuth.</span><br><span class="line">Gitlab Hook Plugin (1.4.2) - Enables Gitlab web hooks to be used to trigger SMC polling on Gitlab projects</span><br><span class="line">GitLab Plugin (1.5.13) - This plugin allows GitLab to trigger Jenkins builds and display their results <span class="keyword">in</span> the GitLab UI.</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201224101640.png" target="_blank" title="WeiyiGeek.Gitlabå…³è”æ’ä»¶" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201224101640.png" alt="WeiyiGeek.Gitlabå…³è”æ’ä»¶" title="" class=""></a>
                <p>WeiyiGeek.Gitlabå…³è”æ’ä»¶</p>
            </figure>
<ul>
<li>3.Jenkins åˆ›å»º FreeStyle é¡¹ç›®ï¼Œç„¶åé…ç½®Gitlabä»“åº“å¯¹åº”çš„åœ°å€;</li>
</ul>
<p><br></p>
<p><strong>æ“ä½œæµç¨‹:</strong></p>
<ul>
<li><strong>Step 1.é¦–å…ˆéœ€è¦å°†æˆ‘ä»¬æ‰€ç”¨çš„é¡¹ç›®ä»£ç æ¨é€åˆ°Gitlabï¼ˆæ­¤å¤„å‡è®¾æ‚¨å·²å®‰è£…Gitlabï¼‰ä¹‹ä¸­;</strong></li>
</ul>
<blockquote>
<p>(1) ç®¡ç†ä¸­å¿ƒ -&gt; ç¾¤ç»„ -&gt; æ–°å»ºç¾¤ç»„ -&gt; å®Œå–„ä¿¡æ¯ -&gt; åˆ›å»ºç¾¤ç»„<br>(2) ç®¡ç†ä¸­å¿ƒ -&gt; é¡¹ç›® -&gt; åˆ›å»ºé¡¹ç›® -&gt; å®Œå–„ä»“åº“ä¿¡æ¯ -&gt; åˆ›å»ºé¡¹ç›®<br>(3) æ¨é€ç°æœ‰æ–‡ä»¶å¤¹åˆ°Gitlabä¹‹ä¸­</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> existing_folder</span><br><span class="line">git init</span><br><span class="line">git remote add origin http://gitlab.weiyigeek.top/ci-cd/blog.git</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">"Initial commit"</span></span><br><span class="line">git push -u origin master</span><br><span class="line">  <span class="comment"># remote: Resolving deltas: 100% (829/829), done.</span></span><br><span class="line">  <span class="comment"># To http://gitlab.weiyigeek.top/ci-cd/blog.git</span></span><br><span class="line">  <span class="comment">#  * [new branch]      master -&gt; master</span></span><br><span class="line">  <span class="comment"># Branch 'master' set up to track remote branch 'master' from 'origin'.</span></span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201224100508.png" target="_blank" title="WeiyiGeek.gitlab" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201224100508.png" alt="WeiyiGeek.gitlab" title="" class=""></a>
                <p>WeiyiGeek.gitlab</p>
            </figure>
<ul>
<li><strong>Step 2.æ­¤å¤„å‡è®¾æ‚¨å·²ç»æŒ‰ç…§ä¸Šé¢<code>Gitlab é›†æˆé…ç½®</code>å®‰è£…äº†ç›¸åº”çš„æ’ä»¶, å¹¶ä¸”é…ç½®å¥½gitlabåŸŸåè®¿é—®çš„è§£æè®°å½•;</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ­¤å¤„ç”±äºæ²¡æœ‰è‡ªå·±æ­å»ºDNSï¼Œåˆ™å°†å…¶å†™å…¥åˆ°Jenkins æœåŠ¡å™¨çš„hostsæ–‡ä»¶ä¸­è¿›è¡Œç›¸åº”çš„IPä¸åŸŸåç»‘å®š</span></span><br><span class="line">cat /etc/hosts</span><br><span class="line">  <span class="comment"># 127.0.0.1 localhost</span></span><br><span class="line">  <span class="comment"># 127.0.1.1 gitlab</span></span><br><span class="line">  <span class="comment"># 10.10.107.201 gitlab.weiyigeek.top</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Step 3.Jenkins åˆ›å»º FreeStyle é¡¹ç›®ï¼Œç„¶åé…ç½®Gitlabä»“åº“å¯¹åº”çš„åœ°å€(<code>ssh çš„æ–¹å¼</code>)</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) åœ¨Gitlabä¸­æ·»åŠ å½“å‰æœºå™¨sshå¯†é’¥(æ­¤å¤„ä»¥Jenkinsç”¨æˆ·ä¸ºä¾‹)</span></span><br><span class="line">jenkins@jenkins:~<span class="variable">$ssh</span>-keygen -t ed25519 -C <span class="string">"jenkins@weiyigeek.top"</span></span><br><span class="line">~$ ls ~/.ssh/id_ed25519</span><br><span class="line">  <span class="comment"># id_ed25519      id_ed25519.pub</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æ·»åŠ å…¬é’¥åˆ°gitlabä¸­ </span></span><br><span class="line"><span class="comment"># &gt; ç”¨æˆ·è®¾ç½® -&gt; SSH Keys -&gt; jenkins-CI</span></span><br><span class="line">ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINFb2ALOnOpePb7e/tss4/ZKxNHb3srh7NXntW5jAWSf jenkins@weiyigeek.top</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) ä¸»æœºè®¤è¯æŒ‡çº¹ç»‘å®š</span></span><br><span class="line">jenkins@jenkins:~$ git ls-remote -h -- git@gitlab.weiyigeek.top:ci-cd/blog.git HEAD</span><br><span class="line">  <span class="comment"># The authenticity of host 'gitlab.weiyigeek.top (10.10.107.201)' can't be established.</span></span><br><span class="line">  <span class="comment"># ECDSA key fingerprint is SHA256:cmG5Ces+96qG9EEaU1b/tJuTR1re7XDXUU4jg7asna4.</span></span><br><span class="line">  <span class="comment"># Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span></span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201224125431.png" target="_blank" title="WeiyiGeek.SSH Keys" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201224125431.png" alt="WeiyiGeek.SSH Keys" title="" class=""></a>
                <p>WeiyiGeek.SSH Keys</p>
            </figure>
<ul>
<li><strong>Step 4.Jenkins &gt; FreeStyle é¡¹ç›® &gt; æºç ç®¡ç† &gt; Git &gt; Repositories è®¾ç½® &gt;  Credentials è®¾ç½®</strong><br>PS : å¦‚æœæ˜¯éJenkinsç”¨æˆ·ä¸‹å…¬é’¥å¯¹Gitlabè¯¥é¡¹ç›®æœ‰è®¿é—®æƒé™æ—¶ï¼Œå¯ä»¥é€šè¿‡ Credentials æ·»åŠ å…¶è®¤è¯çš„å¯†é’¥å³å¯;</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) Weiyigeek ç”¨æˆ·å¯†é’¥ (æ­¤æ—¶å‡è®¾Gitlabå·²ç»æ·»åŠ è¯¥å…¬é’¥)</span></span><br><span class="line">weiyigeek@jenkins:~$ cat /home/weiyigeek/.ssh/id_ed25519</span><br><span class="line">  <span class="comment"># -----BEGIN OPENSSH PRIVATE KEY-----</span></span><br><span class="line">  <span class="comment"># b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW</span></span><br><span class="line">  <span class="comment"># QyNTUxOQAAACAIxH1a4EivkJOSAXqd6LUE8tUvRfgPwwn1Erb7r728cwAAAJgANcy8ADXM</span></span><br><span class="line">  <span class="comment"># vAAAAAtzc2gtZWQyNTUxOQAAACAIxH1a4EivkJOSAXqd6LUE8tUvRfgPwwn1Erb7r728cw</span></span><br><span class="line">  <span class="comment"># AAAECLw4Wnle7Md7fc5NQN6EohejUx0XMHKfdYXejLAw2/NwjEfVrgSK+Qk5IBep3otQTy</span></span><br><span class="line">  <span class="comment"># 1S9F+A/DCfUStvuvvbxzAAAAFG1hc3RlckB3ZWl5aWdlZWsudG9wAQ==</span></span><br><span class="line">  <span class="comment"># -----END OPENSSH PRIVATE KEY-----</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) è¿›è¡Œ Credentials ç›¸åº”çš„è®¾ç½®</span></span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201224131113.png" target="_blank" title="WeiyiGeek.Weiyigeek ç”¨æˆ·å¯†é’¥" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201224131113.png" alt="WeiyiGeek.Weiyigeek ç”¨æˆ·å¯†é’¥" title="" class=""></a>
                <p>WeiyiGeek.Weiyigeek ç”¨æˆ·å¯†é’¥</p>
            </figure>
<ul>
<li><strong>Step 5.é¦–å…ˆæ‰‹åŠ¨å®ç°è®¾ç½®NFSå…±äº«å­˜å‚¨ä»¥åŠ Kubernetes éƒ¨ç½² StatefulSet èµ„æºæ¸…å•ï¼Œé€šè¿‡Nginxè®¿é—®æˆ‘ä»¬çš„blog;</strong><br>åŸºç¡€é…ç½®:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) NFS æœåŠ¡å™¨é…ç½®</span></span><br><span class="line">root@nfs$ showmount -e</span><br><span class="line">  <span class="comment"># /nfs/data4 *</span></span><br><span class="line">/nfs/data4<span class="comment"># ls -alh /nfs/</span></span><br><span class="line">  <span class="comment"># drwxrwxrwx  2 weiyigeek weiyigeek 4.0K Nov 19 13:27 data4</span></span><br><span class="line">/nfs/data4<span class="comment"># mkdir /nfs/data4/tags/</span></span><br><span class="line">/nfs/data4<span class="comment"># ln -s /nfs/data4/tags/ /nfs/data4/web</span></span><br><span class="line">/nfs/data4<span class="comment"># chown -R nobody:weiyigeek /nfs/data4/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) Node 1 &amp;&amp; Node 2</span></span><br><span class="line">sudo mkdir -pv /nfs/data4/</span><br><span class="line">sudo chown -R weiyigeek:weiyigeek /nfs/data4/</span><br><span class="line">sudo mount.nfs -r 10.10.107.202:/nfs/data4/ /nfs/data4/</span><br><span class="line">k8s-node-4:/nfs/data4$ ls -alh  <span class="comment"># æƒé™æŸ¥çœ‹</span></span><br><span class="line">  <span class="comment"># total 12K</span></span><br><span class="line">  <span class="comment"># drwxrwxrwx 3 weiyigeek weiyigeek 4.0K Dec 24 15:44 .</span></span><br><span class="line">  <span class="comment"># drwxr-xr-x 3 root   root 4.0K Dec 24 15:47 ..</span></span><br><span class="line">  <span class="comment"># drwxr-xr-x 2 weiyigeek weiyigeek 4.0K Dec 24 15:44 tags</span></span><br><span class="line">  <span class="comment"># lrwxrwxrwx 1 weiyigeek weiyigeek   16 Dec 24 15:44 web -&gt; /nfs/data4/tags/</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>èµ„æºæ¸…å•:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; jenkins-gitlab-ci.yaml &lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">deploy-blog-svc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">NodePort</span>         <span class="comment"># Service ç±»å‹</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">blog-html</span>        <span class="comment"># ã€æ³¨æ„ã€‘ä¸deploymentèµ„æºæ§åˆ¶å™¨åˆ›å»ºçš„Podæ ‡ç­¾è¿›è¡Œç»‘å®š;</span></span><br><span class="line"><span class="attr">    release:</span> <span class="string">stabel</span>       <span class="comment"># Service æœåŠ¡å‘ç°ä¸èƒ½ç¼ºå°‘Podæ ‡ç­¾ï¼Œæœ‰äº†Podæ ‡ç­¾æ‰èƒ½ä¸ä¹‹SVCå¯¹åº”</span></span><br><span class="line"><span class="attr">  ports:</span>                  <span class="comment"># æ˜ å°„ç«¯å£</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">http</span>            </span><br><span class="line"><span class="attr">    port:</span> <span class="number">80</span>              <span class="comment"># cluster è®¿é—®ç«¯å£</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">80</span>        <span class="comment"># Pod å®¹å™¨å†…çš„æœåŠ¡ç«¯å£</span></span><br><span class="line"><span class="attr">    nodePort:</span> <span class="number">30088</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">deploy-blog-html</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  serviceName:</span> <span class="string">"deploy-blog-svc"</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span>                <span class="comment"># å‰¯æœ¬æ•°</span></span><br><span class="line"><span class="attr">  selector:</span>                  <span class="comment"># é€‰æ‹©å™¨</span></span><br><span class="line"><span class="attr">    matchLabels:</span>  </span><br><span class="line"><span class="attr">      app:</span> <span class="string">blog-html</span>   <span class="comment"># åŒ¹é…çš„Podæ ‡ç­¾éå¸¸é‡è¦</span></span><br><span class="line"><span class="attr">      release:</span> <span class="string">stabel</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">blog-html</span>      <span class="comment"># æ¨¡æ¿æ ‡ç­¾</span></span><br><span class="line"><span class="attr">        release:</span> <span class="string">stabel</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      volumes:</span>                <span class="comment"># å…³é”®ç‚¹</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">web</span> </span><br><span class="line"><span class="attr">        hostPath:</span>             <span class="comment"># é‡‡ç”¨hostPathå·</span></span><br><span class="line"><span class="attr">          type:</span> <span class="string">DirectoryOrCreate</span>   <span class="comment"># å·ç±»å‹DirectoryOrCreate: å¦‚æœå­èŠ‚ç‚¹ä¸Šæ²¡æœ‰è¯¥ç›®å½•ä¾¿ä¼šè¿›è¡Œåˆ›å»º</span></span><br><span class="line"><span class="attr">          path:</span> <span class="string">/nfs/data4/web</span>      <span class="comment"># å„ä¸»æœºèŠ‚ç‚¹ä¸Šå·²å­˜åœ¨çš„ç›®å½•æ­¤å¤„æ˜¯NFSå…±äº«</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">timezone</span>     <span class="comment"># å®¹å™¨æ—¶åŒºè®¾ç½®</span></span><br><span class="line"><span class="attr">        hostPath:</span></span><br><span class="line"><span class="attr">          path:</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">blog-html</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">harbor.weiyigeek.top/test/nginx:v3.0</span>  <span class="comment"># æ‹‰å–çš„é•œåƒ</span></span><br><span class="line"><span class="attr">        imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">http</span>         <span class="comment"># æ­¤ç«¯å£åœ¨æœåŠ¡ä¸­çš„åç§°</span></span><br><span class="line"><span class="attr">          containerPort:</span> <span class="number">80</span>  <span class="comment"># å®¹å™¨æš´éœ²çš„ç«¯å£</span></span><br><span class="line"><span class="attr">        volumeMounts:</span>        <span class="comment"># æŒ‚è½½æŒ‡å®šå·ç›®å½•</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">web</span> </span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/usr/share/nginx/html</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">logs</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/var/log/nginx</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">timezone</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai</span></span><br><span class="line"><span class="attr">  volumeClaimTemplates:</span>    <span class="comment"># å·çš„ä½“ç§¯è¦æ±‚æ¨¡æ¿æ­¤å¤„é‡‡ç”¨StorageClasså­˜å‚¨ç±»</span></span><br><span class="line"><span class="attr">  - metadata:</span>              <span class="comment"># æ ¹æ®æ¨¡æ¿è‡ªåŠ¨åˆ›å»ºPVä¸PVCå¹¶ä¸”è¿›è¡Œä¸€ä¸€å¯¹åº”ç»‘å®š;</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">logs</span>       </span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      accessModes:</span> <span class="string">[</span> <span class="string">"ReadWriteOnce"</span> <span class="string">]</span></span><br><span class="line"><span class="attr">      storageClassName:</span> <span class="string">managed-nfs-storage</span> <span class="comment"># StorageClasså­˜å‚¨ç±»</span></span><br><span class="line"><span class="attr">      resources:</span></span><br><span class="line"><span class="attr">        requests:</span></span><br><span class="line"><span class="attr">          storage:</span> <span class="number">1</span><span class="string">Gi</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></p>
<p>éƒ¨ç½²èµ„æºæ¸…å•:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">~/K8s/Day12$ kubectl apply -f jenkins-gitlab-ci.yaml</span><br><span class="line">service/deploy-blog-svc unchanged</span><br><span class="line">statefulset.apps/deploy-blog-html configured</span><br><span class="line"></span><br><span class="line">~/K8s/Day12$ kubectl get services -o wide</span><br><span class="line">NAME              TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE    SELECTOR</span><br><span class="line">deploy-blog-svc   NodePort    10.104.74.36   &lt;none&gt;        80:30088/TCP   5m9s   app=blog-html,release=stabel</span><br><span class="line">kubernetes        ClusterIP   10.96.0.1      &lt;none&gt;        443/TCP        49d    &lt;none&gt;</span><br><span class="line"></span><br><span class="line">~/K8s/Day12$ kubectl get pod -o wide</span><br><span class="line">NAME                                      READY   STATUS    RESTARTS   AGE   IP             NODE          NOMINATED NODE   READINESS GATES</span><br><span class="line">deploy-blog-html-0                        1/1     Running   0          72s   10.244.0.193   Master </span><br><span class="line">deploy-blog-html-1                        1/1     Running   0          57s   10.244.1.182   k8s-node-4  </span><br><span class="line">deploy-blog-html-2                        1/1     Running   0          49s   10.244.2.84    k8s-node-5</span><br></pre></td></tr></table></figure></p>
<p>æ•ˆæœæŸ¥çœ‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.107.202:30088/host.html</span><br><span class="line">  <span class="comment"># Hostname: deploy-blog-html-0 ,Image Version: 3.0, Nginx Version: 1.19.4</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>Step 6.é‡‡ç”¨Tagæ–¹å¼å‘å¸ƒå’Œå›é€€é¡¹ç›®</strong></li>
</ul>
<p>Q: ä¸ºä»€ä¹ˆè¦è®©é¡¹ç›®æ”¯æŒTagç‰ˆæœ¬æ–¹å¼ä¸Šçº¿?</p>
<blockquote>
<p>ç­”: é‡‡ç”¨ Tag çš„æ–¹å¼å¯ä»¥ç›´è§‚çš„çŸ¥é“æˆ‘ä»¬éƒ¨ç½²çš„é¡¹ç›®ç‰ˆæœ¬ï¼ŒåŒæ—¶ä¹Ÿä¾¿äºè¿›è¡Œå›é€€;<br>æ¯”å¦‚: ç¬¬ä¸€æ¬¡ä¸Šçº¿v1.1ç¬¬äºŒæ¬¡ä¸Šçº¿v1.2ï¼Œå¦‚æœæ­¤æ—¶ä¸Šçº¿çš„v1.2å‡ºç°æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¿«é€Ÿå›é€€è‡³ä¸Šä¸€ä¸ªç‰ˆæœ¬v1.1;</p>
</blockquote>
<p>ä½¿ç”¨Tagæ–¹å¼å‘å¸ƒä¸å›é€€æ€è·¯:</p>
<blockquote>
<p>1.å¼€å‘å¦‚æœéœ€è¦å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œå¿…é¡»å°†å½“å‰ç‰ˆæœ¬æ‰“ä¸Šä¸€ä¸ªæ ‡ç­¾ã€‚<br>2.Jenkinséœ€è¦è®©å…¶è„šæœ¬æ”¯æŒä¼ å‚ï¼Œæ¯”å¦‚ç”¨æˆ·ä¼ é€’v1.1åˆ™æ‹‰å–é¡¹ç›®çš„v1.1æ ‡ç­¾ã€‚</p>
</blockquote>
<p><br></p>
<p>å®è·µæ“ä½œ:</p>
<blockquote>
<p>(1) é¦–å…ˆéœ€è¦å®‰è£… <code>Git Parameter</code> æ’ä»¶(<code>å¢åŠ äº†ä»é¡¹ç›®ä¸­é…ç½®çš„gitå­˜å‚¨åº“ä¸­é€‰æ‹©åˆ†æ”¯ã€æ ‡è®°æˆ–ä¿®è®¢çš„èƒ½åŠ›ã€‚</code>)ï¼Œç„¶åé…ç½®Jenkinså‚æ•°åŒ–æ„å»ºè¿‡ç¨‹ï¼Œè®©ç”¨æˆ·åœ¨æ„å»ºæ—¶é€‰æ‹©å¯¹åº”çš„Tagç‰ˆæœ¬;<br>ä¸¢å¼ƒæ—§çš„æ„å»º &gt; ä¿æŒæ„å»ºçš„æœ€å¤§ä¸ªæ•° ä¸º 10 ä¸ª<br>å‚æ•°åŒ–æ„å»ºè¿‡ç¨‹ &gt; Git å‚æ•°  &gt; git_version ï¼ˆå˜é‡ï¼‰ -&gt; å‚æ•°ç±»å‹ Tags -&gt; é»˜è®¤å€¼ (origin/master) -&gt; æ’åºæ–¹å¼ (DESCENDING SMART) å€’åº <code>é˜²æ­¢ Tags é¡ºåºä¹±</code>;<br>é€‰é¡¹å‚æ•° (é€‰æ‹©) &gt; deploy_option ï¼ˆå˜é‡ï¼‰ -&gt; é€‰é¡¹ deploy|rollback<br>æºç ç®¡ç† &gt; Git &gt; Repository URL:<a href="mailto:git@gitlab.weiyigeek.top">git@gitlab.weiyigeek.top</a>:ci-cd/blog.git &gt; Credentials (å¯†é’¥è®¤è¯) -&gt; åˆ†æ”¯æœºæ„å»ºè®¾ ï¼ˆ<code>æŒ‡å®šåˆ†æ”¯ï¼ˆä¸ºç©ºæ—¶ä»£è¡¨anyï¼‰</code>ï¼‰-&gt; å¼•å…¥ ${git_version} å˜é‡<br>æ„å»º &gt; æ‰§è¡Œshell &gt; /bin/sh -x /tmp/script/blog-script.sh<br>åº”ç”¨ &gt; ä¿å­˜</p>
</blockquote>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201225100336.png" target="_blank" title="WeiyiGeek.jenkinsé¡¹ç›®åˆ›å»º" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201225100336.png" alt="WeiyiGeek.jenkinsé¡¹ç›®åˆ›å»º" title="" class=""></a>
                <p>WeiyiGeek.jenkinsé¡¹ç›®åˆ›å»º</p>
            </figure>
<blockquote>
<p>(2) éƒ¨ç½²å’Œå›é€€è„šæœ¬ä»¥åŠè‡ªåŠ¨åŒ–å‘å¸ƒé‡å¤æ„å»ºçš„é—®é¢˜å¤„ç†ç¼–å†™</p>
</blockquote>
<p>touch /tmp/script/blog-script.sh &amp;&amp; chmod a+x $_<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Description: Jenkins CI &amp; Kubernetes &amp; Gitlab -&gt; Deploy or Rollback Blog HTML </span></span><br><span class="line">DATE=$(date +%Y%m%d-%H%M%S)</span><br><span class="line">TAG_PATH=<span class="string">"/nfs/data4/tags"</span></span><br><span class="line">WEB_PATH=<span class="string">"/nfs/data4/web"</span></span><br><span class="line">WEB_DIR=<span class="string">"blog-<span class="variable">$&#123;DATE&#125;</span>-<span class="variable">$&#123;git_version&#125;</span>"</span></span><br><span class="line">K8S_MATER=<span class="string">"weiyigeek@10.10.107.202"</span></span><br><span class="line">K8S_MATER_PORT=<span class="string">"20211"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># éƒ¨ç½²</span></span><br><span class="line"><span class="function"><span class="title">deploy</span></span> () &#123;</span><br><span class="line">  <span class="comment"># 1.æ‰“åŒ…å·¥ä½œç›®å½•ä¸­çš„é¡¹ç›®</span></span><br><span class="line">  <span class="built_in">cd</span> <span class="variable">$&#123;WORKSPACE&#125;</span>/ &amp;&amp; \</span><br><span class="line">  tar -zcf /tmp/<span class="variable">$&#123;WEB_DIR&#125;</span>.tar.gz ./*</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 2.ä¸Šä¼ æ‰“åŒ…çš„é¡¹ç›®åˆ°masterä¹‹ä¸­</span></span><br><span class="line">  scp -P <span class="variable">$&#123;K8S_MATER_PORT&#125;</span> /tmp/<span class="variable">$&#123;WEB_DIR&#125;</span>.tar.gz  weiyigeek@10.10.107.202:<span class="variable">$&#123;TAG_PATH&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 3.è§£å‹&amp;è½¯é“¾æ¥</span></span><br><span class="line">  ssh -p <span class="variable">$&#123;K8S_MATER_PORT&#125;</span> <span class="variable">$&#123;K8S_MATER&#125;</span> <span class="string">"mkdir -p <span class="variable">$&#123;TAG_PATH&#125;</span>/<span class="variable">$&#123;WEB_DIR&#125;</span> &amp;&amp; \ </span></span><br><span class="line"><span class="string">                                         tar -xf <span class="variable">$&#123;TAG_PATH&#125;</span>/<span class="variable">$&#123;WEB_DIR&#125;</span>.tar.gz -C <span class="variable">$&#123;TAG_PATH&#125;</span>/<span class="variable">$&#123;WEB_DIR&#125;</span> &amp;&amp; \</span></span><br><span class="line"><span class="string">                                         rm -rf <span class="variable">$&#123;WEB_PATH&#125;</span> &amp;&amp; \</span></span><br><span class="line"><span class="string">                                         ln -s <span class="variable">$&#123;TAG_PATH&#125;</span>/<span class="variable">$&#123;WEB_DIR&#125;</span> <span class="variable">$&#123;WEB_PATH&#125;</span> &amp;&amp; \</span></span><br><span class="line"><span class="string">                                         kubectl delete pod -l app=blog-html"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å›é€€</span></span><br><span class="line"><span class="function"><span class="title">rollback</span></span> () &#123;</span><br><span class="line">  Previous_Version=$(ssh -p <span class="variable">$&#123;K8S_MATER_PORT&#125;</span> <span class="variable">$&#123;K8S_MATER&#125;</span> <span class="string">"find <span class="variable">$&#123;TAG_PATH&#125;</span> -maxdepth 1 -type d -name blog-*-<span class="variable">$&#123;git_version&#125;</span>"</span>)</span><br><span class="line">  ssh -p <span class="variable">$&#123;K8S_MATER_PORT&#125;</span> <span class="variable">$&#123;K8S_MATER&#125;</span> <span class="string">"rm -rf <span class="variable">$&#123;WEB_PATH&#125;</span> &amp;&amp; \</span></span><br><span class="line"><span class="string">                                         ln -s <span class="variable">$&#123;Previous_Version&#125;</span> <span class="variable">$&#123;WEB_PATH&#125;</span> &amp;&amp; \</span></span><br><span class="line"><span class="string">                                         kubectl delete pod -l app=blog-html"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># éƒ¨ç½² &amp; å›é€€ å…¥å£(å‘-==ä¸¤è¾¹æ²¡æœ‰ç©ºæ ¼)</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">"<span class="variable">$&#123;deploy_option&#125;</span>"</span> = <span class="string">"deploy"</span> ]]; <span class="keyword">then</span></span><br><span class="line">  <span class="comment"># å‘ (é˜²æ­¢å­—ç¬¦ä¸²ä¸ºç©º)</span></span><br><span class="line">  <span class="keyword">if</span> [[ <span class="string">"v<span class="variable">$&#123;GIT_COMMIT&#125;</span>"</span> = <span class="string">"v<span class="variable">$&#123;GIT_PREVIOUS_SUCCESSFUL_COMMIT&#125;</span>"</span> ]];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">"æ‚¨å·²ç»éƒ¨ç½²è¿‡ <span class="variable">$&#123;git_version&#125;</span> ç‰ˆæœ¬"</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    deploy</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="string">"<span class="variable">$&#123;deploy_option&#125;</span>"</span> = <span class="string">"rollback"</span> ]];<span class="keyword">then</span></span><br><span class="line">  rollback</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">exit</span> 127</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>(3) Jenkins æœåŠ¡å™¨ ä¸ Kubernetes Master æœºå™¨ä¸­çš„æ™®é€šç”¨æˆ·è¿›è¡Œ ssh å…¬é’¥è®¤è¯ç™»å½•;</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># copy å…¬é’¥ åˆ° å¯¹ç«¯ä¸»æœº</span></span><br><span class="line">ssh-copy-id -p 20211 weiyigeek@10.10.107.202</span><br><span class="line">  <span class="comment"># /usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/var/lib/jenkins/.ssh/id_ed25519.pub"</span></span><br><span class="line">  <span class="comment"># authorized only. All activity will be monitored and reported.</span></span><br><span class="line">  <span class="comment"># weiyigeek@10.10.107.202's password:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Number of key(s) added: 1</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Now try logging into the machine, with:   "ssh -p '20211' 'weiyigeek@10.10.107.202'" and check to make sure that only the key(s) you wanted were added.</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>(4) ä¸ºæˆ‘ä»¬çš„Blogæ‰“ä¸‰ä¸ªTagå¹¶éªŒè¯æ„å»ºè„šæœ¬</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/workspace/freestyle-blog</span><br><span class="line">jenkins:~/workspace/freestyle-blog$ git config --global user.email <span class="string">"jenkins@weiygeek.top"</span></span><br><span class="line">jenkins:~/workspace/freestyle-blog$ git config --global user.name <span class="string">"Weiyigeek"</span></span><br><span class="line">vim index.html</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">"v1.1"</span></span><br><span class="line">git tag v1.1 -m <span class="string">"Jenkins CI test - v1.1"</span></span><br><span class="line">git push origin HEAD:master</span><br><span class="line">git push origin v1.1</span><br><span class="line">  <span class="comment"># Total 0 (delta 0), reused 0 (delta 0)</span></span><br><span class="line">  <span class="comment"># To gitlab.weiyigeek.top:ci-cd/blog.git</span></span><br><span class="line">  <span class="comment"># * [new tag]         v1.1 -&gt; v1.1</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>(5) è¿›è¡Œé¡¹ç›®æ„å»º -&gt; Build With Paramters æŸ¥çœ‹ éƒ¨ç½²çš„ç‰ˆæœ¬ä»¥åŠæ˜¯éƒ¨ç½²è¿˜æ˜¯å›é€€ -&gt; å¦‚ä¸‹å›¾æ‰€ç¤ºæ‹‰å–çš„æŒ‡å®š Tags ;</p>
</blockquote>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201225101836.png" target="_blank" title="WeiyiGeek.é¡¹ç›®æ„å»º" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201225101836.png" alt="WeiyiGeek.é¡¹ç›®æ„å»º" title="" class=""></a>
                <p>WeiyiGeek.é¡¹ç›®æ„å»º</p>
            </figure>
<blockquote>
<p>(6) é¡¹ç›®æ„å»ºéƒ¨ç½²éªŒè¯ è®¿é—®<code>http://10.10.107.202:30088/</code>åšå®¢åœ°å€</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Built Branches</span><br><span class="line">    v1.3: Build <span class="comment">#4 of Revision 4f80504ee142cb9866e4a0988cdc1e1693cfd7aa (v1.3)</span></span><br><span class="line">    v1.2: Build <span class="comment">#3 of Revision 4e1dd6eded12d7cad3740d2461c3e784ad712632 (v1.2)</span></span><br><span class="line">    v1.1: Build <span class="comment">#2 of Revision cd2d5778292ff2cbb7d4ac1b82c684223a38761b (v1.1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœå·²ç»éƒ¨ç½²è¿‡è¯¥é¡¹ç›®åˆ™æ˜¾ç¤º:</span></span><br><span class="line">  <span class="comment"># + '[' deploy==deploy ']'</span></span><br><span class="line">  <span class="comment"># + [[ v4f80504ee142cb9866e4a0988cdc1e1693cfd7aa = \v\4\f\8\0\5\0\4\e\e\1\4\2\c\b\9\8\6\6\e\4\a\0\9\8\8\c\d\c\1\e\1\6\9\3\c\f\d\7\a\a ]]</span></span><br><span class="line">  <span class="comment"># + echo -e 'æ‚¨å·²ç»éƒ¨ç½²è¿‡ v1.3 ç‰ˆæœ¬'</span></span><br><span class="line">  <span class="comment"># æ‚¨å·²ç»éƒ¨ç½²è¿‡ v1.3 ç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201225103232.png" target="_blank" title="WeiyiGeek.é¡¹ç›®æ„å»ºéƒ¨ç½²éªŒè¯" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201225103232.png" alt="WeiyiGeek.é¡¹ç›®æ„å»ºéƒ¨ç½²éªŒè¯" title="" class=""></a>
                <p>WeiyiGeek.é¡¹ç›®æ„å»ºéƒ¨ç½²éªŒè¯</p>
            </figure>
<blockquote>
<p>(6) é¡¹ç›®å›é€€éªŒè¯ &gt; è¯·é€‰æ‹©æ‚¨è¦éƒ¨ç½²çš„RELEASEç‰ˆæœ¬<code>v1.1</code>, ç„¶åé€‰æ‹©éƒ¨ç½²æˆ–æ˜¯å›é€€;</p>
</blockquote>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201225105740.png" target="_blank" title="WeiyiGeek.é¡¹ç›®å›é€€éªŒè¯" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201225105740.png" alt="WeiyiGeek.é¡¹ç›®å›é€€éªŒè¯" title="" class=""></a>
                <p>WeiyiGeek.é¡¹ç›®å›é€€éªŒè¯</p>
            </figure>
<p><br></p>
<h3 id="Maven-é›†æˆé…ç½®ä¸å®è·µ"><a href="#Maven-é›†æˆé…ç½®ä¸å®è·µ" class="headerlink" title="Maven é›†æˆé…ç½®ä¸å®è·µ"></a>Maven é›†æˆé…ç½®ä¸å®è·µ</h3><p><strong>åŸºæœ¬æ¦‚è¿°:</strong><br>Q: ä»€ä¹ˆæ˜¯Javaé¡¹ç›®?</p>
<blockquote>
<p>ç­”ï¼šç®€å•æ¥è¯´å°±æ˜¯ä½¿ç”¨Javaç¼–å†™çš„ä»£ç ï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¸ºJavaé¡¹ç›®ï¼›</p>
</blockquote>
<p>Q: ä¸ºä»€ä¹ˆJavaé¡¹ç›®éœ€è¦ä½¿ç”¨Mavenç¼–è¯‘?</p>
<blockquote>
<p>ç­”: ç”±äºJavaç¼–å†™çš„WebæœåŠ¡ä»£ç æ˜¯æ— æ³•ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œéœ€è¦ä½¿ç”¨Mavenå·¥å…·è¿›è¡Œæ‰“åŒ…;<br>ç®€å•ç†è§£: Java æºä»£ç å°±åƒæ±½è½¦çš„ä¸€å †æ•£ä»¶ï¼Œå¿…é¡»ç»è¿‡å·¥å‚çš„ç»„è£…æ‰èƒ½å®Œæˆä¸€è¾†å®Œæ•´çš„æ±½è½¦ï¼Œè¿™é‡Œç»„è£…æ±½è½¦å¯ä»¥ç†è§£æ˜¯ Maven ç¼–è¯‘è¿‡ç¨‹;</p>
</blockquote>
<p>Q: åœ¨å®ç°è‡ªåŠ¨åŒ–æ„å»ºJavaé¡¹ç›®æ—¶ï¼Œå…ˆå®ç°æ‰‹åŠ¨æ„å»ºJavaé¡¹ç›®;</p>
<blockquote>
<p>ç­”: å› ä¸ºæƒ³è¦å®ç°è‡ªåŠ¨åŒ–å‘å¸ƒä»£ç ï¼Œå°±å¿…é¡»æ‰‹åŠ¨è¿›è¡Œä¸€æ¬¡æ„å»ºï¼Œæ—¢æ˜¯ç†Ÿæ‚‰è¿‡ç¨‹åˆæ˜¯ä¼˜åŒ–æˆ‘ä»¬çš„éƒ¨ç½²è„šæœ¬;<br>å¤§è‡´æµç¨‹: æºç  -&gt; gitlab -&gt; Maven æ‰‹åŠ¨æ„å»º -&gt; æœ€åæ¨é€æ„å»º -&gt; å‘å¸ƒ;</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Maven æ‹‰å– Jar çš„å‡ ç§é€”å¾„</span></span><br><span class="line">                -&gt; å›½å¤– Maven Jar æœåŠ¡å™¨</span><br><span class="line">Gitlab -&gt; Maven -&gt; å›½å†… Maven Jar é•œåƒæœåŠ¡å™¨</span><br><span class="line">                -&gt; ä¼ä¸š å†…éƒ¨ Maven Jar ç§æœæœåŠ¡å™¨ (å¯ä»¥åŒå‘åŒæ­¥)</span><br></pre></td></tr></table></figure>
<p><br/></p>
<p>è‡ªåŠ¨éƒ¨ç½² Java é¡¹ç›®è‡³ kubernetes é›†ç¾¤æµç¨‹æ­¥éª¤ï¼š</p>
<ul>
<li>(1) Jenkins å®‰è£… Maven Integration æ’ä»¶ï¼Œä½¿Jenkinsæ”¯æŒMavené¡¹ç›®çš„æ„å»º</li>
<li>(2) Jenkins é…ç½® JDK è·¯å¾„ä»¥åŠ Maven è·¯å¾„</li>
<li>(3) Jenkins åˆ›å»º Maven é¡¹ç›®ç„¶åè¿›è¡Œæ„å»º</li>
<li>(4) ç¼–å†™è‡ªåŠ¨åŒ–ä¸Šçº¿è„šæœ¬æ¨é€è‡³ kubernetes é›†ç¾¤</li>
<li>(5) ä¼˜åŒ–éƒ¨ç½²è„šæœ¬ä½¿å…¶æ”¯æŒä¸Šçº¿ä¸å›æ»šä»¥åŠï¼Œç›¸åŒç‰ˆæœ¬é‡å¤æ„å»º</li>
</ul>
<p><br/></p>
<p><strong>åŸºç¡€ç¯å¢ƒé…ç½®:</strong></p>
<ul>
<li>Step 1. Jenkins æœåŠ¡å™¨ä¸­ Java ä¸ Maven ç¯å¢ƒé…ç½®ä¸ Maven æ’ä»¶å®‰è£…;<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Java ç¯å¢ƒ</span></span><br><span class="line">~$ ls /usr/<span class="built_in">local</span>/jdk1.8.0_211/</span><br><span class="line">~$ java -version</span><br><span class="line">  <span class="comment"># java version "1.8.0_211"</span></span><br><span class="line">  <span class="comment"># Java(TM) SE Runtime Environment (build 1.8.0_211-b12)</span></span><br><span class="line">  <span class="comment"># Java HotSpot(TM) 64-Bit Server VM (build 25.211-b12, mixed mode)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Maven ç¯å¢ƒ (ä¸¤ç§æ–¹å¼)</span></span><br><span class="line"><span class="comment"># ~$ sudo apt install maven # æ–¹å¼1</span></span><br><span class="line">~$ wget https://mirrors.tuna.tsinghua.edu.cn/apache/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gz </span><br><span class="line">~$ sudo tar -zxvf apache-maven-3.6.3-bin.tar.gz -C /usr/<span class="built_in">local</span></span><br><span class="line">~$ ls /usr/<span class="built_in">local</span>/apache-maven-3.6.3/</span><br><span class="line">  <span class="comment"># bin  boot  conf  lib  LICENSE  NOTICE  README.txt</span></span><br><span class="line">~$ sudo ln -s /usr/<span class="built_in">local</span>/apache-maven-3.6.3/ /usr/<span class="built_in">local</span>/maven  <span class="comment"># éå¸¸å€¼å¾—å­¦ä¹ (å˜ç‰ˆæœ¬å´ä¸å˜æ‰§è¡Œè·¯å¾„)</span></span><br><span class="line">~$ /usr/<span class="built_in">local</span>/maven/bin/mvn -v</span><br><span class="line">  <span class="comment"># Apache Maven 3.6.3 (cecedd343002696d0abb50b32b541b8a6ba2883f)</span></span><br><span class="line">  <span class="comment"># Maven home: /usr/local/maven</span></span><br><span class="line">  <span class="comment"># Java version: 1.8.0_211, vendor: Oracle Corporation, runtime: /usr/local/jdk1.8.0_211/jre</span></span><br><span class="line">  <span class="comment"># Default locale: en_US, platform encoding: UTF-8</span></span><br><span class="line">  <span class="comment"># OS name: "linux", version: "5.4.0-46-generic", arch: "amd64", family: "unix"</span></span><br><span class="line">~$ <span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/maven/bin/:<span class="variable">$PATH</span>  <span class="comment"># ä¸´æ—¶</span></span><br><span class="line">~$ <span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:/usr/<span class="built_in">local</span>/maven/bin/:<span class="variable">$PATH</span> <span class="comment"># åŠ å…¥ /etc/Profileæ°¸ä¹… </span></span><br><span class="line">~$ mvn -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># Maven Integration æ’ä»¶ å®‰è£…</span></span><br><span class="line"><span class="comment"># PS : æä¾›äº†Jenkinså’ŒMavençš„æ·±åº¦é›†æˆ:æ ¹æ®å¿«ç…§åœ¨é¡¹ç›®ä¹‹é—´è‡ªåŠ¨è§¦å‘ï¼Œå„ç§Jenkinså‘å¸ƒè€…çš„è‡ªåŠ¨é…ç½®(Junit)ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Jenkins ä¸­ Maven é›†æˆé…ç½®</span></span><br><span class="line">&gt; é¢æ¿ -&gt; å…¨å±€å·¥å…·é…ç½® -&gt; JDK é…ç½® -&gt; æ–°å¢JDK -&gt; åˆ«å jdk_env -&gt; JAVA_HOME /usr/<span class="built_in">local</span>/jdk1.8.0_211/</span><br><span class="line">                                -&gt; æ–°å¢Maven -&gt; åˆ«å maven_env -&gt; MAVEN_HOME /usr/<span class="built_in">local</span>/jdk1.8.0_211/</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201225214635.png" target="_blank" title="WeiyiGeek.Maven é›†æˆé…ç½®" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201225214635.png" alt="WeiyiGeek.Maven é›†æˆé…ç½®" title="" class=""></a>
                <p>WeiyiGeek.Maven é›†æˆé…ç½®</p>
            </figure>
</li>
</ul>
<ul>
<li>Step 2.æ‰‹åŠ¨æˆ‘ä»¬çš„Javaçš„Mavené¡¹ç›®, æµ‹è¯•JenkinsæœåŠ¡å™¨ä¸Šçš„Mavenæ˜¯å¦å¯ä»¥æ­£å¸¸ç¼–è¯‘WaråŒ…å¹¶è¿è¡Œåœ¨å•æœºçš„Tomcat8 ä¹‹ä¸­;</li>
</ul>
<p>Maven é•œåƒé…ç½®(æ‚¨ä¹Ÿå¯é€‰æ‹©é˜¿é‡Œäº‘çš„Mavenä»“åº“åœ°å€åŠ å¿«æ‹‰å–é€Ÿåº¦):<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- # (1) ä¿®æ”¹å®˜æ–¹çš„Mavenä»“åº“åœ°å€ä¸ºæœ¬åœ°ç§æœ; --&gt;</span></span><br><span class="line">158   <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">159 <span class="comment">&lt;!-- Maven ç§æœåœ°å€é…ç½® --&gt;</span></span><br><span class="line">160     <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">161         <span class="tag">&lt;<span class="name">id</span>&gt;</span>weiyigeek-maven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">162         <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">163         <span class="tag">&lt;<span class="name">name</span>&gt;</span>Private maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">164         <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.weiyigeek.top:8081/repository/maven-public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">165     <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">166   <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- # (2) Default: $&#123;user.home&#125;/.m2/repository ç¼“å­˜ç›®å½• --&gt;</span></span><br><span class="line">53   <span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>/path/to/local/repo<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Mavenä»£ç é¡¹ç›®ç¨‹åºæ‹‰å–:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git@gitlab.weiyigeek.top:ci-cd/java-maven.git</span><br><span class="line">  <span class="comment"># Cloning into 'java-maven'...</span></span><br><span class="line">  <span class="comment"># The authenticity of host 'gitlab.weiyigeek.top (10.10.107.201)' can't be established.</span></span><br><span class="line">$ ~/code/java-maven$ ls</span><br><span class="line">pom.xml  src  target</span><br></pre></td></tr></table></figure></p>
<p>æ„å»ºä¸è¿è¡Œæµ‹è¯•:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">~/code/java-maven$ mvn clean package -Dmaven.test.skip=<span class="literal">true</span>   <span class="comment"># è·³è¿‡æµ‹è¯•ç”¨ä¾‹</span></span><br><span class="line">  <span class="comment"># [INFO] Building war: /home/weiyigeek/code/java-maven/target/hello-world.war</span></span><br><span class="line">  <span class="comment"># [INFO] WEB-INF/web.xml already added, skipping</span></span><br><span class="line">  <span class="comment"># [INFO] ------------------------------------------------------------------------</span></span><br><span class="line">  <span class="comment"># [INFO] BUILD SUCCESS</span></span><br><span class="line">  <span class="comment"># [INFO] ------------------------------------------------------------------------</span></span><br><span class="line">  <span class="comment"># [INFO] Total time:  7.225 s</span></span><br><span class="line">  <span class="comment"># [INFO] Finished at: 2020-12-25T09:23:20Z</span></span><br><span class="line">  <span class="comment"># [INFO] ------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">~/code/java-maven$ ls -alh /home/weiyigeek/code/java-maven/target/hello-world.war  <span class="comment"># ç”Ÿæˆçš„war</span></span><br><span class="line">-rw-r--r-- 1 weiyigeek weiyigeek 2.0M Dec 25 09:23 /home/weiyigeek/code/java-maven/target/hello-world.war</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†ç”Ÿæˆçš„ hello-world.war å¤åˆ¶åˆ°æœ¬åœ°çš„ Tomcat çš„Wabappsç›®å½•ä¹‹ä¸­ä»–ä¼šè‡ªåŠ¨è§£å‹</span></span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201225213200.png" target="_blank" title="WeiyiGeek.Maven-hello-world" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201225213200.png" alt="WeiyiGeek.Maven-hello-world" title="" class=""></a>
                <p>WeiyiGeek.Maven-hello-world</p>
            </figure>
<ul>
<li>Step 3.åœ¨ Kubernets ä¸Š å‡†å¤‡æ¥å—  Jenkins æ¨é€è¿‡æ¥çš„waråŒ…çš„é¡¹ç›®ç¯å¢ƒ;<br>åŸºç¡€é…ç½®:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) NFS æœåŠ¡å™¨ä¸Šé…ç½® (PS:ç”±äºæµ‹è¯•èµ„æºæœ‰é™ åˆ™ nfs ä¸ k8s master åœ¨åŒä¸€å°æœºå™¨ä¸Š)</span></span><br><span class="line">root@nfs$ showmount -e</span><br><span class="line">  <span class="comment"># /nfs/data4 *</span></span><br><span class="line">/nfs/data4<span class="comment"># ls -alh /nfs/</span></span><br><span class="line">  <span class="comment"># drwxrwxrwx  2 weiyigeek weiyigeek 4.0K Nov 19 13:27 data4</span></span><br><span class="line">/nfs/data4<span class="comment"># mkdir /nfs/data4/&#123;war,webapps&#125;/</span></span><br><span class="line">/nfs/data4<span class="comment"># ln -s /nfs/data4/war/ROOT /nfs/data4/webapps/ROOT</span></span><br><span class="line">/nfs/data4<span class="comment"># chown -R weiyigeek:weiyigeek /nfs/data4/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) Node 1 &amp;&amp; Node 2 éƒ½è¦æ‰§è¡Œ</span></span><br><span class="line">sudo mkdir -pv /nfs/data4/</span><br><span class="line">sudo chown -R weiyigeek:weiyigeek /nfs/data4/</span><br><span class="line">sudo mount.nfs -r 10.10.107.202:/nfs/data4/ /nfs/data4/</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) master èŠ‚ç‚¹æ‹‰å– tomcat æ­¤å¤„é€‰æ‹© 8.5.61-jdk8-corretto å¹¶ä¸Šä¼ åˆ°å†…éƒ¨ç§æœ‰harborä¹‹ä¸­</span></span><br><span class="line">master$ docker pull tomcat:8.5.61-jdk8-corretto</span><br><span class="line">  <span class="comment"># 8.5.61-jdk8-corretto: Pulling from library/tomcat</span></span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line">  <span class="comment"># Status: Downloaded newer image for tomcat:8.5.61-jdk8-corretto</span></span><br><span class="line">  <span class="comment"># docker.io/library/tomcat:8.5.61-jdk8-corretto</span></span><br><span class="line">master$ docker tag tomcat:8.5.61-jdk8-corretto harbor.weiyigeek.top/<span class="built_in">test</span>/tomcat:8.5.61-jdk8-corretto</span><br><span class="line">master$ docker push  harbor.weiyigeek.top/<span class="built_in">test</span>/tomcat:8.5.61-jdk8-corretto</span><br><span class="line">  <span class="comment"># The push refers to repository [harbor.weiyigeek.top/test/tomcat]</span></span><br><span class="line">  <span class="comment"># f13244e4918b: Pushed</span></span><br><span class="line">  <span class="comment"># 536f15f78828: Pushed</span></span><br><span class="line">  <span class="comment"># 1c98b6d16fad: Pushed</span></span><br><span class="line">  <span class="comment"># fdef502bf282: Pushed</span></span><br><span class="line">  <span class="comment"># cee8d35c645b: Pushed</span></span><br><span class="line">  <span class="comment"># 8.5.61-jdk8-corretto: digest: sha256:110d7391739e868daf8c1bdd03fcb7ffe9eaf2b134768b9162e2cd47d58f7255 size: 1368</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) èŠ‚ç‚¹æ‹‰å–éªŒè¯</span></span><br><span class="line">k8s-node-4:~$ docker pull harbor.weiyigeek.top/<span class="built_in">test</span>/tomcat:8.5.61-jdk8-corretto</span><br><span class="line">k8s-node-5:~$ docker pull harbor.weiyigeek.top/<span class="built_in">test</span>/tomcat:8.5.61-jdk8-corretto</span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) å°† jenkins ä¸­æ„å»ºå¥½çš„waråŒ… ä¸Šä¼ åˆ° Master èŠ‚ç‚¹ çš„ /nfs/data4/war ç›®å½•ä¹‹ä¸­</span></span><br><span class="line">jenkins$ scp -P 20211 /var/lib/jenkins/workspace/Maven-HelloWorld/target/hello-world.war weiyigeek@10.10.107.202:/nfs/data4/war</span><br><span class="line"><span class="comment"># **************WARNING**************</span></span><br><span class="line"><span class="comment"># Authorized only. All activity will be monitored and reported.</span></span><br><span class="line"><span class="comment"># hello-world.war     </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (6) è§£å‹warå¹¶å»ºç«‹è½¯é“¾æ¥</span></span><br><span class="line">master$ /nfs/data4/war$ unzip hello-world.war -d hello-world-v1.0</span><br><span class="line">  <span class="comment"># Archive:  hello-world.war</span></span><br><span class="line">master$ /nfs/data4/war$ ls</span><br><span class="line">  <span class="comment"># hello-world-v1.0  hello-world.war</span></span><br><span class="line">master$ /nfs/data4$ ln -s /nfs/data4/war/hello-world-v1.0/ /nfs/data4/webapps &amp;&amp; ls /nfs/data4/webapps <span class="comment"># å‘å¤ªå¤šè¯¥ç›®å½•ä¸èƒ½å­˜åœ¨</span></span><br><span class="line">  <span class="comment"># index.jsp  META-INF  WEB-INF</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>èµ„æºæ¸…å•: (<code>åŒæ ·æ­¤å¤„é‡‡ç”¨äº†HostPathçš„Volumnså·(waré¡¹ç›®)ä¸StorageClasså­˜å‚¨ç±»(è®¿é—®æ—¥å¿—)</code>)<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; jenkins-ci-gitlab-to-kubernetes.yaml &lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">deploy-maven-svc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">NodePort</span>         <span class="comment"># Service ç±»å‹</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">java-maven</span>       <span class="comment"># ã€æ³¨æ„ã€‘ä¸deploymentèµ„æºæ§åˆ¶å™¨åˆ›å»ºçš„Podæ ‡ç­¾è¿›è¡Œç»‘å®š;</span></span><br><span class="line"><span class="attr">    release:</span> <span class="string">stabel</span>       <span class="comment"># Service æœåŠ¡å‘ç°ä¸èƒ½ç¼ºå°‘Podæ ‡ç­¾ï¼Œæœ‰äº†Podæ ‡ç­¾æ‰èƒ½ä¸ä¹‹SVCå¯¹åº”</span></span><br><span class="line"><span class="attr">  ports:</span>                  <span class="comment"># æ˜ å°„ç«¯å£</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">http</span>            </span><br><span class="line"><span class="attr">    port:</span> <span class="number">8080</span>              <span class="comment"># cluster è®¿é—®ç«¯å£</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">8080</span>        <span class="comment"># Pod å®¹å™¨å†…çš„æœåŠ¡ç«¯å£</span></span><br><span class="line"><span class="attr">    nodePort:</span> <span class="number">30089</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">deploy-java-maven</span> </span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  serviceName:</span> <span class="string">"deploy-maven-svc"</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span>                <span class="comment"># å‰¯æœ¬æ•°</span></span><br><span class="line"><span class="attr">  selector:</span>                  <span class="comment"># é€‰æ‹©å™¨</span></span><br><span class="line"><span class="attr">    matchLabels:</span>  </span><br><span class="line"><span class="attr">      app:</span> <span class="string">java-maven</span>   <span class="comment"># åŒ¹é…çš„Podæ ‡ç­¾éå¸¸é‡è¦</span></span><br><span class="line"><span class="attr">      release:</span> <span class="string">stabel</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">java-maven</span>      <span class="comment"># æ¨¡æ¿æ ‡ç­¾</span></span><br><span class="line"><span class="attr">        release:</span> <span class="string">stabel</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      volumes:</span>                <span class="comment"># å…³é”®ç‚¹</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">webapps</span>         <span class="comment"># å·åç§° </span></span><br><span class="line"><span class="attr">        hostPath:</span>             <span class="comment"># é‡‡ç”¨hostPathå·</span></span><br><span class="line"><span class="attr">          type:</span> <span class="string">DirectoryOrCreate</span>   <span class="comment"># å·ç±»å‹DirectoryOrCreate: å¦‚æœå­èŠ‚ç‚¹ä¸Šæ²¡æœ‰è¯¥ç›®å½•ä¾¿ä¼šè¿›è¡Œåˆ›å»º</span></span><br><span class="line"><span class="attr">          path:</span> <span class="string">/nfs/data4/webapps</span>  <span class="comment"># å„ä¸»æœºèŠ‚ç‚¹ä¸Šå·²å­˜åœ¨çš„ç›®å½•æ­¤å¤„æ˜¯NFSå…±äº«</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">timezone</span>     <span class="comment"># å®¹å™¨æ—¶åŒºè®¾ç½®</span></span><br><span class="line"><span class="attr">        hostPath:</span></span><br><span class="line"><span class="attr">          path:</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">java-maven</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">harbor.weiyigeek.top/test/tomcat:8.5.61-jdk8-corretto</span>  <span class="comment"># æ‹‰å–çš„é•œåƒ</span></span><br><span class="line"><span class="attr">        imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">http</span>         <span class="comment"># æ­¤ç«¯å£åœ¨æœåŠ¡ä¸­çš„åç§°</span></span><br><span class="line"><span class="attr">          containerPort:</span> <span class="number">8080</span>  <span class="comment"># å®¹å™¨æš´éœ²çš„ç«¯å£</span></span><br><span class="line"><span class="attr">        volumeMounts:</span>        <span class="comment"># æŒ‚è½½æŒ‡å®šå·ç›®å½•</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">webapps</span>      <span class="comment"># Tomcat åº”ç”¨ç›®å½•</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/usr/local/tomcat/webapps/ROOT</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">logs</span>         <span class="comment"># Tomcat æ—¥å¿—ç›®å½•</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/usr/local/tomcat/logs</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">timezone</span>     <span class="comment"># é•œåƒæ—¶åŒºè®¾ç½®</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai</span></span><br><span class="line"><span class="attr">  volumeClaimTemplates:</span>      <span class="comment"># å·çš„ä½“ç§¯è¦æ±‚æ¨¡æ¿æ­¤å¤„é‡‡ç”¨StorageClasså­˜å‚¨ç±»ä¸»è¦é’ˆå¯¹äºåº”ç”¨æ—¥å¿—çš„å­˜å‚¨;</span></span><br><span class="line"><span class="attr">  - metadata:</span>                <span class="comment"># æ ¹æ®æ¨¡æ¿è‡ªåŠ¨åˆ›å»ºPVä¸PVCå¹¶ä¸”è¿›è¡Œä¸€ä¸€å¯¹åº”ç»‘å®š;</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">logs</span>       </span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      accessModes:</span> <span class="string">[</span> <span class="string">"ReadWriteOnce"</span> <span class="string">]</span></span><br><span class="line"><span class="attr">      storageClassName:</span> <span class="string">managed-nfs-storage</span> <span class="comment"># StorageClasså­˜å‚¨ç±»</span></span><br><span class="line"><span class="attr">      resources:</span></span><br><span class="line"><span class="attr">        requests:</span></span><br><span class="line"><span class="attr">          storage:</span> <span class="number">1</span><span class="string">Gi</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></p>
<p>èµ„æºæ¸…å•æ„å»º:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) svc ä¸ stafefulset èµ„æºåˆ›å»º</span></span><br><span class="line">~/K8s/Day12$ kubectl apply -f jenkins-ci-gitlab-to-kubernetes.yaml</span><br><span class="line">  <span class="comment"># service/deploy-maven-svc created</span></span><br><span class="line">  <span class="comment"># statefulset.apps/deploy-java-maven created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æŸ¥çœ‹åˆ›å»ºçš„èµ„æº</span></span><br><span class="line">~/K8s/Day12$ kubectl get svc | grep <span class="string">"deploy-maven-svc"</span> &amp;&amp; kubectl get pod -l app=java-maven -o wide</span><br><span class="line">  <span class="comment"># deploy-maven-svc   NodePort    10.101.97.223    8080:30089/TCP  7m24s</span></span><br><span class="line">  <span class="comment"># NAME                  READY   STATUS    RESTARTS   AGE   IP             NODE        </span></span><br><span class="line">  <span class="comment"># deploy-java-maven-0   1/1     Running   0          10s   10.244.0.212   weiyigeek-ubuntu </span></span><br><span class="line">  <span class="comment"># deploy-java-maven-1   1/1     Running   0          25s   10.244.1.199   k8s-node-4  </span></span><br><span class="line">  <span class="comment"># deploy-java-maven-2   1/1     Running   0          29s   10.244.2.102   k8s-node-5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) è®¿é—®éªŒè¯</span></span><br><span class="line">master$ curl -s http://10.101.97.223:8080 | grep <span class="string">"&lt;p&gt;"</span></span><br><span class="line">  <span class="comment"># &lt;p&gt; Server : Apache Tomcat/8.5.61  | 10.244.2.102 &lt;/p&gt;</span></span><br><span class="line">  <span class="comment"># &lt;p&gt; Client : 10.244.0.0 | 10.244.0.0&lt;/p&gt;</span></span><br><span class="line">  <span class="comment"># &lt;p&gt; Document_Root : /usr/local/tomcat/webapps/ROOT/  &lt;br/&gt;&lt;br/&gt; URL : 10.101.97.223/index.jsp  &lt;/p&gt;</span></span><br><span class="line">master$ curl -s http://10.101.97.223:8080 | grep <span class="string">"&lt;p&gt;"</span></span><br><span class="line">  <span class="comment"># &lt;p&gt; Server : Apache Tomcat/8.5.61  | 10.244.0.212 &lt;/p&gt;</span></span><br><span class="line">  <span class="comment"># &lt;p&gt; Client : 10.244.0.1 | 10.244.0.1&lt;/p&gt;</span></span><br><span class="line">  <span class="comment"># &lt;p&gt; Document_Root : /usr/local/tomcat/webapps/ROOT/  &lt;br/&gt;&lt;br/&gt; URL : 10.101.97.223/index.jsp  &lt;/p&gt;</span></span><br><span class="line">master$ curl -s http://10.101.97.223:8080 | grep <span class="string">"&lt;p&gt;"</span></span><br><span class="line">  <span class="comment"># &lt;p&gt; Server : Apache Tomcat/8.5.61  | 10.244.1.199 &lt;/p&gt;</span></span><br><span class="line">  <span class="comment"># &lt;p&gt; Client : 10.244.0.0 | 10.244.0.0&lt;/p&gt;</span></span><br><span class="line">  <span class="comment"># &lt;p&gt; Document_Root : /usr/local/tomcat/webapps/ROOT/  &lt;br/&gt;&lt;br/&gt; URL : 10.101.97.223/index.jsp  &lt;/p&gt;</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>Step 4.ä¸‹é¢æ­£é¤å¼€å§‹äº†ï¼Œåœ¨ Jenkins æ§åˆ¶å° <code>ç‚¹å‡»æ–°å»ºä»»åŠ¡ -&gt; è¾“å…¥ä»»åŠ¡åç§°(Maven-HelloWorld) -&gt; é€‰æ‹©æ„å»ºä¸€ä¸ªMavené¡¹ç›®</code></li>
</ul>
<p>å¸¸è§„è®¾ç½®: ä¸¢å¼ƒæ—§çš„æ„å»º 10 ä¸ªã€å‚æ•°åŒ–æ„å»ºè¿‡ç¨‹ <code>Git å‚æ•° git_version | é€‰é¡¹å‚æ•° deploy_option ï¼ˆdeploy|rollback|redeployï¼‰</code> (è®¾ç½®ä¸ä¸Šé¢ç›¸åŒ PS æ³¨æ„æ’åºæ–¹å¼ä¸ºæ™ºèƒ½æ’åº)</p>
<p>å…³é”®ç‚¹: Maven Build -&gt; <code>Goals and options : clean package -Dmaven.test.skip=true</code></p>
<p>æ„å»ºåè„šæœ¬è®¾ç½®: Post Steps -&gt; æ‰§è¡Œ Shell å‘½ä»¤ -&gt; <code>/bin/bash -x /tmp/script/maven-jenkins-ci-script.sh</code>-&gt; åº”ç”¨å¹¶ä¿å­˜</p>
<p>æ„å»ºæµ‹è¯•ç»“æœ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é¡¹ç›®æ‹‰å–</span></span><br><span class="line">Running as SYSTEM</span><br><span class="line">Building <span class="keyword">in</span> workspace /var/lib/jenkins/workspace/Maven-HelloWorld</span><br><span class="line">The recommended git tool is: NONE</span><br><span class="line">using credential b4c8b4e9-2777-44a1-a1ed-e9dc21d37f4f</span><br><span class="line">Cloning the remote Git repository</span><br><span class="line">Cloning repository git@gitlab.weiyigeek.top:ci-cd/java-maven.git</span><br><span class="line"></span><br><span class="line">&lt;===[JENKINS REMOTING CAPACITY]===&gt;channel started</span><br><span class="line">Executing Maven: -B -f /var/lib/jenkins/workspace/Maven-HelloWorld/pom.xml clean package -Dmaven.test.skip=<span class="literal">true</span></span><br><span class="line"><span class="comment"># æ‰«æé¡¹ç›®å¹¶ä¸‹è½½ä¾èµ–</span></span><br><span class="line">[INFO] Scanning <span class="keyword">for</span> projects...</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] -------------------&lt; com.weiyigeek.main:hello-world &gt;-------------------</span><br><span class="line">[INFO] Building hello-world Maven Webapp 1.1-SNAPSHOT</span><br><span class="line">[INFO] --------------------------------[ war ]---------------------------------</span><br><span class="line">[INFO] Downloading from weiyigeek-maven: http://maven.weiyigeek.top:8081/repository/maven-public/org/apache/maven/plugins/maven-clean-plugin/2.5/maven-clean-plugin-2.5.pom</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“åŒ…åº”ç”¨</span></span><br><span class="line">[INFO] Packaging webapp</span><br><span class="line">[INFO] Assembling webapp [hello-world] <span class="keyword">in</span> [/var/lib/jenkins/workspace/Maven-HelloWorld/target/hello-world]</span><br><span class="line">[INFO] Processing war project</span><br><span class="line">[INFO] Copying webapp resources [/var/lib/jenkins/workspace/Maven-HelloWorld/src/main/webapp]</span><br><span class="line">[INFO] Webapp assembled <span class="keyword">in</span> [26 msecs]</span><br><span class="line">[INFO] Building war: /var/lib/jenkins/workspace/Maven-HelloWorld/target/hello-world.war</span><br><span class="line">[INFO] WEB-INF/web.xml already added, skipping</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time:  6.756 s</span><br><span class="line">[INFO] Finished at: 2020-12-25T13:55:45Z</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">Waiting <span class="keyword">for</span> Jenkins to finish collecting data</span><br><span class="line">[JENKINS] Archiving /var/lib/jenkins/workspace/Maven-HelloWorld/pom.xml to com.weiyigeek.main/hello-world/1.1-SNAPSHOT/hello-world-1.1-SNAPSHOT.pom</span><br><span class="line">[JENKINS] Archiving /var/lib/jenkins/workspace/Maven-HelloWorld/target/hello-world.war to com.weiyigeek.main/hello-world/1.1-SNAPSHOT/hello-world-1.1-SNAPSHOT.war</span><br><span class="line">channel stopped</span><br><span class="line">Finished: SUCCESS</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>Step 5.Jenkins CI éƒ¨ç½²Shellè„šæœ¬ç¼–å†™,è„šæœ¬éœ€æ±‚éƒ¨ç½²ã€å›é€€ã€å¯é‡å¤æ„å»º;<br>è„šæœ¬ä¸æƒé™: <code>su - &quot;jenkins&quot; -c &quot;touch /tmp/script/maven-jenkins-ci-script.sh &amp;&amp; chmod a+x /tmp/script/maven-jenkins-ci-script.sh&quot;</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Description: Jenkins CI &amp; Kubernetes &amp; Gitlab -&gt; Deploy or Rollback or Redeploy Java Maven Project</span></span><br><span class="line">DATE=$(date +%Y%m%d-%H%M%S)</span><br><span class="line">WAR_PATH=<span class="string">"/nfs/data4/war"</span></span><br><span class="line">WEBROOT_PATH=<span class="string">"/nfs/data4/webapps"</span></span><br><span class="line">WEB_DIR=<span class="string">"<span class="variable">$&#123;JOB_NAME&#125;</span>-<span class="variable">$&#123;DATE&#125;</span>-<span class="variable">$&#123;git_version&#125;</span>"</span></span><br><span class="line">WAR_DIR=<span class="string">"<span class="variable">$&#123;WAR_PATH&#125;</span>/<span class="variable">$&#123;WEB_DIR&#125;</span>"</span></span><br><span class="line">WAR_NAME=<span class="string">"<span class="variable">$&#123;WEB_DIR&#125;</span>.war"</span></span><br><span class="line">K8S_MATER=<span class="string">"weiyigeek@10.10.107.202"</span></span><br><span class="line">K8S_MATER_PORT=<span class="string">"20211"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éƒ¨ç½²</span></span><br><span class="line"><span class="function"><span class="title">deploy</span></span> () &#123;</span><br><span class="line">  <span class="comment"># 1.ä¸Šä¼ Mavenæ‰“åŒ…çš„waråŒ…åˆ°masterä¹‹ä¸­</span></span><br><span class="line">  scp -P <span class="variable">$&#123;K8S_MATER_PORT&#125;</span> <span class="variable">$&#123;WORKSPACE&#125;</span>/target/*.war  weiyigeek@10.10.107.202:<span class="variable">$&#123;WAR_PATH&#125;</span>/<span class="variable">$&#123;WAR_NAME&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 2.è§£å‹&amp;è½¯é“¾æ¥</span></span><br><span class="line">  ssh -p <span class="variable">$&#123;K8S_MATER_PORT&#125;</span> <span class="variable">$&#123;K8S_MATER&#125;</span> <span class="string">"unzip <span class="variable">$&#123;WAR_PATH&#125;</span>/<span class="variable">$&#123;WAR_NAME&#125;</span> -d <span class="variable">$&#123;WAR_DIR&#125;</span> &amp;&amp; \</span></span><br><span class="line"><span class="string">                                         rm -rf <span class="variable">$&#123;WEBROOT_PATH&#125;</span> &amp;&amp; \</span></span><br><span class="line"><span class="string">                                         ln -s <span class="variable">$&#123;WAR_PATH&#125;</span>/<span class="variable">$&#123;WEB_DIR&#125;</span> <span class="variable">$&#123;WEBROOT_PATH&#125;</span> &amp;&amp; \</span></span><br><span class="line"><span class="string">                                         kubectl delete pod -l app=java-maven"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å›é€€</span></span><br><span class="line"><span class="function"><span class="title">rollback</span></span> () &#123;</span><br><span class="line">  History_Version=$(ssh -p <span class="variable">$&#123;K8S_MATER_PORT&#125;</span> <span class="variable">$&#123;K8S_MATER&#125;</span> <span class="string">"find <span class="variable">$&#123;WAR_PATH&#125;</span> -maxdepth 1 -type d -name <span class="variable">$&#123;JOB_NAME&#125;</span>-*-<span class="variable">$&#123;git_version&#125;</span>"</span>)</span><br><span class="line">  ssh -p <span class="variable">$&#123;K8S_MATER_PORT&#125;</span> <span class="variable">$&#123;K8S_MATER&#125;</span> <span class="string">"rm -rf <span class="variable">$&#123;WEBROOT_PATH&#125;</span> &amp;&amp; \</span></span><br><span class="line"><span class="string">                                         ln -s <span class="variable">$&#123;History_Version&#125;</span> <span class="variable">$&#123;WEBROOT_PATH&#125;</span> &amp;&amp; \</span></span><br><span class="line"><span class="string">                                         kubectl delete pod -l app=java-maven"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡éƒ¨ç½²</span></span><br><span class="line"><span class="function"><span class="title">redeploy</span></span> () &#123;</span><br><span class="line">  <span class="comment"># å¦‚æœæ˜¯ä»¥å‰éƒ¨ç½²è¿‡åˆ™åˆ é™¤ä»¥å‰éƒ¨ç½²çš„é¡¹ç›®ç›®å½•,å¦åˆ™é‡æ–°éƒ¨ç½²;</span></span><br><span class="line">  <span class="keyword">if</span> [[ <span class="string">"v<span class="variable">$&#123;GIT_COMMIT&#125;</span>"</span> = <span class="string">"v<span class="variable">$&#123;GIT_PREVIOUS_SUCCESSFUL_COMMIT&#125;</span>"</span> ]];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">"æ›¾ç»éƒ¨ç½²è¿‡ <span class="variable">$&#123;git_version&#125;</span> ç‰ˆæœ¬ï¼Œç°åœ¨æ­£åœ¨é‡æ–°éƒ¨ç½²!"</span></span><br><span class="line">    History_Version=$(ssh -p <span class="variable">$&#123;K8S_MATER_PORT&#125;</span> <span class="variable">$&#123;K8S_MATER&#125;</span> <span class="string">"find <span class="variable">$&#123;WAR_PATH&#125;</span> -maxdepth 1 -type d -name <span class="variable">$&#123;JOB_NAME&#125;</span>-*-<span class="variable">$&#123;git_version&#125;</span>"</span>)</span><br><span class="line">    ssh -p <span class="variable">$&#123;K8S_MATER_PORT&#125;</span> <span class="variable">$&#123;K8S_MATER&#125;</span> <span class="string">"rm -rf <span class="variable">$&#123;History_Version&#125;</span>"</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="comment"># ç‰©ç†å¦‚ä½•éƒ½è¦é‡æ–°éƒ¨ç½²</span></span><br><span class="line">  deploy</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># éƒ¨ç½² &amp; å›é€€ å…¥å£(å‘-==ä¸¤è¾¹æ²¡æœ‰ç©ºæ ¼)</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">"<span class="variable">$&#123;deploy_option&#125;</span>"</span> = <span class="string">"deploy"</span> ]]; <span class="keyword">then</span></span><br><span class="line">  <span class="comment"># å‘ (é˜²æ­¢å­—ç¬¦ä¸²ä¸ºç©º)</span></span><br><span class="line">  <span class="keyword">if</span> [[ <span class="string">"v<span class="variable">$&#123;GIT_COMMIT&#125;</span>"</span> = <span class="string">"v<span class="variable">$&#123;GIT_PREVIOUS_SUCCESSFUL_COMMIT&#125;</span>"</span> ]];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">"æ‚¨å·²ç»éƒ¨ç½²è¿‡ <span class="variable">$&#123;git_version&#125;</span> ç‰ˆæœ¬"</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    deploy</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="string">"<span class="variable">$&#123;deploy_option&#125;</span>"</span> = <span class="string">"rollback"</span> ]];<span class="keyword">then</span></span><br><span class="line">  rollback</span><br><span class="line"><span class="keyword">elif</span> [[ <span class="string">"<span class="variable">$&#123;deploy_option&#125;</span>"</span> = <span class="string">"redeploy"</span> ]];<span class="keyword">then</span> </span><br><span class="line">  redeploy</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">"æ— ä»»ä½•æ“ä½œï¼åœæ­¢æ‰§è¡Œè„šæœ¬"</span></span><br><span class="line">  <span class="built_in">exit</span> 127</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Step 6.ä¿®æ”¹h1æ ‡ç­¾ä¸ºæˆ‘ä»¬çš„é¡¹ç›®æ‰“å‡ ä¸ªTagæ ‡ç­¾ç„¶åPushåˆ°ä»“åº“;</p>
</li>
</ul>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201227095528.png" target="_blank" title="WeiyiGeek.show tags" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201227095528.png" alt="WeiyiGeek.show tags" title="" class=""></a>
                <p>WeiyiGeek.show tags</p>
            </figure>
<ul>
<li>Step 7.éªŒè¯æˆ‘ä»¬çš„æ„å»ºçš„Mavené¡¹ç›®ä»¥åŠæ¨é€æ„å»ºçš„waråˆ°kubernetesé›†ç¾¤ä¹‹ä¸­(æ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»å³å°†åˆ°æ¥);</li>
</ul>
<p>PS: æŸ¥çœ‹ä»»åŠ¡æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ç¡®å®šè„šæœ¬éƒ¨ç½²æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä¹‹åè®¿é—®<code>http://10.10.107.202:30089/</code>æŸ¥çœ‹ç¼–è¯‘çš„warè¿è¡Œåœ¨kunbernetsä¸­éƒ¨ç½²Tomcatåº”ç”¨çš„ç»“æœ;</p>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201227100756.png" target="_blank" title="WeiyiGeek.jenkins-ci-deploy" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201227100756.png" alt="WeiyiGeek.jenkins-ci-deploy" title="" class=""></a>
                <p>WeiyiGeek.jenkins-ci-deploy</p>
            </figure>
<ul>
<li>Step 8.å›æ»šæµ‹è¯• æ„å»ºå‚æ•°: <code>deploy_option-&gt;rollback , git_version -&gt; v1.1</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ„å»ºæ¨é€åé¦ˆ</span></span><br><span class="line">[Maven-HelloWorld] $ /bin/sh -xe /tmp/jenkins6930799554885763742.sh</span><br><span class="line">+ /bin/bash -x /tmp/script/maven-jenkins-ci-script.sh</span><br><span class="line">++ date +%Y%m%d-%H%M%S</span><br><span class="line">+ DATE=20201227-021208</span><br><span class="line">+ WAR_PATH=/nfs/data4/war</span><br><span class="line">+ WEBROOT_PATH=/nfs/data4/webapps</span><br><span class="line">+ WEB_DIR=Maven-HelloWorld-20201227-021208-v1.1</span><br><span class="line">+ WAR_DIR=<span class="string">'/nfs/data4/war/Maven-HelloWorld-20201227-021208-v1.1'</span></span><br><span class="line">+ WAR_NAME=Maven-HelloWorld-20201227-021208-v1.1.war</span><br><span class="line">+ K8S_MATER=weiyigeek@10.10.107.202</span><br><span class="line">+ K8S_MATER_PORT=20211</span><br><span class="line">+ [[ rollback = \d\e\p\l\o\y ]]</span><br><span class="line">+ [[ rollback = \r\o\l\l\b\a\c\k ]]  <span class="comment"># è¿›è¡Œå›æ»šæ“ä½œ</span></span><br><span class="line">+ rollback</span><br><span class="line">++ ssh -p 20211 weiyigeek@10.10.107.202 <span class="string">'find /nfs/data4/war -maxdepth 1 -type d -name Maven-HelloWorld-*-v1.1'</span></span><br><span class="line">**************WARNING**************</span><br><span class="line">Authorized only. All activity will be monitored and reported.</span><br><span class="line">+ History_Version=/nfs/data4/war/Maven-HelloWorld-20201227-020140-v1.1  <span class="comment"># å†å²ç‰ˆæœ¬</span></span><br><span class="line">+ ssh -p 20211 weiyigeek@10.10.107.202 <span class="string">'rm -rf /nfs/data4/webapps &amp;&amp;                                          ln -s /nfs/data4/war/Maven-HelloWorld-20201227-020140-v1.1 /nfs/data4/webapps &amp;&amp;                                          kubectl delete pod -l app=java-maven'</span></span><br><span class="line">**************WARNING**************</span><br><span class="line">Authorized only. All activity will be monitored and reported.</span><br><span class="line">pod <span class="string">"deploy-java-maven-0"</span> deleted</span><br><span class="line">pod <span class="string">"deploy-java-maven-1"</span> deleted</span><br><span class="line">pod <span class="string">"deploy-java-maven-2"</span> deleted</span><br><span class="line">Finished: SUCCESS</span><br><span class="line"></span><br><span class="line"><span class="comment"># åº”ç”¨åé¦ˆ </span></span><br><span class="line">http://10.10.107.202:30089/</span><br><span class="line">  <span class="comment"># Maven - Hello World - v1.1</span></span><br><span class="line">  <span class="comment"># è®¿é—®æ—¶é—´: Sun Dec 27 2020 10:12:18 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)</span></span><br><span class="line">  <span class="comment"># Server : Apache Tomcat/8.5.61 | 10.244.1.203</span></span><br><span class="line">  <span class="comment"># Client : 10.244.0.0 | 10.244.0.0</span></span><br><span class="line">  <span class="comment"># Document_Root : /usr/local/tomcat/webapps/ROOT/</span></span><br><span class="line">  <span class="comment"># URL : 10.10.107.202/index.jsp</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>Step 9.é‡éƒ¨ç½²æµ‹è¯• æ„å»ºå‚æ•°: <code>deploy_option-&gt;redeploy , git_version -&gt; v1.2</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ war ç›®å½•çš„v1.2ç‰ˆæœ¬çš„æ–‡ä»¶ä¸ç›®å½•åç§°</span></span><br><span class="line">/nfs/data4/war$ ls -alh | grep <span class="string">"-v1.2"</span></span><br><span class="line">drwxrwxr-x 4 weiyigeek weiyigeek 4.0K Dec 27 10:09 Maven-HelloWorld-20201227-020939-v1.2</span><br><span class="line">-rw-r--r-- 1 weiyigeek weiyigeek 2.0M Dec 27 10:09 Maven-HelloWorld-20201227-020939-v1.2.war</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) é¡¹ç›®é‡éƒ¨ç½²æ§åˆ¶å°ä¿¡æ¯è¾“å‡º</span></span><br><span class="line">[Maven-HelloWorld] $ /bin/sh -xe /tmp/jenkins8520069315177369772.sh</span><br><span class="line">channel stopped</span><br><span class="line">+ /bin/bash -x /tmp/script/maven-jenkins-ci-script.sh</span><br><span class="line">++ date +%Y%m%d-%H%M%S</span><br><span class="line">+ DATE=20201227-021934</span><br><span class="line">+ WAR_PATH=/nfs/data4/war</span><br><span class="line">+ WEBROOT_PATH=/nfs/data4/webapps</span><br><span class="line">+ WEB_DIR=Maven-HelloWorld-20201227-021934-v1.2</span><br><span class="line">+ WAR_DIR=<span class="string">'/nfs/data4/war/Maven-HelloWorld-20201227-021934-v1.2'</span></span><br><span class="line">+ WAR_NAME=Maven-HelloWorld-20201227-021934-v1.2.war</span><br><span class="line">+ K8S_MATER=weiyigeek@10.10.107.202</span><br><span class="line">+ K8S_MATER_PORT=20211</span><br><span class="line">+ [[ redeploy = \d\e\p\l\o\y ]]</span><br><span class="line">+ [[ redeploy = \r\o\l\l\b\a\c\k ]]</span><br><span class="line">+ [[ redeploy = \r\e\d\e\p\l\o\y ]]</span><br><span class="line">+ redeploy   <span class="comment"># è¿›å…¥äº†é‡éƒ¨ç½²è„šæœ¬é€‰æ‹©</span></span><br><span class="line">+ [[ ve8d88cf3e222b79259edcfb7ca48cee7b079ee08 = \v\e\8\d\8\8\c\f\3\e\2\2\2\b\7\9\2\5\9\e\d\c\f\b\7\c\a\4\8\c\e\e\7\b\0\7\9\e\e\0\8 ]]</span><br><span class="line">+ <span class="built_in">echo</span> -e <span class="string">'æ›¾ç»éƒ¨ç½²è¿‡ v1.2 ç‰ˆæœ¬ï¼Œç°åœ¨æ­£åœ¨é‡æ–°éƒ¨ç½²!'</span></span><br><span class="line">æ›¾ç»éƒ¨ç½²è¿‡ v1.2 ç‰ˆæœ¬ï¼Œç°åœ¨æ­£åœ¨é‡æ–°éƒ¨ç½²!</span><br><span class="line">++ ssh -p 20211 weiyigeek@10.10.107.202 <span class="string">'find /nfs/data4/war -maxdepth 1 -type d -name Maven-HelloWorld-*-v1.2'</span></span><br><span class="line">+ History_Version=/nfs/data4/war/Maven-HelloWorld-20201227-020939-v1.2</span><br><span class="line">+ ssh -p 20211 weiyigeek@10.10.107.202 <span class="string">'rm -rf /nfs/data4/war/Maven-HelloWorld-20201227-020939-v1.2'</span> <span class="comment"># åˆ é™¤äº†åŸæ¥v1.2ç‰ˆæœ¬çš„warè§£å‹ç›®å½•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°æ„å»º</span></span><br><span class="line">+ deploy</span><br><span class="line">+ scp -P 20211 /var/lib/jenkins/workspace/Maven-HelloWorld/target/hello-world.war weiyigeek@10.10.107.202:/nfs/data4/war/Maven-HelloWorld-20201227-021934-v1.2.war</span><br><span class="line"><span class="comment"># è§£å‹ä¸Šä¼ çš„war å¹¶åˆ›å»ºè½¯è¿æ¥</span></span><br><span class="line">+ ssh -p 20211 weiyigeek@10.10.107.202 <span class="string">'unzip /nfs/data4/war/Maven-HelloWorld-20201227-021934-v1.2.war -d  /nfs/data4/war/Maven-HelloWorld-20201227-021934-v1.2 &amp;&amp;                                          rm -rf /nfs/data4/webapps &amp;&amp;                                          ln -s /nfs/data4/war/Maven-HelloWorld-20201227-021934-v1.2 /nfs/data4/webapps &amp;&amp;                                          kubectl delete pod -l app=java-maven'</span></span><br><span class="line">Archive:  /nfs/data4/war/Maven-HelloWorld-20201227-021934-v1.2.war</span><br><span class="line">   creating: /nfs/data4/war/Maven-HelloWorld-20201227-021934-v1.2/META-INF/</span><br><span class="line">....</span><br><span class="line">  inflating: /nfs/data4/war/Maven-HelloWorld-20201227-021934-v1.2/META-INF/maven/com.weiyigeek.main/hello-world/pom.properties  </span><br><span class="line">pod <span class="string">"deploy-java-maven-0"</span> deleted</span><br><span class="line">pod <span class="string">"deploy-java-maven-1"</span> deleted</span><br><span class="line">pod <span class="string">"deploy-java-maven-2"</span> deleted</span><br><span class="line"></span><br><span class="line">Finished: SUCCESS</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) åº”ç”¨åé¦ˆ</span></span><br><span class="line">Maven - Hello World - v1.2</span><br><span class="line">è®¿é—®æ—¶é—´: Sun Dec 27 2020 10:20:03 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)</span><br><span class="line">Server : Apache Tomcat/8.5.61 | 10.244.2.107</span><br><span class="line">Client : 10.244.0.0 | 10.244.0.0</span><br><span class="line">Document_Root : /usr/<span class="built_in">local</span>/tomcat/webapps/ROOT/</span><br><span class="line">URL : 10.10.107.202/index.jsp</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>PS : è‡³æ­¤ Maven ä¸ Jenkins é›†æˆå®è·µå®Œæˆ</p>
<p><strong>è¡¥å……ä»‹ç»: é™¤äº†ä¸Šé¢åœ¨é¡¹ç›®çš„Pom.xmlä¸­è®¾ç½®å†…éƒ¨MavenæœåŠ¡å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å¯ä»¥é‡‡æ ·ä¸‹é¢ä¸¤ç§æ–¹å¼æŒ‡å®šé…ç½®æ–‡ä»¶</strong></p>
<ul>
<li>æ–¹å¼1.é€šè¿‡ curl åœ¨æ„å»ºå‰ä¸‹è½½ Git ç‰ˆæœ¬æ§åˆ¶çš„ Maven è‡ªå®šä¹‰çš„ setting.xml é…ç½®æ–‡ä»¶ï¼ˆåœ¨æˆ‘åé¢K8sä¸­æ„å»ºæ—¶ä¼šçœ‹è§ï¼‰ã€‚</li>
<li>æ–¹å¼2.é‡‡ç”¨ <code>Managed file(å¯ä»¥é…ç½® Maven çš„å…¨å±€é…ç½®æ–‡ä»¶å’Œç”¨æˆ·é…ç½®æ–‡ä»¶)</code> å’Œ <code>Maven Integration</code> æ’ä»¶<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Config File Provider æ’ä»¶ä½¿ç”¨é…ç½®æ–‡ä»¶</span></span><br><span class="line">configFileProvider([configFile(<span class="string">fileId:</span><span class="string">'maven-global-settings'</span>,<span class="string">variable:</span><span class="string">'MAVEN_GLOBAL_ENV'</span>)]) &#123;</span><br><span class="line">  sh <span class="string">"mvn -s $MAVEN_GLOBAL_ENV clean install"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pipeline Maven Integration æ’ä»¶ä½¿ç”¨é…ç½®æ–‡ä»¶</span></span><br><span class="line">withMaven(</span><br><span class="line">  <span class="comment">// Maven installation declared in the Jenkins "Global Tool Configuration"</span></span><br><span class="line"><span class="symbol">  maven:</span> <span class="string">'maven-3'</span>,</span><br><span class="line">  <span class="comment">// Maven settings.xml file defined with the Jenkins Config File Provider Plugin</span></span><br><span class="line">  <span class="comment">// We recommend to define Maven settings.xml globally at the folder level using </span></span><br><span class="line">  <span class="comment">// navigating to the folder configuration in the section "Pipeline Maven Configuration / Override global Maven configuration"</span></span><br><span class="line">  <span class="comment">// or globally to the entire master navigating to  "Manage Jenkins / Global Tools Configuration"</span></span><br><span class="line"><span class="symbol">  mavenSettingsConfig:</span> <span class="string">'my-maven-settings'</span>) &#123;</span><br><span class="line">    <span class="comment">// Run the maven build</span></span><br><span class="line">    sh <span class="string">"mvn clean verify"</span></span><br><span class="line"></span><br><span class="line">  &#125; <span class="comment">// withMaven will discover the generated Maven artifacts, JUnit Surefire &amp; FailSafe &amp; FindBugs &amp; SpotBugs reports...</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h3 id="SonarQube-é›†æˆé…ç½®ä¸å®è·µ"><a href="#SonarQube-é›†æˆé…ç½®ä¸å®è·µ" class="headerlink" title="SonarQube é›†æˆé…ç½®ä¸å®è·µ"></a>SonarQube é›†æˆé…ç½®ä¸å®è·µ</h3><p>æè¿°: åœ¨JenkinsæŒç»­é›†æˆä¸­ä¸­å¯ä»¥åœ¨æ„å»ºä»£ç å‰å¯¹æˆ‘ä»¬é¡¹ç›®è¿›è¡Œä¸€ä¸ªä»£ç è´¨é‡æ‰«ææ£€æµ‹, æ­¤å¤„æˆ‘ä»¬å¼•å…¥SonarQubeè¿›è¡Œå®ç°;</p>
<p><strong>æ“ä½œæµç¨‹:</strong></p>
<ul>
<li><p>Step 0.åœ¨ SonarQube Webä¸­è¿›è¡Œè®¤è¯ Token ç”Ÿæˆï¼š(æ‰‹å·¥è®¾ç½®)_æ·»åŠ é¡¹ç›® -&gt; é¡¹ç›®æ ‡è¯† -&gt; åˆ›å»ºä¸€ä¸ªä»¤ç‰Œ (Jenkins) -&gt;  å¾—åˆ°Token;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Jenkins: 755eeb453cb28f96aa9d4ea14334da7287c2e840</span><br><span class="line"><span class="comment"># æ­¤ä»¤ç‰Œç”¨äºæ‰§è¡Œåˆ†ææ—¶è®¤è¯æ—¶ä½¿ç”¨ï¼Œå¦‚æœè¿™ä¸ªä»¤ç‰Œå­˜åœ¨é—®é¢˜ï¼Œå¯ä»¥éšæ—¶åœ¨ä½ çš„ç”¨æˆ·è´¦å·ä¸‹å–æ¶ˆè¿™ä¸ªä»¤ç‰Œã€‚</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Step 1.æ’ä»¶å®‰è£…: ç³»ç»Ÿç®¡ç† -&gt; æ’ä»¶ç®¡ç† -&gt; <code>SonarQube Scanner for Jenkins</code>ï¼ˆï¼‰</p>
</li>
</ul>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210103122648.png" target="_blank" title="WeiyiGeek.SonarQube Scanner for Jenkins" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210103122648.png" alt="WeiyiGeek.SonarQube Scanner for Jenkins" title="" class=""></a>
                <p>WeiyiGeek.SonarQube Scanner for Jenkins</p>
            </figure>
<ul>
<li>Step 2.åœ¨Jenkinsç³»ç»Ÿç®¡ç†-&gt;ç³»ç»Ÿè®¾ç½®ä»¥åŠå…¨å±€å·¥å…·ç®¡ç†-&gt;ä¸Šé…ç½®SonarQubeç›¸å…³é…ç½®(æœåŠ¡ç«¯åœ°å€ï¼Œä»¥åŠå®¢æˆ·ç«¯å·¥å…·åœ°å€);<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) æœåŠ¡ç«¯</span></span><br><span class="line">Dashboard -&gt; é…ç½® -&gt; SonarQube servers -&gt; Add SonarQube è®¾ç½®åç§°å’ŒSonarQubeåœ°å€ -&gt; æ·»åŠ Tokenå‡­æ®ï¼ˆç±»å‹ï¼šSecret Textï¼‰ -&gt; Jenklins-Connet-Sonarqube-Token</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) å®¢æˆ·ç«¯</span></span><br><span class="line">Dashboard -&gt; å…¨å±€å·¥å…·é…ç½® -&gt; SonarQube Scanner -&gt; åç§°ï¼ˆsonarqube-scannerï¼‰ -&gt; å·¥å…·è·¯å¾„ ï¼ˆ/usr/<span class="built_in">local</span>/sonarï¼‰-&gt; ä¿å­˜åº”ç”¨</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210103124936.png" target="_blank" title="WeiyiGeek.Jenkinsä¸ŠSonarQubeé…ç½®" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210103124936.png" alt="WeiyiGeek.Jenkinsä¸ŠSonarQubeé…ç½®" title="" class=""></a>
                <p>WeiyiGeek.Jenkinsä¸ŠSonarQubeé…ç½®</p>
            </figure>
<ul>
<li><p>Step 3.åº”ç”¨é¡¹ç›®åˆ†æå®æˆ˜åœ¨åˆ†æé¡¹ç›®ä¸­é…ç½®<code>Analysis Properties</code>-&gt;ä¿å­˜å’Œåº”ç”¨-&gt; æ­¤æ—¶é¡¹ç›®ä¸­ä¼šå¤šä¸€ä¸ªSonarQubeçš„å›¾æ ‡;<br>PS : ä¸‹è¿°å›¾ä¸­æœ‰è¯¯åº”è¯¥æ˜¯åœ¨<code>Pre Stepsé˜¶æ®µ(Execute SonarQube Scannerï¼Œå…¶æ¬¡ Build æ„å»ºå³å¯)</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ„å»ºå‰è¿›è¡Œåˆ†æé…ç½®ï¼ˆåç§°ã€å”¯ä¸€æ ‡è¯†ã€æ£€æµ‹ç›®å½•ï¼‰</span></span><br><span class="line">sonar.projectName=<span class="variable">$&#123;JOB_NAME&#125;</span></span><br><span class="line">sonar.projectKey=Jenkis</span><br><span class="line">sonar.source=.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å·²é…ç½®ä¸éœ€è¦äº†</span></span><br><span class="line"><span class="comment"># sonar.host.url=http://sonar.weiyigeek.top:9000 \</span></span><br><span class="line"><span class="comment"># sonar.login=755eeb453cb28f96aa9d4ea14334da7287c2e840</span></span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210103130352.png" target="_blank" title="WeiyiGeek.SonarQube Analysis Properties" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210103130352.png" alt="WeiyiGeek.SonarQube Analysis Properties" title="" class=""></a>
                <p>WeiyiGeek.SonarQube Analysis Properties</p>
            </figure>
</li>
<li><p>Step 4.æ–°å»ºç«‹ä¸€ä¸ªV1.7Tagå¹¶ä¸Šä¼ åˆ°Gitlabä¹‹ä¸­ï¼Œä¹‹åè¿›è¡Œæ£€æµ‹ä¸æ„å»ºæ“ä½œ-&gt;è¿”å›å·¥ç¨‹ç‚¹å‡»SonarQube å›¾æ ‡è¿›è¡Œé¡¹ç›®æ£€æµ‹ç»“æœé¡µé¢;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">WeiyiGeek@WeiyiGeek MINGW64 /e/EclipseProject/hello-world (master)</span><br><span class="line">$ git add .</span><br><span class="line">$ git commit -m <span class="string">"v1.7"</span></span><br><span class="line">  <span class="comment"># [master 0f50b10] v1.7</span></span><br><span class="line">  <span class="comment"># 1 file changed, 1 insertion(+), 1 deletion(-)</span></span><br><span class="line">$ git tag -a <span class="string">"v1.7"</span> -m <span class="string">"v1.7"</span></span><br><span class="line">$ git push</span><br><span class="line">  <span class="comment"># Enumerating objects: 11, done.</span></span><br><span class="line">  <span class="comment"># Counting objects: 100% (11/11), done.</span></span><br><span class="line">  <span class="comment"># .....</span></span><br><span class="line">  <span class="comment"># To http://gitlab.weiyigeek.top/ci-cd/java-maven.git</span></span><br><span class="line">  <span class="comment">#    3bfb942..0f50b10  master -&gt; master</span></span><br><span class="line"></span><br><span class="line">$ git push origin v1.7</span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line">  <span class="comment"># To http://gitlab.weiyigeek.top/ci-cd/java-maven.git</span></span><br><span class="line">  <span class="comment"># * [new tag]         v1.7 -&gt; v1.7</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210103131504.png" target="_blank" title="WeiyiGeek.SonarQubeé¡¹ç›®æ£€æµ‹ç»“æœ" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210103131504.png" alt="WeiyiGeek.SonarQubeé¡¹ç›®æ£€æµ‹ç»“æœ" title="" class=""></a>
                <p>WeiyiGeek.SonarQubeé¡¹ç›®æ£€æµ‹ç»“æœ</p>
            </figure>
<ul>
<li>Step 5.é¡¹ç›®åœ¨K8sé›†ç¾¤ä¸­éƒ¨ç½²ç»“æœ<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://10.10.107.202:30089/</span></span><br><span class="line">Maven - Hello World - v1.7</span><br><span class="line">è®¿é—®æ—¶é—´: Sun Jan 03 2021 13:20:34 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)</span><br><span class="line">Server : Apache Tomcat/8.5.61 | 10.244.2.111</span><br><span class="line">Client : 10.244.0.0 | 10.244.0.0</span><br><span class="line">Document_Root : /usr/<span class="built_in">local</span>/tomcat/webapps/ROOT/</span><br><span class="line">URL : 10.10.107.202/index.jsp</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h3 id="é‚®ç®±-amp-é’‰é’‰-amp-å¾®ä¿¡æ¶ˆæ¯é€šçŸ¥-é›†æˆé…ç½®ä¸å®è·µ"><a href="#é‚®ç®±-amp-é’‰é’‰-amp-å¾®ä¿¡æ¶ˆæ¯é€šçŸ¥-é›†æˆé…ç½®ä¸å®è·µ" class="headerlink" title="é‚®ç®±&amp;é’‰é’‰&amp;å¾®ä¿¡æ¶ˆæ¯é€šçŸ¥ é›†æˆé…ç½®ä¸å®è·µ"></a>é‚®ç®±&amp;é’‰é’‰&amp;å¾®ä¿¡æ¶ˆæ¯é€šçŸ¥ é›†æˆé…ç½®ä¸å®è·µ</h3><p>æè¿°: åœ¨Jenkinsä¸­æˆ‘ä»¬è¿˜æœ‰æœ€é‡è¦çš„ä¸€æ­¥è¿˜æ²¡æœ‰å®Œæˆ, å³æ¶ˆæ¯é€šçŸ¥(è®©æˆ‘ä»¬çŸ¥é“æ˜¯æ„å»ºæˆåŠŸè¿˜æ˜¯ã€æ„å»ºå¤±è´¥)ç­‰ç­‰, å¸¸è§„çš„æ–¹å¼æœ‰é‚®ç®±é€šçŸ¥ã€Shellè‡ªå®šä¹‰è„šæœ¬é€šçŸ¥ï¼ŒWebHooké€šçŸ¥ç­‰;</p>
<p>é€šçŸ¥æ’ä»¶æ’ä»¶å®‰è£…:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DingTalk : é’‰é’‰ Jenkins æ’ä»¶ 2.4.3 (https://github.com/jenkinsci/dingtalk-plugin)</span><br><span class="line">Qy Wechat Notification Plugin : è¿™ä¸ªæ’ä»¶æ˜¯ä¸€ä¸ªæœºå™¨äººï¼Œå¯ä»¥å‘å¸ƒæ„å»ºçŠ¶æ€å’Œå‘é€æ¶ˆæ¯ç»™qyå¾®ä¿¡. 1.0.2	 ï¼ˆhttps://www.jenkins.io/doc/pipeline/steps/qy-wechat-notification/ï¼‰</span><br></pre></td></tr></table></figure></p>
<p><strong>(0) é‚®ç®±é€šçŸ¥å®è·µé…ç½®</strong><br>æè¿°: æ­¤å¤„ä»¥è…¾è®¯ä¼ä¸šé‚®ç®±ä¸ºä¾‹è¿›è¡Œé…ç½®,é¦–å…ˆéœ€è¦ç™»é™†å°†è¦è¢«ä½¿ç”¨çš„é‚®ç®±ï¼Œæ³¨æ„<code>å¿…é¡»è¦ä½¿ç”¨å¾®ä¿¡ç»‘å®šåæ‰èƒ½æ­£å¸¸ç”Ÿæˆå®¢æˆ·ç«¯ä¸“ç”¨å¯†ç </code>ï¼Œç„¶åå¼€å¯SMTPæœåŠ¡;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®¢æˆ·ç«¯è®¾ç½®æ–¹æ³•</span></span><br><span class="line">æ¥æ”¶æœåŠ¡å™¨ï¼š</span><br><span class="line">imap.exmail.qq.com(ä½¿ç”¨SSLï¼Œç«¯å£å·993)</span><br><span class="line">å‘é€æœåŠ¡å™¨ï¼š</span><br><span class="line">smtp.exmail.qq.com(ä½¿ç”¨SSLï¼Œç«¯å£å·465)</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210104230227.png" target="_blank" title="WeiyiGeek.è…¾è®¯ä¼ä¸šé‚®ç®±" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210104230227.png" alt="WeiyiGeek.è…¾è®¯ä¼ä¸šé‚®ç®±" title="" class=""></a>
                <p>WeiyiGeek.è…¾è®¯ä¼ä¸šé‚®ç®±</p>
            </figure>
<p>Step 1.åœ¨ <code>Dashboard -&gt; ç³»ç»Ÿé…ç½® -&gt; Jenkins Location</code>è¿›è¡Œé…ç½®ç³»ç»Ÿç®¡ç†å‘˜é‚®ä»¶åœ°å€ï¼Œæ³¨æ„æ­¤å¤„ç®¡ç†å‘˜é‚®ç®±åœ°å€å¿…é¡»ä¸smtpæœåŠ¡å‘ä¿¡åœ°å€ä¸€è‡´å¦åˆ™å°†ä¼šæŠ¥å‡º<code>501 mail from address must be same as authorization user</code>é”™è¯¯;</p>
<p>Step 2.è®¾ç½®å‘ä¿¡é‚®ç®±ç›¸å…³é…ç½®ï¼Œç‚¹å‡» <code>Dashboard -&gt; ç³»ç»Ÿé…ç½® -&gt; é‚®ä»¶é€šçŸ¥</code> å¡«å…¥ SMTP å‘ä¿¡æœåŠ¡å™¨åœ°å€ä»¥åŠä¼ä¸šé‚®ç®±åç¼€ï¼Œé‡‡ç”¨SSLåè®®å¹¶è¾“å…¥è®¤è¯çš„è´¦å·ä¸å®¢æˆ·ç«¯ä¸“ç”¨å¯†ç ï¼Œæœ€åæµ‹è¯•å‘ä¿¡;</p>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210106214943.png" target="_blank" title="WeiyiGeek.å‘ä¿¡é‚®ç®±ç›¸å…³é…ç½®" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210106214943.png" alt="WeiyiGeek.å‘ä¿¡é‚®ç®±ç›¸å…³é…ç½®" title="" class=""></a>
                <p>WeiyiGeek.å‘ä¿¡é‚®ç®±ç›¸å…³é…ç½®</p>
            </figure>
<p>Step 3.æ„å»ºé¡¹ç›®é€šä¿¡å‘ä¿¡æµ‹è¯•ï¼Œç‚¹å‡» <code>Dashboard -&gt; Maven-HelloWorld -&gt; æ„å»ºè®¾ç½® -&gt; å¯ç”¨E-mail Notification</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ”¶ä¿¡äººï¼šRecipients</span></span><br><span class="line"><span class="comment"># ä»€ä¹ˆåœºæ™¯å‘é€ä¿¡æ¯:</span></span><br><span class="line">- æ„å»ºå¤±è´¥ç»™æ¯ä¸€ä¸ªäººå‘é€å‘é€ç”µå­é‚®ä»¶ : Send e-mail <span class="keyword">for</span> every unstable build</span><br><span class="line">- è°æ„å»ºå¤±è´¥ç»™è°å‘é€é‚®ä»¶: Send separate e-mails to individuals who broke the build</span><br><span class="line">- ä¸ºæ¯ä¸ªå¤±è´¥çš„æ¨¡å—å‘é€ç”µå­é‚®ä»¶ : Send e-mail <span class="keyword">for</span> each failed module</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210106220944.png" target="_blank" title="WeiyiGeek.é¡¹ç›®é€šä¿¡å‘ä¿¡æµ‹è¯•" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210106220944.png" alt="WeiyiGeek.é¡¹ç›®é€šä¿¡å‘ä¿¡æµ‹è¯•" title="" class=""></a>
                <p>WeiyiGeek.é¡¹ç›®é€šä¿¡å‘ä¿¡æµ‹è¯•</p>
            </figure>
<p><strong>è¡¥å……æ–¹å¼ï¼š</strong><br>æè¿°: ç”±äºJenkinsè‡ªå¸¦çš„é‚®ä»¶åŠŸèƒ½æ¯”è¾ƒé¸¡è‚‹ï¼Œå› æ­¤è¿™é‡Œæ¨èå®‰è£…ä¸“é—¨çš„é‚®ä»¶æ’ä»¶(<code>Email Extension</code>)å¹¶ä»‹ç»å¦‚ä½•é…ç½®Jenkinsè‡ªå¸¦çš„é‚®ä»¶åŠŸèƒ½ä½œç”¨ã€‚</p>
<p>æ’ä»¶å®‰è£…: ç³»ç»Ÿç®¡ç†â†’ç®¡ç†æ’ä»¶â†’å¯é€‰æ’ä»¶é€‰æ‹©<code>Email Extension Plugin</code>æ’ä»¶è¿›è¡Œå®‰è£…<br>ç³»ç»Ÿè®¾ç½®:</p>
<ul>
<li>1) é€šè¿‡ç³»ç»Ÿç®¡ç†â†’ç³»ç»Ÿè®¾ç½®ï¼Œè¿›è¡Œé‚®ä»¶é…ç½® -&gt; Extended E-mail Notification -&gt; è¾“å…¥ SMTP Server ç›¸å…³ä¿¡æ¯ä»¥åŠAuthenticationç›¸å…³è®¾ç½®(<code>æ³¨æ„:å¯†ç ä¸€èˆ¬æ˜¯é‚®ç®±æˆæƒç </code>)</li>
<li>2) è®¾ç½®å…¶ç¼–ç æ ¼å¼ä»¥åŠé»˜è®¤å†…å®¹ç±»å‹ï¼Œä»¥åŠé‚®ä»¶æ¨¡æ¿é…ç½®åœ¨ Extended E-mailçš„ default content -;<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ^\s*(?=\r?$)\n æ­£åˆ™æ›¿æ¢ç©ºè¡Œ --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>$&#123;ENV, var="JOB_NAME"&#125;-ç¬¬$&#123;BUILD_NUMBER&#125;æ¬¡æ„å»ºæ—¥å¿—<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">leftmargin</span>=<span class="string">"8"</span> <span class="attr">marginwidth</span>=<span class="string">"0"</span> <span class="attr">topmargin</span>=<span class="string">"8"</span> <span class="attr">marginheight</span>=<span class="string">"4"</span> <span class="attr">offset</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">"95%"</span> <span class="attr">cellpadding</span>=<span class="string">"0"</span> <span class="attr">cellspacing</span>=<span class="string">"0"</span> <span class="attr">style</span>=<span class="string">"font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>(æœ¬é‚®ä»¶ç”±ç¨‹åºè‡ªåŠ¨ä¸‹å‘ï¼Œè¯·å‹¿å›å¤ï¼)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"#FF0000"</span>&gt;</span>æ„å»ºç»“æœ - $&#123;BUILD_STATUS&#125;<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"#0B610B"</span>&gt;</span>æ„å»ºä¿¡æ¯<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">hr</span> <span class="attr">size</span>=<span class="string">"2"</span> <span class="attr">width</span>=<span class="string">"100%"</span> <span class="attr">align</span>=<span class="string">"center"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;PROJECT_URL&#125;"</span>&gt;</span>$&#123;PROJECT_URL&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span>é¡¹ç›®åç§°ï¼š$&#123;PROJECT_NAME&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span>GITè·¯å¾„ï¼š<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;GIT_URL&#125;"</span>&gt;</span>$&#123;GIT_URL&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span>                   </span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span>æ„å»ºç¼–å·ï¼š$&#123;BUILD_NUMBER&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span>                   </span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span>è§¦å‘åŸå› ï¼š$&#123;CAUSE&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span>  </span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span>æ„å»ºæ—¥å¿—ï¼š<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;BUILD_URL&#125;console"</span>&gt;</span>$&#123;BUILD_URL&#125;console<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"#0B610B"</span>&gt;</span>å˜æ›´ä¿¡æ¯:<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">hr</span> <span class="attr">size</span>=<span class="string">"2"</span> <span class="attr">width</span>=<span class="string">"100%"</span> <span class="attr">align</span>=<span class="string">"center"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span>ä¸Šæ¬¡æ„å»ºæˆåŠŸåå˜åŒ– :  $&#123;CHANGES_SINCE_LAST_SUCCESS&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span>ä¸Šæ¬¡æ„å»ºä¸ç¨³å®šåå˜åŒ– :  $&#123;CHANGES_SINCE_LAST_UNSTABLE&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span>å†å²å˜æ›´è®°å½• : <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;PROJECT_URL&#125;changes"</span>&gt;</span>$&#123;PROJECT_URL&#125;changes<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span>å˜æ›´é›†:$&#123;JELLY_SCRIPT,template="html"&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        &lt;tr&gt;</span></span><br><span class="line"><span class="comment">            &lt;td&gt;</span></span><br><span class="line"><span class="comment">                &lt;b&gt;&lt;font color="#0B610B"&gt;Failed Test Results&lt;/font&gt;&lt;/b&gt;</span></span><br><span class="line"><span class="comment">                &lt;hr size="2" width="100%" align="center" /&gt;</span></span><br><span class="line"><span class="comment">            &lt;/td&gt;</span></span><br><span class="line"><span class="comment">        &lt;/tr&gt;</span></span><br><span class="line"><span class="comment">        &lt;tr&gt;</span></span><br><span class="line"><span class="comment">            &lt;td&gt;</span></span><br><span class="line"><span class="comment">                &lt;pre style="font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif"&gt;$FAILED_TESTS&lt;/pre&gt;</span></span><br><span class="line"><span class="comment">                &lt;br /&gt;</span></span><br><span class="line"><span class="comment">            &lt;/td&gt;</span></span><br><span class="line"><span class="comment">        &lt;/tr&gt;</span></span><br><span class="line"><span class="comment">        &lt;tr&gt;</span></span><br><span class="line"><span class="comment">            &lt;td&gt;</span></span><br><span class="line"><span class="comment">                &lt;b&gt;&lt;font color="#0B610B"&gt;æ„å»ºæ—¥å¿— (æœ€å 100è¡Œ):&lt;/font&gt;&lt;/b&gt;</span></span><br><span class="line"><span class="comment">                &lt;hr size="2" width="100%" align="center" /&gt;</span></span><br><span class="line"><span class="comment">            &lt;/td&gt;</span></span><br><span class="line"><span class="comment">        &lt;/tr&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;tr&gt;</span></span><br><span class="line"><span class="comment">            &lt;td&gt;Test Logs (if test has ran): &lt;a</span></span><br><span class="line"><span class="comment">                href="$&#123;PROJECT_URL&#125;ws/TestResult/archive_logs/Log-Build-$&#123;BUILD_NUMBER&#125;.zip"&gt;$&#123;PROJECT_URL&#125;/ws/TestResult/archive_logs/Log-Build-$&#123;BUILD_NUMBER&#125;.zip&lt;/a&gt;</span></span><br><span class="line"><span class="comment">                &lt;br /&gt;</span></span><br><span class="line"><span class="comment">            &lt;br /&gt;</span></span><br><span class="line"><span class="comment">            &lt;/td&gt;</span></span><br><span class="line"><span class="comment">        &lt;/tr&gt; --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        &lt;tr&gt;</span></span><br><span class="line"><span class="comment">            &lt;td&gt;</span></span><br><span class="line"><span class="comment">                &lt;textarea cols="80" rows="30" readonly="readonly" style="font-family: Courier New"&gt;$&#123;BUILD_LOG, maxLines=100,escapeHtml=true&#125;&lt;/textarea&gt;</span></span><br><span class="line"><span class="comment">            &lt;/td&gt;</span></span><br><span class="line"><span class="comment">        &lt;/tr&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span> <span class="attr">size</span>=<span class="string">"2"</span> <span class="attr">width</span>=<span class="string">"100%"</span> <span class="attr">align</span>=<span class="string">"center"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>3) è®¾ç½®<code>Default Triggers</code>è§¦å‘æœºåˆ¶,ä¾‹å¦‚ä¸‹é¢æ˜¯å¤±è´¥æ—¶å€™å’ŒæˆåŠŸæ—¶å€™å‘é€;</li>
</ul>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210126165150.png" target="_blank" title="WeiyiGeek.è®¾ç½®" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210126165150.png" alt="WeiyiGeek.è®¾ç½®" title="" class=""></a>
                <p>WeiyiGeek.è®¾ç½®</p>
            </figure>
<ul>
<li>4) åœ¨Jobä»»åŠ¡è°ƒç”¨ä¸­é€‰æ‹©æ„å»ºåæ“ä½œè¿›è¡Œè®¾ç½®<code>Email Notification</code>è¿›è¡Œè®¾ç½®é€šçŸ¥</li>
</ul>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210126170205.png" target="_blank" title="WeiyiGeek.Email-Notification" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210126170205.png" alt="WeiyiGeek.Email-Notification" title="" class=""></a>
                <p>WeiyiGeek.Email-Notification</p>
            </figure>
<p><br></p>
<p><strong>(1) é’‰é’‰æ¶ˆæ¯é€šçŸ¥å®è·µé…ç½®</strong><br>Step 0.åœ¨é’‰é’‰ä¸­å»ºç«‹ä¸€ä¸ªç¾¤èŠå¹¶ä¸”åˆ›å»ºä¸€ä¸ªç¾¤æœºå™¨äººç”Ÿæˆä¸€ä¸ªWebhookåœ°å€ï¼Œæ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤º:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¾‹å¦‚ï¼šhttps://oapi.dingtalk.com/robot/send?access_token=95f707645db08794166ed3aad3eaad363bb1475bf7c91635b7456a0a8c8893c6</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210104233800.png" target="_blank" title="WeiyiGeek.é’‰é’‰ç¾¤èŠæœºå™¨äººæ·»åŠ " data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210104233800.png" alt="WeiyiGeek.é’‰é’‰ç¾¤èŠæœºå™¨äººæ·»åŠ " title="" class=""></a>
                <p>WeiyiGeek.é’‰é’‰ç¾¤èŠæœºå™¨äººæ·»åŠ </p>
            </figure></p>
<p>Step 1.è®¾ç½®é’‰é’‰æ¶ˆæ¯é€šçŸ¥å‚æ•°, ç‚¹å‡» <code>Dashboard -&gt; ç³»ç»Ÿé…ç½® -&gt; é’‰é’‰</code> é€‰æ‹©é€šçŸ¥æ—¶æœºä»¥åŠä»£ç†é€šä¿¡(<code>å½“è¯¥ä¸»æœºæ— æ³•æ­£å¸¸è¿æ¥ç½‘ç»œæ—¶å¯é‡‡ç”¨æ­¤æ–¹æ³•</code>) -&gt; ç‚¹å‡»æ–°å¢(å¡«å…¥å”¯ä¸€çš„idã€ä»¥åŠåç§°å’Œwebhookåœ°å€ï¼Œæ³¨æ„<code>å¦‚æœåœ¨åˆ›å»ºæœºå™¨äººæ—¶æŒ‡å®šäº†å…³é”®å­—å’ŒåŠ å¯†å­—ç¬¦ä¸²éœ€è¦å¡«å†™ä¸Š</code>)-&gt;ç„¶åæµ‹è¯•å‘ä¿¡;</p>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210104234716.png" target="_blank" title="WeiyiGeek.é’‰é’‰æ¶ˆæ¯é€šçŸ¥å‚æ•°" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210104234716.png" alt="WeiyiGeek.é’‰é’‰æ¶ˆæ¯é€šçŸ¥å‚æ•°" title="" class=""></a>
                <p>WeiyiGeek.é’‰é’‰æ¶ˆæ¯é€šçŸ¥å‚æ•°</p>
            </figure>
<p>Step 2.åœ¨FreeStyleé£æ ¼çš„é¡¹ç›®æ˜¯å¯ä»¥åœ¨é€šç”¨è®¾ç½®å¡ç‚¹é€‰é’‰é’‰æ¶ˆæ¯é€šçŸ¥çš„ï¼Œè€ŒMavençš„é¡¹ç›®æ˜¯æ²¡æœ‰è¯¥ç‚¹é€‰é€‰é¡¹ï¼Œå› ä¸º<code>è¯¥æ’ä»¶åªæ”¯æŒFreeStyleå’ŒPIPELINEæµæ°´çº¿</code>(è¿™é‡Œæœ‰å·¨å‘æ‰€ä»¥æœ‰çš„æ—¶å€™è¿˜æ˜¯è€ç‰ˆæœ¬çš„æ’ä»¶å¥½ç”¨)ï¼Œæ³¨æ„ç½‘ä¸Šåšå®¢ä¸­å…³äºå¤§å¤šæ•°æ­¤é—®é¢˜éƒ½æ˜¯ä¸é€‚ç”¨çš„å®˜æ–¹æ–‡æ¡£æ‰æ˜¯ç¬¬ä¸€æ‰‹;</p>
<p>å‚è€ƒè¿æ¥: <a href="https://jenkinsci.github.io/dingtalk-plugin/examples/freestyleAdvanced.html#%E8%AF%A6%E7%BB%86%E6%97%A5%E5%BF%97" target="_blank" rel="noopener">https://jenkinsci.github.io/dingtalk-plugin/examples/freestyleAdvanced.html#%E8%AF%A6%E7%BB%86%E6%97%A5%E5%BF%97</a></p>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210105002140.png" target="_blank" title="WeiyiGeek.FreeStyleé£æ ¼æ„å»ºçš„é’‰é’‰é€šçŸ¥" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210105002140.png" alt="WeiyiGeek.FreeStyleé£æ ¼æ„å»ºçš„é’‰é’‰é€šçŸ¥" title="" class=""></a>
                <p>WeiyiGeek.FreeStyleé£æ ¼æ„å»ºçš„é’‰é’‰é€šçŸ¥</p>
            </figure>
<p>PS : å¯¹äºå…¶å®ƒé¡¹ç›®é£æ ¼çš„é¡¹ç›®åœ¨åé¢æˆ‘ä»¬å°†ä½¿ç”¨æµæ°´çº¿PIPElineè¿›è¡Œå®ç°é’‰é’‰çš„æ¶ˆæ¯é€šçŸ¥ï¼› </p>
<p><br/></p>
<p><strong>(2) ä¼ä¸šå¾®ä¿¡é€šçŸ¥å®è·µé…ç½®</strong></p>
<ul>
<li>Step 1.è®¾ç½®ä¼ä¸šå¾®ä¿¡é€šçŸ¥å…¨å±€å‚æ•°ï¼Œç‚¹å‡» <code>Dashboard -&gt; ç³»ç»Ÿé…ç½® -&gt; ä¼ä¸šå¾®ä¿¡é€šçŸ¥é…ç½®</code>è®¾ç½®æ„å»ºç¯å¢ƒåç§°(ä¼šåœ¨ä¿¡æ¯ä¸­æ˜¾ç¤º)ä»¥åŠé»˜è®¤Webhookåœ°å€(å…¨å±€çš„)ã€é€šçŸ¥ç”¨æˆ·çš„Uid(@ALLè¡¨ç¤ºå…¨éƒ¨)</li>
</ul>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210104223609.png" target="_blank" title="WeiyiGeek.ä¼ä¸šå¾®ä¿¡å…¨å±€å‚æ•°" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210104223609.png" alt="WeiyiGeek.ä¼ä¸šå¾®ä¿¡å…¨å±€å‚æ•°" title="" class=""></a>
                <p>WeiyiGeek.ä¼ä¸šå¾®ä¿¡å…¨å±€å‚æ•°</p>
            </figure>
<ul>
<li><p>Step 2.åœ¨æ„å»ºä»»åŠ¡ä¸­è®¾ç½®ç›¸åº”çš„é€šçŸ¥å‚æ•°ï¼Œç‚¹å‡» <code>Dashboard -&gt; Maven-HelloWorld(é¡¹ç›®åç§°) -&gt; æ„å»ºåçš„æ“ä½œ -&gt; é€‰æ‹©ä¼ä¸šå¾®ä¿¡</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PS:æ­¤å¤„è¾“å…¥çš„Webhookä¼˜å…ˆçº§é«˜äºå…¨å±€çš„ä¼ä¸šå¾®ä¿¡Webhookè¿™æ ·åšçš„å¥½å¤„æ˜¯ä¾¿äºä¸ºæ¯ä¸ªä»»åŠ¡åˆ†é…ä¸åŒçš„Webhook;</span></span><br><span class="line">Webhookåœ°å€: https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=c222f3fc-f645-440a-ad24-0ce8d9626f11</span><br><span class="line">æƒ…å†µé€šçŸ¥:</span><br><span class="line">  ä»…å¤±è´¥æ‰@</span><br><span class="line">  å‘é€å¼€å§‹æ„å»ºä¿¡æ¯</span><br><span class="line">  ä»…å¤±è´¥æ‰å‘é€</span><br><span class="line">  ä»…æˆåŠŸæ‰å‘é€</span><br><span class="line">  ä»…æ„å»ºä¸­æ–­æ‰å‘é€</span><br><span class="line">  ä»…ä¸ç¨³å®šæ„å»ºæ‰å‘é€</span><br><span class="line">é€šçŸ¥UserID: @ALL</span><br><span class="line">é€šçŸ¥æ‰‹æœºå·ç : é€‰å¡«</span><br></pre></td></tr></table></figure>
</li>
<li><p>Step 3.å¯¹ <code>Maven-HelloWorld</code> é¡¹ç›®è¿›è¡Œæ„å»ºå¹¶æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º,æ¶ˆæ¯æ¨é€;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ„å»ºå‰å‘é€</span></span><br><span class="line">&gt; git config core.sparsecheckout <span class="comment"># timeout=10</span></span><br><span class="line">&gt; git checkout -f e8d88cf3e222b79259edcfb7ca48cee7b079ee08 <span class="comment"># timeout=10</span></span><br><span class="line">Commit message: <span class="string">"v1.2"</span></span><br><span class="line">&gt; git rev-list --no-walk e8d88cf3e222b79259edcfb7ca48cee7b079ee08 <span class="comment"># timeout=10</span></span><br><span class="line">æ¨é€é€šçŸ¥ &#123;<span class="string">"markdown"</span>:&#123;<span class="string">"content"</span>:<span class="string">"Jenkins-Notify&lt;font color=\"info\"&gt;ã€Maven-HelloWorldã€‘&lt;\/font&gt;å¼€å§‹æ„å»º\n &gt;æ„å»ºå‚æ•°ï¼š&lt;font color=\"comment\"&gt;git_version=v1.2, deploy_option=rollback &lt;\/font&gt;\n &gt;é¢„è®¡ç”¨æ—¶ï¼š&lt;font color=\"comment\"&gt;0åˆ†é’Ÿ&lt;\/font&gt;\n &gt;[æŸ¥çœ‹æ§åˆ¶å°](http://jenkins.weiyigeek.top:8080/job/Maven-HelloWorld/16/console)"</span>&#125;,<span class="string">"msgtype"</span>:<span class="string">"markdown"</span>&#125;</span><br><span class="line">é€šçŸ¥ç»“æœ &#123;<span class="string">"errcode"</span>:0,<span class="string">"errmsg"</span>:<span class="string">"ok"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºéƒ¨ç½²åå‘é€</span></span><br><span class="line">+ ssh -p 20211 weiyigeek@10.10.107.202 <span class="string">'rm -rf /nfs/data4/webapps &amp;&amp;  ln -s /nfs/data4/war/Maven-HelloWorld-20201227-021934-v1.2 /nfs/data4/webapps &amp;&amp; kubectl delete pod -l app=java-maven'</span></span><br><span class="line">**************WARNING**************</span><br><span class="line">Authorized only. All activity will be monitored and reported.</span><br><span class="line">pod <span class="string">"deploy-java-maven-0"</span> deleted</span><br><span class="line">pod <span class="string">"deploy-java-maven-1"</span> deleted</span><br><span class="line">pod <span class="string">"deploy-java-maven-2"</span> deleted</span><br><span class="line">æ¨é€é€šçŸ¥&#123;<span class="string">"markdown"</span>:&#123;<span class="string">"content"</span>:<span class="string">"Jenkins-Notify&lt;font color=\"info\"&gt;ã€Maven-HelloWorldã€‘&lt;\/font&gt;æ„å»º&lt;font color=\"info\"&gt;æˆåŠŸ~&lt;\/font&gt;ğŸ‘Œ\n &gt;æ„å»ºç”¨æ—¶ï¼š&lt;font color=\"comment\"&gt;28 sec&lt;\/font&gt;\n &gt;[æŸ¥çœ‹æ§åˆ¶å°](http://jenkins.weiyigeek.top:8080/job/Maven-HelloWorld/16/console)"</span>&#125;,<span class="string">"msgtype"</span>:<span class="string">"markdown"</span>&#125;</span><br><span class="line">é€šçŸ¥ç»“æœ&#123;<span class="string">"errcode"</span>:0,<span class="string">"errmsg"</span>:<span class="string">"ok"</span>&#125;</span><br><span class="line">é¡¹ç›®è¿è¡Œç»“æœ[SUCCESS]</span><br><span class="line">Finished: SUCCESS</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210104223053.png" target="_blank" title="WeiyiGeek.ä¼ä¸šå¾®ä¿¡é€šçŸ¥å®ç°æ•ˆæœ" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20210104223053.png" alt="WeiyiGeek.ä¼ä¸šå¾®ä¿¡é€šçŸ¥å®ç°æ•ˆæœ" title="" class=""></a>
                <p>WeiyiGeek.ä¼ä¸šå¾®ä¿¡é€šçŸ¥å®ç°æ•ˆæœ</p>
            </figure>
<hr>
<h2 id="0x05-è¡¥å……è¯´æ˜"><a href="#0x05-è¡¥å……è¯´æ˜" class="headerlink" title="0x05 è¡¥å……è¯´æ˜"></a>0x05 è¡¥å……è¯´æ˜</h2><h3 id="1-å†…ç½®ç¯å¢ƒå˜é‡"><a href="#1-å†…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="(1) å†…ç½®ç¯å¢ƒå˜é‡"></a>(1) å†…ç½®ç¯å¢ƒå˜é‡</h3><p>PS : Jenkins é»˜è®¤çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ <a href="http://jenkins.weiyigeek.top:8080/env-vars.html/" target="_blank" rel="noopener">http://jenkins.weiyigeek.top:8080/env-vars.html/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">BUILD_NUMBER </span><br><span class="line">    <span class="comment">#The current build number, such as "153"</span></span><br><span class="line">BUILD_ID</span><br><span class="line">    <span class="comment"># The current build ID, identical to BUILD_NUMBER for builds created in 1.597+, but a YYYY-MM-DD_hh-mm-ss timestamp for older builds</span></span><br><span class="line">BUILD_DISPLAY_NAME</span><br><span class="line">    <span class="comment"># The display name of the current build, which is something like "#153" by default.</span></span><br><span class="line">JOB_NAME</span><br><span class="line">    <span class="comment"># Name of the project of this build, such as "foo" or "foo/bar".</span></span><br><span class="line">JOB_BASE_NAME</span><br><span class="line">    <span class="comment"># Short Name of the project of this build stripping off folder paths, such as "foo" for "bar/foo".</span></span><br><span class="line">BUILD_TAG</span><br><span class="line">    <span class="comment"># String of "jenkins-$&#123;JOB_NAME&#125;-$&#123;BUILD_NUMBER&#125;". All forward slashes ("/") in the JOB_NAME are replaced with dashes ("-"). Convenient to put into a resource file, a jar file, etc for easier identification.</span></span><br><span class="line">EXECUTOR_NUMBER</span><br><span class="line">    <span class="comment"># The unique number that identifies the current executor (among executors of the same machine) thatâ€™s carrying out this build. This is the number you see in the "build executor status", except that the number starts from 0, not 1.</span></span><br><span class="line">NODE_NAME</span><br><span class="line">    <span class="comment"># Name of the agent if the build is on an agent, or "master" if run on master</span></span><br><span class="line">NODE_LABELS</span><br><span class="line">    <span class="comment"># Whitespace-separated list of labels that the node is assigned.</span></span><br><span class="line">WORKSPACE</span><br><span class="line">    <span class="comment"># The absolute path of the directory assigned to the build as a workspace.</span></span><br><span class="line">WORKSPACE_TMP</span><br><span class="line">    <span class="comment"># A temporary directory near the workspace that will not be browsable and will not interfere with SCM checkouts. May not initially exist, so be sure to create the directory as needed (e.g., mkdir -p on Linux). Not defined when the regular workspace is a drive root.</span></span><br><span class="line">JENKINS_HOME</span><br><span class="line">    <span class="comment"># The absolute path of the directory assigned on the master node for Jenkins to store data.</span></span><br><span class="line">JENKINS_URL</span><br><span class="line">    <span class="comment"># Full URL of Jenkins, like http://server:port/jenkins/ (note: only available if Jenkins URL set in system configuration)</span></span><br><span class="line">BUILD_URL</span><br><span class="line">    <span class="comment"># Full URL of this build, like http://server:port/jenkins/job/foo/15/ (Jenkins URL must be set)</span></span><br><span class="line">JOB_URL</span><br><span class="line">    <span class="comment"># Full URL of this job, like http://server:port/jenkins/job/foo/ (Jenkins URL must be set)</span></span><br><span class="line">GIT_COMMIT</span><br><span class="line">    <span class="comment"># The commit hash being checked out.</span></span><br><span class="line">GIT_PREVIOUS_COMMIT</span><br><span class="line">    <span class="comment"># The hash of the commit last built on this branch, if any.</span></span><br><span class="line">GIT_PREVIOUS_SUCCESSFUL_COMMIT</span><br><span class="line">    <span class="comment"># The hash of the commit last successfully built on this branch, if any.</span></span><br><span class="line">GIT_BRANCH</span><br><span class="line">    <span class="comment"># The remote branch name, if any.</span></span><br><span class="line">GIT_LOCAL_BRANCH</span><br><span class="line">    <span class="comment"># The local branch name being checked out, if applicable.</span></span><br><span class="line">GIT_CHECKOUT_DIR</span><br><span class="line">    <span class="comment"># The directory that the repository will be checked out to. This contains the value set in Checkout to a sub-directory, if used.</span></span><br><span class="line">GIT_URL</span><br><span class="line">    <span class="comment"># The remote URL. If there are multiple, will be GIT_URL_1, GIT_URL_2, etc.</span></span><br><span class="line">GIT_COMMITTER_NAME</span><br><span class="line">    <span class="comment"># The configured Git committer name, if any, that will be used for FUTURE commits from the current workspace. It is read from the Global Config user.name Value field of the Jenkins Configure System page.</span></span><br><span class="line">GIT_AUTHOR_NAME</span><br><span class="line">    <span class="comment"># The configured Git author name, if any, that will be used for FUTURE commits from the current workspace. It is read from the Global Config user.name Value field of the Jenkins Configure System page.</span></span><br><span class="line">GIT_COMMITTER_EMAIL</span><br><span class="line">    <span class="comment"># The configured Git committer email, if any, that will be used for FUTURE commits from the current workspace. It is read from the Global Config user.email Value field of the Jenkins Configure System page.</span></span><br><span class="line">GIT_AUTHOR_EMAIL</span><br><span class="line">    <span class="comment"># The configured Git author email, if any, that will be used for FUTURE commits from the current workspace. It is read from the Global Config user.email Value field of the Jenkins Configure System page.</span></span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ç¯å¢ƒå˜é‡:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> BUILD_NUMBER: <span class="variable">$&#123;BUILD_NUMBER &#125;</span></span><br><span class="line">    </span><br><span class="line"><span class="built_in">echo</span> BUILD_ID: <span class="variable">$&#123;BUILD_ID&#125;</span></span><br><span class="line">  </span><br><span class="line"><span class="built_in">echo</span> BUILD_DISPLAY_NAME: <span class="variable">$BUILD_DISPLAY_NAME</span>:</span><br><span class="line">  </span><br><span class="line"><span class="built_in">echo</span> JOB_NAME: <span class="variable">$JOB_NAME</span></span><br><span class="line">    </span><br><span class="line"><span class="built_in">echo</span> JOB_BASE_NAME: <span class="variable">$JOB_BASE_NAME</span></span><br><span class="line">  </span><br><span class="line"><span class="built_in">echo</span> BUILD_TAG: <span class="variable">$BUILD_TAG</span></span><br><span class="line">   </span><br><span class="line"><span class="built_in">echo</span> EXECUTOR_NUMBER: <span class="variable">$EXECUTOR_NUMBER</span></span><br><span class="line">    </span><br><span class="line"><span class="built_in">echo</span> NODE_NAME: <span class="variable">$NODE_NAME</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> NODE_LABELS: <span class="variable">$NODE_LABELS</span></span><br><span class="line">  </span><br><span class="line"><span class="built_in">echo</span> WORKSPACE: <span class="variable">$WORKSPACE</span></span><br><span class="line">   </span><br><span class="line"><span class="built_in">echo</span> WORKSPACE_TMP: <span class="variable">$WORKSPACE_TMP</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> JENKINS_HOME: <span class="variable">$JENKINS_HOME</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> JENKINS_URL: <span class="variable">$JENKINS_URL</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> BUILD_URL: <span class="variable">$BUILD_URL</span></span><br><span class="line">   </span><br><span class="line"><span class="built_in">echo</span> JOB_URL: <span class="variable">$JOB_URL</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> GIT_COMMIT: <span class="variable">$GIT_COMMIT</span></span><br><span class="line">   </span><br><span class="line"><span class="built_in">echo</span> GIT_PREVIOUS_COMMIT: <span class="variable">$GIT_PREVIOUS_COMMIT</span></span><br><span class="line">   </span><br><span class="line"><span class="built_in">echo</span> GIT_PREVIOUS_SUCCESSFUL_COMMIT: <span class="variable">$GIT_PREVIOUS_SUCCESSFUL_COMMIT</span></span><br><span class="line">    </span><br><span class="line"><span class="built_in">echo</span> GIT_BRANCH: <span class="variable">$GIT_BRANCH</span></span><br><span class="line">   </span><br><span class="line"><span class="built_in">echo</span> GIT_LOCAL_BRANCH: <span class="variable">$GIT_LOCAL_BRANCH</span></span><br><span class="line">  </span><br><span class="line"><span class="built_in">echo</span> GIT_CHECKOUT_DIR: <span class="variable">$GIT_CHECKOUT_DIR</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> GIT_URL: <span class="variable">$GIT_URL</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> GIT_COMMITTER_NAME: <span class="variable">$GIT_COMMITTER_NAME</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> GIT_AUTHOR_NAME: <span class="variable">$GIT_AUTHOR_NAME</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">echo</span> GIT_COMMITTER_EMAIL: <span class="variable">$GIT_COMMITTER_EMAIL</span></span><br><span class="line">  </span><br><span class="line"><span class="built_in">echo</span> GIT_AUTHOR_EMAIL: <span class="variable">$GIT_AUTHOR_EMAIL</span></span><br></pre></td></tr></table></figure></p>
<p>æµ‹è¯•ç»“æœ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">+ /bin/bash /tmp/script/env.sh</span><br><span class="line">BUILD_NUMBER: 22</span><br><span class="line">BUILD_ID: 22</span><br><span class="line">BUILD_DISPLAY_NAME: <span class="comment">#22:</span></span><br><span class="line">JOB_NAME: Maven-HelloWorld</span><br><span class="line">JOB_BASE_NAME: Maven-HelloWorld</span><br><span class="line">BUILD_TAG: jenkins-Maven-HelloWorld-22</span><br><span class="line">EXECUTOR_NUMBER: 0</span><br><span class="line">NODE_NAME: master</span><br><span class="line">NODE_LABELS: master</span><br><span class="line">WORKSPACE: /var/lib/jenkins/workspace/Maven-HelloWorld</span><br><span class="line">WORKSPACE_TMP: /var/lib/jenkins/workspace/Maven-HelloWorld@tmp</span><br><span class="line">JENKINS_HOME: /var/lib/jenkins</span><br><span class="line">JENKINS_URL: http://jenkins.weiyigeek.top:8080/</span><br><span class="line">BUILD_URL: http://jenkins.weiyigeek.top:8080/job/Maven-HelloWorld/22/</span><br><span class="line">JOB_URL: http://jenkins.weiyigeek.top:8080/job/Maven-HelloWorld/</span><br><span class="line">GIT_COMMIT: 0f50b10b09c160a86972178d94ca1f0a704dd767</span><br><span class="line">GIT_PREVIOUS_COMMIT: 0f50b10b09c160a86972178d94ca1f0a704dd767</span><br><span class="line">GIT_PREVIOUS_SUCCESSFUL_COMMIT: 0f50b10b09c160a86972178d94ca1f0a704dd767</span><br><span class="line">GIT_BRANCH: v1.7</span><br><span class="line">GIT_URL: git@gitlab.weiyigeek.top:ci-cd/java-maven.git</span><br><span class="line">GIT_AUTHOR_NAME:</span><br><span class="line">GIT_AUTHOR_EMAIL:</span><br><span class="line">GIT_COMMITTER_NAME:</span><br><span class="line">GIT_COMMITTER_EMAIL:</span><br><span class="line">GIT_LOCAL_BRANCH:</span><br><span class="line">GIT_CHECKOUT_DIR:</span><br><span class="line">Finished: SUCCESS</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="2-Jenkins-ç®¡ç†å‘˜å¯†ç å¿˜è®°é‡ç½®"><a href="#2-Jenkins-ç®¡ç†å‘˜å¯†ç å¿˜è®°é‡ç½®" class="headerlink" title="(2) Jenkins ç®¡ç†å‘˜å¯†ç å¿˜è®°é‡ç½®"></a>(2) Jenkins ç®¡ç†å‘˜å¯†ç å¿˜è®°é‡ç½®</h3><p>1.æ‰¾åˆ°ç”¨æˆ·çš„è·¯å¾„<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins-node1 ~]<span class="comment"># cd /var/lib/jenkins/users/</span></span><br><span class="line">[root@jenkins-node1 users]<span class="comment"># tree</span></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ 552408925_8628634723176281851</span><br><span class="line">â”‚   â””â”€â”€ config.xml</span><br><span class="line">â”œâ”€â”€ admin_8092868597319509744</span><br><span class="line">â”‚   â””â”€â”€ config.xml</span><br><span class="line">â”œâ”€â”€ jenkins_3327043579358903316     <span class="comment">#æˆ‘ä½¿ç”¨çš„jenkinsä½œä¸ºç®¡ç†å‘˜(å¦‚æœä½ æ˜¯adminå°±è¿›adminç›®å½•)</span></span><br><span class="line">â”‚   â””â”€â”€ config.xml                  <span class="comment">#ä¿®æ”¹config.xml</span></span><br><span class="line">â””â”€â”€ users.xml</span><br><span class="line"></span><br><span class="line">3 directories, 4 files</span><br></pre></td></tr></table></figure></p>
<p>2.ä¿®æ”¹jenkinsç”¨æˆ·ç›®å½•ä¸‹çš„config.xmlï¼Œå®šä½åˆ°<code>&lt;passwordHash&gt;</code>é‚£è¡Œåˆ é™¤ï¼Œæ”¹ä¸ºå¦‚ä¸‹å†…å®¹-<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins-node1 users]<span class="comment"># vim config.xml</span></span><br><span class="line">&lt;passwordHash&gt;<span class="comment">#jbcrypt:$2a$10$slYx6.2Xyss6w9LnuiwnNOReuvkcSkaI.Y.Z2AC6Sp7hdF7hhxlsK&lt;/passwordHash&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>3.æ–°å¯†ç ä¸ºbgx.com è®°å¾—é‡å¯jenkinsç”Ÿæ•ˆ</p>
<p><br/></p>
<h3 id="3-Jenkins-å‡çº§è¿ç§»"><a href="#3-Jenkins-å‡çº§è¿ç§»" class="headerlink" title="(3) Jenkins å‡çº§è¿ç§»"></a>(3) Jenkins å‡çº§è¿ç§»</h3><p>æè¿°: åœ¨ä½¿ç”¨ Jenkins æ—¶å€™æ˜¾ç¤ºæ–°ç‰ˆæœ¬çš„ Jenkins (2.272) å¯ä»¥ä¸‹è½½ (å˜æ›´è®°å½•)ï¼Œæ­£å¥½å¯ä»¥å®è·µä¸€å“ˆJenkinsçš„å‡çº§&amp;è¿ç§»ã€‚<br>PS : å¦‚æœæ˜¯æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å‡çº§å»ºè®®æ…é‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ’ä»¶å’Œå‡çº§ç‰ˆæœ¬ä¸å…¼å®¹çš„æƒ…å†µ; </p>
<p>æ“ä½œæµç¨‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) ä¸‹è½½æ›´æ–°åŒ… </span></span><br><span class="line">wget https://updates.jenkins.io/download/war/2.272/jenkins.war </span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) åœæ­¢ Jenkins æœåŠ¡</span></span><br><span class="line">jenkins:/usr/share/jenkins<span class="comment"># systemctl stop jenkins &amp;&amp; ls</span></span><br><span class="line">  <span class="comment"># jenkins.war</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) å¤‡ä»½ä¸Šä¸€ä¸ªç‰ˆæœ¬</span></span><br><span class="line">jenkins:/usr/share/jenkins<span class="comment"># mv jenkins.war jenkins.war.2.263.1.bak</span></span><br><span class="line">jenkins:/usr/share/jenkins<span class="comment"># cp /home/weiyigeek/jenkins.war jenkins.war</span></span><br><span class="line">jenkins:/usr/share/jenkins<span class="comment"># ls -alh</span></span><br><span class="line">  <span class="comment"># -rw-r--r--   1 root root  67M Dec 24 02:38 jenkins.war</span></span><br><span class="line">  <span class="comment"># -rw-r--r--   1 root root  65M Dec  2 13:56 jenkins.war.2.263.1.bak</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) å¯åŠ¨ Jenkins æœåŠ¡</span></span><br><span class="line">jenkins:/usr/share/jenkins<span class="comment"># systemctl start jenkins</span></span><br><span class="line">jenkins:/usr/share/jenkins<span class="comment"># systemctl status jenkins</span></span><br><span class="line">  <span class="comment"># â— jenkins.service - LSB: Start Jenkins at boot time</span></span><br><span class="line">  <span class="comment">#     Loaded: loaded (/etc/init.d/jenkins; generated)</span></span><br><span class="line">  <span class="comment">#     Active: active (exited) since Thu 2020-12-24 02:38:50 UTC; 4s ago</span></span><br><span class="line">  <span class="comment">#       Docs: man:systemd-sysv-generator(8)</span></span><br><span class="line">  <span class="comment">#     Process: 448375 ExecStart=/etc/init.d/jenkins start (code=exited, status=0/SUCCESS)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Dec 24 02:38:48 gitlab systemd[1]: Starting LSB: Start Jenkins at boot time...</span></span><br><span class="line">  <span class="comment"># Dec 24 02:38:48 gitlab jenkins[448375]: Correct java version found</span></span><br><span class="line">  <span class="comment"># Dec 24 02:38:48 gitlab jenkins[448375]:  * Starting Jenkins Automation Server jenkins</span></span><br><span class="line">  <span class="comment"># Dec 24 02:38:48 gitlab su[448432]: (to jenkins) root on none</span></span><br><span class="line">  <span class="comment"># Dec 24 02:38:48 gitlab su[448432]: pam_unix(su-l:session): session opened for user jenkins by (uid=0)</span></span><br><span class="line">  <span class="comment"># Dec 24 02:38:49 gitlab su[448432]: pam_unix(su-l:session): session closed for user jenkins</span></span><br><span class="line">  <span class="comment"># Dec 24 02:38:50 gitlab jenkins[448375]:    ...done.</span></span><br><span class="line">  <span class="comment"># Dec 24 02:38:50 gitlab systemd[1]: Started LSB: Start Jenkins at boot time.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) è®¿é—® Jenkins UI ç•Œé¢éªŒè¯å‡çº§ç‰ˆæœ¬</span></span><br><span class="line">http://jenkins.weiyigeek.top:8080/about/</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201224104730.png" target="_blank" title="WeiyiGeek.Jenkins UI" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201224104730.png" alt="WeiyiGeek.Jenkins UI" title="" class=""></a>
                <p>WeiyiGeek.Jenkins UI</p>
            </figure>
<hr>
<h2 id="0x06-å…¥å‘-amp-å‡ºå‘"><a href="#0x06-å…¥å‘-amp-å‡ºå‘" class="headerlink" title="0x06 å…¥å‘&amp;å‡ºå‘"></a>0x06 å…¥å‘&amp;å‡ºå‘</h2><p><strong>é—®é¢˜1.jenkins depends on daemon; however Package daemon is not installed.</strong><br>é—®é¢˜æè¿°: åœ¨Ubuntu é‡‡ç”¨ dpkg å®‰è£… jenkins_2.263.1_all.deb æ—¶æŠ¥é”™æç¤º daemon åŒ…æœªå®‰è£…<br>é—®é¢˜å¤åŸ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dpkg -i jenkins_2.263.1_all.deb</span><br><span class="line">Selecting previously unselected package jenkins.</span><br><span class="line">(Reading database ... 115038 files and directories currently installed.)</span><br><span class="line">Preparing to unpack jenkins_2.263.1_all.deb ...</span><br><span class="line">Unpacking jenkins (2.263.1) ...</span><br><span class="line">dpkg: dependency problems prevent configuration of jenkins:</span><br><span class="line"> jenkins depends on daemon; however:</span><br><span class="line">  Package daemon is not installed.</span><br><span class="line"></span><br><span class="line">dpkg: error processing package jenkins (--install):</span><br><span class="line"> dependency problems - leaving unconfigured</span><br><span class="line">Processing triggers <span class="keyword">for</span> systemd (245.4-4ubuntu3.2) ...</span><br><span class="line">Errors were encountered <span class="keyword">while</span> processing:</span><br><span class="line"> jenkins</span><br></pre></td></tr></table></figure><br>è§£å†³åŠæ³•:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y daemon</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>é—®é¢˜2:Jenkins å¯åŠ¨æ—¶æ˜¾ç¤º ERROR: No Java executable found in current PATH: /bin:/usr/bin:/sbin:/usr/sbin</strong><br>é—®é¢˜å¤åŸ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl status jenkins</span><br><span class="line">Dec 23 14:02:57 gitlab systemd[1]: Starting LSB: Start Jenkins at boot time...</span><br><span class="line">Dec 23 14:02:57 gitlab jenkins[356298]: ERROR: No Java executable found <span class="keyword">in</span> current PATH: /bin:/usr/bin:/sbin:/usr/sbin</span><br><span class="line">Dec 23 14:02:57 gitlab jenkins[356298]: If you actually have java installed on the system make sure the executable is <span class="keyword">in</span> the aforementioned path and that <span class="string">'type -p ja&gt;</span></span><br><span class="line"><span class="string">Dec 23 14:02:57 gitlab systemd[1]: jenkins.service: Control process exited, code=exited, status=1/FAILURE</span></span><br><span class="line"><span class="string">Dec 23 14:02:57 gitlab systemd[1]: jenkins.service: Failed with result '</span><span class="built_in">exit</span>-code<span class="string">'.</span></span><br><span class="line"><span class="string">Dec 23 14:02:57 gitlab systemd[1]: Failed to start LSB: Start Jenkins at boot time.</span></span><br></pre></td></tr></table></figure><br>é—®é¢˜åŸå› : æœªæ‰¾å¯»åˆ°æœ‰æ•ˆçš„Javaæ‰§è¡Œç¯å¢ƒ;<br>è§£å†³æµç¨‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â‘ .å…ˆæ‰§è¡Œecho $PATH çœ‹çœ‹ç¯å¢ƒå˜é‡è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</span><br><span class="line">&#x2F;usr&#x2F;maven&#x2F;maven&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;local&#x2F;games:&#x2F;usr&#x2F;java&#x2F;jdk1.8&#x2F;bin</span><br><span class="line">å¦‚æœè¿è¿™éƒ½æ²¡æœ‰çš„è¯é‡æ–°å®‰è£…Javaã€‚</span><br><span class="line"></span><br><span class="line">â‘¡.å»ºç«‹è½¯è¿æ¥ï¼šln -s &#x2F;usr&#x2F;java&#x2F;jdk1.8&#x2F;bin&#x2F;java &#x2F;usr&#x2F;bin&#x2F;javaï¼ˆæ¢æˆä½ è‡ªå·±çš„è·¯å¾„ï¼‰</span><br><span class="line">Please wait while Jenkins is getting ready to work (jenkins)</span><br><span class="line">å¦‚æœç•Œé¢æç¤ºJenkinsæ­£åœ¨å¯åŠ¨,è¯·ç¨åâ€¦æˆ–è€…æç¤º</span><br><span class="line">Please wait while Jenkins is getting ready to workâ€¦</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>é—®é¢˜3.å®‰è£…Jenkinsåæˆ–è€…å®‰è£…æ’ä»¶æ—¶å€™ä¸€ç›´åœ¨åŠ è½½;</strong><br>é—®é¢˜æè¿°: ç”±äºJenkinså®˜æ–¹æ’ä»¶ä¸‹è½½åœ°å€æ²¡è¢«å¢™ä½†æ˜¯ç½‘é€Ÿå¾ˆæ…¢ï¼Œä¸‹è½½æ—¶é—´ä¹Ÿé•¿;<br>è§£å†³æ–¹æ³•:æ¢æ¸…åçš„é•œåƒè¿›å»ä¹‹åä¸‹è½½æ’ä»¶å³å¯ (<a href="http://updates.jenkins-ci.org/download/" target="_blank" rel="noopener">http://updates.jenkins-ci.org/download/</a>)<br>æ“ä½œæµç¨‹: éœ€è¦ä½ è¿›å…¥jenkinsçš„å·¥ä½œç›®å½•<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰“å¼€ hudson.model.UpdateCenter.xml æŠŠ http://updates.jenkins-ci.org/update-center.json æ”¹æˆ http://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</span></span><br><span class="line">sed -i <span class="string">"s#updates.jenkins.io#mirrors.tuna.tsinghua.edu.cn/jenkins/updates#g"</span> /var/lib/jenkins/hudson.model.UpdateCenter.xml</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸Šé¢çš„å‘½ä»¤å°±æ˜¯å°†å°†å®‰è£…ç›®å½•ä¸‹çš„ hudson.model.UpdateCenter.xml ä¸­æ”¹æˆ</span></span><br><span class="line">&lt;?xml version=<span class="string">'1.1'</span> encoding=<span class="string">'UTF-8'</span>?&gt;</span><br><span class="line">&lt;sites&gt;</span><br><span class="line">  &lt;site&gt;</span><br><span class="line">    &lt;id&gt;default&lt;/id&gt;</span><br><span class="line">    &lt;url&gt;https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json&lt;/url&gt;</span><br><span class="line">  &lt;/site&gt;</span><br><span class="line">&lt;/sites&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) å°†updatesæ–‡ä»¶å¤¹ä¸‹çš„default.json ä¸­æ‰€æœ‰ http://updates.jenkins-ci.org/download/æ›¿æ¢ä¸º https://mirrors.tuna.tsinghua.edu.cn/jenkins/ PS: ä¹Ÿå¯ä»¥åœ¨åå°è¿›è¡Œè®¾ç½®</span></span><br><span class="line">https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) ä¿®æ”¹å®Œæˆåé‡å¯ Jenkins å³å¯</span></span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½² href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201223222542.png" target="_blank" title="WeiyiGeek.Jenkins Please wait" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201223222542.png" alt="WeiyiGeek.Jenkins Please wait" title="" class=""></a>
                <p>WeiyiGeek.Jenkins Please wait</p>
            </figure>
<p><br></p>
<p><strong>é—®é¢˜4: æœªæ­£ç¡®é…ç½®JenkinsåŸºç¡€URLç­‰ç›¸å…³ä¿¡æ¯;</strong><br>é—®é¢˜æè¿°: Jenkinsçš„æ ¹URLæ˜¯ç©ºçš„ï¼Œä½†æ˜¯éœ€è¦Jenkinsçš„è®¸å¤šç‰¹æ€§çš„æ­£ç¡®æ“ä½œï¼Œå¦‚ç”µå­é‚®ä»¶é€šçŸ¥ã€PRçŠ¶æ€æ›´æ–°å’Œç¯å¢ƒå˜é‡ï¼Œå¦‚BUILD_URLã€‚<br>è¯·æä¾›Jenkinsé…ç½®ä¸­çš„å‡†ç¡®å€¼ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Jenkins root URL is empty but is required <span class="keyword">for</span> the proper operation of many Jenkins features like email notifications, PR status update, and environment variables such as BUILD_URL.</span><br><span class="line"></span><br><span class="line">Please provide an accurate value <span class="keyword">in</span> Jenkins configuration.</span><br></pre></td></tr></table></figure><br>è§£å†³åŠæ³•: Dashboard -&gt; é…ç½® -&gt; Jenkins Location -&gt; Jenkins åœ°å€ &amp; é‚®ç®±</p>
<p><br></p>
<p><strong>é—®é¢˜5.æ— æ³•è¿æ¥ä»“åº“ï¼šCommand â€œgit ls-remote -h â€“ <a href="mailto:git@gitlab.weiyigeek.top">git@gitlab.weiyigeek.top</a>:ci-cd/blog.git HEADâ€ returned status code 128:</strong><br>é—®é¢˜å¤åŸ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">stdout:</span><br><span class="line">  stderr: Host key verification failed.</span><br><span class="line">  fatal: Could not <span class="built_in">read</span> from remote repository.</span><br><span class="line"><span class="comment"># Please make sure you have the correct access rights and the repository exists.</span></span><br></pre></td></tr></table></figure><br>é—®é¢˜åŸå› : ç”±äºé‡‡ç”¨SSHåè®®è¿›è¡Œä»£ç çš„æ‹‰å–å’Œä¿¡æ¯çš„æŸ¥çœ‹ï¼Œåœ¨åˆ©ç”¨å…¬å¯†é’¥é¦–æ¬¡é“¾æ¥æ—¶å€™æœªç»‘å®šå…¶æœºå™¨çš„å…¬é’¥ä¿¡æ¯, å°†ä¼šå¯¼è‡´ <code>Host key verification failed.</code><br>è§£å†³åŠæ³•: åœ¨è¿æ¥çš„æœºå™¨ä¸Šå…ˆæ‰§è¡Œ<code>git -T git@gitlab.weiyigeek.top</code>ä¿å­˜å…¶ä¸»æœºçš„å…¬é’¥ä¿¡æ¯;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¾‹å¦‚ é¦–æ¬¡è¿æ¥Gitlabæ—¶å€™éœ€è¦è¿›è¡Œä¸»æœºäºå…¬é’¥ç»‘å®š</span></span><br><span class="line">ssh -T git@gitlab.com</span><br><span class="line"><span class="comment"># æ— æ³•å»ºç«‹ä¸»æœºâ€œgitlab.com(172.65.251.78)â€çš„çœŸå®æ€§ã€‚</span></span><br><span class="line">The authenticity of host <span class="string">'gitlab.com (172.65.251.78)'</span> can\<span class="string">'t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:HbW3g8zUjNSksFbqTiUWPWg2Bq1x8xdGUrliXFzSnUw.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no/[fingerprint])?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ cat ~/.ssh/known_hosts</span></span><br><span class="line"><span class="string">gitlab.com,172.65.251.78 ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAABFSMqzJeV9rUzU4kWitGjeR4PWSa29SPqJ1fVkhtj3Hw9xjLVXVYrU9QOLXBpQ6KWjbjTDTdDkoohFzgbEYI=</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>é—®é¢˜6.Jenkins å†…ç½®é‚®ä»¶é€šçŸ¥å‘ä¿¡æµ‹è¯• Failed to send out e-mail javax.mail.AuthenticationFailedException: 535 Error:</strong><br>é”™è¯¯ä¿¡æ¯ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Failed to send out e-mail</span><br><span class="line">javax.mail.AuthenticationFailedException: 535 Error: Ã‡Ã«ÃŠÂ¹Ã“ÃƒÃŠÃšÃˆÂ¨Ã‚Ã«ÂµÃ‡Ã‚Â¼Â¡Â£ÃÃªÃ‡Ã©Ã‡Ã«Â¿Â´: http://service.mail.qq.com/cgi-bin/<span class="built_in">help</span>?subtype=1&amp;&amp;id=28&amp;&amp;no=1001256</span><br><span class="line"></span><br><span class="line">  at com.sun.mail.smtp.SMTPTransport<span class="variable">$Authenticator</span>.authenticate(SMTPTransport.java:947)</span><br><span class="line">  at com.sun.mail.smtp.SMTPTransport.authenticate(SMTPTransport.java:858)</span><br><span class="line">  at com.sun.mail.smtp.SMTPTransport.protocolConnect(SMTPTransport.java:762)</span><br><span class="line">  at javax.mail.Service.connect(Service.java:364)</span><br></pre></td></tr></table></figure><br>é”™è¯¯åŸå› : é…ç½®STMPçš„é‚®ç®±è´¦å·ï¼Œè¾“å…¥çš„è®¤è¯å­—ç¬¦ä¸²æ˜¯é‚®ç®±å¯†ç è€Œå¹¶éç”Ÿæˆçš„å®¢æˆ·ç«¯å¯†ç , åœ¨ è…¾è®¯ä¼ä¸šé‚®ç®±ã€163é‚®ç®±éƒ½éœ€è¦ä½¿ç”¨ç”Ÿæˆçš„å®¢æˆ·ç«¯å¯†ç è¿›è¡Œç™»å½•;</p>
<p><br></p>
<p><strong>é—®é¢˜7.Jenkins å†…ç½®é‚®ä»¶é€šçŸ¥å‘ä¿¡æµ‹è¯• com.sun.mail.smtp.SMTPSenderFailedException: 501 mail from address must be same as authorization user</strong><br>é”™è¯¯ä¿¡æ¯:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Failed to send out e-mail</span><br><span class="line">com.sun.mail.smtp.SMTPSenderFailedException: 501 mail from address must be same as authorization user</span><br><span class="line">  at com.sun.mail.smtp.SMTPTransport.mailFrom(SMTPTransport.java:1817)</span><br><span class="line">Caused: com.sun.mail.smtp.SMTPSendFailedException: 501 mail from address must be same as authorization user</span><br><span class="line">;</span><br><span class="line">  nested exception is:</span><br><span class="line">  com.sun.mail.smtp.SMTPSenderFailedException: 501 mail from address must be same as authorization user</span><br><span class="line">  at com.sun.mail.smtp.SMTPTransport.issueSendCommand(SMTPTransport.java:2374)</span><br><span class="line">  at com.sun.mail.smtp.SMTPTransport.mailFrom(SMTPTransport.java:1808)</span><br><span class="line">  at com.sun.mail.smtp.SMTPTransport.sendMessage(SMTPTransport.java:1285)</span><br><span class="line">  at javax.mail.Transport.send0(Transport.java:231)</span><br></pre></td></tr></table></figure><br>é”™è¯¯åŸå› : æœ€åå‘ç°æ˜¯jenkins urlä¸‹é¢çš„ç³»ç»Ÿç®¡ç†å‘˜é‚®ä»¶åœ°å€æ²¡æœ‰å¡«å†™æˆ–è€…ä¸STMPå‘ä¿¡é‚®ç®±ä¸ä¸€è‡´<br>è§£å†³åŠæ³•: å¡«å†™ç³»ç»Ÿç®¡ç†å‘˜é‚®ç®±ä¸STMPå‘ä¿¡é‚®ç®±åœ°å€ä¸€è‡´å°±å¯ä»¥äº†ã€‚</p>
<p><strong>é—®é¢˜8.Jenkins å†…ç½®é‚®ä»¶é€šçŸ¥å‘ä¿¡æµ‹è¯•com.sun.mail.smtp.SMTPAddressFailedException: 501 Bad address syntax</strong></p>
<p>é”™è¯¯ä¿¡æ¯:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ERROR: Invalid Addresses</span><br><span class="line">javax.mail.SendFailedException: Invalid Addresses;</span><br><span class="line">  nested exception is:</span><br><span class="line">  com.sun.mail.smtp.SMTPAddressFailedException: 501 Bad address syntax</span><br><span class="line">  at com.sun.mail.smtp.SMTPTransport.rcptTo(SMTPTransport.java:2064)</span><br><span class="line">  at com.sun.mail.smtp.SMTPTransport.sendMessage(SMTPTransport.java:1286)</span><br><span class="line">  at javax.mail.Transport.send0(Transport.java:231)</span><br><span class="line">  at javax.mail.Transport.send(Transport.java:100)</span><br><span class="line">  at hudson.tasks.MailSender.run(MailSender.java:130)</span><br><span class="line">  at hudson.tasks.MailSender.execute(MailSender.java:105)</span><br><span class="line">  at hudson.maven.MavenModuleSetBuild<span class="variable">$MavenModuleSetBuildExecution</span>.cleanUp(MavenModuleSetBuild.java:1093)</span><br><span class="line">  at hudson.model.Run.execute(Run.java:1954)</span><br><span class="line">  at hudson.maven.MavenModuleSetBuild.run(MavenModuleSetBuild.java:543)</span><br><span class="line">  at hudson.model.ResourceController.execute(ResourceController.java:97)</span><br><span class="line">  at hudson.model.Executor.run(Executor.java:429)</span><br><span class="line">Caused by: com.sun.mail.smtp.SMTPAddressFailedException: 501 Bad address syntax</span><br><span class="line"></span><br><span class="line">  at com.sun.mail.smtp.SMTPTransport.rcptTo(SMTPTransport.java:1917)</span><br><span class="line">  ... 10 more</span><br><span class="line">Finished: FAILURE</span><br><span class="line">`</span><br></pre></td></tr></table></figure></p>
<p>é”™è¯¯åŸå› : è¾“å…¥çš„æ¥æ”¶é‚®ç®±åœ°å€æ˜¯æ— æ•ˆçš„æ ¼å¼;</p>

        </div>
        
  <hr>
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>

  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>

  <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ï¼Œè½¬ä¸ªå‘ã€‘(äººé—´äº”å¤§æƒ…)</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œè°¢è°¢ï¼ã€‚</p>

  <div>
    <img src="https://www.weiyigeek.top/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul>

  <div>
    <img src="/img/wechat-search.png" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·"  width="328" height="149">
    <img src="/img/wechat-app.png" class="img-responsive" alt="æ‰«æVisit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº"  width="328" height="149">
  </div>


  <hr>
  


  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-06-15T02:46:32.063Z" itemprop="dateUpdated">2022-06-15 10:46:32</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/Jenkins/1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½².md" target="_blank" rel="noopener noreferrer">_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/Jenkins/1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½².md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2020/12-28-513.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/12-28-513.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">ğŸ‘ é’Ÿæ„ä½œè€…</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/12-28-513.html&title=ã€Š1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½²ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/12-28-513.html&title=ã€Š1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½²ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/12-28-513.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½²ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/12-28-513.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/12-28-513.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/12-28-515.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">SonarQubeåŸºç¡€ä»‹ç»ä¸åœ¨ä»£ç æ£€æµ‹ä¸­çš„åº”ç”¨</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/12-17-525.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">å„ç±»æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²æ ¼å¼</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-å‰è¨€ç®€è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å‰è¨€ç®€è¿°</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Jenkins-ä»‹ç»"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">Jenkins ä»‹ç»</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Jenkins-ç‰¹æ€§"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">Jenkins ç‰¹æ€§</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Jenkins-åº”ç”¨åœºæ™¯"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">Jenkins åº”ç”¨åœºæ™¯</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Jenkins-Job-ç±»å‹"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">Jenkins Job ç±»å‹</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-å®‰è£…é…ç½®"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 å®‰è£…é…ç½®</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Ubuntu"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">Ubuntu</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Docker-å®‰è£…"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">Docker å®‰è£…</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Kubernetes-å®‰è£…"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">Kubernetes å®‰è£…</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-åŸºç¡€çŸ¥è¯†"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 åŸºç¡€çŸ¥è¯†</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Jenkins-ç¯å¢ƒå˜é‡"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">Jenkins ç¯å¢ƒå˜é‡</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Jenkins-å‚æ•°æ„å»ºç±»å‹"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">Jenkins å‚æ•°æ„å»ºç±»å‹</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Jenkins-å¹¶å‘æ„å»º"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">Jenkins å¹¶å‘æ„å»º</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Jenkins-è‡ªåŠ¨åŒ–æ„å»º"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">Jenkins è‡ªåŠ¨åŒ–æ„å»º</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Jenkins-ä¸Šä¸‹æ¸¸æ„å»º"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">Jenkins ä¸Šä¸‹æ¸¸æ„å»º</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Jenkins-è°ƒç”¨API"><span class="post-toc-number">3.6.</span> <span class="post-toc-text">Jenkins è°ƒç”¨API</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x03-åŸºç¡€é…ç½®"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 åŸºç¡€é…ç½®</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#è§†å›¾ç®¡ç†"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">è§†å›¾ç®¡ç†</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#æ’ä»¶ç®¡ç†"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">æ’ä»¶ç®¡ç†</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#æƒé™ç®¡ç†"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">æƒé™ç®¡ç†</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#æ„å»ºå·¥å…·ç®¡ç†"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">æ„å»ºå·¥å…·ç®¡ç†</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x04-åŸºç¡€ä½¿ç”¨"><span class="post-toc-number">5.</span> <span class="post-toc-text">0x04 åŸºç¡€ä½¿ç”¨</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#HelloWorld-è‡ªç”±é£æ ¼è½¯ä»¶é¡¹ç›®"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">HelloWorld è‡ªç”±é£æ ¼è½¯ä»¶é¡¹ç›®</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Gitlab-é›†æˆé…ç½®ä¸å®è·µ"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">Gitlab é›†æˆé…ç½®ä¸å®è·µ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Maven-é›†æˆé…ç½®ä¸å®è·µ"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">Maven é›†æˆé…ç½®ä¸å®è·µ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#SonarQube-é›†æˆé…ç½®ä¸å®è·µ"><span class="post-toc-number">5.4.</span> <span class="post-toc-text">SonarQube é›†æˆé…ç½®ä¸å®è·µ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#é‚®ç®±-amp-é’‰é’‰-amp-å¾®ä¿¡æ¶ˆæ¯é€šçŸ¥-é›†æˆé…ç½®ä¸å®è·µ"><span class="post-toc-number">5.5.</span> <span class="post-toc-text">é‚®ç®±&amp;é’‰é’‰&amp;å¾®ä¿¡æ¶ˆæ¯é€šçŸ¥ é›†æˆé…ç½®ä¸å®è·µ</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x05-è¡¥å……è¯´æ˜"><span class="post-toc-number">6.</span> <span class="post-toc-text">0x05 è¡¥å……è¯´æ˜</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-å†…ç½®ç¯å¢ƒå˜é‡"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">(1) å†…ç½®ç¯å¢ƒå˜é‡</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-Jenkins-ç®¡ç†å‘˜å¯†ç å¿˜è®°é‡ç½®"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">(2) Jenkins ç®¡ç†å‘˜å¯†ç å¿˜è®°é‡ç½®</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-Jenkins-å‡çº§è¿ç§»"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">(3) Jenkins å‡çº§è¿ç§»</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x06-å…¥å‘-amp-å‡ºå‘"><span class="post-toc-number">7.</span> <span class="post-toc-text">0x06 å…¥å‘&amp;å‡ºå‘</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

  <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        äººé—´è‡ªæœ‰äº”å¤§æƒ…ã€ç‚¹èµã€æŠ•å¸(èµèµ)ã€æ”¶è—ã€å…³æ³¨ï¼Œè½¬å‘ã€‘, è°¢è°¢çœ‹å‹æ”¯æŒ!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

  
 <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->

  <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">ä¸ªäººGithub</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">ä¸ªäººGitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">ä¸ªäººçŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘+äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved. ITå”¯ä¸€æå®¢ ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/12-28-513.html&title=ã€Š1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½²ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/12-28-513.html&title=ã€Š1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½²ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/12-28-513.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š1.Jenkinså…¥é—¨åŸºç¡€ä»‹ç»ä¸æŒç»­åŒ–é›†æˆéƒ¨ç½²ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/12-28-513.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/12-28-513.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJElEQVR42u3aQW7DMAwEwPz/0+21QBp3l2oCWBqfikCWND6opMjHI36+fjzPvz+Pef791ZhXz+MdDwYGxm0ZyXSvtpKzkzlbNgYGxmmMV1tJxiQbup4nme2PeTAwMDDiELAN/pJwEwMDAyNn5Fu/3mIedGJgYGC0SWw7Mlr+87k4BgbGDRn5rfvn/35LfQMDA+NWjJW08zrsW5mzngEDA2NrxkoJs00784aMpMnjl7cwMDA2ZSSDZkfkdeI6o2JgYGC8Y+GVg7UoIWBgYBzAmBUyk0v/NhluL90wMDBOYyRXabPjeFZ+SD5E9BoGBsbNGXm41rY7JB8oCRyLBgsMDIxNGXmolzdjtaWF2aesbw0xMDC2YOQFgOQYnbVl5B9xWIPFwMC4LWOWjs5Cw/z4LsJEDAyMYxj5UduOXCk81Fk4BgbGdoyVa6+8RWPGrv8NYGBgHMC4Pv7adHdWtlyaDQMDY2tGvlhbGKirqWVFEgMD4xzG+tX/eiq7UlTAwMA4h5GTkmXWT8I6ucXAwDiGMdvu+kXb7HD/h6opBgbGTRhtA0R73VYHeaPVMTAwdmV8lU8SqOWX+/+WDGNgYGzNmBUGcl4+JuctFTgxMDBuy2gbKWaH4yyULAqZGBgYBzDagmKLb6/z8qMfAwMDY+VqbKXZqy1FYGBgYMxaK9pQr26wwMDAOIzxviCvfXe4FgYGxtaMPHVsE9p2hnz1YSETAwPjfoxvIXYUGe8i34IAAAAASUVORK5CYII=" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 



  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 
     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>
