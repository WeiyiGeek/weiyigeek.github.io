{"title":"PS常用命令之文件目录及内容操作","slug":"编程世界/Powershell/Cmdlet/字符串处理类命令/PS字符串内容分隔识别校验","date":"2019-12-20T07:36:30.000Z","updated":"2021-06-09T02:26:26.820Z","url":"2019/12-20-320.html","path":"api/articles/2019/12-20-320.html.json","covers":null,"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"0x00-PS字符串内容分隔识别校验\"><a href=\"#0x00-PS字符串内容分隔识别校验\" class=\"headerlink\" title=\"0x00 PS字符串内容分隔识别校验\"></a>0x00 PS字符串内容分隔识别校验</h2><h3 id=\"替换-Replace\"><a href=\"#替换-Replace\" class=\"headerlink\" title=\"替换 - Replace\"></a>替换 - Replace</h3><p>描述: PowerShell 文本替换方式演示巧妙用法参考。</p>\n<ul>\n<li><strong>.Replace(“原字符串”,”新字符串”)</strong></li>\n<li><strong>-Replace “原字符串(支持正则)”,”新字符串”</strong></li>\n<li><strong>-Creplace “原字符串(支持正则且大小写敏感)”,”新字符串”</strong></li>\n</ul>\n<p><strong>基础示例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 1.字符串\"Hello WeiyiGeek\"将这个字符串的Hello替换为Hi。(注意默认不是大小写敏感的)</span></span><br><span class=\"line\"><span class=\"string\">\"Hello WeiyiGeek\"</span>.Replace(<span class=\"string\">\"Hello\"</span>,<span class=\"string\">\"Hi\"</span>)  <span class=\"comment\"># 结果: Hi WeiyiGeek</span></span><br><span class=\"line\"><span class=\"string\">\"Hello WeiyiGeek\"</span>.Replace(<span class=\"string\">\"hello\"</span>,<span class=\"string\">\"Hi\"</span>)  <span class=\"comment\"># 结果: Hi WeiyiGeek</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 2.将字符串中特殊字符利用正则表达式进行替换。(注意采用得形式)</span></span><br><span class=\"line\"><span class=\"string\">\"He,.l^lo Weiy'./iGeek\"</span> -Replace <span class=\"string\">'\\W'</span>,<span class=\"string\">''</span>    <span class=\"comment\"># 结果: HelloWeiyiGeek</span></span><br><span class=\"line\"><span class=\"string\">\"Hi WeiyiGeek\"</span> -Replace <span class=\"string\">'(.*) (.*)'</span>,<span class=\"string\">'$2 $1'</span> <span class=\"comment\"># 结果: WeiyiGeek Hi (利用元组进行替换)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 3.采用-Replace形式时不进行正则表达式解析匹配</span></span><br><span class=\"line\"><span class=\"string\">\"[Hello] WeiyiGeek\"</span> -Replace <span class=\"string\">'\\[Hello\\]'</span>,<span class=\"string\">'Hi'</span>                  <span class=\"comment\"># 结果: Hi WeiyiGeek</span></span><br><span class=\"line\"><span class=\"string\">\"[Hello] WeiyiGeek\"</span> -Replace ([Regex]::Escape(<span class=\"string\">\"[Hello]\"</span>)),<span class=\"string\">\"Hi\"</span> <span class=\"comment\"># 结果: Hi WeiyiGeek</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 4.该操作符默认是大小写敏感的,即只能完全大小匹配使进行替换</span></span><br><span class=\"line\"><span class=\"string\">\"[Hello] WeiyiGeek\"</span> -creplace <span class=\"string\">'hello'</span>,<span class=\"string\">'Hi'</span>  <span class=\"comment\"># 结果:  [Hello] WeiyiGeek</span></span><br><span class=\"line\"><span class=\"string\">\"[Hello] WeiyiGeek\"</span> -creplace <span class=\"string\">'Hello'</span>,<span class=\"string\">'Hi'</span>  <span class=\"comment\"># 结果:  [Hi] WeiyiGeek</span></span><br><span class=\"line\"><span class=\"string\">\"[Hello] WeiyiGeek\"</span> -creplace ([Regex]::Escape(<span class=\"string\">\"[hello]\"</span>)),<span class=\"string\">\"Hi\"</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>实践案例</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -1.我想从字符串中搜索具有特定格式的数字并使用powershell将最后一个数字增加1,该字符串取自大型txt文件。</span></span><br><span class=\"line\"><span class=\"variable\">$str</span> = <span class=\"string\">\"Android version 4.4.2, Alfa = 1.2.0400, Beta = 2.0.0200, Prod 3.4.0104\"</span>  <span class=\"comment\"># 我想将beta版本增加1（2.0.0200==&gt; 2.0.0201）运行powershell命令后：$str = \"Android version 4.4.2, Alfa = 1.2.0400, Beta = 2.0.0201, Prod 3.4.0104\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方式1</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"variable\">$str</span> -match <span class=\"string\">\"(?&lt;=Beta = \\d+\\.\\d+\\.)(?&lt;bv&gt;\\d+)\"</span>)&#123;</span><br><span class=\"line\">  <span class=\"variable\">$str</span> -replace <span class=\"string\">\"(?&lt;=Beta = \\d+\\.\\d+\\.)(\\d+)\"</span>, (<span class=\"string\">\"&#123;0:0000&#125;\"</span> -f (([int]::Parse(<span class=\"variable\">$matches</span>.bv)+1)))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># 方式2: 注意此处没有++运算符是因为其运算符仅适用于数字，而非字符串.</span></span><br><span class=\"line\">[regex]::Replace(<span class=\"variable\">$str</span>, <span class=\"string\">'(?&lt;Head&gt;.+\\.)(?&lt;Beta&gt;\\d+)(?&lt;Tail&gt;,[^,]+)$'</span>,</span><br><span class=\"line\">  &#123; param( [System.Text.RegularExpressions.Match]<span class=\"variable\">$m</span> ) </span><br><span class=\"line\">    <span class=\"variable\">$bv</span> = 1 + <span class=\"variable\">$m</span>.Groups[<span class=\"string\">'Beta'</span>].Value </span><br><span class=\"line\">    <span class=\"string\">'&#123;0&#125;&#123;1:0000&#125;&#123;2&#125;'</span> -f <span class=\"variable\">$m</span>.Groups[<span class=\"string\">'Head'</span>].Value,<span class=\"variable\">$bv</span>,<span class=\"variable\">$m</span>.Groups[<span class=\"string\">'Tail'</span>].Value</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure><br>Tips : 非常注意Replace中得<code>[Regex]</code>类里面有个Escape静态方法非常方便我们进行禁用正则解析。</p>\n<p><br></p>\n<h3 id=\"匹配-Match\"><a href=\"#匹配-Match\" class=\"headerlink\" title=\"匹配 - Match\"></a>匹配 - Match</h3><p>描述: PowerShell 文本匹配方式演示巧妙用法参考。</p>\n<ul>\n<li><strong>match 运算符: 通过 $Matches来获取字段。</strong></li>\n<li><strong>matches 方法: 通过该方法获取字段。</strong></li>\n</ul>\n<p><strong>基础示例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 1.基础字符串匹配显示match</span></span><br><span class=\"line\">PS &gt; <span class=\"string\">\"[Hello] WeiyiGeek\"</span> -match <span class=\"string\">'(?&lt;name&gt;(W\\w.+k$))'</span>  <span class=\"comment\"># True</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$Matches</span>.name                                    <span class=\"comment\"># WeiyiGeek</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 2.采用matches方法进行多次匹配邮箱格式</span></span><br><span class=\"line\"><span class=\"variable\">$txt</span>=<span class=\"string\">'WeiyiGeek Email &lt;master@weiyigeek.top&gt;;</span></span><br><span class=\"line\"><span class=\"string\">test &lt;test@weiyigeek.top&gt;;</span></span><br><span class=\"line\"><span class=\"string\">demo &lt;demo@weiyigeek.top&gt;;'</span></span><br><span class=\"line\">[regex]::matches(<span class=\"variable\">$txt</span>, <span class=\"string\">'&lt;(.+)&gt;;'</span>) | %&#123;<span class=\"variable\">$_</span>.Groups[1].Value&#125;</span><br><span class=\"line\">  <span class=\"comment\"># master@weiyigeek.top</span></span><br><span class=\"line\">  <span class=\"comment\"># test@weiyigeek.top</span></span><br><span class=\"line\">  <span class=\"comment\"># demo@weiyigeek.top</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 3.网页指定正则表达式匹配到得字符串获取</span></span><br><span class=\"line\">[System.Net.ServicePointManager]::ServerCertificateValidationCallback = &#123;$ <span class=\"literal\">true</span> &#125;</span><br><span class=\"line\"><span class=\"variable\">$WebClient</span>=New-Object System.Net.WebClient</span><br><span class=\"line\"><span class=\"variable\">$url</span>=<span class=\"string\">\"https://www.weiyigeek.top\"</span></span><br><span class=\"line\"><span class=\"variable\">$WebClient</span>.DownloadString(<span class=\"variable\">$url</span>) -match <span class=\"string\">'(?&lt;name&gt;(W\\w.+k))'</span>|out-null  <span class=\"comment\"># 网站字符串</span></span><br><span class=\"line\"><span class=\"variable\">$Matches</span>.name  <span class=\"comment\"># WeiyiGeek</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$WebClient</span>.DownloadString(<span class=\"string\">\"http://ident.me/\"</span>) -match <span class=\"string\">'(?&lt;ip&gt;(\\d+\\.)&#123;3&#125;\\d+)'</span>|out-null  <span class=\"comment\"># 外网地址</span></span><br><span class=\"line\"><span class=\"variable\">$Matches</span>.ip    <span class=\"comment\"># 120.17.50.229</span></span><br></pre></td></tr></table></figure></p>\n<hr>\n<h2 id=\"0x03-内存字符串处理\"><a href=\"#0x03-内存字符串处理\" class=\"headerlink\" title=\"0x03 内存字符串处理\"></a>0x03 内存字符串处理</h2><h3 id=\"Select-String-命令-在字符串和文件中查找文本\"><a href=\"#Select-String-命令-在字符串和文件中查找文本\" class=\"headerlink\" title=\"Select-String 命令 - 在字符串和文件中查找文本\"></a>Select-String 命令 - 在字符串和文件中查找文本</h3><p>描述:可以按照字符串以及属性进行过滤显示通过管道符;</p>\n<p><strong>基础语法:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 语法</span></span><br><span class=\"line\">Select-String [-Pattern] &lt;System.String[]&gt; [-AllMatches] [-CaseSensitive] [-Context &lt;System.Int32[]&gt;] [-Encoding &#123;ASCII | BigEndianUnicode | Default | OEM | Unicode | UTF7 | UTF8 | UTF32&#125;] [-Exclude &lt;System.String[]&gt;] [-Include &lt;System.String[]&gt;] -InputObject &lt;System.Management.Automation.PSObject&gt; [-List] [-NotMatch] [-Quiet] [-SimpleMatch] [&lt;CommonParameters&gt;]</span><br></pre></td></tr></table></figure></p>\n<p><strong>基础示例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.过滤选择显示特定的字符串</span></span><br><span class=\"line\">PS &gt; ipconfig | Select-String <span class=\"string\">\"IPv6\"</span></span><br><span class=\"line\">  <span class=\"comment\"># 本地链接 IPv6 地址. . . . . . . . : fe80::d97d:fe6c:10bf:4244%15</span></span><br><span class=\"line\">  <span class=\"comment\"># 本地链接 IPv6 地址. . . . . . . . : fe80::34d5:4b52:1627:64dc%14</span></span><br><span class=\"line\">  <span class=\"comment\"># 本地链接 IPv6 地址. . . . . . . . : fe80::50fc:1560:33a5:b73f%5</span></span><br><span class=\"line\">ipconfig | Select-String <span class=\"string\">\"以太网\"</span></span><br><span class=\"line\">  <span class=\"comment\"># 以太网适配器 以太网:</span></span><br><span class=\"line\">  <span class=\"comment\"># 以太网适配器 VMware Network Adapter VMnet1:</span></span><br><span class=\"line\">  <span class=\"comment\"># 以太网适配器 VMware Network Adapter VMnet8:</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.查找区分大小写的匹配项(默认不区分大小写)</span></span><br><span class=\"line\"><span class=\"comment\"># SimpleMatch是一个可选参数，指定模式中的字符串不被解释为正则表达式。</span></span><br><span class=\"line\"><span class=\"string\">'Hello'</span>, <span class=\"string\">'HELLO'</span> | Select-String -Pattern <span class=\"string\">'HELLO'</span> -CaseSensitive -SimpleMatch</span><br><span class=\"line\">HELLO</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.在文本文件中查找匹配项(简单通配符|正则匹配)</span></span><br><span class=\"line\">Get-Alias | Out-File -FilePath .\\Alias.txt</span><br><span class=\"line\">Get-Command | Out-File -FilePath .\\Command.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Simple Match</span></span><br><span class=\"line\">Select-String -Path .\\*.txt -Pattern <span class=\"string\">'Get-'</span> -SimpleMatch</span><br><span class=\"line\">  <span class=\"comment\"># Alias.txt:8:Alias            cat -&gt; Get-Content</span></span><br><span class=\"line\">  <span class=\"comment\"># Alias.txt:28:Alias           dir -&gt; Get-ChildItem</span></span><br><span class=\"line\">  <span class=\"comment\"># Alias.txt:43:Alias           gal -&gt; Get-Alias</span></span><br><span class=\"line\">  <span class=\"comment\"># Command.txt:966:Cmdlet       Get-Acl</span></span><br><span class=\"line\">  <span class=\"comment\"># Command.txt:967:Cmdlet       Get-Alias</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Find a pattern match</span></span><br><span class=\"line\">Select-String .\\Testfile1.txt -Pattern <span class=\"string\">\"Weiy|3\"</span></span><br><span class=\"line\">  <span class=\"comment\"># Testfile1.txt:1:Weiyieek</span></span><br><span class=\"line\">  <span class=\"comment\"># Testfile1.txt:4:3</span></span><br><span class=\"line\">Select-String -Path <span class=\"string\">\"<span class=\"variable\">$PSHOME</span>\\en-US\\*.txt\"</span> -Pattern <span class=\"string\">'\\?'</span></span><br><span class=\"line\">  <span class=\"comment\"># C:\\Program Files\\PowerShell\\6\\en-US\\default.help.txt:27:    beginning at https://go.microsoft.com/fwlink/?LinkID=108518.</span></span><br><span class=\"line\">  <span class=\"comment\"># C:\\Program Files\\PowerShell\\6\\en-US\\default.help.txt:50:    or go to: https://go.microsoft.com/fwlink/?LinkID=210614</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.在函数中使用Select字符串</span></span><br><span class=\"line\">PS&gt; Function Search-Help</span><br><span class=\"line\">&gt;&gt; &#123;</span><br><span class=\"line\">&gt;&gt; <span class=\"variable\">$PSHelp</span> = <span class=\"string\">\"<span class=\"variable\">$PSHOME</span>\\en-US\\*.txt\"</span></span><br><span class=\"line\">&gt;&gt; Select-String -Path <span class=\"variable\">$PSHelp</span> -Pattern <span class=\"string\">'About_'</span></span><br><span class=\"line\">&gt;&gt; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">PS&gt; Search-Help</span><br><span class=\"line\">C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\en-US\\about_ActivityCommonParameters.help.txt:2:   about_ActivityCommonParameters</span><br><span class=\"line\">C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\en-US\\about_ActivityCommonParameters.help.txt:31:  see about_WorkflowCommonParameters.</span><br><span class=\"line\">C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\en-US\\about_ActivityCommonParameters.help.txt:33:  about_CommonParameters.</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5.在Windows事件日志中搜索字符串</span></span><br><span class=\"line\"><span class=\"variable\">$Events</span> = (Get-WinEvent -LogName Application -MaxEvents 50)</span><br><span class=\"line\"><span class=\"variable\">$Events</span> | Select-String -InputObject &#123;<span class=\"variable\">$_</span>.message&#125; -Pattern <span class=\"string\">'错误'</span></span><br><span class=\"line\">  <span class=\"comment\"># “C:\\Program Files (x86)\\Google\\Update\\GoogleUpdate.exe”的激活上下文生成失败。在指令清单或策略文件“C:\\Program Files (x86)\\Google\\Update\\GoogleUpdate.exe”的第 0 行出现错误。 无效的 Xml 语法。</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 6.在子目录中查找字符串 (常用)</span></span><br><span class=\"line\">Get-ChildItem -Path C:\\Windows\\System32\\*.txt -Recurse | Select-String -Pattern <span class=\"string\">'Microsoft'</span> -CaseSensitive</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 7.查找与模式不匹配的字符串</span></span><br><span class=\"line\">Get-Command | Out-File -FilePath .\\Command.txt</span><br><span class=\"line\">Select-String -Path .\\Command.txt -Pattern <span class=\"string\">'Get'</span>, <span class=\"string\">'Set'</span> -NotMatch</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 8.查找匹配前后的行</span></span><br><span class=\"line\">Get-Command | Out-File -FilePath .\\Command.txt</span><br><span class=\"line\"><span class=\"comment\"># Context参数使用两个值before和after并用尖括号（`&gt;`）标记输出中的模式匹配。Context参数输出第一个模式匹配之前的两行和之后的三行最后的模式匹配。</span></span><br><span class=\"line\">Select-String -Path .\\Command.txt -Pattern <span class=\"string\">'Get-Computer'</span> -Context 2, 3</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 9.查找所有模式匹配</span></span><br><span class=\"line\">PS&gt; <span class=\"variable\">$A</span> = Get-ChildItem -Path <span class=\"string\">\"<span class=\"variable\">$PSHOME</span>\\en-US\\*.txt\"</span> | Select-String -Pattern <span class=\"string\">'PowerShell'</span></span><br><span class=\"line\">PS&gt; <span class=\"variable\">$A</span></span><br><span class=\"line\">  <span class=\"comment\"># C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\en-US\\about_ActivityCommonParameters.help.txt:5:    Describes the parameters that Windows PowerShell</span></span><br><span class=\"line\">  <span class=\"comment\"># C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\en-US\\about_ActivityCommonParameters.help.txt:9:    Windows PowerShell Workflow adds the activity common</span></span><br><span class=\"line\">PS&gt; <span class=\"variable\">$A</span>.Matches</span><br><span class=\"line\">  <span class=\"comment\"># Groups   : &#123;0&#125;</span></span><br><span class=\"line\">  <span class=\"comment\"># Success  : True</span></span><br><span class=\"line\">  <span class=\"comment\"># Name     : 0</span></span><br><span class=\"line\">  <span class=\"comment\"># Captures : &#123;0&#125;</span></span><br><span class=\"line\">  <span class=\"comment\"># Index    : 4</span></span><br><span class=\"line\">  <span class=\"comment\"># Length   : 10</span></span><br><span class=\"line\">  <span class=\"comment\"># Value    : PowerShell</span></span><br><span class=\"line\">PS&gt; <span class=\"variable\">$A</span>.Matches.Length</span><br><span class=\"line\">  <span class=\"comment\"># 2073</span></span><br><span class=\"line\">PS&gt; <span class=\"variable\">$B</span> = Get-ChildItem -Path <span class=\"string\">\"<span class=\"variable\">$PSHOME</span>\\en-US\\*.txt\"</span> | Select-String -Pattern <span class=\"string\">'PowerShell'</span> -AllMatches</span><br><span class=\"line\">PS&gt; <span class=\"variable\">$B</span>.Matches.Length</span><br><span class=\"line\">  <span class=\"comment\"># 2200</span></span><br><span class=\"line\"><span class=\"comment\"># 长度属性增加，因为对于每一行，模式PowerShell的每一次出现都会被计数。</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 10.从文本文件中获取前几行或者后几行</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"ServerId = VMlinux-b71655e1</span></span><br><span class=\"line\"><span class=\"string\">DatabaseId = db-ecb2e784</span></span><br><span class=\"line\"><span class=\"string\">Status = completed</span></span><br><span class=\"line\"><span class=\"string\">LocationId = 344067960796</span></span><br><span class=\"line\"><span class=\"string\">DatabaseSize = 30</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">ServerId = VMlinux-0db8d45b</span></span><br><span class=\"line\"><span class=\"string\">DatabaseId = db-cea2f7a6</span></span><br><span class=\"line\"><span class=\"string\">Status = completed</span></span><br><span class=\"line\"><span class=\"string\">LocationId = 344067960796</span></span><br><span class=\"line\"><span class=\"string\">DatabaseSize = 35</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">ServerId = VMlinux-c5388693</span></span><br><span class=\"line\"><span class=\"string\">DatabaseId = db-9a421bf2</span></span><br><span class=\"line\"><span class=\"string\">Status = completed</span></span><br><span class=\"line\"><span class=\"string\">LocationId = 344067960796</span></span><br><span class=\"line\"><span class=\"string\">DatabaseSize = 8</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">etc\"</span> &gt; result.txt</span><br><span class=\"line\"><span class=\"comment\"># 此处获取匹配得字符串上方得前三行</span></span><br><span class=\"line\">(gc result.txt | Select-String <span class=\"string\">'DatabaseSize = 35'</span> -Context 3).context.precontext</span><br><span class=\"line\">  <span class=\"comment\"># DatabaseId = db-cea2f7a6</span></span><br><span class=\"line\">  <span class=\"comment\"># Status = completed</span></span><br><span class=\"line\">  <span class=\"comment\"># LocationId = 344067960796</span></span><br><span class=\"line\"><span class=\"comment\"># 此处获取匹配得字符串下方得后三行</span></span><br><span class=\"line\">(gc result.txt | Select-String <span class=\"string\">'DatabaseSize = 35'</span> -Context 3).context.precontext</span><br><span class=\"line\">  <span class=\"comment\"># </span></span><br><span class=\"line\">  <span class=\"comment\"># ServerId = VMlinux-c5388693</span></span><br><span class=\"line\">  <span class=\"comment\"># DatabaseId = db-9a421bf2</span></span><br></pre></td></tr></table></figure></p>\n<p> PowerShell 文本处理实例(三) 4 </p>\n<p>原始文本：”data1″:111,”data2″:22,”data3″:3,”data4″:4444444,”data5″:589</p>\n<p>要求：转换成对象<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$rawTxt</span>=<span class=\"string\">'\"data1\":111,\"data2\":22,\"data3\":3,\"data4\":4444444'</span></span><br><span class=\"line\"><span class=\"variable\">$rawTxt</span> -split <span class=\"string\">','</span> | ForEach-Object &#123;</span><br><span class=\"line\">   <span class=\"variable\">$temp</span>= <span class=\"variable\">$_</span> -split <span class=\"string\">':'</span></span><br><span class=\"line\">   <span class=\"string\">\"&#123;0&#125;=&#123;1&#125;\"</span> -f <span class=\"variable\">$temp</span>[0].Substring(1,<span class=\"variable\">$temp</span>[0].Length-2),<span class=\"variable\">$temp</span>[1]</span><br><span class=\"line\">&#125; | ConvertFrom-StringData</span><br></pre></td></tr></table></figure><br>结果:<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Name                           Value</span><br><span class=\"line\">----                           -----</span><br><span class=\"line\">data1                          111</span><br><span class=\"line\">data2                          22</span><br><span class=\"line\">data3                          3</span><br><span class=\"line\">data4                          4444444</span><br></pre></td></tr></table></figure></p>\n<p>XML节点选择:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#$xml = [xml](Get-Content \"c:\\folder\\app.config\") </span></span><br><span class=\"line\"><span class=\"variable\">$xml</span> = [xml]@<span class=\"string\">\" </span></span><br><span class=\"line\"><span class=\"string\">&lt;?xml version=\"</span>1.0<span class=\"string\">\" encoding=\"</span>utf-8<span class=\"string\">\"?&gt; </span></span><br><span class=\"line\"><span class=\"string\">&lt;configuration&gt; </span></span><br><span class=\"line\"><span class=\"string\">    &lt;appSettings&gt; </span></span><br><span class=\"line\"><span class=\"string\">    &lt;add key=\"</span>IIS_VERSION<span class=\"string\">\" value=\"</span>8<span class=\"string\">\" /&gt; </span></span><br><span class=\"line\"><span class=\"string\">    &lt;add key=\"</span>somekey<span class=\"string\">\" value=\"</span>somevalue<span class=\"string\">\" /&gt; </span></span><br><span class=\"line\"><span class=\"string\">    &lt;/appSettings&gt; </span></span><br><span class=\"line\"><span class=\"string\">&lt;/configuration&gt; </span></span><br><span class=\"line\"><span class=\"string\">\"</span>@ </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$IISVersion</span> = <span class=\"variable\">$xml</span>.SelectSingleNode(<span class=\"string\">\"//add[@key='IIS_VERSION']\"</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"variable\">$IISVersion</span>.Value -eq 7) </span><br><span class=\"line\">&#123; </span><br><span class=\"line\">    Write-Host <span class=\"string\">\"IIS's version is already 7\"</span> </span><br><span class=\"line\">&#125; </span><br><span class=\"line\"><span class=\"keyword\">else</span> </span><br><span class=\"line\">&#123; </span><br><span class=\"line\">    Write-Host <span class=\"string\">\"Update IIS version to 7\"</span> </span><br><span class=\"line\">    <span class=\"variable\">$IISVersion</span>.Value = <span class=\"string\">\"7\"</span> </span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$xml</span>.Save(<span class=\"string\">\"c:\\folder\\app.config\"</span>)</span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Development","path":"api/categories/Development.json"}],"tags":[{"name":"Powershell","path":"api/tags/Powershell.json"}]}