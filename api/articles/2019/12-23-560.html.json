{"title":"PS命令之操作系统远程管理及进程服务操作示例","slug":"编程世界/Powershell/Cmdlet/系统管理类命令/PS命令之操作系统远程管理及进程服务操作示例","date":"2019-12-23T08:36:30.000Z","updated":"2022-03-29T05:39:06.297Z","url":"2019/12-23-560.html","path":"api/articles/2019/12-23-560.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210511171309.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<p><br></p>\n<h4 id=\"命令\"><a href=\"#命令\" class=\"headerlink\" title=\"命令 -\"></a>命令 -</h4><p><strong>基础语法:</strong><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>简单示例:</strong><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>[TOC]</p>\n<h2 id=\"0x00-系统远程访问管理\"><a href=\"#0x00-系统远程访问管理\" class=\"headerlink\" title=\"0x00 系统远程访问管理\"></a>0x00 系统远程访问管理</h2><h3 id=\"Enable-PSRemoting-命令-将计算机配置为接收远程命令。\"><a href=\"#Enable-PSRemoting-命令-将计算机配置为接收远程命令。\" class=\"headerlink\" title=\"Enable-PSRemoting 命令 - 将计算机配置为接收远程命令。\"></a>Enable-PSRemoting 命令 - 将计算机配置为接收远程命令。</h3><p>描述: 该cmdlet将计算机配置为接收通过使用WS-Management技术发送的PowerShell远程命令。当前仅在Windows平台上支持基于WS-Management的PowerShell远程处理(此cmdlet在Linux或MacOS版本的PowerShell中不可用)。</p>\n<p>Tips : Windows Server 平台上默认启用PowerShell远程处理, 通常不允许在计算机位于公用网络上时在Windows客户端版本上启用PowerShell远程处理，但是您可以使用<code>SkipNetworkProfileCheck</code> 参数跳过此限制<br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看服务状态</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Service</span> -Name WinRM</span><br><span class=\"line\">  <span class=\"comment\"># Status   Name               DisplayName</span></span><br><span class=\"line\">  <span class=\"comment\"># ------   ----               -----------</span></span><br><span class=\"line\">  <span class=\"comment\"># Running  WinRM              Windows Remote Management (WS-Manag...</span></span><br></pre></td></tr></table></figure></p>\n<p><strong>该cmdlet会执行以下操作：</strong></p>\n<ul>\n<li>运行Set-WSManQuickConfig cmdlet，该cmdlet执行以下任务：<ul>\n<li>启动WinRM服务。</li>\n<li>将WinRM服务上的启动类型设置为“自动”。</li>\n<li>创建一个侦听器以接受任何IP地址上的请求。</li>\n<li>为WS-Management通信启用防火墙例外。</li>\n<li>如果需要，创建简单和长名称会话端点配置。</li>\n<li>启用所有会话配置。</li>\n<li>更改所有会话配置的安全描述符，以允许远程访问。</li>\n</ul>\n</li>\n<li>重新启动WinRM服务以使前面的更改生效。</li>\n</ul>\n<p><strong>语法参数:</strong><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Enable-PSRemoting</span> [-Force] [-SkipNetworkProfileCheck] [-WhatIf] [-Confirm] [&lt;CommonParameters&gt;]</span><br></pre></td></tr></table></figure></p>\n<p><strong>基础示例:</strong><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 0.配置计算机以接收远程命令(需要远程确认)</span></span><br><span class=\"line\"><span class=\"built_in\">Enable-PSRemoting</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 1. 在服务器上以管理员权限运行启用PowerShell远程访问(配置计算机以在没有确认提示的情况下接收远程命令)</span></span><br><span class=\"line\"><span class=\"built_in\">Enable-PSRemoting</span> -Force</span><br><span class=\"line\"><span class=\"built_in\">Enable-PSRemoting</span> -SkipNetworkProfileCheck -Force  <span class=\"comment\"># 在计算机位于公用网络上时在Windows客户端版本上启用PowerShell远程处理</span></span><br><span class=\"line\">  <span class=\"comment\"># 在此计算机上设置了 WinRM 以接收请求。</span></span><br><span class=\"line\">  <span class=\"comment\"># WinRM 已经进行了更新，以用于远程管理。</span></span><br><span class=\"line\">  <span class=\"comment\"># WinRM 防火墙异常已启用。</span></span><br><span class=\"line\">  <span class=\"comment\"># 已配置 LocalAccountTokenFilterPolicy 以远程向本地用户授予管理权限。</span></span><br><span class=\"line\">  <span class=\"comment\"># 警告: 正在等待服务“Windows Remote Management (WS-Management) (winrm)”停止.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.如何在Windows操作系统的客户端版本上允许从公共网络进行远程访问,对于不同版本的Windows，防火墙规则的名称可能不同;</span></span><br><span class=\"line\"><span class=\"comment\"># NetSecurity模块中的Set-NetFirewallRulecmdlet添加了防火墙规则，该规则允许从任何远程位置从公共网络进行远程访问</span></span><br><span class=\"line\">Get-NetFirewallRule -Name <span class=\"string\">'WINRM*'</span> | <span class=\"built_in\">Select-Object</span> Name </span><br><span class=\"line\">  <span class=\"comment\"># Name</span></span><br><span class=\"line\">  <span class=\"comment\"># ----</span></span><br><span class=\"line\">  <span class=\"comment\"># WINRM-HTTP-In-TCP-NoScope</span></span><br><span class=\"line\">  <span class=\"comment\"># WINRM-HTTP-In-TCP</span></span><br><span class=\"line\">  <span class=\"comment\"># WINRM-HTTP-Compat-In-TCP-NoScope</span></span><br><span class=\"line\">  <span class=\"comment\"># WINRM-HTTP-Compat-In-TCP</span></span><br><span class=\"line\"><span class=\"comment\"># 建议指定远程连接的主机</span></span><br><span class=\"line\">Set-NetFirewallRule -Name <span class=\"string\">\"WINRM-HTTP-In-TCP-NoScope\"</span> -RemoteAddress <span class=\"number\">10.20</span>.<span class=\"number\">172.103</span></span><br><span class=\"line\"><span class=\"comment\"># 如果安全组有限制， 请开放对此机器入方向的5985（HTTP)和5986(HTTPS)端口。</span></span><br><span class=\"line\">New-NetFirewallRule -Name powershell-remote-tcp -Direction Inbound -DisplayName <span class=\"string\">'PowerShell远程连接 TCP'</span> -LocalPort <span class=\"number\">5985</span>-<span class=\"number\">5996</span> -Protocol <span class=\"string\">'TCP'</span> -RemoteAddress <span class=\"number\">192.168</span>.<span class=\"number\">1.254</span></span><br><span class=\"line\">New-NetFirewallRule -Name powershell-remote-udp -Direction Inbound -DisplayName <span class=\"string\">'PowerShell远程连接 UDP'</span> -LocalPort <span class=\"number\">5985</span>-<span class=\"number\">5996</span> -Protocol <span class=\"string\">'UDP'</span> -RemoteAddress <span class=\"number\">192.168</span>.<span class=\"number\">1.254</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.在客户端机器上（需要远程连接被管理的机器上）运行以下命令以接受被管理的机器是受信任的 (如果想管理任何机器请设置为*), 运行以下命令必须是管理员权限</span></span><br><span class=\"line\">PS &gt; <span class=\"built_in\">Get-Service</span> -Name WinRM | <span class=\"built_in\">Start-Service</span></span><br><span class=\"line\">PS &gt; <span class=\"built_in\">Set-Item</span> WSMan:localhost\\client\\trustedhosts -value <span class=\"number\">10.20</span>.<span class=\"number\">172.106</span> -Force</span><br><span class=\"line\">PS &gt; <span class=\"built_in\">Enter-PSSession</span> -ComputerName <span class=\"number\">10.20</span>.<span class=\"number\">172.106</span> -Credential weiyigeek</span><br><span class=\"line\">  <span class=\"comment\"># [10.20.172.106]: PS C:\\Users\\WeiyiGeek\\Documents&gt; hostname</span></span><br><span class=\"line\">  <span class=\"comment\"># Security</span></span><br><span class=\"line\">  <span class=\"comment\"># [10.20.172.106]: PS C:\\Users\\WeiyiGeek\\Documents&gt; Get-NetAdapter</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Name                      InterfaceDescription                    ifIndex Status       MacAddress             LinkSpeed</span></span><br><span class=\"line\">  <span class=\"comment\"># ----                      --------------------                    ------- ------       ----------             ---------</span></span><br><span class=\"line\">  <span class=\"comment\"># VMware Network Adapte...1 VMware Virtual Ethernet Adapter for ...      16 Up           00-50-56-C0-00-01       100 Mbps</span></span><br><span class=\"line\">  <span class=\"comment\"># 以太网                       Intel(R) Ethernet Connection (11) I2...      12 Up           B0-7B-25-05-9E-DE         1 Gbps</span></span><br><span class=\"line\">  <span class=\"comment\"># VMware Network Adapte...8 VMware Virtual Ethernet Adapter for ...       4 Up           00-50-56-C0-00-08       100 Mbps</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>问题1.如在被控制机器上执行时出现如下<code>Set-WSManQuickConfig</code>错误时请将网络连接类型更改为域或专用然后再次尝试.</strong><br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Set-WSManQuickConfig : <span class=\"tag\">&lt;<span class=\"name\">f:WSManFault</span> <span class=\"attr\">xmlns:f</span>=<span class=\"string\">\"http://schemas.microsoft.com/wbem/wsman/1/wsmanfault\"</span> <span class=\"attr\">Code</span>=<span class=\"string\">\"2150859113\"</span> <span class=\"attr\">Machine</span>=<span class=\"string\">\"localhost\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">f:Message</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">f:ProviderFault</span> <span class=\"attr\">provider</span>=<span class=\"string\">\"Config provider\"</span> <span class=\"attr\">path</span>=<span class=\"string\">\"%systemroot%\\system32\\WsmSvc.dll\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">f:WSManFault</span> <span class=\"attr\">xmlns:f</span>=<span class=\"string\">\"http://schemas.microsoft.com/wbem/wsman/1/wsmanfault\"</span> <span class=\"attr\">Code</span>=<span class=\"string\">\"2150859113\"</span> <span class=\"attr\">Machine</span>=<span class=\"string\">\"Security\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">f:Message</span>&gt;</span>由于此计算机上的网络连接类型之一设置为公用，因此 WinRM 防火墙例外将不运行。  <span class=\"tag\">&lt;/<span class=\"name\">f:Message</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">f:WSManFault</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">f:ProviderFault</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">f:Message</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">f:WSManFault</span>&gt;</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210511171309.png\" alt=\"WeiyiGeek.专用网络配置\" title=\"\" class=\"\">\n                <p>WeiyiGeek.专用网络配置</p>\n            </figure></p>\n<p><strong>问题2.如在客户端机器上执行set-Item命令出现如下Set-Item : 客户端无法连接到请求中指定的目标错误时,请开启客户端的启动 WinRM 服务。</strong><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Set-Item</span> WSMan:localhost\\client\\trustedhosts -value <span class=\"number\">10.20</span>.<span class=\"number\">172.106</span> -Force</span><br><span class=\"line\"><span class=\"built_in\">Set-Item</span> : 客户端无法连接到请求中指定的目标。 请验证该目标上的服务是否正在运行以及是否正在接受请求。 有关目标(通常是 IIS 或 WinRM)上运行的 WS 管理服务，请查阅日志和文档。 如果目标是 WinRM 服务，则在目标上运行以下命令来分析和配置 WinRM 服务: <span class=\"string\">\"winrm quickconfig\"</span>。</span><br></pre></td></tr></table></figure><br>解决办法: <code>Get-Service -Name WinRM | Start-Service</code></p>\n<p><br></p>\n<h3 id=\"Disable-PSRemoting-命令-禁用Windows-PowerShell远程会话配置\"><a href=\"#Disable-PSRemoting-命令-禁用Windows-PowerShell远程会话配置\" class=\"headerlink\" title=\"Disable-PSRemoting 命令 - 禁用Windows PowerShell远程会话配置\"></a>Disable-PSRemoting 命令 - 禁用Windows PowerShell远程会话配置</h3><p>描述: 该cmdlet阻止对本地计算机上所有PowerShell版本和更高会话会话配置的远程访问,同样需要使用“以管理员身份运行” 选项启动。</p>\n<p><strong>语法参数:</strong><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Disable-PSRemoting</span> [-Force] [-WhatIf] [-Confirm] [&lt;CommonParameters&gt;]</span><br></pre></td></tr></table></figure></p>\n<p><strong>基础示例:</strong><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 示例1：阻止对所有PowerShell会话配置的远程访问</span></span><br><span class=\"line\"><span class=\"built_in\">Disable-PSRemoting</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 示例2：在没有确认提示的情况下阻止对所有PowerShell会话配置的远程访问</span></span><br><span class=\"line\"><span class=\"built_in\">Disable-PSRemoting</span> -Force</span><br><span class=\"line\"><span class=\"comment\"># 禁用会话配置后，该New-PSSessioncmdlet尝试创建到本地计算机的远程会话（也称为“环回”）。</span></span><br><span class=\"line\"><span class=\"comment\"># 由于在本地计算机上禁用了远程访问，因此该命令将失败</span></span><br><span class=\"line\"><span class=\"built_in\">New-PSSession</span> -ComputerName localhost -ConfigurationName PowerShell.<span class=\"number\">6</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 示例4：运行此cmdlet和Enable-PSRemoting的效果</span></span><br><span class=\"line\"><span class=\"built_in\">Disable-PSRemoting</span> -force</span><br><span class=\"line\"><span class=\"built_in\">Get-PSSessionConfiguration</span> | <span class=\"built_in\">Format-Table</span> -Property Name, Permission -Auto</span><br><span class=\"line\">  <span class=\"comment\"># Name               Permission</span></span><br><span class=\"line\">  <span class=\"comment\"># ----               ----------</span></span><br><span class=\"line\">  <span class=\"comment\"># PowerShell.6       NT AUTHORITY\\NETWORK AccessDenied, NT AUTHORITY\\INTERACTIVE AccessAllowed, BUILTIN\\Administrators AccessAllowed ...</span></span><br><span class=\"line\">  <span class=\"comment\"># PowerShell.6.2.0   NT AUTHORITY\\NETWORK AccessDenied, NT AUTHORITY\\INTERACTIVE AccessAllowed, BUILTIN\\Administrators AccessAllowed ...</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新的输出显示AccessDenied安全描述符已从所有会话配置中删除,此时便可以正常的创建远程连接会话了。</span></span><br><span class=\"line\"><span class=\"built_in\">Enable-PSRemoting</span> -Force</span><br><span class=\"line\"><span class=\"built_in\">Get-PSSessionConfiguration</span> | <span class=\"built_in\">Format-Table</span> -Property Name, Permission -Auto</span><br><span class=\"line\">  <span class=\"comment\"># Name               Permission</span></span><br><span class=\"line\">  <span class=\"comment\"># ----               ----------</span></span><br><span class=\"line\">  <span class=\"comment\"># PowerShell.6       NT AUTHORITY\\INTERACTIVE AccessAllowed, BUILTIN\\Administrators AccessAllowed ...</span></span><br><span class=\"line\">  <span class=\"comment\"># PowerShell.6.2.0   NT AUTHORITY\\INTERACTIVE AccessAllowed, BUILTIN\\Administrators AccessAllowed ...</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 示例5：具有禁用的会话端点配置的环回连接</span></span><br><span class=\"line\"><span class=\"built_in\">Disable-PSRemoting</span> -Force</span><br><span class=\"line\"><span class=\"comment\"># 第一次会话创建尝试: 凭据通过Credential参数显式传递给命令, 这种类型的连接通过网络堆栈，而不是环回。因此与禁用端点的连接尝试失败，并显示“拒绝访问”错误。</span></span><br><span class=\"line\"><span class=\"built_in\">New-PSSession</span> -ComputerName localhost -ConfigurationName powershell.<span class=\"number\">6</span> -Credential (<span class=\"built_in\">Get-Credential</span>)</span><br><span class=\"line\"><span class=\"comment\"># 第二次会话创建尝试: 它是成功的因为它是绕过网络堆栈的环回连接。</span></span><br><span class=\"line\"><span class=\"built_in\">New-PSSession</span> -ComputerName localhost -ConfigurationName powershell.<span class=\"number\">6</span> -EnableNetworkAccess</span><br><span class=\"line\">  <span class=\"comment\"># Id Name       Transport ComputerName  ComputerType   State   ConfigurationName   Availability</span></span><br><span class=\"line\">  <span class=\"comment\"># -- ----       --------- ------------  ------------   -----   -----------------   ------------</span></span><br><span class=\"line\">  <span class=\"comment\"># 1  Runspace1  WSMan     localhost     RemoteMachine  Opened  powershell.6           Available</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 示例6：阻止对具有自定义安全描述符的会话配置的远程访问</span></span><br><span class=\"line\"><span class=\"comment\"># Register-PSSessionConfiguration创建测试会话配置, 该文件路径参数指定自定义会话的会话配置文件, 该 ShowSecurityDescriptorUI参数显示一个对话框为会话配置的权限集</span></span><br><span class=\"line\"><span class=\"built_in\">Register-PSSessionConfiguration</span> -Name Test -FilePath .\\TestEndpoint.pssc -ShowSecurityDescriptorUI -Force</span><br><span class=\"line\"><span class=\"built_in\">Get-PSSessionConfiguration</span> | <span class=\"built_in\">Format-Table</span> -Property Name, Permission -Wrap</span><br><span class=\"line\"><span class=\"comment\"># 现在Get-PSSessionConfigurationand和Format-Tablecmdlet显示将 所有网络用户的AccessDenied安全描述符添加到所有会话配置中，包括 测试会话配置。尽管其他安全描述符未更改，但“ network_deny_all”安全描述符优先</span></span><br><span class=\"line\">  <span class=\"comment\"># Name               Permission</span></span><br><span class=\"line\">  <span class=\"comment\"># ----               ----------</span></span><br><span class=\"line\">  <span class=\"comment\"># PowerShell.6       NT AUTHORITY\\INTERACTIVE AccessAllowed, BUILTIN\\Administrators AccessAllowed,</span></span><br><span class=\"line\">  <span class=\"comment\">#                   BUILTIN\\Remote Management Users AccessAllowed</span></span><br><span class=\"line\">  <span class=\"comment\"># PowerShell.6.2.0   NT AUTHORITY\\INTERACTIVE AccessAllowed, BUILTIN\\Administrators AccessAllowed,</span></span><br><span class=\"line\">  <span class=\"comment\">#                   BUILTIN\\Remote Management Users AccessAllowed</span></span><br><span class=\"line\">  <span class=\"comment\"># Test               NT AUTHORITY\\INTERACTIVE AccessAllowed, BUILTIN\\Administrators AccessAllowed,</span></span><br><span class=\"line\">  <span class=\"comment\">#                   User01 AccessAllowed</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 示例7：重新启用对选定会话配置的远程访问</span></span><br><span class=\"line\"><span class=\"comment\"># 例如：下面更改PowerShell.6会话配置利用AccessMode参数重新启用对配置的远程访问。</span></span><br><span class=\"line\"><span class=\"built_in\">Disable-PSRemoting</span> -Force</span><br><span class=\"line\"><span class=\"built_in\">Get-PSSessionConfiguration</span> | <span class=\"built_in\">Format-Table</span> -Property Name, Permission -Auto</span><br><span class=\"line\">  <span class=\"comment\"># Name                 Permission</span></span><br><span class=\"line\">  <span class=\"comment\"># ----                 ----------</span></span><br><span class=\"line\">  <span class=\"comment\"># PowerShell.6         NT AUTHORITY\\NETWORK AccessDenied(关键点), NT AUTHORITY\\INTERACTIVE AccessAllowed, BUILTIN\\Adm ...</span></span><br><span class=\"line\">  <span class=\"comment\"># PowerShell.6.2.0     NT AUTHORITY\\NETWORK AccessDenied, NT AUTHORITY\\INTERACTIVE AccessAllowed, BUILTIN\\Adm ...</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Set-PSSessionConfiguration</span> -Name PowerShell.<span class=\"number\">6</span> -AccessMode Remote -Force</span><br><span class=\"line\"><span class=\"built_in\">Get-PSSessionConfiguration</span> | <span class=\"built_in\">Format-Table</span> -Property Name, Permission -Auto</span><br><span class=\"line\">  <span class=\"comment\"># Name                 Permission</span></span><br><span class=\"line\">  <span class=\"comment\"># ----                 ----------</span></span><br><span class=\"line\">  <span class=\"comment\"># PowerShell.6         NT AUTHORITY\\INTERACTIVE AccessAllowed(关键点), BUILTIN\\Administrators AccessAllowed, BUILTIN\\ ...</span></span><br><span class=\"line\">  <span class=\"comment\"># PowerShell.6.2.0     NT AUTHORITY\\NETWORK AccessDenied, NT AUTHORITY\\INTERACTIVE AccessAllowed, BUILTIN\\Adm ..</span></span><br></pre></td></tr></table></figure></p>\n<p>Tips : 当满足以下条件时将创建回送连接，1.要连接的计算机名称是“ localhost”，2.没有凭据传入。当前登录用户（隐式凭据）用于连接，3.使用EnableNetworkAccess开关参数。</p>\n<hr>\n<h2 id=\"0x01-计算机管理配置\"><a href=\"#0x01-计算机管理配置\" class=\"headerlink\" title=\"0x01 计算机管理配置\"></a>0x01 计算机管理配置</h2><h3 id=\"Rename-Computer-命令-更改计算机名称\"><a href=\"#Rename-Computer-命令-更改计算机名称\" class=\"headerlink\" title=\"Rename-Computer 命令 - 更改计算机名称\"></a>Rename-Computer 命令 - 更改计算机名称</h3><p>描述: 此Cmdlet是在 Windows PowerShell 3.0 时加入。</p>\n<p><strong>语法说明:</strong><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Rename-Computer</span> [-NewName] &lt;System.String&gt; [-ComputerName &lt;System.String&gt;] [-DomainCredential &lt;System.Management.Automation.PSCredential&gt;] [-Force] [-LocalCredential &lt;System.Management.Automation.PSCredential&gt;] [-PassThru] [-Protocol &#123;DCOM | WSMan&#125;] [-Restart] [-WsmanAuthentication &#123;Default | Basic | Negotiate | CredSSP | Digest | Kerberos&#125;] [-Confirm] [-WhatIf] [&lt;CommonParameters&gt;]</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>简单示例</strong><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 1) 本地计算机重命名并重启计算机</span></span><br><span class=\"line\"><span class=\"built_in\">Rename-Computer</span> -NewName <span class=\"string\">\"weiyigeek\"</span> -Restart</span><br><span class=\"line\"><span class=\"built_in\">Rename-Computer</span> -NewName <span class=\"string\">\"DomainServer\"</span> -DomainCredential Domain01\\Admin01 -Restart</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 2) 远程计算机重命名</span></span><br><span class=\"line\"><span class=\"built_in\">Rename-Computer</span> -ComputerName <span class=\"string\">\"Srv01\"</span> -NewName <span class=\"string\">\"Server001\"</span> -DomainCredential Domain01\\Admin01 -Force</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"Restart-Computer-命令-在本地和远程计算机上重新启动操作系统。\"><a href=\"#Restart-Computer-命令-在本地和远程计算机上重新启动操作系统。\" class=\"headerlink\" title=\"Restart-Computer 命令 - 在本地和远程计算机上重新启动操作系统。\"></a>Restart-Computer 命令 - 在本地和远程计算机上重新启动操作系统。</h3><p>描述: 从Windows PowerShell 3.0开始，您可以等待重新启动完成，然后再运行下一个命令。指定等待超时和查询间隔，并等待重新启动的计算机上的特定服务可用。</p>\n<p><strong>基础语法:</strong><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Restart-Computer</span> [[-ComputerName] &lt;System.String[]&gt;] [[-Credential] &lt;System.Management.Automation.PSCredential&gt;] [-AsJob] [-DcomAuthentication &#123;Default | None | Connect | Call | Packet | PacketIntegrity | PacketPrivacy | Unchanged&#125;] [-Force] [-Impersonation &#123;Default</span><br><span class=\"line\">| Anonymous | Identify | Impersonate | Delegate&#125;] [-ThrottleLimit &lt;System.Int32&gt;] [-Confirm] [-WhatIf] [&lt;CommonParameters&gt;]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Restart-Computer</span> [[-ComputerName] &lt;System.String[]&gt;] [[-Credential] &lt;System.Management.Automation.PSCredential&gt;] [-DcomAuthentication &#123;Default | None | Connect | Call | Packet | PacketIntegrity | PacketPrivacy | Unchanged&#125;] [-Delay &lt;System.Int16&gt;] [-For &#123;Wmi | WinRM | PowerShell&#125;] [-Force] [-Impersonation &#123;Default | Anonymous | Identify | Impersonate | Delegate&#125;] [-Protocol &#123;DCOM | WSMan&#125;] [-Timeout &lt;System.Int32&gt;] [-Wait] [-WsmanAuthentication &#123;Basic | CredSSP | Default | Digest | Kerberos | Negotiate&#125;] [-Confirm] [-WhatIf] [&lt;CommonParameters&gt;]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 参数说明：</span></span><br><span class=\"line\">ComputerName 参数 : 指定要操作的Server01和Server02服务器名称或者IP</span><br><span class=\"line\">Force 参数 : 使每台计算机立即重新启动。</span><br><span class=\"line\">ThrottleLimit 参数 : 将命令限制为<span class=\"number\">10</span>个并发连接。</span><br><span class=\"line\">Impersonation 参数: 指定匿名以隐藏请求者的身份。</span><br><span class=\"line\">DcomAuthentication 参数 : 将PacketIntegrity指定为连接的身份验证级别。</span><br><span class=\"line\">AsJob 参数 ： 将命令作为后台作业运行。</span><br><span class=\"line\">Wait 参数 : 等待重启完成。</span><br><span class=\"line\"><span class=\"keyword\">For</span> 参数 : 指定PowerShell可以在远程计算机上运行命令。</span><br><span class=\"line\">Timeout 参数 : 指定五分钟的等待时间。</span><br><span class=\"line\">Delay 参数 : 每两秒钟查询一次远程计算机，以确定它是否重新启动。</span><br><span class=\"line\">Protocol 参数 : 指定使用WSMan协议。</span><br><span class=\"line\">WsmanAuthentication 参数 : 将身份验证方法指定为Kerberos</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>简单示例:</strong><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 1.Restart the local computer (简单且最常用)</span></span><br><span class=\"line\"><span class=\"built_in\">Restart-Computer</span></span><br><span class=\"line\"><span class=\"built_in\">Restart-Computer</span> -ComputerName localhost, Server01</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 2.Restart a remote compute</span></span><br><span class=\"line\"><span class=\"comment\"># `Restart Computer`使用ComputerName参数指定Server01。</span></span><br><span class=\"line\"><span class=\"built_in\">Restart-Computer</span> -ComputerName Server01 -Impersonation Anonymous -DcomAuthentication PacketIntegrity</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 3.作为后台作业重新启动计算机，作业对象存储在`$job`变量中`$Job`通过管道发送到获取结果的'Receive Job'cmdlet。</span></span><br><span class=\"line\"><span class=\"variable\">$Job</span> = <span class=\"built_in\">Restart-Computer</span> -ComputerName <span class=\"string\">\"Server01\"</span>, <span class=\"string\">\"Server02\"</span> -AsJob</span><br><span class=\"line\"><span class=\"variable\">$Job</span> | <span class=\"built_in\">Receive-Job</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 4.重新启动远程计算机并等待PowerShell</span></span><br><span class=\"line\"><span class=\"built_in\">Restart-Computer</span> -ComputerName Server01 -Wait -For PowerShell -Timeout <span class=\"number\">300</span> -Delay <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 5.`Get Content`使用Path参数从文本文件Domain01.txt中获取计算机名列表。计算机名存储在变量“$names”中`Get Credential`提示您输入用户名和密码，并将值存储在变量“$Creds”中`Restart Computer`使用ComputerNameCredential参数及其变量。</span></span><br><span class=\"line\"><span class=\"variable\">$Names</span> = <span class=\"built_in\">Get-Content</span> -Path C:\\Domain01.txt</span><br><span class=\"line\"><span class=\"variable\">$Creds</span> = <span class=\"built_in\">Get-Credential</span></span><br><span class=\"line\"><span class=\"built_in\">Restart-Computer</span> -ComputerName <span class=\"variable\">$Names</span> -Credential <span class=\"variable\">$Creds</span> -Force -ThrottleLimit <span class=\"number\">10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 6.使用WSMan协议重新启动计算机</span></span><br><span class=\"line\"><span class=\"built_in\">Restart-Computer</span> -ComputerName Server01 -Protocol WSMan -WsmanAuthentication Kerberos</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"Stop-Computer-命令-停止（关闭）本地和远程计算机\"><a href=\"#Stop-Computer-命令-停止（关闭）本地和远程计算机\" class=\"headerlink\" title=\"Stop-Computer 命令 - 停止（关闭）本地和远程计算机\"></a>Stop-Computer 命令 - 停止（关闭）本地和远程计算机</h3><p>描述: 使用<code>&quot;Stop Computer&quot;</code>的参数将关闭操作作为后台作业运行，指定身份验证级别和备用凭据，限制为运行命令而创建的并发连接，并强制立即关闭</p>\n<p><strong>基础语法:</strong><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Stop-Computer</span> [[-ComputerName] &lt;System.String[]&gt;] [[-Credential] &lt;System.Management.Automation.PSCredential&gt;] [-AsJob] [-Confirm] [-DcomAuthentication &#123;Default | None | Connect | Call | Packet | PacketIntegrity | PacketPrivacy | Unchanged&#125;] [-Force] [-Impersonation &#123;Default | Anonymous | Identify | Impersonate | Delegate&#125;] [-Protocol &#123;DCOM | WSMan&#125;] [-ThrottleLimit &lt;System.Int32&gt;] [-WsmanAuthentication &#123;Default | Basic | Negotiate | CredSSP | Digest | Kerberos&#125;] [-WhatIf] [&lt;CommonParameters&gt;]</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>简单示例:</strong><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Example 1: Shut down the local computer  or two remote computers </span></span><br><span class=\"line\"><span class=\"built_in\">Stop-Computer</span> -ComputerName localhost</span><br><span class=\"line\"><span class=\"built_in\">Stop-Computer</span> -ComputerName <span class=\"string\">\"Server01\"</span>, <span class=\"string\">\"Server02\"</span>, <span class=\"string\">\"localhost\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Example 2: Shut down remote computers as a background job</span></span><br><span class=\"line\"><span class=\"variable\">$j</span> = <span class=\"built_in\">Stop-Computer</span> -ComputerName <span class=\"string\">\"Server01\"</span>, <span class=\"string\">\"Server02\"</span> -AsJob</span><br><span class=\"line\"><span class=\"variable\">$results</span> = <span class=\"variable\">$j</span> | <span class=\"built_in\">Receive-Job</span></span><br><span class=\"line\"><span class=\"variable\">$results</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Example 3: Shut down a remote computer</span></span><br><span class=\"line\"><span class=\"built_in\">Stop-Computer</span> -ComputerName <span class=\"string\">\"Server01\"</span> -Impersonation Anonymous -DcomAuthentication PacketIntegrity</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Example 4: Shut down computers in a domain</span></span><br><span class=\"line\"><span class=\"variable\">$s</span> = <span class=\"built_in\">Get-Content</span> -Path ./Domain01.txt</span><br><span class=\"line\"><span class=\"variable\">$c</span> = <span class=\"built_in\">Get-Credential</span> -Credential Domain01\\Admin01</span><br><span class=\"line\"><span class=\"built_in\">Stop-Computer</span> -ComputerName <span class=\"variable\">$s</span> -Force -ThrottleLimit <span class=\"number\">10</span> -Credential <span class=\"variable\">$c</span></span><br></pre></td></tr></table></figure></p>\n<hr>\n<h2 id=\"0x02-进程查看和管理\"><a href=\"#0x02-进程查看和管理\" class=\"headerlink\" title=\"0x02 进程查看和管理\"></a>0x02 进程查看和管理</h2><h3 id=\"Get-Process-命令-获取在本地计算机或远程计算机上运行的进程\"><a href=\"#Get-Process-命令-获取在本地计算机或远程计算机上运行的进程\" class=\"headerlink\" title=\"Get-Process 命令 - 获取在本地计算机或远程计算机上运行的进程\"></a>Get-Process 命令 - 获取在本地计算机或远程计算机上运行的进程</h3><h3 id=\"Start-Process-命令-启动在本地计算机或远程计算机未运行进程\"><a href=\"#Start-Process-命令-启动在本地计算机或远程计算机未运行进程\" class=\"headerlink\" title=\"Start-Process 命令 - 启动在本地计算机或远程计算机未运行进程\"></a>Start-Process 命令 - 启动在本地计算机或远程计算机未运行进程</h3><h3 id=\"Stop-Process-命令-停止在本地计算机或远程计算机上运行的进程\"><a href=\"#Stop-Process-命令-停止在本地计算机或远程计算机上运行的进程\" class=\"headerlink\" title=\"Stop-Process 命令 - 停止在本地计算机或远程计算机上运行的进程\"></a>Stop-Process 命令 - 停止在本地计算机或远程计算机上运行的进程</h3><h3 id=\"Wait-Process-命令-使在本地计算机或远程计算机上运行的进程等待\"><a href=\"#Wait-Process-命令-使在本地计算机或远程计算机上运行的进程等待\" class=\"headerlink\" title=\"Wait-Process 命令 - 使在本地计算机或远程计算机上运行的进程等待\"></a>Wait-Process 命令 - 使在本地计算机或远程计算机上运行的进程等待</h3><h3 id=\"Debug-Process-命令-调试本地计算机上运行的一个或多个进程。\"><a href=\"#Debug-Process-命令-调试本地计算机上运行的一个或多个进程。\" class=\"headerlink\" title=\"Debug-Process 命令 - 调试本地计算机上运行的一个或多个进程。\"></a>Debug-Process 命令 - 调试本地计算机上运行的一个或多个进程。</h3><p>描述: Debug Process cmdlet将调试器附加到本地计算机上一个或多个正在运行的进程。可以通过进程名称或进程ID（PID）指定进程，也可以将进程对象通过管道传送到此cmdlet。</p>\n<p>描述: 进程与服务常用cmdlet命令:<br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1.获取进程相关的cmdlet命令</span></span><br><span class=\"line\">PS &gt; (<span class=\"built_in\">Get-Command</span> *-Process).Name  <span class=\"comment\">#值得学习</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Process</span></span><br><span class=\"line\"><span class=\"built_in\">Start-Process</span></span><br><span class=\"line\"><span class=\"built_in\">Stop-Process</span></span><br><span class=\"line\"><span class=\"built_in\">Wait-Process</span></span><br><span class=\"line\"><span class=\"built_in\">Debug-Process</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>基础语法</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - Get-Process</span></span><br><span class=\"line\">Get-Process [[-Name] &lt;System.String[]&gt;] [-ComputerName &lt;System.String[]&gt;] [-FileVersionInfo] [-Module] [&lt;CommonParameters&gt;] -Id &lt;System.Int32[]&gt; -IncludeUserName [&lt;CommonParameters&gt;] -InputObject &lt;System.Diagnostics.Process[]&gt; [&lt;CommonParameters&gt;]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - Start-Process</span></span><br><span class=\"line\">Start-Process [-FilePath] &lt;System.String&gt; [[-ArgumentList] &lt;System.String[]&gt;] [-Credential &lt;System.Management.Automation.PSCredential&gt;] [-LoadUserProfile] [-NoNewWindow] [-PassThru] [-RedirectStandardError &lt;System.String&gt;] [-RedirectStandardInput &lt;System.String&gt;] [-RedirectStandardOutput &lt;System.String&gt;] [-UseNewEnvironment] [-Wait] [-WindowStyle &#123;Normal | Hidden | Minimized | Maximized&#125;] [-WorkingDirectory &lt;System.String&gt;] [&lt;CommonParameters&gt;]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - Wait-Process </span></span><br><span class=\"line\">Wait-Process [-Id] &lt;System.Int32[]&gt; [-Name] &lt;System.String[]&gt;  [[-Timeout] &lt;System.Int32&gt;] [&lt;CommonParameters&gt;] -InputObject &lt;System.Diagnostics.Process[]&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - Stop-Process</span></span><br><span class=\"line\">Stop-Process [-Id] &lt;System.Int32[]&gt; -Name &lt;System.String[]&gt; [-InputObject] &lt;System.Diagnostics.Process[] [-Force] [-PassThru] [-Confirm] [-WhatIf] [&lt;CommonParameters&gt;]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - Debug-Process</span></span><br><span class=\"line\">Debug-Process [-Id] &lt;System.Int32[]&gt; [-Name] &lt;System.String[]&gt; -InputObject &lt;System.Diagnostics.Process[]&gt; [-Confirm] [-WhatIf] [&lt;CommonParameters&gt;]</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>基础示例:</strong></p>\n<ul>\n<li><p>1) Get-Process 基础使用</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.获取进程 (gps / ps)相关信息</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Process</span> -Id <span class=\"number\">5600</span></span><br><span class=\"line\"><span class=\"built_in\">get-Process</span> -Name notepad  <span class=\"comment\">#获取指定运行经常的消息</span></span><br><span class=\"line\">  <span class=\"comment\"># Handles  NPM(K)    PM(K)      WS(K) VM(M)   CPU(s)     Id ProcessName                   </span></span><br><span class=\"line\">  <span class=\"comment\"># -------  ------    -----      ----- -----   ------     -- -----------                   </span></span><br><span class=\"line\">  <span class=\"comment\">#     467      37    20916      50980   248     2.01   5600 notepad   </span></span><br><span class=\"line\"><span class=\"built_in\">Get-Process</span> notepad, explorer | <span class=\"built_in\">Format-List</span> * <span class=\"comment\"># 获取有关一个或多个进程的所有可用数据</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Process</span> | <span class=\"built_in\">Where-Object</span> &#123;<span class=\"variable\">$_</span>.WorkingSet <span class=\"nomarkup\">-gt</span> <span class=\"number\">20000000</span>&#125; <span class=\"comment\"># 获取工作集大于指定大小的所有进程</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Process</span> | <span class=\"built_in\">Where-Object</span> &#123;<span class=\"variable\">$_</span>.Name <span class=\"nomarkup\">-eq</span> <span class=\"string\">\"notepad\"</span> -or <span class=\"variable\">$_</span>.Name <span class=\"nomarkup\">-eq</span> <span class=\"string\">\"iexplore\"</span>&#125;  <span class=\"comment\"># 根据进程名过滤所有记事本进程以及IE进程。</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Process</span> | <span class=\"built_in\">Where-Object</span> &#123;<span class=\"variable\">$_</span>.company <span class=\"nomarkup\">-like</span> <span class=\"string\">'*Microsoft*'</span> &#125; | select Name,Description,Company <span class=\"comment\"># 根据company过滤所有产品发布者以”Microsoft”打头的进程</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Process</span> | select -First <span class=\"number\">1</span> | <span class=\"built_in\">Format-List</span> *  <span class=\"comment\"># 通过每个Process对象的属性进行过滤并获取第一个对象的属性</span></span><br><span class=\"line\">  <span class=\"comment\"># Name                       : ApplicationFrameHost</span></span><br><span class=\"line\">  <span class=\"comment\"># Id                         : 4756</span></span><br><span class=\"line\">  <span class=\"comment\"># PriorityClass              : Normal</span></span><br><span class=\"line\">  <span class=\"comment\"># FileVersion                : 10.0.19041.746 (WinBuild.160101.0800)</span></span><br><span class=\"line\">  <span class=\"comment\"># HandleCount                : 510</span></span><br><span class=\"line\">  <span class=\"comment\"># WorkingSet                 : 42315776</span></span><br><span class=\"line\">  <span class=\"comment\"># PagedMemorySize            : 17203200</span></span><br><span class=\"line\">  <span class=\"comment\"># PrivateMemorySize          : 17203200</span></span><br><span class=\"line\">  <span class=\"comment\"># VirtualMemorySize          : 385449984</span></span><br><span class=\"line\">  <span class=\"comment\"># TotalProcessorTime         : 00:14:45.3750000</span></span><br><span class=\"line\">  <span class=\"comment\"># SI                         : 1</span></span><br><span class=\"line\">  <span class=\"comment\"># Handles                    : 510</span></span><br><span class=\"line\">  <span class=\"comment\"># VM                         : 2203703672832</span></span><br><span class=\"line\">  <span class=\"comment\"># WS                         : 42315776</span></span><br><span class=\"line\">  <span class=\"comment\"># PM                         : 17203200</span></span><br><span class=\"line\">  <span class=\"comment\"># NPM                        : 33360</span></span><br><span class=\"line\">  <span class=\"comment\"># Path                       : C:\\WINDOWS\\system32\\ApplicationFrameHost.exe</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Process</span> | <span class=\"built_in\">Format-Table</span> -View priority <span class=\"comment\"># 按优先级分组列出计算机上的进程</span></span><br><span class=\"line\">  <span class=\"comment\"># PriorityClass:Idle</span></span><br><span class=\"line\">  <span class=\"comment\"># ProcessName                  Id   HandleCount WorkingSet64</span></span><br><span class=\"line\">  <span class=\"comment\"># -----------                  --   ----------- ------------</span></span><br><span class=\"line\">  <span class=\"comment\"># firefox                   20764           847    177819648</span></span><br><span class=\"line\">  <span class=\"comment\"># firefox                   21368          1343    157007872</span></span><br><span class=\"line\"><span class=\"comment\"># - 向标准Get进程输出显示添加属性(值得学习)</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Process</span> notepad | <span class=\"built_in\">Format-Table</span> `</span><br><span class=\"line\">    @&#123;Label = <span class=\"string\">\"NPM(K)\"</span>; Expression = &#123;[int](<span class=\"variable\">$_</span>.NPM / <span class=\"number\">1024</span>)&#125;&#125;,</span><br><span class=\"line\">    @&#123;Label = <span class=\"string\">\"PM(K)\"</span>; Expression = &#123;[int](<span class=\"variable\">$_</span>.PM / <span class=\"number\">1024</span>)&#125;&#125;,</span><br><span class=\"line\">    @&#123;Label = <span class=\"string\">\"WS(K)\"</span>; Expression = &#123;[int](<span class=\"variable\">$_</span>.WS / <span class=\"number\">1024</span>)&#125;&#125;,</span><br><span class=\"line\">    @&#123;Label = <span class=\"string\">\"VM(M)\"</span>; Expression = &#123;[int](<span class=\"variable\">$_</span>.VM / <span class=\"number\">1</span>MB)&#125;&#125;,</span><br><span class=\"line\">    @&#123;Label = <span class=\"string\">\"CPU(s)\"</span>; Expression = &#123;<span class=\"keyword\">if</span> (<span class=\"variable\">$_</span>.CPU) &#123;<span class=\"variable\">$_</span>.CPU.ToString(<span class=\"string\">\"N\"</span>)&#125;&#125;&#125;,</span><br><span class=\"line\">    Id, MachineName, ProcessName -AutoSize</span><br><span class=\"line\">  <span class=\"comment\"># NPM(K) PM(K) WS(K)   VM(M) CPU(s)   Id MachineName ProcessName</span></span><br><span class=\"line\">  <span class=\"comment\"># ------ ----- -----   ----- ------   -- ----------- -----------</span></span><br><span class=\"line\">  <span class=\"comment\">#     15  3312 16792 2101400 0.14   4060 .           notepad</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Process</span> SQL* -Module  <span class=\"comment\"># 获取用指定进程加载的模块</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Process</span> notepad -IncludeUserName <span class=\"comment\"># 查找进程的所有者(需要管理员权限)</span></span><br><span class=\"line\">  <span class=\"comment\"># Handles      WS(K)   CPU(s)     Id UserName               ProcessName</span></span><br><span class=\"line\">  <span class=\"comment\"># -------      -----   ------     -- --------               -----------</span></span><br><span class=\"line\">  <span class=\"comment\">#     240      16732     0.14   4060 WEIYIGEEK\\WeiyiGeek    notepad</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Process</span> notepad  -FileVersionInfo <span class=\"comment\"># 获取进程的版本信息</span></span><br><span class=\"line\">  <span class=\"comment\"># ProductVersion   FileVersion      FileName</span></span><br><span class=\"line\">  <span class=\"comment\"># --------------   -----------      --------</span></span><br><span class=\"line\">  <span class=\"comment\"># 10.0.19041.980   10.0.19041.98... C:\\WINDOWS\\system32\\notepad.exe</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Process</span> pwsh   </span><br><span class=\"line\"><span class=\"built_in\">Get-Process</span> -Id <span class=\"variable\">$PID</span>  <span class=\"comment\"># 使用自动变量标识承载当前会话的进程</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>2) Start-Process 基础使用</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.此示例启动一个进程，该进程使用当前文件夹中的Sort.exe文件。该命令使用所有默认值包括默认窗口样式、工作文件夹和凭据。</span></span><br><span class=\"line\"><span class=\"built_in\">Start-Process</span> -FilePath <span class=\"string\">\"sort.exe\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.此示例启动一个进程，该进程打印C:\\PS Test\\MyFile.txt文件。</span></span><br><span class=\"line\"><span class=\"built_in\">Start-Process</span> -FilePath <span class=\"string\">\"myfile.txt\"</span> -WorkingDirectory <span class=\"string\">\"C:\\PS-Test\"</span> -Verb Print</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.示例启动了一个进程，对Testsort.txt文件中的项进行排序，并返回sorted.txt文件中的排序项,任何错误都会写入sorterrror.txt文件。</span></span><br><span class=\"line\"><span class=\"built_in\">Start-Process</span> -FilePath <span class=\"string\">\"Sort.exe\"</span> -RedirectStandardInput <span class=\"string\">\"Testsort.txt\"</span> -RedirectStandardOutput <span class=\"string\">\"Sorted.txt\"</span> -RedirectStandardError <span class=\"string\">\"SortError.txt\"</span> -UseNewEnvironment</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.启用notepad打开1.txt并使最大化窗口(# hidden)</span></span><br><span class=\"line\"><span class=\"built_in\">Start-Process</span> C:\\Windows\\System32\\notepad.exe <span class=\"number\">1</span>.txt -WindowStyle Maximized  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5.此示例使用“以管理员身份运行”选项启动PowerShell。</span></span><br><span class=\"line\"><span class=\"built_in\">Start-Process</span> -FilePath <span class=\"string\">\"powershell\"</span> -Verb RunAs</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 6.此示例演示如何查找启动进程时可以使用的动词,可用的谓词由进程中运行的文件的文件扩展名决定。</span></span><br><span class=\"line\"><span class=\"variable\">$startExe</span> = <span class=\"built_in\">New-Object</span> System.Diagnostics.ProcessStartInfo -Args PowerShell.exe</span><br><span class=\"line\"><span class=\"variable\">$startExe</span>.verbs</span><br><span class=\"line\">open</span><br><span class=\"line\">runas</span><br><span class=\"line\">runasuser</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 7.为进程指定参数</span></span><br><span class=\"line\"><span class=\"built_in\">Start-Process</span> -FilePath <span class=\"string\">\"<span class=\"variable\">$env:comspec</span>\"</span> -ArgumentList <span class=\"string\">\"/c dir `\"%systemdrive%\\program files`\"\"</span></span><br><span class=\"line\"><span class=\"built_in\">Start-Process</span> -FilePath <span class=\"string\">\"<span class=\"variable\">$env:comspec</span>\"</span> -ArgumentList <span class=\"string\">\"/c\"</span>,<span class=\"string\">\"dir\"</span>,<span class=\"string\">\"`\"%systemdrive%\\program files`\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 8.示例在Linux上启动PowerShell的后台实例，该实例即使在关闭启动会话后仍保持活动状态。nohup命令在当前目录的nohup.out文件中收集输出。</span></span><br><span class=\"line\"><span class=\"comment\"># 为了避免在类Unix平台上终止子进程，可以将Start进程与nohup结合起来。</span></span><br><span class=\"line\"><span class=\"built_in\">Start-Process</span> nohup <span class=\"string\">'pwsh -noprofile -c \"1..120 | % &#123; Write-Host . -NoNewline; sleep 1 &#125;\"'</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<ul>\n<li><p>3) Wait-Process 基础使用</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.停止进程并等待</span></span><br><span class=\"line\">PS C:\\&gt; <span class=\"variable\">$nid</span> = (<span class=\"built_in\">Get-Process</span> notepad).id</span><br><span class=\"line\">PS C:\\&gt; <span class=\"built_in\">Stop-Process</span> -Id <span class=\"variable\">$nid</span></span><br><span class=\"line\">PS C:\\&gt; <span class=\"built_in\">Wait-Process</span> -Id <span class=\"variable\">$nid</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.指定进程进行等待</span></span><br><span class=\"line\"><span class=\"built_in\">Wait-Process</span> -Id <span class=\"number\">5600</span></span><br><span class=\"line\"><span class=\"variable\">$p</span> = <span class=\"built_in\">Get-Process</span> notepad</span><br><span class=\"line\"><span class=\"built_in\">Wait-Process</span> -Id <span class=\"variable\">$p</span>.id</span><br><span class=\"line\"><span class=\"built_in\">Wait-Process</span> -InputObject <span class=\"variable\">$p</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.等待10秒，等待Outlook和notepad进程停止。如果两个进程都未停止，cmdlet将显示非终止错误并显示命令提示符。</span></span><br><span class=\"line\"><span class=\"built_in\">Wait-Process</span> -Name Outlook,notepad -Timeout <span class=\"number\">10</span></span><br></pre></td></tr></table></figure>\n<p><br></p>\n</li>\n<li><p>4) Stop-Process 基础使用</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.停止进程 ( spps / kill)</span></span><br><span class=\"line\"><span class=\"built_in\">Stop-Process</span> -ID <span class=\"number\">7960</span></span><br><span class=\"line\"><span class=\"built_in\">Stop-Process</span> -Name notepad -Force  <span class=\"comment\">#强制结束</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.进程停止的四种方法(补充)</span></span><br><span class=\"line\"><span class=\"comment\"># 纯cmdlet命令</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Process</span> -Name notepad | <span class=\"built_in\">Stop-Process</span></span><br><span class=\"line\"><span class=\"comment\"># cmdlet+遍历</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Process</span> -Name notepad | <span class=\"built_in\">foreach-object</span>&#123;<span class=\"variable\">$_</span>.Kill()&#125; </span><br><span class=\"line\"><span class=\"comment\"># WMI 对象 + 遍历 + 对象方法 </span></span><br><span class=\"line\"><span class=\"built_in\">Get-WmiObject</span> Win32_Process -Filter <span class=\"string\">\"name = 'notepad.exe'\"</span> | <span class=\"built_in\">ForEach-Object</span>&#123;<span class=\"variable\">$_</span>.Terminate()  | <span class=\"built_in\">Out-Null</span> &#125;</span><br><span class=\"line\"><span class=\"comment\"># WMI 对象 + 遍历 + cmdlet方法</span></span><br><span class=\"line\"><span class=\"built_in\">Get-WmiObject</span> Win32_Process -Filter <span class=\"string\">\"name = 'notepad.exe'\"</span> | <span class=\"built_in\">Invoke-WmiMethod</span> -Name Terminate | <span class=\"built_in\">Out-Null</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>5) Debug-Process 基础使用</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.将调试器附加到以指定字符串开头的所有进程动力壳</span></span><br><span class=\"line\"><span class=\"built_in\">Debug-Process</span> -Name <span class=\"string\">\"SQL*\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.将调试器附加到多个进程(名称或者id)</span></span><br><span class=\"line\">PS C:\\&gt; <span class=\"built_in\">Debug-Process</span> <span class=\"string\">\"Winlogon\"</span>, <span class=\"string\">\"Explorer\"</span>, <span class=\"string\">\"Outlook\"</span></span><br><span class=\"line\">PS C:\\&gt; <span class=\"built_in\">Debug-Process</span> -Id <span class=\"number\">1132</span>, <span class=\"number\">2028</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<hr>\n<h2 id=\"0x03-服务查看和管理\"><a href=\"#0x03-服务查看和管理\" class=\"headerlink\" title=\"0x03 服务查看和管理\"></a>0x03 服务查看和管理</h2><h3 id=\"Get-Service-命令-获取服务信息\"><a href=\"#Get-Service-命令-获取服务信息\" class=\"headerlink\" title=\"Get-Service 命令 - 获取服务信息\"></a>Get-Service 命令 - 获取服务信息</h3><h3 id=\"New-Service-命令-创建新的Windows服务\"><a href=\"#New-Service-命令-创建新的Windows服务\" class=\"headerlink\" title=\"New-Service 命令 - 创建新的Windows服务\"></a>New-Service 命令 - 创建新的Windows服务</h3><h3 id=\"Restart-Service-命令-重新启动服务\"><a href=\"#Restart-Service-命令-重新启动服务\" class=\"headerlink\" title=\"Restart-Service 命令 - 重新启动服务\"></a>Restart-Service 命令 - 重新启动服务</h3><h3 id=\"Resume-Service-命令-恢复挂起服务\"><a href=\"#Resume-Service-命令-恢复挂起服务\" class=\"headerlink\" title=\"Resume-Service 命令 - 恢复挂起服务\"></a>Resume-Service 命令 - 恢复挂起服务</h3><h3 id=\"Set-Service-命令-配置服务\"><a href=\"#Set-Service-命令-配置服务\" class=\"headerlink\" title=\"Set-Service 命令 - 配置服务\"></a>Set-Service 命令 - 配置服务</h3><h3 id=\"Start-Service-命令-开启服务\"><a href=\"#Start-Service-命令-开启服务\" class=\"headerlink\" title=\"Start-Service 命令 - 开启服务\"></a>Start-Service 命令 - 开启服务</h3><h3 id=\"Stop-Service-命令-停止服务\"><a href=\"#Stop-Service-命令-停止服务\" class=\"headerlink\" title=\"Stop-Service 命令 - 停止服务\"></a>Stop-Service 命令 - 停止服务</h3><h3 id=\"Suspend-Service-命令-延缓挂起服务\"><a href=\"#Suspend-Service-命令-延缓挂起服务\" class=\"headerlink\" title=\"Suspend-Service 命令 - 延缓挂起服务\"></a>Suspend-Service 命令 - 延缓挂起服务</h3><p>描述: 服务常用的cmdlet命令:<br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; (<span class=\"built_in\">Get-Command</span> *-Service).Name</span><br><span class=\"line\"><span class=\"built_in\">Get-Service</span></span><br><span class=\"line\"><span class=\"built_in\">New-Service</span></span><br><span class=\"line\"><span class=\"built_in\">Restart-Service</span></span><br><span class=\"line\"><span class=\"built_in\">Resume-Service</span> </span><br><span class=\"line\"><span class=\"built_in\">Set-Service</span></span><br><span class=\"line\"><span class=\"built_in\">Start-Service</span></span><br><span class=\"line\"><span class=\"built_in\">Stop-Service</span></span><br><span class=\"line\"><span class=\"built_in\">Suspend-Service</span></span><br></pre></td></tr></table></figure></p>\n<p>参数说明:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">StartupType : 启动类型支持的参数值(Automatic/Boot/Disabled/Manual/System)</span><br></pre></td></tr></table></figure></p>\n<p><strong>基础语法:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - New-Service</span></span><br><span class=\"line\">New-Service [-Name] &lt;System.String&gt; [-BinaryPathName] &lt;System.String&gt; [-Credential &lt;System.Management.Automation.PSCredential&gt;] [-DependsOn &lt;System.String[]&gt;] [-Description &lt;System.String&gt;] [-DisplayName &lt;System.String&gt;] [-StartupType &#123;Boot | System | Automatic | Manual | Disabled&#125;] [-Confirm] [-WhatIf] [&lt;CommonParameters&gt;]</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 参数解析 -</span></span><br><span class=\"line\">StartupType : 启动类型支持的参数值(Automatic/Boot/Disabled/Manual/System)</span><br></pre></td></tr></table></figure></p>\n<p><strong>基础信息:</strong><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.系统服务信息获取</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Service</span> -Name RpcSs</span><br><span class=\"line\"><span class=\"comment\"># Status   Name               DisplayName                      </span></span><br><span class=\"line\"><span class=\"comment\"># ------   ----               -----------        </span></span><br><span class=\"line\"><span class=\"comment\"># Running  RpcSs              Remote Procedure Call (RPC)  </span></span><br><span class=\"line\"><span class=\"built_in\">Get-Service</span> RpcSs -RequiredServices   <span class=\"comment\"># 查看其被依赖的的服务  </span></span><br><span class=\"line\"><span class=\"comment\"># Running  DcomLaunch         DCOM Server Process Launcher     </span></span><br><span class=\"line\"><span class=\"comment\"># Running  RpcEptMapper       RPC Endpoint Mapper  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Get-Service</span> | ? &#123;<span class=\"variable\">$_</span>.Name <span class=\"nomarkup\">-like</span> <span class=\"string\">\"B*\"</span>&#125;   <span class=\"comment\"># 获取以B开头的服务相关信息</span></span><br><span class=\"line\"><span class=\"built_in\">Get-service</span> | <span class=\"built_in\">Where-Object</span> &#123;<span class=\"variable\">$_</span>.Status <span class=\"nomarkup\">-eq</span> <span class=\"string\">\"Running\"</span>&#125; <span class=\"comment\"># 对象有哪些属性后就可以采取过滤 $_表示当前对象</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Service</span> w32time | Where &#123;<span class=\"variable\">$_</span>.status <span class=\"nomarkup\">-eq</span> <span class=\"string\">'Stopped'</span>&#125; |  <span class=\"built_in\">Start-Service</span>  <span class=\"comment\"># 判断w32time服务状态如果是停止状态则启动w32time服务</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"built_in\">Get-service</span> | <span class=\"built_in\">Select-Object</span> -First <span class=\"number\">1</span> | <span class=\"built_in\">Get-Member</span> -MemberType Property</span><br><span class=\"line\"><span class=\"built_in\">Get-Service</span> -Name TermService | <span class=\"built_in\">Select-Object</span> -Property *</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用 cmdlet 执行该操作（如果存在）继续操作，并启动 Windows 时间服务，但这次使用 cmdlet 启动服务。</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Service</span> -Name w32time | <span class=\"built_in\">Start-Service</span> -PassThru</span><br><span class=\"line\">  <span class=\"comment\">#显示具体属性说明(如下)</span></span><br><span class=\"line\"><span class=\"built_in\">Get-service</span> | <span class=\"built_in\">Select-Object</span> -First <span class=\"number\">1</span> | <span class=\"built_in\">Format-List</span> *          <span class=\"comment\">#显示具体的属性值</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.启动服务</span></span><br><span class=\"line\"><span class=\"built_in\">Start-Service</span> RpcSs</span><br><span class=\"line\"><span class=\"built_in\">Start-Service</span> -Name <span class=\"string\">\"*RpcSs*\"</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Service</span> w32time | <span class=\"built_in\">Start-Service</span> -PassThru</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.暂停服务</span></span><br><span class=\"line\"><span class=\"built_in\">Stop-Service</span> RpcSs -Force  <span class=\"comment\"># 强制暂停</span></span><br><span class=\"line\"><span class=\"built_in\">Get-Service</span> w32time | <span class=\"built_in\">Stop-Service</span> -PassThru</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.延缓挂起服务</span></span><br><span class=\"line\"><span class=\"built_in\">Suspend-Service</span> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5.设置服务自动启用</span></span><br><span class=\"line\"><span class=\"built_in\">Set-Service</span> -DisplayName <span class=\"string\">\"手机网络时间\"</span> -StartupType Automatic</span><br><span class=\"line\"><span class=\"built_in\">Get-Service</span> w32time</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li>New-Service<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><strong>实际案例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1) Windows 上 Prometheus 节点采集服务创建并设置防火墙访问规则</span></span><br><span class=\"line\"><span class=\"comment\"># - 自启动服务创建并且启动服务</span></span><br><span class=\"line\"><span class=\"variable\">$exporterVersion</span>=<span class=\"string\">\"0.16.0\"</span></span><br><span class=\"line\"><span class=\"variable\">$params</span> = @&#123;</span><br><span class=\"line\">  Name = <span class=\"string\">\"windows_exporter_service\"</span></span><br><span class=\"line\">  BinaryPathName = <span class=\"string\">\"d:\\pro\\windows_exporter-0.16.0-amd64 --config.file=d:\\pro\\config.yml\"</span></span><br><span class=\"line\">  DisplayName = <span class=\"string\">\"windows_exporter_service\"</span></span><br><span class=\"line\">  StartupType = <span class=\"string\">\"Automatic\"</span></span><br><span class=\"line\">  Description = <span class=\"string\">\"windows exporter service open 9100 port!\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">New-Service @params | Start-Service -PassThru</span><br><span class=\"line\"><span class=\"comment\"># - 防火墙规则设置（只允许10.0.0.2机器访问）</span></span><br><span class=\"line\">New-NetFirewallRule -Name <span class=\"string\">\"windows_exporter_service\"</span> -DisplayName <span class=\"string\">\"windows_exporter_service\"</span> -Description <span class=\"string\">\"windows_exporter_service\"</span> -Direction Inbound -LocalPort 9100 -RemoteAddress 10.0.0.2 -Protocol TCP -Action Allow -Enabled True</span><br><span class=\"line\">Get-NetFirewallRule -Name <span class=\"string\">\"windows_exporter_service\"</span> | Format-Table</span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Development","path":"api/categories/Development.json"}],"tags":[{"name":"Powershell","path":"api/tags/Powershell.json"}]}