{"title":"CDN网站防护与Worker无服务器应用构建","slug":"系统运维/Application/Web/CDN/CDN网站防护和IP隐藏","date":"2019-08-01T05:36:30.000Z","updated":"2022-03-29T05:39:06.308Z","url":"2019/8-1-114.html","path":"api/articles/2019/8-1-114.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190814094859.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190814111427.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190814095658.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190814104913.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190814110709.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-cloudflare\"><a href=\"#0x00-cloudflare\" class=\"headerlink\" title=\"0x00 cloudflare\"></a>0x00 cloudflare</h4><p><strong>前言</strong><br>描述：cloudflare是一家国外的 CDN 加速服务商还是很有名气的,提供免费和付费的加速和网站保护服务。<br>Cloudflare是用的比较多的一个国外的NS服务商，同时还提供15年的SSL证书以及免费CDN，同时也可以防护DDoS攻击。<br>以前的百度云加速的国外节点就是和 cloudflare 合作使用的 cloudflare 的节点。</p>\n<p>特点事项：</p>\n<ul>\n<li>cloudflare 提供了不同类型的套餐,即使是免费用户cloudflare 提供的功能也是很全面的。</li>\n<li>对于访客来自于国外的网站很不错；</li>\n<li>对于访客来自于国内的网站加速效果有限，有些甚至会变慢，不过其安全防护功能也很不错。</li>\n</ul>\n<p>cloudflare官网地址：<a href=\"https://dash.cloudflare.com/\" target=\"_blank\" rel=\"noopener\">https://dash.cloudflare.com/</a></p>\n<p><br></p>\n<p><strong>使用步骤</strong><br>邮箱注册：注册完后自动进入添加网站界面,首次登录添加网站分为四步：<code>选择方案、添加网站域名、添加DNS记录、更新域名服务器</code><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190814094859.png\" alt=\"WeiyiGeek.CloudflareCDN\" title=\"\" class=\"\">\n                <p>WeiyiGeek.CloudflareCDN</p>\n            </figure></p>\n<ol>\n<li><p>添加网站 :填入自己的主域名（不带 www 的）然后Cloudflare会扫描该域名当前的DNS记录，你可以保留/添加/删除等等</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#管理您的域名系统(DNS)设置（自动扫描 DNS 记录）</span></span><br><span class=\"line\">CNAME weiyigeek.github.io\tis an <span class=\"built_in\">alias</span> of weiyigeek.github.io\tAutomatic\t\t</span><br><span class=\"line\">CNAME www\tis an <span class=\"built_in\">alias</span> of weiyigeek.github.io\tAutomatic</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190814111427.png\" alt=\"WeiyiGeek.DNS解析记录\" title=\"\" class=\"\">\n                <p>WeiyiGeek.DNS解析记录</p>\n            </figure>\n</li>\n<li><p>域名注册商修改NS记录即可等待生效完成即可;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Log in to your registrar account （登录您的域名注册商,将DNS改成以下）</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Remove these nameservers:</span></span><br><span class=\"line\">f1g1ns2.dnspod.net</span><br><span class=\"line\">f1g1ns1.dnspod.net</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Replace with Cloudflare's nameservers:</span></span><br><span class=\"line\">bayan.ns.cloudflare.com</span><br><span class=\"line\">vita.ns.cloudflare.com</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>以腾讯云的为例:<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190814095658.png\" alt=\"WeiyiGeek.设置DNS服务器\" title=\"\" class=\"\">\n                <p>WeiyiGeek.设置DNS服务器</p>\n            </figure></p>\n<ol start=\"3\">\n<li>验证修改配置与DNS<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#方式1：在cloudflare中checknow进行验证并且发送邮件给您</span></span><br><span class=\"line\">Great news! Cloudflare is now protecting your site</span><br><span class=\"line\">Here are some commonly used options to review.</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190814104913.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#方式2：dig与nslookup检测</span></span><br><span class=\"line\">dig www.weiyigeek.github.io</span><br><span class=\"line\">;; QUESTION SECTION:</span><br><span class=\"line\">;www.weiyigeek.github.io.\t\tIN\tA</span><br><span class=\"line\"></span><br><span class=\"line\">;; ANSWER SECTION:</span><br><span class=\"line\">www.weiyigeek.github.io.\t5\tIN\tA\t104.18.51.99  <span class=\"comment\">#指向cloudflare的IP地址</span></span><br><span class=\"line\">www.weiyigeek.github.io.\t5\tIN\tA\t104.18.50.99</span><br><span class=\"line\"></span><br><span class=\"line\">;; AUTHORITY SECTION:</span><br><span class=\"line\">weiyigeek.github.io.\t\t5\tIN\tNS\tbayan.ns.cloudflare.com.</span><br><span class=\"line\">weiyigeek.github.io.\t\t5\tIN\tNS\tvita.ns.cloudflare.com.</span><br><span class=\"line\"></span><br><span class=\"line\">;; ADDITIONAL SECTION:</span><br><span class=\"line\">vita.ns.cloudflare.com.\t5\tIN\tA\t173.245.58.238</span><br><span class=\"line\">bayan.ns.cloudflare.com. 5\tIN\tA\t173.245.59.72</span><br><span class=\"line\">bayan.ns.cloudflare.com. 5\tIN\tAAAA\t2400:cb00:2049:1::adf5:3b48</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#nslookup命令</span></span><br><span class=\"line\">nslookup -qt=<span class=\"string\">\"A\"</span> www.weiyigeek.github.io</span><br><span class=\"line\">非权威应答:</span><br><span class=\"line\">名称:    www.weiyigeek.github.io</span><br><span class=\"line\">Addresses:  2606:4700:30::6812:3263</span><br><span class=\"line\">          2606:4700:30::6812:3363</span><br><span class=\"line\">          104.18.50.99  <span class=\"comment\">#指向cloudflare的IP地址</span></span><br><span class=\"line\">          104.18.51.99 </span><br><span class=\"line\">nslookup -qt=<span class=\"string\">\"CNAME\"</span> www.weiyigeek.github.io</span><br><span class=\"line\">weiyigeek.github.io</span><br><span class=\"line\">        primary name server = bayan.ns.cloudflare.com</span><br><span class=\"line\">        responsible mail addr = dns.cloudflare.com</span><br><span class=\"line\">        serial  = 2031741885</span><br><span class=\"line\">        refresh = 10000 (2 hours 46 mins 40 secs)</span><br><span class=\"line\">        retry   = 2400 (40 mins)</span><br><span class=\"line\">        expire  = 604800 (7 days)</span><br><span class=\"line\">        default TTL = 3600 (1 hour)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#方式3：腾讯监测</span></span><br><span class=\"line\">https://domaintool.cloud.tencent.com/result?domain=weiyigeek.github.io</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190814110709.png\" alt=\"WeiyiGeek.CDN缓存配置\" title=\"\" class=\"\">\n                <p>WeiyiGeek.CDN缓存配置</p>\n            </figure>\n<p><br></p>\n<p><strong>常用配置项</strong></p>\n<ol>\n<li><p>加速访问</p>\n<ul>\n<li><p>Speed 选项</p>\n<ul>\n<li>Auto Minify：选择压缩 JavaScript、CSS、HTML；</li>\n<li>Rocket Loader：Automatic（自动）；</li>\n</ul>\n</li>\n<li><p>Caching 选项</p>\n<ul>\n<li>Caching Level：Standard（标准）；</li>\n<li>Browser Cache Expiration：1day；</li>\n<li>Always Online：on；</li>\n</ul>\n</li>\n<li><p>调试模式不使用缓存长关，在调试网站如果需要实时预览变化可以打开。<br>-Development Mode : off</p>\n</li>\n</ul>\n</li>\n</ol>\n<p>2.安全防护</p>\n<ul>\n<li><p>Firewall 选项</p>\n<ul>\n<li>Security Level：High；</li>\n<li>Challenge Passage：30 min；</li>\n<li>Browser Integrity Check：on；</li>\n</ul>\n</li>\n<li><p>Scrape Shield 选项<br>Email Address Obfuscation：on<br>Server-side Excludes：on<br>Hotlink Protection：on</p>\n</li>\n<li><p>Caching 选项<br>当网站内容更新后，如果缓存期限还未到，那么更新内容并不会立即生效，就需要进入 cloudflare 后台手动刷新缓存。可以输入更新的页面只刷新该页面的缓存，也可以刷新全站的缓存。</p>\n</li>\n</ul>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"WebsiteOperation","path":"api/categories/WebsiteOperation.json"}],"tags":[{"name":"CDN","path":"api/tags/CDN.json"}]}