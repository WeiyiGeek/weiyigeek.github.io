{"title":"zabbix分布式及高可用","slug":"系统运维/Linux/系统监控/Zabbix/zabbix分布式及高可用","date":"2019-05-14T05:34:30.000Z","updated":"2022-03-29T05:39:06.305Z","url":"2019/5-14-191.html","path":"api/articles/2019/5-14-191.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190516153603.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190514162014.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190514170341.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190515141734.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190515152200.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190515151713.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190515161713.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190516114706.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190516114855.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190516115316.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190516115643.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190516142401.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190516144020.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190730220825.png"],"content":"<p>[TOC]<br><a id=\"more\"></a></p>\n<h4 id=\"0x00-需求与环境\"><a href=\"#0x00-需求与环境\" class=\"headerlink\" title=\"0x00 需求与环境\"></a>0x00 需求与环境</h4><p><strong>(1)项目需求</strong></p>\n<ol>\n<li>实现 zabbix/数据库 (宕机自动切换到从)高可用架构;</li>\n<li>实现 zabbix-proxy 分布式代理接入;</li>\n<li>实现 zabbix 的邮件与钉钉预警;</li>\n<li>实现 zabbix 的数据可视化利用grafana工具;</li>\n</ol>\n<p><strong>(2）项目环境</strong><br>Zabbix主(Master) ：CentOS Linux release 7.6.1810 (Core)<br>Zabbix备(Slave) ：CentOS Linux release 7.6.1810 (Core)<br>Zabbix-proxy(分布式)<br>Zabbix-agent(4台-主/从),其中宿主机windows7一台与proxyagent主机一台</p>\n<p>我们这里将在Zabbix主(Master)中安装zabbix-server以及zabbix-agent和grafana可视化;<br>在zabbix备(slave)中安装zabbix-server/agent以及用docker-compose实现安装的docker-zabbix-proxy;<br>我将我的宿主机/matser/slave/proxyagent机器连接到docker-zabbix-proxy代理中;</p>\n<p>基础环境搭建：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#关闭防火墙与selinux并且同步主从机器时间</span></span><br><span class=\"line\"><span class=\"comment\">#Centos7更改主机名称</span></span><br><span class=\"line\">Zabbix(备)<span class=\"variable\">$hostname</span> Szabbix  <span class=\"comment\">#或者采用/etc/hostname(需要重启生效)</span></span><br><span class=\"line\">Zabbix(主)<span class=\"variable\">$hostname</span> Mzabbix</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#设置网络别名</span></span><br><span class=\"line\"><span class=\"variable\">$vim</span> /etc/hosts</span><br><span class=\"line\">92.168.1.98 Szabbix</span><br><span class=\"line\">192.168.1.99 Mzabbix</span><br><span class=\"line\">192.168.1.100 proxagent</span><br><span class=\"line\"><span class=\"comment\">#192.168.1.101 agent</span></span><br><span class=\"line\">192.168.1.200 zabbix.weiyigeek.com</span><br><span class=\"line\">192.168.56.101 Windows7</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#高可用的VIP漂移IP</span></span><br><span class=\"line\">enp0s3: 192.168.1.200</span><br><span class=\"line\">enp0s9: 192.168.56.200</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#网络环境</span></span><br><span class=\"line\">Zabbix主：</span><br><span class=\"line\">1. enp0s3 - 192.168.1.98</span><br><span class=\"line\">2. ens0s9 - 192.168.56.103  <span class=\"comment\">#drbd数据传输使用</span></span><br><span class=\"line\"></span><br><span class=\"line\">Zabbix从:</span><br><span class=\"line\">1. enp0s3 - 192.168.1.99</span><br><span class=\"line\">2. ens0s9 - 192.168.56.102  <span class=\"comment\">#drbd数据传输使用</span></span><br><span class=\"line\">3. docker - 172.18.0.2</span><br><span class=\"line\"></span><br><span class=\"line\">windows7:</span><br><span class=\"line\">192.168.56.101</span><br><span class=\"line\"></span><br><span class=\"line\">proxyagent：</span><br><span class=\"line\">192.168.1.100</span><br></pre></td></tr></table></figure></p>\n<p><strong>(3)项目架构</strong><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190516153603.png\" alt=\"WeiyiGeek.AWS图\" title=\"\" class=\"\">\n                <p>WeiyiGeek.AWS图</p>\n            </figure></p>\n<h4 id=\"0x01-项目安装流程\"><a href=\"#0x01-项目安装流程\" class=\"headerlink\" title=\"0x01 项目安装流程\"></a>0x01 项目安装流程</h4><p>Step1.根据我前面写的磁盘高可用和服务高可用进行安装heartbeat与drbd注意这里是Centos7版本的.(Drbd磁盘格式化是个坑)<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Mzabbix/Szabbix]<span class=\"variable\">$usermod</span> -G root hacluster   <span class=\"comment\">#设置heartbeat启动用户加入root附加组(权限)</span></span><br></pre></td></tr></table></figure><br>安装好drbd手动主从切换测试：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#mariadb 修改root用户的密码并设置外部IP连接数据库</span></span><br><span class=\"line\">mysql&gt; update mysql.user <span class=\"built_in\">set</span> password=password(<span class=\"string\">'System@123'</span>) <span class=\"built_in\">where</span> user=<span class=\"string\">'root'</span>;</span><br><span class=\"line\">mysql&gt; grant all privileges on *.* to <span class=\"string\">'root'</span>@<span class=\"string\">'%'</span> identified by <span class=\"string\">\"System@123\"</span> with grant option;</span><br><span class=\"line\">mysql&gt; grant all privileges on zabbix.* to zabbix@<span class=\"string\">'%'</span> identified by <span class=\"string\">'zabbix'</span>;</span><br><span class=\"line\">mysql&gt; grant all privileges on zabbix_proxy.* to zabbix_proxy@<span class=\"string\">'%'</span> identified by <span class=\"string\">'zabbix'</span>;</span><br><span class=\"line\">mysql&gt; flush privileges;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#手动切换drbd主从</span></span><br><span class=\"line\">[root@Mzabbix lib]<span class=\"comment\"># umount /var/lib/mysql/</span></span><br><span class=\"line\">drbdadm secondary data</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Szabbix lib]<span class=\"comment\"># drbdadm primary data</span></span><br><span class=\"line\">mount /dev/drbd0 /var/lib/mysql/</span><br><span class=\"line\">chown -R mysql:mysql /var/lib/mysql/   <span class=\"comment\">#防止drbd同步发生改变</span></span><br><span class=\"line\">service mariadb restart</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Szabbix lib]<span class=\"variable\">$mysql</span> -uzabbix -pzabbix   <span class=\"comment\">#登录成功</span></span><br><span class=\"line\">Welcome to the MariaDB monitor.  Commands end with ; or \\g.</span><br><span class=\"line\">Your MariaDB connection id is 2</span><br><span class=\"line\">Server version: 5.5.60-MariaDB MariaDB Server</span><br><span class=\"line\">MariaDB [(none)]&gt; show databases;</span><br><span class=\"line\">+--------------------+</span><br><span class=\"line\">| Database           |</span><br><span class=\"line\">+--------------------+</span><br><span class=\"line\">| information_schema |</span><br><span class=\"line\">| <span class=\"built_in\">test</span>               |</span><br><span class=\"line\">+--------------------+</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190514162014.png\" alt=\"WeiyiGeek.drbd同步ok\" title=\"\" class=\"\">\n                <p>WeiyiGeek.drbd同步ok</p>\n            </figure></p>\n<hr>\n\n<p><strong>(1)heartbeat配置文件</strong><br>主/备机器共用：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#vim //usr/local/heartbeat/etc/ha.d/authkeys</span></span><br><span class=\"line\">auth 1</span><br><span class=\"line\">1 sha1 zabbix</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#vim /usr/local/heartbeat/etc/ha.d/ha.cf</span></span><br><span class=\"line\"><span class=\"comment\">#egrep -v '^#' ha.cf</span></span><br><span class=\"line\">logfile /var/<span class=\"built_in\">log</span>/ha-log</span><br><span class=\"line\">logfacility local0</span><br><span class=\"line\">keepalive 2</span><br><span class=\"line\">deadtime 15</span><br><span class=\"line\">warntime 5</span><br><span class=\"line\">initdead 30</span><br><span class=\"line\">udpport 694</span><br><span class=\"line\">mcast enp0s3 225.0.0.255 694 1 0</span><br><span class=\"line\">auto_failback on</span><br><span class=\"line\">node Mzabbix</span><br><span class=\"line\">node Szabbix</span><br><span class=\"line\">ping 192.168.1.1</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#资源文件 - 修改备份节点脚本源文件</span></span><br><span class=\"line\"><span class=\"comment\">#egrep -v '^#' /usr/local/heartbeat/etc/ha.d/haresources</span></span><br><span class=\"line\">Mzabbix IPaddr::192.168.1.200/24/enp0s3 drbddisk::data Filesystem::/dev/drbd0::/var/lib/mysql::ext4 mysqld zabbix</span><br><span class=\"line\">Mzabbix IPaddr::192.168.56.200/24/enp0s9</span><br></pre></td></tr></table></figure></p>\n<p><br><br>注意：(坑)需要将/etc/目录中drbddisk复制到heartbeat源码安装的目录之中:<br>cp /etc/ha.d/resource.d/drbddisk /usr/local/heartbeat/etc/ha.d/resource.d/</p>\n<p>将下列的脚本加入到/usr/local/heartbeat/etc/ha.d/resource.d/之中<br><em>mysqld 资源脚本：</em><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#mariadb启动脚本</span></span><br><span class=\"line\"><span class=\"comment\">#防止drbd同步后文件的所属人和所属组发生改变</span></span><br><span class=\"line\">chown -R mysql:mysql /var/lib/mysql</span><br><span class=\"line\">sleep 1</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$#</span> -eq 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">\"Usage:mysqld [start|stop|status]\"</span></span><br><span class=\"line\">        <span class=\"built_in\">exit</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"comment\">#接收参数</span></span><br><span class=\"line\">action=<span class=\"variable\">$1</span></span><br><span class=\"line\"><span class=\"keyword\">case</span> <span class=\"variable\">$action</span> <span class=\"keyword\">in</span></span><br><span class=\"line\"><span class=\"string\">\"start\"</span>)</span><br><span class=\"line\">        service mariadb start</span><br><span class=\"line\">        ;;</span><br><span class=\"line\"><span class=\"string\">\"stop\"</span>)</span><br><span class=\"line\">        service mariadb stop</span><br><span class=\"line\">        ;;</span><br><span class=\"line\"><span class=\"string\">\"status\"</span>)</span><br><span class=\"line\">        service mariadb status</span><br><span class=\"line\"><span class=\"keyword\">esac</span></span><br></pre></td></tr></table></figure><br><br><br><em>zabbix 资源脚本：</em><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#zabbix服务启动管理脚本</span></span><br><span class=\"line\">action=<span class=\"variable\">$1</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$#</span> -eq 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">\"Usage:zabbix [start|stop|status]\"</span></span><br><span class=\"line\">        <span class=\"built_in\">exit</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">case</span> <span class=\"variable\">$action</span> <span class=\"keyword\">in</span></span><br><span class=\"line\"><span class=\"string\">\"start\"</span>)</span><br><span class=\"line\">        systemctl start zabbix-server httpd</span><br><span class=\"line\">        ;;</span><br><span class=\"line\"><span class=\"string\">\"stop\"</span>)</span><br><span class=\"line\">        systemctl stop zabbix-server httpd</span><br><span class=\"line\">        ;;</span><br><span class=\"line\"><span class=\"string\">\"status\"</span>)</span><br><span class=\"line\">        systemctl status zabbix-server httpd</span><br><span class=\"line\"><span class=\"keyword\">esac</span></span><br></pre></td></tr></table></figure></p>\n<p><br><br><strong>(2)drbd配置文件：</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Szabbix ha.d]<span class=\"comment\"># egrep -v '^#' /etc/drbd.d/global_common.conf</span></span><br><span class=\"line\">global &#123;</span><br><span class=\"line\">    usage-count no;  <span class=\"comment\">#是否参加DRBD使用者统计，默认是参加</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">common &#123;</span><br><span class=\"line\">    protocol C;</span><br><span class=\"line\">    startup &#123;</span><br><span class=\"line\">        degr-wfc-timeout 60;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    disk &#123;</span><br><span class=\"line\">        on-io-error detach;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    net &#123;</span><br><span class=\"line\">        cram-hmac-alg md5; <span class=\"comment\">#DRBD同步时使用的验证方式和密码</span></span><br><span class=\"line\">        shared-secret <span class=\"string\">\"testdrbd\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    syncer &#123;</span><br><span class=\"line\">        rate 100M;      <span class=\"comment\">#主节点和备用节点同步时最大的网络速率 工作中是100M~1000M</span></span><br><span class=\"line\">        verify-alg crc32c; <span class=\"comment\">#验证算法</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">resource data&#123;</span><br><span class=\"line\">    disk &#123;</span><br><span class=\"line\">        on-io-error detach;  <span class=\"comment\">#磁盘出现IO错误处理</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">#两台主备节点配置 (关键点)</span></span><br><span class=\"line\">on Mzabbix &#123;</span><br><span class=\"line\">        device /dev/drbd0;  <span class=\"comment\">#drbd写设备有自己对应的分区</span></span><br><span class=\"line\">        disk /dev/sdb1;        <span class=\"comment\">#本地数据分区1</span></span><br><span class=\"line\">        address  192.168.56.103:7788;  <span class=\"comment\">#心跳/数据传输接口 (建议把这个地址设置到hosts中改成心跳线的网卡)</span></span><br><span class=\"line\">        meta-disk /dev/sdb2[0];  <span class=\"comment\">#meta data数据分区2</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">on Szabbix &#123;</span><br><span class=\"line\">        device /dev/drbd0;</span><br><span class=\"line\">        disk /dev/sdb1;</span><br><span class=\"line\">        address  192.168.56.102:7788;</span><br><span class=\"line\">        meta-disk /dev/sdb2[0];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>完成以上配置后执行：<br>$chown -R root:haclient /usr/local/heartbeat/etc/ha.d/</p>\n<p><br><br>Step 2. 按照[zabbix入门学习]安装与配置Zabbix-server和zabbix-web以及mariadb数据库的安装;<br>由于我已经安装并配置好主节点zabbix的zabbix-web,我们将一些文件进行中直接复制到从节点中改IP指向我们VIP即可;<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#需要将主节点配置文件复制到从节点并进行修改</span></span><br><span class=\"line\">[root@Mzabbix ~]$ scp /etc/zabbix/zabbix_server.conf root@192.168.1.98:/etc/zabbix/zabbix_server.conf</span><br><span class=\"line\">[root@Mzabbix ~]<span class=\"comment\"># egrep -v '^#' /etc/zabbix/zabbix_server.conf</span></span><br><span class=\"line\"><span class=\"comment\">#egrep -v \"^$|^#|^[[:space:]]+#\" /etc/zabbix/zabbix_server.conf  推荐方式</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">LogFileSize=10</span><br><span class=\"line\">LogFile=/var/<span class=\"built_in\">log</span>/zabbix/zabbix_server.log</span><br><span class=\"line\">PidFile=/var/run/zabbix/zabbix_server.pid</span><br><span class=\"line\">SocketDir=/var/run/zabbix</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#漂移的VIP</span></span><br><span class=\"line\">DBHost=192.168.1.200</span><br><span class=\"line\">DBName=zabbix</span><br><span class=\"line\">DBUser=zabbix</span><br><span class=\"line\">DBPassword=zabbix</span><br><span class=\"line\"><span class=\"comment\">#DBSocket=/var/lib/mysql/mysql.sock</span></span><br><span class=\"line\">DBPort=3306</span><br><span class=\"line\"></span><br><span class=\"line\">SNMPTrapperFile=/var/<span class=\"built_in\">log</span>/snmptrap/snmptrap.log</span><br><span class=\"line\">Timeout=4</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#预警脚本</span></span><br><span class=\"line\">AlertScriptsPath=/usr/lib/zabbix/alterscripts</span><br><span class=\"line\">ExternalScripts=/usr/lib/zabbix/externalscripts</span><br><span class=\"line\">FpingLocation=/usr/sbin/fping</span><br><span class=\"line\">LogSlowQueries=3000</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#注意权限的赋值</span></span><br><span class=\"line\">AllowRoot=1</span><br><span class=\"line\">User=root</span><br><span class=\"line\">StatsAllowedIP=192.168.1.0/24</span><br></pre></td></tr></table></figure><br>复制主中zabbix-web项目文件到从机 /usr/share/zabbix 和etc/zabbix/web中config的php配置文件到从机：（非常重要:不用重新去初始化zabbix-web）<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Mzabbix web]<span class=\"variable\">$scp</span> /etc/zabbix/web/zabbix.conf.php root@192.168.1.98:/etc/zabbix/web/</span><br><span class=\"line\">[root@Szabbix web]<span class=\"variable\">$chown</span> -R apache:apache zabbix.conf.php  <span class=\"comment\">#注意权限</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#根据需求进行更改</span></span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">// Zabbix GUI configuration file.</span><br><span class=\"line\">global <span class=\"variable\">$DB</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$DB</span>[<span class=\"string\">'TYPE'</span>]     = <span class=\"string\">'MYSQL'</span>;</span><br><span class=\"line\"><span class=\"variable\">$DB</span>[<span class=\"string\">'SERVER'</span>]   = <span class=\"string\">'192.168.1.200'</span>;  //VIP</span><br><span class=\"line\"><span class=\"variable\">$DB</span>[<span class=\"string\">'PORT'</span>]     = <span class=\"string\">'3306'</span>;</span><br><span class=\"line\"><span class=\"variable\">$DB</span>[<span class=\"string\">'DATABASE'</span>] = <span class=\"string\">'zabbix'</span>;</span><br><span class=\"line\"><span class=\"variable\">$DB</span>[<span class=\"string\">'USER'</span>]     = <span class=\"string\">'zabbix'</span>;</span><br><span class=\"line\"><span class=\"variable\">$DB</span>[<span class=\"string\">'PASSWORD'</span>] = <span class=\"string\">'zabbix'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">// Schema name. Used <span class=\"keyword\">for</span> IBM DB2 and PostgreSQL.</span><br><span class=\"line\"><span class=\"variable\">$DB</span>[<span class=\"string\">'SCHEMA'</span>] = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$ZBX_SERVER</span>      = <span class=\"string\">'192.168.1.200'</span>;  //从节点设置从即刻</span><br><span class=\"line\"><span class=\"variable\">$ZBX_SERVER_PORT</span> = <span class=\"string\">'10051'</span>;</span><br><span class=\"line\"><span class=\"variable\">$ZBX_SERVER_NAME</span> = <span class=\"string\">'zabbix.weiyigeek.com'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$IMAGE_FORMAT_DEFAULT</span> = IMAGE_FORMAT_PNG;</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190514170341.png\" alt=\"WeiyiGeek.zabbix.conf.php\" title=\"\" class=\"\">\n                <p>WeiyiGeek.zabbix.conf.php</p>\n            </figure></p>\n<p><br></p>\n<p>Step 3.安装zabbix-proxy-mysql并将sql文件导入数据中：：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yum install -y zabbix-proxy-mysql</span><br><span class=\"line\">已安装:</span><br><span class=\"line\">  zabbix-proxy-mysql.x86_64 0:4.2.1-1.el7</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#安装成功后将里面proxy-数据库导入我的mysql数据库中</span></span><br><span class=\"line\">mysql_db:zabbix_proxy</span><br><span class=\"line\">mysql_user:zabbix_proxy</span><br><span class=\"line\">mysql_pass:zabbix</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$zcat</span> /usr/share/doc/zabbix-proxy-mysql-4.2.1/schema.sql.gz | mysql -h192.168.1.200 -u<span class=\"string\">'zabbix_proxy'</span> -p<span class=\"string\">'zabbix'</span> zabbix_porxy</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190515141734.png\" alt=\"WeiyiGeek.导入成功\" title=\"\" class=\"\">\n                <p>WeiyiGeek.导入成功</p>\n            </figure></p>\n<p>Step 4.利用docker-compose构建zabbix-proxy环境<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#docker-compose构建配置文件结构</span></span><br><span class=\"line\">[root@Szabbix zabbix-proxy]<span class=\"comment\"># ll -R .</span></span><br><span class=\"line\">.:</span><br><span class=\"line\">-rw-r--r-- 1 root root 462 5月  15 15:55 docker-compose.yaml</span><br><span class=\"line\">drwxr-xr-x 3 root root  51 5月  15 15:05 etc</span><br><span class=\"line\"></span><br><span class=\"line\">./etc:</span><br><span class=\"line\">drwxr-xr-x 2 root root  30 5月  15 15:03 enc</span><br><span class=\"line\">-rw-r--r-- 1 root root 123 5月  15 15:05 env_mysql</span><br><span class=\"line\">-rw-r--r-- 1 root root 205 5月  15 15:04 env_proxy</span><br><span class=\"line\"></span><br><span class=\"line\">./etc/enc:</span><br><span class=\"line\">-rw-r--r-- 1 root root 65 5月  15 14:29 zabbix_proxy.psk</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#允许Zabbix代理容器的卷,参考以下网址来放psk文件</span></span><br><span class=\"line\">https://hub.docker.com/r/zabbix/zabbix-proxy-mysql</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#启动前先生成zabbix网络：</span></span><br><span class=\"line\"><span class=\"variable\">$docker</span> network create zabbix</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#docker-compose.yaml</span></span><br><span class=\"line\">version: <span class=\"string\">\"3.0\"</span></span><br><span class=\"line\">services:</span><br><span class=\"line\">    zabbix_proxy:</span><br><span class=\"line\">        image: zabbix/zabbix-proxy-mysql:alpine-4.2.1</span><br><span class=\"line\">        container_name: zabbix_proxy</span><br><span class=\"line\">        ports:</span><br><span class=\"line\">          - <span class=\"string\">\"10055:10051\"</span></span><br><span class=\"line\">        volumes:</span><br><span class=\"line\">          - /etc/localtime:/etc/localtime:ro</span><br><span class=\"line\">          - ./etc/enc:/var/lib/zabbix/enc</span><br><span class=\"line\">        env_file:</span><br><span class=\"line\">          - ./etc/env_proxy</span><br><span class=\"line\">          - ./etc/env_mysql</span><br><span class=\"line\">        networks:</span><br><span class=\"line\">          - zabbix</span><br><span class=\"line\">        <span class=\"comment\">#command: ['top']</span></span><br><span class=\"line\"></span><br><span class=\"line\">networks:</span><br><span class=\"line\">    zabbix:</span><br><span class=\"line\">        external: <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#env_mysql文件</span></span><br><span class=\"line\">DB_SERVER_HOST=192.168.1.200</span><br><span class=\"line\">DB_SERVER_PORT=3306</span><br><span class=\"line\">MYSQL_DATABASE=zabbix_porxy</span><br><span class=\"line\">MYSQL_USER=zabbix_proxy</span><br><span class=\"line\">MYSQL_PASSWORD=zabbix</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#env_proxy文件</span></span><br><span class=\"line\">ZBX_SERVER_HOST=192.168.1.200</span><br><span class=\"line\">ZBX_SERVER_PORT=10051</span><br><span class=\"line\">ZBX_TLSCONNECT=psk</span><br><span class=\"line\">ZBX_TLSPSKIDENTITY=ZABBIXPROXY</span><br><span class=\"line\">ZBX_TLSPSKFILE=zabbix_proxy.psk</span><br><span class=\"line\">ZBX_HOSTNAME=ZabbixProxy</span><br><span class=\"line\">ZBX_CONFIGFREQUENCY=60</span><br><span class=\"line\">ZBX_PROXYOFFLINEBUFFER=10</span><br><span class=\"line\">ZBX_TLSCONNECT=psk</span><br><span class=\"line\">ZBX_TLSACCEPT=psk</span><br><span class=\"line\">ZBX_DATASENDERFREQUENCY=30</span><br><span class=\"line\">ZBX_PROXYLOCALBUFFER=10</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在 docker-compose.yaml 所在的目录下执行；</span></span><br><span class=\"line\">docker-compose -f docker-compose.yaml up -d</span><br><span class=\"line\">docker-compose up    <span class=\"comment\">#以后直接启动</span></span><br><span class=\"line\">docker-compose logs  <span class=\"comment\">#查看连接日志</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#在zabbix-proxy-mysql docker中显示如下则表示成功接入，或者</span></span><br><span class=\"line\">zabbix_proxy    |    186:20190515:161355.527 proxy <span class=\"comment\">#26 started [preprocessing wo            rker #1]</span></span><br><span class=\"line\">zabbix_proxy    |    161:20190515:161455.932 received configuration data from server at <span class=\"string\">\"192.168.1.200\"</span>, datalen 3707</span><br></pre></td></tr></table></figure><br>选择 管理 -&gt; agent代理程序 -&gt; 创建代理：<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190515152200.png\" alt=\"WeiyiGeek.zabbixproxy-hostname\" title=\"\" class=\"\">\n                <p>WeiyiGeek.zabbixproxy-hostname</p>\n            </figure></p>\n<p>进行zabbix-proxy加密设置：<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190515151713.png\" alt=\"WeiyiGeek.建立zabbix-proxy\" title=\"\" class=\"\">\n                <p>WeiyiGeek.建立zabbix-proxy</p>\n            </figure></p>\n<p>Step 5. 接入主机到zabbix-proxy中：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#拿一台data连接到我们zabbix-proxy中，然后从zabbix-server进行获取信息</span></span><br><span class=\"line\"><span class=\"variable\">$egrep</span> -v <span class=\"string\">'^#'</span> /etc/zabbix/zabbix_agentd.conf</span><br><span class=\"line\">Server=192.168.1.98</span><br><span class=\"line\">ListenPort=10050</span><br><span class=\"line\">ServerActive=192.168.1.98:10055   <span class=\"comment\">#主动推送加端口</span></span><br><span class=\"line\">Hostname=proxy-agent</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#启动服务器的zabbix-agent</span></span><br><span class=\"line\">[root@Master-data1 ~]$ service zabbix-agent start</span><br><span class=\"line\">Starting Zabbix agent:                                     [  OK  ]</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190515161713.png\" alt=\"WeiyiGeek.zabbix-proxy访问成功\" title=\"\" class=\"\">\n                <p>WeiyiGeek.zabbix-proxy访问成功</p>\n            </figure></p>\n<p>接入其他需要监控的主机到server中<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 由于这里做了(高可用-直接连接server会进行主网卡转发) - 所以采用代理的形式</span></span><br><span class=\"line\">注意：在机器数量较少的时候可以采用被动主动,当机器变多的时候建议agent采用采用主动发送,以减少server的负载;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#linux - agent 共用配置</span></span><br><span class=\"line\">Server192.168.1.98</span><br><span class=\"line\">ListenPort=10050</span><br><span class=\"line\">ServerActive=192.168.1.98:10055</span><br><span class=\"line\"><span class=\"comment\">#Linux-agent(主从)</span></span><br><span class=\"line\">Hostname=Mzabbix</span><br><span class=\"line\">Hostname=Szabbix</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#windows-agent</span></span><br><span class=\"line\">Server192.168.56.102</span><br><span class=\"line\">ListenPort=10050</span><br><span class=\"line\">ServerActive=192.168.56.102:10055</span><br><span class=\"line\">Hostname=Windows7</span><br></pre></td></tr></table></figure></p>\n<p>step 6. Grafana应安装在zabbix-server服务器上并进行以下配置<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$wget</span> https://dl.grafana.com/oss/release/grafana-5.4.2-1.x86_64.rpm </span><br><span class=\"line\"><span class=\"variable\">$sudo</span> yum -y localinstall grafana-5.4.2-1.x86_64.rpm</span><br><span class=\"line\">已安装:</span><br><span class=\"line\">  grafana.x86_64 0:5.4.2-1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$systemctl</span> daemon-reload</span><br><span class=\"line\"><span class=\"variable\">$systemctl</span> start grafana-server</span><br><span class=\"line\"><span class=\"variable\">$yum</span> -y install fontconfig freetype* urw-fonts</span><br><span class=\"line\">已安装:</span><br><span class=\"line\">  freetype-demos.x86_64 0:2.8-12.el7_6.1 freetype-devel.x86_64 0:2.8-12.el7_6.1</span><br><span class=\"line\">作为依赖被安装:</span><br><span class=\"line\">  libpng-devel.x86_64 2:1.5.13-7.el7_2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$yum</span> -y install fontconfig freetype* urw-fonts  <span class=\"comment\">#服务器端图像是一项可选功能</span></span><br><span class=\"line\"><span class=\"variable\">$systemctl</span> start grafana-server</span><br></pre></td></tr></table></figure><br>启动Grafana后，在浏览器中输入<a href=\"http://ip:3000,可访问(3000为默认端口,账号密码都是admin/weiyigeek),登录成功后需要您更改默认密码,然后进行插件安装：\">http://ip:3000,可访问(3000为默认端口,账号密码都是admin/weiyigeek),登录成功后需要您更改默认密码,然后进行插件安装：</a><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#获取可用插件列表</span></span><br><span class=\"line\">grafana-cli plugins list-remote</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#安装zabbix插件</span></span><br><span class=\"line\">grafana-cli plugins list-remote |grep zabbix</span><br><span class=\"line\">grafana-cli plugins install alexanderzobnin-zabbix-app</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#重启grafana，并再次访问</span></span><br><span class=\"line\">systemctl restart grafana-server</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190516114706.png\" alt=\"WeiyiGeek.grafana安装zabbix插件\" title=\"\" class=\"\">\n                <p>WeiyiGeek.grafana安装zabbix插件</p>\n            </figure></p>\n<p>Grafana的zabbix配置：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;1&gt; 点击zabbix图标，启用zabbix插件</span><br><span class=\"line\">&lt;2&gt; 点击Enable</span><br><span class=\"line\">&lt;3&gt; 点击Add data <span class=\"built_in\">source</span> ,添加数据源 （首页）</span><br><span class=\"line\">&lt;4&gt; 点击zabbix，添加zabbix插件的数据源</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190516114855.png\" alt=\"WeiyiGeek.数据源\" title=\"\" class=\"\">\n                <p>WeiyiGeek.数据源</p>\n            </figure></p>\n<p><5> 配置数据源<br>Name为自定义，要可区分<br>URL为zabbix的API地址,默认为：<a href=\"http://zabbix-server的IP/zabbix/api_jsonrpc.php\" target=\"_blank\" rel=\"noopener\">http://zabbix-server的IP/zabbix/api_jsonrpc.php</a><br>选择ACCESS为Browser<br>Username,Password为zabbix的用户及对应的密码(可在zabbix上设置用户)<br>注意选择zabbix version为你自己的版本 - 确认无误则保存;<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190516115316.png\" alt=\"WeiyiGeek.配置数据源\" title=\"\" class=\"\">\n                <p>WeiyiGeek.配置数据源</p>\n            </figure></p>\n<p><7>指示板进行查看并导入<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190516115643.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p><8>如何不正正确的链接到zabbix需要查看本地是否能正常连接到zabbix以及,绑定的zabbix的mysql的<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190516142401.png\" alt=\"WeiyiGeek.绑定myqsl\" title=\"\" class=\"\">\n                <p>WeiyiGeek.绑定myqsl</p>\n            </figure></p>\n<p><9>最后grafana数据展现大成<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190516144020.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p>业务整体架构：<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190730220825.png\" alt=\"WeiyiGeek.zabbix架构\" title=\"\" class=\"\">\n                <p>WeiyiGeek.zabbix架构</p>\n            </figure></p>\n","comments":true,"excerpt":"[TOC]<br>","categories":[{"name":"OperationTools","path":"api/categories/OperationTools.json"}],"tags":[{"name":"Zabbix","path":"api/tags/Zabbix.json"}]}