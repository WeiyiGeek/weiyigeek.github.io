{"title":"2.vSphere基础操作配置","slug":"虚拟云容/虚拟化/VMware/vSphere/2.vSphere基础操作配置","date":"2019-06-16T07:36:38.000Z","updated":"2023-01-31T02:29:10.471Z","url":"2019/6-16-488.html","path":"api/articles/2019/6-16-488.html.json","covers":["https://img.weiyigeek.top/2019/20190704211454.png","https://img.weiyigeek.top/2019/20190704211841.png","https://img.weiyigeek.top/2019/20190704212156.png","https://img.weiyigeek.top/2019/20190704212750.png","https://img.weiyigeek.top/2019/20190704213011.png","https://img.weiyigeek.top/2019/20190704213122.png","https://img.weiyigeek.top/2019/20190704213257.png","https://img.weiyigeek.top/2019/20190704213916.png","https://img.weiyigeek.top/2020/1/20200714101352.png","https://img.weiyigeek.top/2020/1/20200818142926.png","https://img.weiyigeek.top/2020/1/20200712224600.png","https://img.weiyigeek.top/2020/1/20200713151922.png","https://img.weiyigeek.top/2020/1/20200713151656.png","https://img.weiyigeek.top/2020/1/20200713153458.png","https://img.weiyigeek.top/2020/1/20200713160329.png","https://img.weiyigeek.top/2020/1/20200713160904.png","https://img.weiyigeek.top/2020/1/20200713173311.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-基础操作\"><a href=\"#0x00-基础操作\" class=\"headerlink\" title=\"0x00 基础操作\"></a>0x00 基础操作</h4><p>VMware vSphere 参考文档: <a href=\"https://docs.vmware.com/cn/VMware-vSphere/index.html\" target=\"_blank\" rel=\"noopener\">https://docs.vmware.com/cn/VMware-vSphere/index.html</a></p>\n<h5 id=\"1-客户端安装使用\"><a href=\"#1-客户端安装使用\" class=\"headerlink\" title=\"1.客户端安装使用\"></a>1.客户端安装使用</h5><p>VMware Workstation需要宿主机的支持，例如需要运行Windows或Linux操作系统上,注意6.7EXSI服务器取消了ESXI Client取而代之是网页端和采用vMware 15 新版本登陆;</p>\n<p><em>VMware workstation与vSphere的区别：</em></p>\n<ul>\n<li>VMware Workstation运行的是较轻量级的虚拟机,主要用于测试、实验</li>\n<li>Vsphere-VMware ESXi，直接安装在裸机，是底层的系统,用于企业生产环境虚拟化解决方案，主要是为了节省资金（场地费用、能源、物理服务器数量），管理方便。当然还有一些其他的特性。</li>\n</ul>\n<p><br></p>\n<p>安装vSphere Client 精辟并连接到VMware ESXi 6，查看主要功能，步骤如下：</p>\n<p>1）用vSphere Client连接到ESXi管理地址:192.168.205.132</p>\n<p>2）登录进入ESXi之后，会看到一个“VMware评估通知”</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190704211454.png\" alt=\"WeiyiGeek.登陆vSphereEXSI主机\" title=\"\" class=\"\">\n                <p>WeiyiGeek.登陆vSphereEXSI主机</p>\n            </figure>\n<p>3）登录进入ESXi 6控制台，在“摘要”选项卡中，查看当前主机的情况;在默认情况下，VMware ESXi使用了大约1320MB的内存，66Mhz的CPU。可以看到ESXi占用内存较大，CPU利用率并不多（空闲时）。</p>\n<p>4）在“配置→己获许可的功能”中，可以看到VMware ESXi 6的功能<br>查看ESXi 6的功能其中一个最大的改进：FT（虚拟机容错）支持的CPU数量上升为4，在以前的5.x版本中只支持1个CPU，这无疑是一个具大的改进。</p>\n<p>5）在图右上角单击“编辑”，输入VMware ESXi 6的序列号；<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190704211841.png\" alt=\"WeiyiGeek.注册许可证\" title=\"\" class=\"\">\n                <p>WeiyiGeek.注册许可证</p>\n            </figure></p>\n<p><br></p>\n<p><em>vSphere 如何建立虚拟机基础操作？</em><br>我们在ESXi中创建一个虚拟机、并在虚拟机中安装操作系统，与以前版本对比看有那些变化。<br>（1）用鼠标右键单击连接到的VMware ESXi的计算机名称或IP地址，在弹出的快捷菜单中选择“新建虚拟机”选项，或者按“Ctrl+N”热键</p>\n<p>（2）在“配置”对话框中，选择“自定义</p>\n<p>（3）在“名称和位置”对话框，在“名称”文本框中，输入要创建的虚拟机的名称</p>\n<p>（4）可以自己需求选择典型配置还是自定义配置;</p>\n<p>（5）在“虚拟机版本”对话框中，选择虚拟机的版本，在VMware ESXi 6的服务器中，可以支持的最高版本是11。<br>在VMware ESXi 5.5支持“虚拟机版本：10”，但在创建虚拟机的对话框中没有。如果你需要“虚拟机版本：10”，则可以在创建虚拟机后，通过升级硬件的方式，将虚拟机版本升级到10。<br>而在vSphere Client 6中，则可以直接创建硬件版本4、7～11的虚拟机，并且在9、10、11每个版本后面声明了所选版本需要的ESXi 的版本号。</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190704212156.png\" alt=\"WeiyiGeek.ESXI版本\" title=\"\" class=\"\">\n                <p>WeiyiGeek.ESXI版本</p>\n            </figure>\n<p>（6）在“CPU”对话框中，选择虚拟机中虚拟CPU的数量，在VMware ESXi 5的硬件版本中，虚拟机中虚拟CPU的内核总数（虚拟插槽数×每个虚拟插槽的内核数）最多为32，但这受限于主机的CPU数量,为虚拟机中分配的虚拟CPU的数量不能超过主机的CPU数量<br><code>例如所用的服务器是具有2个4核心的CPU，则在创建虚拟机时，为虚拟机中分配虚拟CPU的数量不能超过2（虚拟插槽数）</code></p>\n<p>（7）在“网络”对话框中，为虚拟机创建网络连接，在VMware ESXi中的虚拟机，最多支持4个网卡。<br>在VMware ESXi 6中，虚拟网卡支持<code>Intel E1000E、E1000或 VMXNET 3型网卡</code>，当VMware ESXi主机有多个网络时，可以在“网络”列表中选择。</p>\n<p>（8）在“SCSI控制器”对话框中，选择要使用的SCSI控制器类型，可以<code>在“BusLogin”、“LSI逻辑并行”、“LSI Logic SAS”、“VMware准虚拟”</code>之间选择，通常情况下，选择默认值即可。</p>\n<p>（9）在“创建磁盘”对话框中，设置新创建的虚拟磁盘的容量及置备参数</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190704212750.png\" alt=\"WeiyiGeek.磁盘置备\" title=\"\" class=\"\">\n                <p>WeiyiGeek.磁盘置备</p>\n            </figure>\n<p>在创建磁盘时，都会让选择磁盘的置备类型，如下图所示分为：</p>\n<ul>\n<li><p>厚置备延迟置零： -&gt; 虚拟磁盘按照“磁盘大小”立刻分配空间,<code>使用多少空间就先zero（置零）工作</code></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190704213011.png\" alt=\"WeiyiGeek.厚置备延迟置零\" title=\"\" class=\"\">\n                <p>WeiyiGeek.厚置备延迟置零</p>\n            </figure>\n</li>\n<li><p>厚置备置零: -&gt; 虚拟磁盘按照“磁盘大小”立刻分配空间，<code>会将空间全部进行zero（置零）工作</code>；</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190704213122.png\" alt=\"WeiyiGeek.厚置备置零\" title=\"\" class=\"\">\n                <p>WeiyiGeek.厚置备置零</p>\n            </figure>\n</li>\n<li><p>Thin Provision 精简置备: -&gt; <code>按需分配磁盘空间</code>根据实际空间进行增长；</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190704213257.png\" alt=\"WeiyiGeek.精简置备\" title=\"\" class=\"\">\n                <p>WeiyiGeek.精简置备</p>\n            </figure>\n</li>\n</ul>\n<p>磁盘的性能排序：<code>厚置备置零&gt;厚置备延迟置零&gt;Thic Provision（精科置备）</code><br>注意：厚置备置零和厚置备延迟置零对磁盘空间的<code>使用最快</code>，Thic Provision（精科置备）最<code>节省磁盘空间</code>，但也<code>容易出现磁盘“爆仓”的危险</code>。</p>\n<ul>\n<li>厚置备磁盘具有更好的性能但会占用过多的磁盘空间。通常情况下对于需要使用数据库系统的虚拟机，选择厚置备磁盘（非SSD存储）；对于大多数的应用来说，选择“Thin Provision”即可。</li>\n<li>如果虚拟机保存在SSD（固态硬盘）存储上，则不要选择“厚置备”磁盘，在SSD存储上使用“Thin Provision”即可获得更好的性能。</li>\n</ul>\n<p>（10）在“高级选项”中，指定虚拟磁盘的高级选项与工作模式<br>通常来说为Windows 7、Windows 8的虚拟机分配60GB即可满足系统的需求。<br>在VMware ESXi虚拟机中，“独立”磁盘有两种模式：<code>“独立—持久”与“独立—非持久”</code></p>\n<ul>\n<li>持久模式磁盘的行为与物理机上常规磁盘的行为相似，写入持久模式磁盘的所有数据都会永久性地写入磁盘。</li>\n<li>“独立—非持久”模式的虚拟机关闭虚拟机电源或重置虚拟机时，对非持久模式磁盘的更改将丢失，使用非持久模式您可以每次使用相同的虚拟磁盘状态重新启动虚拟机。<ul>\n<li>对磁盘的更改会写入重做日志文件并从中读取，重做日志文件会在虚拟机关闭电源或重置时被删除。</li>\n</ul>\n</li>\n</ul>\n<p>（11）在创建虚拟机的过程中，在vSphere Client控制台中，在下方的“近期任务”中，显示创建虚拟机的进程。<br>如果要启动虚拟机、查看虚拟机窗口，可以鼠标右击，在弹出的快捷菜单中选择“打开控制台”选项<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190704213916.png\" alt=\"WeiyiGeek.完成建立\" title=\"\" class=\"\">\n                <p>WeiyiGeek.完成建立</p>\n            </figure></p>\n<p><em>说明：</em></p>\n<ul>\n<li>VMware Workstation 11所支持的虚拟机硬件版本的上限：64 GB 内存、16 个处理器、8 TB 磁盘大小。</li>\n<li>VMware ESXi 6的硬件版本应该不会等于或高于这个参数。</li>\n<li>VMware ESXi 5中最多可以为虚拟机分配1011GB（大约接近1TB即1024GB的内存量）</li>\n<li>VMware Workstation可以直接使用主机物理硬盘相类似，在VMware ESXi中，可以直接使用“裸机映射”磁盘。</li>\n<li>“独立”磁盘模式不受快照影响，如果在一个虚拟机系统中有多个虚拟硬盘时，在创建快照或者从快照中恢复时，选中为“独立”磁盘模式的虚拟硬盘保持不变。 </li>\n</ul>\n<p><br></p>\n<h5 id=\"2-vSphere-初始化配置\"><a href=\"#2-vSphere-初始化配置\" class=\"headerlink\" title=\"2.vSphere 初始化配置\"></a>2.vSphere 初始化配置</h5><p><strong>配置1.设置ESXi服务器时间和NTP的方法</strong><br>描述:在ESXi中可以利用esxcli更新系统时间或者NTP方法来更新应用的时间；</p>\n<p>NTP启动同步与时区配置:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.配置ntp文件中进行配置ntp服务器</span></span><br><span class=\"line\"><span class=\"variable\">$cat</span> /etc/ntp.conf</span><br><span class=\"line\">restrict default nomodify notrap nopeer noquery</span><br><span class=\"line\">restrict 127.0.0.1</span><br><span class=\"line\">driftfile /etc/ntp.drift</span><br><span class=\"line\">server 192.168.10.254</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.进行时区的更改从CENTOS6或者CENGTOS7将/etc/localtime</span></span><br><span class=\"line\">[root@master-01 ~]<span class=\"comment\"># cat /etc/redhat-release</span></span><br><span class=\"line\">CentOS Linux release 7.8.2003 (Core)</span><br><span class=\"line\">[root@master-01 ~]<span class=\"comment\"># ls -alh /etc/localtime  #</span></span><br><span class=\"line\">lrwxrwxrwx. 1 root root 35 6月   2 14:15 /etc/localtime -&gt; ../usr/share/zoneinfo/Asia/Shanghai</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.从其他一台Linux主机拷贝一个 /usr/share/zoneinfo/Asia/Shanghai 文件到ESXI主机的数据卷目录</span></span><br><span class=\"line\">[root@ESXI-09:/vmfs/volumes/5bec054f-e37ea7be-d6e8-d4ae528208aa/ISO] ls -l Asia-shanghai-localtime</span><br><span class=\"line\">-rw-r--r--    1 root     root           556 Jul 14 01:50 Asia-shanghai-localtime</span><br><span class=\"line\"><span class=\"comment\"># 由于ESXI每次重启后基础配置文件会恢复默认，所以我们需要编辑ESXI上的启动脚本 /etc/rc.local.d/local.sh 将时区文件每次机器开机时候自动拷贝</span></span><br><span class=\"line\">vi /etc/rc.local.d/local.sh</span><br><span class=\"line\">rm -f /etc/localtime &amp;&amp; cp /vmfs/volumes/5bec054f-e37ea7be-d6e8-d4ae528208aa/ISO/Asia-shanghai-localtime /etc/localtime</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.执行重启ntp服务同步与时区设置设置</span></span><br><span class=\"line\">[root@ESXI-09:/vmfs/volumes/5bec054f-e37ea7be-d6e8-d4ae528208aa/ISO] /etc/init.d/ntpd restart</span><br><span class=\"line\">[root@ESXI-09:/vmfs/volumes/5bec054f-e37ea7be-d6e8-d4ae528208aa/ISO] sh /etc/rc.local.d/local.sh</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5.时区时间恢复正常</span></span><br><span class=\"line\"><span class=\"variable\">$date</span></span><br><span class=\"line\">Tue Jul 14 09:53:40 CST 202</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$esxcli</span> system time get</span><br><span class=\"line\">2020-07-14T10:13:40Z</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200714101352.png\" alt=\"WeiyiGeek.两种方式更改时间\" title=\"\" class=\"\">\n                <p>WeiyiGeek.两种方式更改时间</p>\n            </figure></p>\n<p>Tips:可以采用<code>esxcli system time set</code>命令直接更改系统时间;</p>\n<p><br></p>\n<h5 id=\"2-存储设备管理\"><a href=\"#2-存储设备管理\" class=\"headerlink\" title=\"2.存储设备管理\"></a>2.存储设备管理</h5><p>描述:在VCSA中我们可以非常方便的为ESXI进行存储设备添加与卸载;</p>\n<p><strong>操作流程:</strong></p>\n<ul>\n<li>Step 1.选择对应的ESXI<code>操作-&gt;存储-&gt;新建数据存储</code>即可以指定数据存储类型;</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* VMFS: 通过FC SAN(LUN)或者本地磁盘上创建 VMFS 数据存储。</span><br><span class=\"line\">* NFS: 通过网络在 NFS 共享中创建 NFS 数据存储。</span><br><span class=\"line\">* VVol: 在连接到存储提供程序的存储容器上创建 Virtual Volumes 数据存储(存储集群)。</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Step 2.如果选择NFS进行添加演示，你需要选择NFS版本,之后进行配置存储名称以及NFS服务器，之后便可;</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">NFS 3: 允许 6.0 版本以前的 ESX/ESXi 主机访问数据存储</span><br><span class=\"line\">NFS 4.1: 为服务器提供多路径，并且支持 Kerberos 身份验证协议</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#常规配置结果</span></span><br><span class=\"line\">名称: \tVMwareBackup</span><br><span class=\"line\">类型: \tNFS 3</span><br><span class=\"line\">NFS 设置</span><br><span class=\"line\">服务器: \t192.168.12.249</span><br><span class=\"line\">文件夹: \t/VMwareBackup</span><br><span class=\"line\">访问模式: \t读写</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200818142926.png\" alt=\"WeiyiGeek.名称和配置\" title=\"\" class=\"\">\n                <p>WeiyiGeek.名称和配置</p>\n            </figure>\n<hr>\n<h4 id=\"0x01-进阶操作\"><a href=\"#0x01-进阶操作\" class=\"headerlink\" title=\"0x01 进阶操作\"></a>0x01 进阶操作</h4><h5 id=\"1-实践-vSphere-ESXI-补丁安装\"><a href=\"#1-实践-vSphere-ESXI-补丁安装\" class=\"headerlink\" title=\"1.实践 vSphere ESXI 补丁安装\"></a>1.实践 vSphere ESXI 补丁安装</h5><p>基础实践:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.并设置主机为维护模式。</span><br><span class=\"line\">2.上传指定版本的补丁到存储。</span><br><span class=\"line\">3.使用`esxcli software vib update`命令升级</span><br><span class=\"line\"><span class=\"variable\">$esxcli</span> software vib update -d /vmfs/volumes/data/iso/ESXi650-201811001.zip</span><br><span class=\"line\">4.重启机器</span><br><span class=\"line\"><span class=\"variable\">$reboot</span></span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h5 id=\"2-实践-vSphere-ESXI-升级\"><a href=\"#2-实践-vSphere-ESXI-升级\" class=\"headerlink\" title=\"2.实践 vSphere ESXI 升级\"></a>2.实践 vSphere ESXI 升级</h5><p>描述:vSphere ESXI 从低版本升级到指定版本可以采用下图中的几种方式进行安装更新，但是需要注意您的ESXI是否支持跨大版本升级，更多信息您需要在VMware官网进行找寻；</p>\n<p>Tips:在升级前最好检查下硬件兼容性列表，以避免因兼容性问题导致的未知问题</p>\n<ul>\n<li><a href=\"http://www.vmware.com/resources/compatibility/search.php\" target=\"_blank\" rel=\"noopener\">http://www.vmware.com/resources/compatibility/search.php</a></li>\n</ul>\n<p>补丁与离线包下载地址(需要账号密码登陆):</p>\n<ul>\n<li><a href=\"https://my.vmware.com/group/vmware/patch#search\" target=\"_blank\" rel=\"noopener\">https://my.vmware.com/group/vmware/patch#search</a></li>\n</ul>\n<p><img src=\"https://img.weiyigeek.top/2020/1/20200712224600.png\" alt=\"WeiyiGeek.ESXI大版本升级一览\"></p>\n<p>升级类别:</p>\n<ul>\n<li>离线</li>\n<li>在线</li>\n</ul>\n<p><br/></p>\n<h6 id=\"示例1-离线升级6-7版本\"><a href=\"#示例1-离线升级6-7版本\" class=\"headerlink\" title=\"(示例1).离线升级6.7版本\"></a>(示例1).离线升级6.7版本</h6><p>描述：原始ESXI环境及其版本情况:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ESXI 版本</span></span><br><span class=\"line\">客户端版本:1.33.1</span><br><span class=\"line\">客户端内部版本号:12086396</span><br><span class=\"line\">ESXi 版本:6.0.0</span><br><span class=\"line\">ESXi 内部版本号:2494585</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200713151922.png\" alt=\"WeiyiGeek.旧版本\" title=\"\" class=\"\">\n                <p>WeiyiGeek.旧版本</p>\n            </figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 升级流程:</span></span><br><span class=\"line\">6.0 -&gt; 6.0 update3 -&gt; 6.5 update3 -&gt; 6.7 update3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 离线包:</span></span><br><span class=\"line\">update-from-esxi6.0-6.0_update03.zip  </span><br><span class=\"line\">update-from-esxi6.7-6.7_update03.zip</span><br><span class=\"line\">update-from-esxi6.5-6.5_update03.zip</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200713151656.png\" alt=\"WeiyiGeek.update\" title=\"\" class=\"\">\n                <p>WeiyiGeek.update</p>\n            </figure>\n<p><br></p>\n<p><strong>升级流程步骤</strong></p>\n<ul>\n<li><p>Step1.升级前的准备登陆<code>ESXI-Web-Client</code>启用ESXI Shell，并且关闭运行的虚拟机;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.查看当前系统版本</span></span><br><span class=\"line\"><span class=\"variable\">$esxcli</span> system version get</span><br><span class=\"line\"><span class=\"comment\"># Product: VMware ESXi</span></span><br><span class=\"line\"><span class=\"comment\">#    Version: 6.0.0</span></span><br><span class=\"line\"><span class=\"comment\">#    Build: Releasebuild-2494585</span></span><br><span class=\"line\"><span class=\"comment\">#    Update: 0</span></span><br><span class=\"line\"><span class=\"comment\">#    Patch: 0</span></span><br><span class=\"line\"><span class=\"comment\"># (Updated) ESXi-6.0.0-2494585-standard (localhost)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.ESXI 进入到维护模式</span></span><br><span class=\"line\"><span class=\"variable\">$vim</span>-cmd /hostsvc/maintenance_mode_enter</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Step2.将所有的离线升级包上传到ESXI存储之中，执行以下命令将进行<code>6.0 升级到 6.0 update 3</code> 版本;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.列出离线升级仓库中的所有映像配置文件。</span></span><br><span class=\"line\"><span class=\"variable\">$esxcli</span> software sources profile list -d /vmfs/volumes/5bec054f-e37ea7be-d6e8-d4ae528208aa/ISO/update-from-esxi6.0-6.0_update03.zip</span><br><span class=\"line\">Name                              Vendor        Acceptance Level</span><br><span class=\"line\">--------------------------------  ------------  ----------------</span><br><span class=\"line\">ESXi-6.0.0-20170202001-standard   VMware, Inc.  PartnerSupported</span><br><span class=\"line\">ESXi-6.0.0-20170201001s-standard  VMware, Inc.  PartnerSupported</span><br><span class=\"line\">ESXi-6.0.0-20170201001s-no-tools  VMware, Inc.  PartnerSupported</span><br><span class=\"line\">ESXi-6.0.0-20170202001-no-tools   VMware, Inc.  PartnerSupported</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.指定离线包中的映像文件进行升级</span></span><br><span class=\"line\"><span class=\"variable\">$esxcli</span> software profile install -d /vmfs/volumes/5bec054f-e37ea7be-d6e8-d4ae528208aa/ISO/update-from-esxi6.0-6.0_update03.zip -p ESXi-6.0.0-20170202001-standard</span><br><span class=\"line\">Installation Result</span><br><span class=\"line\">   Message: The update completed successfully, but the system needs to be rebooted <span class=\"keyword\">for</span> the changes to be effective.  <span class=\"comment\"># 表示成功完成升级，需要重启系统后生效</span></span><br><span class=\"line\">   Reboot Required: <span class=\"literal\">true</span></span><br><span class=\"line\">   VIBs Installed: VMware_bootbank_ehci-ehci-hcd_1.0-3vmw.600.2.52.4600944, ....... VMware_locker_tools-light_6.0.0-0.0.2494585</span><br><span class=\"line\">   VIBs Skipped: VMWARE_bootbank_mtip32xx-native_3.8.5-1vmw.600.0.0.2494585, ...... VMware 1.0-3vmw.600.0.0.2494585</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.重启机器</span></span><br><span class=\"line\">reboot -d 0 <span class=\"comment\"># 如若系统没反应则 -f 参数强制重启</span></span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200713153458.png\" alt=\"WeiyiGeek.升级成功后登陆UI\" title=\"\" class=\"\">\n                <p>WeiyiGeek.升级成功后登陆UI</p>\n            </figure>\n</li>\n</ul>\n<ul>\n<li>Step 3.从6.0 update 3 升级到 6.5 update 3之中<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.列出6.5update离线升级仓库中的所有映像配置文件。</span></span><br><span class=\"line\"><span class=\"variable\">$esxcli</span> software sources profile list -d /vmfs/volumes/5bec054f-e37ea7be-d6e8-d4ae528208aa/ISO/update-from-esxi6.5-6.5_update03.zip</span><br><span class=\"line\">Name                              Vendor        Acceptance Level</span><br><span class=\"line\">--------------------------------  ------------  ----------------</span><br><span class=\"line\">ESXi-6.5.0-20190702001-standard   VMware, Inc.  PartnerSupported</span><br><span class=\"line\">ESXi-6.5.0-20190701001s-no-tools  VMware, Inc.  PartnerSupported</span><br><span class=\"line\">ESXi-6.5.0-20190702001-no-tools   VMware, Inc.  PartnerSupported</span><br><span class=\"line\">ESXi-6.5.0-20190701001s-standard  VMware, Inc.  PartnerSupported</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.指定离线包中的映像文件进行升级</span></span><br><span class=\"line\"><span class=\"variable\">$esxcli</span> software profile install -d /vmfs/volumes/5bec054f-e37ea7be-d6e8-d4ae528208aa/ISO/update-from-esxi6.5-6.5_update03.zip -p ESXi-6.5.0-20190702001-standard</span><br><span class=\"line\">Installation Result</span><br><span class=\"line\">   Message: The update completed successfully, but the system needs to be rebooted <span class=\"keyword\">for</span> the changes to be effective.</span><br><span class=\"line\">   Reboot Required: <span class=\"literal\">true</span></span><br><span class=\"line\">   VIBs Installed: VMW_bootbank_ata-libata-92_3.00.9.2-16vmw.650.0.0.4564106, ......, VMware_locker_tools-light_6.0.0-3.57.5050593</span><br><span class=\"line\">   VIBs Skipped:</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.同样重启机器</span></span><br><span class=\"line\">reboot</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200713160329.png\" alt=\"WeiyiGeek.ESXIupdate6.5-UI\" title=\"\" class=\"\">\n                <p>WeiyiGeek.ESXIupdate6.5-UI</p>\n            </figure>\n</li>\n</ul>\n<ul>\n<li><p>Step 4.从6.5 update 3 升级到 6.7 update 3 版本之中</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.列出6.7update离线升级仓库中的所有映像配置文件。</span></span><br><span class=\"line\">[root@localhost:/vmfs/volumes/5bec054f-e37ea7be-d6e8-d4ae528208aa/ISO] esxcli software sources profile list -d /vmfs/volumes/5bec054f-e37ea7be-d6e8-d4ae528208aa/ISO/update-from-esxi6.7-6.7_update03.zip</span><br><span class=\"line\">Name                              Vendor        Acceptance Level</span><br><span class=\"line\">--------------------------------  ------------  ----------------</span><br><span class=\"line\">ESXi-6.7.0-20190801001s-no-tools  VMware, Inc.  PartnerSupported</span><br><span class=\"line\">ESXi-6.7.0-20190802001-no-tools   VMware, Inc.  PartnerSupported</span><br><span class=\"line\">ESXi-6.7.0-20190802001-standard   VMware, Inc.  PartnerSupported</span><br><span class=\"line\">ESXi-6.7.0-20190801001s-standard  VMware, Inc.  PartnerSupported</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.指定离线包中的映像文件进行升级</span></span><br><span class=\"line\">[root@localhost:/vmfs/volumes/5bec054f-e37ea7be-d6e8-d4ae528208aa/ISO] esxcli software profile install -d /vmfs/volumes/5bec054f-e37ea7be-d6e8-d4ae528208aa/ISO/update-from-esxi6.7-6.7_update</span><br><span class=\"line\">03.zip  -p ESXi-6.7.0-20190802001-standard</span><br><span class=\"line\">Installation Result</span><br><span class=\"line\">   Message: The update completed successfully, but the system needs to be rebooted <span class=\"keyword\">for</span> the changes to be effective.</span><br><span class=\"line\">   Reboot Required: <span class=\"literal\">true</span></span><br><span class=\"line\">   VIBs Installed: VMW_bootbank_ata-libata-92_3.00.9.2-16vmw.670.0.0.8169922, ...., VMware_locker_tools-light_10.3.10.12406962-14141615</span><br><span class=\"line\">   VIBs Removed: VMW_bootbank_ata-libata-92_3.00.9.2-16vmw.650.0.0.4564106, ...., VMware_locker_tools-light_6.5.0-2.92.13873656</span><br><span class=\"line\">   VIBs Skipped:</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.同样重启机器</span></span><br><span class=\"line\">reboot</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200713160904.png\" alt=\"WeiyiGeek.6.7-UI\" title=\"\" class=\"\">\n                <p>WeiyiGeek.6.7-UI</p>\n            </figure>\n</li>\n<li><p>Step 5.升级成功退出维护模式与查看升级后系统版本信息，至此安装更新全部完成；</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$vim</span>-cmd /hostsvc/maintenance_mode_exit</span><br><span class=\"line\"><span class=\"variable\">$esxcli</span> system version get</span><br><span class=\"line\">Product: VMware ESXi</span><br><span class=\"line\">   Version: 6.7.0</span><br><span class=\"line\">   Build: Releasebuild-14320388</span><br><span class=\"line\">   Update: 3</span><br><span class=\"line\">   Patch: 73</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><strong>补充说明:</strong></p>\n<ul>\n<li>(1) 若升级中间有异常报错请查看其错误信息(<code>常常出现在次版本升级之中</code>)当解决后继续执行, 我将我所遇的坑进行记录如果有遇到相似的问题请参考其它文章<code>《n2.vSphere各版本所遇入坑解决》</code>;</li>\n</ul>\n<p><br/></p>\n<h6 id=\"示例2-在线升级6-7版本\"><a href=\"#示例2-在线升级6-7版本\" class=\"headerlink\" title=\"(示例2).在线升级6.7版本\"></a>(示例2).在线升级6.7版本</h6><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$esxcli</span> software sources profile list -d https://hostupdate.vmware.com/software/VUM/PRODUCTION/main/vmw-depot-index.xml</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200713173311.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n<p>收集补充:</p>\n<ul>\n<li>3种更新vCenter Server Appliance 6.5的方法: <a href=\"https://blog.csdn.net/z136370204/article/details/103683233\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/z136370204/article/details/103683233</a></li>\n<li>vSphere 故障排错思路总结 :<a href=\"https://www.sohu.com/a/229112114_151779\" target=\"_blank\" rel=\"noopener\">https://www.sohu.com/a/229112114_151779</a></li>\n<li>使用 esxcli 和脱机捆绑包 在 ESXi 5.x/6.x 上安装异步驱动程序 (2137853) <a href=\"https://kb.vmware.com/s/article/2137853?lang=zh_CN\" target=\"_blank\" rel=\"noopener\">https://kb.vmware.com/s/article/2137853?lang=zh_CN</a></li>\n</ul>\n<p><br/></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"VMware","path":"api/categories/VMware.json"},{"name":"virtualization","path":"api/categories/virtualization.json"}],"tags":[{"name":"vSphere","path":"api/tags/vSphere.json"}]}