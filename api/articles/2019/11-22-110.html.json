{"title":"IT开源资产管理与工作单系统介绍使用","slug":"系统运维/Application/monitor/IT资产管理与工作单开源系统快速入门","date":"2019-11-22T11:35:30.000Z","updated":"2023-01-31T02:29:10.469Z","url":"2019/11-22-110.html","path":"api/articles/2019/11-22-110.html.json","covers":["https://img.weiyigeek.top/2019/1/20191119214157.png","https://img.weiyigeek.top/2019/1/20191120095544.png","https://img.weiyigeek.top/2019/1/20191121131153.png","https://img.weiyigeek.top/2019/1/20191116125056.png","https://img.weiyigeek.top/2019/1/20191116125342.png","https://img.weiyigeek.top/2019/1/20191125103458.png","https://img.weiyigeek.top/2019/1/20191125111451.png","https://img.weiyigeek.top/2020/1/20200414161850.png","https://img.weiyigeek.top/2020/1/20200414162230.png","https://img.weiyigeek.top/2020/1/20200414163927.png","https://img.weiyigeek.top/2020/1/20200414204315.png","https://img.weiyigeek.top/2019/1/20191116135821.png","https://img.weiyigeek.top/2019/1/20191116135850.png","https://img.weiyigeek.top/2019/1/20191116143814.png","https://img.weiyigeek.top/2019/1/20191116143825.png","https://img.weiyigeek.top/2019/1/20191116144012.png","https://img.weiyigeek.top/2019/1/20191116150136.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-前言简介\"><a href=\"#0x00-前言简介\" class=\"headerlink\" title=\"0x00 前言简介\"></a>0x00 前言简介</h4><p>描述:最近接手了公司的固定资产的管理工作,一看到用Excl记录的固定资产信息我就产生了一种想法,手工(上/下帐)管理太麻烦了于是找一款开源的固定资产管理进行管理。</p>\n<hr>\n\n<h4 id=\"0x01-Snipe-IT\"><a href=\"#0x01-Snipe-IT\" class=\"headerlink\" title=\"0x01 Snipe-IT\"></a>0x01 Snipe-IT</h4><h5 id=\"1-简单介绍\"><a href=\"#1-简单介绍\" class=\"headerlink\" title=\"1.简单介绍\"></a>1.简单介绍</h5><p>Snipe-it是一款开源的资产管理系统,采用Laravel的PHP框架进行编写。在实际工作中，完全替代EXECL表格的资产管理。支持多语言，方便公司全球化扩张。<br>官网:<a href=\"https://snipeitapp.com/\" target=\"_blank\" rel=\"noopener\">https://snipeitapp.com/</a><br>安装文档:<a href=\"https://snipe-it.readme.io\" target=\"_blank\" rel=\"noopener\">https://snipe-it.readme.io</a></p>\n<p><br></p>\n<h5 id=\"2-搭建流程\"><a href=\"#2-搭建流程\" class=\"headerlink\" title=\"2.搭建流程\"></a>2.搭建流程</h5><p>环境构建:</p>\n<ul>\n<li>CentOS7</li>\n<li>Snipe-Mysql</li>\n<li>Snipe-IT </li>\n</ul>\n<p>安装版本系统信息<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Snipe-IT version \tv4.7.8 build 4170 (g4fe689dc5)</span><br><span class=\"line\">软件许可证 \tAGPL3</span><br><span class=\"line\">PHP版本 \t7.1.33-1+ubuntu16.04.1+deb.sury.org+1</span><br><span class=\"line\">Laravel版本 \t5.5.47</span><br></pre></td></tr></table></figure></p>\n<p>1.安装步骤:<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191119214157.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p>下面我们采用最简单的Docker部署的方式进行安装:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1.宿主机上面建立相应的持久化目录</span></span><br><span class=\"line\">sudo mkdir -p /app/Snipe-mysql /app/Snipe-conf</span><br><span class=\"line\">sudo tee /etc/yum.repos.d/docker.repo &lt;&lt;-<span class=\"string\">'EOF'</span></span><br><span class=\"line\">[dockerrepo]</span><br><span class=\"line\">name=Docker Repository</span><br><span class=\"line\">baseurl=https://yum.dockerproject.org/repo/main/centos/<span class=\"variable\">$releasever</span>/</span><br><span class=\"line\">enabled=1</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">gpgkey=https://yum.dockerproject.org/gpg</span><br><span class=\"line\">EOF</span><br><span class=\"line\">yum install docker-ce docker-compose -y</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.生成APP_KEY并利用其来修改yml配置文件</span></span><br><span class=\"line\">php artisan key:generate</span><br><span class=\"line\"><span class=\"comment\"># Please re-run this container with an environment variable $APP_KEY</span></span><br><span class=\"line\"><span class=\"comment\"># An example APP_KEY you could use is: </span></span><br><span class=\"line\"><span class=\"comment\"># base64:D5oGA+zhFSVA3VwuoZoQ21RAcwBtJv/RGiqOcZ7BUvI=</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3.修改env环境变量</span></span><br><span class=\"line\"><span class=\"comment\">#参考；https://snipe-it.readme.io/docs/configuration</span></span><br><span class=\"line\"><span class=\"comment\">#参考: https://bbs.sangfor.com.cn/forum.php?mod=viewthread&amp;tid=87421#</span></span><br><span class=\"line\"><span class=\"comment\"># Mysql Parameters</span></span><br><span class=\"line\">MYSQL_ROOT_PASSWORD=<span class=\"comment\">#SnipeIT#Root</span></span><br><span class=\"line\">MYSQL_DATABASE=snipeit</span><br><span class=\"line\">MYSQL_USER=snipeit</span><br><span class=\"line\">MYSQL_PASSWORD=<span class=\"comment\">#SnipeIT#SnipeIT</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Email Parameters</span></span><br><span class=\"line\"><span class=\"comment\"># - the hostname/IP address of your mailserver</span></span><br><span class=\"line\"><span class=\"comment\"># MAIL_PORT_587_TCP_ADDR=smtp.whatever.com</span></span><br><span class=\"line\"><span class=\"comment\"># #the port for the mailserver (probably 587, could be another)</span></span><br><span class=\"line\"><span class=\"comment\"># MAIL_PORT_587_TCP_PORT=587</span></span><br><span class=\"line\"><span class=\"comment\"># # the default from address, and from name for emails</span></span><br><span class=\"line\"><span class=\"comment\"># MAIL_ENV_FROM_ADDR=youremail@yourdomain.com</span></span><br><span class=\"line\"><span class=\"comment\"># MAIL_ENV_FROM_NAME=Your Full Email Name</span></span><br><span class=\"line\"><span class=\"comment\"># # - pick 'tls' for SMTP-over-SSL, 'tcp' for unencrypted</span></span><br><span class=\"line\"><span class=\"comment\"># MAIL_ENV_ENCRYPTION=tcp</span></span><br><span class=\"line\"><span class=\"comment\"># # SMTP username and password</span></span><br><span class=\"line\"><span class=\"comment\"># MAIL_ENV_USERNAME=your_email_username</span></span><br><span class=\"line\"><span class=\"comment\"># MAIL_ENV_PASSWORD=your_email_password</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Snipe-IT Settings</span></span><br><span class=\"line\">APP_ENV=production</span><br><span class=\"line\">APP_DEBUG=<span class=\"literal\">false</span></span><br><span class=\"line\">APP_KEY=base64:5U/KPKw1GN/Rz0fWYO/4FsSOqjmjvDAQzMCqwcAqstc=</span><br><span class=\"line\"><span class=\"comment\">#注意构建时候修改成为外网地址</span></span><br><span class=\"line\">APP_URL=http://127.0.0.1:80 </span><br><span class=\"line\">APP_TIMEZONE=Asia/Shanghai</span><br><span class=\"line\">APP_LOCALE=zh-CN</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># user</span></span><br><span class=\"line\">PUID=1000</span><br><span class=\"line\">PGID=1000</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># SNIPEIT CONNECT MYSQL (这里直接可以实用docker-compose.yml)</span></span><br><span class=\"line\">DB_HOST=db</span><br><span class=\"line\">DB_DATABASE=snipeit</span><br><span class=\"line\">DB_USERNAME=snipeit</span><br><span class=\"line\">DB_PASSWORD=<span class=\"comment\">#SnipeIT#SnipeIT</span></span><br><span class=\"line\">DB_DUMP_PATH=<span class=\"string\">'/usr/bin'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># OPTIONAL: LOGIN THROTTLING</span></span><br><span class=\"line\">LOGIN_MAX_ATTEMPTS=5</span><br><span class=\"line\">LOGIN_LOCKOUT_DURATION=60</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#3.编写Docker-compose.yml进行一键部署</span></span><br><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">'3'</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\"><span class=\"attr\">  snipe-mysql:</span></span><br><span class=\"line\"><span class=\"attr\">    container_name:</span> <span class=\"string\">snipe-mysql</span></span><br><span class=\"line\"><span class=\"attr\">    image:</span> <span class=\"attr\">mysql:5.6</span></span><br><span class=\"line\"><span class=\"attr\">    env_file:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">./.env</span></span><br><span class=\"line\"><span class=\"attr\">    volumes:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">/app/Snipe-IT/data:/var/lib/mysql</span></span><br><span class=\"line\"><span class=\"attr\">    command:</span> <span class=\"bullet\">--default-authentication-plugin=mysql_native_password</span></span><br><span class=\"line\"><span class=\"attr\">    ports:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">\"3366:3306\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">  snipe-it:</span></span><br><span class=\"line\"><span class=\"attr\">    image:</span> <span class=\"string\">snipe/snipe-it</span></span><br><span class=\"line\"><span class=\"attr\">    container_name:</span> <span class=\"string\">snipe-it</span></span><br><span class=\"line\"><span class=\"attr\">    env_file:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">./.env</span></span><br><span class=\"line\"><span class=\"attr\">    ports:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">\"8080:80\"</span></span><br><span class=\"line\"><span class=\"attr\">    depends_on:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">snipe-mysql</span></span><br><span class=\"line\"><span class=\"attr\">    volumes:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">/app/Snipe-IT/web:/config</span></span><br><span class=\"line\"><span class=\"attr\">    links:</span></span><br><span class=\"line\"><span class=\"attr\">      - snipe-mysql:</span><span class=\"string\">db</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4.验证是否yml有误</span></span><br><span class=\"line\"><span class=\"string\">[root@192</span> <span class=\"string\">app]#</span> <span class=\"string\">docker-compose</span> <span class=\"string\">config</span></span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191120095544.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#5.运行并且构建环境（这里我们不后台运行）</span></span><br><span class=\"line\">docker-compose up</span><br><span class=\"line\"><span class=\"comment\"># Creating network \"app_default\" with the default driver</span></span><br><span class=\"line\"><span class=\"comment\"># Pulling snipe-mysql (mysql:5.6)...</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#其他方式运行该环境</span></span><br><span class=\"line\"><span class=\"comment\">#5.建立数据库容器</span></span><br><span class=\"line\"><span class=\"comment\"># docker run \\</span></span><br><span class=\"line\"><span class=\"comment\"># --name snipe-mysql \\</span></span><br><span class=\"line\"><span class=\"comment\"># -d \\</span></span><br><span class=\"line\"><span class=\"comment\"># -e MYSQL_ROOT_PASSWORD=\"3yyDOLC6VPFG&amp;5gk#yNl\" \\</span></span><br><span class=\"line\"><span class=\"comment\"># -e MYSQL_DATABASE=snipe \\</span></span><br><span class=\"line\"><span class=\"comment\"># -e MYSQL_USER=snipe \\</span></span><br><span class=\"line\"><span class=\"comment\"># -e MYSQL_PASSWORD=\"29fMXli8ZRQCXnxnUEG\" \\</span></span><br><span class=\"line\"><span class=\"comment\"># -e TZ=America/Chicago \\</span></span><br><span class=\"line\"><span class=\"comment\"># -p 127.0.0.1:3306:3306 \\</span></span><br><span class=\"line\"><span class=\"comment\"># -v /media/snipe-mysql:/var/lib/mysql \\</span></span><br><span class=\"line\"><span class=\"comment\"># mysql:5.6 --sql-mode=\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># #6.建立Web容器</span></span><br><span class=\"line\"><span class=\"comment\"># docker create \\</span></span><br><span class=\"line\"><span class=\"comment\">#   --name=snipe-it \\</span></span><br><span class=\"line\"><span class=\"comment\">#   --link snipe-mysql:db \\</span></span><br><span class=\"line\"><span class=\"comment\">#   -e PUID=1000 \\</span></span><br><span class=\"line\"><span class=\"comment\">#   -e PGID=1000 \\</span></span><br><span class=\"line\"><span class=\"comment\">#   -e DB_CONNECTION=mysql \\</span></span><br><span class=\"line\"><span class=\"comment\">#   -e DB_HOST=snipe-mysql \\</span></span><br><span class=\"line\"><span class=\"comment\">#   -e DB_DATABASE=snipe \\</span></span><br><span class=\"line\"><span class=\"comment\">#   -e DB_USERNAME=snipe \\</span></span><br><span class=\"line\"><span class=\"comment\">#   -e DB_PASSWORD=\"29fMXli8ZRQCXnxnUEG\" \\</span></span><br><span class=\"line\"><span class=\"comment\">#   -e APP_KEY=base64:5U/KPKw1GN/Rz0fWYO/4FsSOqjmjvDAQzMCqwcAqstc= \\</span></span><br><span class=\"line\"><span class=\"comment\">#   -p 8082:80 \\</span></span><br><span class=\"line\"><span class=\"comment\">#   -v /media/snipe-conf:/config \\</span></span><br><span class=\"line\"><span class=\"comment\">#   --restart unless-stopped \\</span></span><br><span class=\"line\"><span class=\"comment\">#   snipe/snipe-it</span></span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191121131153.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n<ol start=\"2\">\n<li>打开浏览器访问设置好的站点 <code>http://10.10.10.10:8082/setup</code> 并且检测相关条件是否符合(Create Database Tables)<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191116125056.png\" alt=\"WeiyiGeek.Snipe-IT Pre-Flight Setup\" title=\"\" class=\"\">\n                <p>WeiyiGeek.Snipe-IT Pre-Flight Setup</p>\n            </figure>\n</li>\n</ol>\n<ol start=\"3\">\n<li>创建用户信息完成保存后即可完成并登陆到仪表台<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191116125342.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n</li>\n</ol>\n<p><br></p>\n<h5 id=\"5-基础使用\"><a href=\"#5-基础使用\" class=\"headerlink\" title=\"5.基础使用\"></a>5.基础使用</h5><p><strong>(1) 二维码显示设置</strong><br>点击设置 -&gt; Barcodes(Barcode &amp; QR settings) -&gt;  显示二维码<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191125103458.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p><br></p>\n<p><strong>(2)LDAP同步设置</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#LDAP过滤器完整格式</span></span><br><span class=\"line\">&amp;(sAMAccountType=805306368)(!(userAccountControl:1.2.840.113556.1.4.803:=2))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#然后设置定时任务</span></span><br><span class=\"line\">vim /etc/crontab</span><br><span class=\"line\">0 */3 * * * /usr/<span class=\"built_in\">local</span>/php/bin/php /data/http/html/snipeit/artisan snipeit:ldap-sync &gt;&gt; /dev/null 2&gt;&amp;1  //每三个小时执行一次</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191125111451.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p><br></p>\n<p><strong>(3)数据库备份</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@44dc40312522:/var/www/html/storage/app<span class=\"comment\"># chown -R docker:root /var/www/html/storage/app/</span></span><br><span class=\"line\">total 4.0K</span><br><span class=\"line\">drwxr-xr-x 1 docker root 39 Nov  9 01:15 .</span><br><span class=\"line\">drwxr-xr-x 1 docker root 46 Nov  9 01:15 ..</span><br><span class=\"line\">-rwxr-xr-x 1 docker root 23 Nov  9 01:04 .gitignore</span><br><span class=\"line\">lrwxrwxrwx 1 docker root 22 Nov  9 01:15 backups -&gt; /var/lib/snipeit/dumps</span><br><span class=\"line\">root@44dc40312522:/var/www/html/storage/app<span class=\"comment\"># chown -R docker:root /var/lib/snipeit/dumps/</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h5 id=\"4-进阶配置\"><a href=\"#4-进阶配置\" class=\"headerlink\" title=\"4.进阶配置\"></a>4.进阶配置</h5><p><strong>OpenLDAP登录Snipe-IT配置</strong><br>环境说明:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Snipe-IT version \tv4.9.0 build 4210 (g8b2f8ef3c) </span><br><span class=\"line\">PHP版本 \t7.1.33-12+ubuntu16.04.1+deb.sury.org+1</span><br><span class=\"line\">Laravel版本 \t5.5.48</span><br></pre></td></tr></table></figure><br><br/></p>\n<p>Setting -&gt; LDAP/Active Directory 配置如下，官网ldap-sync-login配置参考:<code>https://snipe-it.readme.io/docs/ldap-sync-login</code><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LDAP集成:  启用LDAP验证</span><br><span class=\"line\">LDAP密码同步: 可选</span><br><span class=\"line\">LDAP 服务器: ldap://127.0.0.1</span><br><span class=\"line\">LDAP 用户名: cn=weiyi,geek,dc=com,dc=cn</span><br><span class=\"line\">LDAP 密码: password</span><br><span class=\"line\">Base Bind DN: ou=People,dc=geek,dc=com,dc=cn</span><br><span class=\"line\">LDAP 过滤器: &amp;(objectclass=inetOrgPerson)(memberof=cn=snipeit,ou=Group,dc=geek,dc=com,dc=cn) <span class=\"comment\">#此处采用GroupOfUniqueNames用户组属性(过滤是唯一)</span></span><br><span class=\"line\">用户名字段: uid</span><br><span class=\"line\">姓氏: sn</span><br><span class=\"line\">LDAP用户名字字段:cn</span><br><span class=\"line\">LDAP认证请求:uid=  <span class=\"comment\">#注意openladp默认是cn 您需要进行设置RDN</span></span><br><span class=\"line\">LDAP 版本: 3</span><br><span class=\"line\">LDAP Email: mail</span><br></pre></td></tr></table></figure></p>\n<p>openldap服务创建配置如下:</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200414161850.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n<p>补充由于版本适用于AD的LDAP,此时需要对ldap.php文件进行修改<br><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#Index: app/Models/Ldap.php</span></span><br><span class=\"line\">@@ <span class=\"number\">-98</span>,<span class=\"number\">8</span> +<span class=\"number\">98</span>,<span class=\"number\">10</span> @@</span><br><span class=\"line\"><span class=\"keyword\">if</span> (!$ldapbind = @ldap_bind($connection, $userDn, $password)) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(!$ldapbind = Ldap::bindAdminToLdap($connection))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@@ <span class=\"number\">-148</span>,<span class=\"number\">7</span> +<span class=\"number\">150</span>,<span class=\"number\">7</span> @@</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!$ldapbind = @ldap_bind($connection, $ldap_username, $ldap_pass)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"keyword\">Exception</span>(<span class=\"string\">'Could not bind to LDAP: '</span>.ldap_error($connection));</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> $ldapbind;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>然后重启snipeit容器测试LDAP登录连接:</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200414162230.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#开启同步密码（可以手动或者自动）</span></span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> -it snipe-it1 php artisan snipeit:ldap-sync --location=<span class=\"string\">\"LDAP\"</span> --summary</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#禁用LDAP登录</span></span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> -it snipe-it1 php artisan snipeit:<span class=\"built_in\">disable</span></span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200414163927.png\" alt=\"WeiyiGeek.LDAP登录\" title=\"\" class=\"\">\n                <p>WeiyiGeek.LDAP登录</p>\n            </figure>\n<p>补充知识:</p>\n<ul>\n<li><p>(1) Windows AD 域 LDAP过滤器完整格式 <code>&amp;(sAMAccountType=805306368)(!(userAccountControl:1.2.840.113556.1.4.803:=2))</code></p>\n</li>\n<li><p>(2) SnipeIT 定时同步 <code>0 */3 * * * /usr/local/php/bin/php /data/http/html/snipeit/artisan snipeit:ldap-sync &gt;&gt; /dev/null 2&gt;&amp;1  //每三个小时执行一次</code></p>\n</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200414204315.png\" alt=\"WeiyiGeek.AD-LDAP\" title=\"\" class=\"\">\n                <p>WeiyiGeek.AD-LDAP</p>\n            </figure>\n<ul>\n<li>(3) Snipe-IT BackUP 可以在页面上进行备份也可以采用命令行工具进行备份，实际上是创建数据库的SQL转储以及任何图像以及文件附件;<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php artisan snipeit:backup</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<h5 id=\"5-后续升级\"><a href=\"#5-后续升级\" class=\"headerlink\" title=\"5.后续升级\"></a>5.后续升级</h5><p><strong>常规安装升级</strong><br>注意:升级之前请备份数据库及程序（即snipe-it目录）,因在国内Github被qiang，所以无法通过GIT自动升级，所以只能自己手动升级了。</p>\n<p>1.备份程序目录<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv /data/http/html/snipe-it/ /data/http/html/snipe-it_bakxxxxxxxx/<span class=\"comment\">#此处因后面需要重新解压程序目录，所以在此处直接重命名</span></span><br></pre></td></tr></table></figure></p>\n<p>2.解压新版本到/data/http/html/snipe-it目录<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf snipe-it-4.5.0.tar.gz -C /data/http/html/</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /data/http/html/</span><br><span class=\"line\">mv snipe-it-4.5.0/ snipe-it</span><br></pre></td></tr></table></figure></p>\n<p>3.拷贝旧程序的配置文件至新目录并授权<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#如提示是否要覆盖.gitignore或者.gitkeep，请输入no。</span></span><br><span class=\"line\">cp -R snipe-it-backup/public/uploads/* snipe-it/public/uploads</span><br><span class=\"line\">cp -R snipe-it-backup/storage/private_uploads/* snipe-it/storage/private_uploads</span><br><span class=\"line\">cp -R snipe-it-backup/storage/app/backups/* snipe-it/storage/app/backups</span><br><span class=\"line\">cp -R snipe-it-backup/.env snipe-it/</span><br><span class=\"line\">cp -R snipe-it-backup/storage/oauth-private.key snipe-it/storage/oauth-private.key</span><br><span class=\"line\">cp -R snipe-it-backup/storage/oauth-public.key snipe-it/storage/oauth-public.key</span><br><span class=\"line\">chown -R apache:apaches snipe-it/</span><br><span class=\"line\">chmod -R 775 snipe-it/</span><br></pre></td></tr></table></figure></p>\n<p>4.重新执行Composer安装<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> snipe-it/</span><br><span class=\"line\">curl -sS https://getcomposer.org/installer | php</span><br><span class=\"line\">php composer.phar install --prefer-source</span><br><span class=\"line\">php composer.phar dump-autoloa</span><br><span class=\"line\">php artisan migrate</span><br><span class=\"line\"><span class=\"comment\">#如提示Do you really wish to run this command? (yes/no)，请输入yes</span></span><br></pre></td></tr></table></figure></p>\n<p>5.清除缓存<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php artisan config:clear</span><br><span class=\"line\">php artisan config:cache</span><br></pre></td></tr></table></figure><br>到此升级完成，请访问你的网页查看页面及数据是否正常。</p>\n<p><br></p>\n<p><strong>Docker安装升级</strong><br>注意点:<a href=\"https://snipe-it.readme.io/docs/docker\" target=\"_blank\" rel=\"noopener\">https://snipe-it.readme.io/docs/docker</a></p>\n<p>数据库迁移:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE DATABASE snipeit;</span><br><span class=\"line\">CREATE USER <span class=\"string\">'snipeit'</span>@<span class=\"string\">'%'</span> IDENDIFIED BY <span class=\"string\">'123456'</span>;</span><br><span class=\"line\">GRANT all ON snipeit.* TO <span class=\"string\">'snipeit'</span>@<span class=\"string\">'%'</span> WITH GRANT OPTION;  <span class=\"comment\"># GRANT OPTION 则是管理员权限;</span></span><br></pre></td></tr></table></figure></p>\n<hr>\n<h4 id=\"0x02-CLPI\"><a href=\"#0x02-CLPI\" class=\"headerlink\" title=\"0x02 CLPI\"></a>0x02 CLPI</h4><h5 id=\"安装流程\"><a href=\"#安装流程\" class=\"headerlink\" title=\"安装流程\"></a>安装流程</h5><p>CMDB系统: abbr. 配置管理数据库（Configuration Management Database）<br>官网地址: <a href=\"https://glpi-project.org/\" target=\"_blank\" rel=\"noopener\">https://glpi-project.org/</a></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/luckman666/deploy_glpi.git</span><br><span class=\"line\"><span class=\"built_in\">cd</span> deploy_glpi</span><br><span class=\"line\">docker-compose up -d</span><br></pre></td></tr></table></figure>\n<p>访问进行:<a href=\"http://10.10.10.10:8081/install/install.php\" target=\"_blank\" rel=\"noopener\">http://10.10.10.10:8081/install/install.php</a> 进行安装CLPI流程</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191116135821.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191116135850.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n<p>数据库设置(注意这里采用低权限的用户):<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191116143814.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p>选择我们创建的数据库(glpi):<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191116143825.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p>直接下一步，直到显示 缺省 登录名/密码是：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">管理员帐号是 glpi/glpi</span><br><span class=\"line\">技术员帐号是 tech/tech</span><br><span class=\"line\">普通帐号是 normal/normal</span><br><span class=\"line\">只能发布的帐号是 post-only/postonly</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191116144012.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p>登录后主界面：<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191116150136.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p><strong>注意事项:</strong></p>\n<ul>\n<li>为了安全，请更改默认用户glpi post-only tech normal 的密码</li>\n<li>为了安全，请删除文件：<code>install/install.php</code></li>\n</ul>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"OperationTools","path":"api/categories/OperationTools.json"}],"tags":[{"name":"IT资产管理","path":"api/tags/IT资产管理.json"}]}