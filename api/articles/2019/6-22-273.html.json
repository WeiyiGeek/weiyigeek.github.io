{"title":"Python自动化运维1","slug":"系统运维/自动化运维/Python/Python自动化运维1","date":"2019-06-22T06:34:30.000Z","updated":"2023-01-31T02:29:10.467Z","url":"2019/6-22-273.html","path":"api/articles/2019/6-22-273.html.json","covers":["https://img.weiyigeek.top/2019/20190613225721.png","https://img.weiyigeek.top/2019/20190710174955.png","https://img.weiyigeek.top/2019/20190712094042.png","https://img.weiyigeek.top/2019/20190712110712.png","https://img.weiyigeek.top/2019/20190727182805.png","https://img.weiyigeek.top/2019/1/20190726173307.png","https://img.weiyigeek.top/2019/1/20190730175422.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-快速入门\"><a href=\"#0x00-快速入门\" class=\"headerlink\" title=\"0x00 快速入门\"></a>0x00 快速入门</h4><h4 id=\"系统基础信息\"><a href=\"#系统基础信息\" class=\"headerlink\" title=\"系统基础信息\"></a>系统基础信息</h4><h5 id=\"psutil-系统性能信息模块\"><a href=\"#psutil-系统性能信息模块\" class=\"headerlink\" title=\"psutil-系统性能信息模块\"></a>psutil-系统性能信息模块</h5><p>psutil是一个跨平台库，用于检索Python中运行的进程和系统利用率(CPU、内存、磁盘、网络、传感器)的信息。支持平台:</p>\n<ul>\n<li>Linux</li>\n<li>Windows</li>\n<li>macOS</li>\n<li>FreeBSD</li>\n<li>OpenBSD</li>\n<li>NetBSD</li>\n<li>Sun Solaris</li>\n<li>AIX</li>\n</ul>\n<p>下载与使用：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install psutil</span><br><span class=\"line\">&gt;&gt;&gt; <span class=\"built_in\">help</span>(psutil)</span><br></pre></td></tr></table></figure></p>\n<p>使用案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python3</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding:utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\">#功能：系统基础信息模块收集</span></span><br><span class=\"line\">import psutil</span><br><span class=\"line\">import datetime</span><br><span class=\"line\">from subprocess import PIPE</span><br><span class=\"line\"></span><br><span class=\"line\">def Memory():</span><br><span class=\"line\">    mem = psutil.virtual_memory()</span><br><span class=\"line\">    swap = psutil.swap_memory()</span><br><span class=\"line\">    total = round(mem.total / pow(1024,3),2)</span><br><span class=\"line\">    free = round(mem.available / pow(1024,3),2)</span><br><span class=\"line\">    use = total - free</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"系统内存信息：\"</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"\\tTotal：&#123;1:.2f&#125; &#123;0&#125; \\n\\tUse：&#123;2:.2f&#125; &#123;0&#125; \\n\\tFree: &#123;3:.2f&#125; &#123;0&#125; \\</span></span><br><span class=\"line\"><span class=\"string\">         \\n\\t内存使用百分比：&#123;4:.2f&#125;% \\n\"</span>.format(<span class=\"string\">\"GB\"</span>,total,use,free,mem.percent))  <span class=\"comment\"># 格式化数据</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"\\tswapTotal：&#123;1:.2f&#125; &#123;0&#125; \\n\\tswapUse：&#123;2:.2f&#125; &#123;0&#125; \\n\\tswapFree: &#123;3:.2f&#125; &#123;0&#125; \\</span></span><br><span class=\"line\"><span class=\"string\">         \\n\\t交换分区使用百分比：&#123;4:.2f&#125;% \\n\"</span>.format(<span class=\"string\">\"GB\"</span>,swap.total / pow(1024,3)  ,swap.used / pow(1024,3) ,swap.free / pow(1024,3),swap.percent))  <span class=\"comment\"># 格式化数据</span></span><br><span class=\"line\"></span><br><span class=\"line\">def Cpu():</span><br><span class=\"line\">    cpu = psutil.cpu_times()</span><br><span class=\"line\">    cpucount = psutil.cpu_count()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"系统处理器信息：\"</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"\\tUser：&#123;1:.2f&#125; \\n\\</span></span><br><span class=\"line\"><span class=\"string\">        Sysetm：&#123;2:.2f&#125; \\n\\</span></span><br><span class=\"line\"><span class=\"string\">        idle: &#123;3:.2f&#125; \\n\\</span></span><br><span class=\"line\"><span class=\"string\">        CPU逻辑个数：&#123;4:d&#125; \\n\\t\"</span>.format(<span class=\"string\">\"\"</span>,cpu.user,cpu.system,cpu.idle,cpucount))  <span class=\"comment\"># 格式化数据</span></span><br><span class=\"line\"></span><br><span class=\"line\">def Disk():</span><br><span class=\"line\">    disk = psutil.disk_partitions();</span><br><span class=\"line\">    diskio = psutil.disk_io_counters()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"系统磁盘信息：\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> disk:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(i.device,i.fstype,i.opts,end=<span class=\"string\">\"\\n\"</span>)</span><br><span class=\"line\">        diskname = psutil.disk_usage(i.device)</span><br><span class=\"line\">        diskvalue = []</span><br><span class=\"line\">        <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> diskname:</span><br><span class=\"line\">            diskvalue.append(j)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">\"Total: &#123;1:.2f&#125;&#123;0&#125; Used: &#123;2:.2f&#125;&#123;0&#125; Free: &#123;3:.2f&#125;&#123;0&#125; 磁盘使用百分百：&#123;4:.2f&#125;%\\n\"</span>.format(<span class=\"string\">\"GB\"</span>,diskvalue[0] / pow(1024,3),diskvalue[1] / pow(1024,3),diskvalue[2] / pow(1024,3),diskvalue[3]))</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"磁盘IO信息：Read:\"</span>,diskio.read_count,<span class=\"string\">\" Read_time: \"</span>,diskio.read_time,<span class=\"string\">\"\\tWrite:\"</span>,diskio.write_count,<span class=\"string\">\" Write_time: \"</span>,diskio.write_time,<span class=\"string\">\"\\n\"</span>)       </span><br><span class=\"line\"></span><br><span class=\"line\">def Net():</span><br><span class=\"line\">    ip = psutil.net_if_addrs()</span><br><span class=\"line\">    netio = psutil.net_io_counters()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"系统网卡信息：\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> ip:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">\"\\t\"</span>,i,end=<span class=\"string\">\"\\t\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> ip[i]:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(x.address,end=<span class=\"string\">\"  \"</span>)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">\"\"</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"\\n\\t Bytes_sent : &#123;0:d&#125;  Bytes_recv : &#123;1:d&#125; \\n\\t packets_sent(发送数据包) : &#123;2:d&#125;  packets_recv(接收数据包)：&#123;3:d&#125;\\n\"</span>.format(netio.bytes_sent,netio.bytes_recv,netio.packets_sent,netio.packets_recv))</span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">def Info():</span><br><span class=\"line\">    users = psutil.users()</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"系统用户信息:\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> users:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">\"\\t\"</span>,i,end=<span class=\"string\">\" \"</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"\\t系统开启时间：\"</span>,datetime.datetime.fromtimestamp(users[0].started).strftime(<span class=\"string\">\"%Y-%m-%d %H:%M:%S\"</span>))</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"\\t开机时间：\"</span>,datetime.datetime.fromtimestamp(psutil.boot_time()).strftime(<span class=\"string\">\"%Y-%m-%d %H:%M:%S\"</span>),end=<span class=\"string\">\"\\n\\n\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">def Process():</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"系统进程信息:\"</span>)</span><br><span class=\"line\">    pid = psutil.pids();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> pidnum <span class=\"keyword\">in</span> pid:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">\"\\t\"</span>,psutil.Process(pidnum).pid,<span class=\"string\">\":\"</span>,psutil.Process(pidnum).name())</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#系统性能信息：内存 / CPU / 磁盘 / 网络 / 杂类  </span></span><br><span class=\"line\">def systemPerformance():</span><br><span class=\"line\">   Cpu()</span><br><span class=\"line\">   Memory()</span><br><span class=\"line\">   Disk()</span><br><span class=\"line\">   Net()</span><br><span class=\"line\">   Info()</span><br><span class=\"line\">   Process()</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">#通过psutil的Popen()方法启动应用程序,可以跟踪该程序运行的所有相关信息</span></span><br><span class=\"line\">   p = psutil.Popen([<span class=\"string\">\"python\"</span>,<span class=\"string\">\"-c\"</span>,<span class=\"string\">\"print('Hello World!')\"</span>],stdout=PIPE)</span><br><span class=\"line\">   <span class=\"built_in\">print</span>(p)</span><br><span class=\"line\">   <span class=\"built_in\">print</span>(p.username(),p.communicate())</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">\"__main__\"</span>:</span><br><span class=\"line\">    systemPerformance()</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190613225721.png\" alt=\"WeiyiGeek.系统环境测试\" title=\"\" class=\"\">\n                <p>WeiyiGeek.系统环境测试</p>\n            </figure></p>\n<hr>\n\n<h4 id=\"系统监控\"><a href=\"#系统监控\" class=\"headerlink\" title=\"系统监控\"></a>系统监控</h4><h5 id=\"dnspython-域名轮询业务监控\"><a href=\"#dnspython-域名轮询业务监控\" class=\"headerlink\" title=\"dnspython-域名轮询业务监控\"></a>dnspython-域名轮询业务监控</h5><p>描述：常用的DNS解析都是一个域名对应一个IP地址，但是通过DNS轮询技术可以做到一个域名对应多个IP；</p>\n<ul>\n<li>好处：实现最简单且高效的负载平衡；</li>\n<li>缺点：目标主机不可用时无法被自动剔除；</li>\n</ul>\n<p>实际案例:<br><a href=\"https://github.com/WeiyiGeek/Study-Promgram/blob/master/Python3/Python自动化运维/dnsmonitorweb.py\" target=\"_blank\" rel=\"noopener\">+ Github查看</a><br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @File : dnsmonitorweb.py.py</span></span><br><span class=\"line\"><span class=\"comment\"># @CreateTime : 2019/7/10 16:58</span></span><br><span class=\"line\"><span class=\"comment\"># @Author : WeiyiGeek</span></span><br><span class=\"line\"><span class=\"comment\"># @Function : 实现DNS域名轮询业务监控</span></span><br><span class=\"line\"><span class=\"comment\"># @Software: PyCharm</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> dns.resolver</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib.request</span><br><span class=\"line\"><span class=\"keyword\">import</span> ssl</span><br><span class=\"line\"></span><br><span class=\"line\">iplist=[]</span><br><span class=\"line\">domain=<span class=\"string\">\"www.qq.com.cn\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_ip</span><span class=\"params\">(domain=<span class=\"string\">\"\"</span>)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        A = dns.resolver.query(domain,<span class=\"string\">'A'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        print(<span class=\"string\">\"DNS resolver error : %s \"</span> % str(e))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> A.response.answer:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> i.items:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> j.address <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> iplist:</span><br><span class=\"line\">                iplist.append(j.address)</span><br><span class=\"line\">                print(<span class=\"string\">\"DNS A 记录：%s\"</span> %j)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">checkweb</span><span class=\"params\">(ipaddr)</span>:</span></span><br><span class=\"line\">    url = <span class=\"string\">\"http://\"</span>+ipaddr</span><br><span class=\"line\">    content =<span class=\"string\">\"\"</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        response = urllib.request.urlopen(url,timeout=<span class=\"number\">5</span>,context=ssl._create_unverified_context())  <span class=\"comment\">#定义http链接超时时间15秒,支持https请求</span></span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        print(<span class=\"string\">\"[URL请求错误]: \\n%s\"</span> % str(e))</span><br><span class=\"line\">    <span class=\"keyword\">finally</span>:</span><br><span class=\"line\">        print(<span class=\"string\">\"请求URL：\"</span>, response.geturl())</span><br><span class=\"line\">        print(<span class=\"string\">\"状态码：\"</span>, response.getcode())</span><br><span class=\"line\">        print(<span class=\"string\">\"返回消息头：\\n%s\"</span> %response.info())</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> int(response.getcode()) == <span class=\"number\">200</span>:</span><br><span class=\"line\">            print(ipaddr + <span class=\"string\">\" [alive]\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            print(ipaddr + <span class=\"string\">\" [Error]\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    <span class=\"keyword\">if</span> get_ip(domain) <span class=\"keyword\">and</span> len(iplist) &gt; <span class=\"number\">0</span>:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> ip <span class=\"keyword\">in</span> iplist:</span><br><span class=\"line\">            checkweb(ip)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            print(<span class=\"string\">\"监测完成\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        print(<span class=\"string\">\"DNS Resolver Error!\"</span>)</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190710174955.png\" alt=\"WeiyiGeek.web示例\" title=\"\" class=\"\">\n                <p>WeiyiGeek.web示例</p>\n            </figure></p>\n<hr>\n\n<h4 id=\"文件比对\"><a href=\"#文件比对\" class=\"headerlink\" title=\"文件比对\"></a>文件比对</h4><h5 id=\"文件内容差异对比\"><a href=\"#文件内容差异对比\" class=\"headerlink\" title=\"文件内容差异对比\"></a>文件内容差异对比</h5><p><strong>(1)difflib模块</strong><br>描述：difflib作为Python的标准库模块，作用是对比文件之间的差异并将结果输出到HTML文档中；<br><em>符号含义说明</em>:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># '-' : 在头部表示在一个序列中，但不包含在第二个序列行中,当在底部的时候代表则多余差异;</span></span><br><span class=\"line\"><span class=\"comment\"># '+' : 在头部表示在二个序列中，但不包含在第一个序列行中</span></span><br><span class=\"line\"><span class=\"comment\"># ' ' : 两个序列是一致的</span></span><br><span class=\"line\"><span class=\"comment\"># '?' : 标志两个序列行存在增量差异</span></span><br><span class=\"line\"><span class=\"comment\"># '^' : 标志出两个序列行存在的差异字符</span></span><br></pre></td></tr></table></figure></p>\n<p>实际案例：(可以采用此种方法来对比linux配置文件的差异)<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @File : difflibfile.py</span></span><br><span class=\"line\"><span class=\"comment\"># @CreateTime : 2019/7/11 17:34</span></span><br><span class=\"line\"><span class=\"comment\"># @Author : WeiyiGeek</span></span><br><span class=\"line\"><span class=\"comment\"># @Function : 实现两个文本之间的字符串比较</span></span><br><span class=\"line\"><span class=\"comment\"># @Software: PyCharm</span></span><br><span class=\"line\"></span><br><span class=\"line\">import difflib</span><br><span class=\"line\"></span><br><span class=\"line\">t1 = <span class=\"string\">\"\"</span><span class=\"string\">\"text1</span></span><br><span class=\"line\"><span class=\"string\">this is a demo!</span></span><br><span class=\"line\"><span class=\"string\">front not diff file </span></span><br><span class=\"line\"><span class=\"string\">add string</span></span><br><span class=\"line\"><span class=\"string\">\"</span><span class=\"string\">\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">t2 = <span class=\"string\">\"\"</span><span class=\"string\">\"text2</span></span><br><span class=\"line\"><span class=\"string\">this is a demo!</span></span><br><span class=\"line\"><span class=\"string\">front diff file</span></span><br><span class=\"line\"><span class=\"string\">del string</span></span><br><span class=\"line\"><span class=\"string\">\"</span><span class=\"string\">\"\"</span></span><br><span class=\"line\">    </span><br><span class=\"line\">def main():</span><br><span class=\"line\">   t1line = t1.splitlines()  <span class=\"comment\">#以行为分割</span></span><br><span class=\"line\">   t2line = t2.splitlines()</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">#示例1.输出到shell中</span></span><br><span class=\"line\">   diff = difflib.Differ()  <span class=\"comment\">#创建Differ对象</span></span><br><span class=\"line\">   result = diff.compare(t1line,t2line)</span><br><span class=\"line\">   <span class=\"comment\"># print(\"\\n\".join(list(result)))  #同下</span></span><br><span class=\"line\">   <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> list(result):     <span class=\"comment\">#缓缓输出结果 输出到标准输入内</span></span><br><span class=\"line\">       <span class=\"built_in\">print</span>(i)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">##输出结果##</span></span><br><span class=\"line\">    <span class=\"comment\"># - text1</span></span><br><span class=\"line\">    <span class=\"comment\"># ?     ^</span></span><br><span class=\"line\">    <span class=\"comment\">#</span></span><br><span class=\"line\">    <span class=\"comment\"># + text2</span></span><br><span class=\"line\">    <span class=\"comment\"># ?     ^</span></span><br><span class=\"line\">    <span class=\"comment\">#</span></span><br><span class=\"line\">    <span class=\"comment\">#   this is a demo!</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># - front not diff file</span></span><br><span class=\"line\">    <span class=\"comment\"># ?     ----           -</span></span><br><span class=\"line\">    <span class=\"comment\">#</span></span><br><span class=\"line\">    <span class=\"comment\"># + front diff file  #这里不存在增量差异</span></span><br><span class=\"line\">    <span class=\"comment\"># - add string</span></span><br><span class=\"line\">    <span class=\"comment\"># ? - ^</span></span><br><span class=\"line\">    <span class=\"comment\">#</span></span><br><span class=\"line\">    <span class=\"comment\"># + del string</span></span><br><span class=\"line\">    <span class=\"comment\"># ?  ^^</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">#示例2.生产美观的对比HTML格式文档</span></span><br><span class=\"line\">   d = difflib.HtmlDiff()</span><br><span class=\"line\">   with open(<span class=\"string\">\"diff.html\"</span>,<span class=\"string\">'w+'</span>) as f:</span><br><span class=\"line\">       f.writelines(d.make_file(t1line,t2line))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190712094042.png\" alt=\"WeiyiGeek.difflib示例\" title=\"\" class=\"\">\n                <p>WeiyiGeek.difflib示例</p>\n            </figure>\n<p><br></p>\n<p><strong>(2)filecmp模块</strong><br>描述：filecmp是Python自带模块，可实现文件/目录/遍历子目录的差异对比功能;<br>比如报告中输出目标目录比原始多出的文件或者子目录，即使文件同名也会判断是否为同一文件(内容级对比);</p>\n<p>filecmp三个操作方法：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(1)单文件对比：filecmp.cmp(f1,f2[,shallow]) <span class=\"comment\">#比较f1,f2文件是否相同 True/Fasle</span></span><br><span class=\"line\"> - shallow：缺省为True，表示不根据os.stat()方法返回文件基础信息进行对比判断如访问与修改时间,如为Fasle则根据</span><br><span class=\"line\"></span><br><span class=\"line\">(2)多文件对比：filecmp.cmp(dir1,dir2,common[,shallow]) <span class=\"comment\">#比对两个目录中的文件，返回三个列表分别是匹配，不匹配以及错误</span></span><br><span class=\"line\">- common : 列表表示需要对比的文件[f1,f2,f3,f4]</span><br><span class=\"line\">- 匹配为包含匹配的文件列表，反之则不匹配，错误列表代表了目录中不存在的文件以及权限的原因导致不能比较的文件清单等等</span><br><span class=\"line\"></span><br><span class=\"line\">[dir1]</span><br><span class=\"line\">ee38a408f20702ccc05fb39a04ee251c  f1</span><br><span class=\"line\">1139929d8855ced585631c0e3fe8ad8d  f2</span><br><span class=\"line\">c35957891d72c0c32b53a01911224e13  f3</span><br><span class=\"line\"></span><br><span class=\"line\">[dir2]</span><br><span class=\"line\">ee38a408f20702ccc05fb39a04ee251c  f1</span><br><span class=\"line\">9939929d8855ced625631c0e3fe8ad8d  f2</span><br><span class=\"line\">c35957891d72c0c32b53a01911224e13  f4</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#执行结果</span></span><br><span class=\"line\">([<span class=\"string\">'f1'</span>],[<span class=\"string\">'f2'</span>],[<span class=\"string\">'f3'</span>])</span><br><span class=\"line\"></span><br><span class=\"line\">(3)目录对比：dircmp(a,b[,ignore [,hide]]) <span class=\"comment\">#创建一个目录比较对象，支持递归会显示出a目录中包括文件以及ab都存在的子目录的匹配文件</span></span><br><span class=\"line\">- ignore : 文件名忽略列表 [<span class=\"string\">'RCS'</span>,cvs,<span class=\"string\">'tags'</span>]</span><br><span class=\"line\">- hide : 隐藏列表默认[os.curdir,os.pardir]</span><br><span class=\"line\"><span class=\"comment\"># python -c \"import os;print (os.curdir,os.pardir)\"</span></span><br><span class=\"line\"><span class=\"comment\"># ('.', '..')</span></span><br></pre></td></tr></table></figure><br>补充说明：</p>\n<ul>\n<li>report() : 比较当前指定目录中内容</li>\n<li>report_partial_closure() : 比较当前指定目录及第一级子目录中的内容</li>\n<li>report_full_closure() : 递归比较所有指定目录的内容</li>\n<li><hr>\n</li>\n<li>left  : 左目录</li>\n<li>right : 右目录</li>\n<li>left_list：左边文件夹中的文件与文件夹列表；</li>\n<li><p>right_list：右边文件夹中的文件与文件夹列表；</p>\n</li>\n<li><p>left_only：只在左边文件夹中存在的文件或文件夹；</p>\n</li>\n<li><p>right_only：只在右边文件夹中存在的文件或文件夹；</p>\n</li>\n<li><p>common：两边文件夹中都存在的文件或文件夹；</p>\n</li>\n<li>common_dirs：两边文件夹都存在的子文件夹；</li>\n<li>common_files：两边文件夹都存在的子文件；</li>\n<li><p>common_funny：两边文件夹都存在的子文件夹；</p>\n</li>\n<li><p>same_files：匹配的文件；</p>\n</li>\n<li>diff_files：不匹配的文件；</li>\n<li><p>funny_files：两边文件夹中都存在，但无法比较的文件；</p>\n</li>\n<li><p>subdirs：将 common_dirs 目录名映射到新的dircmp对象，格式为字典类型</p>\n</li>\n</ul>\n<p>实际案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @File : filedircmp.py</span></span><br><span class=\"line\"><span class=\"comment\"># @CreateTime : 2019/7/12 10:21</span></span><br><span class=\"line\"><span class=\"comment\"># @Author : WeiyiGeek</span></span><br><span class=\"line\"><span class=\"comment\"># @Function : 文件/目录之间的对比</span></span><br><span class=\"line\"><span class=\"comment\"># @Software: PyCharm</span></span><br><span class=\"line\"></span><br><span class=\"line\">import filecmp</span><br><span class=\"line\">import pprint</span><br><span class=\"line\"></span><br><span class=\"line\">file1 = <span class=\"string\">\"./diff.html\"</span></span><br><span class=\"line\">file2 = <span class=\"string\">\"./difflibfile.py\"</span></span><br><span class=\"line\">dir1 = <span class=\"string\">\"../\"</span></span><br><span class=\"line\">dir2 = <span class=\"string\">\"../../\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">def main():</span><br><span class=\"line\">  <span class=\"comment\">#示例1.文件对比不同</span></span><br><span class=\"line\">  <span class=\"built_in\">print</span>(<span class=\"string\">\"文件是否相同：%s\"</span> % str(filecmp.cmp(file1,file2,False)))</span><br><span class=\"line\">  <span class=\"built_in\">print</span>(<span class=\"string\">\"文件是否相同：%s\"</span> % str(filecmp.cmp(file1,file2,True)))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#示例2.实现目录差异对比功能</span></span><br><span class=\"line\">    <span class=\"comment\">#比较当前指定目录中内容</span></span><br><span class=\"line\">  dirobj = filecmp.dircmp(dir1,dir2,[<span class=\"string\">'diff.html'</span>]) <span class=\"comment\">#目录比较，忽略test.py文件</span></span><br><span class=\"line\">  <span class=\"built_in\">print</span>(<span class=\"string\">\"\\n[*]  report \"</span>)</span><br><span class=\"line\">  dirobj.report()</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#较当前指定目录及第一级子目录中的内容</span></span><br><span class=\"line\">  <span class=\"built_in\">print</span>(<span class=\"string\">\"\\n[*]  report partial closure \"</span>)</span><br><span class=\"line\">  dirobj.report_partial_closure()</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#递归比较所有指定目录的内容</span></span><br><span class=\"line\">  <span class=\"built_in\">print</span>(<span class=\"string\">\"\\n[*]  report full closure \"</span>)</span><br><span class=\"line\">  dirobj.report_full_closure()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#dircmp类的其他属性参考上方</span></span><br><span class=\"line\">  <span class=\"built_in\">print</span>(<span class=\"string\">\"dircmp类的left_list属性：\"</span>+str(dirobj.left_list))</span><br><span class=\"line\">  <span class=\"built_in\">print</span>(<span class=\"string\">\"dircmp类的left_only属性：\"</span>)</span><br><span class=\"line\">  pprint.pprint(dirobj.left_only)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">  main()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#补充执行结果：</span></span><br><span class=\"line\">dircmp类的left_list属性：[<span class=\"string\">'.gitignore'</span>, <span class=\"string\">'.idea'</span>, <span class=\"string\">'Day1'</span>, <span class=\"string\">'Day2'</span>, <span class=\"string\">'Day3'</span>, <span class=\"string\">'Day4'</span>, <span class=\"string\">'Day5'</span>, <span class=\"string\">'Day6'</span>, <span class=\"string\">'Day7'</span>, <span class=\"string\">'Python安全平台建设'</span>, <span class=\"string\">'Python自动化运维'</span>]</span><br><span class=\"line\">dircmp类的left_only属性：</span><br><span class=\"line\">[<span class=\"string\">'.gitignore'</span>,</span><br><span class=\"line\"> <span class=\"string\">'.idea'</span>,</span><br><span class=\"line\"> <span class=\"string\">'Day1'</span>,</span><br><span class=\"line\"> <span class=\"string\">'Day2'</span>,</span><br><span class=\"line\"> <span class=\"string\">'Day3'</span>,</span><br><span class=\"line\"> <span class=\"string\">'Day4'</span>,</span><br><span class=\"line\"> <span class=\"string\">'Day5'</span>,</span><br><span class=\"line\"> <span class=\"string\">'Day6'</span>,</span><br><span class=\"line\"> <span class=\"string\">'Day7'</span>,</span><br><span class=\"line\"> <span class=\"string\">'Python安全平台建设'</span>,</span><br><span class=\"line\"> <span class=\"string\">'Python自动化运维'</span>]</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190712110712.png\" alt=\"WeiyiGeek.filecmp示例\" title=\"\" class=\"\">\n                <p>WeiyiGeek.filecmp示例</p>\n            </figure>\n<hr>\n\n<h4 id=\"信息发送\"><a href=\"#信息发送\" class=\"headerlink\" title=\"信息发送\"></a>信息发送</h4><h5 id=\"电子邮件发送\"><a href=\"#电子邮件发送\" class=\"headerlink\" title=\"电子邮件发送\"></a>电子邮件发送</h5><p><strong>smtplib 发送电子邮件模块</strong><br>描述：SMTP（Simple Mail Transfer Protocol）是简单传输协议，它是一组用于用于由源地址到目的地址的邮件传输规则。<br><em>python对SMTP的支持</em>：<br>①email模块：负责构建邮件</p>\n<p>②smtplib模块：负责发送邮件</p>\n<ul>\n<li>smtplib模块定义了一个SMTP客户机会话对象，可以使用该对象向任何具有SMTP或ESMTP侦听器守护进程的Internet机器发送邮件</li>\n<li>Python中采用smtplib模式实现邮件的发送功能,电子邮件是最流行的互联网应用之一,运维人员常常通过邮件来发送告警信息，业务质量报表等等;</li>\n</ul>\n<p><em>stmplib模块常用：</em><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#实例化对象SMTP</span></span><br><span class=\"line\">SMTP = smtplib.SMTP(host=<span class=\"string\">''</span>, port=0, local_hostname=None, [timeout, ]source_address=None)   <span class=\"comment\">#初始化返回一个非SSL的smtp对象 默认25端口</span></span><br><span class=\"line\">SMTP =  smtplib.SMTP_SSL(host=<span class=\"string\">''</span>, port=0, local_hostname=None, keyfile=None, certfile=None, [timeout, ]context=None, source_address=None) <span class=\"comment\">#返回一个SSLsmtp对象，默认465端口</span></span><br><span class=\"line\"></span><br><span class=\"line\">LMTP = smtplib.LMTP(host=<span class=\"string\">''</span>, port=LMTP_PORT, local_hostname=None, source_address=None) <span class=\"comment\">#LMTP协议与ESMTP非常相似，主要基于标准SMTP客户机。</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#异常抛出</span></span><br><span class=\"line\">exception smtplib.SMTPException  <span class=\"comment\">#OSError的子类，它是此模块提供的所有其他异常的基异常类。</span></span><br><span class=\"line\"></span><br><span class=\"line\">exception smtplib.SMTPServerDisconnected  <span class=\"comment\">#当服务器意外断开连接时，或者在将SMTP实例连接到服务器之前尝试使用它时，会引发此异常。</span></span><br><span class=\"line\"></span><br><span class=\"line\">exception smtplib.SMTPResponseException  <span class=\"comment\">#包含SMTP错误代码的所有异常的基类当SMTP服务器返回错误代码时，会生成这些异常。</span></span><br><span class=\"line\"><span class=\"comment\">#错误代码存储在错误的smtp_code属性中，smtp_error属性设置为错误消息。</span></span><br><span class=\"line\"></span><br><span class=\"line\">exception smtplib.SMTPSenderRefused  <span class=\"comment\">#发送方地址拒绝了。除了所有SMTPResponseException异常所设置的属性之外，还将' sender '设置为SMTP服务器拒绝的字符串。</span></span><br><span class=\"line\"></span><br><span class=\"line\">exception smtplib.SMTPRecipientsRefused <span class=\"comment\">#所有收件人地址均被拒绝。每个收件人的错误都可以通过属性收件人访问，属性收件人是一个与SMTP.sendmail()返回的排序完全相同的字典。</span></span><br><span class=\"line\"></span><br><span class=\"line\">exception smtplib.SMTPDataError  <span class=\"comment\">#SMTP服务器拒绝接受消息数据。</span></span><br><span class=\"line\"></span><br><span class=\"line\">exception smtplib.SMTPConnectError  <span class=\"comment\">#在与服务器建立连接时发生错误。</span></span><br><span class=\"line\">exception smtplib.SMTPAuthenticationError   <span class=\"comment\">#与服务器建立认证的时候出错</span></span><br><span class=\"line\"></span><br><span class=\"line\">exception smtplib.SMTPHeloError  <span class=\"comment\">#服务器拒绝了我们的HELO消息。</span></span><br><span class=\"line\">exception smtplib.SMTPNotSupportedError  <span class=\"comment\">#服务器不支持尝试的命令或选项。</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#SMTP代表对象</span></span><br><span class=\"line\">SMTP.connect(host=<span class=\"string\">'localhost'</span>, port=0)  <span class=\"comment\">#当初始化未进行设置host以及默认port=25的时候需要进行设置，在LMTP中使用Unix套接字是很常见的，因此我们的connect()方法必须支持这一点</span></span><br><span class=\"line\">SMTP.helo(name=<span class=\"string\">''</span>) <span class=\"comment\">#使用HELO向SMTP服务器标识自己。主机名参数默认为本地主机的完全限定域名。服务器返回的消息存储为对象的helo_resp属性。</span></span><br><span class=\"line\">SMTP.ehlo(name=<span class=\"string\">''</span>) <span class=\"comment\">#使用EHLO向ESMTP服务器标识自己。主机名参数默认为本地主机的完全限定域名。</span></span><br><span class=\"line\">SMTP.login(user, password, *, initial_response_ok=True)  <span class=\"comment\">#登录需要身份验证的SMTP服务器。参数是要进行身份验证的用户名和密码，错误返回异常</span></span><br><span class=\"line\">SMTP.auth(mechanism, authobject, *, initial_response_ok=True) <span class=\"comment\">#有关受支持的身份验证方法的列表，请参见auth()</span></span><br><span class=\"line\">SMTP.starttls(keyfile=None, certfile=None, context=None) <span class=\"comment\">#将SMTP连接置于TLS(传输层安全)模式。接下来的所有smtpcommand都将被加密。然后应该再次调用ehlo() </span></span><br><span class=\"line\">SMTP.sendmail(from_addr, to_addrs, msg, mail_options=(), rcpt_options=())  <span class=\"comment\">#邮件发送 , msg可以是包含ASCII范围内字符的字符串，也可以是字节字符串</span></span><br><span class=\"line\">SMTP.send_message(msg, from_addr=None, to_addrs=None, mail_options=(), rcpt_options=()) <span class=\"comment\">#这是调用sendmail()的一个方便方法，使用email.message表示的消息。 如果from_addr为None或to_addrs为None，将会提取msg中的地址</span></span><br><span class=\"line\">SMTP.set_debuglevel(level)  <span class=\"comment\">#设置调试输出级别 1/true / 2(在版本3.0add)</span></span><br><span class=\"line\">SMTP.quit() <span class=\"comment\">#终止SMTP会话并关闭连接</span></span><br><span class=\"line\">SMTP.close()</span><br></pre></td></tr></table></figure></p>\n<p><em>email包常用模块:</em><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#定制个性化邮件格式方法</span></span><br><span class=\"line\">•email.message  <span class=\"comment\">#邮件构造</span></span><br><span class=\"line\">  - email.message.EmailMessage()  <span class=\"comment\"># 返回对象 msg，构建发信文本并且存入数组</span></span><br><span class=\"line\">•email.parser  <span class=\"comment\">#解析邮件信息</span></span><br><span class=\"line\"></span><br><span class=\"line\">•email.mime <span class=\"comment\">#从头创建电子邮件和MIME对象 (支持HTML)</span></span><br><span class=\"line\">  - email.mime.text.MIMEText(<span class=\"string\">\"\"</span><span class=\"string\">\" HTML \"</span><span class=\"string\">\"\"</span>,_subtype=<span class=\"string\">'plain'</span>, _charset=None, *, policy=compat32)  <span class=\"comment\">#HTML/subtype:文本类型(plain或者html)/字符编码</span></span><br><span class=\"line\">  - email.mime.multipart.MIMEMultipart(_subtype=<span class=\"string\">'mixed'</span>, boundary=None, _subparts=None, *, policy=compat32, **_params) <span class=\"comment\">#生成包含多个部分的邮件体的MIME对象,subtype三种子类型：mixed）(带附件邮件体),related(构建内嵌资源邮件体),alternative(构建纯文本与超文本共存的邮件体);</span></span><br><span class=\"line\">  - email.mime.audio.MIMEAudio(_audiodata, _subtype=None, _encoder=email.encoders.encode_base64, *, policy=compat32, **_params) <span class=\"comment\">#创建包含音频数据的邮件体，audiodata原始二进制音频数据的字节字符串;</span></span><br><span class=\"line\">   email.mime.image.MIMEImage(_imagedata, _subtype=None, _encoder=email.encoders.encode_base64, *, policy=compat32, **_params) <span class=\"comment\">#创建包含图片数据的邮件体，imagedata原始二进制图片数据的字节字符串;</span></span><br></pre></td></tr></table></figure></p>\n<p>模块示例：<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1.SMTP类支持with语句。当这样使用之后退出时，SMTP QUIT命令将自动发出 （可以，判断连接是否正常）</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">with</span> smtplib.SMTP(<span class=\"string\">\"smtp.qq.com\"</span>,<span class=\"number\">25</span>) <span class=\"keyword\">as</span> smtp: </span><br><span class=\"line\">  smtp.noop()  <span class=\"comment\">#25端口 非SSL</span></span><br><span class=\"line\">    smtp.helo(<span class=\"string\">'flag@qq.com'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">(<span class=\"number\">250</span>, <span class=\"string\">b'Ok'</span>)</span><br><span class=\"line\">(<span class=\"number\">250</span>, <span class=\"string\">b'smtp.qq.com'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">with</span> smtplib.SMTP_SSL(<span class=\"string\">\"smtp.qq.com\"</span>,<span class=\"number\">465</span>) <span class=\"keyword\">as</span> smtp:  </span><br><span class=\"line\">  smtp.noop()  <span class=\"comment\">#465端口 SSL</span></span><br><span class=\"line\">    smtp.helo(<span class=\"string\">'flag@qq.com'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">(<span class=\"number\">250</span>, <span class=\"string\">b'Ok'</span>)</span><br><span class=\"line\">(<span class=\"number\">250</span>, <span class=\"string\">b'smtp.qq.com'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#异常抛出与helo标识自己</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">try</span>:</span><br><span class=\"line\">  smtp = smtplib.SMTP(<span class=\"string\">\"smtp.sina.com\"</span>,<span class=\"number\">25</span>)</span><br><span class=\"line\">  smtp.helo(<span class=\"string\">'weiyigeek@sina.com'</span>)</span><br><span class=\"line\">    smtp.ehlo(<span class=\"string\">\"weiyigeek@sina.com\"</span>)</span><br><span class=\"line\">  smtp.quit(<span class=\"string\">'flag'</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">except</span> smtplib.SMTPException <span class=\"keyword\">as</span> connect:</span><br><span class=\"line\">  print(<span class=\"string\">\"+ [ Error ]:\"</span>+connect)</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\">(<span class=\"number\">250</span>, <span class=\"string\">b'smtp-5-123.smtpsmail.fmail.xd.sinanode.com'</span>)</span><br><span class=\"line\">(<span class=\"number\">221</span>, <span class=\"string\">b'smtp-5-123.smtpsmail.fmail.xd.sinanode.com'</span>)</span><br><span class=\"line\">(<span class=\"number\">250</span>, <span class=\"string\">b'smtp.sina.com\\nPIPELINING\\nSIZE 73400320\\nSTARTTLS\\nAUTH LOGIN PLAIN\\nAUTH=LOGIN\\nMAILCOMPRESS\\n8BITMIME'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 登录以及异常抛出</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>smtp = smtplib.SMTP(<span class=\"string\">\"smtp.qq.com\"</span>,<span class=\"number\">25</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">try</span>:</span><br><span class=\"line\">  res = smtp.login(<span class=\"string\">'weiyigeek@qq.com'</span>,<span class=\"string\">'itfbbfqxnbhda'</span>)</span><br><span class=\"line\">  print(res)</span><br><span class=\"line\"><span class=\"keyword\">except</span> smtplib.SMTPException <span class=\"keyword\">as</span> test:</span><br><span class=\"line\">  print(<span class=\"string\">\"Error:\"</span>+str(test))</span><br><span class=\"line\"><span class=\"comment\">#认证成功</span></span><br><span class=\"line\">(<span class=\"number\">235</span>, <span class=\"string\">b'Authentication successful'</span>)  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#异常抛出</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>smtp = smtplib.SMTP(<span class=\"string\">\"smtp.qq.com\"</span>,<span class=\"number\">25</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">try</span>:</span><br><span class=\"line\">  res = smtp.login(<span class=\"string\">'weiyigeek7@qq.com'</span>,<span class=\"string\">'itfbbfqxnbhda'</span>)</span><br><span class=\"line\">  print(res)</span><br><span class=\"line\"><span class=\"keyword\">except</span> smtplib.SMTPException <span class=\"keyword\">as</span> test:</span><br><span class=\"line\">  print(<span class=\"string\">\"Error:\"</span>+str(test))</span><br><span class=\"line\"></span><br><span class=\"line\">Error:(<span class=\"number\">535</span>, <span class=\"string\">b'Error: \\xc7\\xeb\\xca\\xb9\\xd3\\xc3\\xca\\xda\\xc8\\xa8\\xc2\\xeb\\xb5\\xc7\\xc2\\xbc\\xa1\\xa3\\xcf\\xea\\xc7\\xe9\\xc7\\xeb\\xbf\\xb4: http://service.mail.qq.com/cgi-bin/help?subtype=1&amp;&amp;id=28&amp;&amp;no=1001256'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#认证流程 </span></span><br><span class=\"line\"><span class=\"comment\"># SMTP(host,port) -&gt; login</span></span><br><span class=\"line\"><span class=\"comment\"># SMTP() -&gt; connect(host,port) -&gt; ehlo('weiyigeek@qq.com') -&gt; login</span></span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span>smtp = smtplib.SMTP(<span class=\"string\">\"smtp.qq.com\"</span>,<span class=\"number\">25</span>)</span><br><span class=\"line\"><span class=\"meta\">&gt;&gt;&gt; </span><span class=\"keyword\">try</span>:</span><br><span class=\"line\">  res = smtp.login(<span class=\"string\">'22123875262@qq.com'</span>,<span class=\"string\">'iocztfbbfqxnbhda'</span>)</span><br><span class=\"line\">  print(res)</span><br><span class=\"line\">  smtp.close()</span><br><span class=\"line\">  smtp.connect(<span class=\"string\">\"smtp.qq.com\"</span>,<span class=\"number\">25</span>)</span><br><span class=\"line\">  smtp.ehlo(<span class=\"string\">\"221238752621@qq.com\"</span>)</span><br><span class=\"line\">  res = smtp.login(<span class=\"string\">'22123875262@qq.com'</span>,<span class=\"string\">'iocztfbbfqxnbhda'</span>)</span><br><span class=\"line\">  print(res)</span><br><span class=\"line\"><span class=\"keyword\">except</span> smtplib.SMTPException <span class=\"keyword\">as</span> test:</span><br><span class=\"line\">  print(<span class=\"string\">\"Error:\"</span>+str(test))</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\">(<span class=\"number\">235</span>, <span class=\"string\">b'Authentication successful'</span>)</span><br><span class=\"line\">(<span class=\"number\">220</span>, <span class=\"string\">b'smtp.qq.com Esmtp QQ Mail Server'</span>)</span><br><span class=\"line\">(<span class=\"number\">250</span>, <span class=\"string\">b'smtp.qq.com\\nPIPELINING\\nSIZE 73400320\\nSTARTTLS\\nAUTH LOGIN PLAIN\\nAUTH=LOGIN\\nMAILCOMPRESS\\n8BITMIME'</span>)</span><br><span class=\"line\">(<span class=\"number\">235</span>, <span class=\"string\">b'Authentication successful'</span>)</span><br></pre></td></tr></table></figure><br><br><br>邮件发送示例<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> smtplib</span><br><span class=\"line\"><span class=\"keyword\">from</span> email.message <span class=\"keyword\">import</span> EmailMessage</span><br><span class=\"line\">msg = EmailMessage()</span><br><span class=\"line\">msg[<span class=\"string\">'Subject'</span>] = <span class=\"string\">'Login Smtp Succeeful'</span></span><br><span class=\"line\">msg[<span class=\"string\">'From'</span>] = <span class=\"string\">'WeiyiGEEK'</span></span><br><span class=\"line\">msg[<span class=\"string\">'To'</span>] = <span class=\"string\">'1564362804@qq.com'</span></span><br><span class=\"line\">msg.set_content(<span class=\"string\">\"测试连接服务器(1)\"</span>)</span><br><span class=\"line\">smtp = smtplib.SMTP(<span class=\"string\">\"smtp.qq.com\"</span>,<span class=\"number\">25</span>)</span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">  res = smtp.login(<span class=\"string\">'WeiyiGEEK'</span>,<span class=\"string\">'iocztfbbfqxnbhda'</span>) </span><br><span class=\"line\">  smtp.send_message(msg)</span><br><span class=\"line\">  print(res)</span><br><span class=\"line\">  smtp.close()</span><br><span class=\"line\"><span class=\"keyword\">except</span> smtplib.SMTPException <span class=\"keyword\">as</span> test:</span><br><span class=\"line\">  print(<span class=\"string\">\"Error:\"</span>+str(test))</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190727182805.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure> </p>\n<p><br></p>\n<p>实际案例(1) 文本HTML信息发信：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @File : stmpDemo.py</span></span><br><span class=\"line\"><span class=\"comment\"># @CreateTime : 2019/7/26 16:17</span></span><br><span class=\"line\"><span class=\"comment\"># @Author : WeiyiGeek</span></span><br><span class=\"line\"><span class=\"comment\"># @Function : 实现邮件的发送</span></span><br><span class=\"line\"><span class=\"comment\"># @Software: PyCharm</span></span><br><span class=\"line\"></span><br><span class=\"line\">import smtplib</span><br><span class=\"line\">import socket</span><br><span class=\"line\">from email.mime.text import MIMEText</span><br><span class=\"line\"></span><br><span class=\"line\">SMTPHOST = <span class=\"string\">\"smtp.qq.com\"</span></span><br><span class=\"line\">SMTPUSER = <span class=\"string\">\"\"</span></span><br><span class=\"line\">SMTPPASS = <span class=\"string\">\"jxgovvrd\"</span></span><br><span class=\"line\">FROM = <span class=\"string\">\"\"</span></span><br><span class=\"line\">TO = <span class=\"string\">\"\"</span></span><br><span class=\"line\">Subject = <span class=\"string\">\"测试smtplib发信模块\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">def info():</span><br><span class=\"line\">    <span class=\"comment\"># 获取计算机名称</span></span><br><span class=\"line\">    hostname = socket.gethostname()</span><br><span class=\"line\">    <span class=\"comment\"># 获取本机IP</span></span><br><span class=\"line\">    ip = socket.gethostbyname(hostname)</span><br><span class=\"line\">    <span class=\"built_in\">return</span> hostname + ip</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">def sendmail(From,To,boby):</span><br><span class=\"line\">    try:</span><br><span class=\"line\">        <span class=\"comment\"># server = smtplib.SMTP() #创建一个SMTP对象</span></span><br><span class=\"line\">        <span class=\"comment\"># server = smtplib.connect(SMTPHOST,\"25\") #非SSL方式连接smtp主机</span></span><br><span class=\"line\">        server = smtplib.SMTP_SSL(SMTPHOST)     <span class=\"comment\"># 通过SSL方法连接smtp主机默认使用465端口</span></span><br><span class=\"line\">        <span class=\"comment\"># server.starttls()  #启用安全传输模式</span></span><br><span class=\"line\">        server.login(SMTPUSER, SMTPPASS)  <span class=\"comment\"># 账号邮箱认证</span></span><br><span class=\"line\">        server.sendmail(From, To, boby)</span><br><span class=\"line\">        server.quit()</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">\"发信成功! dindong\"</span>)</span><br><span class=\"line\">    except Exception as e:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">\"[发信失败]!:\"</span> + str(e))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">def main():</span><br><span class=\"line\">    Content = info()+<span class=\"string\">\"\\r\\n 我是一名电脑技术爱好者，我正在学习Python运维 \"</span></span><br><span class=\"line\">    msg = MIMEText(<span class=\"string\">\"\"</span><span class=\"string\">\"</span></span><br><span class=\"line\"><span class=\"string\">    #创建一个MIMEtext对象，分别插入HTML内容/类型/文本/字符编码，</span></span><br><span class=\"line\"><span class=\"string\">    &lt;table width=\"</span>400<span class=\"string\">\" border=\"</span>1px solid red<span class=\"string\">\"&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;th&gt;序号1&lt;/th&gt;&lt;th&gt;序号2&lt;/th&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;tr&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;td&gt;主机名称&lt;/td&gt;&lt;td&gt;IP地址&lt;/td&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;tr&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/table&gt;</span></span><br><span class=\"line\"><span class=\"string\">    \"</span><span class=\"string\">\"\"</span>+Content, <span class=\"string\">\"HTML\"</span> ,<span class=\"string\">\"UTF-8\"</span>) <span class=\"comment\">#组装sendmail主体内容</span></span><br><span class=\"line\"></span><br><span class=\"line\">    msg[<span class=\"string\">'Subject'</span>] = Subject  <span class=\"comment\">#必须放在MIMEText后</span></span><br><span class=\"line\">    msg[<span class=\"string\">'From'</span>] = FROM</span><br><span class=\"line\">    msg[<span class=\"string\">'To'</span>] = TO</span><br><span class=\"line\">    sendmail(FROM, TO, msg.as_string())</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20190726173307.png\" alt=\"WeiyiGeek.发信测试\" title=\"\" class=\"\">\n                <p>WeiyiGeek.发信测试</p>\n            </figure>\n<p><br></p>\n<p>实际案例(2) 图片格式与附件文档发信：<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @File : stmplibsimple3.py</span></span><br><span class=\"line\"><span class=\"comment\"># @CreateTime : 2019/7/30 16:07</span></span><br><span class=\"line\"><span class=\"comment\"># @Author : WeiyiGeek</span></span><br><span class=\"line\"><span class=\"comment\"># @Function : 截屏图片发送与附件格式邮件发信</span></span><br><span class=\"line\"><span class=\"comment\"># @Software: PyCharm</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> smtplib,os</span><br><span class=\"line\"><span class=\"keyword\">from</span> email.mime.multipart <span class=\"keyword\">import</span> MIMEMultipart</span><br><span class=\"line\"><span class=\"keyword\">from</span> email.mime.text <span class=\"keyword\">import</span> MIMEText</span><br><span class=\"line\"><span class=\"keyword\">from</span> email.mime.image <span class=\"keyword\">import</span> MIMEImage</span><br><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> ImageGrab</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">SMTPHOST = <span class=\"string\">\"smtp.qq.com\"</span></span><br><span class=\"line\">SMTPUSER = <span class=\"string\">\"123123123213@qq.com\"</span></span><br><span class=\"line\">SMTPPASS = <span class=\"string\">\"iocztfbbfqxnbhda\"</span></span><br><span class=\"line\">SUBJECT = <span class=\"string\">u\"截屏图片发送与附件格式邮件发信测试\"</span></span><br><span class=\"line\">FROM = SMTPUSER</span><br><span class=\"line\">TO = <span class=\"string\">\"1564362804@qq.com\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">captrue</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    img = ImageGrab.grab(bbox=(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">1141</span>, <span class=\"number\">610</span>))</span><br><span class=\"line\">    img.save(<span class=\"string\">'captrue.jpg'</span>,<span class=\"string\">'JPEG'</span>)</span><br><span class=\"line\">    os.system(<span class=\"string\">\"ipconfig &gt; ip.txt\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">addimg</span><span class=\"params\">(src, imgid)</span>:</span></span><br><span class=\"line\">    <span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">    添加图片与iD到mimeiMAGE对象中</span></span><br><span class=\"line\"><span class=\"string\">    :param src: 图片路径 </span></span><br><span class=\"line\"><span class=\"string\">    :param imgid: 图片id</span></span><br><span class=\"line\"><span class=\"string\">    :return: 回imgImage对象</span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> open(src, <span class=\"string\">'rb'</span>) <span class=\"keyword\">as</span> img:</span><br><span class=\"line\">        msgimage = MIMEImage(img.read())  <span class=\"comment\">#创建MIMEImage对象以读取图片内容作为参数</span></span><br><span class=\"line\">        msgimage.add_header(<span class=\"string\">'Content-ID'</span>, imgid) <span class=\"comment\">#指定图片文件的Content-ID,img标签中使用</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> msgimage  <span class=\"comment\">#返回MIMEImage对象</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">addacc</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    <span class=\"comment\">#创建一个MIMEText对象附加文档到邮件之中</span></span><br><span class=\"line\">    attach = MIMEText(open(<span class=\"string\">'./ip.txt'</span>,<span class=\"string\">'r'</span>).read(),<span class=\"string\">\"plain\"</span>,<span class=\"string\">\"utf-8\"</span>)</span><br><span class=\"line\">    attach[<span class=\"string\">\"Context-type\"</span>] = <span class=\"string\">\"text/plain\"</span>  <span class=\"comment\">#指定文件类型</span></span><br><span class=\"line\">    attach[<span class=\"string\">\"Content-Disposition\"</span>] = <span class=\"string\">\"attachment; filename='ip.txt'\"</span>  <span class=\"comment\">#设置下载对话框</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> attach</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">sendmain</span><span class=\"params\">(msg)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        server = smtplib.SMTP_SSL(SMTPHOST)</span><br><span class=\"line\">        server.login(SMTPUSER, SMTPPASS)</span><br><span class=\"line\">        server.sendmail(FROM, TO, msg.as_string())</span><br><span class=\"line\">        server.quit()</span><br><span class=\"line\">        print(<span class=\"string\">\"邮件发送：成功\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> err:</span><br><span class=\"line\">        print(<span class=\"string\">\"发送失败：\"</span> + str(err))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">emailContent</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    message = MIMEMultipart(<span class=\"string\">'related'</span>)  <span class=\"comment\">#创建MIMEutilpart对象并且采用related定义内嵌资源的邮件体</span></span><br><span class=\"line\">    msgtext = MIMEText(<span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">        &lt;font color=red&gt; 官网业务附件 &lt;/font&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;table border=\"0\" cellspacing=\"0\" cellpadding=\"2\"&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;tr bgcolor=\"#CECFAD\" height=\"20\" style=\"front-size:14px\"&gt;</span></span><br><span class=\"line\"><span class=\"string\">                &lt;td colspan=\"2\"&gt; 系统截屏图片邮件发送 &lt;/td&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;/tr&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;tr&gt;</span></span><br><span class=\"line\"><span class=\"string\">                &lt;td&gt;</span></span><br><span class=\"line\"><span class=\"string\">                    &lt;a href=\"www.weiyigeek.github.io\"&gt;&lt;img src=\"cid:captrue\" alt=\"Python屏幕截图\"&gt;&lt;/a&gt;</span></span><br><span class=\"line\"><span class=\"string\">                &lt;/td&gt;</span></span><br><span class=\"line\"><span class=\"string\">            &lt;/tr&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;/table&gt;</span></span><br><span class=\"line\"><span class=\"string\">        </span></span><br><span class=\"line\"><span class=\"string\">    \"\"\"</span>,<span class=\"string\">'html'</span>,<span class=\"string\">'utf-8'</span>)  <span class=\"comment\">#img标签的图片是通过Content-ID来引用的</span></span><br><span class=\"line\">    message.attach(msgtext)</span><br><span class=\"line\">    message.attach(addimg(<span class=\"string\">\"./captrue.jpg\"</span>, <span class=\"string\">\"captrue\"</span>))</span><br><span class=\"line\">    message.attach(addacc())</span><br><span class=\"line\">    message[<span class=\"string\">'Subject'</span>] = SUBJECT</span><br><span class=\"line\">    message[<span class=\"string\">'From'</span>] = FROM</span><br><span class=\"line\">    message[<span class=\"string\">'To'</span>] = TO</span><br><span class=\"line\">    sendmain(message)  <span class=\"comment\">#邮件发送</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    captrue()  <span class=\"comment\">#截屏</span></span><br><span class=\"line\">    emailContent() <span class=\"comment\">#邮件构造</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20190730175422.png\" alt=\"WeiyiGeek.邮件发送图片和文档\" title=\"\" class=\"\">\n                <p>WeiyiGeek.邮件发送图片和文档</p>\n            </figure></p>\n<p><em>补充参考：</em></p>\n<ul>\n<li>Content-type对照表 : <a href=\"http://tool.oschina.net/commons\" target=\"_blank\" rel=\"noopener\">http://tool.oschina.net/commons</a></li>\n<li><a href=\"https://www.cnblogs.com/grefr/p/6089079.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/grefr/p/6089079.html</a></li>\n<li>邮件服务相关模块：</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># See also:</span></span><br><span class=\"line\">Module smtplib : SMTP (Simple Mail Transport Protocol) client</span><br><span class=\"line\">Module poplib : POP (Post Office Protocol) client</span><br><span class=\"line\">Module imaplib : IMAP (Internet Message Access Protocol) client</span><br><span class=\"line\">Module nntplib : NNTP (Net News Transport Protocol) client</span><br><span class=\"line\">Module mailboxTools : 用于使用各种标准格式在磁盘上创建、读取和管理消息集合的工具。</span><br><span class=\"line\">Module smtpd  : SMTP server framework (primarily useful <span class=\"keyword\">for</span> testing)</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> 测试环境</span><br><span class=\"line\"></span><br><span class=\"line\">在client.jaylin.com上发送邮件：</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># telnet mail.jaylin.com 25</span></span><br><span class=\"line\"></span><br><span class=\"line\">Trying 192.168.1.9...</span><br><span class=\"line\"></span><br><span class=\"line\">Connected to mail.jaylin.com (192.168.1.9).</span><br><span class=\"line\"></span><br><span class=\"line\">Escape character is <span class=\"string\">'^]'</span>.</span><br><span class=\"line\"></span><br><span class=\"line\">220 mail.jaylin.com ESMTP Sendmail 8.13.8/8.13.8; Wed, 21 Oct 2009 05:12:41 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">EHLO mail.jaylin.com</span><br><span class=\"line\"></span><br><span class=\"line\">250-mail.jaylin.com Hello [192.168.1.7], pleased to meet you</span><br><span class=\"line\"></span><br><span class=\"line\">250-ENHANCEDSTATUSCODES</span><br><span class=\"line\"></span><br><span class=\"line\">250-PIPELINING</span><br><span class=\"line\"></span><br><span class=\"line\">250-8BITMIME</span><br><span class=\"line\"></span><br><span class=\"line\">250-SIZE</span><br><span class=\"line\"></span><br><span class=\"line\">250-DSN</span><br><span class=\"line\"></span><br><span class=\"line\">250-ETRN</span><br><span class=\"line\"></span><br><span class=\"line\">250-DELIVERBY</span><br><span class=\"line\"></span><br><span class=\"line\">250 HELP</span><br><span class=\"line\"></span><br><span class=\"line\">MAIL FROM:jaylin@jaylin.com</span><br><span class=\"line\"></span><br><span class=\"line\">250 2.1.0 jaylin@jaylin.com... Sender ok</span><br><span class=\"line\"></span><br><span class=\"line\">RCPT TO:xin@xin.com</span><br><span class=\"line\"></span><br><span class=\"line\">250 2.1.5 xin@xin.com... Recipient ok</span><br><span class=\"line\"></span><br><span class=\"line\">DATA</span><br><span class=\"line\"></span><br><span class=\"line\">354 Enter mail, end with <span class=\"string\">\".\"</span> on a line by itself</span><br><span class=\"line\"></span><br><span class=\"line\">SUBJECT xinxin</span><br><span class=\"line\"></span><br><span class=\"line\">lala~</span><br><span class=\"line\"></span><br><span class=\"line\">.</span><br><span class=\"line\"></span><br><span class=\"line\">250 2.0.0 n9KLCfJo004052 Message accepted <span class=\"keyword\">for</span> delivery</span><br><span class=\"line\"></span><br><span class=\"line\">quit</span><br><span class=\"line\"></span><br><span class=\"line\">221 2.0.0 mail.jaylin.com closing connection</span><br><span class=\"line\"></span><br><span class=\"line\">Connection closed by foreign host.</span><br><span class=\"line\"></span><br><span class=\"line\">在client.xin.com上接收邮件：<span class=\"comment\"># telnet mail.xin.com 110</span></span><br><span class=\"line\"></span><br><span class=\"line\">Trying 192.168.2.11...</span><br><span class=\"line\"></span><br><span class=\"line\">Connected to mail.xin.com (192.168.2.11).</span><br><span class=\"line\"></span><br><span class=\"line\">Escape character is <span class=\"string\">'^]'</span>.</span><br><span class=\"line\"></span><br><span class=\"line\">+OK Dovecot ready.</span><br><span class=\"line\"></span><br><span class=\"line\">User xin</span><br><span class=\"line\"></span><br><span class=\"line\">+OK</span><br><span class=\"line\"></span><br><span class=\"line\">Pass ******</span><br><span class=\"line\"></span><br><span class=\"line\">+OK Logged <span class=\"keyword\">in</span>.</span><br><span class=\"line\"></span><br><span class=\"line\">List</span><br><span class=\"line\"></span><br><span class=\"line\">+OK 12 messages:</span><br><span class=\"line\"></span><br><span class=\"line\">1 621</span><br><span class=\"line\"></span><br><span class=\"line\">2 624</span><br><span class=\"line\"></span><br><span class=\"line\">3 619</span><br><span class=\"line\"></span><br><span class=\"line\">4 619</span><br><span class=\"line\"></span><br><span class=\"line\">5 620</span><br><span class=\"line\"></span><br><span class=\"line\">6 841</span><br><span class=\"line\"></span><br><span class=\"line\">7 839</span><br><span class=\"line\"></span><br><span class=\"line\">8 757</span><br><span class=\"line\"></span><br><span class=\"line\">9 738</span><br><span class=\"line\"></span><br><span class=\"line\">10 737</span><br><span class=\"line\"></span><br><span class=\"line\">11 742</span><br><span class=\"line\"></span><br><span class=\"line\">12 740</span><br><span class=\"line\"></span><br><span class=\"line\">.</span><br><span class=\"line\"></span><br><span class=\"line\">retr 12</span><br><span class=\"line\"></span><br><span class=\"line\">+OK 740 octets</span><br><span class=\"line\"></span><br><span class=\"line\">Return-Path: &lt;jaylin@jaylin.com&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">Received: from smarthost.jaylin.com (smarthost.jaylin.co [192.168.1.6] (may be forged))</span><br><span class=\"line\"></span><br><span class=\"line\">        by mail.xin.com (8.13.8/8.13.8) with ESMTP id n9KLDC2H004460</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> &lt;xin@xin.com&gt;; Wed, 21 Oct 2009 05:13:12 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">Received: from mail.jaylin.com (mail.jaylin.com [192.168.1.9])</span><br><span class=\"line\"></span><br><span class=\"line\">        by smarthost.jaylin.com (8.13.8/8.13.8) with ESMTP id n9KLD7VC006062</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> &lt;xin@xin.com&gt;; Wed, 21 Oct 2009 05:13:07 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">Received: from mail.jaylin.com ([192.168.1.7])</span><br><span class=\"line\"></span><br><span class=\"line\">        by mail.jaylin.com (8.13.8/8.13.8) with ESMTP id n9KLCfJo004052</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> xin@xin.com; Wed, 21 Oct 2009 05:12:54 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">Date: Wed, 21 Oct 2009 05:12:41 +0800</span><br><span class=\"line\"></span><br><span class=\"line\">From: jaylin@jaylin.com</span><br><span class=\"line\"></span><br><span class=\"line\">Message-Id: &lt;200910202112.n9KLCfJo004052@mail.jaylin.com&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">SUBJECT xinxin</span><br><span class=\"line\"></span><br><span class=\"line\">lala~</span><br><span class=\"line\"></span><br><span class=\"line\">.</span><br><span class=\"line\"></span><br><span class=\"line\">quit</span><br><span class=\"line\"></span><br><span class=\"line\">+OK Logging out.</span><br><span class=\"line\"></span><br><span class=\"line\">Connection closed by foreign host.</span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">为了验证Smarthost生效了，我们查看一下三台Sendmail服务器的/var/<span class=\"built_in\">log</span>/maillog日志文件。</span><br><span class=\"line\"></span><br><span class=\"line\">发送方mail.jaylin.com：</span><br><span class=\"line\"></span><br><span class=\"line\">Oct 21 05:13:02 mail sendmail[4052]: n9KLCfJo004052: from=jaylin@jaylin.com, size=21, class=0, nrcpts=1, msgid=&lt;200910202112.n9KLCfJo004052@mail.jaylin.com&gt;, proto=ESMTP, daemon=MTA, relay=[192.168.1.7]</span><br><span class=\"line\"></span><br><span class=\"line\">Oct 21 05:13:02 mail sendmail[4054]: n9KLCfJo004052: to=xin@xin.com, ctladdr=jaylin@jaylin.com (501/501), delay=00:00:08, xdelay=00:00:00, mailer=relay, pri=120021, relay=smarthost.jaylin.com [192.168.1.6], dsn=2.0.0, <span class=\"built_in\">stat</span>=Sent (n9KLD7VC006062 Message accepted <span class=\"keyword\">for</span> delivery)</span><br><span class=\"line\"></span><br><span class=\"line\">作为Smarthost的smarthost.jaylin.com：</span><br><span class=\"line\"></span><br><span class=\"line\">Oct 21 05:13:07 client1 sendmail[6062]: n9KLD7VC006062: from=&lt;jaylin@jaylin.com&gt;, size=304, class=0, nrcpts=1, msgid=&lt;200910202112.n9KLCfJo004052@mail.jaylin.com&gt;, proto=ESMTP, daemon=MTA, relay=mail.jaylin.com [192.168.1.9]</span><br><span class=\"line\"></span><br><span class=\"line\">Oct 21 05:13:07 client1 sendmail[6064]: n9KLD7VC006062: to=&lt;xin@xin.com&gt;, delay=00:00:00, xdelay=00:00:00, mailer=esmtp, pri=120304, relay=mail.xin.com. [192.168.2.11], dsn=2.0.0, <span class=\"built_in\">stat</span>=Sent (n9KLDC2H004460 Message accepted <span class=\"keyword\">for</span> delivery)</span><br><span class=\"line\"></span><br><span class=\"line\">接收方mail.xin.com：</span><br><span class=\"line\"></span><br><span class=\"line\">Oct 21 05:13:12 mail sendmail[4460]: n9KLDC2H004460: from=&lt;jaylin@jaylin.com&gt;, size=489, class=0, nrcpts=1, msgid=&lt;200910202112.n9KLCfJo004052@mail.jaylin.com&gt;, proto=ESMTP, daemon=MTA, relay=smarthost.jaylin.co [192.168.1.6] (may be forged)</span><br><span class=\"line\"></span><br><span class=\"line\">Oct 21 05:13:12 mail sendmail[4461]: n9KLDC2H004460: to=&lt;xin@xin.com&gt;, delay=00:00:00, xdelay=00:00:00, mailer=<span class=\"built_in\">local</span>, pri=30702, dsn=2.0.0, <span class=\"built_in\">stat</span>=Sent</span><br><span class=\"line\"></span><br><span class=\"line\">Oct 21 05:13:35 mail dovecot: pop3-login: Login: user=&lt;xin&gt;, method=PLAIN, rip=::ffff:192.168.2.8, lip=::ffff:192.168.2.11</span><br><span class=\"line\"></span><br><span class=\"line\">Oct 21 05:13:41 mail dovecot: POP3(xin): Disconnected: Logged out top=0/0, retr=1/756, del=0/12, size=8497</span><br></pre></td></tr></table></figure>","comments":true,"excerpt":"[TOC]","categories":[{"name":"自动化运维","path":"api/categories/自动化运维.json"},{"name":"运维基础","path":"api/categories/运维基础.json"}],"tags":[{"name":"Python","path":"api/tags/Python.json"}]}