{"title":"等保测评之Oracle关系型数据库安全加固实践指南","slug":"数据存储/Oracle/运维管理/等保测评之Oracle关系型数据库安全加固实践指南","date":"2020-01-13T13:34:33.000Z","updated":"2022-04-13T02:08:38.104Z","url":"2020/1-13-641.html","path":"api/articles/2020/1-13-641.html.json","covers":null,"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"账号权限加固\"><a href=\"#账号权限加固\" class=\"headerlink\" title=\"账号权限加固\"></a>账号权限加固</h2><ul>\n<li><p>1.核查Oracle数据库中是否存在多余账户被启用,如果存在请锁定它。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- (1) 查看系统中已启用账户</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> username,account_status <span class=\"keyword\">FROM</span> dba_users <span class=\"keyword\">WHERE</span> account_status=<span class=\"string\">'OPEN'</span>;</span><br><span class=\"line\">  <span class=\"comment\">-- USERNAME\tACCOUNT_STATUS</span></span><br><span class=\"line\">  <span class=\"comment\">-- SYS\tOPEN</span></span><br><span class=\"line\">  <span class=\"comment\">-- SYSTEM\tOPEN</span></span><br><span class=\"line\">  <span class=\"comment\">-- APP OPEN</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- (2) 锁定禁用不使用(不需要)的账户</span></span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">USER</span> OUTLN <span class=\"keyword\">account</span> <span class=\"keyword\">LOCK</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- (3) 删除多余自建账号</span></span><br><span class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">USER</span> app <span class=\"keyword\">CASCADE</span>;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>2.为所有应用用户配置强口令,根据设置的口令策略修改弱口令。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 特别注意修改 sys 和 system 口令(等保要求:)</span></span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">USER</span> <span class=\"keyword\">sys</span> <span class=\"keyword\">IDENTIFIED</span> <span class=\"keyword\">BY</span> &lt;newpasswd&gt;;</span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">USER</span> <span class=\"keyword\">system</span> <span class=\"keyword\">IDENTIFIED</span> <span class=\"keyword\">BY</span> &lt;newpasswd&gt;;</span><br><span class=\"line\"><span class=\"comment\">-- 应用用户口令修改</span></span><br><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">USER</span> &lt;username&gt; <span class=\"keyword\">IDENTIFIED</span> <span class=\"keyword\">BY</span> &lt;newpasswd&gt;;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>3.查看指定用户权限</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SQL&gt;SELECT * FROM dba_sys_privs WHERE grantee=&lt;username&gt;; -- 系统权限</span><br><span class=\"line\">SQL&gt;SELECT * FROM dba_tab_privs WHERE grantee=&lt;username&gt;; -- 对象权限</span><br><span class=\"line\">SQL&gt;SELECT * FROM dba_role_privs WHERE grantee=&lt;username&gt;; --赋予的角色</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h1 id=\"版本查看\"><a href=\"#版本查看\" class=\"headerlink\" title=\"版本查看\"></a>版本查看</h1><p>SQL&gt; select * from v$version </p>\n<h1 id=\"占用空间大小\"><a href=\"#占用空间大小\" class=\"headerlink\" title=\"占用空间大小\"></a>占用空间大小</h1><p>select ‘bgdrac’ database,t11.username,t11.default_tablespace tablespace_name,segment_size_in_GB,datafile_size_in_gb,tablespace_free_size_in_gb from (select username,default_tablespace from dba_users) t11<br>left join<br>(<br>select nvl(t1.tablespace_name,t2.tablespace_name) tablespace_name,t1.size_in_GB datafile_size_in_GB,t2.size_in_GB segment_size_in_GB,t1.size_in_GB-t2.size_in_GB tablespace_free_size_in_GB from<br>(select tablespace_name,sum(bytes)/1024/1024/1024 size_in_GB from dba_data_files group by tablespace_name) t1<br>full join<br>(select tablespace_name,sum(bytes)/1024/1024/1024 size_in_GB from dba_segments group by tablespace_name) t2 on t2.tablespace_name=t1.tablespace_name) t22 on t22.tablespace_name=t11.default_tablespace<br>where t11.default_tablespace&lt;&gt;’zlbfxt’;</p>\n<p>DATABA USERNAME                       TABLESPACE_NAME                SEGMENT_SIZE_IN_GB DATAFILE_SIZE_IN_GB TABLESPACE_FREE_SIZE_IN_GB</p>\n<hr>\n<p>bgdrac ZLBFXT                         ZLBFXT                                  .00177002              .03125                  .02947998<br>bgdrac SYSTEM                         SYSTEM                                 .180679321           .48828125                 .307601929<br>bgdrac SYS                            SYSTEM                                 .180679321           .48828125                 .307601929<br>bgdrac OUTLN                          SYSTEM                                 .180679321           .48828125                 .307601929<br>bgdrac WMSYS                          SYSAUX                                 .109130859            .1171875                 .008056641<br>bgdrac DBSNMP                         SYSAUX                                 .109130859            .1171875                 .008056641<br>bgdrac APPQOSSYS                      SYSAUX                                 .109130859            .1171875                 .008056641<br>bgdrac ORACLE_OCM                     SYSTEM                                 .180679321           .48828125                 .307601929<br>bgdrac DIP                            SYSTEM                                 .180679321           .48828125                 .307601929</p>\n<p>select <em> from dba_profiles;<br>select </em> from v$parameter where name=’audit_trail’;</p>\n<p>2.收回相应权限(例如收回 select any table 权限)<br>SQL&gt;REVOKE select any table FROM <username>;</p>\n<p>3.收回应用用户的 DBA 角色<br>SQL&gt;REVOKE dba FROM <username>;</p>\n<p>注意：避免分配权限过大或过小</p>\n<p>2、撤消 public 角色的程序包执行权限</p>\n<p>1.查看 public 角色的程序包执行权限<br>SQL&gt;SELECT table_name FROM dba_tab_privs WHERE grantee=’PUBLIC’ and<br>privilege=’EXECUTE’;</p>\n<p>2.撤销 public 角色的程序包执行权限（例如撤销在 utl_file 包上的执行权限）<br>SQL&gt;REVOKE execute ON utl_file FROM public;<br>Oracle 官方建议撤销 public 角色对 utl_file、 utl_http、 utl_tcp、 utl_smtp、dbms_random 程序包的执行权限。</p>\n<p>数据访问控制加固</p>\n<p>1、严格限制库文件的访问权限</p>\n<p>确保除属主和 root 外，其他用户对库文件没有写权限</p>\n<p>1.用操作系统命令查看库文件访问权限（以 RedHat linux 为例）<br>ls -l $ORACLE_BASE/oradata</p>\n<p>2.用操作系统命令删除库文件组和其他用户的写权限<br>chmod 640 $ORACLE_BASE/oradata/*</p>\n<p>3.windows 系统同理（方法不同）</p>\n<p>2、配置$ORACLE_HOME/bin</p>\n<p>设置$ORACLE_HOME/bin 其下所有程序的访问权限或其他安全控制机制</p>\n<p>1.用操作系统命令查看 bin 目录下所有程序文件的访问权限（以 RedHat Linux 为例）<br>ls -l $ORACLE_HOME/bin</p>\n<p>2.用操作系统命令删除组和其他用户的写权限<br>chmod 640 $ORACLE_HOME/bin/*</p>\n<p>注意：修改权限可能对部分应用系统造成影响，需要联系业务部门和应用系统厂商做好相关的测试工作</p>\n<p>3、停止或禁用与承载业务无关的服务或组件</p>\n<p>在不影响业务系统正常运行情况下，停止或禁用与承载业务无关的服务或组件</p>\n<p>1.用操作系统命令查看有无与业务无关的服务或组件<br>2.用操作系统命令停止或禁用与业务无关的服务或组件</p>\n<p>4、清除数据库无用的东西</p>\n<p>1.查看数据库中表或视图等对象<br>SQL&gt;SELECT <em> FROM dba_tables;<br>SQL&gt;SELECT </em> FROM dba_views;</p>\n<p>2.删除数据库中存在的无用的、测试的、废弃的表或视图<br>SQL&gt;DROP TABLE <tablename>;<br>SQL&gt;DROP VIEW <viewname>;</p>\n<p>注意：需要和业务部门确认<br>网络访问控制加固</p>\n<p>1、IP限制</p>\n<p>设置 TNS 登录的 IP 限制，仅允许最少的必要的 IP 地址可连接 TNS 监听器</p>\n<p>1.在目录$ORACLE_HOME/network/admin 下修改 sqlnet.ora 文件实现 TNS 登录 IP 限制,</p>\n<p>设置下列配置信息：<br>tcp.validnode_checking=yes</p>\n<p>#允许访问的 ip<br>tcp.invited_nodes =(ip1,ip2,……)</p>\n<p>#不允许访问的 ip<br>tcp.excluded_nodes=(ip1,ip2,……)<br>2.修改 sqlnet.ora 后，重新启动 listener 服务可能对部分应用系统</p>\n<p>2、关闭远程操作系统认证</p>\n<p>1.在目录$ORACLE_HOME/network/admin 下修改 sqlnet.ora 文件,设置下列配置信息:<br>sqlnet.authentication_services=(NONE)</p>\n<p>2.修改参数 Remote_login_passwordfile 为 EXCLUSIVE 或 SHARED<br>SQL&gt;ALTER SYSTEM SET REMOTE_LOGIN_PASSWORDFILE=EXCLUSIVE SCOPE=SPFILE;</p>\n<p>3.修改参数 REMOTE_OS_AUTHENT<br>SQL&gt;ALTER SYSTEM SET REMOTE_OS_AUTHENT=FALSE SCOPE=SPFILE;</p>\n<p>4.重启数据库和监听使修改生效</p>\n<p>注意：需要重启服务，应提前通知业务部门</p>\n<p>3、修改默认端口</p>\n<p>在不影响应用的前提下，更改默认的1521端口</p>\n<ol>\n<li>查看当前监听的状态<br>lsnrctl status</li>\n<li>停止监听<br>lsnrctl stop</li>\n</ol>\n<ol start=\"3\">\n<li>修改监听文件的端口号，在目录$ORACLE_HOME/network/admin 下修改 listener.ora 文件<br>（例如把端口号改为11251）<br>LISTENER =<br>(DESCRIPTION_LIST =<br>(DESCRIPTION =<br>(ADDRESS = (PROTOCOL = TCP)(HOST=LOCALHOST)(PORT=11251))<br>)<br>)</li>\n<li>修改初始化参数 local_listener<br>SQL&gt;ALTER SYSTEM SET local_listener=”(address=(protocol=tcp)(host=localhost)(port=11251))”;</li>\n</ol>\n<p>SQL&gt;quit</p>\n<ol start=\"5\">\n<li>重启监听器<br>lsnrctl start</li>\n</ol>\n<ol start=\"6\">\n<li>修改完毕，使用新端口登录测试<br>netstat -tunap | grep 11251<br>lsnrctl status<br>客户端连接测试</li>\n</ol>\n<p>4、限制远程管理</p>\n<p>限制对监听器的远程管理，并 设 置监 听器 管理 口令（8i）</p>\n<p>1.进入监听设置状态<br>lsnrctl</p>\n<p>2.设置当前监听器<br>set current_listener <listenername></p>\n<p>3.设置密码</p>\n<p>change_password<br>set password</p>\n<p>4.保存设置<br>save_config</p>\n<p>5.检查 listener.ora 文件</p>\n<p>看是否有一条 PASSWORDS_<listenername>的记录</p>\n<p>5、外部程序调用监听配置的删除</p>\n<p>1.打开 listener.ora 文件，删除以下配置文件:<br>(ADDRESS_LIST =<br>(ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC0))<br>)<br>(SID_DESC =<br>(SID_NAME = PLSExtProc)<br>(ORACLE_HOME = C:oracleora81)<br>(PROGRAM = extproc)<br>)</p>\n<ol start=\"2\">\n<li>重启监听</li>\n</ol>\n<ol start=\"3\">\n<li>查看监听状态</li>\n</ol>\n<p>注意：</p>\n<p>默认安装时，会安装一个 PL/SQL 外部程序（ExtProc）条目在 listener.ora中，是 oracle 为调<br>用外部程序默认配置的监听，它的名字通常是 ExtProc 或PLSExtProc，但一般不会使用它，可以直接从 listener.ora中将这项移除，因为对 ExtProc 已经有多种攻击手段了，在不使用外部程序时，oracle 也是建议删除的。</p>\n<p>口令策略加固</p>\n<p>1、 设置口令复杂度要求</p>\n<p>1.检查 profile 文件设置<br>SQL&gt;SELECT * FROM dba_profiles;</p>\n<p>2.创建口令复杂度函数<br>SQL&gt;@$ORACLE_HOME/rdbms/admin/utlpwdmg.sql</p>\n<p>3.设置口令复杂度</p>\n<p>要求长度不小于4位字符串，而且是字母和数字或特殊字符的混合，用户<br>名和口令禁止相同<br>SQL&gt;ALTER PROFILE “DEFAULT” LIMIT password_verify_function verify_function;</p>\n<p>注意： Oracle 口令复杂度包含的特殊字符不是任意特殊字符都可以，一般以下划线、 $、 *等符号为主</p>\n<p>2、设置口令使用期限要求到期后自动更改</p>\n<p>1.检查 profile 文件设置<br>SQL&gt;SELECT * FROM dba_profiles;</p>\n<p>2.设置 profile 密码策略，建议使用控制台设置<br>SQL&gt;ALTER PROFILE “DEFAULT” LIMIT password_life_time 30;</p>\n<p>3、设置策略对口令尝试次数进行限制</p>\n<p>1.检查 profile 文件设置<br>SQL&gt;SELECT * FROM dba_profiles;</p>\n<p>2.设置 profile 密码策略<br>SQL&gt;ALTER PROFILE “DEFAULT” LIMIT failed_login_attempts 5 password_lock_time 1;</p>\n<p>建议：设置口令尝试次数为5 次，登录超过有效次数锁定时间为 1天。 缺陷是万一有恶意访问，在输入多次错误密码后此用户就被锁定导致不可用。</p>\n<p>审计策略加固</p>\n<p>1、审计配置</p>\n<p>启用相应的审计功能，配置审核策略使系统能够审核数据库管理和安全相关操作的信息，</p>\n<p>建议对 SYSDBA审计操作</p>\n<p>1.启用审计功能<br>SQL&gt;ALTER SYSTEM SET audit_trail=os scope=spfile;</p>\n<p>2.启用对 sysdba 的活动审计<br>SQL&gt;ALTER SYSTEM SET audit_sys_operations=true;</p>\n<p>3.重启数据库，使设置生效</p>\n<p>若是 windows 平台,audit trail 会记录在 windows 的事件管理器中,</p>\n<p>若是linux/unix 平台则会记录在audit_file_dest 参数指定文件中；</p>\n<p>注意：审计功能对数据库的性能和磁盘空间要求较高；需要重启数据库，应提前通知业务部门</p>\n<p>2、配置日志策略</p>\n<p>配置日志策略，确保数据库的归档日志文件、在线日志文件、网络日志、跟踪文件、警告日志记录功能是否启用并且有效实施</p>\n<ol>\n<li>配置归档模式，将数据库正常关闭<br>SQL&gt;SHUTDOWN IMMEDIATE<br>启动到 MOUNT 模式<br>SQL&gt;STARTUP MOUNT<br>SQL&gt;ALTER DATABASE ARCHIVELOG<br>SQL&gt;ALTER DATABASE OPEN</li>\n</ol>\n<p>2.配置归档日志的名称格式<br>ALTER SYSTEM SET log_archvie_format=’%S_%T_%R.log’ scope=spfile</p>\n<p>3.配置归档位置<br>ALTER SYSTEM SET log_archive_dest_1=’location=oracleoradataarchive1’ scope=spfile</p>\n<p>3、配置日志管理策略</p>\n<p>配置日志管理策略、保证日志存放的地点的安全可靠</p>\n<ol>\n<li>配置多个归档位置，包括本地归档位置和远程归档位置<br>ALTER SYSTEM SET log_archive_dest_2=’location=oracleoradataarchive2’ scope=spfile<br>ALTER SYSTEM SET log_archive_dest_3=’service=standby’ scope=spfile<br>配置远程归档位置时， SERVICE 选项需要制定远程数据库的网络服务名（在 tnsnames.Ora 文<br>件中配置）<br>漏洞加固</li>\n</ol>\n<p>1、安装系统安全补丁，</p>\n<p>对安全软件扫描或手工检查发现的系统漏洞进行修补</p>\n<p>1.运行防病毒软件（如 SEP）保护操作系统<br>2.下载并安装相应的安全补丁</p>\n<p>注意：更新安全补丁可能对数据库系统、应用系统造成影响； 需要进行严格测试并做好备<br>份恢复措施后实施</p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"数据库安全","path":"api/categories/数据库安全.json"}],"tags":[{"name":"Oracle","path":"api/tags/Oracle.json"},{"name":"等级保护","path":"api/tags/等级保护.json"},{"name":"安全加固","path":"api/tags/安全加固.json"}]}