{"title":"2.InfluxDB1.x数据库实践使用","slug":"数据存储/InfluxDB/2.InfluxDB1.x数据库实践使用","date":"2022-04-11T05:40:32.000Z","updated":"2022-08-17T14:50:10.933Z","url":"2022/4-11-670.html","path":"api/articles/2022/4-11-670.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220726165604.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220726165544.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"0x00-influx-命令-influxDB-客户端\"><a href=\"#0x00-influx-命令-influxDB-客户端\" class=\"headerlink\" title=\"0x00 influx 命令 - influxDB 客户端\"></a>0x00 influx 命令 - influxDB 客户端</h2><h3 id=\"语法参数\"><a href=\"#语法参数\" class=\"headerlink\" title=\"语法参数\"></a>语法参数</h3><p><strong>语法与参数:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># influx 语法</span></span><br><span class=\"line\">Usage of influx:</span><br><span class=\"line\">  -version  <span class=\"comment\"># Display the version and exit.</span></span><br><span class=\"line\">  -path-prefix <span class=\"string\">'url path'</span> <span class=\"comment\"># Path that follows the host and port</span></span><br><span class=\"line\">  -host <span class=\"string\">'host name'</span>  <span class=\"comment\"># Host to connect to.</span></span><br><span class=\"line\">  -port <span class=\"string\">'port #'</span>     <span class=\"comment\"># Port to connect to.</span></span><br><span class=\"line\">  -socket <span class=\"string\">'unix domain socket'</span> <span class=\"comment\"># Unix socket to connect to.</span></span><br><span class=\"line\">  -database <span class=\"string\">'database name'</span> <span class=\"comment\"># Database to connect to the server.</span></span><br><span class=\"line\">  -password <span class=\"string\">'password'</span> <span class=\"comment\"># Password to connect to the server.  Leaving blank will prompt for password (--password '').</span></span><br><span class=\"line\">  -username <span class=\"string\">'username'</span> <span class=\"comment\"># Username to connect to the server.</span></span><br><span class=\"line\">  -ssl                 <span class=\"comment\"># Use https for requests.</span></span><br><span class=\"line\">  -unsafeSsl           <span class=\"comment\"># Set this when connecting to the cluster using https and not use SSL verification.</span></span><br><span class=\"line\">  -execute <span class=\"string\">'command'</span>   <span class=\"comment\"># Execute command and quit.</span></span><br><span class=\"line\">  -<span class=\"built_in\">type</span> <span class=\"string\">'influxql|flux'</span>              <span class=\"comment\">#  Type specifies the query language for executing commands or when invoking the REPL.</span></span><br><span class=\"line\">  -format <span class=\"string\">'json|csv|column'</span>          <span class=\"comment\">#  Format specifies the format of the server responses:  json, csv, or column.</span></span><br><span class=\"line\">  -precision <span class=\"string\">'rfc3339|h|m|s|ms|u|ns'</span> <span class=\"comment\">#  Precision specifies the format of the timestamp:  rfc3339, h, m, s, ms, u or ns.</span></span><br><span class=\"line\">  -consistency <span class=\"string\">'any|one|quorum|all'</span>  <span class=\"comment\">#  Set write consistency level: any, one, quorum, or all</span></span><br><span class=\"line\">  -pretty <span class=\"comment\"># urns on pretty print for the json format.</span></span><br><span class=\"line\">  -import <span class=\"comment\"># Import a previous database export from file</span></span><br><span class=\"line\">  -pps    <span class=\"comment\"># How many points per second the import will allow.  By default it is zero and will not throttle importing.</span></span><br><span class=\"line\">  -path   <span class=\"comment\">#  Path to file to import</span></span><br><span class=\"line\">  -compressed <span class=\"comment\"># Set to true if the import file is compressed</span></span><br><span class=\"line\"></span><br><span class=\"line\">Examples:</span><br><span class=\"line\"><span class=\"comment\"># 交互式 -&gt; Connect to a specific database on startup and set database context:</span></span><br><span class=\"line\">$ influx -database <span class=\"string\">'metrics'</span> -host <span class=\"string\">'db.weiyigeek.top'</span> -port <span class=\"string\">'8086'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 命令行 -&gt; Use influx in a non-interactive mode to query the database \"metrics\" and pretty print json:</span></span><br><span class=\"line\">$ influx -database <span class=\"string\">'metrics'</span> -execute <span class=\"string\">'select * from cpu'</span> -format <span class=\"string\">'json'</span> -pretty</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># API -&gt; 使用此地址检查InfluxDB实例的状态以及InfluxDB的版本</span></span><br><span class=\"line\">$ curl -G http://db.weiyigeek.top:8086/ping</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h3 id=\"简单示例\"><a href=\"#简单示例\" class=\"headerlink\" title=\"简单示例\"></a>简单示例</h3><p><strong>实践1.其可以利用类似于关系型数据库SQL语句语法，例如：</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1) 数据库的操作</span></span><br><span class=\"line\">SHOW DATABASES <span class=\"comment\"># 查看数据库</span></span><br><span class=\"line\">CREATE DATABASE <span class=\"string\">\"weiyigeek\"</span> <span class=\"comment\"># 创建数据库</span></span><br><span class=\"line\">USE weiyigeek  <span class=\"comment\"># 选择数据库</span></span><br><span class=\"line\">DROP DATABASES <span class=\"string\">\"weiyigeek\"</span>  <span class=\"comment\"># 删除数据库</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2) 数据库权限设置</span></span><br><span class=\"line\">GRANT all privileges on weiyigeek to admin <span class=\"comment\"># 给admin用户授权一个数据库的所有操作权限</span></span><br><span class=\"line\">GRANT write on weiyigeek to admin  <span class=\"comment\"># 给某个用户授权一个数据库的写操作</span></span><br><span class=\"line\">GRANT <span class=\"built_in\">read</span> on weiyigeek to admin   <span class=\"comment\"># 给某个用户授权一个数据库的读操</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3) 表的数据操作</span></span><br><span class=\"line\">SHOW MEASUREMENTS  <span class=\"comment\"># 显示采集的数据表</span></span><br><span class=\"line\">INSERT iot_sensor,host=host_name,region=cn value=66 1658823229  <span class=\"comment\"># 插入数据到 iot_sensor measurement，标签host=host_name，region=cn, field是value=66， 1658823229 是指定的时间戳</span></span><br><span class=\"line\">SELECT <span class=\"string\">\"host\"</span>, <span class=\"string\">\"region\"</span>, <span class=\"string\">\"value\"</span> FROM <span class=\"string\">\"iot_sensor\"</span>   <span class=\"comment\"># 从 iot_sensor measurement 中查询指定字段（label、field）的数据 </span></span><br><span class=\"line\">DROP MEASUREMENTS iot_sensor  <span class=\"comment\"># 删除指定表</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4) 数据查询</span></span><br><span class=\"line\">select * from <span class=\"built_in\">test</span> iot_sensor host=<span class=\"string\">'192.168.12.12'</span> and value=<span class=\"string\">'4321'</span> and time &gt; <span class=\"string\">'2022-01-11T02:52:55Z'</span>   <span class=\"comment\"># 多条件查询</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 通过limit和offset配合可以实现分页，offset后面的值为开始的位置</span></span><br><span class=\"line\">select * from <span class=\"built_in\">test</span> <span class=\"built_in\">limit</span> 5 OFFSET 0 </span><br><span class=\"line\">select * from <span class=\"built_in\">test</span> <span class=\"built_in\">limit</span> 5 OFFSET 5</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 1.实现查询以给定字段开始的数据</span></span><br><span class=\"line\">select fieldName from measurementName <span class=\"built_in\">where</span> fieldName=~/^给定字段/</span><br><span class=\"line\"><span class=\"comment\"># 2.实现查询以给定字段结束的数据</span></span><br><span class=\"line\">select fieldName from measurementName <span class=\"built_in\">where</span> fieldName=~/给定字段$/</span><br><span class=\"line\"><span class=\"comment\"># 3.实现查询包含给定字段数据</span></span><br><span class=\"line\">select fieldName from measurementName <span class=\"built_in\">where</span> fieldName=~/给定字段/</span><br></pre></td></tr></table></figure></p>\n<p>温馨提示: 在influxdb中可以把 <code>measurement</code> 看为关系数据库中的table，tag和field是其中的列。其中Tag都加了索引、field不加, 和关系数据库不同的是，不用预先定义schema，没有value的点不会被保存。</p>\n<p><br/></p>\n<p><strong>实践2.利用Influx API接口请求</strong><br>描述：接口中最重要的 <code>/query</code> 地址接受 GET 和 POST HTTP请求。使用此地址可以查询数据并管理数据库，保留策略和用户<br>类型方法：</p>\n<ul>\n<li>GET：SELECT、SHOW</li>\n<li>POST：ALTER、CREATE、DELETE、DROP、GRANT、KILL、REVOKE</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 该/debug/requests返回写入和查询的数量每用户名和IP地址InfluxDB在指定时间范围内</span></span><br><span class=\"line\">$ curl http://db.weiyigeek.top:8086/debug/requests?seconds=60</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 通过 /debug/vars 地址公开有关其运行时的统计信息和信息</span></span><br><span class=\"line\">$ curl http://db.weiyigeek.top:8086/debug/vars</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 通过 /query 地址查看数据库及其数据表(注意查询事一定要带db参数)</span></span><br><span class=\"line\">$ curl <span class=\"string\">'http://10.106.17.52:8086/query?db=jmeter'</span> --data-urlencode <span class=\"string\">'q=SHOW DATABASES'</span></span><br><span class=\"line\">  <span class=\"comment\"># &#123;\"results\":[&#123;\"statement_id\":0,\"series\":[&#123;\"name\":\"databases\",\"columns\":[\"name\"],\"values\":[[\"_internal\"],[\"jmeter\"]]&#125;]&#125;]&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ curl <span class=\"string\">'http://10.106.17.52:8086/query?db=jmeter'</span> --data-urlencode <span class=\"string\">'q=SHOW MEASUREMENTS'</span></span><br><span class=\"line\">  <span class=\"comment\"># &#123;\"results\":[&#123;\"statement_id\":0,\"series\":[&#123;\"name\":\"measurements\",\"columns\":[\"name\"],\"values\":[[\"events\"],[\"jmeter\"]]&#125;]&#125;]&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 浏览器请求</span></span><br><span class=\"line\"><span class=\"comment\"># 返回json格式数据</span></span><br><span class=\"line\">http://db.weiyigeek.top:8086/query?db=mydb&amp;pretty=<span class=\"literal\">true</span>&amp;q=SELECT * FROM meas01</span><br><span class=\"line\"><span class=\"comment\"># 以json格式返回具有指定精度的纪元时间戳</span></span><br><span class=\"line\">http://db.weiyigeek.top:8086/query?db=mydb&amp;epoch=s&amp;pretty=<span class=\"literal\">true</span>&amp;q=SELECT * FROM meas01</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># curl 命令请求</span></span><br><span class=\"line\"><span class=\"comment\"># 返回具有指定精度的纪元时间戳 </span></span><br><span class=\"line\">$ curl -G <span class=\"string\">'http://db.weiyigeek.top:8086/query?db=mydb&amp;epoch=s'</span> --data-urlencode <span class=\"string\">'q=SELECT * FROM \"meas01\"'</span></span><br><span class=\"line\"><span class=\"comment\"># 添加用户、密码参数</span></span><br><span class=\"line\">$ curl -G <span class=\"string\">'http://db.weiyigeek.top:8086/query?db=mydb&amp;u=admin&amp;p=123456'</span> --data-urlencode <span class=\"string\">'q=SELECT * FROM \"meas01\"'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 插入单条数据</span></span><br><span class=\"line\">$ curl -i -XPOST <span class=\"string\">'http://db.weiyigeek.top:8086/write?db=mydb'</span> --data-binary <span class=\"string\">'cpu_load_short,host=server01,region=us-west value=0.64 1434055562000000000'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 插入多条数据</span></span><br><span class=\"line\">$ curl -i -XPOST <span class=\"string\">'http://db.weiyigeek.top:8086/write?db=mydb'</span> --data-binary <span class=\"string\">'cpu_load_short,host=server02 value=0.67</span></span><br><span class=\"line\"><span class=\"string\">cpu_load_short,host=server02,region=us-west value=0.55 1422568543702900257</span></span><br><span class=\"line\"><span class=\"string\">cpu_load_short,direction=in,host=server01,region=us-west value=2.0 1422568543702900257'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 通过文件插入多条数据</span></span><br><span class=\"line\">$ curl -i -XPOST <span class=\"string\">\"http://db.weiyigeek.top:8086/write?db=mydb\"</span> --data-binary @data.txt</span><br></pre></td></tr></table></figure>\n<p><br></p>\n<p><strong>实践3.influx 交互式</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.控制台指定输出格式，支持 column, csv, json 三种格式默认为column。</span></span><br><span class=\"line\">influx -format=csv</span><br><span class=\"line\">influx -format=json</span><br><span class=\"line\">influx -format=json -pretty</span><br></pre></td></tr></table></figure></p>\n<hr>\n<h2 id=\"0x01-influxDB1-x-实践\"><a href=\"#0x01-influxDB1-x-实践\" class=\"headerlink\" title=\"0x01 influxDB1.x 实践\"></a>0x01 influxDB1.x 实践</h2><h3 id=\"时间时区设置显示\"><a href=\"#时间时区设置显示\" class=\"headerlink\" title=\"时间时区设置显示\"></a>时间时区设置显示</h3><p>描述: InfluxDB 作为时间序列数据库，在处理时间数据时，有特殊的机制和规范，在使用时需要注意，本小节主要介绍 InfluxDB 中与时间相关的几个概念 <code>precision，duration，epoch_time</code>。</p>\n<p>在互联网中常见是UTC时间(即世界标准时间), 它以 <code>1970-01-01T00:00:00</code> 为起点的毫秒数，不考虑闰秒。</p>\n<p>在 InfluxDB 中显示时间通常以时间戳形式进行存储，其不分时区，在任意时间点，不同时区的 UTC 时间戳是相同的, 但时间戳在转换为日期时，会根据本地时区，转换为不同的日期值, 例如时间戳的起始时刻如下所示, 并且在1970年之前的日期对应的时间戳为负数。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># UTC+0</span></span><br><span class=\"line\">Thu Jan 01 1970 00:00:00 GMT+0000 (标准时间)</span><br><span class=\"line\"><span class=\"comment\"># UTC+8</span></span><br><span class=\"line\">Thu Jan 01 1970 08:00:00 GMT+0800 (中国标准时间)</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p><strong>precision - 时间戳转换显示</strong><br>描述: 在写入和读取 influxdb 中的数据时，时间戳默认单位是纳秒，可以通过 precision 参数来指定为其他格式，比如 <code>rfc3339 (YYYY-MM-DDTHH:MM:SS.nnnnnnnnnZ), h (小时), m (分钟), s (秒), ms (毫秒), u (微妙), ns (纳秒)</code></p>\n<p>实践1.使用 curl 来请求写入时，通过 precision 指定时间戳单位<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 时间戳数据 1463683075 会按照秒来解析, 如果不指定 precision 默认会按照纳秒来解析其将会转换为 1463683075000000000</span></span><br><span class=\"line\">curl -i -XPOST <span class=\"string\">\"http://db.weiyigeek.top:8086/write?db=weiyigeek&amp;precision=s\"</span> --data-binary <span class=\"string\">'mymeas,mytag=1 myfield=90 1463683075'</span></span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p>实践2.使用 <code>influx 客户端</code> 进行交互式时间与时区格式调整。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 命令行模式中指定 precision 默认是纳秒</span></span><br><span class=\"line\">$ influx -precision ns</span><br><span class=\"line\"><span class=\"comment\"># 默认时间的显示是unix时间戳（纳秒）</span></span><br><span class=\"line\">&gt; select * from events <span class=\"built_in\">limit</span> 2;</span><br><span class=\"line\">name: events</span><br><span class=\"line\">time                application     tags text                 title</span><br><span class=\"line\">----                -----------     ---- ----                 -----</span><br><span class=\"line\">1658221734002000000 weiyigeek-index      jmeter-index started ApacheJMeter</span><br><span class=\"line\">1658221735666000000 weiyigeek-index      jmeter-index ended   ApacheJMeter</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置rfc3339时间格式进行时间显示（此处时区为UTC时区）</span></span><br><span class=\"line\">&gt; precision rfc3339</span><br><span class=\"line\">&gt; select * from events <span class=\"built_in\">limit</span> 2;</span><br><span class=\"line\">name: events</span><br><span class=\"line\">time                     application     tags text                 title</span><br><span class=\"line\">----                     -----------     ---- ----                 -----</span><br><span class=\"line\">2022-07-19T09:08:54.002Z weiyigeek-index      jmeter-index started ApacheJMeter</span><br><span class=\"line\">2022-07-19T09:08:55.666Z weiyigeek-index      jmeter-index ended   ApacheJMeter</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用 tz('Asia/Shanghai') 以 UTC+8 时区显示</span></span><br><span class=\"line\">&gt; select * from events <span class=\"built_in\">where</span> time &gt;= <span class=\"string\">'2022-07-18T09:08:54.002Z'</span> tz(<span class=\"string\">'Asia/Shanghai'</span>)</span><br><span class=\"line\">name: events</span><br><span class=\"line\">time                          application     tags      text                 title</span><br><span class=\"line\">----                          -----------     ----      ----                 -----</span><br><span class=\"line\">2022-07-19T17:08:54.002+08:00 weiyigeek-index           jmeter-index started ApacheJMeter</span><br><span class=\"line\">2022-07-19T17:08:55.666+08:00 weiyigeek-index           jmeter-index ended   ApacheJMeter</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 补充知识:指定时区显示使用 API 接口请求</span></span><br><span class=\"line\">curl <span class=\"string\">'http://10.106.17.52:8086/query?db=jmeter'</span> --data-urlencode <span class=\"string\">\"q=select * from events where time &gt;= '2022-07-18T09:08:54.002Z' tz('Asia/Shanghai')\"</span></span><br></pre></td></tr></table></figure>\n<p><br/></p>\n<p>实践3.使用 <code>influx 客户端</code> 命令式<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ influx -execute <span class=\"string\">'SELECT * FROM \"weiyigeek\" LIMIT 3'</span> -database=<span class=\"string\">\"NOAA_water_database\"</span> -precision=rfc3339</span><br><span class=\"line\">name: weiyigeek</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>epoch_time</strong></p>\n<p>描述: 在 InfluxDB Select 语句中， epoch 值就是时间戳，只不过 epoch 有更丰富的语义，使用起来更方便灵活, <code>epoch 0 （1970-01-01T00:00:00Z）</code>常被用来表示无意义的时间戳，也就是 null。</p>\n<p>而 epoch time 就是 UTC 时间戳，默认单位为纳秒，可以通过 epoch_time 值后面跟 duration unit 来指定 precision, 并且 epoch_time 支持基本的算术运算，比如 <code>+</code> 或 <code>-</code>。</p>\n<p>温馨提示: influxQL 要求运算符与 epoch_time 之间要有空格。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.now() : 本地服务器对应的纳秒时间戳, 并可以使用其来指定相对时间。</span></span><br><span class=\"line\">&gt; select * from events <span class=\"built_in\">where</span> time &lt;= now();</span><br><span class=\"line\">name: events</span><br><span class=\"line\">time                application     tags      text                 title</span><br><span class=\"line\">----                -----------     ----      ----                 -----</span><br><span class=\"line\">1658221734002000000 weiyigeek-index           jmeter-index started ApacheJMeter</span><br><span class=\"line\">1658221735666000000 weiyigeek-index           jmeter-index ended   ApacheJMeter</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; SELECT <span class=\"string\">\"water_level\"</span> FROM <span class=\"string\">\"h2o_feet\"</span> WHERE time &gt; now() - 1h</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.比如，当请求的结果中不包含时间戳时，time 值就会置为 0:</span></span><br><span class=\"line\">&gt; SELECT MEAN(<span class=\"string\">\"index\"</span>) FROM <span class=\"string\">\"weiyigeek\"</span> GROUP BY location,randtag</span><br><span class=\"line\">name: weiyigeek</span><br><span class=\"line\">tags: location=coyote_creek, randtag=1</span><br><span class=\"line\">time                  mean</span><br><span class=\"line\">----                  ----</span><br><span class=\"line\">1970-01-01T00:00:00Z  50.69033760186263</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.使用 poch_time 进行简单的运算</span></span><br><span class=\"line\">&gt; SELECT <span class=\"string\">\"water_level\"</span> FROM <span class=\"string\">\"h2o_feet\"</span> WHERE time &gt; 24043524m - 6m</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.通过添加 duration unit 来指定 precision 为秒</span></span><br><span class=\"line\">&gt; SELECT <span class=\"string\">\"water_level\"</span> FROM <span class=\"string\">\"h2o_feet\"</span> WHERE <span class=\"string\">\"location\"</span> = <span class=\"string\">'santa_monica'</span> AND time &gt;= 1439856000s AND time &lt;= 1439856720s</span><br></pre></td></tr></table></figure>\n<p><br></p>\n<p><strong>duration</strong><br>描述: duration 用于指定一段时间长度 <code>duration = integer + duration unit</code>, 其中 <code>duration units</code> 可用单位 <code>&quot;ns&quot; | &quot;u&quot; | &quot;µ&quot; | &quot;ms&quot; | &quot;s&quot; | &quot;m&quot; | &quot;h&quot; | &quot;d&quot; | &quot;w&quot;</code>.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.在 InfluxDB 中，配置数据库的 Retention Policy 中会用到 duration，比如：</span></span><br><span class=\"line\"><span class=\"comment\"># 创建保留策略。</span></span><br><span class=\"line\">CREATE RETENTION POLICY <span class=\"string\">\"10m.events\"</span> ON <span class=\"string\">\"weiyigeek\"</span> DURATION 60m REPLICATION 2</span><br><span class=\"line\"><span class=\"comment\"># 创建保留策略并将其设置为默认值。</span></span><br><span class=\"line\">CREATE RETENTION POLICY <span class=\"string\">\"10m.events\"</span> ON <span class=\"string\">\"weiyigeek\"</span> DURATION 60m REPLICATION 2 DEFAULT</span><br><span class=\"line\"><span class=\"comment\"># 创建保留策略并指定分片组持续时间。</span></span><br><span class=\"line\">CREATE RETENTION POLICY <span class=\"string\">\"10m.events\"</span> ON <span class=\"string\">\"weiyigeek\"</span> DURATION 60m REPLICATION 2 SHARD DURATION 30m</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.在 select 语句中也会用到 duration</span></span><br><span class=\"line\">SELECT mean(<span class=\"string\">\"value\"</span>) FROM <span class=\"string\">\"cpu\"</span> GROUP BY region, time(1d) fill(0) tz(<span class=\"string\">'America/Chicago'</span>)</span><br><span class=\"line\">SELECT MEAN(value) FROM cpu GROUP BY time(10m)</span><br><span class=\"line\">SELECT <span class=\"string\">\"water_level\"</span> FROM <span class=\"string\">\"h2o_feet\"</span> WHERE <span class=\"string\">\"location\"</span> = <span class=\"string\">'santa_monica'</span> WHERE time &gt; 24043524m - 6m</span><br></pre></td></tr></table></figure>\n<p><br/></p>\n<h3 id=\"数据导出导入\"><a href=\"#数据导出导入\" class=\"headerlink\" title=\"数据导出导入\"></a>数据导出导入</h3><p><strong>实践1.将influxDB中的数据进行(导出、导入)操作</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 导出表中数据为csv格式</span></span><br><span class=\"line\">influx -host db.weiyigeek.top -port 8086 -database iot_bridge -format csv -execute <span class=\"string\">'select * from \"iot_table\"'</span> -precision=rfc3339 &gt;&gt; iot_table.csv  </span><br><span class=\"line\"><span class=\"comment\"># 导出表数据中大于某一时间点的数据为csv格式</span></span><br><span class=\"line\">influx -host db.weiyigeek.top -port 8086 -database iot_bridge -format csv -execute <span class=\"string\">'select * from \"iot_table\" where time &gt;= \"2021-04-28T00:00:00Z\"'</span> -precision=rfc3339 &gt;&gt; iot_table_time.csv </span><br><span class=\"line\"><span class=\"comment\"># 导出指定范围内的数据到计算机指定目录中</span></span><br><span class=\"line\">influx_inspect <span class=\"built_in\">export</span> -datadir <span class=\"string\">\"C:/Users/weiyigeek/.influxdb/data\"</span> -waldir <span class=\"string\">\"C:/Users/weiyigeek/.influxdb/wal\"</span> -out <span class=\"string\">\"backup\"</span> -database iot_bridge -start 2022-01-15T08:00:01Z -end 2022-01-15T08:00:01Z -retention autogen</span><br><span class=\"line\"><span class=\"comment\"># 以ns(纳秒)的时间格式导入path参数指定文件路径中数据到influxDB中</span></span><br><span class=\"line\">influx -import -path=db2019 -precision=ns</span><br></pre></td></tr></table></figure>\n<p><br/></p>\n<h3 id=\"数据保存策略\"><a href=\"#数据保存策略\" class=\"headerlink\" title=\"数据保存策略\"></a>数据保存策略</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看当前保存策略</span></span><br><span class=\"line\">show retention policies on <span class=\"string\">\"db_name\"</span></span><br><span class=\"line\"><span class=\"comment\"># 创建新的保存策略</span></span><br><span class=\"line\"><span class=\"comment\"># - rp_name：策略名；</span></span><br><span class=\"line\"><span class=\"comment\"># - db_name：具体的数据库名；</span></span><br><span class=\"line\"><span class=\"comment\"># - 3w：保存3周，3周之前的数据将被删除，influxdb具有各种事件参数，比如：h（小时），d（天），w（星期）；</span></span><br><span class=\"line\"><span class=\"comment\"># - replication 1：副本个数，一般为1就可以了；</span></span><br><span class=\"line\"><span class=\"comment\"># - default：设置为默认策略</span></span><br><span class=\"line\">create retention policy <span class=\"string\">\"rp_name\"</span> on <span class=\"string\">\"db_name\"</span> duration 3w replication 1 default</span><br><span class=\"line\"><span class=\"comment\"># 修改保存策略</span></span><br><span class=\"line\">alter retention policy <span class=\"string\">\"rp_name\"</span> on <span class=\"string\">\"db_name\"</span> duration 30d default</span><br><span class=\"line\"><span class=\"comment\"># 删除保存策略</span></span><br><span class=\"line\">drop retention policy <span class=\"string\">\"rp_name\"</span> on <span class=\"string\">\"db_name\"</span></span><br></pre></td></tr></table></figure>\n<hr>\n<h2 id=\"0x02-Influxdb-1-x-配置浅析\"><a href=\"#0x02-Influxdb-1-x-配置浅析\" class=\"headerlink\" title=\"0x02 Influxdb 1.x 配置浅析\"></a>0x02 Influxdb 1.x 配置浅析</h2><p>默认的配置文件路径为：<code>/etc/influxdb/influxdb.conf</code><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># reporting-disabled = false\t                             # 该选项用于上报influxdb的使用信息给InfluxData公司，默认值为false</span></span><br><span class=\"line\"><span class=\"built_in\">bind</span>-address = <span class=\"string\">\"127.0.0.1:8088\"</span>\t                           <span class=\"comment\"># 备份恢复时使用，默认值为8088</span></span><br><span class=\"line\"><span class=\"comment\">### [meta]</span></span><br><span class=\"line\">[meta]</span><br><span class=\"line\">  dir = <span class=\"string\">\"/data/influxdb/meta\"</span>                              <span class=\"comment\"># meta数据存放目录</span></span><br><span class=\"line\">  <span class=\"comment\"># retention-autocreate = true                            # 用于控制默认存储策略，数据库创建时，会自动生成autogen的存储策略，默认值：true</span></span><br><span class=\"line\">  <span class=\"comment\"># logging-enabled = true                                 # 是否开启meta日志，默认值：true</span></span><br><span class=\"line\"><span class=\"comment\">### [data]</span></span><br><span class=\"line\">[data]</span><br><span class=\"line\">  dir = <span class=\"string\">\"/data/influxdb/data\"</span>                              <span class=\"comment\"># 最终数据（TSM文件）存储目录</span></span><br><span class=\"line\">  wal-dir = <span class=\"string\">\"/data/influxdb/wal\"</span>                           <span class=\"comment\"># 预写日志存储目录</span></span><br><span class=\"line\">  <span class=\"comment\"># wal-fsync-delay = \"0s\"                                 # 在同步写入之前等待的总时间，默认0s</span></span><br><span class=\"line\">  <span class=\"comment\"># index-version = \"inmem\"                                # 用于新碎片的切分索引的类型。</span></span><br><span class=\"line\">  <span class=\"comment\"># trace-logging-enabled = false                          # 跟踪日志记录在tsm引擎周围提供了更详细的输出</span></span><br><span class=\"line\">  <span class=\"comment\"># query-log-enabled = true                               # 是否开启tsm引擎查询日志，默认值： true</span></span><br><span class=\"line\">  <span class=\"comment\"># Valid size suffixes are k, m, or g (case insensitive, 1024 = 1k).</span></span><br><span class=\"line\">  <span class=\"comment\"># cache-max-memory-size = \"1g\"                           # 用于限定shard最大值，大于该值时会拒绝写入，默认值：1000MB，单位：byte</span></span><br><span class=\"line\">  <span class=\"comment\"># Valid size suffixes are k, m, or g (case insensitive, 1024 = 1k).</span></span><br><span class=\"line\">  <span class=\"comment\"># cache-snapshot-memory-size = \"25m\"                     # 用于设置快照大小，大于该值时数据会刷新到tsm文件，默认值：25MB，单位：byte</span></span><br><span class=\"line\">  <span class=\"comment\"># cache-snapshot-write-cold-duration = \"10m\"             # tsm引擎 snapshot写盘延迟，默认值：10Minute</span></span><br><span class=\"line\">  <span class=\"comment\"># compact-full-write-cold-duration = \"4h\"                # tsm文件在压缩前可以存储的最大时间，默认值：4Hour</span></span><br><span class=\"line\">  <span class=\"comment\"># max-concurrent-compactions = 0                         # 压缩并发的最大数量，默认设置为0表示runtime.GOMAXPROCS(0)*50% ，否则以设置的非零值为准</span></span><br><span class=\"line\">  <span class=\"comment\"># Valid size suffixes are k, m, or g (case insensitive, 1024 = 1k).</span></span><br><span class=\"line\">  <span class=\"comment\"># max-index-log-file-size = \"1m\"                         # 限制索引日志文件大小</span></span><br><span class=\"line\">  <span class=\"comment\"># max-series-per-database = 1000000                      # 限制数据库的级数，该值为0时取消限制，默认值：1000000</span></span><br><span class=\"line\">  <span class=\"comment\"># max-values-per-tag = 100000                            # 一个tag最大的value数，0取消限制，默认值：100000</span></span><br><span class=\"line\">  <span class=\"comment\"># tsm-use-madv-willneed = false                          # 如果为true，mmap的建议值MADV_WILLNEED会被提供给内核</span></span><br><span class=\"line\"><span class=\"comment\">### [coordinator]</span></span><br><span class=\"line\">[coordinator]</span><br><span class=\"line\">  <span class=\"comment\"># write-timeout = \"10s\"                                  # 写操作超时时间，默认值： 10s</span></span><br><span class=\"line\">  <span class=\"comment\"># max-concurrent-queries = 0                             # 最大并发查询数，0无限制，默认值： 0</span></span><br><span class=\"line\">  <span class=\"comment\"># query-timeout = \"0s\"                                   # 查询操作超时时间，0无限制，默认值：0s</span></span><br><span class=\"line\">  <span class=\"comment\"># log-queries-after = \"0s\"                               # 慢查询超时时间，0无限制，默认值：0s</span></span><br><span class=\"line\">  <span class=\"comment\"># max-select-point = 0                                   # SELECT语句可以处理的最大点数（points），0无限制，默认值：0</span></span><br><span class=\"line\">  <span class=\"comment\"># max-select-series = 0                                  # SELECT语句可以处理的最大级数（series），0无限制，默认值：0</span></span><br><span class=\"line\">  <span class=\"comment\"># max-select-buckets = 0                                 # SELECT语句可以处理的最大\"GROUP BY time()\"的时间周期，0无限制，默认值：0</span></span><br><span class=\"line\"><span class=\"comment\">### [retention]</span></span><br><span class=\"line\">[retention]</span><br><span class=\"line\">  <span class=\"comment\"># enabled = true                                         # 是否启用该模块，默认值 ： true</span></span><br><span class=\"line\">  <span class=\"comment\"># check-interval = \"30m\"                                 # 检查时间间隔，默认值 ：\"30m\"</span></span><br><span class=\"line\"><span class=\"comment\">### [shard-precreation]</span></span><br><span class=\"line\">[shard-precreation]</span><br><span class=\"line\">  <span class=\"comment\"># enabled = true                                         # 是否启用该模块，默认值 ： true</span></span><br><span class=\"line\">  <span class=\"comment\"># check-interval = \"10m\"                                 # 检查时间间隔，默认值 ：\"10m\"</span></span><br><span class=\"line\">  <span class=\"comment\"># advance-period = \"30m\"                                 # 预创建分区的最大提前时间，默认值 ：\"30m\"</span></span><br><span class=\"line\">[monitor]</span><br><span class=\"line\">  <span class=\"comment\"># store-enabled = true                                   # 是否启用该模块，默认值 ：true</span></span><br><span class=\"line\">  <span class=\"comment\"># store-database = \"_internal\"                           # 默认数据库：\"_internal\"</span></span><br><span class=\"line\">  <span class=\"comment\"># store-interval = \"10s\"                                 # 统计间隔，默认值：\"10s\"</span></span><br><span class=\"line\"><span class=\"comment\">### [http]</span></span><br><span class=\"line\">[http]</span><br><span class=\"line\">  <span class=\"comment\"># enabled = true                                         # 是否启用该模块，默认值 ：true</span></span><br><span class=\"line\">  <span class=\"comment\"># bind-address = \":8086\"                                 # 绑定地址，默认值 ：\":8086\"</span></span><br><span class=\"line\">  <span class=\"comment\"># auth-enabled = false                                   # 是否开启认证，默认值：false</span></span><br><span class=\"line\">  <span class=\"comment\"># realm = \"InfluxDB\"                                     # 配置JWT realm，默认值: \"InfluxDB\"</span></span><br><span class=\"line\">  <span class=\"comment\"># log-enabled = true                                     # 是否开启日志，默认值：true</span></span><br><span class=\"line\">  <span class=\"comment\"># suppress-write-log = false                             # 在启用日志时是否抑制HTTP写请求日志</span></span><br><span class=\"line\">  <span class=\"comment\"># access-log-path = \"\"                                   # 当启用HTTP请求日志时，该选项指定了路径。如influxd不能访问指定的路径，它将记录一个错误并将请求日志写入stderr</span></span><br><span class=\"line\">  <span class=\"comment\"># write-tracing = false                                  # 是否开启写操作日志，如果置成true，每一次写操作都会打日志，默认值：false</span></span><br><span class=\"line\">  <span class=\"comment\"># pprof-enabled = true                                   # 是否开启pprof，默认值：true</span></span><br><span class=\"line\">  <span class=\"comment\"># debug-pprof-enabled = false                            # 是否开启pprof，默认值：true</span></span><br><span class=\"line\">  <span class=\"comment\"># https-enabled = false                                  # 是否开启https ，默认值 ：false</span></span><br><span class=\"line\">  <span class=\"comment\"># https-certificate = \"/etc/ssl/influxdb.pem\"            # 设置https证书路径，默认值：\"/etc/ssl/influxdb.pem\"</span></span><br><span class=\"line\">  <span class=\"comment\"># https-private-key = \"\"                                 # 设置https私钥，无默认值</span></span><br><span class=\"line\">  <span class=\"comment\"># shared-secret = \"\"                                     # 用于JWT签名的共享密钥，无默认值</span></span><br><span class=\"line\">  <span class=\"comment\"># max-row-limit = 0                                      # 配置查询返回最大行数，0无限制，默认值：0</span></span><br><span class=\"line\">  <span class=\"comment\"># max-connection-limit = 0                               # 配置最大连接数，0无限制，默认值：0</span></span><br><span class=\"line\">  <span class=\"comment\"># unix-socket-enabled = false                            # 是否使用unix-socket，默认值：false</span></span><br><span class=\"line\">  <span class=\"comment\"># bind-socket = \"/var/run/influxdb.sock\"                 # unix-socket路径，默认值：\"/var/run/influxdb.sock\"</span></span><br><span class=\"line\">  <span class=\"comment\"># max-body-size = 25000000                               # 客户端请求主体的最大值，以字节为单位。0无限制，默认值0</span></span><br><span class=\"line\">  <span class=\"comment\"># max-concurrent-write-limit = 0                         # 并发处理的最大写入次数,0无限制，默认值0</span></span><br><span class=\"line\">  <span class=\"comment\"># max-enqueued-write-limit = 0                           # 排队等待处理的最大数量,0无限制，默认值0</span></span><br><span class=\"line\">  <span class=\"comment\"># enqueued-write-timeout = 0                             # 在队列中等待处理的最长时间，0或者setting max-concurrent-write-limit=0无限制，默认值0</span></span><br><span class=\"line\"><span class=\"comment\">### [ifql]</span></span><br><span class=\"line\">[ifql]</span><br><span class=\"line\">  <span class=\"comment\"># enabled = true                                         # 是否启用该模块，默认值 ：true</span></span><br><span class=\"line\">  <span class=\"comment\"># log-enabled = true                                     # 是否开启日志，默认值：true</span></span><br><span class=\"line\">  <span class=\"comment\"># bind-address = \":8082\"                                 # ifql RPC服务使用的绑定地址默认是8082</span></span><br><span class=\"line\"><span class=\"comment\">### [logging]</span></span><br><span class=\"line\">[logging]</span><br><span class=\"line\">  <span class=\"comment\"># format = \"auto\"                                        # 日志格式，默认是自动</span></span><br><span class=\"line\">  <span class=\"comment\"># level = \"info\"                                         # 日志级别默认info</span></span><br><span class=\"line\">  <span class=\"comment\"># suppress-logo = false                                  # 当程序启动时，会抑制打印出来的logo输出</span></span><br><span class=\"line\"><span class=\"comment\">### [subscriber]</span></span><br><span class=\"line\">[subscriber]</span><br><span class=\"line\">  <span class=\"comment\"># enabled = true\t                                       # 是否启用该模块，默认值 ：true</span></span><br><span class=\"line\">  <span class=\"comment\"># http-timeout = \"30s\"\t                                 # http超时时间，默认值：\"30s\"</span></span><br><span class=\"line\">  <span class=\"comment\"># insecure-skip-verify = false\t                         # 是否允许不安全的证书</span></span><br><span class=\"line\">  <span class=\"comment\"># ca-certs = \"\"\t                                         # 设置CA证书</span></span><br><span class=\"line\">  <span class=\"comment\"># write-concurrency = 40\t                               # 设置并发数目，默认值：40</span></span><br><span class=\"line\">  <span class=\"comment\"># write-buffer-size = 1000 \t                             # 设置buffer大小，默认值：1000</span></span><br><span class=\"line\"><span class=\"comment\">### [[graphite]]</span></span><br><span class=\"line\">[[graphite]]</span><br><span class=\"line\">  <span class=\"comment\"># enabled = false                                        # 是否启用该模块，默认值 ：false</span></span><br><span class=\"line\">  <span class=\"comment\"># database = \"graphite\"                                  # 数据库名称，默认值：\"graphite\"</span></span><br><span class=\"line\">  <span class=\"comment\"># retention-policy = \"\"                                  # 存储策略，无默认值</span></span><br><span class=\"line\">  <span class=\"comment\"># bind-address = \":2003\"                                 # 绑定地址，默认值：\":2003\"</span></span><br><span class=\"line\">  <span class=\"comment\"># protocol = \"tcp\"                                       # 协议，默认值：\"tcp\"</span></span><br><span class=\"line\">  <span class=\"comment\"># consistency-level = \"one\"                              # 一致性级别，默认值：\"one</span></span><br><span class=\"line\">  <span class=\"comment\"># batch-size = 5000                                      # 批量size，默认值：5000</span></span><br><span class=\"line\">  <span class=\"comment\"># batch-pending = 10                                     # 配置在内存中等待的batch数，默认值：10</span></span><br><span class=\"line\">  <span class=\"comment\"># batch-timeout = \"1s\"                                   # 超时时间，默认值：\"1s\"</span></span><br><span class=\"line\">  <span class=\"comment\"># udp-read-buffer = 0                                    # udp读取buffer的大小，0表示使用操作系统提供的值，如果超过操作系统的默认配置则会出错。 该配置的默认值：0</span></span><br><span class=\"line\">  <span class=\"comment\"># separator = \".\"                                        # 多个measurement间的连接符，默认值： \".\"</span></span><br><span class=\"line\">  <span class=\"comment\"># tags = [\"region=us-east\", \"zone=1c\"]                   # 将被添加到所有指标的默认标签。这些可以在模板级别上覆盖或者从指标中提取的标签</span></span><br><span class=\"line\">  <span class=\"comment\"># templates = [</span></span><br><span class=\"line\">  <span class=\"comment\">#   \"*.app env.service.resource.measurement\",</span></span><br><span class=\"line\">  <span class=\"comment\">#   # Default template</span></span><br><span class=\"line\">  <span class=\"comment\">#   \"server.*\",</span></span><br><span class=\"line\">  <span class=\"comment\"># ]</span></span><br><span class=\"line\"><span class=\"comment\">### [collectd]</span></span><br><span class=\"line\">[[collectd]]</span><br><span class=\"line\">  <span class=\"comment\"># enabled = false                                        # 是否启用该模块，默认值 ：false</span></span><br><span class=\"line\">  <span class=\"comment\"># bind-address = \":25826\"                                # 绑定地址，默认值： \":25826\"</span></span><br><span class=\"line\">  <span class=\"comment\"># database = \"collectd\"                                  # 数据库名称，默认值：\"collectd\"</span></span><br><span class=\"line\">  <span class=\"comment\"># retention-policy = \"\"                                  # 存储策略，无默认值</span></span><br><span class=\"line\">  <span class=\"comment\"># typesdb = \"/usr/local/share/collectd\"                  # 路径，默认值：\"/usr/share/collectd/types.db\"</span></span><br><span class=\"line\">  <span class=\"comment\"># security-level = \"none\"                                # 安全级别</span></span><br><span class=\"line\">  <span class=\"comment\"># auth-file = \"/etc/collectd/auth_file\"</span></span><br><span class=\"line\">  <span class=\"comment\"># batch-size = 5000                                      # 从缓存中批量获取数据的量，默认值：5000</span></span><br><span class=\"line\">  <span class=\"comment\"># batch-pending = 10                                     # 可能在内存中等待的批次的数量，默认值：10</span></span><br><span class=\"line\">  <span class=\"comment\"># batch-timeout = \"10s\"                                  # 即使没有达到缓冲区的限制，至少要刷新一下，默认值：\"10s\"</span></span><br><span class=\"line\">  <span class=\"comment\"># read-buffer = 0                                        # udp读取buffer的大小，0表示使用操作系统提供的值，如果超过操作系统的默认配置则会出错。默认值：0</span></span><br><span class=\"line\">  <span class=\"comment\"># parse-multivalue-plugin = \"split\"                      # 两种处理方式split和join，split会分到不同的表中，join会将记录作为一个单独的记录处理。默认是split</span></span><br><span class=\"line\"><span class=\"comment\">### [opentsdb]</span></span><br><span class=\"line\">[[opentsdb]]</span><br><span class=\"line\">  <span class=\"comment\"># enabled = false                                        # 是否启用该模块，默认值 ：false</span></span><br><span class=\"line\">  <span class=\"comment\"># bind-address = \":4242\"                                 # 绑定地址，默认值：\":4242\"</span></span><br><span class=\"line\">  <span class=\"comment\"># database = \"opentsdb\"                                  # 默认数据库：\"opentsdb\"</span></span><br><span class=\"line\">  <span class=\"comment\"># retention-policy = \"\"                                  # 存储策略，无默认值</span></span><br><span class=\"line\">  <span class=\"comment\"># consistency-level = \"one\"                              # 一致性级别，默认值：\"one\"</span></span><br><span class=\"line\">  <span class=\"comment\"># tls-enabled = false                                    # 是否开启tls，默认值：false</span></span><br><span class=\"line\">  <span class=\"comment\"># certificate= \"/etc/ssl/influxdb.pem\"                   # 证书路径，默认值：\"/etc/ssl/influxdb.pem\"</span></span><br><span class=\"line\">  <span class=\"comment\"># log-point-errors = true                                # 出错时是否记录日志，默认值：true</span></span><br><span class=\"line\">  <span class=\"comment\"># batch-size = 1000                                      # 从缓存中批量获取数据的量，默认值：1000</span></span><br><span class=\"line\">  <span class=\"comment\"># batch-pending = 5                                      # 可能在内存中等待的批次的数量，默认值：5</span></span><br><span class=\"line\">  <span class=\"comment\"># batch-timeout = \"1s\"                                   # 即使没有达到缓冲区的限制，至少要刷新一下，默认值：\"1s\"</span></span><br><span class=\"line\"><span class=\"comment\">### [[udp]]</span></span><br><span class=\"line\">[[udp]]</span><br><span class=\"line\">  <span class=\"comment\"># enabled = false                                        # 是否启用该模块，默认值 ：false</span></span><br><span class=\"line\">  <span class=\"comment\"># bind-address = \":8089\"                                 # 绑定地址，默认值：\":8089\"</span></span><br><span class=\"line\">  <span class=\"comment\"># database = \"udp\"                                       # 数据库名称，默认值：\"udp\"</span></span><br><span class=\"line\">  <span class=\"comment\"># retention-policy = \"\"                                  # 存储策略，无默认值</span></span><br><span class=\"line\">  <span class=\"comment\"># precision = \"\"                                         # 接收点的时间点的精度(\"\" or \"n\", \"u\", \"ms\", \"s\", \"m\", \"h\")</span></span><br><span class=\"line\">  <span class=\"comment\"># batch-size = 5000                                      # 从缓存中批量获取数据的量，默认值：5000</span></span><br><span class=\"line\">  <span class=\"comment\"># batch-pending = 10                                     # 可能在内存中等待的批次的数量，默认值：10</span></span><br><span class=\"line\">  <span class=\"comment\"># batch-timeout = \"1s\"                                   # 即使没有达到缓冲区的限制，至少要刷新一下，默认值：\"1s\"</span></span><br><span class=\"line\">  <span class=\"comment\"># read-buffer = 0                                        # udp读取buffer的大小，0表示使用操作系统提供的值，如果超过操作系统的默认配置则会出错。 该配置的默认值：0　</span></span><br><span class=\"line\"><span class=\"comment\">### [continuous_queries]</span></span><br><span class=\"line\">[continuous_queries]</span><br><span class=\"line\">  <span class=\"comment\"># enabled = true                                         # 是否启用该模块，默认值 ：true</span></span><br><span class=\"line\">  <span class=\"comment\"># log-enabled = true                                     # 是否开启日志，默认值：true</span></span><br><span class=\"line\">  <span class=\"comment\"># query-stats-enabled = false                            # 控制查询是否被记录到自我监控数据存储中</span></span><br><span class=\"line\">  <span class=\"comment\"># run-interval = \"1s\"                                    # 时间间隔，默认值：\"1s\"</span></span><br><span class=\"line\"><span class=\"comment\">### [tls]</span></span><br><span class=\"line\">[tls]</span><br><span class=\"line\">  <span class=\"comment\"># ciphers = [</span></span><br><span class=\"line\">  <span class=\"comment\">#   \"TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305\",</span></span><br><span class=\"line\">  <span class=\"comment\">#   \"TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\",</span></span><br><span class=\"line\">  <span class=\"comment\"># ]</span></span><br><span class=\"line\">  <span class=\"comment\"># min-version = \"tls1.2\"</span></span><br><span class=\"line\">  <span class=\"comment\"># max-version = \"tls1.2\"</span></span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p><strong>手动后台启动 influxd 服务并指定其配置文件</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nohup ./influxd -config /etc/conf/influxdb.conf &gt; /var/<span class=\"built_in\">log</span>/influxdb.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure></p>\n<hr>\n<h2 id=\"0x03-Influxdb-1-x-常用Client的API库\"><a href=\"#0x03-Influxdb-1-x-常用Client的API库\" class=\"headerlink\" title=\"0x03 Influxdb 1.x 常用Client的API库\"></a>0x03 Influxdb 1.x 常用Client的API库</h2><h3 id=\"Python\"><a href=\"#Python\" class=\"headerlink\" title=\"Python\"></a>Python</h3><p><strong>influxdb 模块使用介绍</strong><br>描述: 使用 pip 安装 influxdb 模块 <code>pip install influxdb</code>。</p>\n<p>使用范例:<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> influxdb <span class=\"keyword\">import</span> InfluxDBClient</span><br><span class=\"line\">json_body = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"string\">\"measurement\"</span>: <span class=\"string\">\"meas01\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"tags\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"name\"</span>: <span class=\"string\">\"s1-2\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"addr\"</span>: <span class=\"string\">\"10-2\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">\"fields\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"id\"</span>: <span class=\"number\">2</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"string\">\"measurement\"</span>: <span class=\"string\">\"meas02\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"tags\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"name\"</span>: <span class=\"string\">\"s1-3\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"addr\"</span>: <span class=\"string\">\"10-3\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">\"fields\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"id\"</span>: <span class=\"number\">3</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\">client = InfluxDBClient(<span class=\"string\">'db.weiyigeek.top'</span>, <span class=\"number\">8086</span>, <span class=\"string\">'root'</span>, <span class=\"string\">'weiyigeek'</span>, <span class=\"string\">'mydb'</span>) <span class=\"comment\"># 初始化（指定要操作的数据库）</span></span><br><span class=\"line\">client.write_points(json_body) <span class=\"comment\"># 写入数据，同时创建表</span></span><br></pre></td></tr></table></figure></p>\n<hr>\n<h2 id=\"0x04-学习补充\"><a href=\"#0x04-学习补充\" class=\"headerlink\" title=\"0x04 学习补充\"></a>0x04 学习补充</h2><h3 id=\"InfluxDB-可视化工具-InfluxDBStudio\"><a href=\"#InfluxDB-可视化工具-InfluxDBStudio\" class=\"headerlink\" title=\"InfluxDB 可视化工具-InfluxDBStudio\"></a>InfluxDB 可视化工具-InfluxDBStudio</h3><p>描述: InfluxDB Studio 是用于InfluxDB时间序列数据库的UI管理工具, 它的灵感来自其他类似的数据库管理工具，如 <code>SQL Server management Studio</code> 和 <code>Robomongo</code> 为InfluxData公司提供支持, Net的可移植InfluxDB客户端库（加上一些Kapacitor支持）, Tips: 官网项目最后更新时间2017年11月。</p>\n<p>官方使用文档: <a href=\"https://github.com/CymaticLabs/InfluxDBStudio/#managing-connections\" target=\"_blank\" rel=\"noopener\">https://github.com/CymaticLabs/InfluxDBStudio/#managing-connections</a><br>下载链接: <a href=\"https://github.com/CymaticLabs/InfluxDBStudio/releases/download/v0.2.0-beta.1/InfluxDBStudio-0.2.0.zip\" target=\"_blank\" rel=\"noopener\">https://github.com/CymaticLabs/InfluxDBStudio/releases/download/v0.2.0-beta.1/InfluxDBStudio-0.2.0.zip</a></p>\n<p>InfluxDBStudio 连接字符串配置:<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220726165604.png\" alt=\"WeiyiGeek.influxDB Connection\" title=\"\" class=\"\">\n                <p>WeiyiGeek.influxDB Connection</p>\n            </figure></p>\n<p>InfluxDBStudio 进行指定数据库 measurement 名称的数据查询:<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> * <span class=\"keyword\">FROM</span> <span class=\"string\">\"events\"</span> <span class=\"keyword\">WHERE</span> <span class=\"built_in\">time</span> &lt; <span class=\"keyword\">now</span>() </span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"built_in\">time</span>,application,hit,<span class=\"keyword\">count</span>,<span class=\"keyword\">avg</span>,<span class=\"keyword\">transaction</span>,statut  <span class=\"keyword\">FROM</span> <span class=\"string\">\"jmeter\"</span> <span class=\"keyword\">WHERE</span> <span class=\"built_in\">time</span> &lt; <span class=\"keyword\">now</span>() - <span class=\"number\">5</span>m  <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> <span class=\"built_in\">time</span> <span class=\"keyword\">desc</span> tz(<span class=\"string\">'Asia/Shanghai'</span>)</span><br><span class=\"line\"><span class=\"comment\">-- time\tapplication\thit\tcount\tavg\ttransaction\tstatut</span></span><br><span class=\"line\"><span class=\"comment\">-- 2022/7/21 9:42\tindex\t15000\t15000\t32.42\tall\tall</span></span><br><span class=\"line\"><span class=\"comment\">-- 2022/7/21 9:33\tindex\t15000\t15000\t2.2\tall\tall</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220726165544.png\" alt=\"WeiyiGeek.influxDB Query Measurement\" title=\"\" class=\"\">\n                <p>WeiyiGeek.influxDB Query Measurement</p>\n            </figure></p>\n<hr>\n<h2 id=\"0x0n-入坑出坑\"><a href=\"#0x0n-入坑出坑\" class=\"headerlink\" title=\"0x0n 入坑出坑\"></a>0x0n 入坑出坑</h2>","comments":true,"excerpt":"[TOC]","categories":[{"name":"Database","path":"api/categories/Database.json"}],"tags":[{"name":"InfluxDB","path":"api/tags/InfluxDB.json"}]}