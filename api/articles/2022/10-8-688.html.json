{"title":"MobaXterm远程连接工具脆弱性","slug":"网安大类/Vulnerable/Appllication/远程连接/MobaXterm远程连接工具脆弱性","date":"2022-10-08T01:32:30.000Z","updated":"2022-10-13T08:26:38.804Z","url":"2022/10-8-688.html","path":"api/articles/2022/10-8-688.html.json","covers":["https://img.weiyigeek.top/2022/10/20221012090931.png","https://img.weiyigeek.top/2022/10/20221012180455.png","https://img.weiyigeek.top/2022/10/20221012093355.png","https://img.weiyigeek.top/2022/10/20221012100126.png","https://img.weiyigeek.top/2022/10/20221012104737.png","https://img.weiyigeek.top/2022/10/20221012214713.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"0x00-前言简述\"><a href=\"#0x00-前言简述\" class=\"headerlink\" title=\"0x00 前言简述\"></a>0x00 前言简述</h2><p><strong>什么是MobaXterm?</strong></p>\n<blockquote>\n<p>MobaX 术语是远程计算的终极工具箱, 适用于 Windows 的增强型终端，带有 X11 服务器、选项卡式 SSH 客户端、网络工具以及快速监控远程系统运行状况等<br>Enhanced terminal for Windows with X11 server, tabbed SSH client, network tools and much more</p>\n</blockquote>\n<p>官网地址: <a href=\"https://mobaxterm.mobatek.net/\" target=\"_blank\" rel=\"noopener\">https://mobaxterm.mobatek.net/</a></p>\n<p><strong>有什么用?</strong></p>\n<blockquote>\n<p>MobaXterm 提供了所有重要的远程网络工具（SSH，X11，RDP，VNC，FTP，MOSH等）和Unix命令（bash，ls，猫，sed，grep，awk，rsync等）到Windows桌面，在一个便携式exe文件中，开箱即用.</p>\n</blockquote>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2022/10/20221012090931.png\" alt=\"WeiyiGeek.MobaXterm图\" title=\"\" class=\"\">\n                <p>WeiyiGeek.MobaXterm图</p>\n            </figure>\n<p><strong>有那些主要特点?</strong></p>\n<ul>\n<li>嵌入式 X 服务器: 基于 X.org 的完全配置的 X 服务器</li>\n<li>轻松导出显示器 : 显示从远程 Unix 导出到本地窗口</li>\n<li>X11 转发功能: 您的远程显示器使用 SSH 实现安全传输</li>\n<li>带固态混合的选项卡式终端 : 基于 PuTTY，具有抗锯齿字体和宏支持</li>\n<li>视窗上的许多Unix/Linux命令 :基本 Cygwin 命令（bash, grep, awk, sed, rsync,……）</li>\n<li>附加组件和插件 :您可以使用插件扩展 MobaX 术语功能</li>\n<li>多功能会话管理器 :您的所有网络工具都在一个应用程序中：Rdp，Vnc，Ssh，Mosh，X11，…</li>\n<li>便携式轻便应用 : MobaXterm 已被打包为单个可执行文件，不需要管理员权限，您可以从 U 盘启动</li>\n<li>专业应用 : 专业版 MobaX 术语专为安全性和稳定性而设计</li>\n</ul>\n<p>MobaXterm 功能参考：[^features.html] </p>\n<p><strong>版本区别</strong></p>\n<ul>\n<li>Home Edition（家庭版）：免费,基本功能都有知识最多存储12 session、2条 ssh 隧道，4个宏的限制。</li>\n<li>Professional Edition （专业版）：永久$69, 包含家庭全部功能并且无会话限制以及无限数量的隧道和宏，并且可修改配置文件脚本和自定义启动消息和徽标，并且可以直接查看session存储的账号密码。 (花了钱的就是不一样)</li>\n</ul>\n<p>MobaXterm 版本下载地址: [^download.html] </p>\n<p><strong>插件列表与安装</strong><br>为了安装这些插件，只需下载它们并将它们放在与MobaXterm可执行文件相同的目录中即可。</p>\n<p>MobaXterm 插件下载地址: [^plugins.html]</p>\n<hr>\n<h2 id=\"0x01-使用总结\"><a href=\"#0x01-使用总结\" class=\"headerlink\" title=\"0x01 使用总结\"></a>0x01 使用总结</h2><h3 id=\"1-忘记-MobaXterm-主密码如何重置\"><a href=\"#1-忘记-MobaXterm-主密码如何重置\" class=\"headerlink\" title=\"1.忘记 MobaXterm 主密码如何重置?\"></a>1.忘记 MobaXterm 主密码如何重置?</h3><p>描述: 当 MobaXterm 从一台机器复制到另外一台机器上或者重新安装后，需要重新输入主密码（master password），如果此时忘记了则可使用官网提供的 ResetMasterPassword工具进行重置主密码 。</p>\n<p>密码重置工具: <a href=\"https://mobaxterm.mobatek.net/resetmasterpassword.html\" target=\"_blank\" rel=\"noopener\">https://mobaxterm.mobatek.net/resetmasterpassword.html</a></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2022/10/20221012180455.png\" alt=\"WeiyiGeek.使用ResetMasterPassword工具图\" title=\"\" class=\"\">\n                <p>WeiyiGeek.使用ResetMasterPassword工具图</p>\n            </figure>\n<p>温馨提示：如果你重新设置你的主控密码使用这个工具，所有你的连接密码之前保存在MobaXterm将会丢失。 </p>\n<hr>\n<h2 id=\"0x02-脆弱性一览\"><a href=\"#0x02-脆弱性一览\" class=\"headerlink\" title=\"0x02 脆弱性一览\"></a>0x02 脆弱性一览</h2><h3 id=\"1-如何查看MobaXterm中存储的Session密码\"><a href=\"#1-如何查看MobaXterm中存储的Session密码\" class=\"headerlink\" title=\"1.如何查看MobaXterm中存储的Session密码\"></a>1.如何查看MobaXterm中存储的Session密码</h3><p>描述: 今天在登录某个服务器时，发现当时修改的某个服务器的密码，无法登陆到服务器(应该是自己修改的密码记错了)，然而我想起当时修改密码时是使用的MobaxTerm，并且记录了其会话密码，我便开心的以为我找到突破口，好在结果是可以登录的，然后我就想查看其存储密码，发现家庭版本居然不能查看保存的明文密码，坑呀.</p>\n<p>在工作中为了方便登录会存储session账户密码，但时间一久就会忘记，如果没有备份密码，此时再想查看密码还真是件麻烦事, 遂有了此篇文章。</p>\n<p><strong>MobaXterm忘记Session密码,如何查看已保存的密码?</strong></p>\n<blockquote>\n<p>通常情况下游两种方式，一种是将其版本升级到 <code>MobaXterm professional Edition</code> 直接查看存储的session密码（No money）, 另外一种是针对家庭版使用基于python的开源工具反向解析密码.</p>\n</blockquote>\n<ul>\n<li>方式1.专业版查看存储的 session 密码, 注意家庭版是不可以使用此方法，必须进行升级</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2022/10/20221012093355.png\" alt=\"WeiyiGeek.MobaXterm professional Edition 图\" title=\"\" class=\"\">\n                <p>WeiyiGeek.MobaXterm professional Edition 图</p>\n            </figure>\n<ul>\n<li>方式2.使用 how-does-MobaXterm-encrypt-password 开源工具反向解析密码。<blockquote>\n<p>项目地址: <a href=\"https://github.com/HyperSine/how-does-MobaXterm-encrypt-password\" target=\"_blank\" rel=\"noopener\">https://github.com/HyperSine/how-does-MobaXterm-encrypt-password</a><br>fork 修改代码后的地址（推荐，不是还有进行修改代码）: <a href=\"https://github.com/WeiyiGeek/how-does-MobaXterm-encrypt-password\" target=\"_blank\" rel=\"noopener\">https://github.com/WeiyiGeek/how-does-MobaXterm-encrypt-password</a></p>\n</blockquote>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.拉取项目</span></span><br><span class=\"line\">WeiyiGeek@WeiyiGeek MINGW64 ~/Downloads</span><br><span class=\"line\">$ git <span class=\"built_in\">clone</span> https://github.com/WeiyiGeek/how-does-MobaXterm-encrypt-password.git</span><br><span class=\"line\">$ ls</span><br><span class=\"line\">MobaXtermCipher.py</span><br><span class=\"line\">ShowMobaXterm.py</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.安装环境依赖</span></span><br><span class=\"line\"><span class=\"comment\"># 例如，在CentOS上安装 Python3 以及 开源工具依赖模块（此处由于我是Windows的，Python环境都已经配置号楼的，所以我只安装相关依赖模块）</span></span><br><span class=\"line\">yum install -y git</span><br><span class=\"line\">yum install python3</span><br><span class=\"line\">yum install python3-pip</span><br><span class=\"line\">pip3 install pycryto</span><br><span class=\"line\"><span class=\"comment\"># 上一个命令有可能会出错，请使用这个命令</span></span><br><span class=\"line\">pip3 install pycryptodome</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 3.如果密码是存储在文件中, 可以找到 MobaXterm 安装目录下 MobaXterm.ini 文件，打开后找到Passwords模块，显示格式为: 登录名@ip=加密密码</span></span><br><span class=\"line\">$ dir D:\\Program Files\\MobaXterm</span><br><span class=\"line\">CygUtils.plugin        MobaXterm.ini  MobaXterm_Personal_20.1.exe</span><br><span class=\"line\">MobaXterm\\ backup.zip  MobaXterm.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.如果密码是存储在计算机密码中，可以查看如下【 计算机\\HKEY_CURRENT_USER\\SOFTWARE\\Mobatek\\MobaXterm】下的三个注册表地址。</span></span><br><span class=\"line\">&gt; regedit  <span class=\"comment\"># 打开注册表</span></span><br><span class=\"line\">HKEY_CURRENT_USER\\SOFTWARE\\Mobatek\\MobaXterm\\C  <span class=\"comment\"># 存储的自己创建认证票据</span></span><br><span class=\"line\">HKEY_CURRENT_USER\\SOFTWARE\\Mobatek\\MobaXterm\\M  <span class=\"comment\"># 存储的Master管理员密码(以经过加密的)</span></span><br><span class=\"line\">HKEY_CURRENT_USER\\SOFTWARE\\Mobatek\\MobaXterm\\P  <span class=\"comment\"># 存储了使用过程中记录的session会话IP端口，账号密码信息</span></span><br><span class=\"line\"><span class=\"comment\"># 例如，存储 session 会话信息格式</span></span><br><span class=\"line\"><span class=\"comment\"># Name             Type        Data</span></span><br><span class=\"line\"><span class=\"comment\"># example.com      REG_SZ      root:0XROpGmLAYVx</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 数值名称 ：weiyigeek@10.0.30.70</span></span><br><span class=\"line\"><span class=\"comment\"># 数据类型 ：REG_SZ</span></span><br><span class=\"line\"><span class=\"comment\"># 数据值 ：7FzQQ12lpX7g2s8O39zquyQ=</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5.也可以采用PowerShell命令进行查看</span></span><br><span class=\"line\">Get-Item <span class=\"string\">'HKCU:\\SOFTWARE\\Mobatek\\MobaXterm\\'</span></span><br><span class=\"line\"><span class=\"comment\"># 获取 SessionP 值</span></span><br><span class=\"line\">(Get-ItemProperty <span class=\"string\">'HKCU:\\SOFTWARE\\Mobatek\\MobaXterm\\'</span>).SessionP</span><br><span class=\"line\">2493068723790</span><br><span class=\"line\"><span class=\"comment\"># Master/自创建的服务器账号密码/session会话记录的账号密码</span></span><br><span class=\"line\">Get-ItemProperty <span class=\"string\">'HKCU:\\SOFTWARE\\Mobatek\\MobaXterm\\m'</span></span><br><span class=\"line\">Get-ItemProperty <span class=\"string\">'HKCU:\\SOFTWARE\\Mobatek\\MobaXterm\\c'</span></span><br><span class=\"line\">Get-ItemProperty <span class=\"string\">'HKCU:\\SOFTWARE\\Mobatek\\MobaXterm\\p'</span></span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2022/10/20221012100126.png\" alt=\"WeiyiGeek.MobaXterm注册表图\" title=\"\" class=\"\">\n                <p>WeiyiGeek.MobaXterm注册表图</p>\n            </figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 6.开源工具的使用帮助</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> how-does-MobaXterm-encrypt-password</span><br><span class=\"line\">MobaXtermCipher.py &lt;enc|dec&gt; &lt;-sp SessionP&gt; &lt;plaintext|ciphertext&gt;</span><br><span class=\"line\">MobaXtermCipher.py &lt;enc|dec&gt; &lt;-p master_password&gt; &lt;plaintext|ciphertext&gt;</span><br><span class=\"line\">&lt;-sp SessionP&gt;           The value `SessionP` stored <span class=\"keyword\">in</span> key HKCU\\Software\\Mobatek\\MobaXterm</span><br><span class=\"line\">&lt;-p master_password&gt;     The master password <span class=\"built_in\">set</span> <span class=\"keyword\">in</span> MobaXterm.</span><br><span class=\"line\">&lt;plaintext|ciphertext&gt;   Plaintext string or ciphertext string.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在已知道自己设置Master密码的情况下可直接(此处假设我的 master密码是 weiyigeek)，将 plaintext|ciphertext 接到 -p 指定 master密码参数后。</span></span><br><span class=\"line\">&gt; python MobaXtermCipher.py dec -p weiyigeek 8wCf+h+v2OpB0IrTPg==</span><br><span class=\"line\">Hlwdmm94bngsn</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用 SessionP 加密解密</span></span><br><span class=\"line\">C:\\Users\\WeiyiGeek\\Downloads\\how-does-MobaXterm-encrypt-password\\python3&gt;python MobaXtermCipher.py enc -sp 2493068723790 weiyigeek</span><br><span class=\"line\">31RwmZeeGndNigeRo0cud++YU8tNF8MTbZcoA3l3ThUnK</span><br><span class=\"line\">C:\\Users\\WeiyiGeek\\Downloads\\how-does-MobaXterm-encrypt-password\\python3&gt;python MobaXtermCipher.py dec -sp 2493068723790 31RwmZeeGndNigeRo0cud++YU8tNF8MTbZcoA3l3ThUnK</span><br><span class=\"line\">weiyigeek</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ShowMobaXterm.py: 所有凭据和密码都可以通过 (注意该脚本只能在 Windows 上运行)</span></span><br><span class=\"line\">python ShowMobaXterm.py</span><br><span class=\"line\">python ShowMobaXterm.py weiyigeek</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2022/10/20221012104737.png\" alt=\"WeiyiGeek.ShowMobaXterm.py 图\" title=\"\" class=\"\">\n                <p>WeiyiGeek.ShowMobaXterm.py 图</p>\n            </figure>\n<p>官方参考地址：<a href=\"https://github.com/HyperSine/how-does-MobaXterm-encrypt-password#3-example\" target=\"_blank\" rel=\"noopener\">https://github.com/HyperSine/how-does-MobaXterm-encrypt-password#3-example</a></p>\n<p>温馨提示：如果在执行 <code>python ShowMobaXterm.py weiyigeek</code> 出现如下错误时，请将第 232 与 231 行的  <code>ConnHostname.encode(&#39;ansi&#39;),  ConnUsername.encode(&#39;ansi&#39;)</code> 删除，如果存储编码错误提示请将 encode 中 ansi 参数变成 uft8编码。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-------------------Passwords--------------------</span><br><span class=\"line\">Traceback (most recent call last):</span><br><span class=\"line\">  File <span class=\"string\">\"ShowMobaXterm.py\"</span>, line 232, <span class=\"keyword\">in</span> &lt;module&gt;</span><br><span class=\"line\">    ConnUsername.encode(<span class=\"string\">'ansi'</span>)</span><br><span class=\"line\">TypeError: DecryptPassword() takes 2 positional arguments but 4 were given</span><br></pre></td></tr></table></figure>\n<p>解决办法：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ShowMobaXterm.py 中的 229 行</span></span><br><span class=\"line\">ConnPassword = cipher.DecryptPassword(</span><br><span class=\"line\">  Value</span><br><span class=\"line\">).decode(<span class=\"string\">\"utf8\"</span>,<span class=\"string\">\"ignore\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 如果有中文编码</span></span><br><span class=\"line\">encode(<span class=\"string\">'ansi'</span>) =&gt; decode(<span class=\"string\">\"utf8\"</span>,<span class=\"string\">\"ignore\"</span>)</span><br></pre></td></tr></table></figure></p>\n<p>然后顺手提交了一个 PR。</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2022/10/20221012214713.png\" alt=\"WeiyiGeek.在源项目中查看提交的PR图\" title=\"\" class=\"\">\n                <p>WeiyiGeek.在源项目中查看提交的PR图</p>\n            </figure>\n<p>[^features.html]: MobaXterm 功能参考 : <a href=\"https://mobaxterm.mobatek.net/features.html\" target=\"_blank\" rel=\"noopener\">https://mobaxterm.mobatek.net/features.html</a><br>[^download.html]: MobaXterm 版本下载地址 : <a href=\"https://mobaxterm.mobatek.net/download.html\" target=\"_blank\" rel=\"noopener\">https://mobaxterm.mobatek.net/download.html</a><br>[^plugins.html]:  MobaXterm 插件下载地址 : <a href=\"https://mobaxterm.mobatek.net/plugins.html\" target=\"_blank\" rel=\"noopener\">https://mobaxterm.mobatek.net/plugins.html</a> </p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Vulnerable","path":"api/categories/Vulnerable.json"},{"name":"Security","path":"api/categories/Security.json"}],"tags":[{"name":"MobaXterm","path":"api/tags/MobaXterm.json"}]}