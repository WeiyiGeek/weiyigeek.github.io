<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>🌐 8.Go编程快速入门学习|WeiyiGeek Blog|唯一极客Geek-IT网络安全运维开发技术知识分享-博客站点</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Go">
    <meta name="Description" content="WeiyiGeek-唯一极客博客站点,关注于网络安全运维,Web安全开发,IOT物联网安全开发,应用开发,分享技术学习知识与入坑解决,提升网络安全技术与自身技术能力,立志维护大众网络安全为己任,做一个对国家有用的人,为实现中华民族伟大复兴的中国梦不懈奋斗">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-头像">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                首页
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                文章分类
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                文章标签
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                文章归档
              </a>
            </li>
        
            <li class="">
              <a href="/2018/1-1-1.html"  >
                <i class="icon icon-lg icon-mortar-board"></i>
                学习之路
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                学习书籍
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                关于作者
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                站点导航
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                公众账号
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                哔哩哔哩
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>8.Go编程快速入门学习</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="文章头部背景">
    <div class="container fade-scale">
        <h1 class="title">8.Go编程快速入门学习</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-04-24T03:16:58.000Z" itemprop="datePublished" class="page-time">
  2020-04-24
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/">Development</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/Programming/">Programming</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
  <article id="post-编程世界/Go/8.Go编程快速入门学习"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">8.Go编程快速入门学习</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-04-24 11:16:58" datetime="2020-04-24T03:16:58.000Z"  itemprop="datePublished">2020-04-24</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/">Development</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/Programming/">Programming</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="0x00-Go语言基础之Socket网络编程"><a href="#0x00-Go语言基础之Socket网络编程" class="headerlink" title="0x00 Go语言基础之Socket网络编程"></a>0x00 Go语言基础之Socket网络编程</h2><p>现在的我们几乎每天都在使用互联网，但是你知道程序是如果通过网络互相通信吗？<br>描述: 相信大部分人通常是一知半解的，作为一个程序员👨‍💻‍，对于网络模型你应该了解，知道网络到底是怎么进行通信的，进行工作的，为什么服务器能够接收到请求，做出响应。这里面的原理应该是每个 Web 程序员应该了解的。</p>
<p>本章我们就一起来学习下Go语言中的网络编程，关于网络编程其实是一个很庞大的领域，本文只是简单的演示了如何使用net包进行TCP和UDP通信。</p>
<h3 id="1-基础概念介绍"><a href="#1-基础概念介绍" class="headerlink" title="1.基础概念介绍"></a>1.基础概念介绍</h3><p>描述: 互联网的核心是一系列协议，总称为<code>互联网协议(Internet Protocol Suite)</code>，正是这一些协议规定了电脑如何连接和组网，并通过各种协议实现不同的功能, 下面简单介绍一些协议涉及的基础知识概念。</p>
<p>此处不得不老生重谈<code>OSI七层网络模型</code> ，OSI是国际标准化组织 1984 提出的模型标准，简称 OSI(Open Systems Interconnection Model)，主要统一标准来规范网络协议让各个硬件厂商可以协同工作，相信如果你学习过网络工程或者操作系统方面的课程至少你是了解它的。每一层都有自己的功能，就像建筑物一样，每一层都靠下一层支持，通常用户接触到的只是最上面的那一层。</p>
<figure class="image-box">
                <a rel=8.Go编程快速入门学习 href="https://img.weiyigeek.top/2021/5/20211119224548.png" target="_blank" title="WeiyiGeek.OSI七层网络与TCP/IP四层网络模型" data-fancybox="images"><img src="https://img.weiyigeek.top/2021/5/20211119224548.png" alt="WeiyiGeek.OSI七层网络与TCP/IP四层网络模型" title="" class=""></a>
                <p>WeiyiGeek.OSI七层网络与TCP/IP四层网络模型</p>
            </figure>
<p>如上图所示按照不同的模型划分会有不用的分层，但是不论按照什么模型去划分，越往上的层越靠近用户，越往下的层越靠近硬件，在软件开发中我们使用最多的是上图中将互联网划分为五个分层的模型，即<code>应用层、传输层、网络层、数据链路层、物理层</code>。</p>
<p>下面简单介绍各层: (如有兴趣想深入学习的可以自行Google)</p>
<ul>
<li><p>(1) 物理层 : 即通过我们计算机或其它设备通过网络硬件与外界互联网通信，它主要规定了网络的一些电气特性，作用是负责传送0和1的电信号(比特流)。</p>
<blockquote>
<p>例如： 以太网、无线Lan、PPP、双绞线、光纤、无线。</p>
</blockquote>
</li>
<li><p>(2) 数据链路层 : 确定了物理层传输的0和1的分组方式及代表的意义, 通过以太网(Ethernet)的协议规定一组电信号构成一个数据包，叫做<code>帧</code>(Frame)。</p>
<blockquote>
<p>每一帧分成两个部分：标头(Head)和数据(Data)<br>Head : 包含数据包的一些说明项，比如发送者<code>(MAC地址)</code>、接受者<code>(MAC地址)</code>、数据类型等等；(<code>其长度固定为18字节</code>)<br>Data : 则是数据包的具体内容。(<code>其长度，最短为46字节，最长为1500字节</code>)<br>Tips: 因此整个<code>帧</code>最短为64字节，最长为1518字节, 所以如果数据很长就必须分割成多个帧进行发送。</p>
</blockquote>
</li>
</ul>
<p><br/></p>
<ul>
<li>(3) 网络层 : 使得我们能够区分不同的计算机是否属于同一个子网络(子网)，该地址就叫做<code>网络地址</code>(即IP地址)，此时每台计算机有了两种地址，一种是MAC地址(硬件网卡唯一标识)，另一种是IP地址。<blockquote>
<p>IP地址: 则是网络管理员分配的，它可以帮助我们确定计算机所在的子网络，MAC地址则将数据包送到该子网络中的目标网卡。<br>根据IP协议发送的数据就叫做<code>IP数据包</code>，IP数据包也分为<code>标头</code>和<code>数据</code>两个部分：<br><code>标头</code>部分主要包括版本、长度、IP地址等信息(<code>长度为20到60字节</code>)<br><code>数据</code>部分则是IP数据包的具体内容，整个数据包的<code>总长度最大为65535字节</code>。</p>
</blockquote>
</li>
</ul>
<p><br/></p>
<ul>
<li>(4) 传输层 : 有了上述的MAC地址和IP地址可以就可以在互联网上任意两台主机上建立通信。但是如果是要与主机上某一程序进行通信我们还需要一个<code>端口</code>(Port)，从而便可以让两个程序通过网络进行收发数据。<blockquote>
<p>IP和端口我们就能实现唯一确定互联网上一个程序，进而实现网络间的程序通信, 此外可以选择常用的TCP或者UDP协议进行通信。<br><code>端口</code>: 是0到65535之间的一个整数，正好16个二进制位。0到1023的端口被系统占用，用户只能选用大于1023的端口<br>TCP (<code>Transmission Control Protocol</code>): 面向连接的、可靠的、基于字节流的传输层通信协议(<code>经过三次握手四层挥手</code>)，由IETF的RFC 793定义，TCP数据包没有长度限制，理论上可以无限长，但是为了保证网络的效率，通常TCP数据包的长度不会超过IP数据包的长度，以确保单个TCP数据包不必再分割。 (<code>主要用于对通信的信息比较重要的场景</code>)<br>UDP (<code>User Datagram Protocol</code>) : 为应用程序提供了一种无需建立连接就可以发送封装的 IP 数据包的方法,我们可以持续的发送信息但并不关心其是否正常到达, 由IETF的 RFC 768 定义, 其数据包非常简单，”标头”部分一共只有8个字节，总长度不超过65,535字节，正好放进一个IP数据包。(<code>主要用于视屏直播流、非实时性的控制指令发送的场景</code>)</p>
</blockquote>
</li>
</ul>
<p><br/></p>
<ul>
<li>(5) 应用层 : ”应用层”的作用就是规定应用程序使用的数据格式，由于互联网是开放架构，数据来源五花八门，必须事先规定好通信的数据格式，否则接收方根本无法获得真正发送的数据内容。<blockquote>
<p>例如: 我们TCP协议之上常见的Email、HTTP、FTP等协议，这些协议就组成了互联网协议的应用层。</p>
</blockquote>
</li>
</ul>
<p>如下图所示，发送方的HTTP数据经过互联网的传输过程中会依次添加各层协议的标头信息，接收方收到数据包之后再依次根据协议解包得到数据。</p>
<figure class="image-box">
                <a rel=8.Go编程快速入门学习 href="https://img.weiyigeek.top/2021/5/20211119233946.png" target="_blank" title="WeiyiGeek.一张解释互联网的传输过程的图" data-fancybox="images"><img src="https://img.weiyigeek.top/2021/5/20211119233946.png" alt="WeiyiGeek.一张解释互联网的传输过程的图" title="" class=""></a>
                <p>WeiyiGeek.一张解释互联网的传输过程的图</p>
            </figure>
<p><br/></p>
<p><strong>知识扩展</strong></p>
<p><em>Q:那么，发送者和接受者是如何标识呢？</em><br>答: 以太网规定，连入网络的所有设备都必须具有<code>网卡</code>接口。数据包必须是从一块网卡，传送到另一块网卡。网卡的地址，就是数据包的发送地址和接收地址，这叫做MAC地址。每块网卡出厂的时候，都有一个全世界独一无二的MAC地址，长度是48个二进制位，通常用12个十六进制数表示例如<code>00-FF-81-D5-15-F8</code>。<code>前6个十六进制数是厂商编号，后6个是该厂商的网卡流水号</code>, 此时有了MAC地址就可以定位网卡和数据包的路径了。</p>
<p><br></p>
<p><em>Q: 有了MAC地址之后，如何把数据准确的发送给接收方呢？</em><br>描述: 首先通过ARP协议来获取接受方的MAC地址, 然后通过<code>广播</code>(broadcasting)的方式，向本网络内所有计算机都发送，让每台计算机读取这个包的<code>标头</code>，找到接收方的MAC地址，然后与自身的MAC地址相比较，如果两者相同就接受这个包，做进一步处理，否则就丢弃这个包。</p>
<p><em>Q: 网络地址的协议?</em><br>描述: 规定网络地址的协议叫做IP协议,目前，广泛采用的是IP协议第四版，简称IPv4。IPv4这个版本规定，网络地址由32个二进制位组成，我们通常习惯用分成四段的十进制数表示IP地址，从<code>0.0.0.0~255.255.255.255</code>，当然里面包含三个私有网段，以及保留的网段，此处不细讲知道即可。</p>
<p><br/></p>
<h3 id="2-Socket-基础介绍"><a href="#2-Socket-基础介绍" class="headerlink" title="2.Socket 基础介绍"></a>2.Socket 基础介绍</h3><p>其实学习其它开发语言你将会发现, 基本高级语言中都有专门进行网络通信的包来提供两个程序的网络通信, 通常针对程序网络通信的开发都描述为Socket编程。</p>
<p><strong>Q: 什么是Socket编程?</strong><br>描述: Socket(<code>也称作”套接字”</code>)是<code>BSD UNIX</code>的进程通信机制，用于描述IP地址和端口是一个通信链的句柄,<code>Socket可理解为TCP/IP网络的API</code>，它定义了许多函数或例程，程序员可以用它们来开发TCP/IP网络上的应用程序，所以在我们计算机运行的应用程序通常通过<code>&quot;套接字&quot;</code>向网络发出请求或者应答网络请求。</p>
<p>Socket 是<code>应用层</code>与<code>传输层(TCP/IP协议族)</code>通信的中间软件抽象层，在设计模式中Socket其实就是一个门面模式，它把复杂的TCP/IP协议族隐藏在Socket后面，对用户来说只需要调用Socket规定的相关函数，让Socket去组织符合指定的协议数据然后进行通信。</p>
<figure class="image-box">
                <a rel=8.Go编程快速入门学习 href="https://img.weiyigeek.top/2021/5/20211120144527.png" target="_blank" title="WeiyiGeek.Socket图解" data-fancybox="images"><img src="https://img.weiyigeek.top/2021/5/20211120144527.png" alt="WeiyiGeek.Socket图解" title="" class=""></a>
                <p>WeiyiGeek.Socket图解</p>
            </figure>
<p><br/></p>
<h3 id="3-Go实现C-S端TCP通信"><a href="#3-Go实现C-S端TCP通信" class="headerlink" title="3.Go实现C/S端TCP通信"></a>3.Go实现C/S端TCP通信</h3><p>描述: TCP/IP<code>(Transmission Control Protocol/Internet Protocol)</code>即传输控制协议/网间协议，是一种面向连接<code>(连接导向)</code>的、可靠的、基于字节流的传输层<code>(Transport layer)</code>通信协议，因为是面向连接的协议，数据像水流一样传输，但它会存在黏包问题(将会在后续演示解决方案)。</p>
<h4 id="1-TCP-服务端"><a href="#1-TCP-服务端" class="headerlink" title="1) TCP 服务端"></a>1) TCP 服务端</h4><p>描述: 通常一个TCP服务端可以同时连接很多个客户端，例如世界各地的用户使用自己电脑上的浏览器访问淘宝网、京东商城。</p>
<p>由于Go语言中创建多个goroutine实现并发非常方便和高效，所以我们可以每建立一次链接就创建一个goroutine去处理。</p>
<p><strong>TCP服务端程序常规流程：</strong><br>1.设置监听网络地址与端口<br>2.接收客户端请求建立链接<br>3.创建goroutine处理链接</p>
<p><br/></p>
<p>在Go语言中的可以采用net包来实现的TCP服务端的创建,下述罗列出net包中使用的相关方法原型:</p>
<ul>
<li><code>func net.Listen(network string, address string) (net.Listener, error)</code> : 指定通信协议类型版本、本地网络地址和通信端口进行监听,注意 network参数值必须是<code>“tcp”、“tcp4”、“tcp6”、“unix”或“unixpacket”</code>之一。</li>
<li><code>func (net.Listener).Accept() (net.Conn, error)</code> : 等待Listener对象并返回到侦听器的下一个连接。</li>
<li><code>func (net.Conn).Read(b []byte) (n int, err error)</code> : 从服务端或者客户端连接中读取数据。</li>
</ul>
<p><br></p>
<h4 id="2-TCP-客户端"><a href="#2-TCP-客户端" class="headerlink" title="2) TCP 客户端"></a>2) TCP 客户端</h4><p>TCP客户端进行TCP通信的流程大致如下：<br>1.与服务端的建立链接<br>2.与服务端进行数据收发<br>3.关闭与服务端的链接</p>
<p>下述罗列出net包中Tcp客户端创建使用的相关方法原型:</p>
<ul>
<li><code>func net.Dial(network string, address string) (net.Conn, error)</code> : 客户端连接到指定网络上的地址, 同样 networks 参数可选值如下<code>&quot;tcp&quot;, &quot;tcp4&quot; (IPv4-only), &quot;tcp6&quot; (IPv6-only), &quot;udp&quot;, &quot;udp4&quot; (IPv4-only), &quot;udp6&quot; (IPv6-only), &quot;ip&quot;, &quot;ip4&quot; (IPv4-only), &quot;ip6&quot; (IPv6-only), &quot;unix&quot;, &quot;unixgram&quot; and &quot;unixpacket&quot;</code>.</li>
<li><code>func (net.Conn).Write(b []byte) (n int, err error)</code> : 写入将数据写入连接即发送给连接的网络对象，并返回发送的字节数。（注意中文字符占3字节）</li>
<li><code>func (net.Conn).LocalAddr() net.Addr</code> : 获取本地客户端连接到服务端的网络地址信息。</li>
</ul>
<p><br></p>
<p><strong>简单示例1:TCP Server端与Client端一次通信。</strong><br>服务端: Server.go<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1.设置服务端监听端口</span></span><br><span class="line">  address := <span class="string">"10.20.172.108:22022"</span></span><br><span class="line">  listener, err := net.Listen(<span class="string">"tcp"</span>, address)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Start Tcp Server on %v Failed!\nerr：%v\n"</span>, address, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Server Listen : %v\n"</span>, address)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.等待客户端建立连接</span></span><br><span class="line">  conn, err := listener.Accept()</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Accept failed,err: %v\n"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">defer</span> conn.Close() <span class="comment">// 程序结束时,关闭与客户端打开的TCP连接通道</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.与客户端进行消息通信(读取客户端法过来的信息)</span></span><br><span class="line">  <span class="keyword">var</span> msg [<span class="number">1024</span>]<span class="keyword">byte</span></span><br><span class="line">  n, err := conn.Read(msg[:]) <span class="comment">// 注意读取的类型是byte的slice</span></span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Read from Client conn failed, err:%v\n"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4.打印客户端发送的信息,注意此需要将[]byte类型的切片,转为字符串类型进行输出.</span></span><br><span class="line">  fmt.Println(<span class="keyword">string</span>(msg[:n]))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>客户端: Client.go<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1.与Server端建立TCP通信链接</span></span><br><span class="line">  address := <span class="string">"10.20.172.108:22022"</span></span><br><span class="line">  conn, err := net.Dial(<span class="string">"tcp"</span>, address)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Connect Server failed!\nerr:%v\n"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.发送字符串数据到Server端</span></span><br><span class="line">  sendMsg := <span class="string">"Hello World! Server, I'm client"</span></span><br><span class="line">  conn.Write([]<span class="keyword">byte</span>(sendMsg))</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.关闭建立的TCP通信链接</span></span><br><span class="line">  <span class="keyword">defer</span> conn.Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>将上面的代码保存之后分别编译成server和client可执行文件,具体操作如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  Server go build</span><br><span class="line">➜  Server ./Server</span><br><span class="line">Server Listen : 10.20.172.108:22022  </span><br><span class="line"></span><br><span class="line">➜  Client go build</span><br><span class="line">➜  Client ./Client</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=8.Go编程快速入门学习 href="https://img.weiyigeek.top/2021/5/20211120152604.png" target="_blank" title="WeiyiGeek.简单示例1执行结果" data-fancybox="images"><img src="https://img.weiyigeek.top/2021/5/20211120152604.png" alt="WeiyiGeek.简单示例1执行结果" title="" class=""></a>
                <p>WeiyiGeek.简单示例1执行结果</p>
            </figure>
<p><br></p>
<p><strong>进阶示例2: TCP Server端与多个Client端持续通信。</strong><br>Server.go<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"bufio"</span></span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"io"</span></span><br><span class="line">  <span class="string">"net"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SendReceiveProccess</span><span class="params">(conn net.Conn)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 3.与客户端进行消息通信(循环读取客户端法过来的信息)</span></span><br><span class="line">  <span class="keyword">defer</span> conn.Close() <span class="comment">// 关闭当前链接通信对象</span></span><br><span class="line">  reader := bufio.NewReader(conn)</span><br><span class="line">  <span class="keyword">var</span> msg [<span class="number">1024</span>]<span class="keyword">byte</span> <span class="comment">// 每次读取1024B</span></span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    n, err := reader.Read(msg[:]) <span class="comment">// 注意读取的类型是byte的slice</span></span><br><span class="line">    <span class="comment">// 末尾标识</span></span><br><span class="line">    <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">      fmt.Printf(<span class="string">"Close conn %v\n"</span>, conn.RemoteAddr())</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 异常时break</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">"Read from Client conn failed, Close conn %v\n"</span>, conn.RemoteAddr())</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(conn.RemoteAddr(), <span class="string">"-&gt;"</span>, <span class="keyword">string</span>(msg[:n]))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将客户端发送的信息又转发给客户端(返回写入的字节数)</span></span><br><span class="line">    _, err = conn.Write([]<span class="keyword">byte</span>(msg[:n]))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">"Send failed, Close Client conn %v\n"</span>, conn.RemoteAddr())</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1.设置监听端口</span></span><br><span class="line">  address := <span class="string">"10.20.172.108:22022"</span></span><br><span class="line">  listener, err := net.Listen(<span class="string">"tcp"</span>, address)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Start Tcp Server on %v Failed!\nerr：%v\n"</span>, address, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Server Listen %v Start......\n"</span>, address)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">defer</span> listener.Close() <span class="comment">// 关闭服务端监听</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.等待客户端建立连接</span></span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    conn, err := listener.Accept()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">"Accept failed,err: %v\n"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 不同的客户端利用Goroutine分配不同的线程进行响应。</span></span><br><span class="line">    <span class="keyword">go</span> SendReceiveProccess(conn)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>Client.go<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"bufio"</span></span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"net"</span></span><br><span class="line">  <span class="string">"os"</span></span><br><span class="line">  <span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1.与Server端建立TCP链接</span></span><br><span class="line">  address := <span class="string">"10.20.172.108:22022"</span></span><br><span class="line">  conn, err := net.Dial(<span class="string">"tcp"</span>, address)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Connect Server failed! \n [err]: %v\n"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Connect Server %v successful!\n"</span>, address)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 退出通信连接</span></span><br><span class="line">  <span class="keyword">defer</span> conn.Close()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.发送初始连接信息到Server端</span></span><br><span class="line">  sendMsg := fmt.Sprintf(<span class="string">"Hello Server, I'm  %v client."</span>, conn.LocalAddr())</span><br><span class="line">  inputReader := bufio.NewReader(os.Stdin) <span class="comment">// 复习点</span></span><br><span class="line">  conn.Write([]<span class="keyword">byte</span>(sendMsg))</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.循环从服务端接收以及从终端输入发送信息到服务端</span></span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    <span class="comment">// 服务端回复的信息</span></span><br><span class="line">    reply := [<span class="number">1024</span>]<span class="keyword">byte</span>&#123;&#125;</span><br><span class="line">    n, err := conn.Read(reply[:])</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"recv failed, err:"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">"Server &gt; %v\n"</span>, <span class="keyword">string</span>(reply[:n]))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 客户端输入字符串信息</span></span><br><span class="line">    fmt.Printf(<span class="string">"请输入消息:"</span>)</span><br><span class="line">    sendMsg, _ = inputReader.ReadString(<span class="string">'\n'</span>) <span class="comment">// 复习点 (以\n截至读取)</span></span><br><span class="line">    sendMsg = strings.TrimSpace(sendMsg)      <span class="comment">// 复习点 处理输入字符串的前后空格</span></span><br><span class="line">    sendMsg = strings.Trim(sendMsg, <span class="string">"\n"</span>)     <span class="comment">// 复习点 处理输入字符串的最后的换行符</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 但客户端输入quit则退出与服务端建立的TCP通信连接.</span></span><br><span class="line">    <span class="keyword">if</span> strings.ToUpper(sendMsg) == <span class="string">"QUIT"</span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">"exit conn......."</span>)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送已经处理过后的信息到服务端</span></span><br><span class="line">    _, err = conn.Write([]<span class="keyword">byte</span>(sendMsg))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>Server.go与Client.go编译&amp;运行&amp;执行结果:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> build &amp;&amp; ./Server</span><br><span class="line"><span class="keyword">go</span> build &amp;&amp; ./Client</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=8.Go编程快速入门学习 href="https://img.weiyigeek.top/2021/5/20211120160517.png" target="_blank" title="WeiyiGeek.进阶示例2执行结果" data-fancybox="images"><img src="https://img.weiyigeek.top/2021/5/20211120160517.png" alt="WeiyiGeek.进阶示例2执行结果" title="" class=""></a>
                <p>WeiyiGeek.进阶示例2执行结果</p>
            </figure></p>
<p><br/></p>
<h3 id="4-Go实现C-S端UDP通信"><a href="#4-Go实现C-S端UDP通信" class="headerlink" title="4.Go实现C/S端UDP通信"></a>4.Go实现C/S端UDP通信</h3><p>描述: UDP协议（User Datagram Protocol）中文名称是用户数据报协议，是<code>OSI（Open System Interconnection，开放式系统互联）</code>参考模型中一种无连接的传输层协议，不需要建立连接就能直接进行数据发送和接收，属于不可靠的、没有时序的通信，但是UDP协议的实时性比较好，通常用于视频直播相关领域。</p>
<p>Tips : UDP 通信相比较于 TCP 通信使用简单, 下述我将UDP服务端和客户端实现的相关方法原型进行展示。</p>
<ul>
<li><code>func net.ListenUDP(network string, laddr *net.UDPAddr) (*net.UDPConn, error)</code>: 设置监听UDP相关的网络地址与端口信息、网络必须是UDP网络名称。</li>
<li><code>func (*net.UDPConn).ReadFromUDP(b []byte) (int, *net.UDPAddr, error)</code>: 接收conn对象里发送的信息, ReadFromUDP与ReadFrom类似，但返回一个UDPADD。</li>
<li><code>func (*net.UDPConn).WriteToUDP(b []byte, addr *net.UDPAddr) (int, error)</code>: 发送信息到conn对象里, WriteToUDP的行为类似于WriteTo，但使用UDPADD。</li>
<li><code>func net.DialUDP(network string, laddr *net.UDPAddr, raddr *net.UDPAddr) (*net.UDPConn, error)</code> : 作用于与UDP服务端建立连接, DialUDP的作用类似于UDP网络的拨号。</li>
</ul>
<p><br/></p>
<p><strong>进阶示例1.实现UDP服务端与多客户端进行连接通信!</strong><br>Server.go<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"net"</span></span><br><span class="line">  <span class="string">"strings"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1.服务端开启监听 UDP 通信的相关设置</span></span><br><span class="line">  server_ip := [<span class="number">4</span>]<span class="keyword">byte</span>&#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">172</span>, <span class="number">108</span>&#125;</span><br><span class="line">  server_port := <span class="number">30000</span></span><br><span class="line">  conn, err := net.ListenUDP(<span class="string">"udp"</span>, &amp;net.UDPAddr&#123;</span><br><span class="line">    IP:   net.IPv4(server_ip[<span class="number">0</span>], server_ip[<span class="number">1</span>], server_ip[<span class="number">2</span>], server_ip[<span class="number">3</span>]),</span><br><span class="line">    Port: server_port,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Listen UDP Server (%v:%v) Failed, err: %v\n"</span>, server_ip, server_port, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"[%v] Listening UDP Server %v:%v is successful!\n"</span>, time.Now().Format(<span class="string">"2006-01-02 15:04:05"</span>), server_ip, server_port)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 程序结束时关闭conn资源</span></span><br><span class="line">  <span class="keyword">defer</span> conn.Close()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.循环接收和响应数据给客户端，非常主要此处不需要建立连接，直接收发数据。</span></span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    <span class="comment">// 获得客户端通信对象以及返回读取的字节数</span></span><br><span class="line">    <span class="keyword">var</span> recvMsg [<span class="number">1024</span>]<span class="keyword">byte</span></span><br><span class="line">    count, addr, err := conn.ReadFromUDP(recvMsg[:]) <span class="comment">// 接收数据</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"Read from UDP Client failed. Err:"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 打印客户端发送的信息到终端</span></span><br><span class="line">    fmt.Printf(<span class="string">"[%v] %v - %v\n"</span>, time.Now().Format(<span class="string">"2006-01-02 15:04:05"</span>), addr.String(), <span class="keyword">string</span>(recvMsg[:count<span class="number">-1</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 并将接收到的信息更改为大写，再返还给Client。</span></span><br><span class="line">    reply := strings.ToUpper(<span class="keyword">string</span>(recvMsg[:count]))</span><br><span class="line">    conn.WriteToUDP([]<span class="keyword">byte</span>(reply), addr) <span class="comment">// 发送数据</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>Client.go<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"bufio"</span></span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"net"</span></span><br><span class="line">  <span class="string">"os"</span></span><br><span class="line">  <span class="string">"strings"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// (1) 与服务端建立UDP通信链接</span></span><br><span class="line">  server_ip := [<span class="number">4</span>]<span class="keyword">byte</span>&#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">172</span>, <span class="number">108</span>&#125;</span><br><span class="line">  server_port := <span class="number">30000</span></span><br><span class="line">  socket, err := net.DialUDP(<span class="string">"udp"</span>, <span class="literal">nil</span>, &amp;net.UDPAddr&#123;</span><br><span class="line">    IP:   net.IPv4(server_ip[<span class="number">0</span>], server_ip[<span class="number">1</span>], server_ip[<span class="number">2</span>], server_ip[<span class="number">3</span>]),</span><br><span class="line">    Port: server_port,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Connect UDP Server (%v:%v) Failed! err: %v\n"</span>, server_ip, server_port, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"[%v] - Connect UDP Server %v:%v successful!\n"</span>, time.Now().Format(<span class="string">"2006-01-02 15:04:05"</span>), server_ip, server_port)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 同样关闭建立的通信连接</span></span><br><span class="line">  <span class="keyword">defer</span> socket.Close()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (2) 发送与接收服务端返回的信息</span></span><br><span class="line">  <span class="keyword">var</span> reply [<span class="number">1024</span>]<span class="keyword">byte</span></span><br><span class="line">  inputData := bufio.NewReader(os.Stdin)</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    <span class="comment">// 终端接收输入要发送的给服务端的内容</span></span><br><span class="line">    fmt.Print(<span class="string">"&lt;- 请输入将要发送的内容:"</span>)</span><br><span class="line">    sendMsg, _ := inputData.ReadString(<span class="string">'\n'</span>)</span><br><span class="line">    sendMsg = strings.TrimSpace(sendMsg) <span class="comment">// 取消字符串前后的空格</span></span><br><span class="line">    socket.Write([]<span class="keyword">byte</span>(sendMsg))        <span class="comment">// 发送数据</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">"发送数据失败，err: %v\n"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 接收来自服务端的反馈的内容</span></span><br><span class="line">    count, _, err := socket.ReadFromUDP(reply[:]) <span class="comment">// 接收数据</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">"接收数据失败, err: %v\n"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">"Server -&gt; [%v Bytes] %v \n"</span>, count, <span class="keyword">string</span>(reply[:count]))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>执行结果:<br><figure class="image-box">
                <a rel=8.Go编程快速入门学习 href="https://img.weiyigeek.top/2021/5/20211120164754.png" target="_blank" title="WeiyiGeek.实现UDP服务端与多客户端进行连接通信!" data-fancybox="images"><img src="https://img.weiyigeek.top/2021/5/20211120164754.png" alt="WeiyiGeek.实现UDP服务端与多客户端进行连接通信!" title="" class=""></a>
                <p>WeiyiGeek.实现UDP服务端与多客户端进行连接通信!</p>
            </figure></p>
<p><br/></p>
<h3 id="5-课外知识扩展"><a href="#5-课外知识扩展" class="headerlink" title="5.课外知识扩展"></a>5.课外知识扩展</h3><h4 id="1-TCP-黏包"><a href="#1-TCP-黏包" class="headerlink" title="1) TCP 黏包"></a>1) TCP 黏包</h4><p><strong>在讲解TCP黏包前我们先来看看TCP黏包会导致什么问题?</strong></p>
<ul>
<li>黏包示例服务端代码如下：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">process</span><span class="params">(conn net.Conn)</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> conn.Close()</span><br><span class="line">  reader := bufio.NewReader(conn)</span><br><span class="line">  <span class="keyword">var</span> buf [<span class="number">1024</span>]<span class="keyword">byte</span></span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    n, err := reader.Read(buf[:])</span><br><span class="line">    <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"read from client failed, err:"</span>, err)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    recvStr := <span class="keyword">string</span>(buf[:n])</span><br><span class="line">    fmt.Println(<span class="string">"收到client发来的数据："</span>, recvStr)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  listen, err := net.Listen(<span class="string">"tcp"</span>, <span class="string">"127.0.0.1:30000"</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"listen failed, err:"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">defer</span> listen.Close()</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    conn, err := listen.Accept()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"accept failed, err:"</span>, err)</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">go</span> process(conn)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>黏包示例客户端代码如下:</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  conn, err := net.Dial(<span class="string">"tcp"</span>, <span class="string">"127.0.0.1:30000"</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"dial failed, err"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">defer</span> conn.Close()</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">20</span>; i++ &#123;</span><br><span class="line">    msg := <span class="string">`Hello, Hello. How are you?`</span></span><br><span class="line">    conn.Write([]<span class="keyword">byte</span>(msg))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将上面的代码保存后分别编译, 先启动服务端然后再启动客户端，可以看到服务端输出结果如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">收到client发来的数据： Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?</span><br><span class="line">收到client发来的数据： Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?</span><br><span class="line">收到client发来的数据： Hello, Hello. How are you?Hello, Hello. How are you?</span><br><span class="line">收到client发来的数据： Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?</span><br><span class="line">收到client发来的数据： Hello, Hello. How are you?Hello, Hello. How are you?</span><br></pre></td></tr></table></figure></p>
<p>从客户端示例代码中可以看见客户端分20次发送的数据，但是在服务端并没有成功的输出20次，而是多条数据“粘”到了一起，这就是TCP黏包带来的问题。</p>
<p><br/></p>
<p><strong>Q: 此时可能会问为什么会出现粘包?</strong></p>
<blockquote>
<p>答：主要原因就是tcp数据传递模式是流模式，在保持长连接的时候可以进行多次的收和发, 而TCP黏包可以发生在在发送端也可发生在接收端, 主要是由于Nagle算法导致的。<br>Nagle算法是一种改善网络传输效率的算法， 通常在发送端由于Nagle算法导致的黏包问题,而接收端接收不及时也会造成的接收端粘包。<br>发送端: 简单来说就是当我们提交一段数据给TCP发送时，TCP并不立刻发送此段数据，而是等待一小段时间看看在等待期间是否还有要发送的数据，若有则会一次把这两段数据发送出去，所以说Nagle算法特性其并不适用于某些场景。<br>接收端: TCP会把接收到的数据存在自己的缓冲区中，然后通知应用层取数据。当应用层由于某些原因不能及时的把TCP的数据取出来，就会造成TCP缓冲区中存放了几段数据。</p>
</blockquote>
<p><br/></p>
<p><strong>Q: 有何解决办法?</strong></p>
<blockquote>
<p>答: 出现”粘包”的关键在于接收方不确定将要传输的数据包的大小，因此我们可以对数据包进行封包和拆包的操作。<br> 此时需要自己定义一个协议,比如数据包的前4个字节为包头里面存储的是发送的数据的长度，然后通过发送端进行封包、接收端进行拆包的操作来解决此问题。</p>
</blockquote>
<p><br></p>
<p><strong>Q: 什么是封包?</strong></p>
<blockquote>
<p>答: 封包就是给一段数据加上包头，这样一来数据包就分为包头和包体两部分内容了(过滤非法包时封包会加入”包尾”内容)。包头部分的长度是固定的，并且它存储了包体的长度，根据包头长度固定以及包头中含有包体长度的变量就能正确的拆分出一个完整的数据包。</p>
</blockquote>
<p><br></p>
<p><strong>实践示例：</strong></p>
<ul>
<li>自定义协议: proto.go<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> proto</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"bufio"</span></span><br><span class="line">  <span class="string">"bytes"</span></span><br><span class="line">  <span class="string">"encoding/binary"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// (1) Encode 将消息编码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Encode</span><span class="params">(message <span class="keyword">string</span>)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1.读取消息的长度，转换成int32类型（占4个字节）以后可以按照需要进行自定义</span></span><br><span class="line">  <span class="keyword">var</span> length = <span class="keyword">int32</span>(<span class="built_in">len</span>(message))</span><br><span class="line">  <span class="keyword">var</span> pkg = <span class="built_in">new</span>(bytes.Buffer) <span class="comment">// 向系统为具有读写方法的字节大小可变的缓冲区申请内存。</span></span><br><span class="line">  <span class="comment">// 2.写入消息头</span></span><br><span class="line">  err := binary.Write(pkg, binary.LittleEndian, length) <span class="comment">//注意此处以小端的方式写入.在后续解包时也必须采用小端方式读取</span></span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 3.写入消息实体</span></span><br><span class="line">  err = binary.Write(pkg, binary.LittleEndian, []<span class="keyword">byte</span>(message))</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 4.返回封包完毕的缓冲区中数据</span></span><br><span class="line">  <span class="keyword">return</span> pkg.Bytes(), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (2) Decode 解码消息</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Decode</span><span class="params">(reader *bufio.Reader)</span> <span class="params">(<span class="keyword">string</span>, error)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1.读取消息的长度</span></span><br><span class="line">  lengthByte, _ := reader.Peek(<span class="number">4</span>)           <span class="comment">// 读取前4个字节的数据</span></span><br><span class="line">  lengthBuff := bytes.NewBuffer(lengthByte) <span class="comment">// NewBuffer使用buf作为初始内容创建并初始化一个新缓冲区,此处指定要读取数据的长度.</span></span><br><span class="line">  <span class="keyword">var</span> length <span class="keyword">int32</span></span><br><span class="line">  err := binary.Read(lengthBuff, binary.LittleEndian, &amp;length)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>, err</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 2.Buffered返回缓冲中现有的可读取的字节数,如果获取的字节数小于消息的长度则说明数据包有误.</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">int32</span>(reader.Buffered()) &lt; length+<span class="number">4</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>, err</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.读取真正的消息数据</span></span><br><span class="line">  pack := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="keyword">int</span>(<span class="number">4</span>+length))</span><br><span class="line">  _, err = reader.Read(pack)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>, err</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4.利用slice切片返回四个字节后的消息数据</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">string</span>(pack[<span class="number">4</span>:]), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>然后在服务端和客户端分别使用上面定义的proto包的<code>Decode 和 Encode</code>函数处理数据。</p>
<ul>
<li>服务端代码如下：<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"bufio"</span></span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"io"</span></span><br><span class="line">  <span class="string">"net"</span></span><br><span class="line">  <span class="string">"weiyigeek.top/studygo/Day08/03StickBag/proto"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">process</span><span class="params">(conn net.Conn)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 4.退出时关闭conn资源</span></span><br><span class="line">  <span class="keyword">defer</span> conn.Close()</span><br><span class="line">  <span class="comment">// 5.NewReader返回其缓冲区具有默认大小的新读取器。</span></span><br><span class="line">  reader := bufio.NewReader(conn)</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    <span class="comment">// 6.解包: 将通过conn对象中获取的缓冲区数据进行解包.</span></span><br><span class="line">    msg, err := proto.Decode(reader)</span><br><span class="line">    <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"decode msg failed, err:"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 7.打印解包后的数据</span></span><br><span class="line">    fmt.Println(<span class="string">"收到client发来的数据："</span>, msg)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1.设置TCP Server端监听地址和端口</span></span><br><span class="line">  listen, err := net.Listen(<span class="string">"tcp"</span>, <span class="string">"127.0.0.1:30000"</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"listen failed, err:"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 2.函数结束后关闭监听资源</span></span><br><span class="line">  <span class="keyword">defer</span> listen.Close()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.循环接收客户端发送过来的数据,利用gorontine执行process任务</span></span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    conn, err := listen.Accept()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"accept failed, err:"</span>, err)</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">go</span> process(conn)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>客户端代码如下:<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"net"</span></span><br><span class="line">  <span class="string">"weiyigeek.top/studygo/Day08/03StickBag/proto"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1.连接到server端.</span></span><br><span class="line">  conn, err := net.Dial(<span class="string">"tcp"</span>, <span class="string">"127.0.0.1:30000"</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"dial failed, err"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.程序结束时关闭conn网络连接资源.</span></span><br><span class="line">  <span class="keyword">defer</span> conn.Close()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.循环发送20次msg给server端</span></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">20</span>; i++ &#123;</span><br><span class="line">    msg := <span class="string">`Hello, Hello. How are you?`</span></span><br><span class="line">    <span class="comment">// 4.将要发送的信息进行封包处理</span></span><br><span class="line">    data, err := proto.Encode(msg)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"encode msg failed, err:"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5.将处理过的封包进行发送</span></span><br><span class="line">    conn.Write(data)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>执行结果: 此时发现它不会将多个hello…字符串放在一行了，并且输出也是我们预定的20次。</p>
<figure class="image-box">
                <a rel=8.Go编程快速入门学习 href="https://img.weiyigeek.top/2021/5/20211121132345.png" target="_blank" title="WeiyiGeek.黏包解决办法" data-fancybox="images"><img src="https://img.weiyigeek.top/2021/5/20211121132345.png" alt="WeiyiGeek.黏包解决办法" title="" class=""></a>
                <p>WeiyiGeek.黏包解决办法</p>
            </figure>
<p><br/></p>
<p><strong>补充知识</strong>:<code>字节序列的存储格式</code>之大端(<code>Big-endian</code>)和小端(<code>LittleEndian</code>)存储</p>
<ul>
<li>Big-endian：将高序字节存储在起始地址（高位编址），此种方式便于人类理解。</li>
<li>Little-endian：将低序字节存储在起始地址（低位编址）一般在x64/x32的系统中都是小端存储。</li>
</ul>
<p>举个例子: 如果我们将0x1234abcd写入到以0x0000开始的内存中，则结果为；</p>
<table>
<thead>
<tr>
<th>address</th>
<th>big-endian（大端）</th>
<th>little-endian （小端）</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x0000</td>
<td>0x12</td>
<td>0xcd</td>
</tr>
<tr>
<td>0x0001</td>
<td>0x34</td>
<td>0xab</td>
</tr>
<tr>
<td>0x0002</td>
<td>0xab</td>
<td>0x34</td>
</tr>
<tr>
<td>0x0003</td>
<td>0xcd</td>
<td>0x12</td>
</tr>
</tbody>
</table>
<p>注：每个地址存1个字节，2位16进制数是1个字节<code>（0xFF=11111111）</code>；</p>
<figure class="image-box">
                <a rel=8.Go编程快速入门学习 href="https://img.weiyigeek.top/2021/5/20211121123804.png" target="_blank" title="WeiyiGeek.大端和小端" data-fancybox="images"><img src="https://img.weiyigeek.top/2021/5/20211121123804.png" alt="WeiyiGeek.大端和小端" title="" class=""></a>
                <p>WeiyiGeek.大端和小端</p>
            </figure>
<p><br/></p>
<p><strong>补充知识</strong>:CPU存储一个字节的数据时其字节内的8个比特之间的顺序是否也有<code>big endian</code>和<code>little endian</code>之分？或者说是否有比特序的不同？</p>
<p>实际上，这个比特序是同样存在的只是多个两个表示名称（MSB 和 LSB）。<br>MSB的意思是：全称为<code>Most Significant Bit</code>，在二进制数中属于最高有效位，MSB是最高加权位，与十进制数字中最左边的一位类似。<br>LSB的意思是：全称为<code>Least Significant Bit</code>，在二进制数中意为最低有效位，一般来说，MSB位于二进制数的最左侧，LSB位于二进制数的最右侧。</p>
<p>下面以数字0xB4（10110100）用图加以说明。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Big Endian</span></span><br><span class="line">msb------------------------&gt;lsb</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|   1  |   0  |   1  |   1  |   0  |   1  |   0  |   0  |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Little Endian</span></span><br><span class="line">lsb--------------------------&gt;msb</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|   0  |   0  |   1  |   0  |   1  |   1  |   0  |   1  |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></pre></td></tr></table></figure></p>
<p>实际上，由于CPU存储数据操作的最小单位是一个字节，其内部的比特序是什么样对我们的程序来说是一个黑盒子。也就是说，你给我一个指向0xB4这个数的指针，对于big endian方式的CPU来说，它是从左往右依次读取这个数的8个比特；而对于little endian方式的CPU来说，则正好相反，是从右往左依次读取这个数的8个比特。而我们的程序通过这个指针访问后得到的数就是0xB4，字节内部的比特序对于程序来说是不可见的，其实这点对于单机上的字节序来说也是一样的。 </p>
<hr>
<h2 id="0x01Go语言基础之HTTP-C-S实现"><a href="#0x01Go语言基础之HTTP-C-S实现" class="headerlink" title="0x01Go语言基础之HTTP C/S实现"></a>0x01Go语言基础之HTTP C/S实现</h2><p>描述: 在Socket网络编程中我们学习TCP协议与UDP协议的服务端与客户端代码的编写实践, 今天我们来学习在应用层中我们使用最多的HTTP协议，利用Go语言分别实现HTTP的Client端与Server端服务。</p>
<p>Go语言内置<code>的net/http</code>包十分的优秀，其为我们提供了HTTP客户端和服务端的实现。</p>
<p><strong>Q: 什么是 HTTP 协议?</strong></p>
<blockquote>
<p>答: 超文本传输协议（HTTP，HyperText Transfer Protocol)是互联网上应用最为广泛的一种网络传输协议，所有的WWW文件都必须遵守这个标准，设计HTTP最初的目的是为了提供一种发布和接收HTML页面的方法。<br>例如，我们在浏览器中访问的http的网站，其传输协议便是采用HTTP。</p>
</blockquote>
<p><br></p>
<h3 id="1-HTTP-服务端"><a href="#1-HTTP-服务端" class="headerlink" title="1.HTTP 服务端"></a>1.HTTP 服务端</h3><p>描述: 利用Go语言提供的net/http包我们可以非常便利的使用并创建一个服务端, 值得说明的是如果仅仅是实现简单的API接口可以采用原生的http包中提供的方法, 而如果是编写一些Web后端项目通常是采用框架来实现，所以本章节主要对Go语言创建HTTP服务端的基础示例进行说明学习，而Go语言的Web应用开发框框在我后续笔记中将会进行实践讲解。</p>
<p><strong>HTTP服务端实现常用方法原型:</strong></p>
<ul>
<li><code>func http.ListenAndServe(addr string, handler http.Handler) error</code>: 使用指定的监听地址和处理器启动一个HTTP服务端, 处理器参数通常是nil表示采用包变量DefaultServeMux作为处理器。</li>
<li><code>func http.Handle(pattern string, handler http.Handler){ DefaultServeMux.Handle(pattern, handler) }</code>: Handle在DefaultServeMux中注册给定模式的处理程序函数。</li>
<li><code>func http.HandleFunc(pattern string, handler func(http.ResponseWriter, *http.Request)){DefaultServeMux.HandleFunc(pattern, handler)}</code>: HandleFunc在DefaultServeMux中注册给定模式的处理程序函数。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.Handle在DefaultServeMux中注册给定模式的处理程序函数</span></span><br><span class="line"><span class="keyword">type</span> httpServer <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(server httpServer)</span> <span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">  w.Write([]<span class="keyword">byte</span>(r.URL.Path))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> fooHandler httpServer</span><br><span class="line">http.Handle(<span class="string">"/foo"</span>, fooHandler)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.HandleFunc在DefaultServeMux中注册给定模式的处理程序函数</span></span><br><span class="line">http.HandleFunc(<span class="string">"/bar"</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">  fmt.Fprintf(w, <span class="string">"Hello, %q"</span>, html.EscapeString(r.URL.Path))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.指定的本地网卡的8080断开作为监听地址和处理器启动一个HTTP服务端。</span></span><br><span class="line">log.Fatal(http.ListenAndServe(<span class="string">":8080"</span>, <span class="literal">nil</span>))</span><br></pre></td></tr></table></figure>
<p><br/></p>
<p><strong>Tips: go http http.Handle 和 http.HandleFunc 区别?</strong></p>
<ul>
<li><code>http.Handle()</code> 需要自己去定义struct实现这个Handler接口。</li>
<li><code>http.HandleFunc()</code> 则不需要我们自己定义structqi实现,只需要传入访问连接路径以及DefaultServeMux中注册给定模式的处理程序函数。</li>
</ul>
<p>通常是使用HandleFunc方法,其更加方便简单。</p>
<p><br></p>
<p><strong>示例1.http.Handle自定义实现Handler接口</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"log"</span></span><br><span class="line">  <span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义结构体</span></span><br><span class="line"><span class="keyword">type</span> httpServer <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// httpServer 自定义实现http请求处理程序函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(server httpServer)</span> <span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">  path := r.URL.Path</span><br><span class="line">  fmt.Println(path)</span><br><span class="line">  <span class="keyword">switch</span> path &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"/"</span>:</span><br><span class="line">    w.Write([]<span class="keyword">byte</span>(<span class="string">"根路径 : "</span> + r.URL.Path))</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"/index"</span>:</span><br><span class="line">    w.Write([]<span class="keyword">byte</span>(<span class="string">"首页路径 : "</span> + r.URL.Path))</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"/hello"</span>:</span><br><span class="line">    w.Write([]<span class="keyword">byte</span>(<span class="string">"子网页路径 : "</span> + r.URL.Path))</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    w.Write([]<span class="keyword">byte</span>(<span class="string">"&lt;b&gt;未知路径&lt;/b&gt; : https://weiyigeek.top"</span> + r.URL.Path))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1.声明serve变量的类型为我们自定义结构体</span></span><br><span class="line">  <span class="keyword">var</span> server httpServer</span><br><span class="line">  serveraddr := <span class="string">"0.0.0.0:8080"</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.Handle在DefaultServeMux中注册给定模式的处理程序。</span></span><br><span class="line">  http.Handle(<span class="string">"/"</span>, server)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.启动httpServer监听并采用包变量DefaultServeMux作为处理器。</span></span><br><span class="line">  err := http.ListenAndServe(serveraddr, <span class="literal">nil</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatal(err)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Http Server %v Started......"</span>, serveraddr)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>执行结果如下图所示<br><figure class="image-box">
                <a rel=8.Go编程快速入门学习 href="https://img.weiyigeek.top/2021/5/20211122150456.png" target="_blank" title="WeiyiGeek.http.Handle结果" data-fancybox="images"><img src="https://img.weiyigeek.top/2021/5/20211122150456.png" alt="WeiyiGeek.http.Handle结果" title="" class=""></a>
                <p>WeiyiGeek.http.Handle结果</p>
            </figure></p>
<p><br></p>
<p><strong>示例2.http.HandleFunc实现用户请求处理</strong></p>
<p>index.html<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>测试页面2<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>  <span class="attr">id</span>=<span class="string">"tips"</span> <span class="attr">style</span>=<span class="string">"color: red;font-size:medium;font-weight: bolder;"</span>&gt;</span>Welcome to Visit weiyigeek.top web site<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"msg"</span>&gt;</span>点击提示<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> tips = <span class="built_in">document</span>.getElementById(<span class="string">"tips"</span>).textContent;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.getElementById(<span class="string">"msg"</span>).onclick=<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">      alert(tips);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>Http Server 端代码:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"io/ioutil"</span></span><br><span class="line">  <span class="string">"log"</span></span><br><span class="line">  <span class="string">"net/http"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1.声明定义server监听端口地址</span></span><br><span class="line">  serveraddr := <span class="string">"0.0.0.0:8080"</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.HandleFunc在DefaultServeMux中注册给定模式的处理程序。</span></span><br><span class="line">  http.HandleFunc(<span class="string">"/hello"</span>, hello)</span><br><span class="line">  http.HandleFunc(<span class="string">"/blog"</span>, blog)</span><br><span class="line">  http.HandleFunc(<span class="string">"/htmlfile"</span>, htmlfile)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.启动httpServer监听并采用包变量DefaultServeMux作为处理器。</span></span><br><span class="line">  err := http.ListenAndServe(serveraddr, <span class="literal">nil</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatal(err)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Http Server %v Started......"</span>, serveraddr)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (1) 方式1.此种方式不能直接写入HTML标签代码并返还给客户端.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">  fmt.Fprintf(w, <span class="string">"Hello World! Go &lt;b&gt;测试页面0&lt;/b&gt; Time : %s"</span>, time.Now())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (2) 方式2.可以直接写入HTML标签代码并返还给客户端.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">blog</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">  reply := fmt.Sprintf(<span class="string">"&lt;b&gt;测试页面1&lt;/b&gt;&lt;p&gt; 标题.Demo1 Test(Go net/http) &lt;/p&gt; &lt;i&gt;I'm WeiyiGeek&lt;/i&gt;&lt;br/&gt; Time : %s"</span>, time.Now().Format(<span class="string">"2006-01-02 15:04:05"</span>))</span><br><span class="line">  w.Write([]<span class="keyword">byte</span>(reply))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (3) 读取本机上的网页为文件返还给客户端.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">htmlfile</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">  res, err := ioutil.ReadFile(<span class="string">"./index.html"</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    w.Write([]<span class="keyword">byte</span>(fmt.Sprintf(<span class="string">"Error: %v"</span>, err)))</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  w.Write([]<span class="keyword">byte</span>(res))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>将上面的代码编译之后执行，打开电脑上的浏览器在地址栏输入<code>127.0.0.1:8080</code>回车，此时返回如下页面。</p>
<figure class="image-box">
                <a rel=8.Go编程快速入门学习 href="https://img.weiyigeek.top/2021/5/20211122165405.png" target="_blank" title="WeiyiGeek.http.HandleFunc实现用户请求处理" data-fancybox="images"><img src="https://img.weiyigeek.top/2021/5/20211122165405.png" alt="WeiyiGeek.http.HandleFunc实现用户请求处理" title="" class=""></a>
                <p>WeiyiGeek.http.HandleFunc实现用户请求处理</p>
            </figure>
<p><br></p>
<p><strong>示例3.自定义http.Server结构体参数与Handler实现</strong><br>描述: 我们可以创建一个自定义的 <code>Server</code> Handler实现, 通过http.Server指定设置结构体参数来管理服务端的行为。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"log"</span></span><br><span class="line">  <span class="string">"net/http"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义myHandler结构体，注册Handler处理程序使用</span></span><br><span class="line"><span class="keyword">type</span> myHandler <span class="keyword">struct</span> &#123;</span><br><span class="line">  name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 自定义myHandler结构体的方法注册到Handler处理程序,【非常注意】、【非常注意】方法名必须为 ServeHTTP</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(handler myHandler)</span> <span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 现在handler基于URL的路径部分（req.URL.Path）来决定执行什么逻辑。</span></span><br><span class="line">  <span class="keyword">switch</span> req.URL.Path &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"/index"</span>:</span><br><span class="line">    fmt.Fprintf(w, <span class="string">"%s\n"</span>, <span class="string">"This is Index path"</span>)</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"/weiyigeek"</span>:</span><br><span class="line">    fmt.Fprintf(w, <span class="string">"%s -&gt; %s\n"</span>, handler.name, <span class="string">"https://weiyigeek.top"</span>) <span class="comment">// WeiyiGeek -&gt; https://weiyigeek.top</span></span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="comment">// 如果这个handler不能识别这个路径，它会通过调用返回客户端一个HTTP404错误,并响应给客户端表明请求的路径不存在.</span></span><br><span class="line">    w.WriteHeader(http.StatusNotFound) <span class="comment">// 404</span></span><br><span class="line">    fmt.Fprintf(w, <span class="string">"no such page: %s\n"</span>, req.URL)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1.实例化一个处理所有请求的Handler接口</span></span><br><span class="line">  handler := myHandler&#123;name: <span class="string">"WeiyiGeek"</span>&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.创建一个自定义的Server参数,注意如果Handler为nil则采用http.DefaultServeMux进行处理响应,否则需要我们自己实现结构体的ServeHTTP方法.</span></span><br><span class="line">  server := &amp;http.Server&#123;</span><br><span class="line">    Addr:           <span class="string">":8080"</span>,</span><br><span class="line">    Handler:        handler,</span><br><span class="line">    ReadTimeout:    <span class="number">10</span> * time.Second,</span><br><span class="line">    WriteTimeout:   <span class="number">10</span> * time.Second,</span><br><span class="line">    IdleTimeout:    <span class="number">60</span> * time.Second,</span><br><span class="line">    MaxHeaderBytes: <span class="number">1</span> &lt;&lt; <span class="number">20</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.启动并监听HTTP服务端</span></span><br><span class="line">  log.Fatal(server.ListenAndServe())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>执行结果:<br><figure class="image-box">
                <a rel=8.Go编程快速入门学习 href="https://img.weiyigeek.top/2021/5/20211122210606.png" target="_blank" title="WeiyiGeek.自定义http.Server结构体参数与Handler实现" data-fancybox="images"><img src="https://img.weiyigeek.top/2021/5/20211122210606.png" alt="WeiyiGeek.自定义http.Server结构体参数与Handler实现" title="" class=""></a>
                <p>WeiyiGeek.自定义http.Server结构体参数与Handler实现</p>
            </figure></p>
<p>Tips: 显然我们可以继续向ServeHTTP方法中添加case，但在一个实际的应用中，将每个case中的逻辑定义到一个分开的方法或函数中会很实用。对于更复杂的应用我们可以通过一个ServeMux将一批http.Handler聚集到一个单一的http.Handler中,通过组合来处理更加错综复杂的路由需求。</p>
<p>Tips: 【非常注意】【非常注意】【非常注意】自己实现的 http.Handler 且必须包含一个 ServeHTTP 方法名, 才能接受和响应客户端。</p>
<p><br></p>
<p><strong>示例4.ServeMux.HandleFunc实现http服务端</strong><br>语句http.HandlerFunc(handler.list)是一个转换而非一个函数调用，因为http.HandlerFunc是一个类型, 它有如下的定义：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> http</span><br><span class="line"><span class="keyword">type</span> HandlerFunc <span class="function"><span class="keyword">func</span><span class="params">(w ResponseWriter, r *Request)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="params">(f HandlerFunc)</span> <span class="title">ServeHTTP</span><span class="params">(w ResponseWriter, r *Request)</span></span> &#123;</span><br><span class="line">    f(w, r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>简单示例:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义类型声明</span></span><br><span class="line"><span class="keyword">type</span> dollars <span class="keyword">float32</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d dollars)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123; <span class="keyword">return</span> fmt.Sprintf(<span class="string">"$%.2f"</span>, d) &#125; </span><br><span class="line"><span class="comment">// Map类型的变量声明</span></span><br><span class="line"><span class="keyword">type</span> MyHandler <span class="keyword">map</span>[<span class="keyword">string</span>]dollars</span><br><span class="line"><span class="comment">// 类型方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(self MyHandler)</span> <span class="title">list</span><span class="params">(w http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> item, price := <span class="keyword">range</span> self &#123;</span><br><span class="line">      fmt.Fprintf(w, <span class="string">"%s: %s\n"</span>, item, price)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(self MyHandler)</span> <span class="title">price</span><span class="params">(w http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">  item := req.URL.Query().Get(<span class="string">"item"</span>)</span><br><span class="line">  price, ok := self[item]</span><br><span class="line">  <span class="keyword">if</span> !ok &#123;</span><br><span class="line">      w.WriteHeader(http.StatusNotFound) <span class="comment">// 404</span></span><br><span class="line">      fmt.Fprintf(w, <span class="string">"no such item: %q\n"</span>, item)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Fprintf(w, <span class="string">"%s\n"</span>, price)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    handler := MyHandler&#123;<span class="string">"shoes"</span>: <span class="number">50</span>, <span class="string">"socks"</span>: <span class="number">5</span>&#125;</span><br><span class="line">    http.HandleFunc(<span class="string">"/list"</span>, handler.list)</span><br><span class="line">    http.HandleFunc(<span class="string">"/price"</span>, handler.price)</span><br><span class="line">    log.Fatal(http.ListenAndServe(<span class="string">"localhost:8000"</span>, <span class="literal">nil</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Tips: 为了方便net/http包提供了一个全局的ServeMux实例DefaultServerMux和包级别的http.Handle和http.HandleFunc函数, 前面说过我们只需要传入nil值即可。</p>
<p><br/></p>
<h3 id="2-HTTP-客户端"><a href="#2-HTTP-客户端" class="headerlink" title="2.HTTP 客户端"></a>2.HTTP 客户端</h3><p>描述: 如果你学过Python爬虫那么你也肯定知道，我们可以采用编程语言提供的相应函数或者方法就要可以对指定的网站进行请求，并可以将请求响应的数据进行清洗然后存储进数据中。</p>
<p>Go语言也为我们提供相应的内置包<code>net/http</code>和<code>net/url</code>以便于我们进行网站API接口(<code>GET</code>、<code>POST</code>、<code>PUT</code>)请求和处理服务端响应的数据。</p>
<p>HTTP客户端请求函数原型:</p>
<ul>
<li><code>func http.Get(url string) (resp *http.Response, err error)</code> : 向指定的URL发出Get请求,它将随重定向，最多10个重定向。</li>
<li><code>func http.Post(url string, contentType string, body io.Reader) (resp *http.Response, err -error)</code> : 指定的URL发出Post请求，调用方在完成读取后应关闭相应的主体。</li>
<li><code>func http.PostForm(url string, data url.Values) (resp *http.Response, err error)</code> : PostForm向指定的URL发出POST，并将数据的键和值URL编码为请求正文，<code>Content-Type header</code>设置为<code>application/x-www-form-urlencoded</code>。</li>
<li><code>func http.NewRequest(method string, url string, body io.Reader) (*http.Request, error)</code> : NewRequest使用后台上下文包装NewRequestWithContext.</li>
<li><code>func (*http.Client).Do(req *http.Request) (*http.Response, error)</code> : 按照客户端上配置的策略（如重定向、cookie、身份验证），发送到HTTP请求并返回到HTTP响应。</li>
<li><code>func url.Parse(rawurl string) (*url.URL, error)</code>: Parse将rawurl解析为URL结构。</li>
<li><code>func (url.Values).Encode() string</code> : Encode将值编码为按键排序的“URL编码”形式（“bar=baz&amp;foo=qux”）。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Get 请求</span></span><br><span class="line">resp, err := http.Get(<span class="string">"http://example.com/"</span>)</span><br><span class="line">...</span><br><span class="line"><span class="comment"># Post 请求</span></span><br><span class="line">resp, err := http.Post(<span class="string">"http://example.com/upload"</span>, <span class="string">"image/jpeg"</span>, &amp;buf)</span><br><span class="line">...</span><br><span class="line"><span class="comment"># Form 表单请求</span></span><br><span class="line">resp, err := http.PostForm(<span class="string">"http://example.com/form"</span>,</span><br><span class="line">  url.Values&#123;<span class="string">"key"</span>: &#123;<span class="string">"Value"</span>&#125;, <span class="string">"id"</span>: &#123;<span class="string">"123"</span>&#125;&#125;)</span><br><span class="line">...</span><br><span class="line"><span class="keyword">if</span> err != nil &#123;</span><br><span class="line">  // handle error</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="comment"># 程序在使用完response后必须关闭回复的主体。</span></span><br><span class="line">defer resp.Body.Close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取响应的数据</span></span><br><span class="line">body, err := ioutil.ReadAll(resp.Body)</span><br></pre></td></tr></table></figure>
<p>Tips : GET请求的参数需要使用Go语言内置的<code>net/url</code>标准库来处理。</p>
<p><br/></p>
<p><strong>简单示例.</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"io/ioutil"</span></span><br><span class="line">  <span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getMethod</span><span class="params">(url <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1.Get请求指定地址</span></span><br><span class="line">  resp, err := http.Get(url)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"get failed, err:%v\n"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 2.程序完毕时关闭回复的主体.</span></span><br><span class="line">  <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.读取响应的网页源代码</span></span><br><span class="line">  body, err := ioutil.ReadAll(resp.Body)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"read from resp.Body failed, err:%v\n"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  html := <span class="keyword">string</span>(body)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4.网站请求响应数据</span></span><br><span class="line">  fmt.Printf(<span class="string">"resp.StatusCode : %v,\nresp.Status: %v,\nresp.Request: %#v,\nresp.Header: %#v\nresp.Cookies: %#v,\nresp.TLS: %#v\n"</span>,</span><br><span class="line">    resp.StatusCode,</span><br><span class="line">    resp.Status,</span><br><span class="line">    resp.Request,</span><br><span class="line">    resp.Header,</span><br><span class="line">    resp.Cookies(),</span><br><span class="line">    resp.TLS)</span><br><span class="line"></span><br><span class="line">  fmt.Println(<span class="string">"网站响应长度: "</span>, <span class="built_in">len</span>(html))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  getMethod(<span class="string">"https://www.weiyigeek.top"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">resp.StatusCode : <span class="number">200</span>,</span><br><span class="line"></span><br><span class="line">resp.Status: <span class="number">200</span> OK,</span><br><span class="line"></span><br><span class="line">resp.Request: &amp;http.Request&#123;Method:<span class="string">"GET"</span>, URL:(*url.URL)(<span class="number">0xc000176750</span>), Proto:<span class="string">""</span>, ProtoMajor:<span class="number">0</span>, ProtoMinor:<span class="number">0</span>, Header:http.Header&#123;<span class="string">"Referer"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"https://www.weiyigeek.top"</span>&#125;&#125;, Body:io.ReadCloser(<span class="literal">nil</span>), GetBody:(<span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="params">(io.ReadCloser, error)</span>)<span class="params">(<span class="literal">nil</span>)</span>, <span class="title">ContentLength</span>:0, <span class="title">TransferEncoding</span>:[]<span class="title">string</span><span class="params">(<span class="literal">nil</span>)</span>, <span class="title">Close</span>:<span class="title">false</span>, <span class="title">Host</span>:"", <span class="title">Form</span>:<span class="title">url</span>.<span class="title">Values</span><span class="params">(<span class="literal">nil</span>)</span>, <span class="title">PostForm</span>:<span class="title">url</span>.<span class="title">Values</span><span class="params">(<span class="literal">nil</span>)</span>, <span class="title">MultipartForm</span>:<span class="params">(*multipart.Form)</span><span class="params">(<span class="literal">nil</span>)</span>, <span class="title">Trailer</span>:<span class="title">http</span>.<span class="title">Header</span><span class="params">(<span class="literal">nil</span>)</span>, <span class="title">RemoteAddr</span>:"", <span class="title">RequestURI</span>:"", <span class="title">TLS</span>:<span class="params">(*tls.ConnectionState)</span><span class="params">(<span class="literal">nil</span>)</span>, <span class="title">Cancel</span>:<span class="params">(&lt;-<span class="keyword">chan</span> <span class="keyword">struct</span> &#123;&#125;)</span><span class="params">(<span class="literal">nil</span>)</span>, <span class="title">Response</span>:<span class="params">(*http.Response)</span><span class="params">(0xc000176630)</span>, <span class="title">ctx</span>:<span class="params">(*context.emptyCtx)</span><span class="params">(0xc000134010)</span>&#125;,</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">resp</span>.<span class="title">Header</span>: <span class="title">http</span>.<span class="title">Header</span></span>&#123;<span class="string">"Access-Control-Allow-Origin"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"*"</span>&#125;, <span class="string">"Age"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"340"</span>&#125;, <span class="string">"Alt-Svc"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"h3=\":443\"; ma=86400, h3-29=\":443\"; ma=86400, h3-28=\":443\"; ma=86400, h3-27=\":443\"; ma=86400"</span>&#125;, <span class="string">"Cache-Control"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"max-age=600"</span>&#125;, <span class="string">"Cf-Cache-Status"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"DYNAMIC"</span>&#125;, <span class="string">"Cf-Ray"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"6b222396a8d10d24-LAX"</span>&#125;, <span class="string">"Content-Type"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"text/html; charset=utf-8"</span>&#125;, <span class="string">"Date"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"Mon, 22 Nov 2021 12:25:11 GMT"</span>&#125;, <span class="string">"Expect-Ct"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"max-age=604800, report-uri=\"https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct\""</span>&#125;, <span class="string">"Expires"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"Mon, 22 Nov 2021 12:27:16 GMT"</span>&#125;, <span class="string">"Last-Modified"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"Fri, 08 Oct 2021 11:30:52 GMT"</span>&#125;, <span class="string">"Nel"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"&#123;\"success_fraction\":0,\"report_to\":\"cf-nel\",\"max_age\":604800&#125;"</span>&#125;, <span class="string">"Report-To"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"&#123;\"endpoints\":[&#123;\"url\":\"https:\\/\\/a.nel.cloudflare.com\\/report\\/v3?s=6dx48uJJynNOFy1TpNXdJU0V%2FfBjazc15i3SLtiT4xoXr8vXl0MZTRuVE11vx33KNqsU05DfmNKKuPrzDTBstP32mSG%2B%2FNWUtG%2B4vlX5Ro3hApIow24bII5D0uT8FtSh\"&#125;],\"group\":\"cf-nel\",\"max_age\":604800&#125;"</span>&#125;, <span class="string">"Server"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"cloudflare"</span>&#125;, <span class="string">"Vary"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"Accept-Encoding"</span>&#125;, <span class="string">"Via"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"1.1 varnish"</span>&#125;, <span class="string">"X-Cache"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"HIT"</span>&#125;, <span class="string">"X-Cache-Hits"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"1"</span>&#125;, <span class="string">"X-Fastly-Request-Id"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"de2ef3b07dec51677274e7fe8eb68162dc77c39d"</span>&#125;, <span class="string">"X-Github-Request-Id"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"C002:9402:1A6C52:23CF10:619B8A4C"</span>&#125;, <span class="string">"X-Proxy-Cache"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"MISS"</span>&#125;, <span class="string">"X-Served-By"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"cache-bur17563-BUR"</span>&#125;, <span class="string">"X-Timer"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"S1637583911.481935,VS0,VE1"</span>&#125;&#125;</span><br><span class="line">resp.Cookies: []*http.Cookie&#123;&#125;,</span><br><span class="line"></span><br><span class="line">resp.TLS: &amp;tls.ConnectionState&#123;Version:<span class="number">0x304</span>, HandshakeComplete:<span class="literal">true</span>, DidResume:<span class="literal">false</span>, CipherSuite:<span class="number">0x1301</span>, NegotiatedProtocol:<span class="string">"h2"</span>, NegotiatedProtocolIsMutual:<span class="literal">true</span>, ServerName:<span class="string">"weiyigeek.top"</span>, PeerCertificates:[]*x509.Certificate&#123;(*x509.Certificate)(<span class="number">0xc000324000</span>), (*x509.Certificate)(<span class="number">0xc000324580</span>)&#125;, VerifiedChains:[][]*x509.Certificate&#123;[]*x509.Certificate&#123;(*x509.Certificate)(<span class="number">0xc000324000</span>), (*x509.Certificate)(<span class="number">0xc000324580</span>), (*x509.Certificate)(<span class="number">0xc000267180</span>)&#125;&#125;, SignedCertificateTimestamps:[][]<span class="keyword">uint8</span>(<span class="literal">nil</span>), OCSPResponse:[]<span class="keyword">uint8</span>&#123;<span class="number">0x30</span>, <span class="number">0x82</span>, <span class="number">0x1</span>, <span class="number">0x12</span>, <span class="number">0xa</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0xa0</span>, <span class="number">0x82</span>, <span class="number">0x1</span>, <span class="number">0xb</span>, <span class="number">0x30</span>, <span class="number">0x82</span>, <span class="number">0x1</span>, <span class="number">0x7</span>, <span class="number">0x6</span>, <span class="number">0x9</span>, <span class="number">0x2b</span>, <span class="number">0x6</span>, <span class="number">0x1</span>, <span class="number">0x5</span>, <span class="number">0x5</span>, <span class="number">0x7</span>, <span class="number">0x30</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x4</span>, <span class="number">0x81</span>, <span class="number">0xf9</span>, <span class="number">0x30</span>, <span class="number">0x81</span>, <span class="number">0xf6</span>, <span class="number">0x30</span>, <span class="number">0x81</span>, <span class="number">0x9e</span>, <span class="number">0xa2</span>, <span class="number">0x16</span>, <span class="number">0x4</span>, <span class="number">0x14</span>, <span class="number">0xa5</span>, <span class="number">0xce</span>, <span class="number">0x37</span>, <span class="number">0xea</span>, <span class="number">0xeb</span>, <span class="number">0xb0</span>, <span class="number">0x75</span>, <span class="number">0xe</span>, <span class="number">0x94</span>, <span class="number">0x67</span>, <span class="number">0x88</span>, <span class="number">0xb4</span>, <span class="number">0x45</span>, <span class="number">0xfa</span>, <span class="number">0xd9</span>, <span class="number">0x24</span>, <span class="number">0x10</span>, <span class="number">0x87</span>, <span class="number">0x96</span>, <span class="number">0x1f</span>, <span class="number">0x18</span>, <span class="number">0xf</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0x32</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x38</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0x34</span>, <span class="number">0x32</span>, <span class="number">0x33</span>, <span class="number">0x38</span>, <span class="number">0x5a</span>, <span class="number">0x30</span>, <span class="number">0x73</span>, <span class="number">0x30</span>, <span class="number">0x71</span>, <span class="number">0x30</span>, <span class="number">0x49</span>, <span class="number">0x30</span>, <span class="number">0x9</span>, <span class="number">0x6</span>, <span class="number">0x5</span>, <span class="number">0x2b</span>, <span class="number">0xe</span>, <span class="number">0x3</span>, <span class="number">0x2</span>, <span class="number">0x1a</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x4</span>, <span class="number">0x14</span>, <span class="number">0x12</span>, <span class="number">0xd7</span>, <span class="number">0x8b</span>, <span class="number">0x40</span>, <span class="number">0x2c</span>, <span class="number">0x35</span>, <span class="number">0x62</span>, <span class="number">0x6</span>, <span class="number">0xfa</span>, <span class="number">0x82</span>, <span class="number">0x7f</span>, <span class="number">0x8e</span>, <span class="number">0xd8</span>, <span class="number">0x92</span>, <span class="number">0x24</span>, <span class="number">0x11</span>, <span class="number">0xb4</span>, <span class="number">0xac</span>, <span class="number">0xf5</span>, <span class="number">0x4</span>, <span class="number">0x4</span>, <span class="number">0x14</span>, <span class="number">0xa5</span>, <span class="number">0xce</span>, <span class="number">0x37</span>, <span class="number">0xea</span>, <span class="number">0xeb</span>, <span class="number">0xb0</span>, <span class="number">0x75</span>, <span class="number">0xe</span>, <span class="number">0x94</span>, <span class="number">0x67</span>, <span class="number">0x88</span>, <span class="number">0xb4</span>, <span class="number">0x45</span>, <span class="number">0xfa</span>, <span class="number">0xd9</span>, <span class="number">0x24</span>, <span class="number">0x10</span>, <span class="number">0x87</span>, <span class="number">0x96</span>, <span class="number">0x1f</span>, <span class="number">0x2</span>, <span class="number">0x10</span>, <span class="number">0x9</span>, <span class="number">0x98</span>, <span class="number">0xa5</span>, <span class="number">0x9a</span>, <span class="number">0x26</span>, <span class="number">0x72</span>, <span class="number">0xc7</span>, <span class="number">0x24</span>, <span class="number">0x4a</span>, <span class="number">0x4d</span>, <span class="number">0xc5</span>, <span class="number">0x92</span>, <span class="number">0x80</span>, <span class="number">0xfb</span>, <span class="number">0x65</span>, <span class="number">0x5a</span>, <span class="number">0x80</span>, <span class="number">0x0</span>, <span class="number">0x18</span>, <span class="number">0xf</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0x32</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x38</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0x32</span>, <span class="number">0x37</span>, <span class="number">0x30</span>, <span class="number">0x32</span>, <span class="number">0x5a</span>, <span class="number">0xa0</span>, <span class="number">0x11</span>, <span class="number">0x18</span>, <span class="number">0xf</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0x32</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x32</span>, <span class="number">0x35</span>, <span class="number">0x31</span>, <span class="number">0x39</span>, <span class="number">0x34</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0x32</span>, <span class="number">0x5a</span>, <span class="number">0x30</span>, <span class="number">0xa</span>, <span class="number">0x6</span>, <span class="number">0x8</span>, <span class="number">0x2a</span>, <span class="number">0x86</span>, <span class="number">0x48</span>, <span class="number">0xce</span>, <span class="number">0x3d</span>, <span class="number">0x4</span>, <span class="number">0x3</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x47</span>, <span class="number">0x0</span>, <span class="number">0x30</span>, <span class="number">0x44</span>, <span class="number">0x2</span>, <span class="number">0x20</span>, <span class="number">0x5f</span>, <span class="number">0x88</span>, <span class="number">0xf2</span>, <span class="number">0xc1</span>, <span class="number">0x99</span>, <span class="number">0xcf</span>, <span class="number">0x99</span>, <span class="number">0x2b</span>, <span class="number">0x57</span>, <span class="number">0xd6</span>, <span class="number">0xd0</span>, <span class="number">0x38</span>, <span class="number">0x2e</span>, <span class="number">0x7</span>, <span class="number">0x72</span>, <span class="number">0xc7</span>, <span class="number">0x7d</span>, <span class="number">0x48</span>, <span class="number">0x34</span>, <span class="number">0x57</span>, <span class="number">0x60</span>, <span class="number">0x19</span>, <span class="number">0xe</span>, <span class="number">0x42</span>, <span class="number">0xd1</span>, <span class="number">0x32</span>, <span class="number">0x6b</span>, <span class="number">0xea</span>, <span class="number">0x5f</span>, <span class="number">0xbd</span>, <span class="number">0xfa</span>, <span class="number">0x36</span>, <span class="number">0x2</span>, <span class="number">0x20</span>, <span class="number">0x67</span>, <span class="number">0xc7</span>, <span class="number">0xc1</span>, <span class="number">0x3</span>, <span class="number">0xd4</span>, <span class="number">0xed</span>, <span class="number">0x1e</span>, <span class="number">0x32</span>, <span class="number">0xb3</span>, <span class="number">0x5f</span>, <span class="number">0x7e</span>, <span class="number">0xb3</span>, <span class="number">0xc8</span>, <span class="number">0x10</span>, <span class="number">0xb4</span>, <span class="number">0xdf</span>, <span class="number">0x88</span>, <span class="number">0x47</span>, <span class="number">0x1c</span>, <span class="number">0xf3</span>, <span class="number">0xee</span>, <span class="number">0xab</span>, <span class="number">0x3b</span>, <span class="number">0x86</span>, <span class="number">0xc7</span>, <span class="number">0xe4</span>, <span class="number">0xbc</span>, <span class="number">0xcf</span>, <span class="number">0x5c</span>, <span class="number">0x1d</span>, <span class="number">0x69</span>, <span class="number">0x48</span>&#125;, TLSUnique:[]<span class="keyword">uint8</span>(<span class="literal">nil</span>), ekm:(<span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">string</span>, []<span class="keyword">uint8</span>, <span class="keyword">int</span>)</span> <span class="params">([]<span class="keyword">uint8</span>, error)</span>)<span class="params">(0x679b80)</span>&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">网站响应长度:  16853</span></span><br></pre></td></tr></table></figure>
<p><br/></p>
<p><strong>自定义 Client&amp;Transport</strong><br>描述: 要管理HTTP客户端的头域、重定向策略和其他设置，创建一个Client：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重定向策略</span></span><br><span class="line">client := &amp;http.Client&#123;</span><br><span class="line">  <span class="comment">// CheckRedirect指定处理重定向的策略。如果CheckRedirect不是nil，则客户端在执行HTTP重定向之前调用它。</span></span><br><span class="line">  CheckRedirect: redirectPolicyFunc,</span><br><span class="line">  <span class="comment">// 超时指定此客户端发出的请求的时间限制。超时包括连接时间、任何重定向和读取响应正文。Get、Head、Post或Do返回后，计时器将保持运行，并将中断Response.Body的读取。</span></span><br><span class="line">  Timeout： <span class="number">30</span> * time.Second,</span><br><span class="line">&#125;</span><br><span class="line">resp, err := client.Get(<span class="string">"http://example.com"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求对象设置与&amp;自定义请求头</span></span><br><span class="line">req, err := http.NewRequest(<span class="string">"GET"</span>, <span class="string">"http://example.com"</span>, <span class="literal">nil</span>)</span><br><span class="line">req.Header.Add(<span class="string">"If-None-Match"</span>, <span class="string">`W/"wyzzy"`</span>)</span><br><span class="line">resp, err := client.Do(req)</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure></p>
<p>描述: 要管理代理、TLS配置、keep-alive、压缩和其他设置，创建一个Transport：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">tr := &amp;http.Transport&#123;</span><br><span class="line">  <span class="comment">// TLS 配置</span></span><br><span class="line">  TLSClientConfig:    &amp;tls.Config&#123;RootCAs: pool&#125;,</span><br><span class="line">  <span class="comment">// 是否禁用压缩</span></span><br><span class="line">  DisableCompression: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 是否保持连接(长连接、短连接)</span></span><br><span class="line">  DisableKeepAlives:  <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br><span class="line">client := &amp;http.Client&#123;Transport: tr&#125;</span><br><span class="line">resp, err := client.Get(<span class="string">"https://example.com"</span>)</span><br></pre></td></tr></table></figure><br>Tips: <code>Client</code>和<code>Transport</code>类型都可以安全的被多个goroutine同时使用, 出于效率考虑，应该一次建立、尽量重用。<br>Tips: 如果取数据比较频繁的场景建议使用长连接,否则使用短连接即可。</p>
<p><br/></p>
<h3 id="3-综合实践"><a href="#3-综合实践" class="headerlink" title="3.综合实践"></a>3.综合实践</h3><h4 id="3-1-Get-请求示例"><a href="#3-1-Get-请求示例" class="headerlink" title="3.1 Get 请求示例"></a>3.1 Get 请求示例</h4><p>get_client.go<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"io/ioutil"</span></span><br><span class="line">  <span class="string">"net/http"</span></span><br><span class="line">  <span class="string">"net/url"</span></span><br><span class="line">  <span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getMethod</span><span class="params">(urlstr <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1.URL格式校验解析</span></span><br><span class="line">  urlParse, err := url.Parse(urlstr)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Url %v Format Error!\nerr: %v\n"</span>, urlParse, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 2.URL参数设置与编码</span></span><br><span class="line">  data := url.Values&#123;&#125;</span><br><span class="line">  data.Set(<span class="string">"id"</span>, <span class="string">"1024"</span>)</span><br><span class="line">  data.Set(<span class="string">"name"</span>, <span class="string">"唯一极客"</span>)</span><br><span class="line">  <span class="comment">// 处理URL中包含的中文参数,此处采用encode进行编码.</span></span><br><span class="line">  queryStr := data.Encode()</span><br><span class="line">  <span class="comment">// URL参数设置并输出处理过后的请求字符串</span></span><br><span class="line">  urlParse.RawQuery = queryStr <span class="comment">// encoded query values, without '?'</span></span><br><span class="line">  fmt.Println(<span class="string">"QueryStr =&gt; "</span>, queryStr)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.NewRequest使用后台上下文包装NewRequestWithContext,返回请求对象</span></span><br><span class="line">  req, err := http.NewRequest(<span class="string">"Get"</span>, urlParse.String(), <span class="literal">nil</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"NewRequest %v faile!\n[error]: %v\n"</span>, urlstr, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 5.DefaultClient是默认客户端，由Get、Head和Post请求使用,此时传入上面处过的req请求对象</span></span><br><span class="line">  resp, err := http.DefaultClient.Do(req)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Request %v faile!\n[error]: %v\n"</span>, urlstr, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 6.程序完毕时关闭回复的主体(非常重要).</span></span><br><span class="line">  <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 7.从resp中把服务端返回的数据读出来</span></span><br><span class="line">  <span class="comment">// 方式1</span></span><br><span class="line">  <span class="comment">// var data []byte</span></span><br><span class="line">  <span class="comment">// response.Body.Read(data)</span></span><br><span class="line">  <span class="comment">// 方式2</span></span><br><span class="line">  body, err := ioutil.ReadAll(resp.Body)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"read from resp.Body failed, err:%v\n"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 8.网站请求响应数据集合</span></span><br><span class="line">  fmt.Printf(<span class="string">"resp.StatusCode : %v,\nresp.Status: %v,\nresp.Request: %#v,\nresp.Header: %#v\nresp.Cookies: %#v,\nresp.TLS: %#v\n"</span>,</span><br><span class="line">    resp.StatusCode,</span><br><span class="line">    resp.Status,</span><br><span class="line">    resp.Request,</span><br><span class="line">    resp.Header,</span><br><span class="line">    resp.Cookies(),</span><br><span class="line">    resp.TLS)</span><br><span class="line">  fmt.Println(<span class="string">"网站响应长度: "</span>, <span class="built_in">len</span>(body))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  getMethod(<span class="string">"http://10.20.172.108:8080/get"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>执行结果:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">QueryStr =&gt;  id=<span class="number">1024</span>&amp;name=%E5%<span class="number">94</span>%AF%E4%B8%<span class="number">80</span>%E6%<span class="number">9</span>E%<span class="number">81</span>%E5%AE%A2 <span class="comment">//url 编码后</span></span><br><span class="line">resp.StatusCode : <span class="number">200</span>,</span><br><span class="line">resp.Status: <span class="number">200</span> OK,</span><br><span class="line">resp.Request: &amp;http.Request&#123;Method:<span class="string">"Get"</span>, URL:(*url.URL)(<span class="number">0xc0000f</span>e090), Proto:<span class="string">"HTTP/1.1"</span>, ProtoMajor:<span class="number">1</span>, ProtoMinor:<span class="number">1</span>, Header:http.Header&#123;&#125;, Body:io.ReadCloser(<span class="literal">nil</span>), GetBody:(<span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="params">(io.ReadCloser, error)</span>)<span class="params">(<span class="literal">nil</span>)</span>, <span class="title">ContentLength</span>:0, <span class="title">TransferEncoding</span>:[]<span class="title">string</span><span class="params">(<span class="literal">nil</span>)</span>, <span class="title">Close</span>:<span class="title">false</span>, <span class="title">Host</span>:"10.20.172.108:8080", <span class="title">Form</span>:<span class="title">url</span>.<span class="title">Values</span><span class="params">(<span class="literal">nil</span>)</span>, <span class="title">PostForm</span>:<span class="title">url</span>.<span class="title">Values</span><span class="params">(<span class="literal">nil</span>)</span>, <span class="title">MultipartForm</span>:<span class="params">(*multipart.Form)</span><span class="params">(<span class="literal">nil</span>)</span>, <span class="title">Trailer</span>:<span class="title">http</span>.<span class="title">Header</span><span class="params">(<span class="literal">nil</span>)</span>, <span class="title">RemoteAddr</span>:"", <span class="title">RequestURI</span>:"", <span class="title">TLS</span>:<span class="params">(*tls.ConnectionState)</span><span class="params">(<span class="literal">nil</span>)</span>, <span class="title">Cancel</span>:<span class="params">(&lt;-<span class="keyword">chan</span> <span class="keyword">struct</span> &#123;&#125;)</span><span class="params">(<span class="literal">nil</span>)</span>, <span class="title">Response</span>:<span class="params">(*http.Response)</span><span class="params">(<span class="literal">nil</span>)</span>, <span class="title">ctx</span>:<span class="params">(*context.emptyCtx)</span><span class="params">(0xc0000b0010)</span>&#125;,</span></span><br><span class="line"><span class="function"><span class="title">resp</span>.<span class="title">Header</span>: <span class="title">http</span>.<span class="title">Header</span></span>&#123;<span class="string">"Content-Length"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"68"</span>&#125;, <span class="string">"Content-Type"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"application/json;charset=UTF-8"</span>&#125;, <span class="string">"Cookies"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"id=1024;name=唯一极客"</span>&#125;, <span class="string">"Date"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"Tue, 23 Nov 2021 05:25:41 GMT"</span>&#125;, <span class="string">"Requestmethod"</span>:[]<span class="keyword">string</span>&#123;<span class="string">"Get"</span>&#125;&#125;</span><br><span class="line">resp.Cookies: []*http.Cookie&#123;&#125;,</span><br><span class="line">resp.TLS: (*tls.ConnectionState)(<span class="literal">nil</span>)</span><br><span class="line">网站响应长度:  <span class="number">68</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="3-2-Post-请求示例"><a href="#3-2-Post-请求示例" class="headerlink" title="3.2 Post 请求示例"></a>3.2 Post 请求示例</h4><p>post_client.go<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// POST 示例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">postMethos</span><span class="params">(urlstr <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">  <span class="comment">// (1) 定义Post请求上传的参数( 表单数据/json数据)</span></span><br><span class="line">  <span class="comment">//contentType := "application/x-www-form-urlencoded"</span></span><br><span class="line">  <span class="comment">//data := "name=小王子&amp;age=18"</span></span><br><span class="line">  contentType := <span class="string">"application/json"</span></span><br><span class="line">  data := <span class="string">`&#123;"id":128,"name":"Weiyi"&#125;`</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// (2) 进行 Post 请求传入请求url,contentType以及Post上传的data数据</span></span><br><span class="line">  <span class="comment">// resp, err := http.Post("http://example.com/upload", "image/jpeg", &amp;buf)</span></span><br><span class="line">  resp, err := http.Post(urlstr, contentType, strings.NewReader(data))</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"post failed, err:%v\n"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (3) 程序结束则关闭resp资源</span></span><br><span class="line">  <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (4) 读取POST请求返回的数据包</span></span><br><span class="line">  body, err := ioutil.ReadAll(resp.Body)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"get resp failed, err:%v\n"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(<span class="string">"Body : "</span>, <span class="keyword">string</span>(body))</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (5) 响应头输出</span></span><br><span class="line">  fmt.Println(<span class="string">"resp.Header : "</span>, resp.Header)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  postMethos(<span class="string">"http://10.20.172.108:8080/post"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>执行结果:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Body :  &#123;<span class="string">"method"</span>:<span class="string">"POST"</span>,<span class="string">"status"</span>:<span class="string">"ok"</span>,<span class="string">"data"</span>:&#123;<span class="string">"id"</span>:128,<span class="string">"name"</span>:<span class="string">"Weiyi"</span>&#125;&#125;</span><br><span class="line">resp.Header :  map[Content-Length:[64] Content-Type:[application/json;charset=UTF-8] Cookies:[id=128;name=Weiyi] Date:[Tue, 23 Nov 2021 05:25:41 GMT] Requestmethod:[Post]]</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="3-3-PostForm-请求示例"><a href="#3-3-PostForm-请求示例" class="headerlink" title="3.3 PostForm 请求示例"></a>3.3 PostForm 请求示例</h4><p>postForm_client.go<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">postFormMethod</span><span class="params">(urlstr <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">  <span class="comment">// (1) 方式1定义Post请求上传的参数( 表单数据)</span></span><br><span class="line">  <span class="comment">//contentType := "application/x-www-form-urlencoded"</span></span><br><span class="line">  <span class="comment">//data := "id=256&amp;name=唯一极客"</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// (2) 方式2定义Post请求上传的参数( 表单数据)</span></span><br><span class="line">  data := url.Values&#123;&#125;</span><br><span class="line">  data.Set(<span class="string">"id"</span>, <span class="string">"256"</span>)</span><br><span class="line">  data.Set(<span class="string">"name"</span>, <span class="string">"WeiyiGeek-唯一极客"</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (3) 进行表单上传请求</span></span><br><span class="line">  <span class="comment">// resp, err := http.PostForm("http://example.com/form", url.Values&#123;"key": &#123;"Value"&#125;, "id": &#123;"123"&#125;&#125;)</span></span><br><span class="line">  resp, err := http.PostForm(urlstr, data)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"postForm failed, err:%v\n"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (4) 程序结束则关闭resp资源</span></span><br><span class="line">  <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (5) 读取POST请求返回的数据包</span></span><br><span class="line">  body, err := ioutil.ReadAll(resp.Body)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"get resp failed, err:%v\n"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(<span class="string">"Body : "</span>, <span class="keyword">string</span>(body))</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (6) 响应头输出</span></span><br><span class="line">  fmt.Println(<span class="string">"resp.Header : "</span>, resp.Header)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  postFormMethod(<span class="string">"http://10.20.172.108:8080/postform"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>执行结果:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Body :  &#123;<span class="string">"method"</span>:<span class="string">"POSTFORM"</span>,<span class="string">"status"</span>:<span class="string">"ok"</span>,<span class="string">"data"</span>:&#123;<span class="string">"id"</span>:256,<span class="string">"name"</span>:<span class="string">"WeiyiGeek"</span>&#125;&#125;</span><br><span class="line">resp.Header :  map[Content-Length:[72] Content-Type:[application/json;charset=UTF-8] Cookies:[method=form;id=256;name=WeiyiGeek-唯一极客] Date:[Tue, 23 Nov 2021 05:25:41 GMT] Requestmethod:[PostForm]]</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="3-4-Http-服务响应示例"><a href="#3-4-Http-服务响应示例" class="headerlink" title="3.4 Http 服务响应示例"></a>3.4 Http 服务响应示例</h4><p>描述: 下述http_serve.go代码包含上面三种请求示例的响应，以及请求参数获取以及输出。</p>
<p>http_serve.go<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"encoding/json"</span></span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"io/ioutil"</span></span><br><span class="line">  <span class="string">"log"</span></span><br><span class="line">  <span class="string">"net/http"</span></span><br><span class="line">  <span class="string">"strconv"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.自定义Handler结构体</span></span><br><span class="line"><span class="keyword">type</span> myHandler <span class="keyword">struct</span> &#123;</span><br><span class="line">  Id   <span class="keyword">int</span>    <span class="string">`json:"id"`</span></span><br><span class="line">  Name <span class="keyword">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.自定义myHandler结构体的方法注册到Handler处理程序,【非常注意】、【非常注意】方法名必须为 ServeHTTP</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(handler myHandler)</span> <span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 6.现在handler基于URL的路径部分（req.URL.Path）来决定执行什么逻辑。</span></span><br><span class="line">  <span class="keyword">switch</span> req.URL.Path &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">"/get"</span>:</span><br><span class="line">    <span class="comment">// 7.对于客户端Get请求参数获取</span></span><br><span class="line">    fmt.Printf(<span class="string">"Method : %v, URL : %v \n"</span>, req.Method, req.URL)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8.自动识别请求URL中的参数,参数利用Map类型变量进行存储key-value</span></span><br><span class="line">    fmt.Println(<span class="string">"QueryParam : "</span>, req.URL.Query())</span><br><span class="line">    queryParam := req.URL.Query()</span><br><span class="line">    id := queryParam.Get(<span class="string">"id"</span>)</span><br><span class="line">    name := queryParam.Get(<span class="string">"name"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 9.打印输出queryParam存储的value</span></span><br><span class="line">    fmt.Printf(<span class="string">"id = %v,name = %v\n"</span>, id, name)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 10.服务端响应头header自定义</span></span><br><span class="line">    w.Header().Add(<span class="string">"RequestMethod"</span>, <span class="string">"Get"</span>)                            <span class="comment">// 此处将响应的RequestMethod header字段设置为Get</span></span><br><span class="line">    w.Header().Add(<span class="string">"Content-Type"</span>, <span class="string">"application/json;charset=UTF-8"</span>)  <span class="comment">// 此处将响应的类型设置为JSON</span></span><br><span class="line">    w.Header().Add(<span class="string">"Cookies"</span>, fmt.Sprintf(<span class="string">"id=%v;name=%v"</span>, id, name)) <span class="comment">// 此处将响应的cookies设置为请求传入的参数</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 11.返回给客户端的JSON数据组装</span></span><br><span class="line">    uid, err := strconv.Atoi(id) <span class="comment">// 将get到的id字段的值转换为整型</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      errMsg := fmt.Sprintf(<span class="string">"uid convert err! %v\n"</span>, err)</span><br><span class="line">      fmt.Println(errMsg)</span><br><span class="line">      w.Write([]<span class="keyword">byte</span>(errMsg))</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    reply := fmt.Sprintf(<span class="string">"&#123;\"method\":\"%v\",\"status\":\"ok\",\"data\":&#123;\"id\":%v,\"name\":\"%v\"&#125;&#125;"</span>, <span class="string">"GET"</span>, uid, handler.Name)</span><br><span class="line">    fmt.Printf(<span class="string">"reply =&gt; %v\n\n"</span>, reply)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 12.返回响应数据给客户端</span></span><br><span class="line">    w.Write([]<span class="keyword">byte</span>(reply))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="string">"/post"</span>:</span><br><span class="line">    <span class="comment">// 7.对于客户端Request请求信息获取</span></span><br><span class="line">    fmt.Printf(<span class="string">"Method : %v, URL : %v \n"</span>, req.Method, req.URL)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8.服务端打印客户端发来的请求,当请求类型是application/json时才能从req.Body读取数据</span></span><br><span class="line">    body, err := ioutil.ReadAll(req.Body)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"req Body Read Error,"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">"req.Body =&gt; "</span>, <span class="keyword">string</span>(body))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//9.JSON反序列化</span></span><br><span class="line">    json.Unmarshal(body, &amp;handler)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 10.打印输出queryParam存储的value</span></span><br><span class="line">    fmt.Printf(<span class="string">"id = %v,name = %v\n"</span>, handler.Id, handler.Name)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 11.服务端响应头header自定义</span></span><br><span class="line">    w.Header().Add(<span class="string">"RequestMethod"</span>, <span class="string">"Post"</span>)                                           <span class="comment">// 此处将响应的RequestMethod header字段设置为POST</span></span><br><span class="line">    w.Header().Add(<span class="string">"Content-Type"</span>, <span class="string">"application/json;charset=UTF-8"</span>)                  <span class="comment">// 此处将响应的类型设置为JSON</span></span><br><span class="line">    w.Header().Add(<span class="string">"Cookies"</span>, fmt.Sprintf(<span class="string">"id=%v;name=%v"</span>, handler.Id, handler.Name)) <span class="comment">// 此处将响应的cookies设置为请求传入的参数</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 12.返回给客户端的JSON数据组装</span></span><br><span class="line">    reply := fmt.Sprintf(<span class="string">"&#123;\"method\":\"%v\",\"status\":\"ok\",\"data\":&#123;\"id\":%v,\"name\":\"%v\"&#125;&#125;"</span>, <span class="string">"POST"</span>, handler.Id, handler.Name)</span><br><span class="line">    fmt.Printf(<span class="string">"reply =&gt;  %v\n\n"</span>, reply)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 13.返回响应数据给客户端</span></span><br><span class="line">    w.Write([]<span class="keyword">byte</span>(reply))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="string">"/postform"</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7.对于客户端Request请求信息获取</span></span><br><span class="line">    fmt.Printf(<span class="string">"Method : %v, URL : %v \n"</span>, req.Method, req.URL)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8. 请求类型是application/x-www-form-urlencoded时解析form数据并打印</span></span><br><span class="line">    req.ParseForm()</span><br><span class="line">    fmt.Println(req.PostForm)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 9.获取postform表单中指定的字段值.</span></span><br><span class="line">    id := req.PostForm.Get(<span class="string">"id"</span>)</span><br><span class="line">    name := req.PostForm.Get(<span class="string">"name"</span>)</span><br><span class="line">    fmt.Printf(<span class="string">"id = %v, name = %v\n"</span>, id, name)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 10.服务端打印客户端发来的请求Body此处为[],因为但客户端请求类型是application/json时才能从req.Body读取数据</span></span><br><span class="line">    body, err := ioutil.ReadAll(req.Body)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"req Body Read Error,"</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">"req.Body =&gt; "</span>, <span class="keyword">string</span>(body))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 11.服务端响应头header自定义</span></span><br><span class="line">    w.Header().Add(<span class="string">"RequestMethod"</span>, <span class="string">"PostForm"</span>)                                   <span class="comment">// 此处将响应的RequestMethod header字段设置为PostForm</span></span><br><span class="line">    w.Header().Add(<span class="string">"Content-Type"</span>, <span class="string">"application/json;charset=UTF-8"</span>)              <span class="comment">// 此处将响应的类型设置为JSON</span></span><br><span class="line">    w.Header().Add(<span class="string">"Cookies"</span>, fmt.Sprintf(<span class="string">"method=form;id=%v;name=%v"</span>, id, name)) <span class="comment">// 此处将响应的cookies设置为请求传入的参数</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 12.返回给客户端的JSON数据组装</span></span><br><span class="line">    uid, err := strconv.Atoi(id) <span class="comment">// 将get到的id字段的值转换为整型</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      errMsg := fmt.Sprintf(<span class="string">"uid convert err! %v\n"</span>, err)</span><br><span class="line">      fmt.Println(errMsg)</span><br><span class="line">      w.Write([]<span class="keyword">byte</span>(errMsg))</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    reply := fmt.Sprintf(<span class="string">"&#123;\"method\":\"%v\",\"status\":\"ok\",\"data\":&#123;\"id\":%v,\"name\":\"%v\"&#125;&#125;"</span>, <span class="string">"POSTFORM"</span>, uid, handler.Name)</span><br><span class="line">    fmt.Println(<span class="string">"reply =&gt; "</span>, reply)</span><br><span class="line">    w.Write([]<span class="keyword">byte</span>(reply))</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="comment">// 如果这个handler不能识别这个路径，它会通过调用返回客户端一个HTTP404错误,并响应给客户端表明请求的路径不存在.</span></span><br><span class="line">    w.WriteHeader(http.StatusNotFound) <span class="comment">// 404</span></span><br><span class="line">    fmt.Fprintf(w, <span class="string">"no such page: %s\n"</span>, req.URL)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1.实例化一个处理所有请求的Handler接口</span></span><br><span class="line">  handler := myHandler&#123;Name: <span class="string">"WeiyiGeek"</span>&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.创建一个自定义的Server,注意如果Handler为nil则采用http.DefaultServeMux进行处理响应,否则需要我们自己实现结构体的ServeHTTP方法.</span></span><br><span class="line">  server := &amp;http.Server&#123;</span><br><span class="line">    Addr:           <span class="string">":8080"</span>,</span><br><span class="line">    Handler:        handler,</span><br><span class="line">    ReadTimeout:    <span class="number">10</span> * time.Second,</span><br><span class="line">    WriteTimeout:   <span class="number">10</span> * time.Second,</span><br><span class="line">    IdleTimeout:    <span class="number">15</span> * time.Second,</span><br><span class="line">    MaxHeaderBytes: <span class="number">1</span> &lt;&lt; <span class="number">20</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.启动并监听HTTP服务端</span></span><br><span class="line">  fmt.Printf(<span class="string">"[%v] Http Server Start.....\n"</span>, time.Now().Format(<span class="string">"2006-01-02 15:04:05"</span>))</span><br><span class="line">  log.Fatal(server.ListenAndServe())</span><br><span class="line">  <span class="keyword">defer</span> fmt.Printf(<span class="string">"[%v] Http Server Close.....\n"</span>, time.Now().Format(<span class="string">"2006-01-02 15:04:05"</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>执行结果:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ demo4 go build &amp;&amp; ./demo4</span><br><span class="line">[2021-11-23 13:25:30] Http Server Start.....</span><br><span class="line">Method : Get, URL : /get?id=1024&amp;name=%E5%94%AF%E4%B8%80%E6%9E%81%E5%AE%A2 </span><br><span class="line">QueryParam :  map[id:[1024] name:[唯一极客]]</span><br><span class="line">id = 1024,name = 唯一极客</span><br><span class="line">reply =&gt; &#123;<span class="string">"method"</span>:<span class="string">"GET"</span>,<span class="string">"status"</span>:<span class="string">"ok"</span>,<span class="string">"data"</span>:&#123;<span class="string">"id"</span>:1024,<span class="string">"name"</span>:<span class="string">"WeiyiGeek"</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line">Method : POST, URL : /post </span><br><span class="line">req.Body =&gt;  &#123;<span class="string">"id"</span>:128,<span class="string">"name"</span>:<span class="string">"Weiyi"</span>&#125;</span><br><span class="line">id = 128,name = Weiyi</span><br><span class="line">reply =&gt;  &#123;<span class="string">"method"</span>:<span class="string">"POST"</span>,<span class="string">"status"</span>:<span class="string">"ok"</span>,<span class="string">"data"</span>:&#123;<span class="string">"id"</span>:128,<span class="string">"name"</span>:<span class="string">"Weiyi"</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line">Method : POST, URL : /postform </span><br><span class="line">map[id:[256] name:[WeiyiGeek-唯一极客]]</span><br><span class="line">id = 256, name = WeiyiGeek-唯一极客</span><br><span class="line">req.Body =&gt;  </span><br><span class="line">reply =&gt;  &#123;<span class="string">"method"</span>:<span class="string">"POSTFORM"</span>,<span class="string">"status"</span>:<span class="string">"ok"</span>,<span class="string">"data"</span>:&#123;<span class="string">"id"</span>:256,<span class="string">"name"</span>:<span class="string">"WeiyiGeek"</span>&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>

        </div>
        <!-- Google 广告 -->
        
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
  

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> 欢迎各位志同道合的朋友一起学习交流，如文章有误请在下方留下您宝贵的经验知识，个人邮箱地址<b style="color:#ff654e"><code>【master#weiyigeek.top】</code></b>或者个人公众号<b style="color:#ff654e"><code>【WeiyiGeek】</code></b>联系我。 </p>
  <p> 更多文章来源于<b style="color:#03a9f4">【WeiyiGeek Blog - 为了能到远方，脚下的每一步都不能少】</b>, 个人首页地址( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"【点个赞】，动动你那粗壮的拇指或者芊芊玉手，亲！"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"【投个币】，万水千山总是情，投个硬币行不行，亲！")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("【收个藏】，阅后即焚不吃灰，亲！")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("【转个发】，让更多的志同道合的朋友一起学习交流，亲！")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("【关个注】，后续浏览查看不迷路哟，亲！")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="扫描Follow(关注)WeiyiGeek公众号与Visit(浏览)极客全栈修炼小程序" >
    <p>专栏书写不易，如果您觉得这个专栏还不错的，请给这篇专栏 <b style="color: red;">【点个赞、投个币、收个藏、关个注、转个发、赞个助】</b>，这将对我的肯定，我将持续整理发布更多优质原创文章！。</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    最后更新时间：<time datetime="2023-01-31T02:29:10.672Z" itemprop="dateUpdated">2023-01-31 10:29:10</time>
</span><br>


        <span>文章原始路径：<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/编程世界/Go/8.Go编程快速入门学习.md" target="_blank" rel="noopener noreferrer">_posts/编程世界/Go/8.Go编程快速入门学习.md</a></span><br>
         <span class="copy-copyright">转载注明出处，原文地址：<a href="/2020/4-24-597.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/4-24-597.html</a></span><br>本站文章内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">☕️ 请作者喝杯咖啡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go/" rel="tag">Go</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/4-24-597.html&title=《8.Go编程快速入门学习》 — WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/4-24-597.html&title=《8.Go编程快速入门学习》 — WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/4-24-597.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《8.Go编程快速入门学习》 — WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/4-24-597.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/4-24-597.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- 评论组件 -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/4-24-599.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Go编程之入坑出坑记录</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/4-23-283.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">1.Go编程快速入门学习</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-Go语言基础之Socket网络编程"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 Go语言基础之Socket网络编程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-基础概念介绍"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">1.基础概念介绍</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-Socket-基础介绍"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">2.Socket 基础介绍</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-Go实现C-S端TCP通信"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">3.Go实现C&#x2F;S端TCP通信</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-TCP-服务端"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">1) TCP 服务端</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-TCP-客户端"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">2) TCP 客户端</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-Go实现C-S端UDP通信"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">4.Go实现C&#x2F;S端UDP通信</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-课外知识扩展"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">5.课外知识扩展</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-TCP-黏包"><span class="post-toc-number">1.5.1.</span> <span class="post-toc-text">1) TCP 黏包</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01Go语言基础之HTTP-C-S实现"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01Go语言基础之HTTP C&#x2F;S实现</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-HTTP-服务端"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">1.HTTP 服务端</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-HTTP-客户端"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">2.HTTP 客户端</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-综合实践"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">3.综合实践</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-1-Get-请求示例"><span class="post-toc-number">2.3.1.</span> <span class="post-toc-text">3.1 Get 请求示例</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-2-Post-请求示例"><span class="post-toc-number">2.3.2.</span> <span class="post-toc-text">3.2 Post 请求示例</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-3-PostForm-请求示例"><span class="post-toc-number">2.3.3.</span> <span class="post-toc-text">3.3 PostForm 请求示例</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-4-Http-服务响应示例"><span class="post-toc-number">2.3.4.</span> <span class="post-toc-text">3.4 Http 服务响应示例</span></a></li></ol></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    


    <!-- 支付宝微信文章赞赏 -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        如果此篇文章对您有帮助，就请作者喝杯 Coffee ☕️☕️!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="微信打赏二维码">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="支付宝打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>

      

    <!-- 微信公众号关注/文章版权复制 -->
    
      <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">你好看友,欢迎关注博主微信公众号哟! ❤ <br> 这将是我持续更新文章的动力源泉，谢谢支持！(๑′ᴗ‵๑) </b> <br> 如不想关注请点击右上角的【X】即可关闭继续浏览文章.<br>  <b style="color:red;"> 温馨提示: 未解锁的用户不能粘贴复制文章内容哟!</b> <br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">【My Twitter】</a></strong>. There is an article verification code in the homepage.
<br>方式2.请访问本博主的B站<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">【WeiyiGeek】</a></strong>首页关注UP主,<br>将自动随机获取解锁验证码。
<br>方式3.扫一扫下方二维码，关注本站<strong>官方公众号</strong><br>
回复：<strong style="color: rgb(240, 65, 52);">验证码</strong>
将获取<strong style="color: rgb(240, 65, 52);">解锁(有效期7天)</strong>本站所有技术文章哟!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="请输入验证码|Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">提
    交</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - 为了能到远方，脚下的每一步都不能少</p>
</div>
        
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="/img/share-wechat.jpg" target="_blank">公众账号</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">哔哩哔哩专栏</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">博主Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">博主Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">知乎</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">博客园</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">今日头条</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">简书</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">腾讯云社区</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">百度文库</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">IT极客知识分享</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTO博客</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">掘金</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">微博文章</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">小红书</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">墨天轮</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">抖音主页</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">快手主页</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">西瓜视频</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2023 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.唯一极客IT知识分享 版权所有 </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>访问统计
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-站点地图">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-百度站点地图">站点地图</a> </span>
        <!-- 
  -->
        <br/>ICP备案号<span><a href="https://beian.miit.gov.cn" target="_blank">渝ICP备2022003447号</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSL安全认证" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>

<div id="go" class="waves-effect waves-light">
  <a href="javascript:;" id="goqrcode"> <span class="icon icon-lg icon-qrcode"></span> </a>
  <a href="javascript:;" id="gotop"> <span class="icon icon-lg icon-chevron-up"></span></a>
</div>





<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/4-24-597.html&title=《8.Go编程快速入门学习》 — WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/4-24-597.html&title=《8.Go编程快速入门学习》 — WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/4-24-597.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《8.Go编程快速入门学习》 — WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/4-24-597.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/4-24-597.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACKElEQVR42u3a0U7DMAwFUP7/p8srEmp3b7whmp48IdalOUEyjp2vr3gcv8bZp8nzP5+5nufNAwMD47aM43LkL0i+lZCut+N0JRgYGA9gtFO3gfj6mQkbAwMDYy0gTkIwBgYGxrsY88TxXwRcDAyMWzGS0LmWDrbH3Y+fxTEwMG7IyKvuf//zR/obGBgYt2Ic5Uh488SxXhUGBsbWjDzAJcni/EA7WQ8GBsaujPaomb/sXQW46DcYGBhbM9qSVlv2yov+eZnvxf8NDAyM7RiTEv+kbdDCitQQAwNjU0Z7JSsJr2tNzcXtw8DA2JqRHBHzaxDJRrTPF5uLgYGxKWMSUpMlzot30bcwMDAewHjXZYv8mJpvQXSBAwMDY2vGWi6Ztx7zpkI+W9KQwMDA2InRFsjy16+F7LUNwsDAeAIjeXFy3F0rlq2F4DrDxcDAuDmjbSgmnxYHzkGFv94/DAyMGzLy5Ow6dLaBu50nomJgYGzNmB9cJ8X9dobob4KBgbEdYxLmJsni2gynGAwMjAcw1lLAtcDaJp1RmxMDA+MBjLbpuHYhrC3AFSU5DAyMTRlHOfKDZbLQNqzXuS0GBsYWjDbMzV+cl+1yKgYGxhMYnyiQ5ZfA8sPwi/QUAwPjAYw88M0bkJMLYadIDAwMjLL01gbcFn9adMPAwMAo2wPzdkKSjGJgYDyHkRxi2xbCPLx+pNyGgYFxQ8bopsZSa2GeUC6uCgMD436Mb2p00T8Lkb6gAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // 百度统计
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-关注于网络安全_物联网安全开发_网络安全运维-学习心得分享';
                clearTimeout(titleTime);
            } else {
                document.title = '(つェ⊂)咦!又好了!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// 站点运行时间
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + "天" + RunHours + "时" + RunMinutes + "分" + RunSeconds + "秒";
  document.getElementById(id).innerHTML = "网站已在风雨中勉勉强强运行了【" + RunTime + "】";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
</body>
</html>