{"title":"3.vSphere进阶操作配置","slug":"虚拟云容/虚拟化/VMware/vSphere/3.vSphere进阶操作配置","date":"2019-06-17T07:36:30.000Z","updated":"2022-09-14T06:31:55.185Z","url":"2019/6-17-489.html","path":"api/articles/2019/6-17-489.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190705150827.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190705142251.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190704130750.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190704130858.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190704131008.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190704131742.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190705150600.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190614102144.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190614115410.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190614104246.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190704214115.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190704214252.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-ESXI-镜像封装\"><a href=\"#0x00-ESXI-镜像封装\" class=\"headerlink\" title=\"0x00 ESXI 镜像封装\"></a>0x00 ESXI 镜像封装</h4><p><strong>为啥需要封装驱动？</strong><br>描述:下载好ESXI6.7.iso镜像写入U盘后进行安装EXSI6.7会提示No Network Adapters找不到网卡驱动。<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190705150827.png\" alt=\"WeiyiGeek.NoAdapters\" title=\"\" class=\"\">\n                <p>WeiyiGeek.NoAdapters</p>\n            </figure><br>解决办法：需要重新封装ESXI，将对应的网卡驱动嵌入进来。</p>\n<p><strong>(1) 离线封装(推荐)</strong><br>工具准备：安装环境Windows7 X64<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#下载VMware-PowerCLI-6.5.0和ESXi-Customizer-PS封装工具</span></span><br><span class=\"line\">VMware-PowerCLI-6.5.0-4624819.exe</span><br><span class=\"line\">ESXi-Customizer-PS-v2.6.0.ps1</span><br><span class=\"line\"><span class=\"comment\"># http://vibsdepot.v-front.de/tools/ESXi-Customizer-PS-v2.6.0.ps1</span></span><br><span class=\"line\"><span class=\"comment\"># 当前最新版本：https://github.com/VFrontDe/ESXi-Customizer-PS/releases/tag/2.8.2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#下载ESXI6.7和net55-r8168网卡驱动</span></span><br><span class=\"line\">ESXi6.7</span><br><span class=\"line\"><span class=\"comment\">#注意需要下载Direct Download links ，VIB File of version 8.格式的驱动包</span></span><br><span class=\"line\">http://down.whsir.com/downloads/net55-r8168-8.045a-napi.x86_64.vib </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#net55-r8168驱动支持网卡型号:</span></span><br><span class=\"line\">Realtek RTL8111B / RTL8168B / RTL8111/RTL8168 / RTL8111C / RTL8111CP / RTL8111D(L) / RTL8168C / RTL8111DP / RTL8111E / RTL8168E / RTL8111F / RTL8411 / RTL8111G / RTL8111GUS / RTL8411B(N) / RTL8118AS / D-Link DGE-528T</span><br></pre></td></tr></table></figure></p>\n<p><a href=\"https://vibsdepot.v-front.de/wiki/index.php/List_of_currently_available_ESXi_packages\" target=\"_blank\" rel=\"noopener\">+更多网卡EXSI驱动可以查看</a></p>\n<p><em>封装步骤</em>：</p>\n<p>Step1.先安装VMware-PowerCLI-6.5.0,可能会弹出提示需要下载PowerShell3.0,如果还有其他依赖缺失，请自行下载;</p>\n<p>下载地址：<a href=\"https://download.microsoft.com/download/E/7/6/E76850B8-DA6E-4FF5-8CCE-A24FC513FD16/Windows6.1-KB2506143-x64.msu\" target=\"_blank\" rel=\"noopener\">https://download.microsoft.com/download/E/7/6/E76850B8-DA6E-4FF5-8CCE-A24FC513FD16/Windows6.1-KB2506143-x64.msu</a></p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190705142251.png\" alt=\"WeiyiGeek.PowerCliI\" title=\"\" class=\"\">\n                <p>WeiyiGeek.PowerCliI</p>\n            </figure>\n<p><br></p>\n<p>Step2.重新启动然后在重新运行VMware-PowerCLI-6.5.0安装</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190704130750.png\" alt=\"WeiyiGeek.自定义安装\" title=\"\" class=\"\">\n                <p>WeiyiGeek.自定义安装</p>\n            </figure>\n<p><br></p>\n<p>Step3.安装完成后电脑桌面会生成一个VMware PowerCLI，运行后如果看到以下报错，然后重新启动VMware PowerCLI会有个默认的设置，直接回车即可</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190704130858.png\" alt=\"WeiyiGeek.error\" title=\"\" class=\"\">\n                <p>WeiyiGeek.error</p>\n            </figure>\n<p>解决办法：开始-所有程序-附件-Windows PowerShell（管理员身份运行），输入</p>\n<blockquote>\n<p>Set-ExecutionPolicy Unrestricted</p>\n</blockquote>\n<p>设置好后重新启动VMware PowerCLI，如下面表示安装完成;<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190704131008.png\" alt=\"WeiyiGeek.settingPOwershell\" title=\"\" class=\"\">\n                <p>WeiyiGeek.settingPOwershell</p>\n            </figure></p>\n<p><br><br>Step4.打包驱动把 <code>ESXi-Customizer-PS-v2.6.0.ps1和ESXi670-201905001.zip</code>放到c盘根目录下(也可以自定义目录),<code>把net55-r8168-8.045a-napi.x86_64.vib放在c盘weiyigeek文件夹内</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#在VMware PowerCLI执行以下命令：</span></span><br><span class=\"line\">.\\ESXi-Customizer-PS-v2.6.0.ps1 -izip .\\ESXi670-201905001.zip -pkgDir c:\\weiyigeek\\</span><br></pre></td></tr></table></figure>\n<p>打包时会自动在c盘weiyigeek文件夹内查找vib的驱动生成的ESXI6.7.iso镜像会在c盘根下。<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190704131742.png\" alt=\"WeiyiGeek.error\" title=\"\" class=\"\">\n                <p>WeiyiGeek.error</p>\n            </figure><br>最后看到All done则表示封包完成，将镜像写入U盘，重新在物理机使用U盘安装即可；</p>\n<hr>\n\n<p><strong>(2)在线封装</strong><br>下面以瑞昱(Realtek)r8168为例通过VMware-PowerCLI进行嵌入网卡驱动；我们无需下载EXSI版本以及驱动离线包,直接指定版本和型号<code>即可创建的VMware ESXi软件和驱动程序包</code>;</p>\n<p>Step1.根据上次离线的环境安装好VMware-PowerCLI-6.5.0,与powershell3以及ESXi-Customizer-PS-v2.6.0.ps1</p>\n<p>Step2.然后直接运行下面脚本命令进行封装</p>\n<blockquote>\n<p>.\\ESXi-Customizer-PS-v2.6.0.ps1 -v67 -vft -load net55-r8168<br>-v50 : Create the latest ESXi 5.0 ISO<br>-v51 : Create the latest ESXi 5.1 ISO<br>-v55 : Create the latest ESXi 5.5 ISO<br>-v60 : Create the latest ESXi 6.0 ISO<br>-v65 : Create the latest ESXi 6.5 ISO<br>-v67 : Create the latest ESXi 6.7 ISO</p>\n</blockquote>\n<p>解释说明：<a href=\"https://www.v-front.de/p/esxi-customizer-ps.html#download\" target=\"_blank\" rel=\"noopener\">https://www.v-front.de/p/esxi-customizer-ps.html#download</a></p>\n<ul>\n<li>其中-v67是表示ESXI版本是6.7，ESXI6.5版本则-v65</li>\n<li>net55-r8168表示对应的RTL8168网卡驱动，</li>\n</ul>\n<p>补充说明：</p>\n<ul>\n<li><p>1.当前浏览器是否可以访问<a href=\"https://vibsdepot.v-front.de/index.html网站（不要使用IE），如果访问不了很可能会看到以下内容建议开启代理\" target=\"_blank\" rel=\"noopener\">https://vibsdepot.v-front.de/index.html网站（不要使用IE），如果访问不了很可能会看到以下内容建议开启代理</a>;<br>FATAL ERROR: Canot add the V-Front Online depot. Please check your internet connectivity and/or proxy settings!</p>\n</li>\n<li><p>2.如果一切正常，则看到如下页面</p>\n</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190705150600.png\" alt=\"WeiyiGeek.在线安装\" title=\"\" class=\"\">\n                <p>WeiyiGeek.在线安装</p>\n            </figure>\n<p><em>注意事项：</em></p>\n<ul>\n<li>ESXI6.7物理机安装之网卡驱动封装非常依赖网络环境，成功失败的因素大部分在于网络原因。</li>\n<li>打包封装的驱动<code>必须是vib格式</code></li>\n<li>如果当前电脑有杀毒软件则可能弹出窗口，允许运行即可。</li>\n</ul>\n<p><br></p>\n<p><strong>参考网站：</strong></p>\n<ul>\n<li><a href=\"https://blog.whsir.com/post-3359.html\" target=\"_blank\" rel=\"noopener\">+ESXi-Customizer定制ESXI网卡驱动</a></li>\n<li><a href=\"https://www.cnblogs.com/pipci/p/12769718.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/pipci/p/12769718.html</a></li>\n<li>项目官网：<a href=\"https://www.v-front.de/\" target=\"_blank\" rel=\"noopener\">https://www.v-front.de/</a></li>\n<li>项目地址：<a href=\"https://github.com/VFrontDe/ESXi-Customizer-PS/\" target=\"_blank\" rel=\"noopener\">https://github.com/VFrontDe/ESXi-Customizer-PS/</a></li>\n</ul>\n<hr>\n<h4 id=\"0x01-操作实例\"><a href=\"#0x01-操作实例\" class=\"headerlink\" title=\"0x01 操作实例\"></a>0x01 操作实例</h4><p><em>操作1.Vsphere 在数据存储中直接复制一台虚拟机流程方法？</em></p>\n<p>进入vSphere client关闭需要克隆的虚拟机win2012,并且进入存储器进行”浏览数据存储”<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190614102144.png\" alt=\"WeiyiGeek.VMWARE_Vsphere_clone\" title=\"\" class=\"\">\n                <p>WeiyiGeek.VMWARE_Vsphere_clone</p>\n            </figure></p>\n<p>方式1.添加到vsphere Web celint清单<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190614115410.png\" alt=\"WeiyiGeek.添加到vsphere Web celint清单\" title=\"\" class=\"\">\n                <p>WeiyiGeek.添加到vsphere Web celint清单</p>\n            </figure></p>\n<p>方式2.添加到vsphere client 中，选择我已复制(copy)即可<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190614104246.png\" alt=\"WeiyiGeek.添加到vspherecelint清单\" title=\"\" class=\"\">\n                <p>WeiyiGeek.添加到vspherecelint清单</p>\n            </figure></p>\n<p><br></p>\n<p><em>操作2.查看EXSI是不是支持HV虚拟化并且设置</em><br>开启ssh服务和安装Vcenter进行设置,并且利用命令进行查看<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">esxcfg-info -w | grep <span class=\"string\">\"HV Support\"</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190704214115.png\" alt=\"WeiyiGeek.虚拟化支持\" title=\"\" class=\"\">\n                <p>WeiyiGeek.虚拟化支持</p>\n            </figure></p>\n<p>下面设置虚拟化支持在Vcenter上设置，注意设置前虚拟机必须关机;<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190704214252.png\" alt=\"WeiyiGeek.虚拟化硬件支持选项\" title=\"\" class=\"\">\n                <p>WeiyiGeek.虚拟化硬件支持选项</p>\n            </figure></p>\n<p><br></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"VMware","path":"api/categories/VMware.json"},{"name":"virtualization","path":"api/categories/virtualization.json"}],"tags":[{"name":"Vmware","path":"api/tags/Vmware.json"}]}