<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ ç£ç›˜é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ(DBA).md|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="é«˜å¯ç”¨æœåŠ¡">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>ç£ç›˜é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ(DBA).md</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">ç£ç›˜é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ(DBA).md</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-04-11T06:34:30.000Z" itemprop="datePublished" class="page-time">
  2019-04-11
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/">ç³»ç»Ÿæ¶æ„</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/%E8%BF%90%E7%BB%B4%E5%9F%BA%E7%A1%80/">è¿ç»´åŸºç¡€</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
  <article id="post-ç³»ç»Ÿè¿ç»´/ç³»ç»Ÿæ¶æ„/é«˜å¯ç”¨/ç£ç›˜é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">ç£ç›˜é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ(DBA).md</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-04-11 14:34:30" datetime="2019-04-11T06:34:30.000Z"  itemprop="datePublished">2019-04-11</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/">ç³»ç»Ÿæ¶æ„</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/%E8%BF%90%E7%BB%B4%E5%9F%BA%E7%A1%80/">è¿ç»´åŸºç¡€</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <h4 id="æ–‡ç« ç›®å½•"><a href="#æ–‡ç« ç›®å½•" class="headerlink" title="æ–‡ç« ç›®å½•"></a>æ–‡ç« ç›®å½•</h4><p>[TOC]</p>
<p>(1) drbd é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ</p>
<a id="more"></a>
<h4 id="0x00-Drbdé«˜å¯ç”¨"><a href="#0x00-Drbdé«˜å¯ç”¨" class="headerlink" title="0x00 Drbdé«˜å¯ç”¨"></a>0x00 Drbdé«˜å¯ç”¨</h4><h5 id="1-drbd-ä»‹ç»"><a href="#1-drbd-ä»‹ç»" class="headerlink" title="(1) drbd ä»‹ç»"></a>(1) drbd ä»‹ç»</h5><p>å®˜æ–¹ç½‘ç«™ï¼š<br><em>Q:ä»€ä¹ˆæ˜¯Drbdï¼Ÿ</em><br>ç­”:åˆ†å¸ƒå¼å¤åˆ¶å—è®¾å¤‡(Drbd,Dirtributed Replicated Block Device)æ˜¯åŸºäºè½¯ä»¶çš„ï¼Œæ— å…±äº«ï¼Œå¤åˆ¶çš„å­˜å‚¨è§£å†³æ–¹æ¡ˆä»¥åŠåœ¨å—è®¾å¤‡åœ¨ä¸åŒé«˜å¯ç”¨æœåŠ¡å™¨å¯¹ä¹‹é—´åŒæ­¥å’Œé•œåƒæ•°æ®è½¯ä»¶,è§£å†³ç£ç›˜å•ç‚¹æ•…éšœ(èˆ¬æƒ…å†µä¸‹åªæ”¯æŒ2ä¸ªèŠ‚ç‚¹),é€šè¿‡å®ƒå¯ç”¨å®ç°åœ¨ç½‘ç»œä¸­ä¸¤å°æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œå—è®¾å¤‡çº§åˆ«çš„å®æ—¶æˆ–å¼‚æ­¥é•œåƒæˆ–è€…åŒæ­¥å¤åˆ¶,ç±»ä¼¼rsync+inotifyæ¶æ„é¡¹ç›®è½¯ä»¶ï¼š</p>
<p><em>ä»–ä»¬ä¹‹é—´çš„å¯¹æ¯”ï¼š</em></p>
<ul>
<li>inotify -&gt;  rsyncï¼šåœ¨æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Šçš„å®é™…ç‰©ç†æ–‡ä»¶åŒæ­¥(ç£ç›˜IOæ•ˆç‡ä½ä¸‹);</li>
<li>drbdï¼šåŸºäºæ–‡ä»¶ç³»ç»Ÿåº•å±‚,blockå±‚çº§åŒæ­¥(æ•ˆç‡æ›´é«˜),ä¸€ä¸ªç”¨è½¯ä»¶å®ç°çš„ã€æ— å…±äº«çš„ã€æœåŠ¡å™¨ä¹‹é—´é•œåƒå—è®¾å¤‡å†…å®¹çš„å­˜å‚¨å¤åˆ¶è§£å†³æ–¹æ¡ˆ</li>
</ul>
<p>DRBDéœ€æ„å»ºåœ¨åº•å±‚è®¾å¤‡ä¹‹ä¸Šï¼Œç„¶åæ„å»ºå‡ºå—è®¾å¤‡ã€‚å¯¹ç”¨æˆ·æ¥è¯´DRBDè®¾å¤‡å°±åƒæ˜¯ç‰©ç†ç£ç›˜ï¼Œå¯åœ¨å…¶å†…åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿï¼›<br>Drbdæ”¯æŒçš„åº•å±‚è®¾å¤‡å—è®¾å¤‡åˆ†ç±»ï¼š</p>
<ul>
<li>ç£ç›˜åˆ†åŒº,æ•´å—ç£ç›˜</li>
<li>LVM é€»è¾‘å·</li>
<li>soft raidè®¾å¤‡</li>
<li>EVMSï¼ˆEnterprise Volume Management Systemï¼Œä¼ä¸šå·ç®¡ç†ç³»ç»Ÿï¼‰çš„å·ã€‚</li>
</ul>
<p>æ•°æ®é•œåƒï¼šå®æ—¶ã€é€æ˜ã€åŒæ­¥ï¼ˆæ‰€æœ‰æœåŠ¡å™¨éƒ½æˆåŠŸåè¿”å›ï¼‰ã€å¼‚æ­¥ï¼ˆæœ¬åœ°æœåŠ¡å™¨æˆåŠŸåè¿”å›ï¼‰ã€‚<br><br></p>
<p><strong>1.Drbdå·¥ä½œåŸç†</strong><br>drbdè½¯ä»¶å·¥ä½œåœ¨æ–‡ä»¶ç³»ç»Ÿå±‚çº§ä»¥ä¸‹,æ¯”æ–‡ä»¶ç³»ç»Ÿæ›´åŠ é è¿‘æ“ä½œç³»ç»Ÿå†…æ ¸åŠIOæ ˆ,æ‰€ä»¥drbdæ˜¯å·¥ä½œåœ¨ç³»ç»Ÿå†…æ ¸ä¹‹ä¸­çš„;ä½†å®ƒä¸èƒ½ç¥å¥‡åœ°æ·»åŠ ä¸Šå±‚çš„åŠŸèƒ½æ¯”å¦‚æ£€æµ‹åˆ°EXT3æ–‡ä»¶ç³»ç»Ÿçš„å´©æºƒ;<br>åŸç†ï¼šåŸºäºDRBDçš„é«˜å¯ç”¨(HA)ä¸¤å°æœåŠ¡å™¨ä¸»æœºä¸­,å½“æˆ‘ä»¬å°†æ•°æ®å†™å…¥(ä¸»)ç£ç›˜ä¸­æ—¶å€™æ•°æ®è¿˜å°†è¢«å‘é€åˆ°ç½‘ç»œä¸Šçš„å¦å¤–ä¸€å°ä¸»æœºä¸­(å¤‡);ä»¥ç›¸åŒçš„å½¢å¼è®°å½•åœ¨ç£ç›˜ä¹‹ä¸­,ä½¿å¾—æœ¬åœ°(Master)ä¸è¿œç¨‹ä¸»æœº(slave)çš„æ•°æ®å®æ—¶åŒæ­¥;drbdæœåŠ¡ä½œç”¨ç±»ä¼¼äºç£ç›˜é˜µåˆ—é‡Œçš„RAID1åŠŸèƒ½,å°±ç›¸å½“äºæŠŠç½‘ç»œä¸­ä¸¤å°æœåŠ¡å™¨åšæˆäº†ç±»ä¼¼äºç£ç›˜é˜µåˆ—é‡Œçš„RAID1ä¸€æ ·;</p>
<p>åœ¨é«˜å¯ç”¨æ–¹æ¡ˆ(HA)ä½¿ç”¨DRBDåŠŸèƒ½ä»£æ›¿äº†å…±äº«ç›˜é˜µ(ä¿å­˜ä¸¤ä»½-å†—ä½™æ˜¯50%),å½“Masterå‡ºç°æ•…éšœæ—¶å€™,è¿œç¨‹ä¸»æœºè¿˜ä¼šä¿ç•™æœ‰ä¸€ä»½å’Œä¸»èŠ‚ç‚¹ç›¸åŒçš„æ•°æ®å¤‡ä»½å¯ä»¥ç»§ç»­åˆ‡æ¢ä½¿ç”¨(ç›´æ¥æ¥ç®¡æä¾›æœåŠ¡,é™ä½å²©æœºä¿®å¤æ—¶é—´),è€Œä¸ä¼šå‘ä¸æ•…éšœå‰æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜;</p>
<p>å·¥ä½œåŸç†å›¾:<br><figure class="image-box">
                <a rel=ç£ç›˜é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ(DBA).md href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190411123732.png" target="_blank" title="WeiyiGeek.drbdå·¥ä½œåŸç†å›¾" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190411123732.png" alt="WeiyiGeek.drbdå·¥ä½œåŸç†å›¾" title="" class=""></a>
                <p>WeiyiGeek.drbdå·¥ä½œåŸç†å›¾</p>
            </figure></p>
<p><em>ä¸€èˆ¬æƒ…å†µä¸‹æ–‡ä»¶å†™å…¥ç£ç›˜çš„æ­¥éª¤æ˜¯:</em><br>å†™æ“ä½œ â€“&gt; æ–‡ä»¶ç³»ç»Ÿ â€“&gt; å†…å­˜ç¼“å­˜ä¸­ â€“&gt; ç£ç›˜è°ƒåº¦å™¨ â€“&gt; ç£ç›˜é©±åŠ¨å™¨ â€“&gt; å†™å…¥ç£ç›˜ ; è€ŒDRBDçš„å·¥ä½œæœºåˆ¶å¦‚ä¸Šå›¾æ‰€ç¤ºæ•°æ®ç»è¿‡buffer cacheåæœ‰å†…æ ¸ä¸­çš„DRBDæ¨¡å—(å¤åˆ¶å†™å…¥ç£ç›˜çš„æ•°æ®)é€šè¿‡tcp/ipåè®®æ ˆç»è¿‡ç½‘å¡å’Œå¯¹æ–¹æœåŠ¡å™¨DRBDæœåŠ¡å»ºç«‹æ•°æ®åŒæ­¥ã€‚</p>
<p><br></p>
<p><strong>2.Drbdå·¥ä½œæ¨¡å¼ä¸åè®®</strong><br>å½“æŸä¸€è¿›ç¨‹å¯¹æŸä¸€æ–‡ä»¶æ‰§è¡Œäº†å†™æ“ä½œæ—¶ï¼Œå†™æ“ä½œåœ¨ä¸Šå›¾æ‰§è¡Œåˆ°é‚£ä¸ªè¿‡ç¨‹æ—¶å°±è®¤ä¸ºæ–‡ä»¶å·²ç»åŒæ­¥å®Œæˆã€‚</p>
<p><em>Drbdçš„ä¸‰ç§åŒæ­¥å¤åˆ¶åè®®:</em><br>åè®®çš„é€‰æ‹©å°†å½±å“æµé‡,ä»è€Œå½±å“ç½‘ç»œå»¶æ—¶;</p>
<ul>
<li>åè®®Aï¼šå¼‚æ­¥ asynchronous å¤åˆ¶åè®®(æœ¬åœ°å†™å…¥æˆåŠŸåç«‹å³è¿”å›,dataæ”¾åœ¨å‘é€çš„bufferä¸­,å¯èƒ½ä¼šä¸¢å¤±)<br>  å¦‚ä¸Šå›¾æ–‡ä»¶å†™æ“ä½œæ‰§è¡Œåˆ°Aç‚¹æ˜¯å°±è®¤ä¸ºå†™å…¥ç£ç›˜æˆåŠŸ(æ€§èƒ½å¥½/ä½†æ˜¯æ•°æ®å¯é æ€§å·®)</li>
<li>åè®®Bï¼šå†…å­˜åŒæ­¥(åŠåŒæ­¥ Semi sync )å¤åˆ¶åè®®(æœ¬åœ°å†™å…¥æˆåŠŸå¹¶å°†æ•°æ®å‘é€åˆ°å¯¹æ–¹åç«‹å³è¿”å›,å¦‚æœåŒæœºæ‰ç”µæ•°æ®ä¸¢å¤±)<br> å¦‚ä¸Šå›¾æ–‡ä»¶å†™æ“ä½œæ‰§è¡Œåˆ°Bç‚¹æ˜¯å°±è®¤ä¸ºå†™å…¥ç£ç›˜æˆåŠŸã€‚æ€§èƒ½å¥½ï¼Œæ•°æ®å¯é æ€§ä»‹äºAå’ŒCä¹‹é—´ã€‚</li>
<li>åè®®Cï¼šåŒæ­¥å¤åˆ¶åè®®(sync),æœ¬åœ°å’Œå¯¹ç«¯æœåŠ¡å™¨ç£ç›˜éƒ½å†™å…¥æˆåŠŸç¡®è®¤åè¿”å›æˆåŠŸ(å¦‚æœå•æœºç”µå’Œå•æœºç£ç›˜æŸååˆ™æ•°æ®ä¸ä¼šä¸¢å¤±),drbdé»˜è®¤ä½¿ç”¨çš„å¤åˆ¶åè®®;<br>  å¦‚ä¸Šå›¾æ–‡ä»¶å†™æ“ä½œæ‰§è¡Œåˆ°Cç‚¹æ˜¯å°±è®¤ä¸ºå†™å…¥ç£ç›˜æˆåŠŸã€‚æ€§èƒ½å·®ï¼Œæ•°æ®å¯é æ€§é«˜ã€‚</li>
</ul>
<p><em>Drbdæ”¯æŒçš„ä¸¤ç§æ¨¡å¼ï¼š</em></p>
<ol>
<li>å®æ—¶åŒæ­¥æ¨¡å¼<br>å½“æ•°æ®å†™å…¥åˆ°æœ¬åœ°ç£ç›˜å’Œè¿œç«¯æ‰€æœ‰æœåŠ¡å™¨ç£ç›˜éƒ½æˆåŠŸåæ‰ä¼šè¿”å›æˆåŠŸå†™å…¥;é˜²æ­¢æœ¬åœ°ä¸è¿œç«¯çš„æ•°æ®ä¸¢å¤±ä¸ä¸€è‡´,ç”Ÿäº§ç¯å¢ƒä¸­å¸¸ç”¨(DRBDæœåŠ¡åè®®Cçº§åˆ«å³è¯¥ç§åŒæ­¥æ¨¡å¼)</li>
<li>å¼‚æ­¥åŒæ­¥æ¨¡å¼<br>å½“æ•°æ®å†™å…¥åˆ°æœ¬åœ°æœåŠ¡å™¨æˆåŠŸåå°±è¿”å›æˆåŠŸå†™å…¥,ä¸ç®¡è¿œç«¯æœåŠ¡æ­»å¦å†™å…¥æˆåŠŸ;è¿˜å¯èƒ½æ˜¯æ•°æ®å†™å…¥åˆ°æœ¬åœ°æœåŠ¡å™¨æˆ–è¿œç«¯çš„BufferæˆåŠŸåè¿”å›;(DRBDæœåŠ¡åè®®a/bçº§åˆ«)</li>
</ol>
<p>æç¤ºï¼šnfsç½‘ç»œç³»ç»Ÿæ–‡ä»¶ä¹Ÿæœ‰ç±»ä¼¼çš„å‚æ•°(sync/async)ä¸åŠŸèƒ½;å®æ—¶åŒæ­¥ä¸å¼‚æ­¥åŒæ­¥;</p>
<p><em>DRBDçš„å·¥ä½œæ¨¡å¼:</em></p>
<ol>
<li>ä¸»ä»æ¨¡å‹ master/slaveï¼ˆprimary/secondaryï¼‰ | å•ä¸»æ¨¡å¼<br>åœ¨æŸä¸€æ—¶åˆ»åªå…è®¸æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹,ä¸»èŠ‚ç‚¹çš„ä½œç”¨æ˜¯å¯ä»¥æŒ‚åœ¨ä½¿ç”¨ä¸å†™å…¥æ•°æ®ç­‰ï¼›ä»èŠ‚ç‚¹çŸ¥è¯†ä½œä¸ºä¸»èŠ‚ç‚¹çš„é•œåƒæ˜¯ä¸»èŠ‚ç‚¹çš„å¤‡ä»½ã€‚</li>
</ol>
<ul>
<li>ä¼˜ç‚¹ï¼šæœ‰æ•ˆçš„é¿å…ç£ç›˜å‡ºç°å•ç‚¹æ•…éšœ,æ–‡ä»¶ç³»ç»Ÿä¸ä¼šé”™ä¹±</li>
<li>ç¼ºç‚¹ï¼š ä¸»èŠ‚ç‚¹è¯»å–/ä½¿ç”¨,è€Œå¤‡èŠ‚ç‚¹åªåšå¤‡ä»½ä½¿ç”¨(ä¸èƒ½åŒä¸Šè¿›è¡Œè¯»å–/å†™å…¥)å¯¼è‡´èµ„æºçš„æµªè´¹</li>
</ul>
<figure class="image-box">
                <a rel=ç£ç›˜é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ(DBA).md href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190411150931.png" target="_blank" title="WeiyiGeek.ä¸»å¤‡æ¨¡å¼" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190411150931.png" alt="WeiyiGeek.ä¸»å¤‡æ¨¡å¼" title="" class=""></a>
                <p>WeiyiGeek.ä¸»å¤‡æ¨¡å¼</p>
            </figure>
<ol start="2">
<li>åŒä¸»æ¨¡å‹ dula primary(primary/primary)[DRBD8.0ä¹‹åçš„æ–°ç‰¹æ€§]<br>æ‰€è°“åŒä¸»æ¨¡å‹æ˜¯2ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥å½“åšä¸»èŠ‚ç‚¹æ¥æŒ‚è½½ä½¿ç”¨;éœ€è¦é‡‡ç”¨å…±äº«çš„clusteræ–‡ä»¶ç³»ç»Ÿ,å¦‚GFSå’ŒOCFS2ç”¨äºéœ€è¦ä»2ä¸ªèŠ‚ç‚¹å¹¶å‘è®¿é—®æ•°æ®çš„åœºåˆ,éœ€è¦ç‰¹åˆ«é…ç½®;</li>
</ol>
<figure class="image-box">
                <a rel=ç£ç›˜é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ(DBA).md href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190411151016.png" target="_blank" title="WeiyiGeek.ä¸»ä¸»æ¨¡å¼" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190411151016.png" alt="WeiyiGeek.ä¸»ä¸»æ¨¡å¼" title="" class=""></a>
                <p>WeiyiGeek.ä¸»ä¸»æ¨¡å¼</p>
            </figure>
<p><em>é‚£ä¹ˆæ€è€ƒå½“ç¬¬ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯¹æŸä¸€æ–‡ä»¶æ­£åœ¨æ‰§è¡Œå†™æ“ä½œï¼Œæ­¤æ—¶å¦ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿæ­£åœ¨å¯¹åŒä¸€æ–‡ä»¶ä¹Ÿè¦æ‰§è¡Œå†™æ“ä½œï¼Œç»“æœä¼šå¦‚ä½•å‘¢ï¼Ÿ</em><br>ç­”ï¼šä¸€èˆ¬è¿™ç§æƒ…å†µä¼šé€ æˆæ–‡ä»¶ç³»ç»Ÿçš„é”™ä¹±ï¼Œå¯¼è‡´æ•°æ®ä¸èƒ½æ­£å¸¸ä½¿ç”¨ã€‚<br>åŸå› æ˜¯ï¼šå¯¹æ–‡ä»¶çš„åŠ é€Ÿæœºåˆ¶æ˜¯ç”±æ“ä½œç³»ç»Ÿå†…æ ¸æ‰€ç®¡ç†çš„ï¼Œä¸€ä¸ªèŠ‚ç‚¹å¯¹æ–‡ä»¶åŠ é€Ÿä¹‹åï¼Œå¦ä¸€ä¸ªèŠ‚ç‚¹å¹¶ä¸çŸ¥é“å¯¹æ–¹çš„é”ä¿¡æ¯ã€‚<br>è§£å†³åŠæ³•æ˜¯ï¼šä½¿ç”¨é›†ç¾¤æ–‡ä»¶ç³»ç»Ÿ,é›†ç¾¤æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨åˆ†å¸ƒå¼æ–‡ä»¶é”ç®¡ç†å™¨ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹å¯¹æ–‡ä»¶åŠ é”ä¹‹åä¼šé€šè¿‡æŸç§æœºåˆ¶æ¥é€šçŸ¥å…¶ä»–èŠ‚ç‚¹é”ä¿¡æ¯ï¼Œä»è€Œå®ç°æ–‡ä»¶é”å…±äº«ã€‚</p>
<p><em>è¡¥å……çŸ¥è¯†ç‚¹:</em><br>Oracleçš„dgæœåŠ¡æ¨¡å¼åˆ†ä¸ºä¸¤ç§</p>
<ul>
<li>ä¸€ç§æ˜¯é€»è¾‘ä¸Šå¦‚SQLè¯­å¥æ‰§è¡Œæ–¹æ³•,8i~10g å¤‡èŠ‚ç‚¹ä¸æä¾›æœåŠ¡</li>
<li>å¦ä¸€ç§å°±æ˜¯ç‰©ç†çš„å¦‚blockå—çº§æ¨¡å¼,Oracle 11g æ”¯æŒä¸»åº“å†™ä»åº“è¯»çš„æ–¹å¼</li>
</ul>
<hr>

<h5 id="2-drbd-åº”ç”¨åœºæ™¯"><a href="#2-drbd-åº”ç”¨åœºæ™¯" class="headerlink" title="(2) drbd åº”ç”¨åœºæ™¯"></a>(2) drbd åº”ç”¨åœºæ™¯</h5><p>ç”Ÿäº§ç¯å¢ƒä¸­Drbdå¸¸ç”¨äºé«˜å¯ç”¨æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®åŒæ­¥è§£å†³æ–¹æ¡ˆ;<br>å¦‚Heartbeat + drbd  + nfs/mfs/gfs ; heartbeat + drbd + mysql/Oracleç­‰ç­‰,å®é™…ä¸Šå¯ä»¥ç»“åˆä»»æ„éœ€è¦æ•°æ®åŒæ­¥çš„æ‰€æœ‰æœåŠ¡çš„åº”ç”¨åœºæ™¯;</p>
<p><em>ç›¸å…³æ•°æ®åŒæ­¥å·¥å…·ä»‹ç»:</em><br>(1) rsync [å®æ—¶åŒæ­¥å·¥å…·,ä½†æ•ˆç‡ä¸é«˜]<br>(2) scp [å®æ—¶åŒæ­¥å·¥å…·,ä½†æ•ˆç‡ä¸é«˜]<br>(3) nc / nfs (ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ)<br>(4) union åŒæœºåŒæ­¥<br>(5) csync2 å¤šæœºåŒæ­¥<br>(6) è½¯è‡ªèº«åŒæ­¥æœºåˆ¶ (<code>mysql,oracle,mongdb,ttserver,redis</code>) æ–‡ä»¶æ”¾åˆ°æ•°æ®åº“,åŒæ­¥åˆ°ä»åº“å†æŠŠæ–‡ä»¶æ‹¿å‡ºæ¥;<br>(7) drbd é«˜å¯ç”¨</p>
<hr>

<h5 id="3-drbdçš„å®‰è£…"><a href="#3-drbdçš„å®‰è£…" class="headerlink" title="(3) drbdçš„å®‰è£…"></a>(3) drbdçš„å®‰è£…</h5><p>Drbdè½¯ä»¶åˆ†ç±»ï¼š</p>
<ul>
<li>Centos5.x é€‚åˆdrbd 8.3 YUM</li>
<li>Centos6.x é€‚åˆdrbd 8.4 </li>
<li>Centos7.x é€‚åˆæºç ç¼–è¯‘å®‰è£…</li>
</ul>
<p>é…ç½®ç›®æ ‡ï¼šä¸¤å°æœåŠ¡å™¨åˆ†åˆ«é…ç½®å·drbdæœåŠ¡,å®ç°Master-data1æœºå™¨ä¸Š/dev/sdb/åˆ†åŒºä¸Šå†™å…¥æ•°æ®,æ•°æ®ä¼šå®æ—¶åŒæ­¥åˆ°Master-data2jæœºå™¨ä¸Š;ä¸€æ—¦æœåŠ¡å™¨å‡ºç°å¼‚å¸¸,ç¬é—´æ¥æ›¿æŸåæ•°æ®æˆ–å®•æœºçš„æœºå™¨,å®ç°æ•°æ®å¼‚æœºå®æ—¶åŒæ­¥,è¾¾åˆ°æ•°æ®é«˜å¯ç”¨æ— ä¸šåŠ¡å½±å“çš„ç›®çš„;</p>
<p><em>é…ç½®æç¤ºï¼š</em></p>
<ul>
<li>é…ç½®çš„æ˜¯drbdä¸»å¤‡æ¨¡å¼,åŠåº”ç”¨æ—¶åªåœ¨ä¸»çš„ä¸€ç«¯å†™å…¥æ•°æ®,å¤‡çš„ä¸€ç«¯ä»…å¤„äºæ•°æ®çƒ­å¤‡çŠ¶æ€;</li>
<li>å¤‡èŠ‚ç‚¹drbdçš„åˆ†åŒºæ˜¯ä¸å¯è§çš„,ä¹Ÿæ˜¯å¤„äºéæ´»åŠ¨çŠ¶æ€,ä¸èƒ½äººä¸ºå†™å…¥æ•°æ®; </li>
<li>å¤šdrbdåˆ†åŒºä¸»ä¸»åŒå‘åŒæ­¥æ¨¡å¼,åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­é…ç½®æˆä¸ºä¸»ä¸»æ¨¡å¼å³å¦‚ä¸Šé¢å›¾æ‰€ç¤ºï¼š</li>
</ul>
<p>drbd æœåŠ¡ç½‘å¡ä»¥åŠèµ„æºé…ç½®:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##æœºå™¨1 Master-data1 </span></span><br><span class="line">ç®¡ç†IP ï¼š               ETH1:192.168.1.100/24</span><br><span class="line">DRBDç®¡ç†åç§°ä¸æŒ‚è½½ç›®å½•:  data /data</span><br><span class="line">DRBDé€»è¾‘è®¾å¤‡:           /dev/drbd0             <span class="comment">#å…³é”®ç‚¹</span></span><br><span class="line">å¿ƒè·³è¿æ¥ä»¥åŠæ•°æ®åŒæ­¥ï¼š   ETH2:192.168.2.100/24  <span class="comment">#ä¸è¦é…ç½‘å…³/ä¹Ÿä¸è¦ä¸å±€åŸŸç½‘å†…å…¶ä»–æœºå™¨èµ·å†²çª</span></span><br><span class="line">DRBD å­˜å‚¨è®¾å¤‡ï¼š         /dev/sdb1</span><br><span class="line">DRBD Metaè®¾å¤‡ï¼š         /dev/sdb2[0]</span><br><span class="line">è™šæ‹ŸIP(VIP) ï¼š          ETH1:192.168.1.10</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##æœºå™¨2 Master-data2 </span></span><br><span class="line">ç®¡ç†IP ï¼š               ETH1:192.168.1.101/24</span><br><span class="line">DRBDç®¡ç†åç§°ä¸æŒ‚è½½ç›®å½•:  data /data</span><br><span class="line">DRBDé€»è¾‘è®¾å¤‡:           /dev/drbd0             <span class="comment">#å…³é”®ç‚¹ é€šè¿‡ é€»è¾‘è®¾å¤‡å†™åˆ°ç£ç›˜é‡Œé¢</span></span><br><span class="line">å¿ƒè·³è¿æ¥ä»¥åŠæ•°æ®åŒæ­¥ï¼š   ETH2:192.168.2.101/24  <span class="comment">#ä¸è¦é…ç½‘å…³/ä¹Ÿä¸è¦ä¸å±€åŸŸç½‘å†…å…¶ä»–æœºå™¨èµ·å†²çª</span></span><br><span class="line">DRBD å­˜å‚¨è®¾å¤‡ï¼š         /dev/sdb1</span><br><span class="line">DRBD Metaè®¾å¤‡ï¼š         /dev/sdb2[0]</span><br><span class="line">è™šæ‹ŸIP(VIP) ï¼š          ETH1:192.168.1.11</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¨èæ“ä½œã€æŠŠå¿ƒè·³åœ°å€å†™å…¥/etc/hostsæ–‡ä»¶ä¸­ã€‘</span></span><br><span class="line">192.168.2.100 Master-data1</span><br><span class="line">192.168.2.101 Master-data2</span><br></pre></td></tr></table></figure></p>
<p>å®‰è£…ç¯å¢ƒï¼šCentOS release 6.10 (Final) - åŸºç¡€ç¯å¢ƒæ“ä½œå‚çœ‹<a href="./2019/04/09/%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9C%8D%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-dba-md.html">é«˜å¯ç”¨æœåŠ¡è§£å†³æ–¹æ¡ˆ(DBA)</a></p>
<p>DRBD é…ç½®æ­¥éª¤ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1. å®‰è£…drbdä»¥åŠç£ç›˜åˆ†åŒº,åŠ è½½modproedå†…æ ¸</span><br><span class="line">2. é…ç½®èµ„æºæ–‡ä»¶ï¼ˆå®šä¹‰èµ„æ–™åç§°ï¼Œç£ç›˜ï¼ŒèŠ‚ç‚¹ä¿¡æ¯ï¼ŒåŒæ­¥é™åˆ¶ç­‰ï¼‰</span><br><span class="line">3. å°†drbdåŠ å…¥åˆ°ç³»ç»ŸæœåŠ¡chkconfig --add drbd </span><br><span class="line">4. åˆå§‹åŒ–èµ„æºç»„ drbdadm create-md resource_name</span><br><span class="line">5. å¯åŠ¨æœåŠ¡ service drbd start</span><br><span class="line">6. è®¾ç½®primaryä¸»æœºå¹¶åŒæ­¥æ•°æ®</span><br><span class="line">7. åˆ†åŒºã€æ ¼å¼åŒ–&#x2F;dev&#x2F;drbd*</span><br><span class="line">8. ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡ŒæŒ‚è½½</span><br><span class="line">9. æŸ¥çœ‹çŠ¶æ€cat &#x2F;proc&#x2F;drbd</span><br></pre></td></tr></table></figure></p>
<p>DRBD å®‰è£…æµç¨‹ï¼š(è·³è¿‡ä¸Šé¢é…ç½®IPä¸hostsæ–‡ä»¶,æ·»åŠ ä¸»æœºè·¯ç”±)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###### Step 1. å…¬å…±å®‰è£…#########</span></span><br><span class="line">service iptables stop                       //å…³é—­iptables</span><br><span class="line">setenforcing 0                                 //æš‚æ—¶å…³é—­selinux</span><br><span class="line">sed -i <span class="string">'s/SELINUX=enforcing/SELINUX=disabled/'</span> /etc/sysconfig/selinux      //æ°¸ä¹…å…³é—­selinux</span><br><span class="line">ntpdate -u asia.pool.ntp.org <span class="comment"># æ—¶é—´åŒæ­¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###### Step 2. drbdæœåŠ¡å®‰è£… (ç¼–è¯‘å®‰è£…/yumå®‰è£…)########</span></span><br><span class="line"><span class="comment">#drbdå…±æœ‰ä¸¤éƒ¨åˆ†ç»„æˆï¼šå†…æ ¸æ¨¡å—å’Œç”¨æˆ·ç©ºé—´çš„ç®¡ç†å·¥å…·ã€‚</span></span><br><span class="line"><span class="comment">#å…¶ä¸­drbdå†…æ ¸æ¨¡å—ä»£ç å·²ç»æ•´åˆè¿›Linuxå†…æ ¸2.6.33ä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œå› æ­¤å¦‚æœå†…æ ¸ç‰ˆæœ¬é«˜äºæ­¤ç‰ˆæœ¬çš„è¯ï¼Œåªéœ€è¦å®‰è£…ç®¡ç†å·¥å…·å³å¯ï¼›å¦åˆ™æ‚¨éœ€è¦åŒæ—¶å®‰è£…å†…æ ¸æ¨¡å—å’Œç®¡ç†å·¥å…·ä¸¤ä¸ªè½¯ä»¶åŒ…ï¼Œå¹¶ä¸”æ­¤ä¸¤è€…çš„ç‰ˆæœ¬å·ä¸€å®šè¦ä¿æŒå¯¹åº”ã€‚</span></span><br><span class="line"><span class="comment">#yum å®‰è£…éœ€è¦æ‰¾åˆ°ç›¸åº”çš„æº </span></span><br><span class="line">[root@Master-data1/2 drbd]$ rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br><span class="line">[root@Master-data1/2 drbd]$ yum install https://www.elrepo.org/elrepo-release-6-8.el6.elrepo.noarch.rpm</span><br><span class="line"><span class="comment">#yum install https://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm (external link)</span></span><br><span class="line"><span class="comment">#keepcache = 1 yumé…ç½®æ–‡ä»¶å°±ä¼šä¿å­˜ä¸‹è½½çš„rpm</span></span><br><span class="line">$ yum makecache</span><br><span class="line">$ yum install kernel-devel kernel-header flex drbd84-utils kmod-drbd84  parted -y</span><br><span class="line">Installed:</span><br><span class="line">  drbd84-utils.i686 0:9.5.0-1.el6.elrepo              flex.i686 0:2.5.35-9.el6</span><br><span class="line">  kernel-devel.i686 0:2.6.32-754.12.1.el6             kmod-drbd84.i686 0:8.4.11-1.el6_10.elrepo</span><br><span class="line">Complete!  <span class="comment">#è¡¨ç¤ºå®‰è£…æˆåŠŸ</span></span><br><span class="line"><span class="comment">### å¿½ç•¥ä»¥ä¸‹å†…å®¹</span></span><br><span class="line"><span class="comment"># å¯¹åº”çš„å†…æ ¸æ¨¡å—çš„åå­—åˆ†åˆ«ä¸º drbd-kmod</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šdrbdå’Œdrbd-kmdlçš„ç‰ˆæœ¬è¦å¯¹åº”ï¼›å¦ä¸€ä¸ªæ˜¯drbd-kmdlçš„ç‰ˆæœ¬è¦ä¸å½“å‰ç³»ç»Ÿçš„å†…æ ¸ç‰ˆæœ¬(uname -r)ç›¸å¯¹åº”ã€‚</span></span><br><span class="line"><span class="comment">#ä¸‹è½½åœ°å€ï¼š http://www.rpmfind.net/linux/atrpms/el6-x86_64/atrpms/stable/</span></span><br><span class="line"><span class="comment">#          https://www.linbit.com/en/drbd-community/drbd-download/</span></span><br><span class="line"><span class="comment"># [root@Master-data2 drbd]# wget https://www.linbit.com/downloads/drbd/utils/drbd-utils-9.6.0.tar.gz</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############ Step3. åŠ è½½æ¨¡å—åˆ°å†…æ ¸ ###########</span></span><br><span class="line">[root@Master-data1/2 ]$ modprobe drbd &amp;&amp; lsmod | grep drbd  <span class="comment">#ä¸´æ—¶ç”Ÿæ•ˆ,é‡å¯ç”±éœ€è¦æ·»åŠ  å¯ç”¨åŠ å…¥åˆ° /etc/rc.local</span></span><br><span class="line">drbd                  485533  0</span><br><span class="line">libcrc32c                841  1 drbd</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"modprobe drbd"</span> &gt;&gt; /etc/rc.d/rc.local  <span class="comment">#åŠ è½½drbdåˆ°å†…æ ¸</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"modprode drbd &gt; /dev/null 2&gt;&amp;1"</span> &gt; /etc/sysconfig/modules/drbd.modules</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">####### Step4. å»ºç«‹ä¸€ä¸ªç£ç›˜åˆ†åŒº  #######</span></span><br><span class="line"><span class="comment">#ã€é‡è¦ã€‘éœ€è¦VirtualBoxä¸ºè™šæ‹Ÿæœºæ·»åŠ ä¸€å—ç£ç›˜ é€‰æ‹©ç£ç›˜æ ¼å¼ä¸º SCSI åˆ†é… 0.5 GB</span></span><br><span class="line">ä¸»èŠ‚ç‚¹ï¼š512MB </span><br><span class="line">å¤‡èŠ‚ç‚¹ï¼š1024MB</span><br><span class="line"></span><br><span class="line">[root@Master-data1/data2 ~]$ fdisk -l</span><br><span class="line">Disk /dev/sda: 536 MB, 536870912 bytes</span><br><span class="line">Disk /dev/sda: 1073 MB, 1073741824 bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># drbdæœåŠ¡ éœ€è¦åˆ›å»ºä¸¤ä¸ªåˆ†åŒº</span></span><br><span class="line">/dev/sdb1  /data           å­˜å‚¨æ•°æ®ç›®å½•           256MB / 768MB (æ•°)</span><br><span class="line">/dev/sdb2  mete dataåˆ†åŒº   å­˜å‚¨drbdåŒæ­¥ä¿¡æ¯    æ€»å¤§å°å‡å»ä¸Šé¢çš„å¤§å°</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼š</span></span><br><span class="line">1.è¿™é‡Œçš„meta data åˆ†åŒºä¸€å®šä¸èƒ½ä¸ªæ•°å»ºç«‹æ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line">2.åˆ†æµ©çš„åˆ†åŒºç°åœ¨ä¸èƒ½è¿›è¡ŒæŒ‚è½½(mount)</span><br><span class="line">3.ç”Ÿäº§ç¯å¢ƒä¸­DRBD meta data åˆ†åŒºä¸€èˆ¬è®¾ç½®ä¸º1~2G</span><br><span class="line"></span><br><span class="line"><span class="comment">#ã€æ³¨æ„ã€‘ åˆ†åŒºæ­¥éª¤ ï¼ˆæ³¨æ„å¦‚æœ raid ç£ç›˜é˜µåˆ— è¶…è¿‡2T è¯¥å‘½ä»¤ä¸èƒ½ä½¿ç”¨ è¯·æ˜¯ä½¿ç”¨ partedï¼‰</span></span><br><span class="line">[root@Master-data1 ~]<span class="comment"># fdisk /dev/sda</span></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): p</span><br><span class="line">Disk /dev/sda: 536 MB, 536870912 bytes</span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">p</span><br><span class="line">Partition number (1-4): 1 <span class="comment">#æ³¨æ„åˆ†åŒºç¼–å·1</span></span><br><span class="line">First cylinder (1-512, default 1): 1</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1-512, default 512): +256M</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">p</span><br><span class="line">Partition number (1-4): 2  <span class="comment">#æ³¨æ„è¿™é‡Œæ˜¯2</span></span><br><span class="line">First cylinder (386-512, default 386): <span class="comment">#é»˜è®¤å›è½¦å³å¯</span></span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (386-512, default 512):</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): p  <span class="comment">#æ˜¾ç¤ºåˆ†åŒºä¿¡æ¯</span></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1               1         385      394224   83  Linux   <span class="comment">#å­˜å‚¨æ•°æ® 256</span></span><br><span class="line">/dev/sdb2             386         512      130048   83  Linux   <span class="comment">#drbdçŠ¶æ€ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">w <span class="comment">#åˆ†åŒºå†™å…¥</span></span><br><span class="line"></span><br><span class="line">[root@Master-data2 ~]$ fdisk /dev/sda  <span class="comment">#åŒä¸Š</span></span><br><span class="line">Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1               1          99      795186   83  Linux  <span class="comment">#768M</span></span><br><span class="line">/dev/sdb2             100         130      249007+  83  Linux  <span class="comment">#ç¼ºçœå°±è¡Œ(å›è½¦)</span></span><br><span class="line"></span><br><span class="line">$ partprobe <span class="comment">#æ‰§è¡Œå†™å…¥åˆ†åŒºè¡¨åˆ·æ–°ç£ç›˜</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####### Step5.[åˆ†åŒºå®Œæˆåå¯èƒ½éœ€è¦é‡å¯] ä¸‹é¢ä¸éœ€è¦æ“ä½œ ##########</span></span><br><span class="line"><span class="comment"># åœ¨ä¸¤ç«¯ä¸»æœºå†…åˆ›å»ºåˆ†åŒºï¼š å‡ºç°5æœˆ 14 14:57:19 Mzabbix drbd[4097]: adjust disk: data:failed(apply-al:1)é”™è¯¯æ—¶å€™æ–¹æ³•</span></span><br><span class="line"><span class="comment"># æ•°æ®åŒºï¼š     parted /dev/sda mklabel gpt &amp;&amp; parted /dev/sdb mkpart logical ext4 700M 300M</span></span><br><span class="line"><span class="comment">#é‡è¯»åˆ†åŒºï¼š  partprobe &amp;&amp; cat /proc/partions</span></span><br><span class="line"><span class="comment">#æ•°æ®ç›˜/dev/sdb1è¿›è¡Œæ ¼å¼åŒ–  #metaç›˜/dev/sdb2ä¸ç”¨è¿›è¡Œæ ¼å¼åŒ–ç›´æ¥æŒ‚è½½</span></span><br><span class="line">[root@Master-data1/2 ~]$ mkfs.ext4 /dev/sda1   <span class="comment">#æ‰§è¡Œçš„æ—¶å€™æ³¨æ„è‡ªå·±çš„ç£ç›˜åç§°(å·¨å‘)</span></span><br><span class="line"><span class="comment"># tune2fs -c -1 /dev/sdb1  #è®©ç£ç›˜è¢«è¢«æ£€æµ‹</span></span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=ç£ç›˜é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ(DBA).md href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190411153955.png" target="_blank" title="WeiyiGeek.å»ºç«‹ä¸€ä¸ªç£ç›˜åˆ†åŒº" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190411153955.png" alt="WeiyiGeek.å»ºç«‹ä¸€ä¸ªç£ç›˜åˆ†åŒº" title="" class=""></a>
                <p>WeiyiGeek.å»ºç«‹ä¸€ä¸ªç£ç›˜åˆ†åŒº</p>
            </figure></p>
<p><br><br><strong>è¡¥å……ï¼šdrbdç£ç›˜é‡‡ç”¨partedåˆ†åŒº[master/slaveéƒ½æ‰§è¡Œ]</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#BACKUP æœºå™¨ä¸Š,åˆ†åŒºå¤§å°ä¸åŒæ˜¯æœ‰ç›®çš„çš„ï¼Œä¸ºåé¢çš„æ‰©å®¹åšå‡†å¤‡;</span></span><br><span class="line">[root@data2 ~]$ fdisk -l <span class="comment">#æŸ¥çœ‹æœ¬åœ°ç£ç›˜</span></span><br><span class="line">[root@data2 ~]$ parted /dev/sdb mkpart primary 0 600</span><br><span class="line">[root@data2 ~]$ parted /dev/sdb mkpart primary 600 1073</span><br><span class="line">[root@data2 ~]$ parted /dev/sdb p</span><br><span class="line">Number  Start   End     Size   File system  Name     Flags</span><br><span class="line"> 1      17.4kB  600MB   600MB               primary</span><br><span class="line"> 2      600MB   1073MB  473MB               primary</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¹äºæ–°æ·»åŠ çš„ç£ç›˜å¿«é€Ÿåˆ†åŒºæ–¹æ³•</span></span><br><span class="line"><span class="comment"># echo -e "n\np\nl\n\n+600M\nn\np\n2\n\n+400M\nw" | fdisk /dev/sdb</span></span><br><span class="line">partprobe <span class="comment">#æ‰§è¡Œå†™å…¥åˆ†åŒºè¡¨åˆ·æ–°ç£ç›˜ #[é‡ç‚¹]ä¸é‡å¯ç³»ç»Ÿæ·»åŠ ç£ç›˜å¹¶è®©kernelè¯»å–åˆ†åŒºä¿¡æ¯ yum -y install parted</span></span><br></pre></td></tr></table></figure></p>
<h5 id="4-drbdçš„é…ç½®æ–‡ä»¶"><a href="#4-drbdçš„é…ç½®æ–‡ä»¶" class="headerlink" title="(4) drbdçš„é…ç½®æ–‡ä»¶"></a>(4) drbdçš„é…ç½®æ–‡ä»¶</h5><p>ä¿®æ”¹é…ç½®æ–‡ä»¶æµç¨‹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########## Step 5. é»˜è®¤é…ç½®æ–‡ä»¶ä¸ç›®å½• ###############</span></span><br><span class="line">global &#123;</span><br><span class="line">    usage-count no;  <span class="comment">#æ˜¯å¦å‚åŠ DRBDä½¿ç”¨è€…ç»Ÿè®¡ï¼Œé»˜è®¤æ˜¯å‚åŠ </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">common &#123;</span><br><span class="line">    protocol C;    </span><br><span class="line">    startup &#123;</span><br><span class="line">        degr-wfc-timeout 240;</span><br><span class="line">    &#125;</span><br><span class="line">    disk &#123;</span><br><span class="line">        on-io-error detach;</span><br><span class="line">    &#125;</span><br><span class="line">    net &#123; </span><br><span class="line">        cram-hmac-alg md5; <span class="comment">#DRBDåŒæ­¥æ—¶ä½¿ç”¨çš„éªŒè¯æ–¹å¼å’Œå¯†ç </span></span><br><span class="line">        shared-secret <span class="string">"testdrbd"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    syncer &#123;</span><br><span class="line">        rate 100M;      <span class="comment">#ä¸»èŠ‚ç‚¹å’Œå¤‡ç”¨èŠ‚ç‚¹åŒæ­¥æ—¶æœ€å¤§çš„ç½‘ç»œé€Ÿç‡ å·¥ä½œä¸­æ˜¯100M~1000M</span></span><br><span class="line">        verify-alg crc32c; <span class="comment">#éªŒè¯ç®—æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#èµ„æºè®¾ç½®</span></span><br><span class="line">resource data&#123;</span><br><span class="line">    disk &#123;</span><br><span class="line">        on-io-error detach;  <span class="comment">#ç£ç›˜å‡ºç°IOé”™è¯¯å¤„ç†</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#ä¸¤å°ä¸»å¤‡èŠ‚ç‚¹é…ç½® (å…³é”®ç‚¹)</span></span><br><span class="line">    on Mzabbix &#123;</span><br><span class="line">        device /dev/drbd0;  <span class="comment">#drbdå†™è®¾å¤‡æœ‰è‡ªå·±å¯¹åº”çš„åˆ†åŒº</span></span><br><span class="line">        disk /dev/sdb1;        <span class="comment">#æœ¬åœ°æ•°æ®åˆ†åŒº1</span></span><br><span class="line">        address  192.168.56.103:7788;  <span class="comment">#å¿ƒè·³/æ•°æ®ä¼ è¾“æ¥å£ (å»ºè®®æŠŠè¿™ä¸ªåœ°å€è®¾ç½®åˆ°hostsä¸­æ”¹æˆå¿ƒè·³çº¿çš„ç½‘å¡)</span></span><br><span class="line">        meta-disk /dev/sdb2[0];  <span class="comment">#meta dataæ•°æ®åˆ†åŒº2</span></span><br><span class="line">    &#125;</span><br><span class="line">    on data2 &#123;</span><br><span class="line">        device /dev/drbd0;</span><br><span class="line">        disk /dev/sdb1;</span><br><span class="line">        address  192.168.56.102:7788;</span><br><span class="line">        meta-disk /dev/sdb2[0];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ç„¶åå°†ä¸Šé¢çš„é…ç½®å¤åˆ¶åˆ° Master-data2 ä¸Šçš„ /etc/drbd.conf ä¸­å³å¯;</p>
<h5 id="5-drbdçš„å¯åŠ¨è¿è¡Œ"><a href="#5-drbdçš„å¯åŠ¨è¿è¡Œ" class="headerlink" title="(5) drbdçš„å¯åŠ¨è¿è¡Œ"></a>(5) drbdçš„å¯åŠ¨è¿è¡Œ</h5><p>Drbdé«˜å¯ç”¨è¿è¡Œæ¡ˆä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">####### Step 6. ç„¶ååœ¨ä¸¤å°æœºå™¨éƒ½å¯åŠ¨æœåŠ¡ ##########</span></span><br><span class="line"><span class="comment">#step0.å»ºè®®å…ˆæ‰§è¡Œé˜²æ­¢create-mdå¤±è´¥</span></span><br><span class="line">dd <span class="keyword">if</span>=/dev/zero of=/dev/sdb&#123;1..2&#125; bs=1M count=100;sync</span><br><span class="line"></span><br><span class="line"><span class="comment">#Step1.åˆå§‹åŒ–DRBDçš„metadat(Create Device metadata)</span></span><br><span class="line"><span class="comment">#åˆ›å»ºæä¾›DRBDè®°å½•çš„ä¿¡æ¯çš„metadataåˆ†åŒº</span></span><br><span class="line">$ drbdadm create-md data</span><br><span class="line">New drbd meta data block successfully created. drbd</span><br><span class="line"><span class="comment">#ä¹Ÿå¯å•ç‹¬åˆ›å»ºresourceèµ„æºåç§°ç›´æ¥ç”¨;drbdadm create-md all,å…¶ä¸­allè¡¨ç¤ºæˆ‘ä»¬åœ¨drbd.confé‡Œå®šä¹‰æ‰€æœ‰çš„èµ„æºåç§°;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Step2.å¯åŠ¨DRBD</span></span><br><span class="line">/etc/init.d/drbd start</span><br><span class="line">$ drbdadm up data</span><br><span class="line"><span class="comment">#æˆ–è€…é‡‡ç”¨$ drbdadm up all</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Step3.æŸ¥çœ‹drbdçŠ¶æ€</span></span><br><span class="line">$ drbdadm status</span><br><span class="line">    data role:Secondary</span><br><span class="line">    disk:Inconsistent</span><br><span class="line">    peer connection:Connecting</span><br><span class="line"></span><br><span class="line">$ cat /proc/drbd</span><br><span class="line">version: 8.4.11-1 (api:1/proto:86-101)</span><br><span class="line">GIT-hash: 66145a308421e9c124ec391a7848ac20203bb03c build by mockbuild@Build64R6, 2018-09-28 19:36:27</span><br><span class="line"><span class="comment">#çœ‹åˆ°drbdçŠ¶æ€å·²ç»å˜åŒ–,æ­¤æ—¶çŠ¶æ€æ˜¯æ­£ç¡®çš„ roï¼šSecondary/Secondaryè¡¨ç¤ºä¸¤ç«¯éƒ½æ˜¯ä»,å¤„äºæ— ä¸»primaryçŠ¶æ€</span></span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=ç£ç›˜é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ(DBA).md href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190411231249.png" target="_blank" title="WeiyiGeek.drbdçŠ¶æ€" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190411231249.png" alt="WeiyiGeek.drbdçŠ¶æ€" title="" class=""></a>
                <p>WeiyiGeek.drbdçŠ¶æ€</p>
            </figure></p>
<p>åŒæ­¥drbdæ•°æ®åˆ°å¯¹ç«¯Serverä½¿æ•°æ®ä¿æŒä¸€è‡´,æŒ‡å®šä¸€ä¸ªè¦åŒæ­¥çš„èµ„æºåŒæ­¥æ•°æ®åˆ°å¯¹ç«¯ï¼š<br>(1) å¦‚æœä¸ºç©ºç£ç›˜å¯ä»¥éšæ„æ‰§è¡Œæ“ä½œä¸éœ€è¦è€ƒè™‘æ•°æ®<br>(2) å¦‚æœä¸¤è¾¹æ•°æ®ä¸ä¸€æ ·(æ³¨æ„åŒæ­¥æ•°æ®çš„æ–¹å‘å¦åˆ™å¯èƒ½ä¼šä¸¢å¤±æ•°æ®)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Step4.é…ç½®ä¸»ä»åŒæ­¥</span></span><br><span class="line"><span class="comment">#ä¸€ä¸ªèµ„æºè‡ªèƒ½åœ¨ä¸€ç«¯æ‰§è¡ŒåŒæ­¥æ•°æ®åˆ°å¯¹ç«¯å‘½ä»¤ ;å°† Master-data1 æœåŠ¡åŒæ­¥åˆ° Master-data2 åˆ†åŒºä¸­;</span></span><br><span class="line">$ drbdsetup /dev/drbd0 primary --force  <span class="comment">#è®¾ç½®ä¸»èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">#$ drbdadm  -- --overwrite-data-of-peer primary data</span></span><br><span class="line"><span class="comment"># åªæ˜¯åœ¨Master-data1æ‰§è¡Œ,å¦‚æœä»ç«¯ä¸ºç©ºæ•°æ®ç›´æ¥æ‰§è¡Œ</span></span><br><span class="line">$ drbdadm primary data   <span class="comment">#ä¼šè‡ªåŠ¨å¼€å§‹åŒæ­¥æ•°æ® [ä¸»èŠ‚ç‚¹æ‰§è¡Œ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Step5.åŒæ­¥æ¨¡å¼æŸ¥çœ‹</span></span><br><span class="line">[root@Master-data1/2  ~]$ cat /proc/drbd</span><br><span class="line">version: 8.4.11-1 (api:1/proto:86-101)</span><br><span class="line"> 0: (è¿æ¥çŠ¶æ€)cs:Connected (è§’è‰²)ro:Secondary/Primary ds(æ•°æ®çŠ¶æ€):UpToDate/UpToDate(åŒæ­¥çŠ¶æ€) C r-----</span><br><span class="line">    ns(ç½‘ç»œå‘é€):0 nr(ç½‘ç»œæ¥æ”¶):292952 dw(ç£ç›˜å†™):292952 dr(ç£ç›˜è¯»):0 al(æ´»åŠ¨æ—¥å¿—):16 bm():0 lo():0 pe():0 ua:0 ap:0 ep:1 wo:f oos:0  <span class="comment">#æ­£å¸¸æƒ…å†µä¸‹æ˜¯ä¸€è‡´çš„</span></span><br><span class="line"></span><br><span class="line">[root@Master-data1 ~]$ drbdadm status</span><br><span class="line">data role:Primary</span><br><span class="line">  disk:UpToDate</span><br><span class="line">  peer role:Secondary  <span class="comment">#å¯¹ç«¯è§’è‰²name</span></span><br><span class="line">    replication:Established peer-disk:UpToDate</span><br><span class="line"></span><br><span class="line"><span class="comment">#Step6.åˆ›å»ºåŒæ­¥æ–‡ä»¶å¤¹åŠæŒ‚è½½drbdåˆ†åŒº</span></span><br><span class="line"><span class="comment">#drbdå®ä¾‹åˆ©ç”¨ä¸»å¤‡æ¨¡å¼è¿›è¡Œå®æ—¶åŒæ­¥æ•°æ®åˆ°ä»æœåŠ¡å™¨ä¸Šé¢(Master-data2):</span></span><br><span class="line">[root@Master-data1 ~]$ mkfs -t ext4 -b 4096 /dev/drbd0 <span class="comment">#æŒ‚è½½å‰æ ¼å¼</span></span><br><span class="line">[root@Master-data1 ~]$ mkdir /drbddata</span><br><span class="line">[root@Master-data1 ~]$ mount /dev/drbd0 /drbddata/  <span class="comment">#æ³¨æ„è¿™é‡Œæ˜¯drbdé€»è¾‘åˆ†åŒº</span></span><br><span class="line">[root@Master-data1 ~]$ df -h</span><br><span class="line">Filesystem            Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/drbd0            256M  792K  709M   1% /drbddata  <span class="comment">#æŒ‚è½½æˆåŠŸ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Step7. æµ‹è¯•æ˜¯å¦èƒ½è¿›è¡Œæ–‡ä»¶åŒæ­¥</span></span><br><span class="line">[root@Master-data1  ]$ touch `seq 0 10`  <span class="comment">#åœ¨ä¸»ä¸­è¿›è¡Œå»ºç«‹æ–‡ä»¶æµ‹è¯•</span></span><br><span class="line">[root@Master-data2 ~]$ drbdadm down data <span class="comment">#ç”±äºæ˜¯ä¸»å¤‡æ¨¡å¼,å¿…é¡»downæ‰èƒ½è®©æ‚¨æŒ‚è½½ç‰©ç†åˆ†åŒº</span></span><br><span class="line">[root@Master-data2 ~]$ mount /dev/sdb1 /mnt/  <span class="comment">#æ³¨æ„ä»æœåŠ¡å™¨ä¸Šæ˜¯æŒ‚è½½çš„sdb1</span></span><br><span class="line">[root@Master-data2 ~]$ ls /mnt/</span><br><span class="line">0  1  10  11  12  13  14  15  16  17  18  19  2  20  3  4  5  6  7  8  9  lost+found</span><br><span class="line">[root@Master-data2 ~]$ umount /mnt/  <span class="comment">#é€€å‡ºæŒ‚è½½</span></span><br><span class="line">[root@Master-data2 ~]$ drbdadm up data  <span class="comment">#å¯åŠ¨èµ„æºæ± </span></span><br><span class="line">[root@Master-data2 ~]$ df -h  <span class="comment">#æ³¨æ„è¿™é‡Œå­˜åœ¨ä¸€ä¸ªå‘ æ˜æ˜æœ‰768ä½†æ˜¯åªæ˜¾ç¤ºæœ‰256Må¯ç”¨ï¼ˆå¤‡èŠ‚ç‚¹-è¯¾ååæœˆï¼‰</span></span><br><span class="line">/dev/sdb1             256M  792K  709M   1% /mnt</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><strong>è¡¥å……ï¼šCentOS7å®ä¾‹ï¼š</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## MASTER æœºå™¨ä¸Š</span></span><br><span class="line">[root@data1 ~]<span class="variable">$parted</span> /dev/sdb mkpart primary 0 300  <span class="comment">#300MB</span></span><br><span class="line">Warning: The resulting partition is not properly aligned <span class="keyword">for</span> best performance.</span><br><span class="line">Ignore/Cancel? ignore</span><br><span class="line">Information: You may need to update /etc/fstab.</span><br><span class="line"></span><br><span class="line">[root@data1 ~]<span class="variable">$parted</span> /dev/sdb mkpart primary 300 536  <span class="comment">#236MB</span></span><br><span class="line">Warning: The resulting partition is not properly aligned <span class="keyword">for</span> best performance.</span><br><span class="line">Ignore/Cancel? ignore</span><br><span class="line">Information: You may need to update /etc/fstab.</span><br><span class="line"></span><br><span class="line">[root@data1 ~]<span class="variable">$parted</span> /dev/sdb p</span><br><span class="line">Model: ATA VBOX HARDDISK (scsi)</span><br><span class="line">Disk /dev/sdb: 537MB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start   End    Size   File system  Name     Flags</span><br><span class="line"> 1      17.4kB  300MB  300MB               primary</span><br><span class="line"> 2      300MB   536MB  236MB               primary</span><br><span class="line"> </span><br><span class="line"><span class="comment">#(1) å»ºç«‹æ•°æ®å­˜å‚¨mç›®å½•</span></span><br><span class="line"><span class="comment">##--overwrite-data-of-peer è¦†ç›–å¯¹ç«¯çš„æ•°æ®</span></span><br><span class="line">drbdadm  -- --overwrite-data-of-peer primary data  <span class="comment">#è®¾ç½®data1ä¸ºä¸»</span></span><br><span class="line"><span class="comment">#drbdé…ç½®å®Œæˆå¹¶å¯åŠ¨åçš„æ•ˆæœ ï¼ˆdata1 == ä¸» primary/ data2 = ä» Secondaryï¼‰</span></span><br><span class="line">$ cat /proc/drbd</span><br><span class="line">0: cs:Connected ro:Primary/Secondary ds:UpToDate/UpToDate C r-----</span><br><span class="line">[root@data1/2 ~]$ mkdir /data -p <span class="comment">#åœ¨å¯ç”¨drbdæ—¶å€™</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨/dev/drbd0åˆ†åŒºå¿…é¡»æ ¼å¼åŒ–å¥¹drbd</span></span><br><span class="line"><span class="comment">#[root@data1 ~]$ mkfs -t ext4 -b 4096 /dev/drbd0</span></span><br><span class="line"><span class="comment">#[root@data1 ~]$ mount /dev/drbd0 /data  #æŒ‚è½½</span></span><br><span class="line">mkfs.ext4 /dev/drbd0 &amp;&amp; mount /dev/drbd0/data       <span class="comment">#åªéœ€å°†æ•°æ®å†™å…¥/dDataï¼Œdrbdå³æŠŠå…¶åŒæ­¥åˆ°backupNodeçš„/dev/sda2ï¼ˆä»…éœ€æŒ‚è½½é€»è¾‘è®¾å¤‡ï¼Œä¸æŒ‚è½½å…¶ä¸‹å±‚çš„åˆ†åŒºè€Œç”±DRBDåå°æŒ‚è½½ç”¨ï¼‰</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#(2) ä»åº“æŸ¥çœ‹åŒæ­¥çš„æ•°æ® ï¼ˆè¿™æ—¶é‡å¯æ ¼å¼åŒ–/dev/drbd0å°±æ²¡æœ‰æ•°æ®æ³¨æ„å¤‡ä»½ï¼‰</span></span><br><span class="line">[root@data2 ~]$ drbdadm down data      <span class="comment">#ã€å¤‡èŠ‚ç‚¹å¿…é¡»æ‰§è¡Œdownæ•°æ®åç§°ã€‘</span></span><br><span class="line">[root@data2 ~]$ mount /dev/sdb1 /mnt   <span class="comment">#ã€å¤‡èŠ‚ç‚¹æŒ‚è½½ sdb1 åˆ°/mntä¸­å›½ã€‘</span></span><br><span class="line">[root@data2 ~]$ ls  <span class="comment">#æŸ¥çœ‹æ•°æ® ï¼ˆæ³¨æ„ä¸èƒ½å†™å…¥æ•°æ®ï¼‰</span></span><br><span class="line">[root@data2 ~]$ umount /mnt  <span class="comment">#å–æ¶ˆæŒ‚è½½</span></span><br><span class="line">[root@data2 ~]$ drbdadm up data        <span class="comment">#å¯åŠ¨drbdå¤‡èŠ‚ç‚¹(é‡æ–°è¿›è¡ŒåŒæ­¥)</span></span><br><span class="line"><span class="comment"># è¡¥å……ï¼šdrbdå¯ä»¥è‡ªå¯åŠ¨è€Œheartbeatä¸ç”¨è¿›è¡Œè‡ªå¯åŠ¨</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ï¼ˆ3ï¼‰ä¸»å¤‡åˆ‡æ¢ ï¼ˆåšHAé«˜å¯ç”¨çš„æ—¶å€™ï¼‰</span></span><br><span class="line">[root@Master-data1 ~]umount /mnt <span class="comment">#å…ˆå°†ä¸»ä¸Šé¢çš„ç£ç›˜å¸è½½æ‰å¹¶é™çº§</span></span><br><span class="line">[root@Master-data1 ~]drbdadm secondary data</span><br><span class="line"></span><br><span class="line">[root@Master-data2 ~]drbdadm primary data  <span class="comment">#åœ¨å¤‡æœºä¸Šå‡çº§ä¸ºä¸»æœº</span></span><br><span class="line">[root@Master-data2 ~]mount /dev/drbd0 /mnt <span class="comment"># æŒ‚è½½ç£ç›˜</span></span><br></pre></td></tr></table></figure></p>
<h5 id="7-é™„å½•è¡¥å……"><a href="#7-é™„å½•è¡¥å……" class="headerlink" title="(7) é™„å½•è¡¥å……"></a>(7) é™„å½•è¡¥å……</h5><p>DRBDé…ç½®å·¥å…·ï¼š</p>
<ul>
<li>drbdadmï¼š  é«˜çº§ç®¡ç†å·¥å…·ï¼Œç®¡ç†/etc/drbd.confï¼Œå‘drbdsetupå’Œdrbdmetaå‘é€æŒ‡ä»¤</li>
<li>drbdsetupï¼š é…ç½®è£…è½½è¿›kernelçš„DRBDæ¨¡å—ï¼Œå¹³æ—¶å¾ˆå°‘ç”¨</li>
<li>drbdmetaï¼š ç®¡ç†METAæ•°æ®ç»“æ„ï¼Œå¹³æ—¶å¾ˆå°‘ç”¨</li>
</ul>
<p><strong>6.1 drbdå‘½ä»¤è§£æ</strong><br><em>ï¼ˆ1ï¼‰drbdadm å‘½ä»¤:</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ drbdadm up all  <span class="comment">#ç›¸å½“äºå¦‚ä¸‹ä¸‰ä¸ªå‘½ä»¤ç»„åˆ all ä»£è¡¨æ‰€æœ‰çš„èµ„æºæ± </span></span><br><span class="line">drbdadm attach all</span><br><span class="line">drbdadm syncer all</span><br><span class="line">drbdadm connnect all</span><br><span class="line"></span><br><span class="line">$ drbdadm down all  <span class="comment">#downæ‰æ‰€æœ‰çš„èµ„æºåŒæ­¥</span></span><br><span class="line">$ drbdadm disconnect data  <span class="comment">#æ–­å¼€dataèµ„æºæ± çš„åŒæ­¥</span></span><br><span class="line"></span><br><span class="line">$ drbdadm status  <span class="comment">#æŸ¥çœ‹drbdçŠ¶æ€</span></span><br><span class="line">$ drbdadm role èµ„æºå   <span class="comment">#æŸ¥çœ‹èŠ‚ç‚¹çš„è§’è‰²ï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##--overwrite-data-of-peer è¦†ç›–å¯¹ç«¯çš„æ•°æ®</span></span><br><span class="line">$ drbdadm  -- --overwrite-data-of-peer primary data <span class="comment">#é…ç½®ä¸»ä»åŒæ­¥æ¨¡å¼(ä¸»æ‰§è¡Œ) </span></span><br><span class="line">$ drbdadm primary data <span class="comment">#ä¼šè‡ªåŠ¨å¼€å§‹åŒæ­¥æ•°æ®(ä¸»èŠ‚ç‚¹è¿è¡Œ)</span></span><br><span class="line">$ drbdadm secondary data <span class="comment">#ä¼šè‡ªåŠ¨å¼€å§‹åŒæ­¥æ•°æ®(ä»èŠ‚ç‚¹è¿è¡Œ)</span></span><br><span class="line"></span><br><span class="line">$ drbdadm -- --discard-my-data connect data  <span class="comment">#é‡æ–°è¿æ¥èµ„æºæ± </span></span><br><span class="line">$ drbd-overview   <span class="comment">#æŸ¥çœ‹åŒæ­¥çŠ¶æ€</span></span><br></pre></td></tr></table></figure><br><br></p>
<p><em>drbdsetup å‘½ä»¤:</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drbdsetup /dev/drbd0 primary --force <span class="comment">#å°†drbd1ä¸»æœºé…ç½®ä¸ºä¸»èŠ‚ç‚¹ï¼š(node1)</span></span><br></pre></td></tr></table></figure></p>
<p><br><br><strong>6.2 drbdçŠ¶æ€çš„æ„ä¹‰</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">è¾“å‡ºæ–‡ä»¶ä¸Šé¢æœ€å¼€å§‹æ˜¯drbdçš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œç„¶åå°±æ˜¯æ•°æ®åŒæ­¥çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ï¼š</span><br><span class="line">cs â€” connection state</span><br><span class="line">st â€” node state (<span class="built_in">local</span>/remote)</span><br><span class="line">ld â€” <span class="built_in">local</span> data consistency</span><br><span class="line">ds â€” data consistency</span><br><span class="line">ns â€” network send</span><br><span class="line">nr â€” network receive</span><br><span class="line">dw â€” disk wr</span><br><span class="line">ite</span><br><span class="line">dr â€” disk <span class="built_in">read</span></span><br><span class="line">pe â€” pending (waiting <span class="keyword">for</span> ack)</span><br><span class="line">ua â€” unackâ€™d (still need to send ack)</span><br><span class="line">al â€” access <span class="built_in">log</span> write count</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#èµ„æºçš„è¿æ¥çŠ¶æ€ï¼›ä¸€ä¸ªèµ„æºå¯èƒ½æœ‰ä»¥ä¸‹è¿æ¥çŠ¶æ€ä¸­çš„ä¸€ç§</span></span><br><span class="line">StandAlone ç‹¬ç«‹çš„ï¼šç½‘ç»œé…ç½®ä¸å¯ç”¨ï¼›èµ„æºè¿˜æ²¡æœ‰è¢«è¿æ¥æˆ–æ˜¯è¢«ç®¡ç†æ–­å¼€ï¼ˆä½¿ç”¨ drbdadm disconnect å‘½ä»¤ï¼‰ï¼Œæˆ–æ˜¯ç”±äºå‡ºç°è®¤è¯å¤±è´¥æˆ–æ˜¯è„‘è£‚çš„æƒ…å†µ</span><br><span class="line">Disconnecting æ–­å¼€ï¼šæ–­å¼€åªæ˜¯ä¸´æ—¶çŠ¶æ€ï¼Œä¸‹ä¸€ä¸ªçŠ¶æ€æ˜¯StandAloneç‹¬ç«‹çš„</span><br><span class="line">Unconnected æ‚¬ç©ºï¼šæ˜¯å°è¯•è¿æ¥å‰çš„ä¸´æ—¶çŠ¶æ€ï¼Œå¯èƒ½ä¸‹ä¸€ä¸ªçŠ¶æ€ä¸ºWFconnectionå’ŒWFReportParams</span><br><span class="line">Timeout è¶…æ—¶ï¼šä¸å¯¹ç­‰èŠ‚ç‚¹è¿æ¥è¶…æ—¶ï¼Œä¹Ÿæ˜¯ä¸´æ—¶çŠ¶æ€ï¼Œä¸‹ä¸€ä¸ªçŠ¶æ€ä¸ºUnconectedæ‚¬ç©º</span><br><span class="line">BrokerPipeï¼šä¸å¯¹ç­‰èŠ‚ç‚¹è¿æ¥ä¸¢å¤±ï¼Œä¹Ÿæ˜¯ä¸´æ—¶çŠ¶æ€ï¼Œä¸‹ä¸€ä¸ªçŠ¶æ€ä¸ºUnconectedæ‚¬ç©º</span><br><span class="line">NetworkFailureï¼šä¸å¯¹ç­‰èŠ‚ç‚¹æ¨åŠ¨è¿æ¥åçš„ä¸´æ—¶çŠ¶æ€ï¼Œä¸‹ä¸€ä¸ªçŠ¶æ€ä¸ºUnconectedæ‚¬ç©º</span><br><span class="line">ProtocolErrorï¼šä¸å¯¹ç­‰èŠ‚ç‚¹æ¨åŠ¨è¿æ¥åçš„ä¸´æ—¶çŠ¶æ€ï¼Œä¸‹ä¸€ä¸ªçŠ¶æ€ä¸ºUnconectedæ‚¬ç©º</span><br><span class="line">TearDown æ‹†è§£ï¼šä¸´æ—¶çŠ¶æ€ï¼Œå¯¹ç­‰èŠ‚ç‚¹å…³é—­ï¼Œä¸‹ä¸€ä¸ªçŠ¶æ€ä¸ºUnconectedæ‚¬ç©º</span><br><span class="line">WFConnectionï¼šç­‰å¾…å’Œå¯¹ç­‰èŠ‚ç‚¹å»ºç«‹ç½‘ç»œè¿æ¥</span><br><span class="line">WFReportParamsï¼šå·²ç»å»ºç«‹TCPè¿æ¥ï¼Œæœ¬èŠ‚ç‚¹ç­‰å¾…ä»å¯¹ç­‰èŠ‚ç‚¹ä¼ æ¥çš„ç¬¬ä¸€ä¸ªç½‘ç»œåŒ…</span><br><span class="line">Connected è¿æ¥ï¼šDRBDå·²ç»å»ºç«‹è¿æ¥ï¼Œæ•°æ®é•œåƒç°åœ¨å¯ç”¨ï¼ŒèŠ‚ç‚¹å¤„äºæ­£å¸¸çŠ¶æ€</span><br><span class="line">StartingSyncSï¼šå®Œå…¨åŒæ­¥ï¼Œæœ‰ç®¡ç†å‘˜å‘èµ·çš„åˆšåˆšå¼€å§‹åŒæ­¥ï¼Œæœªæ¥å¯èƒ½çš„çŠ¶æ€ä¸ºSyncSourceæˆ–PausedSyncS</span><br><span class="line">StartingSyncTï¼šå®Œå…¨åŒæ­¥ï¼Œæœ‰ç®¡ç†å‘˜å‘èµ·çš„åˆšåˆšå¼€å§‹åŒæ­¥ï¼Œä¸‹ä¸€çŠ¶æ€ä¸ºWFSyncUUID</span><br><span class="line">WFBitMapSï¼šéƒ¨åˆ†åŒæ­¥åˆšåˆšå¼€å§‹ï¼Œä¸‹ä¸€æ­¥å¯èƒ½çš„çŠ¶æ€ä¸ºSyncSourceæˆ–PausedSyncS</span><br><span class="line">WFBitMapTï¼šéƒ¨åˆ†åŒæ­¥åˆšåˆšå¼€å§‹ï¼Œä¸‹ä¸€æ­¥å¯èƒ½çš„çŠ¶æ€ä¸ºWFSyncUUID</span><br><span class="line">WFSyncUUIDï¼šåŒæ­¥å³å°†å¼€å§‹ï¼Œä¸‹ä¸€æ­¥å¯èƒ½çš„çŠ¶æ€ä¸ºSyncTargetæˆ–PausedSyncT</span><br><span class="line">SyncSourceï¼šä»¥æœ¬èŠ‚ç‚¹ä¸ºåŒæ­¥æºçš„åŒæ­¥æ­£åœ¨è¿›è¡Œ</span><br><span class="line">SyncTargetï¼šä»¥æœ¬èŠ‚ç‚¹ä¸ºåŒæ­¥ç›®æ ‡çš„åŒæ­¥æ­£åœ¨è¿›è¡Œ</span><br><span class="line">PausedSyncSï¼šä»¥æœ¬åœ°èŠ‚ç‚¹æ˜¯ä¸€ä¸ªæŒç»­åŒæ­¥çš„æºï¼Œä½†æ˜¯ç›®å‰åŒæ­¥å·²ç»æš‚åœï¼Œå¯èƒ½æ˜¯å› ä¸ºå¦å¤–ä¸€ä¸ªåŒæ­¥æ­£åœ¨è¿›è¡Œæˆ–æ˜¯ä½¿ç”¨å‘½ä»¤(drbdadm pause-sync)æš‚åœäº†åŒæ­¥</span><br><span class="line">PausedSyncTï¼šä»¥æœ¬åœ°èŠ‚ç‚¹ä¸ºæŒç»­åŒæ­¥çš„ç›®æ ‡ï¼Œä½†æ˜¯ç›®å‰åŒæ­¥å·²ç»æš‚åœï¼Œè¿™å¯ä»¥æ˜¯å› ä¸ºå¦å¤–ä¸€ä¸ªåŒæ­¥æ­£åœ¨è¿›è¡Œæˆ–æ˜¯ä½¿ç”¨å‘½ä»¤(drbdadm pause-sync)æš‚åœäº†åŒæ­¥</span><br><span class="line">VerifySï¼šä»¥æœ¬åœ°èŠ‚ç‚¹ä¸ºéªŒè¯æºçš„çº¿ä¸Šè®¾å¤‡éªŒè¯æ­£åœ¨æ‰§è¡Œ</span><br><span class="line">VerifyTï¼šä»¥æœ¬åœ°èŠ‚ç‚¹ä¸ºéªŒè¯ç›®æ ‡çš„çº¿ä¸Šè®¾å¤‡éªŒè¯æ­£åœ¨æ‰§è¡Œ</span><br></pre></td></tr></table></figure><br><br></p>
<p><strong>6.3 drbdé…ç½®æ–‡ä»¶</strong><br>DRBDé…ç½®æ–‡ä»¶ï¼šDRBDçš„ä¸»é…ç½®æ–‡ä»¶ä¸º/etc/drbd.conf<br>ä¸ºäº†ç®¡ç†çš„ä¾¿æ·æ€§é€šå¸¸ä¼šå°†äº›é…ç½®æ–‡ä»¶åˆ†å¤šä¸ªéƒ¨åˆ†ï¼Œä½†éƒ½ä¿å­˜è‡³/etc/drbd.dç›®å½•ã€‚ä¸»é…ç½®æ–‡ä»¶ä¸­ä»…ä½¿ç”¨â€includeâ€æŒ‡ä»¤å°†è¿™äº›é…ç½®æ–‡ä»¶ç‰‡æ–­æ•´åˆã€‚<br>é€šå¸¸/etc/drbd.dä¸­çš„æ–‡ä»¶ä¸ºglobal_common.confå’Œæ‰€æœ‰ä»¥.resç»“å°¾çš„æ–‡ä»¶ã€‚å…¶ä¸­ï¼š</p>
<ul>
<li>global_common.confä¸­ä¸»è¦å®šä¹‰globalæ®µå’Œcommonæ®µ</li>
<li>æ¯ä¸ª.resæ–‡ä»¶ç”¨äºå®šä¹‰ä¸€ä¸ªèµ„æº</li>
</ul>
<p>ä¸€ä¸ªDRBDè®¾å¤‡(å³/dev/drbdX),å«åšä¸€ä¸ªâ€èµ„æºâ€ã€‚é‡Œé¢åŒ…å«DRBDè®¾å¤‡çš„ä¸»å¤‡èŠ‚ç‚¹çš„ipä¿¡æ¯ï¼Œåº•å±‚å­˜å‚¨è®¾å¤‡åç§°åŠè®¾å¤‡å¤§å°ï¼Œmetaä¿¡æ¯å­˜æ”¾æ–¹å¼,drbdå¯¹å¤–æä¾›çš„è®¾å¤‡åç­‰:<br>DRBDèµ„æºï¼š</p>
<ul>
<li>Resource nameï¼š  é™¤ç©ºç™½å­—ç¬¦çš„ä»»æ„çš„ACSIIç å­—ç¬¦</li>
<li>DRBD deviceï¼š  åœ¨åŒæ–¹èŠ‚ç‚¹ä¸Šï¼Œæ­¤DRBDè®¾å¤‡çš„è®¾å¤‡æ–‡ä»¶ï¼›ä¸€èˆ¬ä¸º/dev/drbdNï¼Œå…¶ä¸»è®¾å¤‡å·147</li>
<li>Disk configurationï¼š  åœ¨åŒæ–¹èŠ‚ç‚¹ä¸Šå„è‡ªæä¾›çš„å­˜å‚¨è®¾å¤‡</li>
<li>Nerwork configurationï¼š  åŒæ–¹æ•°æ®åŒæ­¥æ—¶æ‰€ä½¿ç”¨çš„ç½‘ç»œå±æ€§</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$vim</span> /etc/drbd.d/global_common.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨é…ç½®æ–‡ä»¶ä¸­globalæ®µä»…å‡ºç°ä¸€æ¬¡ï¼Œä¸”è‹¥æ‰€æœ‰é…ç½®ä¿¡æ¯éƒ½ä¿å­˜è‡³åŒä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­è€Œä¸åˆ†å¼€ä¸ºå¤šä¸ªæ–‡ä»¶çš„è¯åˆ™globalæ®µå¿…é¡»ä½äºé…ç½®æ–‡ä»¶æœ€å¼€å§‹å¤„</span></span><br><span class="line">    ç›®å‰globalæ®µä¸­å¯ä»¥å®šä¹‰çš„å‚æ•°ä»…æœ‰minor-count, dialog-refresh, <span class="built_in">disable</span>-ip-verificationå’Œusage-countã€‚</span><br><span class="line">global &#123;</span><br><span class="line">    usage-count no;  <span class="comment">#æ˜¯å¦å‚åŠ DRBDä½¿ç”¨è€…ç»Ÿè®¡ï¼Œé»˜è®¤æ˜¯å‚åŠ </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”¨äºå®šä¹‰è¢«æ¯ä¸€ä¸ªèµ„æºé»˜è®¤ç»§æ‰¿çš„å‚æ•°ï¼Œå¯åœ¨èµ„æºå®šä¹‰ä¸­ä½¿ç”¨çš„å‚æ•°éƒ½å¯åœ¨commonå®šä¹‰ã€‚å®é™…åº”ç”¨ä¸­commonæ®µå¹¶éå¿…é¡»ä½†å»ºè®®å°†å¤šä¸ªèµ„æºå…±äº«çš„å‚æ•°å®šä¹‰åœ¨commonæ®µä»¥é™ä½é…ç½®å¤æ‚åº¦</span></span><br><span class="line">common &#123;</span><br><span class="line">  protocol C; <span class="comment">#ä½¿ç”¨DRBDçš„ç¬¬ä¸‰ç§åŒæ­¥åè®®ï¼Œè¡¨ç¤ºæ”¶åˆ°è¿œç¨‹ä¸»æœºçš„å†™å…¥ç¡®è®¤åè®¤ä¸ºå†™å…¥å®Œæˆ (é‡ç‚¹)</span></span><br><span class="line">  handlers &#123;ã€€ã€€ã€€</span><br><span class="line">    pri-on-incon-degr <span class="string">"/usr/lib/drbd/notify-pri-on-incon-degr.sh; /usr/lib/drbd/notify-emergency-reboot.sh; echo b &gt; /proc/sysrq-trigger ; reboot -f"</span>;</span><br><span class="line">    pri-lost-after-sb <span class="string">"/usr/lib/drbd/notify-pri-lost-after-sb.sh; /usr/lib/drbd/notify-emergency-reboot.sh; echo b &gt; /proc/sysrq-trigger ; reboot -f"</span>;</span><br><span class="line">    <span class="built_in">local</span>-io-error <span class="string">"/usr/lib/drbd/notify-io-error.sh; /usr/lib/drbd/notify-emergency-shutdown.sh; echo o &gt; /proc/sysrq-trigger ; halt -f"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  startup &#123;</span><br><span class="line">    wfc-timeout          60;</span><br><span class="line">    degr-wfc-timeout     60; <span class="comment">#å¯åŠ¨æ—¶è¿æ¥èµ„æºçš„è¶…æ—¶æ—¶é—´</span></span><br><span class="line">    outdated-wfc-timeout 06;</span><br><span class="line">  &#125;</span><br><span class="line">  disk &#123;</span><br><span class="line">    on-io-error detach; <span class="comment">#ç£ç›˜å‡ºç°IOé”™è¯¯å¤„ç†</span></span><br><span class="line">  &#125;</span><br><span class="line">  net &#123; </span><br><span class="line">    cram-hmac-alg sha1;    <span class="comment">#DRBDç½‘ç»œåŒæ­¥æ—¶ä½¿ç”¨çš„éªŒè¯æ–¹å¼å’Œå¯†ç </span></span><br><span class="line">    shared-secret <span class="string">"testdrbd"</span>;</span><br><span class="line">    max-buffers 2048;</span><br><span class="line">    max-epoch-size 2048; </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">#åŒæ­¥æ—¶çš„é€Ÿç‡é™åˆ¶åŠæ•°æ®çš„éªŒè¯ç®—æ³•   </span></span><br><span class="line">  syncer &#123;</span><br><span class="line">    rate 30M;      <span class="comment">#ä¸»èŠ‚ç‚¹å’Œå¤‡ç”¨èŠ‚ç‚¹åŒæ­¥æ—¶æœ€å¤§çš„ç½‘ç»œé€Ÿç‡ å·¥ä½œä¸­æ˜¯100M~1000M</span></span><br><span class="line">    verify-alg crc32c; <span class="comment">#éªŒè¯ç®—æ³•</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#èµ„æºè®¾ç½®|ä¸»ä»æ¨¡å¼ ä¸€ä¸ªèµ„æº / è¿˜èƒ½æ·»åŠ èµ„æºå°±æ˜¯ data2 / data3</span></span><br><span class="line"><span class="comment">#èµ„æºåœ¨å®šä¹‰æ—¶å¿…é¡»ä¸ºå…¶å‘½åæ¯ä¸ªèµ„æºæ®µçš„å®šä¹‰ä¸­è‡³å°‘è¦åŒ…å«ä¸¤ä¸ªhostå­æ®µï¼Œä»¥å®šä¹‰æ­¤èµ„æºå…³è”è‡³çš„èŠ‚ç‚¹ï¼Œå…¶å®ƒå‚æ•°å‡å¯ä»¥ä»commonæ®µæˆ–drbdçš„é»˜è®¤ä¸­è¿›è¡Œç»§æ‰¿è€Œæ— é¡»å®šä¹‰</span></span><br><span class="line">resource data&#123;</span><br><span class="line">    meta-disk internal; <span class="comment">#meta-dataå’Œæ•°æ®å­˜æ”¾åœ¨åŒä¸€ä¸ªåº•å±‚</span></span><br><span class="line">    <span class="comment">#ä¸¤å°ä¸»å¤‡èŠ‚ç‚¹é…ç½® (å…³é”®ç‚¹)</span></span><br><span class="line">    on data1 &#123;</span><br><span class="line">        device /dev/drbd0;  <span class="comment">#drbdå†™è®¾å¤‡æœ‰è‡ªå·±å¯¹åº”çš„åˆ†åŒº</span></span><br><span class="line">        disk /dev/sdb1;        <span class="comment">#æœ¬åœ°æ•°æ®åˆ†åŒº1</span></span><br><span class="line">        address  192.168.2.100:7788;  <span class="comment">#å¿ƒè·³/æ•°æ®ä¼ è¾“æ¥å£ (å»ºè®®æŠŠè¿™ä¸ªåœ°å€è®¾ç½®åˆ°hostsä¸­æ”¹æˆå¿ƒè·³çº¿çš„ç½‘å¡)</span></span><br><span class="line">        meta-disk /dev/sdb2[0];  <span class="comment">#meta dataæ•°æ®åˆ†åŒº2</span></span><br><span class="line">    &#125;</span><br><span class="line">    on data2 &#123;</span><br><span class="line">        device /dev/drbd0;  <span class="comment">#drbdå†™è®¾å¤‡æœ‰è‡ªå·±å¯¹åº”çš„åˆ†åŒº</span></span><br><span class="line">        disk /dev/sdb1;        <span class="comment">#æ•°æ®</span></span><br><span class="line">        address  192.168.2.101:7788;  <span class="comment">#å¿ƒè·³/æ•°æ®ä¼ è¾“æ¥å£</span></span><br><span class="line">        meta-disk /dev/sdb2[0];  <span class="comment">#meta dataæ•°æ®åˆ†åŒº</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨äºå®šä¹‰drbdèµ„æºï¼Œæ¯ä¸ªèµ„æºé€šå¸¸å®šä¹‰åœ¨ä¸€ä¸ªå•ç‹¬çš„ä½äº/etc/drbd.dç›®å½•ä¸­çš„ä»¥.resç»“å°¾çš„æ–‡ä»¶ä¸­ã€‚</span></span><br><span class="line">cat /etc/drbd.d/nfsdrbd.res</span><br><span class="line">resource nfsdrbd &#123;</span><br><span class="line">       on pz142 &#123;</span><br><span class="line">              device /dev/drbd0;</span><br><span class="line">              disk   /dev/vg1/lv1;</span><br><span class="line">              address 192.168.1.142:7789;</span><br><span class="line">              meta-disk internal;</span><br><span class="line">       &#125;</span><br><span class="line">       on pz144 &#123;</span><br><span class="line">              device /dev/drbd0;</span><br><span class="line">              disk   /dev/vg1/lv1;</span><br><span class="line">              address 192.168.1.144:7789;</span><br><span class="line">              meta-disk internal;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>6.4 drbdå…¥å‘è®¡</strong><br><em>Q:é—®é¢˜ drbdadm create-md dataå¤±è´¥?</em><br>é—®é¢˜ï¼š/etc/drbd.conf:6: Parse error: â€˜a syncer option keywordâ€™ expected,but got â€˜rateâ€™<br>è§£å†³æ–¹æ³•ï¼šyum install gcc gcc-c++ make glibc flex kernel kernel-devel kernel-headers</p>
<p><br><br><em>Q:é—®é¢˜ drbdadm up all å¤±è´¥?</em><br>é—®é¢˜:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0: Failure: (119) No valid meta-data signature found.</span><br><span class="line">        ==&gt; Use <span class="string">'drbdadm create-md res'</span> to initialize meta-data area. &lt;==</span><br><span class="line">Command <span class="string">'drbdsetup-84 attach 0 /dev/sdb1 /dev/sdb2 0 --on-io-error=detach --resync-rate=30M'</span> terminated with <span class="built_in">exit</span> code 10</span><br></pre></td></tr></table></figure><br>è§£å†³åŠæ³•ï¼šæŸ¥çœ‹åˆ†åŒºæ˜¯å¦é”™è¯¯,åˆ†åŒºåé‡å¯ç³»ç»Ÿå†å¯åŠ¨; dd if=/dev/zero bs=1M count=1 of=/dev/sdb{1..2};sync<br>dd if=/dev/zero bs=1M count=1 of=/dev/sda{1..2};sync<br><br></p>
<p><em>Q:åŒæ­¥çŠ¶æ€å‡ºç°å¼‚å¸¸ï¼Ÿ</em><br>é—®é¢˜ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0: cs:WFConnection ro:Secondary(æœ¬ç«¯è§’è‰²)/Unknown ds:Inconsistent/DUnknown(é—®é¢˜ç‚¹) C r----s</span><br><span class="line">    ns:0 nr:0 dw:0 dr:0 al:8 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:795188</span><br></pre></td></tr></table></figure><br>è§£å†³åŠæ³•ï¼š</p>
<ul>
<li>æ£€æµ‹ä¸¤å°drbdæœåŠ¡å™¨ç‰©ç†ç½‘ç»œé“¾æ¥æˆ–è€…IPåŠä¸»æœºè·¯ç”±æ˜¯å¦æ­£ç¡®</li>
<li>åœæ­¢iptablesé˜²ç«å¢™æˆ–è€…æ”¾è¡Œdrbd(æŒ‡å®šIPå½¢å¼)</li>
<li>Secondary/Unkonwn å¯èƒ½æ˜¯å‘ç”Ÿè£‚è„‘å¯¼è‡´çš„ç»“æœ<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#åœ¨ä»èŠ‚ç‚¹æ‰§è¡Œï¼š</span><br><span class="line">modprobe drbd</span><br><span class="line">drbdadm secondary data</span><br><span class="line">drbdadm up data</span><br><span class="line">drbdadm disconnect data</span><br><span class="line">drbdadm -- --discard-my-data connect data</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<p><em>Qï¼šå¦‚ä½•è§£å†³drbdè£‚è„‘é—®é¢˜ï¼Ÿ</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##å¤‡ç”¨èŠ‚ç‚¹ï¼š</span></span><br><span class="line"><span class="comment">#b.ä¸»èŠ‚ç‚¹æŸ¥çœ‹drbdçŠ¶æ€å¦‚æœ cs:WFConnection ä¸æ˜¯è¯¥çŠ¶æ€éœ€è¦æ‰‹åŠ¨è¿›è¡Œé“¾æ¥</span></span><br><span class="line">[root@ pz142 ~]<span class="comment"># drbdadm secondary r0</span></span><br><span class="line">[root@ pz142 ~]<span class="comment"># drbdadm disconnect all</span></span><br><span class="line">[root@ pz142 ~]<span class="comment"># drbdadm -- --discard-my-data connect r0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##ä¸»èŠ‚ç‚¹ï¼š</span></span><br><span class="line">[root@ pz144 ~]<span class="comment"># drbdadm disconnect al</span></span><br><span class="line">[root@ pz144 ~]<span class="comment"># drbdadm connect r0</span></span><br><span class="line">[root@ pz144 ~]<span class="comment"># drbdsetup /dev/drbd0 primary</span></span><br><span class="line">[root@ pz144 ~]<span class="comment"># mount /dev/drbd0 /data/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#c.cs:Connected ro:Secondary/Secondary ds:Inconsistent/Inconsistent C</span></span><br><span class="line">drbdadm -- --overwrite-data-of-peer primary drbd   <span class="comment">#</span></span><br></pre></td></tr></table></figure></p>
<p><br><br><em>Q:drbdä¸»èŠ‚ç‚¹æ— æ³•è¿›è¡ŒæŒ‚è½½mount</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åŸå› ç”±äº/dev/drbd0 æœªè¿›è¡Œåˆå§‹</span></span><br><span class="line">[root@data1 <span class="built_in">log</span>]<span class="comment"># mount /dev/drbd0 /data</span></span><br><span class="line">mount: /dev/drbd0 is write-protected, mounting <span class="built_in">read</span>-only</span><br><span class="line">mount: unknown filesystem <span class="built_in">type</span> <span class="string">'(null)'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è§£å†³æ–¹æ³•</span></span><br><span class="line">mkfs -t ext4 -b 4096 /dev/drbd0</span><br></pre></td></tr></table></figure></p>

        </div>
        <!-- Google å¹¿å‘Š -->
        
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
  

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-03-29T05:39:06.301Z" itemprop="dateUpdated">2022-03-29 13:39:06</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç³»ç»Ÿè¿ç»´/ç³»ç»Ÿæ¶æ„/é«˜å¯ç”¨/ç£ç›˜é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ.md" target="_blank" rel="noopener noreferrer">_posts/ç³»ç»Ÿè¿ç»´/ç³»ç»Ÿæ¶æ„/é«˜å¯ç”¨/ç£ç›˜é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2019/4-11-263.html" target="_blank" rel="external">https://blog.weiyigeek.top/2019/4-11-263.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9C%8D%E5%8A%A1/" rel="tag">é«˜å¯ç”¨æœåŠ¡</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/4-11-263.html&title=ã€Šç£ç›˜é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ(DBA).mdã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/4-11-263.html&title=ã€Šç£ç›˜é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ(DBA).mdã€‹ â€” WeiyiGeek Blog&source=æ–‡ç« ç›®å½•[TOC]
(1) drbd é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/4-11-263.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Šç£ç›˜é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ(DBA).mdã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/4-11-263.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/4-11-263.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/4-12-345.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Python3çˆ¬è™«å­¦ä¹ .md</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/4-11-315.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Nodejså…¥é—¨å­¦ä¹ 1.md</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#æ–‡ç« ç›®å½•"><span class="post-toc-number">1.</span> <span class="post-toc-text">æ–‡ç« ç›®å½•</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x00-Drbdé«˜å¯ç”¨"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x00 Drbdé«˜å¯ç”¨</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    


    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      

    <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
    
      <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
        
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">ä¸ªäººGithub</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">ä¸ªäººGitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">ä¸ªäººçŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘+äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/4-11-263.html&title=ã€Šç£ç›˜é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ(DBA).mdã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/4-11-263.html&title=ã€Šç£ç›˜é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ(DBA).mdã€‹ â€” WeiyiGeek Blog&source=æ–‡ç« ç›®å½•[TOC]
(1) drbd é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/4-11-263.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Šç£ç›˜é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ(DBA).mdã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/4-11-263.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/4-11-263.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACIUlEQVR42u3aQW7DMAwEwPz/0+kDCje7VF3U0uhUNIms8YGgSL5e8XpfrO+fXn3/as+rp7zuWBgYGI9lvH9cPx8rx1wd/Wqf/GwYGBjnMPKtE0ASpvMXkQRrDAwMjDYgroRgDAwMjLsZyR3zAQEXAwPjXzKS0LmeCLbluVvu4hgYGA9k5FX3v//7lv4GBgbGoxjvcq0cK08c61NhYGBszcgD3EpxP7/Qzs6DgYGxNyMp0LfjF+uY+j8YGBhbM1bCXH7QpOjfNjvr4TAMDIyHM9qw2IbpFpa3MDEwME5mFD8uf5UPduQvAgMDAyMfd0jCZRu+iwYnBgbGAYyVUbB2ImJWJfvwKwwMjE0ZLSAJpkl4bRsJH/bBwMA4gJEkYW1LoG0qLF2kMTAwtmbkF9rfGkJt25zDxBEDA2MjRlF2D8JxPnKR4yMwBgbGAYxZG6CtzOc7tEU3DAyMvRltY2BWIJuNpdZpIgYGxtaMdUxe9J+9mnywFQMDY1dGkg7OHjkb45iV6jAwME5grA9M5CW2/PtFmxMDA+MAxmww67eC7EqTFQMDY2/Gu1wtYBaU6+s0BgbG1oyV/uDswclR8jSxxmBgYDyWMSu3zdK4vEnZhmwMDIwTGLOSWV5KKw402w0DAwNjIXS2Dc68wIeBgYHRlsNmgTIfLPuwGwYGxgGMlYJa0vhsw+uN5TYMDIwHMlYmNZLgmKeSeUI5LAJiYGA8j/EFJogi4BTlfmIAAAAASUVORK5CYII=" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>