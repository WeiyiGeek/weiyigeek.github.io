{"title":"哈希生成与文件验证","slug":"系统运维/Windows/常用命令/证书哈希类命令/哈希生成与文件验证","date":"2019-05-27T12:36:30.000Z","updated":"2020-10-10T02:37:46.937Z","url":"2019/5-27-251.html","path":"api/articles/2019/5-27-251.html.json","covers":null,"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"certutil-命令\"><a href=\"#certutil-命令\" class=\"headerlink\" title=\"certutil 命令\"></a>certutil 命令</h4><p>描述:certutil用于备份证书服务下载查看缓存,管理Windows命令通过文件生成并显示加密哈希生成Hashfile，MD5,SHA1,SHA256，并且可以校验文件MD5/SHA1值等<br>更多操作说明见<a href=\"https://technet.microsoft.com/zh-cn/library/cc755341(v=ws.10).aspx\" target=\"_blank\" rel=\"noopener\">https://technet.microsoft.com/zh-cn/library/cc755341(v=ws.10).aspx</a></p>\n<p>语法参数：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">动词:</span><br><span class=\"line\">  -dump             -- 转储配置信息或文件</span><br><span class=\"line\">  -dumpPFX          -- 转储 PFX 结构</span><br><span class=\"line\">  -asn              -- 分析 ASN.1 文件</span><br><span class=\"line\"></span><br><span class=\"line\">  -decodehex        -- 解码十六进制编码的文件</span><br><span class=\"line\">  -decode           -- 解码 Base64 编码的文件</span><br><span class=\"line\">  -encode           -- 将文件编码为 Base64</span><br><span class=\"line\">  -hashfile         -- 通过文件生成并显示加密哈希支持: MD2 MD4 MD5 SHA1 SHA256 SHA384 SHA512</span><br><span class=\"line\"></span><br><span class=\"line\">  -deny             -- 拒绝挂起的申请</span><br><span class=\"line\">  -resubmit         -- 重新提交挂起的申请</span><br><span class=\"line\">  -setattributes    -- 为挂起申请设置属性</span><br><span class=\"line\">  -setextension     -- 为挂起申请设置扩展</span><br><span class=\"line\">  -revoke           -- 吊销证书</span><br><span class=\"line\">  -isvalid          -- 显示当前证书部署</span><br><span class=\"line\"></span><br><span class=\"line\">  -getconfig        -- 获取默认配置字符串</span><br><span class=\"line\">  -ping             -- Ping Active Directory 证书服务申请接口</span><br><span class=\"line\">  -pingadmin        -- Ping Active Directory 证书服务管理接口</span><br><span class=\"line\">  -CAInfo           -- 显示 CA 信息</span><br><span class=\"line\">  -ca.cert          -- 检索 CA 的证书</span><br><span class=\"line\">  -ca.chain         -- 检索 CA 的证书链</span><br><span class=\"line\">  -GetCRL           -- 获取 CRL</span><br><span class=\"line\">  -CRL              -- 发布新的 CRL [或仅增量 CRL]</span><br><span class=\"line\">  -shutdown         -- 关闭 Active Directory 证书服务</span><br><span class=\"line\"></span><br><span class=\"line\">  -installCert      -- 安装证书颁发机构证书</span><br><span class=\"line\">  -renewCert        -- 续订证书颁发机构证书</span><br><span class=\"line\"></span><br><span class=\"line\">  -schema           -- 转储证书架构</span><br><span class=\"line\">  -view             -- 转储证书视图</span><br><span class=\"line\">  -db               -- 转储原始数据库</span><br><span class=\"line\">  -deleterow        -- 删除服务器数据库行</span><br><span class=\"line\"></span><br><span class=\"line\">  -backup           -- 备份 Active Directory 证书服务</span><br><span class=\"line\">  -backupDB         -- 备份 Active Directory 证书服务数据库</span><br><span class=\"line\">  -backupKey        -- 备份 Active Directory 证书服务证书和私钥</span><br><span class=\"line\">  -restore          -- 还原 Active Directory 证书服务</span><br><span class=\"line\">  -restoreDB        -- 还原 Active Directory 证书服务数据库</span><br><span class=\"line\">  -restoreKey       -- 还原 Active Directory 证书服务证书和私钥</span><br><span class=\"line\">  -importPFX        -- 导入证书和私钥</span><br><span class=\"line\">  -dynamicfilelist  -- 显示动态文件列表</span><br><span class=\"line\">  -databaselocations -- 显示数据库位置</span><br><span class=\"line\"></span><br><span class=\"line\">  -store            -- 转储证书存储</span><br><span class=\"line\">  -enumstore        -- 枚举证书存储</span><br><span class=\"line\">  -addstore         -- 将证书添加到存储</span><br><span class=\"line\">  -delstore         -- 从存储删除证书</span><br><span class=\"line\">  -verifystore      -- 验证存储中的证书</span><br><span class=\"line\">  -repairstore      -- 修复密钥关联，或者更新证书属性或密钥安全描述符</span><br><span class=\"line\">  -viewstore        -- 转储证书存储</span><br><span class=\"line\">  -viewdelstore     -- 从存储删除证书</span><br><span class=\"line\">  -UI               -- 调用 CryptUI</span><br><span class=\"line\">  -attest           -- 验证密钥证明请求</span><br><span class=\"line\"></span><br><span class=\"line\">  -dsPublish        -- 将证书或 CRL 发布到 Active Directory</span><br><span class=\"line\"></span><br><span class=\"line\">  -ADTemplate       -- 显示 AD 模板</span><br><span class=\"line\">  -Template         -- 显示注册策略模板</span><br><span class=\"line\">  -TemplateCAs      -- 显示模板的 CA</span><br><span class=\"line\">  -CATemplates      -- 显示 CA 的模板</span><br><span class=\"line\">  -SetCASites       -- 管理 CA 的站点名称</span><br><span class=\"line\">  -enrollmentServerURL -- 显示、添加或删除与 CA 关联的注册服务器 URL</span><br><span class=\"line\">  -ADCA             -- 显示 AD CA</span><br><span class=\"line\">  -CA               -- 显示注册策略 CA</span><br><span class=\"line\">  -Policy           -- 显示注册策略</span><br><span class=\"line\">  -PolicyCache      -- 显示或删除注册策略缓存项目</span><br><span class=\"line\">  -CredStore        -- 显示、添加或删除凭据存储项目</span><br><span class=\"line\">  -InstallDefaultTemplates -- 安装默认的证书模板</span><br><span class=\"line\">  -URLCache         -- 显示或删除 URL 缓存项目</span><br><span class=\"line\">  -pulse            -- 以脉冲方式执行自动注册事件或 NGC 任务</span><br><span class=\"line\">  -MachineInfo      -- 显示 Active Directory 计算机对象信息</span><br><span class=\"line\">  -DCInfo           -- 显示域控制器信息</span><br><span class=\"line\">  -EntInfo          -- 显示企业信息</span><br><span class=\"line\">  -TCAInfo          -- 显示 CA 信息</span><br><span class=\"line\">  -SCInfo           -- 显示智能卡信息</span><br><span class=\"line\"></span><br><span class=\"line\">  -SCRoots          -- 管理智能卡根证书</span><br><span class=\"line\"></span><br><span class=\"line\">  -DeleteHelloContainer -- 删除 Hello 登录容器。</span><br><span class=\"line\">     ** 在使用此选项后, 用户需要注销才能完成。**</span><br><span class=\"line\">  -verifykeys       -- 验证公/私钥集</span><br><span class=\"line\">  -verify           -- 验证证书，CRL 或链</span><br><span class=\"line\">  -verifyCTL        -- 验证 AuthRoot 或不允许的证书 CTL</span><br><span class=\"line\">  -syncWithWU       -- 与 Windows 更新同步</span><br><span class=\"line\">  -generateSSTFromWU -- 通过 Windows 更新生成 SST</span><br><span class=\"line\">  -generatePinRulesCTL -- 生成捆绑规则 CTL</span><br><span class=\"line\">  -downloadOcsp     -- 下载 OCSP 响应并写入目录</span><br><span class=\"line\">  -generateHpkpHeader -- 使用指定文件或目录中的证书生成 HPKP 头</span><br><span class=\"line\">  -flushCache       -- 刷新选定进程(例如 lsass.exe)中的指定缓存</span><br><span class=\"line\">  -addEccCurve      -- 添加 ECC 曲线</span><br><span class=\"line\">  -deleteEccCurve   -- 删除 ECC 曲线</span><br><span class=\"line\">  -displayEccCurve  -- 显示 ECC 曲线</span><br><span class=\"line\">  -sign             -- 重新签名 CRL 或证书</span><br><span class=\"line\"></span><br><span class=\"line\">  -vroot            -- 创建/删除 Web 虚拟根和文件共享</span><br><span class=\"line\">  -vocsproot        -- 创建/删除 OCSP Web Proxy 的 Web 虚拟根</span><br><span class=\"line\">  -addEnrollmentServer -- 添加注册服务器应用程序</span><br><span class=\"line\">  -deleteEnrollmentServer -- 删除注册服务器应用程序</span><br><span class=\"line\">  -addPolicyServer  -- 添加策略服务器应用程序</span><br><span class=\"line\">  -deletePolicyServer -- 删除策略服务器应用程序</span><br><span class=\"line\">  -oid              -- 显示 ObjectId 或设置显示名称</span><br><span class=\"line\">  -error            -- 显示错误代码消息文本</span><br><span class=\"line\">  -getreg           -- 显示注册表值</span><br><span class=\"line\">  -setreg           -- 设置注册表值</span><br><span class=\"line\">  -delreg           -- 删除注册表值</span><br><span class=\"line\"></span><br><span class=\"line\">  -ImportKMS        -- 为密钥存档导入用户密钥和证书到服务器数据库</span><br><span class=\"line\">  -ImportCert       -- 将证书文件导入数据库</span><br><span class=\"line\">  -GetKey           -- 检索存档的私钥恢复 Blob，生成恢复脚本 或恢复存档的密钥</span><br><span class=\"line\">  -RecoverKey       -- 恢复存档的私钥</span><br><span class=\"line\">  -MergePFX         -- 合并 PFX 文件</span><br><span class=\"line\">  -ConvertEPF       -- 将 PFX 文件转换为 EPF 文件</span><br><span class=\"line\"></span><br><span class=\"line\">  -add-chain        -- (-AddChain) 添加证书链</span><br><span class=\"line\">  -add-pre-chain    -- (-AddPrechain) 添加预植证书链</span><br><span class=\"line\">  -get-sth          -- (-GetSTH) 获取签名树头</span><br><span class=\"line\">  -get-sth-consistency -- (-GetSTHConsistency) 获取签名树头更改</span><br><span class=\"line\">  -get-proof-by-hash -- (-GetProofByHash) 获取哈希证明</span><br><span class=\"line\">  -get-entries      -- (-GetEntries) 获取项</span><br><span class=\"line\">  -get-roots        -- (-GetRoots) 获取根</span><br><span class=\"line\">  -get-entry-and-proof -- (-GetEntryAndProof) 获取项和证明</span><br><span class=\"line\">  -VerifyCT         -- 验证证书 SCT</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#帮助示例：</span></span><br><span class=\"line\">CertUtil -dump -?   -- 显示 <span class=\"string\">\"dump\"</span> 动词的帮助文本</span><br></pre></td></tr></table></figure></p>\n<p>基础示例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1.文件校验(计算文件hash)</span></span><br><span class=\"line\">certutil -hashfile yourfilename.ext MD5</span><br><span class=\"line\">certutil -hashfile yourfilename.ext SHA1</span><br><span class=\"line\">certutil -hashfile yourfilename.ext SHA256</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.将文件进行base64编码和解码 (可用于windows的playload下载)</span></span><br><span class=\"line\">CertUtil -encode InFile OutFile</span><br><span class=\"line\">certutil -encode cos.conf base64.txt</span><br><span class=\"line\"><span class=\"comment\"># 输入长度 = 241</span></span><br><span class=\"line\"><span class=\"comment\"># 输出长度 = 392</span></span><br><span class=\"line\"><span class=\"comment\"># CertUtil: -encode 命令成功完成。</span></span><br><span class=\"line\"></span><br><span class=\"line\">CertUtil -decode InFile OutFile</span><br><span class=\"line\">certutil -decode base64.txt new.txt <span class=\"comment\">#解码</span></span><br><span class=\"line\"><span class=\"comment\"># 输入长度 = 392</span></span><br><span class=\"line\"><span class=\"comment\"># 输出长度 = 241</span></span><br><span class=\"line\"><span class=\"comment\"># CertUtil: -decode 命令成功完成。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3.文件下载(保存指定名称)</span></span><br><span class=\"line\">certutil -urlcache -split -f https://github.com/weblogic.py test.py</span><br><span class=\"line\">certutil -urlcache -f https://github.com/weblogic.py</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4.查看与清除缓存</span></span><br><span class=\"line\">certutil.exe -urlcache *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#@清除下载文件副本方法</span></span><br><span class=\"line\">- 方法一：直接删除缓存目录对应文件</span><br><span class=\"line\">- 方法二，命令行:certutil -urlcache -f https://github.com/weblogic.py delete</span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Windows命令","path":"api/categories/Windows命令.json"}],"tags":[{"name":"证书哈希","path":"api/tags/证书哈希.json"}]}