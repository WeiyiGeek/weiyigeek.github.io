{"title":"Windows服务器核心(Server-Core)安装与基础配置使用","slug":"系统运维/Windows/系统配置/Server/Core/Windows服务器核心(Server-Core)安装与基础配置使用","date":"2021-05-26T11:37:47.000Z","updated":"2023-01-31T02:29:10.468Z","url":"2021/5-26-559.html","path":"api/articles/2021/5-26-559.html.json","covers":["https://img.weiyigeek.top/2021/5/20210519143109.png","https://img.weiyigeek.top/2021/5/20210519143636.png","https://img.weiyigeek.top/2021/5/20210519144154.png","https://img.weiyigeek.top/2021/5/20210519152843.png","https://img.weiyigeek.top/2021/5/20210519184736.png","https://img.weiyigeek.top/2021/5/20210519160606.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"0x00-前言简述\"><a href=\"#0x00-前言简述\" class=\"headerlink\" title=\"0x00 前言简述\"></a>0x00 前言简述</h2><h3 id=\"1-简单介绍\"><a href=\"#1-简单介绍\" class=\"headerlink\" title=\"1.简单介绍\"></a>1.简单介绍</h3><p><strong>Q: Windows Server 中的服务器核心安装选项是什么?</strong></p>\n<blockquote>\n<p>答: “服务器核心” 选项是在部署 <code>Windows Server Standard</code> 或 Datacenter 版本时可用的最小安装选项。 服务器核心包括大多数但并非全部服务器角色。</p>\n</blockquote>\n<p>Tips : 微软介绍服务器核心时说道其降低的硬件要求、磁盘占用量较小，减小了更新需求因此攻击面更小。<br>Tips : 在设计上服务器核心中没有桌面,虽然维护支持传统的业务应用程序和基于角色的工作负荷所需的功能，但服务器核心没有传统的桌面界面。 相反，服务器核心旨<code>在通过命令行、PowerShell 或 GUI 工具进行远程管理</code> (如 RSAT 或 Windows 管理中心) 。</p>\n<p><br/></p>\n<p><strong>Q: 服务器 (核心) vs Server 桌面体验?</strong></p>\n<blockquote>\n<p>1.Server Core : 安装消除了对某些常用服务器角色的支持不是必需的任何服务和其他功能, 例如 Hyper-v 服务器不需要图形用户界面 (GUI) ，因为你可以从命令行使用 Windows PowerShell 或使用 Hyper-v 管理器远程管理 Hyper-v 的所有方面。<br>2.Server 桌面体验: 安装选项的服务器仍将安装许多服务和其他组件而这些组件通常不需要用于特定的使用方案。</p>\n</blockquote>\n<p>除了不提供UI界面外其主要区别如下:</p>\n<ul>\n<li>1.Windows系统的资源管理器<code>explorer</code>没有了。</li>\n<li>2.依赖MMC的控制台界面没有了意味着运行*.msc的命令将无法打开。</li>\n<li>3.控制面板选项<code>control</code>也没有了。</li>\n<li>4.Window Internet Explorer也没有了。</li>\n<li>5.服务器核心没有任何辅助工具</li>\n<li>6.没有用于设置服务器核心的 OOBE (全新体验)</li>\n<li>7.无音频支持</li>\n</ul>\n<p><br/></p>\n<h3 id=\"2-版本区别\"><a href=\"#2-版本区别\" class=\"headerlink\" title=\"2.版本区别\"></a>2.版本区别</h3><p>描述: 下表显示了在具有桌面体验的服务器核心与服务器上本地可用的应用程序</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">应用程序 \tServer Core \t服务器（提供桌面体验）</span><br><span class=\"line\">命令提示符 \t可用 \t可用</span><br><span class=\"line\">Windows PowerShell/Microsoft .NET \t可用 \t可用</span><br><span class=\"line\">Perfmon.exe \t不可用 \t可用</span><br><span class=\"line\">Windbg (GUI) \t受支持 \t受支持</span><br><span class=\"line\">Resmon.exe \t不可用 \t可用</span><br><span class=\"line\">Regedit \t可用 \t可用</span><br><span class=\"line\">Fsutil.exe \t可用 \t可用</span><br><span class=\"line\">Disksnapshot.exe \t不可用 \t可用</span><br><span class=\"line\">Diskpart.exe \t可用 \t可用</span><br><span class=\"line\">Diskmgmt.msc \t不可用 \t可用</span><br><span class=\"line\">Devmgmt.msc \t不可用 \t可用</span><br><span class=\"line\">服务器管理器 \t不可用 \t可用</span><br><span class=\"line\">Mmc.exe \t不可用 \t可用</span><br><span class=\"line\">Eventvwr.msc \t不可用 \t可用</span><br><span class=\"line\">Wevtutil (事件查询) \t可用 \t可用</span><br><span class=\"line\">Services.msc \t不可用 \t可用</span><br><span class=\"line\">控制面板 \t不可用 \t可用</span><br><span class=\"line\">Windows 更新 (GUI) \t不可用 \t可用</span><br><span class=\"line\">Windows 资源管理器 \t不可用 \t可用</span><br><span class=\"line\">任务栏 \t不可用 \t可用</span><br><span class=\"line\">任务栏通知 \t不可用 \t可用</span><br><span class=\"line\">任务管理器 \t可用 \t可用</span><br><span class=\"line\">Internet Explorer 或 Edge \t不可用 \t可用</span><br><span class=\"line\">内置帮助系统 \t不可用 \t可用</span><br><span class=\"line\">Windows 10 Shell \t不可用 \t可用</span><br><span class=\"line\">Windows Media Player \t不可用 \t可用</span><br><span class=\"line\">PowerShell \t可用 \t可用</span><br><span class=\"line\">PowerShell ISE \t不可用 \t可用</span><br><span class=\"line\">PowerShell 输入法 \t可用 \t可用</span><br><span class=\"line\">Mstsc.exe \t不可用 \t可用</span><br><span class=\"line\">远程桌面服务 \t可用 \t可用</span><br><span class=\"line\">Hyper-V 管理器 \t不可用 \t可用</span><br><span class=\"line\">记事本* \t不可用 \t可用</span><br></pre></td></tr></table></figure>\n<p><br></p>\n<h3 id=\"3-参考来源\"><a href=\"#3-参考来源\" class=\"headerlink\" title=\"3.参考来源\"></a>3.参考来源</h3><ul>\n<li>3.1 <a href=\"https://docs.microsoft.com/zh-cn/windows-server/administration/server-core/what-is-server-core\" target=\"_blank\" rel=\"noopener\">what-is-server-core</a></li>\n<li>3.2 <a href=\"https://docs.microsoft.com/zh-cn/windows-server/administration/server-core/server-core-roles-and-services\" target=\"_blank\" rel=\"noopener\">服务器核心中包含的角色-服务器核心中包含的角色服务-服务器核心中包含的角色服务</a></li>\n</ul>\n<hr>\n<h2 id=\"0x01-Server-Core-安装部署\"><a href=\"#0x01-Server-Core-安装部署\" class=\"headerlink\" title=\"0x01 Server-Core 安装部署\"></a>0x01 Server-Core 安装部署</h2><h3 id=\"1-环境准备\"><a href=\"#1-环境准备\" class=\"headerlink\" title=\"1.环境准备\"></a>1.环境准备</h3><p>描述: 在此处准备如下列环境进行<code>Server-Core 2019标准版(不带桌面)的操作系统</code>安装。</p>\n<ul>\n<li>(1) vSphere ESXI((博主的环境) 或者 WorkStation</li>\n<li>(2) Server-Core 基础配置 4G 4C 80GB(磁盘);</li>\n<li>(3) ISO 操作系统: <code>cn_windows_server_2019_updated_march_2019_x64_dvd_c1ffb46c.iso</code></li>\n</ul>\n<p><br></p>\n<h3 id=\"2-安装流程\"><a href=\"#2-安装流程\" class=\"headerlink\" title=\"2.安装流程\"></a>2.安装流程</h3><p>描述: Server Core 的其安装流程大致与桌面版本的安装流程差距不大，下面进行简要说明。</p>\n<ul>\n<li><p>Step 1.在 VMware ESXi 上创建 Windows Server Core 2019 的虚拟机。</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2021/5/20210519143109.png\" alt=\"WeiyiGeek.VMware ESXi\" title=\"\" class=\"\">\n                <p>WeiyiGeek.VMware ESXi</p>\n            </figure>\n</li>\n<li><p>Step 2.启动虚拟机点击下一步-&gt; 我没有产品密钥 (I) -&gt; 选择<code>Server 2019 Standard</code>不带桌面体验的 -&gt; 选择安装磁盘 -&gt; 进行Windows 系统的安装。</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2021/5/20210519143636.png\" alt=\"WeiyiGeek.Server 2019 Standard\" title=\"\" class=\"\">\n                <p>WeiyiGeek.Server 2019 Standard</p>\n            </figure>\n<p>Tips : 不带“桌面体验”的版本是”服务器核心”安装选项</p>\n</li>\n<li><p>Step 3.安装完成后，通过VMware远程会话连接进去之后，里面全是黑乎乎的一个命令行其它啥也没有；首次<code>需要进行用户密码更改 -&gt; 输入系统密码 -&gt; 完成后会出现cmd命令行</code>。</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2021/5/20210519144154.png\" alt=\"WeiyiGeek.Server Core 初始化设置\" title=\"\" class=\"\">\n                <p>WeiyiGeek.Server Core 初始化设置</p>\n            </figure>\n</li>\n</ul>\n<h2 id=\"0x02-Server-Core-管理配置\"><a href=\"#0x02-Server-Core-管理配置\" class=\"headerlink\" title=\"0x02 Server-Core 管理配置\"></a>0x02 Server-Core 管理配置</h2><p>描述: 由于服务器核心没有UI因此需要使用 <code>Windows PowerShell</code> cmdlet、命令行工具或远程工具来执行基本的管理任务,在使用上更像是在Linux上的命令行而在Core中则采用PowerShell进行系统的主要管理，在PS中随处都可以看见Linux Shell的影子例如ls、wget|curl(<code>别名指向的是Invoke-WebRequest</code>)。</p>\n<p>参考地址: <a href=\"https://docs.microsoft.com/zh-cn/windows-server/administration/server-core/server-core-administer\" target=\"_blank\" rel=\"noopener\">https://docs.microsoft.com/zh-cn/windows-server/administration/server-core/server-core-administer</a></p>\n<p><br/></p>\n<h3 id=\"1-服务器IP地址及DNS设置\"><a href=\"#1-服务器IP地址及DNS设置\" class=\"headerlink\" title=\"1.服务器IP地址及DNS设置\"></a>1.服务器IP地址及DNS设置</h3><p>描述: 安装服务器核心服务器时，默认情况下它具有 DHCP 地址。如果需要静态 IP 地址，可以使用以下步骤进行设置。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 1.运行 get-netipinterface 查看 IP 接口的 IfIndex 列中的数字或 InterfaceDescription 字符串。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 2. 运行以下 cmdlet 以设置静态 IP 地址：</span></span><br><span class=\"line\">New-NetIPaddress -InterfaceIndex 5 -IPAddress 10.10.107.220 -PrefixLength 24 -DefaultGateway 10.10.107.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 3.添加多个 DNS 服务器，请运行以下 cmdlet</span></span><br><span class=\"line\">Set-DNSClientServerAddress -InterfaceIndex 5 -ServerAddresses 223.6.6.6，223.5.5.5</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 4.如果需要切换到使用 DHCP 请运行下面的cmdlet</span></span><br><span class=\"line\">DnsClientServerAddress -InterfaceIndex 12 – ResetServerAddresses。</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2021/5/20210519152843.png\" alt=\"WeiyiGeek.IP地址及DNS设置\" title=\"\" class=\"\">\n                <p>WeiyiGeek.IP地址及DNS设置</p>\n            </figure>\n<p><br/></p>\n<h3 id=\"2-重命名服务器名称\"><a href=\"#2-重命名服务器名称\" class=\"headerlink\" title=\"2.重命名服务器名称\"></a>2.重命名服务器名称</h3><p>描述: 使用以下步骤重命名服务器<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 1.使用 hostname 或 ipconfig 命令确定服务器的当前名称。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 2.运行 rename-Computer &lt;new_name&gt; ComputerName</span></span><br><span class=\"line\">Rename-Computer WeiyiGeek</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 3.重新启动计算机。</span></span><br><span class=\"line\">Restart-Computer</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h3 id=\"3-将服务器加入到域中\"><a href=\"#3-将服务器加入到域中\" class=\"headerlink\" title=\"3.将服务器加入到域中\"></a>3.将服务器加入到域中</h3><p>描述: 使用以下cmdlet将计算机加入域。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -1.系统将提示您输入加入域的凭据和域名。</span></span><br><span class=\"line\">Add-Computer</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># -2.如果需要将域用户帐户添加到本地Administrators组，请在命令提示符下（不在PowerShell窗口中）运行以下命令：</span></span><br><span class=\"line\">net localgroup administrators /add &lt;DomainName&gt;\\&lt;UserName&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># -3.您可以通过运行“重新启动计算机”来完成此操作。</span></span><br><span class=\"line\">Restart-Computer</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h3 id=\"4-激活安装的服务器\"><a href=\"#4-激活安装的服务器\" class=\"headerlink\" title=\"4.激活安装的服务器\"></a>4.激活安装的服务器</h3><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 1.提供操作系统相对应的密钥进行激活</span></span><br><span class=\"line\">slmgr.vbs -ipk &lt;productkey&gt;</span><br><span class=\"line\"><span class=\"comment\"># slmgr.vbs -ipk WMDGN-G9PQG-XVVXX-R3X43-63DFG</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 2.如果激活成功，您将不会收到消息。</span></span><br><span class=\"line\">slmgr.vbs -ato</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 3.您还可以通过电话、使用密钥管理服务（KMS）服务器或远程激活服务器。要远程激活，请从远程计算机运行以下cmdlet：</span></span><br><span class=\"line\">cscript windows\\system32\\slmgr.vbs &lt;ServerName&gt; &lt;UserName&gt; &lt;password&gt;:-ato</span><br></pre></td></tr></table></figure>\n<p><br></p>\n<h3 id=\"5-启用Server的远程桌面\"><a href=\"#5-启用Server的远程桌面\" class=\"headerlink\" title=\"5.启用Server的远程桌面\"></a>5.启用Server的远程桌面</h3><p>描述: 虽然 Server Core 不提供mstsc.exe 远程桌面连接工具但可以提供远程连接的服务，便于我们客户端可以使用远程桌面工具进行连接。</p>\n<p>但默认情况下Windows Server 2019将外部远程桌面访问设置为禁用作为安全措施，我们可以轻松地从PowerShell中启用它。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 1.我们可以使用Set-ItemPropery cmdlet修改启用(0)或禁用(1)远程桌面的注册表值：</span></span><br><span class=\"line\">Set-ItemProperty -Path <span class=\"string\">'HKLM:\\System\\CurrentControlSet\\Control\\Terminal Server'</span> -name <span class=\"string\">\"fDenyTSConnections\"</span> -value 0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 2.使用'Enable-NetFirewallRule'配置Windows防火墙以允许远程桌面连接：</span></span><br><span class=\"line\">New-NetFirewallRule -Name <span class=\"string\">\"RDP\"</span> -DisplayName <span class=\"string\">\"Remote Desktop Services\"</span> -Description <span class=\"string\">\"Remote Desktop Services\"</span> -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 3389</span><br><span class=\"line\">  <span class=\"comment\"># Name                  : RDP</span></span><br><span class=\"line\">  <span class=\"comment\"># DisplayName           : Remote Desktop Services</span></span><br><span class=\"line\">  <span class=\"comment\"># Description           :</span></span><br><span class=\"line\">  <span class=\"comment\"># DisplayGroup          :</span></span><br><span class=\"line\">  <span class=\"comment\"># Group                 :</span></span><br><span class=\"line\">  <span class=\"comment\"># Enabled               : True</span></span><br><span class=\"line\">  <span class=\"comment\"># Profile               : Any</span></span><br><span class=\"line\">  <span class=\"comment\"># Platform              : &#123;&#125;</span></span><br><span class=\"line\">  <span class=\"comment\"># Direction             : Inbound</span></span><br><span class=\"line\">  <span class=\"comment\"># Action                : Allow</span></span><br><span class=\"line\">  <span class=\"comment\"># EdgeTraversalPolicy   : Block</span></span><br><span class=\"line\">  <span class=\"comment\"># LooseSourceMapping    : False</span></span><br><span class=\"line\">  <span class=\"comment\"># LocalOnlyMapping      : False</span></span><br><span class=\"line\">  <span class=\"comment\"># Owner                 :</span></span><br><span class=\"line\">  <span class=\"comment\"># PrimaryStatus         : OK</span></span><br><span class=\"line\">  <span class=\"comment\"># Status                : 已从存储区成功分析规则。 (65536)</span></span><br><span class=\"line\">  <span class=\"comment\"># EnforcementStatus     : NotApplicable</span></span><br><span class=\"line\">  <span class=\"comment\"># PolicyStoreSource     : PersistentStore</span></span><br><span class=\"line\">  <span class=\"comment\"># PolicyStoreSourceType : Local</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 3.启用远程桌面服务</span></span><br><span class=\"line\">Get-Service -DisplayName <span class=\"string\">\"*Remote Desktop Services*\"</span> | Start-Service -passthru</span><br><span class=\"line\">Status   Name               DisplayName</span><br><span class=\"line\">------   ----               -----------</span><br><span class=\"line\">Running  TermService        Remote Desktop Services</span><br><span class=\"line\">Running  UmRdpService       Remote Desktop Services UserMode Po...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 4.在我们的客户端执行mstsc.msc进行连接到Core服务器中</span></span><br><span class=\"line\">mstsc.exe /admin</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2021/5/20210519184736.png\" alt=\"WeiyiGeek.Core-Server\" title=\"\" class=\"\">\n                <p>WeiyiGeek.Core-Server</p>\n            </figure>\n<p><br></p>\n<h3 id=\"5-启用Windows-PowerShell远程管理\"><a href=\"#5-启用Windows-PowerShell远程管理\" class=\"headerlink\" title=\"5.启用Windows PowerShell远程管理\"></a>5.启用Windows PowerShell远程管理</h3><p>描述: 您可以启用Windows PowerShell远程处理，即在一台计算机上的Windows PowerShell中键入的命令在另一台计算机上运行。</p>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -1.使用Enable-PSRemoting启用Windows PowerShell远程处理。</span></span><br><span class=\"line\"><span class=\"built_in\">Enable-PSRemoting</span> -Force</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># -2.设置当前机器防火墙允许ICMPv4协议入站规则。</span></span><br><span class=\"line\">New-NetFirewallRule -DisplayName <span class=\"string\">\"Allow Ping\"</span> -Description <span class=\"string\">\"Allow ping\"</span> -Protocol ICMPv4 -IcmpType <span class=\"number\">8</span> -Enabled True -Profile Any -Action Allow </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># -3.设置core服务器的进行WINRM管理的防护墙通信规则(如果安全组有限制， 请开放对此机器入方向的5985（HTTP)和5986(HTTPS)端口)</span></span><br><span class=\"line\">Set-NetFirewallRule -Name <span class=\"string\">\"WINRM-HTTP-In-TCP-PUBLIC\"</span> -RemoteAddress Any</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># -4.本地客户端机器上执行如下命令</span></span><br><span class=\"line\">PS C:\\WINDOWS\\system32&gt; <span class=\"built_in\">Get-Service</span> winrm | <span class=\"built_in\">Start-Service</span></span><br><span class=\"line\">PS C:\\WINDOWS\\system32&gt; <span class=\"built_in\">Set-Item</span> WSMan:localhost\\client\\trustedhosts -value <span class=\"number\">10.10</span>.<span class=\"number\">107.220</span> -Force</span><br><span class=\"line\">PS C:\\WINDOWS\\system32&gt; <span class=\"built_in\">Enter-PsSession</span> -ComputerName <span class=\"number\">10.10</span>.<span class=\"number\">107.220</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># -5.执行命令验证</span></span><br><span class=\"line\">hostname</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2021/5/20210519160606.png\" alt=\"WeiyiGeek.Enter-PsSession\" title=\"\" class=\"\">\n                <p>WeiyiGeek.Enter-PsSession</p>\n            </figure>\n<p><br></p>\n<h3 id=\"6-使用OpenSSH远程管理Windows\"><a href=\"#6-使用OpenSSH远程管理Windows\" class=\"headerlink\" title=\"6.使用OpenSSH远程管理Windows\"></a>6.使用OpenSSH远程管理Windows</h3><p>描述: OpenSSH 是安全 Shell (SSH) 工具的开放源代码版本，Linux 及其他非 Windows 系统的管理员使用此类工具跨平台管理远程系统，OpenSSH 在 2018 年秋季已添加至 Windows，并包含在 Windows 10 和 Windows Server 2019 中。</p>\n<p>OpenSSH 是一款用于远程登录的连接工具，它使用 SSH 协议。它会加密客户端与服务器之间的所有流量，从而遏止窃听、连接劫持和其他攻击, SSH 是基于客户端-服务器体系结构，用户在其中工作的系统是客户端，所管理的远程系统是服务器，</p>\n<p>其包含一系列组件和工具，用于提供一种安全且简单的远程系统管理方法，其中包括：</p>\n<ul>\n<li>sshd.exe: 它是远程所管理的系统上必须运行的 SSH 服务器组件</li>\n<li>ssh.exe: 它是在用户的本地系统上运行的 SSH 客户端组件</li>\n<li>ssh-keygen.exe: 为 SSH 生成、管理和转换身份验证密钥</li>\n<li>ssh-agent.exe: 存储用于公钥身份验证的私钥</li>\n<li>ssh-add.exe: 将私钥添加到服务器允许的列表中</li>\n<li>ssh-keyscan.exe: 帮助从许多主机收集公用 SSH 主机密钥</li>\n<li>sftp.exe: 这是提供安全文件传输协议的服务，通过 SSH 运行</li>\n<li>scp.exe: 是在 SSH 上运行的文件复制实用工具</li>\n</ul>\n<p>Tips: 主 OpenSSH 开源项目是由 OpenBSD 项目的开发人员管理的。 此项目的 Microsoft 分支在 GitHub 中(<a href=\"https://github.com/PowerShell/openssh-portable\" target=\"_blank\" rel=\"noopener\">https://github.com/PowerShell/openssh-portable</a>)</p>\n<p><strong>1) 使用 PowerShell 安装 OpenSSH</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 1.若要使用 PowerShell 安装 OpenSSH，请先以管理员身份运行 PowerShell</span></span><br><span class=\"line\">Get-WindowsCapability -Online | ? Name -like <span class=\"string\">'OpenSSH*'</span></span><br><span class=\"line\">  <span class=\"comment\"># Name  : OpenSSH.Client~~~~0.0.1.0</span></span><br><span class=\"line\">  <span class=\"comment\"># State : Installed</span></span><br><span class=\"line\">  <span class=\"comment\"># Name  : OpenSSH.Server~~~~0.0.1.0</span></span><br><span class=\"line\">  <span class=\"comment\"># State : NotPresent</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 2.然后根据需要安装服务器或客户端组件(上面可以看见Client已经安装)下面我们直接安装Server端即可</span></span><br><span class=\"line\"><span class=\"comment\"># Install the OpenSSH Client</span></span><br><span class=\"line\"><span class=\"comment\"># Add-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0</span></span><br><span class=\"line\"><span class=\"comment\"># Install the OpenSSH Server</span></span><br><span class=\"line\">Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 3.安装完成会返回以下输出：</span></span><br><span class=\"line\">Path          :</span><br><span class=\"line\">Online        : True</span><br><span class=\"line\">RestartNeeded : False</span><br></pre></td></tr></table></figure><br><br/></p>\n<p><strong>2) 启动并配置 OpenSSH</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 4.启动并配置 SSH 服务器自动启动</span></span><br><span class=\"line\">Get-Service sshd | Start-Service -PassThru </span><br><span class=\"line\">Get-Service sshd | Set-Service -StartupType <span class=\"string\">'Automatic'</span></span><br><span class=\"line\">  <span class=\"comment\"># Status   Name               DisplayName</span></span><br><span class=\"line\">  <span class=\"comment\"># ------   ----               -----------</span></span><br><span class=\"line\">  <span class=\"comment\"># Running  sshd               OpenSSH SSH Server</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 5.防火墙规则查看应该有一个名为“OpenSSH Server In TCP”的防火墙规则，应该启用该规则</span></span><br><span class=\"line\">Get-NetFirewallRule -Name *ssh*</span><br><span class=\"line\">  <span class=\"comment\"># Name                  : OpenSSH-Server-In-TCP</span></span><br><span class=\"line\">  <span class=\"comment\"># DisplayName           : OpenSSH SSH Server (sshd)</span></span><br><span class=\"line\">  <span class=\"comment\"># Description           : Inbound rule for OpenSSH SSH Server (sshd)</span></span><br><span class=\"line\">  <span class=\"comment\"># DisplayGroup          : OpenSSH Server</span></span><br><span class=\"line\">  <span class=\"comment\"># Group                 : OpenSSH Server</span></span><br><span class=\"line\">  <span class=\"comment\"># Enabled               : True</span></span><br><span class=\"line\">  <span class=\"comment\"># Profile               : Any</span></span><br><span class=\"line\">  <span class=\"comment\"># Platform              : &#123;&#125;</span></span><br><span class=\"line\">  <span class=\"comment\"># Direction             : Inbound</span></span><br><span class=\"line\">  <span class=\"comment\"># Action                : Allow</span></span><br><span class=\"line\">  <span class=\"comment\"># EdgeTraversalPolicy   : Block</span></span><br><span class=\"line\">  <span class=\"comment\"># LooseSourceMapping    : False</span></span><br><span class=\"line\">  <span class=\"comment\"># LocalOnlyMapping      : False</span></span><br><span class=\"line\">  <span class=\"comment\"># Owner                 :</span></span><br><span class=\"line\">  <span class=\"comment\"># PrimaryStatus         : OK</span></span><br><span class=\"line\">  <span class=\"comment\"># Status                : 已从存储区成功分析规则。 (65536)</span></span><br><span class=\"line\">  <span class=\"comment\"># EnforcementStatus     : NotApplicable</span></span><br><span class=\"line\">  <span class=\"comment\"># PolicyStoreSource     : PersistentStore</span></span><br><span class=\"line\">  <span class=\"comment\"># PolicyStoreSourceType : Local</span></span><br><span class=\"line\">Get-NetFirewallRule -Name *ssh* | Get-NetFirewallPortFilter</span><br><span class=\"line\">  <span class=\"comment\"># Protocol      : TCP</span></span><br><span class=\"line\">  <span class=\"comment\"># LocalPort     : 22</span></span><br><span class=\"line\">  <span class=\"comment\"># RemotePort    : Any</span></span><br><span class=\"line\">  <span class=\"comment\"># IcmpType      : Any</span></span><br><span class=\"line\">  <span class=\"comment\"># DynamicTarget : Any</span></span><br><span class=\"line\"><span class=\"comment\">#如果防火墙不存在，请创建一个</span></span><br><span class=\"line\">New-NetFirewallRule -Name sshd -DisplayName <span class=\"string\">'OpenSSH Server (sshd)'</span> -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22</span><br></pre></td></tr></table></figure></p>\n<p>Tips : 安装 OpenSSH 服务器将创建并启用一个名为 OpenSSH-Server-In-TCP 的防火墙规则。 这允许端口 22 上的入站 SSH 流量。 如果未启用此规则且未打开此端口，那么连接将被拒绝或重置。<br><br/></p>\n<p><strong>3) 连接OpenSSH服务端</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 6.本地SSH客户端连接到远程Windows Server Core服务器上。(请务必以管理员身份运行)</span></span><br><span class=\"line\">PS C:\\WINDOWS\\system32&gt; ssh administrator@10.10.107.220</span><br><span class=\"line\">  <span class=\"comment\"># The authenticity of host '10.10.107.220 (10.10.107.220)' can't be established.ECDSA key fingerprint is SHA256:2gsICyg/iN268lJ6RzAtf7lsRr7yUG4qLAnQIjSKEio.</span></span><br><span class=\"line\">  <span class=\"comment\"># Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added '10.10.107.220' (ECDSA) to the list of known hosts.</span></span><br><span class=\"line\"><span class=\"comment\"># 系统此时会提示你输入密码。 作为安全预防措施，密码在键入的过程中不会显示。</span></span><br><span class=\"line\">  <span class=\"comment\"># administrator@10.10.107.220's password:</span></span><br><span class=\"line\">  <span class=\"comment\"># Microsoft Windows [版本 10.0.17763.379]  # 默认是以  Windows Command shell (cmd.exe) 作为终端</span></span><br><span class=\"line\">  <span class=\"comment\"># (c) 2018 Microsoft Corporation。保留所有权利。</span></span><br><span class=\"line\"><span class=\"comment\"># 连接后，你将看到 Windows 命令行界面提示符：</span></span><br><span class=\"line\">administrator@WEIYIGEEK C:\\Users\\Administrator&gt;hostname</span><br><span class=\"line\">WeiyiGeek</span><br></pre></td></tr></table></figure><br><br/></p>\n<p><strong>4) 为 Windows 中的 OpenSSH 配置默认 shell</strong><br>描述: 在 Windows 中 sshd 默认情况下从 <code>%programdata%\\ssh\\sshd_config</code> 中读取配置数据，也可以通过使用 -f 参数启动 sshd 来指定不同的配置文件,如果该文件不存在，则在启动该服务时，sshd 将使用默认配置生成一个文件。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 1.配置文件查看</span></span><br><span class=\"line\">administrator@WEIYIGEEK C:\\ProgramData\\ssh&gt;more C:\\ProgramData\\ssh\\sshd_config</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 2.通过将 shell 可执行文件的完整路径添加到 \\SOFTWARE\\OpenSSH 字符串值 DefaultShell 中的 Computer\\HKEY_LOCAL_MACHINE\\SOFTWARE\\OpenSSH，在 Windows 注册表中配置默认 ssh shell。</span></span><br><span class=\"line\"><span class=\"comment\"># 例如，以下 Powershell 命令将默认 shell 设置为 PowerShell.exe：</span></span><br><span class=\"line\">New-ItemProperty -Path <span class=\"string\">\"HKLM:\\SOFTWARE\\OpenSSH\"</span> -Name DefaultShell -Value <span class=\"string\">\"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\"</span> -PropertyType String -Force</span><br><span class=\"line\">  <span class=\"comment\"># DefaultShell : C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe</span></span><br><span class=\"line\">  <span class=\"comment\"># PSPath       : Microsoft.PowerShell.Core\\Registry::HKEY_LOCAL_MACHINE\\SOFTWARE\\OpenSSH</span></span><br><span class=\"line\">  <span class=\"comment\"># PSParentPath : Microsoft.PowerShell.Core\\Registry::HKEY_LOCAL_MACHINE\\SOFTWARE</span></span><br><span class=\"line\">  <span class=\"comment\"># PSChildName  : OpenSSH</span></span><br><span class=\"line\">  <span class=\"comment\"># PSDrive      : HKLM</span></span><br><span class=\"line\">  <span class=\"comment\"># PSProvider   : Microsoft.PowerShell.Core\\Registry</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 3.登陆验证查看配置是否生效</span></span><br><span class=\"line\">PS C:\\WINDOWS\\system32&gt; ssh administrator@10.10.107.220</span><br><span class=\"line\">  <span class=\"comment\"># administrator@10.10.107.220's password:</span></span><br><span class=\"line\">  <span class=\"comment\"># Windows PowerShell   # 切换后采用</span></span><br><span class=\"line\">  <span class=\"comment\"># 版权所有 (C) Microsoft Corporation。保留所有权利。</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>5) OpenSSH 密钥管理</strong><br>描述:对于 Windows OpenSSH 的 AuthenticationMethods，唯一可用的身份验证方法是<code>“password”和“publickey”</code>。Windows 环境中的大多数身份验证都是使用用户名-密码（password）对完成的适用于共享公共域的系统(可能会导致关键信息泄露)，跨域工作时（例如在本地和云托管的系统之间）很容易受到暴力攻击入侵。所以相比之下 Linux 环境通常使用公钥/私钥(<code>publickey</code>)对来驱动身份验证，这不要求使用可推测的密码。 OpenSSH 提供了工具来帮助支持此用途，具体如下：</p>\n<ul>\n<li>ssh-keygen ，用于生成安全的密钥</li>\n<li>ssh-agent 和 ssh-add ，用于安全地存储私钥</li>\n<li>scp 和 sftp ，在首次使用服务器时安全地复制公钥文件</li>\n</ul>\n<p>Tips : 密钥对指的是由特定的身份验证协议使用的公钥和私钥文件, SSH 公钥身份验证使用不对称加密算法来生成两个密钥文件<code>一个为“私钥”文件，一个为“公钥”文件</code>。</p>\n<ul>\n<li>Step 1.<code>主机密钥生成</code>:其具有特定的 ACL 要求，在 Windows 上这些要求等同于仅允许管理员和 System 进行访问，若要使用 SSH 服务器轻松进行密钥身份验证，请在权限提升的 PowerShell 提示符下运行以下命令：<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 已创建了 OpenSSHUtils PowerShell 模块来正确设置密钥 ACL，并且应当将该模块安装在服务器上</span></span><br><span class=\"line\">Install-Module -Force OpenSSHUtils -Scope AllUsers</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 首次使用 sshd 时，将自动生成主机的密钥对。如果 ssh-agent 正在运行则密钥将自动添加到本地存储中。</span></span><br><span class=\"line\">Get-Service -Name ssh-agent | Set-Service -StartupType Manual</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动ssh代理服务以保留服务器密钥</span></span><br><span class=\"line\">Start-Service ssh-agent</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 现在启动sshd服务</span></span><br><span class=\"line\">Start-Service sshd</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>Tips : 由于没有与 sshd 服务关联的用户，因此主机密钥存储在 <code>\\ProgramData\\ssh</code> 下。</p>\n<ul>\n<li><p>Step 2.<code>用户密钥生成</code>: 若要使用基于密钥的身份验证，首先需要为客户端生成一些公钥/私钥对。通过 PowerShell 或 cmd使用 ssh-keygen 生成一些密钥文件。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 密钥生成与Linux类似采用 ssh-keygen命令（可采用-t指定密钥类型）</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> ~\\.ssh\\</span><br><span class=\"line\">ssh-keygen</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 现在你有了一个公钥/私钥 ED25519 密钥对（.pub 文件是公钥，其余的是私钥）：</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Step 3.私钥文件等效于密码应当采用与保护密码相同的方式来保护它。为了实现此目的请使用 ssh-agent 来将私钥安全地存储在与你的 Windows 登录关联的 Windows 安全上下文中。 为执行该操作，请以管理员身份启动 ssh-agent 服务并使用 ssh-add 来存储私钥。</p>\n</li>\n</ul>\n<ul>\n<li>Step 4.<code>公钥部署</code>: 若要使用上面创建的用户密钥，需要将公钥放置在服务器上的一个文本文件中，该文件名为 authorized_keys，位于 <code>users\\username\\.ssh\\</code> 下, 将公钥 (~.ssh\\id_ed25519.pub) 的内容移动到服务器/主机上 ~.ssh 中名为 authorized_keys 的文本文件中。</li>\n</ul>\n<p>此示例使用了之前在上面的说明中在主机上安装的 OpenSSHUtils 模块中的 <code>Repair-AuthorizedKeyPermissions</code>函数。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Make sure that the .ssh directory exists in your server's home folder</span></span><br><span class=\"line\">ssh user1@domain1@contoso.com mkdir C:\\users\\user1\\.ssh\\</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Use scp to copy the public key file generated previously to authorized_keys on your server</span></span><br><span class=\"line\">scp C:\\Users\\user1\\.ssh\\id_ed25519.pub user1@domain1@contoso.com:C:\\Users\\user1\\.ssh\\authorized_keys</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Appropriately ACL the authorized_keys file on your server</span></span><br><span class=\"line\">ssh --% user1@domain1@contoso.com powershell -c <span class=\"variable\">$ConfirmPreference</span> = <span class=\"string\">'None'</span>; Repair-AuthorizedKeyPermission C:\\Users\\user1\\.ssh\\authorized_keys</span><br></pre></td></tr></table></figure></p>\n<p>Tips : AuthorizedKeysFile 默认值为<code>“.ssh/authorized_keys .ssh/authorized_keys2”</code>。 如果路径不是绝对路径，则它相对于用户的主目录（或配置文件图像路径）。<br>请注意如果用户属于管理员组，则改为使用 <code>%programdata%/ssh/administrators_authorized_keys。</code></p>\n<p>Tips : 这些步骤完成了对 Windows 上的 SSH 使用基于密钥的身份验证所需的配置,完成此项后用户可以从具有私钥的任何客户端连接到 sshd 主机。<br><br/></p>\n<p><strong>6) 使用 PowerShell 卸载 OpenSSH</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 7.使用 PowerShell 卸载 OpenSSH (如果在卸载时服务正在使用中，稍后可能需要重启 Windows。)</span></span><br><span class=\"line\"><span class=\"comment\"># Uninstall the OpenSSH Client</span></span><br><span class=\"line\">Remove-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Uninstall the OpenSSH Server</span></span><br><span class=\"line\">Remove-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0</span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Windows-Server","path":"api/categories/Windows-Server.json"},{"name":"Windows配置","path":"api/categories/Windows配置.json"}],"tags":[{"name":"Server-Core","path":"api/tags/Server-Core.json"}]}