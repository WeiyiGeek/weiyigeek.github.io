{"title":"CentOS8.x系统配置记录","slug":"系统运维/Linux/系统配置/CentOS/CentOS8.x系统配置记录","date":"2020-01-18T05:34:30.000Z","updated":"2022-03-29T05:39:06.305Z","url":"2020/1-18-197.html","path":"api/articles/2020/1-18-197.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200115091636.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200115091811.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200115092053.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200115092154.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200414225847.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-前言\"><a href=\"#0x00-前言\" class=\"headerlink\" title=\"0x00 前言\"></a>0x00 前言</h4><p>描述:主要记录了CentOS8安装使用和基础设置，以及发行版版本新特性配置实践;</p>\n<hr>\n<h4 id=\"0x01-安装流程\"><a href=\"#0x01-安装流程\" class=\"headerlink\" title=\"0x01 安装流程\"></a>0x01 安装流程</h4><p>安装环境:</p>\n<ul>\n<li>1.CentOS 8.0.1905</li>\n<li>2.vSphere 6.7 (Hypervisor)</li>\n</ul>\n<p>CentOS 8.0 安装流程如下:</p>\n<ul>\n<li>Step1.加载ISO镜像到系统启动，选择安装CentOS8.X即可;</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200115091636.png\" alt=\"WeiyiGeek.Step1\" title=\"\" class=\"\">\n                <p>WeiyiGeek.Step1</p>\n            </figure>\n<ul>\n<li>Step2.进行选择安装信息摘要安装，按照图中上述序号进行配置（重点配置根据需要进行安装目的地选择以及自定义分区swap分区大小）</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200115091811.png\" alt=\"WeiyiGeek.Step2\" title=\"\" class=\"\">\n                <p>WeiyiGeek.Step2</p>\n            </figure>\n<ul>\n<li>Step3.选择安装选择一般选择前三个选项(<code>带GUI的服务器</code>,<code>服务器</code>,<code>最小安装</code>);</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200115092053.png\" alt=\"WeiyiGeek.Step3\" title=\"\" class=\"\">\n                <p>WeiyiGeek.Step3</p>\n            </figure>\n<ul>\n<li>Step4.点击下一步进行安装然后，设置用户根密码即可，等待安装完成重启机器即可;</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200115092154.png\" alt=\"WeiyiGeek.Step4\" title=\"\" class=\"\">\n                <p>WeiyiGeek.Step4</p>\n            </figure>\n<p><br></p>\n<h4 id=\"0x02-基础配置\"><a href=\"#0x02-基础配置\" class=\"headerlink\" title=\"0x02 基础配置\"></a>0x02 基础配置</h4><h5 id=\"1-网络配置\"><a href=\"#1-网络配置\" class=\"headerlink\" title=\"1.网络配置\"></a>1.网络配置</h5><p>描述:由于CentOS8已经弃用network.service来管理网络，而采用nmcli进行网络所以本节简单的记录如何采用nmcli进行OS8网络的配置;<br>手动进行网络配置文件:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sed -i <span class=\"string\">'s/ONBOOT=no/ONBOOT=yes/g'</span> /etc/sysconfig/network-scripts/ifcfg-ens192</span><br><span class=\"line\">sed -i <span class=\"string\">'s/BOOTPROTO=dhcp/BOOTPROTO=static/g'</span> /etc/sysconfig/network-scripts/ifcfg-ens192</span><br><span class=\"line\">sed -i <span class=\"string\">'s/BOOTPROTO=\\\"dhcp\\\"/BOOTPROTO=\\\"static\\\"/g'</span> /etc/sysconfig/network-scripts/ifcfg-ens192</span><br><span class=\"line\">cat &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-ens192 &lt;&lt;EOF</span><br><span class=\"line\">IPADDR=10.20.172.241</span><br><span class=\"line\">NETMASK=255.255.255.0</span><br><span class=\"line\">GATEWAY=10.20.172..1</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure></p>\n<p>1.初始CentOS8静态IP设置:(配置文件参考上面)<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nmcli connect delete <span class=\"string\">'有线连接 1'</span> &amp;&amp; nmcli disconnect ens192 &amp;&amp; nmcli connect ens192 &amp;&amp; nmcli c load /etc/sysconfig/network-scripts/ifcfg-ens192</span><br></pre></td></tr></table></figure></p>\n<p>2.初始CentOS8动态IP设置:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nmcli connect delete <span class=\"string\">'有线连接 1'</span> </span><br><span class=\"line\">nmcli connect add <span class=\"built_in\">type</span> ethernet con-name ens192 ifname ens192 ipv4.method manual</span><br></pre></td></tr></table></figure></p>\n<p>3.切换建立指定的Connection链接<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nmcli conn add <span class=\"built_in\">type</span> ethernet con-name eth0 ifname ens192 ipv4.addr 100.20.172.242/24 ipv4.gateway 100.20.172.1 ipv4.dns <span class=\"string\">'223.6.6.6,223.5.5.5'</span> ipv4.method manual</span><br><span class=\"line\">nmcli conn up eth0</span><br></pre></td></tr></table></figure></p>\n<p>补充说明:</p>\n<ul>\n<li>ipv4.method:设置为manual表示BOOTPROTO=none即只有静态ip。如果设置为auto则表示动态获取IP;</li>\n<li>也可以通过<code>nmtui 命令</code>进行图形化界面的管理设置网卡;</li>\n</ul>\n<p><br></p>\n<p><strong>1.1 配置网卡支持IPV6以及自动获取</strong><br>描述：通常默认当前安装的CentOS系统是支持IPV6，如果机器网卡IPV6未启用可以参照如下方式。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 开启系统ipv6支持,修改 /etc/sysctl.conf 并增加下列配置。</span></span><br><span class=\"line\">net.ipv6.conf.all.disable_ipv6 = 0</span><br><span class=\"line\">net.ipv6.conf.default.disable_ipv6 = 0</span><br><span class=\"line\">net.ipv6.conf.lo.disable_ipv6 = 0</span><br><span class=\"line\"><span class=\"comment\"># 验证是否生效</span></span><br><span class=\"line\">sysctl -a | grep ipv6 | grep <span class=\"built_in\">disable</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 修改网卡配置文件增加IPv6配置选项，自动获取IPV6地址(注意需要交换机或者路由器开启ipv6地址分配)。</span></span><br><span class=\"line\">vim /etc/sysconfig/network-scripts/ifcfg-&#123;网卡名称&#125;</span><br><span class=\"line\">DHCPV6C=yes</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 增加IPv6默认路由</span></span><br><span class=\"line\">vim /etc/sysconfig/network-scripts/route6-eth0</span><br><span class=\"line\">default dev &#123;网卡名称&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重启网络</span></span><br><span class=\"line\">service network restart</span><br></pre></td></tr></table></figure>\n<p><br></p>\n<h5 id=\"2-同步时间配置\"><a href=\"#2-同步时间配置\" class=\"headerlink\" title=\"2.同步时间配置\"></a>2.同步时间配置</h5><p>在CentOS8.0中默认不再支持ntp软件包，时间同步将由chrony来实现，所以实现时间同步可以采用以下方法</p>\n<ul>\n<li>chrony</li>\n<li>ntp <code>继续使用它只不过需要额外安装</code></li>\n</ul>\n<p>时间时区:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 方式1</span></span><br><span class=\"line\">cp /etc/localtime&#123;,.bak&#125;</span><br><span class=\"line\">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方式2</span></span><br><span class=\"line\">timedatectl</span><br><span class=\"line\">timedatectl list-timezones</span><br><span class=\"line\">timedatectl <span class=\"built_in\">set</span>-timezone Asia/Shanghai</span><br></pre></td></tr></table></figure></p>\n<p><strong>chrony服务时间同步</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart chronyd</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p><strong>ntp服务时间同步</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#将通过wlnmp提供的源，来安装ntp服务</span></span><br><span class=\"line\"><span class=\"comment\">#添加wlnmp源 - 时间同步 - 时间同步</span></span><br><span class=\"line\">rpm -ivh http://mirrors.wlnmp.com/centos/wlnmp-release-centos.noarch.rpm &amp;&amp; yum install wntp &amp;&amp; ntpdate ntp1.aliyun.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#也可以编写定时任务，实现每3分钟向ntp1.aliyun.com同步一次时间，并将系统时间设置为硬件时间</span></span><br><span class=\"line\">crontab -l &amp;&amp; systemctl <span class=\"built_in\">enable</span> crond.service</span><br><span class=\"line\"><span class=\"variable\">$crontab</span> -e</span><br><span class=\"line\">*/3 * * * * /usr/sbin/ntpdate ntp1.aliyun.com &amp;&gt; /dev/null;/usr/sbin/hwclock -w</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h4 id=\"0x03-入坑解决\"><a href=\"#0x03-入坑解决\" class=\"headerlink\" title=\"0x03 入坑解决\"></a>0x03 入坑解决</h4><h5 id=\"1-CentOS8-x密码忘记更改\"><a href=\"#1-CentOS8-x密码忘记更改\" class=\"headerlink\" title=\"1. CentOS8.x密码忘记更改\"></a>1. CentOS8.x密码忘记更改</h5><p>1.重启服务器在选择内核版本界面上按e进入编辑Grub界面，将cl-root 后的<code>ro</code> 变成 <code>rw init=/sysroot/bin/bash</code></p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200414225847.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n<p>2.同时按住Ctrl和x键，系统进入emergency(紧急情况)模式。</p>\n<p>3.运行命令“chroot /sysroot/ ”切换回原始系统然后即可修改密码，修改完密码运行命令<code>“touch /.autorelabel”</code>，使SELinux生效密码生效。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/<span class=\"comment\"># chroot /sysroot/</span></span><br><span class=\"line\">/<span class=\"comment\"># LANG=en         （把语言改为英文）</span></span><br><span class=\"line\">/<span class=\"comment\"># passwd</span></span><br><span class=\"line\">/<span class=\"comment\"># touch /.autorelabel</span></span><br></pre></td></tr></table></figure><br>4.同时按住Ctrl和d键，输入reboot，回车，系统重新启动。</p>\n<p><br></p>\n<h5 id=\"2-系统时间与实际时间差8个小时\"><a href=\"#2-系统时间与实际时间差8个小时\" class=\"headerlink\" title=\"2.系统时间与实际时间差8个小时\"></a>2.系统时间与实际时间差8个小时</h5><p>问题描述:查看系统时间发现系统时间和<code>Universal time</code>时间相差8个小时；<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$date</span></span><br><span class=\"line\">Thu May 14  21:13:32 UTC 2020</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$timedatectl</span></span><br><span class=\"line\">      Local time: 一 2020-05-14 21:13:19 CST</span><br><span class=\"line\">  Universal time: 一 2020-05-14 13:13:19 UTC  <span class=\"comment\">#实际应该的时间</span></span><br><span class=\"line\">        RTC time: 一 2020-05-14 13:13:19</span><br><span class=\"line\">       Time zone: Asia/Shanghai (CST, +0800)</span><br><span class=\"line\">     NTP enabled: no</span><br><span class=\"line\">NTP synchronized: no</span><br><span class=\"line\"> RTC <span class=\"keyword\">in</span> <span class=\"built_in\">local</span> TZ: no</span><br><span class=\"line\">      DST active: n/a</span><br></pre></td></tr></table></figure><br>解决方法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1.查看系统时区并删除当前系统所处的分区</span></span><br><span class=\"line\">ls /usr/share/zoneinfo/</span><br><span class=\"line\">sudo rm /etc/localtime</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.从/usr/share/zoneinfo/中创建软连接以替换当前的时区信息，直接选择Universal：</span></span><br><span class=\"line\">sudo ln -s /usr/share/zoneinfo/Universal /etc/localtime</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3.再次查看系统时间时间恢复正常</span></span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Linux配置","path":"api/categories/Linux配置.json"}],"tags":[{"name":"CentOS","path":"api/tags/CentOS.json"}]}