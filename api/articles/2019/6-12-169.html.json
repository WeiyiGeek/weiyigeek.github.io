{"title":"系统配置性能优化测试","slug":"系统运维/Linux/常用命令/系统管理类命令/系统配置性能优化测试","date":"2019-06-12T11:36:30.000Z","updated":"2023-01-31T02:29:09.181Z","url":"2019/6-12-169.html","path":"api/articles/2019/6-12-169.html.json","covers":["https://img.weiyigeek.top/2019/20190611170735.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h3 id=\"0x00-系统配置\"><a href=\"#0x00-系统配置\" class=\"headerlink\" title=\"0x00 系统配置\"></a>0x00 系统配置</h3><h4 id=\"locale-命令\"><a href=\"#locale-命令\" class=\"headerlink\" title=\"locale 命令\"></a>locale 命令</h4><p>描述：查看或者设置系统语言的环境变量</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#参数</span></span><br><span class=\"line\">系统信息：</span><br><span class=\"line\">  -a, --all-locales          写出可用区域的名称</span><br><span class=\"line\">  -m, --charmaps             写出可用字符映射的名称</span><br><span class=\"line\"></span><br><span class=\"line\">修改输出格式：</span><br><span class=\"line\">  -c, --category-name        写出选中范畴的名称</span><br><span class=\"line\">  -k, --keyword-name         写出选中关键字的名称</span><br></pre></td></tr></table></figure>\n<p>实际案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1.系统语言环境变量设置查看</span></span><br><span class=\"line\"><span class=\"variable\">$locale</span></span><br><span class=\"line\">LANG=zh_CN.UTF-8</span><br><span class=\"line\">LC_CTYPE=<span class=\"string\">\"zh_CN.UTF-8\"</span></span><br><span class=\"line\">LC_NUMERIC=<span class=\"string\">\"zh_CN.UTF-8\"</span></span><br><span class=\"line\">LC_TIME=<span class=\"string\">\"zh_CN.UTF-8\"</span></span><br><span class=\"line\">LC_COLLATE=<span class=\"string\">\"zh_CN.UTF-8\"</span></span><br><span class=\"line\">LC_MONETARY=<span class=\"string\">\"zh_CN.UTF-8\"</span></span><br><span class=\"line\">LC_MESSAGES=<span class=\"string\">\"zh_CN.UTF-8\"</span></span><br><span class=\"line\">LC_PAPER=<span class=\"string\">\"zh_CN.UTF-8\"</span></span><br><span class=\"line\">LC_NAME=<span class=\"string\">\"zh_CN.UTF-8\"</span></span><br><span class=\"line\">LC_ADDRESS=<span class=\"string\">\"zh_CN.UTF-8\"</span></span><br><span class=\"line\">LC_TELEPHONE=<span class=\"string\">\"zh_CN.UTF-8\"</span></span><br><span class=\"line\">LC_MEASUREMENT=<span class=\"string\">\"zh_CN.UTF-8\"</span></span><br><span class=\"line\">LC_IDENTIFICATION=<span class=\"string\">\"zh_CN.UTF-8\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例2.查看可用的字符集</span></span><br><span class=\"line\"><span class=\"variable\">$locale</span> -a | egrep -n -i <span class=\"string\">\"en_US\"</span></span><br><span class=\"line\">233:en_US</span><br><span class=\"line\">234:en_US.iso88591</span><br><span class=\"line\">235:en_US.iso885915</span><br><span class=\"line\">236:en_US.utf8</span><br><span class=\"line\"><span class=\"built_in\">export</span> LANG=en_US.utf8 <span class=\"comment\">#临时生效</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例3.大写和小写的映射由当前语言环境的 LC_CTYPE 范畴定义</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$LC_CTYPE</span></span><br><span class=\"line\">C.UTF-8</span><br></pre></td></tr></table></figure></p>\n<p><strong>补充说明:</strong></p>\n<ul>\n<li>Debian 9 语系中文支持安装<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/app<span class=\"comment\"># locale -a</span></span><br><span class=\"line\">locale: Cannot <span class=\"built_in\">set</span> LC_CTYPE to default locale: No such file or directory</span><br><span class=\"line\">locale: Cannot <span class=\"built_in\">set</span> LC_MESSAGES to default locale: No such file or directory</span><br><span class=\"line\">locale: Cannot <span class=\"built_in\">set</span> LC_COLLATE to default locale: No such file or directory</span><br><span class=\"line\">C</span><br><span class=\"line\">C.UTF-8</span><br><span class=\"line\">POSIX</span><br><span class=\"line\"></span><br><span class=\"line\">cat &gt; /etc/apt/sources.list &lt;&lt;<span class=\"string\">'END'</span> </span><br><span class=\"line\">deb http://mirrors.aliyun.com/debian stretch main contrib non-free</span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/debian stretch main contrib non-free</span><br><span class=\"line\">deb http://mirrors.aliyun.com/debian stretch-updates main contrib non-free</span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/debian stretch-updates main contrib non-free</span><br><span class=\"line\">deb http://mirrors.aliyun.com/debian-security stretch/updates main contrib non-free</span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/debian-security stretch/updates main contrib non-free</span><br><span class=\"line\">END</span><br><span class=\"line\"></span><br><span class=\"line\">$ apt clean &amp;&amp; apt update</span><br><span class=\"line\"></span><br><span class=\"line\">$ apt install -y locales   </span><br><span class=\"line\">  <span class=\"comment\"># Reading package lists... Done</span></span><br><span class=\"line\">  <span class=\"comment\"># Building dependency tree       </span></span><br><span class=\"line\">  <span class=\"comment\"># Reading state information... Done</span></span><br><span class=\"line\">  <span class=\"comment\"># The following additional packages will be installed:</span></span><br><span class=\"line\">  <span class=\"comment\">#   libc-l10n</span></span><br><span class=\"line\">  <span class=\"comment\"># The following NEW packages will be installed:</span></span><br><span class=\"line\">  <span class=\"comment\">#   libc-l10n locales</span></span><br><span class=\"line\">  <span class=\"comment\"># 0 upgraded, 2 newly installed, 0 to remove and 100 not upgraded.</span></span><br><span class=\"line\">  <span class=\"comment\"># Need to get 4108 kB of archives.</span></span><br><span class=\"line\">  <span class=\"comment\"># After this operation, 13.8 MB of additional disk space will be used.</span></span><br><span class=\"line\">  <span class=\"comment\"># Do you want to continue? [Y/n] y</span></span><br><span class=\"line\">  <span class=\"comment\"># Get:1 http://mirrors.aliyun.com/debian stretch/main amd64 libc-l10n all 2.24-11+deb9u4 [820 kB]</span></span><br><span class=\"line\">  <span class=\"comment\"># Get:2 http://mirrors.aliyun.com/debian stretch/main amd64 locales all 2.24-11+deb9u4 [3289 kB]</span></span><br><span class=\"line\">  <span class=\"comment\"># Fetched 4108 kB in 1s (3481 kB/s)</span></span><br><span class=\"line\">  <span class=\"comment\"># perl: warning: Setting locale failed.</span></span><br><span class=\"line\">  <span class=\"comment\"># perl: warning: Please check that your locale settings:</span></span><br><span class=\"line\">  <span class=\"comment\">#     LANGUAGE = (unset),</span></span><br><span class=\"line\">  <span class=\"comment\">#     LC_ALL = \"zh_CN.GB18030\",</span></span><br><span class=\"line\">  <span class=\"comment\">#     LANG = \"zh_CN.GB18030\"</span></span><br><span class=\"line\">  <span class=\"comment\">#   are supported and installed on your system.</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ sed -i <span class=\"string\">'s/# zh_CN.GB18030/zh_CN.GB18030/g'</span> /etc/locale.gen</span><br><span class=\"line\"></span><br><span class=\"line\">$ locale-gen </span><br><span class=\"line\"><span class=\"comment\"># $ echo -e \"466 \\n 3 \\n\" | dpkg-reconfigure locales</span></span><br><span class=\"line\"><span class=\"comment\"># Locales to be generated: dpkg-reconfigure locales</span></span><br><span class=\"line\"><span class=\"comment\"># Locales to be generated: 466</span></span><br><span class=\"line\"><span class=\"comment\"># Many packages in Debian use locales to display text in the correct language for the user. You can choose a default locale for the system from the generated locales.</span></span><br><span class=\"line\"><span class=\"comment\"># This will select the default language for the entire system. If this system is a multi-user system where not all users are able to speak the default language, they will experience difficulties.</span></span><br><span class=\"line\"><span class=\"comment\"># 1. None  2. C.UTF-8  3. zh_CN.GB18030</span></span><br><span class=\"line\"><span class=\"comment\"># Default locale for the system environment: 3</span></span><br><span class=\"line\"><span class=\"comment\"># Generating locales (this might take a while)...</span></span><br><span class=\"line\"><span class=\"comment\">#   zh_CN.GB18030... done</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ locale -a</span><br><span class=\"line\">  <span class=\"comment\"># C</span></span><br><span class=\"line\">  <span class=\"comment\"># C.UTF-8</span></span><br><span class=\"line\">  <span class=\"comment\"># POSIX</span></span><br><span class=\"line\">  <span class=\"comment\"># zh_CN.gb18030</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<h4 id=\"localectl-命令\"><a href=\"#localectl-命令\" class=\"headerlink\" title=\"localectl 命令\"></a>localectl 命令</h4><p>描述: 查询或更改系统区域设置和键盘设置。</p>\n<p>基础语法&amp;参数:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Query or change system locale and keyboard settings.</span></span><br><span class=\"line\">localectl [OPTIONS...] COMMAND ... </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Commands:</span></span><br><span class=\"line\">  status                   Show current locale settings</span><br><span class=\"line\">  <span class=\"built_in\">set</span>-locale LOCALE...     Set system locale</span><br><span class=\"line\">  list-locales             Show known locales</span><br><span class=\"line\">  <span class=\"built_in\">set</span>-keymap MAP [MAP]     Set console and X11 keyboard mappings</span><br><span class=\"line\">  list-keymaps             Show known virtual console keyboard mappings</span><br><span class=\"line\">  <span class=\"built_in\">set</span>-x11-keymap LAYOUT [MODEL [VARIANT [OPTIONS]]]</span><br><span class=\"line\">                           Set X11 and console keyboard mappings</span><br><span class=\"line\">  list-x11-keymap-models   Show known X11 keyboard mapping models</span><br><span class=\"line\">  list-x11-keymap-layouts  Show known X11 keyboard mapping layouts</span><br><span class=\"line\">  list-x11-keymap-variants [LAYOUT]</span><br><span class=\"line\">                           Show known X11 keyboard mapping variants</span><br><span class=\"line\">  list-x11-keymap-options  Show known X11 keyboard mapping options</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Options:</span></span><br><span class=\"line\">  -h --<span class=\"built_in\">help</span>                Show this <span class=\"built_in\">help</span></span><br><span class=\"line\">     --version             Show package version</span><br><span class=\"line\">     --no-pager            Do not pipe output into a pager</span><br><span class=\"line\">     --no-ask-password     Do not prompt <span class=\"keyword\">for</span> password</span><br><span class=\"line\">  -H --host=[USER@]HOST    Operate on remote host</span><br><span class=\"line\">  -M --machine=CONTAINER   Operate on <span class=\"built_in\">local</span> container</span><br><span class=\"line\">     --no-convert          Don<span class=\"string\">'t convert keyboard mappings</span></span><br></pre></td></tr></table></figure></p>\n<p>使用案例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># (1) 查看当前区域配置</span></span><br><span class=\"line\">~$ localectl status</span><br><span class=\"line\">  <span class=\"comment\"># System Locale: LANG=en_US.UTF-8</span></span><br><span class=\"line\">  <span class=\"comment\">#     VC Keymap: n/a</span></span><br><span class=\"line\">  <span class=\"comment\">#   X11 Layout: cn</span></span><br><span class=\"line\">  <span class=\"comment\">#     X11 Model: pc105</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2) 查看系统支持的汉语区域语言</span></span><br><span class=\"line\">~$ localectl list-locales</span><br><span class=\"line\">  <span class=\"comment\"># C.UTF-8</span></span><br><span class=\"line\">  <span class=\"comment\"># en_US.UTF-8</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (3) 设置区域语言</span></span><br><span class=\"line\">~$ localectl <span class=\"built_in\">set</span>-locale  LANG=zh_CN.utf8</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h4 id=\"getconf-命令\"><a href=\"#getconf-命令\" class=\"headerlink\" title=\"getconf 命令\"></a>getconf 命令</h4><p>描述:它是个ELF可执行文件,该命令将系统配置变量值写入标准输出用于获取系统信息,在进行LINUX编程中可以提供其帮忙;</p>\n<p>基础语法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#语法</span></span><br><span class=\"line\">Usage: getconf [-v specification] variable_name [pathname]</span><br><span class=\"line\">       getconf -a [pathname]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#参数</span></span><br><span class=\"line\">-a 标志调用，并写入全部系统配置变量值到标准输出。</span><br></pre></td></tr></table></figure></p>\n<p><strong>系统范围配置变量</strong><br>描述:系统范围配置变量包含系统各部分中的最小值。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_CS_PATH \tPATH 环境变量值，用以查找命令。</span><br><span class=\"line\">---|---</span><br><span class=\"line\">ARG_MAX \t用于一个 <span class=\"built_in\">exec</span> 子例程的参数的最大长度（以字节为单位），包含环境数据。</span><br><span class=\"line\">BC_BASE_MAX \tbc 命令使用的 obase 变量允许的最大值。</span><br><span class=\"line\">BC_DIM_MAX \tbc 命令所允许的一个数组中的最大元素数。</span><br><span class=\"line\">BC_SCALE_MAX \tbc 命令使用的 scale 变量允许的最大值。</span><br><span class=\"line\">BC_STRING_MAX \tbc 命令可接受的字符串常量的最大长度。</span><br><span class=\"line\">CHARCLASS_NAME_MAX \t字符类名中的最大字节数。</span><br><span class=\"line\">CHAR_BIT \t类型 character 的位数。</span><br><span class=\"line\">CHAR_MAX \t类型 character 的最大值。</span><br><span class=\"line\">CHAR_MIN \t类型 character 的最小值。</span><br><span class=\"line\">CHILD_MAX \t每个真实用户标识同时打开进程的最大数量。</span><br><span class=\"line\">CLK_TCK \t由 time 子例程返回的每秒钟时钟计数。</span><br><span class=\"line\">COLL_WEIGHTS_MAX \t配给在一个语言环境定义文件的 LC_COLLATE 语言环境节中条目的最大权重。</span><br><span class=\"line\">CS_PATH \tPATH 环境变量值，用以查找命令。</span><br><span class=\"line\">EXPR_NEST_MAX \t圆括号内可嵌套的最大表达式数，用于 expr 命令。</span><br><span class=\"line\">INT_MAX \t类型的最大值，类型为 int。</span><br><span class=\"line\">INT_MIN \t类型的最小值，类型为 int。</span><br><span class=\"line\">LINE_MAX \t当实用程序被描述成为处理文本文件时，命令输入行（标准输入或者是其它文件）的最大长度（以字节为单位）。长度包含换行字符的空间。</span><br><span class=\"line\">LONG_BIT \t类型中的位数，类型为 long int。</span><br><span class=\"line\">LONG_MAX \t类型的最大值，类型为 long int。</span><br><span class=\"line\">LONG_MIN \t类型的最小值，类型为 long int。</span><br><span class=\"line\">MB_LEN_MAX \t在所有支持的语言环境中一个字符的最大字节数。</span><br><span class=\"line\">NGROUPS_MAX \t每个进程中同时补充的最大组标识数。</span><br><span class=\"line\">NL_ARGMAX \t在 <span class=\"built_in\">printf</span> 和 scanf 子例程调用中的数字最大值。</span><br><span class=\"line\">NL_LANGMAX \t在一个 LANG 名中最大字节数。</span><br><span class=\"line\">NL_MSGMAX \t最大消息数。</span><br><span class=\"line\">NL_NMAX \t一个从 N 到 1 整序映射中最大字节数。</span><br><span class=\"line\">NL_SETMAX \t最大设置数。</span><br><span class=\"line\">NL_TEXTMAX \t一个消息字符串中最大字节数。</span><br><span class=\"line\">NZERO \t缺省进程优先级。</span><br><span class=\"line\">OPEN_MAX \t在进程中可同时打开的最大文件数。</span><br><span class=\"line\">PATH \t用以查找命令的以冒号相隔的路径前缀的序列。</span><br><span class=\"line\">RE_DUP_MAX \t当使用间隔符号参数时允许正则表达式重复出现次数的最大值，正如 ed 命令使用的 m 和 n 参数。</span><br><span class=\"line\">SCHAR_MAX \t类型的最大值，类型为 signed char。</span><br><span class=\"line\">SCHAR_MIN \t类型的最小值，类型为 signed char。</span><br><span class=\"line\">SHRT_MAX \t类型的最大值，类型为 short。</span><br><span class=\"line\">SHRT_MIN \t类型的最小值，类型为 short。</span><br><span class=\"line\">SSIZE_MAX \t一个类型为 ssize_t 的对象的最大值。</span><br><span class=\"line\">STREAM_MAX \t一个进程可同时打开的流数。</span><br><span class=\"line\">TMP_MAX \t由 tmpnam 子例程生成的唯一路径名的最小数量。一个应用程序可靠调用 tmpnam 子例程的最多次数。</span><br><span class=\"line\">TZNAME_MAX \t一个时区名支持的最大字节数（非 TZ 环境变量的长度）。</span><br><span class=\"line\">UCHAR_MAX \t类型的最大值，类型为 unsigned char。</span><br><span class=\"line\">UINT_MAX \t类型的最大值，类型为 unsigned int。</span><br><span class=\"line\">ULONG_MAX \t类型的最大值，类型为 unsigned long int。</span><br><span class=\"line\">USHRT_MAX \t类型的最大值，类型为 unsigned short int。</span><br><span class=\"line\">WORD_BIT \t字或类型 int 中的位数。</span><br><span class=\"line\">KERNEL_BITMODE \t内核的位方式，32 位或 64 位.</span><br><span class=\"line\">REAL_MEMORY \t真实内存大小。</span><br><span class=\"line\">HARDWARE_BITMODE \t计算机硬件的位方式，32 位或 64 位。</span><br><span class=\"line\">MP_CAPABLE \t计算机微处理器容量。</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>系统标准配置变量</strong><br>描述:系统标准配置变量包含由一个特殊系统标准所要求的最小值。</p>\n<ul>\n<li><em>POSIX</em>、POSIX2_ 和 <em>XOPEN</em> 前缀显示变量包含分别由 POSIX 1003.1、POSIX 1003.2 和 X/Open 系统标准要求的系统特性最小值。</li>\n<li>系统标准是系统满足的用来支持特定系统标准的全系统最小值。实际配置值可能超出这些标准。</li>\n</ul>\n<p>基础信息:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_POSIX_ARG_MAX \t用于 <span class=\"built_in\">exec</span> 子例程的参数的最大长度（以字节为长度），包含环境数据。</span><br><span class=\"line\">_POSIX_CHILD_MAX \t每个真实用户标识同时打开进程的最大数量。</span><br><span class=\"line\">_POSIX_JOB_CONTROL \t如果系统支持作业控制，则值为 1。</span><br><span class=\"line\">_POSIX_LINK_MAX \t到单个文件的最大链接数。</span><br><span class=\"line\">_POSIX_MAX_CANON \t在终端规范输入队列中的最大字节数。</span><br><span class=\"line\">_POSIX_MAX_INPUT \t在终端输入队列中允许的最大字节数。</span><br><span class=\"line\">_POSIX_NAME_MAX \t文件名中的最大字节数（不包含终止空字符）。</span><br><span class=\"line\">_POSIX_NGROUPS_MAX \t每个进程中同时补充的最大组标识数。</span><br><span class=\"line\">_POSIX_OPEN_MAX \t在进程中可同时打开的最大文件数。</span><br><span class=\"line\">_POSIX_PATH_MAX \t路径名中的最大字节数。</span><br><span class=\"line\">_POSIX_PIPE_BUF \t写入管道时保证成为原子的最大字节数。</span><br><span class=\"line\">_POSIX_SAVED_IDS \t值为１。每个进程具有保存的 <span class=\"built_in\">set</span>-user-ID 和保存的 <span class=\"built_in\">set</span>-group-ID。</span><br><span class=\"line\">_POSIX_SSIZE_MAX \t可存进一个类型为 ssize_t 对象的最大值。</span><br><span class=\"line\">_POSIX_STREAM_MAX \t一个进程可同时打开的流数。</span><br><span class=\"line\">_POSIX_TZNAME_MAX \t一个时区名支持的最大字节数（非 TZ 环境变量的长度）。</span><br><span class=\"line\">_POSIX_VERSION \t操作系统遵守的 POSIX 1 标准（C 语言绑定）的版本。</span><br><span class=\"line\">_XOPEN_CRYPT \t如果系统支持 X/Open 加密功能组则值为 1。</span><br><span class=\"line\">_XOPEN_ENH_I18N \t如果系统支持 X/Open 增强国际化功能组则值为 1。</span><br><span class=\"line\">_XOPEN_SHM \t如果系统支持 X/Open 共享内存功能组则值为 1。</span><br><span class=\"line\">_XOPEN_VERSION \t操作系统所遵守的 X/Open 可移植性指南的版本。</span><br><span class=\"line\">_XOPEN_XCU_VERSION \t操作系统所遵守的 X/Open 命令和实用程序规范的版本。</span><br><span class=\"line\">_XOPEN_XPG2 \t如果系统支持 1987 年 1 月卷 2 的 X/Open 可移植性指南，XVS 系统调用和库，则值为 1，否则为未定义。</span><br><span class=\"line\">_XOPEN_XPG3 \t如果系统支持 1992 年 2 月 的 X/Open 规范，系统接口和头第三版，则缺省值为 1，否则为未定义。</span><br><span class=\"line\">_XOPEN_XPG4 \t如果系统支持 1992 年 7 月 的 X/Open CAE 规范，系统接口和头第 4 版，则值为 1，否则为未定义。</span><br><span class=\"line\">POSIX2_BC_BASE_MAX \t允许的最大值，用于 obase 变量并使用 bc 命令。</span><br><span class=\"line\">POSIX2_BC_DIM_MAX \tbc 命令允许数组中的最大元素数。</span><br><span class=\"line\">POSIX2_BC_SCALE_MAX \t允许的最大值,用于 scale 变量，执行 bc 命令。</span><br><span class=\"line\">POSIX2_BC_STRING_MAX \t可被 bc 命令接受的字符串常量的最大长度。</span><br><span class=\"line\">POSIX2_CHAR_TERM \t系统支持至少一个终端类型则值为 1；否则值为 -1。</span><br><span class=\"line\">POSIX2_COLL_WEIGHTS_MAX \t配给一个条目的最大权重数目，条目在一个语言环境定义文件中的 LC_COLLATE 语言环境变量中。</span><br><span class=\"line\">POSIX2_C_BIND \t如果系统支持 POSIX 2 中的 C 语言绑定选项，则值为 1；否则，值为-1。</span><br><span class=\"line\">POSIX2_C_DEV \t如果系统支持 POSIX 2 中的 C 语言开发实用程序则值为 1；否则，值为 -1。</span><br><span class=\"line\">POSIX2_C_VERSION \t操作系统所遵守的 POSIX 2 标准（C 语言绑定）的版本。</span><br><span class=\"line\">POSIX2_EXPR_NEST_MAX \t圆括号内可嵌套的最大表达式数，用于 expr 命令。</span><br><span class=\"line\">POSIX2_FORT_DEV \t如果系统支持 POSIX 2 中的 FORTRAN 开发实用程序选项则值为 1；否则，值为 -1。</span><br><span class=\"line\">POSIX2_FORT_RUN \t如果系统支持 POSIX 2 中的 FORTRAN 运行时实用程序选项则值为 1；否则，值为 -1。</span><br><span class=\"line\">POSIX2_LINE_MAX \t当命令被描述成处理文本文件时，一个命令输入行（标准输入或其他文件）的最大字节长度。长度包含换行字符空间。</span><br><span class=\"line\">POSIX2_LOCALEDEF \t如果系统支持由 localedef 命令创建语言环境，则值为 1；否则值未定义。</span><br><span class=\"line\">POSIX2_RE_DUP_MAX \t当使用间隔计数参数时正则表达式所允许重复出现的最大值，例如带 m 和 n 参数使用 ed 命令。</span><br><span class=\"line\">POSIX2_SW_DEV \t系统支持软件开发实用程序选项则值为 1；否则，值为 -1。</span><br><span class=\"line\">POSIX2_UPE \t如果系统支持 POSIX 2 中用户可移植实用程序选项，则值为 1；否则，值为 -1。</span><br><span class=\"line\">POSIX2_VERSION \t系统支持的 POSIX 2 标准的最新版本的批准日期。这个日期是一个六位数字，前四位数字表示年份后两位数字表示月份。POSIX 2 标准的不同版本由 IEEE 标准委员会定期批准，批准日期用于区分不同版本。</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>系统路径配置变量:</strong><br>该变量值包含在系统中的路径和路径结构信息;<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_POSIX_CHOWN_RESTRICTED \tchown() 子例程以适当的特权限制在进程，并且将文件的组标识只更改为进程的有效组标识或辅助组标识之一。如果 PathName 参数引用目录，其返回值应用于除在目录中已存在的或可被创建的目录外的所有文件。</span><br><span class=\"line\">_POSIX_NO_TRUNC \t路径名长于变量 NAME_MAX 指定的限定值就会产生错误。如果 PathName 参数引用目录，其返回值应用于目录中的文件名。</span><br><span class=\"line\">_POSIX_VDISABLE \t终端特殊字符，定义在 termios.h 文件中，可使用这一字符值禁用。</span><br><span class=\"line\">LINK_MAX \t链接一个文件的最大链接数。如果 PathName 参数引用目录，则返回值应用于该目录。</span><br><span class=\"line\">MAX_CANON \t在终端规范输入行中的最大字节数。</span><br><span class=\"line\">MAX_INPUT \t在终端输入队列有可用空间的最大字节数。</span><br><span class=\"line\">NAME_MAX \t文件名中的最大字节数（不包含终止空字符）。如果 PathName 参数引用目录，返回值应用于目录内的文件名。</span><br><span class=\"line\">PATH_MAX \t路径名中的最大字节数，包含终止空字符。如果 PathName 参数引用目录，返回值为当指定目录是工作目录时的相对路径名的最大长度。</span><br><span class=\"line\">PIPE_BUF \t当写入管道时保证成为原子的最大字节数。如果这个 PathName 参数指向先进先出或是管道，其返回值应用于引用对象。如果 PathName 参数引用目录，返回值应用于任何已存在的或可在目录内创建的先进先出。</span><br><span class=\"line\">DISK_PARTITION \t磁盘的物理分区大小。</span><br><span class=\"line\">注:</span><br><span class=\"line\">对于 DISK_PARTITION 路径配置变量，这个 PathName 参数必须指定为之查询信息的磁盘的完整路径。</span><br><span class=\"line\">DISK_SIZE \t磁盘大小以兆字节为单位。</span><br><span class=\"line\">注:</span><br><span class=\"line\">对于 DISK_SIZE 路径配置变量，这个 PathName 参数必须指定为之查询信息的磁盘的完整路径。</span><br></pre></td></tr></table></figure></p>\n<p>基础实例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#获取系统所有变量信息</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#查看系统内存分页大小</span></span><br><span class=\"line\">getconf PAGE_SIZE </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#linux是32位还是64位最简单的方法</span></span><br><span class=\"line\">getconf LONG_BIT </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#获取系统类型所占</span></span><br><span class=\"line\">getconf CHAR_BIT</span><br><span class=\"line\">8</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#参数关键配置文件</span></span><br><span class=\"line\">/usr/bin/getconf \t<span class=\"comment\">#包含一个 getconf 命令。</span></span><br><span class=\"line\">/usr/include/limits.h \t<span class=\"comment\">#定义系统配置变量。</span></span><br><span class=\"line\">/usr/include/unistd.h \t<span class=\"comment\">#定义系统配置变量。</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h4 id=\"chsh-命令\"><a href=\"#chsh-命令\" class=\"headerlink\" title=\"chsh 命令\"></a>chsh 命令</h4><p>描述：切换当前shell终端为zsh/或者其他shell</p>\n<p>基础示例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#查看shell列表</span></span><br><span class=\"line\">$ cat /etc/shells </span><br><span class=\"line\">/bin/sh</span><br><span class=\"line\">/bin/bash</span><br><span class=\"line\">/sbin/nologin</span><br><span class=\"line\">/usr/bin/sh</span><br><span class=\"line\">/usr/bin/bash</span><br><span class=\"line\">/usr/sbin/nologin</span><br><span class=\"line\">/bin/tcsh</span><br><span class=\"line\">/bin/csh</span><br><span class=\"line\">/bin/zsh</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#切换shell为zsh,重启后，查看当前shell</span></span><br><span class=\"line\">$ chsh -s /bin/zsh</span><br><span class=\"line\">Changing shell <span class=\"keyword\">for</span> root.</span><br><span class=\"line\">Shell changed.</span><br><span class=\"line\"></span><br><span class=\"line\">WeiyiGeek<span class=\"comment\"># echo $SHELL</span></span><br><span class=\"line\">/bin/zsh</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"0x01-系统运行安全\"><a href=\"#0x01-系统运行安全\" class=\"headerlink\" title=\"0x01 系统运行安全\"></a>0x01 系统运行安全</h3><h4 id=\"1-selinux-相关\"><a href=\"#1-selinux-相关\" class=\"headerlink\" title=\"1.selinux 相关\"></a>1.selinux 相关</h4><h5 id=\"getenforce-命令\"><a href=\"#getenforce-命令\" class=\"headerlink\" title=\"getenforce 命令\"></a>getenforce 命令</h5><h5 id=\"setenforce-命令\"><a href=\"#setenforce-命令\" class=\"headerlink\" title=\"setenforce 命令\"></a>setenforce 命令</h5><p>描述:SELinux是Linux系统上一个常见的安全软件，如果熟悉它的规则，可以用它来为Linux系统新增一道保障；<br>SELinux一共有3种状态，分别是Enforcing，Permissive和Disabled状态。</p>\n<ul>\n<li>第一种是默认状态，表示强制启用，</li>\n<li>第二种是宽容的意思，即大部分规则都放行。</li>\n<li>第三种是禁用，即不设置任何规则</li>\n</ul>\n<p>操作实例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#方式1.---------------通过图像进行管理----------------------</span></span><br><span class=\"line\"><span class=\"comment\">#我们需要安装SELinux的图形管理工具，命令是：</span></span><br><span class=\"line\">yum install policycoreutils-gui -y </span><br><span class=\"line\"><span class=\"comment\">#安装完成后，执行一个命令启动gui管理工具，命令是:</span></span><br><span class=\"line\">system-config-selinux</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#方式2.临时生效</span></span><br><span class=\"line\"><span class=\"variable\">$getenforce</span> <span class=\"comment\">#查看一下SELinux的状态，默认情况下一般都是Enforcing状态，也就是强制启用的意思</span></span><br><span class=\"line\">Enforcing</span><br><span class=\"line\"></span><br><span class=\"line\">usage: setenforce [ Enforcing | Permissive | 1 | 0 ] </span><br><span class=\"line\"><span class=\"comment\">#只能通过setenforce命令来设置前面两种状态，而如果想修改为disable状态，需要修改配置文件，同时重启系统</span></span><br><span class=\"line\"><span class=\"variable\">$setenforce</span> 2</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#方式3.通过修改设置文件，让某个配置永久生效，配置文件的位置是：</span></span><br><span class=\"line\">vim /etc/selinux/config</span><br><span class=\"line\">SELINUX = <span class=\"built_in\">disable</span></span><br><span class=\"line\"><span class=\"comment\">#或者</span></span><br><span class=\"line\">sed -i <span class=\"string\">\"s#SELINUX=enforcing#SELINUX = disable#g\"</span> /etc/selinux/config</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h5 id=\"semanage-命令\"><a href=\"#semanage-命令\" class=\"headerlink\" title=\"semanage 命令\"></a>semanage 命令</h5><p>描述:默认目录的安全上下文查询与修改,简单得说是用来查询与修改SELinux默认目录的安全上下文。<br>SELinux的策略与规则管理相关命令：<code>seinfo命令、sesearch命令、getsebool命令、setsebool命令、semanage命令</code>。</p>\n<p>语法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">semanage &#123;import,<span class=\"built_in\">export</span>,login,user,port,ibpkey,ibendport,interface,module,node,fcontext,boolean,permissive,dontaudit&#125; -l</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#usage: usage: semanage fcontext </span></span><br><span class=\"line\">[-h] [-n] [-N] [-S STORE] [ --add ( -t TYPE -f FTYPE -r RANGE -s SEUSER | -e EQUAL ) FILE_SPEC ) | --delete ( -t TYPE -f FTYPE | -e EQUAL ) FILE_SPEC ) | --deleteall  | --extract  | --list -C | --modify ( -t TYPE -f FTYPE -r RANGE -s SEUSER | -e EQUAL ) FILE_SPEC ) ]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#usage: semanage port </span></span><br><span class=\"line\">[-h] [-n] [-N] [-S STORE] [ --add -t TYPE -p PROTOCOL -r RANGE ( port_name | port_range ) | --delete -p PROTOCOL ( port_name | port_range ) | --deleteall  | --extract  | --list -C | --modify -t TYPE -p PROTOCOL -r RANGE ( port_name | port_range ) ]</span><br><span class=\"line\"></span><br><span class=\"line\">```            </span><br><span class=\"line\"></span><br><span class=\"line\">选项:</span><br><span class=\"line\">```bash</span><br><span class=\"line\"><span class=\"comment\">#fcontext：主要用在安全上下文方面。</span></span><br><span class=\"line\">-l：查询。</span><br><span class=\"line\">-a：增加，你可以增加一些目录的默认安全上下文类型设置。</span><br><span class=\"line\">-m：修改。</span><br><span class=\"line\">-d：删除。</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#port：主要用在的端口方面。</span></span><br><span class=\"line\">-a：增加</span><br><span class=\"line\">-t：指定SELinux 端口类型(ssh_port_t )</span><br><span class=\"line\">-p: 端口协议</span><br></pre></td></tr></table></figure></p>\n<p>实例:</p>\n<ul>\n<li>fcontext<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 示例1.查询一下/var/www/html的默认安全性本文的设置：</span></span><br><span class=\"line\">$ semanage fcontext -l |grep <span class=\"string\">\"/var/www\"</span></span><br><span class=\"line\">SELinux fcontext                                   类型                 上下文</span><br><span class=\"line\">....(前面省略)....</span><br><span class=\"line\">/var/www(/.*)?      all files     system_u:object_r:httpd_sys_content_t:s0</span><br><span class=\"line\">....(後面省略)....</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 如上面例子所示，我们可以查询的到每个目录的安全性本文！而目录的设定可以使用正则表达式去指定一个范围。那么如果我们想要增加某些自定义目录的安全性本文呢？</span></span><br><span class=\"line\"><span class=\"comment\"># 示例2.举例来说，我想要设置/srv/samba成为 public_content_t的类型时，应该如何设置呢？</span></span><br><span class=\"line\"><span class=\"comment\"># 答:用semanage命令设置/srv/samba目录的默认安全性本文为public_content_t：</span></span><br><span class=\"line\">mkdir /srv/samba &amp;&amp; ll -Zd /srv/samba</span><br><span class=\"line\">drwxr-xr-x  root root root:object_r:var_t    /srv/samba</span><br><span class=\"line\"><span class=\"comment\"># 如上所示，默认的情况应该是var_t这个咚咚的！</span></span><br><span class=\"line\">semanage fcontext -l | grep <span class=\"string\">'/srv'</span></span><br><span class=\"line\">/srv/.*                     all files   system_u:object_r:var_t:s0</span><br><span class=\"line\">/srv/([^/]*/)?ftp(/.*)?     all files   system_u:object_r:public_content_t:s0</span><br><span class=\"line\">/srv/([^/]*/)?www(/.*)?     all files   system_u:object_r:httpd_sys_content_t:s0</span><br><span class=\"line\">/srv/([^/]*/)?rsync(/.*)?   all files   system_u:object_r:public_content_t:s0</span><br><span class=\"line\">/srv/gallery2(/.*)?         all files   system_u:object_r:httpd_sys_content_t:s0</span><br><span class=\"line\">/srv                        directory   system_u:object_r:var_t:s0   //看这里！</span><br><span class=\"line\"><span class=\"comment\">#上面则是默认的/srv底下的安全性本文资料，不过并没有指定到/srv/samba。</span></span><br><span class=\"line\">semanage fcontext -a -t public_content_t <span class=\"string\">\"/srv/samba(/.*)?\"</span></span><br><span class=\"line\">semanage fcontext -l | grep <span class=\"string\">'/srv/samba'</span></span><br><span class=\"line\">/srv/samba(/.*)?            all files   system_u:object_r:public_content_t:s0</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 示例3.在selinux中进行写入</span></span><br><span class=\"line\"><span class=\"variable\">$cat</span> /etc/selinux/targeted/contexts/files/file_contexts.local</span><br><span class=\"line\"><span class=\"comment\"># This file is auto-generated by libsemanage，Please use the semanage command to make changes</span></span><br><span class=\"line\">/srv/samba(/.*)?    system_u:object_r:public_content_t:s0  <span class=\"comment\">#写入这个档案默认账</span></span><br><span class=\"line\"><span class=\"variable\">$restorecon</span> -Rv /srv/samba* <span class=\"comment\">#尝试恢复默认值</span></span><br><span class=\"line\"><span class=\"variable\">$ll</span> -Zd /srv/samba</span><br><span class=\"line\">drwxr-xr-x  root root system_u:object_r:public_content_t /srv/samba/  <span class=\"comment\">#有默认值以后用restorecon命令来修改比较简单！</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>补充说明:</p>\n<ul>\n<li>如上所示你可以使用semanage来查询所有的目录默认值，也能够使用它来增加默认值的设置！</li>\n</ul>\n<p><br></p>\n<p>实际案例: Port-SElinux系统端口更改<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 示例0.查看设置的SELinux 端口类型对应的协议以及端口号</span></span><br><span class=\"line\">$ semanage port -l | grep <span class=\"string\">\"ssh\"</span></span><br><span class=\"line\">SELinux 端口类型                协议     端口号</span><br><span class=\"line\">ssh_port_t                     tcp      22</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 示例1.如果希望更改SELinux系统上的端口，则必须将此更改告知SELinux。</span></span><br><span class=\"line\">$ semanage port -a -t ssh_port_t -p tcp 62222</span><br><span class=\"line\">$ semanage port -l | grep <span class=\"string\">\"ssh\"</span></span><br><span class=\"line\">ssh_port_t                     tcp      62222, 22</span><br></pre></td></tr></table></figure></p>\n<p>Tips: 知识扩展 CentOS7 中防火墙设置SSHD服务通信。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 修改firewall配置</span></span><br><span class=\"line\">firewall-cmd --zone=public --add-port=5000/tcp --permanent </span><br><span class=\"line\"><span class=\"comment\"># 重载防火墙</span></span><br><span class=\"line\">firewall-cmd --reload</span><br><span class=\"line\"><span class=\"comment\"># 重启ssh服务</span></span><br><span class=\"line\">systemctl restart sshd.service</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h5 id=\"restorecon-命令\"><a href=\"#restorecon-命令\" class=\"headerlink\" title=\"restorecon 命令\"></a>restorecon 命令</h5><p>描述:该命令用来恢复SELinux文件属性即恢复文件的安全上下文。</p>\n<p>假设CentOS安装了apache，网页默认的主目录是/var/www/html，我们经常遇到这样的问题，在其他目录中创建了一个网页文件，然后用mv移动到网页默认目录/var/www/html中，但是在浏览器中却打不开这个文件，这很可能是因为这个文件的SELinux配置信息是继承原来那个目录的，与/var/www/html目录不同，使用mv移动的时候，这个SELinux配置信息也一起移动过来了，从而导致无法打开页面，如何解决？</p>\n<p>此时便需要采用restorecon命令进行恢复文件安全上下文，具体如何操作请看下面得基础示例;</p>\n<p>基础语法选项:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#语法</span></span><br><span class=\"line\">restorecon [-iFnrRv] [-e excludedir ] [-o filename ] [-f filename | pathname...]</span><br><span class=\"line\"><span class=\"comment\">#选项</span></span><br><span class=\"line\">-i：忽略不存在的文件。</span><br><span class=\"line\">-f：infilename 文件 infilename 中记录要处理的文件。</span><br><span class=\"line\">-e：directory 排除目录。</span><br><span class=\"line\">-R/-r：递归处理目录。</span><br><span class=\"line\">-n：不改变文件标签。</span><br><span class=\"line\">-o/outfilename：保存文件列表到 outfilename，在文件不正确情况下。</span><br><span class=\"line\">-v：将过程显示到屏幕上。</span><br><span class=\"line\">-F：强制恢复文件安全语境。</span><br></pre></td></tr></table></figure></p>\n<p>基础示例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例1.使用restorecon来恢复网页主目录中所有文件的SELinux配置信息(如果目标为一个目录，可以添加-R参数递归)</span></span><br><span class=\"line\"><span class=\"comment\">#  * 这个时候我们使用firefox浏览器输入127.0.0.1/index.html发现打不开，</span></span><br><span class=\"line\"><span class=\"comment\">#  * 查看一下SELinux的日志文件，发现了下面这一段报错信息，从这个报错信息不难看出，</span></span><br><span class=\"line\"><span class=\"comment\">#  * 进程httpd访问网页主目录中的index.html时被SELinux阻止，原因是因为SELinux配置信息不正确,</span></span><br><span class=\"line\"><span class=\"comment\">#  * 正确的SELinux配置信息应该是scontext=后面的部分，</span></span><br><span class=\"line\"><span class=\"comment\">#  * 而index.html文件的SELinux配置信息却是tcontext=后面的部分，</span></span><br><span class=\"line\"><span class=\"comment\">#  * 从tcontext=的第三段“admin_home_t”不难看出，这个文件的SELinux配置信息是root用户家目录的。</span></span><br><span class=\"line\"><span class=\"built_in\">type</span>=AVC msg=audit(1378974214.610:465): avc:  denied  &#123; open &#125; <span class=\"keyword\">for</span>  pid=2359 comm=<span class=\"string\">\"httpd\"</span> path=<span class=\"string\">\"/var/www/html/index.html\"</span> dev=<span class=\"string\">\"sda1\"</span> ino=1317685 scontext=system_u:system_r:httpd_t:s0 tcontext=unconfined_u:object_r:admin_home_t:s0 tclass=file</span><br><span class=\"line\"><span class=\"comment\">#/*使用ls -Z也可以看出文件和目录的SELinux信息不匹配*/</span></span><br><span class=\"line\">ls -Z /var/www/html/</span><br><span class=\"line\"><span class=\"comment\">#.... unconfined_u:object_r:admin_home_t:s0 index.html  #文件</span></span><br><span class=\"line\">ls -Zd /var/www/html/</span><br><span class=\"line\"><span class=\"comment\">#.... system_u:object_r:httpd_sys_content_t:s0 /var/www/html/ #目录</span></span><br><span class=\"line\">restorecon -vR /var/www/html/  <span class=\"comment\">#恢复该目录下得所有文件得SELinux配置信息;</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"0x02-系统内核管理\"><a href=\"#0x02-系统内核管理\" class=\"headerlink\" title=\"0x02 系统内核管理\"></a>0x02 系统内核管理</h3><h4 id=\"ulimit-命令\"><a href=\"#ulimit-命令\" class=\"headerlink\" title=\"ulimit 命令\"></a>ulimit 命令</h4><p>描述：Ulimit 用于限制当前shell内进程的资源使用，并发线程限制;<br><em>ulimit到底有怎样的运用</em>？<br>假设：有这样一种情况，当一台 Linux 主机上同时登陆了 10 个人，在系统资源无限制的情况下，这 10 个用户同时打开了 500 个文档，而假设每个文档的大小有 10M，这时系统的内存资源就会受到巨大的挑战。</p>\n<p>用途：用于限制 shell 启动进程所占用的资源，支持以下各种类型的限制：所创建的内核文件的大小、进程数据块的大小、Shell 进程创建文件的大小、内存锁住的大小、常驻内存集的大小、打开文件描述符的数量、分配堆栈的最大大小、CPU 时间、单个用户的最大线程数、Shell 进程所能使用的最大虚拟内存。同时它支持硬资源和软资源的限制。</p>\n<ul>\n<li>作为临时限制：ulimit 可以作用于通过使用其命令登录的 shell 会话，在会话终止时便结束限制，并不影响于其他 shell 会话。</li>\n<li>长期的固定限制：ulimit 命令语句又可以被添加到由登录 shell 读取的文件中，作用于特定的shell 用户。</li>\n</ul>\n<p><strong>语法参数:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">选项 [options] \t含义 \t例子</span><br><span class=\"line\">-H \t设置硬资源限制，一旦设置不能增加。 \t<span class=\"comment\"># ulimit – Hs 64；限制硬资源，线程栈大小为 64K。</span></span><br><span class=\"line\">-S \t设置软资源限制，设置后可以增加，但是不能超过硬资源设置。 <span class=\"comment\"># \tulimit – Sn 32；限制软资源，32 个文件描述符。</span></span><br><span class=\"line\">-a \t显示当前所有的 <span class=\"built_in\">limit</span> 信息。 \t<span class=\"comment\"># ulimit – a；显示当前所有的 limit 信息。</span></span><br><span class=\"line\">-c \t最大的 core 文件的大小， 以 blocks 为单位。 \t<span class=\"comment\"># ulimit – c unlimited； 对生成的 core 文件的大小不进行限制。</span></span><br><span class=\"line\">-d \t进程最大的数据段的大小，以 Kbytes 为单位。 \t<span class=\"comment\"># ulimit -d unlimited；对进程的数据段大小不进行限制。</span></span><br><span class=\"line\">-f \t进程可以创建文件的最大值，以 blocks 为单位。 \t<span class=\"comment\"># ulimit – f 2048；限制进程可以创建的最大文件大小为 2048 blocks。</span></span><br><span class=\"line\">-l \t最大可加锁内存大小，以 Kbytes 为单位。 <span class=\"comment\"># ulimit – l 32；限制最大可加锁内存大小为 32 Kbytes。</span></span><br><span class=\"line\">-m \t最大内存大小，以 Kbytes 为单位。 \t<span class=\"comment\"># ulimit – m unlimited；对最大内存不进行限制。</span></span><br><span class=\"line\">-n \t可以打开最大文件描述符的数量。 \t<span class=\"comment\"># ulimit – n 128；限制最大可以使用 128 个文件描述符。</span></span><br><span class=\"line\">-p \t管道缓冲区的大小，以 Kbytes 为单位。 \t<span class=\"comment\"># ulimit – p 512；限制管道缓冲区的大小为 512 Kbytes。</span></span><br><span class=\"line\">-s \t线程栈大小，以 Kbytes 为单位。 \t<span class=\"comment\"># ulimit – s 512；限制线程栈的大小为 512 Kbytes。</span></span><br><span class=\"line\">-t \t最大的 CPU 占用时间，以秒为单位。 \t<span class=\"comment\"># ulimit – t unlimited；对最大的 CPU 占用时间不进行限制。</span></span><br><span class=\"line\">-u \t用户最大可用的进程数。 \t<span class=\"comment\"># ulimit – u 64；限制用户最多可以使用 64 个进程。</span></span><br><span class=\"line\">-v \t进程最大可用的虚拟内存，以 Kbytes 为单位。 \t<span class=\"comment\"># ulimit – v 200000；限制最大可用的虚拟内存为 200000 Kbytes。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 全局配置文件 ：/etc/security/limits</span></span><br><span class=\"line\">&lt;domain&gt;&lt;<span class=\"built_in\">type</span>&gt;&lt;item&gt;&lt;value&gt;</span><br></pre></td></tr></table></figure></p>\n<p><strong>实际案例：</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 示例1.查看系统资源进程使用限制</span></span><br><span class=\"line\">~$ <span class=\"built_in\">ulimit</span> -a  <span class=\"comment\">#查看默认值</span></span><br><span class=\"line\">  <span class=\"comment\"># core file size            (blocks, -c) 0</span></span><br><span class=\"line\">  <span class=\"comment\"># data seg size             (kbytes, -d) unlimited</span></span><br><span class=\"line\">  <span class=\"comment\"># scheduling priority               (-e) 0</span></span><br><span class=\"line\">  <span class=\"comment\"># file size                 (blocks, -f) unlimited</span></span><br><span class=\"line\">  <span class=\"comment\"># pending signals                   (-i) 7962</span></span><br><span class=\"line\">  <span class=\"comment\"># max locked memory         (kbytes, -l) 64</span></span><br><span class=\"line\">  <span class=\"comment\"># max memory size           (kbytes, -m) unlimited</span></span><br><span class=\"line\">  <span class=\"comment\"># open files                        (-n) 1024  #此种参数</span></span><br><span class=\"line\">  <span class=\"comment\"># pipe size             (512 kbytes, -p) 8</span></span><br><span class=\"line\">  <span class=\"comment\"># POSIX message queues      (kbytes, -q) 819200</span></span><br><span class=\"line\">  <span class=\"comment\"># real-time priority                (-r) 0</span></span><br><span class=\"line\">  <span class=\"comment\"># stack size                (kbytes, -s) 8192</span></span><br><span class=\"line\">  <span class=\"comment\"># cpu time                 (seconds, -t) unlimited</span></span><br><span class=\"line\">  <span class=\"comment\"># max user processes                (-u) 7962</span></span><br><span class=\"line\">  <span class=\"comment\"># virtual memory            (kbytes, -v) unlimited</span></span><br><span class=\"line\">  <span class=\"comment\"># file locks                        (-x) unlimited</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 示例2.查看指定的参数值, 例如查看系统默认的最大文件句柄数</span></span><br><span class=\"line\">~$ <span class=\"built_in\">ulimit</span> -n</span><br><span class=\"line\">  <span class=\"comment\"># 1024</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 示例3.限制系统参数设置   </span></span><br><span class=\"line\"><span class=\"built_in\">ulimit</span> -u 10240          <span class=\"comment\"># 某linux用户的最大进程数设为1024个：</span></span><br><span class=\"line\"><span class=\"built_in\">ulimit</span> -n 65535          <span class=\"comment\"># 最大文件句柄数设置为65535 </span></span><br><span class=\"line\"><span class=\"built_in\">ulimit</span> -m 5000 -v 5000   <span class=\"comment\"># 限制shell内存使用</span></span><br><span class=\"line\"><span class=\"comment\"># 其他建议设置成无限制（unlimited）的一些重要设置是：</span></span><br><span class=\"line\">数据段长度：<span class=\"built_in\">ulimit</span> -d unlimited</span><br><span class=\"line\">最大内存大小：<span class=\"built_in\">ulimit</span> -m unlimited</span><br><span class=\"line\">堆栈大小：<span class=\"built_in\">ulimit</span> -s unlimited</span><br><span class=\"line\">CPU 时间：<span class=\"built_in\">ulimit</span> -t unlimited</span><br></pre></td></tr></table></figure></p>\n<p><strong>补充说明:</strong></p>\n<ul>\n<li>1.设置<code>ulimit</code>和<code>file-max</code>两者之间的关系差别<ul>\n<li>file-max：/proc/sys/fs/file-max: 是设置系统<code>所有进程一共可以打开的文件数量</code>，同时一些程序可以通过setrlimit调用，设置每个进程的限制，如果得到大量使用完文件句柄的错误信息，是应该增加这个值也就是说这项参数是系统级别的。</li>\n<li>ulimit：即设置当前shell以及由它启动的进程的资源限制</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.修改file-max文件或者内核 </span></span><br><span class=\"line\"><span class=\"comment\"># 下面面2种重启机器后会恢复为默认值</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> 9223372036854775807 &gt; /proc/sys/fs/file-max </span><br><span class=\"line\">sysctl -w <span class=\"string\">\"fs.file-max=9223372036854775807\"</span></span><br><span class=\"line\"><span class=\"comment\"># vim /etc/sysctl.conf,加入以下内容重启生效</span></span><br><span class=\"line\">fs.file-max = 65535</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2. 修改ulimit的 open file 系统默认的ulimit对文件打开数量的限制是1024</span></span><br><span class=\"line\"><span class=\"built_in\">ulimit</span> -HSn 65535 <span class=\"comment\"># 这只是在当前终端有效退出之后 open files又变为默认值, 当然也可以写到/etc/profile中，因为每次登录终端时都会自动执行/etc/profile</span></span><br><span class=\"line\"><span class=\"comment\"># vim /etc/security/limits.conf #加入以下配置，重启即可生效</span></span><br><span class=\"line\"><span class=\"comment\"># * 代表针对所有用户，noproc 是代表最大进程数，nofile 是代表最大文件打开数</span></span><br><span class=\"line\">* soft nofile 65535 </span><br><span class=\"line\">* hard nofile 65535</span><br></pre></td></tr></table></figure>\n<p>Tips: 显然对服务器来说file-max, ulimit都需要设置，否则就可能出现文件描述符用尽的问题；</p>\n<ul>\n<li>2.查看当前进程打开了多少句柄数，然后根据进程ID号来查看打开的文件信息,以及动态修改。<ul>\n<li>附录1.为了让一个程序的open files数目扩大，可以在启动脚本前面加上<code>ulimit -HSn 65535</code>命令。但当程序是一个daemon时可能这种方法无效因为没有终端。</li>\n<li>附录2.如果某项服务已经启动，再动态调整ulimit是无效的，特别是涉及到线上业务就更麻烦了，这时可以考虑通过修改/proc/程序pid/limits来实现动态修改。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看当前进程打开了多少句柄数 (其中第一列是打开的句柄数,第二列是进程ID)</span></span><br><span class=\"line\">apt -y install lsof &amp;&amp; lsof -n|awk <span class=\"string\">'&#123;print $2&#125;'</span>|sort|uniq -c|sort -nr|more</span><br><span class=\"line\">131 24204</span><br><span class=\"line\">57 24244</span><br><span class=\"line\">57 24231</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 根据进程ID号来查看打开的文件信息</span></span><br><span class=\"line\">~$ sudo lsof -p 24204</span><br><span class=\"line\">  <span class=\"comment\"># COMMAND   PID USER   FD   TYPE             DEVICE SIZE/OFF    NODE NAME</span></span><br><span class=\"line\">  <span class=\"comment\"># sshd    91980 weiyigeek  cwd    DIR              253,0     4096       2 /</span></span><br><span class=\"line\">  <span class=\"comment\"># sshd    91980 weiyigeek  rtd    DIR              253,0     4096       2 /</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190611170735.png\" alt=\"WeiyiGeek.ssh服务limit设置\" title=\"\" class=\"\">\n                <p>WeiyiGeek.ssh服务limit设置</p>\n            </figure>\n<ul>\n<li>3./etc/security/limits.conf 文件中每一行都以以下形式描述了用户的限制：<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#&lt;domain&gt;        &lt;type&gt;  &lt;item&gt;  &lt;value&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#Where:</span></span><br><span class=\"line\"><span class=\"comment\">#&lt;domain&gt; can be:</span></span><br><span class=\"line\"><span class=\"comment\">#        - a user name</span></span><br><span class=\"line\"><span class=\"comment\">#        - a group name, with @group syntax</span></span><br><span class=\"line\"><span class=\"comment\">#        - the wildcard *, for default entry</span></span><br><span class=\"line\"><span class=\"comment\">#        - the wildcard %, can be also used with %group syntax,</span></span><br><span class=\"line\"><span class=\"comment\">#                 for maxlogin limit</span></span><br><span class=\"line\"><span class=\"comment\">#        - <span class=\"doctag\">NOTE:</span> group and wildcard limits are not applied to root.</span></span><br><span class=\"line\"><span class=\"comment\">#          To apply a limit to the root user, &lt;domain&gt; must be</span></span><br><span class=\"line\"><span class=\"comment\">#          the literal username root.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#&lt;type&gt; can have the two values:</span></span><br><span class=\"line\"><span class=\"comment\">#        - \"soft\" for enforcing the soft limits</span></span><br><span class=\"line\"><span class=\"comment\">#        - \"hard\" for enforcing hard limits</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#&lt;item&gt; can be one of the following:</span></span><br><span class=\"line\"><span class=\"comment\">#        - core - limits the core file size (KB)</span></span><br><span class=\"line\"><span class=\"comment\">#        - data - max data size (KB)</span></span><br><span class=\"line\"><span class=\"comment\">#        - fsize - maximum filesize (KB)</span></span><br><span class=\"line\"><span class=\"comment\">#        - memlock - max locked-in-memory address space (KB)</span></span><br><span class=\"line\"><span class=\"comment\">#        - nofile - max number of open file descriptors</span></span><br><span class=\"line\"><span class=\"comment\">#        - rss - max resident set size (KB)</span></span><br><span class=\"line\"><span class=\"comment\">#        - stack - max stack size (KB)</span></span><br><span class=\"line\"><span class=\"comment\">#        - cpu - max CPU time (MIN)</span></span><br><span class=\"line\"><span class=\"comment\">#        - nproc - max number of processes</span></span><br><span class=\"line\"><span class=\"comment\">#        - as - address space limit (KB)</span></span><br><span class=\"line\"><span class=\"comment\">#        - maxlogins - max number of logins for this user</span></span><br><span class=\"line\"><span class=\"comment\">#        - maxsyslogins - max number of logins on the system</span></span><br><span class=\"line\"><span class=\"comment\">#        - priority - the priority to run user process with</span></span><br><span class=\"line\"><span class=\"comment\">#        - locks - max number of file locks the user can hold</span></span><br><span class=\"line\"><span class=\"comment\">#        - sigpending - max number of pending signals</span></span><br><span class=\"line\"><span class=\"comment\">#        - msgqueue - max memory used by POSIX message queues (bytes)</span></span><br><span class=\"line\"><span class=\"comment\">#        - nice - max nice priority allowed to raise to values: [-20, 19]</span></span><br><span class=\"line\"><span class=\"comment\">#        - rtprio - max realtime priority</span></span><br><span class=\"line\"><span class=\"comment\">#        - chroot - change root to directory (Debian-specific)</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<h4 id=\"udevadm-命令\"><a href=\"#udevadm-命令\" class=\"headerlink\" title=\"udevadm 命令\"></a>udevadm 命令</h4><p>描述：它控制 systemd-udevd 的运行时行为，请求内核事件、管理事件队列并且提供简单的调试机制,udevadm 需要命令和命令特定的操作。</p>\n<p>语法基础：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">udevadm info [OPTIONS] [DEVPATH|FILE] <span class=\"comment\">#查询sysfs或udev数据库</span></span><br><span class=\"line\">-q --query=TYPE             Query device information:</span><br><span class=\"line\">       name                     Name of device node</span><br><span class=\"line\">       symlink                  Pointing to node</span><br><span class=\"line\">       path                     sysfs device path</span><br><span class=\"line\">       property                 The device properties</span><br><span class=\"line\">       all                      All values</span><br></pre></td></tr></table></figure></p>\n<p>基础示例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例：查询sysfs或udev数据库中的硬件信息</span></span><br><span class=\"line\"><span class=\"variable\">$udevadm</span> info -q all -n /dev/sda2</span><br><span class=\"line\">P: /devices/pci0000:00/0000:00:15.0/0000:03:00.0/host2/target2:0:0/2:0:0:0/block/sda/sda2</span><br><span class=\"line\">N: sda2</span><br><span class=\"line\">S: disk/by-id/lvm-pv-uuid-WYci3Y-yQO9-eU0R-Dzmu-ccUH-Lhns-rLhVnJ</span><br><span class=\"line\">S: disk/by-path/pci-0000:03:00.0-scsi-0:0:0:0-part2</span><br><span class=\"line\">E: DEVLINKS=/dev/disk/by-id/lvm-pv-uuid-WYci3Y-yQO9-eU0R-Dzmu-ccUH-Lhns-rLhVnJ /dev/disk/by-path/pci-0000:03:00.0-scsi-0:0:0:0-part2</span><br></pre></td></tr></table></figure></p>\n<hr>\n<h2 id=\"0x03-系统调优\"><a href=\"#0x03-系统调优\" class=\"headerlink\" title=\"0x03 系统调优\"></a>0x03 系统调优</h2><h3 id=\"1-内核调优\"><a href=\"#1-内核调优\" class=\"headerlink\" title=\"1.内核调优\"></a>1.内核调优</h3><p>永久生效设置:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep -q <span class=\"string\">\"vm.swappiness=0\"</span> /etc/sysctl.conf || sudo tee -a /etc/sysctl.conf &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\"><span class=\"comment\"># - 优先使用物理内存(如果是Redis类的内存数据库建议设置1)</span></span><br><span class=\"line\">vm.swappiness=0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 进程可以拥有的VMA (虚拟内存区域) 的数量</span></span><br><span class=\"line\">vm.max_map_count=262144</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 开启重用允许将TIME-WAITsockets重新用于新的TCP连接</span></span><br><span class=\"line\">net.ipv4.tcp_tw_reuse = 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 开启TCP连接中TIME-WAITsockets的快速回收</span></span><br><span class=\"line\">net.ipv4.tcp_tw_recycle = 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 开启SYNCookies 当出现SYN等待队列溢出时，启用cookies来处理可防范少量SYN攻击（解决攻击）</span></span><br><span class=\"line\">net.ipv4.tcp_syncookies = 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 决定了内核放弃连接之前发送SYN+ACK包的数量</span></span><br><span class=\"line\">net.ipv4.tcp_synack_retries = 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 在内核放弃建立连接之前发送SYN包的数量。</span></span><br><span class=\"line\">net.ipv4.tcp_syn_retries = 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 用来加速连续TCP连接的数据交互的TCP协议扩展.(内核&gt;=3.6)</span></span><br><span class=\"line\">net.ipv4.tcp_fastopen = 3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 表示修改系統TCP默认的 TIMEOUT 时间</span></span><br><span class=\"line\">net.ipv4.tcp_fin_timeout = 30</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 表示当keepalive启用的时候TCP发送keepalive消息的频度。</span></span><br><span class=\"line\">net.ipv4.tcp_keepalive_time = 1200</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 表示SYN队列的长度设置此参数可以容纳更多等待连接的网络连接数</span></span><br><span class=\"line\">net.ipv4.tcp_max_syn_backlog = 8192</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 表示系统同时保持TIME_WAIT的最大数量，如果超过这个数字，TIME_WAIT将立刻被清除并打印警告信息。</span></span><br><span class=\"line\">net.ipv4.tcp_max_tw_buckets = 5000</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 用于向外连接的端口范围(此处因为k8s集群的原因设置32001-65535)</span></span><br><span class=\"line\">net.ipv4.ip_local_port_range = 32001 65535</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - TCP接收(Recive)发送(Send) buffer 总和 </span></span><br><span class=\"line\">net.ipv4.tcp_mem = 189924  253234  379848</span><br><span class=\"line\"><span class=\"comment\"># - TCP接收buffer - 用于TCP接受滑动窗口的最小值、默认值、最大值;</span></span><br><span class=\"line\">net.ipv4.tcp_wmem = 8192  16384  4194304</span><br><span class=\"line\"><span class=\"comment\"># - TCP发送buffer</span></span><br><span class=\"line\">net.ipv4.tcp_rmem = 8192  131072  6291456</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 尚未收到客户端确认信息的连接请求的最大值(高带宽下提高这个值可提高性能-需实际情况配置;</span></span><br><span class=\"line\">net.core.netdev_max_backlog = 262114</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 允许送到队列的数据包的最大数目(结合高并发请求数来调节此值-需实际情况配置)</span></span><br><span class=\"line\">net.core.somaxconn = 32768</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 表示内核套接字发送send缓存区的最大大小以及发送send缓存区默认的大小</span></span><br><span class=\"line\">net.core.rmem_max = 12582912</span><br><span class=\"line\">net.core.rmem_default = 6291456</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 表示内核套接字接收receive缓存区的最大大小以及接收receive缓存区默认的大小</span></span><br><span class=\"line\">net.core.wmem_max = 12582912</span><br><span class=\"line\">net.core.wmem_default = 6291456</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 进程比如一个worker进程可以同时打开的最大句柄数(该参数现在参数限制最大并发连接数-需实际情况配置)</span></span><br><span class=\"line\">fs.file-max = 1646839</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 同时可以拥有的的异步IO请求数目。</span></span><br><span class=\"line\">fs.aio-max-nr = 1048576</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 用来设置内存分配策略(针对于作为Redis内存数据库服务的机器推荐配置为1-可选配置)</span></span><br><span class=\"line\"><span class=\"comment\"># vm.overcommit_memory = 1</span></span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">sysctl -p</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-参数调优\"><a href=\"#2-参数调优\" class=\"headerlink\" title=\"2.参数调优\"></a>2.参数调优</h3><p><strong>临时生效设置:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 最大文件句柄数设置</span></span><br><span class=\"line\"><span class=\"built_in\">ulimit</span> -HSn 65535</span><br><span class=\"line\"><span class=\"built_in\">ulimit</span> -HSu 65535</span><br></pre></td></tr></table></figure></p>\n<p><strong>永久生效设置:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo tee -a /etc/security/limits.conf &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\"><span class=\"comment\"># 说明：* 代表针对所有用户，noproc 是代表最大进程数，nofile 是代表最大文件打开数</span></span><br><span class=\"line\">*  soft    nofile          65535</span><br><span class=\"line\">*  hard    nofile          65535</span><br><span class=\"line\">*  soft    nproc           65535</span><br><span class=\"line\">*  hard    nproc           65535</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Linux命令","path":"api/categories/Linux命令.json"}],"tags":[{"name":"系统优化","path":"api/tags/系统优化.json"}]}