<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 7-Kuberneteså…¥é—¨åŸºç¡€ä¹‹å­˜å‚¨Volumeä»‹ç»|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="k8s">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>7-Kuberneteså…¥é—¨åŸºç¡€ä¹‹å­˜å‚¨Volumeä»‹ç»</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">7-Kuberneteså…¥é—¨åŸºç¡€ä¹‹å­˜å‚¨Volumeä»‹ç»</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-09-27T10:37:47.000Z" itemprop="datePublished" class="page-time">
  2020-09-27
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/7-Kuberneteså…¥é—¨åŸºç¡€ä¹‹å­˜å‚¨Volumeä»‹ç»"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">7-Kuberneteså…¥é—¨åŸºç¡€ä¹‹å­˜å‚¨Volumeä»‹ç»</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-09-27 18:37:47" datetime="2020-09-27T10:37:47.000Z"  itemprop="datePublished">2020-09-27</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<h2 id="0x00-å‰è¨€ç®€è¿°"><a href="#0x00-å‰è¨€ç®€è¿°" class="headerlink" title="0x00 å‰è¨€ç®€è¿°"></a>0x00 å‰è¨€ç®€è¿°</h2><p>æè¿°: æˆ‘ä»¬çŸ¥é“åœ¨Dockerä¸­å¯ä»¥é€šè¿‡Volumeå°†å®¿ä¸»æœºæ–‡ä»¶(<code>é…ç½®æ–‡ä»¶ã€æ•°æ®åº“ç­‰</code>ç­‰)æ˜ å°„åˆ°Containerå†…éƒ¨ä¾›å…¶å®¹å™¨å†…çš„åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚åœ¨Kubernrtesä¸­æˆ‘ä»¬å¯ä»¥é‡‡ç”¨<code>ConfigMapæ§åˆ¶å™¨</code>åˆ›å»ºå…±äº«åº”ç”¨é…ç½®ï¼Œäº¦å¯é‡‡ç”¨Kubernetesä¸­çš„<code>volume</code>ï¼ˆå·ï¼‰åœ¨ä¸€ä¸ªPodå†…å¤šä¸ªContainerä¹‹é—´è¿›è¡Œæ–‡ä»¶å…±äº«;</p>
<p><br/></p>
<p><strong>Q: K8s ä¸ Docker ä¸¤è€…ä¹‹é—´å·çš„åŒºåˆ«?</strong></p>
<ul>
<li>1) K8S çš„ Volume (å·) å®šä¹‰åœ¨Podä¹‹ä¸Šè¢«åŒä¸€ä¸ªPodå†…çš„å¤šä¸ªå®¹å™¨æŒ‚è½½åˆ°å…·ä½“æ–‡ä»¶ä¹‹ä¸‹ä¾¿äºæ–‡ä»¶çš„å…±äº«;</li>
<li>2) K8S çš„ Volume (å·) ä¸ Pod çš„ç”Ÿå‘½å‘¨æœŸç›¸åŒï¼ˆæŒä¹…å·é™¤å¤–ï¼‰ï¼Œå³Podé”€æ¯åVolumeä¹Ÿä¼šè¢«é”€æ¯ï¼Œä½†Podä¸­å®¹å™¨é‡å¯æˆ–è€…ç»ˆæ­¢å¹¶ä¸ä¼šå¯¼è‡´Volumesä¸­æ•°æ®çš„ä¸¢å¤±ï¼›</li>
<li>3) K8S çš„ VOlume (å·) æ”¯æŒå¤šç§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œä¾‹å¦‚GlusterFSã€NFSã€Cephã€</li>
</ul>
<p><br/></p>
<p><strong>Volume ä½¿ç”¨æµç¨‹</strong></p>
<ul>
<li>1) å£°æ˜ä¸€ä¸ªVolume(å¯ä»¥æ˜¯å¤šç§ç±»å‹)</li>
<li>2) åœ¨å®¹å™¨å†…å¼•ç”¨è¯¥Volumeå¹¶Mountåˆ°Podå®¹å™¨é‡Œçš„æŸä¸ªæŒ‡å®šæ–‡ä»¶ç›®å½•ä¹‹ä¸­;</li>
</ul>
<p><br/></p>
<p><strong>k8sæŒä¹…åŒ–å­˜å‚¨æ–¹æ¡ˆ</strong><br>æè¿°: å…±äº«å­˜å‚¨ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿéå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œå­˜å‚¨ä¸€èˆ¬è¦æ±‚ç¨³å®šã€å¯ç”¨ã€æ€§èƒ½ã€å¯é ã€‚</p>
<ul>
<li><p>1.ä»ç”¨æˆ·è§’åº¦çœ‹<br>å­˜å‚¨å°±æ˜¯ä¸€å—ç›˜æˆ–è€…ä¸€ä¸ªç›®å½•ï¼Œç”¨æˆ·ä¸å…³å¿ƒç›˜æˆ–è€…ç›®å½•å¦‚ä½•å®ç°ï¼Œç”¨æˆ·è¦æ±‚éå¸¸â€œç®€å•â€ï¼Œå°±æ˜¯ç¨³å®šï¼Œæ€§èƒ½å¥½ã€‚ä¸ºäº†èƒ½å¤Ÿæä¾›ç¨³å®šå¯é çš„å­˜å‚¨äº§å“ï¼Œå„ä¸ªå‚å®¶æ¨å‡ºäº†å„ç§å„æ ·çš„å­˜å‚¨æŠ€æœ¯å’Œæ¦‚å¿µã€‚ä¸ºäº†èƒ½å¤Ÿè®©å¤§å®¶æœ‰ä¸€ä¸ªæ•´ä½“è®¤è¯†ï¼Œæœ¬æ–‡å…ˆä»‹ç»å­˜å‚¨ä¸­çš„è¿™äº›æ¦‚å¿µã€‚</p>
</li>
<li><p>2.ä»å­˜å‚¨ä»‹è´¨è§’åº¦<br>å­˜å‚¨ä»‹è´¨åˆ†ä¸ºæœºæ¢°ç¡¬ç›˜å’Œå›ºæ€ç¡¬ç›˜ï¼ˆSSDï¼‰ã€‚æœºæ¢°ç¡¬ç›˜æ³›æŒ‡é‡‡ç”¨ç£å¤´å¯»å€çš„ç£ç›˜è®¾å¤‡ï¼ŒåŒ…æ‹¬SATAç¡¬ç›˜å’ŒSASç¡¬ç›˜ã€‚ç”±äºé‡‡ç”¨ç£å¤´å¯»å€ï¼Œæœºæ¢°ç¡¬ç›˜æ€§èƒ½ä¸€èˆ¬ï¼ŒéšæœºIOPSä¸€èˆ¬åœ¨200å·¦å³ï¼Œé¡ºåºå¸¦å®½åœ¨150MB/så·¦å³ã€‚å›ºæ€ç¡¬ç›˜æ˜¯æŒ‡é‡‡ç”¨Flash/DRAMèŠ¯ç‰‡+æ§åˆ¶å™¨ç»„æˆçš„è®¾å¤‡ï¼Œæ ¹æ®åè®®çš„ä¸åŒï¼Œåˆåˆ†ä¸ºSATA SSDï¼ŒSAS SSDï¼ŒPCIe SSDå’ŒNVMe SSDã€‚</p>
</li>
<li><p>3.ä»äº§å“å®šä¹‰è§’åº¦<br>å­˜å‚¨åˆ†ä¸ºæœ¬åœ°å­˜å‚¨ï¼ˆDASï¼‰ï¼Œç½‘ç»œå­˜å‚¨ï¼ˆNASï¼‰ï¼Œå­˜å‚¨å±€åŸŸç½‘ï¼ˆSANï¼‰å’Œè½¯ä»¶å®šä¹‰å­˜å‚¨ï¼ˆSDSï¼‰å››å¤§ç±»</p>
<ul>
<li>DASå°±æ˜¯æœ¬åœ°ç›˜ï¼Œç›´æ¥æ’åˆ°æœåŠ¡å™¨ä¸Š</li>
<li>NASæ˜¯æŒ‡æä¾›NFSåè®®çš„NASè®¾å¤‡ï¼Œé€šå¸¸é‡‡ç”¨ç£ç›˜é˜µåˆ—+åè®®ç½‘å…³çš„æ–¹å¼</li>
<li>SANè·ŸNASç±»ä¼¼ï¼Œæä¾›SCSI/iSCSIåè®®ï¼Œåç«¯æ˜¯ç£ç›˜é˜µåˆ—</li>
<li>SDSæ˜¯ä¸€ç§æ³›æŒ‡ï¼ŒåŒ…æ‹¬åˆ†å¸ƒå¼NASï¼ˆå¹¶è¡Œæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼ŒServerSANç­‰</li>
</ul>
<ul>
<li>4.ä»åº”ç”¨åœºæ™¯è§’åº¦<br>å­˜å‚¨åˆ†ä¸ºæ–‡ä»¶å­˜å‚¨ï¼ˆPosix/MPIï¼‰ï¼Œå—å­˜å‚¨ï¼ˆiSCSI/Qemuï¼‰å’Œå¯¹è±¡å­˜å‚¨ï¼ˆS3/Swiftï¼‰ä¸‰å¤§ç±»ã€‚</li>
</ul>
</li>
</ul>
<p><br/></p>
<p><strong>Kubernetesæ˜¯å¦‚ä½•ç»™å­˜å‚¨å®šä¹‰å’Œåˆ†ç±»å‘¢ï¼Ÿ</strong></p>
<ul>
<li>1.Kubernetesä¸­è·Ÿå­˜å‚¨ç›¸å…³çš„æ¦‚å¿µæœ‰PersistentVolume ï¼ˆPVï¼‰å’ŒPersistentVolumeClaimï¼ˆPVCï¼‰ï¼ŒPVåˆåˆ†ä¸ºé™æ€PVå’ŒåŠ¨æ€PVã€‚é™æ€PVæ–¹å¼å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="image-box">
                <a rel=7-Kuberneteså…¥é—¨åŸºç¡€ä¹‹å­˜å‚¨Volumeä»‹ç» href="https://upload-images.jianshu.io/upload_images/2032456-c85dde456ae345c1.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/664/format/webp" target="_blank" title="PV-PVC" data-fancybox="images"><img src="https://upload-images.jianshu.io/upload_images/2032456-c85dde456ae345c1.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/664/format/webp" alt="PV-PVC" title="" class=""></a>
                <p>PV-PVC</p>
            </figure>
<ul>
<li>2.åŠ¨æ€PVéœ€è¦å¼•å…¥StorageClassçš„æ¦‚å¿µï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="image-box">
                <a rel=7-Kuberneteså…¥é—¨åŸºç¡€ä¹‹å­˜å‚¨Volumeä»‹ç» href="https://upload-images.jianshu.io/upload_images/2032456-3fe73ae1f3fb4d1b.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/623/format/webp" target="_blank" title="StorageClass" data-fancybox="images"><img src="https://upload-images.jianshu.io/upload_images/2032456-3fe73ae1f3fb4d1b.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/623/format/webp" alt="StorageClass" title="" class=""></a>
                <p>StorageClass</p>
            </figure>
<p><br/></p>
<p><strong>Kubernetes å¸¸è§ç±»å‹ä»¥åŠæ”¯æŒçš„å·</strong></p>
<ul>
<li><code>configMap (å¸¸ç”¨)</code> <code>secret (å¸¸ç”¨)</code> <code>emptyDir (å¸¸ç”¨)</code> <code>hostPath (å¸¸ç”¨)</code> <code>nfs (å¸¸ç”¨)</code> <code>persistentVolumeClaim (å¸¸ç”¨)</code> <code>cephfs (å¸¸ç”¨)</code></li>
<li>awsElasticBlockStore  azureDisk  azureFile csi downwardAPI </li>
<li>fc flocker gcePersistentDisk gitRepo glusterfs iscsi local</li>
<li>projected portworxVolume quobyte  rbd scaleI0 </li>
<li>storageos  vsphereVolume   </li>
</ul>
<hr>
<h2 id="0x01-Storage-å­˜å‚¨"><a href="#0x01-Storage-å­˜å‚¨" class="headerlink" title="0x01 Storage - å­˜å‚¨"></a>0x01 Storage - å­˜å‚¨</h2><p>æè¿°: ä»¥ä¸‹éƒ½æ˜¯ <code>statefulSet æ§åˆ¶å™¨</code>æ¶‰åŠæœ‰çŠ¶æ€æœåŠ¡å¿…é¡»æ‹¥æœ‰çš„ä¸€äº›èµ„æºå¯¹è±¡</p>
<ul>
<li>1) configMap : åœ¨k8sä¸­ä¸“é—¨ç”¨æ¥å­˜å‚¨é…ç½®æ–‡ä»¶ã€‚</li>
<li>2) Secret : æœ‰ä¸€äº›éœ€è¦åŠ å¯†çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å¯†é’¥ã€ç”¨æˆ·åå¯†ç ä¿¡æ¯åœ¨Secretä¸­å¯ä»¥è¢«åŠ å¯†ï¼Œæ˜¯k8sä¸­åŠ å¯†çš„<code>è§£å†³æ–¹æ¡ˆã€base64ã€‘</code>ã€‚</li>
<li>3) Volume  : ç”¨äºèµ‹äºˆk8sä¸­podå…±äº«å­˜å‚¨å·çš„èƒ½åŠ›ï¼Œä¾‹å¦‚å¯ä»¥é€šè¿‡nfså…±äº«ï¼Œæœ¬åœ°ç£ç›˜ç›®å½•å…±äº«ç­‰ç­‰ã€‚</li>
<li>4) Persistent Volume : ç®€ç§°PVã€æŒä¹…å·ã€‘ï¼Œè¿˜åŒ…å«ä¸€ä¸ªPVCï¼Œé€šè¿‡æœåŠ¡è¿›è¡ŒæŒä¹…å·çš„æ„å»ºã€‚</li>
<li>5) StorageClass : å­˜å‚¨ç±»å¯ä»¥åŠ¨æ€çš„ç»‘å®šPV(æŒä¹…å·)å’Œåˆ›å»ºPVC(æŒä¹…å·è¦æ±‚)ã€‚</li>
<li>6) Nfs / Cephfs : å¸¸ç”¨çš„åˆ†å¸ƒå¼å…±äº«å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚</li>
</ul>
<p><br></p>
<h3 id="1-ConfigMap"><a href="#1-ConfigMap" class="headerlink" title="1.ConfigMap"></a>1.ConfigMap</h3><p>æè¿°: åœ¨éƒ¨ç½²åº”ç”¨æ—¶å¸¸å¸¸éœ€è¦ç»™åº”ç”¨ç¨‹åºæä¾›ä¸€äº›é…ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚Databaseçš„IPåœ°å€å’Œå¼€æ”¾ç«¯å£ä»¥åŠç”¨æˆ·å¯†ç ç­‰ï¼›</p>
<p>å¸¸ç”¨çš„ç®€å•æ–¹æ³•æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>1) é€šè¿‡æ„å»ºé•œåƒæ—¶(Build)å°†åº”ç”¨é…ç½®æ–‡ä»¶æ‰“å…¥Docker Images : ä¸çµæ´»ä¸”ä»¥æ˜æ–‡ä¸å®‰å…¨ï¼Œå¹¶ä¸”ä¿®æ”¹é…ç½®è¿˜éœ€é‡æ–°æ„å»ºæ‰“åŒ…Image;</li>
<li>2) é€šè¿‡environment(ç¯å¢ƒç¯å¢ƒ)ä¼ å‚ : ä¸çµæ´»ä¸”æ˜æ–‡ä¼ å…¥ï¼Œè€Œä¸”æ›´æ–°ç¯å¢ƒå˜é‡æ—¶èµ„æºå¯¹è±¡å°†éœ€è¦é‡æ–°éƒ¨ç½²;</li>
<li>3) é…ç½®ç®¡ç†ä¸­å¿ƒ : ä¾‹å¦‚ ç™¾åº¦ Disconf ã€360 çš„qconfé…ç½®ç®¡ç†ï¼Œåœ¨å¤§è§„æ¨¡çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¹‹ä¸­å°†åˆ†å¸ƒå¼åº”ç”¨æ‰€éœ€çš„é…ç½®ä¿¡æ¯ä¸åº”ç”¨ç¨‹åºè¿›è¡Œåˆ†ç¦»åŠå…¶é‡è¦ï¼Œå®ƒå¯ä»¥æå¤§çš„ç®€åŒ–åº”ç”¨é…ç½®ç®¡ç†å·¥ä½œ;</li>
<li>4) é€šè¿‡K8sæä¾›çš„ ConfigMap èµ„æºå¯¹è±¡è¿›è¡Œå®ç°;</li>
</ul>
<p>Tips : DisConf å°† X/Y/Z å¤šä¸ªä¸šåŠ¡å¹³å°è¿›è¡Œé…ç½®ç»Ÿä¸€ç®¡ç†, å…¶ä¸»è¦å®ç°ç›®æ ‡æ˜¯å¯¹äºåŒä¸€ä¸ªä¸Šçº¿åŒ…ï¼Œæ— éœ€æ”¹åŠ¨é…ç½®ï¼Œå³å¯åœ¨å¤šä¸ªç¯å¢ƒï¼ˆ<code>DEV/TEST/STAGE/PRODUCTION</code>ï¼‰ä¸Šçº¿ï¼Œç®€å•çš„è¯´å…¶å®ç°äº†<code>é…ç½®ä¿¡æ¯ä¸åº”ç”¨ç¨‹åºè¿›è¡Œè§£è€¦æ“ä½œ</code>;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- 1) åŠ¨æ€åŒ–æ›´æ”¹é…ç½®éƒ¨ç½² : å½“æ›´æ”¹é…ç½®åæ— éœ€é‡æ–°æ‰“åŒ…æˆ–é‡å¯ï¼Œå³å¯å®æ—¶ç”Ÿæ•ˆ;</span><br><span class="line">- 2) é…ç½®ç»Ÿä¸€ç®¡ç† : æä¾›Webå¹³å°ç»Ÿä¸€ç®¡ç†å¤šä¸ªé…ç½®çš„åº”ç”¨ç¯å¢ƒï¼ˆ`DEV/TEST/STAGE/PRODUCTION`ï¼‰ï¼Œä»¥åŠå¤šä¸ªäº§å“çš„æ‰€æœ‰é…ç½®;</span><br><span class="line">- 3) æ ¸å¿ƒç›®æ ‡ : ä¸€ä¸ª Jar åŒ…åˆ°å¤„è¿è¡Œ;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="configMap-ä»‹ç»"><a href="#configMap-ä»‹ç»" class="headerlink" title="configMap - ä»‹ç»"></a>configMap - ä»‹ç»</h4><p>æè¿°: ConfigMap åŠŸèƒ½åœ¨ Kubernetes 1.2 ç‰ˆæœ¬ä¸­å¼•å…¥ï¼Œè®¸å¤šåº”ç”¨ç¨‹åºä¼š<code>ä»é…ç½®æ–‡ä»¶ã€å‘½ä»¤è¡Œå‚æ•°æˆ–ç¯å¢ƒå˜é‡</code>ä¸­è¯»å–é…ç½®ä¿¡æ¯ã€‚ConfigMap API ç»™æˆ‘ä»¬æä¾›äº†å‘å®¹å™¨ä¸­æ³¨å…¥é…ç½®ä¿¡æ¯çš„æœºåˆ¶(<code>å³é…ç½®çš„ä¸€ç§ç»Ÿä¸€ç®¡ç†æ–¹æ³•</code>,ä½¿å¾—åº”ç”¨ç¨‹åºä¸é…ç½®ä¿¡æ¯è¿›è¡Œè§£è€¦)ï¼ŒConfigMapå¯ä»¥è¢«ç”¨æ¥ä¿å­˜å•ä¸ªå±æ€§ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥ä¿å­˜æ•´ä¸ªé…ç½®æ–‡ä»¶æˆ–è€…JSON äºŒè¿›åˆ¶å¤§å¯¹è±¡ã€‚</p>
<p>ç®€å•çš„è¯´: é€šè¿‡ConfigMapèƒ½å¤ŸæŠŠé…ç½®ä»¥<code>Key-Value</code>å¯¹çš„å½¢å¼ä¾›å…¶å®ƒèµ„æºå¯¹è±¡æ¶ˆè´¹;</p>
<p><strong>Q: configMap é…ç½®æ–‡ä»¶æ³¨å†Œä¸­å¿ƒ</strong></p>
<blockquote>
<p>A: åœ¨é›†ç¾¤ä¸­æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶æ³¨å†Œä¸­å¿ƒï¼Œé›†ç¾¤ä¸­çš„èŠ‚ç‚¹å‘é…ç½®ä¸­å¿ƒç´¢è¦å±äºè‡ªèº«çš„é…ç½®ï¼Œé…ç½®ä¸­å¿ƒæ ¹æ®å„èŠ‚ç‚¹çš„ä¸»æœºåæˆ–ipåœ°å€è¿›è¡Œåˆ†å‘é…ç½®ã€‚<br>ä½œç”¨: k8såˆ›å»ºconfigMapï¼Œpodå»å¼•ç”¨ï¼Œæ¥è¾¾åˆ°ç±»ä¼¼äºé…ç½®æ–‡ä»¶æ³¨å†Œä¸­å¿ƒçš„æ•ˆæœã€‚</p>
</blockquote>
<p>Tips : ä¸åŒé›†ç¾¤è·å–åˆ°çš„ä¿¡æ¯æ˜¯ä¸ä¸€æ ·çš„éœ€è¦ä½¿ç”¨è€…è‡ªå·±é…ç½®;</p>
<p><br/></p>
<h4 id="configMap-åˆ›å»º"><a href="#configMap-åˆ›å»º" class="headerlink" title="configMap - åˆ›å»º"></a>configMap - åˆ›å»º</h4><p>æè¿°: configMapçš„å‡ ç§åˆ›å»ºæ–¹å¼è¿›è¡Œå®è·µæ¼”ç¤ºåŸºæœ¬åˆ›å»ºæ ¼å¼:<code>kubectl create configmap [map-name] [data-source]</code></p>
<ul>
<li>0) é€šè¿‡<code>--from-file</code>å‚æ•°è¿›è¡Œç›®å½•æ‰¹é‡&amp;å•ä¸€æ–‡ä»¶configMapåˆ›å»ºå®è·µæµç¨‹:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) æŸ¥çœ‹ç›®å½•æ–‡ä»¶æ¸…å• &amp; å†…å®¹</span></span><br><span class="line">cat &gt; ~/K8s/Day8/demo1/dir1.properties &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">dir.number=1</span><br><span class="line">dir.name=demo1</span><br><span class="line">dir.path=~/K8s/Day8/demo1</span><br><span class="line">EOF</span><br><span class="line">cat &gt; ~/K8s/Day8/demo1/dir2.properties &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">dir.number=2</span><br><span class="line">dir.name=demo2</span><br><span class="line">dir.path=~/K8s/Day8/demo2</span><br><span class="line">EOF</span><br><span class="line">cat &gt; ~/K8s/Day8/demo2/file.properties &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">file.number=2</span><br><span class="line">file.name=file.properties</span><br><span class="line">file.path=~/K8s/Day8/demo2/file.properties</span><br><span class="line">file.html=configMap Test - WeiyiGeek</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) ç›®å½•æ‰¹é‡åˆ›å»º configMap ï¼ˆæ³¨æ„è·¯å¾„ä¸ºå…¨è·¯å¾„ï¼‰</span></span><br><span class="line">~/K8s/Day8/demo1$ ls</span><br><span class="line">  <span class="comment"># dir1.properties  dir2.properties</span></span><br><span class="line">~/K8s/Day8/demo1$ kubectl create configmap dir-config --from-file=/home/weiyigeek/K8s/Day8/demo1/</span><br><span class="line">  <span class="comment"># configmap/dir-config created</span></span><br><span class="line"><span class="comment"># - dir-config : æŒ‡åˆ›å»ºçš„configMapçš„åç§°</span></span><br><span class="line"><span class="comment"># - --from-file : æŒ‡å®šè¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¢«ç”¨åœ¨ConfigMapé‡Œé¢åˆ›å»ºä¸€ä¸ªé”®å€¼å¯¹, æ³¨æ„ç›®å½•å¯ä»¥æ˜¯åœ¨æœ¬åœ°æˆ–è€…è¿œç¨‹åœ°å€ä¸­;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) æ–‡ä»¶åˆ›å»º configMap</span></span><br><span class="line">~/K8s/Day8/demo1$ kubectl create configmap file-config --from-file=/home/weiyigeek/K8s/Day8/demo2/file.properties</span><br><span class="line">  <span class="comment"># configmap/file-config created</span></span><br><span class="line"><span class="comment"># - --from-file : åœ¨Volumeä¸­ä½¿ç”¨æ—¶é”®çš„åå­—å°±æ˜¯æ–‡ä»¶åï¼Œå€¼å°±æ˜¯å¯¹åº”æ–‡ä»¶çš„å†…å®¹ã€K/Vç»“æ„ã€‘</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡Keyåˆ¶å®šæ–‡ä»¶åˆ›å»ºï¼Œé€šè¿‡ä½¿ç”¨Keyåˆ¶å®šæ–‡ä»¶åˆ›å»ºçš„å¥½å¤„æ˜¯å¯ä»¥ä½¿ç”¨Keyæ›¿ä»£æ–‡ä»¶åç§°(ç±»ä¼¼ Alias )å¯ä»¥æ›´æ”¹å¢å¼ºæ–‡ä»¶çš„å¯è¯»æ€§;</span></span><br><span class="line">~/K8s/Day8/demo1$ kubectl create configmap file-config-aliase --from-file file-key=~/K8s/Day8/demo2/file.properties</span><br><span class="line">  <span class="comment"># configmap/file-config-aliase created  </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) ä¿¡æ¯æŸ¥çœ‹ç¤ºä¾‹å…³é”®ç‚¹</span></span><br><span class="line">~/K8s/Day8/demo2$ kubectl get cm file-config-aliase</span><br><span class="line">  <span class="comment"># NAME                 DATA   AGE</span></span><br><span class="line">  <span class="comment"># file-config-aliase   1      109s</span></span><br><span class="line"></span><br><span class="line">~/K8s/Day8/demo2$ kubectl get cm file-config-aliase -o yaml   </span><br><span class="line">  <span class="comment"># apiVersion: v1</span></span><br><span class="line">  <span class="comment"># data:</span></span><br><span class="line">  <span class="comment">#   file-key: |   # åˆ«å</span></span><br><span class="line">  <span class="comment">#     file.number=2</span></span><br><span class="line">  <span class="comment">#     file.name=file.properties</span></span><br><span class="line">  <span class="comment">#     file.path=~/K8s/Day8/demo2/file.properties</span></span><br><span class="line">  <span class="comment">#     file.html=configMap Test - WeiyiGeek</span></span><br><span class="line">  <span class="comment"># kind: ConfigMap</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Tips ï¼š å¦‚éœ€è¦é€šè¿‡å¤šä¸ªæ–‡ä»¶åˆ›å»ºconfigMapå¯ä»¥åˆ†åˆ«é€šè¿‡å¤šä¸ª â€“from-file å‚æ•°è¿›è¡Œåˆ¶å®šå¯¹åº”çš„é…ç½®æ–‡ä»¶;</p>
<p><br></p>
<ul>
<li>1) é€šè¿‡ <code>--from-env-file</code> å‚æ•°è¿›è¡Œåˆ›å»ºconfigMapä¸ä¸Šé¢çš„æ–¹å¼ä¸åŒï¼Œæ­¤ç§å½¢å¼å¯¹env-fileçš„å†…å®¹æ ¼å¼æœ‰åˆ™ä¸¥æ ¼çš„è¦æ±‚ï¼Œå¹¶ä¸”å¦‚æœæ‚¨æä¾›äº†å¤šä¸ª<code>env-fileæ–‡ä»¶</code>ä»…æœ€åä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ç”Ÿæ•ˆ;</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) env-file.properties</span></span><br><span class="line">cat &gt; ~/K8s/Day8/demo2/env-file.properties &lt;&lt;<span class="string">'END'</span></span><br><span class="line">name=weiyigeek</span><br><span class="line">age=88</span><br><span class="line">allowed=<span class="string">"True"</span></span><br><span class="line">END</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) è¿›è¡Œåˆ›å»ºconfigMap</span></span><br><span class="line">kubectl create configmap env-file --from-env-file env-file.properties</span><br><span class="line"><span class="comment"># configmap/env-file created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) æŸ¥çœ‹ env-file çš„configMap</span></span><br><span class="line">~/K8s/Day8/demo2$ kubectl get cm env-file -o yaml</span><br><span class="line">  <span class="comment"># apiVersion: v1</span></span><br><span class="line">  <span class="comment"># data:</span></span><br><span class="line">  <span class="comment">#   age: "88"</span></span><br><span class="line">  <span class="comment">#   allowed: '"True"'</span></span><br><span class="line">  <span class="comment">#   name: weiyigeek</span></span><br><span class="line">  <span class="comment"># kind: ConfigMap</span></span><br><span class="line">  <span class="comment"># metadata:</span></span><br><span class="line">  <span class="comment">#   creationTimestamp: "2021-02-07T01:11:48Z"</span></span><br><span class="line">  <span class="comment">#   managedFields:</span></span><br><span class="line">  <span class="comment">#   - apiVersion: v1</span></span><br><span class="line">  <span class="comment">#     fieldsType: FieldsV1</span></span><br><span class="line">  <span class="comment">#     fieldsV1:</span></span><br><span class="line">  <span class="comment">#       f:data:</span></span><br><span class="line">  <span class="comment">#         .: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#         f:age: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#         f:allowed: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#         f:name: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#     manager: kubectl-create</span></span><br><span class="line">  <span class="comment">#     operation: Update</span></span><br><span class="line">  <span class="comment">#     time: "2021-02-07T01:11:48Z"</span></span><br><span class="line">  <span class="comment">#   name: env-file</span></span><br><span class="line">  <span class="comment">#   namespace: default</span></span><br><span class="line">  <span class="comment">#   resourceVersion: "19745894"</span></span><br><span class="line">  <span class="comment">#   selfLink: /api/v1/namespaces/default/configmaps/env-file</span></span><br><span class="line">  <span class="comment">#   uid: 9fb64e82-3ab1-4bcf-b528-c1f8b9aef026</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<ul>
<li>2) å­—é¢å€¼åˆ›å»ºç®€å•ç¤ºä¾‹:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) ä½¿ç”¨æ–‡å­—å€¼åˆ›å»ºåˆ©ç”¨--from-literal å‚æ•°ä¼ é€’é…ç½®ä¿¡æ¯ï¼Œè¯¥å‚æ•°å¯ä»¥ä½¿ç”¨å¤šæ¬¡;</span></span><br><span class="line">~/K8s/Day8/demo2 $ kubectl create configmap text-config --from-literal=my.name=weiyigeek --from-literal=my.age=18 --from-literal=my.site=http://www.weiyigeek.top</span><br><span class="line">  <span class="comment"># configmap/text-config created</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Tips ï¼šé€šè¿‡å­—é¢å€¼åˆ›å»ºçš„configMap<code>ä¸ä¾¿äºé…ç½®ç®¡ç†çš„è®°å½•</code>æ‰€ä»¥ä¸æ¨èä½¿ç”¨;</p>
<p><br/></p>
<ul>
<li>3) ä»¥èµ„æºæ¸…å•åˆ›å»º<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) èµ„æºæ¸…å•</span></span><br><span class="line">mkdir -pv ~/K8s/Day8/demo3/</span><br><span class="line">cat  &gt; ~/K8s/Day8/demo3/configmap.yaml &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">apiVersion: v1 </span><br><span class="line">kind: ConfigMap </span><br><span class="line">metadata:</span><br><span class="line">  name: configmap-demo</span><br><span class="line">  namespace: default </span><br><span class="line">data:</span><br><span class="line">  special.name: weiyigeek</span><br><span class="line">  special.site: www.weiyigeek.top</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) åˆ›å»º</span></span><br><span class="line">~/K8s/Day8/demo3$ kubectl create -f configmap.yaml</span><br><span class="line">  configmap/configmap-demo created</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<h4 id="configMap-æ“ä½œ"><a href="#configMap-æ“ä½œ" class="headerlink" title="configMap - æ“ä½œ"></a>configMap - æ“ä½œ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.æŸ¥çœ‹åˆ›å»ºconfigMapä¿¡æ¯</span></span><br><span class="line">~/K8s/Day8/demo3$ kubectl api-resources | grep <span class="string">"configmap"</span></span><br><span class="line">  <span class="comment"># configmaps    cm(ç¼©å†™)    true         ConfigMap  #  æ²¡æœ‰ APIGROUP å…¶èµ„æºç‰ˆæœ¬éƒ½æ˜¯ v1</span></span><br><span class="line"></span><br><span class="line">~/K8s/Day8/demo3$ kubectl get cm  <span class="comment"># åˆ›å»ºçš„configmap-demo</span></span><br><span class="line">  <span class="comment"># NAME             DATA   AGE</span></span><br><span class="line">  <span class="comment"># configmap-demo   2      3m3s</span></span><br><span class="line">  <span class="comment"># dir-config       2      23m</span></span><br><span class="line">  <span class="comment"># flie-config      1      16m</span></span><br><span class="line">  <span class="comment"># text-config      3      10m</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.è¯¦ç»†ä¿¡æ¯(é€šè¿‡ä¿¡æ¯å±•ç¤ºçš„å†…å®¹ä¸é€šè¿‡catå‘½ä»¤æŸ¥çœ‹ä¸€è‡´)</span></span><br><span class="line">~/K8s/Day8/demo3$ kubectl describe cm file-config</span><br><span class="line"><span class="comment"># kubectl get cm file-config -o yaml</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Name:         file-config</span></span><br><span class="line">  <span class="comment"># Namespace:    default</span></span><br><span class="line">  <span class="comment"># Labels:       &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># Annotations:  &lt;none&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data</span></span><br><span class="line">  <span class="comment"># ====</span></span><br><span class="line">  <span class="comment"># file.properties:  # Key</span></span><br><span class="line">  <span class="comment"># ----</span></span><br><span class="line">  <span class="comment"># file.number=2     # Value</span></span><br><span class="line">  <span class="comment"># file.name=file.properties</span></span><br><span class="line">  <span class="comment"># file.path=~/K8s/Day8/demo2/file.properties</span></span><br><span class="line">  <span class="comment"># file.html=configMap Test - WeiyiGeek</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Events:  &lt;none&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.åˆ é™¤æŒ‡å®šåç§°çš„configMapçš„é…ç½®</span></span><br><span class="line">~/K8s/Day8/demo3$ kubectl delete cm flie-config</span><br><span class="line">  <span class="comment"># configmap "flie-config" deleted</span></span><br></pre></td></tr></table></figure>
<p><br/></p>
<h4 id="configMap-ä½¿ç”¨"><a href="#configMap-ä½¿ç”¨" class="headerlink" title="configMap - ä½¿ç”¨"></a>configMap - ä½¿ç”¨</h4><ul>
<li>(1) åˆ›å»ºPodèµ„æºæ§åˆ¶å™¨å¹¶ä»¥ConfigMapä½œä¸ºç¯å¢ƒå˜é‡&amp;å‘½ä»¤è¡Œå‚æ•°ï¼ˆéå¸¸å€¼å¾—å­¦ä¹ ï¼‰<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; configmap-use-1.yaml&lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"># Pod Controller</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">configmap-env-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">configmap-env-demo</span></span><br><span class="line"><span class="attr">      image:</span> <span class="string">harbor.weiyigeek.top/test/busbox:latest</span></span><br><span class="line"><span class="attr">      imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">      command:</span> <span class="string">[</span> <span class="string">"/bin/sh"</span><span class="string">,</span> <span class="string">"-c"</span><span class="string">,</span> <span class="string">"env; echo Name: $&#123;USERNAME_KEY&#125;, Site: $&#123;SITE_KEY&#125;"</span> <span class="string">]</span></span><br><span class="line"><span class="attr">      env:</span>                         <span class="comment"># å…³é”®ç‚¹     </span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">USERNAME_KEY</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            configMapKeyRef:</span>       <span class="comment"># å…³é”®ç‚¹keyæ¥æºè®¾ç½®</span></span><br><span class="line"><span class="attr">              name:</span> <span class="string">configmap-demo</span></span><br><span class="line"><span class="attr">              key:</span> <span class="string">special.name</span>    <span class="comment"># Value</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">SITE_KEY</span> </span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            configMapKeyRef:</span></span><br><span class="line"><span class="attr">              name:</span> <span class="string">configmap-demo</span></span><br><span class="line"><span class="attr">              key:</span> <span class="string">special.site</span>    <span class="comment"># Value</span></span><br><span class="line"><span class="attr">      envFrom:</span></span><br><span class="line"><span class="attr">        - configMapRef:</span></span><br><span class="line"><span class="attr">            name:</span> <span class="string">configmap-demo</span>   <span class="comment"># Key</span></span><br><span class="line"><span class="attr">  restartPolicy:</span> <span class="string">Never</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>configMapä½¿ç”¨æ“ä½œæµç¨‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ä¸Šä¼ é•œåƒåˆ°ç§æœ‰ä»“åº“</span></span><br><span class="line">~/K8s/Day8/demo3$ docker tag busybox:latest harbor.weiyigeek.top/<span class="built_in">test</span>/busbox:latest</span><br><span class="line">~/K8s/Day8/demo3$ docker push harbor.weiyigeek.top/<span class="built_in">test</span>/busbox:latest</span><br><span class="line">  <span class="comment"># The push refers to repository [harbor.weiyigeek.top/test/busbox]</span></span><br><span class="line">  <span class="comment"># d2421964bad1: Pushed</span></span><br><span class="line">  <span class="comment"># latest: digest: sha256:c9249fdf56138f0d929e2080ae98ee9cb2946f71498fc1484288e6a935b5e5bc size: 527</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.éƒ¨ç½²Pod</span></span><br><span class="line">~$ kubectl create -f configmap-use-1.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æŸ¥çœ‹</span></span><br><span class="line">~$ kubectl get pod</span><br><span class="line">  <span class="comment"># NAME                 READY   STATUS      RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># configmap-env-demo   0/1     Completed   0          157m</span></span><br><span class="line">$ kubectl logs configmap-env-demo</span><br><span class="line">  <span class="comment"># KUBERNETES_PORT=tcp://10.96.0.1:443</span></span><br><span class="line">  <span class="comment"># KUBERNETES_SERVICE_PORT=443</span></span><br><span class="line">  <span class="comment"># HOSTNAME=configmap-env-demo</span></span><br><span class="line">  <span class="comment"># SHLVL=1</span></span><br><span class="line">  <span class="comment"># HOME=/root</span></span><br><span class="line">  <span class="comment"># SITE_KEY=www.weiyigeek.top      # å…³é”®ç‚¹</span></span><br><span class="line">  <span class="comment"># special.site=www.weiyigeek.top  # å…³é”®ç‚¹</span></span><br><span class="line">  <span class="comment"># KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1</span></span><br><span class="line">  <span class="comment"># PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span></span><br><span class="line">  <span class="comment"># KUBERNETES_PORT_443_TCP_PORT=443</span></span><br><span class="line">  <span class="comment"># KUBERNETES_PORT_443_TCP_PROTO=tcp</span></span><br><span class="line">  <span class="comment"># KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443</span></span><br><span class="line">  <span class="comment"># KUBERNETES_SERVICE_PORT_HTTPS=443</span></span><br><span class="line">  <span class="comment"># KUBERNETES_SERVICE_HOST=10.96.0.1</span></span><br><span class="line">  <span class="comment"># PWD=/</span></span><br><span class="line">  <span class="comment"># USERNAME_KEY=weiyigeek      # å…³é”®ç‚¹</span></span><br><span class="line">  <span class="comment"># special.name=weiyigeek      # å…³é”®ç‚¹</span></span><br><span class="line">  <span class="comment"># Name: weiyigeek, Site: www.weiyigeek.top   # è¾“å‡º</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>(2) åˆ›å»ºPodèµ„æºæ§åˆ¶å™¨å¹¶é€šè¿‡æ•°æ®å·(Volume)æ’ä»¶ä½¿ç”¨ConfigMapå¯¹è±¡&amp;çƒ­æ›´æ–°<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) åœ¨æ•°æ®å·é‡Œé¢ä½¿ç”¨è¿™ä¸ªConfigMapï¼Œæœ‰ä¸åŒçš„é€‰é¡¹ã€‚</span></span><br><span class="line"><span class="comment"># æœ€åŸºæœ¬çš„å°±æ˜¯å°†æ–‡ä»¶å¡«å…¥æ•°æ®å·ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­é”®å°±æ˜¯æ–‡ä»¶åé”®å€¼å°±æ˜¯æ–‡ä»¶å†…å®¹;</span></span><br><span class="line">cat &gt; configmap-use-3.yaml&lt;&lt;<span class="string">'EOF'</span></span><br><span class="line"><span class="comment"># Deployment Controller</span></span><br><span class="line">apiVersion: apps/v1 </span><br><span class="line">kind: Deployment </span><br><span class="line">metadata:</span><br><span class="line">  name: configmap-update-demo</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:                  <span class="comment"># æ³¨æ„å®ƒæ˜¯åœ¨Deploymentæ§åˆ¶å™¨ä¸­éœ€è¦ä¾èµ–çš„</span></span><br><span class="line">    matchLabels:  </span><br><span class="line">      app: configmap-update-demo  <span class="comment"># åŒ¹é…çš„Podæ ‡ç­¾éå¸¸é‡è¦</span></span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: configmap-update-demo</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">        - name: configmap-update-demo</span><br><span class="line">          image: harbor.weiyigeek.top/<span class="built_in">test</span>/nginx:v3.0</span><br><span class="line">          imagePullPolicy: IfNotPresent</span><br><span class="line">          volumeMounts:</span><br><span class="line">          - name: config-volume </span><br><span class="line">            mountPath: /usr/share/nginx/html/</span><br><span class="line">      volumes:</span><br><span class="line">        - name: config-volume </span><br><span class="line">          configMap:</span><br><span class="line">            name: file-config</span><br><span class="line">EOF</span><br><span class="line">$  kubectl create -f configmap-use-3.yaml</span><br><span class="line">  <span class="comment"># deployment.apps/configmap-update-demo created</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æŸ¥çœ‹</span></span><br><span class="line">~/K8s/Day8/demo4$ kubectl get pod -o wide --show-labels</span><br><span class="line">  <span class="comment"># NAME                                     READY   STATUS      RESTARTS   AGE   IP             NODE         LABELS</span></span><br><span class="line">  <span class="comment"># configmap-env-demo                       0/1     Completed   0          25h   10.244.1.129   k8s-node-4   &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># configmap-update-demo-597f67f4df-v82j6   1/1     Running     0          56s   10.244.1.131   k8s-node-4   app=configmap-update-demo,pod-template-hash=597f67f4df</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">~/K8s/Day8/demo4$ kubectl describe cm file-config  <span class="comment"># file-config çš„ConfifMapä¿¡æ¯</span></span><br><span class="line">  <span class="comment"># Name:         file-config</span></span><br><span class="line">  <span class="comment"># Namespace:    default</span></span><br><span class="line">  <span class="comment"># Labels:       &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># Annotations:  &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># Data</span></span><br><span class="line">  <span class="comment"># ====</span></span><br><span class="line">  <span class="comment"># file.properties:</span></span><br><span class="line">  <span class="comment"># ----</span></span><br><span class="line">  <span class="comment"># file.number=2</span></span><br><span class="line">  <span class="comment"># file.name=file.properties</span></span><br><span class="line">  <span class="comment"># file.path=~/K8s/Day8/demo2/file.properties</span></span><br><span class="line">  <span class="comment"># file.html=configMap Test - WeiyiGeek</span></span><br><span class="line">  <span class="comment"># Events:  &lt;none&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) éªŒè¯</span></span><br><span class="line">~/K8s/Day8/demo4$ kubectl <span class="built_in">exec</span> `kubectl get pods -l app=configmap-update-demo -o name` -it -- sh -c <span class="string">"ls /usr/share/nginx/html"</span></span><br><span class="line">file.properties</span><br><span class="line">~/K8s/Day8/demo4$ curl http://10.244.1.131/file.properties</span><br><span class="line">  <span class="comment"># file.number=2</span></span><br><span class="line">  <span class="comment"># file.name=file.properties</span></span><br><span class="line">  <span class="comment"># file.path=~/K8s/Day8/demo2/file.properties</span></span><br><span class="line">  <span class="comment"># file.html=configMap Test - WeiyiGeek</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) çƒ­æ›´æ–°ä¿®æ”¹ConfigMapçš„å€¼ã€ä½¿ç”¨è¯¥å‘½ä»¤æ‰“å¼€yamlæ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€‘</span></span><br><span class="line">~/K8s/Day8/demo4$ kubectl edit cm file-config    <span class="comment"># file.add=append Text with me, and hot update!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># configmap/file-config edited</span></span><br><span class="line">~/K8s/Day8/demo4$ curl http://10.244.1.131/file.properties</span><br><span class="line">~/K8s/Day8/demo4$ kubectl <span class="built_in">exec</span> `kubectl get pods -l app=configmap-update-demo -o name` -it -- sh -c <span class="string">"cat /usr/share/nginx/html/file.properties"</span></span><br><span class="line">  <span class="comment"># file.number=2</span></span><br><span class="line">  <span class="comment"># file.name=file.properties</span></span><br><span class="line">  <span class="comment"># file.path=/K8s/Day8/demo2/file.properties</span></span><br><span class="line">  <span class="comment"># file.html=configMap Test - WeiyiGeek</span></span><br><span class="line">  <span class="comment"># file.add=append Text with me, and hot update!</span></span><br><span class="line">~/K8s/Day8/demo4$ kubectl logs configmap-update-demo </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) æ‰‹åŠ¨æ›´æ–°</span></span><br><span class="line"><span class="comment"># PS: ConfigMapæ›´æ–°åPodå¹¶ä¸ä¼šé‡è½½è¿™ä¸ªæ–‡ä»¶ï¼Œæ›´æ–° ConfigMapç›®å‰å¹¶ä¸ä¼šè§¦å‘ç›¸å…³Pod çš„æ»šåŠ¨æ›´æ–°ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ pod annotations çš„æ–¹å¼å¼ºåˆ¶è§¦å‘æ»šåŠ¨æ›´æ–°</span></span><br><span class="line"><span class="comment"># ä¾‹å­ä¸­æˆ‘ä»¬åœ¨ .spec.template.metadata.annotations ä¸­æ·»åŠ  version/configï¼Œæ¯æ¬¡é€šè¿‡ä¿®æ”¹ version/config æ¥è§¦å‘æ»šåŠ¨æ›´æ–°</span></span><br><span class="line"><span class="comment"># æœªå¤ç°æˆåŠŸ: kubectl patch deployment my-nginx --patch '&#123;"spec": &#123;"template": &#123;"metadata": &#123;"annotations": &#123;"version/config": "20200430"&#125;&#125;&#125;&#125;&#125;' </span></span><br><span class="line"><span class="comment"># é”™è¯¯çš„ä¾‹å­: kubectl patch deployment configmap-update-demo--patch ' &#123;"metadata": &#123;"annotations": &#123;"deployment.kubernetes.io/revision": "2"&#125;&#125;&#125;'</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Tips : configMap èµ„æºå¯¹è±¡æ¶ˆè´¹å¸¸ç”¨äº<code>Podç¯å¢ƒå˜é‡æ¶ˆè´¹ã€Pod command ä¸­æ¶ˆè´¹ã€Volume ä¸­æ¶ˆè´¹</code>;</p>
<p>Tips : éå¸¸æ³¨æ„æ›´æ–° ConfigMap åæ•°æ®åŒæ­¥ä¼šæœ‰ä¸€å®šå»¶è¿Ÿ</p>
<ul>
<li>1.ä½¿ç”¨è¯¥ ConfigMap æŒ‚è½½çš„Envä¸ä¼šåŒæ­¥æ›´æ–°</li>
<li>2.ä½¿ç”¨è¯¥ ConfigMap æŒ‚è½½çš„Volumeä¸­çš„æ•°æ®éœ€è¦ä¸€æ®µæ—¶é—´(å®æµ‹å¤§æ¦‚10ç§’)æ‰èƒ½åŒæ­¥æ›´æ–°</li>
</ul>
<hr>
<h3 id="2-Secret"><a href="#2-Secret" class="headerlink" title="2.Secret"></a>2.Secret</h3><p>æè¿°: å‰é¢æˆ‘ä»¬è¯´è¿‡åœ¨k8sä¸­åˆ©ç”¨<code>ConfigMap</code>æ§åˆ¶å™¨å¯ä»¥å»ä¿å­˜é…ç½®æ–‡ä»¶ä»¥åŠä¸€äº›æ•°æ®, è¿™äº›æ•°æ®å¯ä»¥è¢«å¯¼å…¥åˆ°<code>Podå†…éƒ¨</code>æˆä¸ºç¯å¢ƒå˜é‡æˆ–è€…æ–‡ä»¶ï¼Œä»è€Œå¯ä»¥è¾¾åˆ°çƒ­æ›´æ–°çš„ç›®çš„, å¸¦æ¥ä¾¿åˆ©çš„åŒæ—¶å´æœ‰ä¸€å®šçš„å®‰å…¨é—®é¢˜ï¼ˆä¿å­˜çš„é…ç½®ä»¥æ˜æ–‡çš„å½¢å¼ä¿å­˜çš„ï¼‰ï¼Œæ‰€ä»¥å¯†ç æ–‡ä»¶ã€å¯†é’¥æ–‡ä»¶ç±»å‹çš„æ–‡ä»¶é€šè¿‡<code>ConfigMap</code>å»ä¿å­˜å°±ä¸æ˜¯å¾ˆåˆé€‚ï¼Œåœ¨k8sè¿˜æœ‰ä¸€ç§ä¿å­˜æœºåˆ¶å³<code>Secret</code>ã€‚</p>
<p>ç®€å•çš„è¯´: Secret ä¸»è¦ç”¨äºä¿å­˜éœ€è¦è¿›è¡ŒåŠ å¯†è®¿é—®çš„çš„é…ç½®,è§£å†³äº†å¯†ç ã€tokenã€å¯†é’¥ç­‰æ•æ„Ÿæ•°æ®çš„é…ç½®é—®é¢˜ï¼Œè€Œä¸éœ€è¦æŠŠè¿™äº›æ•æ„Ÿæ•°æ®æš´éœ²åˆ°é•œåƒæˆ–è€… <code>Pod Spec</code> ä¸­ã€‚</p>
<p>åœ¨k8sèµ„æºæ¸…å•ä¸­<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl api-resources | grep <span class="string">"secret"</span></span><br><span class="line">NAME     NAMESPACED   KIND</span><br><span class="line">secrets  <span class="literal">true</span>         Secret      <span class="comment"># kubectl api-versions ç”±äºæ²¡æœ‰APIGROUPåˆ™é»˜è®¤ä¸ºv1</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>Q: Secretçš„åº”ç”¨åœºæ™¯</strong></p>
<blockquote>
<p>ç­”: Secret å¯ä»¥<code>Volumeå·æˆ–è€…ç¯å¢ƒå˜é‡</code>çš„æ–¹å¼è¿›è¡Œæ¶ˆè´¹ä½¿ç”¨ã€‚</p>
</blockquote>
<p><strong>Secret çš„ä¸‰ç§ç±»å‹</strong></p>
<ul>
<li>(1) <code>Service Account</code> : ç”± Kubernetes è‡ªåŠ¨åˆ›å»ºç”¨æ¥è®¿é—®Kubernetes API (<code>æ‰€ä»¥å…¶è®¿é—®å®‰å…¨è‡³å…³é‡è¦å¸¸è§„çš„åº”ç”¨ä¸€èˆ¬ä¸æ¶‰åŠé…ç½®å®ƒ</code>),å¹¶ä¸”ä¼šè‡ªåŠ¨æŒ‚è½½åˆ°Podçš„ /run/secrets/kubernetes.io/serviceaccount ç›®å½•ä¸­</li>
<li>(2) <code>Opaque</code> : Base64ç¼–ç æ ¼å¼çš„Secret ç”¨æ¥å­˜å‚¨å¯†ç ã€å¯†é’¥ç­‰ï¼Œæ³¨æ„åŠ å¯†ç¨‹åº¦å¹¶ä¸é«˜ã€‚</li>
<li>(3) <code>Kubernetes.io/dockerconfigjson</code> : å°†ç§æœ‰ä»“åº“çš„ç™»é™†è®¤è¯ä¿¡æ¯è¿›è¡Œå­˜å‚¨;</li>
</ul>
<p><br/></p>
<h4 id="Service-Account"><a href="#Service-Account" class="headerlink" title="Service Account"></a>Service Account</h4><p>æè¿°: ç”±Kubernetes è‡ªåŠ¨åˆ›å»º, å®ƒç”¨äºè®¿é—®æˆ‘ä»¬çš„ <code>Kubernetes API</code> å¹¶ä¸”ä¼šè‡ªåŠ¨æŒ‚è½½åˆ°Podçš„ <code>/run/secrets/kubernetes.io/serviceaccount</code> ç›®å½•ä¸­<code>æ³¨æ„å…¶å¹¶ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»ç®¡ç†å’Œåˆ›å»º</code>ã€‚</p>
<p>å®è·µæ¼”ç¤º:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (0) æŸ¥çœ‹ service-account-token </span></span><br><span class="line">$ kubectl get secret</span><br><span class="line">  <span class="comment"># NAME                  TYPE                                  DATA   AGE</span></span><br><span class="line">  <span class="comment"># default-token-zglkd   kubernetes.io/service-account-token   3      11d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (1) æŸ¥çœ‹ç°æœ‰çš„ pod</span></span><br><span class="line">$ kubectl get pod configmap-update-demo-597f67f4df-v82j6</span><br><span class="line">  <span class="comment"># NAME                                     READY   STATUS    RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># configmap-update-demo-597f67f4df-v82j6   1/1     Running   0          18h</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) è¿›å…¥ Pod å®¹å™¨å†…éƒ¨</span></span><br><span class="line">$ kubectl <span class="built_in">exec</span> configmap-update-demo-597f67f4df-v82j6 -it -- bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) éªŒè¯ /run/secrets/kubernetes.io/serviceaccount ç›®å½•ä¸­å­˜åœ¨çš„æ–‡ä»¶</span></span><br><span class="line">root@configmap-update-demo-597f67f4df-v82j6:/$ ls /run/secrets/kubernetes.io/serviceaccount/ &amp; <span class="built_in">cd</span> <span class="variable">$_</span></span><br><span class="line">  <span class="comment"># ca.crt      # è®¿é—®APIæ‰€éœ€çš„è¯ä¹¦æ–‡ä»¶</span></span><br><span class="line">  <span class="comment"># namespace   # å½“å‰Podçš„åç§°ç©ºé—´</span></span><br><span class="line">  <span class="comment"># token       # è®¤è¯é‰´æƒç›¸å…³Token</span></span><br><span class="line">root@configmap-update-demo-597f67f4df-v82j6:$ /run/secrets/kubernetes.io/serviceaccount<span class="comment"># cat namespace</span></span><br><span class="line">  <span class="comment"># default</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="Opaque-Secret"><a href="#Opaque-Secret" class="headerlink" title="Opaque Secret"></a>Opaque Secret</h4><p>æè¿°: Opaque <code>è‹± /É™ÊŠËˆpeÉªk/</code> Secret ç±»å‹çš„æ•°æ®æ˜¯ä¸€ä¸ª map ç±»å‹ï¼Œå¹¶ä¸”è¦æ±‚ Value æ˜¯ Base64 ç¼–ç æ ¼å¼;</p>
<p>èµ„æºæ¸…å•ç¤ºä¾‹:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; Opaque-Secret.yaml&lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">secret-test</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span> </span><br><span class="line"><span class="attr">data:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">dXNlcm5hbWU=</span></span><br><span class="line"><span class="attr">  pass:</span> <span class="string">d2VpeWlnZWVr</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - æŒ‡å®šå­—ç¬¦çš„base64åŠ å¯†</span></span><br><span class="line"><span class="string">~$</span> <span class="string">echo</span> <span class="bullet">-n</span> <span class="string">"username"</span> <span class="string">| base64</span></span><br><span class="line"><span class="string">dXNlcm5hbWU=</span></span><br><span class="line"><span class="string">~$ echo -n "weiyigeek" | base64</span></span><br><span class="line"><span class="string">d2VpeWlnZWVr</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># - è¾“å‡ºæŒ‡å®šå­—ç¬¦çš„base64è§£å¯†å½¢å¼</span></span><br><span class="line"><span class="string">echo -n "d2VpeWlnZWVr" | base64 -d  # weiyigeek</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>Opaque Secret åˆ›å»ºä¸æŸ¥çœ‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.åˆ›å»º</span></span><br><span class="line">~/K8s/Day8/demo5$ kubectl create -f Opaque-Secret.yaml</span><br><span class="line">  <span class="comment"># secret/secret-test created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­å·²åˆ›å»ºçš„secret</span></span><br><span class="line">~/K8s/Day8/demo5$ kubectl get secret</span><br><span class="line">  <span class="comment"># NAME                  TYPE                                  DATA   AGE</span></span><br><span class="line">  <span class="comment"># basic-auth            Opaque                                1      2d1h</span></span><br><span class="line">  <span class="comment"># default-token-zglkd   kubernetes.io/service-account-token   3      11d</span></span><br><span class="line">  <span class="comment"># secret-test           Opaque                                2      63s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æŸ¥çœ‹</span></span><br><span class="line">~/K8s/Day8/demo5$ kubectl describe secret secret-test</span><br><span class="line">  <span class="comment"># Name:         secret-test</span></span><br><span class="line">  <span class="comment"># Namespace:    default</span></span><br><span class="line">  <span class="comment"># Labels:       &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># Annotations:  &lt;none&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Type:  Opaque</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data</span></span><br><span class="line">  <span class="comment"># ====</span></span><br><span class="line">  <span class="comment"># name:  8 bytes</span></span><br><span class="line">  <span class="comment"># pass:  9 bytes</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>ä¸‹é¢æ¼”ç¤º Opaque Secret åœ¨å®é™…ç¯å¢ƒä¸­çš„ä¸¤ç§ä½¿ç”¨æ–¹å¼;</strong></p>
<ul>
<li>1) å°†SecretæŒ‚è½½åˆ°<code>Volume</code>ä¸­å°†ä¼šç”Ÿæˆæ–‡ä»¶</li>
<li>2) å°†Secretå¯¼å‡ºåˆ°<code>ç¯å¢ƒå˜é‡(env)</code>ä¸­ä»¥ä¾›è„šæœ¬ä½¿ç”¨</li>
</ul>
<p>èµ„æºæ¸…å•ç¤ºä¾‹:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; opaque-Secret-1.yaml&lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"># 1) Volume æŒ‚è½½ä½¿ç”¨</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">v1</span>   <span class="comment"># æ³¨æ„ç‚¹: Pod æ˜¯ v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">seret-test-1</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">seret-test-1</span> </span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  volumes:</span>    </span><br><span class="line"><span class="attr">  - name:</span> <span class="string">secrets</span>    <span class="comment"># å…³é”®ç‚¹</span></span><br><span class="line"><span class="attr">    secret:</span></span><br><span class="line"><span class="attr">      secretName:</span> <span class="string">secret-test</span> </span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">seret-test-1</span>  </span><br><span class="line"><span class="attr">    image:</span> <span class="string">harbor.weiyigeek.top/test/busbox:latest</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">[</span> <span class="string">"/bin/sh"</span><span class="string">,</span> <span class="string">"-c"</span><span class="string">,</span> <span class="string">"ls /etc/secrets;  sleep 700"</span> <span class="string">]</span></span><br><span class="line"><span class="attr">    imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">    volumeMounts:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">secrets</span> </span><br><span class="line"><span class="attr">      mountPath:</span> <span class="string">"/etc/secrets"</span>  <span class="comment"># å…³é”®ç‚¹æŒ‚è½½åˆ°æ­¤ç›®å½•ä¹‹ä¸­</span></span><br><span class="line"><span class="attr">      readOnly:</span> <span class="literal">true</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># 2) enviroment ç¯å¢ƒå˜é‡ä½¿ç”¨</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">seret-test-2</span>      <span class="comment"># å…ƒæ•°æ®åç§°</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">2</span> </span><br><span class="line"><span class="attr">  selector:</span>                  <span class="comment"># æ³¨æ„å®ƒæ˜¯åœ¨Deploymentæ§åˆ¶å™¨ä¸­éœ€è¦ä¾èµ–çš„</span></span><br><span class="line"><span class="attr">    matchLabels:</span>  </span><br><span class="line"><span class="attr">      app:</span> <span class="string">seret-test-2</span>  <span class="comment"># åŒ¹é…çš„Podæ ‡ç­¾éå¸¸é‡è¦</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">seret-test-2</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">seret-test-2</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">harbor.weiyigeek.top/test/busbox:latest</span></span><br><span class="line"><span class="attr">        imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">        command:</span> <span class="string">[</span> <span class="string">"/bin/sh"</span><span class="string">,</span> <span class="string">"-c"</span><span class="string">,</span> <span class="string">"env; echo Name: $&#123;USERNAME&#125;, Pass: $&#123;PASSWORD&#125;; sleep 700"</span> <span class="string">]</span></span><br><span class="line"><span class="attr">        env:</span>              <span class="comment"># ç¯å¢ƒå˜é‡è®¾ç½®</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">USERNAME</span></span><br><span class="line"><span class="attr">          valueFrom:</span>      <span class="comment"># Value æ¥æº</span></span><br><span class="line"><span class="attr">            secretKeyRef:</span>   <span class="comment"># å…³é”®ç‚¹ï¼šä¸Šé¢æˆ‘ä»¬æ¥è§¦è¿‡ configMapKeyRef ï¼Œæ­¤å¤„æ˜¯ secretKeyRef</span></span><br><span class="line"><span class="attr">              name:</span> <span class="string">secret-test</span> </span><br><span class="line"><span class="attr">              key:</span> <span class="string">name</span> </span><br><span class="line"><span class="attr">        - name:</span> <span class="string">PASSWORD</span> </span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            secretKeyRef:</span></span><br><span class="line"><span class="attr">              name:</span> <span class="string">secret-test</span></span><br><span class="line"><span class="attr">              key:</span> <span class="string">pass</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></p>
<p>æ“ä½œæµç¨‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) åˆ›å»º</span></span><br><span class="line">~/K8s/Day8/demo5$ kubectl create -f opaque-Secret-1.yaml</span><br><span class="line">  <span class="comment"># pod/seret-test-1 created</span></span><br><span class="line">  <span class="comment"># deployment.apps/seret-test-2 created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æŸ¥çœ‹</span></span><br><span class="line">~/K8s/Day8/demo5$ kubectl get pod -o wide --show-labels</span><br><span class="line">  <span class="comment"># NAME                            READY   STATUS    RESTARTS   AGE   IP             NODE         LABELS</span></span><br><span class="line">  <span class="comment"># seret-test-1                    1/1     Running   0          24s   10.244.2.6     k8s-node-5   name=seret-test-1</span></span><br><span class="line">  <span class="comment"># seret-test-2-5bffbffc7d-444db   1/1     Running   0          24s   10.244.1.134   k8s-node-4   app=seret-test-2,pod-template-hash=5bffbffc7d</span></span><br><span class="line">  <span class="comment"># seret-test-2-5bffbffc7d-c5mqv   1/1     Running   0          24s   10.244.2.5     k8s-node-5   app=seret-test-2,pod-template-hash=5bffbffc7d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) éªŒè¯</span></span><br><span class="line"><span class="comment"># - Volument</span></span><br><span class="line">~/K8s/Day8/demo5$ kubectl logs seret-test-1</span><br><span class="line">  <span class="comment"># name</span></span><br><span class="line">  <span class="comment"># pass</span></span><br><span class="line">~/K8s/Day8/demo5$ kubectl <span class="built_in">exec</span> seret-test-1 -- sh -c <span class="string">"cat /etc/secrets/pass"</span></span><br><span class="line">  <span class="comment"># weiyigeek</span></span><br><span class="line">~/K8s/Day8/demo5$ kubectl <span class="built_in">exec</span> -it seret-test-1 -- sh</span><br><span class="line">  <span class="comment"># / # cd /etc/secrets/ &amp;  ls</span></span><br><span class="line">  <span class="comment"># name  pass                      # å…³é”®ç‚¹: Keyæˆä¸ºäº†æ–‡ä»¶åç§°ï¼Œè€ŒValueæˆä¸ºçš„æ–‡ä»¶å†…å®¹</span></span><br><span class="line">  <span class="comment"># /etc/secrets # cat name</span></span><br><span class="line">  <span class="comment"># /etc/secrets # cat pass</span></span><br><span class="line">  <span class="comment"># weiyigeek</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - environment</span></span><br><span class="line">~/K8s/Day8/demo5$ kubectl logs seret-test-2-5bffbffc7d-444db</span><br><span class="line">  <span class="comment"># KUBERNETES_SERVICE_PORT=443</span></span><br><span class="line">  <span class="comment"># KUBERNETES_PORT=tcp://10.96.0.1:443</span></span><br><span class="line">  <span class="comment"># HOSTNAME=seret-test-2-5bffbffc7d-444db</span></span><br><span class="line">  <span class="comment"># SHLVL=1</span></span><br><span class="line">  <span class="comment"># HOME=/root</span></span><br><span class="line">  <span class="comment"># USERNAME=username</span></span><br><span class="line">  <span class="comment"># KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1</span></span><br><span class="line">  <span class="comment"># PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span></span><br><span class="line">  <span class="comment"># KUBERNETES_PORT_443_TCP_PORT=443</span></span><br><span class="line">  <span class="comment"># KUBERNETES_PORT_443_TCP_PROTO=tcp</span></span><br><span class="line">  <span class="comment"># KUBERNETES_SERVICE_PORT_HTTPS=443</span></span><br><span class="line">  <span class="comment"># KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443</span></span><br><span class="line">  <span class="comment"># KUBERNETES_SERVICE_HOST=10.96.0.1</span></span><br><span class="line">  <span class="comment"># PWD=/</span></span><br><span class="line">  <span class="comment"># PASSWORD=weiyigeek</span></span><br><span class="line">  <span class="comment"># Name: username, Pass: weiyigeek</span></span><br><span class="line">~/K8s/Day8/demo5$ kubectl logs seret-test-2-5bffbffc7d-c5mqv | egrep <span class="string">"username|weiyigeek"</span></span><br><span class="line">  <span class="comment"># USERNAME=username</span></span><br><span class="line">  <span class="comment"># PASSWORD=weiyigeek</span></span><br><span class="line">  <span class="comment"># Name: username, Pass: weiyigeek</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="kubernetes-io-dockerconfigjson"><a href="#kubernetes-io-dockerconfigjson" class="headerlink" title="kubernetes.io/dockerconfigjson"></a>kubernetes.io/dockerconfigjson</h4><p>æè¿°: å®ƒå¯ä»¥è®¾ç½®æˆ‘ä»¬ç§æœ‰é•œåƒä»“åº“ä¿¡æ¯å¸®åŠ©æˆ‘ä»¬åœ¨æ²¡æœ‰è¿›è¡Œ<code>docker login</code>çš„NodeèŠ‚ç‚¹ä¸Šä¹Ÿå¯ä»¥æ‹‰å–ç§æœ‰é•œåƒ;</p>
<p>æ¼”ç¤ºç¤ºä¾‹:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) ä½¿ç”¨Kuberctl åˆ›å»ºdocker registry è®¤è¯çš„ secret</span></span><br><span class="line"><span class="string">kuberctl</span> <span class="string">create</span> <span class="string">secret</span> <span class="string">docker-registry</span> <span class="string">private-registry-key</span> <span class="string">\</span></span><br><span class="line"><span class="bullet">-</span><span class="bullet">-docker-server=harbor.weiyigeel.top</span> <span class="string">\</span></span><br><span class="line"><span class="bullet">-</span><span class="bullet">-docker-username=weiyigeek</span> <span class="string">\</span></span><br><span class="line"><span class="bullet">-</span><span class="bullet">-docker-password=Harbor12345</span> <span class="string">\</span></span><br><span class="line"><span class="bullet">-</span><span class="bullet">-docker-email=master@weiyigeek.top</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) èµ„æºæ¸…å•: kubernetes.io/dockerconfigjson ä¹‹ Secret çš„ å¼•ç”¨;</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">docker-config-json</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">busybox</span></span><br><span class="line"><span class="attr">      image:</span> <span class="string">harbor.weiyigeel.top/private/busybox:v1.0</span>  <span class="comment"># æ‹‰å–çš„ç§æœ‰é•œåƒ</span></span><br><span class="line"><span class="attr">  imagePullSecrets:</span>               <span class="comment"># å…³é”®ç‚¹: é€šè¿‡ imagePullSecrets æ¥å¼•ç”¨åˆšåˆ›å»ºçš„`private-registry-key `</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">private-registry-key</span>  <span class="comment"># åˆ›å»ºçš„ docker-registry ç±»å‹ secret çš„åç§°</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="3-Volume"><a href="#3-Volume" class="headerlink" title="3.Volume"></a>3.Volume</h3><p>æè¿°: ç”±äºå®¹å™¨ç£ç›˜ä¸Šæ–‡ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ˜¯çŸ­æš‚çš„ï¼Œè¿™å°±ä½¿å¾—åœ¨å®¹å™¨ä¸­è¿è¡Œé‡è¦åº”ç”¨æ—¶ä¼šå‡ºç°ä¸€äº›é—®é¢˜ã€‚</p>
<p>é¦–å…ˆå½“å®¹å™¨å´©æºƒæ—¶kubeletä¼šé‡å¯å®ƒï¼Œä½†æ˜¯å®¹å™¨ä¸­çš„æ–‡ä»¶å°†ä¸¢å¤±,å®¹å™¨ä»¥å¹²å‡€çš„çŠ¶æ€(é•œåƒæœ€åˆçš„çŠ¶æ€)é‡æ–°å¯åŠ¨ã€‚å…¶æ¬¡ï¼Œåœ¨Pod ä¸­åŒæ—¶è¿è¡Œå¤šä¸ªå®¹å™¨æ—¶ï¼Œè¿™äº›å®¹å™¨ä¹‹é—´é€šå¸¸éœ€è¦å…±äº«æ–‡ä»¶ã€‚</p>
<p>Kubernetes ä¸­çš„ Volume æŠ½è±¡å°±å¾ˆå¥½çš„è§£å†³äº†è¿™äº›é—®é¢˜ã€‚</p>
<ul>
<li>Volume ç”Ÿå‘½å‘¨æœŸ : Kubernetesä¸­çš„å·æœ‰æ˜ç¡®çš„å¯¿å‘½ä¸å°è£…å®ƒçš„Podç›¸åŒ, æ‰€ä»¥å·çš„ç”Ÿå‘½æ¯” Pod ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½é•¿</li>
<li>Volume ä½œç”¨ : å½“è¿™ä¸ªå®¹å™¨é‡å¯æ—¶æ•°æ®ä»ç„¶å¾—ä»¥ä¿å­˜, æ³¨æ„<code>å½“ Podä¸å†å­˜åœ¨æ—¶å·ä¹Ÿå°†ä¸å¤å­˜åœ¨</code>, ä¹Ÿè®¸æ›´é‡è¦çš„æ˜¯Kubernetesæ”¯æŒå¤šç§ç±»å‹çš„å·ï¼ŒPod å¯ä»¥åŒæ—¶ä½¿ç”¨ä»»æ„æ•°é‡çš„å·ã€‚</li>
</ul>
<p>PS : åœ¨ Docker ä¸­å¦‚æœ <code>restartPolicy</code> è®¾ç½®ä¸ºalwaysæ—¶å®¹å™¨å› dockerå´©æºƒé‡å¯æ—¶å°†ä¼šä¿ç•™æ•°æ®ï¼Œä½†æ˜¯<code>åœ¨K8sä¸­å¹¶ä¸ä¼šè¿™æ ·æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨åˆ°æŒä¹…å·ä¿è¯å®¹å™¨ä¸­æŒ‡å®šæ•°æ®çš„ç•™å­˜</code>;</p>
<p>ä¸‹é¢å®è·µä¸­è®²è§£ä¸€äº›ç»å¸¸ä½¿ç”¨ä»¥åŠåç»­é‡åˆ°çš„ä¸€äº›å·é…ç½®ä½¿ç”¨:</p>
<p><br/></p>
<h4 id="emptyDir-ç©ºå·"><a href="#emptyDir-ç©ºå·" class="headerlink" title="emptyDir - ç©ºå·"></a>emptyDir - ç©ºå·</h4><p>æè¿°: æ­£å¦‚å·çš„åå­—æ‰€è¿°å®ƒæœ€åˆæ˜¯ç©ºçš„ï¼Œå…¶ä½œç”¨æ˜¯å¯ä»¥åœ¨ä¸åŒçš„å®¹å™¨ä¸­ç›¸åŒæˆ–è€…ä¸åŒè·¯å¾„è¿›è¡Œæ–‡ä»¶å…±äº«ï¼Œå½“ Pod è¢«åˆ†é…ç»™èŠ‚ç‚¹æ—¶ï¼Œé¦–å…ˆåˆ›å»º emptyDir å·ï¼Œå¹¶ä¸”åªè¦è¯¥ Pod åœ¨è¯¥èŠ‚ç‚¹ä¸Šè¿è¡Œè¯¥å·å°±ä¼šå­˜åœ¨ï¼ŒPodä¸­çš„å®¹å™¨å¯ä»¥è¯»å–å’Œå†™å…¥ emptyDir å·ä¸­çš„ç›¸åŒæ–‡ä»¶ï¼Œä½†æ˜¯<code>å½“å‡ºäºä»»ä½•åŸå› ä»èŠ‚ç‚¹ä¸­åˆ é™¤Podæ—¶,emptyDir ä¸­çš„æ•°æ®ä¹Ÿå°†è¢«æ°¸ä¹…åˆ é™¤</code>;</p>
<p><strong>emptyDir ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>1.Pod å†…å¤šå®¹å™¨å…±äº«ç›®å½•ï¼Œä¾‹å¦‚ä¸€ä¸ªPodå†…çš„å¤šä¸ªContainerå…±äº«ä¸€ä¸ªç›®å½•(<code>ç”Ÿäº§è€… &lt;-&gt; æ¶ˆè´¹è€…</code>)</li>
<li>2.æš‚å­˜ç©ºé—´(ä¸´æ—¶ç›®å½•), ä¾‹å¦‚ç”¨äºåŸºäºç£ç›˜çš„åˆå¹¶æ’åºï¼Œç”¨ä½œé•¿æ—¶é—´è®¡ç®—å´©æºƒæ¢å¤æ—¶çš„æ£€æŸ¥ç‚¹(<code>å³è¯¥ç›®å½•æ— éœ€æŒä¹…åŒ–ä¿ç•™</code>)</li>
<li>3.WebæœåŠ¡å™¨å®¹å™¨æä¾›æ•°æ®æ—¶ï¼Œä¿å­˜å†…å®¹ç®¡ç†å™¨å®¹å™¨æå–çš„æ–‡ä»¶</li>
</ul>
<p>PS : å®¹å™¨å´©æºƒä¸ä¼šä»èŠ‚ç‚¹ä¸­ç§»é™¤ pod,å› æ­¤ <code>emptyDir</code>å·ä¸­çš„æ•°æ®åœ¨å®¹å™¨å´©æºƒæ—¶æ˜¯å®‰å…¨çš„;</p>
<p>èµ„æºæ¸…å•ç¤ºä¾‹:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; emptydir-demo-1.yaml&lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"># 1) Volume æŒ‚è½½ä½¿ç”¨</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">v1</span>   <span class="comment"># æ³¨æ„ç‚¹: Pod æ˜¯ v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">emptydir-test-1</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">emptydir-test-1</span> </span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  volumes:</span>    </span><br><span class="line"><span class="attr">  - name:</span> <span class="string">cachedir</span>          <span class="comment"># å…³é”®ç‚¹å·åç§°</span></span><br><span class="line"><span class="attr">    emptyDir:</span> <span class="string">&#123;&#125;</span>            <span class="comment"># ä½¿ç”¨ç©ºå·</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">emptydir-pod-1</span>  </span><br><span class="line"><span class="attr">    image:</span> <span class="string">harbor.weiyigeek.top/test/busbox:latest</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">[</span> <span class="string">"/bin/sh"</span><span class="string">,</span> <span class="string">"-c"</span><span class="string">,"sleep</span> <span class="number">700</span><span class="string">" ]</span></span><br><span class="line"><span class="string">    imagePullPolicy: IfNotPresent</span></span><br><span class="line"><span class="string">    volumeMounts:</span></span><br><span class="line"><span class="string">    - name: cachedir            # å¼•ç”¨å·é…ç½®åç§°</span></span><br><span class="line"><span class="string">      mountPath: "</span><span class="string">/cache/pod1"</span>  <span class="comment"># æŒ‚è½½ç©ºå·åˆ°æ­¤ç›®å½•ä¹‹ä¸­</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">emptydir-pod-2</span>  </span><br><span class="line"><span class="attr">    image:</span> <span class="string">harbor.weiyigeek.top/test/busbox:latest</span></span><br><span class="line"><span class="attr">    command:</span> <span class="string">[</span> <span class="string">"/bin/sh"</span><span class="string">,</span> <span class="string">"-c"</span><span class="string">,"sleep</span> <span class="number">700</span><span class="string">" ]</span></span><br><span class="line"><span class="string">    imagePullPolicy: IfNotPresent</span></span><br><span class="line"><span class="string">    volumeMounts:</span></span><br><span class="line"><span class="string">    - name: cachedir </span></span><br><span class="line"><span class="string">      mountPath: "</span><span class="string">/cache/pod2"</span>  <span class="comment"># æŒ‚è½½ç©ºå·åˆ°æ­¤ç›®å½•ä¹‹ä¸­</span></span><br><span class="line"><span class="attr">  restartPolicy:</span> <span class="string">Never</span>  </span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></p>
<p>æ“ä½œæµç¨‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) åˆ›å»º</span></span><br><span class="line">~/K8s/Day8/demo6$ kubectl create -f emptydir-demo-1.yaml</span><br><span class="line">  <span class="comment"># pod/emptydir-test-1 created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æŸ¥çœ‹</span></span><br><span class="line">~/K8s/Day8/demo6$ kubectl get pod -o wide --show-labels</span><br><span class="line">  <span class="comment"># NAME                            READY   STATUS    RESTARTS   AGE   IP             NODE         LABELS</span></span><br><span class="line">  <span class="comment"># emptydir-test-1                 2/2     Running   0          16s   10.244.2.9     k8s-node-5   name=emptydir-test-1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) éªŒè¯(åˆ†åˆ«åœ¨ä¸€ä¸ªPodçš„ä¸¤ä¸ªå®¹å™¨ä¸­æŸ¥çœ‹åˆ›å»ºè¿½åŠ çš„å†…å®¹)</span></span><br><span class="line">weiyigeek@ubuntu:~$ kubectl <span class="built_in">exec</span> emptydir-test-1 -c emptydir-pod-1 -it -- sh <span class="comment"># emptydir-pod-1</span></span><br><span class="line">/ <span class="comment"># echo $HOSTNAME</span></span><br><span class="line">  <span class="comment"># emptydir-test-1</span></span><br><span class="line">/ <span class="comment"># echo $HOSTNAME-$(date) &gt; /cache/pod1/time.log</span></span><br><span class="line">/ <span class="comment"># cat /cache/pod1/time.log</span></span><br><span class="line">emptydir-test-1-Wed Nov 18 03:43:48 UTC 2020</span><br><span class="line">/ <span class="comment"># exit</span></span><br><span class="line">weiyigeek@ubuntu:~$ kubectl <span class="built_in">exec</span> emptydir-test-1 -c emptydir-pod-2 -it -- sh -c <span class="string">"echo <span class="variable">$HOSTNAME</span>-<span class="variable">$(date)</span> &gt;&gt; /cache/pod2/time.log"</span> <span class="comment"># emptydir-pod-2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ä¸¤ä¸ªå®¹å™¨ä¸åŒçš„ç›®å½•å®é™…æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªæ–‡ä»¶(å†…éƒ¨é€šè¿‡ `/cache/pod1/` ä¸ `/cache/pod2/` è¿›è¡Œæ¶ˆè´¹)</span></span><br><span class="line">weiyigeek@ubuntu:~$ kubectl <span class="built_in">exec</span> emptydir-test-1 -c emptydir-pod-1 -it -- sh -c <span class="string">"cat /cache/pod1/time.log"</span></span><br><span class="line">weiyigeek@ubuntu:~$ kubectl <span class="built_in">exec</span> emptydir-test-1 -c emptydir-pod-2 -it -- sh -c <span class="string">"cat /cache/pod2/time.log"</span></span><br><span class="line">  <span class="comment"># emptydir-test-1-Wed Nov 18 03:43:48 UTC 2020</span></span><br><span class="line">  <span class="comment"># ubuntu-Wed 18 Nov 2020 11:44:41 AM CST</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) åˆ é™¤podåˆ™emptyDirå¤±æ•ˆ(æ­£å¯¹äºdeploymentåˆ›å»ºçš„Podæ˜¯åœ¨deploymentåˆ é™¤æ—¶å€™å¤±æ•ˆ)</span></span><br><span class="line">$ kubectl delete pod emptydir-test-1</span><br><span class="line">pod <span class="string">"emptydir-test-1"</span> deleted</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="hostPath-ä¸»æœºè·¯å¾„å·"><a href="#hostPath-ä¸»æœºè·¯å¾„å·" class="headerlink" title="hostPath - ä¸»æœºè·¯å¾„å·"></a>hostPath - ä¸»æœºè·¯å¾„å·</h4><p>æè¿°ï¼šä¸emptyDiræ–¹å¼ç›´æ¥å°†ç›®å½•æˆ–è€…æ–‡ä»¶å†™åœ¨Containerå†…éƒ¨ä¸åŒï¼ŒhostPath å·å°†ä¸»æœºèŠ‚ç‚¹(å®¿ä¸»æœº)çš„æ–‡ä»¶ç³»ç»Ÿ(<code>FileSystem</code>)ä¸­çš„æ–‡ä»¶æˆ–ç›®å½•<code>æŒ‚è½½åˆ°é›†ç¾¤(Cluster)ä¸­</code>ç±»ä¼¼äºdockerä¸­ä½¿ç”¨çš„ <code>-v å®¿ä¸»æœºç›®å½•:å®¹å™¨æŒ‚è½½ç›®å½•</code>, ä½¿ç”¨å…¶çš„å¥½å¤„æ˜¯å¯ä»¥ä¸ä»»ä½•å­˜å‚¨è¿›è¡Œå¯¹æ¥ä½¿ç”¨;</p>
<p><strong>hostPath ä¸ emptyDir æ¯”è¾ƒ</strong></p>
<ul>
<li>(1) emptyDir ç›´æ¥å°†ç›®å½•æˆ–è€…æ–‡ä»¶å†™åœ¨Containerå†…éƒ¨, è€Œ HostPath å¯ä»¥ä½¿ç”¨<code>å®¿ä¸»æœºçš„é«˜é€Ÿæ–‡ä»¶ç³»ç»Ÿ</code>ä»¥åŠæ›´å¥½çš„æŒä¹…åŒ–;</li>
<li>(2) emptyDir è¢«é™åˆ¶åœ¨ä¸€ä¸ªPodå…±äº«æ–‡ä»¶æˆ–ç›®å½•ä¸­, è€Œ HostPath å¯ä»¥å®ç°è·¨Podå…±äº«;</li>
</ul>
<p><strong>hostPath ä½¿ç”¨åœºæ™¯:</strong></p>
<ul>
<li>1.è¿è¡Œéœ€è¦è®¿é—® Docker å†…éƒ¨çš„å®¹å™¨(<code>å³å®¹å™¨å†…éƒ¨ä½¿ç”¨å®¹å™¨</code>), ä¾‹å¦‚ä½¿ç”¨ <code>/var/lib/docker ä»¥åŠ /var/run/docker.sock</code> çš„ hostPathä»¥åŠä¾èµ–æŒ‚è½½çš„æ–¹å¼;</li>
<li>2.åœ¨å®¹å™¨ä¸­è¿è¡Œ cAdvisor, ä½¿ç”¨ /dev/cgroups çš„ hostPath;</li>
<li>3.åŒä¸€ä¸ªå®¿ä¸»æœºè·¨Podå…±äº«æ–‡ä»¶æˆ–è€…;</li>
</ul>
<p><br/></p>
<p>Tips: å…è®¸ pod æŒ‡å®šç»™å®šçš„ hostPath æ˜¯å¦åº”è¯¥åœ¨ pod è¿è¡Œä¹‹å‰å­˜åœ¨ï¼Œæ˜¯å¦åº”è¯¥åˆ›å»ºä»¥åŠå®ƒåº”è¯¥ä»¥ä»€ä¹ˆå½¢å¼å­˜åœ¨(é™¤äº†æ‰€éœ€çš„ path å±æ€§ä¹‹å¤–ï¼Œç”¨æˆ·è¿˜å¯ä»¥ä¸º hostPath å·æŒ‡å®š type);</p>
<p><strong>hostPath å·æŒ‡å®š type ç±»å‹è¯´æ˜:</strong></p>
<ul>
<li>ç©ºå­—ç¬¦ä¸²  :  (é»˜è®¤)ç”¨äºå‘åå…¼å®¹ï¼Œè¿™æ„å‘³ç€åœ¨æŒ‚è½½ hostPath å·ä¹‹å‰ä¸ä¼šæ‰§è¡Œä»»ä½•æ£€æŸ¥ã€‚</li>
<li>DirectoryOrCreate : å¦‚æœåœ¨ç»™å®šçš„è·¯å¾„ä¸Šæ²¡æœ‰ä»»ä½•ä¸œè¥¿å­˜åœ¨ï¼Œé‚£ä¹ˆå°†æ ¹æ®éœ€è¦åœ¨é‚£é‡Œåˆ›å»ºä¸€ä¸ªç©ºç›®å½•ï¼Œæƒé™è®¾ç½®ä¸º0755,ä¸Kubelet å…·æœ‰ç›¸åŒçš„ç»„å’Œæ‰€æœ‰æƒã€‚</li>
<li>Directory : ç»™å®šçš„è·¯å¾„ä¸‹å¿…é¡»å­˜åœ¨ç›®å½•</li>
<li>FileOrCreate : å¦‚æœåœ¨ç»™å®šçš„è·¯å¾„ä¸Šæ²¡æœ‰ä»»ä½•ä¸œè¥¿å­˜åœ¨ï¼Œé‚£ä¹ˆä¼šæ ¹æ®éœ€è¦åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œæƒé™è®¾ç½®ä¸º0644ï¼Œä¸Kubeletå…·æœ‰ç›¸åŒçš„ç»„å’Œæ‰€æœ‰æƒã€‚</li>
<li>File : ç»™å®šçš„è·¯å¾„ä¸‹å¿…é¡»å­˜åœ¨æ–‡ä»¶</li>
<li>Socket : ç»™å®šçš„è·¯å¾„ä¸‹å¿…é¡»å­˜åœ¨UNIXå¥—æ¥å­—</li>
<li>CharDevic : ç»™å®šçš„è·¯å¾„ä¸‹å¿…é¡»å­˜åœ¨å­—ç¬¦è®¾å¤‡</li>
<li>BlockDevice :  ç»™å®šçš„è·¯å¾„ä¸‹å¿…é¡»å­˜åœ¨å—è®¾å¤‡</li>
</ul>
<p><br/></p>
<p><strong>æ³¨æ„äº‹é¡¹:</strong></p>
<ul>
<li>1.ç”±äºæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„æ–‡ä»¶éƒ½ä¸åŒï¼Œå…·æœ‰ç›¸åŒé…ç½®(<code>ä¾‹å¦‚ä» podTemplate åˆ›å»ºçš„</code>)çš„podåœ¨ä¸åŒèŠ‚ç‚¹ä¸Šçš„è¡Œä¸º<code>å¯èƒ½ä¼šå¯¼è‡´è®¿é—®çš„ç»“æœä¸ä¸€è‡´</code>ï¼›</li>
<li>2.å½“Kubernetes æŒ‰ç…§è®¡åˆ’æ·»åŠ èµ„æºæ„ŸçŸ¥è°ƒåº¦æ—¶ï¼Œå°†æ— æ³•è€ƒè™‘ hostPath ä½¿ç”¨çš„èµ„æºï¼›</li>
<li>3.åœ¨åº•å±‚ä¸»æœºä¸Šåˆ›å»ºçš„æ–‡ä»¶æˆ–ç›®å½•åªèƒ½ç”± root å†™å…¥æˆ–è€…å…¶ä»–å¯è¯»å¯å†™ç”¨æˆ·ã€‚æ‚¨éœ€è¦åœ¨ç‰¹æƒå®¹å™¨ä¸­ä»¥ root èº«ä»½è¿è¡Œè¿›ç¨‹æˆ–ä¿®æ”¹ä¸»æœºä¸Šçš„æ–‡ä»¶æƒé™ä»¥ä¾¿å†™å…¥ hostPath å·ï¼›</li>
<li>4.hostPathä½¿ç”¨å®¿ä¸»æœºQutoaä¸ä¼šçº³å…¥æˆ–è®°å½•åˆ°k8sçš„èµ„æºç®¡ç†é…é¢ç®¡ç†ä¸­;</li>
</ul>
<p><br/></p>
<p><strong>èµ„æºæ¸…å•ç¤ºä¾‹:</strong><br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; hostPath-demo.yaml&lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">hostpath-test-1</span>      <span class="comment"># å…ƒæ•°æ®åç§°</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">2</span> </span><br><span class="line"><span class="attr">  selector:</span>                  <span class="comment"># æ³¨æ„å®ƒæ˜¯åœ¨Deploymentæ§åˆ¶å™¨ä¸­éœ€è¦ä¾èµ–çš„</span></span><br><span class="line"><span class="attr">    matchLabels:</span>  </span><br><span class="line"><span class="attr">      app:</span> <span class="string">hostpath-test-1</span>   <span class="comment"># åŒ¹é…çš„Podæ ‡ç­¾éå¸¸é‡è¦</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">hostpath-test-1</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      volumes:</span>                <span class="comment"># volumes å…³é”®ç‚¹</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">test-volume</span> </span><br><span class="line"><span class="attr">        hostPath:</span>             <span class="comment"># é‡‡ç”¨ hostPath ç±»å‹çš„å·</span></span><br><span class="line"><span class="attr">          type:</span> <span class="string">DirectoryOrCreate</span>    <span class="comment"># å·ç±»å‹æ­¤å¤„é€‰æ‹©å¦‚æœDirectoryOrCreateå¦‚ä½•å­èŠ‚ç‚¹ä¸Šæ²¡æœ‰è¯¥ç›®å½•ä¾¿ä¼šè¿›è¡Œåˆ›å»º</span></span><br><span class="line"><span class="attr">          path:</span> <span class="string">/data</span>                <span class="comment"># å„ä¸»æœºèŠ‚ç‚¹ä¸Šå·²å­˜åœ¨çš„ç›®å½•</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">hostpath-test</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">harbor.weiyigeek.top/test/busbox:latest</span></span><br><span class="line"><span class="attr">        imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">        command:</span> <span class="string">[</span> <span class="string">"/bin/sh"</span><span class="string">,</span> <span class="string">"-c"</span><span class="string">,</span> <span class="string">"sleep 700"</span> <span class="string">]</span></span><br><span class="line"><span class="attr">        volumeMounts:</span>     </span><br><span class="line"><span class="attr">        - name:</span> <span class="string">test-volume</span>  <span class="comment"># æŒ‚è½½æŒ‡å®šå·ç›®å½•</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/disk/hostpath/</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></p>
<p>Tips : Deployment ä¸æ”¯æŒ restartPolicy: Never å…¶å‚æ•°é€‰é¡¹å¿…é¡»æ˜¯ Always</p>
<p><strong>æ“ä½œæµç¨‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) åˆ›å»ºPodèµ„æº</span></span><br><span class="line">$ kubectl create -f hostPath-demo.yaml</span><br><span class="line">  <span class="comment"># deployment.apps/hostpath-test-1 created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æŸ¥çœ‹åˆ›å»ºçš„Pod</span></span><br><span class="line">~/K8s/Day8/demo6$ kubectl get pod -o wide --show-labels</span><br><span class="line">  <span class="comment"># NAME                               READY   STATUS    RESTARTS   AGE   IP             NODE        LABELS</span></span><br><span class="line">  <span class="comment"># hostpath-test-1-785b9544b9-n5vcz   1/1     Running   0          43s   10.244.1.137   k8s-node-4  app=hostpath-test-1,pod-template-hash=785b9544b9</span></span><br><span class="line">  <span class="comment"># hostpath-test-1-785b9544b9-sv2wh   1/1     Running   0          44s   10.244.2.11    k8s-node-5  app=hostpath-test-1,pod-template-hash=785b9544b9</span></span><br><span class="line">~/K8s/Day8/demo6$ kubectl describe pod hostpath-test-1-785b9544b9-sv2wh</span><br><span class="line">  <span class="comment"># Events:</span></span><br><span class="line">  <span class="comment">#   Type    Reason     Age   From               Message</span></span><br><span class="line">  <span class="comment">#   ----    ------     ----  ----               -------</span></span><br><span class="line">  <span class="comment">#   Normal  Scheduled  102s  default-scheduler  Successfully assigned default/hostpath-test-1-785b9544b9-sv2wh to k8s-node-5</span></span><br><span class="line">  <span class="comment">#   Normal  Pulled     102s  kubelet            Container image "harbor.weiyigeek.top/test/busbox:latest" already present on machine</span></span><br><span class="line">  <span class="comment">#   Normal  Created    101s  kubelet            Created container hostpath-test</span></span><br><span class="line">  <span class="comment">#   Normal  Started    101s  kubelet            Started container hostpath-test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) æµ‹è¯•Podä¸å®¿ä¸»æœºé—´å…±äº«çš„ç›®å½•å’Œæ–‡ä»¶</span></span><br><span class="line">$ kubectl <span class="built_in">exec</span> -it hostpath-test-1-785b9544b9-n5vcz -- sh   <span class="comment"># Node-4</span></span><br><span class="line">/ $ <span class="built_in">echo</span> $(id)-$(date)-$(<span class="built_in">pwd</span>) &gt; /disk/hostpath/hostpath.log</span><br><span class="line">/ $ cat /disk/hostpath/hostpath.log</span><br><span class="line">  <span class="comment"># uid=0(root) gid=0(root) groups=0(root)-Wed 18 Nov 2020 01:34:51 PM CST-/root</span></span><br><span class="line"></span><br><span class="line">$ kubectl <span class="built_in">exec</span> -it hostpath-test-1-785b9544b9-sv2wh -- sh    <span class="comment"># Node-5</span></span><br><span class="line">/ $ <span class="built_in">echo</span> <span class="variable">$HOSTNAME</span>-$(date)-$(<span class="built_in">pwd</span>) &gt;&gt; /disk/hostpath/hostpath.log</span><br><span class="line">/ $ cat /disk/hostpath/hostpath.log</span><br><span class="line">  <span class="comment"># hostpath-test-1-785b9544b9-sv2wh-Wed Nov 18 08:20:42 UTC 2020-/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) éªŒè¯(ç”±äºhostPathæ˜¯å„ä¸ªèŠ‚ç‚¹çš„æŒ‡å®šç›®å½•ä»–ä»¬æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ï¼Œé™¤éæ‰€æœ‰çš„èŠ‚ç‚¹æŒ‚è½½çš„åŒä¸€å—NFSæŒ‡å‘åŒä¸€ä¸ªç›®å½•é™¤å¤–)</span></span><br><span class="line"><span class="comment"># Pod å®¹å™¨</span></span><br><span class="line">kubectl <span class="built_in">exec</span> pod/hostpath-test-1-785b9544b9-n5vcz -it -- sh -c <span class="string">"cat /disk/hostpath/hostpath.log"</span>  <span class="comment"># Node 4</span></span><br><span class="line"><span class="comment"># uid=0(root) gid=0(root) groups=10(wheel)-Wed Nov 18 06:40:20 UTC 2020-/disk/hostpath</span></span><br><span class="line">kubectl <span class="built_in">exec</span> pod/hostpath-test-1-785b9544b9-sv2wh -it -- sh  -c <span class="string">"cat /disk/hostpath/hostpath.log"</span>   <span class="comment"># Node 5</span></span><br><span class="line"><span class="comment"># hostpath-test-1-785b9544b9-sv2wh-Wed Nov 18 08:20:42 UTC 2020-/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»æœºæ–‡ä»¶(å„èŠ‚ç‚¹ä¸»æœºå¦‚æœç›®å½•ä¸å­˜åœ¨åˆ†åˆ«åˆ›å»ºä¸€ä¸ªç›®å½•å­˜æ”¾åˆ†é…Podçš„hostpathå·çš„æ•°æ®æ–‡ä»¶)</span></span><br><span class="line">weiyigeek@Ubuntu-PC:~$ ansible k8s-node-4 -a <span class="string">"cat /data/hostpath.log"</span></span><br><span class="line">  <span class="comment"># k8s-node-4 | CHANGED | rc=0 &gt;&gt;</span></span><br><span class="line">  <span class="comment"># uid=0(root) gid=0(root) groups=10(wheel)-Wed Nov 18 06:40:20 UTC 2020-/disk/hostpath</span></span><br><span class="line">weiyigeek@Ubuntu-PC:~$ ansible k8s-node-5 -a <span class="string">"cat /data/hostpath.log"</span></span><br><span class="line">  <span class="comment"># k8s-node-5 | CHANGED | rc=0 &gt;&gt;</span></span><br><span class="line">  <span class="comment"># hostpath-test-1-785b9544b9-sv2wh-Wed Nov 18 08:20:42 UTC 2020-/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) æµ‹è¯•åˆ é™¤(é‡å¯)Podä¸­Volumeå·ä¸­çš„æ•°æ®æ˜¯å¦ä¿ç•™</span></span><br><span class="line">$ kubectl delete pod --all</span><br><span class="line">  <span class="comment"># pod "hostpath-test-1-785b9544b9-n5vcz" deleted</span></span><br><span class="line">  <span class="comment"># pod "hostpath-test-1-785b9544b9-sv2wh" deleted</span></span><br><span class="line">$ kubectl get pod -o wide  <span class="comment"># ç”±äºæˆ‘ä»¬è®¾ç½®çš„replicaså‰¯æœ¬æœŸæœ›å€¼ä¸º2æ‰€ä»¥åˆä¼šè¿›è¡Œé‡å»ºPod</span></span><br><span class="line">  <span class="comment"># NAME                               READY   STATUS    RESTARTS   AGE     IP             NODE         NOMINATED NODE   READINESS GATES</span></span><br><span class="line">  <span class="comment"># hostpath-test-1-785b9544b9-h5dbw   1/1     Running   0          3m11s   10.244.1.138   k8s-node-4   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># hostpath-test-1-785b9544b9-hnngk   1/1     Running   0          3m11s   10.244.2.12    k8s-node-5   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line">$ kubectl get pod -o name</span><br><span class="line">kubectl <span class="built_in">exec</span> pod/hostpath-test-1-785b9544b9-h5dbw -it -- sh -c <span class="string">"cat /disk/hostpath/hostpath.log"</span> 0 <span class="comment"># æ•°æ®ä¾ç„¶å­˜åœ¨</span></span><br><span class="line">  <span class="comment"># uid=0(root) gid=0(root) groups=10(wheel)-Wed Nov 18 06:40:20 UTC 2020-/disk/hostpath</span></span><br><span class="line">kubectl <span class="built_in">exec</span> pod/hostpath-test-1-785b9544b9-hnngk -it -- sh -c <span class="string">"cat /disk/hostpath/hostpath.log"</span>  <span class="comment"># æ•°æ®ä¾ç„¶å­˜åœ¨</span></span><br><span class="line">  <span class="comment"># hostpath-test-1-785b9544b9-sv2wh-Wed Nov 18 08:20:42 UTC 2020-/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (6) åˆ é™¤deploymentèµ„æºæ§åˆ¶å™¨ï¼Œæ­¤æ—¶å„èŠ‚ç‚¹ä¸­/dataçš„æ•°æ®å¹¶ä¸ä¼šéšç€èµ„æºæ§åˆ¶å™¨çš„åˆ é™¤è€Œåˆ é™¤;</span></span><br><span class="line">$ kubectl delete deploy hostpath-test-1</span><br><span class="line"><span class="comment"># deployment.apps "hostpath-test-1" deleted</span></span><br></pre></td></tr></table></figure></p>
<p>Tips : Deployment ä¸­åªæœ‰åœ¨å‰¯æœ¬æ•°ä¸º1çš„è¿è¡Œæ—¶å€™æ­¤ç§æ–¹å¼æŒä¹…åŒ–æ˜¯æ²¡æœ‰æ²¡æœ‰é—®é¢˜çš„å› ä¸ºä¸€æŠŠæƒ…å†µä¸‹å®ƒä¼šè¿è¡Œåœ¨åˆæ¬¡è¿è¡Œçš„èŠ‚ç‚¹ä¹‹ä¸Šï¼Œä½†æ˜¯å¦‚æœå¤šä¸ªå‰¯æœ¬æ•°åˆ™éœ€è¦ä¸‹é¢çš„PVCæŒä¹…åŒ–å·æ‰èƒ½è¿›è¡Œæ•°æ®çš„æŒä¹…åŒ–ä¸ä¸€è‡´æ€§;</p>
<p>Tips : é€šè¿‡æ§åˆ¶å™¨åˆ›å»ºçš„Podå…±äº«äº†å®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œåšåˆ°äº†Nodeå±‚é¢çš„æ•°æ®æŒä¹…åŒ–ï¼Œä½†éœ€è¦æ³¨æ„åˆ é™¤Podåå®¿ä¸»æœºä¸Šçš„Volumeä»ç„¶å­˜åœ¨éœ€è¦æŒ‰éœ€æ¸…ç†;</p>
<p>Tips : é€šè¿‡ docker çš„ voulme å‘½ä»¤é€‰æ‹©æŸ¥çœ‹ä¸åˆ é™¤æœªä½¿ç”¨çš„voulmeæˆ–è€…é€šè¿‡docker volume rm -force å¼ºåˆ¶åˆ é™¤ä¸€ä¸ªæŠ¤æˆ–è€…å¤šä¸ªVolume;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume ls</span><br><span class="line">  <span class="comment"># DRIVER    VOLUME NAME</span></span><br><span class="line">  <span class="comment"># local     1b39579ff10934e81a10652ba201635141db80aea377e8a7c322533673f64a80</span></span><br><span class="line">  <span class="comment"># local     4d655ca0a6fe6eb6df6616b141ba16e9e7e3900d63ae53ea35879d999a061596</span></span><br><span class="line">  <span class="comment"># local     05d7960fecfe1ce5810e37f61a179ec0f3e50b4bf7f36b494346715ff0bd60c4</span></span><br><span class="line">  <span class="comment"># local     8b2ccd3e2e9707970c61ddaea96e3ed02c83770f560b18591fa4fad1c08f7a8e</span></span><br><span class="line">  <span class="comment"># local     73b0aee0ffbe7d467ec5744690b167f2e57496d08fea93a3c0992bb701af4ff0</span></span><br><span class="line">  <span class="comment"># local     78f74566d76be4cea00378cb0bfc70f18a3b2592ccf7fda90bf7a584964fd733</span></span><br><span class="line">  <span class="comment"># local     3512ea706cfc7f289e3945eaa220e51d91274057cd8463a6b94b52738019bafa</span></span><br><span class="line">  <span class="comment"># local     4438e2bfff84a56f1fa321789924701f7c44af3f8e3f199972adfa5151bf9f83</span></span><br><span class="line">  <span class="comment"># local     8210de4bab78e36f455772caeb261ebd81e32ea9f6753d717f86e44f579a3baa</span></span><br><span class="line">  <span class="comment"># local     831413f617021be764d8b18ca72d6d50381bc7c1816af7da20b7f065eed41c5d</span></span><br><span class="line">  <span class="comment"># local     b97aa9d44e9bf45e38275eec57f3073ab8e0687580b1f34edce12c8ca1f81fe3</span></span><br><span class="line">  <span class="comment"># local     b64726c080fd675bde2199a6845702d19ccea2ffda97a1a63e4ffb0ed3c1ec7b</span></span><br><span class="line">  <span class="comment"># local     bcb02978c32a5f284f675ac2a8088b356a97da5c767c4209f559ac2f11d79f09</span></span><br><span class="line">  <span class="comment"># local     c3407cff74c46e9672758dc9e17b4e6f01aafa982e18abb3ec7dc201975f506b</span></span><br><span class="line">  <span class="comment"># local     d1b64baa6fb899ad03117957839deeed722d2214ab2a59f0abc444bb3d292f5b</span></span><br><span class="line">  <span class="comment"># local     df9e564daff5f45f3c37e38490f8c653b8fc0e0fe7bdd2ee0224e46915cad8f0</span></span><br><span class="line">  <span class="comment"># local     ecd52129f73d26d3028ae84a3a690a3b0012341c1b25c53010e1b4a491313adb</span></span><br><span class="line">  <span class="comment"># local     fd4f5c7b9ca9dafec3f2ec8b54e9da9d87f9468b67d40afec94bdc2ebd9a0a69</span></span><br><span class="line"></span><br><span class="line">$ docker volume inspect  1b39579ff10934e81a10652ba201635141db80aea377e8a7c322533673f64a80</span><br><span class="line">  <span class="comment"># [</span></span><br><span class="line">  <span class="comment">#   &#123;</span></span><br><span class="line">  <span class="comment">#     "CreatedAt": "2021-02-03T10:55:08Z",</span></span><br><span class="line">  <span class="comment">#     "Driver": "local",</span></span><br><span class="line">  <span class="comment">#     "Labels": null,</span></span><br><span class="line">  <span class="comment">#     "Mountpoint": "/var/lib/docker/volumes/1b39579ff10934e81a10652ba201635141db80aea377e8a7c322533673f64a80/_data",</span></span><br><span class="line">  <span class="comment">#     "Name": "1b39579ff10934e81a10652ba201635141db80aea377e8a7c322533673f64a80",</span></span><br><span class="line">  <span class="comment">#     "Options": null,</span></span><br><span class="line">  <span class="comment">#     "Scope": "local"</span></span><br><span class="line">  <span class="comment">#   &#125;</span></span><br><span class="line">  <span class="comment"># ]</span></span><br><span class="line"></span><br><span class="line">~$ docker volume prune</span><br><span class="line">  <span class="comment"># WARNING! This will remove all local volumes not used by at least one container.</span></span><br><span class="line">  <span class="comment"># Are you sure you want to continue? [y/N] y</span></span><br><span class="line">  <span class="comment"># Deleted Volumes:</span></span><br><span class="line">  <span class="comment"># 05d7960fecfe1ce5810e37f61a179ec0f3e50b4bf7f36b494346715ff0bd60c4</span></span><br><span class="line">  <span class="comment"># 4438e2bfff84a56f1fa321789924701f7c44af3f8e3f199972adfa5151bf9f83</span></span><br></pre></td></tr></table></figure></p>
<p><strong>å…¥å‘è®¡:</strong></p>
<ul>
<li>é—®é¢˜1.é…ç½®Volumeæ—¶å„nodeèŠ‚ç‚¹å¯èƒ½æ²¡æœ‰/dataç›®å½•æ­¤æ—¶éœ€è¦typeæŒ‡å®šä¸ºDirectoryOrCreateï¼Œå³ç›®å½•ä¸å­˜åœ¨æ—¶åˆ›å»ºç›®å½•ï¼ˆå·¨å‘ï¼‰;<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~/K8s/Day8/demo6$ kubectl get pod</span><br><span class="line">  <span class="comment"># NAME                               READY   STATUS              RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># hostpath-test-1-565b986876-qgfhk   0/1     ContainerCreating   0          4m59s</span></span><br><span class="line"></span><br><span class="line">~/K8s/Day8/demo6$ kubectl describe pod hostpath-test-1-565b986876-qgfhk</span><br><span class="line">  <span class="comment"># Events:</span></span><br><span class="line">  <span class="comment">#   Type     Reason       Age                From               Message</span></span><br><span class="line">  <span class="comment">#   ----     ------       ----               ----               -------</span></span><br><span class="line">  <span class="comment">#   Normal   Scheduled    29s                default-scheduler  Successfully assigned default/hostpath-test-1-565b986876-qgfhk to k8s-node-5</span></span><br><span class="line">  <span class="comment">#   Warning  FailedMount  14s (x6 over 30s)  kubelet            MountVolume.SetUp failed for volume "test-volume" : hostPath type check failed: /data is not a directory</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<h4 id="nfs-åˆ†å¸ƒå¼å…±äº«å­˜å‚¨å·"><a href="#nfs-åˆ†å¸ƒå¼å…±äº«å­˜å‚¨å·" class="headerlink" title="nfs - åˆ†å¸ƒå¼å…±äº«å­˜å‚¨å·"></a>nfs - åˆ†å¸ƒå¼å…±äº«å­˜å‚¨å·</h4><p>æè¿°: æˆ‘ä»¬å¯ä»¥é‡‡ç”¨nfsç›´æ¥ç»™æˆ‘ä»¬çš„Podå®šä¹‰ä¸€ä¸ªNFSç±»å‹çš„å·Volumeç¤ºä¾‹å¦‚ä¸‹;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; nfs-volume-demo.yaml&lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment </span><br><span class="line">metadata:</span><br><span class="line">  name: nfs-test-1      <span class="comment"># å…ƒæ•°æ®åç§°</span></span><br><span class="line">spec:</span><br><span class="line">  replicas: 1                <span class="comment"># å‰¯æœ¬æ•°é‡ä¸º1ï¼Œå¦åˆ™å¤§å®¶éƒ½å†™è¿›åŒä¸€ä¸ªç›®å½•å¯èƒ½ä¼šå¯¼è‡´æ—¥å¿—è®°å½•æ··ä¹±;</span></span><br><span class="line">  selector:                  <span class="comment"># æ³¨æ„å®ƒæ˜¯åœ¨Deploymentæ§åˆ¶å™¨ä¸­éœ€è¦ä¾èµ–çš„</span></span><br><span class="line">    matchLabels:  </span><br><span class="line">      app: nfs-test-1   <span class="comment"># åŒ¹é…çš„Podæ ‡ç­¾éå¸¸é‡è¦</span></span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nfs-test-1</span><br><span class="line">    spec:</span><br><span class="line">      volumes:                         <span class="comment"># volumes å…³é”®ç‚¹</span></span><br><span class="line">      - name: <span class="built_in">test</span>-volume </span><br><span class="line">        nfs:                           <span class="comment"># é‡‡ç”¨ nfs ç±»å‹çš„å·</span></span><br><span class="line">          server: 192.168.1.253        <span class="comment"># nfs ä¸»æœºåœ°å€</span></span><br><span class="line">          path: <span class="string">'/data'</span>                <span class="comment"># nfs å…±äº«ç›®å½•</span></span><br><span class="line">      containers:</span><br><span class="line">      - name: nfs-test</span><br><span class="line">        image: harbor.weiyigeek.top/<span class="built_in">test</span>/busbox:latest</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        <span class="built_in">command</span>: [ <span class="string">"/bin/sh"</span>, <span class="string">"-c"</span>, <span class="string">"sleep 700"</span> ]</span><br><span class="line">        volumeMounts:     </span><br><span class="line">        - name: <span class="built_in">test</span>-volume       </span><br><span class="line">          mountPath: /app/tools/    <span class="comment"># æŒ‡å®šå·æŒ‚è½½åˆ°PodæŒ‡å®šçš„ç›®å½•è·¯å¾„ä¹‹ä¸­</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p>Tips : æ­¤å¤„é’ˆå¯¹äºæ— çŠ¶æ€æœåŠ¡åˆ›å»º,å¦‚æœæ˜¯æœ‰çŠ¶æ€æœåŠ¡è¯·é‡‡ç”¨<code>statefulset</code>æ§åˆ¶åˆ›å»º;</p>
<hr>
<h3 id="4-PersistentVolume-amp-PersistentVolumeClaim"><a href="#4-PersistentVolume-amp-PersistentVolumeClaim" class="headerlink" title="4.PersistentVolume &amp; PersistentVolumeClaim"></a>4.PersistentVolume &amp; PersistentVolumeClaim</h3><p>æè¿°: é»˜è®¤æƒ…å†µä¸‹å¯¹äºè¿è¡Œçš„å®¹å™¨ï¼Œå…¶å¯¹æ–‡ä»¶ç³»ç»Ÿçš„å†™å…¥éƒ½å‘ç”Ÿåœ¨å…¶åˆ†å±‚æ–‡ä»¶ç³»ç»Ÿçš„å¯å†™å±‚çš„(Copy-On-Write), å½“è¿ç§»åº”ç”¨ç¨‹åºä»å¼€å‘åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œå¼€å‘ä¸è¿ç»´é¢ä¸´ç€æŒ‘æˆ˜ï¼Œä¸ºäº†é˜²æ­¢å®¹å™¨æŒ‚æ‰ã€å´©æºƒæˆ–è€…è¿è¡Œç»“æŸæ—¶ï¼Œä»»ä½•ä¸ä¹‹ç›¸å…³çš„æ•°æ®éƒ½å°†ä¼šä¸¢å¤±ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å¼•å‘çš„æ•°æ®ä¸¢å¤±ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†æ•°æ®å­˜å‚¨æŒä¹…åŒ–ä¹Ÿå°±æ˜¯æœ¬ç« ä¸»é¢˜(Persistent Volume [Claim]);</p>
<h4 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h4><p>Q: ä»€ä¹ˆæ˜¯PersistentVolumeï¼ˆPVï¼‰?</p>
<blockquote>
<p>ç­”: PVæ˜¯Volumeä¹‹ç±»çš„å·æ’ä»¶ï¼Œä½†å…·æœ‰ç‹¬ç«‹äºä½¿ç”¨PVçš„Podçš„ç”Ÿå‘½å‘¨æœŸã€ä¸æ”¯æŒå‘½åç©ºé—´åˆ’åˆ†ã€‚å®ƒæ˜¯ç”±ç®¡ç†å‘˜è®¾ç½®çš„å­˜å‚¨å¹¶ä¸”æ˜¯å±äºç¾¤é›†çš„ä¸€éƒ¨åˆ†(èµ„æº)<br>æ­¤APIå¯¹è±¡åŒ…å«å­˜å‚¨å®ç°çš„ç»†èŠ‚ï¼Œå³NFSã€iSCSlæˆ–ç‰¹å®šäºäº‘ä¾›åº”å•†çš„å­˜å‚¨ç³»ç»Ÿã€‚</p>
</blockquote>
<p>Q: ä»€ä¹ˆæ˜¯PersistentVolumeClaim (PVC) ?</p>
<blockquote>
<p>ç­”: PVC æ˜¯ç”¨æˆ·å­˜å‚¨çš„è¯·æ±‚å®ƒä¸Podæ¯”è¾ƒç›¸ä¼¼ï¼Œ<code>æ”¯æŒå‘½åç©ºé—´çš„åˆ’åˆ†</code>ï¼Œä¾‹å¦‚ Pod æ¶ˆè€—èŠ‚ç‚¹èµ„æºï¼Œè€ŒPVCæ¶ˆè€—PVèµ„æº<br>åˆä¾‹å¦‚Podå¯ä»¥è¯·æ±‚ç‰¹å®šçº§åˆ«çš„èµ„æºï¼ˆCPUå’Œå†…å­˜ï¼‰ï¼Œè€ŒPVC å£°æ˜å¯ä»¥è¯·æ±‚ç‰¹å®šçš„å¤§å°å’Œè®¿é—®æ¨¡å¼ï¼ˆä¾‹å¦‚ï¼Œå¯ä»¥ä»¥è¯»/å†™ä¸€æ¬¡æˆ–åªè¯»å¤šæ¬¡æ¨¡å¼æŒ‚è½½ï¼‰</p>
</blockquote>
<p><br/></p>
<p><strong>PV/PVCç”Ÿå‘½å‘¨æœŸæµç¨‹</strong><br>ç­”: ä¾›åº”å‡†å¤‡ -&gt; ç»‘å®š -&gt; ä½¿ç”¨ -&gt; é‡Šæ”¾ -&gt; å›æ”¶(Reclaiming)</p>
<p><br></p>
<p><strong>æŒä¹…å·(PV)æ’ä»¶ç±»å‹</strong><br>æè¿°: PersistentVolumeç±»å‹ä»¥æ’ä»¶å½¢å¼å®ç°ä¸‹é¢æ˜¯K8sç›®å‰æ”¯æŒçš„ä¸€äº›æ’ä»¶ç±»å‹;</p>
<ul>
<li>Â·GCEPersistentDisk AWSElasticBlockStore AzureFile AzureDisk FC(Fibre Channel) </li>
<li>Â·FlexVolume Flocker NFS iSCSI RBD(Ceph Block Device)CephFS </li>
<li>Â·Cinder(OpenStack block storage)Glusterfs VsphereVolume Quobyte Volumes </li>
<li>Â·HostPath VMware Photon Portworx Volumes Scalelo Volumes StorageOS</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å·æ’ä»¶	ReadWriteOnce	ReadOnlyMany	ReadWriteMany</span></span><br><span class="line">AWSElasticBlockStore	âœ“	-	-</span><br><span class="line">AzureFile	âœ“	âœ“	âœ“</span><br><span class="line">AzureDisk	âœ“	-	-</span><br><span class="line">CephFS	âœ“	âœ“	âœ“</span><br><span class="line">Cinder	âœ“	-	-</span><br><span class="line">CSI	å–å†³äºé©±åŠ¨	å–å†³äºé©±åŠ¨	å–å†³äºé©±åŠ¨</span><br><span class="line">FC	âœ“	âœ“	-</span><br><span class="line">FlexVolume	âœ“	âœ“	å–å†³äºé©±åŠ¨</span><br><span class="line">Flocker	âœ“	-	-</span><br><span class="line">GCEPersistentDisk	âœ“	âœ“	-</span><br><span class="line">Glusterfs	âœ“	âœ“	âœ“</span><br><span class="line">HostPath	âœ“	-	-</span><br><span class="line">iSCSI	âœ“	âœ“	-</span><br><span class="line">Quobyte	âœ“	âœ“	âœ“</span><br><span class="line">NFS	âœ“	âœ“	âœ“</span><br><span class="line">RBD	âœ“	âœ“	-</span><br><span class="line">VsphereVolume	âœ“	-	- (Pod è¿è¡ŒäºåŒä¸€èŠ‚ç‚¹ä¸Šæ—¶å¯è¡Œ)</span><br><span class="line">PortworxVolume	âœ“	-	âœ“</span><br><span class="line">ScaleIO	âœ“	âœ“	-</span><br><span class="line">StorageOS	âœ“	-	-</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒåœ°å€: <a href="https://kubernetes.io/zh/docs/concepts/storage/persistent-volumes/#access-modes" target="_blank" rel="noopener">https://kubernetes.io/zh/docs/concepts/storage/persistent-volumes/#access-modes</a></p>
<p><br></p>
<h4 id="PV-åˆ†ç±»"><a href="#PV-åˆ†ç±»" class="headerlink" title="PV åˆ†ç±»"></a>PV åˆ†ç±»</h4><p>æè¿°: ä¾›åº”å‡†å¤‡é€šè¿‡é›†ç¾¤å¤–çš„å­˜å‚¨ç³»ç»Ÿæˆ–è€…äº‘å¹³å°æ¥æä¾›å­˜å‚¨æŒä¹…åŒ–æ”¯æŒ;</p>
<ul>
<li>1) é™æ€pv : ç”±é›†ç¾¤ç®¡ç†å‘˜åˆ›å»ºä¸€äº›PVã€‚å®ƒä»¬å¸¦æœ‰å¯ä¾›ç¾¤é›†ç”¨æˆ·ä½¿ç”¨çš„å®é™…å­˜å‚¨çš„ç»†èŠ‚ã€‚å®ƒä»¬å­˜åœ¨äºKubernetesAPlä¸­å¯ç”¨äºæ¶ˆè´¹ã€‚</li>
<li>2) åŠ¨æ€pv : å½“ç®¡ç†å‘˜åˆ›å»ºçš„é™æ€PVéƒ½ä¸åŒ¹é…ç”¨æˆ·çš„<code>PersistentVolumeClaim</code> æ—¶ï¼Œé›†ç¾¤å¯èƒ½ä¼šå°è¯•åŠ¨æ€åœ°ä¸ºPVCåˆ›å»ºå·ã€‚æ­¤é…ç½®<code>åŸºäºStorageClasse:PVCå¿…é¡»è¯·æ±‚[å­˜å‚¨ç±»]</code>ï¼Œå¹¶ä¸”ç®¡ç†å‘˜å¿…é¡»åˆ›å»ºå¹¶é…ç½®è¯¥ç±»æ‰èƒ½è¿›è¡ŒåŠ¨æ€åˆ›å»ºã€‚å£°æ˜è¯¥ç±»ä¸ºç©ºå¯ä»¥æœ‰æ•ˆåœ°ç¦ç”¨å…¶åŠ¨æ€é…ç½®ï¼›è¦å¯ç”¨åŸºäºå­˜å‚¨çº§åˆ«çš„åŠ¨æ€å­˜å‚¨é…ç½®ï¼Œé›†ç¾¤ç®¡ç†å‘˜éœ€è¦å¯ç”¨API serverä¸Šçš„<code>DefaultStorageClass[å‡†å…¥æ§åˆ¶å™¨]</code>ã€‚<ul>
<li>ä¾‹å¦‚ï¼Œé€šè¿‡ç¡®ä¿ DefaultStorageClassä½äºAPI server ç»„ä»¶çš„â€“admission-controlæ ‡å¿—ï¼Œä½¿ç”¨é€—å·åˆ†éš”çš„æœ‰åºå€¼åˆ—è¡¨ä¸­ï¼Œå¯ä»¥å®Œæˆæ­¤æ“ä½œã€‚</li>
</ul>
</li>
</ul>
<p><br></p>
<h4 id="PV-ç»‘å®š"><a href="#PV-ç»‘å®š" class="headerlink" title="PV ç»‘å®š"></a>PV ç»‘å®š</h4><p><strong>Q: ä»€ä¹ˆæ˜¯ç»‘å®šPVä»¥åŠä¸ºå•¥éœ€è¦ç»‘å®š?</strong></p>
<blockquote>
<p>ç­”: ç”±äº PVC éœ€è¦å¯¹æ¥ç»‘å®šä¸€ä¸ªPVæ‰èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨, ç”±äº master ä¸­çš„æ§åˆ¶ç¯è·¯ç›‘è§†æ–°çš„PVCï¼Œå¯»æ‰¾åŒ¹é…çš„PVï¼ˆå¦‚æœå¯èƒ½ï¼‰ï¼Œå¹¶å°†å®ƒä»¬ç»‘å®šåœ¨ä¸€èµ·ã€‚<br>å¦‚æœä¸ºæ–°çš„PVCåŠ¨æ€è°ƒé…PVï¼Œåˆ™è¯¥ç¯è·¯å°†å§‹ç»ˆå°†è¯¥PVç»‘å®šåˆ°PVCã€‚å¦åˆ™ï¼Œç”¨æˆ·æ€»ä¼šå¾—åˆ°ä»–ä»¬æ‰€è¯·æ±‚çš„å­˜å‚¨ï¼Œä½†æ˜¯å®¹é‡å¯èƒ½è¶…å‡ºè¦æ±‚çš„æ•°é‡ã€‚<code>ä¸€æ—¦PVå’ŒPVCç»‘å®šå PersistentVolumeClaim ç»‘å®šæ˜¯æ’ä»–æ€§çš„</code>ä¸ç®¡å®ƒä»¬æ˜¯å¦‚ä½•ç»‘å®šçš„ã€‚ç®€å•çš„è¯´PVCè·ŸPVç»‘å®šæ˜¯ä¸€å¯¹ä¸€çš„æ˜ å°„ä¸€æ—¦PVç»‘å®šåä¾¿ä¸å¯ä¸å…¶å®ƒPVCç»‘å®šã€‚</p>
</blockquote>
<p><strong>æŒä¹…å·(PV)çŠ¶æ€</strong><br>æè¿°: PVå·å¯ä»¥å¤„äºä»¥ä¸‹çš„æŸç§çŠ¶æ€;</p>
<ul>
<li>Â·Availableï¼ˆå¯ç”¨ï¼‰ - ç©ºé—²èµ„æºè¿˜æ²¡æœ‰è¢«ä»»ä½•å£°æ˜ç»‘å®š</li>
<li>Â·Boundï¼ˆå·²ç»‘å®šï¼‰ - å·å·²ç»è¢«å£°æ˜ç»‘å®š</li>
<li>Â·Releasedï¼ˆå·²é‡Šæ”¾ï¼‰- å£°æ˜è¢«åˆ é™¤ï¼Œä½†æ˜¯èµ„æºè¿˜æœªè¢«é›†ç¾¤é‡æ–°å£°æ˜</li>
<li>Â·Failedï¼ˆå¤±è´¥ï¼‰- è¯¥å·çš„è‡ªåŠ¨å›æ”¶å¤±è´¥</li>
</ul>
<p><br></p>
<h4 id="PV-ä½¿ç”¨"><a href="#PV-ä½¿ç”¨" class="headerlink" title="PV ä½¿ç”¨"></a>PV ä½¿ç”¨</h4><p>æè¿°: ç”¨æˆ·å¯åœ¨Podä¸­åƒVolumeä¸€æ ·ä½¿ç”¨PVC;</p>
<p><strong>æŒä¹…å·(PV)å£°æ˜çš„ä¿æŠ¤</strong><br>æè¿°: PVCä¿æŠ¤çš„ç›®çš„æ˜¯ç¡®ä¿ç”±podæ­£åœ¨ä½¿ç”¨çš„PVCä¸ä¼šä»ç³»ç»Ÿä¸­ç§»é™¤ï¼Œå› ä¸ºå¦‚æœè¢«ç§»é™¤çš„è¯å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±å½“<code>å¯ç”¨PVCä¿æŠ¤ alphaåŠŸèƒ½æ—¶</code>ï¼Œå¦‚æœç”¨æˆ·åˆ é™¤äº†ä¸€ä¸ªpod æ­£åœ¨ä½¿ç”¨çš„PVCï¼Œåˆ™è¯¥PVCä¸ä¼šè¢«ç«‹å³åˆ é™¤ã€‚PVCçš„åˆ é™¤å°†è¢«æ¨è¿Ÿï¼Œç›´åˆ°PVCä¸å†è¢«ä»»ä½• pod ä½¿ç”¨;</p>
<p><strong>æŒä¹…å·(PV)è®¿é—®æ¨¡å¼</strong><br>æè¿°: PersistentVolumeå¯ä»¥èµ„æºæä¾›è€…æ”¯æŒçš„ä»»ä½•æ–¹å¼æŒ‚è½½åˆ°ä¸»æœºä¸Š, å¦‚ä¸‹è¡¨æ‰€ç¤ºä¾›åº”å•†å…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œæ¯ä¸ªPVçš„è®¿é—®æ¨¡å¼éƒ½å°†è¢«è®¾ç½®ä¸ºè¯¥å·æ”¯æŒçš„ç‰¹å®šæ¨¡å¼ã€‚<br>ä¾‹å¦‚ï¼ŒNFSå¯ä»¥<code>æ”¯æŒå¤šä¸ªè¯»/å†™å®¢æˆ·ç«¯</code>ï¼Œä½†ç‰¹å®šçš„NFSPVå¯èƒ½ä»¥åªè¯»æ–¹å¼å¯¼å‡ºåˆ°æœåŠ¡å™¨ä¸Šã€‚æ¯ä¸ªPVéƒ½æœ‰ä¸€å¥—è‡ªå·±çš„ç”¨æ¥æè¿°ç‰¹å®šåŠŸèƒ½çš„è®¿é—®æ¨¡å¼;</p>
<ul>
<li>Â·RWO (<code>Cli æ ¼å¼ç®€å†™</code>)-ReadWriteOnce è¯¥å·å¯ä»¥è¢«å•ä¸ªèŠ‚ç‚¹ä»¥è¯»/å†™æ¨¡å¼æŒ‚è½½</li>
<li>Â·ROX-ReadOnlyMany                  - è¯¥å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥åªè¯»æ¨¡å¼æŒ‚è½½</li>
<li>Â·RWX-ReadWriteMany                 - è¯¥å·å¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹ä»¥è¯»/å†™æ¨¡å¼æŒ‚è½½</li>
</ul>
<p>PS : æ¯ä¸ªå·åªèƒ½åŒä¸€æ—¶åˆ»åªèƒ½ä»¥ä¸€ç§è®¿é—®æ¨¡å¼æŒ‚è½½ï¼Œå³ä½¿è¯¥å·èƒ½å¤Ÿæ”¯æŒ å¤šç§è®¿é—®æ¨¡å¼ã€‚ä¾‹å¦‚<code>GCEPersistentDisk</code>å¯ä»¥ç”±å•ä¸ªèŠ‚ç‚¹ä½œä¸º<code>ReadWriteOnce</code>æ¨¡å¼æŒ‚è½½ï¼Œæˆ–ç”±å¤šä¸ªèŠ‚ç‚¹ä»¥<code>ReadOnlyMany</code>æ¨¡å¼æŒ‚è½½ï¼Œä½†ä¸èƒ½åŒæ—¶æŒ‚è½½ ;</p>
<p><br></p>
<h4 id="PV-é‡Šæ”¾"><a href="#PV-é‡Šæ”¾" class="headerlink" title="PV é‡Šæ”¾"></a>PV é‡Šæ”¾</h4><p>æè¿°: ç”¨æˆ·åˆ é™¤PVCæ¥å›æ”¶å­˜å‚¨èµ„æºæ­¤æ—¶PVå°†å˜æˆReleasedçŠ¶æ€ï¼Œç”±äºå…¶è¿˜ä¿ç•™ç€ä¹‹å‰çš„æ•°æ®ï¼Œè¯¥æ•°æ®éœ€è¦æ ¹æ®ä¸åŒçš„ç­–ç•¥æ¥å¤„ç†ï¼Œå¦åˆ™è¿™äº›å­˜å‚¨èµ„æºæ— æ³•è¢«å…¶å®ƒPVCä½¿ç”¨;</p>
<p><br></p>
<h4 id="PV-å›æ”¶"><a href="#PV-å›æ”¶" class="headerlink" title="PV å›æ”¶"></a>PV å›æ”¶</h4><p>æè¿°: æŒä¹…å·(PV) å›æ”¶çš„å‡ ç§ç­–ç•¥</p>
<ul>
<li>Â·Retainï¼ˆä¿ç•™ï¼‰â€“ å…è®¸äººå·¥å¤„ç†ä¿ç•™çš„æ•°æ®;</li>
<li>Â·Recycle (deprecated) â€“ åŸºæœ¬æ“¦é™¤å°†åˆ é™¤PVä¸å¤–éƒ¨å…³è”çš„å­˜å‚¨èµ„æº (rm -rf /thevolume/*)ï¼Œæ³¨æ„:éœ€è¦æ’ä»¶æ”¯æŒ</li>
<li>Â·Deleteï¼ˆåˆ é™¤ï¼‰â€“ å…³è”çš„å­˜å‚¨èµ„äº§ï¼ˆä¾‹å¦‚AWS EBSã€GCE PDã€Azure Disk å’ŒOpenStack Cinderå·ï¼‰å°†è¢«åˆ é™¤ï¼Œ æ³¨æ„:éœ€è¦æ’ä»¶æ”¯æŒ</li>
</ul>
<p>PS :å½“å‰åªæœ‰ NFS å’Œ HostPath æ”¯æŒå›æ”¶ç­–ç•¥åŸºæœ¬ä¸ç”¨(Recycleå·²è¢«åºŸå¼ƒ)ã€‚AWS EBSã€GCE PDã€Azure Disk å’ŒCinder å·æ”¯æŒåˆ é™¤ç­–ç•¥;</p>
<p><br></p>
<h4 id="PV-PVC-ä¸¾ä¾‹"><a href="#PV-PVC-ä¸¾ä¾‹" class="headerlink" title="PV/PVC ä¸¾ä¾‹"></a>PV/PVC ä¸¾ä¾‹</h4><p>Volume API èµ„æºæ¸…å•:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/K8s/Day8/demo6$ kubectl api-resources | grep <span class="string">"volume"</span></span><br><span class="line">  <span class="comment"># persistentvolumeclaims            pvc                                         true         PersistentVolumeClaim</span></span><br><span class="line">  <span class="comment"># persistentvolumes                 pv                                          false        PersistentVolume</span></span><br></pre></td></tr></table></figure></p>
<p>PVï¼ˆæŒä¹…å·ï¼‰NFS ç±»å‹ ä¸ HostPath ç±»å‹èµ„æºæ¸…å•:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) ä»¥NFSç±»å‹çš„PVç¤ºä¾‹</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nfs-test</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  capacity:</span></span><br><span class="line"><span class="attr">    storage:</span> <span class="number">5</span><span class="string">Gi</span> </span><br><span class="line"><span class="attr">  volumeMode:</span> <span class="string">Filesystem</span> </span><br><span class="line"><span class="attr">  accessModes:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">ReadWriteOnce</span>                       <span class="comment"># å•èŠ‚ç‚¹è¯»å†™</span></span><br><span class="line"><span class="attr">  persistentVolumeReclaimPolicy:</span> <span class="string">Delete</span>   <span class="comment"># å›æ”¶ç­–ç•¥</span></span><br><span class="line"><span class="attr">  storageClassName:</span> <span class="string">slow</span>                  <span class="comment"># æ­¤æŒä¹…å·æ‰€å±çš„StorageClassçš„åç§°ï¼Œç©ºå€¼æ„å‘³ç€æ­¤å·ä¸å±äºä»»ä½•å­˜å‚¨ç±»ã€‚</span></span><br><span class="line"><span class="attr">  mountOptions:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">hard</span> </span><br><span class="line"><span class="bullet">    -</span> <span class="string">nfsvers=4.1</span> </span><br><span class="line"><span class="attr">  nfs:</span>             <span class="comment">#PV ç±»å‹</span></span><br><span class="line"><span class="attr">    path:</span> <span class="string">/tmp</span> </span><br><span class="line"><span class="attr">    server:</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># (2) ä»¥hostpathç±»å‹çš„PVç¤ºä¾‹</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">hostpath-test</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  capacity:</span></span><br><span class="line"><span class="attr">    storage:</span> <span class="number">2</span><span class="string">Gi</span> </span><br><span class="line"><span class="attr">  accessModes:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">ReadWriteOnce</span>                       <span class="comment"># å•èŠ‚ç‚¹è¯»å†™</span></span><br><span class="line"><span class="attr">  hostPath:</span></span><br><span class="line"><span class="attr">    path:</span> <span class="string">/tmp/local</span></span><br></pre></td></tr></table></figure></p>
<p>PS : storageClassName è¡¨ç¤ºæ‰€å±å·çš„ StorageClass çš„åç§°ï¼Œç©ºå€¼æ„å‘³ç€æ­¤å·ä¸å±äºä»»ä½•å­˜å‚¨ç±», ä»–æ˜¯PVCç»‘å®šåˆ°PVå·çš„é‡è¦æŒ‡æ ‡ã€‚</p>
<p><br/></p>
<p>PVCï¼ˆæŒä¹…å·ï¼‰NFS ç±»å‹ ä¸ HostPath ç±»å‹èµ„æºæ¸…å•:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PVCï¼ˆæŒä¹…å·ï¼‰NFS ç±»å‹ </span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nfs-test-claim</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  accessModes:</span> <span class="string">["ReadWriteOnce"]</span></span><br><span class="line"><span class="attr">  storageClassName:</span> <span class="string">slow</span>       <span class="comment"># å…³é”®ç‚¹(ä¸ä¸Šé¢çš„NFSåˆ›å»ºçš„PVè¿›è¡Œå…³è”)</span></span><br><span class="line"><span class="attr">  volumeMode:</span> <span class="string">Filesystem</span> </span><br><span class="line"><span class="attr">  resources:</span></span><br><span class="line"><span class="attr">    requests:</span></span><br><span class="line"><span class="attr">      storage:</span> <span class="number">5</span><span class="string">Gi</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      release:</span> <span class="string">"stable"</span></span><br><span class="line"><span class="attr">    matchExpressions:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">&#123;key:</span> <span class="string">environment,</span> <span class="attr">operator:</span> <span class="string">In,</span> <span class="attr">values:</span> <span class="string">[dev]&#125;</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># PVCï¼ˆæŒä¹…å·ï¼‰HostPath ç±»å‹ </span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">hostpath-test-claim</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  accessModes:</span> <span class="string">["ReadWriteOnce"]</span></span><br><span class="line"><span class="attr">  resources:</span></span><br><span class="line"><span class="attr">    requests:</span></span><br><span class="line"><span class="attr">      storage:</span> <span class="number">1</span><span class="string">Gi</span></span><br></pre></td></tr></table></figure></p>
<p>Pod æ¶ˆè´¹ PV å·èµ„æºæ¸…å•ç¤ºä¾‹:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">pv-consumer</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">myfrontend</span></span><br><span class="line"><span class="attr">      image:</span> <span class="attr">nginx:latest</span></span><br><span class="line"><span class="attr">      imagePullPolicy:</span> <span class="string">ifNotPresent</span></span><br><span class="line"><span class="attr">      ports:</span></span><br><span class="line"><span class="attr">      - containerPort:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">web</span> </span><br><span class="line"><span class="attr">      volumeMounts:</span>     <span class="comment"># å·æŒ‚è½½</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">pv-claim</span>  <span class="comment"># å·åç§°</span></span><br><span class="line"><span class="attr">        mountPath:</span> <span class="string">/usr/share/nginx/html</span>  <span class="comment"># å·æŒ‚è½½è·¯å¾„</span></span><br><span class="line"><span class="attr">  volumes:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">pv-claim</span></span><br><span class="line"><span class="attr">      persistentVolumeClaim:</span> </span><br><span class="line"><span class="attr">        claimName:</span> <span class="string">nfs-test-claim</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="PV-PVC-å®ä¾‹"><a href="#PV-PVC-å®ä¾‹" class="headerlink" title="PV/PVC å®ä¾‹"></a>PV/PVC å®ä¾‹</h4><h5 id="NFS-æŒä¹…åŒ–å·é…ç½®æ¼”ç¤º"><a href="#NFS-æŒä¹…åŒ–å·é…ç½®æ¼”ç¤º" class="headerlink" title="NFS æŒä¹…åŒ–å·é…ç½®æ¼”ç¤º"></a>NFS æŒä¹…åŒ–å·é…ç½®æ¼”ç¤º</h5><ul>
<li>Step 1.NFS æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯é…ç½®<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ä¸»èŠ‚ç‚¹ä¸Šå®‰è£…nfs-server</span></span><br><span class="line">&gt; ansible admin -a <span class="string">"sudo apt install -y nfs-kernel-server rpcbind"</span></span><br><span class="line">sudo mkdir -pv /nfs/data&#123;1..4&#125; /nfs/datamkdir </span><br><span class="line">  <span class="comment"># mkdir: created directory '/nfs'</span></span><br><span class="line">  <span class="comment"># mkdir: created directory '/nfs/data1'</span></span><br><span class="line">  <span class="comment"># mkdir: created directory '/nfs/data2'</span></span><br><span class="line">  <span class="comment"># mkdir: created directory '/nfs/data3'</span></span><br><span class="line">sudo chmod -R 777 /nfs</span><br><span class="line">sudo chown -R nobody /nfs</span><br><span class="line">sudo tee /etc/exports &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">/nfs/data *(rw,no_root_squash,no_all_squash,sync)</span><br><span class="line">/nfs/data1 *(rw,no_root_squash,no_all_squash,sync)</span><br><span class="line">/nfs/data2 *(rw,no_root_squash,no_all_squash,sync)</span><br><span class="line">/nfs/data3 *(rw,no_root_squash,no_all_squash,sync)</span><br><span class="line">/nfs/data4 *(rw,no_root_squash,no_all_squash,sync)</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl restart rpcbind </span><br><span class="line">sudo systemctl restart nfs-server.service</span><br><span class="line">sudo exportfs -r &amp;&amp; sudo exportfs -av</span><br><span class="line"></span><br><span class="line"><span class="comment"># Node èŠ‚ç‚¹ä¸Šå®‰è£…nfs-clientä»¥åŠmount.nfs</span></span><br><span class="line">&gt; ansible k8s-node-4 -a <span class="string">"sudo apt install -y nfs-common rpcbind"</span></span><br><span class="line">&gt; ansible k8s-node-5 -a <span class="string">"sudo apt install -y nfs-common rpcbind"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹ä¸ŠæŒ‚è½½æµ‹è¯•</span></span><br><span class="line">showmount -e 10.10.107.202</span><br><span class="line">mount -t nfs 10.10.107.202:/nfsdata /<span class="built_in">test</span>/</span><br><span class="line"><span class="built_in">cd</span> /<span class="built_in">test</span>/ &amp;&amp; ls</span><br><span class="line">umount /<span class="built_in">test</span>/</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>Step 2.PV åˆ›å»º<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; pv-test-demo-1.yaml&lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"># 1.è®¿é—®æ¨¡å¼ä¸º ReadWriteOnce - pv-test-1</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">pv-test-1</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  capacity:</span>              <span class="comment"># å®¹é‡</span></span><br><span class="line"><span class="attr">    storage:</span> <span class="number">1</span><span class="string">Gi</span> </span><br><span class="line"><span class="attr">  accessModes:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">ReadWriteOnce</span> </span><br><span class="line"><span class="attr">  persistentVolumeReclaimPolicy:</span> <span class="string">Retain</span></span><br><span class="line"><span class="attr">  storageClassName:</span> <span class="string">nfs</span>  <span class="comment"># éå¸¸é‡è¦ (åé¢PVCå°†ä¼šæ ¹æ®è®¿é—®æ¨¡å¼ä»¥åŠå­˜å‚¨ç±»åç§°è¿›è¡Œç»‘å®šPV)</span></span><br><span class="line"><span class="attr">  nfs:</span></span><br><span class="line"><span class="attr">   path:</span> <span class="string">/nfs/data1</span></span><br><span class="line"><span class="attr">   server:</span> <span class="number">10.10</span><span class="number">.107</span><span class="number">.202</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># 1.è®¿é—®æ¨¡å¼ä¸º ReadWriteOnce - pv-test-2</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">pv-test-2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  capacity:</span>            <span class="comment">#å®¹é‡</span></span><br><span class="line"><span class="attr">    storage:</span> <span class="number">1</span><span class="string">Gi</span> </span><br><span class="line"><span class="attr">  accessModes:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">ReadWriteOnce</span> </span><br><span class="line"><span class="attr">  persistentVolumeReclaimPolicy:</span> <span class="string">Retain</span></span><br><span class="line"><span class="attr">  storageClassName:</span> <span class="string">nfs</span>  <span class="comment"># éå¸¸é‡è¦ (åé¢PVCå°†ä¼šæ ¹æ®è®¿é—®æ¨¡å¼ä»¥åŠå­˜å‚¨ç±»åç§°è¿›è¡Œç»‘å®šPV)</span></span><br><span class="line"><span class="attr">  nfs:</span></span><br><span class="line"><span class="attr">   path:</span> <span class="string">/nfs/data2</span></span><br><span class="line"><span class="attr">   server:</span> <span class="number">10.10</span><span class="number">.107</span><span class="number">.202</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># 2.è®¿é—®æ¨¡å¼ä¸º ReadOnlyMany </span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">pv-test-4</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  capacity:</span>            <span class="comment">#å®¹é‡</span></span><br><span class="line"><span class="attr">    storage:</span> <span class="number">2</span><span class="string">Gi</span> </span><br><span class="line"><span class="attr">  accessModes:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">ReadOnlyMany</span> </span><br><span class="line"><span class="attr">  persistentVolumeReclaimPolicy:</span> <span class="string">Retain</span></span><br><span class="line"><span class="attr">  storageClassName:</span> <span class="string">nfs-retain</span>   <span class="comment"># éå¸¸é‡è¦</span></span><br><span class="line"><span class="attr">  nfs:</span></span><br><span class="line"><span class="attr">   path:</span> <span class="string">/nfs/data4</span></span><br><span class="line"><span class="attr">   server:</span> <span class="number">10.10</span><span class="number">.107</span><span class="number">.202</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># 3.è®¿é—®æ¨¡å¼ä¸º ReadWriteMany å›æ”¶ç­–ç•¥ä¸º Delete</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">pv-test-5</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  capacity:</span>            <span class="comment">#å®¹é‡</span></span><br><span class="line"><span class="attr">    storage:</span> <span class="number">3</span> <span class="string">Gi</span> </span><br><span class="line"><span class="attr">  accessModes:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">ReadWriteMany</span> </span><br><span class="line"><span class="attr">  persistentVolumeReclaimPolicy:</span> <span class="string">Delete</span></span><br><span class="line"><span class="attr">  storageClassName:</span> <span class="string">nfs-delete</span>     <span class="comment"># éå¸¸é‡è¦</span></span><br><span class="line"><span class="attr">  nfs:</span></span><br><span class="line"><span class="attr">   path:</span> <span class="string">/nfs/data</span></span><br><span class="line"><span class="attr">   server:</span> <span class="number">10.10</span><span class="number">.107</span><span class="number">.202</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>Step 3.æ“ä½œæµç¨‹&amp;æŸ¥çœ‹<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1) éƒ¨ç½²PV</span></span><br><span class="line">~/K8s/Day8/demo7$ kubectl create -f pv-test-demo-1.yaml</span><br><span class="line">  <span class="comment"># persistentvolume/pv-test-1 created</span></span><br><span class="line">  <span class="comment"># persistentvolume/pv-test-2 created</span></span><br><span class="line">  <span class="comment"># persistentvolume/pv-test-4 created</span></span><br><span class="line">  <span class="comment"># persistentvolume/pv-test-5 created</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2) æŸ¥çœ‹PV</span></span><br><span class="line">~/K8s/Day8/demo7$ kubectl get pv -o wide</span><br><span class="line"><span class="comment"># NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE     VOLUMEMODE</span></span><br><span class="line">  <span class="comment"># pv-test-1   1Gi        RWO            Retain           Available           nfs                     23s   Filesystem</span></span><br><span class="line">  <span class="comment"># pv-test-2   1Gi        RWO            Retain           Available           nfs                     23s   Filesystem</span></span><br><span class="line">  <span class="comment"># pv-test-4   2Gi        ROX            Retain           Available           nfs-retain              22s   Filesystem</span></span><br><span class="line">  <span class="comment"># pv-test-5   3Gi        RWX            Delete           Available           nfs-delete              22s   Filesystem</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3) æŸ¥çœ‹PV-TEST-1è¯¦æƒ…</span></span><br><span class="line">~/K8s/Day8/demo7$ kubectl describe pv pv-test-1</span><br><span class="line">  <span class="comment"># Name:            pv-test-1</span></span><br><span class="line">  <span class="comment"># Labels:          &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># Annotations:     &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># Finalizers:      [kubernetes.io/pv-protection]</span></span><br><span class="line">  <span class="comment"># StorageClass:    nfs</span></span><br><span class="line">  <span class="comment"># Status:          Available</span></span><br><span class="line">  <span class="comment"># Claim:</span></span><br><span class="line">  <span class="comment"># Reclaim Policy:  Retain</span></span><br><span class="line">  <span class="comment"># Access Modes:    RWO</span></span><br><span class="line">  <span class="comment"># VolumeMode:      Filesystem</span></span><br><span class="line">  <span class="comment"># Capacity:        1Gi</span></span><br><span class="line">  <span class="comment"># Node Affinity:   &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># Message:</span></span><br><span class="line">  <span class="comment"># Source:</span></span><br><span class="line">  <span class="comment">#     Type:      NFS (an NFS mount that lasts the lifetime of a pod)</span></span><br><span class="line">  <span class="comment">#     Server:    10.10.107.202</span></span><br><span class="line">  <span class="comment">#     Path:      /nfs/data1</span></span><br><span class="line">  <span class="comment">#     ReadOnly:  false</span></span><br><span class="line">  <span class="comment"># Events:        &lt;none&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>Step 4.Service å’Œ PV ç»‘å®š ä¸ PVC åˆ›å»º<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; pvc-demo1.yaml&lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nginx-pvc-demo</span>    <span class="comment"># SVCæœåŠ¡çš„å…ƒæ•°æ®åç§°</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  clusterIP:</span> <span class="string">None</span>    <span class="comment"># å…³é”®ç‚¹: æ— å¤´æœåŠ¡å¯ä»¥é€šè¿‡é›†ç¾¤CoreDNSè§£ææŒ‡å‘Podä¸­æœåŠ¡</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">  - port:</span> <span class="number">80</span> </span><br><span class="line"><span class="attr">    name:</span> <span class="string">web</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">web-pvc-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  serviceName:</span> <span class="string">nginx-pvc-demo</span>    <span class="comment"># ç»‘å®šServiceæœåŠ¡çš„åç§°</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span>                    <span class="comment"># ä¸‰ä¸ªå‰¯æœ¬æ•°</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">nginx</span>                 <span class="comment"># é€‰æ‹©å™¨åŒ¹é…çš„æ ‡ç­¾</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">nginx</span>               <span class="comment"># æ¨¡æ¿æ ‡ç­¾ </span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">nginx</span> </span><br><span class="line"><span class="attr">        image:</span> <span class="string">harbor.weiyigeek.top/test/nginx:latest</span></span><br><span class="line"><span class="attr">        imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="attr">        - containerPort:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">web</span> </span><br><span class="line"><span class="attr">        volumeMounts:</span>    <span class="comment"># å·æŒ‚è½½</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">diskpv</span>   <span class="comment"># å·åç§°</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/usr/share/nginx/html</span> </span><br><span class="line"><span class="attr">  volumeClaimTemplates:</span>   <span class="comment"># æŒä¹…å·æ¨¡æ¿å¼•æ“</span></span><br><span class="line"><span class="attr">  - metadata:</span> </span><br><span class="line"><span class="attr">      name:</span> <span class="string">diskpv</span>        <span class="comment"># å·åç§°å…ƒæ•°æ®ä¸ä¸Šè¿›è¡Œå¯¹åº”</span></span><br><span class="line"><span class="attr">    spec:</span> </span><br><span class="line"><span class="attr">      accessModes:</span> <span class="string">[</span> <span class="string">"ReadWriteOnce"</span> <span class="string">]</span>  <span class="comment"># è®¿é—®æ¨¡å¼ ä¸ PV å·çš„å±æ€§ä¸ä¹‹å¯¹åº”</span></span><br><span class="line"><span class="attr">      storageClassName:</span> <span class="string">"nfs"</span>           <span class="comment"># å­˜å‚¨ç±»å ä¸ PV å·çš„å±æ€§ä¸ä¹‹å¯¹åº”</span></span><br><span class="line"><span class="attr">      resources:</span></span><br><span class="line"><span class="attr">        requests:</span></span><br><span class="line"><span class="attr">          storage:</span> <span class="number">1</span><span class="string">Gi</span>                  <span class="comment"># å¤§å°å¯ä»¥è¿›è¡Œè®¾ç½®</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>Step 5.éƒ¨ç½²PVCä¸æŸ¥çœ‹<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1) éƒ¨ç½² Server ä¸ PVC</span></span><br><span class="line">~/K8s/Day8/demo7$ kubectl create -f pvc-demo1.yaml</span><br><span class="line">  <span class="comment"># service/nginx-pvc-demo created</span></span><br><span class="line">  <span class="comment"># statefulset.apps/web-pvc-demo created</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2) æŸ¥çœ‹Service Headless</span></span><br><span class="line">~/K8s/Day8/demo7$ kubectl get svc -o wide --show-labels | grep <span class="string">"nginx-pvc-demo"</span> <span class="comment"># æ— å¤´æœåŠ¡</span></span><br><span class="line">  <span class="comment"># NAME             TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE   SELECTOR    LABELS</span></span><br><span class="line">  <span class="comment"># nginx-pvc-demo   ClusterIP   None         &lt;none&gt;        80/TCP    84s   app=nginx   app=nginx</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3) æŸ¥çœ‹statefulset ä¸ Pod</span></span><br><span class="line">~/K8s/Day8/demo7$ kubectl get statefulset -o wide  <span class="comment"># statefulsetæ§åˆ¶å™¨æŸ¥çœ‹</span></span><br><span class="line">  <span class="comment"># NAME           READY   AGE    CONTAINERS   IMAGES</span></span><br><span class="line">  <span class="comment"># web-pvc-demo   2/3     24m   nginx        harbor.weiyigeek.top/test/nginx:latest</span></span><br><span class="line"></span><br><span class="line">~/K8s/Day8/demo7$ kubectl get pod -o wide</span><br><span class="line">  <span class="comment"># NAME             READY   STATUS    RESTARTS   AGE     IP             NODE         NOMINATED NODE   READINESS GATES</span></span><br><span class="line">  <span class="comment"># web-pvc-demo-0   1/1     Running   0          27m     10.244.2.15    k8s-node-5   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># web-pvc-demo-1   1/1     Running   0          8m45s   10.244.1.140   k8s-node-4   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># web-pvc-demo-2   0/1     Pending   0          2m11s   &lt;none&gt;         &lt;none&gt;       &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"><span class="comment"># PS : web-pvc-demo-2  æœªæˆåŠŸå¯åŠ¨å¾—åŸå› æ˜¯ç”±äºæ²¡å¾—æŒä¹…å·ç»™Pod3ä½¿ç”¨</span></span><br><span class="line"><span class="comment"># Events:</span></span><br><span class="line"><span class="comment">#   Type     Reason            Age    From               Message</span></span><br><span class="line"><span class="comment">#   ----     ------            ----   ----               -------</span></span><br><span class="line"><span class="comment">#   Warning  FailedScheduling  2m25s  default-scheduler  0/3 nodes are available: 3 pod has unbound immediate PersistentVolumeClaims.</span></span><br><span class="line"><span class="comment">#   Warning  FailedScheduling  2m25s  default-scheduler  0/3 nodes are available: 3 pod has unbound immediate PersistentVolumeClaims.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4) åˆ›å»ºä¸€ä¸ªç»™web-pvc-demo-2ä½¿ç”¨å¾—å­˜å‚¨å·</span></span><br><span class="line">cat &gt; web-pvc-demo-2.yaml&lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">apiVersion: v1 </span><br><span class="line">kind: PersistentVolume </span><br><span class="line">metadata:</span><br><span class="line">  name: pv-test-3</span><br><span class="line">spec:</span><br><span class="line">  capacity:             <span class="comment">#å®¹é‡</span></span><br><span class="line">    storage: 1Gi </span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteOnce </span><br><span class="line">  persistentVolumeReclaimPolicy: Delete</span><br><span class="line">  storageClassName: nfs    <span class="comment"># éå¸¸é‡è¦</span></span><br><span class="line">  nfs:</span><br><span class="line">   path: /nfs/data3</span><br><span class="line">   server: 10.10.107.202</span><br><span class="line">EOF</span><br><span class="line">~/K8s/Day8/demo7$ kubectl create -f web-pvc-demo-2.yaml</span><br><span class="line"><span class="comment"># persistentvolume/pv-test-3 created</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) åˆ›å»ºå®Œæˆåå¯ä»¥çœ‹è§æ‰€æœ‰å·éƒ½å·²ç»ok</span></span><br><span class="line">~/K8s/Day8/demo7$ kubectl get pvc -o wide <span class="comment"># PVC ç»‘å®šçš„PV æŸ¥çœ‹</span></span><br><span class="line">  <span class="comment"># NAME                    STATUS   VOLUME      CAPACITY   ACCESS MODES   STORAGECLASS   AGE   VOLUMEMODE</span></span><br><span class="line">  <span class="comment"># diskpv-web-pvc-demo-0   Bound    pv-test-1   1Gi        RWO            nfs            93m   Filesystem</span></span><br><span class="line">  <span class="comment"># diskpv-web-pvc-demo-1   Bound    pv-test-2   4Gi        RWO            nfs            93m   Filesystem</span></span><br><span class="line">  <span class="comment"># diskpv-web-pvc-demo-2   Bound    pv-test-3   1Gi        RWO            nfs            93m   Filesystem</span></span><br><span class="line"></span><br><span class="line">~/K8s/Day8/demo7$ kubectl get pv -o wide  <span class="comment">#å‘½ä»¤è¡Œä¼šæ˜¾ç¤ºPVçŠ¶æ€ä»¥åŠç»‘å®šåˆ°PVçš„PVCçš„åç§°</span></span><br><span class="line">  <span class="comment"># NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM                           STORAGECLASS   REASON   AGE    VOLUMEMODE</span></span><br><span class="line">  <span class="comment"># pv-test-1   1Gi        RWO            Retain           Bound       default/diskpv-web-pvc-demo-1   nfs                     73m   Filesystem</span></span><br><span class="line">  <span class="comment"># pv-test-2   1Gi        RWO            Retain           Bound       default/diskpv-web-pvc-demo-0   nfs                     73m   Filesystem</span></span><br><span class="line">  <span class="comment"># pv-test-3   1Gi        RWO            Delete           Bound       default/diskpv-web-pvc-demo-2   nfs                     11s   Filesystem</span></span><br><span class="line">  <span class="comment"># pv-test-4   2Gi        ROX            Retain           Available                                   nfs-retain              73m   Filesystem</span></span><br><span class="line">  <span class="comment"># pv-test-5   3Gi        RWX            Delete           Available                                   nfs-delete              73m   Filesystem</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>6.PVCå·ä½¿ç”¨éªŒè¯<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) æŸ¥çœ‹Podå®¹å™¨-&gt;PVC-&gt;PVç»‘å®šçš„ç›®å½•</span></span><br><span class="line">pv-test-1   1Gi        RWO            Retain           Bound       default/diskpv-web-pvc-demo-1   nfs                     73m   Filesystem</span><br><span class="line">pv-test-2   1Gi        RWO            Retain           Bound       default/diskpv-web-pvc-demo-0   nfs                     73m   Filesystem</span><br><span class="line">pv-test-3   1Gi        RWO            Delete           Bound       default/diskpv-web-pvc-demo-2   nfs                     11s   Filesystem</span><br><span class="line">---</span><br><span class="line"><span class="comment"># ä¸‰ä¸ªPodçš„/usr/share/nginx/htmlæŒ‡å‘ä¸åŒçš„å·ä»¥åŠ</span></span><br><span class="line">NAME             IP             NODE       </span><br><span class="line">web-pvc-demo-0   10.244.2.15    k8s-node-5   /nfs/data2</span><br><span class="line">web-pvc-demo-1   10.244.1.140   k8s-node-4   /nfs/data1</span><br><span class="line">web-pvc-demo-2   10.244.2.16    k8s-node-5   /nfs/data3</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) åˆ›å»ºhtmlæ–‡ä»¶(é‡ç‚¹) - æ­¤æ­¥éª¤åœ¨NFSæœåŠ¡å™¨ä¸Šæ‰§è¡Œæ­¤å¤„ç”±äºæˆ‘ä»¬æ˜¯åœ¨masterä¸Šå»ºç«‹çš„</span></span><br><span class="line"><span class="built_in">cd</span> /nfs/data1 &amp;&amp; <span class="built_in">echo</span> <span class="string">"web-pvc-demo-1 - <span class="variable">$(pwd)</span> -- <span class="variable">$(date)</span>"</span> &gt; /nfs/data1/index.html</span><br><span class="line"><span class="built_in">cd</span> /nfs/data2 &amp;&amp; <span class="built_in">echo</span> <span class="string">"web-pvc-demo-0 - <span class="variable">$(pwd)</span> -- <span class="variable">$(date)</span>"</span> &gt; /nfs/data2/index.html</span><br><span class="line"><span class="built_in">cd</span> /nfs/data3 &amp;&amp; <span class="built_in">echo</span> <span class="string">"web-pvc-demo-2 - <span class="variable">$(pwd)</span> -- <span class="variable">$(date)</span>"</span> &gt; /nfs/data3/index.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) è®¿é—® Pod æœåŠ¡æŸ¥çœ‹(ç”±äºæ˜¯æ— å¤´æœåŠ¡æˆ‘ä»¬å¯ä»¥é‡‡ç”¨åŸŸåæ–¹å¼è¿›è¡Œè®¿é—®)</span></span><br><span class="line">/nfs/data2$ curl http://10.244.2.15</span><br><span class="line">  <span class="comment"># web-pvc-demo-0 - /nfs/data2 -- Thu 19 Nov 2020 02:53:47 PM CST</span></span><br><span class="line">/nfs/data1$ curl http://10.244.1.140</span><br><span class="line">  <span class="comment"># web-pvc-demo-1 - /nfs/data1 -- Thu 19 Nov 2020 02:53:47 PM CST</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) é‡‡ç”¨coreDNSåŸŸåè§£ææ–¹å¼çš„è®¿é—®</span></span><br><span class="line">$ kubectl get pod -n kube-system -o wide | grep <span class="string">"coredns"</span></span><br><span class="line">  <span class="comment"># NAME                                  READY   STATUS    RESTARTS   AGE    IP              NODE          NOMINATED NODE   READINESS GATES</span></span><br><span class="line">  <span class="comment"># coredns-6c76c8bb89-8cgjz              1/1     Running   2          13d    10.244.0.7      ubuntu   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># coredns-6c76c8bb89-wgbs9              1/1     Running   2          13d    10.244.0.8      ubuntu   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line">$ cat /etc/resolv.conf</span><br><span class="line"><span class="comment"># nameserver 10.244.0.7</span></span><br><span class="line">$ dig -t A nginx-pvc-demo.default.svc.cluster.local. @10.244.0.8    <span class="comment"># nginx-pvc-demo.default</span></span><br><span class="line"><span class="comment"># ;; ANSWER SECTION:</span></span><br><span class="line"><span class="comment"># nginx-pvc-demo.default.svc.cluster.local. 30 IN A 10.244.1.140</span></span><br><span class="line"><span class="comment"># nginx-pvc-demo.default.svc.cluster.local. 30 IN A 10.244.2.16</span></span><br><span class="line"><span class="comment"># nginx-pvc-demo.default.svc.cluster.local. 30 IN A 10.244.2.15</span></span><br><span class="line">/nfs/data3$ curl http://nginx-pvc-demo.default.svc.cluster.local</span><br><span class="line">  web-pvc-demo-2 - /nfs/data3 -- Thu 19 Nov 2020 02:53:48 PM CST</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li><p>7.PV ä¸ PVC åˆ é™¤ &amp; å›æ”¶ç­–ç•¥æŸ¥çœ‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) statefulSet èµ„æºæ§åˆ¶å™¨åˆ é™¤</span></span><br><span class="line">~/K8s/Day8/demo7$ kubectl delete statefulset --all</span><br><span class="line">  <span class="comment"># statefulset.apps "web-pvc-demo" deleted</span></span><br><span class="line">~/K8s/Day8/demo7$ kubectl get pod -w  <span class="comment"># å…³é”®ç‚¹ï¼šåˆ é™¤æ—¶å€™æ˜¯æœ‰åºçš„</span></span><br><span class="line">  <span class="comment"># NAME             READY   STATUS        RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># web-pvc-demo-0   0/1     Terminating   0          105m</span></span><br><span class="line">  <span class="comment"># web-pvc-demo-1   0/1     Terminating   0          105m</span></span><br><span class="line">  <span class="comment"># web-pvc-demo-2   0/1     Terminating   0          105m</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) åˆ é™¤æŒ‡å®šçš„PVCéªŒè¯PVå…¶Deleteçš„å›æ”¶ç­–ç•¥</span></span><br><span class="line">$ kubectl delete pvc diskpv-web-pvc-demo-2</span><br><span class="line">  <span class="comment"># persistentvolumeclaim "diskpv-web-pvc-demo-2" deleted</span></span><br><span class="line"><span class="comment"># æ­¤æ—¶pv-test-3æ— æ³•è¿›è¡Œdeleteå›æ”¶ (æœªèƒ½è§£å†³åç»­æœ‰èƒ½åŠ›æ—¶å€™è¡¥å……)</span></span><br><span class="line">pv-test-3   1Gi        RWO            Delete           Failed      default/diskpv-web-pvc-demo-2   nfs                     34m</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) åˆ é™¤æ‰€æœ‰çš„PVC</span></span><br><span class="line">$ kubectl delete pvc --all </span><br><span class="line">  <span class="comment"># persistentvolumeclaim "diskpv-web-pvc-demo-0" deleted</span></span><br><span class="line">  <span class="comment"># persistentvolumeclaim "diskpv-web-pvc-demo-1" deleted</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) æ‰‹åŠ¨å›æ”¶PVå·</span></span><br><span class="line">$ kubectl get pv   <span class="comment"># æŸ¥çœ‹åˆ°PVçš„STATUSä»¥åŠCLAIMå¹¶æœªéšç€PVCåˆ é™¤è€Œå˜åŒ–æ­¤æ—¶éœ€è¦è¿›è¡Œæ‰‹åŠ¨å›æ”¶</span></span><br><span class="line">  <span class="comment"># NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM                           STORAGECLASS   REASON   AGE</span></span><br><span class="line">  <span class="comment"># pv-test-1   1Gi        RWO            Retain           Released    default/diskpv-web-pvc-demo-1   nfs                     116m</span></span><br><span class="line">  <span class="comment"># pv-test-2   1Gi        RWO            Retain           Released    default/diskpv-web-pvc-demo-0   nfs                     116m</span></span><br><span class="line">  <span class="comment"># pv-test-3   1Gi        RWO            Delete           Failed      default/diskpv-web-pvc-demo-2   nfs                     42m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) åˆ é™¤æˆ–è€…nfså…±äº«ç›®å½•ä¸­çš„æ•°æ®ç„¶åç¼–è¾‘pvåˆ é™¤å¦‚ä¸‹ç‰‡æ®µ</span></span><br><span class="line">~/K8s/Day8/demo7$ kubectl edit pv pv-test-1</span><br><span class="line"><span class="comment"># åˆ é™¤ yaml ä¸­claimRefå¯¹è±¡key-value</span></span><br><span class="line"><span class="comment"># ---</span></span><br><span class="line"><span class="comment"># claimRef:</span></span><br><span class="line"><span class="comment">#   apiVersion: v1</span></span><br><span class="line"><span class="comment">#   kind: PersistentVolumeClaim</span></span><br><span class="line"><span class="comment">#   name: diskpv-web-pvc-demo-0</span></span><br><span class="line"><span class="comment">#   namespace: default</span></span><br><span class="line"><span class="comment">#   resourceVersion: "2830220"</span></span><br><span class="line"><span class="comment">#   uid: 02359666-0fcb-4529-8a28-a2fb1dd18008</span></span><br><span class="line"><span class="comment"># ---</span></span><br><span class="line">  <span class="comment"># persistentvolume/pv-test-1 edited</span></span><br><span class="line">$ kubectl edit pv pv-test-2</span><br><span class="line">  <span class="comment"># persistentvolume/pv-test-2 edited</span></span><br><span class="line">$ kubectl edit pv pv-test-3</span><br><span class="line">  <span class="comment"># persistentvolume/pv-test-3 edited</span></span><br><span class="line">$ kubectl get pv   <span class="comment"># ç„¶åæ‚¨å°†å‘ç°PVä¸€åˆ‡åˆæ¢å¤åˆ°æ­£å¸¸çš„å¯ç”¨çŠ¶æ€</span></span><br><span class="line">  <span class="comment"># NAME        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE</span></span><br><span class="line">  <span class="comment"># pv-test-1   1Gi        RWO            Retain           Available           nfs                     119m</span></span><br><span class="line">  <span class="comment"># pv-test-2   1Gi        RWO            Retain           Available           nfs                     119m</span></span><br><span class="line">  <span class="comment"># pv-test-3   1Gi        RWO            Delete           Available           nfs                     46m</span></span><br><span class="line">  <span class="comment"># pv-test-4   2Gi        ROX            Retain           Available           nfs-retain              119m</span></span><br><span class="line">  <span class="comment"># pv-test-5   3Gi        RWX            Delete           Available           nfs-delete              119m</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (6) åˆ é™¤æŒ‡å®šçš„ PV </span></span><br><span class="line">~/K8s/Day8/demo7$ kubectl delete pv pv-test-3</span><br><span class="line"><span class="comment"># persistentvolume "pv-test-3" deleted</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Step 8.è‡³æ­¤æŒä¹…åŒ–æ•°æ®å·æ¼”ç¤ºç»“æŸ;</p>
</li>
</ul>
<p><br></p>
<h3 id="5-StorageClass-åŠ¨æ€åˆ†é…æŒä¹…å·"><a href="#5-StorageClass-åŠ¨æ€åˆ†é…æŒä¹…å·" class="headerlink" title="5.StorageClass - åŠ¨æ€åˆ†é…æŒä¹…å·"></a>5.StorageClass - åŠ¨æ€åˆ†é…æŒä¹…å·</h3><p>æè¿°: StorageClass è¢«ç”¨äºæè¿°å­˜å‚¨åˆ†ç±»(å­˜å‚¨ç±»)ï¼Œä¸åŒçš„<code>StorageClass</code>ä¼šè¢«å…³ç³»çš„æœåŠ¡è´¨é‡å±‚é¢æˆ–è€…å¤‡ä»½ç­–ç•¥;</p>
<h4 id="åŸºç¡€æ¦‚å¿µ-1"><a href="#åŸºç¡€æ¦‚å¿µ-1" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h4><p>æè¿°: å‰é¢æˆ‘ä»¬è¯´è¿‡ <code>Persistent Volume</code> ç®€ç§°PVæ˜¯ä¸€ä¸ªK8Sèµ„æºå¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å•ç‹¬åˆ›å»ºä¸€ä¸ªPVã€‚å®ƒä¸å’ŒPodç›´æ¥å‘ç”Ÿå…³ç³»ï¼Œè€Œæ˜¯é€šè¿‡ <code>Persistent Volume Claim</code>ï¼Œç®€ç§°PVCæ¥å®ç°åŠ¨æ€ç»‘å®šã€‚Podå®šä¹‰é‡ŒæŒ‡å®šçš„PVCç»‘å®šå…³é”®å­—ï¼Œç„¶åPVCä¼šæ ¹æ®Podçš„è¦æ±‚å»è‡ªåŠ¨<code>ç»‘å®šåˆé€‚çš„PVç»™Podä½¿ç”¨</code>ã€‚</p>
<p>Tips : æ¯”å¦‚ä¸€ä¸ªé…ç½®äº†è®¸å¤š 50Gi PV çš„é›†ç¾¤ä¸ä¼šåŒ¹é…åˆ°ä¸€ä¸ªè¦æ±‚ 100Gi çš„PVCã€‚åªæœ‰åœ¨ 100Gi PVè¢«åŠ åˆ°é›†ç¾¤ä¹‹åï¼Œè¯¥PVCæ‰å¯ä»¥è¢«ç»‘å®šã€‚</p>
<p><br/></p>
<p><strong>Q: ä»€ä¹ˆæ˜¯ storageClass?</strong></p>
<blockquote>
<p>ç­”: å‰é¢æˆ‘ä»¬è¯´è¿‡åˆ›å»ºPVæœ‰é™æ€(<code>å³æ‰‹åŠ¨åˆ›å»ºä¸€å †PVç»„æˆä¸€ä¸ªPVæ± ï¼Œä¾›PVCæ¥ç»‘å®š</code>)å’ŒåŠ¨æ€ä¸¤ç§æ–¹å¼, è€ŒåŠ¨æ€æ˜¯æŒ‡åœ¨ç°æœ‰PVä¸æ»¡è¶³PVCçš„è¯·æ±‚æ—¶ï¼Œå³é€šè¿‡ä¸€ä¸ªå«<code>StorageClass(å­˜å‚¨ç±»)</code>çš„å¯¹è±¡ç”±å­˜å‚¨ç³»ç»Ÿæ ¹æ®PVCçš„è¦æ±‚è‡ªåŠ¨åˆ›å»ºæ¥å®Œæˆçš„ã€‚åŠ¨æ€å·ä¾›ç»™èƒ½åŠ›è®©ç®¡ç†å‘˜ä¸å¿…è¿›è¡Œé¢„å…ˆåˆ›å»ºå­˜å‚¨å·ï¼Œè€Œæ˜¯éšç”¨æˆ·éœ€æ±‚è¿›è¡Œåˆ›å»ºã€‚<br>æ‰€ä»¥è¯´ storageclass æ˜¯ä¸€ä¸ªå­˜å‚¨ç±»ï¼Œk8sé›†ç¾¤ç®¡ç†å‘˜é€šè¿‡åˆ›å»º<code>storageclass</code>å¯ä»¥<code>åŠ¨æ€ç”Ÿæˆä¸€ä¸ªå­˜å‚¨å·</code>ä¾›k8sç”¨æˆ·ä½¿ç”¨ã€‚è¿™æ˜¯ä¸€ç§æ–°çš„å­˜å‚¨ä¾›åº”æ–¹å¼ã€‚</p>
</blockquote>
<p><br/></p>
<p><strong>Q: ä½¿ç”¨StorageClassæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ</strong></p>
<blockquote>
<p>ç­”: é™¤äº†ç”±å­˜å‚¨ç³»ç»ŸåŠ¨æ€åˆ›å»ºï¼ŒèŠ‚çœäº†ç®¡ç†å‘˜çš„æ—¶é—´ï¼Œè¿˜æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä»¥<code>å°è£…ä¸åŒç±»å‹çš„å­˜å‚¨ä¾›PVCé€‰ç”¨</code>ã€‚åœ¨StorageClasså‡ºç°ä»¥å‰ï¼ŒPVCç»‘å®šä¸€ä¸ªPVåªèƒ½æ ¹æ®ä¸¤ä¸ªæ¡ä»¶ï¼Œ<code>ä¸€ä¸ªæ˜¯å­˜å‚¨çš„å¤§å°ï¼Œå¦ä¸€ä¸ªæ˜¯è®¿é—®æ¨¡å¼</code>ã€‚åœ¨StorageClasså‡ºç°åï¼Œç­‰äºå¢åŠ äº†ä¸€ä¸ªç»‘å®šç»´åº¦å³<code>StorageClassName</code>å‚æ•°ã€‚</p>
</blockquote>
<p><br/></p>
<h4 id="èµ„æºå®šä¹‰"><a href="#èµ„æºå®šä¹‰" class="headerlink" title="èµ„æºå®šä¹‰"></a>èµ„æºå®šä¹‰</h4><p><strong>Q: ä»€ä¹ˆæ˜¯ storageClass çš„èµ„æºå®šä¹‰?</strong></p>
<blockquote>
<p>ç­”: æ¯ä¸€ä¸ªStorageClasséƒ½åŒ…å«äº†<code>Provisionerã€Parametersã€ReclaimPolicy</code>ç­‰å‡ ä¸ªå­—æ®µï¼Œå½“éœ€è¦åŠ¨æ€é…ç½®å±äºè¯¥ç±»çš„<code>PersistentVolume</code>æ—¶ä½¿ç”¨è¿™äº›å­—æ®µã€‚<br>æè¿°å…·ä½“è¿‡ç¨‹ä¸º: PVå…ˆåˆ›å»ºåˆ†ç±»ï¼ŒPVCè¯·æ±‚ç»‘å®šæŸä¸ªå·²åˆ›å»ºçš„ç±»<code>(StorageClass)</code>çš„èµ„æºï¼ŒåŒæ—¶ç”± <code>Controlleræ§åˆ¶å™¨</code> åˆ›å»ºçš„èµ„æºç»‘å®šåˆ°PVCä¹‹ä¸­,è¿™æ ·å°±è¾¾åˆ°åŠ¨æ€é…ç½®çš„æ•ˆæœã€‚</p>
</blockquote>
<p>Tips : StorageClasså¯¹è±¡çš„åç§°å¾ˆé‡è¦ï¼Œæ˜¯ç”¨æˆ·å¯ä»¥è¯·æ±‚ç‰¹å®šç±»çš„æ–¹å¼ã€‚ç®¡ç†å‘˜åœ¨é¦–æ¬¡åˆ›å»º<code>StorageClass</code>å¯¹è±¡æ—¶è®¾ç½®ç±»çš„åç§°å’Œå…¶ä»–å‚æ•°ï¼Œ<code>æ³¨æ„åœ¨åˆ›å»ºå¯¹è±¡åæ— æ³•æ›´æ–°è¿™äº›å¯¹è±¡</code>ã€‚</p>
<p>Tips : ç®¡ç†å‘˜å¯ä»¥ä¸ºä¸è¯·æ±‚ä»»ä½•ç‰¹å®šç±»ç»‘å®šçš„PVCæŒ‡å®šé»˜è®¤çš„<code>StorageClass</code>;</p>
<p>yamlæ–‡ä»¶ç¤ºä¾‹è¯´æ˜:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">standard</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">kubernetes.io/aws-ebs</span></span><br><span class="line"><span class="attr">parameters:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">gp2</span></span><br><span class="line"><span class="attr">reclaimPolicy:</span> <span class="string">Retain</span></span><br><span class="line"><span class="attr">mountOptions:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">debug</span></span><br><span class="line"><span class="attr">volumeBindingMode:</span> <span class="string">Immediate</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h5 id="Provisoner-ä¾›åº”å•†"><a href="#Provisoner-ä¾›åº”å•†" class="headerlink" title="Provisoner - ä¾›åº”å•†"></a>Provisoner - ä¾›åº”å•†</h5><p><strong>Q: ä»€ä¹ˆæ˜¯ä¾›åº”å•† (Provisoner)?</strong><br>æè¿°: storageclasséœ€è¦æœ‰ä¸€ä¸ªä¾›åº”è€…ï¼Œç”¨æ¥ç¡®å®šæˆ‘ä»¬ä½¿ç”¨ä»€ä¹ˆæ ·çš„å­˜å‚¨æ–¹å¼æ¥åˆ›å»ºpv;</p>
<p>Tips : provisioner ä¾›åº”è€…å®ƒæ—¢å¯ä»¥æ˜¯å†…éƒ¨ä¾›åº”ç¨‹åºï¼Œä¹Ÿå¯ä»¥ç”±å¤–éƒ¨ä¾›åº”å•†æä¾›; å¦‚æœæ˜¯å¤–éƒ¨ä¾›åº”å•†å¯ä»¥å‚è€ƒ <a href="https://github.com/kubernetes-incubator/external-storage/" target="_blank" rel="noopener">https://github.com/kubernetes-incubator/external-storage/</a> ä¸‹æä¾›çš„æ–¹æ³•åˆ›å»ºstorageclassçš„provisioner;</p>
<p>ä¾‹å¦‚ï¼ŒNFSä¸æä¾›å†…éƒ¨é…ç½®ç¨‹åºï¼Œä½†å¯ä»¥ä½¿ç”¨å¤–éƒ¨é…ç½®ç¨‹åºã€‚</p>
<p>å¸¸è§çš„provisionerä¾›åº”è€…åˆ—è¡¨:</p>
<figure class="image-box">
                <a rel=7-Kuberneteså…¥é—¨åŸºç¡€ä¹‹å­˜å‚¨Volumeä»‹ç» href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210220140128.png" target="_blank" title="WeiyiGeek.provisioner" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210220140128.png" alt="WeiyiGeek.provisioner" title="" class=""></a>
                <p>WeiyiGeek.provisioner</p>
            </figure>
<p>Tips : nfs çš„ provisioner éƒ¨ç½²èµ„æºæ¸…å•æ–‡ä»¶ç¤ºä¾‹ <a href="https://github.com/kubernetes-incubator/external-storage/tree/master/nfs/deploy/kubernetes" target="_blank" rel="noopener">https://github.com/kubernetes-incubator/external-storage/tree/master/nfs/deploy/kubernetes</a></p>
<p>ã€2022å¹´6æœˆ15æ—¥ 20:27:10ã€‘è¡¥å……: æ³¨æ„ nfs-client-provisioner å·²ç»ä¸åœ¨æ›´æ–°ç»´æŠ¤å»ºè®®ä½¿ç”¨ nfs-subdir-external-provisioner (<a href="https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner" target="_blank" rel="noopener">https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner</a>)</p>
<p><br/></p>
<h5 id="Parameters-å‚æ•°"><a href="#Parameters-å‚æ•°" class="headerlink" title="Parameters - å‚æ•°"></a>Parameters - å‚æ•°</h5><p>æè¿°: å…¶åŠŸèƒ½ä¸æ ‡ç­¾ç±»ä¼¼ï¼Œä½†å…¶æ˜¯ä¸ºäº†ç»™å¤–éƒ¨æ’ä»¶æä¾›æŸäº›è‡ªå®šä¹‰å‚æ•°;</p>
<p><br/></p>
<h5 id="Reclaim-Policy-å›æ”¶ç­–ç•¥"><a href="#Reclaim-Policy-å›æ”¶ç­–ç•¥" class="headerlink" title="Reclaim Policy - å›æ”¶ç­–ç•¥"></a>Reclaim Policy - å›æ”¶ç­–ç•¥</h5><p>æè¿°: ç”±ä¸€ä¸ªå­˜å‚¨ç±»åŠ¨æ€åˆ›å»ºæŒä¹…åŒ–å·(<code>Persistent Volumes</code>-PV), å¯ä»¥é€šè¿‡ReclaimPolicyæŒ‡å®šå›æ”¶ç­–ç•¥è€Œè¯¥ç­–ç•¥å¯ä»¥æ˜¯åˆ é™¤<code>Delete(é»˜è®¤)</code>æˆ–è€…<code>ä¿æŒRetain</code>;</p>
<p><br/></p>
<h5 id="Mount-Options-æŒ‚è½½é€‰é¡¹"><a href="#Mount-Options-æŒ‚è½½é€‰é¡¹" class="headerlink" title="Mount Options - æŒ‚è½½é€‰é¡¹"></a>Mount Options - æŒ‚è½½é€‰é¡¹</h5><p>æè¿°: å¦‚æœ<code>Volume Plugin</code>ä¸æ”¯æŒè¿™ä¸ªæŒ‚è½½é€‰é¡¹ï¼Œä½†æ˜¯æŒ‡å®šäº†å°±ä¼šä½¿<code>provisioner</code>åˆ›å»ºStorageClasså¤±è´¥</p>
<p><br/></p>
<h5 id="Volume-Binding-Mode-å·ç»‘å®šæ¨¡å¼"><a href="#Volume-Binding-Mode-å·ç»‘å®šæ¨¡å¼" class="headerlink" title="Volume Binding Mode - å·ç»‘å®šæ¨¡å¼"></a>Volume Binding Mode - å·ç»‘å®šæ¨¡å¼</h5><p>æè¿°: è¯¥å­—æ®µç”¨æ¥è¯´æ˜ä»€ä¹ˆæ—¶å€™è¿›è¡Œå·ç»‘å®šå’ŒåŠ¨æ€é…ç½®ï¼Œé»˜è®¤æƒ…å†µä¸‹ç«‹å³æ¨¡å¼è¡¨ç¤ºä¸€æ—¦åˆ›å»ºäº†<code>PersistentVolumeClaim</code>ï¼Œå°±ä¼šå‘ç”Ÿå·ç»‘å®šå’ŒåŠ¨æ€é…ç½®ã€‚<br>å¯¹äºå—æ‹“æ‰‘çº¦æŸä¸”æ— æ³•ä»ç¾¤é›†ä¸­çš„<code>æ‰€æœ‰èŠ‚ç‚¹å…¨å±€è®¿é—®çš„å­˜å‚¨åç«¯</code>ï¼Œå°†åœ¨ä¸çŸ¥é“Podçš„è°ƒåº¦è¦æ±‚çš„æƒ…å†µä¸‹ç»‘å®šæˆ–é…ç½®PersistentVolumes, è¿™å¯èƒ½å¯¼è‡´ä¸å¯è°ƒåº¦çš„Podã€‚</p>
<p>é›†ç¾¤ç®¡ç†å‘˜å¯ä»¥é€šè¿‡æŒ‡å®š<code>WaitForFirstConsumer</code>æ¨¡å¼æ¥è§£å†³æ­¤é—®é¢˜ï¼Œè¯¥æ¨¡å¼å°†å»¶è¿Ÿç»‘å®šå’Œé…ç½®<code>PersistentVolume</code>ï¼Œç›´åˆ°åˆ›å»ºä½¿ç”¨PersistentVolumeClaimçš„Podã€‚å°†æ ¹æ®Podçš„è°ƒåº¦çº¦æŸæŒ‡å®šçš„æ‹“æ‰‘é€‰æ‹©æˆ–é…ç½®PersistentVolumesã€‚è¿™äº›åŒ…æ‹¬ä½†ä¸é™äº<code>èµ„æºéœ€æ±‚ï¼ŒèŠ‚ç‚¹é€‰æ‹©å™¨ï¼Œpodäº²å’ŒåŠ›å’Œåäº²å’ŒåŠ›ï¼Œä»¥åŠæ±¡ç‚¹å’Œå®¹å¿åº¦</code>ã€‚</p>
<p><br></p>
<h4 id="åŸºç¡€å®ä¾‹"><a href="#åŸºç¡€å®ä¾‹" class="headerlink" title="åŸºç¡€å®ä¾‹"></a>åŸºç¡€å®ä¾‹</h4><h5 id="ç¯å¢ƒæ„å»ºæµç¨‹"><a href="#ç¯å¢ƒæ„å»ºæµç¨‹" class="headerlink" title="ç¯å¢ƒæ„å»ºæµç¨‹"></a>ç¯å¢ƒæ„å»ºæµç¨‹</h5><ul>
<li>Step 1.è®¾ç½®æŸ¥çœ‹å½“NFSç›®å½•ä»¥åŠå®šä¹‰nfsé©±åŠ¨è¿›è¡Œç¼–æ’ä»¥ä¸‹æ˜¯<code>nfs-client-provisioner</code>éƒ¨ç½²æ–‡ä»¶;<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) å½“å‰ NFS å…±äº«ç›®å½•</span></span><br><span class="line"><span class="string">showmount</span> <span class="bullet">-e</span></span><br><span class="line">  <span class="comment"># /nfs/data4 *</span></span><br><span class="line">  <span class="comment"># /nfs/data3 *</span></span><br><span class="line">  <span class="comment"># /nfs/data2 *</span></span><br><span class="line">  <span class="comment"># /nfs/data1 *</span></span><br><span class="line">  <span class="comment"># /nfs/data  *  # ä¸‹é¢æ¡ˆä¾‹å°†ä½¿ç”¨è¯¥ç›®å½•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) NFS é©±åŠ¨ç¼–æ’çš„èµ„æºæ¸…å•</span></span><br><span class="line"><span class="string">cat</span> <span class="string">&gt; nfs-client-provisioner.yaml  &lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line"><span class="attr">  strategy:</span>          <span class="comment"># ç­–ç•¥</span></span><br><span class="line"><span class="attr">    type:</span> <span class="string">Recreate</span>   <span class="comment"># å†ç”Ÿ(å¾ªç¯ä½¿ç”¨)</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      serviceAccountName:</span> <span class="string">nfs-client-provisioner</span>   <span class="comment"># æœåŠ¡å¸æˆ·åç§°</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/open-ali/nfs-client-provisioner</span> </span><br><span class="line"><span class="attr">        volumeMounts:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">timezone</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/localtime</span>                <span class="comment"># æ—¶åŒºè®¾ç½®</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">nfs-client-root</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/persistentvolumes</span></span><br><span class="line"><span class="attr">        env:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">PROVISIONER_NAME</span>                   <span class="comment"># StorageClass å¯¹è±¡ä¸­å®šä¹‰çš„ provisioner é”®éœ€è¦ä¿æŒä¸€è‡´</span></span><br><span class="line"><span class="attr">          value:</span> <span class="string">fuseim.pri/ifs</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">NFS_SERVER</span></span><br><span class="line"><span class="attr">          value:</span> <span class="number">10.10</span><span class="number">.107</span><span class="number">.202</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">NFS_PATH</span></span><br><span class="line"><span class="attr">          value:</span> <span class="string">/nfs/data</span></span><br><span class="line"><span class="attr">      volumes:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">timezone</span>                            <span class="comment"># æ—¶åŒºå®šä¹‰</span></span><br><span class="line"><span class="attr">        hostPath:</span></span><br><span class="line"><span class="attr">          path:</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai</span>   </span><br><span class="line"><span class="attr">      - name:</span> <span class="string">nfs-client-root</span>                     <span class="comment"># å­˜å‚¨å·</span></span><br><span class="line"><span class="attr">        nfs:</span></span><br><span class="line"><span class="attr">          server:</span> <span class="number">10.10</span><span class="number">.107</span><span class="number">.202</span></span><br><span class="line"><span class="attr">          path:</span> <span class="string">/nfs/data</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>Step 2.Storageclass éƒ¨ç½²æ–‡ä»¶<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; nfs-client-storageclass.yaml &lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">managed-nfs-storage</span>    <span class="comment"># é‡è¦ StorageClass Nameç»‘å®š</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="string">storageclass.kubernetes.io/is-default-class:</span> <span class="string">"true"</span>   <span class="comment">#è®¾ç½®å…¶ä¸ºé»˜è®¤å­˜å‚¨åç«¯</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">fuseim.pri/ifs</span>   <span class="comment"># æˆ–é€‰æ‹©å¦ä¸€ä¸ªåç§°ï¼Œå¿…é¡»ä¸NFS é©±åŠ¨ç¼–æ’åŒ¹é…éƒ¨ç½²çš„ env PROVISIONER_NAME</span></span><br><span class="line"><span class="attr">parameters:</span></span><br><span class="line"><span class="attr">  archiveOnDelete:</span> <span class="string">"false"</span>    <span class="comment"># åˆ é™¤pvcåï¼Œåç«¯å­˜å‚¨ä¸Šçš„pvä¹Ÿè‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>Step 3.rbacæˆæƒæ–‡ä»¶<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; nfs-client-rbac.yaml&lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nfs-client-provisioner-runner</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">[""]</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["persistentvolumes"]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["get",</span> <span class="string">"list"</span><span class="string">,</span> <span class="string">"watch"</span><span class="string">,</span> <span class="string">"create"</span><span class="string">,</span> <span class="string">"delete"</span><span class="string">]</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">[""]</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["persistentvolumeclaims"]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["get",</span> <span class="string">"list"</span><span class="string">,</span> <span class="string">"watch"</span><span class="string">,</span> <span class="string">"update"</span><span class="string">]</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">["storage.k8s.io"]</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["storageclasses"]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["get",</span> <span class="string">"list"</span><span class="string">,</span> <span class="string">"watch"</span><span class="string">]</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">[""]</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["events"]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["create",</span> <span class="string">"update"</span><span class="string">,</span> <span class="string">"patch"</span><span class="string">]</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">[""]</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["services",</span> <span class="string">"endpoints"</span><span class="string">]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["get"]</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">["extensions"]</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["podsecuritypolicies"]</span></span><br><span class="line"><span class="attr">  resourceNames:</span> <span class="string">["nfs-provisioner"]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["use"]</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">run-nfs-client-provisioner</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="attr">- kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line"><span class="attr">- kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nfs-client-provisioner-runner</span></span><br><span class="line"><span class="attr">  apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">leader-locking-nfs-client-provisioner</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">[""]</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["endpoints"]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["get",</span> <span class="string">"list"</span><span class="string">,</span> <span class="string">"watch"</span><span class="string">,</span> <span class="string">"create"</span><span class="string">,</span> <span class="string">"update"</span><span class="string">,</span> <span class="string">"patch"</span><span class="string">]</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">leader-locking-nfs-client-provisioner</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="attr">- kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line"><span class="attr">  kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">leader-locking-nfs-client-provisioner</span></span><br><span class="line"><span class="attr">  apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>Step 4.å‡†å¤‡å¥½ä»¥ä¸Šä¸‰ä¸ªæ–‡ä»¶åï¼Œä½¿ç”¨kubectl applyå‘½ä»¤åº”ç”¨å³å¯å®Œæˆnfs-client-provisionerçš„éƒ¨ç½²ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) éƒ¨ç½²</span></span><br><span class="line">/nfs/data~/K8s/Day7/demo3$ ls</span><br><span class="line">  <span class="comment"># nfs-client-provisioner.yaml  nfs-client-rbac.yaml  nfs-client-storageclass.yaml</span></span><br><span class="line">/nfs/data~/K8s/Day7/demo3$ kubectl create -f .</span><br><span class="line">  <span class="comment"># deployment.apps/nfs-client-provisioner created   ã€å‰æ’ã€‘</span></span><br><span class="line">  <span class="comment"># serviceaccount/nfs-client-provisioner created    ã€æƒé™ç»‘å®šã€‘</span></span><br><span class="line">  <span class="comment"># clusterrole.rbac.authorization.k8s.io/nfs-client-provisioner-runner created</span></span><br><span class="line">  <span class="comment"># clusterrolebinding.rbac.authorization.k8s.io/run-nfs-client-provisioner created</span></span><br><span class="line">  <span class="comment"># role.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner created</span></span><br><span class="line">  <span class="comment"># rolebinding.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner created</span></span><br><span class="line">  <span class="comment"># storageclass.storage.k8s.io/managed-nfs-storage created  ã€å­˜å‚¨ç±»åˆ›å»ºã€‘</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æŸ¥çœ‹podã€Deploymentè¿è¡ŒçŠ¶æ€å’Œsc</span></span><br><span class="line">~/K8s/Day7/demo3$ kubectl get pod,deployment,sc -o wide</span><br><span class="line">  <span class="comment"># NAME                                          READY   STATUS    RESTARTS   AGE   IP             NODE         NOMINATED NODE   READINESS GATES</span></span><br><span class="line">  <span class="comment"># pod/nfs-client-provisioner-58b5dc958d-5fwl9   1/1     Running   0          9m    10.244.1.172   k8s-node-4   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># NAME                                     READY   UP-TO-DATE   AVAILABLE   AGE    CONTAINERS               IMAGES                                                              SELECTOR</span></span><br><span class="line">  <span class="comment"># deployment.apps/nfs-client-provisioner   1/1     1            1           9m1s   nfs-client-provisioner   registry.cn-hangzhou.aliyuncs.com/open-ali/nfs-client-provisioner   app=nfs-client-provisioner</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># NAME                                                        PROVISIONER      RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span></span><br><span class="line">  <span class="comment"># storageclass.storage.k8s.io/managed-nfs-storage (default)   fuseim.pri/ifs   Delete          Immediate           false                  9m1s</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<h5 id="åŠ¨æ€å­˜å‚¨ç±»éªŒè¯"><a href="#åŠ¨æ€å­˜å‚¨ç±»éªŒè¯" class="headerlink" title="åŠ¨æ€å­˜å‚¨ç±»éªŒè¯"></a>åŠ¨æ€å­˜å‚¨ç±»éªŒè¯</h5><ul>
<li>Step 5.åˆ›å»ºçš„ nfs-client-provisioner(StorageClassåŠ¨æ€å­˜å‚¨å·)å·²ç»æ­£å¸¸è¿è¡Œ, æˆ‘ä»¬ç°åœ¨éƒ¨ç½²å‡ ä¸ªPVCæ¥æµ‹è¯•éªŒè¯</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; logstash-pvc.yaml&lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">log-01-pvc</span></span><br><span class="line"><span class="attr">  annotations:</span>   <span class="comment"># ç©ºé—´æ ‡æ³¨</span></span><br><span class="line">    <span class="string">volume.beta.kubernetes.io/storage-class:</span> <span class="string">"managed-nfs-storage"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  accessModes:</span> <span class="string">["ReadWriteMany"]</span></span><br><span class="line"><span class="attr">  resources:</span></span><br><span class="line"><span class="attr">    requests:</span></span><br><span class="line"><span class="attr">      storage:</span> <span class="number">1</span><span class="string">Gi</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">log-02-pvc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  accessModes:</span> <span class="string">["ReadWriteMany"]</span>   <span class="comment"># æ³¨æ„ç”±äºè®¾ç½®é»˜è®¤çš„å­˜å‚¨æ­¤æ¬¡ä¸åŠ æ³¨è§£ä¹Ÿæ˜¯ä½¿ç”¨çš„ managed-nfs-storage StorageClass èµ„æº</span></span><br><span class="line"><span class="attr">  resources:</span></span><br><span class="line"><span class="attr">    requests:</span></span><br><span class="line"><span class="attr">      storage:</span> <span class="number">1</span><span class="string">Gi</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<p>éƒ¨ç½²ä¸æŸ¥çœ‹PVCæŒä¹…å·<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~/K8s/Day7/demo3$ kubectl create -f logstash-pvc.yaml</span><br><span class="line">  <span class="comment"># persistentvolumeclaim/log-01-pvc created</span></span><br><span class="line">  <span class="comment"># persistentvolumeclaim/log-02-pvc created</span></span><br><span class="line"></span><br><span class="line">~/K8s/Day7/demo3$ kubectl get pv,pvc -o wide</span><br><span class="line">  <span class="comment"># NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                STORAGECLASS          REASON   AGE    VOLUMEMODE</span></span><br><span class="line">  <span class="comment"># persistentvolume/pvc-e76d332e-52bf-470a-a362-48742c03ab5f   1Gi        RWX            Delete           Bound    default/log-02-pvc   managed-nfs-storage            4m5s   Filesystem</span></span><br><span class="line">  <span class="comment"># persistentvolume/pvc-f003301b-d22b-4a9f-beb3-b6fe81a6398b   1Gi        RWX            Delete           Bound    default/log-01-pvc   managed-nfs-storage            4m6s   Filesystem</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># NAME                               STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS          AGE    VOLUMEMODE</span></span><br><span class="line">  <span class="comment"># persistentvolumeclaim/log-01-pvc   Bound    pvc-f003301b-d22b-4a9f-beb3-b6fe81a6398b   1Gi        RWX            managed-nfs-storage   4m6s   Filesystem</span></span><br><span class="line">  <span class="comment"># persistentvolumeclaim/log-02-pvc   Bound    pvc-e76d332e-52bf-470a-a362-48742c03ab5f   1Gi        RWX            managed-nfs-storage   4m6s   Filesystem</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<ul>
<li>Step 6.pvcå·²ç»åˆ›å»ºæˆåŠŸï¼Œå¹¶è‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ªå…³è”çš„pvèµ„æºå¯¹è±¡ï¼Œæˆ‘ä»¬å†æŸ¥çœ‹åç«¯å­˜å‚¨ç›®å½•é‡Œé¢æ˜¯å¦ç”Ÿæˆäº†å¯¹åº”å‘½åæ ¼å¼çš„ pvï¼›<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–‡ä»¶å¤¹çš„å‘½åæ–¹å¼è§„åˆ™ï¼š$&#123;namespace&#125;-$&#123;pvcName&#125;-$&#123;pvName&#125;</span></span><br><span class="line">/nfs/data$ ls -alh | grep <span class="string">"pvc"</span></span><br><span class="line">drwxrwxrwx 2 root   root 4.0K Dec  9 20:57 default-log-01-pvc-pvc-f003301b-d22b-4a9f-beb3-b6fe81a6398b</span><br><span class="line">drwxrwxrwx 2 root   root 4.0K Dec  9 20:57 default-log-02-pvc-pvc-e76d332e-52bf-470a-a362-48742c03ab5f</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<h5 id="åŠ¨æ€å­˜å‚¨ç±»ä½¿ç”¨"><a href="#åŠ¨æ€å­˜å‚¨ç±»ä½¿ç”¨" class="headerlink" title="åŠ¨æ€å­˜å‚¨ç±»ä½¿ç”¨"></a>åŠ¨æ€å­˜å‚¨ç±»ä½¿ç”¨</h5><ul>
<li>Step 7.åœ¨å®é™…å·¥ä½œä¸­ï¼Œä½¿ç”¨ StorageClass æ›´å¤šçš„æ˜¯ StatefulSet ç±»å‹çš„æœåŠ¡ï¼ŒStatefulSet ç±»å‹çš„æœåŠ¡æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸€ä¸ª <code>volumeClaimTemplates å±æ€§</code>æ¥ç›´æ¥ä½¿ç”¨ StorageClass;</li>
</ul>
<p>å®æˆ˜åˆ©ç”¨StatefulSetæ§åˆ¶å™¨éƒ¨ç½²Nginxä»¥åŠStorageClassåŠ¨æ€PVçš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; nginx-use-storageClass.yaml &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  <span class="built_in">type</span>: NodePort</span><br><span class="line">  ports:</span><br><span class="line">  - name: web</span><br><span class="line">    port: 80</span><br><span class="line">    targetPort: 80</span><br><span class="line">    nodePort: 30001</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: StatefulSet</span><br><span class="line">metadata:</span><br><span class="line">  name: web</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  serviceName: <span class="string">"nginx"</span></span><br><span class="line">  replicas: 8</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: harbor.weiyigeek.top/<span class="built_in">test</span>/nginx:v3.0</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">          name: web</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: webroot</span><br><span class="line">          mountPath: /usr/share/nginx/html</span><br><span class="line">        - name: weblog</span><br><span class="line">          mountPath: /var/<span class="built_in">log</span>/nginx</span><br><span class="line">        - name: timezone</span><br><span class="line">          mountPath: /etc/localtime</span><br><span class="line">      volumes:</span><br><span class="line">      - name: timezone     <span class="comment"># å®¹å™¨æ—¶åŒºè®¾ç½®</span></span><br><span class="line">        hostPath:</span><br><span class="line">          path: /usr/share/zoneinfo/Asia/Shanghai</span><br><span class="line">  volumeClaimTemplates:    <span class="comment"># æŒä¹…å·æ¨¡æ¿</span></span><br><span class="line">  - metadata:              <span class="comment"># æ ¹æ®æ¨¡æ¿è‡ªåŠ¨åˆ›å»ºPVä¸PVCå¹¶ä¸”è¿›è¡Œä¸€ä¸€å¯¹åº”ç»‘å®š;</span></span><br><span class="line">      name: webroot       </span><br><span class="line">    spec:</span><br><span class="line">      accessModes: [ <span class="string">"ReadWriteOnce"</span> ]  <span class="comment"># ç»‘å®šPVå…³é”®ç‚¹(1) - è®¿é—®æ¨¡å¼</span></span><br><span class="line">      resources:</span><br><span class="line">        requests:</span><br><span class="line">          storage: 1Gi                  <span class="comment"># ç»‘å®šPVå…³é”®ç‚¹(2) - å­˜å‚¨å¤§å°</span></span><br><span class="line">  - metadata:</span><br><span class="line">      name: weblog</span><br><span class="line">    spec:</span><br><span class="line">      accessModes: [ <span class="string">"ReadWriteMany"</span> ]</span><br><span class="line">      storageClassName: managed-nfs-storage   <span class="comment"># åŠ¨æ€å­˜å‚¨ç±»ç»‘å®šPV/PVCå…³é”®ç‚¹(3)</span></span><br><span class="line">      resources:</span><br><span class="line">        requests:</span><br><span class="line">          storage: 1Gi        </span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>Step 8.æŸ¥çœ‹åˆ›å»ºçš„SVCä»¥åŠStatefulSetã€podçŠ¶æ€;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~/K8s/Day7/demo3$ kubectl get svc,sts,pod -o wide --show-labels</span><br><span class="line">  <span class="comment"># NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE    SELECTOR    LABELS</span></span><br><span class="line">  <span class="comment"># service/kubernetes   ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP        34d    &lt;none&gt;      component=apiserver,provider=kubernetes</span></span><br><span class="line">  <span class="comment"># service/nginx        NodePort    10.110.119.27   &lt;none&gt;        80:30001/TCP   7m6s   app=nginx   app=nginx</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># NAME                   READY   AGE    CONTAINERS   IMAGES                                 LABELS</span></span><br><span class="line">  <span class="comment"># statefulset.apps/web   8/8     7m6s   nginx        harbor.weiyigeek.top/test/nginx:v3.0   &lt;none&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># NAME                                          READY   STATUS    RESTARTS   AGE     IP             NODE         LABELS</span></span><br><span class="line">  <span class="comment"># pod/nfs-client-provisioner-58b5dc958d-5fwl9   1/1     Running   0          5h43m   10.244.1.172   k8s-node-4   app=nfs-client-provisioner,pod-template-hash=58b5dc958d</span></span><br><span class="line">  <span class="comment"># pod/web-0                                     1/1     Running   0          2m24s   10.244.1.173   k8s-node-4   app=nginx,controller-revision-hash=web-79545bdb6d,statefulset.kubernetes.io/pod-name=web-0</span></span><br><span class="line">  <span class="comment"># pod/web-1                                     1/1     Running   0          2m20s   10.244.2.73    k8s-node-5   app=nginx,controller-revision-hash=web-79545bdb6d,statefulset.kubernetes.io/pod-name=web-1</span></span><br><span class="line">  <span class="comment"># pod/web-2                                     1/1     Running   0          2m15s   10.244.1.174   k8s-node-4   app=nginx,controller-revision-hash=web-79545bdb6d,statefulset.kubernetes.io/pod-name=web-2</span></span><br><span class="line">  <span class="comment"># pod/web-3                                     1/1     Running   0          2m10s   10.244.2.74    k8s-node-5   app=nginx,controller-revision-hash=web-79545bdb6d,statefulset.kubernetes.io/pod-name=web-3</span></span><br><span class="line">  <span class="comment"># pod/web-4                                     1/1     Running   0          2m6s    10.244.1.175   k8s-node-4   app=nginx,controller-revision-hash=web-79545bdb6d,statefulset.kubernetes.io/pod-name=web-4</span></span><br><span class="line">  <span class="comment"># pod/web-5                                     1/1     Running   0          117s    10.244.2.75    k8s-node-5   app=nginx,controller-revision-hash=web-79545bdb6d,statefulset.kubernetes.io/pod-name=web-5</span></span><br><span class="line">  <span class="comment"># pod/web-6                                     1/1     Running   0          107s    10.244.1.176   k8s-node-4   app=nginx,controller-revision-hash=web-79545bdb6d,statefulset.kubernetes.io/pod-name=web-6</span></span><br><span class="line">  <span class="comment"># pod/web-7                                     1/1     Running   0          96s     10.244.2.76    k8s-node-5   app=nginx,controller-revision-hash=web-79545bdb6d,statefulset.kubernetes.io/pod-name=web-7</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Step 9.è®¿é—®æˆ‘ä»¬nginxå¹¶è®¾ç½®æŸ¥æ—¥å¿—æ•°æ®å­˜å‚¨ç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) è®¿é—® Nginx Podï¼ˆè½®è¯¢æœºåˆ¶RRï¼‰</span></span><br><span class="line">/nfs/data$ curl http://10.110.119.27/host.html &amp;&amp; curl http://10.10.107.202:30001/host.html</span><br><span class="line">  <span class="comment"># Hostname: web-7 ,Image Version: 3.0, Nginx Version: 1.19.4</span></span><br><span class="line">  <span class="comment"># Hostname: web-7 ,Image Version: 3.0, Nginx Version: 1.19.4</span></span><br><span class="line">/nfs/data$ curl http://10.110.119.27/host.html &amp;&amp; curl http://10.10.107.202:30001/host.html</span><br><span class="line">  <span class="comment"># Hostname: web-6 ,Image Version: 3.0, Nginx Version: 1.19.4</span></span><br><span class="line">  <span class="comment"># Hostname: web-6 ,Image Version: 3.0, Nginx Version: 1.19.4</span></span><br><span class="line">/nfs/data$ curl http://10.110.119.27/host.html &amp;&amp; curl http://10.10.107.202:30001/host.html</span><br><span class="line">  <span class="comment"># Hostname: web-5 ,Image Version: 3.0, Nginx Version: 1.19.4</span></span><br><span class="line">  <span class="comment"># Hostname: web-5 ,Image Version: 3.0, Nginx Version: 1.19.4</span></span><br><span class="line">/nfs/data$ curl http://10.110.119.27/host.html &amp;&amp; curl http://10.10.107.202:30001/host.html</span><br><span class="line">  <span class="comment"># Hostname: web-4 ,Image Version: 3.0, Nginx Version: 1.19.4</span></span><br><span class="line">  <span class="comment"># Hostname: web-4 ,Image Version: 3.0, Nginx Version: 1.19.4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æŸ¥çœ‹æŒä¹…å·æ•°æ®å­˜æ”¾ç›®å½•(å¯ä»¥çœ‹å‡ºå¯ä»¥è‡ªåŠ¨åŠ¨æ€çš„åˆ†é…nfså­˜å‚¨å·)</span></span><br><span class="line">/nfs/data$ ls -alh | grep <span class="string">"web"</span> | cut -f 13 -d <span class="string">" "</span></span><br><span class="line"><span class="comment"># æ­¤å¤„ç›®å½•å®šä¹‰çš„æ ¼å¼ä¸º &#123;nameSpace&#125;-&#123;pvcName&#125;-&#123;pvName&#125;</span></span><br><span class="line">  <span class="comment"># default-weblog-web-0-pvc-b24af2f5-e6ad-4487-9f7b-d87d38fd9190</span></span><br><span class="line">  <span class="comment"># ....</span></span><br><span class="line">  <span class="comment"># default-weblog-web-7-pvc-94d2d4a2-fbc7-455a-a554-31e171dd19c9</span></span><br><span class="line">  <span class="comment"># default-webroot-web-0-pvc-f709d766-1061-4703-9c18-c2a814d450bf</span></span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line">  <span class="comment"># default-webroot-web-7-pvc-a7d6783b-2d91-4839-9a5b-d84436018f84</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123;pvcName&#125; &lt;==&gt; &#123;volumeName&#125;-&#123;statefulSetName&#125;-&#123;replicasSerial&#125;</span></span><br><span class="line">/nfs/data$ kubectl get pvc,pv | grep <span class="string">"pvc-102f5ada-5599-4152-bae4-968670a0d9a8"</span></span><br><span class="line">  <span class="comment"># persistentvolumeclaim/weblog-web-1    Bound    pvc-102f5ada-5599-4152-bae4-968670a0d9a8   1Gi        RWX            managed-nfs-storage   22m</span></span><br><span class="line">  <span class="comment"># persistentvolume/pvc-102f5ada-5599-4152-bae4-968670a0d9a8   1Gi        RWX            Delete           Bound    default/weblog-web-1    managed-nfs-storage            22m</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) æŸ¥çœ‹webè®¿é—®çš„é¡µé¢ä»¥åŠæ—¥å¿—æ•°æ®</span></span><br><span class="line">/nfs/data$ find . -name <span class="string">"host.html"</span> -<span class="built_in">exec</span> grep -H <span class="string">"Hostname"</span> &#123;&#125; \;  <span class="comment"># å¯ä»¥çœ‹åˆ°å„ä¸ª Pod çš„ host.html æ˜¯ä¸ä¸€è‡´çš„;</span></span><br><span class="line">  <span class="comment"># ./default-webroot-web-5-pvc-e77bbe07-bf82-4be8-9bc2-c3721c2db4ae/host.html:Hostname: web-5 ,Image Version: 3.0, Nginx Version: 1.19.4</span></span><br><span class="line">  <span class="comment"># ./default-webroot-web-4-pvc-c0c41528-85c0-4881-b05b-8e236bc77a47/host.html:Hostname: web-4 ,Image Version: 3.0, Nginx Version: 1.19.4</span></span><br><span class="line">  <span class="comment"># ./default-webroot-web-0-pvc-f709d766-1061-4703-9c18-c2a814d450bf/host.html:Hostname: web-0 ,Image Version: 3.0, Nginx Version: 1.19.4</span></span><br><span class="line">  <span class="comment"># ./default-webroot-web-6-pvc-9b482936-5252-43b2-b3a0-22bfee032dfb/host.html:Hostname: web-6 ,Image Version: 3.0, Nginx Version: 1.19.4</span></span><br><span class="line">  <span class="comment"># ./default-webroot-web-3-pvc-5c8f0e23-4718-4ce4-aa60-883c95bc7352/host.html:Hostname: web-3 ,Image Version: 3.0, Nginx Version: 1.19.4</span></span><br><span class="line">  <span class="comment"># ./default-webroot-web-2-pvc-d8685582-3122-4eb7-997f-b3d9c729918d/host.html:Hostname: web-2 ,Image Version: 3.0, Nginx Version: 1.19.4</span></span><br><span class="line">  <span class="comment"># ./default-webroot-web-7-pvc-a7d6783b-2d91-4839-9a5b-d84436018f84/host.html:Hostname: web-7 ,Image Version: 3.0, Nginx Version: 1.19.4</span></span><br><span class="line">  <span class="comment"># ./default-webroot-web-1-pvc-c7baf155-3514-4dce-83ed-6d33362864b4/host.html:Hostname: web-1 ,Image Version: 3.0, Nginx Version: 1.19.4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) åŒæ ·è®¿é—®æ—¥å¿—ä¹Ÿæ˜¯ç‹¬ç«‹çš„æ¯ä¸€ä¸ªPodéƒ½æœ‰è‡ªå·±çš„æ—¥å¿—å­˜å‚¨çš„PVC</span></span><br><span class="line">/nfs/data$ find . -name <span class="string">"*.log"</span> -<span class="built_in">exec</span> grep -H <span class="string">"200"</span> &#123;&#125; \;</span><br><span class="line">  <span class="comment"># ./default-weblog-web-6-pvc-cb930d15-558b-4ede-a087-4f0ee001826a/access.log:10.244.0.0 - - [09/Dec/2020:21:49:21 +0800] "GET /host.html HTTP/1.1" 200 59 "-" "curl/7.68.0" "-"</span></span><br><span class="line">  <span class="comment"># ./default-weblog-web-6-pvc-cb930d15-558b-4ede-a087-4f0ee001826a/access.log:10.244.0.0 - - [09/Dec/2020:21:49:21 +0800] "GET /host.html HTTP/1.1" 200 59 "-" "curl/7.68.0" "-"</span></span><br><span class="line">  <span class="comment"># ./default-weblog-web-5-pvc-fbd240f3-eaaa-46cc-af77-b8ea81f7be09/access.log:10.244.0.0 - - [09/Dec/2020:21:49:24 +0800] "GET /host.html HTTP/1.1" 200 59 "-" "curl/7.68.0" "-"</span></span><br><span class="line">  <span class="comment"># ./default-weblog-web-5-pvc-fbd240f3-eaaa-46cc-af77-b8ea81f7be09/access.log:10.244.0.0 - - [09/Dec/2020:21:49:24 +0800] "GET /host.html HTTP/1.1" 200 59 "-" "curl/7.68.0" "-"</span></span><br><span class="line">  <span class="comment"># ./default-weblog-web-4-pvc-2196b531-445f-48d5-bf2c-1c3ee4ee2a83/access.log:10.244.0.0 - - [09/Dec/2020:21:49:26 +0800] "GET /host.html HTTP/1.1" 200 59 "-" "curl/7.68.0" "-"</span></span><br><span class="line">  <span class="comment"># ./default-weblog-web-4-pvc-2196b531-445f-48d5-bf2c-1c3ee4ee2a83/access.log:10.244.0.0 - - [09/Dec/2020:21:49:26 +0800] "GET /host.html HTTP/1.1" 200 59 "-" "curl/7.68.0" "-"</span></span><br><span class="line">  <span class="comment"># ./default-weblog-web-7-pvc-94d2d4a2-fbc7-455a-a554-31e171dd19c9/access.log:10.244.0.0 - - [09/Dec/2020:21:49:17 +0800] "GET /host.html HTTP/1.1" 200 59 "-" "curl/7.68.0" "-"</span></span><br><span class="line">  <span class="comment"># ./default-weblog-web-7-pvc-94d2d4a2-fbc7-455a-a554-31e171dd19c9/access.log:10.244.0.0 - - [09/Dec/2020:21:49:17 +0800] "GET /host.html HTTP/1.1" 200 59 "-" "curl/7.68.0" "-"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="åŠ¨æ€å­˜å‚¨ç±»æ‰©å®¹ç¼©ä¸åˆ é™¤"><a href="#åŠ¨æ€å­˜å‚¨ç±»æ‰©å®¹ç¼©ä¸åˆ é™¤" class="headerlink" title="åŠ¨æ€å­˜å‚¨ç±»æ‰©å®¹ç¼©ä¸åˆ é™¤"></a>åŠ¨æ€å­˜å‚¨ç±»æ‰©å®¹ç¼©ä¸åˆ é™¤</h5><ul>
<li>Step 10.æŸ¥çœ‹StatefulSetæ‰©å®¹ç¼©å¯¹åŠåˆ é™¤èµ„æºæ—¶å€™å¯¹StorageClassçš„å½±å“<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) éªŒè¯: æ‰©å®¹ç¼©</span></span><br><span class="line">/nfs/data$ kubectl scale statefulset --replicas=3 web  <span class="comment"># Pod æ”¶ç¼©</span></span><br><span class="line">  <span class="comment"># statefulset.apps/web scaled</span></span><br><span class="line"><span class="comment"># ç»“è®ºï¼šPodæ•°é‡çš„å‡å°‘å¹¶ä¼šå½±å“PVCï¼Œå®ƒä¼šä¸€ç›´å­˜å‚¨åœ¨åŠ¨æ€å·é‡Œé™¤éæ‰‹åŠ¨çš„è¿›è¡Œæ“ä½œï¼›</span></span><br><span class="line">/nfs/data$ kubectl get pod,pv,pvc</span><br><span class="line">  <span class="comment"># NAME                                          READY   STATUS    RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># pod/nfs-client-provisioner-58b5dc958d-5fwl9   1/1     Running   0          6h21m</span></span><br><span class="line">  <span class="comment"># pod/web-0                                     1/1     Running   0          40m</span></span><br><span class="line">  <span class="comment"># pod/web-1                                     1/1     Running   0          40m</span></span><br><span class="line">  <span class="comment"># pod/web-2                                     1/1     Running   0          40m</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                   STORAGECLASS          REASON   AGE</span></span><br><span class="line">  <span class="comment"># persistentvolume/pvc-102f5ada-5599-4152-bae4-968670a0d9a8   1Gi        RWX            Delete           Bound    default/weblog-web-1    managed-nfs-storage            40m</span></span><br><span class="line">  <span class="comment"># .....</span></span><br><span class="line">  <span class="comment"># persistentvolume/pvc-fbd240f3-eaaa-46cc-af77-b8ea81f7be09   1Gi        RWX            Delete           Bound    default/weblog-web-5    managed-nfs-storage            39m</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># NAME                                  STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS          AGE</span></span><br><span class="line">  <span class="comment"># persistentvolumeclaim/log-01-pvc      Bound    pvc-f003301b-d22b-4a9f-beb3-b6fe81a6398b   1Gi        RWX            managed-nfs-storage   75m</span></span><br><span class="line">  <span class="comment"># persistentvolumeclaim/log-02-pvc      Bound    pvc-e76d332e-52bf-470a-a362-48742c03ab5f   1Gi        RWX            managed-nfs-storage   75m</span></span><br><span class="line">  <span class="comment"># persistentvolumeclaim/weblog-web-0    Bound    pvc-b24af2f5-e6ad-4487-9f7b-d87d38fd9190   1Gi        RWX            managed-nfs-storage   45m</span></span><br><span class="line">  <span class="comment"># ....</span></span><br><span class="line">  <span class="comment"># persistentvolumeclaim/weblog-web-7    Bound    pvc-94d2d4a2-fbc7-455a-a554-31e171dd19c9   1Gi        RWX            managed-nfs-storage   39m</span></span><br><span class="line">  <span class="comment"># persistentvolumeclaim/webroot-web-0   Bound    pvc-f709d766-1061-4703-9c18-c2a814d450bf   1Gi        RWO            managed-nfs-storage   45m</span></span><br><span class="line">  <span class="comment"># persistentvolumeclaim/webroot-web-1   Bound    pvc-c7baf155-3514-4dce-83ed-6d33362864b4   1Gi        RWO            managed-nfs-storage   40m</span></span><br><span class="line">  <span class="comment"># ....</span></span><br><span class="line">  <span class="comment"># persistentvolumeclaim/webroot-web-7   Bound    pvc-a7d6783b-2d91-4839-9a5b-d84436018f84   1Gi        RWO            managed-nfs-storage   39m</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) éªŒè¯:åˆ é™¤StatefulSetæ§åˆ¶å™¨åˆ›å»ºçš„èµ„æº</span></span><br><span class="line">/nfs/data$ kubectl delete sts web</span><br><span class="line">  <span class="comment"># statefulset.apps "web" deleted</span></span><br><span class="line">/nfs/data$ kubectl get pod</span><br><span class="line">  <span class="comment"># NAME                                      READY   STATUS        RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># nfs-client-provisioner-58b5dc958d-5fwl9   1/1     Running       0          6h28m</span></span><br><span class="line">  <span class="comment"># web-0                                     1/1     Terminating   0          47m # ç»ˆæ­¢ä¸­</span></span><br><span class="line">  <span class="comment"># web-1                                     1/1     Terminating   0          47m # ç»ˆæ­¢ä¸­</span></span><br><span class="line">  <span class="comment"># web-2                                     1/1     Terminating   0          47m # ç»ˆæ­¢ä¸­</span></span><br><span class="line"><span class="comment"># ç»“è®º: StatefulSet èµ„æºåˆ é™¤ååŠ¨æ€æŒä¹…å·ä»»ç„¶å­˜å‚¨åœ¨æˆ‘ä»¬çš„nfsæœåŠ¡ä¸Šå¹¶æœªè¢«æ¸…ç©ºï¼ˆä½ å¯ä»¥æ‰‹åŠ¨æ¸…ç©ºæˆ–è€…ï¼‰</span></span><br><span class="line">/nfs/data$ kubectl get pvc</span><br><span class="line">  <span class="comment"># NAME            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS          AGE</span></span><br><span class="line">  <span class="comment"># log-01-pvc      Bound    pvc-f003301b-d22b-4a9f-beb3-b6fe81a6398b   1Gi        RWX            managed-nfs-storage   84m</span></span><br><span class="line">  <span class="comment"># log-02-pvc      Bound    pvc-e76d332e-52bf-470a-a362-48742c03ab5f   1Gi        RWX            managed-nfs-storage   84m</span></span><br><span class="line">  <span class="comment"># weblog-web-0    Bound    pvc-b24af2f5-e6ad-4487-9f7b-d87d38fd9190   1Gi        RWX            managed-nfs-storage   54m</span></span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line">  <span class="comment"># weblog-web-7    Bound    pvc-94d2d4a2-fbc7-455a-a554-31e171dd19c9   1Gi        RWX            managed-nfs-storage   49m</span></span><br><span class="line">  <span class="comment"># webroot-web-0   Bound    pvc-f709d766-1061-4703-9c18-c2a814d450bf   1Gi        RWO            managed-nfs-storage   54m</span></span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line">  <span class="comment"># webroot-web-7   Bound    pvc-a7d6783b-2d91-4839-9a5b-d84436018f84   1Gi        RWO            managed-nfs-storage   49m</span></span><br><span class="line"></span><br><span class="line">~/K8s/Day7/demo3$ kubectl delete pv,pvc --all</span><br><span class="line">persistentvolume <span class="string">"pvc-102f5ada-5599-4152-bae4-968670a0d9a8"</span> deleted</span><br><span class="line">persistentvolume <span class="string">"pvc-2196b531-445f-48d5-bf2c-1c3ee4ee2a83"</span> deleted</span><br><span class="line">persistentvolume <span class="string">"pvc-5c8f0e23-4718-4ce4-aa60-883c95bc7352"</span> deleted</span><br><span class="line">persistentvolume <span class="string">"pvc-94d2d4a2-fbc7-455a-a554-31e171dd19c9"</span> deleted</span><br><span class="line">persistentvolume <span class="string">"pvc-9b482936-5252-43b2-b3a0-22bfee032dfb"</span> deleted</span><br><span class="line">persistentvolume <span class="string">"pvc-a7d6783b-2d91-4839-9a5b-d84436018f84"</span> deleted</span><br><span class="line">persistentvolume <span class="string">"pvc-b24af2f5-e6ad-4487-9f7b-d87d38fd9190"</span> deleted</span><br><span class="line">persistentvolume <span class="string">"pvc-bf4734e3-a010-4336-a190-6a13527d9672"</span> deleted</span><br><span class="line">persistentvolume <span class="string">"pvc-c0c41528-85c0-4881-b05b-8e236bc77a47"</span> deleted</span><br><span class="line">persistentvolume <span class="string">"pvc-c7baf155-3514-4dce-83ed-6d33362864b4"</span> deleted</span><br><span class="line">persistentvolume <span class="string">"pvc-cb930d15-558b-4ede-a087-4f0ee001826a"</span> deleted</span><br><span class="line">persistentvolume <span class="string">"pvc-d02d6fcd-20e4-47a1-bdb9-3e42e8a6cf54"</span> deleted</span><br><span class="line">persistentvolume <span class="string">"pvc-d8685582-3122-4eb7-997f-b3d9c729918d"</span> deleted</span><br><span class="line">persistentvolume <span class="string">"pvc-e77bbe07-bf82-4be8-9bc2-c3721c2db4ae"</span> deleted</span><br><span class="line">persistentvolume <span class="string">"pvc-f709d766-1061-4703-9c18-c2a814d450bf"</span> deleted</span><br><span class="line">persistentvolume <span class="string">"pvc-fbd240f3-eaaa-46cc-af77-b8ea81f7be09"</span> deleted</span><br><span class="line">persistentvolumeclaim <span class="string">"weblog-web-0"</span> deleted</span><br><span class="line">persistentvolumeclaim <span class="string">"weblog-web-1"</span> deleted</span><br><span class="line">persistentvolumeclaim <span class="string">"weblog-web-2"</span> deleted</span><br><span class="line">persistentvolumeclaim <span class="string">"weblog-web-3"</span> deleted</span><br><span class="line">persistentvolumeclaim <span class="string">"weblog-web-4"</span> deleted</span><br><span class="line">persistentvolumeclaim <span class="string">"weblog-web-5"</span> deleted</span><br><span class="line">persistentvolumeclaim <span class="string">"weblog-web-6"</span> deleted</span><br><span class="line">persistentvolumeclaim <span class="string">"weblog-web-7"</span> deleted</span><br><span class="line">persistentvolumeclaim <span class="string">"webroot-web-0"</span> deleted</span><br><span class="line">persistentvolumeclaim <span class="string">"webroot-web-1"</span> deleted</span><br><span class="line">persistentvolumeclaim <span class="string">"webroot-web-2"</span> deleted</span><br><span class="line">persistentvolumeclaim <span class="string">"webroot-web-3"</span> deleted</span><br><span class="line">persistentvolumeclaim <span class="string">"webroot-web-4"</span> deleted</span><br><span class="line">persistentvolumeclaim <span class="string">"webroot-web-5"</span> deleted</span><br><span class="line">persistentvolumeclaim <span class="string">"webroot-web-6"</span> deleted</span><br><span class="line">persistentvolumeclaim <span class="string">"webroot-web-7"</span> deleted</span><br><span class="line">~/K8s/Day7/demo3$ ls /nfs/data</span><br><span class="line">data/  data1/ data2/ data3/ data4/</span><br><span class="line">~/K8s/Day7/demo3$ ls /nfs/data/</span><br><span class="line">archived-default-elasticsearch-master-elasticsearch-master-0-pvc-337180d4-e12a-4933-bbe7-bc9eea8d068a  default-weblog-web-6-pvc-cb930d15-558b-4ede-a087-4f0ee001826a</span><br><span class="line">archived-default-elasticsearch-master-elasticsearch-master-0-pvc-6c445381-1a64-40e4-a412-493e691d8a22  default-weblog-web-7-pvc-94d2d4a2-fbc7-455a-a554-31e171dd19c9</span><br><span class="line">archived-default-elasticsearch-master-elasticsearch-master-0-pvc-ad986a1f-f36e-4223-af17-e4100ca2a587  default-webroot-web-0-pvc-f709d766-1061-4703-9c18-c2a814d450bf</span><br><span class="line">archived-default-log-01-pvc-pvc-f003301b-d22b-4a9f-beb3-b6fe81a6398b                                   default-webroot-web-1-pvc-c7baf155-3514-4dce-83ed-6d33362864b4</span><br><span class="line">archived-default-log-02-pvc-pvc-e76d332e-52bf-470a-a362-48742c03ab5f                                   default-webroot-web-2-pvc-d8685582-3122-4eb7-997f-b3d9c729918d</span><br><span class="line">archived-default-weblog-web-0-pvc-b24af2f5-e6ad-4487-9f7b-d87d38fd9190                                 default-webroot-web-3-pvc-5c8f0e23-4718-4ce4-aa60-883c95bc7352</span><br><span class="line">archived-default-weblog-web-1-pvc-102f5ada-5599-4152-bae4-968670a0d9a8                                 default-webroot-web-4-pvc-c0c41528-85c0-4881-b05b-8e236bc77a47</span><br><span class="line">archived-default-weblog-web-2-pvc-bf4734e3-a010-4336-a190-6a13527d9672                                 default-webroot-web-5-pvc-e77bbe07-bf82-4be8-9bc2-c3721c2db4ae</span><br><span class="line">archived-default-weblog-web-3-pvc-d02d6fcd-20e4-47a1-bdb9-3e42e8a6cf54                                 default-webroot-web-6-pvc-9b482936-5252-43b2-b3a0-22bfee032dfb</span><br><span class="line">archived-default-weblog-web-4-pvc-2196b531-445f-48d5-bf2c-1c3ee4ee2a83                                 default-webroot-web-7-pvc-a7d6783b-2d91-4839-9a5b-d84436018f84</span><br><span class="line">archived-default-weblog-web-5-pvc-fbd240f3-eaaa-46cc-af77-b8ea81f7be09</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="image-box">
                <a rel=7-Kuberneteså…¥é—¨åŸºç¡€ä¹‹å­˜å‚¨Volumeä»‹ç» href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201209223436.png" target="_blank" title="WeiyiGeek.Nginxç½‘ç«™ä¸æ—¥å¿—æ•°æ®ä¾ç„¶å­˜å‚¨" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201209223436.png" alt="WeiyiGeek.Nginxç½‘ç«™ä¸æ—¥å¿—æ•°æ®ä¾ç„¶å­˜å‚¨" title="" class=""></a>
                <p>WeiyiGeek.Nginxç½‘ç«™ä¸æ—¥å¿—æ•°æ®ä¾ç„¶å­˜å‚¨</p>
            </figure>
<ul>
<li>Step 11.ä»¥ä¸Šå³ä¸ºk8sæŒä¹…åŒ–å­˜å‚¨ä¹‹storageclasså®è·µã€‚<br>ä»¥ä¸Šå°±æ˜¯ä½¿ç”¨storageclasså®ç°åŠ¨æ€pvçš„å…·ä½“æ­¥éª¤ï¼Œå†…å®¹è¾ƒä¸ºå…¨é¢è€Œä¸”æˆ‘ä¹Ÿç›¸ä¿¡æœ‰ç›¸å½“çš„ä¸€äº›å·¥å…·å¯èƒ½æ˜¯æˆ‘ä»¬æ—¥å¸¸å·¥ä½œå¯èƒ½ä¼šè§åˆ°æˆ–ç”¨åˆ°çš„ã€‚</li>
</ul>
<p><br></p>
<h4 id="å®é™…æ¡ˆä¾‹"><a href="#å®é™…æ¡ˆä¾‹" class="headerlink" title="å®é™…æ¡ˆä¾‹"></a>å®é™…æ¡ˆä¾‹</h4><h5 id="MySQLæ•°æ®åº“ä½¿ç”¨StorageClasså¯¹æ•°æ®çš„æŒä¹…å­˜å‚¨"><a href="#MySQLæ•°æ®åº“ä½¿ç”¨StorageClasså¯¹æ•°æ®çš„æŒä¹…å­˜å‚¨" class="headerlink" title="MySQLæ•°æ®åº“ä½¿ç”¨StorageClasså¯¹æ•°æ®çš„æŒä¹…å­˜å‚¨"></a>MySQLæ•°æ®åº“ä½¿ç”¨StorageClasså¯¹æ•°æ®çš„æŒä¹…å­˜å‚¨</h5><p>æè¿°: æ¥ä¸‹æ¥æˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ªmysqlåº”ç”¨ï¼Œæµ‹è¯•ä¸‹ StorageClass æ–¹å¼å£°æ˜çš„ PVC å¯¹è±¡</p>
<ul>
<li>Step 1.MySQLåœ¨K8sé›†ç¾¤ä¸­éƒ¨ç½²çš„èµ„æºæ¸…å•<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">mysql-config.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">mysql-config</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="string">custom.cnf:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    [mysqld]</span></span><br><span class="line"><span class="string">    default_storage_engine=innodb</span></span><br><span class="line"><span class="string">    skip_external_locking</span></span><br><span class="line"><span class="string">    skip_host_cache</span></span><br><span class="line"><span class="string">    skip_name_resolve</span></span><br><span class="line"><span class="string">    default_authentication_plugin=mysql_native_password</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">cat mysql-secret.yaml</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">mysql-user-pwd</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line"><span class="attr">  mysql-root-pwd:</span> <span class="string">cGFzc3dvcmQ=</span></span><br><span class="line"></span><br><span class="line"><span class="string">cat</span> <span class="string">mysql-deploy.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">  - port:</span> <span class="number">3306</span></span><br><span class="line"><span class="attr">    nodePort:</span> <span class="number">30006</span></span><br><span class="line"><span class="attr">    protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">3306</span> </span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">mysql</span></span><br><span class="line"></span><br><span class="line"><span class="string">cat</span> <span class="string">mysql-pvc.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">mysql-pvc</span></span><br><span class="line"><span class="attr">  annotations:</span>                      </span><br><span class="line">    <span class="string">volume.beta.kubernetes.io/storage-class:</span> <span class="string">"managed-nfs-storage"</span>    <span class="comment"># ç©ºé—´æ ‡æ³¨</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  accessModes:</span> <span class="string">["ReadWriteMany"]</span></span><br><span class="line"><span class="attr">  storageClassName:</span> <span class="string">managed-nfs-storage</span></span><br><span class="line"><span class="attr">  resources:</span></span><br><span class="line"><span class="attr">    requests:</span></span><br><span class="line"><span class="attr">      storage:</span> <span class="number">2</span><span class="string">Gi</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">  strategy:</span></span><br><span class="line"><span class="attr">    type:</span> <span class="string">Recreate</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - image:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">        name:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">        imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">        env:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line"><span class="attr">          valueFrom:</span></span><br><span class="line"><span class="attr">            secretKeyRef:</span></span><br><span class="line"><span class="attr">              name:</span> <span class="string">mysql-user-pwd</span></span><br><span class="line"><span class="attr">              key:</span> <span class="string">mysql-root-pwd</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="attr">        - containerPort:</span> <span class="number">3306</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">        volumeMounts:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">mysql-config</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/mysql/conf.d/</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">mysql-persistent-storage</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/var/lib/mysql</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">timezone</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/localtime</span></span><br><span class="line"><span class="attr">      volumes:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">mysql-config</span></span><br><span class="line"><span class="attr">        configMap:</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">mysql-config</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">timezone</span></span><br><span class="line"><span class="attr">        hostPath:</span></span><br><span class="line"><span class="attr">          path:</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">mysql-persistent-storage</span></span><br><span class="line"><span class="attr">        persistentVolumeClaim:</span></span><br><span class="line"><span class="attr">          claimName:</span> <span class="string">mysql-pvc</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>Step 2.æŒ‰ç…§èµ„æºæ¸…å•è¿›è¡Œéƒ¨ç½²æ„å»ºå“åº”çš„Podä»¥åŠServices</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f .</span><br><span class="line">  configmap/mysql-config created</span><br><span class="line">  service/mysql created</span><br><span class="line">  deployment.apps/mysql created</span><br><span class="line">  secret/mysql-user-pwd created</span><br></pre></td></tr></table></figure>
<ul>
<li>Step 3.æŸ¥çœ‹åˆ›å»ºçš„èµ„æº<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod,svc</span><br><span class="line">NAME                                        READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/mysql-7c5b5df54c-vrnr8                  1/1     Running   0          83s</span><br><span class="line">pod/nfs-client-provisioner-c676947d-pfpms   1/1     Running   0          30m</span><br><span class="line"></span><br><span class="line">NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">service/kubernetes   ClusterIP   10.0.0.1     &lt;none&gt;        443/TCP          93d</span><br><span class="line">service/mysql        NodePort    10.0.0.19    &lt;none&gt;        3306:30006/TCP   83s</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>Step 4.å¯ä»¥çœ‹åˆ°mysqlåº”ç”¨å·²ç»æ­£å¸¸è¿è¡Œï¼Œæˆ‘ä»¬é€šè¿‡ä»»æ„ä¸€ä¸ªnodeèŠ‚ç‚¹çš„ipå’Œ30006ç«¯å£è¿æ¥mysqlæ•°æ®åº“æµ‹è¯•<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mysql -uroot -h292.168.248.134 -P30006 -p</span></span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 10</span><br><span class="line">Server version: 8.0.19 MySQL Community Server - GPL</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>Step 5.å¯ä»¥çœ‹åˆ°mysqlæ•°æ®åº“è¿æ¥æ­£å¸¸ï¼Œæ­¤æ—¶æŸ¥çœ‹nfså­˜å‚¨mysqlæ•°æ®åº“æ•°æ®å·²ç»æŒä¹…åŒ–åˆ°nfsæœåŠ¡å™¨ <code>/data/nfs/default-mysql-pvc-pvc-eef853e1-f8d8-4ab9-bfd3-05c2a58fd9dc</code>ç›®å½•ä¸­<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ du -sh *</span><br><span class="line">177M    default-mysql-pvc-pvc-eef853e1-f8d8-4ab9-bfd3-05c2a58fd9dc</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> default-mysql-pvc-pvc-eef853e1-f8d8-4ab9-bfd3-05c2a58fd9dc/</span><br><span class="line"></span><br><span class="line">$ ls</span><br><span class="line">auto.cnf       binlog.index  client-cert.pem  ibdata1      ibtmp1        mysql.ibd           public_key.pem   sys</span><br><span class="line">binlog.000001  ca-key.pem    client-key.pem   ib_logfile0  innodb_temp  performance_schema  server-cert.pem  undo_001</span><br><span class="line">binlog.000002  ca.pem        ib_buffer_pool   ib_logfile1  mysql         private_key.pem     server-key.pem   undo_002</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<p><strong>å…³äº StatefulSet è¡¥å……ä½¿ç”¨PV/PVCæˆ–è€…StorageClassçš„è¡¥å……</strong></p>
<ul>
<li>1) StatefulSet ä¸ºæ¯ä¸ªPodå‰¯æœ¬åˆ›å»ºäº†ä¸€ä¸ªDNS åŸŸåï¼Œè¿™ä¸ªåŸŸåçš„æ ¼å¼ä¸º:<code>(podname).(headless servername)</code>ï¼Œä¹Ÿå°±æ„å‘³ç€æœåŠ¡é—´æ˜¯é€šè¿‡PodåŸŸåæ¥é€šä¿¡è€ŒéPodIPï¼Œå› ä¸ºå½“Podæ‰€åœ¨Nodeå‘ç”Ÿæ•…éšœæ—¶ï¼ŒPodä¼šè¢«é£˜ç§»åˆ°å…¶å®ƒ Node ä¸Š PodIP ä¼šå‘ç”Ÿå˜åŒ–ä½†æ˜¯ PodåŸŸåä¸ä¼šæœ‰å˜åŒ–;<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ— è®º Pod åˆ é™¤åé‡å»ºçš„å®¹å™¨ä»»ç„¶å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®;</span></span><br><span class="line">ping web-pvc-demo-0.nginx-pvc-demo</span><br><span class="line">ping web-pvc-demo-1.nginx-pvc-demo</span><br><span class="line">ping web-pvc-demo-2.nginx-pvc-demo</span><br></pre></td></tr></table></figure></li>
<li>2) StatefulSet é… Pod name (ç½‘ç»œæ ‡è¯†) çš„æ¨¡å¼ä¸º:(<code>statefulsetåç§°âˆ’åºå·</code>)ï¼Œæ¯”å¦‚ä¸Šé¢çš„ç¤ºä¾‹:<code>web-pvc-demo-0, web-pvc-demo-1,web-pvc-demo-2</code></li>
<li>3) StatefulSet ä½¿ç”¨ Headless æœåŠ¡æ¥æ§åˆ¶ Pod çš„åŸŸå,è¿™ä¸ªåŸŸåçš„FQDNä¸º:<code>(servicename).$(namespace).svc.cluster.local</code>,å…¶ä¸­<code>&quot;cluster.local&quot;</code>æŒ‡çš„æ˜¯é›†ç¾¤çš„åŸŸå<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig -t A nginx-pvc-demo.default.svc.cluster.local. @10.244.0.8</span><br></pre></td></tr></table></figure></li>
<li>4) æ ¹æ®volumeClaimTemplatesä¸ºæ¯ä¸ªPod åˆ›å»ºä¸€ä¸ªPVC,å…¶çš„å‘½åè§„åˆ™åŒ¹é…æ¨¡å¼:<code>(volumeClaim Templates.name-pod_name)</code>, æ¯”å¦‚ä¸Šé¢çš„<code>volumeMounts.name=diskpv</code> å› æ­¤åˆ›å»ºå‡ºæ¥çš„PVCæ˜¯<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">diskpv-web-pvc-demo-1</span><br><span class="line">diskpv-web-pvc-demo-2</span><br><span class="line">diskpv-web-pvc-demo-3</span><br></pre></td></tr></table></figure></li>
<li>5)ã€€åˆ é™¤ Pod ä¸ä¼šåˆ é™¤å…¶pvcï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤ pvc å°†è‡ªåŠ¨é‡Šæ”¾ pvï¼ŒæŸ¥çœ‹ä¸Šé¢çš„<code>æ­¥éª¤6.PV ä¸ PVC åˆ é™¤ &amp; å›æ”¶ç­–ç•¥æŸ¥çœ‹</code></li>
</ul>
<p><br/></p>

        </div>
        
  <hr>
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>

  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>

  <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ï¼Œè½¬ä¸ªå‘ã€‘(äººé—´äº”å¤§æƒ…)</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œè°¢è°¢ï¼ã€‚</p>

  <div>
    <img src="https://www.weiyigeek.top/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul>

  <div>
    <img src="/img/wechat-search.png" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·"  width="380" height="170">
    <img src="/img/wechat-app.png" class="img-responsive" alt="æ‰«æVisit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº"  width="385" height="170">
  </div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-06-21T02:33:02.087Z" itemprop="dateUpdated">2022-06-21 10:33:02</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/7-Kuberneteså…¥é—¨åŸºç¡€ä¹‹å­˜å‚¨Volumeä»‹ç».md" target="_blank" rel="noopener noreferrer">_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/7-Kuberneteså…¥é—¨åŸºç¡€ä¹‹å­˜å‚¨Volumeä»‹ç».md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2020/9-27-522.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/9-27-522.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">ğŸ‘ é’Ÿæ„ä½œè€…</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/9-27-522.html&title=ã€Š7-Kuberneteså…¥é—¨åŸºç¡€ä¹‹å­˜å‚¨Volumeä»‹ç»ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/9-27-522.html&title=ã€Š7-Kuberneteså…¥é—¨åŸºç¡€ä¹‹å­˜å‚¨Volumeä»‹ç»ã€‹ â€” WeiyiGeek Blog&source=WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ª..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/9-27-522.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š7-Kuberneteså…¥é—¨åŸºç¡€ä¹‹å­˜å‚¨Volumeä»‹ç»ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/9-27-522.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/9-27-522.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/9-27-538.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">10-kuberneteså…¥é—¨åŸºç¡€ä¹‹ç½‘ç»œè®¾è®¡å®ç°æ–¹æ¡ˆ</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/9-16-507.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Flaskä¸­ORMæ¡†æ¶ä¹‹SQLAlchemyæ’ä»¶å…¥é—¨åˆ°å¼ƒå‘</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-å‰è¨€ç®€è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å‰è¨€ç®€è¿°</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-Storage-å­˜å‚¨"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 Storage - å­˜å‚¨</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-ConfigMap"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">1.ConfigMap</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#configMap-ä»‹ç»"><span class="post-toc-number">2.1.1.</span> <span class="post-toc-text">configMap - ä»‹ç»</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#configMap-åˆ›å»º"><span class="post-toc-number">2.1.2.</span> <span class="post-toc-text">configMap - åˆ›å»º</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#configMap-æ“ä½œ"><span class="post-toc-number">2.1.3.</span> <span class="post-toc-text">configMap - æ“ä½œ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#configMap-ä½¿ç”¨"><span class="post-toc-number">2.1.4.</span> <span class="post-toc-text">configMap - ä½¿ç”¨</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-Secret"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">2.Secret</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Service-Account"><span class="post-toc-number">2.2.1.</span> <span class="post-toc-text">Service Account</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Opaque-Secret"><span class="post-toc-number">2.2.2.</span> <span class="post-toc-text">Opaque Secret</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#kubernetes-io-dockerconfigjson"><span class="post-toc-number">2.2.3.</span> <span class="post-toc-text">kubernetes.io&#x2F;dockerconfigjson</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-Volume"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">3.Volume</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#emptyDir-ç©ºå·"><span class="post-toc-number">2.3.1.</span> <span class="post-toc-text">emptyDir - ç©ºå·</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#hostPath-ä¸»æœºè·¯å¾„å·"><span class="post-toc-number">2.3.2.</span> <span class="post-toc-text">hostPath - ä¸»æœºè·¯å¾„å·</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#nfs-åˆ†å¸ƒå¼å…±äº«å­˜å‚¨å·"><span class="post-toc-number">2.3.3.</span> <span class="post-toc-text">nfs - åˆ†å¸ƒå¼å…±äº«å­˜å‚¨å·</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-PersistentVolume-amp-PersistentVolumeClaim"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">4.PersistentVolume &amp; PersistentVolumeClaim</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#åŸºç¡€æ¦‚å¿µ"><span class="post-toc-number">2.4.1.</span> <span class="post-toc-text">åŸºç¡€æ¦‚å¿µ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#PV-åˆ†ç±»"><span class="post-toc-number">2.4.2.</span> <span class="post-toc-text">PV åˆ†ç±»</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#PV-ç»‘å®š"><span class="post-toc-number">2.4.3.</span> <span class="post-toc-text">PV ç»‘å®š</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#PV-ä½¿ç”¨"><span class="post-toc-number">2.4.4.</span> <span class="post-toc-text">PV ä½¿ç”¨</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#PV-é‡Šæ”¾"><span class="post-toc-number">2.4.5.</span> <span class="post-toc-text">PV é‡Šæ”¾</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#PV-å›æ”¶"><span class="post-toc-number">2.4.6.</span> <span class="post-toc-text">PV å›æ”¶</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#PV-PVC-ä¸¾ä¾‹"><span class="post-toc-number">2.4.7.</span> <span class="post-toc-text">PV&#x2F;PVC ä¸¾ä¾‹</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#PV-PVC-å®ä¾‹"><span class="post-toc-number">2.4.8.</span> <span class="post-toc-text">PV&#x2F;PVC å®ä¾‹</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-StorageClass-åŠ¨æ€åˆ†é…æŒä¹…å·"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">5.StorageClass - åŠ¨æ€åˆ†é…æŒä¹…å·</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#åŸºç¡€æ¦‚å¿µ-1"><span class="post-toc-number">2.5.1.</span> <span class="post-toc-text">åŸºç¡€æ¦‚å¿µ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#èµ„æºå®šä¹‰"><span class="post-toc-number">2.5.2.</span> <span class="post-toc-text">èµ„æºå®šä¹‰</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#åŸºç¡€å®ä¾‹"><span class="post-toc-number">2.5.3.</span> <span class="post-toc-text">åŸºç¡€å®ä¾‹</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#å®é™…æ¡ˆä¾‹"><span class="post-toc-number">2.5.4.</span> <span class="post-toc-text">å®é™…æ¡ˆä¾‹</span></a></li></ol></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

  <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¿˜è¯·æ”¯æŒä¸€ä¸‹åšä¸»å“Ÿ, è°¢è°¢å„ä½çœ‹å‹â™¥!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

  
 <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->

  <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">ä¸ªäººGithub</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">ä¸ªäººGitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">ä¸ªäººçŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘+äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/9-27-522.html&title=ã€Š7-Kuberneteså…¥é—¨åŸºç¡€ä¹‹å­˜å‚¨Volumeä»‹ç»ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/9-27-522.html&title=ã€Š7-Kuberneteså…¥é—¨åŸºç¡€ä¹‹å­˜å‚¨Volumeä»‹ç»ã€‹ â€” WeiyiGeek Blog&source=WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ª..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/9-27-522.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š7-Kuberneteså…¥é—¨åŸºç¡€ä¹‹å­˜å‚¨Volumeä»‹ç»ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/9-27-522.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/9-27-522.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACL0lEQVR42u3a0XLbMAwEQP//T6uvzaR27gi7rcjlk0eWRK4zgxAAH494XL+N5Nvr23j2VD7LGwYGBsZtGdfL0S7r2VPPlv79+ut5n64BAwPjAEb+6tcTrN0zYWNgYGC0n9eu5D8fBgYGRrtdS96TP/UPAi4GBsatGEkSm0w2T3c/notjYGDckJFX3f/+54/0NzAwMG7FuMox7xu+ayVf3omBgbE1Iw9wyXZwbdFRgpq8AQMDY1NG3npsD29N7qmvYGBgHMBoy2TtQteKdEXJDwMD4wDGpA3QRrz5UYw/vA0DA+MARntgog2+k1AebUwxMDC2ZrRl+kkZbu3+UYMTAwNjC8Y8KW3L/W0zIHoKAwPjAMbrZLLYii2lqWstiqLchoGBcXPG/DhFWxrLn10LwRgYGHszWljbhpy0RYtFY2BgbMpYmyzZGrap76T9iYGBcQJjbTO3OGUc4uv/DxgYGNsxJolo8p724FcbdjEwME5g5IvIk9U8u1xrD9R/EwwMjO0Ya5uzFpm3OYt2AgYGxjGMeYGs3W4m7dKozYmBgXEMo93qtQfC5tXBKInFwMDYiHGVIy/iJwvNi24/BF8MDIytGe/qEs5D8No28c3NTgwMjP+YsZaItgtqm5R1QMfAwDiAkQe+ydLrDDtuiGJgYGDkAXfSVGiT5Ef7u2JgYBzMyK+3iW5ejMPAwDiBkSSx+T3vCq8fKbdhYGDckDE5qTFJPidFusVGJgYGxv0YvwD7DPoIP1gl0AAAAABJRU5ErkJggg==" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 



  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 
     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>
