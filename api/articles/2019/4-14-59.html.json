{"title":"绿盟安全设备基础配置","slug":"网安防御/安全厂商设备/绿盟-Nsfocus/绿盟安全设备基础配置","date":"2019-04-14T11:35:00.000Z","updated":"2022-03-29T05:39:02.682Z","url":"2019/4-14-59.html","path":"api/articles/2019/4-14-59.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413200815.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413200935.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413201208.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413202034.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413202146.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413202455.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413214329.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413214458.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413214521.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413214846.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413215037.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413215149.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"1-配置案例\"><a href=\"#1-配置案例\" class=\"headerlink\" title=\"1.配置案例\"></a>1.配置案例</h4><p><strong>0x00 WAF - 密码忘记重置通过设备的console</strong><br>通过RJ45-&gt;serial转USB的线，插入到设备的S口，然后USB连接到电脑；之后利用XSHELL或者，SecureCRT等软件连接；<br>特别注意这里是波特率设置为115200，然后选择连接的com口，回车输入conadmin，conadmin即可；</p>\n<p>WAF : admin@admin</p>\n<p><br></p>\n<p><strong>0x01 NIPS - 设置静态路由无法访问设置（该网段其他主机也不能访问改主机）</strong><br>通过串口设置管理接口COM4<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413200815.png\" alt=\"WeiyiGeek.静态路由\" title=\"\" class=\"\">\n                <p>WeiyiGeek.静态路由</p>\n            </figure></p>\n<p>设置静态路由为：IP/子网掩码 ：0.0.0.0/0   网管：192.168.1.254（根据情况而定） 最后应用配置生效；<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413200935.png\" alt=\"WeiyiGeek.应用配置\" title=\"\" class=\"\">\n                <p>WeiyiGeek.应用配置</p>\n            </figure></p>\n<p><br><br><strong>0x02 NIPS 设置虚拟线路</strong><br>虚拟线（透明管理，相当于是一个河道中间利用渔网进行过滤特定的数据）—&gt;&gt;&gt; （注意必须是一进一出） ,虚拟线Wiress新建选择接口：</p>\n<p>除此之外的接口，接口链路状态同步【当一段端口异常时候，对端端口也将发生异常，这时将启动Bybass直通】,设置得两对虚拟线：<br>monitor ： 监听<br>mgt    ： 管理<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413201208.png\" alt=\"WeiyiGeek.虚拟线路\" title=\"\" class=\"\">\n                <p>WeiyiGeek.虚拟线路</p>\n            </figure></p>\n<p><strong>0x03 软件版ESP安装（态势感知）</strong><br>主机软件配置要求：目前只支持64位操作系统，要求安装时关闭SELinux。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CentOS 6.5 x86_64，basic server模式。</span><br><span class=\"line\">CentOS 7.0 x86_64，infrastructure server模式。</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413202034.png\" alt=\"WeiyiGeek.主机硬件配置\" title=\"\" class=\"\">\n                <p>WeiyiGeek.主机硬件配置</p>\n            </figure></p>\n<p>网络防火墙策略占用的端口：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">服务名称/用途\t占用端口\t协议\tINPUT规则\tOUTPUT规则</span><br><span class=\"line\">在线升级\t80\tTCP\tDENY\tACCEPT</span><br><span class=\"line\">Nginx\t443\tTCP\tACCEPT\tACCEPT</span><br><span class=\"line\">NPAI V2\t5002,5003,50071\tTCP\tACCEPT\tDENY</span><br><span class=\"line\">NPAI V3\t5050\tTCP\tACCEPT\tACCEPT</span><br><span class=\"line\">Cloud\t5553\tTCP\tDENY\tACCEPT</span><br><span class=\"line\">Redis 服务\t6379\tTCP\tACCEPT\tDENY</span><br><span class=\"line\">设备添加\t8081\tTCP\tACCEPT\tDENY</span><br><span class=\"line\">Kafka\t9092\tTCP\tACCEPT\tDENY</span><br><span class=\"line\">Dubbo服务\t20980\tTCP\tACCEPT\tACCEPT</span><br><span class=\"line\">级联服务\t20001\tTCP\tACCEPT\tACCEPT</span><br><span class=\"line\">Dubbo服务\t8092, 20990\tTCP\tACCEPT\tDENY</span><br><span class=\"line\">采集器添加\t8093,20981\tTCP\tDENY\tACCEPT</span><br><span class=\"line\">FTP存储服务\t50061\tTCP\tACCEPT\tDENY</span><br></pre></td></tr></table></figure><br>准备工作：<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413202146.png\" alt=\"WeiyiGeek\" title=\"\" class=\"\">\n                <p>WeiyiGeek</p>\n            </figure></p>\n<p>安装流程步骤：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Step0：软件上传</span><br><span class=\"line\">mkdir /home/ESP                       创建光盘文件拷贝目录</span><br><span class=\"line\">mkdir /home/iso                       <span class=\"comment\">#创建光盘挂载目录</span></span><br><span class=\"line\">mount -t iso9660 /dev/cdrom /home/iso <span class=\"comment\">#将光盘挂载到/home/iso目录</span></span><br><span class=\"line\">ls /home/iso  &amp; <span class=\"built_in\">cd</span> /home/iso        <span class=\"comment\">#显示光盘中数据和文件 #进入/home/iso目录</span></span><br><span class=\"line\">cp -r * /home/ESP/                    <span class=\"comment\">#拷贝光盘中所有文件到/home/ESP/目录</span></span><br><span class=\"line\">umount /home/iso/                         <span class=\"comment\">#完成拷贝后，取消光盘挂载</span></span><br><span class=\"line\"></span><br><span class=\"line\">Step1：进行安装NESP</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /home/ESP/Install                           <span class=\"comment\">#进入安装脚本所在目录</span></span><br><span class=\"line\">chmod 777 ESP.centos_x86_64-11242.run           <span class=\"comment\">#修改安装脚本权限</span></span><br><span class=\"line\">./ESP.centos_x86_64-11242.run    </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Step2：以配置中国时区为例</span><br><span class=\"line\">vi /etc/sysconfig/clock <span class=\"comment\">#编辑clock文件</span></span><br><span class=\"line\">ZONE=Asia/Shanghai <span class=\"comment\">#将时区设置为中国上海</span></span><br><span class=\"line\">UTC=<span class=\"literal\">false</span> <span class=\"comment\">#禁用UTC</span></span><br><span class=\"line\">ARC=<span class=\"literal\">false</span> <span class=\"comment\">#禁用ARC</span></span><br><span class=\"line\">:wq <span class=\"comment\">#保存并退出编辑后的文件</span></span><br><span class=\"line\">rm /etc/localtime <span class=\"comment\">#删除时区信息</span></span><br><span class=\"line\">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime <span class=\"comment\">#链接到时区文件</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">step3.重启系统后登录</span><br><span class=\"line\">b.配置主机时间。</span><br><span class=\"line\">−从NTP服务器同步时间。</span><br><span class=\"line\">ntpdate time.nist.gov <span class=\"comment\">#同步时间</span></span><br><span class=\"line\">−手动配置时间。</span><br><span class=\"line\">date –s <span class=\"string\">\"2016-08-30 14:00:00\"</span> <span class=\"comment\">#手动修改系统时间</span></span><br><span class=\"line\">clock -w                           </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Step4.导入证书及其部署</span><br><span class=\"line\">利用账户进行登陆进行系统更改默认密码：admin / admin,完成安装</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413202455.png\" alt=\"WeiyiGeek.导入证书\" title=\"\" class=\"\">\n                <p>WeiyiGeek.导入证书</p>\n            </figure></p>\n<h4 id=\"2-入坑案例\"><a href=\"#2-入坑案例\" class=\"headerlink\" title=\"2.入坑案例\"></a>2.入坑案例</h4><p><strong>0x00）堡垒机OSMS-SSH认证设置</strong><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413214329.png\" alt=\"WeiyiGeek.ssh设置\" title=\"\" class=\"\">\n                <p>WeiyiGeek.ssh设置</p>\n            </figure><br>step3 设置好堡垒机ip地址和端口<br>step4 设置登录账号（堡垒机用户账号密码）和键盘认证模式（非常重要）：<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413214458.png\" alt=\"WeiyiGeek.keyboard\" title=\"\" class=\"\">\n                <p>WeiyiGeek.keyboard</p>\n            </figure><br>step5 全部设置好后登录ssh即可：<br>登录后进行寻选择字符编码，设备选择，设置协议选择，然后输入运维机器的账号密码（如：root password）<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413214521.png\" alt=\"WeiyiGeek.nsfocuslogin\" title=\"\" class=\"\">\n                <p>WeiyiGeek.nsfocuslogin</p>\n            </figure></p>\n<p><br></p>\n<p><strong>0x01）绿盟软件ESPC启动案例</strong><br>登录到linux服务器中进行登录：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#查看数据库</span></span><br><span class=\"line\">vim /opt/nsfocus/espc/conf/service/jdbc.properties</span><br><span class=\"line\"> root      hooligan@123</span><br><span class=\"line\">    </span><br><span class=\"line\">/opt/nsfocus/espc/bin/postgressd restart</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\">#启动Postgress</span></span><br><span class=\"line\">/opt/nsfocus/espc/deps/env/bin/psql -U espcpostgress -d espc -h 127.0.0.1 -p 5432</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#启动服务</span></span><br><span class=\"line\">/etc/rc.d/init.d/espc &#123;start|stop|restart|uninstall&#125;</span><br><span class=\"line\">/opt/nsfocus/espc/bin/aserver-new-start.sh</span><br></pre></td></tr></table></figure></p>\n<p><em>Q：部署时候无法导入证书问题？</em><br>注意：需要注意服务器时间，时区，以及当前解析的文件；<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413214846.png\" alt=\"WeiyiGeek.导入证书问题\" title=\"\" class=\"\">\n                <p>WeiyiGeek.导入证书问题</p>\n            </figure></p>\n<p><em>Q：ESPC 403跳转错误？</em><br>解决办法：将LicenseFilter.class覆盖到下面的目录之中<br>/opt/nsfocus/espc/platform/proxy/ROOT/WEB-INF/classes/com/nsfocus/filter/auth/<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413215037.png\" alt=\"WeiyiGeek.403\" title=\"\" class=\"\">\n                <p>WeiyiGeek.403</p>\n            </figure></p>\n<p><br></p>\n<p><strong>0x02) 绿盟HWAF忘记密码恢复配置</strong><br>配置文件地址：C:/programfiles/nsfocus/mp-wafsl/UI/web/app/config/users.json文件<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#weboper weboper</span></span><br><span class=\"line\"><span class=\"comment\">#md5 加密方式</span></span><br><span class=\"line\">&#123;<span class=\"string\">\"webaudit\"</span>:&#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"-\"</span>,<span class=\"string\">\"password\"</span>:<span class=\"string\">\"832612fa25d8cccd30db41d3d6f7e5e0\"</span>,<span class=\"string\">\"ip\"</span>:<span class=\"string\">\"*\"</span>,<span class=\"string\">\"mail\"</span>:<span class=\"string\">\"hwaf@nsfocus.com\"</span>,<span class=\"string\">\"roles\"</span>:[<span class=\"string\">\"AUDITORS\"</span>],<span class=\"string\">\"isSystem\"</span>:<span class=\"string\">\"1\"</span>,<span class=\"string\">\"lastpwd\"</span>:<span class=\"string\">\"832612fa25d8cccd30db41d3d6f7e5e0\"</span>,<span class=\"string\">\"modtime\"</span>:<span class=\"number\">1256037410</span>,<span class=\"string\">\"status\"</span>:true&#125;,</span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"string\">\"weboper\"</span>:&#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"-\"</span>,<span class=\"string\">\"password\"</span>:<span class=\"string\">\"216c6786c2850781bee10461a56cb6b5\"</span>,<span class=\"string\">\"ip\"</span>:<span class=\"string\">\"*\"</span>,<span class=\"string\">\"mail\"</span>:<span class=\"string\">\"hwaf@nsfocus.com\"</span>,<span class=\"string\">\"roles\"</span>:[<span class=\"string\">\"OPERATORS\"</span>],<span class=\"string\">\"isSystem\"</span>:<span class=\"string\">\"1\"</span>,</span><br><span class=\"line\"><span class=\"string\">\"lastpwd\"</span>:<span class=\"string\">\"216c6786c2850781bee10461a56cb6b5\"</span>,<span class=\"string\">\"modtime\"</span>:<span class=\"number\">1256037262</span>,<span class=\"string\">\"status\"</span>:true&#125;,</span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"string\">\"webpolicy\"</span>:&#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"-\"</span>,<span class=\"string\">\"password\"</span>:<span class=\"string\">\"16b0b09a6b3e46845a3f3e7b49ae85f1\"</span>,<span class=\"string\">\"ip\"</span>:<span class=\"string\">\"*\"</span>,<span class=\"string\">\"mail\"</span>:<span class=\"string\">\"hwaf@nsfocus.com\"</span>,<span class=\"string\">\"roles\"</span>:[<span class=\"string\">\"POLICYORS\"</span>],<span class=\"string\">\"isSystem\"</span>:<span class=\"string\">\"1\"</span>,<span class=\"string\">\"lastpwd\"</span>:<span class=\"string\">\"16b0b09a6b3e46845a3f3e7b49ae85f1\"</span>,<span class=\"string\">\"modtime\"</span>:<span class=\"number\">1256037637</span>,<span class=\"string\">\"status\"</span>:true&#125;&#125;</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190413215149.png\" alt=\"WeiyiGeek.HWAF默认密码\" title=\"\" class=\"\">\n                <p>WeiyiGeek.HWAF默认密码</p>\n            </figure><br><br></p>\n<p><strong>0x03) 绿盟ESPC(软件)忘记密码恢复配置</strong><br>配置文件地址：D:\\Program Files (x86)\\nSC\\web\\app\\config\\user.json<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># admin:auditor</span></span><br><span class=\"line\"><span class=\"comment\"># sha1加密方式: fb2d634f1868a1353228c05cf0bd1273c612f10e ： auditor</span></span><br><span class=\"line\">    </span><br><span class=\"line\">&#123;<span class=\"string\">\"admin\"</span>:&#123;<span class=\"string\">\"historyPwd\"</span>:<span class=\"string\">\"\"</span>,<span class=\"string\">\"password\"</span>:<span class=\"string\">\"fb2d634f1868a1353228c05cf0bd1273c612f10e\"</span>,<span class=\"string\">\"name\"</span>:<span class=\"string\">\"admin\"</span>,<span class=\"string\">\"roles\"</span>:[<span class=\"string\">\"ADMINISTRATORS\"</span>],<span class=\"string\">\"pwdTime\"</span>:<span class=\"number\">1489582423</span>,<span class=\"string\">\"validateType\"</span>:[<span class=\"string\">\"local\"</span>],<span class=\"string\">\"firstLogin\"</span>:false,<span class=\"string\">\"fingerprint\"</span>:[],<span class=\"string\">\"mail\"</span>:<span class=\"string\">\"\"</span>,<span class=\"string\">\"isSystem\"</span>:true,<span class=\"string\">\"ipRange\"</span>:<span class=\"string\">\"*.*.*.*\"</span>&#125;,</span><br><span class=\"line\"><span class=\"string\">\"operator\"</span>:&#123;<span class=\"string\">\"status\"</span>:false,<span class=\"string\">\"password\"</span>:<span class=\"string\">\"fe96dd39756ac41b74283a9292652d366d73931f\"</span>,<span class=\"string\">\"name\"</span>:<span class=\"string\">\"operator\"</span>,<span class=\"string\">\"roles\"</span>:[<span class=\"string\">\"OPERATORS\"</span>],<span class=\"string\">\"validateType\"</span>:[<span class=\"string\">\"local\"</span>],<span class=\"string\">\"firstLogin\"</span>:true,<span class=\"string\">\"fingerprint\"</span>:[],<span class=\"string\">\"mail\"</span>:<span class=\"string\">\"\"</span>,<span class=\"string\">\"isSystem\"</span>:true,<span class=\"string\">\"ipRange\"</span>:<span class=\"string\">\"*.*.*.*\"</span>&#125;,</span><br><span class=\"line\"><span class=\"string\">\"auditor\"</span>:&#123;<span class=\"string\">\"status\"</span>:false,<span class=\"string\">\"password\"</span>:<span class=\"string\">\"fb2d634f1868a1353228c05cf0bd1273c612f10e\"</span>,<span class=\"string\">\"name\"</span>:<span class=\"string\">\"auditor\"</span>,<span class=\"string\">\"roles\"</span>:[<span class=\"string\">\"AUDITORS\"</span>],<span class=\"string\">\"validateType\"</span>:[<span class=\"string\">\"local\"</span>],<span class=\"string\">\"firstLogin\"</span>:true,<span class=\"string\">\"fingerprint\"</span>:[],<span class=\"string\">\"mail\"</span>:<span class=\"string\">\"\"</span>,<span class=\"string\">\"isSystem\"</span>:true,<span class=\"string\">\"ipRange\"</span>:<span class=\"string\">\"*.*.*.*\"</span>&#125;&#125;</span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"安全设备","path":"api/categories/安全设备.json"}],"tags":[{"name":"Nsfocus","path":"api/tags/Nsfocus.json"}]}