{"title":"8.Goç¼–ç¨‹å¿«é€Ÿå…¥é—¨å­¦ä¹ ","slug":"ç¼–ç¨‹ä¸–ç•Œ/Go/8.Goç¼–ç¨‹å¿«é€Ÿå…¥é—¨å­¦ä¹ ","date":"2020-04-24T03:16:58.000Z","updated":"2022-03-29T05:39:06.303Z","url":"2020/4-24-597.html","path":"api/articles/2020/4-24-597.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211119224548.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211119233946.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211120144527.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211120152604.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211120160517.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211120164754.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211121132345.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211121123804.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211122150456.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211122165405.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211122210606.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"0x00-Goè¯­è¨€åŸºç¡€ä¹‹Socketç½‘ç»œç¼–ç¨‹\"><a href=\"#0x00-Goè¯­è¨€åŸºç¡€ä¹‹Socketç½‘ç»œç¼–ç¨‹\" class=\"headerlink\" title=\"0x00 Goè¯­è¨€åŸºç¡€ä¹‹Socketç½‘ç»œç¼–ç¨‹\"></a>0x00 Goè¯­è¨€åŸºç¡€ä¹‹Socketç½‘ç»œç¼–ç¨‹</h2><p>ç°åœ¨çš„æˆ‘ä»¬å‡ ä¹æ¯å¤©éƒ½åœ¨ä½¿ç”¨äº’è”ç½‘ï¼Œä½†æ˜¯ä½ çŸ¥é“ç¨‹åºæ˜¯å¦‚æœé€šè¿‡ç½‘ç»œäº’ç›¸é€šä¿¡å—ï¼Ÿ<br>æè¿°: ç›¸ä¿¡å¤§éƒ¨åˆ†äººé€šå¸¸æ˜¯ä¸€çŸ¥åŠè§£çš„ï¼Œä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ğŸ‘¨â€ğŸ’»â€ï¼Œå¯¹äºç½‘ç»œæ¨¡å‹ä½ åº”è¯¥äº†è§£ï¼ŒçŸ¥é“ç½‘ç»œåˆ°åº•æ˜¯æ€ä¹ˆè¿›è¡Œé€šä¿¡çš„ï¼Œè¿›è¡Œå·¥ä½œçš„ï¼Œä¸ºä»€ä¹ˆæœåŠ¡å™¨èƒ½å¤Ÿæ¥æ”¶åˆ°è¯·æ±‚ï¼Œåšå‡ºå“åº”ã€‚è¿™é‡Œé¢çš„åŸç†åº”è¯¥æ˜¯æ¯ä¸ª Web ç¨‹åºå‘˜åº”è¯¥äº†è§£çš„ã€‚</p>\n<p>æœ¬ç« æˆ‘ä»¬å°±ä¸€èµ·æ¥å­¦ä¹ ä¸‹Goè¯­è¨€ä¸­çš„ç½‘ç»œç¼–ç¨‹ï¼Œå…³äºç½‘ç»œç¼–ç¨‹å…¶å®æ˜¯ä¸€ä¸ªå¾ˆåºå¤§çš„é¢†åŸŸï¼Œæœ¬æ–‡åªæ˜¯ç®€å•çš„æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨netåŒ…è¿›è¡ŒTCPå’ŒUDPé€šä¿¡ã€‚</p>\n<h3 id=\"1-åŸºç¡€æ¦‚å¿µä»‹ç»\"><a href=\"#1-åŸºç¡€æ¦‚å¿µä»‹ç»\" class=\"headerlink\" title=\"1.åŸºç¡€æ¦‚å¿µä»‹ç»\"></a>1.åŸºç¡€æ¦‚å¿µä»‹ç»</h3><p>æè¿°: äº’è”ç½‘çš„æ ¸å¿ƒæ˜¯ä¸€ç³»åˆ—åè®®ï¼Œæ€»ç§°ä¸º<code>äº’è”ç½‘åè®®(Internet Protocol Suite)</code>ï¼Œæ­£æ˜¯è¿™ä¸€äº›åè®®è§„å®šäº†ç”µè„‘å¦‚ä½•è¿æ¥å’Œç»„ç½‘ï¼Œå¹¶é€šè¿‡å„ç§åè®®å®ç°ä¸åŒçš„åŠŸèƒ½, ä¸‹é¢ç®€å•ä»‹ç»ä¸€äº›åè®®æ¶‰åŠçš„åŸºç¡€çŸ¥è¯†æ¦‚å¿µã€‚</p>\n<p>æ­¤å¤„ä¸å¾—ä¸è€ç”Ÿé‡è°ˆ<code>OSIä¸ƒå±‚ç½‘ç»œæ¨¡å‹</code> ï¼ŒOSIæ˜¯å›½é™…æ ‡å‡†åŒ–ç»„ç»‡ 1984 æå‡ºçš„æ¨¡å‹æ ‡å‡†ï¼Œç®€ç§° OSI(Open Systems Interconnection Model)ï¼Œä¸»è¦ç»Ÿä¸€æ ‡å‡†æ¥è§„èŒƒç½‘ç»œåè®®è®©å„ä¸ªç¡¬ä»¶å‚å•†å¯ä»¥ååŒå·¥ä½œï¼Œç›¸ä¿¡å¦‚æœä½ å­¦ä¹ è¿‡ç½‘ç»œå·¥ç¨‹æˆ–è€…æ“ä½œç³»ç»Ÿæ–¹é¢çš„è¯¾ç¨‹è‡³å°‘ä½ æ˜¯äº†è§£å®ƒçš„ã€‚æ¯ä¸€å±‚éƒ½æœ‰è‡ªå·±çš„åŠŸèƒ½ï¼Œå°±åƒå»ºç­‘ç‰©ä¸€æ ·ï¼Œæ¯ä¸€å±‚éƒ½é ä¸‹ä¸€å±‚æ”¯æŒï¼Œé€šå¸¸ç”¨æˆ·æ¥è§¦åˆ°çš„åªæ˜¯æœ€ä¸Šé¢çš„é‚£ä¸€å±‚ã€‚</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211119224548.png\" alt=\"WeiyiGeek.OSIä¸ƒå±‚ç½‘ç»œä¸TCP/IPå››å±‚ç½‘ç»œæ¨¡å‹\" title=\"\" class=\"\">\n                <p>WeiyiGeek.OSIä¸ƒå±‚ç½‘ç»œä¸TCP/IPå››å±‚ç½‘ç»œæ¨¡å‹</p>\n            </figure>\n<p>å¦‚ä¸Šå›¾æ‰€ç¤ºæŒ‰ç…§ä¸åŒçš„æ¨¡å‹åˆ’åˆ†ä¼šæœ‰ä¸ç”¨çš„åˆ†å±‚ï¼Œä½†æ˜¯ä¸è®ºæŒ‰ç…§ä»€ä¹ˆæ¨¡å‹å»åˆ’åˆ†ï¼Œè¶Šå¾€ä¸Šçš„å±‚è¶Šé è¿‘ç”¨æˆ·ï¼Œè¶Šå¾€ä¸‹çš„å±‚è¶Šé è¿‘ç¡¬ä»¶ï¼Œåœ¨è½¯ä»¶å¼€å‘ä¸­æˆ‘ä»¬ä½¿ç”¨æœ€å¤šçš„æ˜¯ä¸Šå›¾ä¸­å°†äº’è”ç½‘åˆ’åˆ†ä¸ºäº”ä¸ªåˆ†å±‚çš„æ¨¡å‹ï¼Œå³<code>åº”ç”¨å±‚ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç‰©ç†å±‚</code>ã€‚</p>\n<p>ä¸‹é¢ç®€å•ä»‹ç»å„å±‚: (å¦‚æœ‰å…´è¶£æƒ³æ·±å…¥å­¦ä¹ çš„å¯ä»¥è‡ªè¡ŒGoogle)</p>\n<ul>\n<li><p>(1) ç‰©ç†å±‚ : å³é€šè¿‡æˆ‘ä»¬è®¡ç®—æœºæˆ–å…¶å®ƒè®¾å¤‡é€šè¿‡ç½‘ç»œç¡¬ä»¶ä¸å¤–ç•Œäº’è”ç½‘é€šä¿¡ï¼Œå®ƒä¸»è¦è§„å®šäº†ç½‘ç»œçš„ä¸€äº›ç”µæ°”ç‰¹æ€§ï¼Œä½œç”¨æ˜¯è´Ÿè´£ä¼ é€0å’Œ1çš„ç”µä¿¡å·(æ¯”ç‰¹æµ)ã€‚</p>\n<blockquote>\n<p>ä¾‹å¦‚ï¼š ä»¥å¤ªç½‘ã€æ— çº¿Lanã€PPPã€åŒç»çº¿ã€å…‰çº¤ã€æ— çº¿ã€‚</p>\n</blockquote>\n</li>\n<li><p>(2) æ•°æ®é“¾è·¯å±‚ : ç¡®å®šäº†ç‰©ç†å±‚ä¼ è¾“çš„0å’Œ1çš„åˆ†ç»„æ–¹å¼åŠä»£è¡¨çš„æ„ä¹‰, é€šè¿‡ä»¥å¤ªç½‘(Ethernet)çš„åè®®è§„å®šä¸€ç»„ç”µä¿¡å·æ„æˆä¸€ä¸ªæ•°æ®åŒ…ï¼Œå«åš<code>å¸§</code>(Frame)ã€‚</p>\n<blockquote>\n<p>æ¯ä¸€å¸§åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼šæ ‡å¤´(Head)å’Œæ•°æ®(Data)<br>Head : åŒ…å«æ•°æ®åŒ…çš„ä¸€äº›è¯´æ˜é¡¹ï¼Œæ¯”å¦‚å‘é€è€…<code>(MACåœ°å€)</code>ã€æ¥å—è€…<code>(MACåœ°å€)</code>ã€æ•°æ®ç±»å‹ç­‰ç­‰ï¼›(<code>å…¶é•¿åº¦å›ºå®šä¸º18å­—èŠ‚</code>)<br>Data : åˆ™æ˜¯æ•°æ®åŒ…çš„å…·ä½“å†…å®¹ã€‚(<code>å…¶é•¿åº¦ï¼Œæœ€çŸ­ä¸º46å­—èŠ‚ï¼Œæœ€é•¿ä¸º1500å­—èŠ‚</code>)<br>Tips: å› æ­¤æ•´ä¸ª<code>å¸§</code>æœ€çŸ­ä¸º64å­—èŠ‚ï¼Œæœ€é•¿ä¸º1518å­—èŠ‚, æ‰€ä»¥å¦‚æœæ•°æ®å¾ˆé•¿å°±å¿…é¡»åˆ†å‰²æˆå¤šä¸ªå¸§è¿›è¡Œå‘é€ã€‚</p>\n</blockquote>\n</li>\n</ul>\n<p><br/></p>\n<ul>\n<li>(3) ç½‘ç»œå±‚ : ä½¿å¾—æˆ‘ä»¬èƒ½å¤ŸåŒºåˆ†ä¸åŒçš„è®¡ç®—æœºæ˜¯å¦å±äºåŒä¸€ä¸ªå­ç½‘ç»œ(å­ç½‘)ï¼Œè¯¥åœ°å€å°±å«åš<code>ç½‘ç»œåœ°å€</code>(å³IPåœ°å€)ï¼Œæ­¤æ—¶æ¯å°è®¡ç®—æœºæœ‰äº†ä¸¤ç§åœ°å€ï¼Œä¸€ç§æ˜¯MACåœ°å€(ç¡¬ä»¶ç½‘å¡å”¯ä¸€æ ‡è¯†)ï¼Œå¦ä¸€ç§æ˜¯IPåœ°å€ã€‚<blockquote>\n<p>IPåœ°å€: åˆ™æ˜¯ç½‘ç»œç®¡ç†å‘˜åˆ†é…çš„ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç¡®å®šè®¡ç®—æœºæ‰€åœ¨çš„å­ç½‘ç»œï¼ŒMACåœ°å€åˆ™å°†æ•°æ®åŒ…é€åˆ°è¯¥å­ç½‘ç»œä¸­çš„ç›®æ ‡ç½‘å¡ã€‚<br>æ ¹æ®IPåè®®å‘é€çš„æ•°æ®å°±å«åš<code>IPæ•°æ®åŒ…</code>ï¼ŒIPæ•°æ®åŒ…ä¹Ÿåˆ†ä¸º<code>æ ‡å¤´</code>å’Œ<code>æ•°æ®</code>ä¸¤ä¸ªéƒ¨åˆ†ï¼š<br><code>æ ‡å¤´</code>éƒ¨åˆ†ä¸»è¦åŒ…æ‹¬ç‰ˆæœ¬ã€é•¿åº¦ã€IPåœ°å€ç­‰ä¿¡æ¯(<code>é•¿åº¦ä¸º20åˆ°60å­—èŠ‚</code>)<br><code>æ•°æ®</code>éƒ¨åˆ†åˆ™æ˜¯IPæ•°æ®åŒ…çš„å…·ä½“å†…å®¹ï¼Œæ•´ä¸ªæ•°æ®åŒ…çš„<code>æ€»é•¿åº¦æœ€å¤§ä¸º65535å­—èŠ‚</code>ã€‚</p>\n</blockquote>\n</li>\n</ul>\n<p><br/></p>\n<ul>\n<li>(4) ä¼ è¾“å±‚ : æœ‰äº†ä¸Šè¿°çš„MACåœ°å€å’ŒIPåœ°å€å¯ä»¥å°±å¯ä»¥åœ¨äº’è”ç½‘ä¸Šä»»æ„ä¸¤å°ä¸»æœºä¸Šå»ºç«‹é€šä¿¡ã€‚ä½†æ˜¯å¦‚æœæ˜¯è¦ä¸ä¸»æœºä¸ŠæŸä¸€ç¨‹åºè¿›è¡Œé€šä¿¡æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ª<code>ç«¯å£</code>(Port)ï¼Œä»è€Œä¾¿å¯ä»¥è®©ä¸¤ä¸ªç¨‹åºé€šè¿‡ç½‘ç»œè¿›è¡Œæ”¶å‘æ•°æ®ã€‚<blockquote>\n<p>IPå’Œç«¯å£æˆ‘ä»¬å°±èƒ½å®ç°å”¯ä¸€ç¡®å®šäº’è”ç½‘ä¸Šä¸€ä¸ªç¨‹åºï¼Œè¿›è€Œå®ç°ç½‘ç»œé—´çš„ç¨‹åºé€šä¿¡, æ­¤å¤–å¯ä»¥é€‰æ‹©å¸¸ç”¨çš„TCPæˆ–è€…UDPåè®®è¿›è¡Œé€šä¿¡ã€‚<br><code>ç«¯å£</code>: æ˜¯0åˆ°65535ä¹‹é—´çš„ä¸€ä¸ªæ•´æ•°ï¼Œæ­£å¥½16ä¸ªäºŒè¿›åˆ¶ä½ã€‚0åˆ°1023çš„ç«¯å£è¢«ç³»ç»Ÿå ç”¨ï¼Œç”¨æˆ·åªèƒ½é€‰ç”¨å¤§äº1023çš„ç«¯å£<br>TCP (<code>Transmission Control Protocol</code>): é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®®(<code>ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹å››å±‚æŒ¥æ‰‹</code>)ï¼Œç”±IETFçš„RFC 793å®šä¹‰ï¼ŒTCPæ•°æ®åŒ…æ²¡æœ‰é•¿åº¦é™åˆ¶ï¼Œç†è®ºä¸Šå¯ä»¥æ— é™é•¿ï¼Œä½†æ˜¯ä¸ºäº†ä¿è¯ç½‘ç»œçš„æ•ˆç‡ï¼Œé€šå¸¸TCPæ•°æ®åŒ…çš„é•¿åº¦ä¸ä¼šè¶…è¿‡IPæ•°æ®åŒ…çš„é•¿åº¦ï¼Œä»¥ç¡®ä¿å•ä¸ªTCPæ•°æ®åŒ…ä¸å¿…å†åˆ†å‰²ã€‚ (<code>ä¸»è¦ç”¨äºå¯¹é€šä¿¡çš„ä¿¡æ¯æ¯”è¾ƒé‡è¦çš„åœºæ™¯</code>)<br>UDP (<code>User Datagram Protocol</code>) : ä¸ºåº”ç”¨ç¨‹åºæä¾›äº†ä¸€ç§æ— éœ€å»ºç«‹è¿æ¥å°±å¯ä»¥å‘é€å°è£…çš„ IP æ•°æ®åŒ…çš„æ–¹æ³•,æˆ‘ä»¬å¯ä»¥æŒç»­çš„å‘é€ä¿¡æ¯ä½†å¹¶ä¸å…³å¿ƒå…¶æ˜¯å¦æ­£å¸¸åˆ°è¾¾, ç”±IETFçš„ RFC 768 å®šä¹‰, å…¶æ•°æ®åŒ…éå¸¸ç®€å•ï¼Œâ€æ ‡å¤´â€éƒ¨åˆ†ä¸€å…±åªæœ‰8ä¸ªå­—èŠ‚ï¼Œæ€»é•¿åº¦ä¸è¶…è¿‡65,535å­—èŠ‚ï¼Œæ­£å¥½æ”¾è¿›ä¸€ä¸ªIPæ•°æ®åŒ…ã€‚(<code>ä¸»è¦ç”¨äºè§†å±ç›´æ’­æµã€éå®æ—¶æ€§çš„æ§åˆ¶æŒ‡ä»¤å‘é€çš„åœºæ™¯</code>)</p>\n</blockquote>\n</li>\n</ul>\n<p><br/></p>\n<ul>\n<li>(5) åº”ç”¨å±‚ : â€åº”ç”¨å±‚â€çš„ä½œç”¨å°±æ˜¯è§„å®šåº”ç”¨ç¨‹åºä½¿ç”¨çš„æ•°æ®æ ¼å¼ï¼Œç”±äºäº’è”ç½‘æ˜¯å¼€æ”¾æ¶æ„ï¼Œæ•°æ®æ¥æºäº”èŠ±å…«é—¨ï¼Œå¿…é¡»äº‹å…ˆè§„å®šå¥½é€šä¿¡çš„æ•°æ®æ ¼å¼ï¼Œå¦åˆ™æ¥æ”¶æ–¹æ ¹æœ¬æ— æ³•è·å¾—çœŸæ­£å‘é€çš„æ•°æ®å†…å®¹ã€‚<blockquote>\n<p>ä¾‹å¦‚: æˆ‘ä»¬TCPåè®®ä¹‹ä¸Šå¸¸è§çš„Emailã€HTTPã€FTPç­‰åè®®ï¼Œè¿™äº›åè®®å°±ç»„æˆäº†äº’è”ç½‘åè®®çš„åº”ç”¨å±‚ã€‚</p>\n</blockquote>\n</li>\n</ul>\n<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‘é€æ–¹çš„HTTPæ•°æ®ç»è¿‡äº’è”ç½‘çš„ä¼ è¾“è¿‡ç¨‹ä¸­ä¼šä¾æ¬¡æ·»åŠ å„å±‚åè®®çš„æ ‡å¤´ä¿¡æ¯ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®åŒ…ä¹‹åå†ä¾æ¬¡æ ¹æ®åè®®è§£åŒ…å¾—åˆ°æ•°æ®ã€‚</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211119233946.png\" alt=\"WeiyiGeek.ä¸€å¼ è§£é‡Šäº’è”ç½‘çš„ä¼ è¾“è¿‡ç¨‹çš„å›¾\" title=\"\" class=\"\">\n                <p>WeiyiGeek.ä¸€å¼ è§£é‡Šäº’è”ç½‘çš„ä¼ è¾“è¿‡ç¨‹çš„å›¾</p>\n            </figure>\n<p><br/></p>\n<p><strong>çŸ¥è¯†æ‰©å±•</strong></p>\n<p><em>Q:é‚£ä¹ˆï¼Œå‘é€è€…å’Œæ¥å—è€…æ˜¯å¦‚ä½•æ ‡è¯†å‘¢ï¼Ÿ</em><br>ç­”: ä»¥å¤ªç½‘è§„å®šï¼Œè¿å…¥ç½‘ç»œçš„æ‰€æœ‰è®¾å¤‡éƒ½å¿…é¡»å…·æœ‰<code>ç½‘å¡</code>æ¥å£ã€‚æ•°æ®åŒ…å¿…é¡»æ˜¯ä»ä¸€å—ç½‘å¡ï¼Œä¼ é€åˆ°å¦ä¸€å—ç½‘å¡ã€‚ç½‘å¡çš„åœ°å€ï¼Œå°±æ˜¯æ•°æ®åŒ…çš„å‘é€åœ°å€å’Œæ¥æ”¶åœ°å€ï¼Œè¿™å«åšMACåœ°å€ã€‚æ¯å—ç½‘å¡å‡ºå‚çš„æ—¶å€™ï¼Œéƒ½æœ‰ä¸€ä¸ªå…¨ä¸–ç•Œç‹¬ä¸€æ— äºŒçš„MACåœ°å€ï¼Œé•¿åº¦æ˜¯48ä¸ªäºŒè¿›åˆ¶ä½ï¼Œé€šå¸¸ç”¨12ä¸ªåå…­è¿›åˆ¶æ•°è¡¨ç¤ºä¾‹å¦‚<code>00-FF-81-D5-15-F8</code>ã€‚<code>å‰6ä¸ªåå…­è¿›åˆ¶æ•°æ˜¯å‚å•†ç¼–å·ï¼Œå6ä¸ªæ˜¯è¯¥å‚å•†çš„ç½‘å¡æµæ°´å·</code>, æ­¤æ—¶æœ‰äº†MACåœ°å€å°±å¯ä»¥å®šä½ç½‘å¡å’Œæ•°æ®åŒ…çš„è·¯å¾„äº†ã€‚</p>\n<p><br></p>\n<p><em>Q: æœ‰äº†MACåœ°å€ä¹‹åï¼Œå¦‚ä½•æŠŠæ•°æ®å‡†ç¡®çš„å‘é€ç»™æ¥æ”¶æ–¹å‘¢ï¼Ÿ</em><br>æè¿°: é¦–å…ˆé€šè¿‡ARPåè®®æ¥è·å–æ¥å—æ–¹çš„MACåœ°å€, ç„¶åé€šè¿‡<code>å¹¿æ’­</code>(broadcasting)çš„æ–¹å¼ï¼Œå‘æœ¬ç½‘ç»œå†…æ‰€æœ‰è®¡ç®—æœºéƒ½å‘é€ï¼Œè®©æ¯å°è®¡ç®—æœºè¯»å–è¿™ä¸ªåŒ…çš„<code>æ ‡å¤´</code>ï¼Œæ‰¾åˆ°æ¥æ”¶æ–¹çš„MACåœ°å€ï¼Œç„¶åä¸è‡ªèº«çš„MACåœ°å€ç›¸æ¯”è¾ƒï¼Œå¦‚æœä¸¤è€…ç›¸åŒå°±æ¥å—è¿™ä¸ªåŒ…ï¼Œåšè¿›ä¸€æ­¥å¤„ç†ï¼Œå¦åˆ™å°±ä¸¢å¼ƒè¿™ä¸ªåŒ…ã€‚</p>\n<p><em>Q: ç½‘ç»œåœ°å€çš„åè®®?</em><br>æè¿°: è§„å®šç½‘ç»œåœ°å€çš„åè®®å«åšIPåè®®,ç›®å‰ï¼Œå¹¿æ³›é‡‡ç”¨çš„æ˜¯IPåè®®ç¬¬å››ç‰ˆï¼Œç®€ç§°IPv4ã€‚IPv4è¿™ä¸ªç‰ˆæœ¬è§„å®šï¼Œç½‘ç»œåœ°å€ç”±32ä¸ªäºŒè¿›åˆ¶ä½ç»„æˆï¼Œæˆ‘ä»¬é€šå¸¸ä¹ æƒ¯ç”¨åˆ†æˆå››æ®µçš„åè¿›åˆ¶æ•°è¡¨ç¤ºIPåœ°å€ï¼Œä»<code>0.0.0.0~255.255.255.255</code>ï¼Œå½“ç„¶é‡Œé¢åŒ…å«ä¸‰ä¸ªç§æœ‰ç½‘æ®µï¼Œä»¥åŠä¿ç•™çš„ç½‘æ®µï¼Œæ­¤å¤„ä¸ç»†è®²çŸ¥é“å³å¯ã€‚</p>\n<p><br/></p>\n<h3 id=\"2-Socket-åŸºç¡€ä»‹ç»\"><a href=\"#2-Socket-åŸºç¡€ä»‹ç»\" class=\"headerlink\" title=\"2.Socket åŸºç¡€ä»‹ç»\"></a>2.Socket åŸºç¡€ä»‹ç»</h3><p>å…¶å®å­¦ä¹ å…¶å®ƒå¼€å‘è¯­è¨€ä½ å°†ä¼šå‘ç°, åŸºæœ¬é«˜çº§è¯­è¨€ä¸­éƒ½æœ‰ä¸“é—¨è¿›è¡Œç½‘ç»œé€šä¿¡çš„åŒ…æ¥æä¾›ä¸¤ä¸ªç¨‹åºçš„ç½‘ç»œé€šä¿¡, é€šå¸¸é’ˆå¯¹ç¨‹åºç½‘ç»œé€šä¿¡çš„å¼€å‘éƒ½æè¿°ä¸ºSocketç¼–ç¨‹ã€‚</p>\n<p><strong>Q: ä»€ä¹ˆæ˜¯Socketç¼–ç¨‹?</strong><br>æè¿°: Socket(<code>ä¹Ÿç§°ä½œâ€å¥—æ¥å­—â€</code>)æ˜¯<code>BSD UNIX</code>çš„è¿›ç¨‹é€šä¿¡æœºåˆ¶ï¼Œç”¨äºæè¿°IPåœ°å€å’Œç«¯å£æ˜¯ä¸€ä¸ªé€šä¿¡é“¾çš„å¥æŸ„,<code>Socketå¯ç†è§£ä¸ºTCP/IPç½‘ç»œçš„API</code>ï¼Œå®ƒå®šä¹‰äº†è®¸å¤šå‡½æ•°æˆ–ä¾‹ç¨‹ï¼Œç¨‹åºå‘˜å¯ä»¥ç”¨å®ƒä»¬æ¥å¼€å‘TCP/IPç½‘ç»œä¸Šçš„åº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬è®¡ç®—æœºè¿è¡Œçš„åº”ç”¨ç¨‹åºé€šå¸¸é€šè¿‡<code>&quot;å¥—æ¥å­—&quot;</code>å‘ç½‘ç»œå‘å‡ºè¯·æ±‚æˆ–è€…åº”ç­”ç½‘ç»œè¯·æ±‚ã€‚</p>\n<p>Socket æ˜¯<code>åº”ç”¨å±‚</code>ä¸<code>ä¼ è¾“å±‚(TCP/IPåè®®æ—)</code>é€šä¿¡çš„ä¸­é—´è½¯ä»¶æŠ½è±¡å±‚ï¼Œåœ¨è®¾è®¡æ¨¡å¼ä¸­Socketå…¶å®å°±æ˜¯ä¸€ä¸ªé—¨é¢æ¨¡å¼ï¼Œå®ƒæŠŠå¤æ‚çš„TCP/IPåè®®æ—éšè—åœ¨Socketåé¢ï¼Œå¯¹ç”¨æˆ·æ¥è¯´åªéœ€è¦è°ƒç”¨Socketè§„å®šçš„ç›¸å…³å‡½æ•°ï¼Œè®©Socketå»ç»„ç»‡ç¬¦åˆæŒ‡å®šçš„åè®®æ•°æ®ç„¶åè¿›è¡Œé€šä¿¡ã€‚</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211120144527.png\" alt=\"WeiyiGeek.Socketå›¾è§£\" title=\"\" class=\"\">\n                <p>WeiyiGeek.Socketå›¾è§£</p>\n            </figure>\n<p><br/></p>\n<h3 id=\"3-Goå®ç°C-Sç«¯TCPé€šä¿¡\"><a href=\"#3-Goå®ç°C-Sç«¯TCPé€šä¿¡\" class=\"headerlink\" title=\"3.Goå®ç°C/Sç«¯TCPé€šä¿¡\"></a>3.Goå®ç°C/Sç«¯TCPé€šä¿¡</h3><p>æè¿°: TCP/IP<code>(Transmission Control Protocol/Internet Protocol)</code>å³ä¼ è¾“æ§åˆ¶åè®®/ç½‘é—´åè®®ï¼Œæ˜¯ä¸€ç§é¢å‘è¿æ¥<code>(è¿æ¥å¯¼å‘)</code>çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚<code>(Transport layer)</code>é€šä¿¡åè®®ï¼Œå› ä¸ºæ˜¯é¢å‘è¿æ¥çš„åè®®ï¼Œæ•°æ®åƒæ°´æµä¸€æ ·ä¼ è¾“ï¼Œä½†å®ƒä¼šå­˜åœ¨é»åŒ…é—®é¢˜(å°†ä¼šåœ¨åç»­æ¼”ç¤ºè§£å†³æ–¹æ¡ˆ)ã€‚</p>\n<h4 id=\"1-TCP-æœåŠ¡ç«¯\"><a href=\"#1-TCP-æœåŠ¡ç«¯\" class=\"headerlink\" title=\"1) TCP æœåŠ¡ç«¯\"></a>1) TCP æœåŠ¡ç«¯</h4><p>æè¿°: é€šå¸¸ä¸€ä¸ªTCPæœåŠ¡ç«¯å¯ä»¥åŒæ—¶è¿æ¥å¾ˆå¤šä¸ªå®¢æˆ·ç«¯ï¼Œä¾‹å¦‚ä¸–ç•Œå„åœ°çš„ç”¨æˆ·ä½¿ç”¨è‡ªå·±ç”µè„‘ä¸Šçš„æµè§ˆå™¨è®¿é—®æ·˜å®ç½‘ã€äº¬ä¸œå•†åŸã€‚</p>\n<p>ç”±äºGoè¯­è¨€ä¸­åˆ›å»ºå¤šä¸ªgoroutineå®ç°å¹¶å‘éå¸¸æ–¹ä¾¿å’Œé«˜æ•ˆï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¯å»ºç«‹ä¸€æ¬¡é“¾æ¥å°±åˆ›å»ºä¸€ä¸ªgoroutineå»å¤„ç†ã€‚</p>\n<p><strong>TCPæœåŠ¡ç«¯ç¨‹åºå¸¸è§„æµç¨‹ï¼š</strong><br>1.è®¾ç½®ç›‘å¬ç½‘ç»œåœ°å€ä¸ç«¯å£<br>2.æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚å»ºç«‹é“¾æ¥<br>3.åˆ›å»ºgoroutineå¤„ç†é“¾æ¥</p>\n<p><br/></p>\n<p>åœ¨Goè¯­è¨€ä¸­çš„å¯ä»¥é‡‡ç”¨netåŒ…æ¥å®ç°çš„TCPæœåŠ¡ç«¯çš„åˆ›å»º,ä¸‹è¿°ç½—åˆ—å‡ºnetåŒ…ä¸­ä½¿ç”¨çš„ç›¸å…³æ–¹æ³•åŸå‹:</p>\n<ul>\n<li><code>func net.Listen(network string, address string) (net.Listener, error)</code> : æŒ‡å®šé€šä¿¡åè®®ç±»å‹ç‰ˆæœ¬ã€æœ¬åœ°ç½‘ç»œåœ°å€å’Œé€šä¿¡ç«¯å£è¿›è¡Œç›‘å¬,æ³¨æ„ networkå‚æ•°å€¼å¿…é¡»æ˜¯<code>â€œtcpâ€ã€â€œtcp4â€ã€â€œtcp6â€ã€â€œunixâ€æˆ–â€œunixpacketâ€</code>ä¹‹ä¸€ã€‚</li>\n<li><code>func (net.Listener).Accept() (net.Conn, error)</code> : ç­‰å¾…Listenerå¯¹è±¡å¹¶è¿”å›åˆ°ä¾¦å¬å™¨çš„ä¸‹ä¸€ä¸ªè¿æ¥ã€‚</li>\n<li><code>func (net.Conn).Read(b []byte) (n int, err error)</code> : ä»æœåŠ¡ç«¯æˆ–è€…å®¢æˆ·ç«¯è¿æ¥ä¸­è¯»å–æ•°æ®ã€‚</li>\n</ul>\n<p><br></p>\n<h4 id=\"2-TCP-å®¢æˆ·ç«¯\"><a href=\"#2-TCP-å®¢æˆ·ç«¯\" class=\"headerlink\" title=\"2) TCP å®¢æˆ·ç«¯\"></a>2) TCP å®¢æˆ·ç«¯</h4><p>TCPå®¢æˆ·ç«¯è¿›è¡ŒTCPé€šä¿¡çš„æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š<br>1.ä¸æœåŠ¡ç«¯çš„å»ºç«‹é“¾æ¥<br>2.ä¸æœåŠ¡ç«¯è¿›è¡Œæ•°æ®æ”¶å‘<br>3.å…³é—­ä¸æœåŠ¡ç«¯çš„é“¾æ¥</p>\n<p>ä¸‹è¿°ç½—åˆ—å‡ºnetåŒ…ä¸­Tcpå®¢æˆ·ç«¯åˆ›å»ºä½¿ç”¨çš„ç›¸å…³æ–¹æ³•åŸå‹:</p>\n<ul>\n<li><code>func net.Dial(network string, address string) (net.Conn, error)</code> : å®¢æˆ·ç«¯è¿æ¥åˆ°æŒ‡å®šç½‘ç»œä¸Šçš„åœ°å€, åŒæ · networks å‚æ•°å¯é€‰å€¼å¦‚ä¸‹<code>&quot;tcp&quot;, &quot;tcp4&quot; (IPv4-only), &quot;tcp6&quot; (IPv6-only), &quot;udp&quot;, &quot;udp4&quot; (IPv4-only), &quot;udp6&quot; (IPv6-only), &quot;ip&quot;, &quot;ip4&quot; (IPv4-only), &quot;ip6&quot; (IPv6-only), &quot;unix&quot;, &quot;unixgram&quot; and &quot;unixpacket&quot;</code>.</li>\n<li><code>func (net.Conn).Write(b []byte) (n int, err error)</code> : å†™å…¥å°†æ•°æ®å†™å…¥è¿æ¥å³å‘é€ç»™è¿æ¥çš„ç½‘ç»œå¯¹è±¡ï¼Œå¹¶è¿”å›å‘é€çš„å­—èŠ‚æ•°ã€‚ï¼ˆæ³¨æ„ä¸­æ–‡å­—ç¬¦å 3å­—èŠ‚ï¼‰</li>\n<li><code>func (net.Conn).LocalAddr() net.Addr</code> : è·å–æœ¬åœ°å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡ç«¯çš„ç½‘ç»œåœ°å€ä¿¡æ¯ã€‚</li>\n</ul>\n<p><br></p>\n<p><strong>ç®€å•ç¤ºä¾‹1:TCP Serverç«¯ä¸Clientç«¯ä¸€æ¬¡é€šä¿¡ã€‚</strong><br>æœåŠ¡ç«¯: Server.go<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 1.è®¾ç½®æœåŠ¡ç«¯ç›‘å¬ç«¯å£</span></span><br><span class=\"line\">  address := <span class=\"string\">\"10.20.172.108:22022\"</span></span><br><span class=\"line\">  listener, err := net.Listen(<span class=\"string\">\"tcp\"</span>, address)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Start Tcp Server on %v Failed!\\nerrï¼š%v\\n\"</span>, address, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Server Listen : %v\\n\"</span>, address)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 2.ç­‰å¾…å®¢æˆ·ç«¯å»ºç«‹è¿æ¥</span></span><br><span class=\"line\">  conn, err := listener.Accept()</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Accept failed,err: %v\\n\"</span>, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">defer</span> conn.Close() <span class=\"comment\">// ç¨‹åºç»“æŸæ—¶,å…³é—­ä¸å®¢æˆ·ç«¯æ‰“å¼€çš„TCPè¿æ¥é€šé“</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 3.ä¸å®¢æˆ·ç«¯è¿›è¡Œæ¶ˆæ¯é€šä¿¡(è¯»å–å®¢æˆ·ç«¯æ³•è¿‡æ¥çš„ä¿¡æ¯)</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> msg [<span class=\"number\">1024</span>]<span class=\"keyword\">byte</span></span><br><span class=\"line\">  n, err := conn.Read(msg[:]) <span class=\"comment\">// æ³¨æ„è¯»å–çš„ç±»å‹æ˜¯byteçš„slice</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Read from Client conn failed, err:%v\\n\"</span>, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 4.æ‰“å°å®¢æˆ·ç«¯å‘é€çš„ä¿¡æ¯,æ³¨æ„æ­¤éœ€è¦å°†[]byteç±»å‹çš„åˆ‡ç‰‡,è½¬ä¸ºå­—ç¬¦ä¸²ç±»å‹è¿›è¡Œè¾“å‡º.</span></span><br><span class=\"line\">  fmt.Println(<span class=\"keyword\">string</span>(msg[:n]))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p>å®¢æˆ·ç«¯: Client.go<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 1.ä¸Serverç«¯å»ºç«‹TCPé€šä¿¡é“¾æ¥</span></span><br><span class=\"line\">  address := <span class=\"string\">\"10.20.172.108:22022\"</span></span><br><span class=\"line\">  conn, err := net.Dial(<span class=\"string\">\"tcp\"</span>, address)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Connect Server failed!\\nerr:%v\\n\"</span>, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 2.å‘é€å­—ç¬¦ä¸²æ•°æ®åˆ°Serverç«¯</span></span><br><span class=\"line\">  sendMsg := <span class=\"string\">\"Hello World! Server, I'm client\"</span></span><br><span class=\"line\">  conn.Write([]<span class=\"keyword\">byte</span>(sendMsg))</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 3.å…³é—­å»ºç«‹çš„TCPé€šä¿¡é“¾æ¥</span></span><br><span class=\"line\">  <span class=\"keyword\">defer</span> conn.Close()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>å°†ä¸Šé¢çš„ä»£ç ä¿å­˜ä¹‹ååˆ†åˆ«ç¼–è¯‘æˆserverå’Œclientå¯æ‰§è¡Œæ–‡ä»¶,å…·ä½“æ“ä½œå¦‚ä¸‹:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">âœ  Server go build</span><br><span class=\"line\">âœ  Server ./Server</span><br><span class=\"line\">Server Listen : 10.20.172.108:22022  </span><br><span class=\"line\"></span><br><span class=\"line\">âœ  Client go build</span><br><span class=\"line\">âœ  Client ./Client</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211120152604.png\" alt=\"WeiyiGeek.ç®€å•ç¤ºä¾‹1æ‰§è¡Œç»“æœ\" title=\"\" class=\"\">\n                <p>WeiyiGeek.ç®€å•ç¤ºä¾‹1æ‰§è¡Œç»“æœ</p>\n            </figure>\n<p><br></p>\n<p><strong>è¿›é˜¶ç¤ºä¾‹2: TCP Serverç«¯ä¸å¤šä¸ªClientç«¯æŒç»­é€šä¿¡ã€‚</strong><br>Server.go<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">\"bufio\"</span></span><br><span class=\"line\">  <span class=\"string\">\"fmt\"</span></span><br><span class=\"line\">  <span class=\"string\">\"io\"</span></span><br><span class=\"line\">  <span class=\"string\">\"net\"</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">SendReceiveProccess</span><span class=\"params\">(conn net.Conn)</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 3.ä¸å®¢æˆ·ç«¯è¿›è¡Œæ¶ˆæ¯é€šä¿¡(å¾ªç¯è¯»å–å®¢æˆ·ç«¯æ³•è¿‡æ¥çš„ä¿¡æ¯)</span></span><br><span class=\"line\">  <span class=\"keyword\">defer</span> conn.Close() <span class=\"comment\">// å…³é—­å½“å‰é“¾æ¥é€šä¿¡å¯¹è±¡</span></span><br><span class=\"line\">  reader := bufio.NewReader(conn)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> msg [<span class=\"number\">1024</span>]<span class=\"keyword\">byte</span> <span class=\"comment\">// æ¯æ¬¡è¯»å–1024B</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">    n, err := reader.Read(msg[:]) <span class=\"comment\">// æ³¨æ„è¯»å–çš„ç±»å‹æ˜¯byteçš„slice</span></span><br><span class=\"line\">    <span class=\"comment\">// æœ«å°¾æ ‡è¯†</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> err == io.EOF &#123;</span><br><span class=\"line\">      fmt.Printf(<span class=\"string\">\"Close conn %v\\n\"</span>, conn.RemoteAddr())</span><br><span class=\"line\">      <span class=\"keyword\">break</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// å¼‚å¸¸æ—¶break</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">      fmt.Printf(<span class=\"string\">\"Read from Client conn failed, Close conn %v\\n\"</span>, conn.RemoteAddr())</span><br><span class=\"line\">      <span class=\"keyword\">break</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    fmt.Println(conn.RemoteAddr(), <span class=\"string\">\"-&gt;\"</span>, <span class=\"keyword\">string</span>(msg[:n]))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å°†å®¢æˆ·ç«¯å‘é€çš„ä¿¡æ¯åˆè½¬å‘ç»™å®¢æˆ·ç«¯(è¿”å›å†™å…¥çš„å­—èŠ‚æ•°)</span></span><br><span class=\"line\">    _, err = conn.Write([]<span class=\"keyword\">byte</span>(msg[:n]))</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">      fmt.Printf(<span class=\"string\">\"Send failed, Close Client conn %v\\n\"</span>, conn.RemoteAddr())</span><br><span class=\"line\">      <span class=\"keyword\">break</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 1.è®¾ç½®ç›‘å¬ç«¯å£</span></span><br><span class=\"line\">  address := <span class=\"string\">\"10.20.172.108:22022\"</span></span><br><span class=\"line\">  listener, err := net.Listen(<span class=\"string\">\"tcp\"</span>, address)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Start Tcp Server on %v Failed!\\nerrï¼š%v\\n\"</span>, address, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Server Listen %v Start......\\n\"</span>, address)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">defer</span> listener.Close() <span class=\"comment\">// å…³é—­æœåŠ¡ç«¯ç›‘å¬</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 2.ç­‰å¾…å®¢æˆ·ç«¯å»ºç«‹è¿æ¥</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">    conn, err := listener.Accept()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">      fmt.Printf(<span class=\"string\">\"Accept failed,err: %v\\n\"</span>, err)</span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// ä¸åŒçš„å®¢æˆ·ç«¯åˆ©ç”¨Goroutineåˆ†é…ä¸åŒçš„çº¿ç¨‹è¿›è¡Œå“åº”ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">go</span> SendReceiveProccess(conn)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p>Client.go<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">\"bufio\"</span></span><br><span class=\"line\">  <span class=\"string\">\"fmt\"</span></span><br><span class=\"line\">  <span class=\"string\">\"net\"</span></span><br><span class=\"line\">  <span class=\"string\">\"os\"</span></span><br><span class=\"line\">  <span class=\"string\">\"strings\"</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 1.ä¸Serverç«¯å»ºç«‹TCPé“¾æ¥</span></span><br><span class=\"line\">  address := <span class=\"string\">\"10.20.172.108:22022\"</span></span><br><span class=\"line\">  conn, err := net.Dial(<span class=\"string\">\"tcp\"</span>, address)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Connect Server failed! \\n [err]: %v\\n\"</span>, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Connect Server %v successful!\\n\"</span>, address)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// é€€å‡ºé€šä¿¡è¿æ¥</span></span><br><span class=\"line\">  <span class=\"keyword\">defer</span> conn.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 2.å‘é€åˆå§‹è¿æ¥ä¿¡æ¯åˆ°Serverç«¯</span></span><br><span class=\"line\">  sendMsg := fmt.Sprintf(<span class=\"string\">\"Hello Server, I'm  %v client.\"</span>, conn.LocalAddr())</span><br><span class=\"line\">  inputReader := bufio.NewReader(os.Stdin) <span class=\"comment\">// å¤ä¹ ç‚¹</span></span><br><span class=\"line\">  conn.Write([]<span class=\"keyword\">byte</span>(sendMsg))</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 3.å¾ªç¯ä»æœåŠ¡ç«¯æ¥æ”¶ä»¥åŠä»ç»ˆç«¯è¾“å…¥å‘é€ä¿¡æ¯åˆ°æœåŠ¡ç«¯</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// æœåŠ¡ç«¯å›å¤çš„ä¿¡æ¯</span></span><br><span class=\"line\">    reply := [<span class=\"number\">1024</span>]<span class=\"keyword\">byte</span>&#123;&#125;</span><br><span class=\"line\">    n, err := conn.Read(reply[:])</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">      fmt.Println(<span class=\"string\">\"recv failed, err:\"</span>, err)</span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Server &gt; %v\\n\"</span>, <span class=\"keyword\">string</span>(reply[:n]))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å®¢æˆ·ç«¯è¾“å…¥å­—ç¬¦ä¸²ä¿¡æ¯</span></span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"è¯·è¾“å…¥æ¶ˆæ¯:\"</span>)</span><br><span class=\"line\">    sendMsg, _ = inputReader.ReadString(<span class=\"string\">'\\n'</span>) <span class=\"comment\">// å¤ä¹ ç‚¹ (ä»¥\\næˆªè‡³è¯»å–)</span></span><br><span class=\"line\">    sendMsg = strings.TrimSpace(sendMsg)      <span class=\"comment\">// å¤ä¹ ç‚¹ å¤„ç†è¾“å…¥å­—ç¬¦ä¸²çš„å‰åç©ºæ ¼</span></span><br><span class=\"line\">    sendMsg = strings.Trim(sendMsg, <span class=\"string\">\"\\n\"</span>)     <span class=\"comment\">// å¤ä¹ ç‚¹ å¤„ç†è¾“å…¥å­—ç¬¦ä¸²çš„æœ€åçš„æ¢è¡Œç¬¦</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ä½†å®¢æˆ·ç«¯è¾“å…¥quitåˆ™é€€å‡ºä¸æœåŠ¡ç«¯å»ºç«‹çš„TCPé€šä¿¡è¿æ¥.</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> strings.ToUpper(sendMsg) == <span class=\"string\">\"QUIT\"</span> &#123;</span><br><span class=\"line\">      fmt.Printf(<span class=\"string\">\"exit conn.......\"</span>)</span><br><span class=\"line\">      <span class=\"keyword\">break</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å‘é€å·²ç»å¤„ç†è¿‡åçš„ä¿¡æ¯åˆ°æœåŠ¡ç«¯</span></span><br><span class=\"line\">    _, err = conn.Write([]<span class=\"keyword\">byte</span>(sendMsg))</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br>Server.goä¸Client.goç¼–è¯‘&amp;è¿è¡Œ&amp;æ‰§è¡Œç»“æœ:<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">go</span> build &amp;&amp; ./Server</span><br><span class=\"line\"><span class=\"keyword\">go</span> build &amp;&amp; ./Client</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211120160517.png\" alt=\"WeiyiGeek.è¿›é˜¶ç¤ºä¾‹2æ‰§è¡Œç»“æœ\" title=\"\" class=\"\">\n                <p>WeiyiGeek.è¿›é˜¶ç¤ºä¾‹2æ‰§è¡Œç»“æœ</p>\n            </figure></p>\n<p><br/></p>\n<h3 id=\"4-Goå®ç°C-Sç«¯UDPé€šä¿¡\"><a href=\"#4-Goå®ç°C-Sç«¯UDPé€šä¿¡\" class=\"headerlink\" title=\"4.Goå®ç°C/Sç«¯UDPé€šä¿¡\"></a>4.Goå®ç°C/Sç«¯UDPé€šä¿¡</h3><p>æè¿°: UDPåè®®ï¼ˆUser Datagram Protocolï¼‰ä¸­æ–‡åç§°æ˜¯ç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼Œæ˜¯<code>OSIï¼ˆOpen System Interconnectionï¼Œå¼€æ”¾å¼ç³»ç»Ÿäº’è”ï¼‰</code>å‚è€ƒæ¨¡å‹ä¸­ä¸€ç§æ— è¿æ¥çš„ä¼ è¾“å±‚åè®®ï¼Œä¸éœ€è¦å»ºç«‹è¿æ¥å°±èƒ½ç›´æ¥è¿›è¡Œæ•°æ®å‘é€å’Œæ¥æ”¶ï¼Œå±äºä¸å¯é çš„ã€æ²¡æœ‰æ—¶åºçš„é€šä¿¡ï¼Œä½†æ˜¯UDPåè®®çš„å®æ—¶æ€§æ¯”è¾ƒå¥½ï¼Œé€šå¸¸ç”¨äºè§†é¢‘ç›´æ’­ç›¸å…³é¢†åŸŸã€‚</p>\n<p>Tips : UDP é€šä¿¡ç›¸æ¯”è¾ƒäº TCP é€šä¿¡ä½¿ç”¨ç®€å•, ä¸‹è¿°æˆ‘å°†UDPæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å®ç°çš„ç›¸å…³æ–¹æ³•åŸå‹è¿›è¡Œå±•ç¤ºã€‚</p>\n<ul>\n<li><code>func net.ListenUDP(network string, laddr *net.UDPAddr) (*net.UDPConn, error)</code>: è®¾ç½®ç›‘å¬UDPç›¸å…³çš„ç½‘ç»œåœ°å€ä¸ç«¯å£ä¿¡æ¯ã€ç½‘ç»œå¿…é¡»æ˜¯UDPç½‘ç»œåç§°ã€‚</li>\n<li><code>func (*net.UDPConn).ReadFromUDP(b []byte) (int, *net.UDPAddr, error)</code>: æ¥æ”¶connå¯¹è±¡é‡Œå‘é€çš„ä¿¡æ¯, ReadFromUDPä¸ReadFromç±»ä¼¼ï¼Œä½†è¿”å›ä¸€ä¸ªUDPADDã€‚</li>\n<li><code>func (*net.UDPConn).WriteToUDP(b []byte, addr *net.UDPAddr) (int, error)</code>: å‘é€ä¿¡æ¯åˆ°connå¯¹è±¡é‡Œ, WriteToUDPçš„è¡Œä¸ºç±»ä¼¼äºWriteToï¼Œä½†ä½¿ç”¨UDPADDã€‚</li>\n<li><code>func net.DialUDP(network string, laddr *net.UDPAddr, raddr *net.UDPAddr) (*net.UDPConn, error)</code> : ä½œç”¨äºä¸UDPæœåŠ¡ç«¯å»ºç«‹è¿æ¥, DialUDPçš„ä½œç”¨ç±»ä¼¼äºUDPç½‘ç»œçš„æ‹¨å·ã€‚</li>\n</ul>\n<p><br/></p>\n<p><strong>è¿›é˜¶ç¤ºä¾‹1.å®ç°UDPæœåŠ¡ç«¯ä¸å¤šå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥é€šä¿¡!</strong><br>Server.go<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">\"fmt\"</span></span><br><span class=\"line\">  <span class=\"string\">\"net\"</span></span><br><span class=\"line\">  <span class=\"string\">\"strings\"</span></span><br><span class=\"line\">  <span class=\"string\">\"time\"</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 1.æœåŠ¡ç«¯å¼€å¯ç›‘å¬ UDP é€šä¿¡çš„ç›¸å…³è®¾ç½®</span></span><br><span class=\"line\">  server_ip := [<span class=\"number\">4</span>]<span class=\"keyword\">byte</span>&#123;<span class=\"number\">10</span>, <span class=\"number\">20</span>, <span class=\"number\">172</span>, <span class=\"number\">108</span>&#125;</span><br><span class=\"line\">  server_port := <span class=\"number\">30000</span></span><br><span class=\"line\">  conn, err := net.ListenUDP(<span class=\"string\">\"udp\"</span>, &amp;net.UDPAddr&#123;</span><br><span class=\"line\">    IP:   net.IPv4(server_ip[<span class=\"number\">0</span>], server_ip[<span class=\"number\">1</span>], server_ip[<span class=\"number\">2</span>], server_ip[<span class=\"number\">3</span>]),</span><br><span class=\"line\">    Port: server_port,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Listen UDP Server (%v:%v) Failed, err: %v\\n\"</span>, server_ip, server_port, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"[%v] Listening UDP Server %v:%v is successful!\\n\"</span>, time.Now().Format(<span class=\"string\">\"2006-01-02 15:04:05\"</span>), server_ip, server_port)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ç¨‹åºç»“æŸæ—¶å…³é—­connèµ„æº</span></span><br><span class=\"line\">  <span class=\"keyword\">defer</span> conn.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 2.å¾ªç¯æ¥æ”¶å’Œå“åº”æ•°æ®ç»™å®¢æˆ·ç«¯ï¼Œéå¸¸ä¸»è¦æ­¤å¤„ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œç›´æ¥æ”¶å‘æ•°æ®ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// è·å¾—å®¢æˆ·ç«¯é€šä¿¡å¯¹è±¡ä»¥åŠè¿”å›è¯»å–çš„å­—èŠ‚æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> recvMsg [<span class=\"number\">1024</span>]<span class=\"keyword\">byte</span></span><br><span class=\"line\">    count, addr, err := conn.ReadFromUDP(recvMsg[:]) <span class=\"comment\">// æ¥æ”¶æ•°æ®</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">      fmt.Println(<span class=\"string\">\"Read from UDP Client failed. Err:\"</span>, err)</span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// æ‰“å°å®¢æˆ·ç«¯å‘é€çš„ä¿¡æ¯åˆ°ç»ˆç«¯</span></span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"[%v] %v - %v\\n\"</span>, time.Now().Format(<span class=\"string\">\"2006-01-02 15:04:05\"</span>), addr.String(), <span class=\"keyword\">string</span>(recvMsg[:count<span class=\"number\">-1</span>]))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¹¶å°†æ¥æ”¶åˆ°çš„ä¿¡æ¯æ›´æ”¹ä¸ºå¤§å†™ï¼Œå†è¿”è¿˜ç»™Clientã€‚</span></span><br><span class=\"line\">    reply := strings.ToUpper(<span class=\"keyword\">string</span>(recvMsg[:count]))</span><br><span class=\"line\">    conn.WriteToUDP([]<span class=\"keyword\">byte</span>(reply), addr) <span class=\"comment\">// å‘é€æ•°æ®</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p>Client.go<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">\"bufio\"</span></span><br><span class=\"line\">  <span class=\"string\">\"fmt\"</span></span><br><span class=\"line\">  <span class=\"string\">\"net\"</span></span><br><span class=\"line\">  <span class=\"string\">\"os\"</span></span><br><span class=\"line\">  <span class=\"string\">\"strings\"</span></span><br><span class=\"line\">  <span class=\"string\">\"time\"</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// (1) ä¸æœåŠ¡ç«¯å»ºç«‹UDPé€šä¿¡é“¾æ¥</span></span><br><span class=\"line\">  server_ip := [<span class=\"number\">4</span>]<span class=\"keyword\">byte</span>&#123;<span class=\"number\">10</span>, <span class=\"number\">20</span>, <span class=\"number\">172</span>, <span class=\"number\">108</span>&#125;</span><br><span class=\"line\">  server_port := <span class=\"number\">30000</span></span><br><span class=\"line\">  socket, err := net.DialUDP(<span class=\"string\">\"udp\"</span>, <span class=\"literal\">nil</span>, &amp;net.UDPAddr&#123;</span><br><span class=\"line\">    IP:   net.IPv4(server_ip[<span class=\"number\">0</span>], server_ip[<span class=\"number\">1</span>], server_ip[<span class=\"number\">2</span>], server_ip[<span class=\"number\">3</span>]),</span><br><span class=\"line\">    Port: server_port,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Connect UDP Server (%v:%v) Failed! err: %v\\n\"</span>, server_ip, server_port, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"[%v] - Connect UDP Server %v:%v successful!\\n\"</span>, time.Now().Format(<span class=\"string\">\"2006-01-02 15:04:05\"</span>), server_ip, server_port)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// åŒæ ·å…³é—­å»ºç«‹çš„é€šä¿¡è¿æ¥</span></span><br><span class=\"line\">  <span class=\"keyword\">defer</span> socket.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// (2) å‘é€ä¸æ¥æ”¶æœåŠ¡ç«¯è¿”å›çš„ä¿¡æ¯</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> reply [<span class=\"number\">1024</span>]<span class=\"keyword\">byte</span></span><br><span class=\"line\">  inputData := bufio.NewReader(os.Stdin)</span><br><span class=\"line\">  <span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ç»ˆç«¯æ¥æ”¶è¾“å…¥è¦å‘é€çš„ç»™æœåŠ¡ç«¯çš„å†…å®¹</span></span><br><span class=\"line\">    fmt.Print(<span class=\"string\">\"&lt;- è¯·è¾“å…¥å°†è¦å‘é€çš„å†…å®¹:\"</span>)</span><br><span class=\"line\">    sendMsg, _ := inputData.ReadString(<span class=\"string\">'\\n'</span>)</span><br><span class=\"line\">    sendMsg = strings.TrimSpace(sendMsg) <span class=\"comment\">// å–æ¶ˆå­—ç¬¦ä¸²å‰åçš„ç©ºæ ¼</span></span><br><span class=\"line\">    socket.Write([]<span class=\"keyword\">byte</span>(sendMsg))        <span class=\"comment\">// å‘é€æ•°æ®</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">      fmt.Printf(<span class=\"string\">\"å‘é€æ•°æ®å¤±è´¥ï¼Œerr: %v\\n\"</span>, err)</span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// æ¥æ”¶æ¥è‡ªæœåŠ¡ç«¯çš„åé¦ˆçš„å†…å®¹</span></span><br><span class=\"line\">    count, _, err := socket.ReadFromUDP(reply[:]) <span class=\"comment\">// æ¥æ”¶æ•°æ®</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">      fmt.Printf(<span class=\"string\">\"æ¥æ”¶æ•°æ®å¤±è´¥, err: %v\\n\"</span>, err)</span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Server -&gt; [%v Bytes] %v \\n\"</span>, count, <span class=\"keyword\">string</span>(reply[:count]))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœ:<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211120164754.png\" alt=\"WeiyiGeek.å®ç°UDPæœåŠ¡ç«¯ä¸å¤šå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥é€šä¿¡!\" title=\"\" class=\"\">\n                <p>WeiyiGeek.å®ç°UDPæœåŠ¡ç«¯ä¸å¤šå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥é€šä¿¡!</p>\n            </figure></p>\n<p><br/></p>\n<h3 id=\"5-è¯¾å¤–çŸ¥è¯†æ‰©å±•\"><a href=\"#5-è¯¾å¤–çŸ¥è¯†æ‰©å±•\" class=\"headerlink\" title=\"5.è¯¾å¤–çŸ¥è¯†æ‰©å±•\"></a>5.è¯¾å¤–çŸ¥è¯†æ‰©å±•</h3><h4 id=\"1-TCP-é»åŒ…\"><a href=\"#1-TCP-é»åŒ…\" class=\"headerlink\" title=\"1) TCP é»åŒ…\"></a>1) TCP é»åŒ…</h4><p><strong>åœ¨è®²è§£TCPé»åŒ…å‰æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹TCPé»åŒ…ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜?</strong></p>\n<ul>\n<li>é»åŒ…ç¤ºä¾‹æœåŠ¡ç«¯ä»£ç å¦‚ä¸‹ï¼š</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">process</span><span class=\"params\">(conn net.Conn)</span></span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">defer</span> conn.Close()</span><br><span class=\"line\">  reader := bufio.NewReader(conn)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> buf [<span class=\"number\">1024</span>]<span class=\"keyword\">byte</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">    n, err := reader.Read(buf[:])</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err == io.EOF &#123;</span><br><span class=\"line\">      <span class=\"keyword\">break</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">      fmt.Println(<span class=\"string\">\"read from client failed, err:\"</span>, err)</span><br><span class=\"line\">      <span class=\"keyword\">break</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    recvStr := <span class=\"keyword\">string</span>(buf[:n])</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">\"æ”¶åˆ°clientå‘æ¥çš„æ•°æ®ï¼š\"</span>, recvStr)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  listen, err := net.Listen(<span class=\"string\">\"tcp\"</span>, <span class=\"string\">\"127.0.0.1:30000\"</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">\"listen failed, err:\"</span>, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">defer</span> listen.Close()</span><br><span class=\"line\">  <span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">    conn, err := listen.Accept()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">      fmt.Println(<span class=\"string\">\"accept failed, err:\"</span>, err)</span><br><span class=\"line\">      <span class=\"keyword\">continue</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">go</span> process(conn)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>é»åŒ…ç¤ºä¾‹å®¢æˆ·ç«¯ä»£ç å¦‚ä¸‹:</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  conn, err := net.Dial(<span class=\"string\">\"tcp\"</span>, <span class=\"string\">\"127.0.0.1:30000\"</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">\"dial failed, err\"</span>, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">defer</span> conn.Close()</span><br><span class=\"line\">  <span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; <span class=\"number\">20</span>; i++ &#123;</span><br><span class=\"line\">    msg := <span class=\"string\">`Hello, Hello. How are you?`</span></span><br><span class=\"line\">    conn.Write([]<span class=\"keyword\">byte</span>(msg))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å°†ä¸Šé¢çš„ä»£ç ä¿å­˜ååˆ†åˆ«ç¼–è¯‘, å…ˆå¯åŠ¨æœåŠ¡ç«¯ç„¶åå†å¯åŠ¨å®¢æˆ·ç«¯ï¼Œå¯ä»¥çœ‹åˆ°æœåŠ¡ç«¯è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">æ”¶åˆ°clientå‘æ¥çš„æ•°æ®ï¼š Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?</span><br><span class=\"line\">æ”¶åˆ°clientå‘æ¥çš„æ•°æ®ï¼š Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?</span><br><span class=\"line\">æ”¶åˆ°clientå‘æ¥çš„æ•°æ®ï¼š Hello, Hello. How are you?Hello, Hello. How are you?</span><br><span class=\"line\">æ”¶åˆ°clientå‘æ¥çš„æ•°æ®ï¼š Hello, Hello. How are you?Hello, Hello. How are you?Hello, Hello. How are you?</span><br><span class=\"line\">æ”¶åˆ°clientå‘æ¥çš„æ•°æ®ï¼š Hello, Hello. How are you?Hello, Hello. How are you?</span><br></pre></td></tr></table></figure></p>\n<p>ä»å®¢æˆ·ç«¯ç¤ºä¾‹ä»£ç ä¸­å¯ä»¥çœ‹è§å®¢æˆ·ç«¯åˆ†20æ¬¡å‘é€çš„æ•°æ®ï¼Œä½†æ˜¯åœ¨æœåŠ¡ç«¯å¹¶æ²¡æœ‰æˆåŠŸçš„è¾“å‡º20æ¬¡ï¼Œè€Œæ˜¯å¤šæ¡æ•°æ®â€œç²˜â€åˆ°äº†ä¸€èµ·ï¼Œè¿™å°±æ˜¯TCPé»åŒ…å¸¦æ¥çš„é—®é¢˜ã€‚</p>\n<p><br/></p>\n<p><strong>Q: æ­¤æ—¶å¯èƒ½ä¼šé—®ä¸ºä»€ä¹ˆä¼šå‡ºç°ç²˜åŒ…?</strong></p>\n<blockquote>\n<p>ç­”ï¼šä¸»è¦åŸå› å°±æ˜¯tcpæ•°æ®ä¼ é€’æ¨¡å¼æ˜¯æµæ¨¡å¼ï¼Œåœ¨ä¿æŒé•¿è¿æ¥çš„æ—¶å€™å¯ä»¥è¿›è¡Œå¤šæ¬¡çš„æ”¶å’Œå‘, è€ŒTCPé»åŒ…å¯ä»¥å‘ç”Ÿåœ¨åœ¨å‘é€ç«¯ä¹Ÿå¯å‘ç”Ÿåœ¨æ¥æ”¶ç«¯, ä¸»è¦æ˜¯ç”±äºNagleç®—æ³•å¯¼è‡´çš„ã€‚<br>Nagleç®—æ³•æ˜¯ä¸€ç§æ”¹å–„ç½‘ç»œä¼ è¾“æ•ˆç‡çš„ç®—æ³•ï¼Œ é€šå¸¸åœ¨å‘é€ç«¯ç”±äºNagleç®—æ³•å¯¼è‡´çš„é»åŒ…é—®é¢˜,è€Œæ¥æ”¶ç«¯æ¥æ”¶ä¸åŠæ—¶ä¹Ÿä¼šé€ æˆçš„æ¥æ”¶ç«¯ç²˜åŒ…ã€‚<br>å‘é€ç«¯: ç®€å•æ¥è¯´å°±æ˜¯å½“æˆ‘ä»¬æäº¤ä¸€æ®µæ•°æ®ç»™TCPå‘é€æ—¶ï¼ŒTCPå¹¶ä¸ç«‹åˆ»å‘é€æ­¤æ®µæ•°æ®ï¼Œè€Œæ˜¯ç­‰å¾…ä¸€å°æ®µæ—¶é—´çœ‹çœ‹åœ¨ç­‰å¾…æœŸé—´æ˜¯å¦è¿˜æœ‰è¦å‘é€çš„æ•°æ®ï¼Œè‹¥æœ‰åˆ™ä¼šä¸€æ¬¡æŠŠè¿™ä¸¤æ®µæ•°æ®å‘é€å‡ºå»ï¼Œæ‰€ä»¥è¯´Nagleç®—æ³•ç‰¹æ€§å…¶å¹¶ä¸é€‚ç”¨äºæŸäº›åœºæ™¯ã€‚<br>æ¥æ”¶ç«¯: TCPä¼šæŠŠæ¥æ”¶åˆ°çš„æ•°æ®å­˜åœ¨è‡ªå·±çš„ç¼“å†²åŒºä¸­ï¼Œç„¶åé€šçŸ¥åº”ç”¨å±‚å–æ•°æ®ã€‚å½“åº”ç”¨å±‚ç”±äºæŸäº›åŸå› ä¸èƒ½åŠæ—¶çš„æŠŠTCPçš„æ•°æ®å–å‡ºæ¥ï¼Œå°±ä¼šé€ æˆTCPç¼“å†²åŒºä¸­å­˜æ”¾äº†å‡ æ®µæ•°æ®ã€‚</p>\n</blockquote>\n<p><br/></p>\n<p><strong>Q: æœ‰ä½•è§£å†³åŠæ³•?</strong></p>\n<blockquote>\n<p>ç­”: å‡ºç°â€ç²˜åŒ…â€çš„å…³é”®åœ¨äºæ¥æ”¶æ–¹ä¸ç¡®å®šå°†è¦ä¼ è¾“çš„æ•°æ®åŒ…çš„å¤§å°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¯¹æ•°æ®åŒ…è¿›è¡Œå°åŒ…å’Œæ‹†åŒ…çš„æ“ä½œã€‚<br> æ­¤æ—¶éœ€è¦è‡ªå·±å®šä¹‰ä¸€ä¸ªåè®®,æ¯”å¦‚æ•°æ®åŒ…çš„å‰4ä¸ªå­—èŠ‚ä¸ºåŒ…å¤´é‡Œé¢å­˜å‚¨çš„æ˜¯å‘é€çš„æ•°æ®çš„é•¿åº¦ï¼Œç„¶åé€šè¿‡å‘é€ç«¯è¿›è¡Œå°åŒ…ã€æ¥æ”¶ç«¯è¿›è¡Œæ‹†åŒ…çš„æ“ä½œæ¥è§£å†³æ­¤é—®é¢˜ã€‚</p>\n</blockquote>\n<p><br></p>\n<p><strong>Q: ä»€ä¹ˆæ˜¯å°åŒ…?</strong></p>\n<blockquote>\n<p>ç­”: å°åŒ…å°±æ˜¯ç»™ä¸€æ®µæ•°æ®åŠ ä¸ŠåŒ…å¤´ï¼Œè¿™æ ·ä¸€æ¥æ•°æ®åŒ…å°±åˆ†ä¸ºåŒ…å¤´å’ŒåŒ…ä½“ä¸¤éƒ¨åˆ†å†…å®¹äº†(è¿‡æ»¤éæ³•åŒ…æ—¶å°åŒ…ä¼šåŠ å…¥â€åŒ…å°¾â€å†…å®¹)ã€‚åŒ…å¤´éƒ¨åˆ†çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸”å®ƒå­˜å‚¨äº†åŒ…ä½“çš„é•¿åº¦ï¼Œæ ¹æ®åŒ…å¤´é•¿åº¦å›ºå®šä»¥åŠåŒ…å¤´ä¸­å«æœ‰åŒ…ä½“é•¿åº¦çš„å˜é‡å°±èƒ½æ­£ç¡®çš„æ‹†åˆ†å‡ºä¸€ä¸ªå®Œæ•´çš„æ•°æ®åŒ…ã€‚</p>\n</blockquote>\n<p><br></p>\n<p><strong>å®è·µç¤ºä¾‹ï¼š</strong></p>\n<ul>\n<li>è‡ªå®šä¹‰åè®®: proto.go<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> proto</span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">\"bufio\"</span></span><br><span class=\"line\">  <span class=\"string\">\"bytes\"</span></span><br><span class=\"line\">  <span class=\"string\">\"encoding/binary\"</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"comment\">// (1) Encode å°†æ¶ˆæ¯ç¼–ç </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Encode</span><span class=\"params\">(message <span class=\"keyword\">string</span>)</span> <span class=\"params\">([]<span class=\"keyword\">byte</span>, error)</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 1.è¯»å–æ¶ˆæ¯çš„é•¿åº¦ï¼Œè½¬æ¢æˆint32ç±»å‹ï¼ˆå 4ä¸ªå­—èŠ‚ï¼‰ä»¥åå¯ä»¥æŒ‰ç…§éœ€è¦è¿›è¡Œè‡ªå®šä¹‰</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> length = <span class=\"keyword\">int32</span>(<span class=\"built_in\">len</span>(message))</span><br><span class=\"line\">  <span class=\"keyword\">var</span> pkg = <span class=\"built_in\">new</span>(bytes.Buffer) <span class=\"comment\">// å‘ç³»ç»Ÿä¸ºå…·æœ‰è¯»å†™æ–¹æ³•çš„å­—èŠ‚å¤§å°å¯å˜çš„ç¼“å†²åŒºç”³è¯·å†…å­˜ã€‚</span></span><br><span class=\"line\">  <span class=\"comment\">// 2.å†™å…¥æ¶ˆæ¯å¤´</span></span><br><span class=\"line\">  err := binary.Write(pkg, binary.LittleEndian, length) <span class=\"comment\">//æ³¨æ„æ­¤å¤„ä»¥å°ç«¯çš„æ–¹å¼å†™å…¥.åœ¨åç»­è§£åŒ…æ—¶ä¹Ÿå¿…é¡»é‡‡ç”¨å°ç«¯æ–¹å¼è¯»å–</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, err</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 3.å†™å…¥æ¶ˆæ¯å®ä½“</span></span><br><span class=\"line\">  err = binary.Write(pkg, binary.LittleEndian, []<span class=\"keyword\">byte</span>(message))</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, err</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 4.è¿”å›å°åŒ…å®Œæ¯•çš„ç¼“å†²åŒºä¸­æ•°æ®</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> pkg.Bytes(), <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// (2) Decode è§£ç æ¶ˆæ¯</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Decode</span><span class=\"params\">(reader *bufio.Reader)</span> <span class=\"params\">(<span class=\"keyword\">string</span>, error)</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 1.è¯»å–æ¶ˆæ¯çš„é•¿åº¦</span></span><br><span class=\"line\">  lengthByte, _ := reader.Peek(<span class=\"number\">4</span>)           <span class=\"comment\">// è¯»å–å‰4ä¸ªå­—èŠ‚çš„æ•°æ®</span></span><br><span class=\"line\">  lengthBuff := bytes.NewBuffer(lengthByte) <span class=\"comment\">// NewBufferä½¿ç”¨bufä½œä¸ºåˆå§‹å†…å®¹åˆ›å»ºå¹¶åˆå§‹åŒ–ä¸€ä¸ªæ–°ç¼“å†²åŒº,æ­¤å¤„æŒ‡å®šè¦è¯»å–æ•°æ®çš„é•¿åº¦.</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> length <span class=\"keyword\">int32</span></span><br><span class=\"line\">  err := binary.Read(lengthBuff, binary.LittleEndian, &amp;length)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"\"</span>, err</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 2.Bufferedè¿”å›ç¼“å†²ä¸­ç°æœ‰çš„å¯è¯»å–çš„å­—èŠ‚æ•°,å¦‚æœè·å–çš„å­—èŠ‚æ•°å°äºæ¶ˆæ¯çš„é•¿åº¦åˆ™è¯´æ˜æ•°æ®åŒ…æœ‰è¯¯.</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> <span class=\"keyword\">int32</span>(reader.Buffered()) &lt; length+<span class=\"number\">4</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"\"</span>, err</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 3.è¯»å–çœŸæ­£çš„æ¶ˆæ¯æ•°æ®</span></span><br><span class=\"line\">  pack := <span class=\"built_in\">make</span>([]<span class=\"keyword\">byte</span>, <span class=\"keyword\">int</span>(<span class=\"number\">4</span>+length))</span><br><span class=\"line\">  _, err = reader.Read(pack)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"\"</span>, err</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 4.åˆ©ç”¨sliceåˆ‡ç‰‡è¿”å›å››ä¸ªå­—èŠ‚åçš„æ¶ˆæ¯æ•°æ®</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">string</span>(pack[<span class=\"number\">4</span>:]), <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>ç„¶ååœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åˆ†åˆ«ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„protoåŒ…çš„<code>Decode å’Œ Encode</code>å‡½æ•°å¤„ç†æ•°æ®ã€‚</p>\n<ul>\n<li>æœåŠ¡ç«¯ä»£ç å¦‚ä¸‹ï¼š<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">\"bufio\"</span></span><br><span class=\"line\">  <span class=\"string\">\"fmt\"</span></span><br><span class=\"line\">  <span class=\"string\">\"io\"</span></span><br><span class=\"line\">  <span class=\"string\">\"net\"</span></span><br><span class=\"line\">  <span class=\"string\">\"weiyigeek.top/studygo/Day08/03StickBag/proto\"</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">process</span><span class=\"params\">(conn net.Conn)</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 4.é€€å‡ºæ—¶å…³é—­connèµ„æº</span></span><br><span class=\"line\">  <span class=\"keyword\">defer</span> conn.Close()</span><br><span class=\"line\">  <span class=\"comment\">// 5.NewReaderè¿”å›å…¶ç¼“å†²åŒºå…·æœ‰é»˜è®¤å¤§å°çš„æ–°è¯»å–å™¨ã€‚</span></span><br><span class=\"line\">  reader := bufio.NewReader(conn)</span><br><span class=\"line\">  <span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 6.è§£åŒ…: å°†é€šè¿‡connå¯¹è±¡ä¸­è·å–çš„ç¼“å†²åŒºæ•°æ®è¿›è¡Œè§£åŒ….</span></span><br><span class=\"line\">    msg, err := proto.Decode(reader)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err == io.EOF &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">      fmt.Println(<span class=\"string\">\"decode msg failed, err:\"</span>, err)</span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 7.æ‰“å°è§£åŒ…åçš„æ•°æ®</span></span><br><span class=\"line\">    fmt.Println(<span class=\"string\">\"æ”¶åˆ°clientå‘æ¥çš„æ•°æ®ï¼š\"</span>, msg)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 1.è®¾ç½®TCP Serverç«¯ç›‘å¬åœ°å€å’Œç«¯å£</span></span><br><span class=\"line\">  listen, err := net.Listen(<span class=\"string\">\"tcp\"</span>, <span class=\"string\">\"127.0.0.1:30000\"</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">\"listen failed, err:\"</span>, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 2.å‡½æ•°ç»“æŸåå…³é—­ç›‘å¬èµ„æº</span></span><br><span class=\"line\">  <span class=\"keyword\">defer</span> listen.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 3.å¾ªç¯æ¥æ”¶å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ•°æ®,åˆ©ç”¨gorontineæ‰§è¡Œprocessä»»åŠ¡</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">    conn, err := listen.Accept()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">      fmt.Println(<span class=\"string\">\"accept failed, err:\"</span>, err)</span><br><span class=\"line\">      <span class=\"keyword\">continue</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">go</span> process(conn)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li>å®¢æˆ·ç«¯ä»£ç å¦‚ä¸‹:<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">\"fmt\"</span></span><br><span class=\"line\">  <span class=\"string\">\"net\"</span></span><br><span class=\"line\">  <span class=\"string\">\"weiyigeek.top/studygo/Day08/03StickBag/proto\"</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 1.è¿æ¥åˆ°serverç«¯.</span></span><br><span class=\"line\">  conn, err := net.Dial(<span class=\"string\">\"tcp\"</span>, <span class=\"string\">\"127.0.0.1:30000\"</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">\"dial failed, err\"</span>, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 2.ç¨‹åºç»“æŸæ—¶å…³é—­connç½‘ç»œè¿æ¥èµ„æº.</span></span><br><span class=\"line\">  <span class=\"keyword\">defer</span> conn.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 3.å¾ªç¯å‘é€20æ¬¡msgç»™serverç«¯</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; <span class=\"number\">20</span>; i++ &#123;</span><br><span class=\"line\">    msg := <span class=\"string\">`Hello, Hello. How are you?`</span></span><br><span class=\"line\">    <span class=\"comment\">// 4.å°†è¦å‘é€çš„ä¿¡æ¯è¿›è¡Œå°åŒ…å¤„ç†</span></span><br><span class=\"line\">    data, err := proto.Encode(msg)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">      fmt.Println(<span class=\"string\">\"encode msg failed, err:\"</span>, err)</span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 5.å°†å¤„ç†è¿‡çš„å°åŒ…è¿›è¡Œå‘é€</span></span><br><span class=\"line\">    conn.Write(data)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>æ‰§è¡Œç»“æœ: æ­¤æ—¶å‘ç°å®ƒä¸ä¼šå°†å¤šä¸ªhelloâ€¦å­—ç¬¦ä¸²æ”¾åœ¨ä¸€è¡Œäº†ï¼Œå¹¶ä¸”è¾“å‡ºä¹Ÿæ˜¯æˆ‘ä»¬é¢„å®šçš„20æ¬¡ã€‚</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211121132345.png\" alt=\"WeiyiGeek.é»åŒ…è§£å†³åŠæ³•\" title=\"\" class=\"\">\n                <p>WeiyiGeek.é»åŒ…è§£å†³åŠæ³•</p>\n            </figure>\n<p><br/></p>\n<p><strong>è¡¥å……çŸ¥è¯†</strong>:<code>å­—èŠ‚åºåˆ—çš„å­˜å‚¨æ ¼å¼</code>ä¹‹å¤§ç«¯(<code>Big-endian</code>)å’Œå°ç«¯(<code>LittleEndian</code>)å­˜å‚¨</p>\n<ul>\n<li>Big-endianï¼šå°†é«˜åºå­—èŠ‚å­˜å‚¨åœ¨èµ·å§‹åœ°å€ï¼ˆé«˜ä½ç¼–å€ï¼‰ï¼Œæ­¤ç§æ–¹å¼ä¾¿äºäººç±»ç†è§£ã€‚</li>\n<li>Little-endianï¼šå°†ä½åºå­—èŠ‚å­˜å‚¨åœ¨èµ·å§‹åœ°å€ï¼ˆä½ä½ç¼–å€ï¼‰ä¸€èˆ¬åœ¨x64/x32çš„ç³»ç»Ÿä¸­éƒ½æ˜¯å°ç«¯å­˜å‚¨ã€‚</li>\n</ul>\n<p>ä¸¾ä¸ªä¾‹å­: å¦‚æœæˆ‘ä»¬å°†0x1234abcdå†™å…¥åˆ°ä»¥0x0000å¼€å§‹çš„å†…å­˜ä¸­ï¼Œåˆ™ç»“æœä¸ºï¼›</p>\n<table>\n<thead>\n<tr>\n<th>address</th>\n<th>big-endianï¼ˆå¤§ç«¯ï¼‰</th>\n<th>little-endian ï¼ˆå°ç«¯ï¼‰</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0x0000</td>\n<td>0x12</td>\n<td>0xcd</td>\n</tr>\n<tr>\n<td>0x0001</td>\n<td>0x34</td>\n<td>0xab</td>\n</tr>\n<tr>\n<td>0x0002</td>\n<td>0xab</td>\n<td>0x34</td>\n</tr>\n<tr>\n<td>0x0003</td>\n<td>0xcd</td>\n<td>0x12</td>\n</tr>\n</tbody>\n</table>\n<p>æ³¨ï¼šæ¯ä¸ªåœ°å€å­˜1ä¸ªå­—èŠ‚ï¼Œ2ä½16è¿›åˆ¶æ•°æ˜¯1ä¸ªå­—èŠ‚<code>ï¼ˆ0xFF=11111111ï¼‰</code>ï¼›</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211121123804.png\" alt=\"WeiyiGeek.å¤§ç«¯å’Œå°ç«¯\" title=\"\" class=\"\">\n                <p>WeiyiGeek.å¤§ç«¯å’Œå°ç«¯</p>\n            </figure>\n<p><br/></p>\n<p><strong>è¡¥å……çŸ¥è¯†</strong>:CPUå­˜å‚¨ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®æ—¶å…¶å­—èŠ‚å†…çš„8ä¸ªæ¯”ç‰¹ä¹‹é—´çš„é¡ºåºæ˜¯å¦ä¹Ÿæœ‰<code>big endian</code>å’Œ<code>little endian</code>ä¹‹åˆ†ï¼Ÿæˆ–è€…è¯´æ˜¯å¦æœ‰æ¯”ç‰¹åºçš„ä¸åŒï¼Ÿ</p>\n<p>å®é™…ä¸Šï¼Œè¿™ä¸ªæ¯”ç‰¹åºæ˜¯åŒæ ·å­˜åœ¨çš„åªæ˜¯å¤šä¸ªä¸¤ä¸ªè¡¨ç¤ºåç§°ï¼ˆMSB å’Œ LSBï¼‰ã€‚<br>MSBçš„æ„æ€æ˜¯ï¼šå…¨ç§°ä¸º<code>Most Significant Bit</code>ï¼Œåœ¨äºŒè¿›åˆ¶æ•°ä¸­å±äºæœ€é«˜æœ‰æ•ˆä½ï¼ŒMSBæ˜¯æœ€é«˜åŠ æƒä½ï¼Œä¸åè¿›åˆ¶æ•°å­—ä¸­æœ€å·¦è¾¹çš„ä¸€ä½ç±»ä¼¼ã€‚<br>LSBçš„æ„æ€æ˜¯ï¼šå…¨ç§°ä¸º<code>Least Significant Bit</code>ï¼Œåœ¨äºŒè¿›åˆ¶æ•°ä¸­æ„ä¸ºæœ€ä½æœ‰æ•ˆä½ï¼Œä¸€èˆ¬æ¥è¯´ï¼ŒMSBä½äºäºŒè¿›åˆ¶æ•°çš„æœ€å·¦ä¾§ï¼ŒLSBä½äºäºŒè¿›åˆ¶æ•°çš„æœ€å³ä¾§ã€‚</p>\n<p>ä¸‹é¢ä»¥æ•°å­—0xB4ï¼ˆ10110100ï¼‰ç”¨å›¾åŠ ä»¥è¯´æ˜ã€‚<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Big Endian</span></span><br><span class=\"line\">msb------------------------&gt;lsb</span><br><span class=\"line\">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class=\"line\">|   1  |   0  |   1  |   1  |   0  |   1  |   0  |   0  |</span><br><span class=\"line\">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Little Endian</span></span><br><span class=\"line\">lsb--------------------------&gt;msb</span><br><span class=\"line\">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class=\"line\">|   0  |   0  |   1  |   0  |   1  |   1  |   0  |   1  |</span><br><span class=\"line\">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></pre></td></tr></table></figure></p>\n<p>å®é™…ä¸Šï¼Œç”±äºCPUå­˜å‚¨æ•°æ®æ“ä½œçš„æœ€å°å•ä½æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œå…¶å†…éƒ¨çš„æ¯”ç‰¹åºæ˜¯ä»€ä¹ˆæ ·å¯¹æˆ‘ä»¬çš„ç¨‹åºæ¥è¯´æ˜¯ä¸€ä¸ªé»‘ç›’å­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ç»™æˆ‘ä¸€ä¸ªæŒ‡å‘0xB4è¿™ä¸ªæ•°çš„æŒ‡é’ˆï¼Œå¯¹äºbig endianæ–¹å¼çš„CPUæ¥è¯´ï¼Œå®ƒæ˜¯ä»å·¦å¾€å³ä¾æ¬¡è¯»å–è¿™ä¸ªæ•°çš„8ä¸ªæ¯”ç‰¹ï¼›è€Œå¯¹äºlittle endianæ–¹å¼çš„CPUæ¥è¯´ï¼Œåˆ™æ­£å¥½ç›¸åï¼Œæ˜¯ä»å³å¾€å·¦ä¾æ¬¡è¯»å–è¿™ä¸ªæ•°çš„8ä¸ªæ¯”ç‰¹ã€‚è€Œæˆ‘ä»¬çš„ç¨‹åºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆè®¿é—®åå¾—åˆ°çš„æ•°å°±æ˜¯0xB4ï¼Œå­—èŠ‚å†…éƒ¨çš„æ¯”ç‰¹åºå¯¹äºç¨‹åºæ¥è¯´æ˜¯ä¸å¯è§çš„ï¼Œå…¶å®è¿™ç‚¹å¯¹äºå•æœºä¸Šçš„å­—èŠ‚åºæ¥è¯´ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ </p>\n<hr>\n<h2 id=\"0x01Goè¯­è¨€åŸºç¡€ä¹‹HTTP-C-Så®ç°\"><a href=\"#0x01Goè¯­è¨€åŸºç¡€ä¹‹HTTP-C-Så®ç°\" class=\"headerlink\" title=\"0x01Goè¯­è¨€åŸºç¡€ä¹‹HTTP C/Så®ç°\"></a>0x01Goè¯­è¨€åŸºç¡€ä¹‹HTTP C/Så®ç°</h2><p>æè¿°: åœ¨Socketç½‘ç»œç¼–ç¨‹ä¸­æˆ‘ä»¬å­¦ä¹ TCPåè®®ä¸UDPåè®®çš„æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä»£ç çš„ç¼–å†™å®è·µ, ä»Šå¤©æˆ‘ä»¬æ¥å­¦ä¹ åœ¨åº”ç”¨å±‚ä¸­æˆ‘ä»¬ä½¿ç”¨æœ€å¤šçš„HTTPåè®®ï¼Œåˆ©ç”¨Goè¯­è¨€åˆ†åˆ«å®ç°HTTPçš„Clientç«¯ä¸Serverç«¯æœåŠ¡ã€‚</p>\n<p>Goè¯­è¨€å†…ç½®<code>çš„net/http</code>åŒ…ååˆ†çš„ä¼˜ç§€ï¼Œå…¶ä¸ºæˆ‘ä»¬æä¾›äº†HTTPå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„å®ç°ã€‚</p>\n<p><strong>Q: ä»€ä¹ˆæ˜¯ HTTP åè®®?</strong></p>\n<blockquote>\n<p>ç­”: è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼ŒHyperText Transfer Protocol)æ˜¯äº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œä¼ è¾“åè®®ï¼Œæ‰€æœ‰çš„WWWæ–‡ä»¶éƒ½å¿…é¡»éµå®ˆè¿™ä¸ªæ ‡å‡†ï¼Œè®¾è®¡HTTPæœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶HTMLé¡µé¢çš„æ–¹æ³•ã€‚<br>ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è®¿é—®çš„httpçš„ç½‘ç«™ï¼Œå…¶ä¼ è¾“åè®®ä¾¿æ˜¯é‡‡ç”¨HTTPã€‚</p>\n</blockquote>\n<p><br></p>\n<h3 id=\"1-HTTP-æœåŠ¡ç«¯\"><a href=\"#1-HTTP-æœåŠ¡ç«¯\" class=\"headerlink\" title=\"1.HTTP æœåŠ¡ç«¯\"></a>1.HTTP æœåŠ¡ç«¯</h3><p>æè¿°: åˆ©ç”¨Goè¯­è¨€æä¾›çš„net/httpåŒ…æˆ‘ä»¬å¯ä»¥éå¸¸ä¾¿åˆ©çš„ä½¿ç”¨å¹¶åˆ›å»ºä¸€ä¸ªæœåŠ¡ç«¯, å€¼å¾—è¯´æ˜çš„æ˜¯å¦‚æœä»…ä»…æ˜¯å®ç°ç®€å•çš„APIæ¥å£å¯ä»¥é‡‡ç”¨åŸç”Ÿçš„httpåŒ…ä¸­æä¾›çš„æ–¹æ³•, è€Œå¦‚æœæ˜¯ç¼–å†™ä¸€äº›Webåç«¯é¡¹ç›®é€šå¸¸æ˜¯é‡‡ç”¨æ¡†æ¶æ¥å®ç°ï¼Œæ‰€ä»¥æœ¬ç« èŠ‚ä¸»è¦å¯¹Goè¯­è¨€åˆ›å»ºHTTPæœåŠ¡ç«¯çš„åŸºç¡€ç¤ºä¾‹è¿›è¡Œè¯´æ˜å­¦ä¹ ï¼Œè€ŒGoè¯­è¨€çš„Webåº”ç”¨å¼€å‘æ¡†æ¡†åœ¨æˆ‘åç»­ç¬”è®°ä¸­å°†ä¼šè¿›è¡Œå®è·µè®²è§£ã€‚</p>\n<p><strong>HTTPæœåŠ¡ç«¯å®ç°å¸¸ç”¨æ–¹æ³•åŸå‹:</strong></p>\n<ul>\n<li><code>func http.ListenAndServe(addr string, handler http.Handler) error</code>: ä½¿ç”¨æŒ‡å®šçš„ç›‘å¬åœ°å€å’Œå¤„ç†å™¨å¯åŠ¨ä¸€ä¸ªHTTPæœåŠ¡ç«¯, å¤„ç†å™¨å‚æ•°é€šå¸¸æ˜¯nilè¡¨ç¤ºé‡‡ç”¨åŒ…å˜é‡DefaultServeMuxä½œä¸ºå¤„ç†å™¨ã€‚</li>\n<li><code>func http.Handle(pattern string, handler http.Handler){ DefaultServeMux.Handle(pattern, handler) }</code>: Handleåœ¨DefaultServeMuxä¸­æ³¨å†Œç»™å®šæ¨¡å¼çš„å¤„ç†ç¨‹åºå‡½æ•°ã€‚</li>\n<li><code>func http.HandleFunc(pattern string, handler func(http.ResponseWriter, *http.Request)){DefaultServeMux.HandleFunc(pattern, handler)}</code>: HandleFuncåœ¨DefaultServeMuxä¸­æ³¨å†Œç»™å®šæ¨¡å¼çš„å¤„ç†ç¨‹åºå‡½æ•°ã€‚</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1.Handleåœ¨DefaultServeMuxä¸­æ³¨å†Œç»™å®šæ¨¡å¼çš„å¤„ç†ç¨‹åºå‡½æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> httpServer <span class=\"keyword\">struct</span> &#123;&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(server httpServer)</span> <span class=\"title\">ServeHTTP</span><span class=\"params\">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class=\"line\">  w.Write([]<span class=\"keyword\">byte</span>(r.URL.Path))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> fooHandler httpServer</span><br><span class=\"line\">http.Handle(<span class=\"string\">\"/foo\"</span>, fooHandler)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2.HandleFuncåœ¨DefaultServeMuxä¸­æ³¨å†Œç»™å®šæ¨¡å¼çš„å¤„ç†ç¨‹åºå‡½æ•°</span></span><br><span class=\"line\">http.HandleFunc(<span class=\"string\">\"/bar\"</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class=\"line\">  fmt.Fprintf(w, <span class=\"string\">\"Hello, %q\"</span>, html.EscapeString(r.URL.Path))</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3.æŒ‡å®šçš„æœ¬åœ°ç½‘å¡çš„8080æ–­å¼€ä½œä¸ºç›‘å¬åœ°å€å’Œå¤„ç†å™¨å¯åŠ¨ä¸€ä¸ªHTTPæœåŠ¡ç«¯ã€‚</span></span><br><span class=\"line\">log.Fatal(http.ListenAndServe(<span class=\"string\">\":8080\"</span>, <span class=\"literal\">nil</span>))</span><br></pre></td></tr></table></figure>\n<p><br/></p>\n<p><strong>Tips: go http http.Handle å’Œ http.HandleFunc åŒºåˆ«?</strong></p>\n<ul>\n<li><code>http.Handle()</code> éœ€è¦è‡ªå·±å»å®šä¹‰structå®ç°è¿™ä¸ªHandleræ¥å£ã€‚</li>\n<li><code>http.HandleFunc()</code> åˆ™ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å®šä¹‰structqiå®ç°,åªéœ€è¦ä¼ å…¥è®¿é—®è¿æ¥è·¯å¾„ä»¥åŠDefaultServeMuxä¸­æ³¨å†Œç»™å®šæ¨¡å¼çš„å¤„ç†ç¨‹åºå‡½æ•°ã€‚</li>\n</ul>\n<p>é€šå¸¸æ˜¯ä½¿ç”¨HandleFuncæ–¹æ³•,å…¶æ›´åŠ æ–¹ä¾¿ç®€å•ã€‚</p>\n<p><br></p>\n<p><strong>ç¤ºä¾‹1.http.Handleè‡ªå®šä¹‰å®ç°Handleræ¥å£</strong><br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">\"fmt\"</span></span><br><span class=\"line\">  <span class=\"string\">\"log\"</span></span><br><span class=\"line\">  <span class=\"string\">\"net/http\"</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è‡ªå®šä¹‰ç»“æ„ä½“</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> httpServer <span class=\"keyword\">struct</span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// httpServer è‡ªå®šä¹‰å®ç°httpè¯·æ±‚å¤„ç†ç¨‹åºå‡½æ•°</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(server httpServer)</span> <span class=\"title\">ServeHTTP</span><span class=\"params\">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class=\"line\">  path := r.URL.Path</span><br><span class=\"line\">  fmt.Println(path)</span><br><span class=\"line\">  <span class=\"keyword\">switch</span> path &#123;</span><br><span class=\"line\">  <span class=\"keyword\">case</span> <span class=\"string\">\"/\"</span>:</span><br><span class=\"line\">    w.Write([]<span class=\"keyword\">byte</span>(<span class=\"string\">\"æ ¹è·¯å¾„ : \"</span> + r.URL.Path))</span><br><span class=\"line\">  <span class=\"keyword\">case</span> <span class=\"string\">\"/index\"</span>:</span><br><span class=\"line\">    w.Write([]<span class=\"keyword\">byte</span>(<span class=\"string\">\"é¦–é¡µè·¯å¾„ : \"</span> + r.URL.Path))</span><br><span class=\"line\">  <span class=\"keyword\">case</span> <span class=\"string\">\"/hello\"</span>:</span><br><span class=\"line\">    w.Write([]<span class=\"keyword\">byte</span>(<span class=\"string\">\"å­ç½‘é¡µè·¯å¾„ : \"</span> + r.URL.Path))</span><br><span class=\"line\">  <span class=\"keyword\">default</span>:</span><br><span class=\"line\">    w.Write([]<span class=\"keyword\">byte</span>(<span class=\"string\">\"&lt;b&gt;æœªçŸ¥è·¯å¾„&lt;/b&gt; : https://weiyigeek.top\"</span> + r.URL.Path))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 1.å£°æ˜serveå˜é‡çš„ç±»å‹ä¸ºæˆ‘ä»¬è‡ªå®šä¹‰ç»“æ„ä½“</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> server httpServer</span><br><span class=\"line\">  serveraddr := <span class=\"string\">\"0.0.0.0:8080\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 2.Handleåœ¨DefaultServeMuxä¸­æ³¨å†Œç»™å®šæ¨¡å¼çš„å¤„ç†ç¨‹åºã€‚</span></span><br><span class=\"line\">  http.Handle(<span class=\"string\">\"/\"</span>, server)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 3.å¯åŠ¨httpServerç›‘å¬å¹¶é‡‡ç”¨åŒ…å˜é‡DefaultServeMuxä½œä¸ºå¤„ç†å™¨ã€‚</span></span><br><span class=\"line\">  err := http.ListenAndServe(serveraddr, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    log.Fatal(err)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Http Server %v Started......\"</span>, serveraddr)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤º<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211122150456.png\" alt=\"WeiyiGeek.http.Handleç»“æœ\" title=\"\" class=\"\">\n                <p>WeiyiGeek.http.Handleç»“æœ</p>\n            </figure></p>\n<p><br></p>\n<p><strong>ç¤ºä¾‹2.http.HandleFuncå®ç°ç”¨æˆ·è¯·æ±‚å¤„ç†</strong></p>\n<p>index.html<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"X-UA-Compatible\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"IE=edge\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width, initial-scale=1.0\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>æµ‹è¯•é¡µé¢2<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">p</span>  <span class=\"attr\">id</span>=<span class=\"string\">\"tips\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"color: red;font-size:medium;font-weight: bolder;\"</span>&gt;</span>Welcome to Visit weiyigeek.top web site<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"msg\"</span>&gt;</span>ç‚¹å‡»æç¤º<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">var</span> tips = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"tips\"</span>).textContent;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"msg\"</span>).onclick=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">      alert(tips);</span></span><br><span class=\"line\"><span class=\"undefined\">    &#125;</span></span><br><span class=\"line\"><span class=\"undefined\"> </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p>Http Server ç«¯ä»£ç :<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">\"fmt\"</span></span><br><span class=\"line\">  <span class=\"string\">\"io/ioutil\"</span></span><br><span class=\"line\">  <span class=\"string\">\"log\"</span></span><br><span class=\"line\">  <span class=\"string\">\"net/http\"</span></span><br><span class=\"line\">  <span class=\"string\">\"time\"</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 1.å£°æ˜å®šä¹‰serverç›‘å¬ç«¯å£åœ°å€</span></span><br><span class=\"line\">  serveraddr := <span class=\"string\">\"0.0.0.0:8080\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 2.HandleFuncåœ¨DefaultServeMuxä¸­æ³¨å†Œç»™å®šæ¨¡å¼çš„å¤„ç†ç¨‹åºã€‚</span></span><br><span class=\"line\">  http.HandleFunc(<span class=\"string\">\"/hello\"</span>, hello)</span><br><span class=\"line\">  http.HandleFunc(<span class=\"string\">\"/blog\"</span>, blog)</span><br><span class=\"line\">  http.HandleFunc(<span class=\"string\">\"/htmlfile\"</span>, htmlfile)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 3.å¯åŠ¨httpServerç›‘å¬å¹¶é‡‡ç”¨åŒ…å˜é‡DefaultServeMuxä½œä¸ºå¤„ç†å™¨ã€‚</span></span><br><span class=\"line\">  err := http.ListenAndServe(serveraddr, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    log.Fatal(err)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Http Server %v Started......\"</span>, serveraddr)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// (1) æ–¹å¼1.æ­¤ç§æ–¹å¼ä¸èƒ½ç›´æ¥å†™å…¥HTMLæ ‡ç­¾ä»£ç å¹¶è¿”è¿˜ç»™å®¢æˆ·ç«¯.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">hello</span><span class=\"params\">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class=\"line\">  fmt.Fprintf(w, <span class=\"string\">\"Hello World! Go &lt;b&gt;æµ‹è¯•é¡µé¢0&lt;/b&gt; Time : %s\"</span>, time.Now())</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// (2) æ–¹å¼2.å¯ä»¥ç›´æ¥å†™å…¥HTMLæ ‡ç­¾ä»£ç å¹¶è¿”è¿˜ç»™å®¢æˆ·ç«¯.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">blog</span><span class=\"params\">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class=\"line\">  reply := fmt.Sprintf(<span class=\"string\">\"&lt;b&gt;æµ‹è¯•é¡µé¢1&lt;/b&gt;&lt;p&gt; æ ‡é¢˜.Demo1 Test(Go net/http) &lt;/p&gt; &lt;i&gt;I'm WeiyiGeek&lt;/i&gt;&lt;br/&gt; Time : %s\"</span>, time.Now().Format(<span class=\"string\">\"2006-01-02 15:04:05\"</span>))</span><br><span class=\"line\">  w.Write([]<span class=\"keyword\">byte</span>(reply))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// (3) è¯»å–æœ¬æœºä¸Šçš„ç½‘é¡µä¸ºæ–‡ä»¶è¿”è¿˜ç»™å®¢æˆ·ç«¯.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">htmlfile</span><span class=\"params\">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class=\"line\">  res, err := ioutil.ReadFile(<span class=\"string\">\"./index.html\"</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    w.Write([]<span class=\"keyword\">byte</span>(fmt.Sprintf(<span class=\"string\">\"Error: %v\"</span>, err)))</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  w.Write([]<span class=\"keyword\">byte</span>(res))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>å°†ä¸Šé¢çš„ä»£ç ç¼–è¯‘ä¹‹åæ‰§è¡Œï¼Œæ‰“å¼€ç”µè„‘ä¸Šçš„æµè§ˆå™¨åœ¨åœ°å€æ è¾“å…¥<code>127.0.0.1:8080</code>å›è½¦ï¼Œæ­¤æ—¶è¿”å›å¦‚ä¸‹é¡µé¢ã€‚</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211122165405.png\" alt=\"WeiyiGeek.http.HandleFuncå®ç°ç”¨æˆ·è¯·æ±‚å¤„ç†\" title=\"\" class=\"\">\n                <p>WeiyiGeek.http.HandleFuncå®ç°ç”¨æˆ·è¯·æ±‚å¤„ç†</p>\n            </figure>\n<p><br></p>\n<p><strong>ç¤ºä¾‹3.è‡ªå®šä¹‰http.Serverç»“æ„ä½“å‚æ•°ä¸Handlerå®ç°</strong><br>æè¿°: æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>Server</code> Handlerå®ç°, é€šè¿‡http.ServeræŒ‡å®šè®¾ç½®ç»“æ„ä½“å‚æ•°æ¥ç®¡ç†æœåŠ¡ç«¯çš„è¡Œä¸ºã€‚<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">\"fmt\"</span></span><br><span class=\"line\">  <span class=\"string\">\"log\"</span></span><br><span class=\"line\">  <span class=\"string\">\"net/http\"</span></span><br><span class=\"line\">  <span class=\"string\">\"time\"</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è‡ªå®šä¹‰myHandlerç»“æ„ä½“ï¼Œæ³¨å†ŒHandlerå¤„ç†ç¨‹åºä½¿ç”¨</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> myHandler <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  name <span class=\"keyword\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// è‡ªå®šä¹‰myHandlerç»“æ„ä½“çš„æ–¹æ³•æ³¨å†Œåˆ°Handlerå¤„ç†ç¨‹åº,ã€éå¸¸æ³¨æ„ã€‘ã€ã€éå¸¸æ³¨æ„ã€‘æ–¹æ³•åå¿…é¡»ä¸º ServeHTTP</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(handler myHandler)</span> <span class=\"title\">ServeHTTP</span><span class=\"params\">(w http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// ç°åœ¨handleråŸºäºURLçš„è·¯å¾„éƒ¨åˆ†ï¼ˆreq.URL.Pathï¼‰æ¥å†³å®šæ‰§è¡Œä»€ä¹ˆé€»è¾‘ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">switch</span> req.URL.Path &#123;</span><br><span class=\"line\">  <span class=\"keyword\">case</span> <span class=\"string\">\"/index\"</span>:</span><br><span class=\"line\">    fmt.Fprintf(w, <span class=\"string\">\"%s\\n\"</span>, <span class=\"string\">\"This is Index path\"</span>)</span><br><span class=\"line\">  <span class=\"keyword\">case</span> <span class=\"string\">\"/weiyigeek\"</span>:</span><br><span class=\"line\">    fmt.Fprintf(w, <span class=\"string\">\"%s -&gt; %s\\n\"</span>, handler.name, <span class=\"string\">\"https://weiyigeek.top\"</span>) <span class=\"comment\">// WeiyiGeek -&gt; https://weiyigeek.top</span></span><br><span class=\"line\">  <span class=\"keyword\">default</span>:</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœè¿™ä¸ªhandlerä¸èƒ½è¯†åˆ«è¿™ä¸ªè·¯å¾„ï¼Œå®ƒä¼šé€šè¿‡è°ƒç”¨è¿”å›å®¢æˆ·ç«¯ä¸€ä¸ªHTTP404é”™è¯¯,å¹¶å“åº”ç»™å®¢æˆ·ç«¯è¡¨æ˜è¯·æ±‚çš„è·¯å¾„ä¸å­˜åœ¨.</span></span><br><span class=\"line\">    w.WriteHeader(http.StatusNotFound) <span class=\"comment\">// 404</span></span><br><span class=\"line\">    fmt.Fprintf(w, <span class=\"string\">\"no such page: %s\\n\"</span>, req.URL)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 1.å®ä¾‹åŒ–ä¸€ä¸ªå¤„ç†æ‰€æœ‰è¯·æ±‚çš„Handleræ¥å£</span></span><br><span class=\"line\">  handler := myHandler&#123;name: <span class=\"string\">\"WeiyiGeek\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 2.åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„Serverå‚æ•°,æ³¨æ„å¦‚æœHandlerä¸ºnilåˆ™é‡‡ç”¨http.DefaultServeMuxè¿›è¡Œå¤„ç†å“åº”,å¦åˆ™éœ€è¦æˆ‘ä»¬è‡ªå·±å®ç°ç»“æ„ä½“çš„ServeHTTPæ–¹æ³•.</span></span><br><span class=\"line\">  server := &amp;http.Server&#123;</span><br><span class=\"line\">    Addr:           <span class=\"string\">\":8080\"</span>,</span><br><span class=\"line\">    Handler:        handler,</span><br><span class=\"line\">    ReadTimeout:    <span class=\"number\">10</span> * time.Second,</span><br><span class=\"line\">    WriteTimeout:   <span class=\"number\">10</span> * time.Second,</span><br><span class=\"line\">    IdleTimeout:    <span class=\"number\">60</span> * time.Second,</span><br><span class=\"line\">    MaxHeaderBytes: <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">20</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 3.å¯åŠ¨å¹¶ç›‘å¬HTTPæœåŠ¡ç«¯</span></span><br><span class=\"line\">  log.Fatal(server.ListenAndServe())</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœ:<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211122210606.png\" alt=\"WeiyiGeek.è‡ªå®šä¹‰http.Serverç»“æ„ä½“å‚æ•°ä¸Handlerå®ç°\" title=\"\" class=\"\">\n                <p>WeiyiGeek.è‡ªå®šä¹‰http.Serverç»“æ„ä½“å‚æ•°ä¸Handlerå®ç°</p>\n            </figure></p>\n<p>Tips: æ˜¾ç„¶æˆ‘ä»¬å¯ä»¥ç»§ç»­å‘ServeHTTPæ–¹æ³•ä¸­æ·»åŠ caseï¼Œä½†åœ¨ä¸€ä¸ªå®é™…çš„åº”ç”¨ä¸­ï¼Œå°†æ¯ä¸ªcaseä¸­çš„é€»è¾‘å®šä¹‰åˆ°ä¸€ä¸ªåˆ†å¼€çš„æ–¹æ³•æˆ–å‡½æ•°ä¸­ä¼šå¾ˆå®ç”¨ã€‚å¯¹äºæ›´å¤æ‚çš„åº”ç”¨æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªServeMuxå°†ä¸€æ‰¹http.Handlerèšé›†åˆ°ä¸€ä¸ªå•ä¸€çš„http.Handlerä¸­,é€šè¿‡ç»„åˆæ¥å¤„ç†æ›´åŠ é”™ç»¼å¤æ‚çš„è·¯ç”±éœ€æ±‚ã€‚</p>\n<p>Tips: ã€éå¸¸æ³¨æ„ã€‘ã€éå¸¸æ³¨æ„ã€‘ã€éå¸¸æ³¨æ„ã€‘è‡ªå·±å®ç°çš„ http.Handler ä¸”å¿…é¡»åŒ…å«ä¸€ä¸ª ServeHTTP æ–¹æ³•å, æ‰èƒ½æ¥å—å’Œå“åº”å®¢æˆ·ç«¯ã€‚</p>\n<p><br></p>\n<p><strong>ç¤ºä¾‹4.ServeMux.HandleFuncå®ç°httpæœåŠ¡ç«¯</strong><br>è¯­å¥http.HandlerFunc(handler.list)æ˜¯ä¸€ä¸ªè½¬æ¢è€Œéä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œå› ä¸ºhttp.HandlerFuncæ˜¯ä¸€ä¸ªç±»å‹, å®ƒæœ‰å¦‚ä¸‹çš„å®šä¹‰ï¼š<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> http</span><br><span class=\"line\"><span class=\"keyword\">type</span> HandlerFunc <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(w ResponseWriter, r *Request)</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">func</span> <span class=\"params\">(f HandlerFunc)</span> <span class=\"title\">ServeHTTP</span><span class=\"params\">(w ResponseWriter, r *Request)</span></span> &#123;</span><br><span class=\"line\">    f(w, r)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>ç®€å•ç¤ºä¾‹:<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// è‡ªå®šä¹‰ç±»å‹å£°æ˜</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> dollars <span class=\"keyword\">float32</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(d dollars)</span> <span class=\"title\">String</span><span class=\"params\">()</span> <span class=\"title\">string</span></span> &#123; <span class=\"keyword\">return</span> fmt.Sprintf(<span class=\"string\">\"$%.2f\"</span>, d) &#125; </span><br><span class=\"line\"><span class=\"comment\">// Mapç±»å‹çš„å˜é‡å£°æ˜</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> MyHandler <span class=\"keyword\">map</span>[<span class=\"keyword\">string</span>]dollars</span><br><span class=\"line\"><span class=\"comment\">// ç±»å‹æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self MyHandler)</span> <span class=\"title\">list</span><span class=\"params\">(w http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> item, price := <span class=\"keyword\">range</span> self &#123;</span><br><span class=\"line\">      fmt.Fprintf(w, <span class=\"string\">\"%s: %s\\n\"</span>, item, price)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self MyHandler)</span> <span class=\"title\">price</span><span class=\"params\">(w http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class=\"line\">  item := req.URL.Query().Get(<span class=\"string\">\"item\"</span>)</span><br><span class=\"line\">  price, ok := self[item]</span><br><span class=\"line\">  <span class=\"keyword\">if</span> !ok &#123;</span><br><span class=\"line\">      w.WriteHeader(http.StatusNotFound) <span class=\"comment\">// 404</span></span><br><span class=\"line\">      fmt.Fprintf(w, <span class=\"string\">\"no such item: %q\\n\"</span>, item)</span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  fmt.Fprintf(w, <span class=\"string\">\"%s\\n\"</span>, price)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    handler := MyHandler&#123;<span class=\"string\">\"shoes\"</span>: <span class=\"number\">50</span>, <span class=\"string\">\"socks\"</span>: <span class=\"number\">5</span>&#125;</span><br><span class=\"line\">    http.HandleFunc(<span class=\"string\">\"/list\"</span>, handler.list)</span><br><span class=\"line\">    http.HandleFunc(<span class=\"string\">\"/price\"</span>, handler.price)</span><br><span class=\"line\">    log.Fatal(http.ListenAndServe(<span class=\"string\">\"localhost:8000\"</span>, <span class=\"literal\">nil</span>))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>Tips: ä¸ºäº†æ–¹ä¾¿net/httpåŒ…æä¾›äº†ä¸€ä¸ªå…¨å±€çš„ServeMuxå®ä¾‹DefaultServerMuxå’ŒåŒ…çº§åˆ«çš„http.Handleå’Œhttp.HandleFuncå‡½æ•°, å‰é¢è¯´è¿‡æˆ‘ä»¬åªéœ€è¦ä¼ å…¥nilå€¼å³å¯ã€‚</p>\n<p><br/></p>\n<h3 id=\"2-HTTP-å®¢æˆ·ç«¯\"><a href=\"#2-HTTP-å®¢æˆ·ç«¯\" class=\"headerlink\" title=\"2.HTTP å®¢æˆ·ç«¯\"></a>2.HTTP å®¢æˆ·ç«¯</h3><p>æè¿°: å¦‚æœä½ å­¦è¿‡Pythonçˆ¬è™«é‚£ä¹ˆä½ ä¹Ÿè‚¯å®šçŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ç¼–ç¨‹è¯­è¨€æä¾›çš„ç›¸åº”å‡½æ•°æˆ–è€…æ–¹æ³•å°±è¦å¯ä»¥å¯¹æŒ‡å®šçš„ç½‘ç«™è¿›è¡Œè¯·æ±‚ï¼Œå¹¶å¯ä»¥å°†è¯·æ±‚å“åº”çš„æ•°æ®è¿›è¡Œæ¸…æ´—ç„¶åå­˜å‚¨è¿›æ•°æ®ä¸­ã€‚</p>\n<p>Goè¯­è¨€ä¹Ÿä¸ºæˆ‘ä»¬æä¾›ç›¸åº”çš„å†…ç½®åŒ…<code>net/http</code>å’Œ<code>net/url</code>ä»¥ä¾¿äºæˆ‘ä»¬è¿›è¡Œç½‘ç«™APIæ¥å£(<code>GET</code>ã€<code>POST</code>ã€<code>PUT</code>)è¯·æ±‚å’Œå¤„ç†æœåŠ¡ç«¯å“åº”çš„æ•°æ®ã€‚</p>\n<p>HTTPå®¢æˆ·ç«¯è¯·æ±‚å‡½æ•°åŸå‹:</p>\n<ul>\n<li><code>func http.Get(url string) (resp *http.Response, err error)</code> : å‘æŒ‡å®šçš„URLå‘å‡ºGetè¯·æ±‚,å®ƒå°†éšé‡å®šå‘ï¼Œæœ€å¤š10ä¸ªé‡å®šå‘ã€‚</li>\n<li><code>func http.Post(url string, contentType string, body io.Reader) (resp *http.Response, err -error)</code> : æŒ‡å®šçš„URLå‘å‡ºPostè¯·æ±‚ï¼Œè°ƒç”¨æ–¹åœ¨å®Œæˆè¯»å–ååº”å…³é—­ç›¸åº”çš„ä¸»ä½“ã€‚</li>\n<li><code>func http.PostForm(url string, data url.Values) (resp *http.Response, err error)</code> : PostFormå‘æŒ‡å®šçš„URLå‘å‡ºPOSTï¼Œå¹¶å°†æ•°æ®çš„é”®å’Œå€¼URLç¼–ç ä¸ºè¯·æ±‚æ­£æ–‡ï¼Œ<code>Content-Type header</code>è®¾ç½®ä¸º<code>application/x-www-form-urlencoded</code>ã€‚</li>\n<li><code>func http.NewRequest(method string, url string, body io.Reader) (*http.Request, error)</code> : NewRequestä½¿ç”¨åå°ä¸Šä¸‹æ–‡åŒ…è£…NewRequestWithContext.</li>\n<li><code>func (*http.Client).Do(req *http.Request) (*http.Response, error)</code> : æŒ‰ç…§å®¢æˆ·ç«¯ä¸Šé…ç½®çš„ç­–ç•¥ï¼ˆå¦‚é‡å®šå‘ã€cookieã€èº«ä»½éªŒè¯ï¼‰ï¼Œå‘é€åˆ°HTTPè¯·æ±‚å¹¶è¿”å›åˆ°HTTPå“åº”ã€‚</li>\n<li><code>func url.Parse(rawurl string) (*url.URL, error)</code>: Parseå°†rawurlè§£æä¸ºURLç»“æ„ã€‚</li>\n<li><code>func (url.Values).Encode() string</code> : Encodeå°†å€¼ç¼–ç ä¸ºæŒ‰é”®æ’åºçš„â€œURLç¼–ç â€å½¢å¼ï¼ˆâ€œbar=baz&amp;foo=quxâ€ï¼‰ã€‚</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Get è¯·æ±‚</span></span><br><span class=\"line\">resp, err := http.Get(<span class=\"string\">\"http://example.com/\"</span>)</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"comment\"># Post è¯·æ±‚</span></span><br><span class=\"line\">resp, err := http.Post(<span class=\"string\">\"http://example.com/upload\"</span>, <span class=\"string\">\"image/jpeg\"</span>, &amp;buf)</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"comment\"># Form è¡¨å•è¯·æ±‚</span></span><br><span class=\"line\">resp, err := http.PostForm(<span class=\"string\">\"http://example.com/form\"</span>,</span><br><span class=\"line\">  url.Values&#123;<span class=\"string\">\"key\"</span>: &#123;<span class=\"string\">\"Value\"</span>&#125;, <span class=\"string\">\"id\"</span>: &#123;<span class=\"string\">\"123\"</span>&#125;&#125;)</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"keyword\">if</span> err != nil &#123;</span><br><span class=\"line\">  // handle error</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"comment\"># ç¨‹åºåœ¨ä½¿ç”¨å®Œresponseåå¿…é¡»å…³é—­å›å¤çš„ä¸»ä½“ã€‚</span></span><br><span class=\"line\">defer resp.Body.Close()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¯»å–å“åº”çš„æ•°æ®</span></span><br><span class=\"line\">body, err := ioutil.ReadAll(resp.Body)</span><br></pre></td></tr></table></figure>\n<p>Tips : GETè¯·æ±‚çš„å‚æ•°éœ€è¦ä½¿ç”¨Goè¯­è¨€å†…ç½®çš„<code>net/url</code>æ ‡å‡†åº“æ¥å¤„ç†ã€‚</p>\n<p><br/></p>\n<p><strong>ç®€å•ç¤ºä¾‹.</strong></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">\"fmt\"</span></span><br><span class=\"line\">  <span class=\"string\">\"io/ioutil\"</span></span><br><span class=\"line\">  <span class=\"string\">\"net/http\"</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">getMethod</span><span class=\"params\">(url <span class=\"keyword\">string</span>)</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 1.Getè¯·æ±‚æŒ‡å®šåœ°å€</span></span><br><span class=\"line\">  resp, err := http.Get(url)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"get failed, err:%v\\n\"</span>, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 2.ç¨‹åºå®Œæ¯•æ—¶å…³é—­å›å¤çš„ä¸»ä½“.</span></span><br><span class=\"line\">  <span class=\"keyword\">defer</span> resp.Body.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 3.è¯»å–å“åº”çš„ç½‘é¡µæºä»£ç </span></span><br><span class=\"line\">  body, err := ioutil.ReadAll(resp.Body)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"read from resp.Body failed, err:%v\\n\"</span>, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  html := <span class=\"keyword\">string</span>(body)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 4.ç½‘ç«™è¯·æ±‚å“åº”æ•°æ®</span></span><br><span class=\"line\">  fmt.Printf(<span class=\"string\">\"resp.StatusCode : %v,\\nresp.Status: %v,\\nresp.Request: %#v,\\nresp.Header: %#v\\nresp.Cookies: %#v,\\nresp.TLS: %#v\\n\"</span>,</span><br><span class=\"line\">    resp.StatusCode,</span><br><span class=\"line\">    resp.Status,</span><br><span class=\"line\">    resp.Request,</span><br><span class=\"line\">    resp.Header,</span><br><span class=\"line\">    resp.Cookies(),</span><br><span class=\"line\">    resp.TLS)</span><br><span class=\"line\"></span><br><span class=\"line\">  fmt.Println(<span class=\"string\">\"ç½‘ç«™å“åº”é•¿åº¦: \"</span>, <span class=\"built_in\">len</span>(html))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  getMethod(<span class=\"string\">\"https://www.weiyigeek.top\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>æ‰§è¡Œç»“æœ:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">resp.StatusCode : <span class=\"number\">200</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">resp.Status: <span class=\"number\">200</span> OK,</span><br><span class=\"line\"></span><br><span class=\"line\">resp.Request: &amp;http.Request&#123;Method:<span class=\"string\">\"GET\"</span>, URL:(*url.URL)(<span class=\"number\">0xc000176750</span>), Proto:<span class=\"string\">\"\"</span>, ProtoMajor:<span class=\"number\">0</span>, ProtoMinor:<span class=\"number\">0</span>, Header:http.Header&#123;<span class=\"string\">\"Referer\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"https://www.weiyigeek.top\"</span>&#125;&#125;, Body:io.ReadCloser(<span class=\"literal\">nil</span>), GetBody:(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span> <span class=\"params\">(io.ReadCloser, error)</span>)<span class=\"params\">(<span class=\"literal\">nil</span>)</span>, <span class=\"title\">ContentLength</span>:0, <span class=\"title\">TransferEncoding</span>:[]<span class=\"title\">string</span><span class=\"params\">(<span class=\"literal\">nil</span>)</span>, <span class=\"title\">Close</span>:<span class=\"title\">false</span>, <span class=\"title\">Host</span>:\"\", <span class=\"title\">Form</span>:<span class=\"title\">url</span>.<span class=\"title\">Values</span><span class=\"params\">(<span class=\"literal\">nil</span>)</span>, <span class=\"title\">PostForm</span>:<span class=\"title\">url</span>.<span class=\"title\">Values</span><span class=\"params\">(<span class=\"literal\">nil</span>)</span>, <span class=\"title\">MultipartForm</span>:<span class=\"params\">(*multipart.Form)</span><span class=\"params\">(<span class=\"literal\">nil</span>)</span>, <span class=\"title\">Trailer</span>:<span class=\"title\">http</span>.<span class=\"title\">Header</span><span class=\"params\">(<span class=\"literal\">nil</span>)</span>, <span class=\"title\">RemoteAddr</span>:\"\", <span class=\"title\">RequestURI</span>:\"\", <span class=\"title\">TLS</span>:<span class=\"params\">(*tls.ConnectionState)</span><span class=\"params\">(<span class=\"literal\">nil</span>)</span>, <span class=\"title\">Cancel</span>:<span class=\"params\">(&lt;-<span class=\"keyword\">chan</span> <span class=\"keyword\">struct</span> &#123;&#125;)</span><span class=\"params\">(<span class=\"literal\">nil</span>)</span>, <span class=\"title\">Response</span>:<span class=\"params\">(*http.Response)</span><span class=\"params\">(0xc000176630)</span>, <span class=\"title\">ctx</span>:<span class=\"params\">(*context.emptyCtx)</span><span class=\"params\">(0xc000134010)</span>&#125;,</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">resp</span>.<span class=\"title\">Header</span>: <span class=\"title\">http</span>.<span class=\"title\">Header</span></span>&#123;<span class=\"string\">\"Access-Control-Allow-Origin\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"*\"</span>&#125;, <span class=\"string\">\"Age\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"340\"</span>&#125;, <span class=\"string\">\"Alt-Svc\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"h3=\\\":443\\\"; ma=86400, h3-29=\\\":443\\\"; ma=86400, h3-28=\\\":443\\\"; ma=86400, h3-27=\\\":443\\\"; ma=86400\"</span>&#125;, <span class=\"string\">\"Cache-Control\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"max-age=600\"</span>&#125;, <span class=\"string\">\"Cf-Cache-Status\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"DYNAMIC\"</span>&#125;, <span class=\"string\">\"Cf-Ray\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"6b222396a8d10d24-LAX\"</span>&#125;, <span class=\"string\">\"Content-Type\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"text/html; charset=utf-8\"</span>&#125;, <span class=\"string\">\"Date\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"Mon, 22 Nov 2021 12:25:11 GMT\"</span>&#125;, <span class=\"string\">\"Expect-Ct\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"max-age=604800, report-uri=\\\"https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct\\\"\"</span>&#125;, <span class=\"string\">\"Expires\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"Mon, 22 Nov 2021 12:27:16 GMT\"</span>&#125;, <span class=\"string\">\"Last-Modified\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"Fri, 08 Oct 2021 11:30:52 GMT\"</span>&#125;, <span class=\"string\">\"Nel\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"&#123;\\\"success_fraction\\\":0,\\\"report_to\\\":\\\"cf-nel\\\",\\\"max_age\\\":604800&#125;\"</span>&#125;, <span class=\"string\">\"Report-To\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"&#123;\\\"endpoints\\\":[&#123;\\\"url\\\":\\\"https:\\\\/\\\\/a.nel.cloudflare.com\\\\/report\\\\/v3?s=6dx48uJJynNOFy1TpNXdJU0V%2FfBjazc15i3SLtiT4xoXr8vXl0MZTRuVE11vx33KNqsU05DfmNKKuPrzDTBstP32mSG%2B%2FNWUtG%2B4vlX5Ro3hApIow24bII5D0uT8FtSh\\\"&#125;],\\\"group\\\":\\\"cf-nel\\\",\\\"max_age\\\":604800&#125;\"</span>&#125;, <span class=\"string\">\"Server\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"cloudflare\"</span>&#125;, <span class=\"string\">\"Vary\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"Accept-Encoding\"</span>&#125;, <span class=\"string\">\"Via\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"1.1 varnish\"</span>&#125;, <span class=\"string\">\"X-Cache\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"HIT\"</span>&#125;, <span class=\"string\">\"X-Cache-Hits\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"1\"</span>&#125;, <span class=\"string\">\"X-Fastly-Request-Id\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"de2ef3b07dec51677274e7fe8eb68162dc77c39d\"</span>&#125;, <span class=\"string\">\"X-Github-Request-Id\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"C002:9402:1A6C52:23CF10:619B8A4C\"</span>&#125;, <span class=\"string\">\"X-Proxy-Cache\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"MISS\"</span>&#125;, <span class=\"string\">\"X-Served-By\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"cache-bur17563-BUR\"</span>&#125;, <span class=\"string\">\"X-Timer\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"S1637583911.481935,VS0,VE1\"</span>&#125;&#125;</span><br><span class=\"line\">resp.Cookies: []*http.Cookie&#123;&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">resp.TLS: &amp;tls.ConnectionState&#123;Version:<span class=\"number\">0x304</span>, HandshakeComplete:<span class=\"literal\">true</span>, DidResume:<span class=\"literal\">false</span>, CipherSuite:<span class=\"number\">0x1301</span>, NegotiatedProtocol:<span class=\"string\">\"h2\"</span>, NegotiatedProtocolIsMutual:<span class=\"literal\">true</span>, ServerName:<span class=\"string\">\"weiyigeek.top\"</span>, PeerCertificates:[]*x509.Certificate&#123;(*x509.Certificate)(<span class=\"number\">0xc000324000</span>), (*x509.Certificate)(<span class=\"number\">0xc000324580</span>)&#125;, VerifiedChains:[][]*x509.Certificate&#123;[]*x509.Certificate&#123;(*x509.Certificate)(<span class=\"number\">0xc000324000</span>), (*x509.Certificate)(<span class=\"number\">0xc000324580</span>), (*x509.Certificate)(<span class=\"number\">0xc000267180</span>)&#125;&#125;, SignedCertificateTimestamps:[][]<span class=\"keyword\">uint8</span>(<span class=\"literal\">nil</span>), OCSPResponse:[]<span class=\"keyword\">uint8</span>&#123;<span class=\"number\">0x30</span>, <span class=\"number\">0x82</span>, <span class=\"number\">0x1</span>, <span class=\"number\">0x12</span>, <span class=\"number\">0xa</span>, <span class=\"number\">0x1</span>, <span class=\"number\">0x0</span>, <span class=\"number\">0xa0</span>, <span class=\"number\">0x82</span>, <span class=\"number\">0x1</span>, <span class=\"number\">0xb</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x82</span>, <span class=\"number\">0x1</span>, <span class=\"number\">0x7</span>, <span class=\"number\">0x6</span>, <span class=\"number\">0x9</span>, <span class=\"number\">0x2b</span>, <span class=\"number\">0x6</span>, <span class=\"number\">0x1</span>, <span class=\"number\">0x5</span>, <span class=\"number\">0x5</span>, <span class=\"number\">0x7</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x1</span>, <span class=\"number\">0x1</span>, <span class=\"number\">0x4</span>, <span class=\"number\">0x81</span>, <span class=\"number\">0xf9</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x81</span>, <span class=\"number\">0xf6</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x81</span>, <span class=\"number\">0x9e</span>, <span class=\"number\">0xa2</span>, <span class=\"number\">0x16</span>, <span class=\"number\">0x4</span>, <span class=\"number\">0x14</span>, <span class=\"number\">0xa5</span>, <span class=\"number\">0xce</span>, <span class=\"number\">0x37</span>, <span class=\"number\">0xea</span>, <span class=\"number\">0xeb</span>, <span class=\"number\">0xb0</span>, <span class=\"number\">0x75</span>, <span class=\"number\">0xe</span>, <span class=\"number\">0x94</span>, <span class=\"number\">0x67</span>, <span class=\"number\">0x88</span>, <span class=\"number\">0xb4</span>, <span class=\"number\">0x45</span>, <span class=\"number\">0xfa</span>, <span class=\"number\">0xd9</span>, <span class=\"number\">0x24</span>, <span class=\"number\">0x10</span>, <span class=\"number\">0x87</span>, <span class=\"number\">0x96</span>, <span class=\"number\">0x1f</span>, <span class=\"number\">0x18</span>, <span class=\"number\">0xf</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0x38</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x34</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x33</span>, <span class=\"number\">0x38</span>, <span class=\"number\">0x5a</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x73</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x71</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x49</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x9</span>, <span class=\"number\">0x6</span>, <span class=\"number\">0x5</span>, <span class=\"number\">0x2b</span>, <span class=\"number\">0xe</span>, <span class=\"number\">0x3</span>, <span class=\"number\">0x2</span>, <span class=\"number\">0x1a</span>, <span class=\"number\">0x5</span>, <span class=\"number\">0x0</span>, <span class=\"number\">0x4</span>, <span class=\"number\">0x14</span>, <span class=\"number\">0x12</span>, <span class=\"number\">0xd7</span>, <span class=\"number\">0x8b</span>, <span class=\"number\">0x40</span>, <span class=\"number\">0x2c</span>, <span class=\"number\">0x35</span>, <span class=\"number\">0x62</span>, <span class=\"number\">0x6</span>, <span class=\"number\">0xfa</span>, <span class=\"number\">0x82</span>, <span class=\"number\">0x7f</span>, <span class=\"number\">0x8e</span>, <span class=\"number\">0xd8</span>, <span class=\"number\">0x92</span>, <span class=\"number\">0x24</span>, <span class=\"number\">0x11</span>, <span class=\"number\">0xb4</span>, <span class=\"number\">0xac</span>, <span class=\"number\">0xf5</span>, <span class=\"number\">0x4</span>, <span class=\"number\">0x4</span>, <span class=\"number\">0x14</span>, <span class=\"number\">0xa5</span>, <span class=\"number\">0xce</span>, <span class=\"number\">0x37</span>, <span class=\"number\">0xea</span>, <span class=\"number\">0xeb</span>, <span class=\"number\">0xb0</span>, <span class=\"number\">0x75</span>, <span class=\"number\">0xe</span>, <span class=\"number\">0x94</span>, <span class=\"number\">0x67</span>, <span class=\"number\">0x88</span>, <span class=\"number\">0xb4</span>, <span class=\"number\">0x45</span>, <span class=\"number\">0xfa</span>, <span class=\"number\">0xd9</span>, <span class=\"number\">0x24</span>, <span class=\"number\">0x10</span>, <span class=\"number\">0x87</span>, <span class=\"number\">0x96</span>, <span class=\"number\">0x1f</span>, <span class=\"number\">0x2</span>, <span class=\"number\">0x10</span>, <span class=\"number\">0x9</span>, <span class=\"number\">0x98</span>, <span class=\"number\">0xa5</span>, <span class=\"number\">0x9a</span>, <span class=\"number\">0x26</span>, <span class=\"number\">0x72</span>, <span class=\"number\">0xc7</span>, <span class=\"number\">0x24</span>, <span class=\"number\">0x4a</span>, <span class=\"number\">0x4d</span>, <span class=\"number\">0xc5</span>, <span class=\"number\">0x92</span>, <span class=\"number\">0x80</span>, <span class=\"number\">0xfb</span>, <span class=\"number\">0x65</span>, <span class=\"number\">0x5a</span>, <span class=\"number\">0x80</span>, <span class=\"number\">0x0</span>, <span class=\"number\">0x18</span>, <span class=\"number\">0xf</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0x38</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x37</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x5a</span>, <span class=\"number\">0xa0</span>, <span class=\"number\">0x11</span>, <span class=\"number\">0x18</span>, <span class=\"number\">0xf</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x35</span>, <span class=\"number\">0x31</span>, <span class=\"number\">0x39</span>, <span class=\"number\">0x34</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x5a</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0xa</span>, <span class=\"number\">0x6</span>, <span class=\"number\">0x8</span>, <span class=\"number\">0x2a</span>, <span class=\"number\">0x86</span>, <span class=\"number\">0x48</span>, <span class=\"number\">0xce</span>, <span class=\"number\">0x3d</span>, <span class=\"number\">0x4</span>, <span class=\"number\">0x3</span>, <span class=\"number\">0x2</span>, <span class=\"number\">0x3</span>, <span class=\"number\">0x47</span>, <span class=\"number\">0x0</span>, <span class=\"number\">0x30</span>, <span class=\"number\">0x44</span>, <span class=\"number\">0x2</span>, <span class=\"number\">0x20</span>, <span class=\"number\">0x5f</span>, <span class=\"number\">0x88</span>, <span class=\"number\">0xf2</span>, <span class=\"number\">0xc1</span>, <span class=\"number\">0x99</span>, <span class=\"number\">0xcf</span>, <span class=\"number\">0x99</span>, <span class=\"number\">0x2b</span>, <span class=\"number\">0x57</span>, <span class=\"number\">0xd6</span>, <span class=\"number\">0xd0</span>, <span class=\"number\">0x38</span>, <span class=\"number\">0x2e</span>, <span class=\"number\">0x7</span>, <span class=\"number\">0x72</span>, <span class=\"number\">0xc7</span>, <span class=\"number\">0x7d</span>, <span class=\"number\">0x48</span>, <span class=\"number\">0x34</span>, <span class=\"number\">0x57</span>, <span class=\"number\">0x60</span>, <span class=\"number\">0x19</span>, <span class=\"number\">0xe</span>, <span class=\"number\">0x42</span>, <span class=\"number\">0xd1</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0x6b</span>, <span class=\"number\">0xea</span>, <span class=\"number\">0x5f</span>, <span class=\"number\">0xbd</span>, <span class=\"number\">0xfa</span>, <span class=\"number\">0x36</span>, <span class=\"number\">0x2</span>, <span class=\"number\">0x20</span>, <span class=\"number\">0x67</span>, <span class=\"number\">0xc7</span>, <span class=\"number\">0xc1</span>, <span class=\"number\">0x3</span>, <span class=\"number\">0xd4</span>, <span class=\"number\">0xed</span>, <span class=\"number\">0x1e</span>, <span class=\"number\">0x32</span>, <span class=\"number\">0xb3</span>, <span class=\"number\">0x5f</span>, <span class=\"number\">0x7e</span>, <span class=\"number\">0xb3</span>, <span class=\"number\">0xc8</span>, <span class=\"number\">0x10</span>, <span class=\"number\">0xb4</span>, <span class=\"number\">0xdf</span>, <span class=\"number\">0x88</span>, <span class=\"number\">0x47</span>, <span class=\"number\">0x1c</span>, <span class=\"number\">0xf3</span>, <span class=\"number\">0xee</span>, <span class=\"number\">0xab</span>, <span class=\"number\">0x3b</span>, <span class=\"number\">0x86</span>, <span class=\"number\">0xc7</span>, <span class=\"number\">0xe4</span>, <span class=\"number\">0xbc</span>, <span class=\"number\">0xcf</span>, <span class=\"number\">0x5c</span>, <span class=\"number\">0x1d</span>, <span class=\"number\">0x69</span>, <span class=\"number\">0x48</span>&#125;, TLSUnique:[]<span class=\"keyword\">uint8</span>(<span class=\"literal\">nil</span>), ekm:(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(<span class=\"keyword\">string</span>, []<span class=\"keyword\">uint8</span>, <span class=\"keyword\">int</span>)</span> <span class=\"params\">([]<span class=\"keyword\">uint8</span>, error)</span>)<span class=\"params\">(0x679b80)</span>&#125;</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">ç½‘ç«™å“åº”é•¿åº¦:  16853</span></span><br></pre></td></tr></table></figure>\n<p><br/></p>\n<p><strong>è‡ªå®šä¹‰ Client&amp;Transport</strong><br>æè¿°: è¦ç®¡ç†HTTPå®¢æˆ·ç«¯çš„å¤´åŸŸã€é‡å®šå‘ç­–ç•¥å’Œå…¶ä»–è®¾ç½®ï¼Œåˆ›å»ºä¸€ä¸ªClientï¼š<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// é‡å®šå‘ç­–ç•¥</span></span><br><span class=\"line\">client := &amp;http.Client&#123;</span><br><span class=\"line\">  <span class=\"comment\">// CheckRedirectæŒ‡å®šå¤„ç†é‡å®šå‘çš„ç­–ç•¥ã€‚å¦‚æœCheckRedirectä¸æ˜¯nilï¼Œåˆ™å®¢æˆ·ç«¯åœ¨æ‰§è¡ŒHTTPé‡å®šå‘ä¹‹å‰è°ƒç”¨å®ƒã€‚</span></span><br><span class=\"line\">  CheckRedirect: redirectPolicyFunc,</span><br><span class=\"line\">  <span class=\"comment\">// è¶…æ—¶æŒ‡å®šæ­¤å®¢æˆ·ç«¯å‘å‡ºçš„è¯·æ±‚çš„æ—¶é—´é™åˆ¶ã€‚è¶…æ—¶åŒ…æ‹¬è¿æ¥æ—¶é—´ã€ä»»ä½•é‡å®šå‘å’Œè¯»å–å“åº”æ­£æ–‡ã€‚Getã€Headã€Postæˆ–Doè¿”å›åï¼Œè®¡æ—¶å™¨å°†ä¿æŒè¿è¡Œï¼Œå¹¶å°†ä¸­æ–­Response.Bodyçš„è¯»å–ã€‚</span></span><br><span class=\"line\">  Timeoutï¼š <span class=\"number\">30</span> * time.Second,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">resp, err := client.Get(<span class=\"string\">\"http://example.com\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¯·æ±‚å¯¹è±¡è®¾ç½®ä¸&amp;è‡ªå®šä¹‰è¯·æ±‚å¤´</span></span><br><span class=\"line\">req, err := http.NewRequest(<span class=\"string\">\"GET\"</span>, <span class=\"string\">\"http://example.com\"</span>, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">req.Header.Add(<span class=\"string\">\"If-None-Match\"</span>, <span class=\"string\">`W/\"wyzzy\"`</span>)</span><br><span class=\"line\">resp, err := client.Do(req)</span><br><span class=\"line\"><span class=\"comment\">// ...</span></span><br></pre></td></tr></table></figure></p>\n<p>æè¿°: è¦ç®¡ç†ä»£ç†ã€TLSé…ç½®ã€keep-aliveã€å‹ç¼©å’Œå…¶ä»–è®¾ç½®ï¼Œåˆ›å»ºä¸€ä¸ªTransportï¼š<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tr := &amp;http.Transport&#123;</span><br><span class=\"line\">  <span class=\"comment\">// TLS é…ç½®</span></span><br><span class=\"line\">  TLSClientConfig:    &amp;tls.Config&#123;RootCAs: pool&#125;,</span><br><span class=\"line\">  <span class=\"comment\">// æ˜¯å¦ç¦ç”¨å‹ç¼©</span></span><br><span class=\"line\">  DisableCompression: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"comment\">// æ˜¯å¦ä¿æŒè¿æ¥(é•¿è¿æ¥ã€çŸ­è¿æ¥)</span></span><br><span class=\"line\">  DisableKeepAlives:  <span class=\"literal\">true</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">client := &amp;http.Client&#123;Transport: tr&#125;</span><br><span class=\"line\">resp, err := client.Get(<span class=\"string\">\"https://example.com\"</span>)</span><br></pre></td></tr></table></figure><br>Tips: <code>Client</code>å’Œ<code>Transport</code>ç±»å‹éƒ½å¯ä»¥å®‰å…¨çš„è¢«å¤šä¸ªgoroutineåŒæ—¶ä½¿ç”¨, å‡ºäºæ•ˆç‡è€ƒè™‘ï¼Œåº”è¯¥ä¸€æ¬¡å»ºç«‹ã€å°½é‡é‡ç”¨ã€‚<br>Tips: å¦‚æœå–æ•°æ®æ¯”è¾ƒé¢‘ç¹çš„åœºæ™¯å»ºè®®ä½¿ç”¨é•¿è¿æ¥,å¦åˆ™ä½¿ç”¨çŸ­è¿æ¥å³å¯ã€‚</p>\n<p><br/></p>\n<h3 id=\"3-ç»¼åˆå®è·µ\"><a href=\"#3-ç»¼åˆå®è·µ\" class=\"headerlink\" title=\"3.ç»¼åˆå®è·µ\"></a>3.ç»¼åˆå®è·µ</h3><h4 id=\"3-1-Get-è¯·æ±‚ç¤ºä¾‹\"><a href=\"#3-1-Get-è¯·æ±‚ç¤ºä¾‹\" class=\"headerlink\" title=\"3.1 Get è¯·æ±‚ç¤ºä¾‹\"></a>3.1 Get è¯·æ±‚ç¤ºä¾‹</h4><p>get_client.go<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">\"fmt\"</span></span><br><span class=\"line\">  <span class=\"string\">\"io/ioutil\"</span></span><br><span class=\"line\">  <span class=\"string\">\"net/http\"</span></span><br><span class=\"line\">  <span class=\"string\">\"net/url\"</span></span><br><span class=\"line\">  <span class=\"string\">\"strings\"</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">getMethod</span><span class=\"params\">(urlstr <span class=\"keyword\">string</span>)</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 1.URLæ ¼å¼æ ¡éªŒè§£æ</span></span><br><span class=\"line\">  urlParse, err := url.Parse(urlstr)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Url %v Format Error!\\nerr: %v\\n\"</span>, urlParse, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 2.URLå‚æ•°è®¾ç½®ä¸ç¼–ç </span></span><br><span class=\"line\">  data := url.Values&#123;&#125;</span><br><span class=\"line\">  data.Set(<span class=\"string\">\"id\"</span>, <span class=\"string\">\"1024\"</span>)</span><br><span class=\"line\">  data.Set(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"å”¯ä¸€æå®¢\"</span>)</span><br><span class=\"line\">  <span class=\"comment\">// å¤„ç†URLä¸­åŒ…å«çš„ä¸­æ–‡å‚æ•°,æ­¤å¤„é‡‡ç”¨encodeè¿›è¡Œç¼–ç .</span></span><br><span class=\"line\">  queryStr := data.Encode()</span><br><span class=\"line\">  <span class=\"comment\">// URLå‚æ•°è®¾ç½®å¹¶è¾“å‡ºå¤„ç†è¿‡åçš„è¯·æ±‚å­—ç¬¦ä¸²</span></span><br><span class=\"line\">  urlParse.RawQuery = queryStr <span class=\"comment\">// encoded query values, without '?'</span></span><br><span class=\"line\">  fmt.Println(<span class=\"string\">\"QueryStr =&gt; \"</span>, queryStr)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 3.NewRequestä½¿ç”¨åå°ä¸Šä¸‹æ–‡åŒ…è£…NewRequestWithContext,è¿”å›è¯·æ±‚å¯¹è±¡</span></span><br><span class=\"line\">  req, err := http.NewRequest(<span class=\"string\">\"Get\"</span>, urlParse.String(), <span class=\"literal\">nil</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"NewRequest %v faile!\\n[error]: %v\\n\"</span>, urlstr, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 5.DefaultClientæ˜¯é»˜è®¤å®¢æˆ·ç«¯ï¼Œç”±Getã€Headå’ŒPostè¯·æ±‚ä½¿ç”¨,æ­¤æ—¶ä¼ å…¥ä¸Šé¢å¤„è¿‡çš„reqè¯·æ±‚å¯¹è±¡</span></span><br><span class=\"line\">  resp, err := http.DefaultClient.Do(req)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Request %v faile!\\n[error]: %v\\n\"</span>, urlstr, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 6.ç¨‹åºå®Œæ¯•æ—¶å…³é—­å›å¤çš„ä¸»ä½“(éå¸¸é‡è¦).</span></span><br><span class=\"line\">  <span class=\"keyword\">defer</span> resp.Body.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 7.ä»respä¸­æŠŠæœåŠ¡ç«¯è¿”å›çš„æ•°æ®è¯»å‡ºæ¥</span></span><br><span class=\"line\">  <span class=\"comment\">// æ–¹å¼1</span></span><br><span class=\"line\">  <span class=\"comment\">// var data []byte</span></span><br><span class=\"line\">  <span class=\"comment\">// response.Body.Read(data)</span></span><br><span class=\"line\">  <span class=\"comment\">// æ–¹å¼2</span></span><br><span class=\"line\">  body, err := ioutil.ReadAll(resp.Body)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"read from resp.Body failed, err:%v\\n\"</span>, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 8.ç½‘ç«™è¯·æ±‚å“åº”æ•°æ®é›†åˆ</span></span><br><span class=\"line\">  fmt.Printf(<span class=\"string\">\"resp.StatusCode : %v,\\nresp.Status: %v,\\nresp.Request: %#v,\\nresp.Header: %#v\\nresp.Cookies: %#v,\\nresp.TLS: %#v\\n\"</span>,</span><br><span class=\"line\">    resp.StatusCode,</span><br><span class=\"line\">    resp.Status,</span><br><span class=\"line\">    resp.Request,</span><br><span class=\"line\">    resp.Header,</span><br><span class=\"line\">    resp.Cookies(),</span><br><span class=\"line\">    resp.TLS)</span><br><span class=\"line\">  fmt.Println(<span class=\"string\">\"ç½‘ç«™å“åº”é•¿åº¦: \"</span>, <span class=\"built_in\">len</span>(body))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  getMethod(<span class=\"string\">\"http://10.20.172.108:8080/get\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœ:<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">QueryStr =&gt;  id=<span class=\"number\">1024</span>&amp;name=%E5%<span class=\"number\">94</span>%AF%E4%B8%<span class=\"number\">80</span>%E6%<span class=\"number\">9</span>E%<span class=\"number\">81</span>%E5%AE%A2 <span class=\"comment\">//url ç¼–ç å</span></span><br><span class=\"line\">resp.StatusCode : <span class=\"number\">200</span>,</span><br><span class=\"line\">resp.Status: <span class=\"number\">200</span> OK,</span><br><span class=\"line\">resp.Request: &amp;http.Request&#123;Method:<span class=\"string\">\"Get\"</span>, URL:(*url.URL)(<span class=\"number\">0xc0000f</span>e090), Proto:<span class=\"string\">\"HTTP/1.1\"</span>, ProtoMajor:<span class=\"number\">1</span>, ProtoMinor:<span class=\"number\">1</span>, Header:http.Header&#123;&#125;, Body:io.ReadCloser(<span class=\"literal\">nil</span>), GetBody:(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span> <span class=\"params\">(io.ReadCloser, error)</span>)<span class=\"params\">(<span class=\"literal\">nil</span>)</span>, <span class=\"title\">ContentLength</span>:0, <span class=\"title\">TransferEncoding</span>:[]<span class=\"title\">string</span><span class=\"params\">(<span class=\"literal\">nil</span>)</span>, <span class=\"title\">Close</span>:<span class=\"title\">false</span>, <span class=\"title\">Host</span>:\"10.20.172.108:8080\", <span class=\"title\">Form</span>:<span class=\"title\">url</span>.<span class=\"title\">Values</span><span class=\"params\">(<span class=\"literal\">nil</span>)</span>, <span class=\"title\">PostForm</span>:<span class=\"title\">url</span>.<span class=\"title\">Values</span><span class=\"params\">(<span class=\"literal\">nil</span>)</span>, <span class=\"title\">MultipartForm</span>:<span class=\"params\">(*multipart.Form)</span><span class=\"params\">(<span class=\"literal\">nil</span>)</span>, <span class=\"title\">Trailer</span>:<span class=\"title\">http</span>.<span class=\"title\">Header</span><span class=\"params\">(<span class=\"literal\">nil</span>)</span>, <span class=\"title\">RemoteAddr</span>:\"\", <span class=\"title\">RequestURI</span>:\"\", <span class=\"title\">TLS</span>:<span class=\"params\">(*tls.ConnectionState)</span><span class=\"params\">(<span class=\"literal\">nil</span>)</span>, <span class=\"title\">Cancel</span>:<span class=\"params\">(&lt;-<span class=\"keyword\">chan</span> <span class=\"keyword\">struct</span> &#123;&#125;)</span><span class=\"params\">(<span class=\"literal\">nil</span>)</span>, <span class=\"title\">Response</span>:<span class=\"params\">(*http.Response)</span><span class=\"params\">(<span class=\"literal\">nil</span>)</span>, <span class=\"title\">ctx</span>:<span class=\"params\">(*context.emptyCtx)</span><span class=\"params\">(0xc0000b0010)</span>&#125;,</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">resp</span>.<span class=\"title\">Header</span>: <span class=\"title\">http</span>.<span class=\"title\">Header</span></span>&#123;<span class=\"string\">\"Content-Length\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"68\"</span>&#125;, <span class=\"string\">\"Content-Type\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"application/json;charset=UTF-8\"</span>&#125;, <span class=\"string\">\"Cookies\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"id=1024;name=å”¯ä¸€æå®¢\"</span>&#125;, <span class=\"string\">\"Date\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"Tue, 23 Nov 2021 05:25:41 GMT\"</span>&#125;, <span class=\"string\">\"Requestmethod\"</span>:[]<span class=\"keyword\">string</span>&#123;<span class=\"string\">\"Get\"</span>&#125;&#125;</span><br><span class=\"line\">resp.Cookies: []*http.Cookie&#123;&#125;,</span><br><span class=\"line\">resp.TLS: (*tls.ConnectionState)(<span class=\"literal\">nil</span>)</span><br><span class=\"line\">ç½‘ç«™å“åº”é•¿åº¦:  <span class=\"number\">68</span></span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h4 id=\"3-2-Post-è¯·æ±‚ç¤ºä¾‹\"><a href=\"#3-2-Post-è¯·æ±‚ç¤ºä¾‹\" class=\"headerlink\" title=\"3.2 Post è¯·æ±‚ç¤ºä¾‹\"></a>3.2 Post è¯·æ±‚ç¤ºä¾‹</h4><p>post_client.go<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// POST ç¤ºä¾‹</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">postMethos</span><span class=\"params\">(urlstr <span class=\"keyword\">string</span>)</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// (1) å®šä¹‰Postè¯·æ±‚ä¸Šä¼ çš„å‚æ•°( è¡¨å•æ•°æ®/jsonæ•°æ®)</span></span><br><span class=\"line\">  <span class=\"comment\">//contentType := \"application/x-www-form-urlencoded\"</span></span><br><span class=\"line\">  <span class=\"comment\">//data := \"name=å°ç‹å­&amp;age=18\"</span></span><br><span class=\"line\">  contentType := <span class=\"string\">\"application/json\"</span></span><br><span class=\"line\">  data := <span class=\"string\">`&#123;\"id\":128,\"name\":\"Weiyi\"&#125;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// (2) è¿›è¡Œ Post è¯·æ±‚ä¼ å…¥è¯·æ±‚url,contentTypeä»¥åŠPostä¸Šä¼ çš„dataæ•°æ®</span></span><br><span class=\"line\">  <span class=\"comment\">// resp, err := http.Post(\"http://example.com/upload\", \"image/jpeg\", &amp;buf)</span></span><br><span class=\"line\">  resp, err := http.Post(urlstr, contentType, strings.NewReader(data))</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"post failed, err:%v\\n\"</span>, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// (3) ç¨‹åºç»“æŸåˆ™å…³é—­respèµ„æº</span></span><br><span class=\"line\">  <span class=\"keyword\">defer</span> resp.Body.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// (4) è¯»å–POSTè¯·æ±‚è¿”å›çš„æ•°æ®åŒ…</span></span><br><span class=\"line\">  body, err := ioutil.ReadAll(resp.Body)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"get resp failed, err:%v\\n\"</span>, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  fmt.Println(<span class=\"string\">\"Body : \"</span>, <span class=\"keyword\">string</span>(body))</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// (5) å“åº”å¤´è¾“å‡º</span></span><br><span class=\"line\">  fmt.Println(<span class=\"string\">\"resp.Header : \"</span>, resp.Header)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  postMethos(<span class=\"string\">\"http://10.20.172.108:8080/post\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœ:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Body :  &#123;<span class=\"string\">\"method\"</span>:<span class=\"string\">\"POST\"</span>,<span class=\"string\">\"status\"</span>:<span class=\"string\">\"ok\"</span>,<span class=\"string\">\"data\"</span>:&#123;<span class=\"string\">\"id\"</span>:128,<span class=\"string\">\"name\"</span>:<span class=\"string\">\"Weiyi\"</span>&#125;&#125;</span><br><span class=\"line\">resp.Header :  map[Content-Length:[64] Content-Type:[application/json;charset=UTF-8] Cookies:[id=128;name=Weiyi] Date:[Tue, 23 Nov 2021 05:25:41 GMT] Requestmethod:[Post]]</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h4 id=\"3-3-PostForm-è¯·æ±‚ç¤ºä¾‹\"><a href=\"#3-3-PostForm-è¯·æ±‚ç¤ºä¾‹\" class=\"headerlink\" title=\"3.3 PostForm è¯·æ±‚ç¤ºä¾‹\"></a>3.3 PostForm è¯·æ±‚ç¤ºä¾‹</h4><p>postForm_client.go<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">postFormMethod</span><span class=\"params\">(urlstr <span class=\"keyword\">string</span>)</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// (1) æ–¹å¼1å®šä¹‰Postè¯·æ±‚ä¸Šä¼ çš„å‚æ•°( è¡¨å•æ•°æ®)</span></span><br><span class=\"line\">  <span class=\"comment\">//contentType := \"application/x-www-form-urlencoded\"</span></span><br><span class=\"line\">  <span class=\"comment\">//data := \"id=256&amp;name=å”¯ä¸€æå®¢\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// (2) æ–¹å¼2å®šä¹‰Postè¯·æ±‚ä¸Šä¼ çš„å‚æ•°( è¡¨å•æ•°æ®)</span></span><br><span class=\"line\">  data := url.Values&#123;&#125;</span><br><span class=\"line\">  data.Set(<span class=\"string\">\"id\"</span>, <span class=\"string\">\"256\"</span>)</span><br><span class=\"line\">  data.Set(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"WeiyiGeek-å”¯ä¸€æå®¢\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// (3) è¿›è¡Œè¡¨å•ä¸Šä¼ è¯·æ±‚</span></span><br><span class=\"line\">  <span class=\"comment\">// resp, err := http.PostForm(\"http://example.com/form\", url.Values&#123;\"key\": &#123;\"Value\"&#125;, \"id\": &#123;\"123\"&#125;&#125;)</span></span><br><span class=\"line\">  resp, err := http.PostForm(urlstr, data)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"postForm failed, err:%v\\n\"</span>, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// (4) ç¨‹åºç»“æŸåˆ™å…³é—­respèµ„æº</span></span><br><span class=\"line\">  <span class=\"keyword\">defer</span> resp.Body.Close()</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// (5) è¯»å–POSTè¯·æ±‚è¿”å›çš„æ•°æ®åŒ…</span></span><br><span class=\"line\">  body, err := ioutil.ReadAll(resp.Body)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"get resp failed, err:%v\\n\"</span>, err)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  fmt.Println(<span class=\"string\">\"Body : \"</span>, <span class=\"keyword\">string</span>(body))</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// (6) å“åº”å¤´è¾“å‡º</span></span><br><span class=\"line\">  fmt.Println(<span class=\"string\">\"resp.Header : \"</span>, resp.Header)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  postFormMethod(<span class=\"string\">\"http://10.20.172.108:8080/postform\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>æ‰§è¡Œç»“æœ:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Body :  &#123;<span class=\"string\">\"method\"</span>:<span class=\"string\">\"POSTFORM\"</span>,<span class=\"string\">\"status\"</span>:<span class=\"string\">\"ok\"</span>,<span class=\"string\">\"data\"</span>:&#123;<span class=\"string\">\"id\"</span>:256,<span class=\"string\">\"name\"</span>:<span class=\"string\">\"WeiyiGeek\"</span>&#125;&#125;</span><br><span class=\"line\">resp.Header :  map[Content-Length:[72] Content-Type:[application/json;charset=UTF-8] Cookies:[method=form;id=256;name=WeiyiGeek-å”¯ä¸€æå®¢] Date:[Tue, 23 Nov 2021 05:25:41 GMT] Requestmethod:[PostForm]]</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h4 id=\"3-4-Http-æœåŠ¡å“åº”ç¤ºä¾‹\"><a href=\"#3-4-Http-æœåŠ¡å“åº”ç¤ºä¾‹\" class=\"headerlink\" title=\"3.4 Http æœåŠ¡å“åº”ç¤ºä¾‹\"></a>3.4 Http æœåŠ¡å“åº”ç¤ºä¾‹</h4><p>æè¿°: ä¸‹è¿°http_serve.goä»£ç åŒ…å«ä¸Šé¢ä¸‰ç§è¯·æ±‚ç¤ºä¾‹çš„å“åº”ï¼Œä»¥åŠè¯·æ±‚å‚æ•°è·å–ä»¥åŠè¾“å‡ºã€‚</p>\n<p>http_serve.go<br><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">  <span class=\"string\">\"encoding/json\"</span></span><br><span class=\"line\">  <span class=\"string\">\"fmt\"</span></span><br><span class=\"line\">  <span class=\"string\">\"io/ioutil\"</span></span><br><span class=\"line\">  <span class=\"string\">\"log\"</span></span><br><span class=\"line\">  <span class=\"string\">\"net/http\"</span></span><br><span class=\"line\">  <span class=\"string\">\"strconv\"</span></span><br><span class=\"line\">  <span class=\"string\">\"time\"</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 4.è‡ªå®šä¹‰Handlerç»“æ„ä½“</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> myHandler <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">  Id   <span class=\"keyword\">int</span>    <span class=\"string\">`json:\"id\"`</span></span><br><span class=\"line\">  Name <span class=\"keyword\">string</span> <span class=\"string\">`json:\"name\"`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 5.è‡ªå®šä¹‰myHandlerç»“æ„ä½“çš„æ–¹æ³•æ³¨å†Œåˆ°Handlerå¤„ç†ç¨‹åº,ã€éå¸¸æ³¨æ„ã€‘ã€ã€éå¸¸æ³¨æ„ã€‘æ–¹æ³•åå¿…é¡»ä¸º ServeHTTP</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(handler myHandler)</span> <span class=\"title\">ServeHTTP</span><span class=\"params\">(w http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 6.ç°åœ¨handleråŸºäºURLçš„è·¯å¾„éƒ¨åˆ†ï¼ˆreq.URL.Pathï¼‰æ¥å†³å®šæ‰§è¡Œä»€ä¹ˆé€»è¾‘ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">switch</span> req.URL.Path &#123;</span><br><span class=\"line\">  <span class=\"keyword\">case</span> <span class=\"string\">\"/get\"</span>:</span><br><span class=\"line\">    <span class=\"comment\">// 7.å¯¹äºå®¢æˆ·ç«¯Getè¯·æ±‚å‚æ•°è·å–</span></span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Method : %v, URL : %v \\n\"</span>, req.Method, req.URL)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 8.è‡ªåŠ¨è¯†åˆ«è¯·æ±‚URLä¸­çš„å‚æ•°,å‚æ•°åˆ©ç”¨Mapç±»å‹å˜é‡è¿›è¡Œå­˜å‚¨key-value</span></span><br><span class=\"line\">    fmt.Println(<span class=\"string\">\"QueryParam : \"</span>, req.URL.Query())</span><br><span class=\"line\">    queryParam := req.URL.Query()</span><br><span class=\"line\">    id := queryParam.Get(<span class=\"string\">\"id\"</span>)</span><br><span class=\"line\">    name := queryParam.Get(<span class=\"string\">\"name\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 9.æ‰“å°è¾“å‡ºqueryParamå­˜å‚¨çš„value</span></span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"id = %v,name = %v\\n\"</span>, id, name)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 10.æœåŠ¡ç«¯å“åº”å¤´headerè‡ªå®šä¹‰</span></span><br><span class=\"line\">    w.Header().Add(<span class=\"string\">\"RequestMethod\"</span>, <span class=\"string\">\"Get\"</span>)                            <span class=\"comment\">// æ­¤å¤„å°†å“åº”çš„RequestMethod headerå­—æ®µè®¾ç½®ä¸ºGet</span></span><br><span class=\"line\">    w.Header().Add(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/json;charset=UTF-8\"</span>)  <span class=\"comment\">// æ­¤å¤„å°†å“åº”çš„ç±»å‹è®¾ç½®ä¸ºJSON</span></span><br><span class=\"line\">    w.Header().Add(<span class=\"string\">\"Cookies\"</span>, fmt.Sprintf(<span class=\"string\">\"id=%v;name=%v\"</span>, id, name)) <span class=\"comment\">// æ­¤å¤„å°†å“åº”çš„cookiesè®¾ç½®ä¸ºè¯·æ±‚ä¼ å…¥çš„å‚æ•°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 11.è¿”å›ç»™å®¢æˆ·ç«¯çš„JSONæ•°æ®ç»„è£…</span></span><br><span class=\"line\">    uid, err := strconv.Atoi(id) <span class=\"comment\">// å°†getåˆ°çš„idå­—æ®µçš„å€¼è½¬æ¢ä¸ºæ•´å‹</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">      errMsg := fmt.Sprintf(<span class=\"string\">\"uid convert err! %v\\n\"</span>, err)</span><br><span class=\"line\">      fmt.Println(errMsg)</span><br><span class=\"line\">      w.Write([]<span class=\"keyword\">byte</span>(errMsg))</span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    reply := fmt.Sprintf(<span class=\"string\">\"&#123;\\\"method\\\":\\\"%v\\\",\\\"status\\\":\\\"ok\\\",\\\"data\\\":&#123;\\\"id\\\":%v,\\\"name\\\":\\\"%v\\\"&#125;&#125;\"</span>, <span class=\"string\">\"GET\"</span>, uid, handler.Name)</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"reply =&gt; %v\\n\\n\"</span>, reply)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 12.è¿”å›å“åº”æ•°æ®ç»™å®¢æˆ·ç«¯</span></span><br><span class=\"line\">    w.Write([]<span class=\"keyword\">byte</span>(reply))</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">case</span> <span class=\"string\">\"/post\"</span>:</span><br><span class=\"line\">    <span class=\"comment\">// 7.å¯¹äºå®¢æˆ·ç«¯Requestè¯·æ±‚ä¿¡æ¯è·å–</span></span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Method : %v, URL : %v \\n\"</span>, req.Method, req.URL)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 8.æœåŠ¡ç«¯æ‰“å°å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚,å½“è¯·æ±‚ç±»å‹æ˜¯application/jsonæ—¶æ‰èƒ½ä»req.Bodyè¯»å–æ•°æ®</span></span><br><span class=\"line\">    body, err := ioutil.ReadAll(req.Body)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">      fmt.Println(<span class=\"string\">\"req Body Read Error,\"</span>, err)</span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">\"req.Body =&gt; \"</span>, <span class=\"keyword\">string</span>(body))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//9.JSONååºåˆ—åŒ–</span></span><br><span class=\"line\">    json.Unmarshal(body, &amp;handler)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 10.æ‰“å°è¾“å‡ºqueryParamå­˜å‚¨çš„value</span></span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"id = %v,name = %v\\n\"</span>, handler.Id, handler.Name)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 11.æœåŠ¡ç«¯å“åº”å¤´headerè‡ªå®šä¹‰</span></span><br><span class=\"line\">    w.Header().Add(<span class=\"string\">\"RequestMethod\"</span>, <span class=\"string\">\"Post\"</span>)                                           <span class=\"comment\">// æ­¤å¤„å°†å“åº”çš„RequestMethod headerå­—æ®µè®¾ç½®ä¸ºPOST</span></span><br><span class=\"line\">    w.Header().Add(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/json;charset=UTF-8\"</span>)                  <span class=\"comment\">// æ­¤å¤„å°†å“åº”çš„ç±»å‹è®¾ç½®ä¸ºJSON</span></span><br><span class=\"line\">    w.Header().Add(<span class=\"string\">\"Cookies\"</span>, fmt.Sprintf(<span class=\"string\">\"id=%v;name=%v\"</span>, handler.Id, handler.Name)) <span class=\"comment\">// æ­¤å¤„å°†å“åº”çš„cookiesè®¾ç½®ä¸ºè¯·æ±‚ä¼ å…¥çš„å‚æ•°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 12.è¿”å›ç»™å®¢æˆ·ç«¯çš„JSONæ•°æ®ç»„è£…</span></span><br><span class=\"line\">    reply := fmt.Sprintf(<span class=\"string\">\"&#123;\\\"method\\\":\\\"%v\\\",\\\"status\\\":\\\"ok\\\",\\\"data\\\":&#123;\\\"id\\\":%v,\\\"name\\\":\\\"%v\\\"&#125;&#125;\"</span>, <span class=\"string\">\"POST\"</span>, handler.Id, handler.Name)</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"reply =&gt;  %v\\n\\n\"</span>, reply)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 13.è¿”å›å“åº”æ•°æ®ç»™å®¢æˆ·ç«¯</span></span><br><span class=\"line\">    w.Write([]<span class=\"keyword\">byte</span>(reply))</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">case</span> <span class=\"string\">\"/postform\"</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 7.å¯¹äºå®¢æˆ·ç«¯Requestè¯·æ±‚ä¿¡æ¯è·å–</span></span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"Method : %v, URL : %v \\n\"</span>, req.Method, req.URL)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 8. è¯·æ±‚ç±»å‹æ˜¯application/x-www-form-urlencodedæ—¶è§£æformæ•°æ®å¹¶æ‰“å°</span></span><br><span class=\"line\">    req.ParseForm()</span><br><span class=\"line\">    fmt.Println(req.PostForm)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 9.è·å–postformè¡¨å•ä¸­æŒ‡å®šçš„å­—æ®µå€¼.</span></span><br><span class=\"line\">    id := req.PostForm.Get(<span class=\"string\">\"id\"</span>)</span><br><span class=\"line\">    name := req.PostForm.Get(<span class=\"string\">\"name\"</span>)</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">\"id = %v, name = %v\\n\"</span>, id, name)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 10.æœåŠ¡ç«¯æ‰“å°å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚Bodyæ­¤å¤„ä¸º[],å› ä¸ºä½†å®¢æˆ·ç«¯è¯·æ±‚ç±»å‹æ˜¯application/jsonæ—¶æ‰èƒ½ä»req.Bodyè¯»å–æ•°æ®</span></span><br><span class=\"line\">    body, err := ioutil.ReadAll(req.Body)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">      fmt.Println(<span class=\"string\">\"req Body Read Error,\"</span>, err)</span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">\"req.Body =&gt; \"</span>, <span class=\"keyword\">string</span>(body))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 11.æœåŠ¡ç«¯å“åº”å¤´headerè‡ªå®šä¹‰</span></span><br><span class=\"line\">    w.Header().Add(<span class=\"string\">\"RequestMethod\"</span>, <span class=\"string\">\"PostForm\"</span>)                                   <span class=\"comment\">// æ­¤å¤„å°†å“åº”çš„RequestMethod headerå­—æ®µè®¾ç½®ä¸ºPostForm</span></span><br><span class=\"line\">    w.Header().Add(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/json;charset=UTF-8\"</span>)              <span class=\"comment\">// æ­¤å¤„å°†å“åº”çš„ç±»å‹è®¾ç½®ä¸ºJSON</span></span><br><span class=\"line\">    w.Header().Add(<span class=\"string\">\"Cookies\"</span>, fmt.Sprintf(<span class=\"string\">\"method=form;id=%v;name=%v\"</span>, id, name)) <span class=\"comment\">// æ­¤å¤„å°†å“åº”çš„cookiesè®¾ç½®ä¸ºè¯·æ±‚ä¼ å…¥çš„å‚æ•°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 12.è¿”å›ç»™å®¢æˆ·ç«¯çš„JSONæ•°æ®ç»„è£…</span></span><br><span class=\"line\">    uid, err := strconv.Atoi(id) <span class=\"comment\">// å°†getåˆ°çš„idå­—æ®µçš„å€¼è½¬æ¢ä¸ºæ•´å‹</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">      errMsg := fmt.Sprintf(<span class=\"string\">\"uid convert err! %v\\n\"</span>, err)</span><br><span class=\"line\">      fmt.Println(errMsg)</span><br><span class=\"line\">      w.Write([]<span class=\"keyword\">byte</span>(errMsg))</span><br><span class=\"line\">      <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    reply := fmt.Sprintf(<span class=\"string\">\"&#123;\\\"method\\\":\\\"%v\\\",\\\"status\\\":\\\"ok\\\",\\\"data\\\":&#123;\\\"id\\\":%v,\\\"name\\\":\\\"%v\\\"&#125;&#125;\"</span>, <span class=\"string\">\"POSTFORM\"</span>, uid, handler.Name)</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">\"reply =&gt; \"</span>, reply)</span><br><span class=\"line\">    w.Write([]<span class=\"keyword\">byte</span>(reply))</span><br><span class=\"line\">  <span class=\"keyword\">default</span>:</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœè¿™ä¸ªhandlerä¸èƒ½è¯†åˆ«è¿™ä¸ªè·¯å¾„ï¼Œå®ƒä¼šé€šè¿‡è°ƒç”¨è¿”å›å®¢æˆ·ç«¯ä¸€ä¸ªHTTP404é”™è¯¯,å¹¶å“åº”ç»™å®¢æˆ·ç«¯è¡¨æ˜è¯·æ±‚çš„è·¯å¾„ä¸å­˜åœ¨.</span></span><br><span class=\"line\">    w.WriteHeader(http.StatusNotFound) <span class=\"comment\">// 404</span></span><br><span class=\"line\">    fmt.Fprintf(w, <span class=\"string\">\"no such page: %s\\n\"</span>, req.URL)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 1.å®ä¾‹åŒ–ä¸€ä¸ªå¤„ç†æ‰€æœ‰è¯·æ±‚çš„Handleræ¥å£</span></span><br><span class=\"line\">  handler := myHandler&#123;Name: <span class=\"string\">\"WeiyiGeek\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 2.åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„Server,æ³¨æ„å¦‚æœHandlerä¸ºnilåˆ™é‡‡ç”¨http.DefaultServeMuxè¿›è¡Œå¤„ç†å“åº”,å¦åˆ™éœ€è¦æˆ‘ä»¬è‡ªå·±å®ç°ç»“æ„ä½“çš„ServeHTTPæ–¹æ³•.</span></span><br><span class=\"line\">  server := &amp;http.Server&#123;</span><br><span class=\"line\">    Addr:           <span class=\"string\">\":8080\"</span>,</span><br><span class=\"line\">    Handler:        handler,</span><br><span class=\"line\">    ReadTimeout:    <span class=\"number\">10</span> * time.Second,</span><br><span class=\"line\">    WriteTimeout:   <span class=\"number\">10</span> * time.Second,</span><br><span class=\"line\">    IdleTimeout:    <span class=\"number\">15</span> * time.Second,</span><br><span class=\"line\">    MaxHeaderBytes: <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">20</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 3.å¯åŠ¨å¹¶ç›‘å¬HTTPæœåŠ¡ç«¯</span></span><br><span class=\"line\">  fmt.Printf(<span class=\"string\">\"[%v] Http Server Start.....\\n\"</span>, time.Now().Format(<span class=\"string\">\"2006-01-02 15:04:05\"</span>))</span><br><span class=\"line\">  log.Fatal(server.ListenAndServe())</span><br><span class=\"line\">  <span class=\"keyword\">defer</span> fmt.Printf(<span class=\"string\">\"[%v] Http Server Close.....\\n\"</span>, time.Now().Format(<span class=\"string\">\"2006-01-02 15:04:05\"</span>))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœ:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ demo4 go build &amp;&amp; ./demo4</span><br><span class=\"line\">[2021-11-23 13:25:30] Http Server Start.....</span><br><span class=\"line\">Method : Get, URL : /get?id=1024&amp;name=%E5%94%AF%E4%B8%80%E6%9E%81%E5%AE%A2 </span><br><span class=\"line\">QueryParam :  map[id:[1024] name:[å”¯ä¸€æå®¢]]</span><br><span class=\"line\">id = 1024,name = å”¯ä¸€æå®¢</span><br><span class=\"line\">reply =&gt; &#123;<span class=\"string\">\"method\"</span>:<span class=\"string\">\"GET\"</span>,<span class=\"string\">\"status\"</span>:<span class=\"string\">\"ok\"</span>,<span class=\"string\">\"data\"</span>:&#123;<span class=\"string\">\"id\"</span>:1024,<span class=\"string\">\"name\"</span>:<span class=\"string\">\"WeiyiGeek\"</span>&#125;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Method : POST, URL : /post </span><br><span class=\"line\">req.Body =&gt;  &#123;<span class=\"string\">\"id\"</span>:128,<span class=\"string\">\"name\"</span>:<span class=\"string\">\"Weiyi\"</span>&#125;</span><br><span class=\"line\">id = 128,name = Weiyi</span><br><span class=\"line\">reply =&gt;  &#123;<span class=\"string\">\"method\"</span>:<span class=\"string\">\"POST\"</span>,<span class=\"string\">\"status\"</span>:<span class=\"string\">\"ok\"</span>,<span class=\"string\">\"data\"</span>:&#123;<span class=\"string\">\"id\"</span>:128,<span class=\"string\">\"name\"</span>:<span class=\"string\">\"Weiyi\"</span>&#125;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Method : POST, URL : /postform </span><br><span class=\"line\">map[id:[256] name:[WeiyiGeek-å”¯ä¸€æå®¢]]</span><br><span class=\"line\">id = 256, name = WeiyiGeek-å”¯ä¸€æå®¢</span><br><span class=\"line\">req.Body =&gt;  </span><br><span class=\"line\">reply =&gt;  &#123;<span class=\"string\">\"method\"</span>:<span class=\"string\">\"POSTFORM\"</span>,<span class=\"string\">\"status\"</span>:<span class=\"string\">\"ok\"</span>,<span class=\"string\">\"data\"</span>:&#123;<span class=\"string\">\"id\"</span>:256,<span class=\"string\">\"name\"</span>:<span class=\"string\">\"WeiyiGeek\"</span>&#125;&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Development","path":"api/categories/Development.json"},{"name":"Programming","path":"api/categories/Programming.json"}],"tags":[{"name":"Go","path":"api/tags/Go.json"}]}