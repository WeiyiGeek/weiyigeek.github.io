<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 2.åŸºäºContainerdè¿è¡Œæ—¶æ­å»ºKuberneteså¤šæ§åˆ¶å¹³é¢é›†ç¾¤å®è·µ|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="kubernetes,Containerd">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>2.åŸºäºContainerdè¿è¡Œæ—¶æ­å»ºKuberneteså¤šæ§åˆ¶å¹³é¢é›†ç¾¤å®è·µ</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">2.åŸºäºContainerdè¿è¡Œæ—¶æ­å»ºKuberneteså¤šæ§åˆ¶å¹³é¢é›†ç¾¤å®è·µ</h1>
        <h5 class="subtitle">
            
                <time datetime="2021-06-29T06:36:30.000Z" itemprop="datePublished" class="page-time">
  2021-06-29
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Containerd/2.åŸºäºContainerdå®‰è£…Kuberneteså¤šæ§åˆ¶å¹³é¢é›†ç¾¤å®è·µ"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">2.åŸºäºContainerdè¿è¡Œæ—¶æ­å»ºKuberneteså¤šæ§åˆ¶å¹³é¢é›†ç¾¤å®è·µ</h1>
        <div class="post-meta">
            <time class="post-time" title="2021-06-29 14:36:30" datetime="2021-06-29T06:36:30.000Z"  itemprop="datePublished">2021-06-29</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="0x00-å‰è¨€ç®€è¿°"><a href="#0x00-å‰è¨€ç®€è¿°" class="headerlink" title="0x00 å‰è¨€ç®€è¿°"></a>0x00 å‰è¨€ç®€è¿°</h2><p>æœ¬ç« ä¸»è¦è®²è¿°ï¼Œå¦‚æœä½¿ç”¨kubeadmè¿›è¡Œå®‰è£…é…ç½®K8Sé›†ç¾¤ï¼Œå¹¶æŒ‡å®šä½¿ç”¨containerdä½œä¸ºå®¹å™¨è¿è¡Œæ—¶æ­é…ä½¿ç”¨çš„å…·ä½“å®‰è£…æ­¥éª¤,ä»¥åŠå°½å¯èƒ½åœ¨æ¡ˆä¾‹ä¸­åŠ å…¥k8sé›†ç¾¤å¸¸ç”¨ç»„ä»¶åŠå…¶æ“ä½œé…ç½®ã€‚</p>
<hr>
<h2 id="0x01-ç¯å¢ƒå‡†å¤‡"><a href="#0x01-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="0x01 ç¯å¢ƒå‡†å¤‡"></a>0x01 ç¯å¢ƒå‡†å¤‡</h2><p>æè¿°: æ­¤Ubuntuæ“ä½œç³»ç»Ÿå·²åšå®‰å…¨åŠ å›ºå’Œå†…æ ¸ä¼˜åŒ–(SecOpsDev/Ubuntu-InitializeSecurity.sh at master Â· WeiyiGeek/SecOpsDev (github.com),å¦‚ä½ çš„Linuxæœªè¿›è¡Œç›¸åº”é…ç½®ç¯å¢ƒå¯èƒ½ä¸è¯»è€…æœ‰äº›è®¸å·®å¼‚ã€‚</p>
<p>åŠ å›ºè„šæœ¬: <a href="https://github.com/WeiyiGeek/SecOpsDev/blob/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Ubuntu/Ubuntu-InitializeSecurity.sh" target="_blank" rel="noopener">https://github.com/WeiyiGeek/SecOpsDev/blob/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Ubuntu/Ubuntu-InitializeSecurity.sh</a></p>
<p><strong>ä¸»æœºç¯å¢ƒ:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ“ä½œç³»ç»Ÿç‰ˆæœ¬: Ubuntu 20.04.2 LTS</span><br><span class="line">æ“ä½œå†…æ ¸ç‰ˆæœ¬: 5.4.0-78-generic</span><br><span class="line">ä¸»æœºåç§°ä¸IP:</span><br><span class="line">* k8s-master-1 10.10.107.220  2C 4G  @<span class="comment"># æ§åˆ¶å¹³é¢èŠ‚ç‚¹</span></span><br><span class="line">* k8s-node-1  10.10.107.221   2C 4G  @<span class="comment"># å·¥ä½œèŠ‚ç‚¹</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>è½¯ä»¶ç¯å¢ƒ:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubernetes -- v1.20.8</span><br><span class="line">containerd -- 1.4.6</span><br><span class="line">calico -- v3.18</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><strong>èŠ‚ç‚¹ç¯å¢ƒ</strong><br>Tips: ä»¥ä¸‹å‘½ä»¤éœ€è¦å†k8s-master-1å’Œk8s-node-1ä¸»æœºä¸Šéƒ½è¦è¿è¡Œã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.èŠ‚ç‚¹hostsä¿¡æ¯ä»¥åŠç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹ä¸Š MAC åœ°å€å’Œ product_uuid çš„å”¯ä¸€æ€§ </span></span><br><span class="line">tee -a /etc/hosts &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">10.10.107.220 k8s-master-1</span><br><span class="line">10.10.107.221 k8s-node-1</span><br><span class="line">10.10.107.220 newcluster.k8s</span><br><span class="line">EOF</span><br><span class="line"><span class="comment"># ä½ å¯ä»¥ä½¿ç”¨å‘½ä»¤ ip link æˆ– ifconfig -a æ¥è·å–ç½‘ç»œæ¥å£çš„ MAC åœ°å€</span></span><br><span class="line">ifconfig -a</span><br><span class="line"><span class="comment"># å¯ä»¥ä½¿ç”¨ sudo cat /sys/class/dmi/id/product_uuid å‘½ä»¤å¯¹ product_uuid æ ¡éªŒ</span></span><br><span class="line">sudo cat /sys/class/dmi/id/product_uuid</span><br><span class="line">  <span class="comment"># k8s-master-1: d0154d56-ffdd-697d-09a6-34c851710f09</span></span><br><span class="line">  <span class="comment"># k8s-node-1: f98c4d56-9fb2-bc92-98be-2648c83eb7b5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ç³»ç»Ÿæ—¶é—´æ—¶åŒºåŒæ­¥è®¾ç½® </span></span><br><span class="line">date -R</span><br><span class="line">sudo ntpdate ntp.aliyun.com</span><br><span class="line"><span class="comment"># chronyc sources</span></span><br><span class="line">sudo timedatectl <span class="built_in">set</span>-timezone Asia/Shanghai</span><br><span class="line"><span class="comment"># sudo dpkg-reconfigure tzdata</span></span><br><span class="line">sudo timedatectl <span class="built_in">set</span>-local-rtc 0</span><br><span class="line">timedatectl</span><br><span class="line">  <span class="comment">#  Local time: Tue 2021-07-06 11:28:54 CST</span></span><br><span class="line">  <span class="comment">#            Universal time: Tue 2021-07-06 03:28:54 UTC</span></span><br><span class="line">  <span class="comment">#                  RTC time: Tue 2021-07-06 03:28:55</span></span><br><span class="line">  <span class="comment">#                 Time zone: Asia/Shanghai (CST, +0800)</span></span><br><span class="line">  <span class="comment"># System clock synchronized: yes</span></span><br><span class="line">  <span class="comment">#               NTP service: active</span></span><br><span class="line">  <span class="comment">#           RTC in local TZ: no</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.ç¦ç”¨é˜²ç«å¢™ä¸swapåˆ†åŒº(æ–°æ‰‹ä¸€å®šè¦æœ‰è¿™ä¸€æ­¥æ“ä½œ)</span></span><br><span class="line">ufw <span class="built_in">disable</span> &amp;&amp; systemctl <span class="built_in">disable</span> ufw &amp;&amp; systemctl stop ufw</span><br><span class="line">swapoff -a &amp;&amp; sed -i <span class="string">'s|^/swap.img|#/swap.ing|g'</span> /etc/fstab</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.å†…æ ¸ç›¸å…³å‚æ•°è°ƒæ•´</span></span><br><span class="line">egrep -q <span class="string">"^(#)?vm.swappiness.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?vm.swappiness.*|vm.swappiness = 0|g"</span>  /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"vm.swappiness = 0"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">egrep -q <span class="string">"^(#)?net.ipv4.ip_forward.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.ipv4.ip_forward.*|net.ipv4.ip_forward = 1|g"</span>  /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.ipv4.ip_forward = 1"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="comment"># - å…è®¸ iptables æ£€æŸ¥æ¡¥æ¥æµé‡</span></span><br><span class="line">egrep -q <span class="string">"^(#)?net.bridge.bridge-nf-call-iptables.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.bridge.bridge-nf-call-iptables.*|net.bridge.bridge-nf-call-iptables = 1|g"</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.bridge.bridge-nf-call-iptables = 1"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">egrep -q <span class="string">"^(#)?net.bridge.bridge-nf-call-ip6tables.*"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class="string">"s|^(#)?net.bridge.bridge-nf-call-ip6tables.*|net.bridge.bridge-nf-call-ip6tables = 1|g"</span> /etc/sysctl.conf || <span class="built_in">echo</span> <span class="string">"net.bridge.bridge-nf-call-ip6tables = 1"</span> &gt;&gt; /etc/sysctl.conf </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.ipvsè´Ÿè½½å‡è¡¡ç®¡ç†å·¥å…·å®‰è£…</span></span><br><span class="line">apt install ipset ipvsadm -y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.æ¨¡å—åŠ è½½åˆ°å†…æ ¸å¹¶æŸ¥çœ‹æ˜¯å¦å·²ç»æ­£ç¡®åŠ è½½æ‰€éœ€çš„å†…æ ¸æ¨¡å—</span></span><br><span class="line"><span class="comment"># é‡å¯åæ°¸ä¹…ç”Ÿæ•ˆ</span></span><br><span class="line">tee /etc/modules-load.d/k8s.conf &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line"><span class="comment"># netfilter</span></span><br><span class="line">br_netfilter</span><br><span class="line"><span class="comment"># containerd.</span></span><br><span class="line">overlay</span><br><span class="line"><span class="comment"># ipvs</span></span><br><span class="line">ip_vs</span><br><span class="line">ip_vs_rr</span><br><span class="line">ip_vs_wrr</span><br><span class="line">ip_vs_sh</span><br><span class="line">nf_conntrack</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸´æ—¶ç”Ÿæ•ˆ</span></span><br><span class="line">mkdir -vp /etc/modules.d/</span><br><span class="line">cat &gt; /etc/modules.d/k8s.modules &lt;&lt;EOF</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># å…è®¸ iptables æ£€æŸ¥æ¡¥æ¥æµé‡</span></span><br><span class="line">modprobe -- br_netfilter</span><br><span class="line"><span class="comment"># containerd.</span></span><br><span class="line">modprobe -- overlay</span><br><span class="line"><span class="comment"># ipvs</span></span><br><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line">modprobe -- nf_conntrack</span><br><span class="line">EOF</span><br><span class="line">chmod 755 /etc/modules.d/k8s.modules &amp;&amp; bash /etc/modules.d/k8s.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack</span><br><span class="line">sysctl --system</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="0x02-å®‰è£…æµç¨‹"><a href="#0x02-å®‰è£…æµç¨‹" class="headerlink" title="0x02 å®‰è£…æµç¨‹"></a>0x02 å®‰è£…æµç¨‹</h2><ul>
<li>Step 1.MasterèŠ‚ç‚¹ä¸NodeèŠ‚ç‚¹éƒ½è¿›è¡Œ Containerd.io å®‰è£…ä¸é…ç½®ã€‚<br>å‚è€ƒåœ°å€: <a href="https://docs.docker.com/engine/install/ubuntu/" target="_blank" rel="noopener">https://docs.docker.com/engine/install/ubuntu/</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - å¸è½½åŸæœ‰Docker ä»¥åŠ containerd</span></span><br><span class="line">sudo apt-get remove docker docker-engine docker.io containerd runc</span><br><span class="line"><span class="comment"># - æ›´æ–°aptç¨‹åºåŒ…ç´¢å¼•å¹¶å®‰è£…ç¨‹åºåŒ…ï¼Œä»¥å…è®¸apté€šè¿‡HTTPSä½¿ç”¨å­˜å‚¨åº“</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install \</span><br><span class="line">  apt-transport-https \</span><br><span class="line">  ca-certificates \</span><br><span class="line">  curl \</span><br><span class="line">  gnupg \</span><br><span class="line">  lsb-release</span><br><span class="line"></span><br><span class="line"><span class="comment"># - æ·»åŠ Dockerçš„å®˜æ–¹GPGå¯†é’¥ï¼š</span></span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</span><br><span class="line"></span><br><span class="line"><span class="comment"># - ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è®¾ç½®ç¨³å®šå­˜å‚¨åº“ã€‚è¦æ·»åŠ nightlyæˆ–testå­˜å‚¨åº“ï¼Œè¯·åœ¨ä¸‹é¢çš„å‘½ä»¤ä¸­çš„å•è¯stableåé¢æ·»åŠ å•è¯nightlyæˆ–testï¼ˆæˆ–ä¸¤è€…ï¼‰ã€‚</span></span><br><span class="line"><span class="built_in">echo</span> \</span><br><span class="line">  <span class="string">"deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">  <span class="variable">$(lsb_release -cs)</span> stable"</span> | sudo tee /etc/apt/sources.list.d/container.list &gt; /dev/null</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line"><span class="comment"># - æ›´æ–°aptåŒ…ç´¢å¼•ï¼Œå®‰è£…æœ€æ–°ç‰ˆæœ¬çš„containerdæˆ–è¿›å…¥ä¸‹ä¸€æ­¥å®‰è£…ç‰¹å®šç‰ˆæœ¬ï¼š</span></span><br><span class="line">sudo apt-get update</span><br><span class="line"><span class="comment"># - å®‰è£…å‰å¯æŸ¥çœ‹containerd.ioå¯ç”¨çš„ç‰ˆæœ¬: 2021å¹´7æœˆ6æ—¥ 21:03:47 å½“å‰æœ€æ–°ç‰ˆæœ¬ 1.4.6-1</span></span><br><span class="line">apt-cache madison containerd.io &amp;&amp; apt install -y containerd.io=1.4.6-1</span><br><span class="line"></span><br><span class="line"><span class="comment"># - åˆ›å»ºå¹¶ä¿®æ”¹ containerd é…ç½®</span></span><br><span class="line">mkdir -vp /etc/containerd/</span><br><span class="line">containerd config default &gt; /etc/containerd/config.toml</span><br><span class="line">sed -i <span class="string">"s#k8s.gcr.io#registry.cn-hangzhou.aliyuncs.com/google_containers#g"</span>  /etc/containerd/config.toml</span><br><span class="line">sed -i <span class="string">'/containerd.runtimes.runc.options/a\ \ \ \ \ \ \ \ \ \ \ \ SystemdCgroup = true'</span> /etc/containerd/config.toml</span><br><span class="line">sed -i <span class="string">"s#https://registry-1.docker.io#https://xlx9erfu.mirror.aliyuncs.com#g"</span>  /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># - å¯åŠ¨ Containerd </span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> containerd</span><br><span class="line">systemctl restart containerd</span><br><span class="line"></span><br><span class="line"><span class="comment"># - éªŒè¯å®‰è£…çš„ Containerd çŠ¶æ€åŠå…¶ç‰ˆæœ¬</span></span><br><span class="line">systemctl status containerd.service &amp;&amp; ctr --version</span><br><span class="line">  <span class="comment"># ctr containerd.io 1.4.6</span></span><br></pre></td></tr></table></figure>
<p>æ¸©é¦¨æç¤º: å½“å‰æœ€æ–°ç‰ˆæœ¬ 1.5.11 ã€2022å¹´4æœˆ18æ—¥ 14:10:15ã€‘å…¶é…ç½®æ–‡ä»¶å‘ç”Ÿæ”¹å˜, éœ€è¦å¦‚ä¸‹åˆå§‹åŒ–ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">containerd config default &gt; /etc/containerd/config.toml</span><br><span class="line">sed -i <span class="string">"s#k8s.gcr.io/pause#registry.cn-hangzhou.aliyuncs.com/google_containers/pause#g"</span>  /etc/containerd/config.toml</span><br><span class="line">sed -i <span class="string">'s#SystemdCgroup = false#SystemdCgroup = true#g'</span> /etc/containerd/config.toml</span><br><span class="line">sed -i <span class="string">'/registry.mirrors]/a\ \ \ \ \ \ \ \ [plugins."io.containerd.grpc.v1.cri".registry.mirrors."docker.io"]'</span> /etc/containerd/config.toml</span><br><span class="line">sed -i <span class="string">'/registry.mirrors."docker.io"]/a\ \ \ \ \ \ \ \ \ \ endpoint = ["https://xlx9erfu.mirror.aliyuncs.com"]'</span> /etc/containerd/config.toml</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<ul>
<li>Step 2.åœ¨ç¡®ä¿ Containerdå®‰è£…å®Œæˆåï¼Œç°åœ¨æˆ‘ä»¬å°±å¯ä»¥æ¥å®‰è£…kubernetesç›¸å…³å·¥å…·ï¼ŒåŒæ ·æ˜¯åœ¨ä¸¤å°ä¸»æœºä¸­æ‰§è¡Œã€‚<br>å‚è€ƒåœ°å€: </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - ä¸ºäº†æå‡ä¸‹è½½é€Ÿåº¦æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ä½¿ç”¨é˜¿é‡Œäº‘çš„æºè¿›è¡Œå®‰è£…ã€‚</span></span><br><span class="line">curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - </span><br><span class="line">tee /etc/apt/sources.list.d/kubernetes.list &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main</span><br><span class="line">EOF</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line"><span class="comment"># $ sudo add-apt-repository "deb http://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–° apt åŒ…ç´¢å¼•ï¼Œå¹¶æŸ¥çœ‹å¯ç”¨çš„kubernetesç‰ˆæœ¬ä¸ºäº†ç¯å¢ƒçš„ç¨³å®šæ€§</span></span><br><span class="line">apt-get update</span><br><span class="line">apt-cache madison kubeadm | head -n 8</span><br><span class="line">  <span class="comment"># kubeadm |  1.21.2-00 | https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 Packages</span></span><br><span class="line">  <span class="comment"># kubeadm |  1.21.1-00 | https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 Packages</span></span><br><span class="line">  <span class="comment"># kubeadm |  1.21.0-00 | https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 Packages</span></span><br><span class="line">  <span class="comment"># kubeadm |  1.20.8-00 | https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 Packages</span></span><br><span class="line">  <span class="comment"># kubeadm |  1.20.7-00 | https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 Packages</span></span><br><span class="line">  <span class="comment"># kubeadm |  1.20.6-00 | https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 Packages</span></span><br><span class="line">  <span class="comment"># kubeadm |  1.20.5-00 | https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 Packages</span></span><br><span class="line">  <span class="comment"># kubeadm |  1.20.4-00 | https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial/main amd64 Packages</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - å®‰è£… kubeletã€kubeadm å’Œ kubectlï¼Œå¹¶é”å®šå…¶ç‰ˆæœ¬(æ­¤å¤„é€‰æ‹©1.20.8-00ç‰ˆæœ¬)</span></span><br><span class="line">sudo apt-get install -y kubelet=1.20.8-00 kubeadm=1.20.8-00 kubectl=1.20.8-00</span><br><span class="line">sudo apt-mark hold kubelet kubeadm kubectl</span><br></pre></td></tr></table></figure>
<p><br/></p>
<ul>
<li>Step 3.è®¾ç½®å®¹å™¨è¿è¡Œæ—¶ä¸ºcontainerdï¼Œåˆ°è¿™é‡Œä¸ºæ­¢ä¸Šé¢æ‰€æœ‰çš„æ“ä½œéƒ½éœ€è¦åœ¨æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œé…ç½®ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># containerd - è¿è¡Œæ—¶è®¾ç½®</span></span><br><span class="line">crictl config runtime-endpoint /run/containerd/containerd.sock</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡è½½systemdå®ˆæŠ¤è¿›ç¨‹å¹¶å°† kubelet è®¾ç½®æˆå¼€æœºå¯åŠ¨</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet &amp;&amp; systemctl start kubelet</span><br></pre></td></tr></table></figure>
<p>Tips : kubelet ç°åœ¨æ¯éš”å‡ ç§’å°±ä¼šé‡å¯ï¼Œå› ä¸ºå®ƒé™·å…¥äº†ä¸€ä¸ªç­‰å¾… kubeadm æŒ‡ä»¤çš„æ­»å¾ªç¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl status kubelet.service</span><br><span class="line">  <span class="comment"># Active: activating (auto-restart) (Result: exit-code) since Tue 2021-07-06 21:38:26 CST; 9s ago</span></span><br></pre></td></tr></table></figure>
<p><br/></p>
<ul>
<li>Step 4.åˆå§‹åŒ–é›†ç¾¤é¦–å…ˆæˆ‘ä»¬åˆå§‹åŒ–MasterèŠ‚ç‚¹ ( <code>åªåœ¨ k8s-master-1 æœºå™¨æ‰§è¡Œ</code> )é›†ç¾¤å®‰è£…å‚è€ƒåœ°å€: <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/" target="_blank" rel="noopener">https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/</a></li>
</ul>
<p>æ¥ä¸‹æ¥åœ¨ master èŠ‚ç‚¹é…ç½® kubeadm åˆå§‹åŒ–æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯¼å‡ºé»˜è®¤çš„åˆå§‹åŒ–é…ç½®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@k8s-master-1:~/k8s<span class="comment"># kubeadm config print init-defaults &gt; kubeadm.yaml</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åæ ¹æ®æˆ‘ä»¬è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹é…ç½®ï¼Œæ¯”å¦‚ä¿®æ”¹ imageRepository çš„å€¼ï¼Œkube-proxy çš„æ¨¡å¼ä¸º ipvs ä»¥åŠ criSocket è®¾ç½®ä¸º <code>/run/containerd/containerd.sock</code>ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„containerdä½œä¸ºè¿è¡Œæ—¶ï¼Œæ‰€ä»¥åœ¨åˆå§‹åŒ–èŠ‚ç‚¹çš„æ—¶å€™éœ€è¦æŒ‡å®šcgroupDriverä¸ºsystemd</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; kubeadm.yaml &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">apiVersion: kubeadm.k8s.io/v1beta2</span><br><span class="line">bootstrapTokens:</span><br><span class="line">- groups:</span><br><span class="line">  - system:bootstrappers:kubeadm:default-node-token</span><br><span class="line">  token: abcdef.0123456789abcdef</span><br><span class="line">  ttl: 24h0m0s</span><br><span class="line">  usages:</span><br><span class="line">  - signing</span><br><span class="line">  - authentication</span><br><span class="line">kind: InitConfiguration</span><br><span class="line">localAPIEndpoint:</span><br><span class="line">  advertiseAddress: 10.10.107.220</span><br><span class="line">  bindPort: 6443</span><br><span class="line">nodeRegistration:</span><br><span class="line">  criSocket: /run/containerd/containerd.sock</span><br><span class="line">  name: k8s-master-1</span><br><span class="line">  taints:</span><br><span class="line">  - effect: NoSchedule</span><br><span class="line">    key: node-role.kubernetes.io/master</span><br><span class="line">---</span><br><span class="line">apiServer:</span><br><span class="line">  timeoutForControlPlane: 4m0s</span><br><span class="line">apiVersion: kubeadm.k8s.io/v1beta2</span><br><span class="line">certificatesDir: /etc/kubernetes/pki</span><br><span class="line">clusterName: kubernetes</span><br><span class="line">controllerManager: &#123;&#125;</span><br><span class="line">dns:</span><br><span class="line">  <span class="built_in">type</span>: CoreDNS</span><br><span class="line">etcd:</span><br><span class="line">  <span class="built_in">local</span>:</span><br><span class="line">    dataDir: /var/lib/etcd</span><br><span class="line">imageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers</span><br><span class="line">kind: ClusterConfiguration</span><br><span class="line">kubernetesVersion: v1.20.8</span><br><span class="line">controlPlaneEndpoint: <span class="string">"newcluster.k8s:6443"</span></span><br><span class="line">networking:</span><br><span class="line">  dnsDomain: cluster.local</span><br><span class="line">  podSubnet: 172.16.0.0/16</span><br><span class="line">  serviceSubnet: 10.96.0.0/12</span><br><span class="line">scheduler: &#123;&#125;</span><br><span class="line">---</span><br><span class="line">apiVersion: kubeproxy.config.k8s.io/v1alpha1</span><br><span class="line">kind: KubeProxyConfiguration</span><br><span class="line">mode: ipvs</span><br><span class="line">---</span><br><span class="line">apiVersion: kubelet.config.k8s.io/v1beta1</span><br><span class="line">kind: KubeletConfiguration</span><br><span class="line">cgroupDriver: systemd</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæƒ³è®¾ç½®APISERVERåç§°éœ€è¦å†/etc/hostsæ·»åŠ ä¸å…¶å¯¹åº”IPåœ°å€</span></span><br><span class="line">tee -a /etc/hosts &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">10.10.107.220 newcluster.k8s</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p>ç„¶åä½¿ç”¨ä¸Šé¢çš„é…ç½®æ–‡ä»¶è¿›è¡Œåˆå§‹åŒ–MasterèŠ‚ç‚¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --config=kubeadm.yaml</span><br><span class="line">  <span class="comment"># [preflight] You can also perform this action in beforehand using 'kubeadm config images pull'</span></span><br><span class="line">  <span class="comment"># [certs] Using certificateDir folder "/etc/kubernetes/pki"</span></span><br><span class="line">  <span class="comment"># [certs] Generating "ca" certificate and key</span></span><br><span class="line">  <span class="comment"># [certs] Generating "apiserver" certificate and key</span></span><br><span class="line">  <span class="comment"># [certs] apiserver serving cert is signed for DNS names [k8s-master-1 kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local newcluster.k8s] and IPs [10.96.0.1 10.10.107.220]</span></span><br><span class="line">  ......</span><br><span class="line">  <span class="comment"># [addons] Applied essential addon: CoreDNS</span></span><br><span class="line">  <span class="comment"># [addons] Applied essential addon: kube-proxy</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Your Kubernetes control-plane has initialized successfully!</span></span><br><span class="line">  <span class="comment"># To start using your cluster, you need to run the following as a regular user:</span></span><br><span class="line">  <span class="comment"># - æ‹·è´ kubeconfig æ–‡ä»¶åˆ°å½“å‰ç”¨æˆ·çš„æ ¹ç›®å½•,å®Œæ¯•åå³å¯é‡‡ç”¨kubectlè¿›è¡ŒæŸ¥çœ‹ç®¡ç†k8sé›†ç¾¤ã€‚</span></span><br><span class="line">    mkdir -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">    sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">    sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Alternatively, if you are the root user, you can run:</span></span><br><span class="line">    <span class="built_in">export</span> KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class="line"></span><br><span class="line">  <span class="comment"># You should now deploy a pod network to the cluster.</span></span><br><span class="line">  <span class="comment"># Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:</span></span><br><span class="line">    https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">  <span class="comment"># You can now join any number of control-plane nodes by copying certificate authorities</span></span><br><span class="line">  <span class="comment"># and service account keys on each node and then running the following as root:</span></span><br><span class="line">  <span class="comment"># ä»MasterèŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class="line">  kubeadm join newcluster.k8s:6443 --token abcdef.0123456789abcdef \</span><br><span class="line">  --discovery-token-ca-cert-hash sha256:d57743fa8657a959e6f96ea1b2d16ce32c315a2a6dc080a65a2b0fc8849bfbd4 \</span><br><span class="line">  --control-plane</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Then you can join any number of worker nodes by running the following on each as root:</span></span><br><span class="line">  <span class="comment"># å·¥ä½œèŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class="line">  kubeadm join newcluster.k8s:6443 --token abcdef.0123456789abcdef \</span><br><span class="line">  --discovery-token-ca-cert-hash sha256:d57743fa8657a959e6f96ea1b2d16ce32c315a2a6dc080a65a2b0fc8849bfbd4</span><br></pre></td></tr></table></figure>
<p>Tips : ç”±äº kubeadm æŠŠ kubelet è§†ä¸ºä¸€ä¸ªç³»ç»ŸæœåŠ¡æ¥ç®¡ç†ï¼Œæ‰€ä»¥å¯¹åŸºäº kubeadm çš„å®‰è£…ï¼Œ æˆ‘ä»¬æ¨èä½¿ç”¨ systemd é©±åŠ¨ï¼Œä¸æ¨è cgroupfs é©±åŠ¨ã€‚å‚è€ƒåœ°å€: <a href="https://kubernetes.io/zh/docs/tasks/administer-cluster/kubeadm/configure-cgroup-driver/" target="_blank" rel="noopener">https://kubernetes.io/zh/docs/tasks/administer-cluster/kubeadm/configure-cgroup-driver/</a></p>
<p><br></p>
<ul>
<li>Step 5.æ·»åŠ èŠ‚ç‚¹éœ€è¦å®Œæˆåˆå§‹åŒ–é›†ç¾¤ä¸Šé¢çš„é…ç½®å’Œæ“ä½œè¦æå‰åšå¥½ï¼Œå°† master èŠ‚ç‚¹ä¸Šé¢çš„ $HOME/.kube/config æ–‡ä»¶æ‹·è´åˆ° node èŠ‚ç‚¹å¯¹åº”çš„æ–‡ä»¶ä¸­ï¼Œå®‰è£… kubeadmã€kubeletã€kubectlï¼Œç„¶ååœ¨nodeèŠ‚ç‚¹ä¸Š(<code>k8s-node-1</code>)æ‰§è¡Œä¸Šé¢åˆå§‹åŒ–å®Œæˆåæç¤ºçš„ join å‘½ä»¤å³å¯ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join newcluster.k8s:6443 --token abcdef.0123456789abcdef \</span><br><span class="line">  --discovery-token-ca-cert-hash sha256:d57743fa8657a959e6f96ea1b2d16ce32c315a2a6dc080a65a2b0fc8849bfbd4</span><br></pre></td></tr></table></figure>
<p><br></p>
<ul>
<li>Step 6.é€šè¿‡åœ¨Masterä¸­æ‰§è¡Œ<code>kubectl get node</code>å‘½ä»¤å¯ä»¥çœ‹åˆ°æ˜¯ NotReady çŠ¶æ€ï¼Œè¿™æ˜¯å› ä¸ºè¿˜æ²¡æœ‰å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œç°åœ¨åº”è¯¥åœ¨é›†ç¾¤ä¸­éƒ¨ç½²ä¸€ä¸ªpodç½‘ç»œï¼Œå¯ä»¥ä»<a href="https://kubernetes.io/docs/concepts/cluster-administration/addons" target="_blank" rel="noopener">kuberneteså®˜æ–¹æä¾›çš„å„ç±»ç»„ä»¶</a>ä¸­é€‰æ‹©æˆ‘ä»¬è‡ªå·±çš„ç½‘ç»œæ’ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬å®‰è£… calio (æ˜¯ä¸€ä¸ªå®‰å…¨çš„ä¸‰å±‚ç½‘ç»œå’Œç½‘ç»œç­–ç•¥é©±åŠ¨), å…¶Calicoç‰ˆæœ¬é€‰æ‹© <a href="https://docs.projectcalico.org/releases" target="_blank" rel="noopener">https://docs.projectcalico.org/releases</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - å®‰è£… Pod ç½‘ç»œå‰èŠ‚ç‚¹çš„çŠ¶æ€ä¸ºNotReady</span></span><br><span class="line">~/k8s<span class="comment"># kubectl get node</span></span><br><span class="line">NAME           STATUS     ROLES                  AGE     VERSION</span><br><span class="line">k8s-master-1   NotReady   control-plane,master   11m     v1.20.8</span><br><span class="line">k8s-node-1     NotReady   &lt;none&gt;                 4m19s   v1.20.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># - ä»calicoå®˜æ–¹ä¸‹è½½calicoæ’ä»¶çš„éƒ¨ç½²æ¸…å•ã€‚</span></span><br><span class="line">~/k8s<span class="comment"># wget https://docs.projectcalico.org/v3.18/manifests/calico.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - è‡ªå®šä¹‰æ›´æ”¹calicoæ’ä»¶çš„åœ°å€æ± ã€‚</span></span><br><span class="line"><span class="comment"># The default IPv4 pool to create on startup if none exists. Pod IPs will be chosen from this range. Changing this value after installation will have no effect. This should fall within `--cluster-cidr`.</span></span><br><span class="line">vim calico.yaml</span><br><span class="line">- name: CALICO_IPV4POOL_CIDR</span><br><span class="line">  value: <span class="string">"192.168.0.0/16"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - éƒ¨ç½² calico ç½‘ç»œæ’ä»¶</span></span><br><span class="line">kubectl apply -f calico.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># - éƒ¨ç½²åæŸ¥çœ‹kube-systemä¸­å’Œç½‘ç»œç›¸å…³çš„podçš„è¿è¡ŒçŠ¶æ€ï¼Œä¸€èˆ¬çš„çŠ¶æ€å›ä»Pending -&gt; Init -&gt; ContainerCreate -&gt; Runningè¿‡ç¨‹è½¬å˜ã€‚</span></span><br><span class="line">~/k8s<span class="comment"># kubectl get pod -n kube-system</span></span><br><span class="line">NAME                                       READY   STATUS     RESTARTS   AGE</span><br><span class="line">calico-kube-controllers-77dd468cdb-2lchv   0/1     Pending    0          18s</span><br><span class="line">calico-node-pz9qx                          0/1     Init:0/3   0          18s</span><br><span class="line">calico-node-zvst7                          0/1     Init:0/3   0          18s</span><br><span class="line">coredns-54d67798b7-78n5j                   0/1     Pending    0          15m</span><br><span class="line">coredns-54d67798b7-z9c8f                   0/1     Pending    0          15m</span><br><span class="line"></span><br><span class="line"><span class="comment"># - ç­‰å¾…å‡ åˆ†é’Ÿåcalicoæ’ä»¶ç›¸å…³Podå·²æˆåŠŸè¿è¡Œ</span></span><br><span class="line">~/k8s<span class="comment"># kubectl get pod -n kube-system</span></span><br><span class="line">NAME                                       READY   STATUS    RESTARTS   AGE</span><br><span class="line">calico-kube-controllers-77dd468cdb-2lchv   1/1     Running   0          2m18s</span><br><span class="line">calico-node-pz9qx                          1/1     Running   0          2m18s</span><br><span class="line">calico-node-zvst7                          1/1     Running   0          2m18s</span><br><span class="line">coredns-54d67798b7-78n5j                   1/1     Running   0          17m</span><br><span class="line">coredns-54d67798b7-z9c8f                   1/1     Running   0          17m</span><br><span class="line"></span><br><span class="line"><span class="comment"># - åŒæ—¶å¯ä»¥çœ‹åˆ°å…¶NodeèŠ‚ç‚¹çš„çŠ¶æ€å·²å˜ä¸ºReadyï¼Œè‡³æ­¤calicoç½‘ç»œæ’ä»¶å®‰è£…éƒ¨ç½²å·²å®Œæ¯•ã€‚</span></span><br><span class="line">~/k8s<span class="comment"># kubectl get node</span></span><br><span class="line">NAME           STATUS   ROLES                  AGE   VERSION</span><br><span class="line">k8s-master-1   Ready    control-plane,master   17m   v1.20.8</span><br><span class="line">k8s-node-1     Ready    &lt;none&gt;                 10m   v1.20.8</span><br></pre></td></tr></table></figure>
<p><br/></p>
<ul>
<li>Step 7.æœ€åæ·»åŠ å‘½ä»¤è‡ªåŠ¨è¡¥é½ä¸å…¨åŠŸèƒ½</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt install -y bash-completion</span><br><span class="line"><span class="built_in">source</span> /usr/share/bash-completion/bash_completion</span><br><span class="line"><span class="built_in">source</span> &lt;(kubectl completion bash)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"source &lt;(kubectl completion bash)"</span> &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="0x03-åŸºç¡€å®è·µ"><a href="#0x03-åŸºç¡€å®è·µ" class="headerlink" title="0x03 åŸºç¡€å®è·µ"></a>0x03 åŸºç¡€å®è·µ</h2><p><strong>å®è·µç›®æ ‡:</strong> åœ¨Kubernetesé›†ç¾¤ä¸­è¿è¡ŒNginxå®¹å™¨å¹¶è®¾ç½®<code>nginx-status</code>æŸ¥çœ‹ï¼Œå¹¶å°½å¯èƒ½ä½¿ç”¨k8sç›¸å…³ç»„ä»¶ä»¥åŠæ§åˆ¶å™¨çš„ç®€å•ä½¿ç”¨ã€‚</p>
<p><strong>å®è·µæµç¨‹:</strong></p>
<ul>
<li>Step 1.åˆ›å»ºä¸€ä¸ª<code>weiyigeek</code>çš„åç§°ç©ºé—´è¿›è¡Œéƒ¨ç½² Nginx Web å®¹å™¨ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create namespace weiyigeek</span><br><span class="line">  <span class="comment"># namespace/weiyigeek created</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<ul>
<li>Step 2.å‡†å¤‡Nginx.confé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ConfigMapæ¥å­˜å‚¨Nginx.confé…ç½®æ–‡ä»¶ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Yaml æ–¹å¼åˆ›å»º ConfigMap</span></span><br><span class="line">tee nginx-conf.yaml &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-conf</span><br><span class="line">  namespace: weiyigeek</span><br><span class="line">data:</span><br><span class="line">  nginx.conf: |</span><br><span class="line">    user  nginx;</span><br><span class="line">    worker_processes  auto;</span><br><span class="line">    worker_cpu_affinity 00000001 00000010 00000100 00001000;</span><br><span class="line">    error_log  /var/<span class="built_in">log</span>/nginx/error.log warn;</span><br><span class="line">    pid        /var/run/nginx.pid;</span><br><span class="line">    worker_rlimit_nofile 65536;</span><br><span class="line"></span><br><span class="line">    events &#123;</span><br><span class="line">      worker_connections  65535;</span><br><span class="line">      accept_mutex on;</span><br><span class="line">      multi_accept on;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    http &#123;</span><br><span class="line">      include       mime.types;</span><br><span class="line">      default_type  application/octet-stream;</span><br><span class="line">      log_format access_json <span class="string">'&#123;"@timestamp":"$time_iso8601",'</span></span><br><span class="line">      <span class="string">'"host":"$server_addr",'</span></span><br><span class="line">      <span class="string">'"clientip":"$remote_addr",'</span></span><br><span class="line">      <span class="string">'"size":$body_bytes_sent,'</span></span><br><span class="line">      <span class="string">'"responsetime":$request_time,'</span></span><br><span class="line">      <span class="string">'"upstreamtime":"$upstream_response_time",'</span></span><br><span class="line">      <span class="string">'"upstreamhost":"$upstream_addr",'</span></span><br><span class="line">      <span class="string">'"http_host":"$host",'</span></span><br><span class="line">      <span class="string">'"url":"$uri",'</span></span><br><span class="line">      <span class="string">'"domain":"$host",'</span></span><br><span class="line">      <span class="string">'"xff":"$http_x_forwarded_for",'</span></span><br><span class="line">      <span class="string">'"referer":"$http_referer",'</span></span><br><span class="line">      <span class="string">'"status":"$status"&#125;'</span>;</span><br><span class="line">      access_log  /var/<span class="built_in">log</span>/nginx/access.log  access_json;</span><br><span class="line">      client_max_body_size 50M;</span><br><span class="line">      keepalive_timeout  300;</span><br><span class="line">      fastcgi_buffers 8 128k;</span><br><span class="line">      fastcgi_buffer_size  128k;</span><br><span class="line">      fastcgi_busy_buffers_size 256k;</span><br><span class="line">      fastcgi_temp_file_write_size 256k;</span><br><span class="line">      proxy_connect_timeout 90;</span><br><span class="line">      proxy_read_timeout 300;</span><br><span class="line">      proxy_send_timeout 300;</span><br><span class="line">      sendfile        on;</span><br><span class="line"></span><br><span class="line">      server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        add_header Cache-Control no-cache;</span><br><span class="line">        location / &#123;</span><br><span class="line">          root   /usr/share/nginx/html;</span><br><span class="line">          index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        location /status </span><br><span class="line">        &#123;</span><br><span class="line">          stub_status on;</span><br><span class="line">          access_log off;            </span><br><span class="line">        &#125;       </span><br><span class="line">        error_page 500 502 503 504 /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">          root   html;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment"># include /etc/nginx/conf.d/*.conf;</span></span><br><span class="line">    &#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼1.é‡‡ç”¨ Yaml æ–¹å¼åˆ›å»º ConfigMap å­˜å‚¨é…ç½®ä¿¡æ¯</span></span><br><span class="line">$ kubectl apply -f nginx-conf.yaml</span><br><span class="line">  <span class="comment"># configmap/nginx-conf created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2.é‡‡ç”¨ nginx.conf é…ç½®åˆ›å»º ConfigMap å­˜å‚¨é…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># kubectl create configmap nginx-conf --from-file=nginx.conf</span></span><br><span class="line"><span class="comment"># kubectl describe configmap nginx-conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹åˆ›å»ºçš„ configmap</span></span><br><span class="line">$ kubectl -n weiyigeek  get configmap nginx-conf</span><br><span class="line">  <span class="comment"># NAME               DATA   AGE</span></span><br><span class="line">  <span class="comment"># nginx-conf         1      25m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®çš„é…ç½®ä¿¡æ¯</span></span><br><span class="line">$ kubectl describe -n weiyigeek configmap nginx-conf</span><br><span class="line">  <span class="comment"># Name:         nginx-conf</span></span><br><span class="line">  <span class="comment"># Namespace:    weiyigeek</span></span><br><span class="line">  <span class="comment"># Labels:       &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># Annotations:  &lt;none&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data</span></span><br><span class="line">  <span class="comment"># ====</span></span><br><span class="line">  <span class="comment"># nginx.conf:</span></span><br><span class="line">  <span class="comment"># ----</span></span><br><span class="line">  <span class="comment"># user  nginx;</span></span><br><span class="line">  <span class="comment"># worker_processes  auto;</span></span><br><span class="line">  <span class="comment"># ............</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># events &#123;</span></span><br><span class="line">  <span class="comment">#   ...................</span></span><br><span class="line">  <span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># http &#123;</span></span><br><span class="line">  <span class="comment">#   ....................</span></span><br><span class="line">  <span class="comment">#   server &#123;</span></span><br><span class="line">  <span class="comment">#     listen       80;</span></span><br><span class="line">  <span class="comment">#     server_name  localhost;</span></span><br><span class="line">  <span class="comment">#     add_header Cache-Control no-cache;</span></span><br><span class="line">  <span class="comment">#     location / &#123;</span></span><br><span class="line">  <span class="comment">#       root   /usr/share/nginx/html;</span></span><br><span class="line">  <span class="comment">#       index  index.html index.htm;</span></span><br><span class="line">  <span class="comment">#     &#125;</span></span><br><span class="line">  <span class="comment">#     location /status</span></span><br><span class="line">  <span class="comment">#     &#123;</span></span><br><span class="line">  <span class="comment">#       stub_status on;</span></span><br><span class="line">  <span class="comment">#       access_log off;</span></span><br><span class="line">  <span class="comment">#     &#125;</span></span><br><span class="line">  <span class="comment">#     error_page 500 502 503 504 /50x.html;</span></span><br><span class="line">  <span class="comment">#     location = /50x.html &#123;</span></span><br><span class="line">  <span class="comment">#       root   html;</span></span><br><span class="line">  <span class="comment">#     &#125;</span></span><br><span class="line">  <span class="comment">#   &#125;</span></span><br><span class="line">  <span class="comment"># &#125;</span></span><br><span class="line">  <span class="comment"># Events:  &lt;none&gt;</span></span><br></pre></td></tr></table></figure>
<p><br/></p>
<ul>
<li>Step 3.åˆ©ç”¨ Deployment æ§åˆ¶å™¨ç¼–å†™éƒ¨ç½² Nginx èµ„æºæ¸…å•ã€‚<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">tee</span> <span class="string">nginx-deployment.yaml</span> <span class="string">&lt;&lt;'EOF'</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">web-deploy</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">weiyigeek</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">nginx-test</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">nginx-test</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      initContainers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">init-html</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">busybox</span></span><br><span class="line"><span class="attr">        imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">        command:</span> <span class="string">['sh',</span> <span class="string">'-c'</span><span class="string">,</span> <span class="string">"env;echo ConfigMap:$&#123;MSG&#125;--HostName-$&#123;HOSTNAME&#125; &gt; /usr/share/nginx/html/index.html"</span><span class="string">]</span></span><br><span class="line"><span class="attr">        volumeMounts:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">"/usr/share/nginx/html"</span></span><br><span class="line"><span class="attr">        securityContext:</span></span><br><span class="line"><span class="attr">          privileged:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">"nginx:latest"</span></span><br><span class="line"><span class="attr">        imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="attr">        - containerPort:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">        volumeMounts:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">nginx-conf</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">/etc/nginx/nginx.conf</span></span><br><span class="line"><span class="attr">          subPath:</span> <span class="string">nginx.conf</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">          mountPath:</span> <span class="string">"/usr/share/nginx/html"</span></span><br><span class="line"><span class="attr">      volumes:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">nginx-conf</span></span><br><span class="line"><span class="attr">        configMap:</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">nginx-conf</span></span><br><span class="line"><span class="attr">          items:</span></span><br><span class="line"><span class="attr">          - key:</span> <span class="string">nginx.conf</span></span><br><span class="line"><span class="attr">            path:</span> <span class="string">nginx.conf</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">web</span> </span><br><span class="line"><span class="attr">        emptyDir:</span> <span class="string">&#123;&#125;</span>       </span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nginx-service</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">weiyigeek</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">nginx-test</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">      port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">      nodePort:</span> <span class="number">30000</span></span><br><span class="line"><span class="attr">      protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">nginx-test</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ©ç”¨ kubectl apply éƒ¨ç½² Nginx æ§åˆ¶å™¨</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">apply</span> <span class="bullet">-f</span> <span class="string">nginx-deployment.yaml</span></span><br><span class="line">  <span class="comment"># deployment.apps/web-deploy created</span></span><br><span class="line">  <span class="comment"># service/nginx-service created</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>Step 4.æŸ¥çœ‹éªŒè¯åˆ›å»ºçš„ Nginx Pod å’Œ Services, è®¿é—®åˆ›å»ºçš„ nginx Webå®¹å™¨ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">~/k8s/containerd<span class="comment"># kubectl -n weiyigeek get pod</span></span><br><span class="line">  <span class="comment"># NAME                         READY   STATUS    RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># web-deploy-99fbb677d-jbbwk   1/1     Running   0          48s</span></span><br><span class="line">  <span class="comment"># web-deploy-99fbb677d-md5z9   1/1     Running   0          51s</span></span><br><span class="line"></span><br><span class="line">~/k8s/containerd<span class="comment"># kubectl -n weiyigeek get svc</span></span><br><span class="line">  <span class="comment"># NAME            TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE</span></span><br><span class="line">  <span class="comment"># nginx-service   NodePort   10.105.172.104   &lt;none&gt;        80:30000/TCP   59m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥çœ‹åˆ°ä»¥è½®è¯¢çš„æ–¹å¼æ¥è®¿é—®nginxå‰¯æœ¬</span></span><br><span class="line">~/k8s/containerd<span class="comment"># curl http://10.105.172.104</span></span><br><span class="line">  <span class="comment"># ConfigMap:--HostName-web-deploy-99fbb677d-md5z9</span></span><br><span class="line">~/k8s/containerd<span class="comment"># curl http://10.105.172.104</span></span><br><span class="line">  <span class="comment"># ConfigMap:--HostName-web-deploy-99fbb677d-jbbwk</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹nginxçš„çŠ¶æ€ä¿¡æ¯</span></span><br><span class="line">~/k8s/containerd<span class="comment"># curl http://10.105.172.104/status</span></span><br><span class="line">  <span class="comment"># Active connections: 1</span></span><br><span class="line">  <span class="comment"># server accepts handled requests</span></span><br><span class="line">  <span class="comment"># 3 3 3</span></span><br><span class="line">  <span class="comment"># Reading: 0 Writing: 1 Waiting: 0</span></span><br></pre></td></tr></table></figure>
<p><br/></p>
<ul>
<li>Step 5.æˆ‘ä»¬ä¹Ÿå¯ä»¥é‡‡ç”¨ port-forward å­å‘½ä»¤è¿›è¡Œè½¬å‘ web-deploy-99fbb677d-jbbwk Pod åˆ°æœ¬æœºçš„ 80 ç«¯å£</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n weiyigeek port-forward --address 0.0.0.0 web-deploy-99fbb677d-jbbwk 80:80</span><br><span class="line">  <span class="comment"># Forwarding from 0.0.0.0:80 -&gt; 80</span></span><br><span class="line">  <span class="comment"># Handling connection for 80</span></span><br><span class="line">  <span class="comment"># Handling connection for 80</span></span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=2.åŸºäºContainerdè¿è¡Œæ—¶æ­å»ºKuberneteså¤šæ§åˆ¶å¹³é¢é›†ç¾¤å®è·µ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210713153641.png" target="_blank" title="WeiyiGeek.port-forward" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210713153641.png" alt="WeiyiGeek.port-forward" title="" class=""></a>
                <p>WeiyiGeek.port-forward</p>
            </figure>
<p><strong>Nginx Status è¯¦è§£:</strong></p>
<ul>
<li>Active connections - æ´»è·ƒçš„è¿æ¥æ•°é‡</li>
<li>server accepts handled requests â€” æ€»å…±å¤„ç†äº†7ä¸ªè¿æ¥ , æˆåŠŸåˆ›å»º7æ¬¡æ¡æ‰‹, æ€»å…±å¤„ç†äº†36ä¸ªè¯·æ±‚ã€‚</li>
<li>Reading â€” è¯»å–å®¢æˆ·ç«¯çš„è¿æ¥æ•°ã€‚</li>
<li>Writing â€” å“åº”æ•°æ®åˆ°å®¢æˆ·ç«¯çš„æ•°é‡ã€‚</li>
<li>Waiting â€” å¼€å¯ keep-alive çš„æƒ…å†µä¸‹, è¿™ä¸ªå€¼ç­‰äº <code>active - (reading+writing)</code> æ„æ€å°±æ˜¯ Nginx å·²ç»å¤„ç†å®Œæ­£åœ¨ç­‰å€™ä¸‹ä¸€æ¬¡è¯·æ±‚æŒ‡ä»¤çš„é©»ç•™è¿æ¥ã€‚</li>
</ul>
<p><br></p>
<ul>
<li>Step 6.è‡³æ­¤ï¼Œåœ¨ä½¿ç”¨containerdè¿è¡Œæ—¶çš„kubernetesé›†ç¾¤ä¸­, é‡‡ç”¨deploymentsæ§åˆ¶å™¨åˆ›å»ºå¤šä¸ªNginxå‰¯æœ¬å¹¶è®¿é—®ã€‚</li>
</ul>
<hr>
<h2 id="0x04-å…¥å‘å‡ºå‘"><a href="#0x04-å…¥å‘å‡ºå‘" class="headerlink" title="0x04 å…¥å‘å‡ºå‘"></a>0x04 å…¥å‘å‡ºå‘</h2><h3 id="Containerd-ç›¸å…³é—®é¢˜"><a href="#Containerd-ç›¸å…³é—®é¢˜" class="headerlink" title="Containerd ç›¸å…³é—®é¢˜"></a>Containerd ç›¸å…³é—®é¢˜</h3><h4 id="é—®é¢˜1-æ‰§è¡Œctrå‘½ä»¤æ—¶æŠ¥-connection-error-æˆ–è€…-connect-permission-denied-é”™è¯¯"><a href="#é—®é¢˜1-æ‰§è¡Œctrå‘½ä»¤æ—¶æŠ¥-connection-error-æˆ–è€…-connect-permission-denied-é”™è¯¯" class="headerlink" title="é—®é¢˜1.æ‰§è¡Œctrå‘½ä»¤æ—¶æŠ¥ connection error æˆ–è€… :connect: permission denied é”™è¯¯"></a>é—®é¢˜1.æ‰§è¡Œctrå‘½ä»¤æ—¶æŠ¥ connection error æˆ–è€… :connect: permission denied é”™è¯¯</h4><ul>
<li>é”™è¯¯ä¿¡æ¯: </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctr: failed to dial <span class="string">"/run/containerd/containerd.sock"</span>: connection error: desc = <span class="string">"transport: error while dialing: dial unix /run/containerd/containerd.sock: connect: permission denied"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>é”™è¯¯åŸå› : ä¸€æ˜¯å¯èƒ½æœªå¯åŠ¨containerdç›¸å…³æœåŠ¡ï¼ŒäºŒå¯èƒ½æ˜¯è¯¥ç”¨æˆ·æ²¡æœ‰æ“ä½œcontainerçš„æƒé™(ä¸€èˆ¬ä¼šå­˜åœ¨äºä½æƒé™ç”¨æˆ·)</li>
<li>è§£å†³åŠæ³•:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - æœåŠ¡çŠ¶æ€</span></span><br><span class="line">systemctl status containerd.servic</span><br><span class="line"></span><br><span class="line"><span class="comment"># - ç”¨æˆ·åˆ‡æ¢</span></span><br><span class="line">su - root </span><br><span class="line">ctr images ls</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="é—®é¢˜2-æœªæŒ‡å®šåç§°ç©ºé—´-namespace-æˆ–è€…è¯¥æ“ä½œå¯¹è±¡ä¸åœ¨è¯¥åç§°ç©ºé—´-namespace-ä¸­æ‰§è¡Œæ“ä½œå‘½ä»¤"><a href="#é—®é¢˜2-æœªæŒ‡å®šåç§°ç©ºé—´-namespace-æˆ–è€…è¯¥æ“ä½œå¯¹è±¡ä¸åœ¨è¯¥åç§°ç©ºé—´-namespace-ä¸­æ‰§è¡Œæ“ä½œå‘½ä»¤" class="headerlink" title="é—®é¢˜2.æœªæŒ‡å®šåç§°ç©ºé—´(namespace)æˆ–è€…è¯¥æ“ä½œå¯¹è±¡ä¸åœ¨è¯¥åç§°ç©ºé—´(namespace)ä¸­æ‰§è¡Œæ“ä½œå‘½ä»¤"></a>é—®é¢˜2.æœªæŒ‡å®šåç§°ç©ºé—´(namespace)æˆ–è€…è¯¥æ“ä½œå¯¹è±¡ä¸åœ¨è¯¥åç§°ç©ºé—´(namespace)ä¸­æ‰§è¡Œæ“ä½œå‘½ä»¤</h4><ul>
<li>é”™è¯¯ä¿¡æ¯: </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ctr container rm busybox</span><br><span class="line">ERRO[0000] failed to delete container <span class="string">"busybox"</span>          error=<span class="string">"container \"busybox\" in namespace \"default\": not found"</span></span><br><span class="line">ctr: container <span class="string">"busybox"</span> <span class="keyword">in</span> namespace <span class="string">"default"</span>: not found</span><br></pre></td></tr></table></figure>
<ul>
<li>é”™è¯¯åŸå› : ç”±äº default çš„é»˜è®¤åç§°ç©ºé—´å†…æ— busyboxæ‰€ä»¥åˆ é™¤æ—¶æŠ¥é”™.</li>
<li>è§£å†³åŠæ³•: æŸ¥çœ‹æœ‰é‚£äº›åç§°ç©ºé—´<code>ctr namespace ls</code></li>
</ul>
<p><br></p>
<h4 id="é—®é¢˜3-ä½¿ç”¨ctræ‹‰å–é•œåƒæ—¶æŠ¥INFO-0001-trying-next-host-error-quot-failed-to-authorize-failed-to-fetch-anonymous-token-é”™è¯¯"><a href="#é—®é¢˜3-ä½¿ç”¨ctræ‹‰å–é•œåƒæ—¶æŠ¥INFO-0001-trying-next-host-error-quot-failed-to-authorize-failed-to-fetch-anonymous-token-é”™è¯¯" class="headerlink" title="é—®é¢˜3.ä½¿ç”¨ctræ‹‰å–é•œåƒæ—¶æŠ¥INFO[0001] trying next host error=&quot;failed to authorize: failed to fetch anonymous token:é”™è¯¯"></a>é—®é¢˜3.ä½¿ç”¨ctræ‹‰å–é•œåƒæ—¶æŠ¥<code>INFO[0001] trying next host error=&quot;failed to authorize: failed to fetch anonymous token:</code>é”™è¯¯</h4><ul>
<li>é”™è¯¯ä¿¡æ¯:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ctr -n k8s.io images pull docker.io/library/busybox:latest</span><br><span class="line">  <span class="comment"># docker.io/library/busybox:latest: resolving      |--------------------------------------|</span></span><br><span class="line">  <span class="comment"># elapsed: 1.1 s                    total:   0.0 B (0.0 B/s)</span></span><br><span class="line">  <span class="comment"># INFO[0001] trying next host error="failed to authorize: failed to fetch anonymous token: Get https://auth.docker.io/token?scope=repository%3Alibrary%2Fbusybox%3Apull&amp;service=registry.docker.io: read tcp 10.10.107.220:62946-&gt;107.23.149.57:443: read: connection reset by peer" host=registry-1.docker.io</span></span><br><span class="line">  <span class="comment"># ctr: failed to resolve reference "docker.io/library/busybox:latest": failed to authorize: failed to fetch anonymous token: Get https://auth.docker.io/token?scope=repository%3Alibrary%2Fbusybox%3Apull&amp;service=registry.docker.io: read tcp 10.10.107.220:62946-&gt;107.23.149.57:443: read: connection reset by peer</span></span><br></pre></td></tr></table></figure>
<ul>
<li>è§£å†³åŠæ³•: ä¸çŸ¥é“æ˜¯ctrçš„Bugè¿˜æ˜¯ä½•å¤„é…ç½®ä¸å¯¹é‡‡ç”¨ctr imagesæ— æ³•æ‹‰å–è€Œä½¿ç”¨ctr image åˆ™å¯ä»¥æ­£å¸¸æ‹‰å–ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ctr command</span></span><br><span class="line"><span class="comment"># images, image, i           manage images</span></span><br><span class="line"></span><br><span class="line">ctr -n k8s.io image pull docker.io/library/busybox:latest</span><br><span class="line">  <span class="comment"># docker.io/library/busybox:latest:                                                 resolved       |++++++++++++++++++++++++++++++++++++++|</span></span><br><span class="line">  <span class="comment"># index-sha256:930490f97e5b921535c153e0e7110d251134cc4b72bbb8133c6a5065cc68580d:    done           |++++++++++++++++++++++++++++++++++++++|</span></span><br><span class="line">  <span class="comment"># manifest-sha256:dca71257cd2e72840a21f0323234bb2e33fea6d949fa0f21c5102146f583486b: done           |++++++++++++++++++++++++++++++++++++++|</span></span><br><span class="line">  <span class="comment"># layer-sha256:b71f96345d44b237decc0c2d6c2f9ad0d17fde83dad7579608f1f0764d9686f2:    done           |++++++++++++++++++++++++++++++++++++++|</span></span><br><span class="line">  <span class="comment"># config-sha256:69593048aa3acfee0f75f20b77acb549de2472063053f6730c4091b53f2dfb02:   done           |++++++++++++++++++++++++++++++++++++++|</span></span><br><span class="line">  <span class="comment"># elapsed: 2.5 s                                                                    total:   0.0 B (0.0 B/s)</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="Kubernetes-ç›¸å…³é—®é¢˜-åŸºäºContainerdè¿è¡Œæ—¶"><a href="#Kubernetes-ç›¸å…³é—®é¢˜-åŸºäºContainerdè¿è¡Œæ—¶" class="headerlink" title="Kubernetes ç›¸å…³é—®é¢˜(åŸºäºContainerdè¿è¡Œæ—¶)"></a>Kubernetes ç›¸å…³é—®é¢˜(åŸºäºContainerdè¿è¡Œæ—¶)</h3><h4 id="1-Kubernetes-é«˜å¯ç”¨é›†ç¾¤æ­å»ºæ—¶é”™è¯¯ä¿¡æ¯æ’æŸ¥æ–¹å¼-æ€è·¯å…·ä½“æƒ…å†µè¿˜éœ€å…·ä½“åˆ†æ"><a href="#1-Kubernetes-é«˜å¯ç”¨é›†ç¾¤æ­å»ºæ—¶é”™è¯¯ä¿¡æ¯æ’æŸ¥æ–¹å¼-æ€è·¯å…·ä½“æƒ…å†µè¿˜éœ€å…·ä½“åˆ†æ" class="headerlink" title="1.Kubernetes é«˜å¯ç”¨é›†ç¾¤æ­å»ºæ—¶é”™è¯¯ä¿¡æ¯æ’æŸ¥æ–¹å¼(æ€è·¯å…·ä½“æƒ…å†µè¿˜éœ€å…·ä½“åˆ†æ)"></a>1.Kubernetes é«˜å¯ç”¨é›†ç¾¤æ­å»ºæ—¶é”™è¯¯ä¿¡æ¯æ’æŸ¥æ–¹å¼(æ€è·¯å…·ä½“æƒ…å†µè¿˜éœ€å…·ä½“åˆ†æ)</h4><ul>
<li>é”™è¯¯ä¿¡æ¯: Unfortunately, an error has occurred: timed out waiting for the condition</li>
<li>é”™è¯¯æ’æŸ¥: </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - æ­¤é”™è¯¯å¯èƒ½ç”±ä»¥ä¸‹åŸå› å¼•èµ·ï¼š</span></span><br><span class="line">- The kubelet is not running</span><br><span class="line">- The kubelet is unhealthy due to a misconfiguration of the node <span class="keyword">in</span> some way (required cgroups disabled)</span><br><span class="line"></span><br><span class="line"><span class="comment"># - å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯systemdçš„ç³»ç»Ÿï¼Œåˆ™å¯ä»¥å°è¯•ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ’é™¤é”™è¯¯ï¼š</span></span><br><span class="line">- <span class="string">'systemctl status kubelet'</span></span><br><span class="line">- <span class="string">'journalctl -xeu kubelet'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - æ­¤å¤–ï¼Œå½“å®¹å™¨è¿è¡Œæ—¶å¯åŠ¨æ—¶ï¼Œæ§åˆ¶å¹³é¢ç»„ä»¶å¯èƒ½å·²å´©æºƒæˆ–é€€å‡ºã€‚è¦è¿›è¡Œæ•…éšœæ’é™¤ï¼Œè¯·ä½¿ç”¨é¦–é€‰å®¹å™¨è¿è¡Œæ—¶CLIåˆ—å‡ºæ‰€æœ‰å®¹å™¨ã€‚</span></span><br><span class="line">- <span class="string">'crictl --runtime-endpoint /run/containerd/containerd.sock ps -a | grep kube | grep -v pause'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - æ‰¾åˆ°å‘ç”Ÿæ•…éšœçš„å®¹å™¨åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·æ£€æŸ¥å…¶æ—¥å¿—ï¼š</span></span><br><span class="line">- <span class="string">'crictl --runtime-endpoint /run/containerd/containerd.sock logs CONTAINERID'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - é›†ç¾¤ pod æ’é”™å¸¸ç”¨å‘½ä»¤æŒ‡å—</span></span><br><span class="line">kubectl get pod &lt;pod-name&gt; -o yaml <span class="comment"># æŸ¥çœ‹ Pod çš„é…ç½®æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">kubectl describe pod &lt;pod-name&gt;    <span class="comment"># æŸ¥çœ‹ Pod çš„äº‹ä»¶</span></span><br><span class="line">kubectl logs &lt;pod-name&gt; [-c &lt;container-name&gt;] <span class="comment"># æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å®é™…æ¡ˆä¾‹:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">journalctl -xeu kubelet</span><br><span class="line">  <span class="comment"># Jul 06 22:15:29 k8s-master-1 kubelet[11333]: E0706 22:15:29.108499   11333 kubelet.go:2183] Container runtime network not ready: NetworkReady=false reason:NetworkPluginNotReady message:Network plugin returns error: cni plugin not initialized</span></span><br><span class="line">  <span class="comment"># Jul 06 22:15:29 k8s-master-1 kubelet[11333]: E0706 22:15:29.206203   11333 kubelet.go:2263] node "k8s-master-1" not found</span></span><br><span class="line">  <span class="comment"># Jul 06 22:15:29 k8s-master-1 kubelet[11333]: E0706 22:15:29.208552   11333 remote_runtime.go:116] RunPodSandbox from runtime service failed: rpc error: code = Unknown desc = failed to get sandbox image "k8s.gcr.io/pause:3.2": failed to pull image "&gt;</span></span><br><span class="line">  <span class="comment"># Jul 06 22:15:29 k8s-master-1 kubelet[11333]: E0706 22:15:29.208609   11333 kuberuntime_sandbox.go:70] CreatePodSandbox for pod "kube-controller-manager-k8s-master-1_kube-system(d1d11a3cb97124022c9d85b070508dfa)" failed: rpc error: code = Unknown de&gt;</span></span><br><span class="line">  <span class="comment"># Jul 06 22:15:29 k8s-master-1 kubelet[11333]: E0706 22:15:29.208621   11333 kuberuntime_manager.go:755] createPodSandbox for pod "kube-controller-manager-k8s-master-1_kube-system(d1d11a3cb97124022c9d85b070508dfa)" failed: rpc error: code = Unknown d&gt;</span></span><br><span class="line">  <span class="comment"># Jul 06 22:15:29 k8s-master-1 kubelet[11333]: E0706 22:15:29.208682   11333 pod_workers.go:191] Error syncing pod d1d11a3cb97124022c9d85b070508dfa ("kube-controller-manager-k8s-master-1_kube-system(d1d11a3cb97124022c9d85b070508dfa)"), skipping: fail&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>é”™è¯¯åŸå› : ç”±äºä»k8s.gcr.io/pause:3.2ä»“åº“æ— æ³•æ‹‰å–pauseé•œåƒå¯¼è‡´kubernetesé›†ç¾¤æ²¡åŠæ³•åˆ›å»ºç›¸åº”çš„PodSandboxè€Œæœ€ç»ˆä½¿å¾—é›†ç¾¤å®‰è£…å¤±è´¥ã€‚</li>
<li>è§£å†³åŠæ³•: ä¿®æ”¹ containerd é…ç½®ä¸­pauseé•œåƒæ‹‰å–çš„ä»“åº“åœ°å€(æ­¤å¤„è®¾ç½®ä¸ºé˜¿é‡Œäº‘)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">"s#k8s.gcr.io#registry.cn-hangzhou.aliyuncs.com/google_containers#g"</span>  /etc/containerd/config.toml</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="2-ä½¿ç”¨crictlå·¥å…·æ‹‰å–é•œåƒæ—¶æŠ¥FATA-0000-pulling-image-failed-rpc-error-code-Unknown-desc-failed-to-pull-and-unpack-imageé”™è¯¯ã€‚"><a href="#2-ä½¿ç”¨crictlå·¥å…·æ‹‰å–é•œåƒæ—¶æŠ¥FATA-0000-pulling-image-failed-rpc-error-code-Unknown-desc-failed-to-pull-and-unpack-imageé”™è¯¯ã€‚" class="headerlink" title="2.ä½¿ç”¨crictlå·¥å…·æ‹‰å–é•œåƒæ—¶æŠ¥FATA[0000] pulling image failed: rpc error: code = Unknown desc = failed to pull and unpack imageé”™è¯¯ã€‚"></a>2.ä½¿ç”¨crictlå·¥å…·æ‹‰å–é•œåƒæ—¶æŠ¥<code>FATA[0000] pulling image failed: rpc error: code = Unknown desc = failed to pull and unpack image</code>é”™è¯¯ã€‚</h4><ul>
<li>é”™è¯¯ä¿¡æ¯:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ crictl pull docker.io/pollyduan/ingress-nginx-controller:v0.47.0</span><br><span class="line">  <span class="comment"># FATA[0000] pulling image failed: rpc error: code = Unknown desc = failed to pull and unpack image "docker.io/pollyduan/ingress-nginx-controller:v0.47.0": failed to resolve reference "docker.io/pollyduan/ingress-nginx-controller:v0.47.0": pull access denied, repository does not exist or may require authorization: server message: insufficient_scope: authorization failed</span></span><br></pre></td></tr></table></figure>
<ul>
<li>é”™è¯¯åŸå› : æœªåœ¨ /etc/crictl.yaml ä¸­è®¾ç½® image-endpoint å¯¹è±¡, å…¶æ¬¡æ˜¯åœ¨ /etc/containerd/config.tomlä¸­è®¾ç½®docker.ioé•œåƒendpointæœ‰è¯¯ã€‚</li>
<li>è§£å†³åŠæ³•: è®¾ç½® image-endpoint ç«¯ç‚¹ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ tee /etc/crictl.yaml &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">runtime-endpoint: unix:///run/containerd/containerd.sock</span><br><span class="line">image-endpoint: <span class="string">"unix:///run/containerd/containerd.sock"</span></span><br><span class="line">timeout: 0</span><br><span class="line">debug: <span class="literal">false</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">$ grep -C 3 <span class="string">'registry.mirrors."docker.io" '</span> /etc/containerd/config.toml</span><br><span class="line">  [plugins.<span class="string">"io.containerd.grpc.v1.cri"</span>.registry]</span><br><span class="line">        [plugins.<span class="string">"io.containerd.grpc.v1.cri"</span>.registry.mirrors]</span><br><span class="line">          [plugins.<span class="string">"io.containerd.grpc.v1.cri"</span>.registry.mirrors.<span class="string">"docker.io"</span>]</span><br><span class="line">            endpoint = [<span class="string">"https://xlx9erfu.mirror.aliyuncs.com"</span>]</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="3-åˆ›å»ºPodæ—¶æŠ¥Failed-to-create-pod-sandbox-rpc-error-code-Unknown-desc-failed-to-set-up-sandbox-container-é”™è¯¯"><a href="#3-åˆ›å»ºPodæ—¶æŠ¥Failed-to-create-pod-sandbox-rpc-error-code-Unknown-desc-failed-to-set-up-sandbox-container-é”™è¯¯" class="headerlink" title="3.åˆ›å»ºPodæ—¶æŠ¥Failed to create pod sandbox: rpc error: code = Unknown desc = [failed to set up sandbox container.é”™è¯¯"></a>3.åˆ›å»ºPodæ—¶æŠ¥<code>Failed to create pod sandbox: rpc error: code = Unknown desc = [failed to set up sandbox container.</code>é”™è¯¯</h4><ul>
<li>é”™è¯¯ä¿¡æ¯:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning  FailedCreatePodSandBox  89s               kubelet            Failed to create pod sandbox: rpc error: code = Unknown desc = [failed to <span class="built_in">set</span> up sandbox container <span class="string">"1c97ad2710e2939c0591477f9d6dde8e0d7d31b3fbc138a7fa38aaa657566a9a"</span> network <span class="keyword">for</span> pod <span class="string">"coredns-7f89b7bc75-qg924"</span>: networkPlugin cni failed to <span class="built_in">set</span> up pod <span class="string">"coredns-7f89b7bc75-qg924_kube-system"</span> network: error getting ClusterInformation: Get <span class="string">"https://[10.96.0.1]:443/apis/crd.projectcalico.org/v1/clusterinformations/default"</span>: x509: certificate signed by unknown authority (possibly because of <span class="string">"crypto/rsa: verification error"</span> <span class="keyword">while</span> trying to verify candidate authority certificate <span class="string">"kubernetes"</span>), failed to clean up sandbox container <span class="string">"1c97ad2710e2939c0591477f9d6dde8e0d7d31b3fbc138a7fa38aaa657566a9a"</span> network <span class="keyword">for</span> pod <span class="string">"coredns-7f89b7bc75-qg924"</span>: networkPlugin cni failed to teardown pod <span class="string">"coredns-7f89b7bc75-qg924_kube-system"</span> network: error getting ClusterInformation: Get <span class="string">"https://[10.96.0.1]:443/apis/crd.projectcalico.org/v1/clusterinformations/default"</span>: x509: certificate signed by unknown authority (possibly because of <span class="string">"crypto/rsa: verification error"</span> <span class="keyword">while</span> trying to verify candidate authority certificate <span class="string">"kubernetes"</span>)]</span><br></pre></td></tr></table></figure>
<ul>
<li>è¡¨ç°çŠ¶æ€: corednsæ— æ³•è¿è¡Œ<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods -n kube-system</span><br><span class="line">NAME                              READY   STATUS              RESTARTS   AGE</span><br><span class="line">coredns-7f89b7bc75-jzs26          0&#x2F;1     ContainerCreating   0          63s</span><br><span class="line">coredns-7f89b7bc75-qg924          0&#x2F;1     ContainerCreating   0          63s</span><br></pre></td></tr></table></figure></li>
<li>è§£å†³åŠæ³•: æ›´æ”¹calico.yaml</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ vim calico.yaml</span><br><span class="line"><span class="comment"># Cluster type to identify the deployment type</span></span><br><span class="line">  - name: CLUSTER_TYPE</span><br><span class="line">  value: <span class="string">"k8s,bgp"</span></span><br><span class="line"><span class="comment"># ä¸‹æ–¹ç†™å¢æ–°å¢</span></span><br><span class="line">  - name: IP_AUTODETECTION_METHOD</span><br><span class="line">    value: <span class="string">"interface=ens192"</span></span><br><span class="line">    <span class="comment"># ens192ä¸ºæœ¬åœ°ç½‘å¡åå­—</span></span><br><span class="line"></span><br><span class="line">$ kubectl apply -f calico.yaml</span><br><span class="line"></span><br><span class="line">$ kubectl get pods -n kube-system</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="4-Kubeadm-åˆå§‹åŒ–-kubernetes-å¤±è´¥æŠ¥-ERROR-SystemVerification-unexpected-kernel-config-CONFIG-CGROUP-PIDSé”™è¯¯"><a href="#4-Kubeadm-åˆå§‹åŒ–-kubernetes-å¤±è´¥æŠ¥-ERROR-SystemVerification-unexpected-kernel-config-CONFIG-CGROUP-PIDSé”™è¯¯" class="headerlink" title="4.Kubeadm åˆå§‹åŒ– kubernetes å¤±è´¥æŠ¥[ERROR SystemVerification]: unexpected kernel config: CONFIG_CGROUP_PIDSé”™è¯¯"></a>4.Kubeadm åˆå§‹åŒ– kubernetes å¤±è´¥æŠ¥<code>[ERROR SystemVerification]: unexpected kernel config: CONFIG_CGROUP_PIDS</code>é”™è¯¯</h4><ul>
<li>é”™è¯¯ä¿¡æ¯:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">error execution phase preflight: [preflight] Some fatal errors occurred:</span><br><span class="line">[ERROR SystemVerification]: unexpected kernel config: CONFIG_CGROUP_PIDS</span><br><span class="line">[ERROR SystemVerification]: missing required cgroups: pids</span><br></pre></td></tr></table></figure>
<ul>
<li>è§£å†³åŠæ³•: é¦–å…ˆä½ è¦åœ¨ cat /boot/config-$(uname -r) | grep CGROUP è¿™ä¸ªæ–‡ä»¶é‡Œé¢åŠ <code>CONFIG_CGROUP_PIDS=y</code><br>ç„¶åä½ å†å‡çº§ä¸€ä¸‹å†…æ ¸å°±å¯ä»¥äº†ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ cat /boot/config-`uname -r` | grep CGROUP</span><br><span class="line">CONFIG_CGROUPS=y</span><br><span class="line">CONFIG_BLK_CGROUP=y</span><br><span class="line">CONFIG_CGROUP_WRITEBACK=y</span><br><span class="line">CONFIG_CGROUP_SCHED=y</span><br><span class="line">CONFIG_CGROUP_PIDS=y</span><br><span class="line">CONFIG_CGROUP_RDMA=y</span><br><span class="line">CONFIG_CGROUP_FREEZER=y</span><br><span class="line">CONFIG_CGROUP_HUGETLB=y</span><br><span class="line">CONFIG_CGROUP_DEVICE=y</span><br><span class="line">CONFIG_CGROUP_CPUACCT=y</span><br><span class="line">CONFIG_CGROUP_PERF=y</span><br><span class="line">CONFIG_CGROUP_BPF=y</span><br><span class="line"><span class="comment"># CONFIG_CGROUP_DEBUG is not set</span></span><br><span class="line">CONFIG_SOCK_CGROUP_DATA=y</span><br><span class="line"><span class="comment"># CONFIG_BLK_CGROUP_IOLATENCY is not set</span></span><br><span class="line">CONFIG_BLK_CGROUP_IOCOST=y</span><br><span class="line"><span class="comment"># CONFIG_BFQ_CGROUP_DEBUG is not set</span></span><br><span class="line">CONFIG_NETFILTER_XT_MATCH_CGROUP=m</span><br><span class="line">CONFIG_NET_CLS_CGROUP=m</span><br><span class="line">CONFIG_CGROUP_NET_PRIO=y</span><br><span class="line">CONFIG_CGROUP_NET_CLASSID=y</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="5-ä½¿ç”¨KubectlæŸ¥çœ‹å·¥ä½œèŠ‚ç‚¹æ—¶å‘ç°èŠ‚ç‚¹çŠ¶æ€ä¸ºNotReadyï¼Œå¹¶æŠ¥å‡ºNetwork-plugin-returns-error-cni-plugin-not-initializedé”™è¯¯è§£å†³åŠæ³•"><a href="#5-ä½¿ç”¨KubectlæŸ¥çœ‹å·¥ä½œèŠ‚ç‚¹æ—¶å‘ç°èŠ‚ç‚¹çŠ¶æ€ä¸ºNotReadyï¼Œå¹¶æŠ¥å‡ºNetwork-plugin-returns-error-cni-plugin-not-initializedé”™è¯¯è§£å†³åŠæ³•" class="headerlink" title="5.ä½¿ç”¨KubectlæŸ¥çœ‹å·¥ä½œèŠ‚ç‚¹æ—¶å‘ç°èŠ‚ç‚¹çŠ¶æ€ä¸ºNotReadyï¼Œå¹¶æŠ¥å‡ºNetwork plugin returns error: cni plugin not initializedé”™è¯¯è§£å†³åŠæ³•."></a>5.ä½¿ç”¨KubectlæŸ¥çœ‹å·¥ä½œèŠ‚ç‚¹æ—¶å‘ç°èŠ‚ç‚¹çŠ¶æ€ä¸ºNotReadyï¼Œå¹¶æŠ¥å‡º<code>Network plugin returns error: cni plugin not initialized</code>é”™è¯¯è§£å†³åŠæ³•.</h4><ul>
<li>é”™è¯¯ä¿¡æ¯:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl describe node master-1</span><br><span class="line">Ready    False   Fri, 22 Apr 2022 14:37:11 +0800   Fri, 22 Apr 2022 11:38:16 +0800   KubeletNotReady   container runtime network not ready: NetworkReady=<span class="literal">false</span> reason:NetworkPluginNotReady message:Network plugin returns error: cni plugin not initialized</span><br><span class="line"></span><br><span class="line">$ journalctl -xeu kubelet</span><br><span class="line">Apr 22 14:41:34 master-1 kubelet[412039]: E0422 14:41:34.064340  412039 kubelet.go:2347] <span class="string">"Container runtime network not ready"</span>  networkReady=<span class="string">"NetworkReady=false reason:NetworkPluginNotReady message:Network plugin returns error: cni plugin not initialized"</span></span><br></pre></td></tr></table></figure></li>
<li>é—®é¢˜åŸå› : ç”±äºæˆ‘é‡æ–°åˆå§‹åŒ–é›†ç¾¤èŠ‚ç‚¹åï¼Œåˆ é™¤äº† /etc/cni/net.d/ ç›®å½•å¹¶æœªé‡å¯containerdæœåŠ¡ã€‚</li>
<li>è§£å†³åŠæ³•:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡å¯ containerd</span></span><br><span class="line">$ systemctl restart containerd</span><br><span class="line">$ ls /etc/cni/net.d/</span><br><span class="line">10-calico.conflist  calico-kubeconfig</span><br></pre></td></tr></table></figure></li>
</ul>

        </div>
        
  <hr>
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>

  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>

  <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ï¼Œè½¬ä¸ªå‘ã€‘(äººé—´äº”å¤§æƒ…)</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œè°¢è°¢ï¼ã€‚</p>

  <div>
    <img src="https://www.weiyigeek.top/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul>

  <div>
    <img src="/img/wechat-search.png" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·"  width="380" height="170">
    <img src="/img/wechat-app.png" class="img-responsive" alt="æ‰«æVisit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº"  width="385" height="170">
  </div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-09-08T03:52:07.931Z" itemprop="dateUpdated">2022-09-08 11:52:07</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Containerd/2.åŸºäºContainerdå®‰è£…Kuberneteså¤šæ§åˆ¶å¹³é¢é›†ç¾¤å®è·µ.md" target="_blank" rel="noopener noreferrer">_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Containerd/2.åŸºäºContainerdå®‰è£…Kuberneteså¤šæ§åˆ¶å¹³é¢é›†ç¾¤å®è·µ.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2021/6-29-571.html" target="_blank" rel="external">https://blog.weiyigeek.top/2021/6-29-571.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">ğŸ‘ é’Ÿæ„ä½œè€…</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Containerd/" rel="tag">Containerd</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kubernetes/" rel="tag">kubernetes</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2021/6-29-571.html&title=ã€Š2.åŸºäºContainerdè¿è¡Œæ—¶æ­å»ºKuberneteså¤šæ§åˆ¶å¹³é¢é›†ç¾¤å®è·µã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2021/6-29-571.html&title=ã€Š2.åŸºäºContainerdè¿è¡Œæ—¶æ­å»ºKuberneteså¤šæ§åˆ¶å¹³é¢é›†ç¾¤å®è·µã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2021/6-29-571.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š2.åŸºäºContainerdè¿è¡Œæ—¶æ­å»ºKuberneteså¤šæ§åˆ¶å¹³é¢é›†ç¾¤å®è·µã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2021/6-29-571.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2021/6-29-571.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2021/6-30-581.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">3.åŸºäºContainerdå®¹å™¨è¿è¡Œæ—¶çš„é…ç½®æµ…æä¸çŸ¥è¯†æ‰©å……å®è·µ</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2021/6-27-570.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">1.Containerdå®¹å™¨è¿è¡Œæ—¶åˆè¯†ä¸å°è¯•</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-å‰è¨€ç®€è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å‰è¨€ç®€è¿°</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-ç¯å¢ƒå‡†å¤‡"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 ç¯å¢ƒå‡†å¤‡</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-å®‰è£…æµç¨‹"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 å®‰è£…æµç¨‹</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x03-åŸºç¡€å®è·µ"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 åŸºç¡€å®è·µ</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x04-å…¥å‘å‡ºå‘"><span class="post-toc-number">5.</span> <span class="post-toc-text">0x04 å…¥å‘å‡ºå‘</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Containerd-ç›¸å…³é—®é¢˜"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">Containerd ç›¸å…³é—®é¢˜</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#é—®é¢˜1-æ‰§è¡Œctrå‘½ä»¤æ—¶æŠ¥-connection-error-æˆ–è€…-connect-permission-denied-é”™è¯¯"><span class="post-toc-number">5.1.1.</span> <span class="post-toc-text">é—®é¢˜1.æ‰§è¡Œctrå‘½ä»¤æ—¶æŠ¥ connection error æˆ–è€… :connect: permission denied é”™è¯¯</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#é—®é¢˜2-æœªæŒ‡å®šåç§°ç©ºé—´-namespace-æˆ–è€…è¯¥æ“ä½œå¯¹è±¡ä¸åœ¨è¯¥åç§°ç©ºé—´-namespace-ä¸­æ‰§è¡Œæ“ä½œå‘½ä»¤"><span class="post-toc-number">5.1.2.</span> <span class="post-toc-text">é—®é¢˜2.æœªæŒ‡å®šåç§°ç©ºé—´(namespace)æˆ–è€…è¯¥æ“ä½œå¯¹è±¡ä¸åœ¨è¯¥åç§°ç©ºé—´(namespace)ä¸­æ‰§è¡Œæ“ä½œå‘½ä»¤</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#é—®é¢˜3-ä½¿ç”¨ctræ‹‰å–é•œåƒæ—¶æŠ¥INFO-0001-trying-next-host-error-quot-failed-to-authorize-failed-to-fetch-anonymous-token-é”™è¯¯"><span class="post-toc-number">5.1.3.</span> <span class="post-toc-text">é—®é¢˜3.ä½¿ç”¨ctræ‹‰å–é•œåƒæ—¶æŠ¥INFO[0001] trying next host error&#x3D;&quot;failed to authorize: failed to fetch anonymous token:é”™è¯¯</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Kubernetes-ç›¸å…³é—®é¢˜-åŸºäºContainerdè¿è¡Œæ—¶"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">Kubernetes ç›¸å…³é—®é¢˜(åŸºäºContainerdè¿è¡Œæ—¶)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-Kubernetes-é«˜å¯ç”¨é›†ç¾¤æ­å»ºæ—¶é”™è¯¯ä¿¡æ¯æ’æŸ¥æ–¹å¼-æ€è·¯å…·ä½“æƒ…å†µè¿˜éœ€å…·ä½“åˆ†æ"><span class="post-toc-number">5.2.1.</span> <span class="post-toc-text">1.Kubernetes é«˜å¯ç”¨é›†ç¾¤æ­å»ºæ—¶é”™è¯¯ä¿¡æ¯æ’æŸ¥æ–¹å¼(æ€è·¯å…·ä½“æƒ…å†µè¿˜éœ€å…·ä½“åˆ†æ)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-ä½¿ç”¨crictlå·¥å…·æ‹‰å–é•œåƒæ—¶æŠ¥FATA-0000-pulling-image-failed-rpc-error-code-Unknown-desc-failed-to-pull-and-unpack-imageé”™è¯¯ã€‚"><span class="post-toc-number">5.2.2.</span> <span class="post-toc-text">2.ä½¿ç”¨crictlå·¥å…·æ‹‰å–é•œåƒæ—¶æŠ¥FATA[0000] pulling image failed: rpc error: code &#x3D; Unknown desc &#x3D; failed to pull and unpack imageé”™è¯¯ã€‚</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-åˆ›å»ºPodæ—¶æŠ¥Failed-to-create-pod-sandbox-rpc-error-code-Unknown-desc-failed-to-set-up-sandbox-container-é”™è¯¯"><span class="post-toc-number">5.2.3.</span> <span class="post-toc-text">3.åˆ›å»ºPodæ—¶æŠ¥Failed to create pod sandbox: rpc error: code &#x3D; Unknown desc &#x3D; [failed to set up sandbox container.é”™è¯¯</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-Kubeadm-åˆå§‹åŒ–-kubernetes-å¤±è´¥æŠ¥-ERROR-SystemVerification-unexpected-kernel-config-CONFIG-CGROUP-PIDSé”™è¯¯"><span class="post-toc-number">5.2.4.</span> <span class="post-toc-text">4.Kubeadm åˆå§‹åŒ– kubernetes å¤±è´¥æŠ¥[ERROR SystemVerification]: unexpected kernel config: CONFIG_CGROUP_PIDSé”™è¯¯</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#5-ä½¿ç”¨KubectlæŸ¥çœ‹å·¥ä½œèŠ‚ç‚¹æ—¶å‘ç°èŠ‚ç‚¹çŠ¶æ€ä¸ºNotReadyï¼Œå¹¶æŠ¥å‡ºNetwork-plugin-returns-error-cni-plugin-not-initializedé”™è¯¯è§£å†³åŠæ³•"><span class="post-toc-number">5.2.5.</span> <span class="post-toc-text">5.ä½¿ç”¨KubectlæŸ¥çœ‹å·¥ä½œèŠ‚ç‚¹æ—¶å‘ç°èŠ‚ç‚¹çŠ¶æ€ä¸ºNotReadyï¼Œå¹¶æŠ¥å‡ºNetwork plugin returns error: cni plugin not initializedé”™è¯¯è§£å†³åŠæ³•.</span></a></li></ol></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

  <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¿˜è¯·æ”¯æŒä¸€ä¸‹åšä¸»å“Ÿ, è°¢è°¢å„ä½çœ‹å‹â™¥!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

  
 <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->

  <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">ä¸ªäººGithub</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">ä¸ªäººGitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">ä¸ªäººçŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘+äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2021/6-29-571.html&title=ã€Š2.åŸºäºContainerdè¿è¡Œæ—¶æ­å»ºKuberneteså¤šæ§åˆ¶å¹³é¢é›†ç¾¤å®è·µã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2021/6-29-571.html&title=ã€Š2.åŸºäºContainerdè¿è¡Œæ—¶æ­å»ºKuberneteså¤šæ§åˆ¶å¹³é¢é›†ç¾¤å®è·µã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2021/6-29-571.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š2.åŸºäºContainerdè¿è¡Œæ—¶æ­å»ºKuberneteså¤šæ§åˆ¶å¹³é¢é›†ç¾¤å®è·µã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2021/6-29-571.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2021/6-29-571.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJ0lEQVR42u3ay3KDMAwF0Pz/T9NtZ1rIlUTawT6sOgnBPixUPfx6xdfx4zr7Nrn/+z3Xz7n5wsDAeCzjuLzyBZJfJaTr13G6EwwMjA0Y+aOvF+jdM2FjYGBgVO/pfTJZFwMDA6O33SRx/OeAi4GB8UBGUsQmm84bbUl77iO1OAYGxgMZedf97//+yHwDAwPjUYyjePXGnNXEsbwrDAyMpRl5gOslc9WCdrIfDAyMVRnVUjNf7K4GXPQJBgbGBozecDHHJM+vDjt/CbgYGBiLMpLAN1lgPrBsjjAxMDAWZUzGA8mSeaJZfREYGBi7MfLBQPUwWR6sq8/EwMBYmzEvSqshtdq8i36FgYGxASMvX/PRZt5Eu6GQxsDAWJrRyyWvH52A5422N4U3BgbG0ox7RwKTRluv54+BgbEqo9pcq5ajeQNutAcMDIxFGZOBYp7q5clcnmgWenUYGBhLMKr5Y76hu5LLN6tjYGAszZg3+vNkMW+xVY9oYGBg7MAoW4PfThLHvG13WotjYGBsxqgu0Hsp+eqnaSIGBsYGjDyN6w0Peg24QgmNgYGxKGMSQPPCtRdk838DGBgYazN6B8Xyb/MQ3EsTyxgMDIzHMu5tkF2ncfmQshqyMTAwdmD0Al/+bWFDrWMcGBgYGL3jWXnAzQ9YnL4UDAwMjDiBu7fQLQRxDAyMDRjVYUBSyk7C6wfbbRgYGA9kjE5qtEYLyZhhEtwxMDAWYnwBcb2TYeZpH2sAAAAASUVORK5CYII=" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 



  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 
     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>
