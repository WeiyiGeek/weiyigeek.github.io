{"title":"安全开发小知识记录","slug":"网安大类/安全开发/杂类/安全开发小知识记录","date":"2019-07-08T05:36:30.000Z","updated":"2023-01-31T02:29:10.673Z","url":"2019/7-8-423.html","path":"api/articles/2019/7-8-423.html.json","covers":["https://img.weiyigeek.top/2020/1/20200528164823.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-前言\"><a href=\"#0x00-前言\" class=\"headerlink\" title=\"0x00 前言\"></a>0x00 前言</h4><p>小小知识大作用</p>\n<h4 id=\"0x01-F-amp-Q\"><a href=\"#0x01-F-amp-Q\" class=\"headerlink\" title=\"0x01 F&amp;Q\"></a>0x01 F&amp;Q</h4><h5 id=\"1-前端Web\"><a href=\"#1-前端Web\" class=\"headerlink\" title=\"1.前端Web\"></a>1.前端Web</h5><p><strong>Q:a标签<code>target=&quot;_blank&quot;</code>的安全问题及解决办法</strong><br>答:A标签的target属性规定在何处如何打开链接文档常用的有<code>_self &amp; _blank</code>,如果在一个 A 标签内包含一个 target 属性，浏览器将会<code>载入和显示用这个标签的 href 属性命名的、名称与这个目标吻合的框架或者窗口中的文档</code>,如果这个指定名称或 id 的框架或者窗口不存在，浏览器将打开一个新的窗口，给这个窗口一个指定的标记，然后超链接文档就可以指向这个新的窗口。您可以把target=”_blank”理解为新的浏览器窗口打开此超链接;</p>\n<blockquote>\n<p>关键点: 如果您使用了该属性却没有添加rel=”noopener noreferrer”得话就会存在一定得安全风险;</p>\n</blockquote>\n<blockquote>\n<p>原理解析:我们知道JS在在调用window下的open方法创建一个新窗口的同时，我们可以获得一个创建窗口的opener句柄，如果通过target=”_blank”点开的窗口活着标签页，此时子窗口也能捕获opener句柄与此同时通过这个句柄，子窗口可以访问到父窗口的一些属性；虽然很有限，但是我们却可以修改父窗口的页面地址，让父窗口显示指定的页面。</p>\n</blockquote>\n<p>实例演示:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#http://www.weiyigeek/a.html</span></span><br><span class=\"line\">&lt;a href=<span class=\"string\">\"b.html\"</span> target=<span class=\"string\">\"_blank\"</span>&gt;跳转&lt;/a&gt;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#点击后浏览器会在新得窗口和标签页打开b.html，又假如此时b.html有如下js代码</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (window.opener) &#123;</span><br><span class=\"line\">    window.opener.location.href = <span class=\"string\">'eval.html'</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br>当页面b.html被打开的同时原来打开a.html的标签页会被重定向到eval.html, <code>eval.html可以是和原来域完全不相关的其它域的资源</code>这就是问题得风险点，如果网站上有上传功能得就需要值得注意了。<br>JS-Console演示:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#窗口1.default.html</span></span><br><span class=\"line\">window.open(<span class=\"string\">\"./index.html\"</span>)</span><br><span class=\"line\"><span class=\"comment\">#Restricted about:blank</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#窗口2.index.html</span></span><br><span class=\"line\">window.opener</span><br><span class=\"line\"><span class=\"comment\">#Restricted https://weiyigeek.top/default.html</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#此时由于target属性为_blank且没有限制Window.opener访问行为执行以下语句此时窗口1将会加载下面得网站文档内容;</span></span><br><span class=\"line\">window.opener.location.href = <span class=\"string\">'https://blog.weiyigeek.top'</span>;</span><br></pre></td></tr></table></figure></p>\n<blockquote>\n<p>解决方法:我们唯一的目的就是限制window.opener的访问行为，此时我只需要在标签中<code>加上一个rel=&quot;noopener&quot;属性(chrome)或者rel=&quot;noreferrer&quot;属性(火狐)</code>,当然您可以将两个属性值合并写成<code>rel=&quot;noopener noreferrer&quot;</code>来完整覆盖,此时子页面就再也访问不到父页面的句柄所以更无法操作原窗口的句柄;<br>也可以通过js来控制限制句柄的访问:<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var otherWindow = window.open();</span><br><span class=\"line\">otherWindow.opener = null;</span><br><span class=\"line\">otherWindow.location = url;</span><br></pre></td></tr></table></figure></p>\n</blockquote>\n<p>总结:在开发中一些小细节还是要引起注意别怕麻烦，比如我们以后在写a标签的时候尽量都在target=”_blank”后面添加一句<code>rel=&quot;noopener noreferrer&quot;</code>。</p>\n<p><br></p>\n<p><strong>Q:”no-referrer”属性标签解决防盗链问题办法</strong><br>答：该标签属性解决其他网站防盗链图片得设置方法，可对绝大部分网站适应，但是会造成百度统计数据异常，请谨慎使用(已测试部分gif网站无效)。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"referrer\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"no-referrer\"</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- #标签内使用no-referrer --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"http://example.com\"</span> <span class=\"attr\">referrer</span>=<span class=\"string\">\"no-referrer|origin|unsafe-url\"</span>&gt;</span>xxx<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">referrer</span>=<span class=\"string\">\"no-referrer|origin|unsafe-url\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"&#123;&#123;item.src&#125;&#125;\"</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">image</span> <span class=\"attr\">referrer</span>=<span class=\"string\">\"no-referrer|origin|unsafe-url\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"&#123;&#123;item.src&#125;&#125;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">image</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200528164823.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>","comments":true,"excerpt":"[TOC]","categories":[{"name":"安全开发","path":"api/categories/安全开发.json"}],"tags":[{"name":"Web","path":"api/tags/Web.json"}]}