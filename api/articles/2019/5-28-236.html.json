{"title":"系统安全策略查看配置命令一览表","slug":"系统运维/Windows/常用命令/系统管理类命令/安全策略查看配置命令一览表","date":"2019-05-28T14:16:30.000Z","updated":"2022-03-29T05:39:06.302Z","url":"2019/5-28-236.html","path":"api/articles/2019/5-28-236.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190821161444.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190821162822.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190821213033.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20191108153312.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210607201700.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"0x01-secedit-命令-命令行中操作组策略计算机安全策略\"><a href=\"#0x01-secedit-命令-命令行中操作组策略计算机安全策略\" class=\"headerlink\" title=\"0x01 secedit 命令 - 命令行中操作组策略计算机安全策略\"></a>0x01 secedit 命令 - 命令行中操作组策略计算机安全策略</h2><p>描述:组策略是建立Windows安全环境的重要手段尤其是在Windows域环境下, 我们可以采用<code>secedit 命令</code>行操作组策略进行命令文本的方式下进行设置, 或者系统管理员肯定使用<code>gpedit.msc</code>在窗口界面下访问组策略。</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190821161444.png\" alt=\"WeiyiGeek.gpedit\" title=\"\" class=\"\">\n                <p>WeiyiGeek.gpedit</p>\n            </figure>\n<p><br></p>\n<p><strong>组策略相关文件路径</strong></p>\n<ul>\n<li>组策略的计算机安全策略模板存放路径<ul>\n<li><code>%SYSTEMROOT%\\security\\templates</code></li>\n</ul>\n</li>\n<li>系统默认的安全数据库路径<ul>\n<li><code>%windir%\\security\\database\\secedit.sdb</code></li>\n</ul>\n</li>\n<li>如果没有/log指定配置操作信息将被记录到scesrv.log <ul>\n<li><code>%windir%\\security\\logs</code>目录之中<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS C:\\Users\\WeiyiGeek&gt; ls C:\\Windows\\Security\\Database\\</span><br><span class=\"line\">目录: C:\\Windows\\Security\\Database</span><br><span class=\"line\">Mode                 LastWriteTime         Length Name</span><br><span class=\"line\">----                 -------------         ------ ----</span><br><span class=\"line\">-a----        2020/12/10      0:06           8192 edb.chk</span><br><span class=\"line\">-a----        2020/12/10      0:06        1048576 edb.log</span><br><span class=\"line\">-a----        2020/12/10      0:06        1048576 edb00001.log</span><br><span class=\"line\">-a----         2020/11/4     23:44        1048576 edbres00001.jrs</span><br><span class=\"line\">-a----         2020/11/4     23:44        1048576 edbres00002.jrs</span><br><span class=\"line\">-a----        2020/12/10      0:06        1048576 edbtmp.log</span><br><span class=\"line\">-a----        2020/12/10      0:06          16384 secedit.jfm</span><br><span class=\"line\">-a----        2020/12/10      9:00        1048576 secedit.sdb</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190821162822.png\" alt=\"WeiyiGeek.secedit.sdb\" title=\"\" class=\"\">\n                <p>WeiyiGeek.secedit.sdb</p>\n            </figure>\n<p><br></p>\n<p><strong>基础语法:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 语法格式:</span></span><br><span class=\"line\">secedit [/configure | /analyze | /import | /<span class=\"built_in\">export</span> | /validate | /generaterollback]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 参数说明:</span></span><br><span class=\"line\">/quit 安静模式</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"export\"><a href=\"#export\" class=\"headerlink\" title=\"/export\"></a>/export</h3><p>描述:允许你导出保存在数据库中的安全设置。</p>\n<p>基础语法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 语法:</span></span><br><span class=\"line\">secedit /<span class=\"built_in\">export</span> [/db filename] [/mergedpolicy] /cfg filename [/areas area1 area2...] [/<span class=\"built_in\">log</span> filename]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 参数：</span></span><br><span class=\"line\">/db filename - 指定要导出数据的数据库。如果没有指定，将使用系统安全数据库。</span><br><span class=\"line\">/cfg filename - 指定要导出数据库内容的安全模板。</span><br><span class=\"line\">/mergedpolicy - 合并并且导出域和本地策略安全设置。</span><br><span class=\"line\">/areas - 指定要应用到系统的安全性范围。如果没有指定此参数，在数据库中定义的所有安全性设置都将应用到系统中。 要配置多个范围，用空格将它们分开。下列安全性范围是受支持的:</span><br><span class=\"line\">  * SECURITYPOLICY - 包括帐户策略，审核策略，事件日志设置和安全选项。</span><br><span class=\"line\">  * GROUP_MGMT - 包括受限制的组设置</span><br><span class=\"line\">  * USER_RIGHTS - 包括用户权限分配</span><br><span class=\"line\">  * REGKEYS - 包括注册表权限</span><br><span class=\"line\">  * FILESTORE - 包括文件系统权限</span><br><span class=\"line\">  * SERVICES - 包括系统服务设置</span><br><span class=\"line\">/<span class=\"built_in\">log</span> filename - 指定要记录导出操作状态的文件。</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"configure\"><a href=\"#configure\" class=\"headerlink\" title=\"/configure\"></a>/configure</h3><p>描述: 允许你用保存在数据库中的安全性设置来配置系统。</p>\n<p>基础语法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">secedit /configure /db filename [/cfg filename] [/overwrite][/areas area1 area2...] [/<span class=\"built_in\">log</span> filename] [/quiet]</span><br><span class=\"line\"></span><br><span class=\"line\">/overwrite - 指定在导入安全性模板前数据库应该被清空</span><br><span class=\"line\"><span class=\"comment\"># - 如果没有指定此参数在安全性模板中指定的将累积到数据库中。</span></span><br><span class=\"line\"><span class=\"comment\"># - 如果没有指定此参数而且在数据库中的设置与要导入的模板冲突，将采用模板中的设置。</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"import\"><a href=\"#import\" class=\"headerlink\" title=\"/import\"></a>/import</h3><p>描述: 可将安全性模板导入到数据库以便模板中指定的设置可应用到系统或作为分析系统的依据。</p>\n<p>基础语法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">secedit /import /db FileName .sdb /cfg FileName.inf [/overwrite] [/areasArea1 Area2 ...] [/logFileName] [/quiet]</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"analyze\"><a href=\"#analyze\" class=\"headerlink\" title=\"/analyze\"></a>/analyze</h3><p>描述: 可通过将其与数据库中的基本设置相比较，分析一台计算机上的安全设置。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">secedit /analyze /db FileName.sdb [/cfgFileName] [/overwrite] [/logFileName] [/quiet]</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"GenereateRollback\"><a href=\"#GenereateRollback\" class=\"headerlink\" title=\"/GenereateRollback\"></a>/GenereateRollback</h3><p>描述：在将配置模板应用到计算机上时可以选择创建回滚模板，该模板在应用时会将安全性设置重置为应用配置模板前的值。(可根据配置模板生成一个回滚模板) </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">secedit /generaterollback /cfg filename /rbk filename [/<span class=\"built_in\">log</span> filename] [/quiet]</span><br><span class=\"line\">/db filename - 指定执行复原操作使用的数据库。</span><br><span class=\"line\">/cfg filename - 指定一个将要生成关于它的复原模板的安全模板。安全模板是用安全模板管理单元创建的。</span><br><span class=\"line\">/rbk filename - 指定一个复原信息要写入的安全模板。安全模板是用安全模板管理单元创建的。</span><br></pre></td></tr></table></figure>\n<p><br></p>\n<h3 id=\"validate\"><a href=\"#validate\" class=\"headerlink\" title=\"/validate\"></a>/validate</h3><p>描述:验证要导入到分析数据库或系统应用程序的安全模板的语法,在不同的系统下执行配置文件中的参数是不同的;</p>\n<p>基础语法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">secedit /validate FileName</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>常用实例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 1..命令行组策略中本地安全策略进行导出</span></span><br><span class=\"line\">secedit /<span class=\"built_in\">export</span> /cfg secedit.inf /<span class=\"built_in\">log</span> secedit.log /quiet</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 2.将修改的本地安全策略导入到系统之中(导入全案策略) 日志路径 gp.log 或者 %windir%\\security\\logs\\scesrv.log。</span></span><br><span class=\"line\">secedit /configure /db gp.sdb /cfg secedit.inf /overwrite /<span class=\"built_in\">log</span> gp.log /quiet</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 3.将安全性模板导入到数据库中存储为模板</span></span><br><span class=\"line\">secedit /import /db secedit.sdb /cfg secedit.inf</span><br><span class=\"line\">secedit /import /db hisecws.sdb /cfg hisecws.inf /overwrite </span><br><span class=\"line\">  <span class=\"comment\"># 使用 /overwrite 模式中的这个模板配置当前系统会 导致指定数据库中现有的安全性记录丢失。你想继续这个操作吗? [y/n]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 4.验证secedit.cfg模板文件格式是否正确</span></span><br><span class=\"line\">SecEdit.exe /validate .\\secedit.cfg</span><br><span class=\"line\">  <span class=\"comment\"># 模板 C:\\Users\\WeiyiGeek\\secedit.cfg 已生效</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 5.选择创建回滚模板</span></span><br><span class=\"line\">secedit /generaterollback /db hisecws.sdb /cfg hisecws.inf /rbk hisecwsrollback.inf /<span class=\"built_in\">log</span> hisecws.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 6. 分析一台计算机上的安全设置</span></span><br><span class=\"line\">secedit /analyze /db current.sdb /<span class=\"built_in\">log</span> result.txt</span><br><span class=\"line\">  <span class=\"comment\"># 有关详细信息，请查看日志 result.txt。</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190821213033.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p><br></p>\n<p>Tips : Built-In Local Groups (本地内置组查询)<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Administrators组 *S-1-5-32-544</span></span><br><span class=\"line\"><span class=\"comment\"># Users组 *S-1-5-32-545</span></span><br><span class=\"line\"><span class=\"comment\"># GUESTS组 *S-1-5-32-546</span></span><br><span class=\"line\"><span class=\"comment\"># BUILTIN\\ACCOUNT OPERATORS *S-1-5-32-548 (=0x224)</span></span><br><span class=\"line\"><span class=\"comment\"># UILTIN\\SERVER OPERATORS *S-1-5-32-549 (=0x225)</span></span><br><span class=\"line\"><span class=\"comment\"># BUILTIN\\PRINT OPERATORS *S-1-5-32-550 (=0x226)</span></span><br><span class=\"line\"><span class=\"comment\"># BUILTIN\\BACKUP OPERATORS *S-1-5-32-551 (=0x227)</span></span><br><span class=\"line\"><span class=\"comment\"># BUILTIN\\REPLICATOR  *S-1-5-32-552 (=0x228)</span></span><br></pre></td></tr></table></figure></p>\n<hr>\n<h2 id=\"0x02-gpresult-命令-显示机器或用户的组策略信息\"><a href=\"#0x02-gpresult-命令-显示机器或用户的组策略信息\" class=\"headerlink\" title=\"0x02 gpresult 命令 - 显示机器或用户的组策略信息\"></a>0x02 gpresult 命令 - 显示机器或用户的组策略信息</h2><p>描述:Gpresult 显示机器或用户的组策略信息此命令行工具显示目标用户和计算机的策略结果集 (RSoP) 的信息</p>\n<p><strong>语法参数:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GPRESULT [/S system [/U username [/P [password]]]] [/SCOPE scope]</span><br><span class=\"line\">         [/USER targetusername] [/R | /V | /Z] [(/X | /H) &lt;filename&gt; [/F]]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#参数列表:</span></span><br><span class=\"line\">/S        system                 指定要连接到的远程系统。</span><br><span class=\"line\">/U       [domain\\]user        指定命令应在其下执行的用户上下文,无法与 /X、/H 一起使用。</span><br><span class=\"line\">/P        [password]           为给定的用户上下文指定密码。如果省略则提示输入,无法与 /X、/H 一起使用。</span><br><span class=\"line\">/SCOPE    scope             指定是显示用户还是计算机设置,有效值: <span class=\"string\">\"USER\"</span>，<span class=\"string\">\"COMPUTER\"</span>。</span><br><span class=\"line\">/USER    [domain\\]user    指定要显示 RSOP 的用户名称。</span><br><span class=\"line\">/R          显示 RSoP 摘要数据。</span><br><span class=\"line\">/V          指定要显示详细信息,详细信息提供已经应用的、优先权是 1 的详细设置。</span><br><span class=\"line\">/Z          指定显示超详细信息。超详细信息提供其他详细设置，用 1 或更高的优先权应用于此设置。这允许您查看是否在多处设置了某一设置。请参阅组策略联机帮助主题获得更多信息。</span><br><span class=\"line\">/X        &lt;filename&gt;      以 XML 格式将报告保存该位置，并使用由&lt;filename&gt; 参数指定的文件名。(在 Windows Vista SP1 和更高版本以及 Windows Server 2008高版本中有效)</span><br><span class=\"line\">/H        &lt;filename&gt;      以 HTML 格式将报告保存该位置，并使用由 &lt;filename&gt; 参数指定的文件名。(在 WindowsVista SP1 和更高版本以及 Windows Server 2008高版本中有效)</span><br><span class=\"line\"></span><br><span class=\"line\">/F         强制 gpresult 覆盖在, /X 或 /H 命令中指定的文件名</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p><strong>基础实例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.显示更多安装策略信息</span></span><br><span class=\"line\">gpresult /scope USER /z</span><br><span class=\"line\">已应用的组策略对象</span><br><span class=\"line\">-------------------</span><br><span class=\"line\">本地组策略</span><br><span class=\"line\"></span><br><span class=\"line\">用户是下列安全组的一部分</span><br><span class=\"line\">------------------------</span><br><span class=\"line\">None</span><br><span class=\"line\">Everyone</span><br><span class=\"line\">本地帐户和管理员组成员</span><br><span class=\"line\">BUILTIN\\Administrators</span><br><span class=\"line\">BUILTIN\\Users</span><br><span class=\"line\">NT AUTHORITY\\INTERACTIVE</span><br><span class=\"line\">控制台登录</span><br><span class=\"line\">NT AUTHORITY\\Authenticated Us</span><br><span class=\"line\">This Organization</span><br><span class=\"line\">本地帐户</span><br><span class=\"line\">LOCAL</span><br><span class=\"line\">NTLM Authentication</span><br><span class=\"line\">High Mandatory Level</span><br><span class=\"line\"></span><br><span class=\"line\">用户有下列安全特权</span><br><span class=\"line\">------------------</span><br><span class=\"line\">绕过遍历检查</span><br><span class=\"line\">管理审核和安全日志</span><br><span class=\"line\">备份文件和目录</span><br><span class=\"line\">还原文件和目录</span><br><span class=\"line\">更改系统时间</span><br><span class=\"line\">关闭系统</span><br><span class=\"line\">从远程系统强制关机</span><br><span class=\"line\">取得文件或其他对象的所有权</span><br><span class=\"line\">调试程序</span><br><span class=\"line\">修改固件环境值</span><br><span class=\"line\">配置文件系统性能</span><br><span class=\"line\">配置文件单个进程</span><br><span class=\"line\">提高计划优先级</span><br><span class=\"line\">加载和卸载设备驱动程序</span><br><span class=\"line\">创建一个页面文件</span><br><span class=\"line\">为进程调整内存配额</span><br><span class=\"line\">从扩展坞上取下计算机</span><br><span class=\"line\">执行卷维护任务</span><br><span class=\"line\">身份验证后模拟客户端</span><br><span class=\"line\">创建全局对象</span><br><span class=\"line\">更改时区</span><br><span class=\"line\">创建符号链接</span><br><span class=\"line\">增加进程工作集</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.查看本地用户策略组信息</span></span><br><span class=\"line\">GPRESULT /USER targetusername /V</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.远程机器用户的策略组信息</span></span><br><span class=\"line\">GPRESULT /S system /U username /P password /SCOPE USER /V</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.显示RsoP操作系统组策略结果</span></span><br><span class=\"line\">gpresult /r</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5.将报告进行HTML导出</span></span><br><span class=\"line\">GPRESULT /H GPReport.html</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20191108153312.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n<p><br></p>\n<p>Tips: 附录脚本合规检查采用Bat方式，推荐使用博主的PowerShell进行合规检测。<br><figure class=\"highlight bat\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">if</span> <span class=\"keyword\">exist</span> no.txt (<span class=\"built_in\">del</span> no.txt)</span><br><span class=\"line\"><span class=\"built_in\">cls</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> 正在进行 \"审计与帐户策略” 安全检查</span><br><span class=\"line\"><span class=\"built_in\">echo</span> &gt; list.txt PasswordComplexity = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> &gt;&gt; list.txt MinimumPasswordLength = <span class=\"number\">8</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> &gt;&gt; list.txt MaximumPasswordAge = <span class=\"number\">42</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> &gt;&gt; list.txt MinimumPasswordAge = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> &gt;&gt; list.txt PasswordHistorySize = <span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> &gt;&gt; list.txt ClearTextPassword = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> &gt;&gt; list.txt ResetLockoutCount = <span class=\"number\">15</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> &gt;&gt; list.txt LockoutDuration = <span class=\"number\">15</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> &gt;&gt; list.txt LockoutBadCount = <span class=\"number\">15</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> &gt;&gt; list.txt AuditPolicyChange = <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> &gt;&gt; list.txt AuditLogonEvents = <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> &gt;&gt; list.txt AuditObjectAccess = <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> &gt;&gt; list.txt AuditPrivilegeUse = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> &gt;&gt; list.txt AuditProcessTracking = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> &gt;&gt; list.txt AuditDSAccess = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> &gt;&gt; list.txt AuditSystemEvents = <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> &gt;&gt; list.txt AuditAccountLogon = <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> &gt;&gt; list.txt AuditAccountManage = <span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\">secedit /export /cfg model.inf &gt;<span class=\"built_in\">nul</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> /F \"tokens=<span class=\"number\">1</span>,<span class=\"number\">3</span>\" <span class=\"variable\">%%i</span> <span class=\"keyword\">in</span> (list.txt) <span class=\"keyword\">do</span> (</span><br><span class=\"line\"><span class=\"keyword\">call</span> :Getgp <span class=\"variable\">%%i</span> <span class=\"variable\">%%j</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"built_in\">ping</span> <span class=\"number\">127</span>.<span class=\"number\">0</span>.<span class=\"number\">0</span>.<span class=\"number\">1</span> /n <span class=\"number\">2</span> &gt;<span class=\"built_in\">nul</span></span><br><span class=\"line\"><span class=\"built_in\">del</span> tmp.txt</span><br><span class=\"line\"><span class=\"built_in\">del</span> list.txt</span><br><span class=\"line\"><span class=\"built_in\">del</span> model.inf</span><br><span class=\"line\"><span class=\"keyword\">goto</span> :EOF</span><br><span class=\"line\">:Getgp</span><br><span class=\"line\"><span class=\"built_in\">find</span> \"%<span class=\"number\">1</span>\" model.inf &gt;tmp.txt</span><br><span class=\"line\"><span class=\"keyword\">for</span> /f \"skip=<span class=\"number\">2</span> tokens=<span class=\"number\">3</span>\" <span class=\"variable\">%%i</span> <span class=\"keyword\">in</span> (tmp.txt) <span class=\"keyword\">do</span> (</span><br><span class=\"line\"><span class=\"keyword\">if</span> \"<span class=\"variable\">%%i</span>”==”%<span class=\"number\">2</span>\" (<span class=\"built_in\">echo</span> <span class=\"variable\">%1=%</span>%i ok) <span class=\"keyword\">else</span> (<span class=\"built_in\">echo</span> %<span class=\"number\">1</span> 策略不符合规则&gt;&gt;bad.txt)</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">goto</span> :EOF</span><br></pre></td></tr></table></figure></p>\n<p>补充说明: </p>\n<hr>\n<h2 id=\"0x0n-入坑-amp-出坑\"><a href=\"#0x0n-入坑-amp-出坑\" class=\"headerlink\" title=\"0x0n 入坑&amp;出坑\"></a>0x0n 入坑&amp;出坑</h2><h3 id=\"1-修改本地安全设置的ini文件后采用secedit导入本地安全策略出现了扩展性错误。\"><a href=\"#1-修改本地安全设置的ini文件后采用secedit导入本地安全策略出现了扩展性错误。\" class=\"headerlink\" title=\"1.修改本地安全设置的ini文件后采用secedit导入本地安全策略出现了扩展性错误。\"></a>1.修改本地安全设置的ini文件后采用secedit导入本地安全策略出现了扩展性错误。</h3><ul>\n<li><strong>错误表现:</strong> 1) 服务器查看相关的安全性策略的配置，发现修改某一个设置后通过本地的gpedit.msc打开本地安全策略就报了这个错误 2) 在<code>SecEdit.exe /validate secconfig.cfg</code>验证我们修改过的文件.<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS C:\\Users\\WeiyiGeek&gt; SecEdit.exe /validate secconfig.cfg</span><br><span class=\"line\">出现了扩展错误。</span><br><span class=\"line\"> 你指定的文件可能已损坏。</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20210607201700.png\" alt=\"WeiyiGeek.出现了扩展性错误\" title=\"\" class=\"\">\n                <p>WeiyiGeek.出现了扩展性错误</p>\n            </figure></li>\n<li><strong>问题原因:</strong> 我修改后的secconfig.cfg策略文件其编码是UTF-8而非 UTF-16 LE格式。</li>\n<li><strong>解决办法:</strong> 1) 手动将内容复制到<code>secedit /export /cfg config.cfg /quiet</code>生成的config.cfg 2) 采用PS不指定编码格式<code>Get-Content secconfig.cfg | Out-File test.cfg</code>。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># - 针对于修改服务器相关的安全性策略的配置后出现了扩展性错误解决办法</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方式1.用以下命令来检测修复(百度-未实践)</span></span><br><span class=\"line\">  * esentutl /k %windir%\\Security\\Database\\Secedit.sdb </span><br><span class=\"line\">  * esentutl /g %windir%\\Security\\Database\\Secedit.sdb</span><br><span class=\"line\">  * esentutl /p %windir%\\Security\\Database\\Secedit.sdb </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方式2.重新生成安全数据库的方法</span></span><br><span class=\"line\">  * 1.Open the %SystemRoot%\\Security folder, create a new folder, and <span class=\"keyword\">then</span> name it <span class=\"string\">\"OldSecurity\"</span>. </span><br><span class=\"line\">  * 2.Move all of the files ending <span class=\"keyword\">in</span> .<span class=\"built_in\">log</span> from the %SystemRoot%\\Security folder to the OldSecurity folder. </span><br><span class=\"line\">  * 3.Find the Secedit.sdb file <span class=\"keyword\">in</span> the %SystemRoot%\\Security\\Database folder, and <span class=\"keyword\">then</span> rename this file to <span class=\"string\">\"Secedit.old\"</span>. </span><br><span class=\"line\">  * 4.Click Start, click Run, <span class=\"built_in\">type</span> mmc, and <span class=\"keyword\">then</span> click OK. </span><br><span class=\"line\">  * 5.Click Console, click Add/Remove Snap-in, and <span class=\"keyword\">then</span> add the Security and Configuration snap-in. </span><br><span class=\"line\">  * 6.Right-click Security and Configuration and Analysis, and <span class=\"keyword\">then</span> click Open Database. </span><br><span class=\"line\">  * 7.Browse to the %SystemRoot%\\Security\\Database folder, <span class=\"built_in\">type</span> Secedit.sdb <span class=\"keyword\">in</span> the File name box, and <span class=\"keyword\">then</span> click Open. </span><br><span class=\"line\">  * 8.When you are prompted to import a template, click Setup Security.inf, and <span class=\"keyword\">then</span> click Open.</span><br></pre></td></tr></table></figure></li>\n</ul>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Windows命令","path":"api/categories/Windows命令.json"}],"tags":[{"name":"安全策略","path":"api/tags/安全策略.json"}]}