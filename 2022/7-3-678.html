<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å—|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Nginx,webp">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å—</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å—</h1>
        <h5 class="subtitle">
            
                <time datetime="2022-07-03T07:34:30.000Z" itemprop="datePublished" class="page-time">
  2022-07-03
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E8%BF%90%E7%BB%B4%E5%AE%9E%E8%B7%B5/">è¿ç»´å®è·µ</a></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
  <article id="post-ç³»ç»Ÿè¿ç»´/Application/Web/WebApp/Nginx/9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®å®è·µæŒ‡å—"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å—</h1>
        <div class="post-meta">
            <time class="post-time" title="2022-07-03 15:34:30" datetime="2022-07-03T07:34:30.000Z"  itemprop="datePublished">2022-07-03</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E8%BF%90%E7%BB%B4%E5%AE%9E%E8%B7%B5/">è¿ç»´å®è·µ</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p><strong>æœ¬ç« ç›®å½•</strong></p>
<p>[TOC]</p>
<h2 id="0x00-å‰è¨€ç®€è¿°"><a href="#0x00-å‰è¨€ç®€è¿°" class="headerlink" title="0x00 å‰è¨€ç®€è¿°"></a>0x00 å‰è¨€ç®€è¿°</h2><p>æè¿°: ä¸ºäº†å®ç°æ ¹æ®è®¿é—®è€…è®¿é—®æˆ‘ä»¬çš„ç½‘ç«™æ—¶æ ¹æ®å…¶IPæ˜¾ç¤ºå…¶æ‰€å±åœ°ï¼Œä¹Ÿä¸ºè·å–ä¸åŒåœ°åŒºè®¿é—®è€…çš„IPåœ°å€ç­‰ç›¸å…³ä¿¡æ¯ä¸ºç›®çš„ï¼Œæ‰€ä»¥åœ¨æœç´¢å¼•æ“ä¸­æŸ¥æ‰¾è§£å†³æ–¹æ¡ˆï¼Œåœ¨ç½‘ç»œä¸ŠæŸ¥è¯¢åˆ°å¦‚ä¸‹å‡ ç§æ–¹æ¡ˆ<code>Nginx+GeoIP2ã€ä½¿ç”¨æ”¶è´¹ IP è¯†åˆ«æ¥å£ã€DNS æ ¹æ®åœ°åŸŸè§£æ</code>ï¼Œç„¶åç»è¿‡å¤šæ–¹é¢è€ƒç©¶ï¼Œæœ€ç»ˆè¿˜æ˜¯ä½¿ç”¨Nginx+GeoIP2è§£å†³æ–¹æ¡ˆã€‚</p>
<a id="more"></a>
<p><strong>ä¸‰ç§è§£å†³æ–¹æ¡ˆä¼˜ç¼ºç‚¹</strong></p>
<ul>
<li><p>[x] Nginx + GeoIP2<br>å¯ä»¥æ‹¿åˆ°è¯·æ±‚ IP çš„å›½å®¶å’ŒåŸå¸‚ä¿¡æ¯ç„¶åè¿›è¡Œå„ç§ä¸ªæ€§åŒ– Nginx é…ç½®<br>å¯ä»¥å°†è¯·æ±‚ IP çš„åœ°ç†ä½ç½®é€šè¿‡ php-fpm ä¼ é€’ php ç¨‹åº<br>å®šæ—¶æ›´æ–° MaxMind å…è´¹æ•°æ®åº“ï¼ˆ<code>GeoLite2-Country.mmdb + GeoLite2-City.mmdb</code>ï¼‰å®Œæˆå®Œç¾é—­ç¯<br>maxmind å…¬å¸ 2002 å¹´æˆç«‹è‡³ä»Šï¼Œé è°±</p>
</li>
<li><p>[ ] ä½¿ç”¨ IP è¯†åˆ«æ¥å£ï¼šç¨³å®šçš„éœ€è¦æ”¶è´¹ï¼ˆä¹Ÿä¸èƒ½ä¿è¯ 100% é«˜å¯ç”¨ï¼šé™é¢‘ã€å“åº”æ—¶é—´ã€æ¥å£å¼‚å¸¸ç­‰å› ç´ ï¼‰ï¼Œå…è´¹çš„æ— æ³•ä¿è¯ç¨³å®šæ€§ï¼Œæ¥å£è¿œè¿œæ²¡æœ‰å°† GeoLite æ•°æ®æ”¾åœ¨æœ¬åœ°ç¨³å®š</p>
</li>
<li><p>[ ] DNS æ ¹æ®åœ°åŸŸè§£æï¼šcloudflare æ”¶è´¹ç•¥è´µï¼Œå›½å†… cloudxns å·²å…³é—­å…è´¹æœåŠ¡ï¼ˆå…è´¹çš„ä¸œè¥¿è¯´å˜å°±å˜ï¼Œè®º planB çš„é‡è¦æ€§ï¼‰</p>
</li>
</ul>
<p><br></p>
<p>æ‰€æœ‰åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•æ­å»ºä¸é…ç½®ä¸€ä¸ªæœ‰æ•ˆçš„ Nginx å’Œ Max Mind GeoIP2/GeoLite2 è®¾ç½®ã€‚ ä»å®‰è£…éƒ¨ç½²åŒ…çš„ä¸‹è½½ã€ç¼–è¯‘å®‰è£…æ­¥éª¤ä»¥åŠå‘½ä»¤ä½¿ç”¨ã€åŒ…æ‹¬å®‰è£…è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°çš„å‘ï¼Œåœ¨æœ€ååšä¸»ä¹Ÿé€šè¿‡å‡ ä¸ªå®è·µä¾‹å­ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ GeoIP2 æŒ‰å›½å®¶/åœ°åŒºé™åˆ¶å¯¹æŸäº› URL çš„è®¿é—®ã€‚ </p>
<p><br></p>
<p><strong>TIPS:</strong> MaxMind GeoIP å·²ç»è¢«å¼ƒç”¨äº†ä¸€æ®µæ—¶é—´ã€‚ å¯¹äºæ‚¨æœ€æ–°çš„åœ°ç†å®šä½éœ€æ±‚ï¼Œè¯·æ”¹ç”¨ MaxMind GeoIP2ï¼ˆæˆ–å…è´¹ç‰ˆæœ¬çš„ GeoLite2ï¼‰ã€‚<br><strong>TIPS:</strong> å½“å‰ç½‘ä¸Šå¤§éƒ¨åˆ†Nginx + GeoIP çš„æ•™ç¨‹éƒ½æ˜¯ GeoIP è€ç‰ˆæœ¬çš„å·²ç»ä¸é€‚ç”¨äº†å½“å‰æœ€æ–°ç‰ˆæœ¬çš„NginxäºŒè¿›åˆ¶ç¼–è¯‘å®‰è£…ï¼Œä½ å¯å‚ç…§æœ¬ç« æ›´å¿«çš„è¿›è¡Œå®è·µä½¿ç”¨ã€‚</p>
<p><strong>TIPS:</strong> GeoUP ä¾èµ– MaxMind çš„ IP æ•°æ®ï¼Œéœ€è¦é¢‘ç¹æ›´æ–°ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å®‰è£…é…ç½®åä¹Ÿå®ç°äº†ä½¿ç”¨<code>crontab</code>æœåŠ¡ï¼Œé’ˆå¯¹å…¶å›½å®¶åŸå¸‚æ•°æ®åº“è¿›è¡Œè‡ªåŠ¨åŒ–è„šæœ¬å®šæ—¶æ›´æ–°é…ç½®ã€‚</p>
<p>å¥½äº†ï¼Œä¸å¤šè¯´äº†ï¼Œä¸‹é¢ç›´æ¥å¼€å§‹å®è·µå§ï¼</p>
<hr>
<h2 id="0x01-å®‰è£…éƒ¨ç½²"><a href="#0x01-å®‰è£…éƒ¨ç½²" class="headerlink" title="0x01 å®‰è£…éƒ¨ç½²"></a>0x01 å®‰è£…éƒ¨ç½²</h2><h3 id="ç¯å¢ƒè¯´æ˜"><a href="#ç¯å¢ƒè¯´æ˜" class="headerlink" title="ç¯å¢ƒè¯´æ˜"></a>ç¯å¢ƒè¯´æ˜</h3><p><strong>ç¯å¢ƒä¸€è§ˆ:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®¿ä¸»æœºç³»ç»Ÿ</span></span><br><span class="line">$ uname -a</span><br><span class="line">113-Ubuntu SMP Thu Feb 3 18:43:29 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line">$ cat /etc/issue.net</span><br><span class="line">Ubuntu 20.04.1 LTS</span><br><span class="line"></span><br><span class="line"><span class="comment"># åº”ç”¨è½¯ä»¶</span></span><br><span class="line">nginx-1.22.0.tar.gz</span><br><span class="line">libmaxminddb-1.6.0.tar.gz</span><br><span class="line">ngx_http_geoip2_module-3.4.tar.gz</span><br><span class="line">GeoLite2-City_20220802.tar.gz</span><br><span class="line">GeoLite2-Country_20220802.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>æ¸©é¦¨æç¤º: æ­¤å¤„ä½¿ç”¨çš„æ˜¯ Ubuntu 20.04 æ“ä½œç³»ç»Ÿ, è¯¥ç³»ç»Ÿå·²åšå®‰å…¨åŠ å›ºå’Œå†…æ ¸ä¼˜åŒ–ç¬¦åˆç­‰ä¿2.0è¦æ±‚ã€<a href="https://github.com/WeiyiGeek/SecOpsDev/blob/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Ubuntu/Ubuntu-InitializeSecurity.sh" target="_blank" rel="noopener">SecOpsDev/Ubuntu-InitializeSecurity.sh at master Â· WeiyiGeek/SecOpsDev</a> ã€‘, å¦‚ä½ çš„Linuxæœªè¿›è¡Œç›¸åº”é…ç½®ç¯å¢ƒå¯èƒ½ä¸è¯»è€…æœ‰äº›è®¸å·®å¼‚, å¦‚éœ€è¦è¿›è¡Œ(windows serverã€Ubuntuã€CentOS)å®‰å…¨åŠ å›ºè¯·å‚ç…§å¦‚ä¸‹åŠ å›ºè„šæœ¬è¿›è¡ŒåŠ å›º, è¯·å¤§å®¶ç–¯ç‹‚çš„ star ã€‚<br>åŠ å›ºè„šæœ¬åœ°å€:ã€ <a href="https://github.com/WeiyiGeek/SecOpsDev/blob/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Ubuntu/Ubuntu-InitializeSecurity.sh" target="_blank" rel="noopener">https://github.com/WeiyiGeek/SecOpsDev/blob/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Ubuntu/Ubuntu-InitializeSecurity.sh</a> ã€‘</p>
<p style='color:red'> ä¸ºäº†èŠ‚çœå¤§å®¶çš„å®è·µæ—¶é—´ï¼Œæˆ‘å·²ç»æŠŠéœ€è¦ç”¨åˆ°çš„æºç åŒ…ä¸Šä¼ åˆ°ç©ºé—´ä¸­ï¼Œæœ‰éœ€è¦çš„æœ‹å‹å¯ä»¥çœ‹ä¸€ä¸‹ï¼Œä¸‹è½½åœ°å€: <a href="http://share.weiyigeek.top/d/36158960-50338508-7c5982?p=2088ï¼ˆè®¿é—®å¯†ç ï¼š2088ï¼‰" target="_blank" rel="noopener">http://share.weiyigeek.top/d/36158960-50338508-7c5982?p=2088ï¼ˆè®¿é—®å¯†ç ï¼š2088ï¼‰</a><br><br/><br>æ¸©é¦¨æç¤º: å¦‚æç¤ºè¯ä¹¦ä¸å¯¹ï¼Œè¯·ç‚¹å‡»é«˜çº§ç»§ç»­è®¿é—®å³å¯.<br></p>

<figure class="image-box">
                <a rel=9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å— href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220806093220.png" target="_blank" title="WeiyiGeek.NginxåŠå…¶æ¨¡å—ä¸‹è½½" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220806093220.png" alt="WeiyiGeek.NginxåŠå…¶æ¨¡å—ä¸‹è½½" title="" class=""></a>
                <p>WeiyiGeek.NginxåŠå…¶æ¨¡å—ä¸‹è½½</p>
            </figure>
<p>åŸæ–‡åœ°å€: <a href="https://blog.weiyigeek.top">https://blog.weiyigeek.top</a></p>
<p><br/></p>
<h3 id="libmaxminddb-ä¸‹è½½"><a href="#libmaxminddb-ä¸‹è½½" class="headerlink" title="libmaxminddb ä¸‹è½½"></a>libmaxminddb ä¸‹è½½</h3><p>æè¿°: é¦–å…ˆå®‰è£… libmaxminddb åº“ï¼Œå…¶æä¾›äº†ä¸€ä¸ªç”¨äºè¯»å–<code>MaxMind DB</code>æ–‡ä»¶çš„Cåº“ï¼ŒåŒ…æ‹¬æ¥è‡ªMaxMindçš„GeoIP2æ•°æ®åº“ã€‚è¿™æ˜¯ä¸€ç§è‡ªå®šä¹‰äºŒè¿›åˆ¶æ ¼å¼ï¼Œæ—¨åœ¨ä¿ƒè¿› IP åœ°å€çš„å¿«é€ŸæŸ¥æ‰¾ï¼ŒåŒæ—¶å…è®¸åœ¨ä¸åœ°å€å…³è”çš„æ•°æ®ç±»å‹æ–¹é¢å…·æœ‰æå¤§çš„çµæ´»æ€§ã€‚</p>
<p>é¡¹ç›®åœ°å€: <a href="https://github.com/maxmind/libmaxminddb" target="_blank" rel="noopener">https://github.com/maxmind/libmaxminddb</a><br>ä¸‹è½½æ„å»º:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget -c https://github.com/maxmind/libmaxminddb/releases/download/1.6.0/libmaxminddb-1.6.0.tar.gz</span><br><span class="line">tar -zxvf libmaxminddb-1.6.0.tar.gz &amp;&amp; <span class="built_in">cd</span> libmaxminddb-1.6.0</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">tee -a /etc/ld.so.conf.d/libc.conf &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line"><span class="comment"># libc default configuration</span></span><br><span class="line">/usr/<span class="built_in">local</span>/lib</span><br><span class="line">EOF</span><br><span class="line">sudo ldconfig</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>æˆ–ä½¿ç”¨aptå‘½ä»¤è¿›è¡Œå®‰è£…:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt update</span><br><span class="line">$ sudo apt install libmaxminddb0 libmaxminddb-dev mmdb-bin geoipupdate</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢å®‰è£…çš„è½¯ä»¶åŒ…æ˜¯ï¼š</p>
<ul>
<li>libmaxminddb0 libmaxminddb-dev â€“ MaxMind åœ°ç†å®šä½æ•°æ®åº“</li>
<li>mmdb-bin â€“ äºŒè¿›åˆ¶ã€‚ ä»å‘½ä»¤è¡Œè°ƒç”¨çš„ç¨‹åºã€‚ ä½¿ç”¨æ­¤å‘½ä»¤æ‰‹åŠ¨å®šä½ IPã€‚</li>
<li>geoipupdate â€“ å¸®åŠ©é…ç½®å’Œæ›´æ–° GeoIP2 / GeoLite2 çš„è½¯ä»¶åŒ…ã€‚ </li>
</ul>
<p><br/></p>
<h3 id="ngx-http-geoip2-module-ä¸‹è½½"><a href="#ngx-http-geoip2-module-ä¸‹è½½" class="headerlink" title="ngx_http_geoip2_module ä¸‹è½½"></a>ngx_http_geoip2_module ä¸‹è½½</h3><p>æè¿°: ä¸‹è½½ ngx_http_geoip2_module ä½¿ç”¨åŸºäºå®¢æˆ·ç«¯ IPï¼ˆé»˜è®¤ï¼‰æˆ–ç‰¹å®šå˜é‡ï¼ˆåŒæ—¶æ”¯æŒ IPv4 å’Œ IPv6ï¼‰çš„ <code>maxmind geoip2</code> æ•°æ®åº“ä¸­çš„å€¼åˆ›å»ºå˜é‡ï¼Œè¯¥æ¨¡å—ç°åœ¨æ”¯æŒnginxæµï¼Œå¹¶ä¸”å¯ä»¥ä»¥ä¸httpæ¨¡å—ç›¸åŒçš„æ–¹å¼ä½¿ç”¨ã€‚</p>
<p>é¡¹ç›®åœ°å€: <a href="https://github.com/leev/ngx_http_geoip2_module/" target="_blank" rel="noopener">https://github.com/leev/ngx_http_geoip2_module/</a><br>ä¸‹è½½æ„å»º:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget -c https://github.com/leev/ngx_http_geoip2_module/archive/refs/tags/3.4.tar.gz -O /usr/<span class="built_in">local</span>/src/ngx_http_geoip2_module-3.4.tar.gz</span><br><span class="line">tar -zxf ngx_http_geoip2_module-3.4.tar.gz &amp;&amp; ls ngx_http_geoip2_module-3.4/</span><br><span class="line">  <span class="comment"># config  LICENSE  ngx_http_geoip2_module.c  ngx_stream_geoip2_module.c  README.md</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>Geoip2 æ¨¡å—è¯­æ³•</strong><br>è¯­æ³•ç¤ºä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HTTP</span></span><br><span class="line">http &#123;</span><br><span class="line">  ...</span><br><span class="line">  geoip2 /etc/maxmind-country.mmdb &#123;</span><br><span class="line">    auto_reload 5m;</span><br><span class="line">    <span class="variable">$geoip2_data_country_code</span> default=US <span class="built_in">source</span>=<span class="variable">$variable_with_ip</span> country iso_code;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Stream</span></span><br><span class="line">stream &#123;</span><br><span class="line">  ...</span><br><span class="line">  geoip2 /etc/maxmind-country.mmdb &#123;</span><br><span class="line">    auto_reload 5m;</span><br><span class="line">    <span class="variable">$geoip2_data_country_code</span> default=US <span class="built_in">source</span>=<span class="variable">$remote_addr</span> country iso_code;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å‚æ•°è¯´æ˜: </p>
<ul>
<li><p><code>auto_reload &lt;interval&gt;</code>: å¯ç”¨è‡ªåŠ¨é‡æ–°åŠ è½½å°†ä½¿ nginx ä»¥æŒ‡å®šçš„æ—¶é—´é—´éš”æ£€æŸ¥æ•°æ®åº“çš„ä¿®æ”¹æ—¶é—´ï¼Œå¦‚æœå‘ç”Ÿæ›´æ”¹åˆ™é‡æ–°åŠ è½½ã€‚</p>
</li>
<li><p><code>$variable_name [default=&lt;value] [source=$variable_with_ip] path ...</code>: å¦‚æœæ²¡æœ‰æŒ‡å®šã€defaultã€‘å‚æ•°ï¼Œåˆ™å¦‚æœæœªæ‰¾åˆ°è¯¥å˜é‡å°†ä¸ºç©ºï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šã€sourceã€‘å‚æ•° $remote_addr å°†ç”¨äºæ‰§è¡ŒæŸ¥æ‰¾ã€‚</p>
</li>
</ul>
<p><br/></p>
<p>ä»ä¸Šé¢è¯­æ³•æ ¼å¼ä¸­æ‚¨æ˜¯å¦æ˜¯ä¸€ç‰‡èŒ«ç„¶ï¼Œä¸ç®¡ä½ æ˜¯ä¸æ˜¯åæ­£æˆ‘ç¬¬ä¸€æ¬¡çœ‹åˆ°å°±èŒ«ç„¶äº†ï¼Œé‚£ <code>country iso_code</code> å…³é”®å­—åˆæ˜¯ä»ä½•è€Œæ¥?</p>
<p>ä¸ºäº†è§£å†³ä¸Šé¢è¿™ä¸ªç–‘é—®ï¼Œæˆ‘ä»¬åœ¨æ¥çœ‹çœ‹å¦‚ä¸‹æ“ä½œã€‚ </p>
<p><br></p>
<p><strong>mmdblookup å‘½ä»¤</strong><br>æè¿°: åœ¨å‰é¢ç¼–è¯‘å®‰è£…<code>libmaxminddb</code>åº“åï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨ mmdblookup å·¥å…·ï¼ŒæŸ¥æ‰¾æ‰€éœ€æ•°æ®çš„è·¯å¾„ï¼ˆä¾‹å¦‚ï¼šå›½å®¶/åœ°åŒºåç§°ï¼‰ï¼Œä»¥JSONæ ¼å¼è¿”å›çš„ï¼Œå…¶ä¸­continentï¼ˆæ´²ï¼‰ ã€country (å›½å®¶) ã€registered_countryï¼ˆå·²æ³¨å†Œçš„å›½å®¶ï¼‰å¯¹è±¡åŒ…å«äº†<code>code/geoname_id/names</code>é”®ï¼š</p>
<p>GeoLite2-Country.mmdb åº“åªå¸¦æœ‰ country ç›¸å…³æ•°æ®æ ·æœ¬è¾“å‡º<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">$ mmdblookup --file ./GeoLite2-Country.mmdb --ip 223.6.6.6</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"continent"</span>:</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"code"</span>:</span><br><span class="line">        <span class="string">"AS"</span> &lt;utf8_string&gt;</span><br><span class="line">      <span class="string">"geoname_id"</span>:</span><br><span class="line">        <span class="number">6255147</span> &lt;uint32&gt;</span><br><span class="line">      <span class="string">"names"</span>:</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"de"</span>:</span><br><span class="line">            <span class="string">"Asien"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"en"</span>:</span><br><span class="line">            <span class="string">"Asia"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"es"</span>:</span><br><span class="line">            <span class="string">"Asia"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"fr"</span>:</span><br><span class="line">            <span class="string">"Asie"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"ja"</span>:</span><br><span class="line">            <span class="string">"ã‚¢ã‚¸ã‚¢"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"pt-BR"</span>:</span><br><span class="line">            <span class="string">"Ãsia"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"ru"</span>:</span><br><span class="line">            <span class="string">"ĞĞ·Ğ¸Ñ"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"zh-CN"</span>:</span><br><span class="line">            <span class="string">"äºšæ´²"</span> &lt;utf8_string&gt;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="string">"country"</span>:</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"geoname_id"</span>:</span><br><span class="line">        <span class="number">1814991</span> &lt;uint32&gt;</span><br><span class="line">      <span class="string">"iso_code"</span>:</span><br><span class="line">        <span class="string">"CN"</span> &lt;utf8_string&gt;</span><br><span class="line">      <span class="string">"names"</span>:</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"de"</span>:</span><br><span class="line">            <span class="string">"China"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"en"</span>:</span><br><span class="line">            <span class="string">"China"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"es"</span>:</span><br><span class="line">            <span class="string">"China"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"fr"</span>:</span><br><span class="line">            <span class="string">"Chine"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"ja"</span>:</span><br><span class="line">            <span class="string">"ä¸­å›½"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"pt-BR"</span>:</span><br><span class="line">            <span class="string">"China"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"ru"</span>:</span><br><span class="line">            <span class="string">"ĞšĞ¸Ñ‚Ğ°Ğ¹"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"zh-CN"</span>:</span><br><span class="line">            <span class="string">"ä¸­å›½"</span> &lt;utf8_string&gt;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="string">"registered_country"</span>:</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"geoname_id"</span>:</span><br><span class="line">        <span class="number">1814991</span> &lt;uint32&gt;</span><br><span class="line">      <span class="string">"iso_code"</span>:</span><br><span class="line">        <span class="string">"CN"</span> &lt;utf8_string&gt;</span><br><span class="line">      <span class="string">"names"</span>:</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"de"</span>:</span><br><span class="line">            <span class="string">"China"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"en"</span>:</span><br><span class="line">            <span class="string">"China"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"es"</span>:</span><br><span class="line">            <span class="string">"China"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"fr"</span>:</span><br><span class="line">            <span class="string">"Chine"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"ja"</span>:</span><br><span class="line">            <span class="string">"ä¸­å›½"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"pt-BR"</span>:</span><br><span class="line">            <span class="string">"China"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"ru"</span>:</span><br><span class="line">            <span class="string">"ĞšĞ¸Ñ‚Ğ°Ğ¹"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"zh-CN"</span>:</span><br><span class="line">            <span class="string">"ä¸­å›½"</span> &lt;utf8_string&gt;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>GeoLite2-City.mmdb åº“å¸¦æœ‰ country City ç›¸å…³æ•°æ®æ ·æœ¬è¾“å‡º (ä¸€èˆ¬æ¨èä½¿ç”¨è¯¥åº“)</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">$ mmdblookup --file ./GeoLite2-City.mmdb --ip 223.6.6.6</span><br><span class="line"> &#123;</span><br><span class="line">    <span class="attr">"city"</span>:</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"geoname_id"</span>:</span><br><span class="line">          <span class="number">1808926</span> &lt;uint32&gt;</span><br><span class="line">        <span class="string">"names"</span>:</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"de"</span>:</span><br><span class="line">              <span class="string">"Hangzhou"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"en"</span>:</span><br><span class="line">              <span class="string">"Hangzhou"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"es"</span>:</span><br><span class="line">              <span class="string">"Hangzhou"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"fr"</span>:</span><br><span class="line">              <span class="string">"Hangzhou"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"ja"</span>:</span><br><span class="line">              <span class="string">"æ­å·å¸‚"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"pt-BR"</span>:</span><br><span class="line">              <span class="string">"Hangzhou"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"ru"</span>:</span><br><span class="line">              <span class="string">"Ğ¥Ğ°Ğ½Ñ‡Ğ¶Ğ¾Ñƒ"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"zh-CN"</span>:</span><br><span class="line">              <span class="string">"æ­å·"</span> &lt;utf8_string&gt;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="string">"continent"</span>:</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"code"</span>:</span><br><span class="line">          <span class="string">"AS"</span> &lt;utf8_string&gt;</span><br><span class="line">        <span class="string">"geoname_id"</span>:</span><br><span class="line">          <span class="number">6255147</span> &lt;uint32&gt;</span><br><span class="line">        <span class="string">"names"</span>:</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"de"</span>:</span><br><span class="line">              <span class="string">"Asien"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"en"</span>:</span><br><span class="line">              <span class="string">"Asia"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"es"</span>:</span><br><span class="line">              <span class="string">"Asia"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"fr"</span>:</span><br><span class="line">              <span class="string">"Asie"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"ja"</span>:</span><br><span class="line">              <span class="string">"ã‚¢ã‚¸ã‚¢"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"pt-BR"</span>:</span><br><span class="line">              <span class="string">"Ãsia"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"ru"</span>:</span><br><span class="line">              <span class="string">"ĞĞ·Ğ¸Ñ"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"zh-CN"</span>:</span><br><span class="line">              <span class="string">"äºšæ´²"</span> &lt;utf8_string&gt;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="string">"country"</span>:</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"geoname_id"</span>:</span><br><span class="line">          <span class="number">1814991</span> &lt;uint32&gt;</span><br><span class="line">        <span class="string">"iso_code"</span>:</span><br><span class="line">          <span class="string">"CN"</span> &lt;utf8_string&gt;</span><br><span class="line">        <span class="string">"names"</span>:</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"de"</span>:</span><br><span class="line">              <span class="string">"China"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"en"</span>:</span><br><span class="line">              <span class="string">"China"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"es"</span>:</span><br><span class="line">              <span class="string">"China"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"fr"</span>:</span><br><span class="line">              <span class="string">"Chine"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"ja"</span>:</span><br><span class="line">              <span class="string">"ä¸­å›½"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"pt-BR"</span>:</span><br><span class="line">              <span class="string">"China"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"ru"</span>:</span><br><span class="line">              <span class="string">"ĞšĞ¸Ñ‚Ğ°Ğ¹"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"zh-CN"</span>:</span><br><span class="line">              <span class="string">"ä¸­å›½"</span> &lt;utf8_string&gt;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="string">"location"</span>:</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"accuracy_radius"</span>:</span><br><span class="line">          <span class="number">1000</span> &lt;uint16&gt;</span><br><span class="line">        <span class="string">"latitude"</span>:</span><br><span class="line">          <span class="number">30.299400</span> &lt;double&gt;</span><br><span class="line">        <span class="string">"longitude"</span>:</span><br><span class="line">          <span class="number">120.161200</span> &lt;double&gt;</span><br><span class="line">        <span class="string">"time_zone"</span>:</span><br><span class="line">          <span class="string">"Asia/Shanghai"</span> &lt;utf8_string&gt;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="string">"registered_country"</span>:</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"geoname_id"</span>:</span><br><span class="line">          <span class="number">1814991</span> &lt;uint32&gt;</span><br><span class="line">        <span class="string">"iso_code"</span>:</span><br><span class="line">          <span class="string">"CN"</span> &lt;utf8_string&gt;</span><br><span class="line">        <span class="string">"names"</span>:</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"de"</span>:</span><br><span class="line">              <span class="string">"China"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"en"</span>:</span><br><span class="line">              <span class="string">"China"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"es"</span>:</span><br><span class="line">              <span class="string">"China"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"fr"</span>:</span><br><span class="line">              <span class="string">"Chine"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"ja"</span>:</span><br><span class="line">              <span class="string">"ä¸­å›½"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"pt-BR"</span>:</span><br><span class="line">              <span class="string">"China"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"ru"</span>:</span><br><span class="line">              <span class="string">"ĞšĞ¸Ñ‚Ğ°Ğ¹"</span> &lt;utf8_string&gt;</span><br><span class="line">            <span class="string">"zh-CN"</span>:</span><br><span class="line">              <span class="string">"ä¸­å›½"</span> &lt;utf8_string&gt;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="string">"subdivisions"</span>:</span><br><span class="line">      [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"geoname_id"</span>:</span><br><span class="line">            <span class="number">1784764</span> &lt;uint32&gt;</span><br><span class="line">          <span class="string">"iso_code"</span>:</span><br><span class="line">            <span class="string">"ZJ"</span> &lt;utf8_string&gt;</span><br><span class="line">          <span class="string">"names"</span>:</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">"en"</span>:</span><br><span class="line">                <span class="string">"Zhejiang"</span> &lt;utf8_string&gt;</span><br><span class="line">              <span class="string">"fr"</span>:</span><br><span class="line">                <span class="string">"Province de Zhejiang"</span> &lt;utf8_string&gt;</span><br><span class="line">              <span class="string">"zh-CN"</span>:</span><br><span class="line">                <span class="string">"æµ™æ±Ÿçœ"</span> &lt;utf8_string&gt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>GeoLite2-Country.mmdb ä¸  GeoLite2-Country.mmdb å¯¹æ¯”ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - å›½å®¶ ./GeoLite2-Country.mmdb åº“</span></span><br><span class="line"><span class="comment"># å¦‚æœæ­¤æ—¶æˆ‘åªæƒ³è·å– country çš„åç§°å¯ä»¥è¿™æ ·ã€‚</span></span><br><span class="line">$ mmdblookup --file ./GeoLite2-Country.mmdb --ip 223.6.6.6 country names zh-CN</span><br><span class="line">  <span class="string">"ä¸­å›½"</span> &lt;utf8_string&gt;</span><br><span class="line"><span class="comment"># å½“ç„¶å¦‚æœä½ æƒ³è·å–å›½å®¶çš„ iso_code ä¹Ÿæ˜¯åŒæ ·çš„ã€‚</span></span><br><span class="line">$ mmdblookup --file ./GeoLite2-Country.mmdb --ip 223.6.6.6 country iso_code</span><br><span class="line">  <span class="string">"CN"</span> &lt;utf8_string&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># - å›½å®¶ã€åŸå¸‚åº“ ./GeoLite2-Country.mmdb åº“</span></span><br><span class="line">$ mmdblookup --file ./GeoLite2-City.mmdb --ip 223.6.6.6 country names zh-CN</span><br><span class="line">  <span class="string">"ä¸­å›½"</span> &lt;utf8_string&gt;</span><br><span class="line">$ mmdblookup --file ./GeoLite2-City.mmdb --ip 223.6.6.6 country iso_code</span><br><span class="line">  <span class="string">"CN"</span> &lt;utf8_string&gt;</span><br><span class="line">$ mmdblookup --file ./GeoLite2-City.mmdb --ip 223.6.6.6 continent names zh-CN</span><br><span class="line">  <span class="string">"äºšæ´²"</span> &lt;utf8_string&gt;</span><br><span class="line">$ mmdblookup --file ./GeoLite2-City.mmdb --ip 223.6.6.6 subdivisions 0 names zh-CN</span><br><span class="line">  <span class="string">"æµ™æ±Ÿçœ"</span> &lt;utf8_string&gt;</span><br><span class="line">$ mmdblookup --file ./GeoLite2-City.mmdb --ip 223.6.6.6 subdivisions 0 names iso_code</span><br><span class="line">  <span class="string">"ZJ"</span> &lt;utf8_string&gt;</span><br><span class="line">$ mmdblookup --file ./GeoLite2-City.mmdb --ip 223.6.6.6 city names zh-CN</span><br><span class="line">  <span class="string">"æ­å·"</span> &lt;utf8_string&gt;</span><br><span class="line">$ mmdblookup --file ./GeoLite2-City.mmdb --ip 223.6.6.6 location longitude <span class="comment"># ç»åº¦  </span></span><br><span class="line">  120.161200 &lt;double&gt;</span><br><span class="line">$ mmdblookup --file ./GeoLite2-City.mmdb --ip 223.6.6.6 location latitude  <span class="comment"># çº¬åº¦</span></span><br><span class="line">  30.299400  &lt;double&gt;</span><br><span class="line">$ mmdblookup --file ./GeoLite2-City.mmdb --ip 223.6.6.6 location time_zone <span class="comment"># æ—¶åŒº</span></span><br><span class="line">  <span class="string">"Asia/Shanghai"</span> &lt;utf8_string&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å— href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220803151840.png" target="_blank" title="WeiyiGeek.mmdblookupè·å–mmdbåº“ä¿¡æ¯" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220803151840.png" alt="WeiyiGeek.mmdblookupè·å–mmdbåº“ä¿¡æ¯" title="" class=""></a>
                <p>WeiyiGeek.mmdblookupè·å–mmdbåº“ä¿¡æ¯</p>
            </figure>
<p>ä¸Šè¿°çš„ä¸¤ä¸ªç¤ºä¾‹æˆ‘ä»¬å¯ä»¥å°†å…¶è½¬æ¢ä¸º geoip2 æ¨¡å—å®šä¹‰çš„nginxå˜é‡ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚åªéœ€è¦å›½å®¶ä¿¡æ¯å»ºè®®ä½¿ç”¨è¯¥åº“</span></span><br><span class="line">geoip2 /usr/<span class="built_in">local</span>/GeoIP2/GeoLite2-Country.mmdb &#123;</span><br><span class="line">  <span class="variable">$geoip2_data_country</span> <span class="string">"default=China"</span> <span class="built_in">source</span>=<span class="variable">$remote_addr</span> country names en</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚éœ€è¦è·å–å›½å®¶ä»¥åŠçœä»½ä¿¡æ¯å»ºè®®ä½¿ç”¨è¯¥åº“ï¼Œæ­¤å¤„æš‚ä¸æ¼”ç¤ºä½¿ç”¨ï¼Œåœ¨åç»­å®è·µä¸­å†è¿›è¡Œä»‹ç»å’Œä½¿ç”¨ã€‚</span></span><br><span class="line">geoip2 /usr/<span class="built_in">local</span>/GeoIP2/GeoLite2-City.mmdb &#123;</span><br><span class="line">  <span class="variable">$geoip2_data_country</span> <span class="string">"default=ä¸­å›½"</span> <span class="built_in">source</span>=<span class="variable">$remote_addr</span> country names zh-CN;  <span class="comment"># ä¸­å›½</span></span><br><span class="line">  <span class="variable">$geoip2_data_country_code</span> country iso_code;                  <span class="comment"># CN</span></span><br><span class="line">  <span class="variable">$geoip2_data_country_continent</span> continent names zh-CN;        <span class="comment"># äºšæ´²</span></span><br><span class="line">  <span class="variable">$geoip2_data_country_continent_code</span> continent code;          <span class="comment"># AS</span></span><br><span class="line">  <span class="variable">$geoip2_data_province_name</span> subdivisions 0 names zh-CN;       <span class="comment"># æµ™æ±Ÿçœ</span></span><br><span class="line">  <span class="variable">$geoip2_data_province_isocode</span> subdivisions 0 names iso_code; <span class="comment"># "ZJ"</span></span><br><span class="line">  <span class="variable">$geoip2_data_city</span> city names zh-CN;                         <span class="comment"># æ­å·</span></span><br><span class="line">  <span class="variable">$geoip2_data_city_longitude</span> location longitude;              <span class="comment"># 120.161200</span></span><br><span class="line">  <span class="variable">$geoip2_data_city_latitude</span> location latitude;                <span class="comment"># 30.299400</span></span><br><span class="line">  <span class="variable">$geoip2_data_city_time_zone</span> location time_zone;             <span class="comment"># "Asia/Shanghai"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>æ¸©é¦¨æç¤º: å½“è¯·æ±‚æ¥è‡ªå—ä¿¡ä»»çš„åœ°å€æ—¶ï¼Œå°†ä½¿ç”¨â€œX-Forwarded-Forâ€è¯·æ±‚æ ‡å¤´å­—æ®µä¸­çš„åœ°å€, å¹¶ä¸”è®¾ç½® <code>geoip2_proxy_recursive &lt; on | off &gt;</code> æŒ‡ä»¤ã€‚</p>
<ul>
<li>å¦‚æœé€’å½’æœç´¢è¢«ç¦ç”¨ï¼Œé‚£ä¹ˆå°†ä½¿ç”¨â€œX-Forwarded-Forâ€ä¸­å‘é€çš„æœ€åä¸€ä¸ªåœ°å€ï¼Œè€Œä¸æ˜¯ä¸ä¸€ä¸ªå—ä¿¡ä»»åœ°å€åŒ¹é…çš„åŸå§‹å®¢æˆ·ç«¯åœ°å€ã€‚ </li>
<li>å¦‚æœå¯ç”¨äº†é€’å½’æœç´¢ï¼Œé‚£ä¹ˆå°†ä½¿ç”¨â€œX-Forwarded-Forâ€ä¸­å‘é€çš„æœ€åä¸€ä¸ªéä¿¡ä»»åœ°å€ï¼Œè€Œä¸æ˜¯ä¸å¯ä¿¡åœ°å€ä¹‹ä¸€åŒ¹é…çš„åŸå§‹å®¢æˆ·ç«¯åœ°å€ã€‚</li>
</ul>
<p>æ¨¡å—ä½¿ç”¨å‚è€ƒåœ°å€ï¼š<a href="https://github.com/leev/ngx_http_geoip2_module/#example-usage" target="_blank" rel="noopener">https://github.com/leev/ngx_http_geoip2_module/#example-usage</a></p>
<p><br/></p>
<h3 id="Geoip2-æ¨¡å—ç¼–è¯‘åŠ¨æ€é“¾æ¥åº“"><a href="#Geoip2-æ¨¡å—ç¼–è¯‘åŠ¨æ€é“¾æ¥åº“" class="headerlink" title="Geoip2 æ¨¡å—ç¼–è¯‘åŠ¨æ€é“¾æ¥åº“"></a>Geoip2 æ¨¡å—ç¼–è¯‘åŠ¨æ€é“¾æ¥åº“</h3><p>æè¿°: æœ‰å¯èƒ½æ­¤æ—¶ä½ é€šè¿‡æºç ç¼–è¯‘æ–¹å¼å®‰è£… Nginx äº† ï¼Œé‚£å¦‚ä½•åŠ å…¥æ–°çš„Nginxæ¨¡å—å‘¢? </p>
<p>ç­”: é‚£å°±æ˜¯é‡æ–°ç¼–è¯‘ Nginx å³å¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰§è¡Œ<code>make install</code>é‡æ–°å®‰è£… Nginx å…·ä½“æ“ä½œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p>Step 1.æ‰§è¡Œ<code>nginx -v</code>è·å–åŸç¼–è¯‘æ„å»ºçš„å‚æ•°ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nginx version: nginx/1.22.0</span><br><span class="line">built by gcc 9.4.0 (Ubuntu 9.4.0-1ubuntu1~20.04.1)</span><br><span class="line">built with OpenSSL 1.1.1q  5 Jul 2022</span><br><span class="line">TLS SNI support enabled</span><br><span class="line">configure arguments: --prefix=/usr/<span class="built_in">local</span>/nginx --with-pcre=../pcre-8.45 ......  --with-ld-opt=-Wl,--as-needed,-O1,--sort-common</span><br></pre></td></tr></table></figure>
<p><br/></p>
<p>Step 2.æ­¤å¤„è¡¥å……ä¸€ç‚¹ï¼Œä½ å®Œå…¨å¯æŒ‰ç…§è‡ªèº«éœ€æ±‚ä½¿ç”¨<code>--add-module</code>è¿›è¡Œé™æ€é“¾æ¥åº“å®‰è£…ï¼Œæˆ–è€…ä½¿ç”¨<code>--add-dynamic-module</code>è¿›è¡ŒåŠ¨æ€é“¾æ¥åº“å®‰è£…ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŠ¨æ€é“¾æ¥åº“å®‰è£…æ¨¡å— ï¼ˆç»å¯¹æˆ–è€…ç›¸å¯¹è·¯å¾„ï¼‰</span></span><br><span class="line">--add-dynamic-module=../ngx_http_geoip2_module-3.4</span><br><span class="line">--add-dynamic-module=/usr/<span class="built_in">local</span>/src/ngx_http_geoip2_module-3.4</span><br><span class="line"></span><br><span class="line"><span class="comment"># é™æ€é“¾æ¥åº“ç”Ÿæˆæ¨¡å—</span></span><br><span class="line">--add-module=../ngx_http_geoip2_module-3.4</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>Step 3.å°†æ­¥éª¤1è·å–çš„å‚æ•°åŠ å…¥åˆ°<code>./configure</code>, å¹¶åœ¨æœ«å°¾æ·»åŠ ä¸Š<code>--add-dynamic-module=/usr/local/src/ngx_http_geoip2_module-3.4</code>, ä»¥é‡æ–°æ„å»ºæ”¯æŒ geoip2 æ¨¡å—çš„ nginx äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/nginx-1.22.0/</span><br><span class="line"></span><br><span class="line"><span class="comment"># é¢„ç¼–è¯‘å‚æ•°</span></span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/nginx --user=nginx --group=nginx --with-pcre=../pcre-8.45 --with-zlib=../zlib-1.2.12 --with-openssl=../openssl-1.1.1q --sbin-path=/usr/sbin/nginx --conf-path=/usr/<span class="built_in">local</span>/nginx/nginx.conf --pid-path=/usr/<span class="built_in">local</span>/nginx/nginx.pid --error-log-path=/var/<span class="built_in">log</span>/nginx/error.log --http-log-path=/var/<span class="built_in">log</span>/nginx/access.log --lock-path=/var/run/nginx.lock --modules-path=/usr/<span class="built_in">local</span>/nginx/modules --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --with-threads --with-http_sub_module --with-http_v2_module --with-http_auth_request_module --with-http_realip_module --with-http_secure_link_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_ssl_module --with-http_slice_module --with-http_stub_status_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-stream_geoip_module --with-mail --with-mail_ssl_module --with-http_addition_module --with-http_random_index_module --with-compat --with-file-aio --with-cc-opt=<span class="string">'-Os -fomit-frame-pointer -g'</span> --with-ld-opt=-Wl,-rpath,/usr/<span class="built_in">local</span>/luajit/lib,--as-needed,-O1,--sort-common --add-module=/usr/<span class="built_in">local</span>/src/ngx_devel_kit-0.3.1 --add-module=/usr/<span class="built_in">local</span>/src/lua-nginx-module-0.10.21 --add-dynamic-module=/usr/<span class="built_in">local</span>/src/<span class="built_in">echo</span>-nginx-module-0.62 --add-dynamic-module=/usr/<span class="built_in">local</span>/src/ngx_http_geoip2_module-3.4</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘æ„å»º</span></span><br><span class="line">make</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘åå°†ä¼šåœ¨objsç›®å½•ç”ŸæˆåŠ¨æ€é“¾æ¥åº“ï¼Œæˆ‘ä»¬éœ€å¤åˆ¶åˆ° /usr/local/nginx/modules</span></span><br><span class="line">$ ls objs/*.so</span><br><span class="line">  objs/ngx_http_geoip2_module.so  objs/ngx_stream_geoip2_module.so</span><br><span class="line">$ cp -a objs/*.so /usr/<span class="built_in">local</span>/nginx/modules</span><br><span class="line">$ ls /usr/<span class="built_in">local</span>/nginx/modules</span><br><span class="line">ngx_http_echo_module.so  ngx_http_geoip2_module.so  ngx_stream_geoip2_module.so</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åä½¿ç”¨objsç›®å½•ä¸­ç”Ÿæˆçš„ nginx äºŒè¿›åˆ¶æ–‡ä»¶è¦†ç›– /usr/sbin/nginx</span></span><br><span class="line">$ cp -a objs/nginx /usr/sbin/nginx</span><br><span class="line">$ make upgrade </span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€åæ‰§è¡Œæ­¤å‘½ä»¤éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">nginx -V</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="GeoLite2-æ•°æ®åº“ä¸‹è½½"><a href="#GeoLite2-æ•°æ®åº“ä¸‹è½½" class="headerlink" title="GeoLite2 æ•°æ®åº“ä¸‹è½½"></a>GeoLite2 æ•°æ®åº“ä¸‹è½½</h3><p>æè¿°: Nginx çš„ <code>ngx_*_geoip2_module</code> æ¨¡å—ä¾èµ–äº GeoLite2 æ•°æ®åº“, å…è´¹çš„ GeoLite2 æ•°æ®åº“å¯ä» Maxminds ç½‘ç«™è·å¾—ï¼ˆéœ€è¦æ³¨å†Œï¼‰ï¼ŒGeoLite2 æ•°æ®åº“åŸºäº IP åœ°å€çš„æ•°æ®åº“å’Œ Web æœåŠ¡ï¼Œæä¾›æœ‰å…³åœ°ç†ä½ç½®ã€äººå£ç»Ÿè®¡å’Œç”¨æˆ·ä»¥åŠåŒ¿åè€…çš„æ•°æ®ã€‚</p>
<p>å¦‚æœä½ æƒ³ä¸‹è½½ä¸æ›´æ–° GeoLite2 æ•°æ®åº“,æ‚¨éœ€è¦æ‹¥æœ‰ MaxMind å¸æˆ· ID å’Œè®¸å¯è¯å¯†é’¥, å¹¶ä¸”å½“æˆ‘ä»¬åœ¨ nginx ä¸­ä½¿ç”¨åˆ™è¯¥ GeoIP2 æ¨¡å—ï¼Œåœ¨æˆ‘ä»¬è¯·æ±‚æ—¶Nginxæ—¶æ ¹æ®IPåœ°å€æ¥è¯†åˆ«æ¥æºå›½å®¶åŸå¸‚ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æå‰ä¸‹è½½è½½è¯¥æ•°æ®åº“.</p>
<p>ç®€å•æµç¨‹: é¦–å…ˆè®¿é—® <code>Maxminds</code> å®˜ç½‘ï¼Œç„¶åæ³¨å†Œç™»é™†åˆ°ç”¨æˆ·åå°ï¼Œåˆ›å»ºå¹¶è·å– <code>License Key</code>, æœ€åä¸‹è½½ GeoLite2 æ•°æ®åº“è¯¥å‹ç¼©åŒ…ï¼Œé‡Œé¢åŒ…å«çš„æ˜¯äºŒè¿›åˆ¶mmdbæ ¼å¼çš„åº“æ–‡ä»¶ã€‚</p>
<p>Maxminds å®˜ç½‘åœ°å€: <a href="https://maxmind.com" target="_blank" rel="noopener">https://maxmind.com</a><br>GeoIP2 Web æœåŠ¡æ¼”ç¤ºï¼ˆæ¯å¤©25æ¬¡é™é¢ï¼‰ï¼š<a href="https://www.maxmind.com/en/geoip2-precision-demo?ip_address=223.6.6.6" target="_blank" rel="noopener">https://www.maxmind.com/en/geoip2-precision-demo?ip_address=223.6.6.6</a><br>Locate My IP Address : <a href="https://www.maxmind.com/en/locate-my-ip-address" target="_blank" rel="noopener">https://www.maxmind.com/en/locate-my-ip-address</a></p>
<p>å¦‚æœæ— æ³•ç™»å½•å®˜ç½‘æˆ–è€…ä½ ä¸æƒ³æ³¨å†Œç™»é™†ï¼Œä¹Ÿå¯ä»¥ä¸‹è½½åšä¸»å·²ç»ä»å®˜ç½‘ä¸‹è½½å¥½çš„ GeoIP2 æ•°æ®åº“ã€‚</p>
<p style='color:red'> GeoLite2 æ•°æ®åº“ä¸‹è½½åœ°å€: <a href="http://share.weiyigeek.top/d/36158960-50280983-746907" target="_blank" rel="noopener">http://share.weiyigeek.top/d/36158960-50280983-746907</a><br>(è®¿é—®å¯†ç : 2088)<br><br/><br>æ¸©é¦¨æç¤º: å¦‚æç¤ºè¯ä¹¦ä¸å¯¹ï¼Œè¯·ç‚¹å‡»é«˜çº§ç»§ç»­è®¿é—®å³å¯.<br></p>

<p><br/></p>
<p><strong>å®è·µæµç¨‹</strong></p>
<p>Step 1.è®¿é—®å¹¶ç™»é™†maxmind.comå®˜ç½‘ï¼Œæ­¤å¤„æˆ‘å·²ç»æ³¨å†Œäº†è´¦å·ï¼Œå°±ä¸åœ¨æ¼”ç¤ºå¦‚ä½•æ³¨å†Œäº†ï¼Œå¦‚æœæ²¡æœ‰æ³¨å†Œçš„æœ‹å‹å¯ä»¥å®‰è£…å¦‚ä¸‹æç¤ºè¿›è¡Œæ³¨å†Œ(<a href="https://support.maxmind.com/hc/en-us/articles/4407099783707-Create-an-Account)ï¼Œç›¸ä¿¡å¤§å®¶éƒ½æ²¡é—®é¢˜ã€‚" target="_blank" rel="noopener">https://support.maxmind.com/hc/en-us/articles/4407099783707-Create-an-Account)ï¼Œç›¸ä¿¡å¤§å®¶éƒ½æ²¡é—®é¢˜ã€‚</a></p>
<figure class="image-box">
                <a rel=9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å— href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220803111300.png" target="_blank" title="WeiyiGeek.maxmindæ³¨å†Œ" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220803111300.png" alt="WeiyiGeek.maxmindæ³¨å†Œ" title="" class=""></a>
                <p>WeiyiGeek.maxmindæ³¨å†Œ</p>
            </figure>
<p><br/></p>
<p>Step 2.ç™»é™†åç‚¹å‡» Account ç”¨æˆ·-&gt; Manage License Keys ç®¡ç†è®¸å¯ -&gt; ç”Ÿæˆè®¸å¯ï¼Œç„¶åå°†ä¼šçœ‹è§ <code>New license key successfully created</code> æç¤ºï¼Œå…¶ä¸­è¯·è®°å½•å· Account/User ID ä¸ License key ï¼Œä»¥å¤‡åç»­ä½¿ç”¨ã€‚</p>
<figure class="image-box">
                <a rel=9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å— href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220803111107.png" target="_blank" title="WeiyiGeek.Manage License Keys" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220803111107.png" alt="WeiyiGeek.Manage License Keys" title="" class=""></a>
                <p>WeiyiGeek.Manage License Keys</p>
            </figure>
<p><br/></p>
<p>Step 3.éšåç‚¹å‡»å³è¾¹çš„<code>GeoIP2</code>é€‰é¡¹å¡ä¸­çš„ <code>Download Files</code>, ä½ å¯å®‰è£…éœ€è¦ä¸‹è½½ <code>Country å›½å®¶</code> æˆ–è€… <code>City åŸå¸‚</code>çš„æ•°æ®ï¼Œä¸Šè¿°ä¸‹è½½è¿æ¥ä¸­æˆ‘ä»¬å·²ç»ä¸‹è½½äº†å¦‚å›¾ä¸­çš„ä¸¤ä¸ªå‹ç¼©åŒ…ã€‚</p>
<p>å®˜æ–¹ä¸‹è½½åœ°å€: <code>https://www.maxmind.com/en/accounts/&lt;your user account id&gt;/geoip/downloads</code></p>
<figure class="image-box">
                <a rel=9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å— href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220803111528.png" target="_blank" title="WeiyiGeek.å®˜æ–¹ä¸‹è½½ GeoIP2 æ•°æ®åº“" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220803111528.png" alt="WeiyiGeek.å®˜æ–¹ä¸‹è½½ GeoIP2 æ•°æ®åº“" title="" class=""></a>
                <p>WeiyiGeek.å®˜æ–¹ä¸‹è½½ GeoIP2 æ•°æ®åº“</p>
            </figure>
<p><br/></p>
<p>Step 4.ä¸‹è½½åä¸Šä¼ åˆ°NginxæœåŠ¡å™¨å¹¶è§£å‹åˆ° <code>/usr/local/GeoIP2</code> ç›®å½•ä¹‹ä¸­ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è‹¥ä¸å­˜åœ¨è¯¥ç›®å½•è¯·åˆ›å»º</span></span><br><span class="line">mkdir -vp /usr/<span class="built_in">local</span>/GeoIP2</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹æ•°æ®åº“</span></span><br><span class="line">ls ~</span><br><span class="line">GeoLite2-City_20220802.tar.gz  GeoLite2-Country_20220802.tar.gz</span><br><span class="line">tar -zxf GeoLite2-City_20220802.tar.gz</span><br><span class="line">tar -zxf GeoLite2-Country_20220802.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°† mmdb æ–‡ä»¶å¤åˆ¶åˆ° /usr/local/GeoIP2 ç›®å½•ä¸‹</span></span><br><span class="line">mv GeoLite2-City_20220802/GeoLite2-City.mmdb /usr/<span class="built_in">local</span>/GeoIP2/</span><br><span class="line">mv GeoLite2-Country_20220802/GeoLite2-Country.mmdb /usr/<span class="built_in">local</span>/GeoIP2/</span><br><span class="line">rm -rf GeoLite2-City_20220802/ GeoLite2-Country_20220802/</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è§£å‹åˆ° /usr/local/GeoIP2/ åçš„ GeoIP2 æ•°æ®åº“</span></span><br><span class="line">$ tree /usr/<span class="built_in">local</span>/GeoIP2/</span><br><span class="line">/usr/<span class="built_in">local</span>/GeoIP2/</span><br><span class="line">â”œâ”€â”€ GeoLite2-City.mmdb</span><br><span class="line">â””â”€â”€ GeoLite2-Country.mmdb</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>Step 5.éªŒè¯GeoIPæ¨¡å—éƒ¨ç½²ç¯å¢ƒ,æˆ‘ä»¬éœ€è¦é’ˆå¯¹nginxç›¸å…³é…ç½®æ–‡ä»¶è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.åœ¨ nginx.conf ä¸­è¿›è¡Œå¦‚ä¸‹å‡ ä¸ªå…³é”®éƒ¨åˆ†é…ç½®ã€‚</span></span><br><span class="line">$ vim nginx.conf</span><br><span class="line">worker_processes  auto;</span><br><span class="line"><span class="comment"># -- å…³é”®ç‚¹: åŠ è½½ geoip2 æ¨¡å—åŠ¨æ€é“¾æ¥åº“</span></span><br><span class="line">load_module modules/ngx_http_geoip2_module.so;</span><br><span class="line">load_module modules/ngx_stream_geoip2_module.so;</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># -- å…³é”®ç‚¹: æ—¥å¿—æ ¼å¼</span></span><br><span class="line">    log_format demo <span class="string">'$remote_addr - [ $geoip2_country_code $geoip2_data_city_name ] - $remote_user [$time_local] "$request" '</span></span><br><span class="line">                <span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">                <span class="string">'"$http_user_agent" "$http_x_forwarded_for" rt=$request_time urt=$upstream_response_time'</span>;</span><br><span class="line">    </span><br><span class="line">   <span class="comment"># -- å…³é”®ç‚¹: geoip æ¨¡å—å˜é‡ç»‘å®š</span></span><br><span class="line">    geoip2 /usr/<span class="built_in">local</span>/GeoIP2/GeoLite2-Country.mmdb &#123;</span><br><span class="line">      <span class="variable">$geoip2_country_code</span> country names en;</span><br><span class="line">    &#125;</span><br><span class="line">    geoip2 /usr/<span class="built_in">local</span>/GeoIP2/GeoLite2-City.mmdb &#123;</span><br><span class="line">      <span class="variable">$geoip2_data_country_name</span> country names en;</span><br><span class="line">      <span class="variable">$geoip2_data_country_code</span> default=China <span class="built_in">source</span>=<span class="variable">$remote_addr</span> country iso_code;</span><br><span class="line">      <span class="variable">$geoip2_data_city_name</span> city names en;</span><br><span class="line">      <span class="variable">$geoip2_data_province_name</span> subdivisions 0 names en;</span><br><span class="line">      <span class="variable">$geoip2_data_province_isocode</span> subdivisions 0 iso_code;</span><br><span class="line">      <span class="variable">$geoip2_continent_code</span> continent code;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.åœ¨ demo.conf é…ç½®å¦‚ä¸‹ location ä»¥éªŒè¯ GeoIPã€‚</span></span><br><span class="line">server &#123;</span><br><span class="line">....</span><br><span class="line">  <span class="comment"># -- å…³é”®ç‚¹: è®¿é—®æ—¥å¿—è®¾ç½®</span></span><br><span class="line">  access_log /var/<span class="built_in">log</span>/nginx/demo-<span class="variable">$&#123;logdate&#125;</span>.<span class="built_in">log</span> demo;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment"># -- å…³é”®ç‚¹: è¯¥è·¯å¾„æ˜¾ç¤ºå½“å‰è¯·æ±‚è®¿é—®åœ°å€ä¿¡æ¯</span></span><br><span class="line">  location = /api/v1/info &#123;</span><br><span class="line">     default_type text/plain;</span><br><span class="line">     <span class="built_in">return</span> 200 <span class="string">"<span class="variable">$remote_addr</span>\n geoip2_country_code=<span class="variable">$geoip2_country_code</span>\n geoip2_data_country_name=<span class="variable">$geoip2_data_country_name</span> \n geoip2_data_country_code=<span class="variable">$geoip2_data_country_code</span> \n geoip2_data_city_name=<span class="variable">$geoip2_data_city_name</span> \n geoip2_continent_code=<span class="variable">$geoip2_continent_code</span> \n geoip2_data_province_name=<span class="variable">$geoip2_data_province_name</span> \n geoip2_data_province_isocode=<span class="variable">$geoip2_data_province_isocode</span>"</span>;</span><br><span class="line">   &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br/></p>
<p>Step 6.é…ç½®å®Œæˆåæ£€æŸ¥nginxé…ç½®å¹¶é‡è½½nginxæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯ <code>nginx -t &amp;&amp; nginx -s reload</code>, ç„¶åä½¿ç”¨æµè§ˆå™¨è¿›è¡Œè®¿é—® <code>http://demo.weiyigeek.top/api/v1/info</code> éªŒè¯ï¼Œå°†ä¼šè¾“å…¥å¦‚ä¸‹ä¿¡æ¯ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">222.177.***.***</span><br><span class="line"> geoip2_country_code=China</span><br><span class="line"> geoip2_data_country_name=China </span><br><span class="line"> geoip2_data_country_code=CN </span><br><span class="line"> geoip2_data_city_name= </span><br><span class="line"> geoip2_continent_code=AS </span><br><span class="line"> geoip2_data_province_name= </span><br><span class="line"> geoip2_data_province_isocode=</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å— href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220803131616.png" target="_blank" title="WeiyiGeek.nginxä¸­ä½¿ç”¨geoip2æ¨¡å—éªŒè¯" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220803131616.png" alt="WeiyiGeek.nginxä¸­ä½¿ç”¨geoip2æ¨¡å—éªŒè¯" title="" class=""></a>
                <p>WeiyiGeek.nginxä¸­ä½¿ç”¨geoip2æ¨¡å—éªŒè¯</p>
            </figure>
<p>è‡³æ­¤ï¼ŒGeoIP2 æ¨¡å—çš„æ‰€éœ€ç¯å¢ƒçš„æ­å»ºå°±å®Œæ¯•äº†ï¼Œæ›´å¤šæ¨¡å—ç¤ºä¾‹è¯·å‚è€ƒ <code>ngx_http_geoip2_module</code> æ–‡æ¡£ , ä¸‹ä¸€ç« èŠ‚å°†è¿›è¡Œå®æˆ˜è®²è§£è¯¥æ¨¡å—çš„ä½¿ç”¨ã€‚</p>
<p><br/></p>
<h3 id="GeoLite2-æ•°æ®åº“è‡ªåŠ¨æ›´æ–°"><a href="#GeoLite2-æ•°æ®åº“è‡ªåŠ¨æ›´æ–°" class="headerlink" title="GeoLite2 æ•°æ®åº“è‡ªåŠ¨æ›´æ–°"></a>GeoLite2 æ•°æ®åº“è‡ªåŠ¨æ›´æ–°</h3><p>æè¿°: ä¸ºäº†ä¿è¯æ•°æ®åº“ä¸­å›½å®¶ä¸åŸå¸‚çš„å‡†ç¡®æ€§ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®cronå®šæ—¶ä»»åŠ¡æ¥æ›´æ–°MaxMindæä¾›çš„<code>GeoLite2-Country.mmdb</code>æˆ–è€…<code>GeoLite2-City.mmdb</code>æ•°æ®åº“åº“, ä»¥ä¿è¯å…¶æ•°æ®åº“ä¿æŒæœ€æ–°ã€‚</p>
<p><br/></p>
<p><strong>æ“ä½œæµç¨‹</strong></p>
<p>Step 1.ä½¿ç”¨aptå‘½ä»¤å¸®åŠ©é…ç½®å’Œæ›´æ–° GeoIP2 / GeoLite2 çš„è½¯ä»¶åŒ…ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y geoipupdate</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>Step 2.ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€å¹¶ç¼–è¾‘ä½äº <code>/etc/GeoIP.conf</code> çš„ <code>MaxMind GeoIP conf</code> æ–‡ä»¶, ä½¿ç”¨ä¸Šè¿°æ­¥éª¤è·å–çš„ AccountID å’Œ LicenseKey å­—æ®µä¿¡æ¯å¡«å…¥å…¶æ–‡ä»¶ä¸­, ä¹‹åä¾¿å¯æ‰§è¡Œè¿›è¡Œåœ°ç†ä½ç½®æ•°æ®åº“ï¼Œæ“ä½œåå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ tee /etc/GeoIP.conf &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">AccountID 696302</span><br><span class="line">LicenseKey ycm3xq02oE7QXMOw</span><br><span class="line">EditionIDs GeoLite2-Country GeoLite2-City</span><br><span class="line">DatabaseDirectory /usr/<span class="built_in">local</span>/GeoIP2</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">ls -alh /usr/<span class="built_in">local</span>/GeoIP2  <span class="comment"># æ‰‹åŠ¨æ›´æ–°å‰</span></span><br><span class="line">geoipupdate --stack-trace</span><br><span class="line">ls -alh /usr/<span class="built_in">local</span>/GeoIP2  <span class="comment"># æ‰‹åŠ¨æ›´æ–°å</span></span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å— href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220805130137.png" target="_blank" title="WeiyiGeek.æ‰‹åŠ¨æ›´æ–°GeoLite2æ•°æ®åº“" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220805130137.png" alt="WeiyiGeek.æ‰‹åŠ¨æ›´æ–°GeoLite2æ•°æ®åº“" title="" class=""></a>
                <p>WeiyiGeek.æ‰‹åŠ¨æ›´æ–°GeoLite2æ•°æ®åº“</p>
            </figure>
<p><br/></p>
<ul>
<li>Step 3.ä¸ºäº†æ–¹ä¾¿è¿ç»´ç®¡ç†æˆ‘ä»¬å¯ä»¥åˆ›å»ºå®šæ—¶ä»»åŠ¡è‡ªåŠ¨æ›´æ–°ï¼Œæé«˜å·¥ä½œæ•ˆç‡ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢æ‰§è¡Œæ–‡ä»¶ç»å¯¹è·¯å¾„</span></span><br><span class="line">$ <span class="built_in">which</span> geoipupdate</span><br><span class="line">/usr/bin/geoipupdate</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯å‘¨å¤©çš„å‡Œæ™¨æ›´æ–°æ•°æ®åº“</span></span><br><span class="line">$ crontab -e</span><br><span class="line">0 * * * 6 /usr/<span class="built_in">local</span>/bin/geoipupdate &gt; /var/<span class="built_in">log</span>/geoipupdate.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>å®˜ç½‘æ›´æ–°å‚è€ƒåœ°å€: <a href="https://dev.maxmind.com/geoip/updating-databases?lang=en" target="_blank" rel="noopener">https://dev.maxmind.com/geoip/updating-databases?lang=en</a>.</p>
<hr>
<h2 id="0x02-å®è·µä½¿ç”¨"><a href="#0x02-å®è·µä½¿ç”¨" class="headerlink" title="0x02 å®è·µä½¿ç”¨"></a>0x02 å®è·µä½¿ç”¨</h2><h3 id="1-ä½¿ç”¨GeoIP2æ¨¡å—è¯·æ±‚å®¢æˆ·ç«¯çš„IPåœ°å€å›½å®¶çœä»½ç»çº¬åº¦å±•ç¤º"><a href="#1-ä½¿ç”¨GeoIP2æ¨¡å—è¯·æ±‚å®¢æˆ·ç«¯çš„IPåœ°å€å›½å®¶çœä»½ç»çº¬åº¦å±•ç¤º" class="headerlink" title="1.ä½¿ç”¨GeoIP2æ¨¡å—è¯·æ±‚å®¢æˆ·ç«¯çš„IPåœ°å€å›½å®¶çœä»½ç»çº¬åº¦å±•ç¤º"></a>1.ä½¿ç”¨GeoIP2æ¨¡å—è¯·æ±‚å®¢æˆ·ç«¯çš„IPåœ°å€å›½å®¶çœä»½ç»çº¬åº¦å±•ç¤º</h3><p>æè¿°: æœ¬æ¬¡å®è·µå°†æ ¹æ®è¯·æ±‚è€…çš„å›½å®¶æ˜¾ç¤ºä¸­æ–‡æˆ–è€…è‹±æ–‡çš„IPåœ°å€ä½ç½®ç­‰ç›¸å…³ä¿¡æ¯åœ¨ç½‘é¡µä¸Šï¼Œé€šè¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“ geoip2 åœ¨æ£€ç´¢æœ‰å…³ geoip æ•°æ®åº“çš„å…ƒæ•°æ®æ—¶ï¼Œå…¶è¯­æ³•æ ¼å¼ä¸º <code>$variable_name metadata &lt;field&gt;</code>, </p>
<p><strong>å®è·µæµç¨‹</strong></p>
<ul>
<li>Step 1.ç¼–è¾‘Nginx.confä¸»é…ç½®æ–‡ä»¶åœ¨ http ç‰‡æ®µä¸­ï¼Œè‡ªå®šä¹‰å®šä¹‰è®¿é—®æ—¥å¿—æ ¼å¼ååŠ å…¥å¦‚ä¸‹ä¸¤ä¸ª geoip2 æŒ‡ä»¤ç‰‡æ®µã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">  .....</span><br><span class="line">  geoip2 /usr/<span class="built_in">local</span>/GeoIP2/GeoLite2-Country.mmdb &#123;</span><br><span class="line">    <span class="comment"># å¯ç”¨è‡ªåŠ¨é‡æ–°åŠ è½½å°†ä½¿ nginx ä»¥æŒ‡å®šçš„æ—¶é—´é—´éš”æ£€æŸ¥æ•°æ®åº“çš„ä¿®æ”¹æ—¶é—´ï¼Œå¦‚æœå‘ç”Ÿæ›´æ”¹åˆ™é‡æ–°åŠ è½½ã€‚</span></span><br><span class="line">    auto_reload 7d;</span><br><span class="line">    <span class="variable">$geoip2_country_code</span> country names en;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  geoip2 /usr/<span class="built_in">local</span>/GeoIP2/GeoLite2-City.mmdb &#123;</span><br><span class="line">    <span class="comment"># ä¸­å›½IPè®¿é—®éƒ½æ˜¾ç¤ºä¸­æ–‡</span></span><br><span class="line">    <span class="variable">$geoip2_data_country</span> <span class="string">"default=ä¸­å›½"</span> <span class="built_in">source</span>=<span class="variable">$remote_addr</span> country names zh-CN;  <span class="comment"># ä¸­å›½</span></span><br><span class="line">    <span class="variable">$geoip2_data_country_code</span> country iso_code;                  <span class="comment"># CN</span></span><br><span class="line">    <span class="variable">$geoip2_data_country_continent</span> continent names zh-CN;        <span class="comment"># äºšæ´²</span></span><br><span class="line">    <span class="variable">$geoip2_data_country_continent_code</span> continent code;          <span class="comment"># AS</span></span><br><span class="line">    <span class="variable">$geoip2_data_province_name</span> subdivisions 0 names zh-CN;       <span class="comment"># æµ™æ±Ÿçœ</span></span><br><span class="line">    <span class="variable">$geoip2_data_province_isocode</span> subdivisions 0 names iso_code; <span class="comment"># "ZJ"</span></span><br><span class="line">    <span class="variable">$geoip2_data_city</span> city names zh-CN;                          <span class="comment"># æ­å·</span></span><br><span class="line">    <span class="variable">$geoip2_data_city_longitude</span> location longitude;              <span class="comment"># 120.161200</span></span><br><span class="line">    <span class="variable">$geoip2_data_city_latitude</span> location latitude;                <span class="comment"># 30.299400</span></span><br><span class="line">    <span class="variable">$geoip2_data_city_time_zone</span> location time_zone;              <span class="comment"># "Asia/Shanghai"</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment"># ä¸­å›½ä»¥å¤–çš„è®¿é—®éƒ½æ˜¯æ˜¾ç¤ºè‹±æ–‡</span></span><br><span class="line">    <span class="variable">$geoip2_data_country_en</span> <span class="string">"default=United States"</span> <span class="built_in">source</span>=<span class="variable">$remote_addr</span> country names en;  <span class="comment"># United States</span></span><br><span class="line">    <span class="variable">$geoip2_data_country_code</span> country iso_code;                     <span class="comment"># US</span></span><br><span class="line">    <span class="variable">$geoip2_data_country_continent_en</span> continent names en;           <span class="comment"># North America</span></span><br><span class="line">    <span class="variable">$geoip2_data_country_continent_code</span> continent code;             <span class="comment"># NA</span></span><br><span class="line">    <span class="variable">$geoip2_data_province_name_en</span> subdivisions 0 names en;          <span class="comment"># ""</span></span><br><span class="line">    <span class="variable">$geoip2_data_province_isocode</span> subdivisions 0 names iso_code;    <span class="comment"># ""</span></span><br><span class="line">    <span class="variable">$geoip2_data_city</span> city names en;                                <span class="comment"># æ­å·</span></span><br><span class="line">    <span class="variable">$geoip2_data_city_longitude</span> location longitude;                 <span class="comment"># 120.161200</span></span><br><span class="line">    <span class="variable">$geoip2_data_city_latitude</span> location latitude;                   <span class="comment"># 30.299400</span></span><br><span class="line">    <span class="variable">$geoip2_data_city_time_zone</span> location time_zone;                 <span class="comment"># "Asia/Shanghai"</span></span><br><span class="line">  &#125;</span><br><span class="line">  ....</span><br><span class="line">  </span><br><span class="line">  map <span class="variable">$geoip2_data_country_code</span> <span class="variable">$CN</span> &#123;</span><br><span class="line">    CN yes;</span><br><span class="line">    TW yes;</span><br><span class="line">    HK yes;</span><br><span class="line">    MO yes;</span><br><span class="line">    default no;       </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br/></p>
<ul>
<li>Step 2.åŒæ ·ç¼–è¾‘<code>conf.d/demo.conf</code>, æ­¤å¤„ä½¿ç”¨è™šæ‹Ÿä¸»æœºå¤´(demo.weiyigeek.top)åšæ¼”, åŠ å…¥å¦‚ä¸‹æŒ‡ä»¤ç‰‡æ®µï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯æ ¹æ®åŒºå…¶åœ°åŒºï¼Œä½¿ç”¨ä¸­è‹±æ–‡æ˜¾ç¤ºè¯·æ±‚è€…IPåœ°ç†ä½ç½®ä¿¡æ¯ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ vim conf.d/demo.conf</span><br><span class="line">server &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment"># ç²¾å‡†åŒ¹é…</span></span><br><span class="line">  location = /api/v1/ip &#123;</span><br><span class="line">    <span class="comment"># å½“è®¿é—®è€…IPæ¥è‡ª `CN|TW|HK|MO` æ—¶å°†ä¼šä»¥jsonçš„å½¢å¼è¿›è¡Œè¿”å›ä¸­æ–‡çš„IPåœ°å€ä¿¡æ¯ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> ( <span class="variable">$geoip2_data_country_code</span> ~* (CN|TW|HK|MO) )&#123;</span><br><span class="line">      rewrite (.*)  /api/v1/ip/cn last;</span><br><span class="line">    &#125;</span><br><span class="line">    rewrite (.*) /api/v1/ip/en last;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># ä¸­æ–‡æ˜¾ç¤º</span></span><br><span class="line">  location /api/v1/ip/cn &#123;</span><br><span class="line">    default_type application/json;</span><br><span class="line">    <span class="built_in">return</span> 200 <span class="string">'&#123;"ip":"$remote_addr","country":&#123;"name": "$geoip2_data_country", "iso_code":  "$geoip2_data_country_code", "continent": "$geoip2_data_country_continent","continent_code": "$geoip2_data_country_continent_code"&#125;,"province":&#123;"name":"$geoip2_data_province_name","iso_code":"$geoip2_data_province_isocode"&#125;,"city":&#123;"name":"$geoip2_data_city","timezone":"$geoip2_data_city_time_zone"&#125;,"location":&#123;"longitude":"$geoip2_data_city_longitude","latitude":"$geoip2_data_city_latitude"&#125;&#125;'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># è‹±æ–‡æ˜¾ç¤º</span></span><br><span class="line">  location /api/v1/ip/en &#123;</span><br><span class="line">    default_type application/json;</span><br><span class="line">    <span class="built_in">return</span> 200 <span class="string">'&#123;"ip":"$remote_addr","country":&#123;"name": "$geoip2_data_country_en", "iso_code":  "$geoip2_data_country_code", "continent": "$geoip2_data_country_continent_en","continent_code": "$geoip2_data_country_continent_code"&#125;,"province":&#123;"name":"$geoip2_data_province_name_en","iso_code":"$geoip2_data_province_isocode"&#125;,"city":&#123;"name":"$geoip2_data_city","timezone":"$geoip2_data_city_time_zone"&#125;,"location":&#123;"longitude":"$geoip2_data_city_longitude","latitude":"$geoip2_data_city_latitude"&#125;&#125;'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<ul>
<li>Step 3.é…ç½® nginx æ ¸éªŒä¸é‡è½½ nginx æœåŠ¡, æ­¤å¤„ä½¿ç”¨ä¸åŒçš„ç½‘ç»œä½¿ç”¨æµè§ˆå™¨è¿›è¡Œè®¿é—®<code>https://demo.weiyigeek.top/api/v1/ip</code>éªŒè¯, ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤º:ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -t &amp;&amp; nginx -s reload</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å— href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220804142610.png" target="_blank" title="WeiyiGeek.ä¸­è‹±æ–‡æ˜¾ç¤ºIPåœ°å€ä¿¡æ¯" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220804142610.png" alt="WeiyiGeek.ä¸­è‹±æ–‡æ˜¾ç¤ºIPåœ°å€ä¿¡æ¯" title="" class=""></a>
                <p>WeiyiGeek.ä¸­è‹±æ–‡æ˜¾ç¤ºIPåœ°å€ä¿¡æ¯</p>
            </figure>
<p><br/></p>
<h3 id="2-ä½¿ç”¨GeoIP2æ¨¡å—é™æ­¢æŸä¸€å›½å®¶åœ°åŒºçš„IPåœ°å€è®¿é—®ç½‘ç«™"><a href="#2-ä½¿ç”¨GeoIP2æ¨¡å—é™æ­¢æŸä¸€å›½å®¶åœ°åŒºçš„IPåœ°å€è®¿é—®ç½‘ç«™" class="headerlink" title="2.ä½¿ç”¨GeoIP2æ¨¡å—é™æ­¢æŸä¸€å›½å®¶åœ°åŒºçš„IPåœ°å€è®¿é—®ç½‘ç«™"></a>2.ä½¿ç”¨GeoIP2æ¨¡å—é™æ­¢æŸä¸€å›½å®¶åœ°åŒºçš„IPåœ°å€è®¿é—®ç½‘ç«™</h3><p>æè¿°: ä¸ºäº†å‡å°‘å›½å¤–çš„æ”»å‡»ï¼Œæˆ‘ä»¬å¯ä»¥å°†æŒ‡å®šçš„åœ°åŒºIPè®¿é—®è¿›è¡Œæ”¾è¡Œï¼Œé™¤æ­¤ä¹‹å¤–çš„å…¨éƒ¨æ‹’ç»ã€‚</p>
<p><strong>å®é™…æµç¨‹:</strong></p>
<ul>
<li>Step 1.åœ¨ nginx.conf ä¸­æ·»åŠ  map æŒ‡ä»¤å¹¶è¿›è¡Œå¦‚ä¸‹é…ç½®, é¢„å®šä¹‰äº†å¯ä»¥è®¿é—®ç½‘ç«™çš„åœ°åŒºã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">....</span><br><span class="line">  map <span class="variable">$geoip2_data_country_code</span> <span class="variable">$allow_visit</span> &#123;</span><br><span class="line">    CN yes;</span><br><span class="line">    TW yes;</span><br><span class="line">    HK yes;</span><br><span class="line">    MO yes;</span><br><span class="line">    default no;</span><br><span class="line">  &#125;</span><br><span class="line">....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>æ¸©é¦¨æç¤º:<br>1) map æŒ‡ä»¤æ˜¯ç”±ngx_http_map_moduleæ¨¡å—æä¾›çš„,é»˜è®¤æƒ…å†µä¸‹å®‰è£… nginx éƒ½ä¼šå®‰è£…è¯¥æ¨¡å—.<br>2) map çš„ä¸»è¦ä½œç”¨æ˜¯â€™åˆ›å»ºè‡ªå®šä¹‰å˜é‡â€™,é€šè¿‡ä½¿ç”¨ nginx çš„â€™å†…ç½®â€™å˜é‡,å»â€™åŒ¹é…â€™æŸäº›ç‰¹å®šè§„åˆ™; å¦‚æœåŒ¹é…æˆåŠŸåˆ™è®¾ç½®æŸä¸ªå€¼ç»™è‡ªå®šä¹‰å˜é‡,è€Œè¿™ä¸ªâ€™è‡ªå®šä¹‰å˜é‡â€™åˆå¯ä»¥â€™ç”¨ä½œä»–ç”¨â€™ã€‚</p>
<p><br></p>
<ul>
<li>Step 2.åœ¨demo.confé…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªè®¿é—®éªŒè¯çš„ç¤ºä¾‹ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¿é—®è¯¥é¡µé¢å¦‚æœ$allow_visitå˜é‡ä¸ä¸ºyesåˆ™è¿”å›403é¡µé¢,å¦åˆ™è¿”å›è®¿é—®è€…çš„IPåœ°åŒºä¿¡æ¯ã€‚</span></span><br><span class="line">location /allow/html &#123;</span><br><span class="line">  default_type text/html;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable">$allow_visit</span> != yes ) &#123;</span><br><span class="line">    <span class="built_in">return</span> 403 <span class="string">"IP [ <span class="variable">$remote_addr</span> ] ç¦æ­¢è®¿é—®! &lt;br&gt; <span class="variable">$remote_addr</span> - <span class="variable">$geoip2_data_country</span> - <span class="variable">$geoip2_data_country_code</span> - <span class="variable">$geoip2_data_country_continent</span>"</span>;</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="built_in">return</span> 200 <span class="string">"æ¬¢è¿IPä¸º [ <span class="variable">$remote_addr</span> ] ç”¨æˆ·è¿›è¡Œè®¿é—®! &lt;br&gt; <span class="variable">$remote_addr</span> - <span class="variable">$geoip2_data_country</span> - <span class="variable">$geoip2_data_country_code</span> - <span class="variable">$geoip2_data_country_continent</span>"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<ul>
<li>Step 3.åŒæ ·ä¿®æ”¹å®Œæˆåï¼Œæˆ‘ä»¬éœ€è¦é’ˆå¯¹nginxé…ç½®æ ¸éªŒä¸é‡æ–°åŠ è½½é…ç½® <code>nginx -t &amp;&amp; nginx -s reload</code> ï¼ˆPS: åç»­å°†ä¸å†æç¤ºäº†ï¼Œæƒ³å¿…å¤§å®¶éƒ½èŠç†Ÿäºå¿ƒäº†ï¼‰, ï¼Œä¹‹ååˆ†åˆ«ä½¿ç”¨å·¥å…·è¿›è¡Œè®¿é—®éªŒè¯ï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºã€‚</li>
</ul>
<figure class="image-box">
                <a rel=9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å— href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220804150600.png" target="_blank" title="WeiyiGeek.allow ip visit" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220804150600.png" alt="WeiyiGeek.allow ip visit" title="" class=""></a>
                <p>WeiyiGeek.allow ip visit</p>
            </figure>
<hr>
<h3 id="3-ä½¿ç”¨GeoIP2æ¨¡å—å®ç°ä¸åŒå›½å®¶è®¿é—®è¿›å…¥ä¸åŒç›®å½•é¡µé¢"><a href="#3-ä½¿ç”¨GeoIP2æ¨¡å—å®ç°ä¸åŒå›½å®¶è®¿é—®è¿›å…¥ä¸åŒç›®å½•é¡µé¢" class="headerlink" title="3.ä½¿ç”¨GeoIP2æ¨¡å—å®ç°ä¸åŒå›½å®¶è®¿é—®è¿›å…¥ä¸åŒç›®å½•é¡µé¢"></a>3.ä½¿ç”¨GeoIP2æ¨¡å—å®ç°ä¸åŒå›½å®¶è®¿é—®è¿›å…¥ä¸åŒç›®å½•é¡µé¢</h3><p>æè¿°: åœ¨æŸäº›æ—¶åˆ»æˆ‘ä»¬å¯èƒ½ä¼šå¯¹ä¸åŒåœ°åŒºæ¥æºè®¿é—®çš„å®¢æˆ·å±•ç¤ºä¸åŒçš„é¡µé¢ï¼Œä¾‹å¦‚å›½å†…æˆ‘å°±æ˜¾ç¤ºä¸­æ–‡çš„é¡µé¢ï¼Œè€Œæ–°åŠ å¡æˆ‘å°±æ˜¾ç¤ºè‹±æ–‡çš„é¡µé¢ï¼Œè¿™æ ·ä¸€æ¥å°±æ›´åŠ äººæ€§åŒ–ä¸€ç‚¹ã€‚</p>
<p><strong>ç¤ºä¾‹æ¼”ç¤º</strong><br>åœ¨<code>/usr/local/nginx/html</code>ç›®å½•ä¸­åˆ›å»º<code>ch/en</code>å­ç›®å½•ï¼ŒåŒæ—¶å‡†å¤‡ä¸¤ä¸ªä¸åŒåœ°åŒºè®¿é—®çš„æµ‹è¯•é¡µé¢:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ tree /usr/<span class="built_in">local</span>/nginx/html</span><br><span class="line">â”œâ”€â”€ ch</span><br><span class="line">â”‚Â Â  â””â”€â”€ index.html</span><br><span class="line">â”œâ”€â”€ en</span><br><span class="line">â”‚Â Â  â””â”€â”€ index.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ cat ch/index.html</span><br><span class="line">&lt;h1&gt;ä¸­æ–‡ç«™ç‚¹&lt;/h1&gt;</span><br><span class="line">&lt;iframe src=<span class="string">"https://blog.weiyigeek.top"</span> frameborder=<span class="string">"0"</span> width=<span class="string">"500"</span>&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure></p>
<p>Nginx é…ç½®ä¸­ä½¿ç”¨GeoIPå¤„ç†è®¿é—®è¯·æ±‚ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">....</span><br><span class="line">  map <span class="variable">$geoip2_data_country_code</span> <span class="variable">$lang_ch</span> &#123;</span><br><span class="line">    CN yes;</span><br><span class="line">    TW yes;</span><br><span class="line">    HK yes;</span><br><span class="line">    MO yes;</span><br><span class="line">    default no;</span><br><span class="line">  &#125;</span><br><span class="line">....</span><br><span class="line"> server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  demo.weiyigeek.top;</span><br><span class="line">    location / &#123;</span><br><span class="line">      <span class="built_in">set</span> <span class="variable">$rootpath</span> html/ch; <span class="comment"># å…³é”®ç‚¹è®¾ç½®ä¸€ä¸ªæ ¹ç›®å½•å˜é‡ã€‚</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable">$lang_ch</span> = no) &#123; </span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$rootpath</span> html/en;</span><br><span class="line">      &#125;</span><br><span class="line">      add_header program-path <span class="variable">$rootpath</span>; <span class="comment"># å…³é”®ç‚¹å†™å…¥åˆ°å“åº”å¤´ä¸­ã€‚</span></span><br><span class="line">      add_header country-code <span class="variable">$geoip2_data_country_code</span>;</span><br><span class="line">      root <span class="variable">$rootpath</span>;</span><br><span class="line">      index index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è®¿é—®ç»“æœ: </p>
<p><a rel=9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å— href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220804194143.png" target="_blank" title="WeiyiGeek.GeoIP2å¤„ç†ä¸åŒå›½å®¶çš„è¯·æ±‚" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220804194143.png" alt="WeiyiGeek.GeoIP2å¤„ç†ä¸åŒå›½å®¶çš„è¯·æ±‚"></a></p>
<hr>
<h2 id="0x0n-å…¥å‘å‡ºå‘"><a href="#0x0n-å…¥å‘å‡ºå‘" class="headerlink" title="0x0n å…¥å‘å‡ºå‘"></a>0x0n å…¥å‘å‡ºå‘</h2><h3 id="é—®é¢˜1-éäºŒè¿›åˆ¶æ–¹å¼å®‰è£…Nginx-GeoIPè¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°çš„é”™è¯¯é—®é¢˜å¦‚ä¸‹ï¼Œä¹Ÿå¸®å¤§å®¶åˆ—ä¸¾å‡ºè§£å†³åŠæ³•ã€‚"><a href="#é—®é¢˜1-éäºŒè¿›åˆ¶æ–¹å¼å®‰è£…Nginx-GeoIPè¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°çš„é”™è¯¯é—®é¢˜å¦‚ä¸‹ï¼Œä¹Ÿå¸®å¤§å®¶åˆ—ä¸¾å‡ºè§£å†³åŠæ³•ã€‚" class="headerlink" title="é—®é¢˜1.éäºŒè¿›åˆ¶æ–¹å¼å®‰è£…Nginx GeoIPè¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°çš„é”™è¯¯é—®é¢˜å¦‚ä¸‹ï¼Œä¹Ÿå¸®å¤§å®¶åˆ—ä¸¾å‡ºè§£å†³åŠæ³•ã€‚"></a>é—®é¢˜1.éäºŒè¿›åˆ¶æ–¹å¼å®‰è£…Nginx GeoIPè¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°çš„é”™è¯¯é—®é¢˜å¦‚ä¸‹ï¼Œä¹Ÿå¸®å¤§å®¶åˆ—ä¸¾å‡ºè§£å†³åŠæ³•ã€‚</h3><p>é”™è¯¯ä¿¡æ¯:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">é”™è¯¯1ï¼š./configure: error: C compiler cc is not foundã€‚</span><br><span class="line">é”™è¯¯2ï¼š./configure: error: the HTTP rewrite module requires the PCRE library.</span><br><span class="line">é”™è¯¯3ï¼š./configure: error: the HTTP gzip module requires the zlib library.</span><br><span class="line">é”™è¯¯4ï¼š./configure: error: the HTTP XSLT module requires the libxml2/libxsltã€‚</span><br><span class="line">é”™è¯¯5ï¼š./configure: error: the HTTP image filter module requires the GD library.</span><br><span class="line">é”™è¯¯6ï¼š./configure: error: SSL modules require the OpenSSL library.</span><br></pre></td></tr></table></figure></p>
<p>è§£å†³åŠæ³•: <code>sudo apt install gcc libpcre3 libpcre3-dev zlib1g-dev libxslt-dev libgd-dev libssl-dev</code></p>
<h3 id="é—®é¢˜2-å¦‚æœåœ¨è¿›è¡ŒNginxç¼–è¯‘æ—¶å‡ºç°-configure-error-the-GeoIP-module-requires-the-GeoIP-library-You-can-either-do-not-enable-the-module-or-install-the-library-é—®é¢˜æç¤ºæ—¶è§£å†³æ–¹æ³•ã€‚"><a href="#é—®é¢˜2-å¦‚æœåœ¨è¿›è¡ŒNginxç¼–è¯‘æ—¶å‡ºç°-configure-error-the-GeoIP-module-requires-the-GeoIP-library-You-can-either-do-not-enable-the-module-or-install-the-library-é—®é¢˜æç¤ºæ—¶è§£å†³æ–¹æ³•ã€‚" class="headerlink" title="é—®é¢˜2: å¦‚æœåœ¨è¿›è¡ŒNginxç¼–è¯‘æ—¶å‡ºç° ./configure: error: the GeoIP module requires the GeoIP library.You can either do not enable the module or install the library. é—®é¢˜æç¤ºæ—¶è§£å†³æ–¹æ³•ã€‚"></a>é—®é¢˜2: å¦‚æœåœ¨è¿›è¡ŒNginxç¼–è¯‘æ—¶å‡ºç° <code>./configure: error: the GeoIP module requires the GeoIP library.You can either do not enable the module or install the library.</code> é—®é¢˜æç¤ºæ—¶è§£å†³æ–¹æ³•ã€‚</h3><p>è§£å†³æ–¹å¼: å¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤<code>apt install -y libgeoip-dev</code>å‘½ä»¤è¿›è¡Œè§£å†³ã€‚</p>
<p>åŸæ–‡åœ°å€: <a href="https://blog.weiyigeek.top/2022/7-3-678.html">https://blog.weiyigeek.top/2022/7-3-678.html</a></p>

        </div>
        <!-- Google å¹¿å‘Š -->
        
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
  

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-08-12T02:38:24.410Z" itemprop="dateUpdated">2022-08-12 10:38:24</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç³»ç»Ÿè¿ç»´/Application/Web/WebApp/Nginx/9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®å®è·µæŒ‡å—.md" target="_blank" rel="noopener noreferrer">_posts/ç³»ç»Ÿè¿ç»´/Application/Web/WebApp/Nginx/9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®å®è·µæŒ‡å—.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2022/7-3-678.html" target="_blank" rel="external">https://blog.weiyigeek.top/2022/7-3-678.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webp/" rel="tag">webp</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2022/7-3-678.html&title=ã€Š9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å—ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2022/7-3-678.html&title=ã€Š9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å—ã€‹ â€” WeiyiGeek Blog&source=æœ¬ç« ç›®å½•
[TOC]
0x00 å‰è¨€ç®€è¿°æè¿°: ä¸ºäº†å®ç°æ ¹æ®è®¿é—®è€…è®¿é—®æˆ‘ä»¬çš„ç½‘ç«™æ—¶æ ¹æ®å…¶IPæ˜¾ç¤ºå…¶æ‰€å±åœ°ï¼Œä¹Ÿä¸ºè·å–ä¸åŒåœ°åŒºè®¿é—®è€…çš„IPåœ°å€ç­‰ç›¸å…³ä¿¡æ¯ä¸ºç›®çš„..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2022/7-3-678.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å—ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2022/7-3-678.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2022/7-3-678.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2022/7-18-674.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">ä½¿ç”¨WebP-Server-Goæ— ç¼è½¬æ¢å›¾ç‰‡ä¸ºGoogleçš„webpæ ¼å¼è®©ä½ ç½‘ç«™è®¿é—®åŠ è½½é€Ÿåº¦é£èµ·æ¥</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2022/7-3-677.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">8.Nginxå®è·µä¹‹è¯·æ±‚å›¾ç‰‡è½¬æ¢ä¸ºGoogleæ¨å‡ºçš„webpæ ¼å¼è½¬æ¢å·¥å…·å®è·µ</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-å‰è¨€ç®€è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å‰è¨€ç®€è¿°</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-å®‰è£…éƒ¨ç½²"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 å®‰è£…éƒ¨ç½²</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ç¯å¢ƒè¯´æ˜"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">ç¯å¢ƒè¯´æ˜</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#libmaxminddb-ä¸‹è½½"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">libmaxminddb ä¸‹è½½</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ngx-http-geoip2-module-ä¸‹è½½"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">ngx_http_geoip2_module ä¸‹è½½</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Geoip2-æ¨¡å—ç¼–è¯‘åŠ¨æ€é“¾æ¥åº“"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">Geoip2 æ¨¡å—ç¼–è¯‘åŠ¨æ€é“¾æ¥åº“</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#GeoLite2-æ•°æ®åº“ä¸‹è½½"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">GeoLite2 æ•°æ®åº“ä¸‹è½½</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#GeoLite2-æ•°æ®åº“è‡ªåŠ¨æ›´æ–°"><span class="post-toc-number">2.6.</span> <span class="post-toc-text">GeoLite2 æ•°æ®åº“è‡ªåŠ¨æ›´æ–°</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-å®è·µä½¿ç”¨"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 å®è·µä½¿ç”¨</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-ä½¿ç”¨GeoIP2æ¨¡å—è¯·æ±‚å®¢æˆ·ç«¯çš„IPåœ°å€å›½å®¶çœä»½ç»çº¬åº¦å±•ç¤º"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">1.ä½¿ç”¨GeoIP2æ¨¡å—è¯·æ±‚å®¢æˆ·ç«¯çš„IPåœ°å€å›½å®¶çœä»½ç»çº¬åº¦å±•ç¤º</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-ä½¿ç”¨GeoIP2æ¨¡å—é™æ­¢æŸä¸€å›½å®¶åœ°åŒºçš„IPåœ°å€è®¿é—®ç½‘ç«™"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">2.ä½¿ç”¨GeoIP2æ¨¡å—é™æ­¢æŸä¸€å›½å®¶åœ°åŒºçš„IPåœ°å€è®¿é—®ç½‘ç«™</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-ä½¿ç”¨GeoIP2æ¨¡å—å®ç°ä¸åŒå›½å®¶è®¿é—®è¿›å…¥ä¸åŒç›®å½•é¡µé¢"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">3.ä½¿ç”¨GeoIP2æ¨¡å—å®ç°ä¸åŒå›½å®¶è®¿é—®è¿›å…¥ä¸åŒç›®å½•é¡µé¢</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x0n-å…¥å‘å‡ºå‘"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x0n å…¥å‘å‡ºå‘</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#é—®é¢˜1-éäºŒè¿›åˆ¶æ–¹å¼å®‰è£…Nginx-GeoIPè¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°çš„é”™è¯¯é—®é¢˜å¦‚ä¸‹ï¼Œä¹Ÿå¸®å¤§å®¶åˆ—ä¸¾å‡ºè§£å†³åŠæ³•ã€‚"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">é—®é¢˜1.éäºŒè¿›åˆ¶æ–¹å¼å®‰è£…Nginx GeoIPè¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°çš„é”™è¯¯é—®é¢˜å¦‚ä¸‹ï¼Œä¹Ÿå¸®å¤§å®¶åˆ—ä¸¾å‡ºè§£å†³åŠæ³•ã€‚</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#é—®é¢˜2-å¦‚æœåœ¨è¿›è¡ŒNginxç¼–è¯‘æ—¶å‡ºç°-configure-error-the-GeoIP-module-requires-the-GeoIP-library-You-can-either-do-not-enable-the-module-or-install-the-library-é—®é¢˜æç¤ºæ—¶è§£å†³æ–¹æ³•ã€‚"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">é—®é¢˜2: å¦‚æœåœ¨è¿›è¡ŒNginxç¼–è¯‘æ—¶å‡ºç° .&#x2F;configure: error: the GeoIP module requires the GeoIP library.You can either do not enable the module or install the library. é—®é¢˜æç¤ºæ—¶è§£å†³æ–¹æ³•ã€‚</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    


    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      

    <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
    
      <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
        
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/search-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2022/7-3-678.html&title=ã€Š9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å—ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2022/7-3-678.html&title=ã€Š9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å—ã€‹ â€” WeiyiGeek Blog&source=æœ¬ç« ç›®å½•
[TOC]
0x00 å‰è¨€ç®€è¿°æè¿°: ä¸ºäº†å®ç°æ ¹æ®è®¿é—®è€…è®¿é—®æˆ‘ä»¬çš„ç½‘ç«™æ—¶æ ¹æ®å…¶IPæ˜¾ç¤ºå…¶æ‰€å±åœ°ï¼Œä¹Ÿä¸ºè·å–ä¸åŒåœ°åŒºè®¿é—®è€…çš„IPåœ°å€ç­‰ç›¸å…³ä¿¡æ¯ä¸ºç›®çš„..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2022/7-3-678.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š9.Nginxå®è·µä¹‹ä½¿ç”¨MaxMindçš„GeoIP2å®ç°å¤„ç†ä¸åŒå›½å®¶æˆ–åŸå¸‚çš„è®¿é—®æœ€ä½³å®è·µæŒ‡å—ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2022/7-3-678.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2022/7-3-678.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJElEQVR42u3aQW7DMAwEwP7/0+kHGnWXcgJYHp8Cw2Y4OTCiqJ+f+HoF17vn1zHbt7YuDAyM2zKS5JLU14m+i5l8jr4dAwPjAYwkiTU+f2sNW0d4ex8DAwNjWQSTODtlGgMDA2NWcNfp5m1qW7IxMDCezEia2HzXqy2mX+3FMTAwbshok/vm54/MNzAwMG7FeJXXbGnYjjzrrDAwMI5mzBrUZLt/FmenYcbAwDiV0Y4h80Y3L9brHyW6g4GBcTQjOQDRhm4PT7Q/TfS/gYGBcSgjby8T2KwZ3hoAYGBgHM2YLddy6s6dnYYZAwPjbEZbRltq+8wFc1oMDIyDGHkTO2to8+dn34uBgfEcRl7sWsCsQiYLSgwMjFMZs620fIu/nTAmxbQYCWBgYBzBaBd5+4dZ25HnsP/GwMA4iNEeIU0Gk3mh3CnBfywNMTAwjmYkVxK0rfR1h51PUDEwMA5izF5uB42zY171MhEDA+Noxk5Rbgtosqy8atiAgYFxEmP2Wt4A7+OjJSkGBsYDGNemNdv6Twp0NI/FwMB4DCNJaBbh2qNjGBgYZzNe5ZUnNzuckRTZfxaFGBgYxzH254M7ZTqPMDucgYGBcRJj57BXO7zMj3+1rTUGBsYTGMUWfFlM26LcjlQxMDAwWtI62ixmsemGgYGBUY4E8gizVvmygouBgXETRtLE7hTT2ZDyI9ttGBgYN2TkreOwvSyTmBVrDAyMQxm/Dirk86wAtoIAAAAASUVORK5CYII=" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>