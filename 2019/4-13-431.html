<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>🌐 Linux安全运维加公配置|WeiyiGeek Blog|唯一极客Geek-IT网络安全运维开发技术知识分享-博客站点</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="安全配置">
    <meta name="Description" content="WeiyiGeek-唯一极客博客站点,关注于网络安全运维,Web安全开发,IOT物联网安全开发,应用开发,分享技术学习知识与入坑解决,提升网络安全技术与自身技术能力,立志维护大众网络安全为己任,做一个对国家有用的人,为实现中华民族伟大复兴的中国梦不懈奋斗">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
        
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-头像">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                首页
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                文章分类
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                文章标签
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                文章归档
              </a>
            </li>
        
            <li class="">
              <a href="/2018/1-1-1.html"  >
                <i class="icon icon-lg icon-mortar-board"></i>
                学习之路
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                学习书籍
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                关于作者
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                站点导航
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                公众账号
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                哔哩哔哩
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>Linux安全运维加公配置</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="文章头部背景">
    <div class="container fade-scale">
        <h1 class="title">Linux安全运维加公配置</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-04-13T06:36:30.000Z" itemprop="datePublished" class="page-time">
  2019-04-13
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Linux/">Linux</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Linux/Security/">Security</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap" style="display: none;">
  <article id="post-网安防御/Linux安全与防御/加固防御/Linux安全加固配置"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">Linux安全运维加公配置</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-04-13 14:36:30" datetime="2019-04-13T06:36:30.000Z"  itemprop="datePublished">2019-04-13</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Linux/">Linux</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Linux/Security/">Security</a></li></ul></li></ul>



            

            


            
        </div>
        <span class="post-href" style="display: none;">|</span>
        <!-- 微信公众号关注/文章版权复制 -->
        
          <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">你好看友,欢迎关注博主微信公众号哟! ❤ <br> 这将是我持续更新文章的动力源泉，谢谢支持！(๑′ᴗ‵๑) </b> <br> 如不想关注请点击右上角的【X】即可关闭继续浏览文章.<br>  <b style="color:red;"> 温馨提示: 未解锁的用户不能粘贴复制文章内容哟!</b> <br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">【My Twitter】</a></strong>. There is an article verification code in the homepage.
<br>方式2.请访问本博主的B站<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">【WeiyiGeek】</a></strong>首页关注UP主,<br>将自动随机获取解锁验证码。
<br>方式3.扫一扫下方二维码，关注本站<strong>官方公众号</strong><br>
回复：<strong style="color: rgb(240, 65, 52);">验证码</strong>
将获取<strong style="color: rgb(240, 65, 52);">解锁(有效期7天)</strong>本站所有技术文章哟!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="请输入验证码|Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">提
    交</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - 为了能到远方，脚下的每一步都不能少</p>
</div>
            
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h4 id="0x00-前言简述"><a href="#0x00-前言简述" class="headerlink" title="0x00 前言简述"></a>0x00 前言简述</h4><p>描述：Linux系统加固往往是下面几个方面入手,配置完成后将大大的提升机器的安全性，同时满足等保合规的要求;</p>
<p>系统加固分类:</p>
<ul>
<li><p>用户加固管理</p>
<ul>
<li>用户权限</li>
<li>口令增强</li>
</ul>
</li>
<li><p>日志加固管理</p>
</li>
</ul>
<ul>
<li>业务隔离</li>
<li>服务安全</li>
</ul>
<hr>
<h4 id="0x01-用户加固管理"><a href="#0x01-用户加固管理" class="headerlink" title="0x01 用户加固管理"></a>0x01 用户加固管理</h4><h5 id="1-用户与权限加固"><a href="#1-用户与权限加固" class="headerlink" title="1.用户与权限加固"></a>1.用户与权限加固</h5><p><strong>1.1) 用户与系统文件权限</strong><br>描述:主要针对于用户默认权限以及文件目录创建的缺省权限;</p>
<p>PS:用户的umask安全配置将umask修改为022权限掩码即用户所获得的<code>文件权限为644 (666-022)，目录权限为755 (777-022)</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用户的umask安全配置</span></span><br><span class="line"><span class="built_in">echo</span> \*\*\*\* 修改<span class="built_in">umask</span>为022  \*\*\*\* </span><br><span class="line">egrep -q <span class="string">"^\s*umask\s+\w+.*$"</span> /etc/profile &amp;&amp; sed -ri <span class="string">"s/^\s*umask\s+\w+.*$/umask 022/"</span> /etc/profile || <span class="built_in">echo</span> <span class="string">"umask 022"</span> &gt;&gt; /etc/profile</span><br><span class="line">egrep -q <span class="string">"^\s*umask\s+\w+.*$"</span> /etc/csh.login &amp;&amp; sed -ri <span class="string">"s/^\s*umask\s+\w+.*$/umask 022/"</span> /etc/csh.login || <span class="built_in">echo</span> <span class="string">"umask 022"</span> &gt;&gt;/etc/csh.login</span><br><span class="line">egrep -q <span class="string">"^\s*umask\s+\w+.*$"</span> /etc/csh.cshrc &amp;&amp; sed -ri <span class="string">"s/^\s*umask\s+\w+.*$/umask 022/"</span> /etc/csh.cshrc || <span class="built_in">echo</span> <span class="string">"umask 022"</span> &gt;&gt; /etc/csh.cshrc</span><br><span class="line">egrep -q <span class="string">"^\s*umask\s+\w+.*$"</span> /etc/bashrc &amp;&amp; sed -ri <span class="string">"s/^\s*umask\s+\w+.*$/umask 022/"</span> /etc/bashrc || <span class="built_in">echo</span> <span class="string">"umask 022"</span> &gt;&gt; /etc/bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户目录缺省访问权限设置</span></span><br><span class="line"><span class="built_in">echo</span> \*\*\*\* 设置用户目录默认权限为022</span><br><span class="line">egrep -q <span class="string">"^\s*(umask|UMASK)\s+\w+.*$"</span> /etc/login.defs &amp;&amp; sed -ri <span class="string">"s/^\s*(umask|UMASK)\s+\w+.*$/UMASK 022/"</span> /etc/login.defs || <span class="built_in">echo</span> <span class="string">"UMASK 022"</span> &gt;&gt; /etc/login.defs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重要目录和文件的权限设置</span></span><br><span class="line"><span class="built_in">echo</span> \*\*\*\* 设置重要目录和文件的权限</span><br><span class="line">chmod 755 /etc; chmod 750 /etc/rc.d/init.d; chmod 777 /tmp; chmod 700 /etc/inetd.conf&amp;&gt;/dev/null 2&amp;&gt;/dev/null; chmod 755 /etc/passwd; chmod 755 /etc/shadow; chmod 644 /etc/group; chmod 755 /etc/security; chmod 644 /etc/services; chmod 750 /etc/rc*.d</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>CentOS禁止普通用户su到root相关权限涉及到两个文件:</p>
<ul>
<li>/etc/pam.d/su</li>
<li>/etc/login.defs<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#禁止普通用户su到root,配置如下：</span></span><br><span class="line"><span class="comment">#去除/etc/pam.d/su文件中如下行的注释，保存退出即可(即时生效)：</span></span><br><span class="line"><span class="comment">#auth           required        pam_wheel.so use_uid</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#禁止普通用户su到root，但是希望指定的普通用户可以su到root</span></span><br><span class="line">在/etc/login.defs文件中加入如下配置项,保持退出(即时生效)：</span><br><span class="line">SU_WHEEL_ONLY yes</span><br><span class="line"></span><br><span class="line"><span class="comment">#将需要su到root用户的用户名添加至wheel组中，我们以admin为例：</span></span><br><span class="line">[root@localhost ~]<span class="comment"># usermod -G wheel admin</span></span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=Linux安全运维加公配置 href="https://img.weiyigeek.top/2019/1/20190814125609.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://img.weiyigeek.top/2019/1/20190814125609.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure>
</li>
</ul>
<p><br></p>
<p><strong>1.2) 用户账号加固</strong><br>描述:锁定与设备运行、维护等工作无关的账号，如果不需要登录系统shell应该<code>/sbin/nologin</code>并且将该账号进行锁定登陆;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 锁定与设备运行、维护等工作无关的账号</span></span><br><span class="line">passwd -l adm&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l daemon&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l bin&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l sys&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l lp&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l uucp&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l nuucp&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l smmsplp&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l mail&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l operator&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l games&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l gopher&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l ftp&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l nobody&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l nobody4&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l noaccess&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l listen&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l webservd&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l rpm&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l dbus&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l avahi&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l mailnull&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l nscd&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l vcsa&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l rpc&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l rpcuser&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l nfs&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l sshd&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l pcap&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l ntp&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l haldaemon&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l distcache&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l webalizer&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l squid&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l xfs&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l gdm&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l sabayon&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l named&amp;&gt;/dev/null 2&amp;&gt;/dev/null</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 核验配置减少系统无用账号降低风险</span></span><br><span class="line">$ nano /etc/passwd  </span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=Linux安全运维加公配置 href="https://img.weiyigeek.top/2019/20190510165410.png" target="_blank" title="WeiyiGeek.passwd" data-fancybox="images"><img src="https://img.weiyigeek.top/2019/20190510165410.png" alt="WeiyiGeek.passwd" title="" class=""></a>
                <p>WeiyiGeek.passwd</p>
            </figure></p>
<p>用户超时限制:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录超时设置</span></span><br><span class="line"><span class="built_in">echo</span> \*\*\*\* 设置登录超时时间为10分钟</span><br><span class="line">egrep -q <span class="string">"^\s*(export|)\s*TMOUT\S\w+.*$"</span> /etc/profile &amp;&amp; sed -ri <span class="string">"s/^\s*(export|)\s*TMOUT.\S\w+.*$/export TMOUT=600/"</span> /etc/profile || <span class="built_in">echo</span> <span class="string">"export TMOUT=600"</span> &gt;&gt; /etc/profile</span><br><span class="line">egrep -q <span class="string">"^\s*.*ClientAliveInterval\s\w+.*$"</span> /etc/ssh/sshd_config &amp;&amp; sed -ri <span class="string">"s/^\s*.*ClientAliveInterval\s\w+.*$/ClientAliveInterval 600/"</span> /etc/ssh/sshd_config || <span class="built_in">echo</span> <span class="string">"ClientAliveInterval 600 "</span> &gt;&gt; /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure></p>
<p>用户访问限制:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#所有 /etc/ssh/user_deny_list 里面的用户被拒绝ssh登录, 启用 PAM-Authentication  </span></span><br><span class="line">vim /etc/pam.d/sshd </span><br><span class="line">auth required /usr/lib64/security/pam_listfile.so item=user sense=deny file=/etc/ssh/user_deny_list onerr=succeed</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="2-用户认证密码策略调整"><a href="#2-用户认证密码策略调整" class="headerlink" title="2.用户认证密码策略调整"></a>2.用户认证密码策略调整</h5><p>描述:设置用户登陆口令的复杂度以及长度限制,以及登录session失效时间;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 小写字母、数字、特殊字、大写字母，登陆尝试三次返回错误信息，可自行修改</span></span><br><span class="line">vi /etc/pam.d/system-auth</span><br><span class="line">password  requisite pam_cracklib.so retry=5 difok=3 minlen=12 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1   <span class="comment">#至少12位包含一位大写字母，一位小写字母和一位数字以及一位特殊字符</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改system-auth</span></span><br><span class="line">egrep -q <span class="string">"^\s*password\s*(requisite|required)\s*pam_cracklib.so.*$"</span> /etc/pam.d/system-auth  &amp;&amp; sed -ri <span class="string">"s/^\s*password\s*(requisite|required)\s*pam_cracklib.so.*$/\password    requisite     pam_cracklib.so try_first_pass retry=3 minlen=12 dcredit=-1 ocredit=-1 lcredit=-1/"</span> /etc/pam.d/system-auth || <span class="built_in">echo</span> <span class="string">"password    requisite     pam_cracklib.so try_first_pass retry=3 minlen=12 dcredit=-1 ocredit=-1 lcredit=-1"</span> &gt;&gt; /etc/pam.d/system-auth</span><br><span class="line"><span class="comment"># 修改password-auth</span></span><br><span class="line">egrep -q <span class="string">"^\s*password\s*(requisite|required)\s*pam_cracklib.so.*$"</span> /etc/pam.d/password-auth &amp;&amp; sed -ri <span class="string">"s/^\s*password\s*(requisite|required)\s*pam_cracklib.so.*$/\password    requisite     pam_cracklib.so try_first_pass retry=3 minlen=12 dcredit=-1 ocredit=-1 lcredit=-1/"</span> /etc/pam.d/password-auth || <span class="built_in">echo</span> <span class="string">"password    requisite     pam_cracklib.so try_first_pass retry=3 minlen=12 dcredit=-1 ocredit=-1 lcredit=-1"</span> &gt;&gt; /etc/pam.d/password-auth</span><br><span class="line"><span class="comment"># 修改login.defs</span></span><br><span class="line">egrep -q <span class="string">"^\s*PASS_MIN_LEN\s+\S*(\s*#.*)?\s*$"</span> /etc/login.defs &amp;&amp; sed -ri <span class="string">"s/^(\s*)PASS_MIN_LEN\s+\S*(\s*#.*)?\s*$/\PASS_MIN_LEN    12/"</span> /etc/login.defs || <span class="built_in">echo</span> <span class="string">"PASS_MIN_LEN    12"</span> &gt;&gt; /etc/login.defs</span><br></pre></td></tr></table></figure><br>口令的生存周期:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方法1:</span></span><br><span class="line">$ vi /etc/login.defs 修改配置文件</span><br><span class="line"><span class="comment">#$ chage -m 0 -M 30 -E 2018-11-01 -W 7 &lt;用户名&gt;   #改变用户的到期时间</span></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------</span></span><br><span class="line">PASS_MAX_DAYS   180        <span class="comment">#新建用户的密码最长使用天数</span></span><br><span class="line">PASS_MIN_DAYS   14          <span class="comment">#新建用户的密码最短使用天数</span></span><br><span class="line">PASS_WARN_AGE   14          <span class="comment">#新建用户的密码到期提前提醒天数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法2:</span></span><br><span class="line"><span class="built_in">echo</span> \*\*\*\* 口令生成周期最小14天最大180天预警14前天 \*\*\*\*</span><br><span class="line">egrep -q <span class="string">"^\s*PASS_MAX_DAYS\s+\S*(\s*#.*)?\s*$"</span> /etc/login.defs &amp;&amp; sed -ri <span class="string">"s/^(\s*)PASS_MAX_DAYS\s+\S*(\s*#.*)?\s*$/\PASS_MAX_DAYS   180/"</span> /etc/login.defs || <span class="built_in">echo</span> <span class="string">"PASS_MAX_DAYS   180"</span> &gt;&gt; /etc/login.defs</span><br><span class="line">egrep -q <span class="string">"^\s*PASS_MIN_DAYS\s+\S*(\s*#.*)?\s*$"</span> /etc/login.defs &amp;&amp; sed -ri <span class="string">"s/^(\s*)PASS_MIN_DAYS\s+\S*(\s*#.*)?\s*$/\PASS_MIN_DAYS   14/"</span> /etc/login.defs || <span class="built_in">echo</span> <span class="string">"PASS_MIN_DAYS   14"</span> &gt;&gt; /etc/login.defs</span><br><span class="line">egrep -q <span class="string">"^\s*PASS_WARN_AGE\s+\S*(\s*#.*)?\s*$"</span> /etc/login.defs &amp;&amp; sed -ri <span class="string">"s/^(\s*)PASS_WARN_AGE\s+\S*(\s*#.*)?\s*$/\PASS_WARN_AGE   14/"</span> /etc/login.defs || <span class="built_in">echo</span> <span class="string">"PASS_WARN_AGE   14"</span> &gt;&gt; /etc/login.defs</span><br></pre></td></tr></table></figure></p>
<p>密码重复使用次数限制:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 手动创建/etc/security/opasswd，解决首次登录修改密码时提示"passwd: Authentication token manipulation error"</span></span><br><span class="line"><span class="built_in">echo</span> \*\*\*\* 记住3次已使用的密码 \*\*\*\*</span><br><span class="line"><span class="keyword">if</span> [[ ! -f <span class="string">"/etc/security/opasswd"</span> || <span class="string">"<span class="variable">$(ls -l /etc/security/opasswd | egrep -c '\-rw\-\-\-\-\-\-\-')</span>"</span> != <span class="string">"1"</span> ]];<span class="keyword">then</span></span><br><span class="line">  mv /etc/security/opasswd /etc/security/opasswd.old &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">  touch /etc/security/opasswd</span><br><span class="line">  chown root:root /etc/security/opasswd</span><br><span class="line">  chmod +600 /etc/security/opasswd</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改system-auth</span></span><br><span class="line">egrep -q <span class="string">"^\s*password\s*sufficient\s*pam_unix.so.*$"</span> /etc/pam.d/system-auth &amp;&amp; sed -ri <span class="string">"s/^\s*password\s*sufficient\s*pam_unix.so.*$/\password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok remember=3/"</span> /etc/pam.d/system-auth || <span class="built_in">echo</span> <span class="string">"password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok remember=3"</span> &gt;&gt; /etc/pam.d/system-auth</span><br><span class="line"><span class="comment"># 修改password-auth</span></span><br><span class="line">egrep -q <span class="string">"^\s*password\s*sufficient\s*pam_unix.so.*$"</span> /etc/pam.d/password-auth &amp;&amp; sed -ri <span class="string">"s/^\s*password\s*sufficient\s*pam_unix.so.*$/\password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok remember=3/"</span> /etc/pam.d/password-auth || <span class="built_in">echo</span> <span class="string">"password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok remember=3"</span> &gt;&gt; /etc/pam.d/password-auth</span><br></pre></td></tr></table></figure></p>
<p>用户认证失败次数限制:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置文件 /etc/pam.d/sshd /etc/pam.d/login /etc/pam.d/system-auth /etc/pam.d/password-auth</span></span><br><span class="line">auth required pam_tally.so onerr=fail deny=10 unlock_time=300      <span class="comment">#设置连续输错10次密码，帐号锁定5分钟，</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> \*\*\*\* 连续登录失败5次锁定帐号5分钟 \*\*\*\*</span><br><span class="line">sed -ri <span class="string">"/^\s*auth\s+required\s+pam_tally2.so\s+.+(\s*#.*)?\s*$/d"</span> /etc/pam.d/sshd /etc/pam.d/login /etc/pam.d/system-auth /etc/pam.d/password-auth</span><br><span class="line">sed -ri <span class="string">'1a auth       required     pam_tally2.so deny=5 unlock_time=300 even_deny_root root_unlock_time=30'</span> /etc/pam.d/sshd /etc/pam.d/login /etc/pam.d/system-auth /etc/pam.d/password-auth</span><br><span class="line">egrep -q <span class="string">"^\s*account\s+required\s+pam_tally2.so\s*(\s*#.*)?\s*$"</span> /etc/pam.d/sshd || sed -ri <span class="string">'/^password\s+.+(\s*#.*)?\s*$/i\account    required     pam_tally2.so'</span> /etc/pam.d/sshd</span><br><span class="line">egrep -q <span class="string">"^\s*account\s+required\s+pam_tally2.so\s*(\s*#.*)?\s*$"</span> /etc/pam.d/login || sed -ri <span class="string">'/^password\s+.+(\s*#.*)?\s*$/i\account    required     pam_tally2.so'</span> /etc/pam.d/login</span><br><span class="line">egrep -q <span class="string">"^\s*account\s+required\s+pam_tally2.so\s*(\s*#.*)?\s*$"</span> /etc/pam.d/system-auth || sed -ri <span class="string">'/^account\s+required\s+pam_permit.so\s*(\s*#.*)?\s*$/a\account     required      pam_tally2.so'</span> /etc/pam.d/system-auth</span><br><span class="line">egrep -q <span class="string">"^\s*account\s+required\s+pam_tally2.so\s*(\s*#.*)?\s*$"</span> /etc/pam.d/password-auth || sed -ri <span class="string">'/^account\s+required\s+pam_permit.so\s*(\s*#.*)?\s*$/a\account     required      pam_tally2.so'</span> /etc/pam.d/password-auth</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="0x02-日志加固管理"><a href="#0x02-日志加固管理" class="headerlink" title="0x02 日志加固管理"></a>0x02 日志加固管理</h4><h5 id="1-日志审计记录"><a href="#1-日志审计记录" class="headerlink" title="1.日志审计记录"></a>1.日志审计记录</h5><p>描述：在反弹shell的时候使用了bash-i时,如果系统配置了/etc/bash.bashrc、~/.bashrc记录执行记录，应该可以记录到bash -i的执行记录（交互式会话会读取bashrc配置并执行）</p>
<p>基础操作:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例1.防止/var/log中的日志被删除</span></span><br><span class="line">chattr -R +a /var/<span class="built_in">log</span></span><br><span class="line">lsattr -a /var/<span class="built_in">log</span></span><br><span class="line">-----a---------- /var/<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例2.记录su命令使用情况</span></span><br><span class="line">egrep -q <span class="string">"^\s*authpriv\.\*\s+.+$"</span> /etc/rsyslog.conf &amp;&amp; sed -ri <span class="string">"s/^\s*authpriv\.\*\s+.+$/authpriv.*                                              \/var\/log\/secure/"</span> /etc/rsyslog.conf || <span class="built_in">echo</span> <span class="string">"authpriv.*                                              /var/log/secure"</span> &gt;&gt; /etc/rsyslog.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#示例3.记录安全事件日志</span></span><br><span class="line"><span class="built_in">echo</span> \*\*\*\* 配置安全事件日志审计</span><br><span class="line">touch /var/<span class="built_in">log</span>/adm&amp;&gt;/dev/null; chmod 755 /var/<span class="built_in">log</span>/adm</span><br><span class="line">semanage fcontext -a -t security_t <span class="string">'/var/log/adm'</span></span><br><span class="line">restorecon -v <span class="string">'/var/log/adm'</span>&amp;&gt;/dev/null</span><br><span class="line">egrep -q <span class="string">"^\s*\*\.err;kern.debug;daemon.notice\s+.+$"</span> /etc/rsyslog.conf &amp;&amp; sed -ri <span class="string">"s/^\s*\*\.err;kern.debug;daemon.notice\s+.+$/*.err;kern.debug;daemon.notice           \/var\/adm\/messages/"</span> /etc/rsyslog.conf || <span class="built_in">echo</span> <span class="string">"*.err;kern.debug;daemon.notice           /var/log/adm"</span> &gt;&gt; /etc/rsyslog.conf</span><br></pre></td></tr></table></figure></p>
<p>历史命令设置:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Centos7 /etc/profile</span></span><br><span class="line"><span class="comment">#比如登陆过系统的用户、IP地址、操作命令以及操作时间--对应可以通过在/etc/profile里面加入以下代码实现</span></span><br><span class="line"><span class="comment">#47:HISTTIMEFORMAT="%F %T who -u am i 2&gt;/dev/null| awk '&#123;print $NF&#125;'|sed -e 's/[()]//g' whoami"</span></span><br><span class="line"><span class="comment">#400  2019-08-02 16:57:46 192.168.1.88 root # history</span></span><br><span class="line"><span class="built_in">echo</span> \*\*\*\* 设置保留历史命令的条数为30并加上时间戳</span><br><span class="line">egrep -q <span class="string">"^\s*HISTSIZE\s*\W+[0-9].+$"</span> /etc/profile &amp;&amp; sed -ri <span class="string">"s/^\s*HISTSIZE\W+[0-9].+$/HISTSIZE=30/"</span> /etc/profile || <span class="built_in">echo</span> <span class="string">"HISTSIZE=30"</span> &gt;&gt; /etc/profile</span><br><span class="line">egrep -q <span class="string">"^\s*HISTTIMEFORMAT\s*\S+.+$"</span> /etc/profile &amp;&amp; sed -ri <span class="string">"s/^\s*HISTTIMEFORMAT\s*\S+.+$/HISTTIMEFORMAT='%F %T | '/"</span> /etc/profile || <span class="built_in">echo</span> <span class="string">"HISTTIMEFORMAT='%F %T | '"</span> &gt;&gt; /etc/profile</span><br><span class="line">egrep -q <span class="string">"^\s*export\s*HISTTIMEFORMAT.*$"</span> /etc/profile || <span class="built_in">echo</span> <span class="string">"export HISTTIMEFORMAT"</span> &gt;&gt; /etc/profile</span><br></pre></td></tr></table></figure></p>
<p>其他日志审计记录：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Centos7 Shell登陆记录</span></span><br><span class="line"><span class="comment"># vim /etc/profile</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$(date)</span> - <span class="variable">$&#123;SSH_CONNECTION&#125;</span> - <span class="variable">$&#123;USER&#125;</span>"</span> &gt;&gt; /tmp/login.txt</span><br><span class="line"><span class="comment"># 测试bash -i反弹shell</span></span><br><span class="line">ssh -T root@10.10.107.222 /bin/bash -i</span><br><span class="line">Fri Aug  2 16:54:48 CST 2019 - 192.168.1.88 55321 10.10.107.222 22 - root</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="0x03-系统加固"><a href="#0x03-系统加固" class="headerlink" title="0x03 系统加固"></a>0x03 系统加固</h4><h5 id="1-系统文件配置相关"><a href="#1-系统文件配置相关" class="headerlink" title="1.系统文件配置相关"></a>1.系统文件配置相关</h5><p>删除潜在威胁文件:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find / -maxdepth 3 -name hosts.equiv | xargs rm -rf</span><br><span class="line">find / -maxdepth 3 -name .netrc | xargs rm -rf</span><br><span class="line">find / -maxdepth 3 -name .rhosts | xargs rm -rf</span><br></pre></td></tr></table></figure></p>
<p>禁用ctrl+alt+del组合键:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 禁用ctrl+alt+del组合键，Redhat 6.X：</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> \*\*\*\* 禁用ctrl+alt+del组合键</span><br><span class="line">egrep -q <span class="string">"^\s*exec\s+/sbin/shutdown\s+.+$"</span> /etc/init/control-alt-delete.conf &amp;&amp; sed -ri <span class="string">"s/^\s*exec\s+\/sbin\/shutdown\s+.+$/exec \/usr\/bin\/logger \-p authpriv.notice \-t init 'Ctrl-Alt-Del was pressed and ignored'/"</span> /etc/init/control-alt-delete.conf || <span class="built_in">echo</span> <span class="string">"exec /usr/bin/logger -p authpriv.notice -t init 'Ctrl-Alt-Del was pressed and ignored' "</span> &gt;&gt; /etc/init/control-alt-delete.conf</span><br><span class="line"><span class="comment"># 禁用ctrl+alt+del组合键，Redhat 7.X：</span></span><br><span class="line">mv /usr/lib/systemd/system/ctrl-alt-del.target /usr/lib/systemd/system/ctrl-alt-del.target.bat&amp;&gt;/dev/null 2&amp;&gt;/dev/null</span><br></pre></td></tr></table></figure></p>
<p>配置自动屏幕锁定（适用于具备图形界面的设备）:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> \*\*\*\* 对于有图形界面的系统配置10分钟屏幕锁定</span><br><span class="line">gconftool-2 &gt; /dev/null 2&gt;&amp;1</span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">"$?"</span> == 0 ]];<span class="keyword">then</span></span><br><span class="line">  gconftool-2 --direct \</span><br><span class="line">  --config-source xml:readwrite:/etc/gconf/gconf.xml.mandatory \</span><br><span class="line">  --<span class="built_in">type</span> bool \</span><br><span class="line">  --<span class="built_in">set</span> /apps/gnome-screensaver/idle_activation_enabled <span class="literal">true</span> \</span><br><span class="line">  --<span class="built_in">set</span> /apps/gnome-screensaver/lock_enabled <span class="literal">true</span> \</span><br><span class="line">  --<span class="built_in">type</span> int \</span><br><span class="line">  --<span class="built_in">set</span> /apps/gnome-screensaver/idle_delay 10 \</span><br><span class="line">  --<span class="built_in">type</span> string \</span><br><span class="line">  --<span class="built_in">set</span> /apps/gnome-screensaver/mode blank-only</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="2-系统服务"><a href="#2-系统服务" class="headerlink" title="2.系统服务"></a>2.系统服务</h5><p>限制不必要的服务:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">disable</span> rsh&amp;&gt;/dev/null 2&amp;&gt;/dev/null;systemctl <span class="built_in">disable</span> talk&amp;&gt;/dev/null 2&amp;&gt;/dev/null;systemctl <span class="built_in">disable</span> telnet&amp;&gt;/dev/null 2&amp;&gt;/dev/null;systemctl <span class="built_in">disable</span> tftp&amp;&gt;/dev/null 2&amp;&gt;/dev/null;systemctl <span class="built_in">disable</span> rsync&amp;&gt;/dev/null 2&amp;&gt;/dev/null;systemctl <span class="built_in">disable</span> xinetd&amp;&gt;/dev/null 2&amp;&gt;/dev/null;systemctl <span class="built_in">disable</span> nfs&amp;&gt;/dev/null 2&amp;&gt;/dev/null;systemctl <span class="built_in">disable</span> nfslock&amp;&gt;/dev/null 2&amp;&gt;/dev/null</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="0x04-服务应用加固"><a href="#0x04-服务应用加固" class="headerlink" title="0x04 服务应用加固"></a>0x04 服务应用加固</h4><h5 id="1-Ssh服务相关"><a href="#1-Ssh服务相关" class="headerlink" title="1.Ssh服务相关"></a>1.Ssh服务相关</h5><p>描述:openssh 目前的默认配置文件相比以前虽然要安全的多，但还是有必要对生产系统中的 ssh 服务器进行基线检查。<br><em>等保视角下的SSH 加固之旅：</em></p>
<ul>
<li><p>1）身份鉴别:</p>
<ul>
<li>首推公钥认证方式,通过ansible批量更新或者通过堡垒机的定时任务实现对管理的服务器上的公钥进行批量更新</li>
<li>严禁选择基于密码的、基于主机的认证方式，有条件的可以接入 Kerberos 认证;</li>
<li>基于权限最小化原则，限制不同用户使用不同角色的账户</li>
<li>选择安全的ssh-key生成算法生成的key<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ssh key 常见算法及安全性</span><br><span class="line">DSA 已被证明不安全，且从OpenSSH Server 7 之后便不再支持</span><br><span class="line">RSA RSA算法产生的私钥的安全性依赖于密钥的长度，如果密钥的长度小于3072，则不够安全，比如常见的2048 位的ssh key 是不够安全的，1024位直接被标记为不安全</span><br><span class="line">ECDSA：这个算法产生的密钥安全性依赖于当前机器产生的随机数的强度</span><br><span class="line">Ed25519： 目前最为推荐的ssh key 生成算法，安全性最好！</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>2）访问控制</p>
<ul>
<li>网络层的访问控制：禁止端口转发</li>
<li>限制指定的IP才能连接：除了在防火墙上做规则限制，还可以通过TCP Wrapper 和sshd_config的配置命令</li>
</ul>
</li>
<li><p>3）审计</p>
<ul>
<li>实现等保的审计要求：选择加入堡垒机或者将ssh 登录日志、bash 操作日志集中转发之SOC或者内部日志平台（比如通过syslog方式）</li>
</ul>
</li>
<li><p>4）入侵防范</p>
<ul>
<li>及时更新openssh server及其依赖的openssl库的补丁</li>
<li>建议关注：openssh 官方安全通告：<a href="https://www.openbsd.org/security.html" target="_blank" rel="noopener">https://www.openbsd.org/security.html</a></li>
</ul>
</li>
</ul>
<p>文件说明：/root/.ssh/known_hosts 保存相关服务器的签名</p>
<p>(1)SSH 配置文件：/etc/ssh/ssh_config<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Port 2222</span><br><span class="line">Protocol 2                  <span class="comment">#使用ssh 协议2</span></span><br><span class="line">PermitRootLogin no           <span class="comment">#禁止Root登录</span></span><br><span class="line">PermitEmptyPasswords no      <span class="comment">#禁止空密码登录</span></span><br><span class="line"></span><br><span class="line">StrictModes yes            <span class="comment"># 当使用者的 host key 改变之后，Server 就不接受联机，可以抵挡部分的木马程序！</span></span><br><span class="line">MaxAuthTries 5              <span class="comment">#认证尝试次数</span></span><br><span class="line">MaxSessions 6               <span class="comment">#最大会话数</span></span><br><span class="line">IgnoreRhosts yes            <span class="comment">#关闭禁用用户的 .rhosts 文件  ~/.ssh/.rhosts 来做为认证 </span></span><br><span class="line">LoginGraceTime 120         <span class="comment">#无动作断线时间（seconds）</span></span><br><span class="line">HashKnownHosts yes          <span class="comment">#把主机名hash记录</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置 Idle Log Out Timeout 间隔</span></span><br><span class="line">ClientAliveInterval 300</span><br><span class="line">ClientAliveCountMax 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#禁止或者允许某个用户通过ssh登录</span></span><br><span class="line">AllowUsers 用户名</span><br><span class="line">AllowGroups 组名</span><br><span class="line">DenyUsers 用户名  </span><br><span class="line">DenyGroups 组名</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭密码认证，启用公钥认证：</span></span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line">PasswordAuthentication no   <span class="comment">#不建议使用密码认证 建议设置为no</span></span><br><span class="line">HostbasedAuthentication no  <span class="comment">#不建议使用机认证  建议设置为no</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#禁止端口转发</span></span><br><span class="line">AllowAgentForwarding no </span><br><span class="line">AllowTcpForwarding no <span class="comment">#通过禁止TCP端口转发，可以禁止SSH 远程端口和本地端口转发功能，也可以禁止SSH 远程隧道的建立</span></span><br><span class="line">X11Forwarding no   <span class="comment">#如果没用 X11 转发的情况</span></span><br></pre></td></tr></table></figure></p>
<p><br><br>(2) 限制IP登录SSH<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#只允许某个IP登录，拒绝其他所有IP：</span></span><br><span class="line">在 /etc/hosts.allow 写 : sshd: 1.2.3.4</span><br><span class="line">在 /etc/hosts.deny 写 :  sshd: ALL</span><br><span class="line"></span><br><span class="line"><span class="comment">#防火墙配置</span></span><br><span class="line">iptables -A INPUT -s 1.2.3.4 -p tcp --dport 22 -j ACCEPT</span><br><span class="line">iptables -A INPUT -s 堡垒机IP -p tcp --dport 22 -j ACCEPT <span class="comment">#限制只允许堡垒机的IP连接</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 22 -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">#其他加固脚本描述：防止ssh被恶意ip爆破，进行设置Hosts.deny加入恶意的IP地址进行阻断。</span></span><br><span class="line"><span class="comment">#==========开始复制==========</span></span><br><span class="line">ldd `<span class="built_in">which</span> sshd` | grep libwrap <span class="comment"># 确认sshd是否支持TCP Wrapper，输出类似:libwrap.so.0 =&gt; /lib/libwrap.so.0 (0x00bd1000)</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/bin/</span><br><span class="line">wget antivirus.neu.edu.cn/ssh/soft/fetch_neusshbl.sh</span><br><span class="line">chmod +x fetch_neusshbl.sh</span><br><span class="line"><span class="built_in">cd</span> /etc/cron.hourly/</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/bin/fetch_neusshbl.sh .</span><br><span class="line">./fetch_neusshbl.sh</span><br><span class="line"><span class="comment">#=========结束复制==========</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>(3) 限制指定账户不能SSH只能SFTP在指定目录<br>比如以限制sftpgroup 组的用户都只能在自己的家目录sftp 上传下载，不能ssh连接获取shell为例<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.新建一个sftpgroup，以组为单位进行限制</span></span><br><span class="line">groupadd sftpgroup</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.新建一个账户sftpuser，加入sftpgroup</span></span><br><span class="line">useradd -d /home/sftpuser -s /usr/sbin/nologin -M -N -gsftpgroup sftpuser  <span class="comment">#使其无法获取交互式shell,不创建用户的主目录,不创建同名的组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3.配置账号账户以公钥方式认证</span></span><br><span class="line">mkdir -p /home/sftpuser/.ssh</span><br><span class="line">cat xxx.pub &gt;/home/sftpuser/.ssh/authorized_keys</span><br><span class="line">chmod -R 700 /home/sftpuser/.ssh/</span><br><span class="line">chown -R sftpuser:sftpgroup /home/sftpuser/.ssh</span><br><span class="line"></span><br><span class="line"><span class="comment">#4. 配置sshd_config</span></span><br><span class="line">Subsystem sftp internal-sftp</span><br><span class="line">Match group sftpgroup  <span class="comment">#Match指令主要用于条件匹配</span></span><br><span class="line">ChrootDirectory %h     <span class="comment">#限制sftp的活动目录在其Home 目录</span></span><br><span class="line">X11Forwarding no       <span class="comment">#禁止X11转发</span></span><br><span class="line">AllowTcpForwarding no  <span class="comment">#禁止tcp转发</span></span><br><span class="line">ForceCommand internal-sftp  <span class="comment">#如果去掉ssh连接时候提示/usr/bin/nologin no such file or directory</span></span><br></pre></td></tr></table></figure></p>
<p><em>Subsystem sftp /usr/lib/openssh/sftp-server 更为 internal-sftp，这两者有什么区别呢？</em></p>
<ul>
<li>简单的说默认sftp进程由单独的二进制文件：/usr/lib/openssh/sftp-server启动（外部）</li>
<li>internal-sftp 则无需外部二进制文件额外启动一个进程整合在sshd进程内了（内部）</li>
<li>internal-sftp相较于 /usr/lib/openssh/sftp-server 优点在于：<ul>
<li>性能好无需额外进程了</li>
<li>安全性好无需用户登录shell，且可使用ChrootDirectory 限制sftp行为活动的目录；</li>
<li>sftp-server 的存在主要是向后兼容。</li>
</ul>
</li>
</ul>
<p><em>ForceCommand internal-sftp 是什么意思？</em><br>答:防止用户执行他们自己自定义的命令限制用户命令执行上下文为sftp（可以理解为用户的’shell’就是sftp 那个上下文环境）, 即用户除了能执行sftp中允许的命令外，其他命令啥也执行不了<br>PS:采用sftp软件登录：<code>sftp -i 密匙path sftpuser@ip</code> 则进入交换式;</p>
<p>ssh服务应用加固:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SSH登录前警告Banner</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> \*\*\*\* 设置ssh登录前警告Banner</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"**************WARNING**************"</span> &gt;&gt; /etc/issue;<span class="built_in">echo</span> <span class="string">"Authorized only. All activity will be monitored and reported."</span> &gt;&gt; /etc/issue</span><br><span class="line">egrep -q <span class="string">"^\s*(banner|Banner)\s+\W+.*$"</span> /etc/ssh/sshd_config &amp;&amp; sed -ri <span class="string">"s/^\s*(banner|Banner)\s+\W+.*$/Banner \/etc\/issue/"</span> /etc/ssh/sshd_config || <span class="built_in">echo</span> <span class="string">"Banner /etc/issue"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line"><span class="comment"># SSH登录后Banner</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> \*\*\*\* 设置ssh登录后Banner</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"**************WARNING**************"</span> &gt;&gt; /etc/motd;<span class="built_in">echo</span> <span class="string">"Login success. All activity will be monitored and reported."</span> &gt;&gt; /etc/motd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁止root远程登录（暂不配置）</span></span><br><span class="line">:&lt;&lt;!</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> \*\*\*\* 禁止root远程SSH登录</span><br><span class="line">egrep -q <span class="string">"^\s*PermitRootLogin\s+.+$"</span> /etc/ssh/sshd_config &amp;&amp; sed -ri <span class="string">"s/^\s*PermitRootLogin\s+.+$/PermitRootLogin no/"</span> /etc/ssh/sshd_config || <span class="built_in">echo</span> <span class="string">"PermitRootLogin no"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line">!</span><br><span class="line"><span class="comment"># SSH 安全配置</span></span><br><span class="line"><span class="comment"># 严格模式</span></span><br><span class="line">egrep -q <span class="string">"^\s*StrictModes\s+.+$"</span> /etc/ssh/sshd_config &amp;&amp; sed -ri <span class="string">"s/^(#)?\s*StrictModes\s+.+$/StrictModes yes/"</span> /etc/ssh/sshd_config || <span class="built_in">echo</span> <span class="string">"StrictModes yes"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line"><span class="comment"># 缺省端口改变成为62222，重启服务需要 setenforce 0 临时关闭Selinux</span></span><br><span class="line">egrep -q <span class="string">"^\s*Port\s+.+$"</span> /etc/ssh/sshd_config &amp;&amp; sed -ri <span class="string">"s/^(#)?\s*Port\s+.+$/Port 62222/"</span> /etc/ssh/sshd_config || <span class="built_in">echo</span> <span class="string">"Port 62222"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line"><span class="comment"># 禁用端口转发</span></span><br><span class="line">egrep -q <span class="string">"^\s*X11Forwarding\s+.+$"</span> /etc/ssh/sshd_config &amp;&amp; sed -ri <span class="string">"s/^(#)?\s*X11Forwarding\s+.+$/X11Forwarding no/"</span> /etc/ssh/sshd_config || <span class="built_in">echo</span> <span class="string">"X11Forwarding no"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line">egrep -q <span class="string">"^\s*AllowTcpForwarding\s+.+$"</span> /etc/ssh/sshd_config &amp;&amp; sed -ri <span class="string">"s/^(#)?\s*AllowTcpForwarding\s+.+$/AllowTcpForwarding no/"</span> /etc/ssh/sshd_config || <span class="built_in">echo</span> <span class="string">"AllowTcpForwarding no"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line">egrep -q <span class="string">"^\s*AllowAgentForwarding\s+.+$"</span> /etc/ssh/sshd_config &amp;&amp; sed -ri <span class="string">"s/^(#)?\s*AllowAgentForwarding\s+.+$/AllowAgentForwarding no/"</span> /etc/ssh/sshd_config || <span class="built_in">echo</span> <span class="string">"AllowAgentForwarding no"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line"><span class="comment"># CentOS7 (缺省IgnoreRhosts yes) 关闭禁用用户的 .rhosts 文件  ~/.ssh/.rhosts 来做为认证</span></span><br><span class="line"><span class="comment"># egrep -q "^(#)?\s*IgnoreRhosts\s+.+$" /etc/ssh/sshd_config &amp;&amp; sed -ri "s/^(#)?\s*IgnoreRhosts\s+.+$/IgnoreRhosts yes/" /etc/ssh/sshd_config || echo "IgnoreRhosts yes" &gt;&gt; /etc/ssh/sshd_config</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="2-Ftp服务相关"><a href="#2-Ftp服务相关" class="headerlink" title="2.Ftp服务相关"></a>2.Ftp服务相关</h5><p>FTP Banner 设置:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> \*\*\*\* FTP Banner 设置</span><br><span class="line">systemctl list-unit-files|grep vsftpd &gt; /dev/null &amp;&amp; sed -ri <span class="string">"/^\s*ftpd_banner\s*\W+.+$/s/^/#/"</span> /etc/vsftpd/vsftpd.conf &amp;&amp; <span class="built_in">echo</span> <span class="string">"ftpd_banner='Authorized only. All activity will be monitored and reported.'"</span> &gt;&gt; /etc/vsftpd/vsftpd.conf</span><br></pre></td></tr></table></figure></p>
<p>禁止匿名用户登录FTP<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> \*\*\*\* 禁止匿名用户登录FTP</span><br><span class="line">systemctl list-unit-files|grep vsftpd &gt; /dev/null &amp;&amp; sed -ri <span class="string">"/^\s*anonymous_enable\s*\W+.+$/s/^/#/"</span> /etc/vsftpd/vsftpd.conf &amp;&amp; <span class="built_in">echo</span> <span class="string">"anonymous_enable=NO"</span> &gt;&gt; /etc/vsftpd/vsftpd.conf</span><br></pre></td></tr></table></figure></p>
<p>禁止root用户登录FTP<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> \*\*\*\* 禁止root用户登录FTP</span><br><span class="line">systemctl list-unit-files|grep vsftpd &gt; /dev/null &amp;&amp; <span class="built_in">echo</span> <span class="string">"root"</span> &gt;&gt; /etc/vsftpd/ftpusers</span><br></pre></td></tr></table></figure></p>
<p>限制FTP用户上传的文件所具有的权限<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> \*\*\*\* 限制FTP用户上传的文件所具有的权限</span><br><span class="line">systemctl list-unit-files|grep vsftpd &gt; /dev/null &amp;&amp; sed -ri <span class="string">"/^\s*write_enable\s*\W+.+$/s/^/#/"</span> /etc/vsftpd/vsftpd.conf &amp;&amp; <span class="built_in">echo</span> <span class="string">"write_enable=NO"</span> &gt;&gt; /etc/vsftpd/vsftpd.conf</span><br><span class="line">systemctl list-unit-files|grep vsftpd &gt; /dev/null &amp;&amp; sed -ri <span class="string">"/^\s*ls_recurse_enable\s*\W+.+$/s/^/#/"</span> /etc/vsftpd/vsftpd.conf &amp;&amp; <span class="built_in">echo</span> <span class="string">"ls_recurse_enable=NO"</span> &gt;&gt; /etc/vsftpd/vsftpd.conf</span><br><span class="line">systemctl list-unit-files|grep vsftpd &gt; /dev/null &amp;&amp; sed -ri <span class="string">"/^\s*anon_umask\s*\W+.+$/s/^/#/"</span> /etc/vsftpd/vsftpd.conf &amp;&amp; <span class="built_in">echo</span> <span class="string">"anon_umask=077"</span> &gt;&gt; /etc/vsftpd/vsftpd.conf</span><br><span class="line">systemctl list-unit-files|grep vsftpd &gt; /dev/null &amp;&amp; sed -ri <span class="string">"/^\s*local_umask\s*\W+.+$/s/^/#/"</span> /etc/vsftpd/vsftpd.conf &amp;&amp; <span class="built_in">echo</span> <span class="string">"local_umask=022"</span> &gt;&gt; /etc/vsftpd/vsftpd.conf</span><br></pre></td></tr></table></figure></p>
<p>限制FTP用户登录后能访问的目录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> \*\*\*\* 限制FTP用户登录后能访问的目录</span><br><span class="line">systemctl list-unit-files|grep vsftpd &gt; /dev/null &amp;&amp; sed -ri <span class="string">"/^\s*chroot_local_user\s*\W+.+$/s/^/#/"</span> /etc/vsftpd/vsftpd.conf &amp;&amp; <span class="built_in">echo</span> <span class="string">"chroot_local_user=NO"</span> &gt;&gt; /etc/vsftpd/vsftpd.conf</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="3-Telnet服务相关"><a href="#3-Telnet服务相关" class="headerlink" title="3.Telnet服务相关"></a>3.Telnet服务相关</h5><p>配置禁用telnet服务<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">egrep -q <span class="string">"^\s*telnet\s+\d*.+$"</span> /etc/services &amp;&amp; sed -ri <span class="string">"/^\s*telnet\s+\d*.+$/s/^/# /"</span> /etc/services</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="4-Snmp服务相关"><a href="#4-Snmp服务相关" class="headerlink" title="4.Snmp服务相关"></a>4.Snmp服务相关</h5><p>修改SNMP默认团体字:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> \*\*\*\* 修改SNMP默认团体字</span><br><span class="line">cat &gt; /etc/snmp/snmpd.conf &lt;&lt;EOF</span><br><span class="line">com2sec name  default    <span class="variable">$password</span>   </span><br><span class="line">group   ****Grp         v1           ****Sec</span><br><span class="line">group   ****Grp         v2c          ****Sec</span><br><span class="line">view    systemview      included        .1                      80</span><br><span class="line">view    systemview      included        .1.3.6.1.2.1.1</span><br><span class="line">view    systemview      included        .1.3.6.1.2.1.25.1.1</span><br><span class="line">view    ****View        included        .1.3.6.1.4.1.2021.80</span><br><span class="line">access  ****Grp         <span class="string">""</span>      any       noauth    exact  systemview none none</span><br><span class="line">access  ****Grp         <span class="string">""</span>      any       noauth    exact  ****View   none none</span><br><span class="line">dontLogTCPWrappersConnects yes</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#exec mq_ttt /home/107_mq.sh</span></span><br><span class="line"><span class="comment">#exec core_timebargain_ttt /home/105_core_timebargain.sh</span></span><br><span class="line"><span class="comment">#exec core_espot_ttt /home/101_core_espot.sh</span></span><br><span class="line"><span class="comment">#exec core_conditionPlugin_ttt /home/103_core_conditionPlugin.sh</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">trapcommunity <span class="variable">$password</span></span><br><span class="line">authtrapenable 1</span><br><span class="line">trap2sink IP</span><br><span class="line">agentSecName ****Sec</span><br><span class="line">rouser ****Sec</span><br><span class="line">defaultMonitors yes</span><br><span class="line">linkUpDownNotifications yes</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></p>
<p>二、Centos7检查的项目如下：<br>0x01 初始设置</p>
<p>1.1 文件系统配置：</p>
<p>将/tmp挂载至一个单独的分区</p>
<p>挂载时指定noexec,nosuid：不允许运行可执行文件</p>
<p>1.2 安全启动设置：</p>
<p>设置bootloader的配置文件的权限为600</p>
<p>设置bootloader的密码：进入引导界面需输入密码</p>
<p>为单用户启动认证机制</p>
<p>1.3 强制访问控制：</p>
<p>安装SELinux</p>
<p>设置SELinux的状态为enforcing</p>
<p>设置SELinux的policy为targeted<br>0x02 服务配置</p>
<p>2.1 时间同步设置：</p>
<p>开启时间同步服务</p>
<p>使用ntp或chrony来统一服务器的时间</p>
<p>不安装X-windows系统：即不使用可视化界面<br>0x03 网络配置</p>
<p>3.1 hosts设置：</p>
<p>配置/etc/hosts.allow与/etc/hosts.deny文件</p>
<p>配置/etc/hosts.allow与/etc/hosts.deny文件的权限为0644</p>
<p>配置/etc/hosts.allow与/etc/hosts.deny文件的属主为root</p>
<p>3.2 防火墙配置</p>
<p>安装iptables</p>
<p>设置各个Chain的默认策略为drop<br>0x04 审计设置</p>
<p>安装并使用auditd</p>
<p>配置记录审计日志的文件大小：8M</p>
<p>配置记录审计日志的文件个数：5</p>
<p>单个审计日志文件大小达到设定的值时触发的动作为：keep_logs/rotate</p>
<p>磁盘空间满后触发的动作为：rotate</p>
<p>auditd需配置的一些规则：</p>
<p> 规则：审计更改日期和时间的操作<br> 规则：审计更改用户/组信息的操作<br> 规则：审计更改系统网络环境的操作<br> 规则：审计更改系统强制访问控制的操作<br> 规则：审计登入登出系统的事件<br> 规则：审计企图改变文件权限的操作<br> 规则：审计未授权情况下企图访问文件未成功的事件<br> 规则：审计使用提权命令的操作<br> 规则：审计删除文件的操作？？？？<br> 规则：审计sudoers文件的变更<br> 规则：审计sudoers日志文件的变更？？？？<br> 规则：审计日志文件audit.log不能被改变</p>
<p>0x05 日志设置</p>
<p>安装并启用`rsyslog｀<br>0x06 认证授权</p>
<p>6.1 配置cron:</p>
<p>开启cron服务</p>
<p>配置 /etc/crontab,/etc/cron.hourly,/etc/cron.daily,/etc/cron.weekly,/etc/cron.monthly,//etc/cron.d文件的权限为0700</p>
<p>设置cron.allow：只允许特定的用户可以使用cron</p>
<p>6.2 配置SSH：</p>
<p>配置/etc/ssh/sshd_config文件的权限为0600</p>
<p>关闭X11Forwarding</p>
<p>设置最大认证尝试次数：4</p>
<p>开启IgnoreRhosts：不启用基于主机的认证</p>
<p>关闭HostbasedAuthentication: 关闭基于主机的认证</p>
<p>禁止使用root直接登录：PermitRootLogin no</p>
<p>禁止使用空密码登录：PermitEmptyPasswords no</p>
<p>禁止用户环境：PermitUserEnvironment no</p>
<p>设置使用的MAC算法:</p>
<p> <a href="mailto:hmac-sha2-512-etm@openssh.com">hmac-sha2-512-etm@openssh.com</a>,<a href="mailto:hmac-sha2-256-etm@openssh.com">hmac-sha2-256-etm@openssh.com</a>,<a href="mailto:umac-128etm@openssh.com">umac-128etm@openssh.com</a>,hmac-sha2-512,hmac-sha2-256,<a href="mailto:umac-128@openssh.com">umac-128@openssh.com</a>,<a href="mailto:curve25519sha256@libssh.org">curve25519sha256@libssh.org</a>,diffie-hellman-group-exchange-sha256 </p>
<p>设置空闲超时时间:180秒ClientAliveInterval 180</p>
<p>设置一次登录花费时间：120秒LoginGraceTime 120</p>
<p>6.3 配置PAM：</p>
<p>密码长度最少位数：12</p>
<p>密码中最少字符类型数：3</p>
<p>配置密码锁定：？？？？</p>
<p>配置密码重用限制：不使用最近5次的密码</p>
<p>配置密码hash算法：SHA512</p>
<p>6.5 用户账户和环境设置：</p>
<p>密码有效时间：90天</p>
<p>密码更改最短间隔：7天</p>
<p>密码过期警告：7天</p>
<p>自动禁用特定时间内没有活动的账号：365天</p>
<p>配置系统账号的无法登录</p>
<p>配置root账号默认群组的GID为0</p>
<p>配置umask的默认值为027？？？</p>
<p>配置shell超时关闭会话时间：180</p>
<p>配置可以使用su命令的用户<br>0x07 系统维护</p>
<p>7.1 重要文件权限：</p>
<p> /etc/passwd 0644 uid 0 gid 0<br> /etc/shadow 0000 uid 0 gid 0<br> /etc/group 0644 uid 0 gid 0<br> /etc/gshadow 0000 uid 0 gid 0<br> /etc/passwd- 0644 uid 0 gid 0<br> /etc/shadow- 0000 uid 0 gid 0<br> /etc/group- 0644 uid 0 gid 0<br> /etc/gshadow- 0000 uid 0 gid 0</p>
<pre><code>审计设置了SUID可执行文件的完整性 前面

审计设置了SGID的可执行文件的完整性
</code></pre><p>7.2 用户和组设置：</p>
<p>不允许密码为空的账号</p>
<p>只允许root账号的UID为0</p>
<p>设置path环境变量中的目录只有owner可写，group及other都没有w的权限</p>
<p>设置所有用户都有家目录</p>
<p>设置所有用户家目录的权限为0750</p>
<p>设置所有用户家目录的owner都为其自身</p>
<p>设置用户家目录内以.开头的文件，只有owner可写，group及other都没有w的权限</p>
<p>确保没有.netrc,.rhosts,.forward文件</p>
<p>确保所有在/etc/passwd中的组都在/etc/group</p>
<p>确保每个用户的UID都不同</p>
<p>确保每个组的GID都不同</p>
<p>确保用户名唯一</p>
<p>确保组名唯一</p>
<p>*本文作者：jerrybird，转载请注明来自FreeBuf.COM</p>

        </div>
        
        <!-- Google 广告 -->
          

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> 欢迎各位志同道合的朋友一起学习交流，如文章有误请在下方留下您宝贵的经验知识，个人邮箱地址<b style="color:#ff654e"><code>【master#weiyigeek.top】</code></b>或者个人公众号<b style="color:#ff654e"><code>【WeiyiGeek】</code></b>联系我。 </p>
  <p> 更多文章来源于<b style="color:#03a9f4">【WeiyiGeek Blog - 为了能到远方，脚下的每一步都不能少】</b>, 个人首页地址( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"【点个赞】，动动你那粗壮的拇指或者芊芊玉手，亲！"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"【投个币】，万水千山总是情，投个硬币行不行，亲！")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("【收个藏】，阅后即焚不吃灰，亲！")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("【转个发】，让更多的志同道合的朋友一起学习交流，亲！")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("【关个注】，后续浏览查看不迷路哟，亲！")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="扫描Follow(关注)WeiyiGeek公众号与Visit(浏览)极客全栈修炼小程序" >
    <p>专栏书写不易，如果您觉得这个专栏还不错的，请给这篇专栏 <b style="color: red;">【点个赞、投个币、收个藏、关个注、转个发、赞个助】</b>，这将对我的肯定，我将持续整理发布更多优质原创文章！。</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    最后更新时间：<time datetime="2023-01-31T02:29:10.670Z" itemprop="dateUpdated">2023-01-31 10:29:10</time>
</span><br>


        <span>文章原始路径：<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/网安防御/Linux安全与防御/加固防御/Linux安全加固配置.md" target="_blank" rel="noopener noreferrer">_posts/网安防御/Linux安全与防御/加固防御/Linux安全加固配置.md</a></span><br>
         <span class="copy-copyright">转载注明出处，原文地址：<a href="/2019/4-13-431.html" target="_blank" rel="external">https://blog.weiyigeek.top/2019/4-13-431.html</a></span><br>本站文章内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">☕️ 请作者喝杯咖啡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE/" rel="tag">安全配置</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/4-13-431.html&title=《Linux安全运维加公配置》 — WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/4-13-431.html&title=《Linux安全运维加公配置》 — WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/4-13-431.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Linux安全运维加公配置》 — WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/4-13-431.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/4-13-431.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- 评论组件 -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/4-13-450.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">国内网络安全厂商清单</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/4-13-452.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">网络安全设备分类清单</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x00-前言简述"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 前言简述</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x01-用户加固管理"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 用户加固管理</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x02-日志加固管理"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 日志加固管理</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x03-系统加固"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 系统加固</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x04-服务应用加固"><span class="post-toc-number">5.</span> <span class="post-toc-text">0x04 服务应用加固</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    

    <!-- 支付宝微信文章赞赏 -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        如果此篇文章对您有帮助，就请作者喝杯 Coffee ☕️☕️!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="微信打赏二维码">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="支付宝打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>

      
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="/img/share-wechat.jpg" target="_blank">公众账号</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">哔哩哔哩专栏</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">博主Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">博主Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">知乎</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">博客园</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">今日头条</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">简书</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">腾讯云社区</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">百度文库</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">IT极客知识分享</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTO博客</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">掘金</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">微博文章</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">小红书</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">墨天轮</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">抖音主页</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">快手主页</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">西瓜视频</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2023 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.唯一极客IT知识分享 版权所有 </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>访问统计
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-站点地图">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-百度站点地图">站点地图</a> </span>
        <!-- 
  -->
        <br/>ICP备案号<span><a href="https://beian.miit.gov.cn" target="_blank">渝ICP备2022003447号</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSL安全认证" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>

<div id="go" class="waves-effect waves-light">
  <a href="javascript:;" id="goqrcode"> <span class="icon icon-lg icon-qrcode"></span> </a>
  <a href="javascript:;" id="gotop"> <span class="icon icon-lg icon-chevron-up"></span></a>
</div>





<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/4-13-431.html&title=《Linux安全运维加公配置》 — WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/4-13-431.html&title=《Linux安全运维加公配置》 — WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/4-13-431.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Linux安全运维加公配置》 — WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/4-13-431.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/4-13-431.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACLElEQVR42u3aS3LDMAwEUd//0soBUmJ6ACoJoebK5Y+sp8UUCPDzweu6Wd8/vfv+3TXv/uXzxJIhQ8axjGu5at9Zv7Mmpf8rQ4aM9zD4pddZx2N6fdP83mTIkCEjfd2PYBkyZMjYxeDhSEL5zwJXhgwZRzHIBpU310ijjT+azXtxGTJkHMjgXffff/3IfEOGDBlHMa5w1cpEEpFXY8mQIWM2gwdcp7nPN7S1+5EhQ8ZsRu2IAx9M9htw6B0ZMmSMZvTTmtwo+W2/5SdDhoypDN6+52Xc3kNgaLQgQ4aMlzFqBd/ex5E+CBkyZMxmpIfA0pAlYFJoBgNOGTJkDGXwTSN5BE8MA9CvZMiQMZTBm1y1Def6amnRidptMmTIGMrol4Bk8aZ/0GjbW8nKkCHj3zNIRPLDE+RABp+vBvtvGTJkjGOkTfzOYICHeG38KUOGjLcx+C3WRgvpFeIlQ4aMoYw0akkRyX9FNrpBtStDhoyhjGIR1m7u10pPhJEhQ8YgBg/K2k3zkOWxi86MyJAhYzSjVhR2tqNrJBpzypAh48WM2pY1DdlOQ1CGDBmzGVe4eIOMH84g1/whfGXIkDGaUZsM8ixPC8q0TIwxMmTIOJbxXGHHm3FpqbqhayhDhowDGbtKNz5CqB2huL2aDBkyZDTiNR1wklJShgwZMmqBWwtKHtk//LsMGTJewCCbWF4O9uP1wXabDBkyDmS0TmqEQwJ+sIM04GTIkPECxheubEHPWd+1PAAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  





<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-关注于网络安全_物联网安全开发_网络安全运维-学习心得分享';
                clearTimeout(titleTime);
            } else {
                document.title = '(つェ⊂)咦!又好了!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// 站点运行时间
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + "天" + RunHours + "时" + RunMinutes + "分" + RunSeconds + "秒";
  document.getElementById(id).innerHTML = "网站已在风雨中勉勉强强运行了【" + RunTime + "】";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
</body>
</html>