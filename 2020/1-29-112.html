<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ ä¼ä¸šå†…éƒ¨NTPæœåŠ¡å™¨åŸºç¡€å®‰è£…ä¸é…ç½®ä½¿ç”¨|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="NTP">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/2018/1-1-1.html"  >
                <i class="icon icon-lg icon-mortar-board"></i>
                å­¦ä¹ ä¹‹è·¯
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/sites"  >
                <i class="icon icon-lg icon-globe"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="/img/video-account.jpg" target="_blank" >
                <i class="icon icon-lg icon-video-camera"></i>
                è§†é¢‘å·
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                å‹æƒ…é“¾æ¥
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>ä¼ä¸šå†…éƒ¨NTPæœåŠ¡å™¨åŸºç¡€å®‰è£…ä¸é…ç½®ä½¿ç”¨</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">ä¼ä¸šå†…éƒ¨NTPæœåŠ¡å™¨åŸºç¡€å®‰è£…ä¸é…ç½®ä½¿ç”¨</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-01-29T05:34:30.000Z" itemprop="datePublished" class="page-time">
  2020-01-29
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Linux%E9%85%8D%E7%BD%AE/">Linuxé…ç½®</a></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap" style="display: none;">
  <article id="post-ç³»ç»Ÿè¿ç»´/Application/Sync/ä¼ä¸šNTPæœåŠ¡å™¨åŸºç¡€å®‰è£…ä¸é…ç½®ä½¿ç”¨"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">ä¼ä¸šå†…éƒ¨NTPæœåŠ¡å™¨åŸºç¡€å®‰è£…ä¸é…ç½®ä½¿ç”¨</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-01-29 13:34:30" datetime="2020-01-29T05:34:30.000Z"  itemprop="datePublished">2020-01-29</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Linux%E9%85%8D%E7%BD%AE/">Linuxé…ç½®</a></li></ul>



            

            


            
        </div>
        <span class="post-href" style="display: none;">|</span> 
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="0x00-å‰è¨€ç®€è¿°"><a href="#0x00-å‰è¨€ç®€è¿°" class="headerlink" title="0x00 å‰è¨€ç®€è¿°"></a>0x00 å‰è¨€ç®€è¿°</h2><h3 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h3><p>ç®€ä»‹:NTP æ˜¯ç½‘ç»œæ—¶é—´åè®® (Network Time Protocol)æ˜¯ç”¨æ¥ä½¿ç½‘ç»œä¸­çš„å„ä¸ªè®¡ç®—æœºæ—¶é—´åŒæ­¥çš„ä¸€ç§åè®®ã€‚å®ƒçš„ç”¨é€”æ˜¯æŠŠè®¡ç®—æœºçš„æ—¶é’ŸåŒæ­¥åˆ°ä¸–ç•Œåè°ƒUTCï¼Œå…¶ç²¾åº¦åœ¨å±€åŸŸç½‘å†…å¯è¾¾0.1msï¼Œåœ¨äº’è”ç½‘ç»å¤§å¤šæ•°çš„åœ°æ–¹å…¶ç²¾ä¹‰å¯è¾¾1-50msã€‚</p>
<p>ä¾‹å¦‚: æ‚¨åœ¨æ›´æ–°æ•°æ®åº“æˆ–è€…åˆ†ææ—¥å¿—æ—¶ï¼Œæ—¶é—´é¡ºåºå¯¹ç»“æœæœ‰å¾ˆå¤§å½±å“ã€‚ä¸ºé¿å…åœ¨å®ä¾‹ä¸Šè¿è¡Œä¸šåŠ¡æ—¶å‡ºç°é€»è¾‘æ··ä¹±å’Œç½‘ç»œè¯·æ±‚é”™è¯¯ç­‰é—®é¢˜ï¼Œæ‚¨éœ€è¦ç»Ÿä¸€ç›¸å…³å®ä¾‹çš„æ—¶åŒºè®¾ç½®ã€‚å¦å¤–æ‚¨è¿˜å¯ä»¥é€šè¿‡NTPæœåŠ¡åŒæ­¥ç½‘ç»œä¸­æ‰€æœ‰æœåŠ¡å™¨çš„æœ¬åœ°æ—¶é—´ã€‚ </p>
<p><strong>åº”ç”¨åœºæ™¯</strong></p>
<ul>
<li>1) åœ¨è¿›è¡ŒLinuxè¿ç»´ä»¥åŠåŒæ­¥çš„åº”ç”¨å®‰è£…å’Œä½¿ç”¨éƒ½è¦æ±‚ï¼ŒåŒæ–¹çš„æ—¶é—´æ˜¯éœ€è¦ä¿æŒä¸€è‡´çš„ï¼Œè€Œå¸¸å¸¸å°å‹çš„æœåŠ¡å™¨ç¾¤æ˜¯æ²¡æœ‰è‡ªå·±çš„NTPæœåŠ¡å™¨çš„ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦é‡‡ç”¨å¤–ç½‘çš„NTPæœåŠ¡å™¨è¿›è¡Œæ—¶é—´çš„åŒæ­¥å’Œæ ¡å¯¹;</li>
<li>2) ä¸€èˆ¬ä¼ä¸šå‡ºäºå®‰å…¨æˆ–è€…å‡ºå£å¸¦å®½ç­‰å„æ–¹é¢åŸå› å†…ç½‘ä¸»æœºæ˜¯æ— æ³•ç›´æ¥æ¥é€šå¤–ç½‘ï¼Œé€šè¿‡ä¼ä¸šå†…éƒ¨è‡ªå»ºæ—¶é—´æœåŠ¡å™¨å¯ä»¥è®©å†…ç½‘æ— æ³•ä¸Šç½‘çš„æœºå™¨åŒæ­¥æœ¬æœºæ—¶é—´ï¼Œè€Œæœ¬æœºå¯ä»¥é€šè¿‡å…¬ç½‘åŒæ­¥å…¬ç½‘çš„ntpæº(<code>å®ç°ç±»ä¼¼ä¸­è½¬è·³è½¬çš„åŠŸèƒ½</code>)</li>
</ul>
<p>Tips: ç®€å•çš„è¯´å°±æ˜¯å¯¹æ—¶é—´ç²¾åº¦è¦æ±‚é«˜çš„åº”ç”¨å’Œä¸»æœºéœ€è¦ä½¿ç”¨åˆ°æ—¶é—´åŒæ­¥æœåŠ¡å™¨;</p>
<p><strong>åè¯è§£æ</strong></p>
<ul>
<li>(1) åœ¨Linuxç³»ç»Ÿä¸­å­˜åœ¨ä¸¤ä¸ªæ—¶é’Ÿæ—¶é—´ï¼Œåˆ†åˆ«æ˜¯<code>ç¡¬ä»¶æ—¶é’ŸRTCï¼ˆReal Time Clockï¼‰</code>å’Œ<code>ç³»ç»Ÿæ—¶é’Ÿï¼ˆSystem Clockï¼‰</code><ul>
<li>ç¡¬ä»¶æ—¶é’Ÿæ˜¯æŒ‡çš„åœ¨ä¸»æ¿ä¸Šçš„æ—¶é’Ÿè®¾å¤‡ï¼Œä¹Ÿå°±æ˜¯é€šå¸¸å¯ä»¥åœ¨BIOSç”»é¢è®¾ç½®çš„æ—¶é’Ÿï¼Œå³ä½¿å…³æœºçŠ¶æ€ä¹Ÿå¯ä»¥è®¡ç®—æ—¶é—´ã€‚</li>
<li>ç³»ç»Ÿæ—¶é’Ÿåˆ™æ˜¯æŒ‡Kernelä¸­çš„æ—¶é’Ÿï¼Œå…¶å€¼æ˜¯ç”±1970å¹´1æœˆ1æ—¥00:00:00 UTCæ—¶é—´è‡³å½“å‰æ—¶é—´æ‰€ç»å†çš„ç§’æ•°æ€»å’Œã€‚å½“Linuxå¯åŠ¨çš„æ—¶å€™ï¼Œç³»ç»Ÿæ—¶é’Ÿä¼šè¯»å–ç¡¬ä»¶æ—¶é’Ÿçš„è®¾å®šï¼Œä¹‹åç³»ç»Ÿæ—¶é’Ÿç‹¬ç«‹è¿ä½œã€‚é•¿æ—¶é—´è¿è¡Œä¸¤è€…å¯èƒ½å°†ä¼šäº§ç”Ÿè¯¯å·®ã€‚å¦å¤–æ‰€æœ‰çš„Linuxç›¸å…³æŒ‡ä»¤éƒ½æ˜¯è¯»å–ç³»ç»Ÿæ—¶é’ŸæŒ‡å®šçš„ï¼Œå¦‚ date å¯ä»¥ä½¿ç”¨ timedatectl  æŸ¥çœ‹ä¸¤è€…æ—¶é—´ã€‚</li>
</ul>
</li>
</ul>
<p><br></p>
<h3 id="æœåŠ¡æ–¹å¼"><a href="#æœåŠ¡æ–¹å¼" class="headerlink" title="æœåŠ¡æ–¹å¼"></a>æœåŠ¡æ–¹å¼</h3><p>æè¿°: å³ ntpd ä¸ Chrony æœåŠ¡ï¼ˆCentOSä¸Šè‡ªå¸¦å®¢æˆ·ç«¯ï¼‰ä»¥åŠ systemd-timesyncd (Ubuntu 18.04 ä»¥ä¸Šè‡ªå¸¦) ç­‰å‡ ç§æœåŠ¡æ–¹å¼çš„æ­å»ºä¸é…ç½®ã€‚</p>
<p>Tips: NTP æ˜¯ä»åœ¨ä½¿ç”¨ä¸­çš„æœ€å¤è€çš„ç½‘ç»œä¼ è¾“åè®®ä¹‹ä¸€ï¼ˆ1985 å¹´å‰å¼€å§‹ï¼‰ã€‚<br>Tips: NTPæœåŠ¡çš„é€šä¿¡ç«¯å£ä¸ºUDP 123, æ‰€ä»¥åœ¨æœåŠ¡ä¹‹å‰è¯·ç¡®ä¿æ‚¨çš„é˜²ç«å¢™å·²ç»æ‰“å¼€ <code>UDP 123</code> ç«¯å£çš„é€šä¿¡;</p>
<p><br></p>
<h3 id="å…¬å…±-NTP-æœåŠ¡å™¨"><a href="#å…¬å…±-NTP-æœåŠ¡å™¨" class="headerlink" title="å…¬å…± NTP æœåŠ¡å™¨"></a>å…¬å…± NTP æœåŠ¡å™¨</h3><p>æè¿°: é˜¿é‡Œäº‘æä¾›äº†å†…ç½‘å’Œå…¬ç½‘NTPæœåŠ¡å™¨ï¼Œç”¨äºåŒæ­¥å„ç½‘ç»œä¸­ECSå®ä¾‹çš„æœ¬åœ°æ—¶é—´ã€‚</p>
<p>Tips: </p>
<ul>
<li>China - cn.pool.ntp.org: To use this specific pool zone, add the following to your ntp.conf file:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server 0.cn.pool.ntp.org</span><br><span class="line">server 1.cn.pool.ntp.org</span><br><span class="line">server 2.cn.pool.ntp.org</span><br><span class="line">server 3.cn.pool.ntp.org</span><br></pre></td></tr></table></figure></li>
<li>äº‘æœåŠ¡å™¨ECSä¸ºæ‚¨æä¾›äº†é«˜ç²¾åº¦çš„æ—¶é—´å‚è€ƒNTPæœåŠ¡å™¨ï¼Œå…¶ä¸­<code>ntp.cloud.aliyuncs.com</code>æœåŠ¡å™¨åœ¨åœ°åŸŸçº§åˆ«ä¸Šæä¾›åŸå­å‚è€ƒé’ŸæœåŠ¡ï¼Œé€‚ç”¨äºé‡‘èã€é€šè®¯ã€ç§‘ç ”å’Œå¤©æ–‡ç­‰ä»¥æ—¶é—´ç²¾åº¦æ ¸å¿ƒçš„ç”Ÿäº§è¡Œä¸š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é˜¿é‡Œå·´å·´å…¬å…±ç³»ç»ŸæœåŠ¡: https://developer.aliyun.com/mirror</span><br><span class="line">ntp.aliyun.com</span><br></pre></td></tr></table></figure>
</li>
</ul>
<table>
<thead>
<tr>
<th>ç»å…¸ç½‘ç»œå†…ç½‘</th>
<th>ä¸“æœ‰ç½‘ç»œVPCå†…ç½‘</th>
<th>å…¬ç½‘</th>
</tr>
</thead>
<tbody>
<tr>
<td>-</td>
<td>ntp.cloud.aliyuncs.com</td>
<td>ntp1.aliyun.com</td>
</tr>
<tr>
<td>ntp1.cloud.aliyuncs.com</td>
<td>ntp7.cloud.aliyuncs.com</td>
<td>ntp2.aliyun.com</td>
</tr>
<tr>
<td>ntp2.cloud.aliyuncs.com</td>
<td>ntp8.cloud.aliyuncs.com</td>
<td>ntp3.aliyun.com</td>
</tr>
<tr>
<td>ntp3.cloud.aliyuncs.com</td>
<td>ntp9.cloud.aliyuncs.com</td>
<td>ntp4.aliyun.com</td>
</tr>
<tr>
<td>ntp4.cloud.aliyuncs.com</td>
<td>ntp10.cloud.aliyuncs.com</td>
<td>ntp5.aliyun.com</td>
</tr>
<tr>
<td>ntp5.cloud.aliyuncs.com</td>
<td>ntp11.cloud.aliyuncs.com</td>
<td>ntp6.aliyun.com</td>
</tr>
<tr>
<td>ntp6.cloud.aliyuncs.com</td>
<td>ntp12.cloud.aliyuncs.com</td>
<td>ntp7.aliyun.com</td>
</tr>
</tbody>
</table>
<p>Tips:</p>
<ul>
<li>è…¾è®¯äº‘ : <a href="https://cloud.tencent.com/document/product/213/30392" target="_blank" rel="noopener">https://cloud.tencent.com/document/product/213/30392</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server time1.cloud.tencent.com</span><br><span class="line">server time2.cloud.tencent.com</span><br><span class="line">server time3.cloud.tencent.com</span><br><span class="line">server time4.cloud.tencent.com</span><br><span class="line">server time5.cloud.tencent.com</span><br></pre></td></tr></table></figure></li>
<li>China - é«˜æ ¡ä¸ç½‘ç»œä¸­å¿ƒ<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">çº§	åŸŸå	åœ°ç†ä½ç½®	è´Ÿè´£äºº	é‚®ä»¶	ç”µè¯</span><br><span class="line">1	s1a.time.edu.cn	åŒ—äº¬é‚®ç”µå¤§å­¦	ç‹æŒ¯å	wzhdl at bupt.edu.cn	010-62283044-8003</span><br><span class="line">1	s1b.time.edu.cn	æ¸…åå¤§å­¦	å°¹æƒ å®	yhs at cernet.edu.cn	010-62795818-6105</span><br><span class="line">1	s1c.time.edu.cn	åŒ—äº¬å¤§å­¦	é©¬çš“	mah at pku.edu.cn	010-62753007</span><br><span class="line">1	s1d.time.edu.cn	ä¸œå—å¤§å­¦	å¾åŠ ç¾š	jlxu at njnet.edu.cn	025-3794342-309</span><br><span class="line">1	s1e.time.edu.cn	æ¸…åå¤§å­¦	å°¹æƒ å®	yhs at cernet.edu.cn	010-62795818-6105</span><br><span class="line">2	s2a.time.edu.cn	æ¸…åå¤§å­¦	å°¹æƒ å®	yhs at cernet.edu.cn	010-62795818-6105</span><br><span class="line">2	s2b.time.edu.cn	æ¸…åå¤§å­¦	å°¹æƒ å®	yhs at cernet.edu.cn	010-62795818-6105</span><br><span class="line">2	s2c.time.edu.cn	åŒ—äº¬é‚®ç”µå¤§å­¦	ç‹æŒ¯å	wzhdl at bupt.edu.cn	010-62283044-8003</span><br><span class="line">2	s2d.time.edu.cn	è¥¿å—åœ°åŒºç½‘ç»œä¸­å¿ƒ	è‘£èŒœ	appletung at uestc.edu.cn	028-61830330</span><br><span class="line">2	s2e.time.edu.cn	è¥¿åŒ—åœ°åŒºç½‘ç»œä¸­å¿ƒ	ä¸æƒ å®	dhn at xanet.edu.cn	029-2669037</span><br><span class="line">2	s2f.time.edu.cn	ä¸œåŒ—åœ°åŒºç½‘ç»œä¸­å¿ƒ	æ¯›å®‡	maoy at neu.edu.cn	024-23966854</span><br><span class="line">2	s2g.time.edu.cn	åä¸œå—åœ°åŒºç½‘ç»œä¸­å¿ƒ	ç¿åº†æµ·	qqh at sjtu.edu.cn	021-62932901-8101</span><br><span class="line">2	s2h.time.edu.cn	å››å·å¤§å­¦ç½‘ç»œç®¡ç†ä¸­å¿ƒ	éƒ‘ç‚³ä¼¦	zhengbl at scu.edu.cn	028-85414820</span><br><span class="line">2	s2j.time.edu.cn	å¤§è¿ç†å·¥å¤§å­¦ç½‘ç»œä¸­å¿ƒ	äºå¹¿è¾‰	ygh at dlut.edu.cn	0411-4708642</span><br><span class="line">2	s2k.time.edu.cn	CERNETæ¡‚æ—ä¸»èŠ‚ç‚¹	èƒ¡è¿›å¤	jinkun at mailbox.gxnu.edu.cn	0773-5845246</span><br><span class="line">2	s2m.time.edu.cn	åŒ—äº¬å¤§å­¦	é©¬çš“	mah at pku.edu.cn	010-62753007</span><br></pre></td></tr></table></figure></li>
<li>Windowsè‡ªå¸¦: time.windows.com</li>
<li>macOSè‡ªå¸¦: time.apple.com</li>
<li>Google Public NTP : <a href="https://developers.google.com/time" target="_blank" rel="noopener">https://developers.google.com/time</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ”¯æŒIPv6</span></span><br><span class="line">time.google.com</span><br><span class="line">server time1.google.com</span><br><span class="line">server time2.google.com</span><br><span class="line">server time3.google.com</span><br><span class="line">server time4.google.com</span><br></pre></td></tr></table></figure></li>
<li>Cloudflare: time.cloudflare.com</li>
<li>QualcommÂ® ä½ç½® ï¼ˆXTRA é¢„æµ‹å«æ˜Ÿæ•°æ®æœåŠ¡ï¼‰: time.izatcloud.net</li>
</ul>
<hr>
<h2 id="0x01-æœåŠ¡å™¨å®‰è£…é…ç½®"><a href="#0x01-æœåŠ¡å™¨å®‰è£…é…ç½®" class="headerlink" title="0x01 æœåŠ¡å™¨å®‰è£…é…ç½®"></a>0x01 æœåŠ¡å™¨å®‰è£…é…ç½®</h2><h3 id="1-NTP-æœåŠ¡"><a href="#1-NTP-æœåŠ¡" class="headerlink" title="(1) NTP æœåŠ¡"></a>(1) NTP æœåŠ¡</h3><h4 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h4><p><strong>å®‰è£…ç¯å¢ƒ:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~$ lsb_release -a</span><br><span class="line">  <span class="comment"># No LSB modules are available.</span></span><br><span class="line">  <span class="comment"># Distributor ID: Ubuntu</span></span><br><span class="line">  <span class="comment"># Description:    Ubuntu 20.04.1 LTS</span></span><br><span class="line">  <span class="comment"># Release:        20.04</span></span><br><span class="line">  <span class="comment"># Codename:       focal</span></span><br></pre></td></tr></table></figure></p>
<p><strong>å®‰è£…æµç¨‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (0) é˜²ç«å¢™é…ç½®123/udp</span></span><br><span class="line">sudo ufw allow 123/udp</span><br><span class="line"><span class="comment"># Rules updated</span></span><br><span class="line"><span class="comment"># Rules updated (v6)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (1) å®‰è£…NTP</span></span><br><span class="line">sudo apt install ntp -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) è®¾ç½®NTP server</span></span><br><span class="line">cp /etc/ntp.conf&#123;,.bak&#125;</span><br><span class="line">tee /etc/ntp.conf &lt;&lt;<span class="string">'END'</span></span><br><span class="line">driftfile /var/lib/ntp/ntp.drift</span><br><span class="line">leapfile /usr/share/zoneinfo/leap-seconds.list</span><br><span class="line"></span><br><span class="line">server ntp1.aliyun.com iburst minpoll 4 maxpoll 10</span><br><span class="line">server ntp2.aliyun.com iburst minpoll 4 maxpoll 10</span><br><span class="line">server ntp3.aliyun.com iburst minpoll 4 maxpoll 10</span><br><span class="line"></span><br><span class="line">restrict -4 default kod notrap nomodify nopeer noquery</span><br><span class="line">restrict -6 default kod notrap nomodify nopeer noquery</span><br><span class="line"></span><br><span class="line">restrict 192.168.12.254 nomodify notrap nopeer noquery</span><br><span class="line">restrict 127.0.0.1</span><br><span class="line">restrict ::1</span><br><span class="line"></span><br><span class="line">restrict <span class="built_in">source</span> notrap nomodify noquery</span><br><span class="line">restrict ntp.aliyun.com nomodify notrap  noquery</span><br><span class="line">pool ntp.aliyun.com</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) é‡å¯æœåŠ¡&amp;æŸ¥çœ‹çŠ¶æ€&amp;å¼€æœºè‡ªå¯</span></span><br><span class="line">sudo systemctl restart ntp</span><br><span class="line">sudo systemctl status ntp</span><br><span class="line">  <span class="comment"># â— ntp.service - Network Time Service</span></span><br><span class="line">  <span class="comment">#     Loaded: loaded (/lib/systemd/system/ntp.service; enabled; vendor preset: enabled)</span></span><br><span class="line">  <span class="comment">#     Active: active (running) since Fri 2021-03-19 11:51:19 CST; 2s ago</span></span><br><span class="line">  <span class="comment">#       Docs: man:ntpd(8)</span></span><br><span class="line">  <span class="comment">#     Process: 31997 ExecStart=/usr/lib/ntp/ntp-systemd-wrapper (code=exited, status=0/SUCCESS)</span></span><br><span class="line">  <span class="comment">#   Main PID: 32015 (ntpd)</span></span><br><span class="line">  <span class="comment">#       Tasks: 2 (limit: 9450)</span></span><br><span class="line">  <span class="comment">#     Memory: 1.7M</span></span><br><span class="line">  <span class="comment">#     CGroup: /system.slice/ntp.service</span></span><br><span class="line">  <span class="comment">#             â””â”€32015 /usr/sbin/ntpd -p /var/run/ntpd.pid -g -u 112:117</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Mar 19 11:51:19 dns-server ntpd[32015]: Listen and drop on 0 v6wildcard [::]:123</span></span><br><span class="line">  <span class="comment"># Mar 19 11:51:19 dns-server ntpd[32015]: Listen and drop on 1 v4wildcard 0.0.0.0:123</span></span><br><span class="line">  <span class="comment"># Mar 19 11:51:19 dns-server ntpd[32015]: Listen normally on 2 lo 127.0.0.1:123</span></span><br><span class="line">  <span class="comment"># Mar 19 11:51:19 dns-server ntpd[32015]: Listen normally on 3 ens160 192.168.12.254:123</span></span><br><span class="line">  <span class="comment"># Mar 19 11:51:19 dns-server ntpd[32015]: Listen normally on 4 lo [::1]:123</span></span><br><span class="line">  <span class="comment"># Mar 19 11:51:19 dns-server ntpd[32015]: Listen normally on 5 ens160 [fe80::250:56ff:fe8a:69b4%2]:123</span></span><br><span class="line">  <span class="comment"># Mar 19 11:51:19 dns-server ntpd[32015]: Listening on routing socket on fd #22 for interface updates</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> ntpd</span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) éªŒè¯ç›‘å¬æƒ…å†µ</span></span><br><span class="line">~$ netstat -ulnp | grep <span class="string">":123"</span></span><br><span class="line">  <span class="comment"># (Not all processes could be identified, non-owned process info</span></span><br><span class="line">  <span class="comment"># will not be shown, you would have to be root to see it all.)</span></span><br><span class="line">  <span class="comment"># udp        0      0 192.168.12.254:123      0.0.0.0:*                           -</span></span><br><span class="line">  <span class="comment"># udp        0      0 127.0.0.1:123           0.0.0.0:*                           -</span></span><br><span class="line">  <span class="comment"># udp        0      0 0.0.0.0:123             0.0.0.0:*                           -</span></span><br><span class="line">  <span class="comment"># udp6       0      0 fe80::250:56ff:fe8a:123 :::*                                -</span></span><br><span class="line">  <span class="comment"># udp6       0      0 ::1:123                 :::*                                -</span></span><br><span class="line">  <span class="comment"># udp6       0      0 :::123                  :::*                                -</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) æµ‹è¯•æ•ˆæœ</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Asia/Shanghai"</span> &gt; /etc/timezone</span><br><span class="line">sudo ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line">sudo hwclock --systohc  <span class="comment"># å†™å…¥ç¡¬ä»¶ä¹‹ä¸­</span></span><br><span class="line">sudo timedatectl <span class="built_in">set</span>-local-rtc 0</span><br><span class="line">~$ sudo date --s=<span class="string">"2019-09-04 17:30:00"</span></span><br><span class="line">Wed 04 Sep 2019 05:30:00 PM CST</span><br><span class="line">~$ systemctl restart ntp</span><br><span class="line">~$ date  <span class="comment"># ç­‰å¾…10såä¼šå‘ç°å·²åŒæ­¥</span></span><br><span class="line">Fri 19 Mar 2021 03:25:42 PM CST</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="2-Chrony-æœåŠ¡"><a href="#2-Chrony-æœåŠ¡" class="headerlink" title="(2) Chrony æœåŠ¡"></a>(2) Chrony æœåŠ¡</h3><p>æè¿°:ç”±äºRedhat8ç³»åˆ—çš„å‘è¡Œç‰ˆæœ¬é»˜è®¤é‡‡ç”¨Chronyè€ŒåºŸå¼ƒäº†ntpd,æ‰€ä»¥ä¸‹é¢ä¸»è¦è®²è§£ä¸€ä¸‹chronyç›¸å…³çš„é…ç½®;<br>Chronyæ˜¯NTPï¼ˆ<code>Network Time Protocolï¼Œç½‘ç»œæ—¶é—´åè®®ï¼ŒæœåŠ¡å™¨æ—¶é—´åŒæ­¥çš„ä¸€ç§åè®®</code>ï¼‰çš„å¦ä¸€ç§å®ç°ä¸ntpdä¸åŒï¼Œå®ƒå¯ä»¥æ›´å¿«ä¸”æ›´å‡†ç¡®åœ°åŒæ­¥ç³»ç»Ÿæ—¶é’Ÿï¼Œæœ€å¤§ç¨‹åº¦çš„å‡å°‘æ—¶é—´å’Œé¢‘ç‡è¯¯å·®ã€‚</p>
<p>chronyæœ‰ä¸‰ä¸ªæ—¶é—´å‚è€ƒï¼š<code>ç¡¬ä»¶æ—¶é’Ÿã€å®æ—¶æ—¶é’Ÿä»¥åŠæ‰‹åŠ¨åŒæ­¥</code>ã€‚</p>
<p><strong>ChronyåŒ…æ‹¬ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š</strong></p>
<ul>
<li>chronyd:ä¸€ä¸ªåå°è¿è¡Œçš„å®ˆæŠ¤è¿›ç¨‹ï¼Œç”¨äºè°ƒæ•´å†…æ ¸ä¸­è¿è¡Œçš„ç³»ç»Ÿæ—¶é’Ÿä¸NTPæœåŠ¡å™¨åŒæ­¥(<code>å®ƒç¡®å®šæœåŠ¡å™¨å¢å‡æ—¶é—´çš„æ¯”ç‡ï¼Œå¹¶å¯¹æ­¤è¿›è¡Œè°ƒæ•´è¡¥å¿</code>)</li>
<li>chronyc:æä¾›ç”¨æˆ·ç•Œé¢ï¼Œç”¨äºç›‘æ§æ€§èƒ½å¹¶è¿›è¡Œå¤šæ ·åŒ–çš„é…ç½®(<code>å®ƒå¯ä»¥åœ¨chronydå®ä¾‹æ§åˆ¶çš„æœåŠ¡å™¨ä¸Šå·¥ä½œï¼Œä¹Ÿå¯ä»¥åœ¨ä¸€å°ä¸åŒçš„è¿œç¨‹æœåŠ¡å™¨ä¸Šå·¥ä½œ</code>)</li>
</ul>
<p>Tips : å…³äºNTPå®¢æˆ·ç«¯çš„æ›¿ä»£å“Chronyè¯´æ˜<br>ç­”: Chronyå¯ä»¥æ›´å¿«åœ°åŒæ­¥ç³»ç»Ÿæ—¶é’Ÿï¼Œæé«˜æ—¶é—´ç²¾åº¦ï¼Œå¯¹äºä¸€ç›´ä¸åœ¨çº¿çš„ç³»ç»Ÿå°¤å…¶æœ‰ç”¨ï¼ŒåŒæ—¶chronydè¾ƒå°ï¼Œå®ƒä½¿ç”¨è¾ƒå°‘çš„å†…å­˜ï¼Œåªåœ¨å¿…è¦æ—¶æ‰å”¤é†’CPUï¼Œè¿™æ ·å¯ä»¥æ›´å¥½åœ°èŠ‚çœç”µèƒ½ï¼Œå³ä½¿ç½‘ç»œæ‹¥å¡è¾ƒé•¿æ—¶é—´ï¼Œå®ƒä¹Ÿèƒ½å¾ˆå¥½åœ°è¿è¡Œã€‚</p>
<p><br></p>
<h4 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h4><p><strong>éœ€æ±‚åˆ†æä¸ç¯å¢ƒ:</strong><br>æè¿°: å†…ç½‘æœ‰ä¸€å°NTP Serverå‘é˜¿é‡Œäº‘æä¾›çš„å…¬ç½‘NTPæœåŠ¡å™¨åŒæ­¥æ—¶é—´ï¼Œå¹¶ä¸”ä½œä¸ºå†…ç½‘NTP Serverå†…ç½‘ä¸­çš„å…¶å®ƒNTP ClientæœåŠ¡å™¨å‘å…¶åŒæ­¥æ—¶é—´;</p>
<table>
<thead>
<tr>
<th>IP</th>
<th>ä¸»æœºå</th>
<th>æ—¶é—´åŒæ­¥æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.1.146</td>
<td>ntp-server</td>
<td>chronydæœåŠ¡å¹³æ»‘åŒæ­¥</td>
</tr>
<tr>
<td>192.168.1.147</td>
<td>ntp-client1</td>
<td>chronydæœåŠ¡å¹³æ»‘åŒæ­¥</td>
</tr>
<tr>
<td>&lt;!â€“ 192.168.1.148</td>
<td>ntp-client2</td>
<td>crontab+ntpdateå¼ºåˆ¶åŒæ­¥ â€“&gt;</td>
</tr>
</tbody>
</table>
<p><strong>è¡¥å……è¯´æ˜:</strong></p>
<ul>
<li>ä»¥ä¸ŠåŸºäºCent7.7ä»¥ä¸Šçš„å‘è¡Œç‰ˆæœ¬</li>
<li>ä½¿ç”¨chronydæœåŠ¡å¹³æ»‘åŒæ­¥æ—¶é—´çš„æ–¹å¼è¦ä¼˜äºcrontab + ntpdateåŸå› å¦‚ä¸‹:<ul>
<li>å› ä¸ºntpdateåŒæ­¥æ—¶é—´ä¼šé€ æˆ<code>æ—¶é—´çš„è·³è·ƒ</code>,å¯¹ä¸€äº›ä¾èµ–æ—¶é—´çš„ç¨‹åºå’ŒæœåŠ¡ä¼šé€ æˆå½±å“ï¼Œä¾‹å¦‚<code>sleepã€timer</code>ç­‰ï¼Œä¸”chronydæœåŠ¡å¯ä»¥åœ¨ä¿®æ­£æ—¶é—´çš„è¿‡ç¨‹ä¸­åŒæ—¶ä¿®æ­£CPU tickã€‚</li>
</ul>
</li>
<li>é»˜è®¤å¼€æ”¾ç«¯å£<code>127.0.0.1:323-UDP</code> æ³¨æ„NTPæœåŠ¡å™¨çš„å¼€æ”¾ç«¯å£ä¸ºUDP-123</li>
</ul>
<p><strong>åŸºç¡€é…ç½®æµç¨‹:</strong></p>
<ul>
<li><p>Step1.å†…ç½‘ NTP Server ç›¸å…³é…ç½®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0.å…³é—­é˜²ç«å¢™,å¦‚æœä¸æƒ³å…³é—­é˜²ç«å¢™å¯ä»¥æ”¾é€šç«¯å£</span></span><br><span class="line">firewall-cmd --permanent --add-port=123/udp</span><br><span class="line">firewall-cmd --permanent --add-port=123/tcp</span><br><span class="line"></span><br><span class="line"><span class="comment">#1.ä¸»æœºåè®¾ç½®</span></span><br><span class="line">hostnamectl <span class="built_in">set</span>-hostname ntp-server</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"192.168.1.146 ntp-server"</span> &gt;&gt; /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.é‡æ–°ç™»å½•ç»ˆç«¯å¹¶æŸ¥çœ‹å½“å‰æ—¶é—´</span></span><br><span class="line">hostname &amp;&amp; date</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.å®‰è£…chronyç”±äºæˆ‘çš„æœºå™¨å·²å®‰è£…å’Œcentos8è‡ªå¸¦åˆ™å¯ä»¥ä¸ç”¨è‡ªè¡Œå®‰è£…</span></span><br><span class="line">yum -y install chrony</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.å¤‡ä»½åŸå§‹/etc/chrony.confæ–‡ä»¶å¹¶ä¿®æ”¹</span></span><br><span class="line">mv /etc/chrony.conf&#123;,.bak&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#5.é…ç½®æ–‡ä»¶ä¿®æ”¹ä¸è¯´æ˜</span></span><br><span class="line">cat &gt;/etc/chrony.conf&lt;&lt;<span class="string">'EOF'</span></span><br><span class="line"><span class="comment"># æŒ‡å®šä¸Šå±‚NTPæœåŠ¡å™¨ä¸ºé˜¿é‡Œäº‘æä¾›çš„å…¬ç½‘NTPæœåŠ¡å™¨</span></span><br><span class="line"><span class="comment"># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span></span><br><span class="line"><span class="comment"># server 0.centos.pool.ntp.org iburst  #ç¼ºçœé»˜è®¤</span></span><br><span class="line">server ntp1.aliyun.com iburst minpoll 4 maxpoll 10</span><br><span class="line">server ntp2.aliyun.com iburst minpoll 4 maxpoll 10</span><br><span class="line">server ntp3.aliyun.com iburst minpoll 4 maxpoll 10</span><br><span class="line">server ntp4.aliyun.com iburst minpoll 4 maxpoll 10</span><br><span class="line">server ntp5.aliyun.com iburst minpoll 4 maxpoll 10</span><br><span class="line">server ntp6.aliyun.com iburst minpoll 4 maxpoll 10</span><br><span class="line">server ntp7.aliyun.com iburst minpoll 4 maxpoll 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®°å½•ç³»ç»Ÿæ—¶é’Ÿè·å¾—/ä¸¢å¤±æ—¶é—´çš„é€Ÿç‡è‡³driftæ–‡ä»¶ä¸­</span></span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœç³»ç»Ÿæ—¶é’Ÿçš„åç§»é‡å¤§äº10ç§’ï¼Œåˆ™å…è®¸åœ¨å‰ä¸‰æ¬¡æ›´æ–°ä¸­æ­¥è¿›è°ƒæ•´ç³»ç»Ÿæ—¶é’Ÿ</span></span><br><span class="line">makestep 1.0 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨RTCï¼ˆå®æ—¶æ—¶é’Ÿï¼‰çš„å†…æ ¸åŒæ­¥</span></span><br><span class="line">rtcsync</span><br><span class="line"></span><br><span class="line"><span class="comment"># Allow NTP client access from local network.</span></span><br><span class="line"><span class="comment"># å…è®¸åŒæ­¥æ—¶é—´çš„å®¢æˆ·ç«¯ç½‘æ®µ</span></span><br><span class="line">allow 192.168.1.0/24</span><br><span class="line"></span><br><span class="line"><span class="comment"># Serve time even if not synchronized to a time source.</span></span><br><span class="line"><span class="comment"># å½“é˜¿é‡Œäº‘æä¾›çš„å…¬ç½‘NTPæœåŠ¡å™¨ä¸å¯ç”¨æ—¶ï¼Œé‡‡ç”¨æœ¬åœ°æ—¶é—´ä½œä¸ºåŒæ­¥æ ‡å‡†</span></span><br><span class="line"><span class="built_in">local</span> stratum 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šåŒ…å«NTPéªŒè¯å¯†é’¥çš„æ–‡ä»¶:Specify file containing keys for NTP authentication.</span></span><br><span class="line">keyfile /etc/chrony.keys</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šå­˜æ”¾æ—¥å¿—æ–‡ä»¶çš„ç›®å½•:Specify directory for log files.</span></span><br><span class="line">logdir /var/<span class="built_in">log</span>/chrony</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable hardware timestamping on all interfaces that support it.</span></span><br><span class="line"><span class="comment"># åœ¨æ”¯æŒå®ƒçš„æ‰€æœ‰æ¥å£ä¸Šå¯ç”¨ç¡¬ä»¶æ—¶é—´æˆ³ã€‚</span></span><br><span class="line"><span class="comment">#hwtimestamp *</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Increase the minimum number of selectable sources required to adjust the system clock.</span></span><br><span class="line"><span class="comment"># å¢åŠ è°ƒæ•´ç³»ç»Ÿæ—¶é’Ÿæ‰€éœ€çš„å¯é€‰æºçš„æœ€å°æ•°ç›®ã€‚</span></span><br><span class="line"><span class="comment">#minsources 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®°å½•ä¿¡æ¯çš„é€‰æ‹©:Select which information is logged.</span></span><br><span class="line"><span class="comment">#log measurements statistics tracking</span></span><br><span class="line">EOF</span><br><span class="line">å¤‡æ³¨ï¼šè¯¦ç»†æŒ‡ä»¤å‚æ•°å¯ä»¥ä½¿ç”¨å‘½ä»¤<span class="comment"># man chrony.confæŸ¥çœ‹</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#6.å¯åŠ¨ä¸æŸ¥çœ‹chronydæœåŠ¡</span></span><br><span class="line">systemctl <span class="built_in">enable</span> chronyd.service &amp;&amp; systemctl restart chronyd.service &amp;&amp;  systemctl status chronyd.service</span><br><span class="line">ss -tunlp | grep chronyd</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=ä¼ä¸šå†…éƒ¨NTPæœåŠ¡å™¨åŸºç¡€å®‰è£…ä¸é…ç½®ä½¿ç”¨ href="https://img.weiyigeek.top/2020/1/20200514161355.png" target="_blank" title="WeiyiGeek.chronyd" data-fancybox="images"><img src="https://img.weiyigeek.top/2020/1/20200514161355.png" alt="WeiyiGeek.chronyd" title="" class=""></a>
                <p>WeiyiGeek.chronyd</p>
            </figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#7.æŸ¥çœ‹æ—¶é—´åŒæ­¥æºï¼š</span></span><br><span class="line">chronyc sources -v</span><br><span class="line"><span class="comment"># 210 Number of sources = 2 #æ¥æºæ•°é‡</span></span><br><span class="line"><span class="comment">#   .-- Source mode(æ¨¡å¼)  '^' = server, '=' = peer, '#' = local clock.</span></span><br><span class="line"><span class="comment">#  / .- Source state(çŠ¶æ€) '*' = current synced, '+' = combined , '-' = not combined,</span></span><br><span class="line"><span class="comment"># | /   '?' = unreachable, 'x' = time may be in error, '~' = time too variable.</span></span><br><span class="line"><span class="comment"># ||                                                 .- xxxx [ yyyy ] +/- zzzz</span></span><br><span class="line"><span class="comment"># ||      Reachability register (octal) -.           |  xxxx = adjusted offset,</span></span><br><span class="line"><span class="comment"># || Log2(Polling interval|è½®è¯¢é—´éš”) --.  |          |  yyyy = measured offset,</span></span><br><span class="line"><span class="comment"># ||                                \     |          |  zzzz = estimated error.</span></span><br><span class="line"><span class="comment"># ||                                 |    |           \</span></span><br><span class="line"><span class="comment"># MS Name/IP address         Stratum Poll Reach LastRx Last sample</span></span><br><span class="line"><span class="comment"># ===============================================================================</span></span><br><span class="line"><span class="comment"># ^* 120.25.115.20 (æ­£å¸¸)          2   4    17     1   -118us[+2986us] +/-   17ms</span></span><br><span class="line"><span class="comment"># ^- 203.107.6.88  (æ­£å¸¸)          2   4    17     1  -7270us[-7270us] +/-   33ms</span></span><br><span class="line">å¤‡æ³¨ï¼š120.25.115.20ä¸ºntp1.aliyun.comåŸŸåè§£æåçš„åœ°å€ï¼Œ203.107.6.88ä¸ºntp2.aliyun.com~ntp7.aliyun.comåŸŸåè§£æåçš„åœ°å€</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#8.æŸ¥çœ‹æ—¶é—´åŒæ­¥æºçŠ¶æ€:</span></span><br><span class="line">chronyc sourcestats -v</span><br><span class="line"><span class="comment"># 210 Number of sources = 2 #æ¥æºæ•°é‡</span></span><br><span class="line"><span class="comment">#                              .- Number of sample points in measurement set.</span></span><br><span class="line"><span class="comment">#                             /    .- Number of residual runs with same sign.</span></span><br><span class="line"><span class="comment">#                            |    /    .- Length of measurement set (time).</span></span><br><span class="line"><span class="comment">#                            |   |    /      .- Est. clock freq error (ppm).</span></span><br><span class="line"><span class="comment">#                            |   |   |      /           .- Est. error in freq.</span></span><br><span class="line"><span class="comment">#                            |   |   |     |           /         .- Est. offset.</span></span><br><span class="line"><span class="comment">#                            |   |   |     |          |          |   On the -.</span></span><br><span class="line"><span class="comment">#                            |   |   |     |          |          |   samples. \</span></span><br><span class="line"><span class="comment">#                            |   |   |     |          |          |             |</span></span><br><span class="line"><span class="comment"># Name/IP Address            NP  NR  Span  Frequency  Freq Skew  Offset  Std Dev</span></span><br><span class="line"><span class="comment"># ==============================================================================</span></span><br><span class="line"><span class="comment"># 120.25.115.20              16  11   201     -1.609     17.452  +1817us  1128us</span></span><br><span class="line"><span class="comment"># 203.107.6.88               16  10   201     +4.291     31.560  -3671us  2106us</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.è®¾ç½®ç¡¬ä»¶æ—¶é—´</span></span><br><span class="line"><span class="comment"># ç¡¬ä»¶æ—¶é—´é»˜è®¤ä¸ºUTCï¼š</span></span><br><span class="line">timedatectl <span class="built_in">set</span>-local-rtc 0</span><br><span class="line"><span class="comment"># å¯ç”¨NTPæ—¶é—´åŒæ­¥ï¼š</span></span><br><span class="line">timedatectl <span class="built_in">set</span>-ntp yes</span><br><span class="line"><span class="comment"># æ ¡å‡†æ—¶é—´æœåŠ¡å™¨ï¼š</span></span><br><span class="line">chronyc tracking</span><br></pre></td></tr></table></figure>
<p>å¤‡æ³¨ï¼šå¯ç›´æ¥è¾“å…¥å‘½ä»¤chronycè¿›å…¥äº¤äº’å¼æ¨¡å¼è¯¦ç»†ä½¿ç”¨æ–¹æ³•å¯ä»¥ä½¿ç”¨å‘½ä»¤# man chronydå’Œ# man chronycæŸ¥çœ‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¸¸ç”¨æŒ‡ä»¤è¯´æ˜</span></span><br><span class="line">-  <span class="built_in">help</span>ï¼šæŸ¥çœ‹å®Œæ•´çš„å‘½ä»¤å¸®åŠ©åˆ—è¡¨</span><br><span class="line">-  trackingï¼šæ˜¾ç¤ºç³»ç»Ÿæ—¶é—´ä¿¡æ¯</span><br><span class="line">-  activityï¼šæ£€æŸ¥å¤šå°‘NTPæºåœ¨çº¿/ç¦»çº¿</span><br><span class="line">-  add serverï¼šæ‰‹åŠ¨æ·»åŠ ä¸€å°æ–°çš„NTPæœåŠ¡å™¨</span><br><span class="line">-  deleteï¼šæ‰‹åŠ¨ç§»é™¤NTPæœåŠ¡å™¨æˆ–å¯¹ç­‰æœåŠ¡å™¨</span><br><span class="line">-  accheckï¼šæ£€æŸ¥NTPè®¿é—®æ˜¯å¦å¯¹ç‰¹å®šä¸»æœºå¯ç”¨</span><br><span class="line">-  clientsï¼šåœ¨å®¢æˆ·ç«¯æŠ¥å‘Šå·²è®¿é—®åˆ°çš„æœåŠ¡å™¨</span><br><span class="line"></span><br><span class="line">$ chronyc</span><br><span class="line"><span class="comment"># chronyc&gt; tracking</span></span><br><span class="line"><span class="comment"># Reference ID    : 78197314 (120.25.115.20)</span></span><br><span class="line"><span class="comment"># Stratum         : 3</span></span><br><span class="line"><span class="comment"># Ref time (UTC)  : Thu May 14 08:19:56 2020</span></span><br><span class="line"><span class="comment"># System time     : 0.000818836 seconds slow of NTP time</span></span><br><span class="line"><span class="comment"># Last offset     : -0.000368672 seconds</span></span><br><span class="line"><span class="comment"># RMS offset      : 0.000605058 seconds</span></span><br><span class="line"><span class="comment"># Frequency       : 12.746 ppm fast</span></span><br><span class="line"><span class="comment"># Residual freq   : -0.245 ppm</span></span><br><span class="line"><span class="comment"># Skew            : 6.550 ppm</span></span><br><span class="line"><span class="comment"># Root delay      : 0.030892739 seconds</span></span><br><span class="line"><span class="comment"># Root dispersion : 0.001810989 seconds</span></span><br><span class="line"><span class="comment"># Update interval : 64.4 seconds</span></span><br><span class="line"><span class="comment"># Leap status     : Normal</span></span><br><span class="line"><span class="comment"># chronyc&gt; accheck</span></span><br><span class="line"><span class="comment"># Could not read address</span></span><br><span class="line"><span class="comment"># chronyc&gt; clients</span></span><br><span class="line"><span class="comment"># Hostname                      NTP   Drop Int IntL Last     Cmd   Drop Int  Last</span></span><br><span class="line"><span class="comment"># ===============================================================================</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Step2.NTP Clienté…ç½®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å®‰è£…chrony</span></span><br><span class="line">yum -y install chrony &amp;&amp; mv /etc/chrony.conf /etc/chrony.conf.bak</span><br><span class="line"></span><br><span class="line"><span class="comment">#é…ç½®chrony.cnf</span></span><br><span class="line">cat &gt;/etc/chrony.conf&lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">server 192.168.10.254 iburst</span><br><span class="line">server ntp1.aliyun.com iburst</span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line">makestep 1.0 3</span><br><span class="line"><span class="built_in">local</span> stratum 10</span><br><span class="line">rtcsync</span><br><span class="line">logdir /var/<span class="built_in">log</span>/chrony</span><br><span class="line"><span class="comment">#keyfile /etc/chrony.keys</span></span><br><span class="line"><span class="comment">#stratumweight 0.05</span></span><br><span class="line"><span class="comment">#noclientlog</span></span><br><span class="line"><span class="comment">#logchange 0.5</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨chronydæœåŠ¡</span></span><br><span class="line">systemctl <span class="built_in">enable</span> chronyd.service &amp;&amp; systemctl restart chronyd.service &amp;&amp; ss -tunlp | grep chronyd</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ—¶é—´åŒæ­¥æºä»¥åŠåŒæ­¥çŠ¶æ€</span></span><br><span class="line">chronyc sources -v &amp;&amp; chronyc sourcestats -v</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=ä¼ä¸šå†…éƒ¨NTPæœåŠ¡å™¨åŸºç¡€å®‰è£…ä¸é…ç½®ä½¿ç”¨ href="https://img.weiyigeek.top/2020/1/20200514164454.png" target="_blank" title="WeiyiGeek.Client" data-fancybox="images"><img src="https://img.weiyigeek.top/2020/1/20200514164454.png" alt="WeiyiGeek.Client" title="" class=""></a>
                <p>WeiyiGeek.Client</p>
            </figure>
</li>
</ul>
<ul>
<li>Step3.æµ‹è¯•æ˜¯å¦é…ç½®æˆåŠŸ<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Client</span></span><br><span class="line">$ date -s <span class="string">'-1year'</span></span><br><span class="line">$ date 012000002019.00</span><br><span class="line">2019å¹´ 01æœˆ 20æ—¥ æ˜ŸæœŸæ—¥ 00:00:00 CST</span><br><span class="line">$ systemctl restart chronyd  <span class="comment">#é‡å¯åå¤§çº¦ä¸‰ç§’è¿›è¡Œæ—¶é—´åŒæ­¥</span></span><br><span class="line">$ date</span><br><span class="line">2019å¹´ 01æœˆ 20æ—¥ æ˜ŸæœŸæ—¥ 00:00:55 CST</span><br><span class="line">$ date</span><br><span class="line">2019å¹´ 01æœˆ 20æ—¥ æ˜ŸæœŸæ—¥ 00:00:57 CST</span><br><span class="line">$ date</span><br><span class="line">2019å¹´ 01æœˆ 20æ—¥ æ˜ŸæœŸæ—¥ 00:00:58 CST</span><br><span class="line">$ date</span><br><span class="line">2020å¹´ 05æœˆ 14æ—¥ æ˜ŸæœŸå›› 16:58:20 CST</span><br><span class="line">$ date</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸Šé¢æ˜¯æ‰‹åŠ¨ä¸‹é¢æˆ‘ä»¬å¯ä»¥å°†è¯¥å‘½ä»¤å†™å…¥timesync.shåŠ å…¥åˆ°crondä¸­æ¯ä¸‰åˆ†é’ŸåŒæ­¥ä¸€æ¬¡</span></span><br><span class="line">crond -e</span><br><span class="line">*/3 * * * * sh timesync.sh</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h3 id="3-systemd-timesyncd-æœåŠ¡"><a href="#3-systemd-timesyncd-æœåŠ¡" class="headerlink" title="(3) systemd-timesyncd æœåŠ¡"></a>(3) systemd-timesyncd æœåŠ¡</h3><p>æè¿°: åœ¨ Ubuntu 20.04 TLSä¸­å®‰è£…chronyè¿›è¡Œæ—¶é—´åŒæ­¥æ—¶æŠ¥å‡ºå¦‚ä¸‹é”™è¯¯ <code>systemd-timesyncd provides time-daemon and is present and installed.</code>, å‘ç°äº†åœ¨ ubuntuï¼Œdebianï¼ŒopenSUSE ç­‰ç³»ç»Ÿå…¶å®è‡ªå¸¦æ—¶é—´åŒæ­¥ systemd-timesyncd æœåŠ¡ï¼Œä¸‹é¢ä¸»è¦é’ˆå¯¹è¿™ä¸ªè¿›è¡Œä»‹ç»;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dpkg -i chrony_3.5-6ubuntu6.2_amd64.deb</span><br><span class="line">dpkg: regarding chrony_3.5-6ubuntu6.2_amd64.deb containing chrony:</span><br><span class="line"> chrony conflicts with time-daemon</span><br><span class="line">  systemd-timesyncd provides time-daemon and is present and installed.</span><br><span class="line">dpkg: error processing archive chrony_3.5-6ubuntu6.2_amd64.deb (--install):</span><br><span class="line"> conflicting packages - not installing chrony</span><br><span class="line">Errors were encountered <span class="keyword">while</span> processing:</span><br><span class="line"> chrony_3.5-6ubuntu6.2_amd64.deb</span><br></pre></td></tr></table></figure></p>
<p><strong>ç®€å•ä»‹ç»:</strong><br>æè¿°: systemd-timesyncd æ˜¯ä¸€ä¸ª åˆ©ç”¨è¿œç¨‹NTP(Network Time Protocol)æœåŠ¡å™¨åŒæ­¥æœ¬åœ°ç³»ç»Ÿæ—¶é—´çš„ç³»ç»ŸæœåŠ¡ã€‚ è¯¥æœåŠ¡è¿˜ä¼šåœ¨æ¯æ¬¡åŒæ­¥æˆåŠŸä¹‹åï¼Œ å°†è·å–åˆ°çš„æ—¶é—´ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œ ä»¥å°½å¯èƒ½ä¿è¯ ä¸‹ä¸€æ¬¡ç³»ç»Ÿå¯åŠ¨æ—¶æ‰€è·å¾—çš„æ—¶é—´æ˜¯å•è°ƒé€’å¢çš„ï¼Œ å³ä½¿åœ¨ä¸€ä¸ªæ²¡æœ‰ç”µæ± ä¾›ç”µRTC(real time clock)çš„ä¸»æœºä¸Šä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>
<p>systemd-timesyncd ä»…éµå®ˆç®€å•ç½‘ç»œæ—¶é—´åè®®(Simple Network Time protocol)ã€‚ å¯¹äºè¾ƒå¤§çš„æ—¶é—´å·®ï¼Œæ­¤æœåŠ¡åªä¼šç®€å•ç²—æš´çš„å°†ç³»ç»Ÿæ—¶é’Ÿç›´æ¥è®¾ç½®ä¸ºæ­£ç¡®çš„å€¼ï¼› å¯¹äºè¾ƒå°çš„æ—¶é—´å·®ï¼Œæ­¤æœåŠ¡æ‰ä¼šæ¸©å’Œå¹³æ»‘çš„å¾®è°ƒç³»ç»Ÿæ—¶é’Ÿåˆ°æ­£ç¡®çš„å€¼ã€‚ å¦‚æœéœ€è¦åº”å¯¹å¤æ‚åœºæ™¯ä¸‹çš„æ—¶é—´è°ƒæ•´ï¼Œ è¯·ä¸è¦ä½¿ç”¨ systemd-timesyncd ã€‚</p>
<p>ã€‚æˆ‘ä»¬å¯åœ¨/etc/systemd/timesyncd.conf ä¸­é…ç½®ä½ çš„ï¼ˆæ—¶é—´ï¼‰æœåŠ¡å™¨ï¼Œå¤§å¤šæ•° Linux å‘è¡Œç‰ˆéƒ½æä¾›äº†ä¸€ä¸ªé»˜è®¤é…ç½®ï¼Œå®ƒæŒ‡å‘å‘è¡Œç‰ˆç»´æŠ¤çš„æ—¶é—´æœåŠ¡å™¨ä¸Šã€‚</p>
<p>Tips : systemd-timesyncd æ˜¯æ–­ç‚¹å¼æ›´æ–°æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æ—¶é—´ä¸åŒç«‹å³æ›´æ–°ï¼Œè¿™æ ·ä¼šå¯¹æŸäº›æœåŠ¡äº§ç”Ÿå½±å“ï¼Œæ‰€ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒå°½é‡ä¸è¦ç”¨(æ¨èä½¿ç”¨chrony)ï¼Œåœ¨æ¡Œé¢ç¯å¢ƒæˆ–è€…æ˜¯ç³»ç»Ÿåˆšå¼€æœºæ—¶æ¥è¿›è¡Œæ—¶é—´åŒæ­¥è¿˜æ˜¯å¾ˆå¥½çš„ã€‚timesyncd æ›¿ä»£äº† ntpd çš„å®¢æˆ·ç«¯çš„éƒ¨åˆ†ã€‚é»˜è®¤æƒ…å†µä¸‹ timesyncd ä¼šå®šæœŸæ£€æµ‹å¹¶åŒæ­¥æ—¶é—´ã€‚å®ƒè¿˜ä¼šåœ¨æœ¬åœ°å­˜å‚¨æ›´æ–°çš„æ—¶é—´ï¼Œä»¥ä¾¿åœ¨ç³»ç»Ÿé‡å¯æ—¶åšæ—¶é—´å•æ­¥è°ƒæ•´ã€‚å¦‚æœæ˜¯è™šæ‹Ÿæœºç¯å¢ƒï¼Œåº”è¯¥æŠŠä¸ä¸»æœºæ—¶é—´åŒæ­¥åŠŸèƒ½å…³é—­ååœ¨å¯ç”¨systemd-timesyncdï¼Œå¦åˆ™å¯èƒ½ä¼šæœ‰é—®é¢˜ï¼Œsystemd-timesyncdåªèƒ½ä½œä¸ºå®¢æˆ·ç«¯ï¼Œä¸èƒ½ä½œä¸ºNTPæœåŠ¡å™¨ï¼Œè¦æˆä¸ºNTPæœåŠ¡å™¨ï¼Œå¯ä»¥å®‰è£…chronyã€ntpdæˆ–è€…open-ntpã€‚</p>
<p>Tips : systemd-timesyncdåªä¼šæ›´æ”¹ç³»ç»Ÿæ—¶é—´ä¸ä¼šæ›´æ”¹ç¡¬ä»¶æ—¶é—´ï¼Œå¯ä»¥é€šè¿‡<code>hwclock -w</code>å‘½ä»¤å°†ç³»ç»Ÿæ—¶é—´åŒæ­¥åˆ°ç¡¬ä»¶æ—¶é—´</p>
<p><br></p>
<p><strong>é…ç½®ä¸ä½¿ç”¨</strong></p>
<ul>
<li><p>1.systemd-timesyncd å¯åŠ¨æ—¶ä¼šè¯»å– /etc/systemd/timesyncd.conf é…ç½®æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">tee /etc/systemd/timesyncd.conf &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">[Time]</span><br><span class="line"><span class="comment"># ç©ºæ ¼åˆ†éš”çš„NTPæœåŠ¡å™¨åˆ—è¡¨,ä¾æ¬¡å°è¯•åˆ—è¡¨ä¸­çš„æ¯ä¸ªNTPæœåŠ¡å™¨ç›´åˆ°åŒæ­¥æˆåŠŸä¸ºæ­¢ã€‚</span></span><br><span class="line">NTP=ntp.aliyun.com ntp1.aliyun.com</span><br><span class="line"><span class="comment"># ç©ºæ ¼åˆ†éš”çš„NTPæœåŠ¡å™¨åˆ—è¡¨,ç”¨ä½œå¤‡ç”¨NTPæœåŠ¡å™¨ã€‚</span></span><br><span class="line">FallbackNTP=ntp.ubuntu.com</span><br><span class="line"><span class="comment"># æœ€å¤§å¯æ¥å—çš„"root distance"ç§’æ•°(æœ€å¤§è¯¯å·®)</span></span><br><span class="line">RootDistanceMaxSec=5</span><br><span class="line"><span class="comment"># NTPæ¶ˆæ¯çš„æœ€å°/æœ€å¤§è½®è¯¢é—´éš”ç§’æ•°(PollIntervalMinSec å¿…é¡»ä¸å°äº 16 ç§’)</span></span><br><span class="line">PollIntervalMinSec=32</span><br><span class="line">PollIntervalMaxSec=2048</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.ä¿®æ”¹åé‡å¯systemd-timesyncdæœåŠ¡ç”Ÿæ•ˆå¹¶æŸ¥çœ‹æœåŠ¡çŠ¶æ€</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart systemd-timesyncd.service  &amp;&amp; systemctl status systemd-timesyncd.service</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.é€šè¿‡timedatectlå‘½ä»¤æŸ¥çœ‹æ—¶é’Ÿæ˜¯å¦å¯åŠ¨NTPåŒæ­¥ï¼Œå¦‚æœæœªå¼€å¯NTPåŒæ­¥åˆ™é‡‡ç”¨<code>timedatectl set-ntp 1</code>è¿›è¡Œå¯ç”¨ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ timedatectl</span><br><span class="line">Local time: ä¸‰ 2021-07-14 10:29:18 CST       <span class="comment"># æœ¬åœ°æ—¶é—´</span></span><br><span class="line">  Universal time: ä¸‰ 2021-07-14 02:29:18 UTC <span class="comment"># åè°ƒä¸–ç•Œæ—¶</span></span><br><span class="line">        RTC time: ä¸‰ 2021-07-14 02:29:18     <span class="comment"># ç¡¬ä»¶æ—¶é—´</span></span><br><span class="line">       Time zone: Asia/Shanghai (CST, +0800) <span class="comment"># æ—¶åŒºï¼Œæˆ‘è¿™é‡Œä¸ºä¸œ8åŒº</span></span><br><span class="line">     NTP enabled: yes                        <span class="comment"># NTPæ—¶é—´åŒæ­¥æ˜¯å¦å¼€å¯ï¼Œyesè¡¨ç¤ºæ˜¯</span></span><br><span class="line">NTP synchronized: yes                        <span class="comment"># å¦‚æœå’Œè¿œç¨‹NTPæœåŠ¡å™¨æˆåŠŸåŒæ­¥ï¼Œæ˜¾ç¤ºä¸ºyes</span></span><br><span class="line"> RTC <span class="keyword">in</span> <span class="built_in">local</span> TZ: no                         <span class="comment"># noè¡¨ç¤ºç¡¬ä»¶æ—¶é’Ÿè®¾ç½®ä¸ºåè°ƒä¸–ç•Œæ—¶ï¼ˆUTCï¼‰ï¼Œyesè¡¨ç¤ºç¡¬ä»¶æ—¶é’Ÿè®¾ç½®ä¸ºæœ¬åœ°æ—¶é—´</span></span><br><span class="line">      DST active: n/a                        <span class="comment"># åˆ†å¸ƒå¼æ—¶é’Ÿ</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>4.åœ¨systemd 239åŠæ›´é«˜ç‰ˆæœ¬ä¸Šï¼ˆä¾‹å¦‚ï¼Œå®ƒåœ¨Ubuntu 18.04ä¸Šä¸èµ·ä½œç”¨ï¼Œå› ä¸ºå®ƒä½¿ç”¨systemd 237ï¼‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ˜¾ç¤º systemd-timesyncd çŠ¶æ€ <code>timedatectl show-timesync</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - æŸ¥çœ‹æ—¶é—´åŒæ­¥</span></span><br><span class="line">$ timedatectl show-timesync</span><br><span class="line">SystemNTPServers=192.168.10.254</span><br><span class="line">FallbackNTPServers=192.168.4.254</span><br><span class="line">ServerName=192.168.10.254</span><br><span class="line">ServerAddress=192.168.10.254</span><br><span class="line">RootDistanceMaxUSec=5s</span><br><span class="line">PollIntervalMinUSec=32s</span><br><span class="line">PollIntervalMaxUSec=34min 8s</span><br><span class="line">PollIntervalUSec=34min 8s</span><br><span class="line"><span class="comment"># åŒæ­¥çŠ¶æ€</span></span><br><span class="line">NTPMessage=&#123; Leap=0, Version=4, Mode=4, Stratum=3, Precision=-23, RootDelay=25.955ms, RootDispersion=25.772ms, Reference=78197314, OriginateTimestamp=Wed 2021-07-14 10:27:02 CST, ReceiveTimestamp=Wed 2021-07-14 10:27:02 CST, TransmitTimestamp=Wed 2021-07-14 10:27:02 CST, DestinationTimestamp=Wed 2021-07-14 10:27:02 CST, Ignored=no PacketCount=6, Jitter=10.499ms &#125;</span><br><span class="line">Frequency=1531722</span><br><span class="line"></span><br><span class="line"><span class="comment"># - æŸ¥çœ‹æ—¶é—´åŒæ­¥çŠ¶æ€</span></span><br><span class="line">$ timedatectl timesync-status</span><br><span class="line">       Server: 192.168.10.254 (192.168.10.254)</span><br><span class="line">Poll interval: 34min 8s (min: 32s; max 34min 8s)</span><br><span class="line">         Leap: normal</span><br><span class="line">      Version: 4</span><br><span class="line">      Stratum: 3</span><br><span class="line">    Reference: 78197314</span><br><span class="line">    Precision: 1us (-23)</span><br><span class="line">Root distance: 38.749ms (max: 5s)</span><br><span class="line">       Offset: +11.983ms</span><br><span class="line">        Delay: 1.304ms</span><br><span class="line">       Jitter: 10.499ms</span><br><span class="line"> Packet count: 6</span><br><span class="line">    Frequency: +23.372ppm</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="0x02-NTPå®¢æˆ·ç«¯é…ç½®"><a href="#0x02-NTPå®¢æˆ·ç«¯é…ç½®" class="headerlink" title="0x02 NTPå®¢æˆ·ç«¯é…ç½®"></a>0x02 NTPå®¢æˆ·ç«¯é…ç½®</h2><h3 id="Windows-æœåŠ¡å™¨"><a href="#Windows-æœåŠ¡å™¨" class="headerlink" title="Windows æœåŠ¡å™¨"></a>Windows æœåŠ¡å™¨</h3><p>æè¿°: ä¸ºäº†ä¿è¯NTPæœåŠ¡é…ç½®æˆåŠŸåèƒ½æ­£å¸¸åŒæ­¥æ—¶é—´ï¼Œå®ä¾‹ä¸­å¿…é¡»å¼€å¯NTPæœåŠ¡ï¼ŒWindows Serveræ“ä½œç³»ç»Ÿé»˜è®¤å¼€å¯Windows TimeæœåŠ¡</p>
<p>1.é€‰æ‹© å¼€å§‹ &gt; æ‰€æœ‰ç¨‹åº &gt; é™„ä»¶ &gt; è¿è¡Œï¼Œæ‰“å¼€è¿è¡Œå¯¹è¯æ¡†ï¼Œå¹¶è¿è¡Œå‘½ä»¤<code>services.msc</code>ã€‚</p>
<p>2.åœ¨æœåŠ¡å¯¹è¯æ¡†ä¸­ï¼Œæ‰¾åˆ°å¹¶åŒå‡»Windows TimeæœåŠ¡ï¼Œååˆ†é‡è¦å¦åˆ™æŠ¥é”™åŒæ­¥è¿æ¥è¶…æ—¶ã€‚</p>
<p>3.åœ¨Windows Timeçš„å±æ€§ï¼ˆæœ¬åœ°è®¡ç®—æœºï¼‰å¯¹è¯æ¡†ä¸­ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š<code>å°†å¯åŠ¨ç±»å‹è®¾ç½®ä¸ºè‡ªåŠ¨ï¼Œç¡®è®¤æœåŠ¡çŠ¶æ€ä¸ºå·²å¯åŠ¨ã€‚å¦‚æœä¸æ˜¯ï¼Œå•å‡»å¯åŠ¨ã€‚</code></p>
<p>4.ä¿®æ”¹æœåŠ¡å™¨é»˜è®¤NTPæœåŠ¡å™¨åœ°å€ä¸º:ntp.aliyun.com</p>
<figure class="image-box">
                <a rel=ä¼ä¸šå†…éƒ¨NTPæœåŠ¡å™¨åŸºç¡€å®‰è£…ä¸é…ç½®ä½¿ç”¨ href="https://img.weiyigeek.top/2020/1/20200115144000.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://img.weiyigeek.top/2020/1/20200115144000.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure>
<p><br/></p>
<p><strong>Q: å¦‚ä½•ä¿®æ”¹NTPæœåŠ¡æ—¶é—´åŒæ­¥é—´éš”ï¼Ÿ</strong><br>ç­”:NTPæœåŠ¡çš„æ—¶é—´åŒæ­¥é—´éš”é»˜è®¤æ˜¯5åˆ†é’Ÿï¼Œæ‚¨å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚è‡ªå®šä¹‰åŒæ­¥é—´éš”;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ³¨å†Œè¡¨ç¼–è¾‘å™¨: </span></span><br><span class="line">HKEY_LOCAL_MACHINE &gt; SYSTEM &gt; CurrentControlSet &gt; services &gt; W32Time &gt; TimeProviders &gt; NtpClient </span><br><span class="line">å¹¶åŒå‡»SpecialPollIntervalé”®å€¼,å¡«å…¥çš„æ•°å€¼å³æ˜¯æ‚¨éœ€è¦çš„åŒæ­¥æ—¶é—´é—´éš”ï¼ˆå•ä½ä¸ºç§’ï¼‰</span><br></pre></td></tr></table></figure>
<p>Tips: åœ¨ç¼–è¾‘ DWORD (32 ä½ï¼‰å€¼å¯¹è¯æ¡†ä¸­ï¼Œåœ¨åŸºæ•°æ é‡Œé€‰æ‹©åè¿›åˆ¶ï¼Œå¹¶æŒ‰éœ€è¦å¡«å†™æ•°å€¼æ•°æ®ã€‚</p>
<p><br></p>
<h3 id="Linux-æœåŠ¡å™¨"><a href="#Linux-æœåŠ¡å™¨" class="headerlink" title="Linux æœåŠ¡å™¨"></a>Linux æœåŠ¡å™¨</h3><p>æè¿°: åœ¨Linuxç³»ç»Ÿä¸­æ‚¨å¯ä»¥<code>é€šè¿‡ntpdateå’Œntpd</code> ä¸¤ç§å‘½ä»¤æ–¹å¼å®ç°NTPæ—¶é—´åŒæ­¥ä¸¤ç§æ–¹å¼çš„å¼‚åŒï¼›</p>
<ul>
<li><code>ntpdate ntp.aliyun.com</code> ä¸º<code>æ–­ç‚¹æ›´æ–°</code>ï¼Œåœ¨æœ€æ–°å®‰è£…ç³»ç»Ÿçš„æ—¶å€™æˆ–è€…æ²¡æœ‰ä¸šåŠ¡è¿è¡Œçš„æƒ…å†µä¸‹;</li>
<li><code>ntpd ntp.aliyun.com</code> ä¸º<code>æ­¥è¿›å¼åœ°</code>é€æ¸è°ƒæ•´æ—¶é—´ã€‚å¯¹å·²ç»æ‰¿è½½æœ‰è¿è¡Œä¸­ä¸šåŠ¡çš„å®ä¾‹å»ºè®®æ‚¨ä½¿ç”¨<code>ntpd</code>åŒæ­¥æ—¶é—´;</li>
</ul>
<p>ä»¥rootèº«ä»½æ‰“å¼€å¹¶ç¼–è¾‘æ—¶åŒºé…ç½®æ–‡ä»¶:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo rm /etc/localtime  <span class="comment">#åˆ é™¤ç³»ç»Ÿé‡Œçš„å½“åœ°æ—¶é—´é“¾æ¥</span></span><br><span class="line">ls /usr/share/zoneinfo  <span class="comment">#æŸ¥è¯¢æ—¶åŒºåˆ—è¡¨Shanghaiä¸ºåˆ—è¡¨æ¡ç›®ä¹‹ä¸€ã€‚</span></span><br><span class="line">sudo vi /etc/sysconfig/clock <span class="comment">#ç”¨vimæ‰“å¼€å¹¶ç¼–è¾‘é…ç½®æ–‡ä»¶/etc/sysconfig/clockã€‚</span></span><br><span class="line">è¾“å…¥iæ·»åŠ æ—¶åŒºåŸå¸‚ã€‚ä¾‹å¦‚æ·»åŠ Zone=Asia/Shanghaiï¼ŒæŒ‰ä¸‹Escé”®é€€å‡ºç¼–è¾‘å¹¶è¾“å…¥:wqä¿å­˜å¹¶é€€å‡ºã€‚</span><br><span class="line">sudo ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime  <span class="comment">#æ›´æ–°æ—¶åŒºä¿®æ”¹å†…å®¹ã€‚</span></span><br><span class="line">hwclock -w  <span class="comment">#æ›´æ–°ç¡¬ä»¶æ—¶é’Ÿï¼ˆRTCï¼‰ã€‚</span></span><br><span class="line"><span class="comment">#éªŒè¯æ‰§è¡Œå‘½ä»¤date -RæŸ¥çœ‹æ—¶åŒºä¿¡æ¯æ˜¯å¦ç”Ÿæ•ˆï¼Œæœªç”Ÿæ•ˆå¯æŒ‰ç…§ä¸Šè¿°æ­¥éª¤é‡æ–°æ“ä½œä¸€éã€‚</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>å¯ç”¨NTPæœåŠ¡</p>
<ol>
<li>æ‰§è¡Œå‘½ä»¤<code>ntpstat</code>æŸ¥çœ‹æ˜¯å¦å¯ç”¨äº†NTPæœåŠ¡ã€‚</li>
<li>æ‰§è¡Œå‘½ä»¤sudo vi /etc/ntp.confç”¨vimæ‰“å¼€å¹¶ç¼–è¾‘NTPæœåŠ¡é…ç½®æ–‡ä»¶ã€‚</li>
<li>æ–°æ·»åŠ ä¸€è¡ŒNTPæœåŠ¡å™¨ä¿¡æ¯æ ¼å¼ä¸ºï¼šserver æ‚¨éœ€è¦æ·»åŠ çš„NTPæœåŠ¡å™¨ iburst</li>
<li>æ‰§è¡Œå‘½ä»¤<code>sudo service ntpd start</code>è¿è¡ŒNTPæœåŠ¡ã€‚</li>
<li>æ‰§è¡Œå‘½ä»¤<code>chkconfig ntpd on</code>å¯ç”¨NTPæœåŠ¡ã€‚</li>
<li><strong>å¯é€‰ï¼š</strong> æ‰§è¡Œå‘½ä»¤ <code>ntpq -p</code> å¯æŸ¥çœ‹NTPæœåŠ¡å¯¹ç­‰ç«¯çš„åˆ—è¡¨ä¿¡æ¯æ‰§è¡Œå‘½ä»¤<code>sudo chkconfig --list ntpd</code>å¯æŸ¥çœ‹NTPæœåŠ¡çš„è¿è¡Œçº§åˆ«ã€‚</li>
</ol>
<p><br></p>
<p>Tips: å¦‚æœè®¡åˆ’ä»»åŠ¡æœ‰æ—¶é—´åŒæ­¥ï¼Œå…ˆæ³¨é‡Šä¸¤ç§ç”¨æ³•ä¼šå†²çªã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³é—­ ntpdate æ–¹å¼åŒæ­¥</span></span><br><span class="line">$ crontab -e</span><br><span class="line"><span class="comment"># time sync by oldboy at 2010-2-1</span></span><br><span class="line"><span class="comment">#*/5 * * * * /usr/sbin/ntpdate time.nist.gov &gt;/dev/null 2&gt;&amp;1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨ ntpd æ–¹å¼åŒæ­¥</span></span><br><span class="line">/etc/init.d/ntpd start</span><br><span class="line">ntpq -p</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="0x04-é…ç½®è§£æ-amp-éªŒè¯"><a href="#0x04-é…ç½®è§£æ-amp-éªŒè¯" class="headerlink" title="0x04 é…ç½®è§£æ&amp;éªŒè¯"></a>0x04 é…ç½®è§£æ&amp;éªŒè¯</h2><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><h4 id="etc-ntp-conf"><a href="#etc-ntp-conf" class="headerlink" title="/etc/ntp.conf"></a>/etc/ntp.conf</h4><p>æè¿°: ntpd æ ¹æ®é…ç½®æ–‡ä»¶ (<code>/etc/ntp.conf</code>) çš„å‚æ•°å†³å®šæ˜¯è¦ä¸ºå…¶ä»–æœåŠ¡å™¨æä¾›æ—¶é’ŸæœåŠ¡æˆ–è€…æ˜¯ä»å…¶ä»–æœåŠ¡å™¨åŒæ­¥æ—¶é’Ÿã€‚</p>
<p><strong>é…ç½®æ–‡ä»¶:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/ntp.conf, configuration for ntpd; see ntp.conf(5) for help</span></span><br><span class="line">driftfile /var/lib/ntp/ntp.drift</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”±tzdataæä¾›çš„é—°ç§’å®šä¹‰</span></span><br><span class="line"><span class="comment"># Leap seconds definition provided by tzdata</span></span><br><span class="line">leapfile /usr/share/zoneinfo/leap-seconds.list</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœå¸Œæœ›è®°å½•ç»Ÿè®¡æ•°æ®ï¼Œè¯·å¯ç”¨æ­¤é€‰é¡¹ã€‚</span></span><br><span class="line"><span class="comment">#statsdir /var/log/ntpstats/</span></span><br><span class="line">statistics loopstats peerstats clockstats</span><br><span class="line">filegen loopstats file loopstats <span class="built_in">type</span> day <span class="built_in">enable</span></span><br><span class="line">filegen peerstats file peerstats <span class="built_in">type</span> day <span class="built_in">enable</span></span><br><span class="line">filegen clockstats file clockstats <span class="built_in">type</span> day <span class="built_in">enable</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯·æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªNTPæœåŠ¡å™¨ã€‚ - Specify one or more NTP servers.</span></span><br><span class="line"><span class="comment"># Use servers from the NTP Pool Project. Approved by Ubuntu Technical Board</span></span><br><span class="line"><span class="comment"># on 2011-02-08 (LP: #104525). See http://www.pool.ntp.org/join.html for</span></span><br><span class="line"><span class="comment"># more information.</span></span><br><span class="line"><span class="comment">#pool 0.ubuntu.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#pool 1.ubuntu.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#pool 2.ubuntu.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#pool 3.ubuntu.pool.ntp.org iburst</span></span><br><span class="line">server ntp1.aliyun.com iburst</span><br><span class="line">server ntp2.aliyun.com iburst</span><br><span class="line">server 0.cn.pool.ntp.org iburst</span><br><span class="line">server 1.cn.pool.ntp.org iburst</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨Ubuntuçš„ntpæœåŠ¡å™¨ä½œä¸ºåå¤‡ã€‚</span></span><br><span class="line"><span class="comment"># Use Ubuntu's ntp server as a fallback.</span></span><br><span class="line">pool ntp.ubuntu.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># Access control configuration; see /usr/share/doc/ntp-doc/html/accopt.html for</span></span><br><span class="line"><span class="comment"># details.  The web page &lt;http://support.ntp.org/bin/view/Support/AccessRestrictions&gt;</span></span><br><span class="line"><span class="comment"># might also be helpful.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„â€œrestrictâ€åŒæ—¶é€‚ç”¨äºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ æ‰€ä»¥æ˜¯ä¸€ä¸ªé…ç½®</span></span><br><span class="line"><span class="comment"># å¯èƒ½ä¼šé˜»æ­¢æ¥è‡ªæŸäº›å®¢æˆ·ç«¯çš„è¯·æ±‚ä¹Ÿå¯èƒ½ä¼šç»“æŸ</span></span><br><span class="line"><span class="comment"># upé˜»å¡æ¥è‡ªä½ è‡ªå·±çš„ä¸Šæ¸¸æœåŠ¡å™¨çš„å›å¤ã€‚</span></span><br><span class="line"><span class="comment"># é»˜è®¤æƒ…å†µä¸‹ä¸æ‰€æœ‰äººäº¤æ¢æ—¶é—´ä½†ä¸å…è®¸é…ç½®ã€‚</span></span><br><span class="line">restrict -4 default kod notrap nomodify nopeer noquery </span><br><span class="line">restrict -6 default kod notrap nomodify nopeer noquery</span><br><span class="line"></span><br><span class="line"><span class="comment"># Local users may interrogate the ntp server more closely.</span></span><br><span class="line"><span class="comment"># å½“å‰èŠ‚ç‚¹IPåœ°å€</span></span><br><span class="line">restrict 192.168.10.1 nomodify notrap nopeer noquery</span><br><span class="line"><span class="comment">#é›†ç¾¤æ‰€åœ¨ç½‘æ®µçš„ç½‘å…³ï¼ˆGatewayï¼‰ï¼Œå­ç½‘æ©ç ï¼ˆGenmaskï¼‰</span></span><br><span class="line">restrict 192.168.10.1 mask 255.255.255.0 nomodify notrap  </span><br><span class="line">restrict 192.168.12.254 nomodify notrap nopeer noquery</span><br><span class="line">restrict 127.0.0.1</span><br><span class="line">restrict ::1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Needed for adding pool entries</span></span><br><span class="line">restrict <span class="built_in">source</span> notrap nomodify noquery</span><br><span class="line"></span><br><span class="line"><span class="comment"># Clients from this (example!) subnet have unlimited access, but only if</span></span><br><span class="line"><span class="comment"># cryptographically authenticated.</span></span><br><span class="line"><span class="comment"># restrict 192.168.123.0 mask 255.255.255.0 notrust</span></span><br><span class="line"><span class="comment"># é›†ç¾¤æ‰€åœ¨ç½‘æ®µçš„ç½‘å…³ï¼ˆGatewayï¼‰ï¼Œå­ç½‘æ©ç ï¼ˆGenmaskï¼‰</span></span><br><span class="line">restrict 192.168.12.61 mask 255.255.255.0 nomodify notrap </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœè¦ä¸ºæœ¬åœ°å­ç½‘æä¾›æ—¶é—´ï¼Œè¯·æ›´æ”¹ä¸‹ä¸€è¡Œã€‚</span></span><br><span class="line"><span class="comment"># (Again, the address is an example only.)</span></span><br><span class="line">broadcast 192.168.12.255</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœä½ æƒ³åœ¨ä½ çš„æœ¬åœ°å­ç½‘ä¸Šæ”¶å¬æ—¶é—´å¹¿æ’­ï¼Œå–æ¶ˆæ³¨é‡Š</span></span><br><span class="line"><span class="comment"># next lines.  Please do this only if you trust everybody on the network!</span></span><br><span class="line"><span class="comment">#disable auth</span></span><br><span class="line"><span class="comment">#broadcastclient</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>é…ç½®æ–‡ä»¶è¯´æ˜ï¼š</strong></p>
<ul>
<li><p>restrict é€‰é¡¹æ ¼å¼</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- restrict [ å®¢æˆ·ç«¯IP ]  mask  [ IPæ©ç  ]  [å‚æ•°]</span><br><span class="line"><span class="comment"># æ“ä½œå¯¹è±¡:</span></span><br><span class="line">â€œå®¢æˆ·ç«¯IPâ€ å’Œ â€œIPæ©ç â€ æŒ‡å®šäº†å¯¹ç½‘ç»œä¸­å“ªäº›èŒƒå›´çš„è®¡ç®—æœºè¿›è¡Œæ§åˆ¶ï¼Œå¦‚æœä½¿ç”¨defaultå…³é”®å­—åˆ™è¡¨ç¤ºå¯¹æ‰€æœ‰çš„è®¡ç®—æœºè¿›è¡Œæ§åˆ¶.</span><br><span class="line"><span class="comment"># å‚æ•°ï¼š</span></span><br><span class="line">* kodï¼š å‘ä¸å®‰å…¨çš„è®¿é—®è€…å‘é€ Kiss-Of-Death æŠ¥æ–‡ã€‚</span><br><span class="line">* ignoreï¼šæ‹’ç»è¿æ¥åˆ°NTPæœåŠ¡å™¨ã€‚</span><br><span class="line">* nomodifyï¼š å®¢æˆ·ç«¯ä¸èƒ½æ›´æ”¹æœåŠ¡ç«¯çš„æ—¶é—´å‚æ•°ï¼Œä½†æ˜¯å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡æœåŠ¡ç«¯è¿›è¡Œç½‘ç»œæ ¡æ—¶ã€‚</span><br><span class="line">* noqueryï¼š ä¸æä¾›å®¢æˆ·ç«¯çš„æ—¶é—´æŸ¥è¯¢ã€‚</span><br><span class="line">* notrapï¼š ä¸æä¾›<span class="built_in">trap</span>è¿œç¨‹ç™»å½•åŠŸèƒ½ï¼Œ<span class="built_in">trap</span>æœåŠ¡æ˜¯ä¸€ç§è¿œç¨‹æ—¶é—´æ—¥å¿—æœåŠ¡ã€‚</span><br><span class="line">* notrustï¼š å®¢æˆ·ç«¯é™¤éé€šè¿‡è®¤è¯ï¼Œå¦åˆ™è¯¥å®¢æˆ·ç«¯æ¥æºå°†è¢«è§†ä¸ºä¸ä¿¡ä»»å­ç½‘ ã€‚</span><br><span class="line">* nopeerï¼š æä¾›æ—¶é—´æœåŠ¡ï¼Œä½†ä¸ä½œä¸ºå¯¹ç­‰ä½“ã€‚</span><br></pre></td></tr></table></figure>
</li>
<li><p>server é€‰é¡¹æ ¼å¼</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- server host  [ key n ] [ version n ] [ prefer ] [ mode n ] [ minpoll n ] [ maxpoll n ] [ iburst ]</span><br><span class="line"><span class="comment"># å‚æ•°:</span></span><br><span class="line">- host ï¼šæ˜¯ä¸Šå±‚NTPæœåŠ¡å™¨çš„IPåœ°å€æˆ–åŸŸå</span><br><span class="line">* keyï¼š è¡¨ç¤ºæ‰€æœ‰å‘å¾€æœåŠ¡å™¨çš„æŠ¥æ–‡åŒ…å«æœ‰ç§˜é’¥åŠ å¯†çš„è®¤è¯ä¿¡æ¯ï¼Œnæ˜¯32ä½çš„æ•´æ•°ï¼Œè¡¨ç¤ºç§˜é’¥å·ã€‚</span><br><span class="line">* versionï¼š è¡¨ç¤ºå‘å¾€ä¸Šå±‚æœåŠ¡å™¨çš„æŠ¥æ–‡ä½¿ç”¨çš„ç‰ˆæœ¬å·ï¼Œné»˜è®¤æ˜¯3ï¼Œå¯ä»¥æ˜¯1æˆ–è€…2ã€‚</span><br><span class="line">* preferï¼š å¦‚æœæœ‰å¤šä¸ªserveré€‰é¡¹ï¼Œå…·æœ‰è¯¥å‚æ•°çš„æœåŠ¡å™¨æœ‰é™ä½¿ç”¨ã€‚</span><br><span class="line">* modeï¼š æŒ‡å®šæ•°æ®æŠ¥æ–‡modeå­—æ®µçš„å€¼ã€‚</span><br><span class="line">* minpollï¼š æŒ‡å®šä¸æŸ¥è¯¢è¯¥æœåŠ¡å™¨çš„æœ€å°æ—¶é—´é—´éš”ä¸º2çš„næ¬¡æ–¹ç§’ï¼Œné»˜è®¤ä¸º6ï¼ŒèŒƒå›´ä¸º4-14ã€‚</span><br><span class="line">* maxpollï¼š  æŒ‡å®šä¸æŸ¥è¯¢è¯¥æœåŠ¡å™¨çš„æœ€å¤§æ—¶é—´é—´éš”ä¸º2çš„næ¬¡æ–¹ç§’ï¼Œné»˜è®¤ä¸º10ï¼ŒèŒƒå›´ä¸º4-14ã€‚</span><br><span class="line">* iburstï¼š å½“åˆå§‹åŒæ­¥è¯·æ±‚æ—¶ï¼Œé‡‡ç”¨çªå‘æ–¹å¼æ¥è¿å‘é€8ä¸ªæŠ¥æ–‡ï¼Œæ—¶é—´é—´éš”ä¸º2ç§’ã€‚</span><br></pre></td></tr></table></figure>
</li>
<li><p>fudge é€‰é¡¹æ ¼å¼:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‚æ•°: </span></span><br><span class="line">- stratum : å³å±‚æ¬¡æ ¹æ®ä¸Šå±‚serverçš„å±‚æ¬¡è€Œè®¾å®š(+1) å¯¹äºæä¾› `network time service provider` çš„ä¸»æœºæ¥è¯´ stratum çš„è®¾å®šè¦å°½å¯èƒ½å‡†ç¡®ã€‚è€Œä½œä¸ºå±€åŸŸç½‘çš„ `time service provider `é€šå¸¸å°†`stratum` è®¾ç½®ä¸º10ï¼Œå…¶å–å€¼èŒƒå›´æ˜¯0-15;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<p><strong>è¡¥å……è¯´æ˜:</strong><br>æè¿°: 0 å±‚çš„æœåŠ¡å™¨é‡‡ç”¨çš„æ˜¯åŸå­é’Ÿã€GPSé’Ÿç­‰ç‰©ç†è®¾å¤‡ï¼Œstratum 1 ä¸ stratum 0 æ˜¯ç›´æ¥ç›¸è¿çš„ï¼Œå¾€åçš„stratum ä¸ä¸Šä¸€å±‚ stratum é€šè¿‡ç½‘ç»œç›¸è¿åŒä¸€å±‚çš„ server ä¹Ÿå¯ä»¥äº¤äº’ã€‚</p>
<p>Tips: ntpd å¯¹ä¸‹å±‚ client æ¥è¯´æ˜¯ service serverï¼Œå¯¹äºä¸Šå±‚ server æ¥è¯´å®ƒæ˜¯clientã€‚</p>
<figure class="image-box">
                <a rel=ä¼ä¸šå†…éƒ¨NTPæœåŠ¡å™¨åŸºç¡€å®‰è£…ä¸é…ç½®ä½¿ç”¨ href="https://img.weiyigeek.top/2021/1/20210319143801.png" target="_blank" title="WeiyiGeek.åŒæ­¥ç¤ºæ„å›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2021/1/20210319143801.png" alt="WeiyiGeek.åŒæ­¥ç¤ºæ„å›¾" title="" class=""></a>
                <p>WeiyiGeek.åŒæ­¥ç¤ºæ„å›¾</p>
            </figure>
<p><br/></p>
<p><strong>é…ç½®ç¤ºä¾‹:</strong></p>
<p>ä¾‹å¦‚: å¿«é€Ÿé…ç½®é˜¿é‡Œå·´å·´ <code>OPSX NTP</code> æœåŠ¡ç¼–è¾‘æ–‡ä»¶ â€œ/etc/ntp.confâ€ï¼Œæ ¹æ®æƒ…å†µä¿®æ”¹æ–‡ä»¶å†…å®¹ä¸ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">driftfile  &#x2F;var&#x2F;lib&#x2F;ntp&#x2F;drift</span><br><span class="line">pidfile   &#x2F;var&#x2F;run&#x2F;ntpd.pid</span><br><span class="line">logfile &#x2F;var&#x2F;log&#x2F;ntp.log</span><br><span class="line">restrict    default kod nomodify notrap nopeer noquery</span><br><span class="line">restrict -6 default kod nomodify notrap nopeer noquery</span><br><span class="line">restrict 127.0.0.1</span><br><span class="line">server 127.127.1.0</span><br><span class="line">fudge  127.127.1.0 stratum 10</span><br><span class="line">server ntp.aliyun.com iburst minpoll 4 maxpoll 10</span><br><span class="line">restrict ntp.aliyun.com nomodify notrap nopeer noquery</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>ä¾‹å¦‚ï¼Œè…¾è®¯äº‘æœåŠ¡å™¨ä¸­,é»˜è®¤çš„<code>/etc/ntp.conf</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹,æ³¨æ„ tencentyun.com æ˜¯å†…ç½‘åœ°å€ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">driftfile /var/lib/ntp/ntp.drift</span><br><span class="line">statistics loopstats peerstats clockstats</span><br><span class="line">filegen loopstats file loopstats <span class="built_in">type</span> day <span class="built_in">enable</span></span><br><span class="line">filegen peerstats file peerstats <span class="built_in">type</span> day <span class="built_in">enable</span></span><br><span class="line">filegen clockstats file clockstats <span class="built_in">type</span> day <span class="built_in">enable</span></span><br><span class="line">restrict -4 default kod notrap nomodify nopeer noquery limited</span><br><span class="line">restrict -6 default kod notrap nomodify nopeer noquery limited</span><br><span class="line">restrict 127.0.0.1</span><br><span class="line">restrict ::1</span><br><span class="line">restrict <span class="built_in">source</span> notrap nomodify noquery</span><br><span class="line">server time1.tencentyun.com iburst</span><br><span class="line">server time2.tencentyun.com iburst</span><br><span class="line">server time3.tencentyun.com iburst</span><br><span class="line">server time4.tencentyun.com iburst</span><br><span class="line">server time5.tencentyun.com iburst</span><br><span class="line">interface ignore wildcard</span><br><span class="line">interface listen eth0</span><br></pre></td></tr></table></figure></p>
<p>è…¾è®¯äº‘NTPæœåŠ¡å™¨å¤–ç½‘åœ°å€:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ntp.tencent.com</span><br><span class="line">ntp1.tencent.com</span><br><span class="line">ntp2.tencent.com</span><br><span class="line">ntp3.tencent.com</span><br><span class="line">ntp4.tencent.com</span><br><span class="line">ntp5.tencent.com</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>ä¾‹å¦‚: ä¼ä¸šå†…éƒ¨ä½¿ç”¨çš„ntp.confç¤ºä¾‹(ntpd 4.2.8 )<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.æ¼‚ç§»æ–‡ä»¶ -&gt; å…¶å†…å®¹ä¸º3.031</span></span><br><span class="line">driftfile /var/lib/ntp/ntp.drift</span><br><span class="line"><span class="comment"># 2.ç”±tzdataæä¾›çš„é—°ç§’å®šä¹‰</span></span><br><span class="line">leapfile /usr/share/zoneinfo/leap-seconds.list</span><br><span class="line"><span class="comment"># 3.å¦‚æœå¸Œæœ›è®°å½•ç»Ÿè®¡æ•°æ®è¯·å¯ç”¨æ­¤é€‰é¡¹ã€‚</span></span><br><span class="line"><span class="comment"># statsdir /var/log/ntpstats/</span></span><br><span class="line"><span class="comment"># statistics loopstats peerstats clockstats</span></span><br><span class="line"><span class="comment"># filegen loopstats file loopstats type day enable</span></span><br><span class="line"><span class="comment"># filegen peerstats file peerstats type day enable</span></span><br><span class="line"><span class="comment"># filegen clockstats file clockstats type day enable</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.restrict åŒæ—¶é€‚ç”¨äºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯</span></span><br><span class="line">restrict -4 default kod notrap nomodify nopeer noquery </span><br><span class="line">restrict -6 default kod notrap nomodify nopeer noquery</span><br><span class="line"><span class="comment"># æœ¬åœ°ç”¨æˆ·å¯èƒ½ä¼šæ›´å¯†åˆ‡åœ°è¯¢é—®ntpæœåŠ¡å™¨ã€‚</span></span><br><span class="line">restrict 192.168.12.254 nomodify notrap  noquery</span><br><span class="line">restrict 127.0.0.1</span><br><span class="line">restrict ::1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.è¯·æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªNTPæœåŠ¡å™¨ã€‚</span></span><br><span class="line"><span class="comment"># 5.1 é€šè¿‡ç½‘ç»œåŒæ­¥æ—¶é—´</span></span><br><span class="line">server ntp1.aliyun.com iburst minpoll 4 maxpoll 10</span><br><span class="line">server ntp2.aliyun.com iburst minpoll 4 maxpoll 10</span><br><span class="line">server ntp3.aliyun.com iburst minpoll 4 maxpoll 10</span><br><span class="line">server 0.cn.pool.ntp.org iburst minpoll 4 maxpoll 10</span><br><span class="line">server 1.cn.pool.ntp.org iburst minpoll 4 maxpoll 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.2 ä½¿ç”¨æœ¬åœ°æ—¶é—´</span></span><br><span class="line"><span class="comment"># serverè‡ªèº«å’Œè°åŒæ­¥</span></span><br><span class="line">server ntp.aliyun.com prefer</span><br><span class="line"><span class="comment"># æŠŠè‡ªèº«çš„æ—¶é—´åŒæ­¥ç»™å®¢æˆ·ç«¯,å³å½“æ²¡æœ‰æ—¶é—´åŒæ­¥æ¥æºçš„æ—¶å€™ä»¥è‡ªèº«çš„ç¡¬ä»¶æ—¶é’Ÿä¸ºå‡†,æ­¤å¤„stratumæ˜¯ä»£è¡¨å±‚çº§é»˜è®¤æ˜¯10ã€‚</span></span><br><span class="line">server 127.127.1.0</span><br><span class="line">fudge 127.127.1.0 stratum  10</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.éœ€è¦æ·»åŠ æ± æ¡ç›®ä»¥åŠå¤‡ç”¨æ± </span></span><br><span class="line">restrict <span class="built_in">source</span> notrap nomodify noquery</span><br><span class="line">restrict ntp.aliyun.com nomodify notrap noquery</span><br><span class="line">pool ntp.aliyun.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.å¦‚æœè¦ä¸ºæœ¬åœ°å­ç½‘æä¾›æ—¶é—´</span></span><br><span class="line"><span class="comment"># broadcast 192.168.12.255</span></span><br><span class="line"><span class="comment"># disable auth</span></span><br><span class="line"><span class="comment"># broadcastclient</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>Tips: è¡¥å……è¯´æ˜å…è®¸é‚£äº›ç½‘æ®µæˆ–è€…IPåŒæ­¥ï¼Œä¸åšé™åˆ¶åˆ™0.0.0.0 mask 0.0.0.0.éœ€è¦æ³¨æ„çš„æ˜¯4.2ç‰ˆæœ¬çš„ntpdçš„restrictå‚æ•°ä¸è¦åŠ notrustå¦åˆ™å®¢æˆ·ç«¯ä¼šåŒæ­¥ä¸äº†ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">restrict 192.168.80.0 mask 255.255.255.0 nomodify notrap</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="etc-chrony-conf"><a href="#etc-chrony-conf" class="headerlink" title="/etc/chrony.conf"></a>/etc/chrony.conf</h4><p>ä¾‹å¦‚:å¯¹äºä½¿ç”¨ chrony å®¢æˆ·ç«¯çš„ linux ä¸»æœºé…ç½® <code>&#39;/etc/chrony.conf&#39;</code>æ–‡ä»¶çš„å†…å®¹ä¸ºï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€ç¤ºä¾‹1</span></span><br><span class="line">server ntp.aliyun.com iburst</span><br><span class="line">stratumweight 0</span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line">rtcsync</span><br><span class="line">makestep 10 3</span><br><span class="line">bindcmdaddress 127.0.0.1</span><br><span class="line">bindcmdaddress ::1</span><br><span class="line">keyfile /etc/chrony.keys</span><br><span class="line">commandkey 1</span><br><span class="line">generatecommandkey</span><br><span class="line">logchange 0.5</span><br><span class="line">logdir /var/<span class="built_in">log</span>/chrony</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŸºç¡€ç¤ºä¾‹2</span></span><br><span class="line">pool 192.168.12.254 iburst maxsources 1</span><br><span class="line">pool 192.168.10.254 iburst maxsources 1</span><br><span class="line">pool 192.168.4.254 iburst maxsources 1</span><br><span class="line">pool ntp.aliyun.com iburst maxsources 4</span><br><span class="line">keyfile /etc/chrony/chrony.keys</span><br><span class="line">driftfile /var/lib/chrony/chrony.drift</span><br><span class="line">logdir /var/<span class="built_in">log</span>/chrony</span><br><span class="line">maxupdateskew 100.0</span><br><span class="line"><span class="comment"># å¯ç”¨å®æ—¶æ—¶é’Ÿï¼ˆRTCï¼‰çš„å†…æ ¸åŒæ­¥ã€‚</span></span><br><span class="line">rtcsync</span><br><span class="line">makestep 10 3</span><br></pre></td></tr></table></figure></p>
<p>å‚è€ƒåœ°å€: <a href="https://chrony.tuxfamily.org/doc/3.5/chrony.conf.html" target="_blank" rel="noopener">https://chrony.tuxfamily.org/doc/3.5/chrony.conf.html</a></p>
<p><br></p>
<h3 id="æ ¸éªŒå·¥å…·"><a href="#æ ¸éªŒå·¥å…·" class="headerlink" title="æ ¸éªŒå·¥å…·"></a>æ ¸éªŒå·¥å…·</h3><h4 id="ntpd-å‘½ä»¤"><a href="#ntpd-å‘½ä»¤" class="headerlink" title="ntpd å‘½ä»¤"></a>ntpd å‘½ä»¤</h4><p>æè¿°: NTPå®ˆæŠ¤ç¨‹åº</p>
<p>è¯­æ³•å‚æ•°:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">ntpd - NTP daemon program - Ver. 4.2.8p12</span><br><span class="line">Usage:  ntpd [ -&lt;flag&gt; [&lt;val&gt;] | --&lt;name&gt;[&#123;=| &#125;&lt;val&gt;] ]...  [ &lt;server1&gt; ... &lt;serverN&gt; ]</span><br><span class="line">  Flg Arg Option-Name    Description</span><br><span class="line">   -4 no  ipv4           Force IPv4 DNS name resolution</span><br><span class="line">                                - prohibits the option <span class="string">'ipv6'</span></span><br><span class="line">   -6 no  ipv6           Force IPv6 DNS name resolution</span><br><span class="line">                                - prohibits the option <span class="string">'ipv4'</span></span><br><span class="line">   -a no  authreq        Require crypto authentication</span><br><span class="line">                                - prohibits the option <span class="string">'authnoreq'</span></span><br><span class="line">   -A no  authnoreq      Do not require crypto authentication</span><br><span class="line">                                - prohibits the option <span class="string">'authreq'</span></span><br><span class="line">   -b no  bcastsync      Allow us to sync to broadcast servers</span><br><span class="line">   -c Str configfile     configuration file name</span><br><span class="line">   -d no  debug-level    Increase debug verbosity level</span><br><span class="line">                                - may appear multiple <span class="built_in">times</span></span><br><span class="line">   -D Num <span class="built_in">set</span>-debug-level Set the debug verbosity level</span><br><span class="line">                                - may appear multiple <span class="built_in">times</span></span><br><span class="line">   -f Str driftfile      frequency drift file name</span><br><span class="line">   -g no  panicgate      Allow the first adjustment to be Big</span><br><span class="line">                                - may appear multiple <span class="built_in">times</span></span><br><span class="line">   -G no  force-step-once Step any initial offset correction.</span><br><span class="line">   -i Str jaildir        Jail directory</span><br><span class="line">   -I Str interface      Listen on an interface name or address</span><br><span class="line">                                - may appear multiple <span class="built_in">times</span></span><br><span class="line">   -k Str keyfile        path to symmetric keys</span><br><span class="line">   -l Str logfile        path to the <span class="built_in">log</span> file</span><br><span class="line">   -L no  novirtualips   Do not listen to virtual interfaces</span><br><span class="line">   -n no  nofork         Do not fork</span><br><span class="line">                                - prohibits the option <span class="string">'wait-sync'</span></span><br><span class="line">   -N no  nice           Run at high priority</span><br><span class="line">   -p Str pidfile        path to the PID file</span><br><span class="line">   -P Num priority       Process priority</span><br><span class="line">   -q no  quit           Set the time and quit</span><br><span class="line">                                - prohibits these options:</span><br><span class="line">                                saveconfigquit</span><br><span class="line">                                <span class="built_in">wait</span>-sync</span><br><span class="line">   -r Str propagationdelay Broadcast/propagation delay</span><br><span class="line">      Str saveconfigquit Save parsed configuration and quit</span><br><span class="line">                                - prohibits these options:</span><br><span class="line">                                quit</span><br><span class="line">                                <span class="built_in">wait</span>-sync</span><br><span class="line">   -s Str statsdir       Statistics file location</span><br><span class="line">   -t Str trustedkey     Trusted key number</span><br><span class="line">                                - may appear multiple <span class="built_in">times</span></span><br><span class="line">   -u Str user           Run as userid (or userid:groupid)</span><br><span class="line">   -U Num updateinterval interval <span class="keyword">in</span> seconds between scans <span class="keyword">for</span> new or dropped interfaces</span><br><span class="line">      Str var            make ARG an ntp variable (RW)</span><br><span class="line">                                - may appear multiple <span class="built_in">times</span></span><br><span class="line">      Str dvar           make ARG an ntp variable (RW|DEF)</span><br><span class="line">                                - may appear multiple <span class="built_in">times</span></span><br><span class="line">   -w Num <span class="built_in">wait</span>-sync      Seconds to <span class="built_in">wait</span> <span class="keyword">for</span> first clock sync</span><br><span class="line">                                - prohibits these options:</span><br><span class="line">                                nofork</span><br><span class="line">                                quit</span><br><span class="line">                                saveconfigquit</span><br><span class="line">   -x no  slew           Slew up to 600 seconds</span><br><span class="line">      opt version        output version information and <span class="built_in">exit</span></span><br><span class="line">   -? no  <span class="built_in">help</span>           display extended usage information and <span class="built_in">exit</span></span><br><span class="line">   -! no  more-help      extended usage information passed thru pager</span><br></pre></td></tr></table></figure></p>
<p>åŸºç¡€å‘½ä»¤:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) é€šè¿‡binç›®å½•ä¸‹çš„è„šæœ¬å¯åŠ¨</span></span><br><span class="line">/usr/<span class="built_in">local</span>/ntp/bin/ntpd -c /etc/ntp.conf -p /tmp/ntpd.pid</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="ntpdate-å‘½ä»¤"><a href="#ntpdate-å‘½ä»¤" class="headerlink" title="ntpdate å‘½ä»¤"></a>ntpdate å‘½ä»¤</h4><p>æè¿°: é€šè¿‡NTPè®¾ç½®æ—¥æœŸå’Œæ—¶é—´;</p>
<p><strong>è¯­æ³•å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ntpdate [-46bBdqsuv] [-a key] [-e authdelay] [-k keyfile] [-o version] [-p samples] [-t timeout] server [...]</span><br></pre></td></tr></table></figure></p>
<p><strong>åŸºç¡€å®ä¾‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€è°ƒè¯•</span></span><br><span class="line">$ ntpdate -d 192.168.12.254</span><br><span class="line">19 Mar 15:44:30 ntpdate[989474]: ntpdate 4.2.8p12@1.3728-o (1)</span><br><span class="line">Looking <span class="keyword">for</span> host 192.168.12.254 and service ntp</span><br><span class="line">host found : 192.168.12.254</span><br><span class="line">transmit(192.168.12.254)</span><br><span class="line">receive(192.168.12.254)</span><br><span class="line">....</span><br><span class="line">transmit(192.168.12.254)</span><br><span class="line">receive(192.168.12.254)</span><br><span class="line"></span><br><span class="line">server 192.168.12.254, port 123</span><br><span class="line">stratum 3, precision -24, leap 00, trust 000</span><br><span class="line">refid [120.25.115.20], root delay 0.034073, root dispersion 0.014389</span><br><span class="line">transmitted 4, <span class="keyword">in</span> filter 4</span><br><span class="line">reference time:    e3fed42b.d735a7b4  Fri, Mar 19 2021 15:41:31.840</span><br><span class="line">originate timestamp: e3fed4e4.d942360e  Fri, Mar 19 2021 15:44:36.848</span><br><span class="line">transmit timestamp:  e3fed4e4.d9081cab  Fri, Mar 19 2021 15:44:36.847</span><br><span class="line">filter delay:  0.02577  0.02576  0.02576  0.02577</span><br><span class="line">         0.00000  0.00000  0.00000  0.00000</span><br><span class="line">filter offset: 0.000817 0.000793 0.000781 0.000769</span><br><span class="line">         0.000000 0.000000 0.000000 0.000000</span><br><span class="line">delay 0.02576, dispersion 0.00000</span><br><span class="line">offset 0.000793</span><br><span class="line"></span><br><span class="line">19 Mar 15:44:36 ntpdate[989474]: adjust time server 192.168.12.254 offset 0.000793 sec</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="ntpstat-å‘½ä»¤-æ˜¾ç¤ºç½‘ç»œæ—¶é—´åŒæ­¥çŠ¶æ€"><a href="#ntpstat-å‘½ä»¤-æ˜¾ç¤ºç½‘ç»œæ—¶é—´åŒæ­¥çŠ¶æ€" class="headerlink" title="ntpstat å‘½ä»¤ - æ˜¾ç¤ºç½‘ç»œæ—¶é—´åŒæ­¥çŠ¶æ€"></a>ntpstat å‘½ä»¤ - æ˜¾ç¤ºç½‘ç»œæ—¶é—´åŒæ­¥çŠ¶æ€</h4><p>æè¿°: ntpstatå°†æŠ¥å‘Šåœ¨æœ¬åœ°è®¡ç®—æœºä¸Šè¿è¡Œçš„NTPå®ˆæŠ¤ç¨‹åºï¼ˆntpdï¼‰çš„åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœå‘ç°æœ¬åœ°ç³»ç»Ÿä¸å‚è€ƒæ—¶é—´æºåŒæ­¥ï¼Œåˆ™ntpstatå°†æŠ¥å‘Šå¤§è‡´çš„æ—¶é—´ç²¾åº¦ã€‚</p>
<p>ntpstatå‘½ä»¤æ ¹æ®NTPåŒæ­¥è¿”å›ä¸‰ç§çŠ¶æ€ä»£ç è¯¦æƒ…å¦‚ä¸‹ï¼š</p>
<ul>
<li>0ï¼šå¦‚æœæ—¶é’ŸåŒæ­¥ï¼Œåˆ™è¿”å›0ã€‚</li>
<li>1ï¼šå¦‚æœæ—¶é’Ÿä¸åŒæ­¥ï¼Œåˆ™è¿”å›1ã€‚</li>
<li>2ï¼šå¦‚æœæ—¶é’ŸçŠ¶æ€ä¸ç¡®å®šï¼Œåˆ™è¿”å›2ï¼Œä¾‹å¦‚ï¼Œå¦‚æœntpdä¸å¯è”ç³»ã€‚</li>
</ul>
<p>åŸºç¡€ç¤ºä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.åœ¨ç¬¬3å±‚åŒæ­¥åˆ°NTPæœåŠ¡å™¨ï¼ˆ120.25.115.20ï¼‰ï¼Œæ—¶é—´åœ¨56æ¯«ç§’å†…çº æ­£ï¼Œæ¯éš”1024ç§’è½®è¯¢ä¸€æ¬¡æœåŠ¡å™¨ã€‚</span></span><br><span class="line">$ ntpstat</span><br><span class="line">synchronised to NTP server (120.25.115.20) at stratum 3</span><br><span class="line">   time correct to within 56 ms</span><br><span class="line">   polling server every 1024 s</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="ntpq-å‘½ä»¤-æ ‡å‡†çš„NTPæŸ¥è¯¢ç¨‹åº"><a href="#ntpq-å‘½ä»¤-æ ‡å‡†çš„NTPæŸ¥è¯¢ç¨‹åº" class="headerlink" title="ntpq å‘½ä»¤ - æ ‡å‡†çš„NTPæŸ¥è¯¢ç¨‹åº"></a>ntpq å‘½ä»¤ - æ ‡å‡†çš„NTPæŸ¥è¯¢ç¨‹åº</h4><p>æè¿°: æ ‡å‡†çš„NTPæŸ¥è¯¢ç¨‹åº</p>
<p>è¯­æ³•å‚æ•°:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">ntpq - standard NTP query program - Ver. 4.2.8p12</span><br><span class="line">Usage:  ntpq [ -&lt;flag&gt; [&lt;val&gt;] | --&lt;name&gt;[&#123;=| &#125;&lt;val&gt;] ]... [ host ...]</span><br><span class="line">  Flg Arg Option-Name    Description</span><br><span class="line">   -4 no  ipv4           Force IPv4 name resolution</span><br><span class="line">                                - prohibits the option <span class="string">'ipv6'</span></span><br><span class="line">   -6 no  ipv6           Force IPv6 name resolution</span><br><span class="line">                                - prohibits the option <span class="string">'ipv4'</span></span><br><span class="line">   -c Str <span class="built_in">command</span>        run a <span class="built_in">command</span> and <span class="built_in">exit</span></span><br><span class="line">                                - may appear multiple <span class="built_in">times</span></span><br><span class="line">   -d no  debug-level    Increase debug verbosity level</span><br><span class="line">                                - may appear multiple <span class="built_in">times</span></span><br><span class="line">   -D Num <span class="built_in">set</span>-debug-level Set the debug verbosity level</span><br><span class="line">                                - may appear multiple <span class="built_in">times</span></span><br><span class="line">   -i no  interactive    Force ntpq to operate <span class="keyword">in</span> interactive mode</span><br><span class="line">                                - prohibits these options: <span class="built_in">command</span> peers</span><br><span class="line">   -n no  numeric        numeric host addresses</span><br><span class="line">      no  old-rv         Always output status line with readvar</span><br><span class="line">   -p no  peers          Print a list of the peers</span><br><span class="line">                                - prohibits the option <span class="string">'interactive'</span></span><br><span class="line">   -r KWd refid          Set default display <span class="built_in">type</span> <span class="keyword">for</span> S2+ refids</span><br><span class="line">   -w no  wide           Display the full <span class="string">'remote'</span> value</span><br><span class="line">      opt version        output version information and <span class="built_in">exit</span></span><br><span class="line">   -? no  <span class="built_in">help</span>           display extended usage information and <span class="built_in">exit</span></span><br><span class="line">   -! no  more-help      extended usage information passed thru pager</span><br><span class="line">   -&gt; opt save-opts      save the option state to a config file</span><br><span class="line">   -&lt; Str load-opts      load options from a config file</span><br><span class="line">                                - disabled as <span class="string">'--no-load-opts'</span></span><br><span class="line">                                - may appear multiple <span class="built_in">times</span></span><br></pre></td></tr></table></figure></p>
<p>åŸºç¡€å®ä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1) æ‰“å°å¯¹ç­‰ä½“çš„åˆ—è¡¨å³æŸ¥çœ‹ntpæœåŠ¡å™¨ä¸ä¸Šå±‚ntpçš„çŠ¶æ€(å¦‚å¼€å¯nopeeré€‰é¡¹å…¶å®ƒä¸»æœºæ— æ³•è·å–)</span></span><br><span class="line">dns-server:~$ ntpq -p</span><br><span class="line">dns-server:~$ ntpq -p 192.168.12.254</span><br><span class="line">  <span class="comment">#     remote           refid      st t when poll reach   delay   offset  jitter</span></span><br><span class="line">  <span class="comment"># ==============================================================================</span></span><br><span class="line">  <span class="comment"># LOCAL(0)        .LOCL.           8 l  332   64   40    0.000    0.000   0.000</span></span><br><span class="line">  <span class="comment"># ntp.aliyun.com  .POOL.          16 p    -   64    0    0.000    0.000   0.000</span></span><br><span class="line">  <span class="comment"># *120.25.115.20   10.137.53.7      2 u    8   16  377   33.766   -2.872   0.170</span></span><br><span class="line">  <span class="comment"># +203.107.6.88    10.137.38.86     2 u    8   16  377   53.024    5.287   1.349</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‚æ•°è¯´æ˜</span></span><br><span class="line">  <span class="comment"># remoteï¼šæœ¬æœºå’Œä¸Šå±‚ntpçš„ipæˆ–ä¸»æœºåï¼Œâ€œ+â€è¡¨ç¤ºä¼˜å…ˆï¼Œâ€œ*â€è¡¨ç¤ºæ¬¡ä¼˜å…ˆ</span></span><br><span class="line">  <span class="comment"># refidï¼šå‚è€ƒä¸Šä¸€å±‚ntpä¸»æœºåœ°å€</span></span><br><span class="line">  <span class="comment"># stï¼šstratumé˜¶å±‚</span></span><br><span class="line">  <span class="comment"># whenï¼šå¤šå°‘ç§’å‰æ›¾ç»åŒæ­¥è¿‡æ—¶é—´</span></span><br><span class="line">  <span class="comment"># pollï¼šä¸‹æ¬¡æ›´æ–°åœ¨å¤šå°‘ç§’å</span></span><br><span class="line">  <span class="comment"># reachï¼šå·²ç»å‘ä¸Šå±‚ntpæœåŠ¡å™¨è¦æ±‚æ›´æ–°çš„æ¬¡æ•°</span></span><br><span class="line">  <span class="comment"># delayï¼šç½‘ç»œå»¶è¿Ÿ</span></span><br><span class="line">  <span class="comment"># offsetï¼šæ—¶é—´è¡¥å¿</span></span><br><span class="line">  <span class="comment"># jitterï¼šç³»ç»Ÿæ—¶é—´ä¸biosæ—¶é—´å·®</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ~$ ping ntp.aliyun.com</span></span><br><span class="line">  <span class="comment"># PING ntp.aliyun.com (203.107.6.88)</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="chronycå‘½ä»¤"><a href="#chronycå‘½ä»¤" class="headerlink" title="chronycå‘½ä»¤"></a>chronycå‘½ä»¤</h4><p>æè¿°: chronyc å®¢æˆ·ç«¯å‘½ä»¤æŸ¥çœ‹æ—¶é—´æœåŠ¡å™¨çš„çŠ¶æ€ã€‚</p>
<p>è¯­æ³•å‚æ•°:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">ç³»ç»Ÿæ—¶é’Ÿ:</span><br><span class="line">tracking			æ˜¾ç¤ºç³»ç»Ÿæ—¶é—´ä¿¡æ¯</span><br><span class="line">makestep		ç«‹å³æ­¥è¿›åœ°æ ¡æ­£æ—¶é’Ÿ</span><br><span class="line">makestep   		é…ç½®è‡ªåŠ¨æ—¶é’Ÿæ­¥è¿›</span><br><span class="line">maxupdateskew  	ä¿®æ”¹æ›´æ–°é¢‘ç‡çš„æœ€å¤§æœ‰æ•ˆæ—¶æ»</span><br><span class="line"></span><br><span class="line">waitsync [ [ [ []]]]		ç­‰å¾…ï¼Œç›´åˆ°åŒæ­¥åˆ°æŒ‡å®šçš„é˜ˆå€¼å†…</span><br><span class="line"></span><br><span class="line">æ—¶é—´æ¥æº:</span><br><span class="line">sources [-v]		æ˜¾ç¤ºå…³äºå½“å‰æ¥æºçš„ä¿¡æ¯</span><br><span class="line">sourcestats [-v] 	æ˜¾ç¤ºæœ‰å…³æ”¶é›†æµ‹é‡çš„ç»Ÿè®¡ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">reselect			å¼ºåˆ¶é‡æ–°é€‰æ‹©åŒæ­¥æº</span><br><span class="line"></span><br><span class="line">reselectdist  		ä¿®æ”¹é‡é€‰è·ç¦»</span><br><span class="line"></span><br><span class="line">NTPæº:</span><br><span class="line">activity			æ£€æŸ¥æœ‰å¤šå°‘ä¸ªNTPæºåœ¨çº¿/ç¦»çº¿</span><br><span class="line">ntpdata []			æ˜¾ç¤ºä¸Šæ¬¡æœ‰æ•ˆæµ‹é‡çš„ä¿¡æ¯</span><br><span class="line">add server   [options] 	æ·»åŠ æ–°çš„NTPæœåŠ¡å™¨</span><br><span class="line">add peer [options] 		æ·»åŠ æ–°çš„NTP peer</span><br><span class="line">delete                    ç§»é™¤æœåŠ¡å™¨æˆ– peer</span><br><span class="line">burst / [/]               å¼€å§‹å¿«é€Ÿè®¾ç½®çš„æµ‹é‡</span><br><span class="line">maxdelay             ä¿®æ”¹æœ€å¤§æœ‰æ•ˆé‡‡æ ·å»¶è¿Ÿ</span><br><span class="line">maxdelayratio      ä¿®æ”¹æœ€å¤§æœ‰æ•ˆå»¶è¿Ÿ/æœ€å°æ¯”ç‡</span><br><span class="line">maxdelaydevratio   ä¿®æ”¹æœ€å¤§æœ‰æ•ˆå»¶è¿Ÿ/åå·®æ¯”ç‡</span><br><span class="line"></span><br><span class="line">minpoll              ä¿®æ”¹æœ€å°è½®è¯¢æ—¶é—´é—´éš”</span><br><span class="line">maxpoll            ä¿®æ”¹æœ€å¤§è½®è¯¢é—´éš”</span><br><span class="line">minstratum      ä¿®æ”¹æœ€å°å±‚çº§</span><br><span class="line">offline [/]  	å°†å­ç½‘ä¸­çš„æºè®¾ç½®ä¸ºç¦»çº¿çŠ¶æ€</span><br><span class="line">online [/]   	å°†å­ç½‘ä¸­çš„æºè®¾ç½®ä¸ºåœ¨çº¿çŠ¶æ€</span><br><span class="line">polltarget         ä¿®æ”¹æŠ•ç¥¨ç›®æ ‡</span><br><span class="line">refresh            åˆ·æ–°IPåœ°å€</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ‰‹åŠ¨æ—¶é—´è¾“å…¥:</span><br><span class="line">manual off|on|reset         	ç¦ç”¨/å¯ç”¨/é‡ç½®settimeå‘½ä»¤</span><br><span class="line">manual list                 		æ˜¾ç¤ºä»¥å‰çš„è®¾ç½®æ—¶é—´æ¡ç›®</span><br><span class="line">manual delete        			åˆ é™¤ä¹‹å‰çš„è®¾ç½®æ—¶é—´æ¡ç›®</span><br><span class="line">settime               			ç½®å®ˆæŠ¤è¿›ç¨‹çš„æ—¶é—´ (e.g. Sep 25, 2015 16:30:05 or 16:30:05)</span><br><span class="line"></span><br><span class="line">NTPè®¿é—®:</span><br><span class="line"></span><br><span class="line">accheck                æ£€æŸ¥åœ°å€æ˜¯å¦è¢«å…è®¸</span><br><span class="line">clients                   æŠ¥å‘Šè®¿é—®æœåŠ¡å™¨çš„å®¢æˆ·ç«¯</span><br><span class="line">serverstats            æ˜¾ç¤ºæœåŠ¡å™¨çš„ç»Ÿè®¡ä¿¡æ¯</span><br><span class="line">allow []            	     é»˜è®¤å…è®¸è®¿é—®å­ç½‘</span><br><span class="line">allow all []             é»˜è®¤å…è®¸è®¿é—®å­ç½‘å’Œæ‰€æœ‰å­èŠ‚ç‚¹</span><br><span class="line">deny []                  é»˜è®¤æ‹’ç»è®¿é—®å­ç½‘</span><br><span class="line">deny all []             é»˜è®¤æ‹’ç»è®¿é—®å­ç½‘å’Œæ‰€æœ‰å­èŠ‚ç‚¹</span><br><span class="line"><span class="built_in">local</span> [options]             				åœ¨æœªåŒæ­¥çš„æƒ…å†µä¸‹ä¹Ÿæä¾›æœåŠ¡</span><br><span class="line"><span class="built_in">local</span> off                   					åœ¨æœªåŒæ­¥çš„æƒ…å†µä¸‹ä¸æä¾›æœåŠ¡</span><br><span class="line">smoothtime reset|activate   			é‡ç½®/æ¿€æ´»æ—¶é—´å¹³æ»‘</span><br><span class="line">smoothing                   				æ˜¾ç¤ºå½“å‰æ—¶é—´å¹³æ»‘çŠ¶æ€</span><br><span class="line"></span><br><span class="line">è®¿é—®ç›‘æ§:</span><br><span class="line">cmdaccheck                 æ£€æŸ¥åœ°å€æ˜¯å¦è¢«å…è®¸</span><br><span class="line">cmdallow []         	   é»˜è®¤å…è®¸è®¿é—®å­ç½‘</span><br><span class="line">cmdallow all []     	   é»˜è®¤å…è®¸è®¿é—®å­ç½‘å’Œæ‰€æœ‰å­èŠ‚ç‚¹</span><br><span class="line">cmddeny []          	   é»˜è®¤æ‹’ç»è®¿é—®å­ç½‘</span><br><span class="line">cmddeny all []      	  é»˜è®¤æ‹’ç»è®¿é—®å­ç½‘å’Œæ‰€æœ‰å­èŠ‚ç‚¹</span><br><span class="line"></span><br><span class="line">Real-time clock:</span><br><span class="line">rtcdata                      æ‰“å°å½“å‰çš„RTCæ€§â€‹â€‹èƒ½å‚æ•°</span><br><span class="line">trimrtc                     	 ç›¸å¯¹äºç³»ç»Ÿæ—¶é’Ÿæ ¡æ­£RTC</span><br><span class="line">writertc                     å°†RTCæ€§èƒ½å‚æ•°ä¿å­˜åˆ°æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">Other daemon commands:</span><br><span class="line">cyclelogs                  å…³é—­å¹¶é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶</span><br><span class="line">dump                        è½¬å‚¨æ‰€æœ‰æµ‹é‡ä»¥ä¿å­˜æ–‡ä»¶</span><br><span class="line">rekey                        é‡æ–°è¯»å–å¯†é’¥æ–‡ä»¶ä¸­çš„å¯†é’¥</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Client commands:</span><br><span class="line">dns -n|+n                   ç¦ç”¨/å¯ç”¨å°†IPåœ°å€è§£æä¸ºä¸»æœºå</span><br><span class="line">dns -4|-6|-46              å°†ä¸»æœºåè§£æä¸ºIPv4ã€IPv6æˆ–å…¨éƒ¨</span><br><span class="line">timeout       		  è®¾ç½®åˆå§‹å“åº”è¶…æ—¶</span><br><span class="line">retries            		  è®¾ç½®æœ€å¤§é‡è¯•æ¬¡æ•°</span><br><span class="line">keygen [ [ []]]		  ä¸ºå¯†é’¥æ–‡ä»¶ç”Ÿæˆå¯†é’¥</span><br><span class="line"><span class="built_in">exit</span>|quit                   	  é€€å‡ºç¨‹åº</span><br><span class="line"><span class="built_in">help</span>                        	  ç”Ÿæˆæ­¤å¸®åŠ©</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>åŸºç¡€ç¤ºä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.éªŒè¯ chronyæ˜¯å¦å®‰è£…æˆåŠŸï¼Œå¹¶æŸ¥çœ‹æœ‰å¤šå°‘ä¸ªæœåŠ¡ç«¯åŠç»“ç‚¹å·²è¿æ¥, æŸ¥çœ‹ NTP æœåŠ¡å™¨çš„åœ¨çº¿å’Œç¦»çº¿çŠ¶æ€;</span></span><br><span class="line">$ chronyc activity</span><br><span class="line">200 OK</span><br><span class="line">8 sources online</span><br><span class="line">0 sources offline</span><br><span class="line">0 sources doing burst (<span class="built_in">return</span> to online)</span><br><span class="line">0 sources doing burst (<span class="built_in">return</span> to offline)</span><br><span class="line">0 sources with unknown address</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æ£€æŸ¥ Chrony æ˜¯å¦å®é™…åŒæ­¥(ä¸»è¦å…³æ³¨ Update interval è¿™ä¸ªå‚æ•°, è¯´æ˜æœ€åä¸¤æ¬¡æ›´æ–°çš„æ—¶é—´é—´éš”æ˜¯ 64.1sã€‚)</span></span><br><span class="line"><span class="comment"># æ ¡å‡†æ—¶é—´æœåŠ¡å™¨ï¼Œæ˜¾ç¤ºç³»ç»Ÿæ—¶é—´ä¿¡æ¯</span></span><br><span class="line">$ chronyc tracking</span><br><span class="line">Reference ID    : AB42617E (srcf-ntp.stanford.edu)</span><br><span class="line">Stratum         : 2</span><br><span class="line">Ref time (UTC)  : Thu Apr 05 18:27:33 2018</span><br><span class="line">System time     : 0.000669840 seconds slow of NTP time</span><br><span class="line">Last offset     : -0.000506939 seconds</span><br><span class="line">RMS offset      : 0.001261410 seconds</span><br><span class="line">Frequency       : 28.552 ppm slow</span><br><span class="line">Residual freq   : -0.000 ppm</span><br><span class="line">Skew            : 88.846 ppm</span><br><span class="line">Root delay      : 0.031207338 seconds</span><br><span class="line">Root dispersion : 0.001206590 seconds</span><br><span class="line">Update interval : 65.2 seconds</span><br><span class="line">Leap status     : Normal</span><br><span class="line">sources</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»“æœä¸­çš„å…¶å®ƒå‚æ•°çš„å«ä¹‰åˆ†åˆ«æ˜¯ï¼š</span></span><br><span class="line">  * å¼•ç”¨ ID - è®¡ç®—æœºå½“å‰åŒæ­¥çš„å¼•ç”¨ ID å’Œåç§°ã€‚</span><br><span class="line">  * Stratum - è¿æ¥å‚è€ƒæ—¶é’Ÿçš„è®¡ç®—æœºçš„è·³æ•°ã€‚</span><br><span class="line">  * å‚è€ƒæ—¶é—´ - è¿™æ˜¯å‚è€ƒæºçš„æœ€åä¸€æ¬¡æµ‹é‡çš„ UTC æ—¶é—´ã€‚</span><br><span class="line">  * ç³»ç»Ÿæ—¶é—´ - æ¥è‡ªåŒæ­¥æœåŠ¡å™¨çš„ç³»ç»Ÿæ—¶é’Ÿå»¶è¿Ÿã€‚</span><br><span class="line">  * æœ€åä¸€æ¬¡åç§» - ä¸Šæ¬¡æ—¶é’Ÿæ›´æ–°çš„ä¼°è®¡åç§»é‡ã€‚</span><br><span class="line">  * RMS åç§» - åç§»å€¼çš„é•¿æœŸå¹³å‡å€¼ã€‚</span><br><span class="line">  * é¢‘ç‡ - å¦‚æœ chronyd æ²¡æœ‰çº æ­£å®ƒï¼Œé‚£ä¹ˆç³»ç»Ÿçš„æ—¶é’Ÿé”™è¯¯çš„é€Ÿç‡ã€‚å®ƒä»¥ ppm ï¼ˆç™¾ä¸‡åˆ†ç‡ï¼‰æä¾›ã€‚</span><br><span class="line">  * æ®‹ä½™é¢‘ç‡ - æ®‹ä½™é¢‘ç‡è¡¨ç¤ºå‚è€ƒæºçš„æµ‹é‡å€¼ä¸å½“å‰ä½¿ç”¨çš„é¢‘ç‡ä¹‹é—´çš„å·®å¼‚ã€‚</span><br><span class="line">  * åæ–œ - ä¼°è®¡é¢‘ç‡çš„è¯¯å·®ç•Œé™ã€‚</span><br><span class="line">  * æ ¹å»¶è¿Ÿ - ç½‘ç»œè·¯å¾„å»¶è¿Ÿåˆ°è®¡ç®—æœºæ­£åœ¨åŒæ­¥çš„å±‚è®¡ç®—æœºçš„æ€»å’Œã€‚</span><br><span class="line">  * è·³è·ƒçŠ¶æ€ - è¿™æ˜¯è·³è·ƒçŠ¶æ€ï¼Œå¯ä»¥å…·æœ‰ä»¥ä¸‹å€¼ä¹‹ä¸€ï¼šæ­£å¸¸ã€æ’å…¥ç§’ã€åˆ é™¤ç§’æˆ–ä¸åŒæ­¥ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æ˜¾ç¤ºæ‰€æœ‰ NTP æºæœåŠ¡å™¨çš„ä¿¡æ¯(æŸ¥çœ‹æ—¶é—´åŒæ­¥æº)</span></span><br><span class="line">$ chronyc sources -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.æ£€æŸ¥ NTP è®¿é—®æ˜¯å¦å¯¹ç‰¹å®šä¸»æœºå¯ç”¨</span></span><br><span class="line">$ chronyc accheck 192.168.12.254</span><br><span class="line"><span class="comment"># 501 Not authorised</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.åœ¨å®¢æˆ·ç«¯æŠ¥å‘Šå·²è®¿é—®åˆ°æœåŠ¡å™¨</span></span><br><span class="line">$ chronyc clients</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.æ‰‹åŠ¨æ·»åŠ ä¸€å°æ–°çš„ NTP æœåŠ¡å™¨</span></span><br><span class="line">$ chronyc add server ntp1.aliyun.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.æ‰‹åŠ¨ç§»é™¤ NTP æœåŠ¡å™¨æˆ–å¯¹ç­‰æœåŠ¡å™¨</span></span><br><span class="line">$ chronyc delete server ntp1.aliyun.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.æ‰‹åŠ¨è®¾ç½®å®ˆæŠ¤è¿›ç¨‹æ—¶é—´</span></span><br><span class="line">$ chronyc settime</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.æŸ¥çœ‹æ—¶é—´åŒæ­¥æºçŠ¶æ€</span></span><br><span class="line">$ chronyc sourcestats -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.å¼ºåˆ¶æ›´æ–°æ—¶é—´</span></span><br><span class="line">chronyc -a makestep</span><br></pre></td></tr></table></figure></p>
<p>Tips : å¦‚æœè¦æŸ¥çœ‹ Chrony æœåŠ¡çš„æ—¥å¿—å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ <code>journalctl -u chronyd</code> </p>
<hr>
<h2 id="0x05-å…¥å‘å‡ºå‘"><a href="#0x05-å…¥å‘å‡ºå‘" class="headerlink" title="0x05 å…¥å‘å‡ºå‘"></a>0x05 å…¥å‘å‡ºå‘</h2><h3 id="é—®é¢˜1-ntpdate-820110-no-server-suitable-for-synchronization-found"><a href="#é—®é¢˜1-ntpdate-820110-no-server-suitable-for-synchronization-found" class="headerlink" title="é—®é¢˜1.ntpdate[820110]: no server suitable for synchronization found"></a>é—®é¢˜1.ntpdate[820110]: no server suitable for synchronization found</h3><p>æè¿°:åœ¨ntpæœåŠ¡å™¨å¯åŠ¨ä¹‹åéœ€è¦ä¸€æ®µæ—¶é—´æ‰èƒ½å¤Ÿé€šè¿‡å®¢æˆ·ç«¯è¿›è¡Œæ—¶é—´çš„åŒæ­¥ï¼Œæ‰€ä»¥å¦‚æœè¿™ä¸ªé—®é¢˜æ˜¯åœ¨æœåŠ¡å™¨ç«¯åˆšå¯åŠ¨çš„æ—¶å€™å‡ºç°çš„æ˜¯å±äºæ­£å¸¸çš„æƒ…å†µï¼Œè¯·ç­‰å¾…ä¸€æ®µæ—¶é—´åœ¨è¿›è¡Œå°è¯•ã€‚å¦‚æœè¿˜æ˜¯æœ‰é—®é¢˜å¯ä»¥æŸ¥çœ‹ç½‘ç»œæˆ–è€…æ˜¯æœåŠ¡å™¨ç«¯ä¸å®¢æˆ·ç«¯çš„é…ç½®æƒ…å†µã€‚<br>é—®é¢˜å¤ç°ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~$ sudo ntpdate 192.168.12.254</span><br><span class="line">19 Mar 04:50:24 ntpdate[820110]: no server suitable <span class="keyword">for</span> synchronization found</span><br></pre></td></tr></table></figure><br>é—®é¢˜åŸå› :</p>
<ul>
<li>1.é˜²ç«å¢™æœªå¼€æ”¾</li>
<li>2.ntpæœåŠ¡ç«¯æœªé…ç½®å­ç½‘æ—¶é—´åŒæ­¥è·å–</li>
</ul>
<p>è§£å†³åŠæ³•:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) åœ¨ntpå®¢æˆ·ç«¯ç”¨ ntpdate â€“d serverIP è§‚å¯ŸæœåŠ¡çŠ¶æ€å¦‚å‘ç°ä»¥ä¸‹é”™è¯¯</span></span><br><span class="line">- é”™è¯¯1.Server dropped: strata too high å¹¶ä¸”æ˜¾ç¤º stratum 16 è¡¨ç¤º stratum å€¼æœ‰è¯¯;</span><br><span class="line">- é”™è¯¯2.Server dropped: no data æ£€æŸ¥`ntp`çš„ç‰ˆæœ¬å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ntp4.2ï¼ˆåŒ…æ‹¬4.2ï¼‰ä¹‹åçš„ç‰ˆæœ¬, åœ¨restrictçš„å®šä¹‰ä¸­ä½¿ç”¨äº†notrustçš„è¯ï¼Œä¼šå¯¼è‡´ä»¥ä¸Šé”™è¯¯ã€‚</span><br><span class="line"><span class="comment"># (2) ç¦ç”¨é˜²ç«å¢™</span></span><br></pre></td></tr></table></figure></p>
<p>æ­£å¸¸çŠ¶æ€å›æ˜¾:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">26 Mar 22:19:43 ntpdate[3156]: adjust time server 192.168.100.110 offset -0.001781 sec</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="é—®é¢˜2-ntpdate-35934-the-NTP-socket-is-in-use-exiting"><a href="#é—®é¢˜2-ntpdate-35934-the-NTP-socket-is-in-use-exiting" class="headerlink" title="é—®é¢˜2.ntpdate[35934]: the NTP socket is in use, exiting"></a>é—®é¢˜2.ntpdate[35934]: the NTP socket is in use, exiting</h3><p>æè¿°: åœ¨ä½¿ç”¨ntpdateè¿›è¡ŒåŒæ­¥æ—¶å¦‚æœå‘ç°NTPç«¯å£è¢«å ç”¨çš„æç¤ºï¼Œè¯·ä½¿ç”¨pså‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿæ˜¯ä¸æ˜¯è¿è¡Œç€ntpç›¸å…³çš„æœåŠ¡ï¼Œå¾ˆå¤šæœåŠ¡å™¨å®‰è£…ä¸Šä¹‹åä¼šè‡ªåŠ¨çš„å¯åŠ¨ä¸€äº›æœåŠ¡ï¼Œä¹‹ç”¨å°†å…¶å…³é—­å°±å¯ä»¥äº†ã€‚<br>é—®é¢˜é”™è¯¯:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dns-server:~$ ntpdate 192.168.12.254</span><br><span class="line">19 Mar 13:27:40 ntpdate[35934]: the NTP socket is <span class="keyword">in</span> use, exiting</span><br></pre></td></tr></table></figure><br>é—®é¢˜åŸå› : ä¸èƒ½åœ¨å¯ç”¨äº†ntpæœåŠ¡çš„æœºå™¨ä¸Šå†ä½¿ç”¨ntpdataè¿›è¡Œæ—¶é—´åŒæ­¥ï¼Œéœ€è¦å°†ntpæœåŠ¡åœæ­¢åæ‰èƒ½ä½¿ç”¨è¯¥å‘½ä»¤<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dns-server:~$ ps aux | grep <span class="string">"ntp"</span></span><br><span class="line"><span class="comment"># ntp        41534  0.0  0.0  74636  4124 ?        Ssl  15:32   0:00 /usr/sbin/ntpd -p /var/run/ntpd.pid -g -u 112:117</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="é—®é¢˜3-ntpdä¸ntpdateåŒºåˆ«è¯´æ˜"><a href="#é—®é¢˜3-ntpdä¸ntpdateåŒºåˆ«è¯´æ˜" class="headerlink" title="é—®é¢˜3.ntpdä¸ntpdateåŒºåˆ«è¯´æ˜"></a>é—®é¢˜3.ntpdä¸ntpdateåŒºåˆ«è¯´æ˜</h3><p>æè¿°: ä½¿ç”¨ä¹‹å‰å¾—å¼„æ¸…æ¥šä¸€ä¸ªé—®é¢˜ ntpdä¸ntpdateåœ¨æ›´æ–°æ—¶é—´æ—¶æœ‰ä»€ä¹ˆåŒºåˆ«?</p>
<ul>
<li>ntpd : å®ƒæ˜¯æ—¶é—´åŒæ­¥æœåŠ¡å™¨å¹¶ä¸”è¿˜å¯ä»¥åšå®¢æˆ·ç«¯ä¸æ ‡å‡†æ—¶é—´æœåŠ¡å™¨è¿›è¡ŒåŒæ­¥æ—¶é—´(å¹³æ»‘åŒæ­¥)</li>
<li>ntpdate : åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ…ç”¨ntpdate(è·ƒå˜åŒæ­¥)</li>
</ul>
<p>Tips: æ­£å¦‚æ­¤ä¸¤è€…ä¸å¯åŒæ—¶è¿è¡Œ, å› ä¸ºæ—¶é’Ÿçš„è·ƒå˜ï¼Œå¯¹äºæŸäº›ç¨‹åºä¼šå¯¼è‡´å¾ˆä¸¥é‡çš„é—®é¢˜ã€‚ä¾‹å¦‚è®¸å¤šåº”ç”¨ç¨‹åºä¾èµ–è¿ç»­çš„æ—¶é’Ÿ(å–å¾—çš„æ—¶é—´æ˜¯çº¿æ€§çš„)ï¼Œå¯¹äºæ•°æ®åº“äº‹åŠ¡é€šå¸¸ä¼šåœ°ä¾èµ–è¿™æ ·çš„äº‹å®ï¼Œæ—¶é—´ä¸ä¼šå¾€å›è·³è·ƒã€‚</p>
<p><strong>Q: ntpdateä½¿ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„åå¤„?</strong></p>
<ul>
<li>1) ä¸å®‰å…¨: ntpdate çš„è®¾ç½®ä¾èµ–äºntpæœåŠ¡å™¨çš„å®‰å…¨æ€§ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ä¸€äº›è½¯ä»¶è®¾è®¡ä¸Šçš„ç¼ºé™·ï¼Œæ‹¿ä¸‹ntpæœåŠ¡å™¨å¹¶ä»¤ä¸å…¶åŒæ­¥çš„æœåŠ¡å™¨æ‰§è¡ŒæŸäº›æ¶ˆè€—æ€§çš„ä»»åŠ¡ã€‚</li>
<li>2) ä¸ç²¾ç¡®: ä¸€æ—¦ntpæœåŠ¡å™¨å®•æœºï¼Œè·Ÿéšå®ƒçš„æœåŠ¡å™¨ä¹Ÿå°±ä¼šæ— æ³•åŒæ­¥æ—¶é—´ã€‚ä¸æ­¤ä¸åŒntpdä¸ä»…èƒ½å¤Ÿæ ¡å‡†è®¡ç®—æœºçš„æ—¶é—´ï¼Œè€Œä¸”èƒ½å¤Ÿæ ¡å‡†è®¡ç®—æœºçš„æ—¶é’Ÿã€‚</li>
<li>3) ä¸å¤Ÿä¼˜é›…: ç”±äºæ˜¯è·³å˜ï¼Œè€Œä¸æ˜¯ä½¿æ—¶é—´å˜å¿«æˆ–å˜æ…¢ä¾èµ–æ—¶åºçš„ç¨‹åºä¼šå‡ºé”™, æœ€å¥½çš„åšæ³•æ˜¯ä½¿ç”¨ntpdæ¥æ ¡å‡†æ—¶é’Ÿï¼Œè€Œä¸æ˜¯è°ƒæ•´è®¡ç®—æœºæ—¶é’Ÿä¸Šçš„æ—¶é—´ï¼›ntpd åœ¨å’Œæ—¶é—´æœåŠ¡å™¨çš„åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œ<code>ä¼šæŠŠBIOSè®¡æ—¶å™¨çš„æŒ¯è¡é¢‘ç‡åå·®â€”â€”æˆ–è€…è¯´Local Clockçš„è‡ªç„¶æ¼‚ç§»(drift)ä¸€ä¸€è®°å½•ä¸‹æ¥</code>ã€‚å¦‚æ­¤å³ä½¿ç½‘ç»œæœ‰é—®é¢˜æœ¬æœºä»ç„¶èƒ½ç»´æŒä¸€ä¸ªç›¸å½“ç²¾ç¡®çš„èµ°æ—¶ã€‚</li>
</ul>
<p><br/></p>
<p><strong>å‚è€ƒæ¥æº</strong></p>
<p>é˜¿é‡Œäº‘: <a href="https://developer.aliyun.com/mirror/NTP?spm=a2c6h.13651102.0.0.53322f708XGXRj" target="_blank" rel="noopener">https://developer.aliyun.com/mirror/NTP?spm=a2c6h.13651102.0.0.53322f708XGXRj</a></p>
<p><br/></p>
<h3 id="é—®é¢˜4-éªŒè¯æ“ä½œç³»ç»Ÿæ—¶é—´åŒæ­¥NTP-synchronized-yes"><a href="#é—®é¢˜4-éªŒè¯æ“ä½œç³»ç»Ÿæ—¶é—´åŒæ­¥NTP-synchronized-yes" class="headerlink" title="é—®é¢˜4.éªŒè¯æ“ä½œç³»ç»Ÿæ—¶é—´åŒæ­¥NTP synchronized: yes"></a>é—®é¢˜4.éªŒè¯æ“ä½œç³»ç»Ÿæ—¶é—´åŒæ­¥<code>NTP synchronized: yes</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®æ—¶é—´åŒæ­¥</span></span><br><span class="line">$ timedatectl <span class="built_in">set</span>-ntp yes</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ—¶é—´åŒæ­¥æƒ…å†µ</span></span><br><span class="line">$ timedatectl</span><br><span class="line">      Local time: å›› 2021-05-06 16:09:29 CST</span><br><span class="line">  Universal time: å›› 2021-05-06 08:09:29 UTC</span><br><span class="line">        RTC time: å›› 2021-05-06 16:09:29</span><br><span class="line">       Time zone: Asia/Shanghai (CST, +0800)</span><br><span class="line">     NTP enabled: yes</span><br><span class="line">NTP synchronized: yes  <span class="comment"># å·²åŒæ­¥</span></span><br><span class="line"> RTC <span class="keyword">in</span> <span class="built_in">local</span> TZ: yes</span><br><span class="line">      DST active: n/a</span><br></pre></td></tr></table></figure>

        </div>
        
        <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
        
        <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½çœ‹å‹,æ¬¢è¿å…³æ³¨åšä¸»å¾®ä¿¡å…¬ä¼—å·å“Ÿ! â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘å³å¯å…³é—­ç»§ç»­æµè§ˆæ–‡ç« .<br>  <b style="color:red;"> æ¸©é¦¨æç¤º: æœªè§£é”çš„ç”¨æˆ·ä¸èƒ½ç²˜è´´å¤åˆ¶æ–‡ç« å†…å®¹å“Ÿ!</b> <br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
           

        <!-- Google å¹¿å‘Š -->
        
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
  

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2023-01-31T02:29:10.469Z" itemprop="dateUpdated">2023-01-31 10:29:10</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç³»ç»Ÿè¿ç»´/Application/Sync/ä¼ä¸šNTPæœåŠ¡å™¨åŸºç¡€å®‰è£…ä¸é…ç½®ä½¿ç”¨.md" target="_blank" rel="noopener noreferrer">_posts/ç³»ç»Ÿè¿ç»´/Application/Sync/ä¼ä¸šNTPæœåŠ¡å™¨åŸºç¡€å®‰è£…ä¸é…ç½®ä½¿ç”¨.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2020/1-29-112.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/1-29-112.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NTP/" rel="tag">NTP</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/1-29-112.html&title=ã€Šä¼ä¸šå†…éƒ¨NTPæœåŠ¡å™¨åŸºç¡€å®‰è£…ä¸é…ç½®ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/1-29-112.html&title=ã€Šä¼ä¸šå†…éƒ¨NTPæœåŠ¡å™¨åŸºç¡€å®‰è£…ä¸é…ç½®ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/1-29-112.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Šä¼ä¸šå†…éƒ¨NTPæœåŠ¡å™¨åŸºç¡€å®‰è£…ä¸é…ç½®ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/1-29-112.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/1-29-112.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/2-1-306.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">JDBCåŸºç¡€å…¥é—¨ä½¿ç”¨</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/1-27-182.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">ç³»ç»Ÿä¸åº”ç”¨å¼‚å¸¸å®šä½è¯Šæ–­</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-å‰è¨€ç®€è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å‰è¨€ç®€è¿°</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#åŸºç¡€æ¦‚å¿µ"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">åŸºç¡€æ¦‚å¿µ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#æœåŠ¡æ–¹å¼"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">æœåŠ¡æ–¹å¼</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#å…¬å…±-NTP-æœåŠ¡å™¨"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">å…¬å…± NTP æœåŠ¡å™¨</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-æœåŠ¡å™¨å®‰è£…é…ç½®"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 æœåŠ¡å™¨å®‰è£…é…ç½®</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-NTP-æœåŠ¡"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">(1) NTP æœåŠ¡</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Ubuntu"><span class="post-toc-number">2.1.1.</span> <span class="post-toc-text">Ubuntu</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-Chrony-æœåŠ¡"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">(2) Chrony æœåŠ¡</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#CentOS"><span class="post-toc-number">2.2.1.</span> <span class="post-toc-text">CentOS</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-systemd-timesyncd-æœåŠ¡"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">(3) systemd-timesyncd æœåŠ¡</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-NTPå®¢æˆ·ç«¯é…ç½®"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 NTPå®¢æˆ·ç«¯é…ç½®</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Windows-æœåŠ¡å™¨"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">Windows æœåŠ¡å™¨</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Linux-æœåŠ¡å™¨"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">Linux æœåŠ¡å™¨</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x04-é…ç½®è§£æ-amp-éªŒè¯"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x04 é…ç½®è§£æ&amp;éªŒè¯</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#é…ç½®æ–‡ä»¶"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">é…ç½®æ–‡ä»¶</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#etc-ntp-conf"><span class="post-toc-number">4.1.1.</span> <span class="post-toc-text">&#x2F;etc&#x2F;ntp.conf</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#etc-chrony-conf"><span class="post-toc-number">4.1.2.</span> <span class="post-toc-text">&#x2F;etc&#x2F;chrony.conf</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#æ ¸éªŒå·¥å…·"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">æ ¸éªŒå·¥å…·</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ntpd-å‘½ä»¤"><span class="post-toc-number">4.2.1.</span> <span class="post-toc-text">ntpd å‘½ä»¤</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ntpdate-å‘½ä»¤"><span class="post-toc-number">4.2.2.</span> <span class="post-toc-text">ntpdate å‘½ä»¤</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ntpstat-å‘½ä»¤-æ˜¾ç¤ºç½‘ç»œæ—¶é—´åŒæ­¥çŠ¶æ€"><span class="post-toc-number">4.2.3.</span> <span class="post-toc-text">ntpstat å‘½ä»¤ - æ˜¾ç¤ºç½‘ç»œæ—¶é—´åŒæ­¥çŠ¶æ€</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ntpq-å‘½ä»¤-æ ‡å‡†çš„NTPæŸ¥è¯¢ç¨‹åº"><span class="post-toc-number">4.2.4.</span> <span class="post-toc-text">ntpq å‘½ä»¤ - æ ‡å‡†çš„NTPæŸ¥è¯¢ç¨‹åº</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#chronycå‘½ä»¤"><span class="post-toc-number">4.2.5.</span> <span class="post-toc-text">chronycå‘½ä»¤</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x05-å…¥å‘å‡ºå‘"><span class="post-toc-number">5.</span> <span class="post-toc-text">0x05 å…¥å‘å‡ºå‘</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#é—®é¢˜1-ntpdate-820110-no-server-suitable-for-synchronization-found"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">é—®é¢˜1.ntpdate[820110]: no server suitable for synchronization found</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#é—®é¢˜2-ntpdate-35934-the-NTP-socket-is-in-use-exiting"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">é—®é¢˜2.ntpdate[35934]: the NTP socket is in use, exiting</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#é—®é¢˜3-ntpdä¸ntpdateåŒºåˆ«è¯´æ˜"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">é—®é¢˜3.ntpdä¸ntpdateåŒºåˆ«è¯´æ˜</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#é—®é¢˜4-éªŒè¯æ“ä½œç³»ç»Ÿæ—¶é—´åŒæ­¥NTP-synchronized-yes"><span class="post-toc-number">5.4.</span> <span class="post-toc-text">é—®é¢˜4.éªŒè¯æ“ä½œç³»ç»Ÿæ—¶é—´åŒæ­¥NTP synchronized: yes</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
    <!-- 
  <div id="post-wechat" class="post-wechat" style="position:fixed;top: 360px;bottom: 500px;right: 3%;width: 190px;text-align: center; z-index: 9999">
    <p><b>å…³æ³¨ã€å…¨æ ˆå·¥ç¨‹å¸ˆä¿®ç‚¼æŒ‡å—ã€‘</b></p>
    <img src="/img/wechat-gzh.jpg" class="img-responsive" alt="weiyigeek">
    <p><b>æ¬¢è¿æ·»åŠ ã€ä½œè€…ã€‘å¾®ä¿¡</b></p>
    <img src="/img/wehat.jpg" class="img-responsive" alt="weiyigeek">
  </div>
 -->

    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="/img/share-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2023 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div>
        <div id="blog-wormhole-id" >
          <a href="https://www.foreverblog.cn/go.html" target="_blank"> 
            <img src="https://img.foreverblog.cn/wormhole_2_tp.gif" alt="åå¹´ä¹‹çº¦è™«æ´" style="height:32px;max-height:50px;display:block;margin:0 auto;" title="ç©¿æ¢­è™«æ´-éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢">
          </a>
        </div>
        <div id="cc-myssl-id" >
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>

<div id="go" class="waves-effect waves-light">
  <a href="javascript:;" id="goqrcode"> <span class="icon icon-lg icon-qrcode"></span> </a>
  <a href="javascript:;" id="gotop"> <span class="icon icon-lg icon-chevron-up"></span></a>
</div>





<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/1-29-112.html&title=ã€Šä¼ä¸šå†…éƒ¨NTPæœåŠ¡å™¨åŸºç¡€å®‰è£…ä¸é…ç½®ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/1-29-112.html&title=ã€Šä¼ä¸šå†…éƒ¨NTPæœåŠ¡å™¨åŸºç¡€å®‰è£…ä¸é…ç½®ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/1-29-112.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Šä¼ä¸šå†…éƒ¨NTPæœåŠ¡å™¨åŸºç¡€å®‰è£…ä¸é…ç½®ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/1-29-112.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/1-29-112.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMUlEQVR42u3aQVLEMAwF0bn/pcMWaojTX8pARe6sKEiMnxcqWdLrhZ/j7Tn7K3n/+zvrdW5+ZMiQ8VjGsXzWG+WYs6/ef78+jlOqDBkyNmDwpdf/oPZOhy1DhgwZaRAk2yIHJEOGDBl3Mcg6/Kt/C7gyZMh4CIOEzrT0tt4EWfMjd3EZMmQ8kMGr7n//80f6GzJkyHgU4wifu/qG/Z38WFOGDBmjGTzAkWSxtml0QSUryJAhY0sGuabWNpqW7VBpT4YMGaMZaZksbQbwkF0r+cmQIWMHRlri77cN0nXIMcmQIWMqg19NO5fPNJTHLVIZMmSMZvCF0nDMDyIdArsoxsmQIWMcgyt5gpgW72olv19SQxkyZIxm1MYsahfRWrPhYh0ZMmSMZtRySd56XKeSJImsNUdlyJAxm8EvqGkbMi208QOSIUPGbAYvsQV1uzCIc/ZFhitDhozRjH5K1ynDFdO+9DMZMmSMY9QGHUjoTEfKUJooQ4aM0Qx+ce1cNdMrcTqiIUOGjB0YtTQuTSVrbc6gnSBDhowNGGm6VivVpSW5oM0pQ4aMbRi1EMnDaD+sB7mtDBkyRjCO8OFFfN5yICH+IvjKkCFjNKM/KHZXCK6lia1mpwwZMh7FqKWG/dJ/rVEqQ4aMnRm11K0TjoMRCoKUIUOGjHC0Ig24fMDi9FBkyJAhA1xQ+XBYOs2FgrgMGTI2YPTHKdIBrxpShgwZezI6kxqdyydfk5fzZMiQMY7xBWXJYL44cMDjAAAAAElFTkSuQmCC" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å”¯ä¸€æå®¢-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// ç«™ç‚¹è¿è¡Œæ—¶é—´
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + " å¤© " + RunHours + " æ—¶ " + RunMinutes + " åˆ† " + RunSeconds + " ç§’";
  document.getElementById(id).innerHTML = "ç½‘ç«™å·²åœ¨é£é›¨ä¸­å‹‰å‹‰å¼ºå¼ºè¿è¡Œäº†ã€ " + RunTime + " ã€‘";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
    
  <div id="post-wechat" class="post-wechat" style="position:fixed;top: 360px;bottom: 500px;right: 3%;width: 190px;text-align: center; z-index: 9999">
    <p><b>å…³æ³¨ã€å…¨æ ˆå·¥ç¨‹å¸ˆä¿®ç‚¼æŒ‡å—ã€‘</b></p>
    <img src="/img/wechat-gzh.jpg" class="img-responsive" alt="weiyigeek">
    <p><b>æ¬¢è¿æ·»åŠ ã€ä½œè€…ã€‘å¾®ä¿¡</b></p>
    <img src="/img/wehat.jpg" class="img-responsive" alt="weiyigeek">
  </div>

</body>
</html>