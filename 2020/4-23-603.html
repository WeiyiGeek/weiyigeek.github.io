<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 2.Goè¯­è¨€ä¹‹æ ‡å‡†åº“å­¦ä¹ è®°å½•(2)|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Go">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/2018/1-1-1.html"  >
                <i class="icon icon-lg icon-mortar-board"></i>
                å­¦ä¹ ä¹‹è·¯
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/sites"  >
                <i class="icon icon-lg icon-globe"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="/img/video-account.jpg" target="_blank" >
                <i class="icon icon-lg icon-video-camera"></i>
                è§†é¢‘å·
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                å‹æƒ…é“¾æ¥
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>2.Goè¯­è¨€ä¹‹æ ‡å‡†åº“å­¦ä¹ è®°å½•(2)</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">2.Goè¯­è¨€ä¹‹æ ‡å‡†åº“å­¦ä¹ è®°å½•(2)</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-04-23T03:16:58.000Z" itemprop="datePublished" class="page-time">
  2020-04-23
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/">Development</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/Programming/">Programming</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap" style="display: none;">
  <article id="post-ç¼–ç¨‹ä¸–ç•Œ/Go/Package/2.Goè¯­è¨€ä¹‹æ ‡å‡†åº“å­¦ä¹ è®°å½•(2)"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">2.Goè¯­è¨€ä¹‹æ ‡å‡†åº“å­¦ä¹ è®°å½•(2)</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-04-23 11:16:58" datetime="2020-04-23T03:16:58.000Z"  itemprop="datePublished">2020-04-23</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/">Development</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/Programming/">Programming</a></li></ul></li></ul>



            

            


            
        </div>
        <span class="post-href" style="display: none;">|</span> 
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="0x00-Strconv-å­—ç¬¦ä¸²ç±»å‹è½¬æ¢åº“"><a href="#0x00-Strconv-å­—ç¬¦ä¸²ç±»å‹è½¬æ¢åº“" class="headerlink" title="0x00 Strconv.å­—ç¬¦ä¸²ç±»å‹è½¬æ¢åº“"></a>0x00 Strconv.å­—ç¬¦ä¸²ç±»å‹è½¬æ¢åº“</h2><p>æè¿°: Goè¯­è¨€ä¸­strconvåŒ…å®ç°äº†åŸºæœ¬æ•°æ®ç±»å‹å’Œå…¶å­—ç¬¦ä¸²è¡¨ç¤ºçš„ç›¸äº’è½¬æ¢ï¼Œä¸»è¦å¯ä»¥å°†å­—ç¬¦ä¸²ç±»å‹è½¬æ¢ä¸ºæ•´å‹(int32 ã€int64ã€intã€uint)ã€æµ®ç‚¹å‹(float32ã€float64)ã€å¸ƒå°”å‹ï¼ˆBooleanï¼‰ç­‰ã€‚</p>
<p>ä¸»è¦æœ‰ä»¥ä¸‹å¸¸ç”¨å‡½æ•°: Atoi()ã€Itoa()ã€parseç³»åˆ—å’Œformatä»¥åŠappendç³»åˆ—ç­‰ï¼Œæ›´å¤šå‡½æ•°å‚è€ƒåœ°å€: <a href="https://golang.org/pkg/strconv/" target="_blank" rel="noopener">https://golang.org/pkg/strconv/</a></p>
<h3 id="1-Atoi-ã€Itoa-å‡½æ•°"><a href="#1-Atoi-ã€Itoa-å‡½æ•°" class="headerlink" title="1.Atoi()ã€Itoa()å‡½æ•°"></a>1.Atoi()ã€Itoa()å‡½æ•°</h3><p><strong>å‡½æ•°è¯´æ˜:</strong></p>
<ul>
<li><code>Atoi()</code> å‡½æ•°ç”¨äºå°†å­—ç¬¦ä¸²ç±»å‹çš„æ•´æ•°è½¬æ¢ä¸ºintç±»å‹ï¼Œå‡½æ•°åŸå‹å¦‚ä¸‹: <code>func Atoi(s string) (i int, err error)</code></li>
<li><code>Itoa()</code> å‡½æ•°ç”¨äºå°†intç±»å‹æ•°æ®è½¬æ¢ä¸ºå¯¹åº”çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå‡½æ•°åŸå‹å¦‚ä¸‹: <code>func Itoa(i int) string</code></li>
</ul>
<p>Tips: ä½ ä¼šå‘ç° <code>Atoi()</code> ä¸ <code>Itoa()</code> å‡½æ•°åœ¨Cè¯­è¨€ä¸­ä¹Ÿæ˜¯å­˜åœ¨ï¼Œæ­¤å¤„goå»¶ç»­äº†Cè¯­è¨€æŸäº›å‡½æ•°ç”¨æ³•ä¾¿äºCè¯­è¨€ç¨‹åºå‘˜çš„å­¦ä¹ ç†è§£ï¼Œå› ä¸ºCè¯­è¨€ä¸­æ²¡æœ‰stringç±»å‹è€Œæ˜¯ç”¨å­—ç¬¦æ•°ç»„(array)è¡¨ç¤ºå­—ç¬¦ä¸²ã€‚</p>
<p>Tips: å¦‚æœä¼ å…¥çš„å­—ç¬¦ä¸²å‚æ•°æ— æ³•è½¬æ¢ä¸ºintç±»å‹æ—¶å°†ä¼šè¿”å›é”™è¯¯ã€‚</p>
<p><br/></p>
<h3 id="2-Parseç³»åˆ—å‡½æ•°"><a href="#2-Parseç³»åˆ—å‡½æ•°" class="headerlink" title="2.Parseç³»åˆ—å‡½æ•°"></a>2.Parseç³»åˆ—å‡½æ•°</h3><p>æè¿°: Parseç±»å‡½æ•°ç”¨äºè½¬æ¢å­—ç¬¦ä¸²ä¸ºç»™å®šç±»å‹çš„å€¼ï¼šParseBool()ã€ParseFloat()ã€ParseInt()ã€ParseUint()ã€‚</p>
<p><strong>å‡½æ•°è¯´æ˜</strong></p>
<ul>
<li><code>ParseInt()</code> è§£æä¸€ä¸ªè¡¨ç¤ºæ•´æ•°ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œè¿”å›å­—ç¬¦ä¸²è¡¨ç¤ºçš„æ•´æ•°å€¼ï¼Œæ¥å—æ­£è´Ÿå·ã€‚</li>
<li><code>ParseUnit()</code> ParseUintç±»ä¼¼ParseIntä½†ä¸æ¥å—æ­£è´Ÿå·ï¼Œç”¨äºæ— ç¬¦å·æ•´å‹ã€‚</li>
<li><code>ParseFloat()</code> è§£æä¸€ä¸ªè¡¨ç¤ºæµ®ç‚¹æ•°çš„å­—ç¬¦ä¸²å¹¶è¿”å›å…¶å€¼.</li>
<li><code>ParseBool()</code>  è§£æä¸€ä¸ªè¡¨ç¤ºå¸ƒå°”ç±»å‹çš„å­—ç¬¦ä¸²,è¿”å›å­—ç¬¦ä¸²è¡¨ç¤ºçš„boolå€¼ã€‚å®ƒæ¥å— <code>1ã€0ã€tã€fã€Tã€Fã€trueã€falseã€Trueã€Falseã€TRUEã€FALSE</code> å¦åˆ™è¿”å›é”™è¯¯ã€‚</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ParseInt</span><span class="params">(s <span class="keyword">string</span>, base <span class="keyword">int</span>, bitSize <span class="keyword">int</span>)</span> <span class="params">(i <span class="keyword">int64</span>, err error)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">ParseUint</span><span class="params">(s <span class="keyword">string</span>, base <span class="keyword">int</span>, bitSize <span class="keyword">int</span>)</span> <span class="params">(n <span class="keyword">uint64</span>, err error)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">ParseFloat</span><span class="params">(s <span class="keyword">string</span>, bitSize <span class="keyword">int</span>)</span> <span class="params">(f <span class="keyword">float64</span>, err error)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">ParseBool</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="params">(value <span class="keyword">bool</span>, err error)</span></span></span><br></pre></td></tr></table></figure>
<p><strong>å‚æ•°è¯´æ˜</strong></p>
<ul>
<li><code>s</code> æŒ‡ä¼ å…¥çš„æŒ‡å®šè¦è½¬æ¢çš„ç±»å‹çš„å­—ç¬¦ä¸²ã€‚</li>
<li><code>base</code> æŒ‡å®šè¿›åˆ¶ï¼ˆ2åˆ°36ï¼‰ï¼Œå¦‚æœbaseä¸º0ï¼Œåˆ™ä¼šä»å­—ç¬¦ä¸²å‰ç½®åˆ¤æ–­ï¼Œâ€0xâ€æ˜¯16è¿›åˆ¶ï¼Œâ€0â€æ˜¯8è¿›åˆ¶ï¼Œå¦åˆ™æ˜¯10è¿›åˆ¶ï¼›</li>
<li><code>bitSize</code> æŒ‡å®šç»“æœå¿…é¡»èƒ½æ— æº¢å‡ºèµ‹å€¼çš„æ•´æ•°æˆ–è€…æµ®ç‚¹æ•°ç±»å‹ï¼Œè½¬æ¢ä¸ºæ•´å‹æ—¶ 0ã€8ã€16ã€32ã€64 åˆ†åˆ«ä»£è¡¨ intã€int8ã€int16ã€int32ã€int64ï¼›è½¬æ¢ä¸ºæµ®ç‚¹æ•°ç±»å‹æ—¶ä¸ºfloat32ï¼ˆè¿”å›å€¼å¯ä»¥ä¸æ”¹å˜ç²¾ç¡®å€¼çš„èµ‹å€¼ç»™float32ï¼‰ã€float64ï¼›</li>
<li><code>è¿”å›çš„erræ˜¯*NumErrç±»å‹çš„</code> å¦‚æœè¯­æ³•æœ‰è¯¯ï¼Œerr.Error = ErrSyntaxï¼›å¦‚æœç»“æœè¶…å‡ºç±»å‹èŒƒå›´err.Error = ErrRangeã€‚</li>
</ul>
<p>Tips : ä¸Šè¿°å‡½æ•°éƒ½æœ‰ä¸¤ä¸ªè¿”å›å€¼ï¼Œç¬¬ä¸€ä¸ªè¿”å›å€¼æ˜¯è½¬æ¢åçš„å€¼ï¼Œç¬¬äºŒä¸ªè¿”å›å€¼ä¸ºè½¬åŒ–å¤±è´¥çš„é”™è¯¯ä¿¡æ¯ã€‚</p>
<p><strong>å®ä¾‹æ¼”ç¤º:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"strconv"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// é‡‡ç”¨strconvåŒ…è¿›è¡Œå­—ç¬¦ä¸²çš„å¼ºåˆ¶è½¬æ¢ç¤ºä¾‹æ¼”ç¤º</span></span><br><span class="line"><span class="comment">// å­—ç¬¦ä¸²ä¸æ•´å½¢äº’æ¢</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">strInteger</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// å­—ç¬¦ä¸²è½¬æ•´å‹</span></span><br><span class="line">  str := <span class="string">"1024"</span></span><br><span class="line">  ret1, err := strconv.ParseInt(str, <span class="number">10</span>, <span class="number">64</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"Parseint failed,err"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Printf(<span class="string">"Integer Ret1 = %#v %T \n"</span>, ret1, ret1) <span class="comment">// è¿”å›int64ç±»å‹</span></span><br><span class="line"></span><br><span class="line">  ret2, _ := strconv.Atoi(str) <span class="comment">// å­—ç¬¦ä¸² -&gt; æ•´æ•°</span></span><br><span class="line">  fmt.Printf(<span class="string">"Integer Ret2 = %#v %T \n"</span>, ret2, ret2) <span class="comment">// è¿”å›intç±»å‹</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ•´å½¢è½¬å­—ç¬¦ä¸²</span></span><br><span class="line">  i := <span class="keyword">int32</span>(<span class="number">1024</span>)</span><br><span class="line">  ret3 := fmt.Sprintf(<span class="string">"%d"</span>, i)</span><br><span class="line">  fmt.Printf(<span class="string">"String Ret3 = %#v %T\n"</span>, ret3, ret3)</span><br><span class="line"></span><br><span class="line">  ret4 := strconv.Itoa(<span class="keyword">int</span>(i)) <span class="comment">// int32 -&gt; int ç±»å‹ -&gt; å­—ç¬¦ä¸²</span></span><br><span class="line">  fmt.Printf(<span class="string">"String Ret4 = %#v %T\n"</span>, ret4, ret4)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­—ç¬¦ä¸²ä¸æµ®ç‚¹å‹äº’æ¢</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">strFloat</span><span class="params">()</span></span> &#123;</span><br><span class="line">  floatStr := <span class="string">"3.1415926"</span> <span class="comment">// åœ†å‘¨ç‡ Pi</span></span><br><span class="line">  floatValue, _ := strconv.ParseFloat(floatStr, <span class="number">32</span>)</span><br><span class="line">  fmt.Printf(<span class="string">"float floatValue = %#v %T\n"</span>, floatValue, floatValue)</span><br><span class="line">&#125;ã€</span><br><span class="line"><span class="comment">// å­—ç¬¦ä¸²ä¸å¸ƒå°”å‹äº’æ¢</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">strBoolean</span><span class="params">()</span></span> &#123;</span><br><span class="line">  boolStr := <span class="string">"True"</span></span><br><span class="line">  boolValue, _ := strconv.ParseBool(boolStr)</span><br><span class="line">  fmt.Printf(<span class="string">"boolean boolValue = %#v %T\n"</span>, boolValue, boolValue)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// å­—ç¬¦ä¸²ä¸æ•´å½¢äº’æ¢</span></span><br><span class="line">  strInteger()</span><br><span class="line">  <span class="comment">// å­—ç¬¦ä¸²ä¸æµ®ç‚¹å‹äº’æ¢</span></span><br><span class="line">  strFloat()</span><br><span class="line">  <span class="comment">// å­—ç¬¦ä¸²ä¸å¸ƒå°”å‹äº’æ¢</span></span><br><span class="line">  strBoolean()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Integer Ret1 = 1024 int64 </span><br><span class="line">Integer Ret2 = 1024 int </span><br><span class="line">String Ret3 = <span class="string">"1024"</span> string</span><br><span class="line">String Ret4 = <span class="string">"1024"</span> string</span><br><span class="line"><span class="built_in">float</span> floatValue = 3.141592502593994 float64</span><br><span class="line">boolean boolValue = <span class="literal">true</span> bool</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="3-Formatç³»åˆ—å‡½æ•°"><a href="#3-Formatç³»åˆ—å‡½æ•°" class="headerlink" title="3.Formatç³»åˆ—å‡½æ•°"></a>3.Formatç³»åˆ—å‡½æ•°</h3><p>æè¿°: Formatç³»åˆ—å‡½æ•°å®ç°äº†å°†ç»™å®šç±»å‹æ•°æ®æ ¼å¼åŒ–ä¸ºstringç±»å‹æ•°æ®çš„åŠŸèƒ½ã€‚</p>
<p><strong>å‡½æ•°è¯´æ˜:</strong><br><code>FormatInt()</code> : è¿”å›içš„baseè¿›åˆ¶çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚base å¿…é¡»åœ¨2åˆ°36ä¹‹é—´ï¼Œç»“æœä¸­ä¼šä½¿ç”¨å°å†™å­—æ¯â€™aâ€™åˆ°â€™zâ€™è¡¨ç¤ºå¤§äº10çš„æ•°å­—ã€‚<code>func FormatInt(i int64, base int) string</code><br><code>FormatUint()</code> : æ˜¯FormatIntçš„æ— ç¬¦å·æ•´æ•°ç‰ˆæœ¬ã€‚<code>func FormatUint(i uint64, base int) string</code><br><code>FormatFloat()</code> : å‡½æ•°å°†æµ®ç‚¹æ•°è¡¨ç¤ºä¸ºå­—ç¬¦ä¸²å¹¶è¿”å›ã€‚<code>func FormatFloat(f float64, fmt byte, prec, bitSize int) string</code><br><code>FormatBool()</code> : æ ¹æ®bçš„å€¼è¿”å›â€trueâ€æˆ–â€falseâ€ã€‚<code>func FormatBool(b bool) string</code></p>
<p><strong>å‚æ•°è¯´æ˜:</strong><br><code>base</code> æŒ‡å®šè¿›åˆ¶ï¼ˆ2åˆ°36ï¼‰ï¼Œå¦‚æœbaseä¸º0ï¼Œåˆ™ä¼šä»å­—ç¬¦ä¸²å‰ç½®åˆ¤æ–­ï¼Œâ€0xâ€æ˜¯16è¿›åˆ¶ï¼Œâ€0â€æ˜¯8è¿›åˆ¶ï¼Œå¦åˆ™æ˜¯10è¿›åˆ¶ï¼›</p>
<p><code>bitSize</code> è¡¨ç¤ºfçš„æ¥æºç±»å‹ï¼ˆ32ï¼šfloat32ã€64ï¼šfloat64ï¼‰ï¼Œä¼šæ®æ­¤è¿›è¡Œèˆå…¥ã€‚</p>
<p><code>fmt</code> è¡¨ç¤ºæ ¼å¼ï¼šâ€™fâ€™ï¼ˆ-ddd.ddddï¼‰ã€â€™bâ€™ï¼ˆ-ddddpÂ±dddï¼ŒæŒ‡æ•°ä¸ºäºŒè¿›åˆ¶ï¼‰ã€â€™eâ€™ï¼ˆ-d.ddddeÂ±ddï¼Œåè¿›åˆ¶æŒ‡æ•°ï¼‰ã€â€™Eâ€™ï¼ˆ-d.ddddEÂ±ddï¼Œåè¿›åˆ¶æŒ‡æ•°ï¼‰ã€â€™gâ€™ï¼ˆæŒ‡æ•°å¾ˆå¤§æ—¶ç”¨â€™eâ€™æ ¼å¼ï¼Œå¦åˆ™â€™fâ€™æ ¼å¼ï¼‰ã€â€™Gâ€™ï¼ˆæŒ‡æ•°å¾ˆå¤§æ—¶ç”¨â€™Eâ€™æ ¼å¼ï¼Œå¦åˆ™â€™fâ€™æ ¼å¼ï¼‰ã€‚</p>
<p><code>prec</code> æ§åˆ¶ç²¾åº¦ï¼ˆæ’é™¤æŒ‡æ•°éƒ¨åˆ†ï¼‰ï¼šå¯¹â€™fâ€™ã€â€™eâ€™ã€â€™Eâ€™ï¼Œå®ƒè¡¨ç¤ºå°æ•°ç‚¹åçš„æ•°å­—ä¸ªæ•°ï¼›å¯¹â€™gâ€™ã€â€™Gâ€™ï¼Œå®ƒæ§åˆ¶æ€»çš„æ•°å­—ä¸ªæ•°ã€‚å¦‚æœprec ä¸º-1ï¼Œåˆ™ä»£è¡¨ä½¿ç”¨æœ€å°‘æ•°é‡çš„ã€ä½†åˆå¿…éœ€çš„æ•°å­—æ¥è¡¨ç¤ºfã€‚</p>
<p><strong>ç¤ºä¾‹æ¼”ç¤º:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s1 := strconv.FormatBool(<span class="literal">true</span>)</span><br><span class="line">s2 := strconv.FormatFloat(<span class="number">3.1415</span>, <span class="string">'E'</span>, <span class="number">-1</span>, <span class="number">64</span>)</span><br><span class="line">s3 := strconv.FormatInt(<span class="number">-2</span>, <span class="number">16</span>)</span><br><span class="line">s4 := strconv.FormatUint(<span class="number">2</span>, <span class="number">16</span>)</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="6-Appendç³»åˆ—ã€Quoteç³»åˆ—ç­‰å‡½æ•°"><a href="#6-Appendç³»åˆ—ã€Quoteç³»åˆ—ç­‰å‡½æ•°" class="headerlink" title="6.Appendç³»åˆ—ã€Quoteç³»åˆ—ç­‰å‡½æ•°"></a>6.Appendç³»åˆ—ã€Quoteç³»åˆ—ç­‰å‡½æ•°</h3><p>æè¿°: strconvåŒ…ä¸­è¿˜æœ‰Appendç³»åˆ—ã€Quoteç³»åˆ—ç­‰å‡½æ•°ã€‚å…·ä½“ç”¨æ³•å¯æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ <a href="https://golang.org/pkg/strconv/" target="_blank" rel="noopener">https://golang.org/pkg/strconv/</a> , åç»­ç”¨åˆ°æ—¶æ‰©å……ã€‚</p>
<p><br></p>
<h3 id="5-æ‰©å±•è¯´æ˜"><a href="#5-æ‰©å±•è¯´æ˜" class="headerlink" title="5.æ‰©å±•è¯´æ˜"></a>5.æ‰©å±•è¯´æ˜</h3><p><code>isPrint()</code> : è¿”å›ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯å¯æ‰“å°çš„ï¼Œå’Œunicode.IsPrintä¸€æ ·ï¼Œrå¿…é¡»æ˜¯ï¼šå­—æ¯ï¼ˆå¹¿ä¹‰ï¼‰ã€æ•°å­—ã€æ ‡ç‚¹ã€ç¬¦å·ã€ASCIIç©ºæ ¼ã€‚<code>func IsPrint(r rune) bool</code><br><code>IsGraphic()</code> æŠ¥å‘Šç¬¦æ–‡æ˜¯å¦ç”±Unicodeå®šä¹‰ä¸ºå›¾å½¢ã€‚è¿™äº›å­—ç¬¦åŒ…æ‹¬å­—æ¯ã€æ ‡è®°ã€æ•°å­—ã€æ ‡ç‚¹ç¬¦å·ã€ç¬¦å·å’Œç©ºæ ¼ï¼Œå®ƒä»¬æ¥è‡ªç±»åˆ«Lã€Mã€Nã€Pã€Så’ŒZsã€‚<code>func IsGraphic(r rune) bool</code><br><code>CanBackquote()</code> : è¿”å›å­—ç¬¦ä¸²sæ˜¯å¦å¯ä»¥ä¸è¢«ä¿®æ”¹çš„è¡¨ç¤ºä¸ºä¸€ä¸ªå•è¡Œçš„ã€æ²¡æœ‰ç©ºæ ¼å’Œtabä¹‹å¤–æ§åˆ¶å­—ç¬¦çš„åå¼•å·å­—ç¬¦ä¸²ã€‚<code>func CanBackquote(s string) bool</code></p>
<p><br></p>
<p><strong>ç¤ºä¾‹æ¼”ç¤º:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a := strconv.IsPrint(<span class="string">'a'</span>)</span><br><span class="line">b := strconv.IsGraphic(<span class="string">'ä½›'</span>)</span><br><span class="line">c := strconv.CanBackquote(<span class="string">"THIS IS DEMO"</span>)</span><br><span class="line">fmt.Println(a, b, c) <span class="comment">// true true true</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="0x01-Sync-å¹¶å‘å®‰å…¨åº“"><a href="#0x01-Sync-å¹¶å‘å®‰å…¨åº“" class="headerlink" title="0x01 Sync.å¹¶å‘å®‰å…¨åº“"></a>0x01 Sync.å¹¶å‘å®‰å…¨åº“</h2><p>æè¿°: Goè¯­è¨€å¤©ç”Ÿæ˜¯æ”¯æŒå¹¶å‘çš„,æ‰€ä»¥ä¸ºäº†æ›´å¥½æ–¹ä¾¿å¼€å‘è€…çš„åŸºç¡€ä½¿ç”¨,Goè¯­è¨€ä¸­å¯ä»¥ä½¿ç”¨SyncåŒ…æä¾›åŸºæœ¬åŒæ­¥åŸè¯­ï¼Œå¦‚äº’æ–¥é”ã€‚é™¤äº†Onceå’ŒWaitGroupç±»å‹ä¹‹å¤–ï¼Œå¤§å¤šæ•°éƒ½æ˜¯ä¾›ä½çº§åº“ä¾‹ç¨‹ä½¿ç”¨çš„ï¼Œæ›´é«˜çº§åˆ«çš„åŒæ­¥æœ€å¥½é€šè¿‡é€šé“å’Œé€šä¿¡å®Œæˆã€‚</p>
<p>ä¸»è¦æœ‰ä»¥ä¸‹ç»“æ„ä½“æ–¹æ³•: WaitGroupã€Onceã€Mutexã€RWMutexã€Mapç­‰ç»“æ„ä½“ï¼Œåœ¨ä¸‹é¢æˆ‘å°†ç®€å•æè¿°å…¶ä½¿ç”¨</p>
<p>å‚è€ƒåœ°å€: <a href="https://golang.org/pkg/sync/" target="_blank" rel="noopener">https://golang.org/pkg/sync/</a></p>
<h3 id="1-sync-WaitGroup"><a href="#1-sync-WaitGroup" class="headerlink" title="1.sync.WaitGroup"></a>1.sync.WaitGroup</h3><p>æè¿°: åœ¨ä»£ç ä¸­ç”Ÿç¡¬çš„ä½¿ç”¨time.Sleepè‚¯å®šæ˜¯ä¸åˆé€‚çš„ï¼ŒGoè¯­è¨€ä¸­å¯ä»¥ä½¿ç”¨sync.WaitGroupæ¥å®ç°å¹¶å‘ä»»åŠ¡çš„åŒæ­¥ã€‚</p>
<p>sync.WaitGroup æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li><code>func (wg *WaitGroup) Add(delta int)</code>: è®¡æ•°å™¨+1</li>
<li><code>func (wg *WaitGroup) Done()</code>: è®¡æ•°å™¨-1</li>
<li><code>func (wg *WaitGroup) Wait()</code>: é˜»å¡ç›´åˆ°è®¡æ•°å™¨å˜ä¸º0</li>
</ul>
<p><code>sync.WaitGroup</code> å†…éƒ¨ç»´æŠ¤ç€ä¸€ä¸ªè®¡æ•°å™¨ï¼Œè®¡æ•°å™¨çš„å€¼å¯ä»¥å¢åŠ å’Œå‡å°‘, ä¾‹å¦‚å½“æˆ‘ä»¬å¯åŠ¨äº† N ä¸ªå¹¶å‘ä»»åŠ¡æ—¶ï¼Œå°±å°†è®¡æ•°å™¨å€¼å¢åŠ Nã€‚æ¯ä¸ªä»»åŠ¡å®Œæˆæ—¶é€šè¿‡è°ƒç”¨ <code>Done()</code> æ–¹æ³•å°†è®¡æ•°å™¨å‡1ã€‚é€šè¿‡è°ƒç”¨ <code>Wait()</code> æ¥ç­‰å¾…å¹¶å‘ä»»åŠ¡æ‰§è¡Œå®Œï¼Œå½“è®¡æ•°å™¨å€¼ä¸º0æ—¶ï¼Œè¡¨ç¤ºæ‰€æœ‰å¹¶å‘ä»»åŠ¡å·²ç»å®Œæˆã€‚</p>
<p>ä½¿ç”¨ç¤ºä¾‹:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> wg.Done() <span class="comment">// å®Œæˆæ—¶è®¡æ•°å™¨-1</span></span><br><span class="line">  fmt.Println(<span class="string">"Hello Goroutine!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  wg.Add(<span class="number">1</span>)     <span class="comment">// è®¡æ•°å™¨+1</span></span><br><span class="line">  <span class="keyword">go</span> hello()    <span class="comment">// å¯åŠ¨ä¸€ä¸ªgoroutineå»æ‰§è¡Œhelloå‡½æ•°</span></span><br><span class="line">  fmt.Println(<span class="string">"main goroutine done!"</span>)</span><br><span class="line">  wg.Wait()     <span class="comment">//  é˜»å¡ç›´åˆ°è®¡æ•°å™¨å˜ä¸º0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Tips: æ³¨æ„sync.WaitGroupæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œä¼ é€’çš„æ—¶å€™è¦ä¼ é€’æŒ‡é’ˆã€‚</p>
<p><br></p>
<h3 id="2-sync-Once"><a href="#2-sync-Once" class="headerlink" title="2.sync.Once"></a>2.sync.Once</h3><p>æè¿°: åœ¨goroutineæ‰§è¡ŒæŸä¸€ä»»åŠ¡,æˆ‘ä»¬æƒ³å½“æœ€åä¸€ä¸ªgoroutineä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œå°±å…³é—­ä»»åŠ¡ä¸­çš„é€šé“ï¼Œæ­¤æ—¶ä¸ºäº†é˜²æ­¢å…¶å®ƒçº¿ç¨‹æ‰§è¡Œå®Œæ¯•æ—¶å¤šæ¬¡å…³é—­ä»»åŠ¡ä¸­çš„é€šé“å¯¼è‡´ç¨‹åºPanicï¼Œä¸ºäº†ç¡®ä¿å…³é—­é€šé“åªæ‰§è¡Œä¸€æ¬¡ï¼Œåœ¨Goè¯­è¨€ä¸­çš„syncåŒ…ä¸­æä¾›äº†ä¸€ä¸ªé’ˆå¯¹åªæ‰§è¡Œä¸€æ¬¡åœºæ™¯çš„è§£å†³æ–¹æ¡ˆ<code>sync.Once</code>ã€‚</p>
<p>åœ¨ç¼–ç¨‹çš„å¾ˆå¤šåœºæ™¯ä¸‹æˆ‘ä»¬éœ€è¦ç¡®ä¿æŸäº›æ“ä½œåœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹åªæ‰§è¡Œä¸€æ¬¡ï¼Œä¾‹å¦‚åªåŠ è½½ä¸€æ¬¡é…ç½®æ–‡ä»¶ã€åªå…³é—­ä¸€æ¬¡é€šé“ç­‰ã€‚</p>
<p>sync.Once åªæœ‰ä¸€ä¸ªDoæ–¹æ³•åŸå‹: <code>func (o *Once) Do(f func()) {}</code></p>
<p>Tips: å¦‚æœè¦æ‰§è¡Œçš„å‡½æ•°féœ€è¦ä¼ é€’å‚æ•°ï¼Œæ­¤æ—¶éœ€è¦æ­é…é—­åŒ…æ¥ä½¿ç”¨ã€‚</p>
<p><br/></p>
<p><strong>ç¤ºä¾‹1.åŠ è½½é…ç½®æ–‡ä»¶è¯´æ˜</strong><br>æè¿°: å»¶è¿Ÿä¸€ä¸ªå¼€é”€å¾ˆå¤§çš„åˆå§‹åŒ–æ“ä½œåˆ°çœŸæ­£ç”¨åˆ°å®ƒçš„æ—¶å€™å†æ‰§è¡Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å®è·µã€‚å› ä¸ºé¢„å…ˆåˆå§‹åŒ–ä¸€ä¸ªå˜é‡ï¼ˆæ¯”å¦‚åœ¨initå‡½æ•°ä¸­å®Œæˆåˆå§‹åŒ–ï¼‰ä¼šå¢åŠ ç¨‹åºçš„å¯åŠ¨è€—æ—¶ï¼Œè€Œä¸”æœ‰å¯èƒ½å®é™…æ‰§è¡Œè¿‡ç¨‹ä¸­è¿™ä¸ªå˜é‡æ²¡æœ‰ç”¨ä¸Šï¼Œé‚£ä¹ˆè¿™ä¸ªåˆå§‹åŒ–æ“ä½œå°±ä¸æ˜¯å¿…é¡»è¦åšçš„ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> icons <span class="keyword">map</span>[<span class="keyword">string</span>]image.Image <span class="comment">// å£°æ˜ä¸€ä¸ª Map ç±»å‹çš„iconså˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadIcons</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// å®ä¾‹åŒ–</span></span><br><span class="line">  icons = <span class="keyword">map</span>[<span class="keyword">string</span>]image.Image &#123;</span><br><span class="line">    <span class="string">"left"</span>:  loadIcon(<span class="string">"left.png"</span>),</span><br><span class="line">    <span class="string">"up"</span>:    loadIcon(<span class="string">"up.png"</span>),</span><br><span class="line">    <span class="string">"right"</span>: loadIcon(<span class="string">"right.png"</span>),</span><br><span class="line">    <span class="string">"down"</span>:  loadIcon(<span class="string">"down.png"</span>),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Icon è¢«å¤šä¸ªgoroutineè°ƒç”¨æ—¶ä¸æ˜¯å¹¶å‘å®‰å…¨çš„</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Icon</span><span class="params">(name <span class="keyword">string</span>)</span> <span class="title">image</span>.<span class="title">Image</span></span> &#123;</span><br><span class="line">  <span class="comment">// åˆ¤è¯» icons å¦‚æœä¸ºnilè¡¨ç¤ºæ²¡æœ‰å€¼ä¸ºç©ºã€‚</span></span><br><span class="line">  <span class="keyword">if</span> icons == <span class="literal">nil</span> &#123;</span><br><span class="line">    loadIcons()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> icons[name]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¤šä¸ª<code>goroutine</code>å¹¶å‘è°ƒç”¨Iconå‡½æ•°æ—¶ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œç°ä»£çš„ç¼–è¯‘å™¨å’ŒCPUå¯èƒ½ä¼šåœ¨ä¿è¯æ¯ä¸ªgoroutineéƒ½æ»¡è¶³ä¸²è¡Œä¸€è‡´çš„åŸºç¡€ä¸Šè‡ªç”±åœ°é‡æ’è®¿é—®å†…å­˜çš„é¡ºåºã€‚</p>
<p>loadIconså‡½æ•°å¯èƒ½ä¼šè¢«é‡æ’ä¸ºä»¥ä¸‹ç»“æœï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadIcons</span><span class="params">()</span></span> &#123;</span><br><span class="line">  icons = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]image.Image)</span><br><span class="line">  icons[<span class="string">"left"</span>] = loadIcon(<span class="string">"left.png"</span>)</span><br><span class="line">  icons[<span class="string">"up"</span>] = loadIcon(<span class="string">"up.png"</span>)</span><br><span class="line">  icons[<span class="string">"right"</span>] = loadIcon(<span class="string">"right.png"</span>)</span><br><span class="line">  icons[<span class="string">"down"</span>] = loadIcon(<span class="string">"down.png"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>åœ¨è¿™ç§æƒ…å†µä¸‹å°±ä¼šå‡ºç°<code>å³ä½¿åˆ¤æ–­äº†iconsä¸æ˜¯nilä¹Ÿä¸æ„å‘³ç€å˜é‡åˆå§‹åŒ–å®Œæˆäº†</code>è€ƒè™‘åˆ°è¿™ç§æƒ…å†µ; æˆ‘ä»¬èƒ½æƒ³åˆ°çš„åŠæ³•å°±æ˜¯æ·»åŠ äº’æ–¥é”ï¼Œä¿è¯åˆå§‹åŒ–iconsçš„æ—¶å€™ä¸ä¼šè¢«å…¶ä»–çš„<code>goroutine</code>æ“ä½œï¼Œä½†æ˜¯è¿™æ ·åšåˆä¼šå¼•å‘æ€§èƒ½é—®é¢˜ã€‚</p>
<p>ä½¿ç”¨sync.Onceæ”¹é€ çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> icons <span class="keyword">map</span>[<span class="keyword">string</span>]image.Image</span><br><span class="line"><span class="keyword">var</span> loadIconsOnce sync.Once</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadIcons</span><span class="params">()</span></span> &#123;</span><br><span class="line">  icons = <span class="keyword">map</span>[<span class="keyword">string</span>]image.Image&#123;</span><br><span class="line">    <span class="string">"left"</span>:  loadIcon(<span class="string">"left.png"</span>),</span><br><span class="line">    <span class="string">"up"</span>:    loadIcon(<span class="string">"up.png"</span>),</span><br><span class="line">    <span class="string">"right"</span>: loadIcon(<span class="string">"right.png"</span>),</span><br><span class="line">    <span class="string">"down"</span>:  loadIcon(<span class="string">"down.png"</span>),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Icon æ˜¯å¹¶å‘å®‰å…¨çš„</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Icon</span><span class="params">(name <span class="keyword">string</span>)</span> <span class="title">image</span>.<span class="title">Image</span></span> &#123;</span><br><span class="line">  loadIconsOnce.Do(loadIcons)</span><br><span class="line">  <span class="keyword">return</span> icons[name]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>ç¤ºä¾‹2.å¹¶å‘å®‰å…¨çš„å•ä¾‹æ¨¡å¼</strong><br>æè¿°: ä¸‹é¢æ˜¯å€ŸåŠ©sync.Onceå®ç°çš„å¹¶å‘å®‰å…¨çš„å•ä¾‹æ¨¡å¼<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> singleton <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"><span class="keyword">var</span> instance *singleton</span><br><span class="line"><span class="keyword">var</span> once sync.Once</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetInstance</span><span class="params">()</span> *<span class="title">singleton</span></span> &#123;</span><br><span class="line">  <span class="comment">// ç¡®ä¿å®ä¾‹åŒ–singletonåªåšä¸€æ¬¡</span></span><br><span class="line">  once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    instance = &amp;singleton&#123;&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> instance</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Tips : sync.Once å…¶å®å†…éƒ¨åŒ…å«ä¸€ä¸ªäº’æ–¥é”å’Œä¸€ä¸ªå¸ƒå°”å€¼ï¼Œäº’æ–¥é”ä¿è¯å¸ƒå°”å€¼å’Œæ•°æ®çš„å®‰å…¨, è€Œå¸ƒå°”å€¼ç”¨æ¥è®°å½•åˆå§‹åŒ–æ˜¯å¦å®Œæˆã€‚è¿™æ ·è®¾è®¡å°±èƒ½ä¿è¯åˆå§‹åŒ–æ“ä½œçš„æ—¶å€™æ˜¯å¹¶å‘å®‰å…¨çš„,å¹¶ä¸”åˆå§‹åŒ–æ“ä½œä¹Ÿä¸ä¼šè¢«æ‰§è¡Œå¤šæ¬¡ã€‚</p>
<p><br></p>
<h3 id="3-sync-Map"><a href="#3-sync-Map" class="headerlink" title="3.sync.Map"></a>3.sync.Map</h3><p>æè¿°: SynåŒ…ä¸­çš„ Map ç±»ä¼¼äºGoè¯­è¨€å†…ç½®Mapä½†å…¶æ˜¯è¿™æ ·<code>map[interface{}]interface{}</code>ç±»å‹ï¼Œä½†å¯¹äºå¤šä¸ªgoroutineå¹¶å‘ä½¿ç”¨æ˜¯å®‰å…¨çš„ï¼Œæ— éœ€é¢å¤–çš„é”å®šæˆ–åè°ƒã€‚åŠ è½½ã€å­˜å‚¨å’Œåˆ é™¤åœ¨æ‘Šä½™å›ºå®šæ—¶é—´å†…è¿è¡Œã€‚</p>
<p>Map ç±»å‹æ˜¯ä¸“ç”¨çš„ï¼Œå¤§å¤šæ•°ä»£ç åº”è¯¥ä½¿ç”¨ä¸€ä¸ªæ™®é€šçš„Go Mapæ¥ä»£æ›¿ï¼Œå¹¶å¸¦æœ‰å•ç‹¬çš„é”å®šæˆ–åè°ƒï¼Œä»¥æé«˜ç±»å‹å®‰å…¨æ€§ï¼Œå¹¶ä½¿ç»´æŠ¤å…¶ä»–ä¸å˜é‡ä»¥åŠMapå†…å®¹å˜å¾—æ›´å®¹æ˜“ã€‚</p>
<p>Mapç±»å‹é’ˆå¯¹ä¸¤ç§å¸¸è§çš„ä½¿ç”¨æƒ…å†µè¿›è¡Œäº†ä¼˜åŒ–ï¼š<br>ï¼ˆ1ï¼‰å½“ç»™å®šå¯†é’¥çš„æ¡ç›®åªå†™å…¥ä¸€æ¬¡ä½†å¤šæ¬¡è¯»å–æ—¶ï¼ˆå¦‚åœ¨ä»…å¢é•¿çš„ç¼“å­˜ä¸­ï¼‰<br>ï¼ˆ2ï¼‰å½“å¤šä¸ªgoroutineè¯»å–ã€å†™å…¥å’Œè¦†ç›–ä¸ç›¸äº¤å¯†é’¥é›†çš„æ¡ç›®æ—¶ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œä¸Go Mapä¸å•ç‹¬çš„äº’æ–¥æˆ–RWäº’æ–¥é…å¯¹ç›¸æ¯”ï¼Œä½¿ç”¨Mapå¯ä»¥æ˜¾è‘—å‡å°‘é”äº‰ç”¨ã€‚</p>
<p>Tips: ç©ºå€¼çš„Mapä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚</p>
<p>sync.Map ä¸­çš„æ–¹æ³•å¦‚ä¸‹:</p>
<ul>
<li>func (m *Map) Delete(key interface{}) : åˆ é™¤é”®çš„å€¼ã€‚</li>
<li>func (m *Map) Load(key interface{}) (value interface{}, ok bool): åŠ è½½è¿”å›åœ°å›¾ä¸­å­˜å‚¨çš„é”®å€¼ã€‚</li>
<li>func (m *Map) LoadAndDelete(key interface{}) (value interface{}, loaded bool): åŠ è½½ä»¥åŠåˆ é™¤é”®çš„å€¼ã€‚</li>
<li>func (m *Map) LoadOrStore(key, value interface{}) (actual interface{}, loaded bool): ä¼šé€€å›é”®çš„ç°æœ‰å€¼</li>
<li>func (m *Map) Range(f func(key, value interface{}) bool): èŒƒå›´æŒ‰é¡ºåºè°ƒç”¨åœ°å›¾ä¸­å­˜åœ¨çš„æ¯ä¸ªé”®å’Œå€¼ã€‚å¦‚æœ f è¿”å›é”™è¯¯ï¼ŒèŒƒå›´å°†åœæ­¢è¿­ä»£ã€‚</li>
<li>func (m *Map) Store(key, value interface{}) : è®¾ç½®é”®çš„å€¼ã€‚</li>
</ul>
<p><br/></p>
<p><strong>ç¤ºä¾‹1.Goè¯­è¨€ä¸­å†…ç½®çš„mapä¸æ˜¯å¹¶å‘å®‰å…¨çš„</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> m = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">get</span><span class="params">(key <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> m[key]</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">set</span><span class="params">(key <span class="keyword">string</span>, value <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  m[key] = value</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">20</span>; i++ &#123;</span><br><span class="line">    wg.Add(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(n <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">      key := strconv.Itoa(n)  <span class="comment">// æ•´å‹è½¬ä¸ºå­—ç¬¦ä¸²ç±»å‹ã€‚</span></span><br><span class="line">      set(key, n) <span class="comment">// è¯»</span></span><br><span class="line">      fmt.Printf(<span class="string">"k=:%v,v:=%v\n"</span>, key, get(key)) <span class="comment">// å†™</span></span><br><span class="line">      wg.Done()</span><br><span class="line">    &#125;(i)</span><br><span class="line">  &#125;</span><br><span class="line">  wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Tips: ä¸Šé¢çš„ä»£ç å¼€å¯å°‘é‡å‡ ä¸ªgoroutineçš„æ—¶å€™å¯èƒ½æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œå½“å¹¶å‘å¤šäº†(æ•°é‡å¤§äºç­‰äº21æ—¶)ä¹‹åæ‰§è¡Œä¸Šé¢çš„ä»£ç å°±ä¼šæŠ¥<code>fatal error: concurrent map writes</code>é”™è¯¯ï¼Œåƒè¿™ç§åœºæ™¯ä¸‹å°±éœ€è¦ä¸ºmapåŠ é”æ¥ä¿è¯å¹¶å‘çš„å®‰å…¨æ€§äº†ã€‚</p>
<p>Goè¯­è¨€çš„syncåŒ…ä¸­æä¾›äº†ä¸€ä¸ªå¼€ç®±å³ç”¨çš„å¹¶å‘å®‰å…¨ç‰ˆçš„mapå°±æ˜¯<code>sync.Map</code>ã€‚å¼€ç®±å³ç”¨è¡¨ç¤ºå®ƒä¸ç”¨åƒå†…ç½®çš„mapä¸€æ ·ä½¿ç”¨makeå‡½æ•°åˆå§‹åŒ–å°±èƒ½ç›´æ¥ä½¿ç”¨ï¼ŒåŒæ—¶sync.Mapå†…ç½®äº†è¯¸å¦‚Storeã€Loadã€LoadOrStoreã€Deleteã€Rangeç­‰æ“ä½œæ–¹æ³•,æé«˜äº†ä½¿ç”¨ä¾¿åˆ©æ€§åŠå®‰å…¨æ€§ã€‚</p>
<p><strong>å®é™…æ¡ˆä¾‹</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"strconv"</span></span><br><span class="line">  <span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">var</span> m = sync.Map&#123;&#125;  <span class="comment">// å¹¶å‘å®‰å…¨ç‰ˆçš„Mapç±»å‹å˜é‡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  wg := sync.WaitGroup&#123;&#125;  <span class="comment">// å¹¶å‘æ‰§è¡Œç­‰å¾…ç»„å˜é‡</span></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">20</span>; i++ &#123;</span><br><span class="line">    wg.Add(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(n <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">      key := strconv.Itoa(n)</span><br><span class="line">      m.Store(key, n)  <span class="comment">// å°†nå­˜å…¥ m["key"]=n</span></span><br><span class="line">      value, _ := m.Load(key) <span class="comment">// è¯»å–å­˜å…¥ m["key"] çš„å€¼</span></span><br><span class="line">      fmt.Printf(<span class="string">"k=:%v,v:=%v\n"</span>, key, value)</span><br><span class="line">      wg.Done()</span><br><span class="line">    &#125;(i)</span><br><span class="line">  &#125;</span><br><span class="line">  wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœ:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">k=:<span class="number">19</span>,v:=<span class="number">19</span></span><br><span class="line">k=:<span class="number">0</span>,v:=<span class="number">0</span></span><br><span class="line">k=:<span class="number">1</span>,v:=<span class="number">1</span></span><br><span class="line">k=:<span class="number">2</span>,v:=<span class="number">2</span></span><br><span class="line">k=:<span class="number">3</span>,v:=<span class="number">3</span></span><br><span class="line">k=:<span class="number">4</span>,v:=<span class="number">4</span></span><br><span class="line">k=:<span class="number">5</span>,v:=<span class="number">5</span></span><br><span class="line">k=:<span class="number">6</span>,v:=<span class="number">6</span></span><br><span class="line">k=:<span class="number">7</span>,v:=<span class="number">7</span></span><br><span class="line">k=:<span class="number">8</span>,v:=<span class="number">8</span></span><br><span class="line">k=:<span class="number">9</span>,v:=<span class="number">9</span></span><br><span class="line">k=:<span class="number">10</span>,v:=<span class="number">10</span></span><br><span class="line">k=:<span class="number">11</span>,v:=<span class="number">11</span></span><br><span class="line">k=:<span class="number">12</span>,v:=<span class="number">12</span></span><br><span class="line">k=:<span class="number">13</span>,v:=<span class="number">13</span></span><br><span class="line">k=:<span class="number">14</span>,v:=<span class="number">14</span></span><br><span class="line">k=:<span class="number">15</span>,v:=<span class="number">15</span></span><br><span class="line">k=:<span class="number">16</span>,v:=<span class="number">16</span></span><br><span class="line">k=:<span class="number">17</span>,v:=<span class="number">17</span></span><br><span class="line">k=:<span class="number">18</span>,v:=<span class="number">18</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="4-sync-Mutexã€RWMutex"><a href="#4-sync-Mutexã€RWMutex" class="headerlink" title="4.sync.Mutexã€RWMutex"></a>4.sync.Mutexã€RWMutex</h3><p>æè¿°: åœ¨Mutexã€RWMutexç»“æ„ä½“ä¸­åˆ†åˆ«å®šä¹‰çš„æ˜¯äº’æ–¥é”å’Œè¯»å†™é”ã€‚<br>äº’æ–¥é”: ä¸»è¦ç”¨äºé˜²æ­¢èµ„æºç«äº‰é—®é¢˜çš„åº”ç”¨åœºæ™¯ï¼Œä¸€ä¸ªäº’æ–¥é”åªèƒ½åŒæ—¶è¢«ä¸€ä¸ª goroutine é”å®šï¼Œå…¶å®ƒ goroutine å°†é˜»å¡ç›´åˆ°äº’æ–¥é”è¢«è§£é”ã€‚<br>è¯»å†™é”: ä¸»è¦ç”¨äºè¯»å¤šå†™å°‘çš„åº”ç”¨åœºæ™¯ï¼Œå®ƒæ˜¯é’ˆå¯¹è¯»å†™æ“ä½œçš„äº’æ–¥é”ï¼Œè¯»å†™é”ä¸äº’æ–¥é”æœ€å¤§çš„ä¸åŒå°±æ˜¯å¯ä»¥åˆ†åˆ«å¯¹ è¯»ã€å†™ è¿›è¡Œé”å®šã€‚</p>
<p><strong>æ–¹æ³•åŸå‹:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sync.Mutex</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Mutex)</span> <span class="title">Lock</span><span class="params">()</span>   // åŠ é”</span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="params">(m *Mutex)</span> <span class="title">Unlock</span><span class="params">()</span> // è§£é”</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// <span class="title">sync</span>.<span class="title">RWMutex</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="params">(rw *RWMutex)</span> <span class="title">Lock</span><span class="params">()</span>   // åŠ å†™é”</span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="params">(rw *RWMutex)</span> <span class="title">Unlock</span><span class="params">()</span> // è§£å†™é”</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="params">(rw *RWMutex)</span> <span class="title">RLock</span><span class="params">()</span>  // åŠ è¯»é”</span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="params">(rw *RWMutex)</span> <span class="title">RUnlock</span><span class="params">()</span>// è§£è¯»é”</span></span><br></pre></td></tr></table></figure></p>
<p><strong>è¡¥å……è¯´æ˜:</strong></p>
<ul>
<li>å½“æœ‰ä¸€ä¸ª goroutine è·å¾—å†™é”å®šï¼Œå…¶å®ƒæ— è®ºæ˜¯è¯»é”å®šè¿˜æ˜¯å†™é”å®šéƒ½å°†é˜»å¡ç›´åˆ°å†™è§£é”ï¼›</li>
<li>å½“æœ‰ä¸€ä¸ª goroutine è·å¾—è¯»é”å®šï¼Œå…¶å®ƒè¯»é”å®šä»»ç„¶å¯ä»¥ç»§ç»­ï¼›</li>
<li>å½“æœ‰ä¸€ä¸ªæˆ–ä»»æ„å¤šä¸ªè¯»é”å®šï¼Œå†™é”å®šå°†ç­‰å¾…æ‰€æœ‰è¯»é”å®šè§£é”ä¹‹åæ‰èƒ½å¤Ÿè¿›è¡Œå†™é”å®š;</li>
</ul>
<p>æ‰€ä»¥è¯´è¿™é‡Œçš„è¯»é”å®šï¼ˆRLockï¼‰ç›®çš„å…¶å®æ˜¯å‘Šè¯‰å†™é”å®šï¼šæœ‰å¾ˆå¤šäººæ­£åœ¨è¯»å–æ•°æ®ï¼Œä½ éœ€è¦æ’é˜Ÿç­‰å¾…;</p>
<p><br/></p>
<p><strong>å®è·µç¤ºä¾‹1: Mutex äº’æ–¥é”</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">0</span></span><br><span class="line">  <span class="comment">// å¯åŠ¨è¶³å¤Ÿå¤šä¸ªåç¨‹</span></span><br><span class="line">  <span class="keyword">var</span> lock sync.Mutex</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(idx <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">        lock.Lock()  <span class="comment">// åŠ é”</span></span><br><span class="line">        <span class="keyword">defer</span> lock.Unlock() <span class="comment">// æ‰§è¡Œå®Œæ¯•åè§£é”</span></span><br><span class="line">        a += <span class="number">1</span></span><br><span class="line">        fmt.Printf(<span class="string">"goroutine %d, a=%d\n"</span>, idx, a)</span><br><span class="line">    &#125;(i)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ä¸»ç¨‹åºç­‰å¾…1s ç¡®ä¿æ‰€æœ‰åç¨‹æ‰§è¡Œå®Œ</span></span><br><span class="line">  time.Sleep(time.Second)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœ: æ­¤æ—¶ä½ å°†å‘ç°ç»“æœä¸ä»…æ²¡æœ‰å‘ç°æŠ¢å èµ„æºå¯¼è‡´çš„è¾“å‡ºé‡å¤,è€Œä¸”è¾“å‡ºç»“æœé¡ºåºé€’å¢.<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">goroutine <span class="number">42946</span>, a=<span class="number">47847</span></span><br><span class="line">goroutine <span class="number">42947</span>, a=<span class="number">47848</span></span><br><span class="line">goroutine <span class="number">42948</span>, a=<span class="number">47849</span></span><br><span class="line">goroutine <span class="number">42949</span>, a=<span class="number">47850</span></span><br><span class="line">goroutine <span class="number">42856</span>, a=<span class="number">47851</span></span><br><span class="line">goroutine <span class="number">42950</span>, a=<span class="number">47852</span></span><br><span class="line">goroutine <span class="number">42857</span>, a=<span class="number">47853</span></span><br><span class="line">goroutine <span class="number">42951</span>, a=<span class="number">47854</span></span><br><span class="line">goroutine <span class="number">42858</span>, a=<span class="number">47855</span></span><br><span class="line">goroutine <span class="number">42952</span>, a=<span class="number">47856</span></span><br><span class="line">goroutine <span class="number">42859</span>, a=<span class="number">47857</span></span><br><span class="line">goroutine <span class="number">43050</span>, a=<span class="number">47858</span></span><br><span class="line">goroutine <span class="number">42860</span>, a=<span class="number">47859</span></span><br><span class="line">goroutine <span class="number">42953</span>, a=<span class="number">47860</span></span><br><span class="line">goroutine <span class="number">42861</span>, a=<span class="number">47861</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>å®è·µç¤ºä¾‹1: RWMutex è¯»å†™é”é”</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"sync"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m *sync.RWMutex</span><br><span class="line"><span class="keyword">var</span> val = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// read æ–¹æ³•åº”ç”¨äº†è¯»é”RLock;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  m.RLock()</span><br><span class="line">  <span class="built_in">println</span>(<span class="string">"è¯»: "</span>, i, val)</span><br><span class="line">  time.Sleep(<span class="number">3</span> * time.Second) <span class="comment">// ä¸ºäº†éªŒè¯åç¨‹æŠ¢å¤ºèµ„æº, è¯»å†™æ–¹æ³•ä¸­æˆ‘ä»¬è®©ç¨‹åºä¼‘çœ ä¸€å®šçš„æ—¶é—´;</span></span><br><span class="line">  <span class="built_in">println</span>(<span class="string">"è¯»ç»“æŸ"</span>)</span><br><span class="line">  <span class="keyword">defer</span> m.RUnlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  write æ–¹æ³•åº”ç”¨äº†å†™é” Lock;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">write</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  m.Lock()</span><br><span class="line">  val = val + <span class="number">10</span></span><br><span class="line">  <span class="built_in">println</span>(<span class="string">"å†™: "</span>, i, val)</span><br><span class="line">  time.Sleep(<span class="number">3</span> * time.Second) <span class="comment">// ä¸ºäº†éªŒè¯åç¨‹æŠ¢å¤ºèµ„æº, è¯»å†™æ–¹æ³•ä¸­æˆ‘ä»¬è®©ç¨‹åºä¼‘çœ ä¸€å®šçš„æ—¶é—´;</span></span><br><span class="line">  <span class="built_in">println</span>(<span class="string">"å†™ç»“æŸ"</span>)</span><br><span class="line">  <span class="keyword">defer</span> m.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  m = <span class="built_in">new</span>(sync.RWMutex)</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">go</span> read(<span class="number">1</span>)  <span class="comment">// è¯»</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="number">5</span>; j++ &#123;</span><br><span class="line">    <span class="keyword">go</span> write(<span class="number">2</span>) <span class="comment">// å†™</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> m := <span class="number">0</span>; m &lt; <span class="number">5</span>; m++ &#123;</span><br><span class="line">    <span class="keyword">go</span> read(<span class="number">3</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ­¤å¤„é˜²æ­¢ä¸»ç¨‹åºæå‰é€€å‡º,goroutine åç¨‹å‡½æ•°è¿˜æœªæ‰§è¡Œå®Œ.</span></span><br><span class="line">  time.Sleep(<span class="number">25</span> * time.Second)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">è¯»:  <span class="number">1</span> <span class="number">10</span></span><br><span class="line">è¯»:  <span class="number">3</span> <span class="number">10</span></span><br><span class="line">è¯»:  <span class="number">3</span> <span class="number">10</span></span><br><span class="line">è¯»:  <span class="number">3</span> <span class="number">10</span></span><br><span class="line">è¯»:  <span class="number">1</span> <span class="number">10</span></span><br><span class="line">è¯»:  <span class="number">1</span> <span class="number">10</span></span><br><span class="line">è¯»ç»“æŸ</span><br><span class="line">è¯»ç»“æŸ</span><br><span class="line">è¯»ç»“æŸ</span><br><span class="line">è¯»ç»“æŸ</span><br><span class="line">è¯»ç»“æŸ</span><br><span class="line">è¯»ç»“æŸ</span><br><span class="line">è¯»ç»“æŸ</span><br><span class="line">è¯»ç»“æŸ</span><br><span class="line">è¯»ç»“æŸ</span><br><span class="line">å†™:  <span class="number">2</span> <span class="number">20</span></span><br><span class="line">å†™ç»“æŸ</span><br><span class="line">å†™:  <span class="number">2</span> <span class="number">30</span></span><br><span class="line">å†™ç»“æŸ</span><br><span class="line">å†™:  <span class="number">2</span> <span class="number">40</span></span><br><span class="line">å†™ç»“æŸ</span><br><span class="line">å†™:  <span class="number">2</span> <span class="number">50</span></span><br><span class="line">å†™ç»“æŸ</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„: æ¯æ¬¡æ‰§è¡Œçš„ç»“æœéƒ½æœ‰å·®å¼‚, å½“ä½ å¤åˆ¶ä¸Šé¢ä»£ç è¿è¡Œç»“æœå’Œä¸Šé¢æœ‰æ‰€ä¸åŒ, ä½†æ˜¯ç»“æœå±•ç¤ºå‡ºæ¥çš„è§„å¾‹å´æ˜¯ä¸€è‡´çš„:</p>
<ul>
<li><p>è§„å¾‹ä¸€: <code>[åŒæ—¶å¯ä»¥æœ‰ä»»æ„å¤šä¸ª gorouinte è·å¾—è¯»é”å®š]</code></p>
<blockquote>
<p>RWMutex è¯»é”å¯ä»¥å¹¶å‘å¤šä¸ªæ‰§è¡Œ,ä»ä¸Šé¢read ç¨‹åºå’Œç¨‹åºæ‰§è¡Œè¾“å‡ºçš„å†…å®¹æ¥çœ‹<br>è¯´æ˜åœ¨åŠ ä¸Šè¯»å–é”æ—¶,å…¶ä»– goroutine ä¾ç„¶å¯ä»¥å¹¶å‘å¤šä¸ª è¯» è®¿é—®.</p>
</blockquote>
</li>
<li><p>è§„å¾‹äºŒ: <code>[åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ª goroutine èƒ½å¤Ÿè·å¾—å†™é”å®š]</code></p>
<blockquote>
<p>RWMutex å†™è·å¾—é”å®šæ—¶,ä¸è®ºç¨‹åºä¼‘çœ å¤šé•¿æ—¶é—´,ä¸€å®šä¼šè¾“å‡º å†™ç»“æŸ,å…¶ä»– goroutine æ‰èƒ½è·å¾—é”èµ„æº.</p>
</blockquote>
</li>
<li><p>è§„å¾‹ä¸‰: <code>[åŒæ—¶åªèƒ½å­˜åœ¨å†™é”å®šæˆ–è¯»é”å®šï¼ˆè¯»å’Œå†™äº’æ–¥ï¼‰]</code></p>
<blockquote>
<p>è¯»è™½ç„¶å¯ä»¥åŒæ—¶å¤šä¸ª goroutine æ¥é”å®š,ä½†æ˜¯å†™é”å®šä¹‹å‰å…¶ä»–å¤šä¸ªè¯»é”å®šå¿…é¡»å…¨éƒ¨é‡Šæ”¾é”.<br>å†™é”å®šè·å¾—é”æ—¶,å…¶ä»– è¯» æˆ–è€… å†™ éƒ½æ— æ³•å†è·å¾—é”,ç›´åˆ°æ­¤ goroutine å†™ç»“æŸ,é‡Šæ”¾é”å,å…¶ä»– goroutine æ‰ä¼šäº‰å¤º.<br>æ‰€ä»¥ è¯»å’Œå†™ çš„ä¿©ç§é”æ˜¯äº’æ–¥çš„.</p>
</blockquote>
</li>
</ul>
<p><br/></p>
<p>Tips: å¯¹ä¸€ä¸ªæœªé”å®šçš„äº’æ–¥é”è§£é”å°†ä¼šäº§ç”Ÿè¿è¡Œæ—¶é”™è¯¯ï¼Œå¹¶ä¸”ä¸Šé¢çš„é”å¿…é¡»æˆå¯¹ä½¿ç”¨ä¸èƒ½äº’ç›¸æ‹†åˆ†æ··ç”¨,å¦åˆ™ä¼šå‘ç”Ÿè¿è¡Œæ—¶é”™è¯¯ã€‚</p>
<hr>
<h2 id="0x02-Atomic-åŸå­æ“ä½œåº“"><a href="#0x02-Atomic-åŸå­æ“ä½œåº“" class="headerlink" title="0x02 Atomic.åŸå­æ“ä½œåº“"></a>0x02 Atomic.åŸå­æ“ä½œåº“</h2><p>æè¿°: Goè¯­è¨€ä¸­åŸå­æ“ä½œç”±å†…ç½®çš„æ ‡å‡†åº“<code>sync/atomic</code>æä¾›,å®ƒå¯ä»¥ä¸ºæˆ‘ä»¬æä¾›æ›´é«˜æ€§èƒ½æ•ˆç‡çš„å¹¶å‘åŒæ­¥å®‰å…¨ã€‚</p>
<p><strong>å¸¸ç”¨æ–¹æ³•åŸå‹:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯»å–æ“ä½œ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">LoadInt32</span><span class="params">(addr *<span class="keyword">int32</span>)</span> <span class="params">(val <span class="keyword">int32</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">LoadInt64</span><span class="params">(addr *<span class="keyword">int64</span>)</span> <span class="params">(val <span class="keyword">int64</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">LoadUint32</span><span class="params">(addr *<span class="keyword">uint32</span>)</span> <span class="params">(val <span class="keyword">uint32</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">LoadUint64</span><span class="params">(addr *<span class="keyword">uint64</span>)</span> <span class="params">(val <span class="keyword">uint64</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">LoadUintptr</span><span class="params">(addr *<span class="keyword">uintptr</span>)</span> <span class="params">(val <span class="keyword">uintptr</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">LoadPointer</span><span class="params">(addr *unsafe.Pointer)</span> <span class="params">(val unsafe.Pointer)</span> 	</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// å†™å…¥æ“ä½œ</span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">StoreInt32</span><span class="params">(addr *<span class="keyword">int32</span>, val <span class="keyword">int32</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">StoreInt64</span><span class="params">(addr *<span class="keyword">int64</span>, val <span class="keyword">int64</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">StoreUint32</span><span class="params">(addr *<span class="keyword">uint32</span>, val <span class="keyword">uint32</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">StoreUint64</span><span class="params">(addr *<span class="keyword">uint64</span>, val <span class="keyword">uint64</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">StoreUintptr</span><span class="params">(addr *<span class="keyword">uintptr</span>, val <span class="keyword">uintptr</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">StorePointer</span><span class="params">(addr *unsafe.Pointer, val unsafe.Pointer)</span> 	</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// ä¿®æ”¹æ“ä½œ</span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">AddInt32</span><span class="params">(addr *<span class="keyword">int32</span>, delta <span class="keyword">int32</span>)</span> <span class="params">(<span class="built_in">new</span> <span class="keyword">int32</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">AddInt64</span><span class="params">(addr *<span class="keyword">int64</span>, delta <span class="keyword">int64</span>)</span> <span class="params">(<span class="built_in">new</span> <span class="keyword">int64</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">AddUint32</span><span class="params">(addr *<span class="keyword">uint32</span>, delta <span class="keyword">uint32</span>)</span> <span class="params">(<span class="built_in">new</span> <span class="keyword">uint32</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">AddUint64</span><span class="params">(addr *<span class="keyword">uint64</span>, delta <span class="keyword">uint64</span>)</span> <span class="params">(<span class="built_in">new</span> <span class="keyword">uint64</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">AddUintptr</span><span class="params">(addr *<span class="keyword">uintptr</span>, delta <span class="keyword">uintptr</span>)</span> <span class="params">(<span class="built_in">new</span> <span class="keyword">uintptr</span>)</span> 	</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// äº¤æ¢æ“ä½œ</span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">SwapInt32</span><span class="params">(addr *<span class="keyword">int32</span>, <span class="built_in">new</span> <span class="keyword">int32</span>)</span> <span class="params">(old <span class="keyword">int32</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">SwapInt64</span><span class="params">(addr *<span class="keyword">int64</span>, <span class="built_in">new</span> <span class="keyword">int64</span>)</span> <span class="params">(old <span class="keyword">int64</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">SwapUint32</span><span class="params">(addr *<span class="keyword">uint32</span>, <span class="built_in">new</span> <span class="keyword">uint32</span>)</span> <span class="params">(old <span class="keyword">uint32</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">SwapUint64</span><span class="params">(addr *<span class="keyword">uint64</span>, <span class="built_in">new</span> <span class="keyword">uint64</span>)</span> <span class="params">(old <span class="keyword">uint64</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">SwapUintptr</span><span class="params">(addr *<span class="keyword">uintptr</span>, <span class="built_in">new</span> <span class="keyword">uintptr</span>)</span> <span class="params">(old <span class="keyword">uintptr</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">SwapPointer</span><span class="params">(addr *unsafe.Pointer, <span class="built_in">new</span> unsafe.Pointer)</span> <span class="params">(old unsafe.Pointer)</span> </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// æ¯”è¾ƒå¹¶äº¤æ¢æ“ä½œ</span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">CompareAndSwapInt32</span><span class="params">(addr *<span class="keyword">int32</span>, old, <span class="built_in">new</span> <span class="keyword">int32</span>)</span> <span class="params">(swapped <span class="keyword">bool</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">CompareAndSwapInt64</span><span class="params">(addr *<span class="keyword">int64</span>, old, <span class="built_in">new</span> <span class="keyword">int64</span>)</span> <span class="params">(swapped <span class="keyword">bool</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">CompareAndSwapUint32</span><span class="params">(addr *<span class="keyword">uint32</span>, old, <span class="built_in">new</span> <span class="keyword">uint32</span>)</span> <span class="params">(swapped <span class="keyword">bool</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">CompareAndSwapUint64</span><span class="params">(addr *<span class="keyword">uint64</span>, old, <span class="built_in">new</span> <span class="keyword">uint64</span>)</span> <span class="params">(swapped <span class="keyword">bool</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">CompareAndSwapUintptr</span><span class="params">(addr *<span class="keyword">uintptr</span>, old, <span class="built_in">new</span> <span class="keyword">uintptr</span>)</span> <span class="params">(swapped <span class="keyword">bool</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">CompareAndSwapPointer</span><span class="params">(addr *unsafe.Pointer, old, <span class="built_in">new</span> unsafe.Pointer)</span> <span class="params">(swapped <span class="keyword">bool</span>)</span></span></span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="0x03-Context-ä¸Šä¸‹æ–‡æ“ä½œåº“"><a href="#0x03-Context-ä¸Šä¸‹æ–‡æ“ä½œåº“" class="headerlink" title="0x03 Context.ä¸Šä¸‹æ–‡æ“ä½œåº“"></a>0x03 Context.ä¸Šä¸‹æ–‡æ“ä½œåº“</h2><h3 id="1-Context-ç®€è¿°"><a href="#1-Context-ç®€è¿°" class="headerlink" title="1.Context ç®€è¿°"></a>1.Context ç®€è¿°</h3><p>æè¿°: Goåœ¨1.7æ—¶åŠ å…¥contextæ ‡å‡†åº“å®ƒå®šä¹‰äº†Contextç±»å‹ï¼Œä¸“é—¨ç”¨æ¥ç®€åŒ–å¯¹äºå¤„ç†å•ä¸ªè¯·æ±‚çš„å¤šä¸ª goroutine ä¹‹é—´ä¸è¯·æ±‚åŸŸçš„æ•°æ®ã€å–æ¶ˆä¿¡å·ã€æˆªæ­¢æ—¶é—´ç­‰ç›¸å…³æ“ä½œï¼Œè¿™äº›æ“ä½œå¯èƒ½æ¶‰åŠå¤šä¸ª API è°ƒç”¨ã€‚</p>
<p>é€šå¸¸å¯¹æœåŠ¡å™¨ä¼ å…¥çš„è¯·æ±‚åº”è¯¥åˆ›å»ºä¸Šä¸‹æ–‡ï¼Œè€Œå¯¹æœåŠ¡å™¨çš„ä¼ å‡ºè°ƒç”¨åº”è¯¥æ¥å—ä¸Šä¸‹æ–‡, å®ƒä»¬ä¹‹é—´çš„å‡½æ•°è°ƒç”¨é“¾å¿…é¡»ä¼ é€’ä¸Šä¸‹æ–‡ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨<code>WithCancelã€WithDeadlineã€WithTimeoutæˆ–WithValue</code>åˆ›å»ºçš„æ´¾ç”Ÿä¸Šä¸‹æ–‡ã€‚</p>
<p>ç®€å•æ¥è¯´å°±æ˜¯ä½¿ç”¨<code>Context</code>åˆ›å»ºä¸Šä¸‹æ–‡æ¥æ§åˆ¶å­goroutineçš„ç”Ÿå‘½å‘¨æœŸ(ç»ˆæ­¢), å½“ä¸€ä¸ªä¸Šä¸‹æ–‡è¢«å–æ¶ˆæ—¶, å®ƒæ´¾ç”Ÿçš„æ‰€æœ‰ä¸Šä¸‹æ–‡ä¹Ÿè¢«å–æ¶ˆã€‚</p>
<p><br/></p>
<p><strong>Why Use Context</strong><br>åœ¨å›ç­”é—®é¢˜å‰ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹ä¸¤ä¸ªä¾‹å­ä¸­æ‰¾åˆ°å¯¹åº”çš„ç­”æ¡ˆ, å®ç°æ•ˆæœ(ç›®æ ‡): åˆ†åˆ«é‡‡ç”¨ç‰¹å®šå˜é‡ä»¥åŠé€šé“æ¥æ§åˆ¶å­goroutineé€€å‡ºã€‚</p>
<ul>
<li>ç¤ºä¾‹1.åˆ©ç”¨è‡ªå®šä¹‰å…¨å±€å˜é‡æ§åˆ¶<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¤ºä¾‹1.é‡‡ç”¨è‡ªå®šä¹‰å…¨å±€å˜é‡æ§åˆ¶å­goroutineé€€å‡º</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> notify <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¹¶å‘è°ƒç”¨workå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">work</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> wg.Done()</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"%v : %v\n"</span>, time.Now().Format(<span class="string">"2006-01-02 15:04:05"</span>), <span class="string">"WeiyiGeek"</span>)</span><br><span class="line">    time.Sleep(time.Millisecond * <span class="number">500</span>)</span><br><span class="line">    <span class="keyword">if</span> notify &#123;  <span class="comment">// æ¥æ”¶å¤–éƒ¨å‘½ä»¤å®ç°é€€å‡º</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  wg.Add(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">go</span> work()</span><br><span class="line">  time.Sleep(time.Second * <span class="number">5</span>)</span><br><span class="line">  notify = <span class="literal">true</span>  <span class="comment">// åˆ©ç”¨å…¨å±€å˜é‡å®ç°å­goroutineçš„é€€å‡º</span></span><br><span class="line">  wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// # æ‰§è¡Œç»“æœ # </span></span><br><span class="line">âœ  demo1 <span class="keyword">go</span> run .</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">44</span>:<span class="number">08</span> : WeiyiGeek</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">44</span>:<span class="number">09</span> : WeiyiGeek</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">44</span>:<span class="number">09</span> : WeiyiGeek</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">44</span>:<span class="number">10</span> : WeiyiGeek</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">44</span>:<span class="number">10</span> : WeiyiGeek</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">44</span>:<span class="number">11</span> : WeiyiGeek</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">44</span>:<span class="number">12</span> : WeiyiGeek</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">44</span>:<span class="number">12</span> : WeiyiGeek</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">44</span>:<span class="number">13</span> : WeiyiGeek</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">44</span>:<span class="number">13</span> : WeiyiGeek</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<ul>
<li>ç¤ºä¾‹2.åˆ©ç”¨channel(é€šé“)æ§åˆ¶<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// ç¤ºä¾‹2.é‡‡ç”¨é€šé“Channelæ–¹å¼æ§åˆ¶å­goroutineé€€å‡º</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> notifyChan = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>, <span class="number">1</span>) <span class="comment">// å®šä¹‰&amp;å£°æ˜å†…å­˜ç”³è¯·ä¸€æ°”å‘µæˆ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¹¶å‘è°ƒç”¨workå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">work</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> wg.Done()</span><br><span class="line">LOOPEXIT:</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"%v : %v\n"</span>, time.Now().Format(<span class="string">"2006-01-02 15:04:05"</span>), <span class="string">"WeiyiGeek"</span>)</span><br><span class="line">    time.Sleep(time.Millisecond * <span class="number">500</span>)</span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> &lt;-notifyChan: <span class="comment">// æ¥æ”¶å¤–éƒ¨å‘½ä»¤å®ç°é€€å‡º</span></span><br><span class="line">      <span class="keyword">break</span> LOOPEXIT <span class="comment">// é€€å‡ºè·³è½¬ï¼Œå¦‚æœç›´æ¥breakåˆ™æ— æ³•è·³å‡º</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      fmt.Println(<span class="string">"# Default"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  wg.Add(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">go</span> work()</span><br><span class="line">  time.Sleep(time.Second * <span class="number">5</span>)</span><br><span class="line">  notifyChan &lt;- <span class="literal">true</span></span><br><span class="line">  wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// # æ‰§è¡Œç»“æœ # </span></span><br><span class="line">âœ  demo2 <span class="keyword">go</span> run .</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">54</span>:<span class="number">28</span> : WeiyiGeek</span><br><span class="line"># Default</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">54</span>:<span class="number">28</span> : WeiyiGeek</span><br><span class="line"># Default</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">54</span>:<span class="number">29</span> : WeiyiGeek</span><br><span class="line"># Default</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">54</span>:<span class="number">29</span> : WeiyiGeek</span><br><span class="line"># Default</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">54</span>:<span class="number">30</span> : WeiyiGeek</span><br><span class="line"># Default</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">54</span>:<span class="number">30</span> : WeiyiGeek</span><br><span class="line"># Default</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">54</span>:<span class="number">31</span> : WeiyiGeek</span><br><span class="line"># Default</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">54</span>:<span class="number">31</span> : WeiyiGeek</span><br><span class="line"># Default</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">54</span>:<span class="number">32</span> : WeiyiGeek</span><br><span class="line"># Default</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-29</span> <span class="number">05</span>:<span class="number">54</span>:<span class="number">32</span> : WeiyiGeek</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œå¦‚ä½•åˆ©ç”¨contextå®ç°å­goroutineä¼˜é›…é€€å‡ºã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"context"</span></span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"sync"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¤ºä¾‹3.åˆ©ç”¨contextå®ç°å­goroutineé€€å‡º</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¹¶å‘è°ƒç”¨childworkå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">childwork</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> wg.Done()</span><br><span class="line">LOOPEXIT:</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"%v : %v\n"</span>, time.Now().Format(<span class="string">"2006-01-02 15:04:05"</span>), <span class="string">"childwork -&gt; WeiyiGeek"</span>)</span><br><span class="line">    time.Sleep(time.Millisecond * <span class="number">500</span>)</span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> &lt;-ctx.Done():  <span class="comment">// ç­‰å¾…ä¸Šçº§é€šçŸ¥</span></span><br><span class="line">      <span class="keyword">break</span> LOOPEXIT <span class="comment">// é€€å‡ºè·³è½¬ï¼Œå¦‚æœç›´æ¥breakåˆ™æ— æ³•è·³å‡º</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      fmt.Println(<span class="string">"# childwork"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¹¶å‘è°ƒç”¨workå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">work</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> wg.Done()</span><br><span class="line">  <span class="keyword">go</span> childwork(ctx)  <span class="comment">// å¹¶å‘è°ƒç”¨ childwork</span></span><br><span class="line">LOOPEXIT:</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"%v : %v\n"</span>, time.Now().Format(<span class="string">"2006-01-02 15:04:05"</span>), <span class="string">"work-&gt;WeiyiGeek"</span>)</span><br><span class="line">    time.Sleep(time.Millisecond * <span class="number">500</span>)</span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> &lt;-ctx.Done():  <span class="comment">// å…³é”®ç‚¹: å½“è°ƒç”¨cancle()åè¡¨ç¤ºå®Œæˆçš„å–æ¶ˆé¢‘é“ã€‚</span></span><br><span class="line">      <span class="keyword">break</span> LOOPEXIT <span class="comment">// é€€å‡ºè·³è½¬ï¼Œå¦‚æœç›´æ¥breakåˆ™æ— æ³•è·³å‡º</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      fmt.Println(<span class="string">"# work"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// WithCancelè¿”å›å…·æœ‰æ–°å®Œæˆé€šé“çš„çˆ¶çº§å‰¯æœ¬ã€‚</span></span><br><span class="line">  <span class="comment">// è°ƒç”¨è¿”å›çš„cancelå‡½æ•°æˆ–å…³é—­çˆ¶ä¸Šä¸‹æ–‡çš„Doneé€šé“æ—¶ï¼Œè¿”å›ä¸Šä¸‹æ–‡çš„Doneé€šé“å…³é—­ï¼Œä»¥å…ˆå‘ç”Ÿçš„ä¸ºå‡†ã€‚</span></span><br><span class="line">  ctx, cancle := context.WithCancel(context.Background())</span><br><span class="line">  wg.Add(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">go</span> work(ctx)</span><br><span class="line">  time.Sleep(time.Second * <span class="number">5</span>)</span><br><span class="line">  <span class="comment">// è¡¨ç¤ºå…³é—­ä¸Šä¸‹æ–‡é€šé“</span></span><br><span class="line">  cancle()</span><br><span class="line">  wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// # æ‰§è¡Œç»“æœ #</span></span><br><span class="line">âœ  demo3 <span class="keyword">go</span> run .</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">54</span> : work-&gt;WeiyiGeek</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">54</span> : childwork -&gt; WeiyiGeek</span><br><span class="line"># childwork</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">55</span> : childwork -&gt; WeiyiGeek</span><br><span class="line"># work</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">55</span> : work-&gt;WeiyiGeek</span><br><span class="line"># childwork</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">55</span> : childwork -&gt; WeiyiGeek</span><br><span class="line"># work</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">55</span> : work-&gt;WeiyiGeek</span><br><span class="line"># childwork</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">56</span> : childwork -&gt; WeiyiGeek</span><br><span class="line"># work</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">56</span> : work-&gt;WeiyiGeek</span><br><span class="line"># work</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">56</span> : work-&gt;WeiyiGeek</span><br><span class="line"># childwork</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">56</span> : childwork -&gt; WeiyiGeek</span><br><span class="line"># childwork</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">57</span> : childwork -&gt; WeiyiGeek</span><br><span class="line"># work</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">57</span> : work-&gt;WeiyiGeek</span><br><span class="line"># work</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">57</span> : work-&gt;WeiyiGeek</span><br><span class="line"># childwork</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">57</span> : childwork -&gt; WeiyiGeek</span><br><span class="line"># childwork</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">58</span> : childwork -&gt; WeiyiGeek</span><br><span class="line"># work</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">58</span> : work-&gt;WeiyiGeek</span><br><span class="line"># work</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">58</span> : work-&gt;WeiyiGeek</span><br><span class="line"># childwork</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">58</span> : childwork -&gt; WeiyiGeek</span><br><span class="line"># childwork</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">59</span> : childwork -&gt; WeiyiGeek</span><br><span class="line"># work</span><br><span class="line"><span class="number">2021</span><span class="number">-12</span><span class="number">-28</span> <span class="number">04</span>:<span class="number">29</span>:<span class="number">59</span> : work-&gt;WeiyiGeek</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="2-Context-æ¥å£åˆè¯†"><a href="#2-Context-æ¥å£åˆè¯†" class="headerlink" title="2.Context æ¥å£åˆè¯†"></a>2.Context æ¥å£åˆè¯†</h3><p>æè¿°: åœ¨ context åŒ…ä¸­æœ‰ä¸€ä¸ªContextæ¥å£, è¯¥æ¥å£å®šä¹‰äº†ä»¥ä¸‹å››ä¸ªéœ€è¦å®ç°çš„æ–¹æ³•ã€‚</p>
<p><strong>context.Context æ¥å£æ–¹æ³•:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸Šä¸‹æ–‡è·¨APIè¾¹ç•Œæºå¸¦æˆªæ­¢æ—¥æœŸã€å–æ¶ˆä¿¡å·å’Œå…¶ä»–å€¼, å¤šä¸ªgoroutineå¯ä»¥åŒæ—¶è°ƒç”¨ä¸Šä¸‹æ–‡çš„æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">interface</span> &#123;</span><br><span class="line">  <span class="comment">// Deadlineæ–¹æ³•éœ€è¦è¿”å›å½“å‰Contextè¢«å–æ¶ˆçš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯å®Œæˆå·¥ä½œçš„æˆªæ­¢æ—¶é—´ï¼ˆdeadlineï¼‰;</span></span><br><span class="line">  Deadline() (deadline time.Time, ok <span class="keyword">bool</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Doneæ–¹æ³•éœ€è¦è¿”å›ä¸€ä¸ªChannelï¼Œè¿™ä¸ªChannelä¼šåœ¨å½“å‰å·¥ä½œå®Œæˆæˆ–è€…ä¸Šä¸‹æ–‡è¢«å–æ¶ˆä¹‹åå…³é—­ï¼Œå¤šæ¬¡è°ƒç”¨Doneæ–¹æ³•ä¼šè¿”å›åŒä¸€ä¸ªChannelï¼›</span></span><br><span class="line">  Done() &lt;-<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Erræ–¹æ³•ä¼šè¿”å›å½“å‰Contextç»“æŸçš„åŸå› ï¼Œå®ƒåªä¼šåœ¨Doneè¿”å›çš„Channelè¢«å…³é—­æ—¶æ‰ä¼šè¿”å›éç©ºçš„å€¼;</span></span><br><span class="line">  <span class="comment">// - å¦‚æœå½“å‰Contextè¢«å–æ¶ˆå°±ä¼šè¿”å›Canceledé”™è¯¯;</span></span><br><span class="line">  <span class="comment">// - å¦‚æœå½“å‰Contextè¶…æ—¶å°±ä¼šè¿”å›DeadlineExceededé”™è¯¯;</span></span><br><span class="line">  Err() error  <span class="comment">// å¦‚æœå°šæœªå…³é—­Doneï¼ŒErrå°†è¿”å›nil</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Valueæ–¹æ³•ä¼šä»Contextä¸­è¿”å›é”®å¯¹åº”çš„å€¼ï¼Œå¯¹äºåŒä¸€ä¸ªä¸Šä¸‹æ–‡æ¥è¯´ï¼Œå¤šæ¬¡è°ƒç”¨Valueå¹¶ä¼ å…¥ç›¸åŒçš„Keyä¼šè¿”å›ç›¸åŒçš„ç»“æœï¼Œè¯¥æ–¹æ³•ä»…ç”¨äºä¼ é€’è·¨APIå’Œè¿›ç¨‹é—´è·Ÿè¯·æ±‚åŸŸçš„æ•°æ®ï¼›</span></span><br><span class="line">  Value(key <span class="keyword">interface</span>&#123;&#125;) <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">  <span class="comment">// 	ç¤ºä¾‹: FromContextè¿”å›å­˜å‚¨åœ¨ctxä¸­çš„ç”¨æˆ·å€¼ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚</span></span><br><span class="line">  <span class="comment">// 	func FromContext(ctx context.Context) (*User, bool) &#123;</span></span><br><span class="line">  <span class="comment">// 		u, ok := ctx.Value(userKey).(*User)</span></span><br><span class="line">  <span class="comment">// 		return u, ok</span></span><br><span class="line">  <span class="comment">// 	&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>æ–¹æ³•åŸå‹:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> emptyCtx <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Deadline</span><span class="params">()</span> <span class="params">(deadline time.Time, ok <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Done</span><span class="params">()</span> &lt;-<span class="title">chan</span> <span class="title">struct</span></span>&#123;&#125; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Err</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Value</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="3-Context-å†…ç½®å‡½æ•°"><a href="#3-Context-å†…ç½®å‡½æ•°" class="headerlink" title="3.Context å†…ç½®å‡½æ•°"></a>3.Context å†…ç½®å‡½æ•°</h3><p>æè¿°: Context ä¸­äº†å¦‚ä¸‹ä¸¤ä¸ªå‡½æ•° <code>Background()</code> å’Œ<code>TODO()</code>ï¼Œè¯¥å‡½æ•°å…¶åˆ†åˆ«è¿”å›ä¸€ä¸ªå®ç°äº†Contextæ¥å£çš„<code>background</code>å’Œ<code>todo</code>, æˆ‘ä»¬ä»£ç ä¸­æœ€å¼€å§‹éƒ½æ˜¯ä»¥è¿™ä¸¤ä¸ªå†…ç½®çš„ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºæœ€é¡¶å±‚çš„ <code>partent context</code> è¡ç”Ÿå‡ºæ›´å¤šçš„<code>å­ä¸Šä¸‹æ–‡å¯¹è±¡</code>ã€‚</p>
<ul>
<li><code>Background()</code>: ä¸»è¦ç”¨äºmainå‡½æ•°ã€åˆå§‹åŒ–ä»¥åŠæµ‹è¯•ä»£ç ä¸­ï¼Œä½œä¸ºContextè¿™ä¸ªæ ‘ç»“æ„çš„æœ€é¡¶å±‚çš„Contextï¼Œä¹Ÿå°±æ˜¯æ ¹Contextã€‚</li>
<li><code>TODO()</code>: å®ƒç›®å‰è¿˜ä¸çŸ¥é“å…·ä½“çš„ä½¿ç”¨åœºæ™¯ï¼Œå½“ä¸æ¸…æ¥šè¦ä½¿ç”¨å“ªä¸ªä¸Šä¸‹æ–‡æˆ–å®ƒè¿˜ä¸å¯ç”¨æ—¶(å› ä¸ºå‘¨å›´çš„å‡½æ•°è¿˜æ²¡æœ‰æ‰©å±•åˆ°æ¥å—ä¸Šä¸‹æ–‡å‚æ•°), å¯ä»¥ä½¿ç”¨è¿™ä¸ªã€‚</li>
</ul>
<p><strong>å‡½æ•°åŸå‹:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”±ä¸‹å¯çŸ¥backgroundå’Œtodoæœ¬è´¨ä¸Šéƒ½æ˜¯emptyCtxç»“æ„ä½“ç±»å‹ï¼Œæ˜¯ä¸€ä¸ªä¸å¯å–æ¶ˆï¼Œæ²¡æœ‰è®¾ç½®æˆªæ­¢æ—¶é—´ï¼Œæ²¡æœ‰æºå¸¦ä»»ä½•å€¼çš„Contextã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *emptyCtx)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> e &#123;</span><br><span class="line">  <span class="keyword">case</span> background:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"context.Background"</span></span><br><span class="line">  <span class="keyword">case</span> todo:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"context.TODO"</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">"unknown empty Context"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">  background = <span class="built_in">new</span>(emptyCtx)</span><br><span class="line">  todo       = <span class="built_in">new</span>(emptyCtx)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Background() è¿”å›ä¸€ä¸ªéé›¶çš„ç©ºä¸Šä¸‹æ–‡ã€‚å®ƒä»æœªè¢«å–æ¶ˆï¼Œæ²¡æœ‰å€¼ï¼Œä¹Ÿæ²¡æœ‰æˆªæ­¢æ—¥æœŸã€‚å®ƒé€šå¸¸ç”±ä¸»å‡½æ•°ã€åˆå§‹åŒ–å’Œæµ‹è¯•ä½¿ç”¨ï¼Œå¹¶ä½œä¸ºä¼ å…¥è¯·æ±‚çš„é¡¶çº§ä¸Šä¸‹æ–‡ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Background</span><span class="params">()</span> <span class="title">Context</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> background</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// TODO() è¿”å›ä¸€ä¸ªéé›¶çš„ç©ºä¸Šä¸‹æ–‡ã€‚ä»£ç åº”è¯¥ä½¿ç”¨ä¸Šä¸‹æ–‡ã€‚å½“ä¸æ¸…æ¥šè¦ä½¿ç”¨å“ªä¸ªä¸Šä¸‹æ–‡æˆ–å®ƒè¿˜ä¸å¯ç”¨æ—¶ï¼ˆå› ä¸ºå‘¨å›´çš„å‡½æ•°è¿˜æ²¡æœ‰æ‰©å±•åˆ°æ¥å—ä¸Šä¸‹æ–‡å‚æ•°ï¼‰ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TODO</span><span class="params">()</span> <span class="title">Context</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> todo</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="4-Context-Withç³»åˆ—å‡½æ•°"><a href="#4-Context-Withç³»åˆ—å‡½æ•°" class="headerlink" title="4.Context.Withç³»åˆ—å‡½æ•°"></a>4.Context.Withç³»åˆ—å‡½æ•°</h3><p>æè¿°: æ­¤å¤– contextåŒ…ä¸­è¿˜å®šä¹‰äº†å››ä¸ªWithç³»åˆ—å‡½æ•°, å…¶å‡½æ•°ç­¾ååˆ†åˆ«å¦‚ä¸‹:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// # WithCancel çš„å‡½æ•°ç­¾å</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithCancel</span><span class="params">(parent Context)</span> <span class="params">(ctx Context, cancel CancelFunc)</span></span></span><br><span class="line"><span class="function">// # <span class="title">WithDeadline</span> çš„å‡½æ•°ç­¾å</span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">WithDeadline</span><span class="params">(parent Context, deadline time.Time)</span> <span class="params">(Context, CancelFunc)</span></span></span><br><span class="line"><span class="function">// # <span class="title">WithTimeout</span> çš„å‡½æ•°ç­¾å</span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">WithTimeout</span><span class="params">(parent Context, timeout time.Duration)</span> <span class="params">(Context, CancelFunc)</span></span></span><br><span class="line"><span class="function">// # <span class="title">WithValue</span>çš„å‡½æ•°ç­¾å</span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">WithValue</span><span class="params">(parent Context, key, val <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">Context</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// æ³¨æ„: å¤šä¸ª<span class="title">goroutine</span>å¯ä»¥åŒæ—¶è°ƒç”¨<span class="title">CancelFunc</span>, å¹¶åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ä¹‹åå¯¹<span class="title">CancelFunc</span>çš„åç»­è°ƒç”¨ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚</span></span><br><span class="line"><span class="function">// <span class="title">CancelFunc</span> é€šçŸ¥æ“ä½œæ”¾å¼ƒå…¶å·¥ä½œã€‚</span></span><br><span class="line"><span class="function">// <span class="title">CancelFunc</span> ä¸ä¼šç­‰å¾…å·¥ä½œåœæ­¢ã€‚</span></span><br><span class="line"><span class="function"><span class="title">type</span> <span class="title">CancelFunc</span> <span class="title">func</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="WithCancel"><a href="#WithCancel" class="headerlink" title="WithCancel()"></a>WithCancel()</h4><p>æè¿°: WithCancel è¿”å›<code>å¸¦æœ‰æ–°Doneé€šé“çš„çˆ¶èŠ‚ç‚¹çš„å‰¯æœ¬</code>, å½“è°ƒç”¨è¿”å›çš„cancelå‡½æ•°æ—¶, ä¸Šä¸‹æ–‡çš„Doneé€šé“å…³é—­æˆ–è€…å½“çˆ¶ä¸Šä¸‹æ–‡çš„â€œDoneâ€é€šé“å…³é—­æ—¶ï¼Œå°†å…³é—­è¿”å›ä¸Šä¸‹æ–‡çš„Doneé€šé“ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å–æ¶ˆæ­¤ä¸Šä¸‹æ–‡å°†é‡Šæ”¾ä¸å…¶å…³è”çš„èµ„æºï¼Œå› æ­¤ä»£ç åº”è¯¥åœ¨è¯¥ä¸Šä¸‹æ–‡ä¸­è¿è¡Œçš„æ“ä½œå®Œæˆåç«‹å³è°ƒç”¨cancelã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithCancel</span><span class="params">(parent Context)</span> <span class="params">(ctx Context, cancel CancelFunc)</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> parent == <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">"cannot create context from nil parent"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  c := newCancelCtx(parent)</span><br><span class="line">  propagateCancel(parent, &amp;c)</span><br><span class="line">  <span class="keyword">return</span> &amp;c, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; c.cancel(<span class="literal">true</span>, Canceled) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>ç¤ºä¾‹æ¼”ç¤º:</strong>ä¸‹è¿°ä»£ç ä¸­genå‡½æ•°åœ¨<code>å•ç‹¬çš„goroutine</code>ä¸­ç”Ÿæˆæ•´æ•°å¹¶å°†å®ƒä»¬å‘é€åˆ°è¿”å›çš„é€šé“, gençš„è°ƒç”¨è€…åœ¨ä½¿ç”¨ç”Ÿæˆçš„æ•´æ•°ä¹‹åéœ€è¦å–æ¶ˆä¸Šä¸‹æ–‡ï¼Œä»¥å…genå¯åŠ¨çš„å†…éƒ¨goroutineå‘ç”Ÿæ³„æ¼ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">gen</span><span class="params">(ctx context.Context)</span> &lt;-<span class="title">chan</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    dst := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">    n := <span class="number">1</span></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> &lt;-ctx.Done():  <span class="comment">// åœ¨è°ƒç”¨cancle()åå°†è¿›å…¥æ­¤ä»£ç å—ã€‚</span></span><br><span class="line">          <span class="keyword">return</span> <span class="comment">// returnç»“æŸè¯¥goroutineé˜²æ­¢æ³„éœ²ã€‚</span></span><br><span class="line">        <span class="keyword">case</span> dst &lt;- n:</span><br><span class="line">          n++</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">return</span> dst</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  ctx, cancel := context.WithCancel(context.Background())</span><br><span class="line">  <span class="keyword">defer</span> cancel() <span class="comment">// å½“æˆ‘ä»¬å–å®Œéœ€è¦çš„æ•´æ•°åè°ƒç”¨cancel</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> n := <span class="keyword">range</span> gen(ctx) &#123;</span><br><span class="line">    fmt.Println(n)</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">5</span> &#123;</span><br><span class="line">      <span class="keyword">break</span>  <span class="comment">// å½“è¿”å›5æ—¶é€€å‡ºforå¾ªç¯</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// # æ‰§è¡Œç»“æœ #</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="WithDeadline"><a href="#WithDeadline" class="headerlink" title="WithDeadline()"></a>WithDeadline()</h4><p>æè¿°: WithDeadline è¿”å›çˆ¶ä¸Šä¸‹æ–‡çš„å‰¯æœ¬å¹¶å°†deadlineè°ƒæ•´ä¸º<code>ä¸è¿Ÿäºå½“å‰æ—¶é—´(time.Now())</code>ã€‚å¦‚æœçˆ¶ä¸Šä¸‹æ–‡çš„ deadline å·²ç»<code>æ—©äºå½“å‰æ—¶é—´(time.Now())</code>ï¼Œåˆ™ <code>WithDeadline(parent, d)</code> åœ¨è¯­ä¹‰ä¸Šç­‰åŒäºçˆ¶ä¸Šä¸‹æ–‡, å¹¶å½“æˆªæ­¢æ—¥è¿‡æœŸæ—¶å½“è°ƒç”¨è¿”å›çš„cancelå‡½æ•°æ—¶ï¼Œæˆ–è€…å½“çˆ¶ä¸Šä¸‹æ–‡çš„Doneé€šé“å…³é—­æ—¶ï¼Œè¿”å›ä¸Šä¸‹æ–‡çš„Doneé€šé“å°†è¢«å…³é—­ï¼Œä»¥æœ€å…ˆå‘ç”Ÿçš„æƒ…å†µä¸ºå‡†ã€‚</p>
<p><strong>å‡½æ•°åŸå‹:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å–æ¶ˆæ­¤ä¸Šä¸‹æ–‡å°†é‡Šæ”¾ä¸å…¶å…³è”çš„èµ„æºï¼Œå› æ­¤ä»£ç åº”è¯¥åœ¨æ­¤ä¸Šä¸‹æ–‡ä¸­è¿è¡Œçš„æ“ä½œå®Œæˆåç«‹å³è°ƒç”¨cancelã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithDeadline</span><span class="params">(parent Context, d time.Time)</span> <span class="params">(Context, CancelFunc)</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> parent == <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">"cannot create context from nil parent"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> cur, ok := parent.Deadline(); ok &amp;&amp; cur.Before(d) &#123;</span><br><span class="line">    <span class="comment">// ç›®å‰çš„æˆªæ­¢æ—¥æœŸå·²ç»æ¯”æ–°çš„æˆªæ­¢æ—¥æœŸæ—©ã€‚</span></span><br><span class="line">    <span class="keyword">return</span> WithCancel(parent)</span><br><span class="line">  &#125;</span><br><span class="line">  c := &amp;timerCtx&#123;</span><br><span class="line">    cancelCtx: newCancelCtx(parent),</span><br><span class="line">    deadline:  d,</span><br><span class="line">  &#125;</span><br><span class="line">  propagateCancel(parent, c)</span><br><span class="line">  dur := time.Until(d)</span><br><span class="line">  <span class="keyword">if</span> dur &lt;= <span class="number">0</span> &#123;</span><br><span class="line">    c.cancel(<span class="literal">true</span>, DeadlineExceeded) <span class="comment">// æˆªæ­¢æ—¥æœŸå·²ç»è¿‡å»äº†</span></span><br><span class="line">    <span class="keyword">return</span> c, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; c.cancel(<span class="literal">false</span>, Canceled) &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  c.mu.Lock()  <span class="comment">// é”æœºåˆ¶</span></span><br><span class="line">  <span class="keyword">defer</span> c.mu.Unlock()</span><br><span class="line">  <span class="keyword">if</span> c.err == <span class="literal">nil</span> &#123;</span><br><span class="line">    c.timer = time.AfterFunc(dur, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      c.cancel(<span class="literal">true</span>, DeadlineExceeded)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> c, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; c.cancel(<span class="literal">true</span>, Canceled) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>ç¤ºä¾‹æ¼”ç¤º:</strong> ä¸‹è¿°ä»£ç ä¸­å®šä¹‰äº†ä¸€ä¸ª50æ¯«ç§’ä¹‹åè¿‡æœŸçš„deadlineï¼Œç„¶åæˆ‘ä»¬è°ƒç”¨<code>context.WithDeadline(context.Background(), d)</code>å¾—åˆ°ä¸€ä¸ªä¸Šä¸‹æ–‡(ctx)å’Œä¸€ä¸ªå–æ¶ˆå‡½æ•°(cancel)ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªselectè®©ä¸»ç¨‹åºé™·å…¥ç­‰å¾…, å³ç­‰å¾…1ç§’åæ‰“å°overslepté€€å‡ºæˆ–è€…ç­‰å¾…ctxè¿‡æœŸåé€€å‡ºã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  d := time.Now().Add(<span class="number">5000</span> * time.Millisecond)  </span><br><span class="line">  <span class="comment">// è®¾ç½® 5000 æ¯«ç§’ä¹‹åè¿‡æœŸçš„ deadline</span></span><br><span class="line">  ctx, cancel := context.WithDeadline(context.Background(), d)</span><br><span class="line">  <span class="comment">// å°½ç®¡ctxä¼šè¿‡æœŸï¼Œä½†åœ¨ä»»ä½•æƒ…å†µä¸‹è°ƒç”¨å®ƒçš„cancelå‡½æ•°éƒ½æ˜¯å¾ˆå¥½çš„å®è·µã€‚</span></span><br><span class="line">  <span class="comment">// å¦‚æœä¸è¿™æ ·åšï¼Œå¯èƒ½ä¼šä½¿ä¸Šä¸‹æ–‡åŠå…¶çˆ¶ç±»å­˜æ´»çš„æ—¶é—´è¶…è¿‡å¿…è¦çš„æ—¶é—´ã€‚</span></span><br><span class="line">  <span class="keyword">defer</span> cancel()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">select</span> &#123;</span><br><span class="line">  <span class="keyword">case</span> &lt;-time.After(<span class="number">1</span> * time.Second):  <span class="comment">// å½“å‰æ—¶é—´ç­‰å¾…1såæ‰“å°æ‰§è¡Œè¾“å‡º</span></span><br><span class="line">    fmt.Println(<span class="string">"overslept"</span>)</span><br><span class="line">  <span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">    fmt.Println(ctx.Err())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// # è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="comment">// å½“ d ä¸º 50 å¾®ç§’æ—¶æ˜¾ç¤º context deadline exceeded</span></span><br><span class="line"><span class="comment">// å½“ d ä¸º 5000 å¾®ç§’æ—¶æ˜¾ç¤º overslept</span></span><br></pre></td></tr></table></figure>
<p>Tips: éå¸¸æ³¨æ„å°½ç®¡ctxä¼šè¿‡æœŸï¼Œä½†åœ¨ä»»ä½•æƒ…å†µä¸‹è°ƒç”¨å®ƒçš„cancelå‡½æ•°éƒ½æ˜¯å¾ˆå¥½çš„å®è·µ, å¦‚æœä¸è¿™æ ·åšå¯èƒ½ä¼šä½¿ä¸Šä¸‹æ–‡åŠå…¶çˆ¶ç±»å­˜æ´»çš„æ—¶é—´è¶…è¿‡å¿…è¦çš„æ—¶é—´ã€‚</p>
<p><br></p>
<h4 id="WithTimeout"><a href="#WithTimeout" class="headerlink" title="WithTimeout()"></a>WithTimeout()</h4><p>æè¿°: WithTimeout å–æ¶ˆæ­¤ä¸Šä¸‹æ–‡å°†é‡Šæ”¾ä¸å…¶ç›¸å…³çš„èµ„æºï¼Œå› æ­¤ä»£ç åº”è¯¥åœ¨æ­¤ä¸Šä¸‹æ–‡ä¸­è¿è¡Œçš„æ“ä½œå®Œæˆåç«‹å³è°ƒç”¨cancelï¼Œé€šå¸¸ç”¨äºæ•°æ®åº“æˆ–è€…ç½‘ç»œè¿æ¥çš„è¶…æ—¶æ§åˆ¶ã€‚</p>
<p><strong>å‡½æ•°åŸå‹:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WithTimeout returns WithDeadline(parent, time.Now().Add(timeout)).</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithTimeout</span><span class="params">(parent Context, timeout time.Duration)</span> <span class="params">(Context, CancelFunc)</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> WithDeadline(parent, time.Now().Add(timeout))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>ç¤ºä¾‹æ¼”ç¤º:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">LOOP:</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"db connecting ..."</span>)</span><br><span class="line">    time.Sleep(time.Millisecond * <span class="number">10</span>) <span class="comment">// å‡è®¾æ­£å¸¸è¿æ¥æ•°æ®åº“è€—æ—¶10æ¯«ç§’</span></span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> &lt;-ctx.Done(): <span class="comment">// 50æ¯«ç§’åè‡ªåŠ¨è°ƒç”¨</span></span><br><span class="line">      <span class="keyword">break</span> LOOP</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(<span class="string">"worker done!"</span>)</span><br><span class="line">  wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// è®¾ç½®ä¸€ä¸ª50æ¯«ç§’çš„è¶…æ—¶</span></span><br><span class="line">  ctx, cancel := context.WithTimeout(context.Background(), time.Millisecond*<span class="number">50</span>)</span><br><span class="line">  wg.Add(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">go</span> worker(ctx)</span><br><span class="line">  time.Sleep(time.Second * <span class="number">5</span>)</span><br><span class="line">  cancel() <span class="comment">// é€šçŸ¥å­goroutineç»“æŸ</span></span><br><span class="line">  wg.Wait()</span><br><span class="line">  fmt.Println(<span class="string">"over"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// # æ‰§è¡Œç»“æœ #</span></span><br><span class="line">db connecting ...</span><br><span class="line">db connecting ...</span><br><span class="line">db connecting ...</span><br><span class="line">db connecting ...</span><br><span class="line">worker done!</span><br><span class="line">over</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="WithValue"><a href="#WithValue" class="headerlink" title="WithValue()"></a>WithValue()</h4><p>æè¿°: WithValue å‡½æ•°èƒ½å¤Ÿå°†è¯·æ±‚ä½œç”¨åŸŸçš„æ•°æ®ä¸ Context å¯¹è±¡å»ºç«‹å…³ç³», WithValue è¿”å›çˆ¶èŠ‚ç‚¹çš„å‰¯æœ¬ï¼Œå…¶ä¸­ä¸keyå…³è”çš„å€¼ä¸ºvalã€‚</p>
<p>æ³¨æ„å…¶ä»…å¯¹APIå’Œè¿›ç¨‹é—´ä¼ é€’è¯·æ±‚åŸŸçš„æ•°æ®ä½¿ç”¨ä¸Šä¸‹æ–‡å€¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å®ƒæ¥ä¼ é€’å¯é€‰å‚æ•°ç»™å‡½æ•°ï¼Œæ‰€æä¾›çš„é”®å¿…é¡»æ˜¯å¯æ¯”è¾ƒçš„ï¼Œå¹¶ä¸”ä¸åº”è¯¥æ˜¯stringç±»å‹æˆ–ä»»ä½•å…¶ä»–å†…ç½®ç±»å‹ï¼Œä»¥é¿å…ä½¿ç”¨ä¸Šä¸‹æ–‡åœ¨åŒ…ä¹‹é—´å‘ç”Ÿå†²çªã€‚</p>
<p>WithValueçš„ç”¨æˆ·åº”è¯¥ä¸ºé”®å®šä¹‰è‡ªå·±çš„ç±»å‹,ä¸ºäº†é¿å…åœ¨åˆ†é…ç»™<code>interface{}</code>æ—¶è¿›è¡Œåˆ†é…ï¼Œä¸Šä¸‹æ–‡é”®é€šå¸¸<code>å…·æœ‰å…·ä½“ç±»å‹struct{}</code>æˆ–è€…<code>å¯¼å‡ºçš„ä¸Šä¸‹æ–‡å…³é”®å˜é‡çš„é™æ€ç±»å‹åº”è¯¥æ˜¯æŒ‡é’ˆæˆ–æ¥å£</code>ã€‚</p>
<p><strong>å‡½æ•°åŸå‹:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithValue</span><span class="params">(parent Context, key, val <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">Context</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> parent == <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">"cannot create context from nil parent"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> key == <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">"nil key"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> !reflectlite.TypeOf(key).Comparable() &#123;</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">"key is not comparable"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &amp;valueCtx&#123;parent, key, val&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>ç¤ºä¾‹æ¼”ç¤º:</strong><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨withValueæ—¶å®šä¹‰è‡ªå·±çš„ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> TraceCode <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">  key := TraceCode(<span class="string">"TRACE_CODE"</span>)           <span class="comment">// TraceCode ç±»å‹çš„å­—ç¬¦ä¸²å®é™…ä¸Šå°±æ˜¯stringç±»å‹ï¼Œåªæ˜¯é‡‡ç”¨äº†åˆ«åæ–¹å¼</span></span><br><span class="line">  traceCode, ok := ctx.Value(key).(<span class="keyword">string</span>) <span class="comment">// åœ¨å­goroutineä¸­è·å–ctxä¸Šä¸‹æ–‡ç»‘å®šTRACE_CODEé”®å€¼ã€‚</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> !ok &#123;</span><br><span class="line">    fmt.Println(<span class="string">"invalid trace code"</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">LOOP:</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"worker, trace code:%s\n"</span>, traceCode)  <span class="comment">// å¾ªç¯è¾“å‡ºç›´åˆ°å…³é—­ä¸Šä¸‹æ–‡</span></span><br><span class="line">    time.Sleep(time.Millisecond * <span class="number">10</span>) <span class="comment">// å‡è®¾æ­£å¸¸è¿æ¥æ•°æ®åº“è€—æ—¶10æ¯«ç§’</span></span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> &lt;-ctx.Done(): <span class="comment">// 50æ¯«ç§’åè‡ªåŠ¨è°ƒç”¨</span></span><br><span class="line">      <span class="keyword">break</span> LOOP <span class="comment">// é€€å‡ºå½“å‰forå¾ªç¯</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(<span class="string">"worker done!"</span>)</span><br><span class="line">  wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// è®¾ç½®ä¸€ä¸ª50æ¯«ç§’çš„è¶…æ—¶å¹¶è¿”å›ä¸€ä¸ªparentä¸Šä¸‹æ–‡ã€‚</span></span><br><span class="line">  ctx, cancel := context.WithTimeout(context.Background(), time.Millisecond*<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨ç³»ç»Ÿçš„å…¥å£ä¸­è®¾ç½®trace codeä¼ é€’ç»™åç»­å¯åŠ¨çš„goroutineå®ç°æ—¥å¿—æ•°æ®èšåˆã€‚</span></span><br><span class="line">  ctx = context.WithValue(ctx, TraceCode(<span class="string">"TRACE_CODE"</span>), <span class="string">"12512312234"</span>)  <span class="comment">// æ³¨æ„æ­¤å¤„æ˜¯ä¼ å…¥çš„æ˜¯ct(å³parentä¸Šä¸‹æ–‡)</span></span><br><span class="line">  wg.Add(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">go</span> worker(ctx)</span><br><span class="line">  time.Sleep(time.Second * <span class="number">5</span>) <span class="comment">// é˜²æ­¢å¤ªå¿«çœ‹ä¸å‡ºæ•ˆæœ</span></span><br><span class="line">  cancel()     <span class="comment">// å…³é—­ä¸Šä¸‹æ–‡å¹¶é€šçŸ¥å­goroutineç»“æŸ</span></span><br><span class="line">  wg.Wait()</span><br><span class="line">  fmt.Println(<span class="string">"over"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// # æ‰§è¡Œç»“æœ # </span></span><br><span class="line">worker, trace code:<span class="number">12512312234</span></span><br><span class="line">worker, trace code:<span class="number">12512312234</span></span><br><span class="line">worker, trace code:<span class="number">12512312234</span></span><br><span class="line">worker, trace code:<span class="number">12512312234</span></span><br><span class="line">worker, trace code:<span class="number">12512312234</span></span><br><span class="line">worker done!</span><br><span class="line">over</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="5-Context-æ€»ç»“"><a href="#5-Context-æ€»ç»“" class="headerlink" title="5.Context æ€»ç»“"></a>5.Context æ€»ç»“</h3><p>æè¿°: æˆ‘ä»¬åœ¨ä½¿ç”¨Contextçš„æ—¶å€™éœ€è¦æ³¨æ„ä»¥ä¸‹äº‹é¡¹ã€‚</p>
<ul>
<li>æ¨èä»¥å‚æ•°çš„æ–¹å¼æ˜¾ç¤ºä¼ é€’Contextï¼Œå¹¶ä»¥Contextä½œä¸ºå‚æ•°çš„å‡½æ•°æ–¹æ³•ï¼Œåº”è¯¥æŠŠContextä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚</li>
<li>ç»™ä¸€ä¸ªå‡½æ•°æ–¹æ³•ä¼ é€’Contextçš„æ—¶å€™ï¼Œä¸è¦ä¼ é€’nilï¼Œå¦‚æœä¸çŸ¥é“ä¼ é€’ä»€ä¹ˆï¼Œå°±ä½¿ç”¨context.TODO()</li>
<li>Context çš„Valueç›¸å…³æ–¹æ³•åº”è¯¥ä¼ é€’è¯·æ±‚åŸŸçš„å¿…è¦æ•°æ®ï¼Œä¸åº”è¯¥ç”¨äºä¼ é€’å¯é€‰å‚æ•°</li>
<li>Context æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥æ”¾å¿ƒçš„åœ¨å¤šä¸ªgoroutineä¸­ä¼ é€’</li>
</ul>
<p><strong>ç¤ºä¾‹1.è°ƒç”¨æœåŠ¡ç«¯APIæ—¶å¦‚ä½•åœ¨å®¢æˆ·ç«¯å®ç°è¶…æ—¶æ§åˆ¶ï¼Ÿ</strong></p>
<p>Server ç«¯:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"math/rand"</span></span><br><span class="line">  <span class="string">"net/http"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// æ­¤å¤„å°†æ¼”ç¤º server ç«¯éšæœºå‡ºç°æ…¢å“åº”</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">indexHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">  number := rand.Intn(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">if</span> number == <span class="number">0</span> &#123;</span><br><span class="line">    time.Sleep(time.Second * <span class="number">10</span>)    <span class="comment">// è€—æ—¶10ç§’çš„æ…¢å“åº”</span></span><br><span class="line">    fmt.Fprintf(w, <span class="string">"slow response - WeiyiGeek"</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Fprint(w, <span class="string">"quick response - master@weiyigeek.top"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  http.HandleFunc(<span class="string">"/"</span>, indexHandler)</span><br><span class="line">  err := http.ListenAndServe(<span class="string">":8000"</span>, <span class="literal">nil</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>client ç«¯:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"context"</span></span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"io/ioutil"</span></span><br><span class="line">  <span class="string">"net/http"</span></span><br><span class="line">  <span class="string">"sync"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="keyword">type</span> respData <span class="keyword">struct</span> &#123;</span><br><span class="line">  resp *http.Response</span><br><span class="line">  err  error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doCall</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">  <span class="comment">// è¯·æ±‚é¢‘ç¹å¯å®šä¹‰å…¨å±€çš„clientå¯¹è±¡å¹¶å¯ç”¨é•¿é“¾æ¥ï¼Œå¦åˆ™è¯·ä½¿ç”¨çŸ­é“¾æ¥ã€‚</span></span><br><span class="line">  transport := http.Transport&#123;</span><br><span class="line">    DisableKeepAlives: <span class="literal">true</span>, </span><br><span class="line">  &#125;</span><br><span class="line">  client := http.Client&#123;</span><br><span class="line">    Transport: &amp;transport,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// é’ˆå¯¹æŒ‡é’ˆç»“æ„ä½“ç±»å‹çš„é€šé“è¿›è¡Œå†…å­˜ç”³è¯·</span></span><br><span class="line">  respChan := <span class="built_in">make</span>(<span class="keyword">chan</span> *respData, <span class="number">1</span>)</span><br><span class="line">  req, err := http.NewRequest(<span class="string">"GET"</span>, <span class="string">"http://127.0.0.1:8000/"</span>, <span class="literal">nil</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"new requestg failed, err:%v\n"</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ä½¿ç”¨å¸¦è¶…æ—¶çš„ctxåˆ›å»ºä¸€ä¸ªæ–°çš„ client requestã€‚</span></span><br><span class="line">  req = req.WithContext(ctx) </span><br><span class="line">  <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">  wg.Add(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">defer</span> wg.Wait()</span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    resp, err := client.Do(req)</span><br><span class="line">    fmt.Printf(<span class="string">"client.do resp:%v, err:%v\n"</span>, resp, err)</span><br><span class="line">    rd := &amp;respData&#123;</span><br><span class="line">      resp: resp,</span><br><span class="line">      err:  err,</span><br><span class="line">    &#125;</span><br><span class="line">    respChan &lt;- rd</span><br><span class="line">    wg.Done()</span><br><span class="line">  &#125;()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">select</span> &#123;</span><br><span class="line">  <span class="keyword">case</span> &lt;-ctx.Done():  <span class="comment">// å½“è¯·æ±‚è¶…è¿‡æ—¶é—´è¶…è¿‡WithTimeoutè®¾å®šçš„æ—¶é—´æ—¶å°†ä¼šæ”¯æŒcancel()å‘é€å…³é—­ä¸Šä¸‹æ–‡ä¿¡å·ç»™é€šé“ã€‚</span></span><br><span class="line">    <span class="comment">//transport.CancelRequest(req)</span></span><br><span class="line">    fmt.Println(<span class="string">"call api timeout"</span>)</span><br><span class="line">  <span class="keyword">case</span> result := &lt;-respChan:</span><br><span class="line">    fmt.Println(<span class="string">"call server api success"</span>)</span><br><span class="line">    <span class="keyword">if</span> result.err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">"call server api failed, err:%v\n"</span>, result.err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> result.resp.Body.Close()</span><br><span class="line">    data, _ := ioutil.ReadAll(result.resp.Body)</span><br><span class="line">    fmt.Printf(<span class="string">"resp:%v\n"</span>, <span class="keyword">string</span>(data))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// å®šä¹‰ä¸€ä¸ª100æ¯«ç§’çš„è¶…æ—¶</span></span><br><span class="line">  ctx, cancel := context.WithTimeout(context.Background(), time.Millisecond*<span class="number">100</span>)</span><br><span class="line">  <span class="comment">// è°ƒç”¨cancelé‡Šæ”¾å­goroutineèµ„æº</span></span><br><span class="line">  <span class="keyword">defer</span> cancel() </span><br><span class="line">  doCall(ctx)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// # æ‰§è¡Œç»“æœ #</span></span><br><span class="line">client.do resp:*, err:*</span><br><span class="line">call server api success</span><br></pre></td></tr></table></figure></p>

        </div>
        
        <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
        
        <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½çœ‹å‹,æ¬¢è¿å…³æ³¨åšä¸»å¾®ä¿¡å…¬ä¼—å·å“Ÿ! â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘å³å¯å…³é—­ç»§ç»­æµè§ˆæ–‡ç« .<br>  <b style="color:red;"> æ¸©é¦¨æç¤º: æœªè§£é”çš„ç”¨æˆ·ä¸èƒ½ç²˜è´´å¤åˆ¶æ–‡ç« å†…å®¹å“Ÿ!</b> <br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
           

        <!-- Google å¹¿å‘Š -->
        
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
  

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-03-11T03:29:11.749Z" itemprop="dateUpdated">2022-03-11 11:29:11</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç¼–ç¨‹ä¸–ç•Œ/Go/Package/2.Goè¯­è¨€ä¹‹æ ‡å‡†åº“å­¦ä¹ è®°å½•(2).md" target="_blank" rel="noopener noreferrer">_posts/ç¼–ç¨‹ä¸–ç•Œ/Go/Package/2.Goè¯­è¨€ä¹‹æ ‡å‡†åº“å­¦ä¹ è®°å½•(2).md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2020/4-23-603.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/4-23-603.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go/" rel="tag">Go</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/4-23-603.html&title=ã€Š2.Goè¯­è¨€ä¹‹æ ‡å‡†åº“å­¦ä¹ è®°å½•(2)ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/4-23-603.html&title=ã€Š2.Goè¯­è¨€ä¹‹æ ‡å‡†åº“å­¦ä¹ è®°å½•(2)ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/4-23-603.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š2.Goè¯­è¨€ä¹‹æ ‡å‡†åº“å­¦ä¹ è®°å½•(2)ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/4-23-603.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/4-23-603.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/4-23-604.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">2.Goè¯­è¨€ä¹‹æ–‡ä»¶æ“ä½œå­¦ä¹ è®°å½•.md</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/4-23-611.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">n1.Goè¯­è¨€ä¹‹ä¸‰æ–¹æ‰©å±•å­¦ä¹ è®°å½•</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-Strconv-å­—ç¬¦ä¸²ç±»å‹è½¬æ¢åº“"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 Strconv.å­—ç¬¦ä¸²ç±»å‹è½¬æ¢åº“</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-Atoi-ã€Itoa-å‡½æ•°"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">1.Atoi()ã€Itoa()å‡½æ•°</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-Parseç³»åˆ—å‡½æ•°"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">2.Parseç³»åˆ—å‡½æ•°</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-Formatç³»åˆ—å‡½æ•°"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">3.Formatç³»åˆ—å‡½æ•°</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6-Appendç³»åˆ—ã€Quoteç³»åˆ—ç­‰å‡½æ•°"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">6.Appendç³»åˆ—ã€Quoteç³»åˆ—ç­‰å‡½æ•°</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-æ‰©å±•è¯´æ˜"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">5.æ‰©å±•è¯´æ˜</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-Sync-å¹¶å‘å®‰å…¨åº“"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 Sync.å¹¶å‘å®‰å…¨åº“</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-sync-WaitGroup"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">1.sync.WaitGroup</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-sync-Once"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">2.sync.Once</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-sync-Map"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">3.sync.Map</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-sync-Mutexã€RWMutex"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">4.sync.Mutexã€RWMutex</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-Atomic-åŸå­æ“ä½œåº“"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 Atomic.åŸå­æ“ä½œåº“</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x03-Context-ä¸Šä¸‹æ–‡æ“ä½œåº“"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 Context.ä¸Šä¸‹æ–‡æ“ä½œåº“</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-Context-ç®€è¿°"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">1.Context ç®€è¿°</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-Context-æ¥å£åˆè¯†"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">2.Context æ¥å£åˆè¯†</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-Context-å†…ç½®å‡½æ•°"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">3.Context å†…ç½®å‡½æ•°</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-Context-Withç³»åˆ—å‡½æ•°"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">4.Context.Withç³»åˆ—å‡½æ•°</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#WithCancel"><span class="post-toc-number">4.4.1.</span> <span class="post-toc-text">WithCancel()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#WithDeadline"><span class="post-toc-number">4.4.2.</span> <span class="post-toc-text">WithDeadline()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#WithTimeout"><span class="post-toc-number">4.4.3.</span> <span class="post-toc-text">WithTimeout()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#WithValue"><span class="post-toc-number">4.4.4.</span> <span class="post-toc-text">WithValue()</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-Context-æ€»ç»“"><span class="post-toc-number">4.5.</span> <span class="post-toc-text">5.Context æ€»ç»“</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
    <!-- 
  <div id="post-wechat" class="post-wechat" style="position:fixed;top: 360px;bottom: 500px;right: 3%;width: 190px;text-align: center; z-index: 9999">
    <p><b>å…³æ³¨ã€å…¨æ ˆå·¥ç¨‹å¸ˆä¿®ç‚¼æŒ‡å—ã€‘</b></p>
    <img src="/img/wechat-gzh.jpg" class="img-responsive" alt="weiyigeek">
    <p><b>æ¬¢è¿æ·»åŠ ã€ä½œè€…ã€‘å¾®ä¿¡</b></p>
    <img src="/img/wehat.jpg" class="img-responsive" alt="weiyigeek">
  </div>
 -->

    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="/img/share-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2023 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div>
        <div id="blog-wormhole-id" >
          <a href="https://www.foreverblog.cn/go.html" target="_blank"> 
            <img src="https://img.foreverblog.cn/wormhole_2_tp.gif" alt="åå¹´ä¹‹çº¦è™«æ´" style="height:32px;max-height:50px;display:block;margin:0 auto;" title="ç©¿æ¢­è™«æ´-éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢">
          </a>
        </div>
        <div id="cc-myssl-id" >
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>

<div id="go" class="waves-effect waves-light">
  <a href="javascript:;" id="goqrcode"> <span class="icon icon-lg icon-qrcode"></span> </a>
  <a href="javascript:;" id="gotop"> <span class="icon icon-lg icon-chevron-up"></span></a>
</div>





<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/4-23-603.html&title=ã€Š2.Goè¯­è¨€ä¹‹æ ‡å‡†åº“å­¦ä¹ è®°å½•(2)ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/4-23-603.html&title=ã€Š2.Goè¯­è¨€ä¹‹æ ‡å‡†åº“å­¦ä¹ è®°å½•(2)ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/4-23-603.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š2.Goè¯­è¨€ä¹‹æ ‡å‡†åº“å­¦ä¹ è®°å½•(2)ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/4-23-603.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/4-23-603.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJ0lEQVR42u3aS5LCMAxFUfa/6fS0q+iQ+6SEasvXIwpI4sNA6OPXC6/j1yKfHm/r7Cr+lBuWDBkylmUcH9fn73DM2dbf3yfP/eM+MmTI2IDxxK35dzpsGTJkyCBpHAnTfKMyZMiQcW/A5cXnv/7fkCFDxiIMEjpJwscbbeSqR2pxGTJkLMjgXffvv35kviFDhoylGEe40rvVEsd4VzJkyBjN4AGOJIv9grazHxkyZOzJ6DzsrgYcf0eGDBk7MPoHI0jp2znAcfF0GTJkDGV0mvhku7WBZbwrGTJkjGakm+gUpTzRTH8IGTJk7MNIRwI8gau17dDW09mCDBkyFmSgNhYoUNOwWxsGnF4lQ4aMDRj3FpO8TOVDgov7yJAhYzSjf5wC5Z7gp+Gh/6LAliFDxmhGWqCSBLHTaOsnjjJkyJjHKLbjcXrXZ8epoQwZMgYxeOu/tgmezBX/H2TIkLExIx0J8GKVl8dBmihDhozNGOmDO839dDxQPHIhQ4aM0Yy0cOXJYu0OpxgZMmRswEiTuTQd5OkmeS1DhgwZ/ChYGkbjAxO85JYhQ8ZQxhGuDiMNsrx4liFDxmxG/6AYKXGDllmYJsYYGTJkLMuoNcj6rf90kHAxQpAhQ8YGjFrqliL7Z7pOkTJkyJBRCrI84KYHLNBhCxkyZMgIG2GkAE6/c1vAlSFDxiKMdBjAQ2Tt2gfbbTJkyFiQ0Tqp0RgtkECftvNkyJAxjvEDoS3RPyb62NoAAAAASUVORK5CYII=" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å”¯ä¸€æå®¢-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// ç«™ç‚¹è¿è¡Œæ—¶é—´
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + " å¤© " + RunHours + " æ—¶ " + RunMinutes + " åˆ† " + RunSeconds + " ç§’";
  document.getElementById(id).innerHTML = "ç½‘ç«™å·²åœ¨é£é›¨ä¸­å‹‰å‹‰å¼ºå¼ºè¿è¡Œäº†ã€ " + RunTime + " ã€‘";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
    
  <div id="post-wechat" class="post-wechat" style="position:fixed;top: 360px;bottom: 500px;right: 3%;width: 190px;text-align: center; z-index: 9999">
    <p><b>å…³æ³¨ã€å…¨æ ˆå·¥ç¨‹å¸ˆä¿®ç‚¼æŒ‡å—ã€‘</b></p>
    <img src="/img/wechat-gzh.jpg" class="img-responsive" alt="weiyigeek">
    <p><b>æ¬¢è¿æ·»åŠ ã€ä½œè€…ã€‘å¾®ä¿¡</b></p>
    <img src="/img/wehat.jpg" class="img-responsive" alt="weiyigeek">
  </div>

</body>
</html>