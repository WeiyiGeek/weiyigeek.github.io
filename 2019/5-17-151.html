<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>🌐 rpm 快速入门与基础|WeiyiGeek Blog|唯一极客Geek-IT网络安全运维开发技术知识分享-博客站点</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="系统命令">
    <meta name="Description" content="WeiyiGeek-唯一极客博客站点,关注于网络安全运维,Web安全开发,IOT物联网安全开发,应用开发,分享技术学习知识与入坑解决,提升网络安全技术与自身技术能力,立志维护大众网络安全为己任,做一个对国家有用的人,为实现中华民族伟大复兴的中国梦不懈奋斗">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-头像">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                首页
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                文章分类
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                文章标签
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                文章归档
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                学习书籍
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                关于作者
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                站点导航
              </a>
            </li>
        
            <li class="">
              <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                公众账号
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                哔哩哔哩
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>rpm 快速入门与基础</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="文章头部背景">
    <div class="container fade-scale">
        <h1 class="title">rpm 快速入门与基础</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-05-17T12:35:30.000Z" itemprop="datePublished" class="page-time">
  2019-05-17
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Linux%E5%91%BD%E4%BB%A4/">Linux命令</a></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-系统运维/Linux/常用命令/安装软件类命令/rpm快速入门与基础"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">rpm 快速入门与基础</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-05-17 20:35:30" datetime="2019-05-17T12:35:30.000Z"  itemprop="datePublished">2019-05-17</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Linux%E5%91%BD%E4%BB%A4/">Linux命令</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]<br><a id="more"></a></p>
<h4 id="0x00-rpm介绍"><a href="#0x00-rpm介绍" class="headerlink" title="0x00 rpm介绍"></a>0x00 rpm介绍</h4><p>RPM全称是 Red Hat Package Manager（Red Hat包管理器-红帽创建的一个开放的软件包管理系统）。几乎所有的 Linux 发行版本都使用这种形式的软件包管理安装、更新和卸载软件,现在已成为一种标准,常用在opensuse/turbo/redhat版本,</p>
<p>RPM软件包中的文件是以压缩格式存放的，拥有一个定制的二进制头文件，其中包含有关包和内容的信息，可以让我们对单个软件包的查询简便又快速。</p>
<p>rmp包的特点：</p>
<ul>
<li>拥有功能强大的查询选项</li>
<li>拥有能进行软件包的验证选项</li>
</ul>
<p><em>rpm包优缺点</em>：</p>
<ul>
<li>优点：包管理系统简单(通过命令实现包的安装、卸载、升级、查询、和验证),安装速度比源码包快</li>
<li>缺点：经过编译不能看见源代码,功能选择不如源码灵活,依赖性;</li>
</ul>
<p>采用定制rpm包存放到yum仓库中并进行yum安装：</p>
<ul>
<li>优点：可以根据自己的需求编译软件&gt;&gt;制作 rpm 包&gt;&gt;搭建 yum 仓库&gt;&gt;上传 rpm 包到 yum仓库&gt;&gt;客户端安装软件　　</li>
<li>缺点：第一步编译安装复杂，打包完成以后无法更改，一般人不会这个方法</li>
</ul>
<p>RPM包存在的依赖性：装A前要装B,装B前要装C，比如window装游戏要显卡驱动 .net 的依赖；<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#常见的RPM包依赖</span></span><br><span class="line">- 树形依赖</span><br><span class="line">- 环形依赖</span><br><span class="line">- 模块依赖</span><br><span class="line">模块依赖的的文件名是以.so.2结尾的时候，代表这是一个文件，而不是一个软件包此时是模块依赖，需要依赖一个库文件。</span><br><span class="line">这个时候就要上 www.rpmfind.net https://pkgs.org/ 网上去查找这一库文件是在那一个软件包下然后再把这个软件包安装上</span><br></pre></td></tr></table></figure></p>
<p>RPM包命名规则:httpd-2.2.15-15.el6.centos.1.i686.rpm<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-httpd软件包名</span><br><span class="line">-2.2.15软件版本号</span><br><span class="line">-15 软件发布次数</span><br><span class="line">-el6.centos 适合的Linux平台</span><br><span class="line">-i686 适合的硬件平台</span><br><span class="line">-rpm 扩展名</span><br></pre></td></tr></table></figure></p>
<p><em>源码包和RPM包的区别：</em></p>
<ul>
<li>安装之前的区别：概念上的区别</li>
<li>安装之后的区别：安装位置不同,rpm也可以指定安装目录,rpm包安装的服务可以使用系统服务管理命令（service）来管理</li>
</ul>
<p><em>包全名与包名</em>：</p>
<ul>
<li>包全名：操作的包是没有安装的软件包时，使用包全名如httpd-2.2.15-15.el6.centos.1.i686.rpm</li>
<li>包名： 操作一景安装的软件包时，使用包名，是收索/var/lib/rpm/中的数据库如httpd</li>
<li>注:未安装的包都要使用包全名，已安装的包只使用包名。</li>
</ul>
<hr>

<h4 id="0x01-命令一览"><a href="#0x01-命令一览" class="headerlink" title="0x01 命令一览"></a>0x01 命令一览</h4><h5 id="1-rpm命令"><a href="#1-rpm命令" class="headerlink" title="1. rpm命令"></a>1. rpm命令</h5><p>rpm包安装的服务可以使用系统服务管理命令（service）来管理，RPM有五种基本的操作功能：安装、卸载、升级、查询和验证。例如RPM包安装的apache启动方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#service命令实际搜索的事 /etc/rc.d/init.d 目录</span></span><br><span class="line">/etc/rc.d/init.d/httpd start</span><br><span class="line">service httpd start</span><br></pre></td></tr></table></figure>
<p>RPM包默认安装位置:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/etc/ 配置文件安装目录</span><br><span class="line">/etc/sysconfig/  初始化环境配置文件位置</span><br><span class="line">/etc/init.d/ 启动脚本位置</span><br><span class="line">/usr/bin/ 可执行的命令安装目录           <span class="comment"># usr是Unix System Resource,即Unix系统资源的缩写</span></span><br><span class="line">/usr/lib/ 程序所使用的函数库保存位置</span><br><span class="line">/usr/share/doc/ 基本的软件使用手册保存位置</span><br><span class="line">/usr/share/man/ 帮助文件保存位置</span><br><span class="line">/var/lib/ 服务产生数据 库文件存放位置</span><br><span class="line">/var/<span class="built_in">log</span> 日志</span><br></pre></td></tr></table></figure></p>
<p>常用命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh [包全名]  <span class="comment">#安装软件</span></span><br><span class="line">rpm -Uvh [包全名] <span class="comment">#软件升级</span></span><br><span class="line"></span><br><span class="line">rpm -e 包名   <span class="comment">#卸载的时候也需要依赖检查反向卸载</span></span><br><span class="line">rpm -q 包名   <span class="comment">#查询是否安装 </span></span><br><span class="line">rpm -qa      <span class="comment">#显示所有的RPM包</span></span><br><span class="line"></span><br><span class="line">rpm -qi 包名   <span class="comment">#查询安装rpm包的信息</span></span><br><span class="line">rpm -qip 包全名   </span><br><span class="line"></span><br><span class="line">rpm -ql 包名   <span class="comment">#查询rpm包安装和配置的目录</span></span><br><span class="line">rpm -qlp 包全名</span><br><span class="line"></span><br><span class="line">rpm -qf [路径/文件名] <span class="comment">#查询系统文件属于哪个RPM包</span></span><br><span class="line"></span><br><span class="line">rpm -qR 包名    <span class="comment"># 查询软件包的依赖性</span></span><br><span class="line">rpm -qRp 包全名</span><br><span class="line"></span><br><span class="line">rpm -V [已安装的包名]  <span class="comment">#进行包效验：什么是包校验就是验证包是否被修改过,没有被修改过表示验证通过.</span></span><br><span class="line">rpm ---prefix=&lt;dir&gt;   <span class="comment">#指定安装目录，如果可重定位，便把软件包重定位到 &lt;dir&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#参数说明</span></span><br><span class="line">-i (install) 安装</span><br><span class="line">-U (upgrade) 升级</span><br><span class="line">-e (erase) 卸载</span><br><span class="line">-a (all) 所有包需要和-q联合使用</span><br><span class="line">-q (--query)查询是否安装</span><br><span class="line">-i 查询软件信息</span><br><span class="line">-f 查询系统文件属于哪个软件包</span><br><span class="line">-R 查询软件包的依赖性</span><br><span class="line">-l 查询包安装位置列表</span><br><span class="line">-p 查询未安装软件包的详细信息 package（必须进入光盘里面看包名信息）</span><br><span class="line">-v (verbose) 显示详细信息</span><br><span class="line">-V (--verify)校验指定RPM包的文件</span><br><span class="line">-h (<span class="built_in">hash</span>) 显示进度</span><br><span class="line"></span><br><span class="line">--nodeps 不监测依赖性</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=rpm 快速入门与基础 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190517172155.png" target="_blank" title="WeiyiGeek.rpm" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190517172155.png" alt="WeiyiGeek.rpm" title="" class=""></a>
                <p>WeiyiGeek.rpm</p>
            </figure>
<p>实例演示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">[root@izwz9biz2m4sd3bb3k38pgz ~]$ rpm -q httpd</span><br><span class="line">httpd-2.4.6-88.el7.centos.x86_64</span><br><span class="line"></span><br><span class="line">[root@izwz9biz2m4sd3bb3k38pgz ~]$ rpm -qa | grep <span class="string">"httpd"</span></span><br><span class="line">httpd-2.4.6-88.el7.centos.x86_64</span><br><span class="line">httpd-manual-2.4.6-88.el7.centos.noarch</span><br><span class="line">httpd-tools-2.4.6-88.el7.centos.x86_64</span><br><span class="line"></span><br><span class="line">[root@izwz9biz2m4sd3bb3k38pgz ~]$ rpm -qi httpd</span><br><span class="line">Name        : httpd</span><br><span class="line">Version     : 2.4.6</span><br><span class="line">Release     : 88.el7.centos</span><br><span class="line">Architecture: x86_64</span><br><span class="line">Install Date: Tue 26 Feb 2019 08:56:24 PM CST</span><br><span class="line">Group       : System Environment/Daemons</span><br><span class="line">Size        : 9817309</span><br><span class="line">License     : ASL 2.0</span><br><span class="line">Signature   : RSA/SHA256, Mon 12 Nov 2018 10:28:53 PM CST, Key ID 24c6a8a7f4a80eb5</span><br><span class="line">Source RPM  : httpd-2.4.6-88.el7.centos.src.rpm</span><br><span class="line">Build Date  : Mon 05 Nov 2018 09:48:57 AM CST</span><br><span class="line">Build Host  : x86-01.bsys.centos.org</span><br><span class="line">Relocations : (not relocatable)</span><br><span class="line">Packager    : CentOS BuildSystem &lt;http://bugs.centos.org&gt;</span><br><span class="line">Vendor      : CentOS</span><br><span class="line">URL         : http://httpd.apache.org/</span><br><span class="line">Summary     : Apache HTTP Server</span><br><span class="line">Description :</span><br><span class="line">The Apache HTTP Server is a powerful, efficient, and extensible</span><br><span class="line">web server.</span><br><span class="line"></span><br><span class="line">$ rpm -ql httpd</span><br><span class="line">/etc/httpd</span><br><span class="line">/etc/httpd/conf</span><br><span class="line">/etc/httpd/conf.d</span><br><span class="line">/etc/httpd/conf.d/README</span><br><span class="line">/etc/httpd/conf.d/autoindex.conf</span><br><span class="line"></span><br><span class="line">$ rpm -qf /etc/httpd/conf/httpd.conf</span><br><span class="line">httpd-2.4.6-88.el7.centos.x86_64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ rpm -V httpd</span><br><span class="line">missing   c /etc/httpd/conf.d/welcome.conf</span><br><span class="line">.......T.  c /etc/httpd/conf/httpd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#验证内容中的8个信息的具体内容如下：</span></span><br><span class="line">S 文件大小是否该表</span><br><span class="line">M 文件类型或文件的权限（rwx）是否被改变</span><br><span class="line">5 文件MD5校验和是否改变</span><br><span class="line">D 设备的主从代码是否改变</span><br><span class="line">L 文件路径是否改变</span><br><span class="line">U 文件的属主是否改变</span><br><span class="line">G 文件的属组是否改变</span><br><span class="line">T 文件的修改时间是否改变</span><br><span class="line"></span><br><span class="line"><span class="comment">#文件类型：</span></span><br><span class="line">c 配置文件</span><br><span class="line">d 普通文档</span><br><span class="line">g 鬼文件，很少见，就是该文件不应该被这个RPM包包含</span><br><span class="line">L 授权文件</span><br><span class="line">r 描述文件</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>实际案例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#实例0.安装rpm包得三种方法：rpm命令安装 / yum命令安装 / yum 仓库安装</span></span><br><span class="line">yum -y localinstall *.rpm <span class="comment">#自动安装 rpm 的依赖包</span></span><br><span class="line">rpm -ivh nginx-1.6.3-1.x86_64.rpm <span class="comment">#安装 rpm 包</span></span><br><span class="line">rpm -ivh rubygems-1.3.7-5.el6.noarch.rpm --nodeps　　<span class="comment">#这种方式安装会忽略runygems的依赖包，不建议使用</span></span><br><span class="line">rpm -Uvh *.rpm <span class="comment">#如果依赖版本有更新的则自动更新</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#实例1.RPM常用查询命令组合</span></span><br><span class="line">man rpm <span class="comment">#查看 rpm 帮助</span></span><br><span class="line">rpm -qpi nginx-1.6.3-1.x86_64.rpm <span class="comment">#查看 rpm 包信息</span></span><br><span class="line">rpm -qpl nginx-1.6.3-1.x86_64.rpm <span class="comment">#查看 rpm 包内容</span></span><br><span class="line">rpm -qpR nginx-1.6.3-1.x86_64.rpm <span class="comment">#查看 rpm 包的依赖</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#实例2.rpm进阶查看</span></span><br><span class="line">rpm -qp --scripts nginx-1.6.3-1.x86_64.rpm <span class="comment">#查看 rpm 包带的执行脚本，执行脚本以文件形式存在 rpm 包中</span></span><br><span class="line">rpm -ivh --aid *.rpm      <span class="comment">#--aid 参数解决 rpm 包循环依赖的问题，即当前目录有所有相互依赖的 rpm 包就可以用这种方法。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#实例3.rpm卸载软件包</span></span><br><span class="line">rpm -ev nginx-1.6.3-1.x86_64.rpm</span><br><span class="line">rpm -e --nodeps nginx-1.6.3-1.x86_64.rpm <span class="comment">#会将其依赖他的包一起删除</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="2-文件提取"><a href="#2-文件提取" class="headerlink" title="2. 文件提取"></a>2. 文件提取</h5><p>cpio是一个标准工具它用于创建软件档案和从档案文件中提取文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rpm2cpio 包全名 ｜ cpio -idv .文件绝对路径   <span class="comment">#rpm2cpio 将rpm包转换为cpio格式的命令</span></span><br><span class="line">cpio 选项 &lt;[文件][设备]&gt;</span><br><span class="line">  -i   copy-in 模式 还原</span><br><span class="line">  -d   还原时自动新建目录</span><br><span class="line">  -v   显示还原过程</span><br></pre></td></tr></table></figure></p>
<p>使用案例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$rpm</span> -qf /bin/ls   <span class="comment">#查询ls命令属于哪个软件包</span></span><br><span class="line">coreutils-8.22-23.el7.x86_64</span><br><span class="line"></span><br><span class="line"><span class="variable">$mv</span> /bin/ls /tmp/  <span class="comment">#造成ls命令误删假象</span></span><br><span class="line">rpm2cpio /mnt/cdrom/Packages/coreutils-8.22-23.el7.x86_64.rpm | cpio -idv ./bin/ls   <span class="comment"># 提取ls命令到当前目录</span></span><br><span class="line">cp /root/bin/ls /bin/  <span class="comment"># 把ls命令复制回/bin/目录 修复误操作</span></span><br></pre></td></tr></table></figure></p>
<hr>

<h4 id="0x02-rpm定制与应用"><a href="#0x02-rpm定制与应用" class="headerlink" title="0x02 rpm定制与应用"></a>0x02 rpm定制与应用</h4><p>rpmbuild 是 redhat 系统原生打包命令，这个命令的使用复杂不推荐使用此方法打包 rpm 包;</p>
<p><em>问题:当领导给你 100 台已经安装好系统的服务器，然后让优化，让你提出一个快速部署方案</em><br>1.tar 打包 先编译安装 打包–&gt;分发–&gt;解包(比如 mysql 打包后直接就可以使用<br>2.SaltStack，puppet 自动化运维管理平台<br>3.定制 rpm yum 仓库 yum 安装<br>4.openstack 虚拟机镜像和 docker 容器分发</p>
<h5 id="1-spec文件规范"><a href="#1-spec文件规范" class="headerlink" title="1. spec文件规范"></a>1. spec文件规范</h5><p>制作RPM软件包其中的关键在于编写SPEC软件包描述文件,该文件中包含了软件包的诸多信息;<br>如软件包的名字、版本、类别、说明摘要、创建时要执行什么指令、安装时要执行什么操作、以及软件包所要包含的文件列表等等。</p>
<p>描述文件说明如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">（1） 文件头</span><br><span class="line"></span><br><span class="line"><span class="variable">$rpm</span> -qi httpd <span class="comment">#查询安装httpd的rpm包的信息</span></span><br><span class="line"><span class="comment">#一般的spec文件头包含以下几个域：</span></span><br><span class="line"></span><br><span class="line">Name        : httpd  <span class="comment">#软件包的名字（体系变动）</span></span><br><span class="line">Version     : 2.4.6  <span class="comment">#软件版本号 （较大变化）</span></span><br><span class="line">Release     : 88.el7.centos  <span class="comment">#软件包释出号 (补丁补充)</span></span><br><span class="line"></span><br><span class="line">Architecture: x86_64  <span class="comment">#架构</span></span><br><span class="line">Install Date: Tue 26 Feb 2019 08:56:24 PM CST <span class="comment">#安装时间</span></span><br><span class="line">Group       : System Environment/Daemons  <span class="comment"># 软件包所属类别，具体类别有：</span></span><br><span class="line">Size        : 9817309</span><br><span class="line">License     : ASL 2.0   <span class="comment">#软件包所采用的版权规则</span></span><br><span class="line">Signature   : RSA/SHA256, Mon 12 Nov 2018 10:28:53 PM CST, Key ID 24c6a8a7f4a80eb5</span><br><span class="line">Source RPM  : httpd-2.4.6-88.el7.centos.src.rpm  <span class="comment">#源程序软件包的名字</span></span><br><span class="line">Build Date  : Mon 05 Nov 2018 09:48:57 AM CST</span><br><span class="line">Build Host  : x86-01.bsys.centos.org</span><br><span class="line">Relocations : (not relocatable)</span><br><span class="line">Packager    : CentOS BuildSystem &lt;http://bugs.centos.org&gt;</span><br><span class="line">Vendor      : CentOS  <span class="comment">#软件开发者的名字。</span></span><br><span class="line"></span><br><span class="line">URL         : http://httpd.apache.org/</span><br><span class="line">Summary     : Apache HTTP Server  <span class="comment">#用一句话概括该软件包尽量多的信息。</span></span><br><span class="line">Description :  <span class="comment"># 软件包详细说明，可写在多个行上。</span></span><br><span class="line">The Apache HTTP Server is a powerful, efficient, and extensible</span><br><span class="line">web server.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">####软件包所属类别，具体类别有：#####</span></span><br><span class="line">Amusements/Games （娱乐/游戏）</span><br><span class="line">Amusements/Graphics（娱乐/图形）</span><br><span class="line">Applications/Archiving （应用/文档）</span><br><span class="line">Applications/Communications（应用/通讯）</span><br><span class="line">Applications/Databases （应用/数据库）</span><br><span class="line">Applications/Editors （应用/编辑器）</span><br><span class="line">Applications/Emulators （应用/仿真器）</span><br><span class="line">Applications/Engineering （应用/工程）</span><br><span class="line">Applications/File （应用/文件）</span><br><span class="line">Applications/Internet （应用/因特网）</span><br><span class="line">Applications/Multimedia（应用/多媒体）</span><br><span class="line">Applications/Productivity （应用/产品）</span><br><span class="line">Applications/Publishing（应用/印刷）</span><br><span class="line">Applications/System（应用/系统）</span><br><span class="line">Applications/Text （应用/文本）</span><br><span class="line">Development/Debuggers （开发/调试器）</span><br><span class="line">Development/Languages （开发/语言）</span><br><span class="line">Development/Libraries （开发/函数库）</span><br><span class="line">Development/System （开发/系统）</span><br><span class="line">Development/Tools （开发/工具）</span><br><span class="line">Documentation （文档）</span><br><span class="line">System Environment/Base（系统环境/基础）</span><br><span class="line">System Environment/Daemons （系统环境/守护）</span><br><span class="line">System Environment/Kernel （系统环境/内核）</span><br><span class="line">System Environment/Libraries （系统环境/函数库）</span><br><span class="line">System Environment/Shells （系统环境/接口）</span><br><span class="line">User Interface/Desktops（用户界面/桌面）</span><br><span class="line">User Interface/X （用户界面/X窗口）</span><br><span class="line">User Interface/X Hardware Support （用户界面/X硬件支持）</span><br><span class="line"></span><br><span class="line">（2）%prep段 ：预处理 段通常用来执行一些解开源程序包的命令为下一步的编译安装作准备。</span><br><span class="line">%prep和下面的%build，%install段一样，除了可以执行RPM所定义的宏命令（以%开头）以外，还可以执行SHELL命令，命令可以有很多行，如我们常写的tar解包命令。</span><br><span class="line"></span><br><span class="line">（3）%build段：建立段 所要执行的命令为生成软件包服务如make 命令。</span><br><span class="line"></span><br><span class="line">（4）%install段：安装段 其中的命令在安装软件包时将执行如make install命令。</span><br><span class="line"></span><br><span class="line">（5）%files段：文件段 用于定义软件包所包含的文件分为三类--说明文档（doc）/配置文件（config）及执行程序还可定义文件存取权限拥有者及组别。</span><br><span class="line"></span><br><span class="line">（6）%changelog段: 修改日志段。你可以将软件的每次修改记录到这里，保存到发布的软件包中，以便查询之用。每一个修改日志都有这样一种格式：第一行是：* 星期 月 日 年 修改人 电子信箱。其中：星期、月份均用英文形式的前3个字母，用中文会报错。接下来的行写的是修改了什么地方，可写多行。一般以减号开始，便于后续的查阅。</span><br></pre></td></tr></table></figure></p>
<hr>

<h5 id="2-rpmbuild编译目录"><a href="#2-rpmbuild编译目录" class="headerlink" title="2. rpmbuild编译目录"></a>2. rpmbuild编译目录</h5><p>如果想发布rpm格式的源码包或者是二进制包，就要使用rpmbuild工具（rpm最新打包工具）, 其标准命名格式为:软件名-版本号-释出号.spec</p>
<p>在redhat下安装成功后会在在/usr/src/redhat/目录下建立6个目录,它门分别是BUILD、SOURCE、SPECS 、RPMS   、SRPMS 、 BuiltRoot  ;</p>
<ul>
<li>BUILD ：源代码解压以后放的位置(由rpmbuild管理)- 解压的程序源代码编译文件存储目录</li>
<li>SOURCE：用来存放打包是要用到的源文件和补丁文件等存放位置 - 脚本存放目录</li>
<li>SPEC：存放spec文件作为制作rpm包的领岗文件以 rpm名.spec</li>
<li>RPMS：用来制作完成后的rpm包存放目录，为特定平台指定子目录（i386,i686,ppc）  - rpms生成目录 </li>
<li>SRPMS：分别存放打包生成的rpm格式的源文件和二进制文件</li>
<li>BuiltRoot：使用install临时安装到这个目录把这个目录当作根来用的 - 当打包完成后在清理目录将被删除；</li>
</ul>
<p>注意：在centos没有该目录,因此我们需要自定义工作车间一般自定义到普通用户的家目录下;</p>
<hr>

<h4 id="0x03-rpm打包环境"><a href="#0x03-rpm打包环境" class="headerlink" title="0x03 rpm打包环境"></a>0x03 rpm打包环境</h4><h5 id="0-rpmbuild环境安装"><a href="#0-rpmbuild环境安装" class="headerlink" title="0. rpmbuild环境安装"></a>0. rpmbuild环境安装</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、安装rpm-build与编译环境</span></span><br><span class="line">yum -y install rpm-build</span><br><span class="line">yum -y install gcc gcc-c++ kernel-devel make</span><br><span class="line">yum install rpm-sign  <span class="comment">#rpm签名需要用到</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、增加普通rpm打包用户和工作区间</span></span><br><span class="line">useradd urpm &amp; su - urpm</span><br><span class="line"></span><br><span class="line">$ vim ~/.rpmmacros <span class="comment">#只要改变了这个宏就可以自定义工作车间</span></span><br><span class="line">%_topdir  /home/urpm/rpmbuild</span><br><span class="line">%_gpg_name weiyigeek  <span class="comment">#在~/.rpmmacros宏中定义加密密钥</span></span><br><span class="line"></span><br><span class="line">mkdir -pv ~/rpmbuild/&#123;BUILD,BUILDROOT,RPMS,SOURCES,SPECS,SRPMS&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 修改宏及自定义车间位置</span></span><br><span class="line"><span class="comment">#rpmbuild --showrc 显示所有的宏</span></span><br><span class="line">rpmbuild --showrc | grep _topdir    <span class="comment">#会发现，工作车间已然改变：_topdir  /home/urpm/rpmbuild</span></span><br><span class="line"><span class="comment">#以下划线开头</span></span><br><span class="line">一个下划线：定义环境的使用情况</span><br><span class="line">二个下划线：通常定义的是命令</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=rpm 快速入门与基础 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190519222755.png" target="_blank" title="WeiyiGeek.自定义车间位置" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190519222755.png" alt="WeiyiGeek.自定义车间位置" title="" class=""></a>
                <p>WeiyiGeek.自定义车间位置</p>
            </figure>
<p><em>为什么要定义宏?</em><br>答：因为不同的系统命令的存放位置可能不同，所以通过宏的定义找到命令的真正存放位置.</p>
<p><br></p>
<h5 id="1-rpmbuild命令介绍"><a href="#1-rpmbuild命令介绍" class="headerlink" title="1. rpmbuild命令介绍"></a>1. rpmbuild命令介绍</h5><p>常见得命令是：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rpmbuild -bp xxx.spec  <span class="comment">#(制作到%prep段)只需要生成完整的源文件，源文件存在目录BUILD下,把tar包解开然后把所有的补丁文件合并而生成一个完整的具最新功能的源文件。</span></span><br><span class="line">rpmbuild -bc nginx.spec <span class="comment">#制作到%build段</span></span><br><span class="line">rpmbuild -bi nginx.spec <span class="comment">#执行 spec 文件的 "%install" 阶段 (在执行了 %prep 和 %build 阶段之后)。这通常等价于执行了一次 "make install"</span></span><br><span class="line"></span><br><span class="line">rpmbuild -bs xxx.spec  <span class="comment">#只生成src格式的rpm包，生成的文件会在刚才建立的SRPM目录下存在。</span></span><br><span class="line">rpmbuild -bb xxx.spec  <span class="comment">#只生成二进制格式的rpm包,生成的文件会在刚才建立的RPM目录下存在。</span></span><br><span class="line"></span><br><span class="line">rpmbuild -ba xxx.spec  <span class="comment"># 表示既制作二进制包又制作src格式包,存放在相应的目录下。</span></span><br></pre></td></tr></table></figure><br>软件包制作完成后可用rpm命令查询,如果不满意的话可以再次修改软件包描述文件;</p>
<p>典型spec文件分析:kaffeine.spec（kaffeine是linux平台下的媒体播放器）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Kaffeine.spec文件内容如下：</span></span><br><span class="line"><span class="comment">#第一部分：文件头</span></span><br><span class="line">%define debug_package %&#123;nil&#125;</span><br><span class="line">Name:         kaffeine</span><br><span class="line">Version:        0.4.3</span><br><span class="line">Release:        25</span><br><span class="line">Summary:        A xine-based Media Player <span class="keyword">for</span> KDE</span><br><span class="line">Group:          Applications/Multimedia</span><br><span class="line">License:        GPL</span><br><span class="line">URL:            http://kaffeine.sourceforge.net/</span><br><span class="line">Source0:        kaffeine-0.4.3.tar.bz2</span><br><span class="line">Source1:        logo.png</span><br><span class="line">Source2:    icon.tgz</span><br><span class="line">Source3:        kaffeine.desktop</span><br><span class="line">Source4:        codecs.tgz</span><br><span class="line">Patch: kaffeine-0.4.3-fix-hide-crash.patch</span><br><span class="line">Patch1:kaffeine-0.4.3-without-wizard.patch</span><br><span class="line">BuildRoot:      /var/tmp/kaffeine-root</span><br><span class="line">%description</span><br><span class="line">Kaffeine is a xine based media player <span class="keyword">for</span> KDE3.</span><br></pre></td></tr></table></figure></p>
<p>核心部分：涉及到解包、补丁、编译、安装的过程,<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#要根据具体情况来写出编译过程</span></span><br><span class="line">%prep</span><br><span class="line">%setup -q</span><br><span class="line">%patch -p1</span><br><span class="line">%patch1 -p1</span><br><span class="line"></span><br><span class="line">%Build</span><br><span class="line">make -f admin/Makefile.common cvs</span><br><span class="line">./configure --prefix=/usr</span><br><span class="line">make</span><br><span class="line"><span class="comment">#for mo files</span></span><br><span class="line"><span class="built_in">pushd</span> po</span><br><span class="line">rm *.gmo</span><br><span class="line">make</span><br><span class="line"><span class="built_in">popd</span></span><br><span class="line"></span><br><span class="line">%install</span><br><span class="line">mkdir -p <span class="variable">$RPM_BUILD_ROOT</span></span><br><span class="line">make install DESTDIR=<span class="variable">$RPM_BUILD_ROOT</span></span><br><span class="line">mkdir -p <span class="variable">$RPM_BUILD_ROOT</span>/usr/share/services</span><br><span class="line">cp <span class="variable">$RPM_BUILD_ROOT</span>/usr/share/apps/kaffeine/mms.protocol <span class="variable">$RPM_BUILD_ROOT</span>/usr/share/services</span><br><span class="line">cp <span class="variable">$RPM_BUILD_ROOT</span>/usr/share/apps/kaffeine/rtsp.protocol <span class="variable">$RPM_BUILD_ROOT</span>/usr/share/services</span><br><span class="line"><span class="comment">#mkdir -p $RPM_BUILD_ROOT/usr/lib/firefox/plugins</span></span><br><span class="line"><span class="comment">#cp $RPM_BUILD_ROOT/usr/lib/kaffeineplugin/kaffeineplugin.so</span></span><br><span class="line"><span class="variable">$RPM_BUILD_ROOT</span>/usr/lib/firefox/plugins</span><br><span class="line">cp %&#123;SOURCE1&#125; <span class="variable">$RPM_BUILD_ROOT</span>/usr/share/apps/kaffeine</span><br><span class="line">rm -rf <span class="variable">$RPM_BUILD_ROOT</span>/usr/share/icons/hicolor/*/apps/kaffeine.png</span><br><span class="line">rm -rf <span class="variable">$RPM_BUILD_ROOT</span>/usr/share/icons/hicolor/*/apps/kaffeine-pause.png</span><br><span class="line">rm -rf <span class="variable">$RPM_BUILD_ROOT</span>/usr/share/icons/hicolor/*/apps/kaffeine-play.png</span><br><span class="line">rm -rf <span class="variable">$RPM_BUILD_ROOT</span>/usr/share/icons/hicolor/*/apps/kaffeine-record.png</span><br><span class="line">mkdir -p <span class="variable">$RPM_BUILD_ROOT</span>/usr/share/icons/crystalsvg</span><br><span class="line">tar zxvf %&#123;SOURCE2&#125; -C <span class="variable">$RPM_BUILD_ROOT</span>/usr/share/icons/crystalsvg</span><br><span class="line">mkdir -p <span class="variable">$RPM_BUILD_ROOT</span>/usr/share/applnk/App/Multimedia</span><br><span class="line">cp -r %&#123;SOURCE3&#125; <span class="variable">$RPM_BUILD_ROOT</span>/usr/share/applnk/App/Multimedia</span><br><span class="line">mkdir -p <span class="variable">$RPM_BUILD_ROOT</span>/usr/lib/win32</span><br><span class="line">tar zxvf %&#123;SOURCE4&#125; -C <span class="variable">$RPM_BUILD_ROOT</span>/usr/lib/win32</span><br><span class="line"></span><br><span class="line">%clean</span><br><span class="line">rm -rf <span class="variable">$RPM_BUILD_ROOT</span></span><br><span class="line"></span><br><span class="line">%post</span><br><span class="line">ln -s /dev/cdrom /dev/dvd</span><br><span class="line">ln -s /dev/cdrom /dev/rdvd</span><br><span class="line"></span><br><span class="line">%files</span><br><span class="line">%defattr(-,root,root)</span><br><span class="line">/usr</span><br><span class="line"></span><br><span class="line"><span class="comment">#spec文件的最后内容了它对团队软件开发以及后续的软件维护至关重要</span></span><br><span class="line">%changelog</span><br><span class="line">* Fri Jul 1  2005 AiLin Yang &lt;alyang@redflag-linux.com&gt; -0.4.3-25</span><br><span class="line">- modified the fullscreen bottom control panel</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="2-实际案例"><a href="#2-实际案例" class="headerlink" title="2. 实际案例"></a>2. 实际案例</h5><p><strong>CentOS下使用rpm-build制作nginx的RPM包</strong><br>制作流程步骤：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#STEP1.下载需要的打包的nginx源码包建立文件</span></span><br><span class="line">wget http://nginx.org/download/nginx-1.16.0.tar.gz</span><br><span class="line">cp nginx-1.16.0.tar.gz rpmbuild/SOURCES/</span><br><span class="line">touch fastcgi_params init.nginx nginx.conf</span><br></pre></td></tr></table></figure></p>
<p>step2.编辑init.nginx<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#nginx在主配置文件里面做了很多优化，包括cpu抢占，各种缓存策略，tcp，进程数等。</span></span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># nginx - this script starts and stops the nginx daemon</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># chkconfig:   - 85 15</span></span><br><span class="line"><span class="comment"># description:  Nginx is an HTTP(S) server, HTTP(S) reverse \</span></span><br><span class="line"><span class="comment">#               proxy and IMAP/POP3 proxy server</span></span><br><span class="line"><span class="comment"># processname: nginx</span></span><br><span class="line"><span class="comment">## config:      /etc/nginx/nginx.conf</span></span><br><span class="line"><span class="comment"># config:      /usr/local/nginx/conf/nginx.conf</span></span><br><span class="line"><span class="comment"># config:      /etc/sysconfig/nginx</span></span><br><span class="line"><span class="comment">## pidfile:     /var/run/nginx/nginx.pid</span></span><br><span class="line"><span class="comment"># pidfile:     /usr/local/nginx/logs/nginx.pid</span></span><br><span class="line"><span class="comment"># Source function library.</span></span><br><span class="line">. /etc/rc.d/init.d/<span class="built_in">functions</span></span><br><span class="line"><span class="comment"># Source networking configuration.</span></span><br><span class="line">. /etc/sysconfig/network</span><br><span class="line"><span class="comment"># Check that networking is up.</span></span><br><span class="line">[ <span class="string">"<span class="variable">$NETWORKING</span>"</span> = <span class="string">"no"</span> ] &amp;&amp; <span class="built_in">exit</span> 0</span><br><span class="line">nginx=<span class="string">"/usr/local/nginx/sbin/nginx"</span></span><br><span class="line">prog=$(basename <span class="variable">$nginx</span>)</span><br><span class="line"><span class="comment">#NGINX_CONF_FILE="/etc/nginx/nginx.conf"</span></span><br><span class="line">NGINX_CONF_FILE=<span class="string">"/usr/local/nginx/conf/nginx.conf"</span></span><br><span class="line">[ -f /etc/sysconfig/nginx ] &amp;&amp; . /etc/sysconfig/nginx</span><br><span class="line">lockfile=/var/lock/subsys/nginx</span><br><span class="line"><span class="function"><span class="title">make_dirs</span></span>() &#123;</span><br><span class="line">   <span class="comment"># make required directories</span></span><br><span class="line">   user=`nginx -V 2&gt;&amp;1 | grep <span class="string">"configure arguments:"</span> | sed <span class="string">'s/[^*]*--user=\([^ ]*\).*/\1/g'</span> -`</span><br><span class="line">   options=`<span class="variable">$nginx</span> -V 2&gt;&amp;1 | grep <span class="string">'configure arguments:'</span>`</span><br><span class="line">   <span class="keyword">for</span> opt <span class="keyword">in</span> <span class="variable">$options</span>; <span class="keyword">do</span></span><br><span class="line">       <span class="keyword">if</span> [ `<span class="built_in">echo</span> <span class="variable">$opt</span> | grep <span class="string">'.*-temp-path'</span>` ]; <span class="keyword">then</span></span><br><span class="line">           value=`<span class="built_in">echo</span> <span class="variable">$opt</span> | cut -d <span class="string">"="</span> -f 2`</span><br><span class="line">           <span class="keyword">if</span> [ ! -d <span class="string">"<span class="variable">$value</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">               <span class="comment"># echo "creating" $value</span></span><br><span class="line">               mkdir -p <span class="variable">$value</span> &amp;&amp; chown -R <span class="variable">$user</span> <span class="variable">$value</span></span><br><span class="line">           <span class="keyword">fi</span></span><br><span class="line">       <span class="keyword">fi</span></span><br><span class="line">   <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">start</span></span>() &#123;</span><br><span class="line">    [ -x <span class="variable">$nginx</span> ] || <span class="built_in">exit</span> 5</span><br><span class="line">    [ -f <span class="variable">$NGINX_CONF_FILE</span> ] || <span class="built_in">exit</span> 6</span><br><span class="line">    make_dirs</span><br><span class="line">    <span class="built_in">echo</span> -n $<span class="string">"Starting <span class="variable">$prog</span>: "</span></span><br><span class="line">    daemon <span class="variable">$nginx</span> -c <span class="variable">$NGINX_CONF_FILE</span></span><br><span class="line">    retval=$?</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    [ <span class="variable">$retval</span> -eq 0 ] &amp;&amp; touch <span class="variable">$lockfile</span></span><br><span class="line">    <span class="built_in">return</span> <span class="variable">$retval</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">stop</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> -n $<span class="string">"Stopping <span class="variable">$prog</span>: "</span></span><br><span class="line">    killproc <span class="variable">$prog</span> -QUIT</span><br><span class="line">    retval=$?</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    [ <span class="variable">$retval</span> -eq 0 ] &amp;&amp; rm -f <span class="variable">$lockfile</span></span><br><span class="line">    <span class="built_in">return</span> <span class="variable">$retval</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">restart</span></span>() &#123;</span><br><span class="line">    configtest || <span class="built_in">return</span> $?</span><br><span class="line">    stop</span><br><span class="line">    sleep 1</span><br><span class="line">    start</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">reload</span></span>() &#123;</span><br><span class="line">    configtest || <span class="built_in">return</span> $?</span><br><span class="line">    <span class="built_in">echo</span> -n $<span class="string">"Reloading <span class="variable">$prog</span>: "</span></span><br><span class="line">    killproc <span class="variable">$nginx</span> -HUP</span><br><span class="line">    RETVAL=$?</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">force_reload</span></span>() &#123;</span><br><span class="line">    restart</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">configtest</span></span>() &#123;</span><br><span class="line">  <span class="variable">$nginx</span> -t -c <span class="variable">$NGINX_CONF_FILE</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">rh_status</span></span>() &#123;</span><br><span class="line">    status <span class="variable">$prog</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">rh_status_q</span></span>() &#123;</span><br><span class="line">    rh_status &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">    start)</span><br><span class="line">        rh_status_q &amp;&amp; <span class="built_in">exit</span> 0</span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        rh_status_q || <span class="built_in">exit</span> 0</span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    restart|configtest)</span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    reload)</span><br><span class="line">        rh_status_q || <span class="built_in">exit</span> 7</span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    force-reload)</span><br><span class="line">        force_reload</span><br><span class="line">        ;;</span><br><span class="line">    status)</span><br><span class="line">        rh_status</span><br><span class="line">        ;;</span><br><span class="line">    condrestart|try-restart)</span><br><span class="line">        rh_status_q || <span class="built_in">exit</span> 0</span><br><span class="line">            ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> $<span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest&#125;"</span></span><br><span class="line">        <span class="built_in">exit</span> 2</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure></p>
<p>step3.fastcgi_params参数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fastcgi_param  GATEWAY_INTERFACE  CGI/1.1;</span><br><span class="line">fastcgi_param  SERVER_SOFTWARE    nginx;</span><br><span class="line">fastcgi_param  QUERY_STRING       <span class="variable">$query_string</span>;</span><br><span class="line">fastcgi_param  REQUEST_METHOD     <span class="variable">$request_method</span>;</span><br><span class="line">fastcgi_param  CONTENT_TYPE       <span class="variable">$content_type</span>;</span><br><span class="line">fastcgi_param  CONTENT_LENGTH     <span class="variable">$content_length</span>;</span><br><span class="line">fastcgi_param  SCRIPT_FILENAME    <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">fastcgi_param  SCRIPT_NAME        <span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">fastcgi_param  REQUEST_URI        <span class="variable">$request_uri</span>;</span><br><span class="line">fastcgi_param  DOCUMENT_URI       <span class="variable">$document_uri</span>;</span><br><span class="line">fastcgi_param  DOCUMENT_ROOT      <span class="variable">$document_root</span>;</span><br><span class="line">fastcgi_param  SERVER_PROTOCOL    <span class="variable">$server_protocol</span>;</span><br><span class="line">fastcgi_param  REMOTE_ADDR        <span class="variable">$remote_addr</span>;</span><br><span class="line">fastcgi_param  REMOTE_PORT        <span class="variable">$remote_port</span>;</span><br><span class="line">fastcgi_param  SERVER_ADDR        <span class="variable">$server_addr</span>;</span><br><span class="line">fastcgi_param  SERVER_PORT        <span class="variable">$server_port</span>;</span><br><span class="line">fastcgi_param  SERVER_NAME        <span class="variable">$server_name</span>;</span><br></pre></td></tr></table></figure></p>
<p>Step4.编辑sepc文件进行RPM包基本配置（重重之中-注意备注里面不能带有%+关键字）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Section1.rpm包描述部分(可做变量)</span></span><br><span class="line">Name: nginx</span><br><span class="line"><span class="comment"># 版本号，（不能使用-）</span></span><br><span class="line">Version: 1.16.0</span><br><span class="line"><span class="comment"># release号，对应下面的changelog，如 nginx-1.7.7-1.el6.x86_64.rpm</span></span><br><span class="line">Release: 1%&#123;?dist&#125;</span><br><span class="line"><span class="comment"># 简要描述信息</span></span><br><span class="line">Summary: nginx Porxy http server</span><br><span class="line"><span class="comment"># less /usr/share/doc/rpm-4.11.3/GROUPS 按照这个组里面进行填写</span></span><br><span class="line">Group: Applications/Archiving</span><br><span class="line"><span class="comment">#一定带上（最好是对方源码包的License）BSD，GPL，GPLv2</span></span><br><span class="line">License: GPLv2</span><br><span class="line">URL: http://weiyigeek.github.io</span><br><span class="line"><span class="comment">#作者信息</span></span><br><span class="line">Packager: weiyigeek &lt;weiyigeek@qq.com&gt;</span><br><span class="line"><span class="comment"># source主要是引用一下自己定义好的脚本，配置文件之类的内容。（及当前在SOURCE目录种的文件）</span></span><br><span class="line">Source0: %&#123;name&#125;-%&#123;version&#125;.tar.gz</span><br><span class="line"><span class="comment"># 每增加一个 Source ，都需要在 install 段和 files 段做相应配置，如果是启动脚本的话，最好在脚本段配置一下</span></span><br><span class="line">Source1: init.nginx</span><br><span class="line"><span class="comment">#Source2: nginx.conf</span></span><br><span class="line">Source2: fastcgi_params</span><br><span class="line"><span class="comment">#构建目录</span></span><br><span class="line">BuildRoot: %_topdir/BUILDROOT</span><br><span class="line"><span class="comment">#构建依赖</span></span><br><span class="line">BuildRequires: gcc</span><br><span class="line"><span class="comment">#定义nginx依赖的包，需要yum安装</span></span><br><span class="line">Requires: openssl,openssl-devel,pcre-devel,pcre</span><br><span class="line"></span><br><span class="line"><span class="comment"># 软件包详述</span></span><br><span class="line">%description</span><br><span class="line">Custom a rpm by yourself!Build nginx-1.16.0.tar.gz to nginx-1.16.0.rpm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Section2.准备阶段,主要就是把源码包解压到build目录下，设置一下环境变量，并cd进去</span></span><br><span class="line">%prep</span><br><span class="line"><span class="comment"># 这个宏的作用静默模式解压并cd</span></span><br><span class="line">%setup -q</span><br><span class="line"></span><br><span class="line"><span class="comment">### Section3. 编译制作阶段，这一节主要用于编译源码（重要）</span></span><br><span class="line"><span class="comment">#在 RMP 创建时候, 由于 nginx 不按照常规定义, 不可以定义 &#123;_prefix&#125; 之类参数, 也不可以使用conf 这个参数进行 rpm 编译</span></span><br><span class="line"><span class="comment">#一旦定义该参数, 会导致编译自动增加下面参数, 导致报错</span></span><br><span class="line"><span class="comment"># + ./configure --build=x86_64-redhat-linux-gnu --host=x86_64-redhat-linux-gnu --target=x86_64-redhat-linux-gnu --program-prefix=</span></span><br><span class="line"><span class="comment">#因此，这里需要 ./configure，且需把configure删掉</span></span><br><span class="line"></span><br><span class="line">%build</span><br><span class="line">./configure \</span><br><span class="line">--prefix=/usr/<span class="built_in">local</span>/nginx \</span><br><span class="line">--user=nginx \</span><br><span class="line">--group=nginx \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--with-pcre</span><br><span class="line"></span><br><span class="line"><span class="comment">#多处理器的话make时并行编译</span></span><br><span class="line">make %&#123;?_smp_mflags&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### Section4.主要用于完成实际安装软件必须执行的命令，可包含4种类型脚本</span></span><br><span class="line"></span><br><span class="line">%install</span><br><span class="line">rm -rf %&#123;buildroot&#125;</span><br><span class="line">make install DESTDIR=%&#123;buildroot&#125;</span><br><span class="line">%&#123;__install&#125; -p -D -m 0755 %&#123;SOURCE1&#125; %&#123;buildroot&#125;/etc/rc.d/init.d/nginx</span><br><span class="line"><span class="comment">#%&#123;__install&#125; -p -D %&#123;SOURCE2&#125; %&#123;buildroot&#125;/usr/local/nginx/conf/nginx.conf</span></span><br><span class="line">%&#123;__install&#125; -p -D %&#123;SOURCE2&#125; %&#123;buildroot&#125;/usr/<span class="built_in">local</span>/nginx/conf/fastcgi_params</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># $1有3个值，代表动作，安装类型，处理类型</span></span><br><span class="line"><span class="comment"># 1：表示安装 、2：表示升级 、 0：表示卸载</span></span><br><span class="line">%pre</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$1</span> == 1 ];<span class="keyword">then</span></span><br><span class="line">    /usr/sbin/useradd -M nginx -s /sbin/nologin 2&gt; /dev/null</span><br><span class="line">    ln -s /usr/<span class="built_in">local</span>/nginx/sbin/nginx /usr/bin/nginx 2&gt; /dev/null</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># post</span></span><br><span class="line"><span class="comment"># if [ $1 == 1 ];then</span></span><br><span class="line"><span class="comment">#    /usr/sbin/useradd -M nginx -s /sbin/nologin 2&gt; /dev/null</span></span><br><span class="line"><span class="comment">#    ln -s /usr/local/nginx/sbin/nginx /usr/bin/nginx 2&gt; /dev/null</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line"></span><br><span class="line">%preun</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$1</span> == 0 ];<span class="keyword">then</span></span><br><span class="line">        /usr/sbin/userdel -r nginx 2&gt; /dev/null</span><br><span class="line">        /usr/bin/rm -rf /usr/bin/nginx</span><br><span class="line">        systemctl daemon-reload</span><br><span class="line">        /etc/init.d/nginx stop &gt; /dev/null 2&gt;&amp;1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">%postun</span><br><span class="line"></span><br><span class="line"><span class="comment">#Section5. clean section 清理段,clean的主要作用就是删除BUILD</span></span><br><span class="line">%clean</span><br><span class="line">rm -rf %&#123;buildroot&#125;</span><br><span class="line">rm -rf /var/tmp/rpm-tmp.*</span><br><span class="line"></span><br><span class="line"><span class="comment">#section6. file section 文件列表段，这个阶段是把前面已经编译好的内容要打包了,其中exclude是指要排除什么不打包进来。</span></span><br><span class="line">%files</span><br><span class="line">%defattr(-,root,root,0755)</span><br><span class="line">/usr/<span class="built_in">local</span>/nginx/</span><br><span class="line">%attr(0755,root,root) /etc/rc.d/init.d/nginx</span><br><span class="line">%config(noreplace) /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br><span class="line">%config(noreplace) /usr/<span class="built_in">local</span>/nginx/conf/fastcgi_params</span><br><span class="line"></span><br><span class="line">%doc</span><br><span class="line"></span><br><span class="line"><span class="comment">#section 7 .chagelog section日志改变段， 这一段主要描述软件的开发记录 (需要非常注意格式)</span></span><br><span class="line"><span class="comment">#日期时间注意简写</span></span><br><span class="line">%changelog</span><br><span class="line">* Wed Jun 19 2019 weiyigeek &lt;weiyigeek@qq.com&gt; - 1.16.0-1</span><br><span class="line">- Initial version and rpm Build</span><br></pre></td></tr></table></figure></p>
<p><em>Step5.rpm打包编译流程开始演示</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#制作到%prep段</span></span><br><span class="line"><span class="variable">$rpmbuild</span> -bp nginx.spec</span><br><span class="line">执行(%prep): /bin/sh -e /var/tmp/rpm-tmp.LdMAUu</span><br><span class="line">+ <span class="built_in">umask</span> 022</span><br><span class="line">+ <span class="built_in">cd</span> /root/rpmbuild/BUILD</span><br><span class="line">+ <span class="built_in">cd</span> /root/rpmbuild/BUILD</span><br><span class="line">+ rm -rf nginx-1.16.0</span><br><span class="line">+ /usr/bin/gzip -dc /root/rpmbuild/SOURCES/nginx-1.16.0.tar.gz</span><br><span class="line">+ /usr/bin/tar -xf -</span><br><span class="line">+ STATUS=0</span><br><span class="line">+ <span class="string">'['</span> 0 -ne 0 <span class="string">']'</span></span><br><span class="line">+ <span class="built_in">cd</span> nginx-1.16.0</span><br><span class="line">+ /usr/bin/chmod -Rf a+rX,u+w,g-w,o-w .</span><br><span class="line">+ <span class="built_in">exit</span> 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#制作到%build段</span></span><br><span class="line"><span class="variable">$rpmbuild</span> -bc nginx.spec</span><br><span class="line">sed -e <span class="string">"s|%%PREFIX%%|/usr/local/nginx|"</span> \</span><br><span class="line">        -e <span class="string">"s|%%PID_PATH%%|/usr/local/nginx/logs/nginx.pid|"</span> \</span><br><span class="line">        -e <span class="string">"s|%%CONF_PATH%%|/usr/local/nginx/conf/nginx.conf|"</span> \</span><br><span class="line">        -e <span class="string">"s|%%ERROR_LOG_PATH%%|/usr/local/nginx/logs/error.log|"</span> \</span><br><span class="line">        &lt; man/nginx.8 &gt; objs/nginx.8</span><br><span class="line">make[1]: Leaving directory `/root/rpmbuild/BUILD/nginx-1.16.0<span class="string">'</span></span><br><span class="line"><span class="string">+ exit 0</span></span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=rpm 快速入门与基础 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190618170538.png" target="_blank" title="WeiyiGeek.build" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190618170538.png" alt="WeiyiGeek.build" title="" class=""></a>
                <p>WeiyiGeek.build</p>
            </figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#执行 spec 文件的 "%install" 阶段 (在执行了 %prep 和 %build 阶段之后)。等价于执行 "make install"</span></span><br><span class="line"><span class="variable">$rpmbuild</span> -bi nginx.spec</span><br><span class="line">处理文件：nginx-debuginfo-1.16.0-1.el7.x86_64</span><br><span class="line">Provides: nginx-debuginfo = 1.16.0-1.el7 nginx-debuginfo(x86-64) = 1.16.0-1.el7</span><br><span class="line">Requires(rpmlib): rpmlib(FileDigests) &lt;= 4.6.0-1 rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1 rpmlib(CompressedFileNames) &lt;= 3.0.4-1</span><br><span class="line">检查未打包文件：/usr/lib/rpm/check-files /root/rpmbuild/BUILDROOT/nginx-1.16.0-1.el7.x86_64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#rpmbuild -bb nginx.spec 制作二进制包</span></span><br><span class="line"><span class="variable">$rpmbuild</span> -ba nginx.spec <span class="comment">#表示既制作二进制包又制作src格式包</span></span><br><span class="line">检查未打包文件：/usr/lib/rpm/check-files /root/rpmbuild/BUILDROOT/nginx-1.16.0-1.el7.x86_64</span><br><span class="line">写道:/root/rpmbuild/RPMS/x86_64/nginx-1.16.0-1.el7.x86_64.rpm</span><br><span class="line">写道:/root/rpmbuild/RPMS/x86_64/nginx-debuginfo-1.16.0-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="variable">$ll</span> /root/rpmbuild/SRPMS/nginx-1.16.0-1.el7.src.rpm  <span class="comment">#src包</span></span><br><span class="line">-rw-r--r-- 1 root root 1037470 6月  20 09:08 /root/rpmbuild/SRPMS/nginx-1.16.0-1.el7.src.rpm</span><br><span class="line"><span class="variable">$ll</span> /root/rpmbuild/RPMS/x86_64/nginx-1.16.0-1.el7.x86_64.rpm <span class="comment">#二进制包</span></span><br><span class="line">-rw-r--r-- 1 root root 312800 6月  20 09:08 /root/rpmbuild/RPMS/x86_64/nginx-1.16.0-1.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>
<p>Step6.rpm打包成功查看打包信息<br>进入 /home/urpm/rpmbuild/RPMS/x86_64 后进行执行 rpm -qpi nginx-1.16.0-1.el7.x86_64.rpm 来查询信息：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">rpm -qip /root/rpmbuild/RPMS/x86_64/nginx-1.16.0-1.el7.x86_64.rpm</span><br><span class="line">Name        : nginx</span><br><span class="line">Version     : 1.16.0</span><br><span class="line">Release     : 1.el7</span><br><span class="line">Architecture: x86_64</span><br><span class="line">Install Date: (not installed)</span><br><span class="line">Group       : Applications/Archiving</span><br><span class="line">Size        : 849363</span><br><span class="line">License     : GPLv2</span><br><span class="line">Signature   : RSA/SHA1, 2019年06月19日 星期三 13时16分30秒, Key ID 4a8eba8dd59c7bb6 <span class="comment">#GPG签名</span></span><br><span class="line">Source RPM  : nginx-1.16.0-1.el7.src.rpm</span><br><span class="line">Build Date  : 2019年06月19日 星期三 13时08分12秒</span><br><span class="line">Build Host  : master</span><br><span class="line">Relocations : (not relocatable)</span><br><span class="line">Packager    : weiyigeek &lt;weiyigeek@qq.com&gt;</span><br><span class="line">URL         : http://weiyigeek.github.io</span><br><span class="line">Summary     : nginx Porxy http server</span><br><span class="line">Description :</span><br><span class="line">Custom a rpm by yourself!Build nginx-1.16.0.tar.gz to nginx-1.16.0.rpm</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=rpm 快速入门与基础 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190618171652.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190618171652.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure></p>
<p>Step7.为我们打包的rpm进行gpg签名<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用gpg方式生成签名密钥</span></span><br><span class="line"><span class="variable">$gpg</span> --gen-key</span><br><span class="line">gpg: 已创建目录‘/root/.gnupg’</span><br><span class="line">gpg: 新的配置文件‘/root/.gnupg/gpg.conf’已建立</span><br><span class="line">gpg: 警告：在‘/root/.gnupg/gpg.conf’里的选项于此次运行期间未被使用</span><br><span class="line">gpg: 钥匙环‘/root/.gnupg/secring.gpg’已建立</span><br><span class="line">gpg: 钥匙环‘/root/.gnupg/pubring.gpg’已建立</span><br><span class="line">请选择您要使用的密钥种类：</span><br><span class="line">   (1) RSA and RSA (default)</span><br><span class="line">   (2) DSA and Elgamal</span><br><span class="line">   (3) DSA (仅用于签名)</span><br><span class="line">   (4) RSA (仅用于签名)</span><br><span class="line">您的选择？ 1</span><br><span class="line">RSA 密钥长度应在 1024 位与 4096 位之间。</span><br><span class="line">您想要用多大的密钥尺寸？(2048)1024</span><br><span class="line">您所要求的密钥尺寸是 1024 位</span><br><span class="line">请设定这把密钥的有效期限。</span><br><span class="line">         0 = 密钥永不过期</span><br><span class="line">      &lt;n&gt;  = 密钥在 n 天后过期</span><br><span class="line">      &lt;n&gt;w = 密钥在 n 周后过期</span><br><span class="line">      &lt;n&gt;m = 密钥在 n 月后过期</span><br><span class="line">      &lt;n&gt;y = 密钥在 n 年后过期</span><br><span class="line">密钥的有效期限是？(0) 1y</span><br><span class="line">密钥于 2020年06月18日 星期四 12时45分15秒 CST 过期</span><br><span class="line">以上正确吗？(y/n)y</span><br><span class="line">ter) &lt;heinrichh@duesseldorf.de&gt;</span><br><span class="line">真实姓名：weiyigeek</span><br><span class="line">电子邮件地址：weiyigeek@qq.com</span><br><span class="line">注释：Weiyigeek</span><br><span class="line">您选定了这个用户标识：</span><br><span class="line">    “weiyigeek (Weiyigeek) &lt;weiyigeek@qq.com&gt;”</span><br><span class="line">更改姓名(N)、注释(C)、电子邮件地址(E)或确定(O)/退出(Q)？0</span><br><span class="line">输入密匙密码： &lt;ENTER&gt;</span><br><span class="line">&lt;Take this one anyway&gt; &lt;Enter&gt; <span class="comment">#确认使用此密码</span></span><br><span class="line"></span><br><span class="line">在生成密钥的时候，会报这么一个信息：can<span class="string">'t connect to `/root/.gnupg/S.gpg-agent'</span>: No such file or directory，可以不用理会它。</span><br><span class="line"><span class="comment"># 接下来就是一些随机数的说明了：We need to generate a lot of random bytes. It is a good idea to performsome other action (type on the keyboard, move the mouse, utilize thedisks) during the prime generation; this gives the random numbergenerator a better chance to gain enough entropy.</span></span><br><span class="line"><span class="comment"># 就狂敲键盘和移动鼠标吧，也可以链接一个伪随机数（不过不安全）不是得话会卡，接下来的活儿就是等了</span></span><br><span class="line"><span class="variable">$ngd</span> -r /dev/urandom   <span class="comment">#新建立终端执行</span></span><br><span class="line"><span class="comment"># Initalizing available sources</span></span><br><span class="line"><span class="comment"># Enabling RDRAND rng support</span></span><br><span class="line"><span class="comment"># Enabling JITTER rng support</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成密钥后会是这样的：</span></span><br><span class="line">gpg: /root/.gnupg/trustdb.gpg：建立了信任度数据库</span><br><span class="line">gpg: 密钥 D59C7BB6 被标记为绝对信任</span><br><span class="line">公钥和私钥已经生成并经签名。</span><br><span class="line"></span><br><span class="line">gpg: 正在检查信任度数据库</span><br><span class="line">gpg: 需要 3 份勉强信任和 1 份完全信任，PGP 信任模型</span><br><span class="line">gpg: 深度：0 有效性：  1 已签名：  0 信任度：0-，0q，0n，0m，0f，1u</span><br><span class="line">gpg: 下次信任度数据库检查将于 2020-06-18 进行</span><br><span class="line">pub   1024R/D59C7BB6 2019-06-19 [有效至：2020-06-18]</span><br><span class="line">密钥指纹 = 3C01 50EE C61A 3B1F CC55  63C1 4A8E BA8D D59C 7BB6</span><br><span class="line">uid                  weiyigeek (<span class="built_in">test</span>) &lt;weiyigeek@qq.com&gt;</span><br><span class="line">sub   1024R/30AC729C 2019-06-19 [有效至：2020-06-18]</span><br></pre></td></tr></table></figure></p>
<p>查看生成的密钥:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$gpg</span> --list-keys</span><br><span class="line">/root/.gnupg/pubring.gpg</span><br><span class="line">------------------------</span><br><span class="line">pub   1024R/D59C7BB6 2019-06-19 [有效至：2020-06-18]</span><br><span class="line">uid                  weiyigeek (<span class="built_in">test</span>) &lt;weiyigeek@qq.com&gt;</span><br><span class="line">sub   1024R/30AC729C 2019-06-19 [有效至：2020-06-18]</span><br><span class="line"></span><br><span class="line"><span class="comment">#导出公钥以供验证</span></span><br><span class="line"><span class="variable">$gpg</span> --<span class="built_in">export</span> -a <span class="string">"weiyigeek"</span> &gt; RPM-GPG-KEY-weiyigeek</span><br><span class="line"></span><br><span class="line"><span class="comment">#在~/.rpmmacros宏中定义加密密钥</span></span><br><span class="line"><span class="variable">$vim</span> ~/.rpmmacros</span><br><span class="line">%_gpg_name weiyigeek</span><br><span class="line"></span><br><span class="line"><span class="comment">#为rpm包签名（centos需要进行安装）</span></span><br><span class="line"><span class="variable">$rpm</span> --resign /root/rpmbuild/RPMS/x86_64/nginx-1.16.0-1.el7.x86_64.rpm</span><br><span class="line">输入密码、密码正确。</span><br><span class="line">/root/rpmbuild/RPMS/x86_64/nginx-1.16.0-1.el7.x86_64.rpm:</span><br><span class="line"></span><br><span class="line"><span class="comment">#将公钥导入rpm包</span></span><br><span class="line"><span class="variable">$rpm</span> --import RPM-GPG-KEY-weiyigeek</span><br><span class="line"></span><br><span class="line"><span class="comment">#验证打包信息</span></span><br><span class="line"><span class="variable">$rpm</span> --checksig /root/rpmbuild/RPMS/x86_64/nginx-1.16.0-1.el7.x86_64.rpm</span><br><span class="line"><span class="variable">$rpm</span> -K /root/rpmbuild/RPMS/x86_64/nginx-1.16.0-1.el7.x86_64.rpm</span><br><span class="line">/root/rpmbuild/RPMS/x86_64/nginx-1.16.0-1.el7.x86_64.rpm: rsa sha1 (md5) pgp md5 确定 (发现gpg)</span><br></pre></td></tr></table></figure></p>
<p>重新安装nginx，验证安装包的签名信息：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$rpm</span> -ivh /root/rpmbuild/RPMS/x86_64/nginx-1.16.0-1.el7.x86_64.rpm</span><br><span class="line">Preparing...                <span class="comment">########################################### [100%]</span></span><br><span class="line">   1:nginx                  <span class="comment">########################################### [100%]</span></span><br><span class="line"><span class="variable">$rpm</span> -qi nginx</span><br><span class="line">Install Date: 2019年06月19日 星期三 17时18分26秒</span><br></pre></td></tr></table></figure></p>
<p>yum仓库下载安装我们打包的rpm包：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">nginx -v</span><br><span class="line">nginx version: nginx/1.16.0</span><br><span class="line">[root@slave yum.repos.d]<span class="comment"># rpm -qi nginx</span></span><br><span class="line">Name        : nginx</span><br><span class="line">Version     : 1.16.0</span><br><span class="line">Release     : 1.el7</span><br><span class="line">Architecture: x86_64</span><br><span class="line">Install Date: 2019年06月20日 星期四 11时47分09秒</span><br><span class="line">Group       : Applications/Archiving</span><br><span class="line">Size        : 849363</span><br><span class="line">License     : GPLv2</span><br><span class="line">Signature   : (none)</span><br><span class="line">Source RPM  : nginx-1.16.0-1.el7.src.rpm</span><br><span class="line">Build Date  : 2019年06月20日 星期四 11时35分30秒</span><br><span class="line">Build Host  : master</span><br><span class="line">Relocations : (not relocatable)</span><br><span class="line">Packager    : weiyigeek &lt;weiyigeek@qq.com&gt;</span><br><span class="line">URL         : http://weiyigeek.github.io</span><br><span class="line">Summary     : nginx Porxy http server</span><br><span class="line">Description :</span><br><span class="line">Custom a rpm by yourself!Build nginx-1.16.0.tar.gz to nginx-1.16.0.rpm</span><br></pre></td></tr></table></figure></p>
<p>之后直接采用nginx搭建yum仓库提供局域网内其他机器使用：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Nginx开启文件目录列表显示功能（修改后重启）</span></span><br><span class="line"><span class="variable">$vi</span> /application/nginx/conf/nginx.conf</span><br><span class="line"><span class="comment">#编辑nginx配置文件，在标签内添加如下代码：</span></span><br><span class="line">    autoindex on; <span class="comment"># #开启目录显示功能</span></span><br><span class="line">    autoindex_exact_size off;  <span class="comment"># #关闭详细文件大小统计，默认为b，以kb、mb、gb为单位显示</span></span><br><span class="line">    autoindex_localtime on;  <span class="comment">#开启以服务器时区显示文件修改日期</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#2创建该特殊源的yum数据库和信息索引文件</span></span><br><span class="line"><span class="variable">$createrepo</span> ./</span><br><span class="line"><span class="variable">$tree</span> repodata/</span><br><span class="line">repodata/</span><br><span class="line"><span class="comment"># ├── 60ae28c87acae0eefa0d894f6aef0b1f0b569047d9f1110dd14b8ef4e2aa914e-primary.xml.gz</span></span><br><span class="line"><span class="comment"># ├── 634eb9924cb82ef60d8d35efa8fbce4753ce0b817087989c9db2c12edd23a8ed-primary.sqlite.bz2</span></span><br><span class="line"><span class="comment"># ├── 7fe38e87e6c5b128601021f9a6bfd10fb8d61878ec91210525950440d477af08-other.xml.gz</span></span><br><span class="line"><span class="comment"># ├── 9863ec6f3ceda9f644d9647f754f6a8733139653a810a273ad4119f5879fcf2b-filelists.xml.gz</span></span><br><span class="line"><span class="comment"># ├── a499a68e3f1b3bf8837e766d061e8842d06900d48d6f6ec2e71e8e6ba44a5895-other.sqlite.bz2</span></span><br><span class="line"><span class="comment"># ├── d60debca85472e396ed5155f78a1cc75e9a3f903db2a574d4c8ce10afa03b977-filelists.sqlite.bz2</span></span><br><span class="line"><span class="comment"># └── repomd.xml</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#3. 现在我们访问下该目录，看看能不能正常显示我们创建的目录，如下：</span></span><br><span class="line">wget http://192.168.1.247</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=rpm 快速入门与基础 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190620114712.png" target="_blank" title="WeiyiGeek.yum仓库" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190620114712.png" alt="WeiyiGeek.yum仓库" title="" class=""></a>
                <p>WeiyiGeek.yum仓库</p>
            </figure></p>
<p><br></p>
<h5 id="3-FPM打包工具入门使用"><a href="#3-FPM打包工具入门使用" class="headerlink" title="3. FPM打包工具入门使用"></a>3. FPM打包工具入门使用</h5><p>安装环境：CentOS Linux release 7.6.1810 (Core)  3.10.0-957.12.2.el7.x86_64<br>FPM的作者是:jordansissel ,功能简单说就是将一种类型的包转换成另一种类型。<br>FPM的github：<a href="https://github.com/jordansissel/fpm" target="_blank" rel="noopener">https://github.com/jordansissel/fpm</a> </p>
<p><em>1.FPM主要特点</em>：</p>
<ul>
<li>支持的源类型包：<ul>
<li>dir         将目录打包成所需要的类型，可以用于源码编译安装的软件包</li>
<li>rpm         对rpm进行转换</li>
<li>gem         对rubygem包进行转换</li>
<li>python      将python模块打包成相应的类型</li>
</ul>
</li>
<li>支持的目标类型包: 转换为rpm包 / 转换为deb包 / 转换为solaris包 / 转换为puppet模块</li>
</ul>
<p><br></p>
<p><em>2.FPM参数和用法</em>：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-s          指定源类型</span><br><span class="line">-t          指定目标类型，即想要制作为什么包</span><br><span class="line">-n          指定包的名字</span><br><span class="line">-v          指定包的版本号</span><br><span class="line">-C          指定打包的相对路径（在搜索文件之前，将目录更改为这里）</span><br><span class="line">-d          指定依赖于哪些包</span><br><span class="line">-f          第二次打包时目录下如果有同名安装包存在，则覆盖它</span><br><span class="line">-p          输出的安装包的目录，不想放在当前目录下就需要指定</span><br><span class="line">--post-install      软件包安装完成之后所要运行的脚本；同--after-install</span><br><span class="line">--pre-install       软件包安装完成之前所要运行的脚本；同--before-install</span><br><span class="line">--post-uninstall    软件包卸载完成之后所要运行的脚本；同--after-remove</span><br><span class="line">--pre-uninstall     软件包卸载完成之前所要运行的脚本；同--before-remove</span><br></pre></td></tr></table></figure></p>
<p><em>3.安装FPM工具</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">fpm 是 ruby 写的，因此系统环境需要 ruby且 ruby 版本号大于 1.8.5。</span><br><span class="line"><span class="comment"># 安装 ruby 模块</span></span><br><span class="line">yum -y install ruby ruby-devel rubygems</span><br><span class="line">rpm -qa ruby rubygems ruby-devel  <span class="comment">#查看是否已经安装</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ruby-2.0.0.648-35.el7_6.x86_64</span></span><br><span class="line"><span class="comment"># rubygems-2.0.14.1-35.el7_6.noarch</span></span><br><span class="line"><span class="comment"># ruby-devel-2.0.0.648-35.el7_6.x86_64</span></span><br><span class="line"></span><br><span class="line">gem sources <span class="comment"># 查看 Rubygems 仓库信息</span></span><br><span class="line">gem sources -a https://mirrors.aliyun.com/rubygems/  <span class="comment"># 添加阿里云的 Rubygems 仓库，外国的源慢</span></span><br><span class="line">gem sources --remove https://rubygems.org/ <span class="comment"># 移除原生的 Ruby 仓库</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 fpm </span></span><br><span class="line">gem install fpm</span><br></pre></td></tr></table></figure></p>
<p>实际案例：(我们还是以nginx为例)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编译安装Nginx服务(需要在系统先安装|然后再使用-f指定目录即可)</span></span><br><span class="line">pcre-devel openssl-devel      <span class="comment">#安装Nginx依赖包</span></span><br><span class="line">useradd -M -s /sbin/nologin nginx <span class="comment">#添加Nginx运行用户</span></span><br><span class="line">tar zxvf nginx-1.8.1.tar.gz -C /usr/src/   <span class="comment">#编译安装Nginx</span></span><br><span class="line">/usr/src/nginx-1.8.1/configure --prefix=/usr/<span class="built_in">local</span>/nginx --user=nginx --group=nginx --with-http_ssl_module --with-http_stub_status_module</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/nginx/sbin/* /usr/<span class="built_in">local</span>/sbin/      <span class="comment">#优化Nginx程序执行路径(注意这里得目录)</span></span><br><span class="line">nginx                <span class="comment">#启动Nginx服务，并验证</span></span><br><span class="line">nginx -s stop  <span class="comment">#打包前需要停止</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#编写脚本，用来 nginx 打包完成后，安装后自动执行的脚本</span></span><br><span class="line"><span class="variable">$im</span> /tnp/nginx.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">useradd -M -s /sbin/nologin nginx</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/nginx/sbin/* /usr/<span class="built_in">local</span>/sbin/</span><br><span class="line"></span><br><span class="line"><span class="comment">#将 nginx 服务打包成 rpm 包，并指定需要安装的依赖包</span></span><br><span class="line"><span class="variable">$fpm</span> -s dir -t rpm -n nginx -v 1.15.9 -d <span class="string">'pcre-devel,openssl-devel'</span> --post-install /tmp/nginx.sh -f /usr/<span class="built_in">local</span>/nginx/</span><br><span class="line">[root@izwz9biz2m4sd3bb3k38pgz web]$ fpm -s dir -t rpm -n nginx -v 1.15.9 -d <span class="string">'pcre-devel,openssl-devel'</span> --post-install /tmp/nginx.sh -f `<span class="built_in">pwd</span>`</span><br><span class="line">Created package &#123;:path=&gt;<span class="string">"nginx-1.15.9-1.x86_64.rpm"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用yum命令进行安装我们打包得rpm包</span></span><br><span class="line">yum -y localinstall nginx-1.15.9-1.x86_64.rpm</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=rpm 快速入门与基础 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190622140131.png" target="_blank" title="WeiyiGeek.fpm打包" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190622140131.png" alt="WeiyiGeek.fpm打包" title="" class=""></a>
                <p>WeiyiGeek.fpm打包</p>
            </figure></p>
<hr>

<h4 id="0x04-入坑体验"><a href="#0x04-入坑体验" class="headerlink" title="0x04 入坑体验"></a>0x04 入坑体验</h4><p><em>问题1：安装 fpm 打包工具时提示以下错误：ERROR: Error installing fpm:<br>ruby-xz requires Ruby version &gt;= 1.9.3.</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#上面的提示表示您 Ruby 版本过低，需要安装 1.9.3 的版本，解决思路只需安装低版本的 fpm工具即可</span></span><br><span class="line"></span><br><span class="line">解决方法：</span><br><span class="line">gem install json -v 1.8.3</span><br><span class="line">gem install fpm -v 1.3.3</span><br><span class="line">或者</span><br><span class="line">gem install fpm　　　　//先直接安装一次，再安装一个低版本的</span><br><span class="line">gem install fpm -v 1.3.3</span><br></pre></td></tr></table></figure></p>

        </div>
        
  <hr>
  <p> 欢迎各位志同道合的朋友一起学习交流，如文章有误请在下方留下您宝贵的经验知识，个人邮箱地址<b style="color:#ff654e"><code>【master#weiyigeek.top】</code></b>或者个人公众号<b style="color:#ff654e"><code>【WeiyiGeek】</code></b>联系我。 </p>

  <p> 更多文章来源于<b style="color:#03a9f4">【WeiyiGeek Blog - 为了能到远方，脚下的每一步都不能少】</b>, 个人首页地址( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>

  <p>专栏书写不易，如果您觉得这个专栏还不错的，请给这篇专栏 <b style="color: red;">【点个赞、投个币、收个藏、关个注，转个发】(人间五大情)</b>，这将对我的肯定，谢谢！。</p>

  <div>
    <img src="https://www.weiyigeek.top/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"【点个赞】，动动你那粗壮的拇指或者芊芊玉手，亲！"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"【投个币】，万水千山总是情，投个硬币行不行，亲！")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("【收个藏】，阅后即焚不吃灰，亲！")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("【转个发】，让更多的志同道合的朋友一起学习交流，亲！")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("【关个注】，后续浏览查看不迷路哟，亲！")</span></p>
    </li>
  </ul>

  <div>
    <img src="/img/wechat-search.png" class="img-responsive" alt="扫描Follow(关注)WeiyiGeek公众号"  width="380" height="170">
    <img src="/img/wechat-app.png" class="img-responsive" alt="扫描Visit(浏览)极客全栈修炼小程序"  width="385" height="170">
  </div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    最后更新时间：<time datetime="2022-03-29T05:39:06.307Z" itemprop="dateUpdated">2022-03-29 13:39:06</time>
</span><br>


        <span>文章原始路径：<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/系统运维/Linux/常用命令/安装软件类命令/rpm快速入门与基础.md" target="_blank" rel="noopener noreferrer">_posts/系统运维/Linux/常用命令/安装软件类命令/rpm快速入门与基础.md</a></span><br>
         <span class="copy-copyright">转载注明出处，原文地址：<a href="/2019/5-17-151.html" target="_blank" rel="external">https://blog.weiyigeek.top/2019/5-17-151.html</a></span><br>本站文章内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">👍 钟意作者</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4/" rel="tag">系统命令</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/5-17-151.html&title=《rpm 快速入门与基础》 — WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/5-17-151.html&title=《rpm 快速入门与基础》 — WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/5-17-151.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《rpm 快速入门与基础》 — WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/5-17-151.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/5-17-151.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- 评论组件 -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/5-17-149.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">apt命令之软件仓库管理使用一览表</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/5-17-153.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">yum 快速入门与基础</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x00-rpm介绍"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 rpm介绍</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x01-命令一览"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 命令一览</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x02-rpm定制与应用"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 rpm定制与应用</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x03-rpm打包环境"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 rpm打包环境</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x04-入坑体验"><span class="post-toc-number">5.</span> <span class="post-toc-text">0x04 入坑体验</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

  <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        如果此篇文章对您有帮助，还请支持一下博主哟, 谢谢各位看友♥!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="微信打赏二维码">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="支付宝打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>

  
 <!-- 微信公众号关注/文章版权复制 -->

  <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">你好朋友,可以关个注吗? ❤ <br> 这将是我持续更新文章的动力源泉，谢谢支持！(๑′ᴗ‵๑) </b> <br> 如不想关注请点击右上角的【X】<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">【My Twitter】</a></strong>. There is an article verification code in the homepage.
<br>方式2.请访问本博主的B站<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">【WeiyiGeek】</a></strong>首页关注UP主,<br>将自动随机获取解锁验证码。
<br>方式3.扫一扫下方二维码，关注本站<strong>官方公众号</strong><br>
回复：<strong style="color: rgb(240, 65, 52);">验证码</strong>
将获取<strong style="color: rgb(240, 65, 52);">解锁(有效期7天)</strong>本站所有技术文章哟!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="请输入验证码|Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">提
    交</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - 为了能到远方，脚下的每一步都不能少</p>
</div>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">公众账号</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">哔哩哔哩专栏</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">个人Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">个人Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">个人知乎</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">博客园</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">今日头条</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">简书</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">腾讯云+云社区</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">百度文库</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">IT极客知识分享</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTO博客</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">掘金</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">微博文章</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">小红书</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">抖音主页</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">快手主页</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.唯一极客IT知识分享 版权所有 </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>访问统计
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-站点地图">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-百度站点地图">站点地图</a> </span>
        <!-- 
  -->
        <br/>ICP备案号<span><a href="https://beian.miit.gov.cn" target="_blank">渝ICP备2022003447号</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSL安全认证" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/5-17-151.html&title=《rpm 快速入门与基础》 — WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/5-17-151.html&title=《rpm 快速入门与基础》 — WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/5-17-151.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《rpm 快速入门与基础》 — WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/5-17-151.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/5-17-151.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACK0lEQVR42u3aQVLDMAwF0N7/0mELw9R8SS0Q+3nFpK3j54WwZD0e8bg+jc9P1p9+f/59zvVbXjwwMDBuy7iWI1lo9cmatN6Op1QMDIwDGL2p14Eyef2cjYGBgdELiJMQjIGBgfGOgLueJ//VH//fwMDA+PeMJHSuS2lRqlksz70lF8fAwLghI6+6//7fb7nfwMDAuBXjKo786jE5Sk5W8mVODAyMrRl5gJsU1PKEtrceDAyMvRl5GM3Tzjmm/AQDA2Nrxrwcnyy0d3wsHzcxMDA2ZfTCYjVMvwr2dJswMDC2ZvTSy2rymV9q9jYCAwPjHEZ+uVgtvU3Cd/mCEwMDY1NG7xjXa9eYBOsffoWBgbEpY96umhTjku2YNLxiYGCcwKgWv5KkNEllq5sSdYtgYGBszei1XCTf7BXa8otSDAyMvRnVIn7yvFrKz9mFpBoDA2MjxiTtzLegOkM5yGJgYBzAmDRgVRPdXqr8w0owMDC2ZuQl+F4C3LtaqLZoYGBgnMCYp5G9sJscRps9IxgYGAcweonuJB1dI6MQj4GBcTCjl7JWg2z1dvJlRTcMDIx/z7iKo3ew6wXZ5L0YGBgnMHp9Vvmn+ZVA75g4ahfDwMC4FaMXZOfNHL0ms1HVEAMD4+aMapPW/GKy3EKxng0DAwOj2EhRDbhVPAYGBkavHNYLlEmGHb0dAwPjAEaSxOaB9VXh9S3lNgwMjBsyRp0a8TcTzDxhxsDA2I7xAd+eapgxM666AAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 



  


<script>
  var _hmt = _hmt || [];
  (function() {
    // 百度统计
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-关注于网络安全_物联网安全开发_网络安全运维-学习心得分享';
                clearTimeout(titleTime);
            } else {
                document.title = '(つェ⊂)咦!又好了!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 
     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>
