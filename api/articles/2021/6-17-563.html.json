{"title":"KVM学习收集1","slug":"虚拟云容/虚拟化/KVM/KVM学习收集1","date":"2021-06-17T10:36:30.000Z","updated":"2023-01-31T02:29:10.471Z","url":"2021/6-17-563.html","path":"api/articles/2021/6-17-563.html.json","covers":["https://img.weiyigeek.top/2021/1/20210319200502.png","https://img.weiyigeek.top/2021/1/20210319200912.png","https://img.weiyigeek.top/2021/1/20210319201938.png","https://img.weiyigeek.top/2021/1/20210319210334.png","https://img.weiyigeek.top/2021/1/20210319210950.png","https://img.weiyigeek.top/2021/1/20210319211533.png","https://img.weiyigeek.top/2021/1/20210319213421.png","https://img.weiyigeek.top/2021/1/20210328102845.png","https://img.weiyigeek.top/2021/1/20210319205824.png","https://img.weiyigeek.top/2021/1/20210329172725.png","https://img.weiyigeek.top/2021/1/20210329213723.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<p>[TOC]</p>\n<h2 id=\"0x00-基础环境\"><a href=\"#0x00-基础环境\" class=\"headerlink\" title=\"0x00 基础环境\"></a>0x00 基础环境</h2><p><strong>环境准备:</strong></p>\n<ul>\n<li>1) VMware Workstation 16</li>\n<li>2) OS 版本&amp;架构: CentOS/7.9.2009/x86_64/  <a href=\"http://isoredirect.centos.org/centos/7/isos/x86_64/\" target=\"_blank\" rel=\"noopener\">官网下载地址</a><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 需求选择:此处测试选择使用 `CentOS-7-x86_64-DVD-2009.iso` 进行安装桌面版本的操作,选择CentOS-7-x86_64-Minimal-2009.iso进行KVM虚拟机安装</span></span><br><span class=\"line\">CentOS-7-x86_64-DVD-2009.iso                       04-Nov-2020 19:37      4G</span><br><span class=\"line\">CentOS-7-x86_64-DVD-2009.iso                       04-Nov-2020 19:37      4G</span><br><span class=\"line\">CentOS-7-x86_64-DVD-2009.torrent                   06-Nov-2020 22:44    176K</span><br><span class=\"line\">CentOS-7-x86_64-Everything-2009.iso                02-Nov-2020 23:18     10G</span><br><span class=\"line\">CentOS-7-x86_64-Everything-2009.torrent            06-Nov-2020 22:44    381K</span><br><span class=\"line\">CentOS-7-x86_64-Minimal-2009.iso                   03-Nov-2020 22:55    973M</span><br><span class=\"line\">CentOS-7-x86_64-Minimal-2009.torrent               06-Nov-2020 22:44     39K</span><br><span class=\"line\">CentOS-7-x86_64-NetInstall-2009.iso                27-Oct-2020 00:26    575M</span><br><span class=\"line\">CentOS-7-x86_64-NetInstall-2009.torrent            06-Nov-2020 22:44     23K</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<h2 id=\"0x01-基础步骤\"><a href=\"#0x01-基础步骤\" class=\"headerlink\" title=\"0x01 基础步骤\"></a>0x01 基础步骤</h2><p>描述: 当基础环境准备好后我们就需要开始创建 <code>KVM-Server</code> 的虚拟机了，在我们准备的 VMware Workstation 16 进行配置基础的操作系统，然后在此系统中安装KVM相应软件。</p>\n<ul>\n<li>Step 1.如图所示根据需求进行配置虚拟机，注意必须勾选虚拟化引擎来或者硬件辅助虚拟化的支持，例如<code>虚拟化 Intel VT-x/EPT 或 AMD-V/RVI(V)</code></li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2021/1/20210319200502.png\" alt=\"WeiyiGeek.VM虚拟机创建\" title=\"\" class=\"\">\n                <p>WeiyiGeek.VM虚拟机创建</p>\n            </figure>\n<ul>\n<li><p>Step 2.选择创建带有桌面的CentOS 7的版本，并且开启网络和设置主机名称方便后续连接。</p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2021/1/20210319200912.png\" alt=\"WeiyiGeek.KVM-Server虚拟配置\" title=\"\" class=\"\">\n                <p>WeiyiGeek.KVM-Server虚拟配置</p>\n            </figure>\n</li>\n<li><p>Step 3.安装完成启动系统并进入以下界面后，输入对于的命令进行简单设置与查看</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># (0) 内核查看 (一般正常版本在2.6以上)</span></span><br><span class=\"line\">$ uname -a</span><br><span class=\"line\">Linux kvm-server 3.10.0-1160.el7.x86_64 <span class=\"comment\">#1 SMP Mon Oct 19 16:18:59 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (1) 关闭和禁用防火墙</span></span><br><span class=\"line\">[root@kvm-server ~]<span class=\"comment\"># systemctl stop firewalld.service </span></span><br><span class=\"line\">[root@kvm-server ~]<span class=\"comment\"># systemctl disable firewalld.service </span></span><br><span class=\"line\">Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.</span><br><span class=\"line\">Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2) 关闭selinux</span></span><br><span class=\"line\">[root@kvm-server ~]<span class=\"comment\"># sed -i \"s/^SELINUX=enforcing/SELINUX=disabled/g\" /etc/sysconfig/selinux </span></span><br><span class=\"line\">[root@kvm-server ~]<span class=\"comment\"># setenforce 0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (3) 查看CPU是否支持VT技术</span></span><br><span class=\"line\">grep -E <span class=\"string\">'vmx|svm'</span> /proc/cpuinfo </span><br><span class=\"line\"><span class=\"comment\"># 本机支持的vmx的虚拟化即Intel的处理器支持的。(有几个处理器就显示几个flags)</span></span><br><span class=\"line\">flags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon nopl xtopology tsc_reliable nonstop_tsc eagerfpu pni pclmulqdq vmx</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2021/1/20210319201938.png\" alt=\"WeiyiGeek.简单设置与查看\" title=\"\" class=\"\">\n                <p>WeiyiGeek.简单设置与查看</p>\n            </figure>\n<ul>\n<li><p>Step 4.环境清理卸载系统原本存在的KVM以及安装新的软件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.旧的版本</span></span><br><span class=\"line\">rpm -qa | egrep <span class=\"string\">'qemu|virt|kvm'</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-daemon-driver-nwfilter-4.5.0-36.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-daemon-driver-storage-mpath-4.5.0-36.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-libs-4.5.0-36.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-gobject-1.0.0-1.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># qemu-guest-agent-2.12.0-3.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-daemon-driver-storage-logical-4.5.0-36.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-daemon-driver-interface-4.5.0-36.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-glib-1.0.0-1.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libgovirt-0.3.4-5.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># virt-what-1.18-4.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-daemon-driver-storage-disk-4.5.0-36.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-daemon-driver-storage-gluster-4.5.0-36.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-daemon-driver-storage-4.5.0-36.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-daemon-driver-network-4.5.0-36.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-daemon-config-network-4.5.0-36.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-daemon-driver-nodedev-4.5.0-36.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># qemu-img-1.5.3-175.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-daemon-driver-storage-core-4.5.0-36.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-daemon-driver-storage-iscsi-4.5.0-36.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-daemon-driver-storage-rbd-4.5.0-36.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># qemu-kvm-common-1.5.3-175.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-daemon-driver-qemu-4.5.0-36.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-daemon-driver-secret-4.5.0-36.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># ipxe-roms-qemu-20180825-3.git133f4c.el7.noarch</span></span><br><span class=\"line\">  <span class=\"comment\"># qemu-kvm-1.5.3-175.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-daemon-driver-storage-scsi-4.5.0-36.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-daemon-kvm-4.5.0-36.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-gconfig-1.0.0-1.el7.x86_64</span></span><br><span class=\"line\">  <span class=\"comment\"># libvirt-daemon-4.5.0-36.el7.x86_64</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.卸载</span></span><br><span class=\"line\">yum remove `rpm -qa | egrep <span class=\"string\">'qemu|virt|kvm'</span>` -y</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.清空目录文件夹</span></span><br><span class=\"line\">rm -rf /var/lib/libvirt/ /etc/libvirt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.安装软件（如果安装过程出错请检查是否是操作系统的问题-此处我是很顺利的）</span></span><br><span class=\"line\">yum install *qemu* *virt* librbd1-devel -y  <span class=\"comment\"># CentOS 7</span></span><br><span class=\"line\"><span class=\"comment\"># yum upgrade rpm -y &amp;&amp; yum install *qemu* *virt* librbd1-devel -y  # CentOS 8</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Step 5.在所谓的KVM技术中运用到的就是 <code>QEMU+KVM</code>的组合实现真正意义上的服务器虚拟化。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- KVM : 负责 CPU的虚拟化 + 内存的虚拟化 但却不能模拟其它设备。</span><br><span class=\"line\">- QEMU : 负责 IO设备的模拟例如磁盘 和 网络</span><br><span class=\"line\"><span class=\"comment\"># 安装的包简单介绍</span></span><br><span class=\"line\">1) qemu-kvm : 主包</span><br><span class=\"line\">2) libvirt : 调用KVM虚拟机技术的 Api 接口主要用于管理的作用。</span><br><span class=\"line\">3) virt-manager : 图形管理程序与hypervisor进行交互的作用。</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Step 6.安装完成后启动libvirtd服务并查看KVM模块是是否安装</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@kvm-server ~]<span class=\"comment\"># systemctl start libvirtd.service &amp;&amp; systemctl enable libvirtd.service</span></span><br><span class=\"line\">[root@kvm-server ~]<span class=\"comment\"># lsmod | grep \"kvm\"</span></span><br><span class=\"line\">kvm_intel             188740  0 </span><br><span class=\"line\">kvm                   637289  1 kvm_intel</span><br><span class=\"line\">irqbypass              13503  1 kvm</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<hr>\n<h2 id=\"0x02-安装-GuestOS\"><a href=\"#0x02-安装-GuestOS\" class=\"headerlink\" title=\"0x02 安装 GuestOS\"></a>0x02 安装 GuestOS</h2><p><strong>GuestOS安装的几种方式:</strong></p>\n<ul>\n<li>1.图形化方式</li>\n<li>2.完全文本模式 (<code>现场配置虚拟机的规格</code>)</li>\n<li>3.命令行模式 (<code>模板镜像 + 配置文件</code>)</li>\n</ul>\n<p><br></p>\n<h3 id=\"1-图形化方式\"><a href=\"#1-图形化方式\" class=\"headerlink\" title=\"1.图形化方式\"></a>1.图形化方式</h3><ul>\n<li>Step 1.可以通过命令行模式或者在界面中点击运行虚拟系统管理器都可以<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">virt-manager</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2021/1/20210319210334.png\" alt=\"WeiyiGeek.virt-manager\" title=\"\" class=\"\">\n                <p>WeiyiGeek.virt-manager</p>\n            </figure>\n</li>\n</ul>\n<ul>\n<li>Step 2.选择本地介质安装(采用前面我们下载的CentOS精简版镜像),其安装虚拟机方式与VMware类似，不在类似请看下图</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2021/1/20210319210950.png\" alt=\"WeiyiGeek.VM虚拟机新建\" title=\"\" class=\"\">\n                <p>WeiyiGeek.VM虚拟机新建</p>\n            </figure>\n<ul>\n<li>Step 3.QEMU/KVM 创建的VM1虚拟机配置查看，并且点击开始安装，后续centos7安装流程大致相同此处不在讲述。</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2021/1/20210319211533.png\" alt=\"WeiyiGeek.QEMU/KVM\" title=\"\" class=\"\">\n                <p>WeiyiGeek.QEMU/KVM</p>\n            </figure>\n<ul>\n<li>Step 4.GuestOS 安装成功重启机器。</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2021/1/20210319213421.png\" alt=\"WeiyiGeek.GuestOS\" title=\"\" class=\"\">\n                <p>WeiyiGeek.GuestOS</p>\n            </figure>\n<p>Tips : 宿主机必须开启路由转发<code>(才能使用桥接网络·重点)</code>之后重启一下 libvirtd.service<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'net.ipv4.ip_forward = 1'</span> | tee -a /etc/sysctl.conf &amp;&amp; sysctl -p</span><br><span class=\"line\">systemctl restart libvirtd.service</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"2-完全文本模式\"><a href=\"#2-完全文本模式\" class=\"headerlink\" title=\"2.完全文本模式\"></a>2.完全文本模式</h3><p>描述: 此种方式应用环境是服务器与客户端均没有图形界面时的场景使用。</p>\n<ul>\n<li><p>Step 1.安装前查看你KVM支持的OS版本;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@kvm-server ~]<span class=\"comment\"># osinfo-query os | grep centos</span></span><br><span class=\"line\">centos-stream8       | CentOS Stream 8                                    | 8        | http://centos.org/centos-stream/8       </span><br><span class=\"line\">centos5.0            | CentOS 5.0                                         | 5.0      | http://centos.org/centos/5.0            </span><br><span class=\"line\">centos5.1            | CentOS 5.1                                         | 5.1      | http://centos.org/centos/5.1            </span><br><span class=\"line\">centos5.10           | CentOS 5.10                                        | 5.10     | http://centos.org/centos/5.10           </span><br><span class=\"line\">centos5.11           | CentOS 5.11                                        | 5.11     | http://centos.org/centos/5.11           </span><br><span class=\"line\">centos5.2            | CentOS 5.2                                         | 5.2      | http://centos.org/centos/5.2            </span><br><span class=\"line\">centos5.3            | CentOS 5.3                                         | 5.3      | http://centos.org/centos/5.3            </span><br><span class=\"line\">centos5.4            | CentOS 5.4                                         | 5.4      | http://centos.org/centos/5.4            </span><br><span class=\"line\">centos5.5            | CentOS 5.5                                         | 5.5      | http://centos.org/centos/5.5            </span><br><span class=\"line\">centos5.6            | CentOS 5.6                                         | 5.6      | http://centos.org/centos/5.6            </span><br><span class=\"line\">centos5.7            | CentOS 5.7                                         | 5.7      | http://centos.org/centos/5.7            </span><br><span class=\"line\">centos5.8            | CentOS 5.8                                         | 5.8      | http://centos.org/centos/5.8            </span><br><span class=\"line\">centos5.9            | CentOS 5.9                                         | 5.9      | http://centos.org/centos/5.9            </span><br><span class=\"line\">centos6.0            | CentOS 6.0                                         | 6.0      | http://centos.org/centos/6.0            </span><br><span class=\"line\">centos6.1            | CentOS 6.1                                         | 6.1      | http://centos.org/centos/6.1            </span><br><span class=\"line\">centos6.10           | CentOS 6.10                                        | 6.10     | http://centos.org/centos/6.10           </span><br><span class=\"line\">centos6.2            | CentOS 6.2                                         | 6.2      | http://centos.org/centos/6.2            </span><br><span class=\"line\">centos6.3            | CentOS 6.3                                         | 6.3      | http://centos.org/centos/6.3            </span><br><span class=\"line\">centos6.4            | CentOS 6.4                                         | 6.4      | http://centos.org/centos/6.4            </span><br><span class=\"line\">centos6.5            | CentOS 6.5                                         | 6.5      | http://centos.org/centos/6.5            </span><br><span class=\"line\">centos6.6            | CentOS 6.6                                         | 6.6      | http://centos.org/centos/6.6            </span><br><span class=\"line\">centos6.7            | CentOS 6.7                                         | 6.7      | http://centos.org/centos/6.7            </span><br><span class=\"line\">centos6.8            | CentOS 6.8                                         | 6.8      | http://centos.org/centos/6.8            </span><br><span class=\"line\">centos6.9            | CentOS 6.9                                         | 6.9      | http://centos.org/centos/6.9            </span><br><span class=\"line\">centos7.0            | CentOS 7                                           | 7        | http://centos.org/centos/7.0            </span><br><span class=\"line\">centos8              | CentOS 8                                           | 8        | http://centos.org/centos/8</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Step 2.安装命令;</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.帮助查看</span></span><br><span class=\"line\">man virt-install </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.采用FTP的格式进行安装(注意需要将OS镜像挂载到此ftp目录下)</span></span><br><span class=\"line\">virt-install --connnect qemu:///system \\</span><br><span class=\"line\">-n vm3 -r 2048 --vcpus=1 --disk-path=/var/lib/libvirt/images/vm9.img,size=7 \\</span><br><span class=\"line\">--os-type=linux --os-variant=centos7.0 -x console=ttyS0 --nographics \\</span><br><span class=\"line\">--location=ftp://192.168.10.230/centos7/</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>TIPS : 安装时给与的内存必须是2G及以上否则将报如下错误 <code>Dracut-Initqueue[552]:/sbin/dmsquash-live-root:line 273: printf: write error : no space left on device</code>。</p>\n<p><br></p>\n<h3 id=\"3-命令行模式-推荐方式\"><a href=\"#3-命令行模式-推荐方式\" class=\"headerlink\" title=\"3.命令行模式 (推荐方式)\"></a>3.命令行模式 (推荐方式)</h3><p>描述: 通过此魔术我们可以轻松的创建我们的虚拟机，此种模式创建虚拟机依赖于虚拟机配置文件和虚拟机虚拟机img介质。</p>\n<ul>\n<li><p>Step 1.虚拟机组成部分</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@kvm-server ~]<span class=\"comment\"># ls /etc/libvirt/qemu</span></span><br><span class=\"line\">networks  vm1.xml</span><br><span class=\"line\">[root@kvm-server ~]<span class=\"comment\"># ls /var/lib/libvirt/images/</span></span><br><span class=\"line\">vm1.qcow2</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Step 2.根据现有模板镜像配置文件创建虚拟机即复制磁盘镜像与配置文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@kvm-server ~]<span class=\"comment\"># cp /etc/libvirt/qemu/vm1.xml /etc/libvirt/qemu/vm2.xml</span></span><br><span class=\"line\">[root@kvm-server ~]<span class=\"comment\"># cp /var/lib/libvirt/images/vm1.qcow2 /var/lib/libvirt/images/vm2.qcow2</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Step 3.配置文件修改</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 1.虚拟机UUID修改</span><br><span class=\"line\">[root@kvm-server ~]# uuidgen </span><br><span class=\"line\">960cc2bb-9731-4101-94e6-160c4263bace</span><br><span class=\"line\"></span><br><span class=\"line\"># 2.虚拟机配置文件</span><br><span class=\"line\"><span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">WARNING: THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY TO BE</span></span><br><span class=\"line\"><span class=\"comment\">OVERWRITTEN AND LOST. Changes to this xml configuration should be made using: virsh edit vm2 or other application using the libvirt API.</span></span><br><span class=\"line\"><span class=\"comment\">--&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">domain</span> <span class=\"attr\">type</span>=<span class=\"string\">'kvm'</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!-- 修改点1.名称与UUID --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>vm2<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">uuid</span>&gt;</span>960cc2bb-9731-4101-94e6-160c4263bace<span class=\"tag\">&lt;/<span class=\"name\">uuid</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">memory</span> <span class=\"attr\">unit</span>=<span class=\"string\">'KiB'</span>&gt;</span>2097152<span class=\"tag\">&lt;/<span class=\"name\">memory</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">currentMemory</span> <span class=\"attr\">unit</span>=<span class=\"string\">'KiB'</span>&gt;</span>2097152<span class=\"tag\">&lt;/<span class=\"name\">currentMemory</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">vcpu</span> <span class=\"attr\">placement</span>=<span class=\"string\">'static'</span>&gt;</span>2<span class=\"tag\">&lt;/<span class=\"name\">vcpu</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">os</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">type</span> <span class=\"attr\">arch</span>=<span class=\"string\">'x86_64'</span> <span class=\"attr\">machine</span>=<span class=\"string\">'pc-i440fx-rhel7.0.0'</span>&gt;</span>hvm<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">boot</span> <span class=\"attr\">dev</span>=<span class=\"string\">'hd'</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">os</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">features</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">acpi</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">apic</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">features</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">cpu</span> <span class=\"attr\">mode</span>=<span class=\"string\">'custom'</span> <span class=\"attr\">match</span>=<span class=\"string\">'exact'</span> <span class=\"attr\">check</span>=<span class=\"string\">'partial'</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">model</span> <span class=\"attr\">fallback</span>=<span class=\"string\">'allow'</span>&gt;</span>Broadwell-noTSX-IBRS<span class=\"tag\">&lt;/<span class=\"name\">model</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">feature</span> <span class=\"attr\">policy</span>=<span class=\"string\">'require'</span> <span class=\"attr\">name</span>=<span class=\"string\">'md-clear'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">feature</span> <span class=\"attr\">policy</span>=<span class=\"string\">'require'</span> <span class=\"attr\">name</span>=<span class=\"string\">'spec-ctrl'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">feature</span> <span class=\"attr\">policy</span>=<span class=\"string\">'require'</span> <span class=\"attr\">name</span>=<span class=\"string\">'ssbd'</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">cpu</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">clock</span> <span class=\"attr\">offset</span>=<span class=\"string\">'utc'</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">timer</span> <span class=\"attr\">name</span>=<span class=\"string\">'rtc'</span> <span class=\"attr\">tickpolicy</span>=<span class=\"string\">'catchup'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">timer</span> <span class=\"attr\">name</span>=<span class=\"string\">'pit'</span> <span class=\"attr\">tickpolicy</span>=<span class=\"string\">'delay'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">timer</span> <span class=\"attr\">name</span>=<span class=\"string\">'hpet'</span> <span class=\"attr\">present</span>=<span class=\"string\">'no'</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">clock</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">on_poweroff</span>&gt;</span>destroy<span class=\"tag\">&lt;/<span class=\"name\">on_poweroff</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">on_reboot</span>&gt;</span>restart<span class=\"tag\">&lt;/<span class=\"name\">on_reboot</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">on_crash</span>&gt;</span>destroy<span class=\"tag\">&lt;/<span class=\"name\">on_crash</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">pm</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">suspend-to-mem</span> <span class=\"attr\">enabled</span>=<span class=\"string\">'no'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">suspend-to-disk</span> <span class=\"attr\">enabled</span>=<span class=\"string\">'no'</span>/&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">pm</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">devices</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">emulator</span>&gt;</span>/usr/libexec/qemu-kvm<span class=\"tag\">&lt;/<span class=\"name\">emulator</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 修改点2.虚拟机磁盘镜像  --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">disk</span> <span class=\"attr\">type</span>=<span class=\"string\">'file'</span> <span class=\"attr\">device</span>=<span class=\"string\">'disk'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">driver</span> <span class=\"attr\">name</span>=<span class=\"string\">'qemu'</span> <span class=\"attr\">type</span>=<span class=\"string\">'qcow2'</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">source</span> <span class=\"attr\">file</span>=<span class=\"string\">'/var/lib/libvirt/images/vm2.qcow2'</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">target</span> <span class=\"attr\">dev</span>=<span class=\"string\">'vda'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'virtio'</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">address</span> <span class=\"attr\">type</span>=<span class=\"string\">'pci'</span> <span class=\"attr\">domain</span>=<span class=\"string\">'0x0000'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'0x00'</span> <span class=\"attr\">slot</span>=<span class=\"string\">'0x07'</span> <span class=\"attr\">function</span>=<span class=\"string\">'0x0'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">disk</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">disk</span> <span class=\"attr\">type</span>=<span class=\"string\">'file'</span> <span class=\"attr\">device</span>=<span class=\"string\">'cdrom'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">driver</span> <span class=\"attr\">name</span>=<span class=\"string\">'qemu'</span> <span class=\"attr\">type</span>=<span class=\"string\">'raw'</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">target</span> <span class=\"attr\">dev</span>=<span class=\"string\">'hda'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'ide'</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">readonly</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">address</span> <span class=\"attr\">type</span>=<span class=\"string\">'drive'</span> <span class=\"attr\">controller</span>=<span class=\"string\">'0'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'0'</span> <span class=\"attr\">target</span>=<span class=\"string\">'0'</span> <span class=\"attr\">unit</span>=<span class=\"string\">'0'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">disk</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">controller</span> <span class=\"attr\">type</span>=<span class=\"string\">'usb'</span> <span class=\"attr\">index</span>=<span class=\"string\">'0'</span> <span class=\"attr\">model</span>=<span class=\"string\">'ich9-ehci1'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">address</span> <span class=\"attr\">type</span>=<span class=\"string\">'pci'</span> <span class=\"attr\">domain</span>=<span class=\"string\">'0x0000'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'0x00'</span> <span class=\"attr\">slot</span>=<span class=\"string\">'0x05'</span> <span class=\"attr\">function</span>=<span class=\"string\">'0x7'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">controller</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">controller</span> <span class=\"attr\">type</span>=<span class=\"string\">'usb'</span> <span class=\"attr\">index</span>=<span class=\"string\">'0'</span> <span class=\"attr\">model</span>=<span class=\"string\">'ich9-uhci1'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">master</span> <span class=\"attr\">startport</span>=<span class=\"string\">'0'</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">address</span> <span class=\"attr\">type</span>=<span class=\"string\">'pci'</span> <span class=\"attr\">domain</span>=<span class=\"string\">'0x0000'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'0x00'</span> <span class=\"attr\">slot</span>=<span class=\"string\">'0x05'</span> <span class=\"attr\">function</span>=<span class=\"string\">'0x0'</span> <span class=\"attr\">multifunction</span>=<span class=\"string\">'on'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">controller</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">controller</span> <span class=\"attr\">type</span>=<span class=\"string\">'usb'</span> <span class=\"attr\">index</span>=<span class=\"string\">'0'</span> <span class=\"attr\">model</span>=<span class=\"string\">'ich9-uhci2'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">master</span> <span class=\"attr\">startport</span>=<span class=\"string\">'2'</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">address</span> <span class=\"attr\">type</span>=<span class=\"string\">'pci'</span> <span class=\"attr\">domain</span>=<span class=\"string\">'0x0000'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'0x00'</span> <span class=\"attr\">slot</span>=<span class=\"string\">'0x05'</span> <span class=\"attr\">function</span>=<span class=\"string\">'0x1'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">controller</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">controller</span> <span class=\"attr\">type</span>=<span class=\"string\">'usb'</span> <span class=\"attr\">index</span>=<span class=\"string\">'0'</span> <span class=\"attr\">model</span>=<span class=\"string\">'ich9-uhci3'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">master</span> <span class=\"attr\">startport</span>=<span class=\"string\">'4'</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">address</span> <span class=\"attr\">type</span>=<span class=\"string\">'pci'</span> <span class=\"attr\">domain</span>=<span class=\"string\">'0x0000'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'0x00'</span> <span class=\"attr\">slot</span>=<span class=\"string\">'0x05'</span> <span class=\"attr\">function</span>=<span class=\"string\">'0x2'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">controller</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">controller</span> <span class=\"attr\">type</span>=<span class=\"string\">'pci'</span> <span class=\"attr\">index</span>=<span class=\"string\">'0'</span> <span class=\"attr\">model</span>=<span class=\"string\">'pci-root'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">controller</span> <span class=\"attr\">type</span>=<span class=\"string\">'ide'</span> <span class=\"attr\">index</span>=<span class=\"string\">'0'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">address</span> <span class=\"attr\">type</span>=<span class=\"string\">'pci'</span> <span class=\"attr\">domain</span>=<span class=\"string\">'0x0000'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'0x00'</span> <span class=\"attr\">slot</span>=<span class=\"string\">'0x01'</span> <span class=\"attr\">function</span>=<span class=\"string\">'0x1'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">controller</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">controller</span> <span class=\"attr\">type</span>=<span class=\"string\">'virtio-serial'</span> <span class=\"attr\">index</span>=<span class=\"string\">'0'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">address</span> <span class=\"attr\">type</span>=<span class=\"string\">'pci'</span> <span class=\"attr\">domain</span>=<span class=\"string\">'0x0000'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'0x00'</span> <span class=\"attr\">slot</span>=<span class=\"string\">'0x06'</span> <span class=\"attr\">function</span>=<span class=\"string\">'0x0'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">controller</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 修改点3.网络Mac地址(virtio == NAT 转发) --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interface</span> <span class=\"attr\">type</span>=<span class=\"string\">'network'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">mac</span> <span class=\"attr\">address</span>=<span class=\"string\">'52:54:00:64:97:40'</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">source</span> <span class=\"attr\">network</span>=<span class=\"string\">'default'</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">model</span> <span class=\"attr\">type</span>=<span class=\"string\">'virtio'</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">address</span> <span class=\"attr\">type</span>=<span class=\"string\">'pci'</span> <span class=\"attr\">domain</span>=<span class=\"string\">'0x0000'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'0x00'</span> <span class=\"attr\">slot</span>=<span class=\"string\">'0x03'</span> <span class=\"attr\">function</span>=<span class=\"string\">'0x0'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">interface</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">serial</span> <span class=\"attr\">type</span>=<span class=\"string\">'pty'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">target</span> <span class=\"attr\">type</span>=<span class=\"string\">'isa-serial'</span> <span class=\"attr\">port</span>=<span class=\"string\">'0'</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">model</span> <span class=\"attr\">name</span>=<span class=\"string\">'isa-serial'</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">serial</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">console</span> <span class=\"attr\">type</span>=<span class=\"string\">'pty'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">target</span> <span class=\"attr\">type</span>=<span class=\"string\">'serial'</span> <span class=\"attr\">port</span>=<span class=\"string\">'0'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">console</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">channel</span> <span class=\"attr\">type</span>=<span class=\"string\">'unix'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">target</span> <span class=\"attr\">type</span>=<span class=\"string\">'virtio'</span> <span class=\"attr\">name</span>=<span class=\"string\">'org.qemu.guest_agent.0'</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">address</span> <span class=\"attr\">type</span>=<span class=\"string\">'virtio-serial'</span> <span class=\"attr\">controller</span>=<span class=\"string\">'0'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'0'</span> <span class=\"attr\">port</span>=<span class=\"string\">'1'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">channel</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">channel</span> <span class=\"attr\">type</span>=<span class=\"string\">'spicevmc'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">target</span> <span class=\"attr\">type</span>=<span class=\"string\">'virtio'</span> <span class=\"attr\">name</span>=<span class=\"string\">'com.redhat.spice.0'</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">address</span> <span class=\"attr\">type</span>=<span class=\"string\">'virtio-serial'</span> <span class=\"attr\">controller</span>=<span class=\"string\">'0'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'0'</span> <span class=\"attr\">port</span>=<span class=\"string\">'2'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">channel</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">'tablet'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'usb'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">address</span> <span class=\"attr\">type</span>=<span class=\"string\">'usb'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'0'</span> <span class=\"attr\">port</span>=<span class=\"string\">'1'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">input</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">'mouse'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'ps2'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">'keyboard'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'ps2'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">graphics</span> <span class=\"attr\">type</span>=<span class=\"string\">'spice'</span> <span class=\"attr\">autoport</span>=<span class=\"string\">'yes'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">listen</span> <span class=\"attr\">type</span>=<span class=\"string\">'address'</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">image</span> <span class=\"attr\">compression</span>=<span class=\"string\">'off'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">graphics</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">sound</span> <span class=\"attr\">model</span>=<span class=\"string\">'ich6'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">address</span> <span class=\"attr\">type</span>=<span class=\"string\">'pci'</span> <span class=\"attr\">domain</span>=<span class=\"string\">'0x0000'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'0x00'</span> <span class=\"attr\">slot</span>=<span class=\"string\">'0x04'</span> <span class=\"attr\">function</span>=<span class=\"string\">'0x0'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">sound</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">video</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">model</span> <span class=\"attr\">type</span>=<span class=\"string\">'qxl'</span> <span class=\"attr\">ram</span>=<span class=\"string\">'65536'</span> <span class=\"attr\">vram</span>=<span class=\"string\">'65536'</span> <span class=\"attr\">vgamem</span>=<span class=\"string\">'16384'</span> <span class=\"attr\">heads</span>=<span class=\"string\">'1'</span> <span class=\"attr\">primary</span>=<span class=\"string\">'yes'</span>/&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">address</span> <span class=\"attr\">type</span>=<span class=\"string\">'pci'</span> <span class=\"attr\">domain</span>=<span class=\"string\">'0x0000'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'0x00'</span> <span class=\"attr\">slot</span>=<span class=\"string\">'0x02'</span> <span class=\"attr\">function</span>=<span class=\"string\">'0x0'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">video</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">redirdev</span> <span class=\"attr\">bus</span>=<span class=\"string\">'usb'</span> <span class=\"attr\">type</span>=<span class=\"string\">'spicevmc'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">address</span> <span class=\"attr\">type</span>=<span class=\"string\">'usb'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'0'</span> <span class=\"attr\">port</span>=<span class=\"string\">'2'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">redirdev</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">redirdev</span> <span class=\"attr\">bus</span>=<span class=\"string\">'usb'</span> <span class=\"attr\">type</span>=<span class=\"string\">'spicevmc'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">address</span> <span class=\"attr\">type</span>=<span class=\"string\">'usb'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'0'</span> <span class=\"attr\">port</span>=<span class=\"string\">'3'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">redirdev</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">memballoon</span> <span class=\"attr\">model</span>=<span class=\"string\">'virtio'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">address</span> <span class=\"attr\">type</span>=<span class=\"string\">'pci'</span> <span class=\"attr\">domain</span>=<span class=\"string\">'0x0000'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'0x00'</span> <span class=\"attr\">slot</span>=<span class=\"string\">'0x08'</span> <span class=\"attr\">function</span>=<span class=\"string\">'0x0'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">memballoon</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">rng</span> <span class=\"attr\">model</span>=<span class=\"string\">'virtio'</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">backend</span> <span class=\"attr\">model</span>=<span class=\"string\">'random'</span>&gt;</span>/dev/urandom<span class=\"tag\">&lt;/<span class=\"name\">backend</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">address</span> <span class=\"attr\">type</span>=<span class=\"string\">'pci'</span> <span class=\"attr\">domain</span>=<span class=\"string\">'0x0000'</span> <span class=\"attr\">bus</span>=<span class=\"string\">'0x00'</span> <span class=\"attr\">slot</span>=<span class=\"string\">'0x09'</span> <span class=\"attr\">function</span>=<span class=\"string\">'0x0'</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">rng</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">devices</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">domain</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Step 4.虚拟机创建</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@kvm-server ~]<span class=\"comment\"># virsh define /etc/libvirt/qemu/vm2.xml</span></span><br><span class=\"line\"><span class=\"comment\"># 定义域 vm2（从 /etc/libvirt/qemu/vm2.xml）</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul>\n<li>Step 5.宿主机开启路由转发<code>(才能使用桥接网络重点)</code>之后重启一哈 <code>libvirtd.service</code></li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'net.ipv4.ip_forward = 1'</span> | tee -a /etc/sysctl.conf &amp;&amp; sysctl -p</span><br><span class=\"line\">systemctl restart libvirtd.service</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Step 6.虚拟机运行结果</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2021/1/20210328102845.png\" alt=\"WeiyiGeek.成功创建并连接\" title=\"\" class=\"\">\n                <p>WeiyiGeek.成功创建并连接</p>\n            </figure>\n<p><br></p>\n<h3 id=\"4-飞机舱cockpit管理KVM服务器\"><a href=\"#4-飞机舱cockpit管理KVM服务器\" class=\"headerlink\" title=\"4.飞机舱cockpit管理KVM服务器\"></a>4.飞机舱cockpit管理KVM服务器</h3><p>Tips : 我们可以使用飞机驾驶舱安装与管理虚拟机实际上就是通过一个Web界面来管理服务器，安装完成后浏览器访问服务地址: 9090<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 安装&amp;启用</span></span><br><span class=\"line\">yum install cockpit -y; \\</span><br><span class=\"line\">systemctl start cockpit</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 服务地址查看</span></span><br><span class=\"line\">ip addr | grep <span class=\"string\">\"    inet \"</span></span><br><span class=\"line\">  <span class=\"comment\"># inet 127.0.0.1/8 scope host lo</span></span><br><span class=\"line\">  <span class=\"comment\"># inet 192.168.228.128/24 brd 192.168.228.255 scope global noprefixroute dynamic ens33</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 停止服务</span></span><br><span class=\"line\">systemctl stop cockpit.socket</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 端口配置</span></span><br><span class=\"line\">vim /etc/systemd/system/cockpit.socket.d/listen.conf</span><br><span class=\"line\"><span class=\"comment\"># [Unit]</span></span><br><span class=\"line\"><span class=\"comment\"># Description=Cockpit Web Service Socket</span></span><br><span class=\"line\"><span class=\"comment\"># Documentation=man:cockpit-ws(8)</span></span><br><span class=\"line\"><span class=\"comment\"># Wants=cockpit-motd.service</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># [Socket]</span></span><br><span class=\"line\"><span class=\"comment\"># ListenStream=9090</span></span><br><span class=\"line\"><span class=\"comment\"># ExecStartPost=-/usr/share/cockpit/motd/update-motd '' localhost</span></span><br><span class=\"line\"><span class=\"comment\"># ExecStartPost=-/bin/ln -snf active.motd /run/cockpit/motd</span></span><br><span class=\"line\"><span class=\"comment\"># ExecStopPost=-/bin/ln -snf /usr/share/cockpit/motd/inactive.motd /run/cockpit/motd</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># [Install]</span></span><br><span class=\"line\"><span class=\"comment\"># WantedBy=sockets.target</span></span><br><span class=\"line\"></span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl restart cockpit.socket</span><br><span class=\"line\">sudo systemctl restart cockpit.service</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2021/1/20210319205824.png\" alt=\"WeiyiGeek.cockpit-Web\" title=\"\" class=\"\">\n                <p>WeiyiGeek.cockpit-Web</p>\n            </figure>\n<hr>\n<h2 id=\"0x03-升级GuestOS\"><a href=\"#0x03-升级GuestOS\" class=\"headerlink\" title=\"0x03 升级GuestOS\"></a>0x03 升级GuestOS</h2><p>描述: 在实际的应用场景中,我们常常要对已安装的<code>GuestOS</code>进行添加硬件设备和升级现有的资源配置。</p>\n<h3 id=\"实现方式说明\"><a href=\"#实现方式说明\" class=\"headerlink\" title=\"实现方式说明\"></a>实现方式说明</h3><ul>\n<li>1.图像界面操作(简单)</li>\n<li>2.配置文件操作(手动-无界面的情况下)</li>\n</ul>\n<p><br></p>\n<h3 id=\"图像界面操作\"><a href=\"#图像界面操作\" class=\"headerlink\" title=\"图像界面操作\"></a>图像界面操作</h3><p><strong>虚拟机添加网卡设备流程</strong></p>\n<ul>\n<li><p>Step 1.首先需要关闭要添加硬件的虚拟机</p>\n</li>\n<li><p>Step 2.双击虚拟机在打开的<code>对话框点击上方的 View 并点击 Details(详情)，点击 Add Hardware</code>就可以选择要添加的虚拟硬件;</p>\n</li>\n<li><p>Step 3.此处以添加网卡为例。 </p>\n</li>\n</ul>\n<p><img src=\"https://img.weiyigeek.top/2021/1/20210329172725.png\" alt=\"WeiyiGeek.添加网卡\"></p>\n<ul>\n<li>Step 4.删除添加的虚拟硬件步骤点击要删除的硬件, 例如<code>NIC:20:b9:da</code>然后点击右下角的删除即可。</li>\n</ul>\n<p><br></p>\n<h3 id=\"配置文件操作\"><a href=\"#配置文件操作\" class=\"headerlink\" title=\"配置文件操作\"></a>配置文件操作</h3><p><strong>虚拟机添加磁盘设备流程</strong></p>\n<ul>\n<li><p>Step 1.同样需要先关闭要添加硬件的虚拟机VM2;</p>\n</li>\n<li><p>Step 2.创建要添加的磁盘镜像文件(qcow2格式);</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ qemu-img create -f qcow2 /var/lib/libvirt/images/vm2-1.qcow2 1G</span><br><span class=\"line\">&gt; Formatting <span class=\"string\">'/var/lib/libvirt/images/vm2-1.qcow2'</span>, fmt=qcow2 size=1073741824 encryption=off cluster_size=65536 lazy_refcounts=off</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Step 3.编辑VM2虚拟主机的配置文件,找到定义磁盘镜像的<code>&lt;disk&gt;</code>标签, 将该标签及其包含的内容复制一份在其后。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ virsh edit vm2</span><br><span class=\"line\">37     &lt;disk <span class=\"built_in\">type</span>=<span class=\"string\">'file'</span> device=<span class=\"string\">'disk'</span>&gt;</span><br><span class=\"line\">38       &lt;driver name=<span class=\"string\">'qemu'</span> <span class=\"built_in\">type</span>=<span class=\"string\">'qcow2'</span>/&gt;</span><br><span class=\"line\">39       &lt;<span class=\"built_in\">source</span> file=<span class=\"string\">'/var/lib/libvirt/images/vm2.qcow2'</span>/&gt;</span><br><span class=\"line\">40       &lt;target dev=<span class=\"string\">'vda'</span> bus=<span class=\"string\">'virtio'</span>/&gt;</span><br><span class=\"line\">41       &lt;address <span class=\"built_in\">type</span>=<span class=\"string\">'pci'</span> domain=<span class=\"string\">'0x0000'</span> bus=<span class=\"string\">'0x00'</span> slot=<span class=\"string\">'0x07'</span> <span class=\"keyword\">function</span>=<span class=\"string\">'0x0'</span>/&gt;</span><br><span class=\"line\">42     &lt;/disk&gt;</span><br><span class=\"line\">43     &lt;disk <span class=\"built_in\">type</span>=<span class=\"string\">'file'</span> device=<span class=\"string\">'disk'</span>&gt;</span><br><span class=\"line\">44       &lt;driver name=<span class=\"string\">'qemu'</span> <span class=\"built_in\">type</span>=<span class=\"string\">'qcow2'</span>/&gt;</span><br><span class=\"line\">45       &lt;<span class=\"built_in\">source</span> file=<span class=\"string\">'/var/lib/libvirt/images/vm2-1.qcow2'</span>/&gt; &lt;!--修改点: 磁盘镜像名称--&gt;</span><br><span class=\"line\">46       &lt;target dev=<span class=\"string\">'vdb'</span> bus=<span class=\"string\">'virtio'</span>/&gt;  &lt;!--修改点: 物理磁盘名称--&gt;</span><br><span class=\"line\">47       &lt;address <span class=\"built_in\">type</span>=<span class=\"string\">'pci'</span> domain=<span class=\"string\">'0x0000'</span> bus=<span class=\"string\">'0x00'</span> slot=<span class=\"string\">'0x17'</span> <span class=\"keyword\">function</span>=<span class=\"string\">'0x0'</span>/&gt; &lt;!--修改点: 一定插槽值不能重复--&gt;</span><br><span class=\"line\">48     &lt;/disk&gt;</span><br><span class=\"line\"><span class=\"comment\"># 编辑了域 vm2 XML 配置。</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Step 4.修改完VM2虚拟机配置后保存<code>:wq</code>之后重启libvirtd服务, 之后采用命令启动虚拟机</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@kvm-server ~]<span class=\"comment\"># systemctl restart libvirtd.service </span></span><br><span class=\"line\">[root@kvm-server ~]<span class=\"comment\"># virsh list --all</span></span><br><span class=\"line\"> Id    名称                         状态</span><br><span class=\"line\">----------------------------------------------------</span><br><span class=\"line\"> -     vm1                            关闭</span><br><span class=\"line\"> -     vm2                            关闭</span><br><span class=\"line\">[root@kvm-server ~]<span class=\"comment\"># virsh start vm2</span></span><br><span class=\"line\">域 vm2 已开始</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2021/1/20210329213723.png\" alt=\"WeiyiGeek.VM2配置升级\" title=\"\" class=\"\">\n                <p>WeiyiGeek.VM2配置升级</p>\n            </figure>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"virtualization","path":"api/categories/virtualization.json"}],"tags":[{"name":"VirtualBox","path":"api/tags/VirtualBox.json"}]}