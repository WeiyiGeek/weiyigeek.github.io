{"title":"Alpine 系统配置记录","slug":"系统运维/Linux/系统配置/Alpine/Alpine系统配置记录","date":"2019-04-29T05:34:30.000Z","updated":"2023-01-31T02:29:10.384Z","url":"2019/4-29-194.html","path":"api/articles/2019/4-29-194.html.json","covers":["https://img.weiyigeek.top/2019/20190613172358.png"],"content":"<p>[TOC]<br><a id=\"more\"></a></p>\n<h4 id=\"0x00-快速入门\"><a href=\"#0x00-快速入门\" class=\"headerlink\" title=\"0x00 快速入门\"></a>0x00 快速入门</h4><p>Alpine 的意思是“高山的”，比如 Alpine plants高山植物，Alpine skiing高山滑雪、the alpine resort阿尔卑斯山胜地。</p>\n<p>Alpine linux 它是基于 uClibc 和 Busybox 开发的目的是以减小系统的体积和运行时资源消耗,在保持瘦身的同时Alpine Linux还提供了自己的包管理工具apk，可以在其网站上查询或者直接通过apk命令查询和安装。</p>\n<p>官网：<a href=\"https://wiki.alpinelinux.org/wiki/Alpine_Linux_package_management\" target=\"_blank\" rel=\"noopener\">https://wiki.alpinelinux.org/wiki/Alpine_Linux_package_management</a><br>软件包搜寻：<a href=\"https://pkgs.alpinelinux.org/packages\" target=\"_blank\" rel=\"noopener\">https://pkgs.alpinelinux.org/packages</a></p>\n<p><em>Alpine特点</em>：</p>\n<ul>\n<li>小巧：基于Musl libc和busybox和busybox一样小巧最小的Docker镜像只有5MB</li>\n<li>安全：面向安全应用的轻量级Linux发行版 </li>\n<li>简单：提供APK包管理工具，软件的搜索、安装、删除、升级都非常方便。</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190613172358.png\" alt=\"WeiyiGeek.镜像大小\" title=\"\" class=\"\">\n                <p>WeiyiGeek.镜像大小</p>\n            </figure>\n<p><br/></p>\n<p>Alpine应用：</p>\n<ul>\n<li>适合容器使用：由于小巧、功能完备，非常适合作为容器的基础镜像,Alpine Linux Docker镜像基于Alpine Linux操作系统</li>\n<li>适合用来做Docker镜像、路由器、防火墙、VoIP 盒子 以及服务器的操作系统</li>\n</ul>\n<p><br/><br>Alpine安装：<br>alpine Linux是一个完整的操作系统，像其他操作系统一样可以将Alpine安装到本地硬盘中<br>安装过程：<a href=\"http://blog.csdn.net/csdn_duomaomao/article/details/76053229\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/csdn_duomaomao/article/details/76053229</a></p>\n<p><br/></p>\n<p><em>注意事项</em>：</p>\n<ul>\n<li>因为 Alpine 和 Ubuntu 不是一个社区进行维护，所以软件包很多名称是不同的，这里我直接提供我已经查找修改完毕的镜像文件。</li>\n<li>alpine 的 c 库是 <code>musl libc</code> 而不是正统的 <code>glibc</code> ，另外对于一些依赖 glibc 的大型项目，像 <code>openjdk 、tomcat、rabbitmq</code> 等都不建议使用 alpine 基础镜像，因为 <code>musl libc 可能会导致 jvm 一些奇怪的问题</code>, 这也是为什么 tomcat 官方没有给出基础镜像是 alpine 的 Dockerfile 的原因。</li>\n</ul>\n<h4 id=\"0x01-Alpine的配置和使用\"><a href=\"#0x01-Alpine的配置和使用\" class=\"headerlink\" title=\"0x01 Alpine的配置和使用\"></a>0x01 Alpine的配置和使用</h4><p><em>1.网络相关文件</em><br>网络相关的文档，详细参见：<a href=\"https://wiki.alpinelinux.org/wiki/Configure_Networking\" target=\"_blank\" rel=\"noopener\">https://wiki.alpinelinux.org/wiki/Configure_Networking</a><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#主机名文件</span></span><br><span class=\"line\">/etc/hostname    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#使用新设置的主机名立刻生效,执行如下命令：</span></span><br><span class=\"line\">hostname -F /etc/hostname   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#主机IP和域名映射文件</span></span><br><span class=\"line\">/etc/hosts    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#文件内容为：</span></span><br><span class=\"line\">192.168.99.100    alpine.csdn.net</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#DNS 服务器配置文件</span></span><br><span class=\"line\">/etc/resolv.conf   </span><br><span class=\"line\"><span class=\"comment\">#文件内容为：</span></span><br><span class=\"line\">nameserver 218.2.135.1</span><br><span class=\"line\">nameserver 202.102.24.35</span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#网卡配置文件</span></span><br><span class=\"line\">/etc/network/interfaces</span><br><span class=\"line\"><span class=\"comment\">#文件内容为：</span></span><br><span class=\"line\">auto lo</span><br><span class=\"line\">iface lo inet loopback</span><br><span class=\"line\"></span><br><span class=\"line\">auto eth0</span><br><span class=\"line\">iface eth0 inet static</span><br><span class=\"line\">      address 192.168.3.166</span><br><span class=\"line\">      netmask 255.255.255.0</span><br><span class=\"line\">      gateway 192.168.3.254</span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#修改完相关配置以后，重新启动网络服务：</span></span><br><span class=\"line\">/etc/init.d/networking restart</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><em>2.软件源配置</em>：<br>官方镜像源：<a href=\"https://mirrors.alpinelinux.org/\" target=\"_blank\" rel=\"noopener\">https://mirrors.alpinelinux.org/</a><br>清华TUNA镜像源：<a href=\"https://mirror.tuna.tsinghua.edu.cn/alpine/\" target=\"_blank\" rel=\"noopener\">https://mirror.tuna.tsinghua.edu.cn/alpine/</a><br>中科大镜像源：<a href=\"http://mirrors.ustc.edu.cn/alpine/\" target=\"_blank\" rel=\"noopener\">http://mirrors.ustc.edu.cn/alpine/</a><br>阿里云镜像源：<a href=\"http://mirrors.aliyun.com/alpine/\" target=\"_blank\" rel=\"noopener\">http://mirrors.aliyun.com/alpine/</a></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#Step1.更改源</span></span><br><span class=\"line\">$ vi /etc/apk/repositories</span><br><span class=\"line\"><span class=\"comment\"># /media/cdrom/apks</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"http://mirrors.ustc.edu.cn/alpine/v3.10/main\"</span> &gt; /etc/apk/repositories</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"http://mirrors.ustc.edu.cn/alpine/v3.10/community\"</span>&gt;&gt; /etc/apk/repositories</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"http://mirrors.ustc.edu.cn/alpine/v3.8/main\"</span> &gt; /etc/apk/repositories</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"http://mirrors.ustc.edu.cn/alpine/v3.8/community\"</span>&gt;&gt; /etc/apk/repositories</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"http://dl-4.alpinelinux.org/alpine/edge/testing\"</span> &gt;&gt; /etc/apk/repositories</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.更新与安装源</span></span><br><span class=\"line\"><span class=\"comment\">#alpine 提供了非常好用的apk软件包管理工具，</span></span><br><span class=\"line\"></span><br><span class=\"line\">apk search  openssh    <span class=\"comment\">#查询openssh相关的软件包</span></span><br><span class=\"line\">apk update    <span class=\"comment\">#更新最新本地镜像源</span></span><br><span class=\"line\"></span><br><span class=\"line\">apk add [software]  <span class=\"comment\">#安装软件</span></span><br><span class=\"line\">apk add php7 --repository http://nl.alpinelinux.org/alpine/edge/testing/</span><br><span class=\"line\"></span><br><span class=\"line\">apk info [exsit_software] <span class=\"comment\">#显示已安装的软件</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#drill 命令可以替代dig和nslookup DNS查询命令</span></span><br><span class=\"line\">apk add drill</span><br></pre></td></tr></table></figure>\n<p><em>注意：</em> Alpine中软件安装包的名字可能会与其他发行版有所不同，可以在 <a href=\"https://pkgs.alpinelinux.org/packages\" target=\"_blank\" rel=\"noopener\">https://pkgs.alpinelinux.org/packages</a> 网站搜索并确定安装包的名称</p>\n<p><br></p>\n<p><em>3.开启SSH服务</em><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#安装openssh-server服务器</span></span><br><span class=\"line\">apk add openssh-server</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#修改配置文件 /etc/ssh/sshd_config，</span></span><br><span class=\"line\"><span class=\"comment\">#如果要想使用root用户远程管理，需要修改参数为：</span></span><br><span class=\"line\">PermitRootLogin yes</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#将ssh服务配置为开机自动启动</span></span><br><span class=\"line\">rc-update add sshd</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#如果你想立刻生效，可以执行命令：</span></span><br><span class=\"line\">/etc/init.d/sshd restart</span><br></pre></td></tr></table></figure></p>\n<p><em>注意事项</em>:<br>因为Alpine采用的是musl libc不是通常用的glibc，在使用DNS时Alpine（musl libc）在DNS解析文件/etc/resolv.conf中，不使用domain或search选项。<br>在使用DNS作为服务发现时要查看相应的文档来解决相关链接：<a href=\"http://gliderlabs.viewdocs.io/docker-alpine/caveats/\" target=\"_blank\" rel=\"noopener\">http://gliderlabs.viewdocs.io/docker-alpine/caveats/</a></p>\n<h3 id=\"Alpine-系统使用\"><a href=\"#Alpine-系统使用\" class=\"headerlink\" title=\"Alpine 系统使用\"></a>Alpine 系统使用</h3><p><strong>Alpine Linux 在 Proxy 环境下如何通过网络进行通信？</strong><br>描述: 在我们的alpine没有办法链接外网时而我们又需要使用apk进行更新仓库索引和下载工具, 此时我们可通过代理方式进行连接到局域网中可以上网和搭建有例如<code>squid</code>代理上网的服务。</p>\n<ul>\n<li>宿主机系统</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Alpine 代理设置</span></span><br><span class=\"line\">proxy_user=weiyigeek</span><br><span class=\"line\">proxy_pass=password</span><br><span class=\"line\">proxy_host=proxy.weiyigeek.top</span><br><span class=\"line\">proxy_port=3128</span><br><span class=\"line\"><span class=\"built_in\">export</span> http_proxy=http://<span class=\"variable\">$&#123;proxy_user&#125;</span>:<span class=\"variable\">$&#123;proxy_pass&#125;</span>@<span class=\"variable\">$&#123;proxy_host&#125;</span>:<span class=\"variable\">$&#123;proxy_port&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> https_proxy=<span class=\"variable\">$&#123;http_proxy&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> no_proxy=127.0.0.1,localhost</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 备份apk仓库文件以及更新仓库索引</span></span><br><span class=\"line\">cp /etc/apk/repositories /etc/apk/repositories.bak</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"http://mirrors.ustc.edu.cn/alpine/v3.8/main\"</span> &gt; /etc/apk/repositories</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"http://mirrors.ustc.edu.cn/alpine/v3.8/community\"</span>&gt;&gt; /etc/apk/repositories</span><br><span class=\"line\">apk update</span><br><span class=\"line\">apk add tcpdump</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Docker 镜像构建 Dockerfile 配置文件</li>\n</ul>\n<figure class=\"highlight docker\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">FROM</span> alpine:latest</span><br><span class=\"line\"><span class=\"keyword\">ARG</span> proxy_host=<span class=\"string\">\"proxy.weiyigeek.top\"</span></span><br><span class=\"line\"><span class=\"keyword\">ARG</span> proxy_port=<span class=\"string\">\"8080\"</span></span><br><span class=\"line\"><span class=\"keyword\">ARG</span> proxy_user=<span class=\"string\">\"username\"</span></span><br><span class=\"line\"><span class=\"keyword\">ARG</span> proxy_pass=<span class=\"string\">\"password\"</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> http_proxy http://$&#123;proxy_user&#125;:$&#123;proxy_pass&#125;@$&#123;proxy_host&#125;:$&#123;proxy_port&#125;</span><br><span class=\"line\"><span class=\"keyword\">ENV</span> https_proxy $&#123;http_proxy&#125;</span><br><span class=\"line\"><span class=\"keyword\">ENV</span> no_proxy <span class=\"number\">127.0</span>.<span class=\"number\">0.1</span>,localhost</span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"bash\"> apk update</span></span><br></pre></td></tr></table></figure>","comments":true,"excerpt":"[TOC]<br>","categories":[{"name":"Linux配置","path":"api/categories/Linux配置.json"}],"tags":[{"name":"Alpine","path":"api/tags/Alpine.json"}]}