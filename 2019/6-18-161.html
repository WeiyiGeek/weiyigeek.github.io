<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>🌐 udev高效、动态地管理 Linux 设备文件|WeiyiGeek Blog|唯一极客Geek-IT网络安全运维开发技术知识分享-博客站点</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="磁盘管理">
    <meta name="Description" content="WeiyiGeek-唯一极客博客站点,关注于网络安全运维,Web安全开发,IOT物联网安全开发,应用开发,分享技术学习知识与入坑解决,提升网络安全技术与自身技术能力,立志维护大众网络安全为己任,做一个对国家有用的人,为实现中华民族伟大复兴的中国梦不懈奋斗">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-头像">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                首页
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                文章分类
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                文章标签
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                文章归档
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                学习书籍
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                关于作者
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                站点导航
              </a>
            </li>
        
            <li class="">
              <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                公众账号
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                哔哩哔哩
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>udev高效、动态地管理 Linux 设备文件</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="文章头部背景">
    <div class="container fade-scale">
        <h1 class="title">udev高效、动态地管理 Linux 设备文件</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-06-18T11:35:30.000Z" itemprop="datePublished" class="page-time">
  2019-06-18
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Linux%E5%91%BD%E4%BB%A4/">Linux命令</a></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-系统运维/Linux/常用命令/系统硬件资源类命令/udev高效动态设备管理器介绍与使用"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">udev高效、动态地管理 Linux 设备文件</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-06-18 19:35:30" datetime="2019-06-18T11:35:30.000Z"  itemprop="datePublished">2019-06-18</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Linux%E5%91%BD%E4%BB%A4/">Linux命令</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h4 id="0x00-前言简介"><a href="#0x00-前言简介" class="headerlink" title="0x00 前言简介"></a>0x00 前言简介</h4><p>描述: Linux 用户常常会很难鉴别同一类型的设备名，比如 eth0, eth1, sda, sdb 等等。通过观察这些设备的内核设备名称，用户通常能知道这些是什么类型的设备，但是不知道哪一个设备是他们想要的</p>
<p>例如:在一个充斥着本地磁盘和光纤磁盘的设备名清单 (/dev/sd*) 中，用户无法以名称找到一个序列号为“35000c50000a7ef67”的磁盘。</p>
<p>在这种情况下通过<code>udev</code>就能动态地在 /dev 目录里产生自己想要的、标识性强的设备文件或者设备链接，以此帮助用户方便快捷地找到所需的设备文件。</p>
<p><br/></p>
<p><strong>Q: 什么是 udev?</strong></p>
<blockquote>
<p>答: udev 是 <code>Linux kernel 2.6</code> 系列的一个设备管理器功能,由Greg Kroah-Hartman和Kay Sievers共同开发并得到Dan Stekloff等人的帮助, 它在2012年4月 udev 被合并至 systemd;<br>udev 以守护进程的形式运行，通过侦听内核发出来的 uevent 来管理 /dev目录下的设备文件, 它替代了原来的 devfs 及 hotplug 的功能;</p>
</blockquote>
<p><br/></p>
<p><strong>Q: 为何要选择使用udev?</strong></p>
<blockquote>
<p>答: 在传统的Linux系统中 <code>/dev目录下</code> 的设备节点为一系列静态存在的文件, 而udev则<code>动态提供了在系统中实际存在的设备节点</code>, 虽然在Linux中是采用的devfs提供类似功能但是udev有更好使用的理由:</p>
<ul>
<li>udev 支持设备的固定命名而<code>并不依赖于设备插入系统的顺序</code>, 即默认的udev设置提供了存储设备的固定命名可以使用<code>其vid（vendor）、pid（device）、设备名称（model）</code>等属性或其父设备的对应属性来确认某一设备。</li>
<li>udev 完全在用户空间(user space) 执行而<code>不是像devfs在内核空间 (kernel space) 一样执行</code>, 结果就是udev将命名策略从内核中移走并可以在节点创建前用任意程序在设备属性中为设备命名。</li>
</ul>
</blockquote>
<p><br/></p>
<p><strong>运行原理:</strong></p>
<ul>
<li>1.它以守护进程的方式运行于Linux系统，并监听在新设备初始化或设备从系统中移除时，内核（通过<code>netlink socket</code>）所发出的 uevent(<code>早期的版本使用hotplug，并在/etc/hotplug.d/default添加一个链接到自身来达到目的</code>)，并通过一套规则用于匹配可发现的设备事件和属性的导出值, 该规则并可以根据<code>匹配像内核子系统、内核设备名称、设备的物理等属性或设备序列号的属性</code>, 来对设备设定一个持久的名称，而不管该设备什么时候被发现添加;</li>
<li>2.我们知道在Linux中万物皆文件而/dev目录包含了所有可能出现的设备的设备文件, 使用udev通过定义一个 udev 规则 (rule) 来产生匹配设备属性的设备文件，这些设备属性可以是内核设备名称、总线路径、厂商名称、型号、序列号或者磁盘大小等等。</li>
</ul>
<p><br/></p>
<p><strong>udev功能特点</strong></p>
<ul>
<li>1.动态管理: 当设备添加 / 删除时，udev 的守护进程侦听来自内核的 uevent，以此添加或者删除 /dev下的设备文件，所以 udev 只为已经连接的设备产生设备文件而不会在 /dev下产生大量虚无的设备文件。</li>
<li>2.自定义命名规则：通过 Linux 默认的规则文件，udev 在 /dev/ 里为所有的设备定义了内核设备名称，比如 /dev/sda、/dev/hda、/dev/fd等等。由于 udev 是在用户空间 (user space) 运行，Linux 用户可以通过自定义的规则文件，灵活地产生标识性强的设备文件名，比如 /dev/boot_disk、/dev/root_disk、/dev/color_printer等等</li>
<li>3.设定设备的权限和所有者 / 组：udev 可以按一定的条件来设置设备文件的权限和设备文件所有者 / 组。(注意<code>不同版本实现或许不同</code>)</li>
</ul>
<p><br/></p>
<p><strong>Q: 总结一句话简述udev的作用?</strong><br>答: 系统识别设备都会在/dev目录下创建设备文件与主、次设备表号等每次卸载挂载后其设备名称将会动态的变化, 对于我们来说当然不希望出现这样的情况, 它可以为设备提供持久、自定义的设备名称进行挂载到系统上便于使用者区分使用。</p>
<p><br/></p>
<p><strong>udev 工作流程图：</strong><br><figure class="image-box">
                <a rel=udev高效、动态地管理 Linux 设备文件 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200915205158.png" target="_blank" title="WeiyiGeek.流程图显示 udev 添加 / 删除设备文件的过程" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200915205158.png" alt="WeiyiGeek.流程图显示 udev 添加 / 删除设备文件的过程" title="" class=""></a>
                <p>WeiyiGeek.流程图显示 udev 添加 / 删除设备文件的过程</p>
            </figure></p>
<p><br/></p>
<p><strong>系统架构:</strong></p>
<ul>
<li>libudev函数库，可以用来获取设备的信息。</li>
<li>udevd守护进程，处于用户空间，用于管理虚拟/dev</li>
<li>udevadm管理命令，用来诊断出错情况。</li>
</ul>
<p><br/></p>
<p><strong>相关术语：</strong></p>
<ul>
<li>1.设备文件：由于本文以较通俗的方式讲解 udev，所以设备文件是泛指在 /dev/下，<code>可被应用程序用来和设备驱动交互的文件</code>。而不会特别地区分设备文件、设备节点或者设备特殊文件;</li>
<li>2.devfs：devfs是 Linux 早期的设备管理工具，已经被 udev 取代。</li>
<li>3.sysfs：sysfs是 Linux 2.6 内核里的一个虚拟文件系统 (/sys)。它<code>把设备和驱动的信息从内核的设备模块导出到用户空间 (userspace)</code>。从该文件系统中Linux 用户可以获取很多设备的属性可以帮助我们编写udev规则。</li>
<li>4.devpath：本文的 devpath是指一个设备在 sysfs文件系统 (/sys)下的相对路径，该路径包含了该设备的属性文件。udev 里的多数命令都是针对 devpath操作的。<code>例如：sda的 devpath是 /block/sda，sda2 的 devpath是 /block/sda/sda2</code></li>
<li>5.内核设备名称：设备在 sysfs里的名称，是 udev 默认使用的设备文件名。 例如:<code>udevadm info -a -n /dev/sda | grep &quot;KERNEL&quot;</code> 返回的即为内核设备名称 KERNEL==”sda”</li>
</ul>
<p><em>注意事项:</em></p>
<ul>
<li>1) 使用新版本udev的系统不能在 2.6.13 以下版本启动，除非使用noudev参数来禁用udev并使用传统的/dev来进行设备读取。 </li>
</ul>
<hr>
<h4 id="0x01-安装udev"><a href="#0x01-安装udev" class="headerlink" title="0x01 安装udev"></a>0x01 安装udev</h4><p>描述:从 Fedora3 和 Red Hat Enterprise4 开始，udev 就是默认的设备管理工具并且现在udev已经被集成到systemd中,所以常用的Linux发行版本无需另外下载安装;</p>
<p>检查1.查看系统中版本以及udev运行情况<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.CentOS</span></span><br><span class="line"><span class="variable">$yum</span> list | grep <span class="string">"libgudev1"</span></span><br><span class="line">libgudev1.i686                            219-73.el7_8.9               updates</span><br><span class="line">libgudev1.x86_64                          219-73.el7_8.9               updates</span><br><span class="line">libgudev1-devel.i686                      219-73.el7_8.9               updates</span><br><span class="line">libgudev1-devel.x86_64                    219-73.el7_8.9               updates</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.Ubuntu</span></span><br><span class="line"><span class="variable">$apt</span> list | egrep <span class="string">"^udev"</span></span><br><span class="line">udev/focal-updates,now 245.4-4ubuntu3.2 amd64 [installed,automatic]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.运行状态查看</span></span><br><span class="line">$ ps -ef | grep <span class="string">"udev"</span></span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root     15981     1  0 9月11 ?       00:00:00 /usr/lib/systemd/systemd-udevd  <span class="comment"># 已经集成到systemd中了</span></span><br><span class="line"></span><br><span class="line">$ systemctl status udev.service</span><br><span class="line">● systemd-udevd.service - udev Kernel Device Manager</span><br><span class="line">     Loaded: loaded (/lib/systemd/system/systemd-udevd.service; static; vendor preset: enabled)</span><br><span class="line">     Active: active (running) since Tue 2020-09-15 09:27:07 CST; 13h ago</span><br><span class="line">TriggeredBy: ● systemd-udevd-kernel.socket</span><br><span class="line">             ● systemd-udevd-control.socket</span><br><span class="line">       Docs: man:systemd-udevd.service(8)</span><br><span class="line">             man:udev(7)</span><br><span class="line">   Main PID: 823 (systemd-udevd)</span><br><span class="line">     Status: <span class="string">"Processing with 96 children at max"</span></span><br><span class="line">      Tasks: 1</span><br><span class="line">     Memory: 171.5M</span><br><span class="line">     CGroup: /system.slice/systemd-udevd.service</span><br><span class="line">             └─823 /lib/systemd/systemd-udevd</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="0x02-配置文件树形"><a href="#0x02-配置文件树形" class="headerlink" title="0x02 配置文件树形"></a>0x02 配置文件树形</h4><p>udev 配置目录一览:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 此处以Ubuntu 20.04 TLS 为例</span></span><br><span class="line">$ tree -l /etc/udev/</span><br><span class="line">/etc/udev/</span><br><span class="line">├── hwdb.d</span><br><span class="line">├── rules.d</span><br><span class="line">│   ├── 70-snap.snapd.rules</span><br><span class="line">│   └── ubuntu--vg-ubuntu--lv.rules</span><br><span class="line">└── udev.conf</span><br><span class="line"></span><br><span class="line">2 directories, 3 files</span><br></pre></td></tr></table></figure></p>
<p>说明1.udev 的配置文件<code>/etc/udev/udev.conf</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/udev/udev.conf  <span class="comment"># Ubuntu</span></span><br><span class="line"><span class="comment"># see udev.conf(5) for details</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># udevd is also started in the initrd.  When this file is modified you might</span></span><br><span class="line"><span class="comment"># also want to rebuild the initrd, so that it will include the modified configuration.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#udev_log=info</span></span><br><span class="line"><span class="comment">#children_max=</span></span><br><span class="line"><span class="comment">#exec_delay=</span></span><br><span class="line"><span class="comment">#event_timeout=180</span></span><br><span class="line"><span class="comment">#resolve_names=early</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>udev_root：udev 产生的设备所存放的目录，默认值是 /dev/。建议不要修改该参数，因为很多应用程序默认会从该目录调用设备文件。(<code>不建议修改</code>)</li>
<li>udev_db：udev 信息存放的数据库或者所在目录，默认值是 /dev/.udev.tdb。</li>
<li>udev_rules：udev 规则文件的名字或者所在目录，默认值是 /etc/udev/rules.d/。(<code>不建议修改</code>)</li>
<li>udev_permissions：udev 权限文件的名字或者所在目录，默认值是 /etc/udev/permissions.d/。</li>
<li>default_mode/ default_owner/ default_group：如果设备文件的权限没有在权限文件里指定，就使用该参数作为默认权限，默认值分别是：0600/root/root。</li>
<li>udev_log：syslog记录日志的级别，默认值是 err。如果改为 info 或者 debug 的话，会有冗长的 udev 日志被记录下来。</li>
</ul>
<h5 id="1-指令操作符"><a href="#1-指令操作符" class="headerlink" title="(1) 指令操作符"></a>(1) 指令操作符</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) udev指令操作符:</span></span><br><span class="line">==    <span class="comment"># 表示匹配 比较键、值，若等于，则该条件满足；</span></span><br><span class="line">!=    <span class="comment"># 表示不匹配  比较键、值，若不等于，则该条件满足；</span></span><br><span class="line">=     <span class="comment"># 指定要赋予的值 对一个键赋值；</span></span><br><span class="line">+=    <span class="comment"># 添加新值 为一个表示多个条目的键赋值。</span></span><br><span class="line">:=    <span class="comment"># 指定的值且不允许被替换 对一个键赋值，并拒绝之后所有对该键的改动</span></span><br></pre></td></tr></table></figure>
<h5 id="2-字符串替换传值"><a href="#2-字符串替换传值" class="headerlink" title="(2) 字符串替换传值"></a>(2) 字符串替换传值</h5><p>描述:当编写可能处理多个类似设备的规则时，udev的类似printf的字符串替换操作符非常有用。Linux 用户可以随意地定制 udev 规则文件的值;</p>
<p>例如：my_root_disk, my_printer 同时也可以引用下面的替换操作符：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$kernel</span>, %k：设备的内核设备名称, 例如“sda3”表示将(默认情况下)出现在/dev/sda3上的设备</span><br><span class="line"><span class="variable">$number</span>, %n: 计算设备的内核号(存储设备的分区号): e.g. <span class="string">"3"</span> <span class="keyword">for</span> /dev/sda3</span><br><span class="line"><span class="variable">$devpath</span>, %p: 设备的 devpath路径。</span><br><span class="line"><span class="variable">$id</span>, %b：设备在 devpath里的 ID 号。</span><br><span class="line"><span class="variable">$sysfs</span>&#123;file&#125;, %s&#123;file&#125;：设备的 sysfs 里 file 的内容就是设备属性值, 例如：<span class="variable">$sysfs</span>&#123;size&#125; 表示该设备 ( 磁盘 ) 的大小。</span><br><span class="line"><span class="variable">$env</span>&#123;key&#125;, %E&#123;key&#125;：一个环境变量的值。</span><br><span class="line"><span class="variable">$major</span>, %M：设备的 major 号。</span><br><span class="line"><span class="variable">$minor</span> %m：设备的 minor 号。</span><br><span class="line"><span class="variable">$result</span>, %c：PROGRAM 返回的结果。</span><br><span class="line"><span class="variable">$parent</span>, %P：父设备的设备文件名。</span><br><span class="line"><span class="variable">$root</span>, %r：udev_root的值，默认是 /dev/。</span><br><span class="line"><span class="variable">$tempnode</span>, %N：临时设备名。</span><br><span class="line">%%：符号 % 本身。</span><br><span class="line">$$：符号 $ 本身。</span><br></pre></td></tr></table></figure></p>
<p>简单实例:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.下面示例中的$kernel和$number是替换操作符的规则例子</span></span><br><span class="line"><span class="comment"># 第一个规则确保mice设备节点只出现在/dev/input目录中(默认情况下是在/dev/mice)</span></span><br><span class="line"><span class="comment"># 第二个规则确保名为loop0的设备节点在/dev/loop/0处创建，并且像往常一样在/dev/loop0处创建一个符号链接。</span></span><br><span class="line">KERNEL==<span class="string">"mice"</span>, NAME=<span class="string">"input/%k"</span></span><br><span class="line">KERNEL==<span class="string">"loop0"</span>, NAME=<span class="string">"loop/%n"</span>, SYMLINK+=<span class="string">"%k"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.该规则的执行：如果有一个内核设备名称以 sd 开头，且 SCSI ID 为 35000c50000a7ef67，则为设备文件产生一个符号链接“sda_35000c50000a7ef67”.</span></span><br><span class="line">KERNEL==<span class="string">"sd*"</span>, PROGRAM=<span class="string">"/lib/udev/scsi_id -g -s %p"</span>, \</span><br><span class="line">RESULT==<span class="string">"35000c50000a7ef67"</span>, SYMLINK=<span class="string">"%k_%c"</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="3-字符串匹配"><a href="#3-字符串匹配" class="headerlink" title="(3) 字符串匹配"></a>(3) 字符串匹配</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用shell风格的模式匹配(实际都是正则这里不过多接受了)</span></span><br><span class="line">* - match any character, zero or more <span class="built_in">times</span></span><br><span class="line">? - match any character exactly once</span><br><span class="line">[] - match any single character specified <span class="keyword">in</span> the brackets, ranges are also permitted</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.基础示例</span></span><br><span class="line"><span class="comment"># 第一个规则匹配所有软盘驱动器，并确保设备节点被放置在/dev/floppy目录中，并从默认名称创建符号链接。</span></span><br><span class="line"><span class="comment"># 第二条规则确保hiddev设备只存在于/dev/usb目录中。</span></span><br><span class="line">KERNEL==<span class="string">"fd[0-9]*"</span>, NAME=<span class="string">"floppy/%n"</span>, SYMLINK+=<span class="string">"%k"</span></span><br><span class="line">KERNEL==<span class="string">"hiddev*"</span>, NAME=<span class="string">"usb/%k"</span></span><br></pre></td></tr></table></figure>
<h5 id="4-设备文件的权限"><a href="#4-设备文件的权限" class="headerlink" title="(4) 设备文件的权限"></a>(4) 设备文件的权限</h5><p>注意在 RHEL5.3 的 udev 已经没有权限文件，所有的权限都是通过规则文件 <code>(*.rules)</code>来设置</p>
<h5 id="5-udev基本规则"><a href="#5-udev基本规则" class="headerlink" title="(5) udev基本规则"></a>(5) udev基本规则</h5><p>描述:用于精确装置匹配设备的规则常用如下:</p>
<ul>
<li>KERNEL - 匹配设备的内核名字</li>
<li>SUBSYSTEM - 匹配设备的子系统即<code>/dev/block/</code>和<code>/dev/net</code>;</li>
<li>DRIVER - 匹配设备驱动名</li>
<li>NAME - 在 /dev下产生的设备文件名</li>
<li>SYMLINK - 为 /dev/下的设备文件产生符号链接,由于 udev 只能为某个设备产生一个设备文件，所以为了不覆盖系统默认的 udev 规则所产生的文件，推荐使用符号链接。</li>
<li>ACTION - 事件 (uevent) 的行为例如add( 添加设备 )、remove( 删除设备)</li>
<li>SYSFS{filename} - 设备的 devpath 路径下，设备的属性文件“filename”里的内容; 如 <code>SYSFS{model}==“ST936701SS”</code> 表示如果设备的型号为 ST936701SS，则该设备匹配该匹配键。</li>
<li><p>ATTRS - 匹配设备的sysfs属性，或任何父设备的sysfs属性</p>
</li>
<li><p>DEVPATH - 设备的 devpath 路径。</p>
</li>
<li>ENV{key} - 环境变量。<br>ENV{key}：导入一个环境变量。</li>
<li>BUS - 设备在 devpath 里的总线名称，例如usb</li>
<li>DRIVER - 设备在 devpath 里的设备驱动名称，例如 ide-cdrom</li>
<li>ID - 设备在 devpath 里的识别号</li>
<li>PROGRAM - 调用外部命令。</li>
<li>RESULT -  外部命令 PROGRAM 的返回结果。</li>
<li>OWNER, GROUP, MODE - 为设备设定权限。</li>
</ul>
<p>简单实例:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例1.匹配键与操作符</span></span><br><span class="line">NAME = <span class="string">"udisk"</span>,      <span class="comment"># 定义设备名称</span></span><br><span class="line">SYMLINK += <span class="string">"data1"</span>,  <span class="comment"># 定义设备的别名</span></span><br><span class="line">OWNER = <span class="string">"student"</span>,   <span class="comment"># 定义设备的所有者</span></span><br><span class="line">MODE = <span class="string">"0600"</span>,       <span class="comment"># 定义设备的权限</span></span><br><span class="line">ACTION == <span class="string">"add"</span>,     <span class="comment"># 判断设备的操作动作、添加或删除设备等</span></span><br><span class="line">KERNEL == <span class="string">"sd[a-z]1"</span>, <span class="comment"># 判断设备的内核名称</span></span><br><span class="line">RUN += 程序          <span class="comment"># 为设备添加程序</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例2.如果设备的型号为 ST936701SS并且sysfs的size属性匹配234441648值,则该设备匹配该匹配键</span></span><br><span class="line">SUBSYSTEM==<span class="string">"block"</span>,SYSFS&#123;model&#125;==<span class="string">"ST936701SS"</span>,ATTR&#123;size&#125;==<span class="string">"234441648"</span>, SYMLINK+=<span class="string">"my_disk"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例3.调用外部命令 /lib/udev/scsi_id查询设备的 SCSI ID，如果返回结果为 35000c50000a7ef67，则该设备匹配该匹配键。</span></span><br><span class="line">SUBSYSTEM==<span class="string">"block"</span>,PROGRAM==<span class="string">"/lib/udev/scsi_id -g -s <span class="variable">$devpath</span>"</span>, RESULT==<span class="string">"35000c50000a7ef67"</span></span><br></pre></td></tr></table></figure></p>
<p><strong>注意事项:</strong></p>
<ul>
<li>如果没有任何规则对设备的 NAME 赋值，udev 将使用内核设备名称来产生设备文件</li>
<li>在一条规则中可以设定最多五条 SYSFS 的匹配键以及环境变量的匹配键。</li>
</ul>
<hr>
<h5 id="5-sysfs系统设备属性"><a href="#5-sysfs系统设备属性" class="headerlink" title="(5) sysfs系统设备属性"></a>(5) sysfs系统设备属性</h5><p>描述: 当我们为指定的设备设定规则时，首先需要知道该设备的属性，比如设备的序列号、磁盘大小、厂商 ID、设备路径等等。通常我们可以通过以下的方法获得：</p>
<ul>
<li>1.根据 sysfs 查找设备的信息 ( 属性 ) 来制定 udev 规则</li>
<li>2.采用udevadm命令的info子命令可以查询 udev 数据库里的设备信息。</li>
</ul>
<p>sysfs设备的信息(属性):<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) 目录表示具有相应设备节点的实际设备</span></span><br><span class="line"><span class="variable">$sudo</span> find /sys -name dev | grep <span class="string">"pci"</span></span><br><span class="line">/sys/devices/pci0000:00/0000:00:1f.2/ata10/host11/target11:0:0/11:0:0:0/scsi_generic/sg1/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:1f.2/ata10/host11/target11:0:0/11:0:0:0/block/sr0/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:1f.2/ata10/host11/target11:0:0/11:0:0:0/bsg/11:0:0:0/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:01.0/0000:01:00.0/host0/target0:2:0/0:2:0:0/scsi_generic/sg0/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:01.0/0000:01:00.0/host0/target0:2:0/0:2:0:0/block/sda/sda4/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:01.0/0000:01:00.0/host0/target0:2:0/0:2:0:0/block/sda/sda2/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:01.0/0000:01:00.0/host0/target0:2:0/0:2:0:0/block/sda/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:01.0/0000:01:00.0/host0/target0:2:0/0:2:0:0/block/sda/sda3/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:01.0/0000:01:00.0/host0/target0:2:0/0:2:0:0/block/sda/sda1/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:01.0/0000:01:00.0/host0/target0:2:0/0:2:0:0/bsg/0:2:0:0/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:1c.3/0000:03:00.0/ptp/ptp2/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:1c.3/0000:03:00.1/ptp/ptp3/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:1c.1/0000:07:00.0/0000:08:00.0/0000:09:00.0/0000:0a:00.0/graphics/fb0/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:1c.1/0000:07:00.0/0000:08:00.0/0000:09:00.0/0000:0a:00.0/i2c-0/i2c-dev/i2c-0/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:1c.1/0000:07:00.0/0000:08:00.0/0000:09:00.0/0000:0a:00.0/drm/card0/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:1a.0/usb1/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:1a.0/usb1/1-1/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:1a.0/usb1/1-1/1-1.6/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:1d.0/usb2/2-1/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:1d.0/usb2/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:02.0/0000:04:00.0/host4/port-4:1/end_device-4:1/bsg/end_device-4:1/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:02.0/0000:04:00.0/host4/port-4:0/end_device-4:0/bsg/end_device-4:0/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:02.0/0000:04:00.0/host4/bsg/sas_host4/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:1c.2/0000:02:00.0/ptp/ptp0/dev</span><br><span class="line">/sys/devices/pci0000:00/0000:00:1c.2/0000:02:00.1/ptp/ptp1/dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) 例如在我的系统上 `/sys/block/sda` 目录是我的硬盘的设备路径, 它通过 /sys/block/sda/device 符号链接链接到它的上级SCSI磁盘设备;</span></span><br><span class="line">$ cat /sys/block/sda/size</span><br><span class="line">2341994496   <span class="comment"># 在规则中可以使用ATTR&#123;size&#125;=="234441648"来标识该磁盘</span></span><br><span class="line">$ cat /sys/block/sda/dev</span><br><span class="line">8:0</span><br></pre></td></tr></table></figure></p>
<p>补充udev规则所需属性：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (0) 通过 scsi_id 查询磁盘的 SCSI_ID 的例子</span></span><br><span class="line">/usr/lib/udev/scsi_id -g -u 设备名</span><br><span class="line">scsi_id -g -s /block/sda </span><br><span class="line">35000c50000a7ef67</span><br><span class="line"></span><br><span class="line"><span class="comment"># (1) 例如：用 udevinfo 查询设备 sda 的 model 和 size 信息：</span></span><br><span class="line">udevinfo -a -p /sys/block/sda</span><br><span class="line">udevinfo -a -p /block/sda | egrep <span class="string">"model|size"</span></span><br><span class="line">SYSFS&#123;size&#125;==<span class="string">"71096640"</span></span><br><span class="line">SYSFS&#123;model&#125;==<span class="string">"ST936701SS"</span></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">udevadm info -q path -n /dev/sda</span><br><span class="line">/devices/pci0000:00/0000:00:15.0/0000:03:00.0/host1/target1:0:0/1:0:0:0/block/sda</span><br><span class="line">udevadm info -a -q $(udevadm info -q path -n /dev/sda) | </span><br><span class="line">udevadm info -a -n /dev/sda | egrep <span class="string">"model|size"</span></span><br><span class="line">  <span class="comment"># ATTR&#123;size&#125;=="104857600"</span></span><br><span class="line">  <span class="comment"># ATTRS&#123;model&#125;=="Virtual disk    "</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="0x03-UDEV规则实例"><a href="#0x03-UDEV规则实例" class="headerlink" title="0x03 UDEV规则实例"></a>0x03 UDEV规则实例</h4><p>描述:udev 配置文件是 /etc/udev/udev.conf 该文件内容中有指定udev规则存储目录形如 <code>udev_rules=&quot;/etc/udev/rules.d&quot;</code> 该指定的目录中存储一系列以.rules结束的规则文件, 每个文件处理一系列规则来帮助udev分配名字给设备文件并保证内核可以识别此设备名称。 </p>
<ul>
<li><p>(1) 规则文件由系列键-值对组成, 键值对分两类：<code>匹配键(使用操作符&quot;==&quot;,&quot;!=&quot;等</code>) 和 <code>赋值键(使用&quot;=&quot;,&quot;+=&quot;,&quot;:=&quot;等)</code>, 匹配键判断规则是否应被应用，赋值键可以被分配一到多个值。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 规则语法: 每个规则由一系列键 - 值对，这是由逗号分隔的构造</span></span><br><span class="line"><span class="comment"># 实例1.KERNEL 是匹配键，NAME 和 MODE 是赋值键</span></span><br><span class="line">KERNEL==<span class="string">"hdb"</span>, NAME=<span class="string">"my_spare_disk"</span>   </span><br><span class="line"><span class="comment"># 如果有一个设备的内核设备名称为 sda则该条件生效，执行后面的赋值：在 /dev下产生一个名为 my_root_disk的设备文件，并把设备文件的权限设为 0660。</span></span><br><span class="line">KERNEL==<span class="string">"sda"</span>, NAME=<span class="string">"my_root_disk"</span>, MODE=<span class="string">"0660"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>(2) 规则文件必须以”.rules”为后缀名, 在 RHEL 有默认的规则文件，这些默认规则文件不仅为设备产生内核设备名称，还会产生标识性强的符号链接。</p>
<ul>
<li>例如：<code>/dev/disk/by-uuid/ 16afe28a-9da0-482d-93e8-1a9474e7245c</code></li>
<li>其缺点是链接名称较长不易调用, 所以通常需要自定义规则文件以此产生易用且标识性强的设备文件或符号链接。</li>
</ul>
</li>
</ul>
<p>查看已为您的存储硬件创建的持久性名称:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ls</span> -lR /dev/disk</span><br><span class="line">/dev/disk:</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x 2 root root  60 Sep 14 08:48 by-dname</span><br><span class="line">drwxr-xr-x 2 root root 140 Sep 14 08:48 by-id</span><br><span class="line">drwxr-xr-x 2 root root 120 Sep 14 08:48 by-partuuid</span><br><span class="line">drwxr-xr-x 2 root root 180 Sep 14 08:48 by-path</span><br><span class="line"></span><br><span class="line"><span class="variable">$tree</span> -l /dev/disk</span><br><span class="line">/dev/disk</span><br><span class="line">├── by-id</span><br><span class="line">│   ├── ata-VMware_Virtual_SATA_CDRW_Drive_00000000000000000001 -&gt; ../../sr0</span><br><span class="line">│   ├── dm-name-centos-root -&gt; ../../dm-0</span><br><span class="line">│   ├── dm-name-centos-swap -&gt; ../../dm-1</span><br><span class="line">│   ├── dm-uuid-LVM-aU2d8DppVRkxbqQEFXw2K1tUjzEIAQ83cLOioKmuP4CzguVYh6jGG8qKYeQH9BLJ -&gt; ../../dm-1</span><br><span class="line">│   ├── dm-uuid-LVM-aU2d8DppVRkxbqQEFXw2K1tUjzEIAQ83pkIKVVfwHPfFSrDXwmzJgh1BD4v7yjbJ -&gt; ../../dm-0</span><br><span class="line">│   └── lvm-pv-uuid-dBw5Er-e0CA-NnE5-9EZW-PQ08-iW0e-smzxdQ -&gt; ../../sda2</span><br><span class="line">├── by-path</span><br><span class="line">│   ├── pci-0000:02:01.0-ata-1.0 -&gt; ../../sr0</span><br><span class="line">│   ├── pci-0000:03:00.0-scsi-0:0:0:0 -&gt; ../../sda</span><br><span class="line">│   ├── pci-0000:03:00.0-scsi-0:0:0:0-part1 -&gt; ../../sda1</span><br><span class="line">│   └── pci-0000:03:00.0-scsi-0:0:0:0-part2 -&gt; ../../sda2</span><br><span class="line">└── by-uuid</span><br><span class="line">    ├── b4d40c4d-2103-4825-8c1e-0d3ce53fa1a1 -&gt; ../../dm-1</span><br><span class="line">    ├── dc1ba57c-3df8-43b5-a9c6-d7410a40f598 -&gt; ../../sda1</span><br><span class="line">    └── e1e3ac22-fd97-4841-baa0-0c3e3a333f0f -&gt; ../../dm-0</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h5 id="etc-udev-udev-conf"><a href="#etc-udev-udev-conf" class="headerlink" title="/etc/udev/udev.conf"></a>/etc/udev/udev.conf</h5><p>描述:该文件为udev主配置文件一般不用进行更改,如需更改请参考udev(5)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主配置文件：/etc/udev/udev.conf</span></span><br><span class="line">  - udev_root：创建设备文件位置，默认为/dev</span><br><span class="line">  - udev_rules：udev规则文件位置，默认为/etc/udev/rules.d</span><br><span class="line">  - udev_log : syslog优先级，缺省为err</span><br><span class="line"><span class="comment"># 文件位置及格式</span></span><br><span class="line">  - /etc/udev/rules.d/&lt;rule_name&gt;.rules</span><br><span class="line"><span class="comment"># 规则格式</span></span><br><span class="line">&lt;match-key&gt;&lt;op&gt;&lt;value&gt;[,...]&lt;assignment-key&gt;&lt;op&gt;value[,...]</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h5 id="etc-udev-rules-d-lt-rule-name-gt-rules"><a href="#etc-udev-rules-d-lt-rule-name-gt-rules" class="headerlink" title="/etc/udev/rules.d/&lt;rule_name&gt;.rules"></a>/etc/udev/rules.d/&lt;rule_name&gt;.rules</h5><p>描述: 这里是存放了相关规则来指定匹配硬件设备按照何种方式进行绑定名称;</p>
<p>基础实例:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例1.匹配这是由内核建屋局并在名为设备的驱动程序是IDE磁盘。命名与默认名称的设备节点并创建一个符号链接到它命名sparedisk设备节点名称为my_spare_disk;</span></span><br><span class="line">KERNEL==<span class="string">"hdb"</span>, DRIVER==<span class="string">"ide-disk"</span>, NAME=<span class="string">"my_spare_disk"</span>, SYMLINK+=<span class="string">"sparedisk"</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例2.它创建于的/dev/CDROM 和/dev/CDROM0两个点的/dev/hdc符号链接。同样没有名称分配指定因此将使用默认的内核名称HDC</span></span><br><span class="line">KERNEL==<span class="string">"hdc"</span>, SYMLINK+=<span class="string">"cdrom cdrom0"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例3.匹配的sysfs中size属性234441648的设备创建/dev/my_disk符号连接</span></span><br><span class="line">SUBSYSTEM==<span class="string">"block"</span>, ATTR&#123;size&#125;==<span class="string">"234441648"</span>, SYMLINK+=<span class="string">"my_disk"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 实例4.子系统是一个block设备匹配设备类型大小以及scsi id匹配RESULT规则时候将为该设备创建/dev/ipsan符号连接</span></span><br><span class="line"><span class="variable">$vim</span> /etc/udev/rules.d/100-ipsan.rules	</span><br><span class="line">SUBSYSTEM==<span class="string">"block"</span>,					                       // 设备类型</span><br><span class="line">ATTR&#123;size&#125;==<span class="string">"41943040"</span>,				                     // 设备大小</span><br><span class="line">ATTRS&#123;vendor&#125;==<span class="string">"LIO-ORG "</span>,		                     // 厂家</span><br><span class="line">PROGRAM==<span class="string">"/usr/lib/udev/scsi_id  -g -u <span class="variable">$devnode</span>"</span>,  // 要执行的程序</span><br><span class="line">RESULT==<span class="string">"36001405423854f332574ae7ae493f2b0"</span>,	     // 执行程序后的结果</span><br><span class="line">SYMLINK+=<span class="string">"ipsan"</span>					                         // 别名</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例5.产生网卡设备文件的规则</span></span><br><span class="line"><span class="comment"># 该规则表示：如果存在设备的子系统为 net，并且地址 (MAC address) 为“AA:BB:CC:DD:EE:FF”，为该设备产生一个名为 public_NIC 的设备文件。</span></span><br><span class="line">SUBSYSTEM==<span class="string">"net"</span>, SYSFS&#123;address&#125;==<span class="string">"AA:BB:CC:DD:EE:FF"</span>, NAME=<span class="string">"public_NIC"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 实例6.为指定大小的磁盘产生符号链接的规则</span></span><br><span class="line"><span class="comment"># 如果存在设备的子系统为 block，并且大小为 71096640(block)，则为该设备的设备文件名产生一个名为 my_disk 的符号链接。</span></span><br><span class="line">SUBSYSTEM==<span class="string">"block"</span>, SYSFS&#123;size&#125;==<span class="string">"71096640"</span>, SYMLINK =<span class="string">"my_disk"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 实例7.通过外部命令为指定序列号的磁盘产生设备文件的规则</span></span><br><span class="line"><span class="comment"># 如果存在设备的内核设备名称是以 sd 开头 ( 磁盘设备 )，以数字结尾 ( 磁盘分区 )，并且通过外部命令查询该设备的 SCSI_ID 号为“35000c50000a7ef67”，则产生一个以 root_disk 开头，内核号码结尾的设备文件，并替换原来的设备文件（如果存在的话）。例如：产生设备名 /dev/root_disk2，替换原来的设备名 /dev/sda2。</span></span><br><span class="line">KERNEL==<span class="string">"sd*[0-9]"</span>, PROGRAM==<span class="string">"/lib/udev/scsi_id -g -s %p"</span>, \</span><br><span class="line">RESULT==<span class="string">"35000c50000a7ef67"</span>, NAME +=<span class="string">"root_disk%n"</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h5 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h5><p><strong>USB Printer</strong><br>描述:我打开我的打印机它被分配了设备节点/dev/lp0,下面我想对其进行自定义设备符号名称;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设备信息获取</span></span><br><span class="line"><span class="variable">$udevadm</span> info -a -p $(udevinfo -q path -n /dev/lp0)</span><br><span class="line">looking at device <span class="string">'/class/usb/lp0'</span>:</span><br><span class="line">  KERNEL==<span class="string">"lp0"</span></span><br><span class="line">  SUBSYSTEM==<span class="string">"usb"</span></span><br><span class="line">  DRIVER==<span class="string">""</span></span><br><span class="line">  ATTR&#123;dev&#125;==<span class="string">"180:0"</span></span><br><span class="line">looking at parent device <span class="string">'/devices/pci0000:00/0000:00:1d.0/usb1/1-1'</span>:</span><br><span class="line">  SUBSYSTEMS==<span class="string">"usb"</span></span><br><span class="line">  ATTRS&#123;manufacturer&#125;==<span class="string">"EPSON"</span></span><br><span class="line">  ATTRS&#123;product&#125;==<span class="string">"USB Printer"</span></span><br><span class="line">  ATTRS&#123;serial&#125;==<span class="string">"L72010011070626380"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># udev 规则</span></span><br><span class="line">SUBSYSTEM==<span class="string">"usb"</span>, ATTRS&#123;serial&#125;==<span class="string">"L72010011070626380"</span>, SYMLINK+=<span class="string">"epson_680"</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>USB Camera</strong><br>描述:和大多数相机一样，我的相机将自己标识为通过USB总线连接的外部硬盘使用SCSI传输。为了访问我的照片我挂载驱动器和复制图像文件到我的硬盘。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># USB Camera 设备信息</span></span><br><span class="line">udevinfo -a -p $(udevinfo -q path -n /dev/sdb1)</span><br><span class="line">looking at device <span class="string">'/block/sdb/sdb1'</span>:</span><br><span class="line">  KERNEL==<span class="string">"sdb1"</span></span><br><span class="line">  SUBSYSTEM==<span class="string">"block"</span></span><br><span class="line"></span><br><span class="line">looking at parent device <span class="string">'/devices/pci0000:00/0000:00:02.1/usb1/1-1/1-1:1.0/host6/target6:0:0/6:0:0:0'</span>:</span><br><span class="line">  KERNELS==<span class="string">"6:0:0:0"</span></span><br><span class="line">  SUBSYSTEMS==<span class="string">"scsi"</span></span><br><span class="line">  DRIVERS==<span class="string">"sd"</span></span><br><span class="line">  ATTRS&#123;rev&#125;==<span class="string">"1.00"</span></span><br><span class="line">  ATTRS&#123;model&#125;==<span class="string">"X250,D560Z,C350Z"</span></span><br><span class="line">  ATTRS&#123;vendor&#125;==<span class="string">"OLYMPUS "</span></span><br><span class="line">  ATTRS&#123;scsi_level&#125;==<span class="string">"3"</span></span><br><span class="line">  ATTRS&#123;<span class="built_in">type</span>&#125;==<span class="string">"0"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 规则</span></span><br><span class="line"><span class="comment"># 它出奇地简单:名称本身不同，因此我们可以在name字段上使用简单的模式匹配。</span></span><br><span class="line">KERNEL==<span class="string">"sd?1"</span>, SUBSYSTEMS==<span class="string">"scsi"</span>, ATTRS&#123;model&#125;==<span class="string">"X250,D560Z,C350Z"</span>, SYMLINK+=<span class="string">"camera"</span>  <span class="comment">#即/dev/camera</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>USB Hard Disk</strong><br>描述:USB硬盘可与我上面描述的USB相机相比较，然而典型的使用模式是不同的。<br>在相机的例子中我解释了我对sdb节点不感兴趣——它真正的用途只是用于分区(例如fdisk)，但我为什么要对相机进行分区!?当然如果你有一个100GB的USB硬盘，这是完全可以理解的，你可能想要分区，在这种情况下，我们可以利用udev的字符串替换:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This rule creates symlinks such as:</span></span><br><span class="line"><span class="comment"># /dev/usbhd - The fdiskable node</span></span><br><span class="line"><span class="comment"># /dev/usbhd1 - The first partition (mountable)</span></span><br><span class="line"><span class="comment"># /dev/usbhd2 - The second partition (mountable)</span></span><br><span class="line">KERNEL==<span class="string">"sd*"</span>, SUBSYSTEMS==<span class="string">"scsi"</span>, ATTRS&#123;model&#125;==<span class="string">"USB 2.0 Storage Device"</span>, SYMLINK+=<span class="string">"usbhd%n"</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>USB Card Reader</strong><br>描述:USB读卡器(CompactFlash、SmartMedia等)是另一种有不同使用要求的USB存储设备,比如下面将有节点命名:cfrdr, cfrdr1, cfrdr2, cfrdr3，…, cfrdr15。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 利用all_partitions选项，它将为规则匹配的每个块设备创建16个分区节点:</span></span><br><span class="line">KERNEL=<span class="string">"sd*"</span>, SUBSYSTEMS==<span class="string">"scsi"</span>, ATTRS&#123;model&#125;==<span class="string">"USB 2.0 CompactFlash Reader"</span>, SYMLINK+=<span class="string">"cfrdr%n"</span>, OPTIONS+=<span class="string">"all_partitions"</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>CD/DVD drives</strong><br>描述:我有两个光驱在这台电脑:一个DVD阅读器(hdc)和一个DVD重写(hdd)。我不希望这些设备节点发生变化，除非我物理上重新连接我的系统。但是为了方便许多用户喜欢使用/dev/dvd这样的设备节点。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SUBSYSTEM==<span class="string">"block"</span>, KERNEL==<span class="string">"hdc"</span>, SYMLINK+=<span class="string">"dvd"</span>, GROUP=<span class="string">"cdrom"</span></span><br><span class="line">SUBSYSTEM==<span class="string">"block"</span>, KERNEL==<span class="string">"hdd"</span>, SYMLINK+=<span class="string">"dvdrw"</span>, GROUP=<span class="string">"cdrom"</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>Network interfaces</strong><br>描述:即使网络接口是通过名称引用的，它们通常也没有与之关联的设备节点。尽管如此规则编写过程几乎是相同的。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># udevadm info -a -p /sys/class/net/eth0</span></span><br><span class="line">  looking at class device <span class="string">'/sys/class/net/eth0'</span>:</span><br><span class="line">    KERNEL==<span class="string">"eth0"</span></span><br><span class="line">    ATTR&#123;address&#125;==<span class="string">"00:52:8b:d5:04:48"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Here is my rule:</span></span><br><span class="line">KERNEL==<span class="string">"eth*"</span>, ATTR&#123;address&#125;==<span class="string">"00:52:8b:d5:04:48"</span>, NAME=<span class="string">"lan"</span></span><br></pre></td></tr></table></figure></p>
<p><em>注意事项:</em></p>
<ul>
<li>要使此规则生效需要重新加载网络驱动程序。您可以卸载并重新加载模块，或者简单地重新启动系统。您还需要重新配置您的系统，使其使用“lan”而不是“eth0”。</li>
<li>在我完全删除所有对eth0的引用之前，我在进行这个操作时遇到了一些麻烦(接口没有被重命名)。在此之后您应该能够在任何对ifconfig或类似实用程序的调用中使用“lan”而不是“eth0”;<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cat</span> /etc/sysconfig/network-scripts/ifcfg-ens192</span><br><span class="line">TYPE=<span class="string">"Ethernet"</span></span><br><span class="line">PROXY_METHOD=<span class="string">"none"</span></span><br><span class="line">BROWSER_ONLY=<span class="string">"no"</span></span><br><span class="line">BOOTPROTO=<span class="string">"static"</span></span><br><span class="line">DEFROUTE=<span class="string">"yes"</span></span><br><span class="line">IPV4_FAILURE_FATAL=<span class="string">"no"</span></span><br><span class="line">IPV6INIT=<span class="string">"yes"</span></span><br><span class="line">IPV6_AUTOCONF=<span class="string">"yes"</span></span><br><span class="line">IPV6_DEFROUTE=<span class="string">"yes"</span></span><br><span class="line">IPV6_FAILURE_FATAL=<span class="string">"no"</span></span><br><span class="line">IPV6_ADDR_GEN_MODE=<span class="string">"stable-privacy"</span></span><br><span class="line">NAME=<span class="string">"ens192"</span></span><br><span class="line">UUID=<span class="string">"78d46457-5eb7-4421-9637-ba4161637646"</span></span><br><span class="line">DEVICE=<span class="string">"ens192"</span></span><br><span class="line">ONBOOT=<span class="string">"yes"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<h5 id="Production-Examples"><a href="#Production-Examples" class="headerlink" title="Production Examples"></a>Production Examples</h5><p>生产实例1: ORACLE中ASM设备动态绑定<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 规则中写明了绑定源路径dm-*绑定磁盘的scsi id，绑定目标路径/dev/asm/hdisk00x，目标路径属组grid:asmadmin，目标路径权限066</span></span><br><span class="line"><span class="variable">$cat</span> /etc/udev/rules.d/99-oracle-asmdevices.rules </span><br><span class="line">KERNEL==<span class="string">"dm-*"</span>,ENV&#123;DM_UUID&#125;==<span class="string">"mpath-36005076xxx000000000010cb"</span>,SYMLINK+=<span class="string">"asm/hdisk001"</span>,OWNER=<span class="string">"grid"</span>,GROUP=<span class="string">"asmadmin"</span>,MODE=<span class="string">"0660"</span></span><br><span class="line">KERNEL==<span class="string">"dm-*"</span>,ENV&#123;DM_UUID&#125;==<span class="string">"mpath-36005076xxx000000000010cc"</span>,SYMLINK+=<span class="string">"asm/hdisk002"</span>,OWNER=<span class="string">"grid"</span>,GROUP=<span class="string">"asmadmin"</span>,MODE=<span class="string">"0660"</span></span><br><span class="line">KERNEL==<span class="string">"dm-*"</span>,ENV&#123;DM_UUID&#125;==<span class="string">"mpath-36005076xxx000000000010cd"</span>,SYMLINK+=<span class="string">"asm/hdisk003"</span>,OWNER=<span class="string">"grid"</span>,GROUP=<span class="string">"asmadmin"</span>,MODE=<span class="string">"0660"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行结果:</span></span><br><span class="line">[root@ybnode01 ~]<span class="comment"># ls -lrt /dev/asm/hdisk0*</span></span><br><span class="line">lrwxrwxrwx 1 root root 7 Jun 15 15:31 /dev/asm/hdisk017 -&gt; ../dm-2</span><br><span class="line">lrwxrwxrwx 1 root root 8 Jun 15 15:31 /dev/asm/hdisk002 -&gt; ../dm-13</span><br><span class="line">[root@ybnode01 ~]<span class="comment"># ls -lrt /dev/dm*</span></span><br><span class="line">brw-rw---- 1 grid asmadmin 253,  2 Jun 15 15:34 /dev/dm-2</span><br><span class="line">brw-rw---- 1 grid asmadmin 253, 13 Jun 15 15:34 /dev/dm-13</span><br></pre></td></tr></table></figure></p>
<ul>
<li>注意点:udev绑定源路径权限不变绑定目标路径/dev/asm/hdisk*的权限是root:root 777 link到dm下。<ul>
<li>在rhel7中用udev绑定磁盘后，就算udev规则中写明了权限，但目标路径权限仍然是<code>root:root 777</code>。</li>
<li>在rhel6中其权限如udev规则中的一致<code>grid:asmadmin 0660</code></li>
</ul>
</li>
</ul>
<p><br/></p>
<p>生产实例2: 在multipath中绑定了scsi id 而又在udev中再次绑定显得有些多余（但最好是这么做），在 scsi id 已绑定的前提下udev可以有如下绑定方式：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 绑定方式没有在udev规则中绑定磁盘路径与磁盘scsi id 没有生成额外的路径，仅修改了/dev/dm*的权限。</span></span><br><span class="line"><span class="comment"># 这里的udev规则只是用来绑定磁盘权限，数据库可直接使用dm*</span></span><br><span class="line"><span class="variable">$cat</span> /etc/udev/rules.d/12-dm-permissions.rules </span><br><span class="line">ENV&#123;DM_NAME&#125;==<span class="string">"dm*"</span>,OWNER:=<span class="string">"grid"</span>, GROUP:=<span class="string">"asmadmin"</span>, MODE:=<span class="string">"660"</span></span><br></pre></td></tr></table></figure></p>
<p>另外做法是在 multipath.conf 中不写明wwid和alias的对应关系，只在udev中绑定源路径dm、目标路径、scsi id权限。<br><code>虽然这种方法有效但是很难理解</code>,其缺陷是如果multipath不生成dm那也轮不到udev去绑定，所以udev一定在multipath之后，multipath没有绑定scsi id那么是不是可能会multipath在启动的时候把scsi id识别错了，这个时候udev在去绑定scsi id和dm所以我个人并不推荐这种绑定方式。</p>
<p>不同的运维人员有不同的做法但无论哪种绑定方式，最终的目的就把磁盘路径和scsi id绑定，且绑定asm要使用的asm_disk的path的权限，理解multipath和udev才可以处理异常状况。</p>
<p><em>注意事项:</em></p>
<ul>
<li>当设备名改变时在 <code>/etc/fstab</code> 里保持系统分区名称的一致性，而不会受驱动加载顺序或者磁盘标签被破坏的影响，导致操作系统启动时找不到系统分区。</li>
<li>触发udev编写的规则配置生效:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start_udev                                      <span class="comment"># RHEL6</span></span><br><span class="line">systemctl restart systemd-udev-trigger.service  <span class="comment"># RHEL7</span></span><br></pre></td></tr></table></figure></li>
<li>注：本地文件系统 ext2/3/4 xfs ，同时只能单台设备使用gfs 集群文件系统（谷歌的一个文件系统）</li>
</ul>
<hr>
<h4 id="0x04-UDEV-相关命令"><a href="#0x04-UDEV-相关命令" class="headerlink" title="0x04 UDEV 相关命令"></a>0x04 UDEV 相关命令</h4><h5 id="udevadm-命令-udev管理工具"><a href="#udevadm-命令-udev管理工具" class="headerlink" title="udevadm 命令 - udev管理工具"></a>udevadm 命令 - udev管理工具</h5><p>描述:udevadm需要命令和命令特定的选项, 它控制system-udevd的运行时行为、请求内核事件、管理事件队列，并提供简单的调试机制。</p>
<p>语法选项:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Synx</span></span><br><span class="line">udevadm [--debug] [--version] [--<span class="built_in">help</span>]</span><br><span class="line"></span><br><span class="line">udevadm info [options] [devpath]</span><br><span class="line"></span><br><span class="line">udevadm trigger [options] [devpath]</span><br><span class="line"></span><br><span class="line">udevadm settle [options]</span><br><span class="line"></span><br><span class="line">udevadm control option</span><br><span class="line"></span><br><span class="line">udevadm monitor [options]</span><br><span class="line"></span><br><span class="line">udevadm <span class="built_in">test</span> [options] devpath</span><br><span class="line"></span><br><span class="line">udevadm <span class="built_in">test</span>-builtin [options] <span class="built_in">command</span> devpath</span><br><span class="line"></span><br><span class="line"><span class="comment"># Option</span></span><br><span class="line">-d, --debug <span class="comment">#打印调试消息到标准错误</span></span><br><span class="line">-h, --<span class="built_in">help</span> <span class="comment">#打印一个简短的帮助文本并退出。</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>子命令:</p>
<ul>
<li>info ：查询udev数据库以获取设备信息(查询的可以是设备名称以/dev)或者一个sys路径。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Option</span></span><br><span class="line">-q, --query=TYPE  <span class="comment">#在数据库中查询指定类型的设备数据Valid TYPEs are: name, symlink, path, property, all.</span></span><br><span class="line"></span><br><span class="line">-p, --path=DEVPATH <span class="comment">#要查询的设备的/sys路径</span></span><br><span class="line">   <span class="comment"># e.g.  [/sys]/class/block/sda. This option is an alternative to the positional argument with a /sys/ prefix.</span></span><br><span class="line">  udevadm info --path=/class/block/sda is equivalent to udevadm info /sys/class/block/sda.</span><br><span class="line"></span><br><span class="line">-n, --name=FILE <span class="comment"># 查询的设备节点或符号链接的名称(/dev)</span></span><br><span class="line">  <span class="comment">#e.g.  [/dev]/sda. This option is an alternative to the positional argument with a /dev/ prefix.</span></span><br><span class="line">  udevadm info --name=sda is equivalent to udevadm info /dev/sda.</span><br><span class="line"></span><br><span class="line">-r, --root</span><br><span class="line">  Print absolute paths <span class="keyword">in</span> name or symlink query.</span><br><span class="line"></span><br><span class="line">-a, --attribute-walk</span><br><span class="line">  Print all sysfs properties of the specified device that can be used <span class="keyword">in</span> udev rules to match the specified device. It prints all devices along the</span><br><span class="line">  chain, up to the root of sysfs that can be used <span class="keyword">in</span> udev rules.</span><br><span class="line"></span><br><span class="line">-x, --<span class="built_in">export</span></span><br><span class="line">  Print output as key/value pairs. Values are enclosed <span class="keyword">in</span> single quotes. This takes effects only when --query=property or --device-id-of-file=FILE is specified.</span><br><span class="line"></span><br><span class="line">-P, --<span class="built_in">export</span>-prefix=NAME</span><br><span class="line">  Add a prefix to the key name of exported values. This implies --<span class="built_in">export</span>.</span><br><span class="line"></span><br><span class="line">-d, --device-id-of-file=FILE</span><br><span class="line">  Print major/minor numbers of the underlying device, <span class="built_in">where</span> the file lives on. If this is specified, all positional arguments are ignored.</span><br><span class="line"></span><br><span class="line">-e, --<span class="built_in">export</span>-db</span><br><span class="line">  Export the content of the udev database.</span><br><span class="line"></span><br><span class="line"> -e, --<span class="built_in">export</span>-db</span><br><span class="line">  Export the content of the udev database.</span><br><span class="line"></span><br><span class="line">-c, --cleanup-db</span><br><span class="line">  Cleanup the udev database.</span><br><span class="line"></span><br><span class="line">-w[SECONDS], --<span class="built_in">wait</span>-for-initialization[=SECONDS]</span><br><span class="line">  Wait <span class="keyword">for</span> device to be initialized. If argument SECONDS is not specified, the default is to <span class="built_in">wait</span> forever.</span><br></pre></td></tr></table></figure></li>
<li>trigger： 主要是用于在系统冷插拔时重放事件。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">-v, --verbose</span><br><span class="line">  Print the list of devices <span class="built_in">which</span> will be triggered.</span><br><span class="line"></span><br><span class="line">-n, --dry-run</span><br><span class="line">  Do not actually trigger the event.</span><br><span class="line"></span><br><span class="line">-t, --<span class="built_in">type</span>=TYPE</span><br><span class="line">  Trigger a specific <span class="built_in">type</span> of devices. Valid types are: devices, subsystems. The default value is devices.</span><br><span class="line"></span><br><span class="line">-c, --action=ACTION</span><br><span class="line">  Type of event to be triggered. Possible actions are <span class="string">"add"</span>, <span class="string">"remove"</span>, <span class="string">"change"</span>, <span class="string">"move"</span>, <span class="string">"online"</span>, <span class="string">"offline"</span>, <span class="string">"bind"</span>, and <span class="string">"unbind"</span>. Also, the special</span><br><span class="line">  value <span class="string">"help"</span> can be used to list the possible actions. The default value is <span class="string">"change"</span>.</span><br><span class="line"></span><br><span class="line">-s, --subsystem-match=SUBSYSTEM</span><br><span class="line">  Trigger events <span class="keyword">for</span> devices <span class="built_in">which</span> belong to a matching subsystem. This option supports shell style pattern matching. When this option is specified</span><br><span class="line">  more than once, <span class="keyword">then</span> each matching result is ORed, that is, all the devices <span class="keyword">in</span> each subsystem are triggered.</span><br><span class="line"></span><br><span class="line">-S, --subsystem-nomatch=SUBSYSTEM</span><br><span class="line">  Do not trigger events <span class="keyword">for</span> devices <span class="built_in">which</span> belong to a matching subsystem. This option supports shell style pattern matching. When this option is</span><br><span class="line">  specified more than once, <span class="keyword">then</span> each matching result is ANDed, that is, devices <span class="built_in">which</span> <span class="keyword">do</span> not match all specified subsystems are triggered.</span><br><span class="line"></span><br><span class="line">-a, --attr-match=ATTRIBUTE=VALUE</span><br><span class="line">  Trigger events <span class="keyword">for</span> devices with a matching sysfs attribute. If a value is specified along with the attribute name, the content of the attribute is</span><br><span class="line">  matched against the given value using shell style pattern matching. If no value is specified, the existence of the sysfs attribute is checked. When</span><br><span class="line">  this option is specified multiple <span class="built_in">times</span>, <span class="keyword">then</span> each matching result is ANDed, that is, only devices <span class="built_in">which</span> have all specified attributes are</span><br><span class="line">  triggered.</span><br><span class="line"></span><br><span class="line">-A, --attr-nomatch=ATTRIBUTE=VALUE</span><br><span class="line">  Do not trigger events <span class="keyword">for</span> devices with a matching sysfs attribute. If a value is specified along with the attribute name, the content of the</span><br><span class="line">  attribute is matched against the given value using shell style pattern matching. If no value is specified, the existence of the sysfs attribute is</span><br><span class="line">  checked. When this option is specified multiple <span class="built_in">times</span>, <span class="keyword">then</span> each matching result is ANDed, that is, only devices <span class="built_in">which</span> have none of the specified</span><br><span class="line">  attributes are triggered.</span><br><span class="line"> -g, --tag-match=PROPERTY</span><br><span class="line">  Trigger events <span class="keyword">for</span> devices with a matching tag. When this option is specified multiple <span class="built_in">times</span>, <span class="keyword">then</span> each matching result is ANDed, that is, devices</span><br><span class="line">  <span class="built_in">which</span> have all specified tags are triggered.</span><br><span class="line"></span><br><span class="line">-y, --sysname-match=NAME</span><br><span class="line">  Trigger events <span class="keyword">for</span> devices <span class="keyword">for</span> <span class="built_in">which</span> the last component (i.e. the filename) of the /sys path matches the specified PATH. This option supports shell</span><br><span class="line">  style pattern matching. When this option is specified more than once, <span class="keyword">then</span> each matching result is ORed, that is, all devices <span class="built_in">which</span> have any of the</span><br><span class="line">  specified NAME are triggered.</span><br><span class="line"></span><br><span class="line">--name-match=NAME</span><br><span class="line">  Trigger events <span class="keyword">for</span> devices with a matching device path. When this option is specified more than once, <span class="keyword">then</span> each matching result is ORed, that is,</span><br><span class="line">  all specified devices are triggered.</span><br><span class="line"></span><br><span class="line">-b, --parent-match=SYSPATH</span><br><span class="line">  Trigger events <span class="keyword">for</span> all children of a given device. When this option is specified more than once, <span class="keyword">then</span> each matching result is ORed, that is, all</span><br><span class="line">  children of each specified device are triggered.</span><br><span class="line"></span><br><span class="line">-w, --settle</span><br><span class="line">  Apart from triggering events, also waits <span class="keyword">for</span> those events to finish. Note that this is different from calling udevadm settle.  udevadm settle waits</span><br><span class="line">  <span class="keyword">for</span> all events to finish. This option only waits <span class="keyword">for</span> events triggered by the same <span class="built_in">command</span> to finish.</span><br><span class="line"></span><br><span class="line">--<span class="built_in">wait</span>-daemon[=SECONDS]</span><br><span class="line">  Before triggering uevents, <span class="built_in">wait</span> <span class="keyword">for</span> systemd-udevd daemon to be initialized. Optionally takes timeout value. Default timeout is 5 seconds. This is</span><br><span class="line">  equivalent to invoke invoking udevadm control --ping before udevadm trigger.</span><br></pre></td></tr></table></figure></li>
<li>settle : 监视udev事件队列，如果所有当前事件都被处理，则退出。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-t, --timeout=SECONDS</span><br><span class="line">  Maximum number of seconds to <span class="built_in">wait</span> <span class="keyword">for</span> the event queue to become empty. The default value is 120 seconds. A value of 0 will check <span class="keyword">if</span> the queue is</span><br><span class="line">  empty and always <span class="built_in">return</span> immediately.</span><br><span class="line"></span><br><span class="line">-E, --<span class="built_in">exit</span>-if-exists=FILE</span><br><span class="line">  Stop waiting <span class="keyword">if</span> file exists.</span><br></pre></td></tr></table></figure></li>
<li>control： 修改正在运行的udev守护进程的内部状态。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">-e, --<span class="built_in">exit</span></span><br><span class="line">    Signal and <span class="built_in">wait</span> <span class="keyword">for</span> systemd-udevd to <span class="built_in">exit</span>. No option except <span class="keyword">for</span> --timeout can be specified after this option. Note that systemd-udevd.service</span><br><span class="line">    contains Restart=always and so as a result, this option restarts systemd-udevd. If you want to stop systemd-udevd.service, please use the following:</span><br><span class="line">    systemctl stop systemd-udevd-control.socket systemd-udevd-kernel.socket systemd-udevd.service</span><br><span class="line"></span><br><span class="line">-l, --<span class="built_in">log</span>-priority=value</span><br><span class="line">    Set the internal <span class="built_in">log</span> level of systemd-udevd. Valid values are the numerical syslog priorities or their textual representations: emerg, alert, crit,</span><br><span class="line">    err, warning, notice, info, and debug.</span><br><span class="line"></span><br><span class="line">-s, --stop-exec-queue</span><br><span class="line">    Signal systemd-udevd to stop executing new events. Incoming events will be queued.</span><br><span class="line"></span><br><span class="line">-S, --start-exec-queue</span><br><span class="line">    Signal systemd-udevd to <span class="built_in">enable</span> the execution of events.</span><br><span class="line"></span><br><span class="line">-R, --reload</span><br><span class="line">    Signal systemd-udevd to reload the rules files and other databases like the kernel module index. Reloading rules and databases does not apply any</span><br><span class="line">    changes to already existing devices; the new configuration will only be applied to new events.</span><br><span class="line"></span><br><span class="line">-p, --property=KEY=value</span><br><span class="line">    Set a global property <span class="keyword">for</span> all events.</span><br><span class="line"></span><br><span class="line">-m, --children-max=value</span><br><span class="line">    Set the maximum number of events, systemd-udevd will handle at the same time.</span><br><span class="line"></span><br><span class="line">--ping</span><br><span class="line">    Send a ping message to systemd-udevd and <span class="built_in">wait</span> <span class="keyword">for</span> the reply. This may be useful to check that systemd-udevd daemon is running.</span><br><span class="line"></span><br><span class="line">-t, --timeout=seconds</span><br><span class="line">    The maximum number of seconds to <span class="built_in">wait</span> <span class="keyword">for</span> a reply from systemd-udevd.</span><br></pre></td></tr></table></figure></li>
<li>monitor ： 侦听内核uevents和udev规则发送的事件，并将事件的devpath打印到控制台。它可以用来分析事件计时，通过比较内核uevent和udev事件的时间戳。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-k, --kernel</span><br><span class="line">  Print the kernel uevents.</span><br><span class="line"></span><br><span class="line">-u, --udev</span><br><span class="line">  Print the udev event after the rule processing.</span><br><span class="line"></span><br><span class="line">-p, --property</span><br><span class="line">  Also <span class="built_in">print</span> the properties of the event.</span><br><span class="line"></span><br><span class="line">-s, --subsystem-match=string[/string]</span><br><span class="line">  Filter kernel uevents and udev events by subsystem[/devtype]. Only events with a matching subsystem value will pass. When this option is specified</span><br><span class="line">  more than once, <span class="keyword">then</span> each matching result is ORed, that is, all devices <span class="keyword">in</span> the specified subsystems are monitored.</span><br><span class="line"></span><br><span class="line">-t, --tag-match=string</span><br><span class="line">  Filter udev events by tag. Only udev events with a given tag attached will pass. When this option is specified more than once, <span class="keyword">then</span> each matching</span><br><span class="line">  result is ORed, that is, devices <span class="built_in">which</span> have one of the specified tags are monitored.</span><br></pre></td></tr></table></figure></li>
<li>test ：针对一个设备，在不需要 uevent 触发的情况下模拟一次 udev的运行，并输出查询规则文件的过程、所执行的行为、规则文件的执行结果。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-a, --action=ACTION</span><br><span class="line">  Type of event to be simulated. Possible actions are <span class="string">"add"</span>, <span class="string">"remove"</span>, <span class="string">"change"</span>, <span class="string">"move"</span>, <span class="string">"online"</span>, <span class="string">"offline"</span>, <span class="string">"bind"</span>, and <span class="string">"unbind"</span>. Also, the special value <span class="string">"help"</span> can be used to list the possible actions. The default</span><br><span class="line">  value is <span class="string">"add"</span>.</span><br><span class="line"></span><br><span class="line">-N, --resolve-names=early|late|never</span><br><span class="line">  Specify when udevadm should resolve names of users and groups. When <span class="built_in">set</span> to early (the default), names will be resolved when the rules are parsed. When <span class="built_in">set</span> to late, names will be resolved <span class="keyword">for</span> every event. When <span class="built_in">set</span> to</span><br><span class="line">  never, names will never be resolved and all devices will be owned by root.</span><br></pre></td></tr></table></figure></li>
<li>test-builtin :  为设备DEVPATH运行内置的命令命令，并打印调试输出。</li>
</ul>
<p><br></p>
<p>简单实例:<br><strong>monitor 子命令</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 实例1.UDEV事件监控实时监控内核所处理的事件，比如添加/移除一块设备会提示相对应的信息</span></span><br><span class="line">udevadm monitor -u         <span class="comment"># 在规则处理之后打印udev事件。</span></span><br><span class="line">udevadm monitor --property <span class="comment"># 还要打印事件的属性。</span></span><br><span class="line">udevadm monitor -k         <span class="comment"># 内核 uevent 事件信息查看</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>info 子命令</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 实例2.查看磁盘设备在内核中的属性(替代udevinfo命令)</span></span><br><span class="line"><span class="variable">$udevadm</span> info -a -p /sys/block/sda</span><br><span class="line"><span class="comment"># looking at device '/devices/pci0000:00/0000:00:15.0/0000:03:00.0/host1/target1:0:0/1:0:0:0/block/sda':</span></span><br><span class="line"><span class="comment"># looking at parent device '/devices/pci0000:00/0000:00:15.0/0000:03:00.0/host1/target1:0:0/1:0:0:0':</span></span><br><span class="line"><span class="comment">#   KERNELS=="1:0:0:0"</span></span><br><span class="line"><span class="comment">#   SUBSYSTEMS=="scsi"</span></span><br><span class="line"><span class="comment">#   DRIVERS=="sd"</span></span><br><span class="line"><span class="comment"># looking at parent device '/devices/pci0000:00/0000:00:15.0/0000:03:00.0/host1/target1:0:0':</span></span><br><span class="line"><span class="comment">#   KERNELS=="target1:0:0"</span></span><br><span class="line"><span class="comment">#   SUBSYSTEMS=="scsi"</span></span><br><span class="line"><span class="comment">#   DRIVERS==""</span></span><br><span class="line"><span class="comment"># looking at parent device '/devices/pci0000:00/0000:00:15.0/0000:03:00.0/host1':</span></span><br><span class="line"><span class="comment">#   KERNELS=="host1"</span></span><br><span class="line"><span class="comment">#   SUBSYSTEMS=="scsi"</span></span><br><span class="line"><span class="comment">#   DRIVERS==""</span></span><br><span class="line"><span class="comment"># looking at parent device '/devices/pci0000:00/0000:00:15.0/0000:03:00.0':</span></span><br><span class="line"><span class="comment">#   KERNELS=="0000:03:00.0"</span></span><br><span class="line"><span class="comment">#   SUBSYSTEMS=="pci"</span></span><br><span class="line"><span class="comment">#   DRIVERS=="vmw_pvscsi"</span></span><br><span class="line"><span class="comment"># looking at parent device '/devices/pci0000:00/0000:00:15.0':</span></span><br><span class="line"><span class="comment">#   KERNELS=="0000:00:15.0"</span></span><br><span class="line"><span class="comment">#   SUBSYSTEMS=="pci"</span></span><br><span class="line"><span class="comment">#   DRIVERS=="pcieport"</span></span><br><span class="line"><span class="comment"># looking at parent device '/devices/pci0000:00':</span></span><br><span class="line"><span class="comment">#   KERNELS=="pci0000:00"</span></span><br><span class="line"><span class="comment">#   SUBSYSTEMS==""</span></span><br><span class="line"><span class="comment">#   DRIVERS==""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 实例3.为已经存在的设备节点编写规则可以直接使用以下属性</span></span><br><span class="line"><span class="variable">$udevadm</span> info -n /dev/sda</span><br><span class="line"><span class="comment"># P: /devices/pci0000:00/0000:00:10.0/host32/target32:0:0/32:0:0:0/block/sda</span></span><br><span class="line"><span class="comment"># N: sda</span></span><br><span class="line"><span class="comment"># L: 0</span></span><br><span class="line"><span class="comment"># S: disk/by-path/pci-0000:00:10.0-scsi-0:0:0:0</span></span><br><span class="line"><span class="comment"># E: DEVPATH=/devices/pci0000:00/0000:00:10.0/host32/target32:0:0/32:0:0:0/block/sda</span></span><br><span class="line"><span class="comment"># E: DEVNAME=/dev/sda</span></span><br><span class="line"><span class="comment"># E: DEVTYPE=disk</span></span><br><span class="line"><span class="comment"># E: MAJOR=8</span></span><br><span class="line"><span class="comment"># E: MINOR=0</span></span><br><span class="line"><span class="comment"># E: SUBSYSTEM=block</span></span><br><span class="line"><span class="comment"># E: USEC_INITIALIZED=2120529</span></span><br><span class="line"><span class="comment"># E: SCSI_TPGS=0</span></span><br><span class="line"><span class="comment"># E: SCSI_TYPE=disk</span></span><br><span class="line"><span class="comment"># E: SCSI_VENDOR=VMware</span></span><br><span class="line"><span class="comment"># E: SCSI_VENDOR_ENC=VMware\x20\x20</span></span><br><span class="line"><span class="comment"># E: SCSI_MODEL=Virtual_disk</span></span><br><span class="line"><span class="comment"># E: SCSI_MODEL_ENC=Virtual\x20disk\x20\x20\x20\x20</span></span><br><span class="line"><span class="comment"># E: SCSI_REVISION=1.0</span></span><br><span class="line"><span class="comment"># E: ID_SCSI=1</span></span><br><span class="line"><span class="comment"># E: ID_VENDOR=VMware</span></span><br><span class="line"><span class="comment"># E: ID_VENDOR_ENC=VMware\x20\x20</span></span><br><span class="line"><span class="comment"># E: ID_MODEL=Virtual_disk</span></span><br><span class="line"><span class="comment"># E: ID_MODEL_ENC=Virtual\x20disk\x20\x20\x20\x20</span></span><br><span class="line"><span class="comment"># E: ID_REVISION=1.0</span></span><br><span class="line"><span class="comment"># E: ID_TYPE=disk</span></span><br><span class="line"><span class="comment"># E: MPATH_SBIN_PATH=/sbin</span></span><br><span class="line"><span class="comment"># E: ID_BUS=scsi</span></span><br><span class="line"><span class="comment"># E: ID_PATH=pci-0000:00:10.0-scsi-0:0:0:0</span></span><br><span class="line"><span class="comment"># E: ID_PATH_TAG=pci-0000_00_10_0-scsi-0_0_0_0</span></span><br><span class="line"><span class="comment"># E: ID_PART_TABLE_UUID=36f4f6a3-6312-408e-8497-a333afa589f7</span></span><br><span class="line"><span class="comment"># E: ID_PART_TABLE_TYPE=gpt</span></span><br><span class="line"><span class="comment"># E: DEVLINKS=/dev/disk/by-path/pci-0000:00:10.0-scsi-0:0:0:0</span></span><br><span class="line"><span class="comment"># E: TAGS=:systemd:</span></span><br><span class="line"><span class="variable">$udevadm</span> info -q path -n /dev/sda</span><br><span class="line">/devices/pci0000:00/0000:00:10.0/host32/target32:0:0/32:0:0:0/block/sda</span><br><span class="line"><span class="variable">$udevadm</span> info -a -p $(udevadm info -q path -n /dev/sda)  <span class="comment"># 效果同2</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>control 子命令</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 判断守护进程是否在线</span></span><br><span class="line">sudo udevadm control --ping</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>test 子命令</strong><br>描述:通常使用来调试规则文件;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.由于 udevtest是扫描所有的规则文件 ( 包括系统自带的规则文件 )，所以会产生冗长的输出。为了让读者清楚地了解 udevtest，本例只在规则目录里保留一条规则：</span></span><br><span class="line">$ vim /etc/udev/rules.d/99-test.rules</span><br><span class="line">KERNEL==<span class="string">"sd*"</span>, PROGRAM=<span class="string">"/lib/udev/scsi_id -g -s %p"</span>, RESULT==<span class="string">"35000c50000a7ef67"</span>, \</span><br><span class="line">NAME=<span class="string">"root_disk%n"</span>, SYMLINK=<span class="string">"symlink_root_disk%n"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从 test 的执行过程可以看出，test对 sda 执行了外部命令 scsi_id, 得到的 stdout 和规则文件里的 RESULT 匹配，所以该规则匹配。然后 ( 模拟 ) 产生设备文件 /dev/root_disk和符号链接 /dev/symlink_root_disk，并为其设定权限。</span></span><br><span class="line">$ udevadm <span class="built_in">test</span> /block/sda </span><br><span class="line"><span class="comment"># main: looking at device '/block/sda' from subsystem 'block'</span></span><br><span class="line"><span class="comment"># run_program: '/lib/udev/scsi_id -g -s /block/sda'</span></span><br><span class="line"><span class="comment"># run_program: '/lib/udev/scsi_id' (stdout) '35000c50000a7ef67'</span></span><br><span class="line"><span class="comment"># run_program: '/lib/udev/scsi_id' returned with status 0 </span></span><br><span class="line"><span class="comment"># udev_rules_get_name: reset symlink list </span></span><br><span class="line"><span class="comment"># udev_rules_get_name: add symlink 'symlink_root_disk'</span></span><br><span class="line"><span class="comment"># udev_rules_get_name: rule applied, 'sda' becomes 'root_disk'</span></span><br><span class="line"><span class="comment"># udev_device_event: device '/block/sda' already in database, \</span></span><br><span class="line"><span class="comment">#                  validate currently present symlinks </span></span><br><span class="line"><span class="comment"># udev_node_add: creating device node '/dev/root_disk', major = '8', \</span></span><br><span class="line"><span class="comment">#            minor = '0', mode = '0660', uid = '0', gid = '0'</span></span><br><span class="line"><span class="comment"># udev_node_add: creating symlink '/dev/symlink_root_disk' to 'root_disk'</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="udevinfo-显示sysfs的设备路径相关属性信息-deprecated"><a href="#udevinfo-显示sysfs的设备路径相关属性信息-deprecated" class="headerlink" title="udevinfo - 显示sysfs的设备路径相关属性信息 (deprecated)"></a>udevinfo - 显示sysfs的设备路径相关属性信息 (deprecated)</h5><p>描述:该命令用来构建udev规则的最直接方便的工具,现已经被系统整合进入udevadm形成了子命令,但是对于一些老系统仍然存在以下命令;</p>
<p>基础示例:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$udevinfo</span> -a -p /sys/block/sda</span><br><span class="line">looking at device <span class="string">'/block/sda'</span>:</span><br><span class="line">  KERNEL==<span class="string">"sda"</span></span><br><span class="line">  SUBSYSTEM==<span class="string">"block"</span></span><br><span class="line">  ATTR&#123;<span class="built_in">stat</span>&#125;==<span class="string">"  128535     2246  2788977   766188    73998   317300  3132216  5735004        0   516516  6503316"</span></span><br><span class="line">  ATTR&#123;size&#125;==<span class="string">"234441648"</span></span><br><span class="line">  ATTR&#123;removable&#125;==<span class="string">"0"</span></span><br><span class="line">  ATTR&#123;range&#125;==<span class="string">"16"</span></span><br><span class="line">  ATTR&#123;dev&#125;==<span class="string">"8:0"</span></span><br><span class="line"></span><br><span class="line">looking at parent device <span class="string">'/devices/pci0000:00/0000:00:07.0/host0/target0:0:0/0:0:0:0'</span>:</span><br><span class="line">  KERNELS==<span class="string">"0:0:0:0"</span></span><br><span class="line">  SUBSYSTEMS==<span class="string">"scsi"</span></span><br><span class="line">  DRIVERS==<span class="string">"sd"</span></span><br><span class="line">  ATTRS&#123;ioerr_cnt&#125;==<span class="string">"0x0"</span></span><br><span class="line">  ATTRS&#123;iodone_cnt&#125;==<span class="string">"0x31737"</span></span><br><span class="line">  ATTRS&#123;iorequest_cnt&#125;==<span class="string">"0x31737"</span></span><br><span class="line">  ATTRS&#123;iocounterbits&#125;==<span class="string">"32"</span></span><br><span class="line">  ATTRS&#123;timeout&#125;==<span class="string">"30"</span></span><br><span class="line">  ATTRS&#123;state&#125;==<span class="string">"running"</span></span><br><span class="line">  ATTRS&#123;rev&#125;==<span class="string">"3.42"</span></span><br><span class="line">  ATTRS&#123;model&#125;==<span class="string">"ST3120827AS     "</span></span><br><span class="line">  ATTRS&#123;vendor&#125;==<span class="string">"ATA     "</span></span><br><span class="line">  ATTRS&#123;scsi_level&#125;==<span class="string">"6"</span></span><br><span class="line">  ATTRS&#123;<span class="built_in">type</span>&#125;==<span class="string">"0"</span></span><br><span class="line">  ATTRS&#123;queue_type&#125;==<span class="string">"none"</span></span><br><span class="line">  ATTRS&#123;queue_depth&#125;==<span class="string">"1"</span></span><br><span class="line">  ATTRS&#123;device_blocked&#125;==<span class="string">"0"</span></span><br><span class="line"></span><br><span class="line">looking at parent device <span class="string">'/devices/pci0000:00/0000:00:07.0'</span>:</span><br><span class="line">  KERNELS==<span class="string">"0000:00:07.0"</span></span><br><span class="line">  SUBSYSTEMS==<span class="string">"pci"</span></span><br><span class="line">  DRIVERS==<span class="string">"sata_nv"</span></span><br><span class="line">  ATTRS&#123;vendor&#125;==<span class="string">"0x10de"</span></span><br><span class="line">  ATTRS&#123;device&#125;==<span class="string">"0x037f"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用udevinfo来为你查找设备路径对于已经存在的设备节点编写规则</span></span><br><span class="line">udevinfo -a -p $(udevinfo -q path -n /dev/sda)</span><br></pre></td></tr></table></figure></p>
<p>Tips:可依据其编写udev规则及其注意点<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.udevinfo 只生成一个属性列表，您可以在udev规则中作为匹配键使用。</span></span><br><span class="line">SUBSYSTEM==<span class="string">"block"</span>, ATTR&#123;size&#125;==<span class="string">"234441648"</span>, NAME=<span class="string">"my_hard_disk"</span></span><br><span class="line">SUBSYSTEM==<span class="string">"block"</span>, SUBSYSTEMS==<span class="string">"scsi"</span>, ATTRS&#123;model&#125;==<span class="string">"ST3120827AS"</span>, NAME=<span class="string">"my_hard_disk"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.以下规则无效因为它试图匹配来自两个父设备的属性(不能进行设备关联匹配):</span></span><br><span class="line">SUBSYSTEM==<span class="string">"block"</span>, ATTRS&#123;model&#125;==<span class="string">"ST3120827AS"</span>, DRIVERS==<span class="string">"sata_nv"</span>, NAME=<span class="string">"my_hard_disk"</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="本章小结"><a href="#本章小结" class="headerlink" title="本章小结"></a>本章小结</h4><p>描述: udev 是高效的设备管理工具，其最大的优势是动态管理设备和自定义设备的命名规则，因此替代 devfs 成为 Linux 默认的设备管理工具。</p>
<p>上文主要描述了Linux 用户能够了解到 udev 的工作原理和流程，灵活地运用 udev 规则文件，从而方便地管理 Linux 设备文件。</p>
<p>在udev规则中可以规定了系统所有设备绑定的条件当匹配则按照就规则创建符号链接, 在日常使用并不要您全部进行绑定而是按照需求绑定即可;</p>
<p><strong>参考连接</strong></p>
<ul>
<li>如何编写udev规则:<a href="http://www.reactivated.net/writing_udev_rules.html" target="_blank" rel="noopener">http://www.reactivated.net/writing_udev_rules.html</a></li>
<li>udev规则：<a href="https://www.ibm.com/developerworks/cn/linux/l-cn-udev/index.html" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/linux/l-cn-udev/index.html</a></li>
</ul>

        </div>
        
  <hr>
  <p> 欢迎各位志同道合的朋友一起学习交流，如文章有误请在下方留下您宝贵的经验知识，个人邮箱地址<b style="color:#ff654e"><code>【master#weiyigeek.top】</code></b>或者个人公众号<b style="color:#ff654e"><code>【WeiyiGeek】</code></b>联系我。 </p>

  <p> 更多文章来源于<b style="color:#03a9f4">【WeiyiGeek Blog - 为了能到远方，脚下的每一步都不能少】</b>, 个人首页地址( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>

  <p>专栏书写不易，如果您觉得这个专栏还不错的，请给这篇专栏 <b style="color: red;">【点个赞、投个币、收个藏、关个注，转个发】(人间五大情)</b>，这将对我的肯定，谢谢！。</p>

  <div>
    <img src="https://www.weiyigeek.top/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"【点个赞】，动动你那粗壮的拇指或者芊芊玉手，亲！"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"【投个币】，万水千山总是情，投个硬币行不行，亲！")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("【收个藏】，阅后即焚不吃灰，亲！")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("【转个发】，让更多的志同道合的朋友一起学习交流，亲！")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("【关个注】，后续浏览查看不迷路哟，亲！")</span></p>
    </li>
  </ul>

  <div>
    <img src="/img/wechat-search.png" class="img-responsive" alt="扫描Follow(关注)WeiyiGeek公众号"  width="380" height="170">
    <img src="/img/wechat-app.png" class="img-responsive" alt="扫描Visit(浏览)极客全栈修炼小程序"  width="385" height="170">
  </div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    最后更新时间：<time datetime="2022-03-29T05:39:06.307Z" itemprop="dateUpdated">2022-03-29 13:39:06</time>
</span><br>


        <span>文章原始路径：<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/系统运维/Linux/常用命令/系统硬件资源类命令/udev高效动态设备管理器介绍与使用.md" target="_blank" rel="noopener noreferrer">_posts/系统运维/Linux/常用命令/系统硬件资源类命令/udev高效动态设备管理器介绍与使用.md</a></span><br>
         <span class="copy-copyright">转载注明出处，原文地址：<a href="/2019/6-18-161.html" target="_blank" rel="external">https://blog.weiyigeek.top/2019/6-18-161.html</a></span><br>本站文章内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">👍 钟意作者</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/" rel="tag">磁盘管理</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/6-18-161.html&title=《udev高效、动态地管理 Linux 设备文件》 — WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/6-18-161.html&title=《udev高效、动态地管理 Linux 设备文件》 — WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/6-18-161.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《udev高效、动态地管理 Linux 设备文件》 — WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/6-18-161.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/6-18-161.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- 评论组件 -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/6-18-93.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Linux下安装Oracle11gR2</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/6-17-160.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">磁盘和移动存储常用命令</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x00-前言简介"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 前言简介</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x01-安装udev"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 安装udev</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x02-配置文件树形"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 配置文件树形</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x03-UDEV规则实例"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 UDEV规则实例</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x04-UDEV-相关命令"><span class="post-toc-number">5.</span> <span class="post-toc-text">0x04 UDEV 相关命令</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#本章小结"><span class="post-toc-number">6.</span> <span class="post-toc-text">本章小结</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

  <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        如果此篇文章对您有帮助，还请支持一下博主哟, 谢谢各位看友♥!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="228" height="228" alt="打赏二维码">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="228" height="228" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>

  
 <!-- 微信公众号关注/文章版权复制 -->

  <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">你好朋友,可以关个注吗? ❤ <br> 这将是我持续更新文章的动力源泉，谢谢支持！(๑′ᴗ‵๑) </b> <br> 如不想关注请点击右上角的【X】<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">【My Twitter】</a></strong>. There is an article verification code in the homepage.
<br>方式2.请访问本博主的B站<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">【WeiyiGeek】</a></strong>首页关注UP主,<br>将自动随机获取解锁验证码。
<br>方式3.扫一扫下方二维码，关注本站<strong>官方公众号</strong><br>
回复：<strong style="color: rgb(240, 65, 52);">验证码</strong>
将获取<strong style="color: rgb(240, 65, 52);">解锁(有效期7天)</strong>本站所有技术文章哟!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="请输入验证码|Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">提
    交</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - 为了能到远方，脚下的每一步都不能少</p>
</div>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">公众账号</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">哔哩哔哩专栏</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">个人Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">个人Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">个人知乎</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">博客园</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">今日头条</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">简书</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">腾讯云+云社区</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">百度文库</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">IT极客知识分享</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTO博客</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">掘金</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">微博文章</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">小红书</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">抖音主页</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">快手主页</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.唯一极客IT知识分享 版权所有 </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>访问统计
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-站点地图">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-百度站点地图">站点地图</a> </span>
        <!-- 
  -->
        <br/>ICP备案号<span><a href="https://beian.miit.gov.cn" target="_blank">渝ICP备2022003447号</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSL安全认证" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/6-18-161.html&title=《udev高效、动态地管理 Linux 设备文件》 — WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/6-18-161.html&title=《udev高效、动态地管理 Linux 设备文件》 — WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/6-18-161.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《udev高效、动态地管理 Linux 设备文件》 — WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/6-18-161.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/6-18-161.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACK0lEQVR42u3ay26DQAwF0Pz/T6frqoJc21CFmcOqStDAycL16/WKr/fB9ffbo/uPzjx6yuuOCwMD47GM9+nVu+f8k3NS9bkYGBj7MPKjzx+Wh+nknDxYY2BgYFQD4iQEY2BgYNzBOD8nCcpfEXAxMDC+npGEzuT+vNGWtOduqcUxMDAeyMi77v//9y3zDQwMjEcxeqEzGT0mzbjJm/w6EwMDY2lGHuAmzf28oO29DwYGxtqMq8rUJAT3GnDRJxgYGEszJssT+TCglz42000MDIxFGdemcfMlsIsnsRgYGEsw8pt6xWc+1Oz9EBgYGDszqgXqVSOEfIBaHm1iYGA8ljFfemhOJK4N8RgYGIsyqulXMjxIwmt1kPDhHAwMjA0YeRKWvHqebibPam6LYGBgLMSohrbeAlmv0VYeA2BgYCzKmAfcfAhaDeKF8ScGBsbSjN4CRDXKVYP16H8FBgbGcoy8fdYbZE7WUgtpIgYGxtKMJDmrBtxJQjlZ48DAwNiBUR09VgNunjj2WnUYGBi7MSav1StH8/UODAyMnRm9xayrgmyvOfhKMlAMDIyHM97F69rljPxH+RB8MTAwlmb01sXyZYt8JNBLE5vTWgwMjAcyemVqkrRVB5yTkI2BgbEDo7qkNUkfCxV2fhoGBgbGRclfdZmjUB5jYGBgtBpqSaCsLnB8KGIxMDCWZiRFbLW4nYTXG9ttGBgYD2SMNjXiO6tFb9KAw8DA2IDxA+3+aphz4LgvAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 



  


<script>
  var _hmt = _hmt || [];
  (function() {
    // 百度统计
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-关注于网络安全_物联网安全开发_网络安全运维-学习心得分享';
                clearTimeout(titleTime);
            } else {
                document.title = '(つェ⊂)咦!又好了!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 
     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>
