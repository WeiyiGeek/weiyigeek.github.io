{"title":"性能监控与优化命令","slug":"系统运维/Linux/常用命令/基础运维配置/性能监控工具命令","date":"2020-03-31T11:35:30.000Z","updated":"2022-03-29T05:39:06.307Z","url":"2020/3-31-146.html","path":"api/articles/2020/3-31-146.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190611164458.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-性能监控\"><a href=\"#0x00-性能监控\" class=\"headerlink\" title=\"0x00 性能监控\"></a>0x00 性能监控</h4><h5 id=\"iostat-命令\"><a href=\"#iostat-命令\" class=\"headerlink\" title=\"iostat 命令\"></a>iostat 命令</h5><p>描述:Linux系统中的 iostat是I/O statistics（输入/输出统计）的缩写,该工具对系统的磁盘操作活动进行监视（IO负载）；通过iostat方便<code>查看CPU、网卡、tty设备、磁盘、CD-ROM</code> 等等设备的活动情况, 负载信息。</p>\n<p>特点:</p>\n<ul>\n<li>1.汇报磁盘活动统计情况，同时也会汇报出CPU使用情况</li>\n<li>2.<code>同vmstat一样iostat也有一个弱点</code>，就是它不能对某个进程进行深入分析，仅对系统的整体情况进行分析</li>\n</ul>\n<p>iostat属于sysstat软件包<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y sysstat</span><br></pre></td></tr></table></figure></p>\n<p>命令格式：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iostat[参数][时间][次数]</span><br><span class=\"line\">iostat [ -c ] [ -d ] [ -h ] [ -N ] [ -k | -m ] [ -t ] [ -V ] [ -x ] [ -z ] [ device [...] | ALL ] [ -p [ device [,...] | ALL ] ] [ interval [ count ] ]</span><br></pre></td></tr></table></figure></p>\n<p>命令参数：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-C 显示CPU使用情况</span><br><span class=\"line\">-d 显示磁盘使用情况</span><br><span class=\"line\">-k 以 KB 为单位显示</span><br><span class=\"line\">-m 以 M 为单位显示</span><br><span class=\"line\">-N 显示磁盘阵列(LVM) 信息</span><br><span class=\"line\">-n 显示NFS 使用情况</span><br><span class=\"line\">-p[磁盘] 显示磁盘和分区的情况</span><br><span class=\"line\">-t 显示终端和CPU的信息</span><br><span class=\"line\">-x 显示详细信息</span><br><span class=\"line\">-V 显示版本信息</span><br></pre></td></tr></table></figure></p>\n<p>基础示例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1.显示所有设备负载情况</span></span><br><span class=\"line\">$ iostat</span><br><span class=\"line\">Linux 3.10.0-693.el7.x86_64 (weiyigeek)         04/12/2020      _x86_64_        (16 CPU)</span><br><span class=\"line\"><span class=\"comment\"># avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span></span><br><span class=\"line\"><span class=\"comment\">#            0.02    0.00    0.01    0.00    0.00   99.96</span></span><br><span class=\"line\"><span class=\"comment\"># Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn</span></span><br><span class=\"line\"><span class=\"comment\"># vda               0.34         0.06         8.66     208182   28650151</span></span><br><span class=\"line\"><span class=\"comment\"># scd0              0.00         0.00         0.00        232          0</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#cpu属性值说明：</span></span><br><span class=\"line\">* %user：CPU处在用户模式下的时间百分比。</span><br><span class=\"line\">* %nice：CPU处在带NICE值的用户模式下的时间百分比。</span><br><span class=\"line\">* %system：CPU处在系统模式下的时间百分比。</span><br><span class=\"line\">* %iowait：CPU等待输入输出完成时间的百分比。</span><br><span class=\"line\">* %steal：管理程序维护另一个虚拟处理器时，虚拟CPU的无意识等待时间百分比。</span><br><span class=\"line\">* %idle：CPU空闲时间百分比。</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#disk属性值说明：</span></span><br><span class=\"line\">* tps：该设备每秒的传输次数（Indicate the number of transfers per second that were issued to the device.）。“一次传输”意思是“一次I/O请求”。多个逻辑请求可能会被合并为“一次I/O请求”。“一次传输”请求的大小是未知的。</span><br><span class=\"line\">* kB_read/s：每秒从设备（drive expressed）读取的数据量；</span><br><span class=\"line\">* kB_wrtn/s：每秒向设备（drive expressed）写入的数据量；</span><br><span class=\"line\">* kB_read：读取的总数据量；</span><br><span class=\"line\">* kB_wrtn：写入的总数量数据量；</span><br><span class=\"line\"></span><br><span class=\"line\">* rrqm/s:  每秒进行 merge 的读操作数目。即 rmerge/s</span><br><span class=\"line\">* wrqm/s:  每秒进行 merge 的写操作数目。即 wmerge/s</span><br><span class=\"line\">* r/s:  每秒完成的读 I/O 设备次数。即 rio/s</span><br><span class=\"line\">* w/s:  每秒完成的写 I/O 设备次数。即 wio/s</span><br><span class=\"line\">* rsec/s:  每秒读扇区数。即 rsect/s</span><br><span class=\"line\">* wsec/s:  每秒写扇区数。即 wsect/s</span><br><span class=\"line\">* rkB/s:  每秒读K字节数。是 rsect/s 的一半，因为每扇区大小为512字节。</span><br><span class=\"line\">* wkB/s:  每秒写K字节数。是 wsect/s 的一半。</span><br><span class=\"line\">* avgrq-sz:  平均每次设备I/O操作的数据大小 (扇区)。</span><br><span class=\"line\">* avgqu-sz:  平均I/O队列长度。</span><br><span class=\"line\">* await:  平均每次设备I/O操作的等待时间 (毫秒)。</span><br><span class=\"line\">* svctm: 平均每次设备I/O操作的服务时间 (毫秒)。</span><br><span class=\"line\">* %util:  一秒中有百分之多少的时间用于 I/O 操作，即被io消耗的cpu百分比</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li><p>备注：<code>如果%iowait的值过高，表示硬盘存在I/O瓶颈，%idle值高，表示CPU较空闲，如果%idle值高但系统响应慢时，有可能是CPU等待分配内存，此时应加大内存容量。%idle值如果持续低于10，那么系统的CPU处理能力相对较低，表明系统中最需要解决的资源是CPU</code>。</p>\n</li>\n<li><p>备注：<code>如果 %util 接近 100%，说明产生的I/O请求太多，I/O系统已经满负荷，该磁盘可能存在瓶颈。如果 svctm 比较接近 await，说明 I/O 几乎没有等待时间；如果 await 远大于 svctm，说明I/O 队列太长，io响应太慢，则需要进行必要优化。如果avgqu-sz比较大，也表示有当量io在等待</code>。</p>\n</li>\n<li><p>备注:<code>上面的例子中，我们可以看到磁盘vda以及它的各个分区的统计数据，当时统计的磁盘总TPS是22.73，下面是各个分区的TPS。（因为是瞬间值，所以总TPS并不严格等于各个分区TPS的总和）</code></p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#实例2：定时显示所有信息(显示3条数据且两秒刷新一次)</span></span><br><span class=\"line\"><span class=\"variable\">$iostat</span> 2 3</span><br><span class=\"line\"><span class=\"variable\">$iostat</span> -c 2 3 <span class=\"comment\">#CPU</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#实例3：显示指定磁盘信息(上面我只有一块硬盘)</span></span><br><span class=\"line\">$ iostat -d vda</span><br><span class=\"line\">$ iostat -d 1</span><br><span class=\"line\">Linux 5.4.0-47-generic (weiyigeek-104)       09/14/2020      _x86_64_        (4 CPU)</span><br><span class=\"line\">Device             tps    kB_read/s    kB_wrtn/s    kB_dscd/s    kB_read    kB_wrtn    kB_dscd</span><br><span class=\"line\"><span class=\"comment\"># dm-0              3.92         1.87        18.12         0.00     474009    4599964          0</span></span><br><span class=\"line\"><span class=\"comment\"># loop0             0.00         0.00         0.00         0.00        338          0          0</span></span><br><span class=\"line\"><span class=\"comment\"># loop1             0.01         0.01         0.00         0.00       1733          0          0</span></span><br><span class=\"line\"><span class=\"comment\"># loop2             0.00         0.00         0.00         0.00       1074          0          0</span></span><br><span class=\"line\"><span class=\"comment\"># loop3             0.00         0.00         0.00         0.00       1079          0          0</span></span><br><span class=\"line\"><span class=\"comment\"># loop4             0.05         0.05         0.00         0.00      12335          0          0</span></span><br><span class=\"line\"><span class=\"comment\"># loop5             0.00         0.00         0.00         0.00        336          0          0</span></span><br><span class=\"line\"><span class=\"comment\"># loop6             0.00         0.00         0.00         0.00          4          0          0</span></span><br><span class=\"line\"><span class=\"comment\"># sda               3.02         1.89        18.12         0.00     480510    4600068          0</span></span><br><span class=\"line\"><span class=\"comment\"># sdb               0.00         0.02         0.00         0.00       4868          4          0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#实例4：以M为单位显示tty和Cpu信息</span></span><br><span class=\"line\"><span class=\"variable\">$iostat</span> -t -m</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#实例5：查看TPS和吞吐量信息每一秒刷新共十次</span></span><br><span class=\"line\"><span class=\"variable\">$iostat</span> -d -k 1 10</span><br><span class=\"line\"><span class=\"comment\"># Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn</span></span><br><span class=\"line\"><span class=\"comment\"># vda               0.34         0.06         8.66     208258   28665138</span></span><br><span class=\"line\"><span class=\"comment\"># scd0              0.00         0.00         0.00        232          0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#实例6：-x选择获取更多统计信息查看设备使用率（%util）、响应时间（await）</span></span><br><span class=\"line\">iostat -d -x -k 1 10</span><br><span class=\"line\"><span class=\"comment\"># Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span></span><br><span class=\"line\"><span class=\"comment\"># vda               0.00     0.03    0.00    0.34     0.06     8.66    50.60     0.02   62.38    2.32   62.83   1.35   0.05</span></span><br><span class=\"line\"><span class=\"comment\"># scd0              0.00     0.00    0.00    0.00     0.00     0.00     6.54     0.00    0.51    0.51    0.00   0.51   0.00</span></span><br><span class=\"line\">* 一般idle小于70%即未正常状态</span><br><span class=\"line\">* await 与 svctm 的参数来参考，如果差的过高就一定有 IO 的问题。</span><br><span class=\"line\">* svctm 的大小一般和磁盘性能有关，CPU/内存的负荷也会对其有影响，请求过多也会间接导致 svctm 的增加</span><br><span class=\"line\">* avgqu-sz 调优时需要注意的地方 : `avgqu-sz × ( r/s or w/s ) = rsec/s or wsec/s`</span><br><span class=\"line\">* 队列长度(avgqu-sz)也可作为衡量系统 I/O 负荷的指标，但由于 avgqu-sz 是按照单位时间的平均值，所以不能反映瞬间的 I/O 洪水。</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例7.以人类的方式显示数据</span></span><br></pre></td></tr></table></figure>\n<p><strong>补充说明:</strong></p>\n<ul>\n<li>r/s+w/s 类似于交款人的总数 </li>\n<li>平均队列长度(avgqu-sz)类似于单位时间里平均排队人的个数</li>\n<li>平均服务时间(svctm)类似于收银员的收款速度</li>\n<li>平均等待时间(await)类似于平均每人的等待时间 </li>\n<li>平均I/O数据(avgrq-sz)类似于平均每人所买的东西多少</li>\n<li>I/O 操作率 (%util)类似于收款台前有人排队的时间比例</li>\n<li>设备IO操作:总IO(io)/s = r/s(读) +w/s(写) =1.46 + 25.28=26.74 </li>\n<li>平均每次设备I/O操作只需要0.36毫秒完成,现在却需要10.57毫秒完成，因为发出的请求太多(每秒26.74个)，假如请求时同时发出的，可以这样计算平均等待时间: 平均等待时间=单个I/O服务器时间*(1+2+…+请求总数-1)/请求总数;</li>\n<li>每秒发出的I/0请求很多,但是平均队列就4,表示这些请求比较均匀,大部分处理还是比较及时。</li>\n</ul>\n<p><br></p>\n<h5 id=\"lsof-命令-列出Linux所有打开的文件信息-等同于查看Linux各种信息排查故障的利器\"><a href=\"#lsof-命令-列出Linux所有打开的文件信息-等同于查看Linux各种信息排查故障的利器\" class=\"headerlink\" title=\"lsof 命令 - 列出Linux所有打开的文件信息(等同于查看Linux各种信息排查故障的利器)\"></a>lsof 命令 - 列出Linux所有打开的文件信息(等同于查看Linux各种信息排查故障的利器)</h5><p>描述:list open files是一个列出当前系统打开文件的工具用于查看你进程开打的文件/的进程，进程打开的端口(TCP、UDP)，是十分方便的系统监视工具，因为应用程序打开文件的描述符列表提供了大量关于这个应用程序本身的信息,文件描述符为应用程序与基础操作系统之间的交互提供了通用接口;</p>\n<p>在linux环境下任何事物都以<code>文件的形式存在</code>包括但不限于<code>普通文件/目录/网络文件系统的文件/字符或设备文件/(函数)共享库/管道、命名管道/符号链接/网络文件(例如:NFS file、网络socket，unix域名socket)/还有其它类型的文件</code>;</p>\n<ul>\n<li>1.普通文件</li>\n<li>2.目录</li>\n<li>3.网络文件系统的文件</li>\n<li>4.字符或设备文件</li>\n<li>5.(函数)共享库</li>\n<li>6.管道，命名管道</li>\n<li>7.符号链接</li>\n<li>8.网络文件（例如：NFS file、网络socket，unix域名socket）</li>\n<li>9.还有其它类型的文件，等等</li>\n</ul>\n<p>特点&amp;功能：</p>\n<ul>\n<li>root用户执行 (lsof命令需要访问核心内存和各种文件)</li>\n<li>恢复误删除但还在内存中的文件</li>\n<li>对系统监测以及排错</li>\n</ul>\n<p>语法命令参数格式：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#语法</span></span><br><span class=\"line\">lsof [参数][文件]</span><br><span class=\"line\">lsof [-?abhlnNoOPRtUvVX] [+|-c c] [+|-d s] [+D D] [+|-f[gG]] [+|-e s]</span><br><span class=\"line\">[-F [f]] [-g [s]] [-i [i]] [+|-L [l]] [+m [m]] [+|-M] [-o [o]] [-p s]</span><br><span class=\"line\">[+|-r [t]] [-s [p:s]] [-S [t]] [-T [t]] [-u s] [+|-w] [-x [fl]] [-Z [Z]] [--] [names]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#参数</span></span><br><span class=\"line\">-a：列出打开文件存在的进程；</span><br><span class=\"line\">-c&lt;进程名&gt;：列出指定进程所打开的文件；</span><br><span class=\"line\">-g：列出GID号进程详情；</span><br><span class=\"line\">-d&lt;文件号&gt;：列出占用该文件号的进程；</span><br><span class=\"line\">+d&lt;目录&gt;：列出目录下被打开的文件；</span><br><span class=\"line\">+D&lt;目录&gt;：递归列出目录下被打开的文件；</span><br><span class=\"line\">-n&lt;目录&gt;：列出使用NFS的文件；</span><br><span class=\"line\">-i&lt;条件&gt;：列出符合条件的进程。（4、6、协议、:端口、 @ip ）</span><br><span class=\"line\">-p&lt;进程号&gt;：列出指定进程号所打开的文件；</span><br><span class=\"line\">+L&lt;fd&gt;: 查找为链接的文件</span><br><span class=\"line\">-u：列出UID号进程详情；</span><br><span class=\"line\">-h：显示帮助信息；</span><br><span class=\"line\">-v：显示版本信息。</span><br></pre></td></tr></table></figure></p>\n<p>关键字描述:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#文件描述符列表FD</span></span><br><span class=\"line\">* cwd：表示current work dirctory，<span class=\"comment\">#即：应用程序的当前工作目录，这是该应用程序启动的目录，除非它本身对这个目录进行更改</span></span><br><span class=\"line\">* txt：<span class=\"comment\">#该类型的文件是程序代码，如应用程序二进制文件本身或共享库，如上列表中显示的 /sbin/init 程序</span></span><br><span class=\"line\">* lnn：<span class=\"comment\">#library references (AIX);</span></span><br><span class=\"line\">* er：<span class=\"comment\">#FD information error (see NAME column);</span></span><br><span class=\"line\">* jld：<span class=\"comment\">#jail directory (FreeBSD);</span></span><br><span class=\"line\">* ltx：<span class=\"comment\">#shared library text (code and data);</span></span><br><span class=\"line\">* mxx ：<span class=\"comment\">#hex memory-mapped type number xx.</span></span><br><span class=\"line\">* m86：<span class=\"comment\">#DOS Merge mapped file;</span></span><br><span class=\"line\">* mem：<span class=\"comment\">#memory-mapped file;</span></span><br><span class=\"line\">* mmap：<span class=\"comment\">#memory-mapped device;</span></span><br><span class=\"line\">* pd：<span class=\"comment\">#parent directory;</span></span><br><span class=\"line\">* rtd：<span class=\"comment\">#root directory;</span></span><br><span class=\"line\">* tr：<span class=\"comment\">#kernel trace file (OpenBSD);</span></span><br><span class=\"line\">* v86  <span class=\"comment\">#VP/ix mapped file;</span></span><br><span class=\"line\">* 0：<span class=\"comment\">#表示标准输出</span></span><br><span class=\"line\">* 1：<span class=\"comment\">#表示标准输入</span></span><br><span class=\"line\">* 2：<span class=\"comment\">#表示标准错误</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#一般在标准输出、标准错误、标准输入后还跟着文件状态模式：</span></span><br><span class=\"line\">* u：<span class=\"comment\">#表示该文件被打开并处于读取/写入模式。</span></span><br><span class=\"line\">* r：<span class=\"comment\">#表示该文件被打开并处于只读模式。</span></span><br><span class=\"line\">* w：<span class=\"comment\">#表示该文件被打开并处于写入模式。</span></span><br><span class=\"line\">* 空格：<span class=\"comment\">#表示该文件的状态模式为unknow，且没有锁定。</span></span><br><span class=\"line\">* -：<span class=\"comment\">#表示该文件的状态模式为unknow，且被锁定。</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#同时在文件状态模式后面，还跟着相关的锁：</span></span><br><span class=\"line\">* N：<span class=\"keyword\">for</span> a Solaris NFS lock of unknown <span class=\"built_in\">type</span>;</span><br><span class=\"line\">* r：<span class=\"keyword\">for</span> <span class=\"built_in\">read</span> lock on part of the file;</span><br><span class=\"line\">* R：<span class=\"keyword\">for</span> a <span class=\"built_in\">read</span> lock on the entire file;</span><br><span class=\"line\">* w：<span class=\"keyword\">for</span> a write lock on part of the file;（文件的部分写锁）</span><br><span class=\"line\">* W：<span class=\"keyword\">for</span> a write lock on the entire file;（整个文件的写锁）</span><br><span class=\"line\">* u：<span class=\"keyword\">for</span> a <span class=\"built_in\">read</span> and write lock of any length;</span><br><span class=\"line\">* U：<span class=\"keyword\">for</span> a lock of unknown <span class=\"built_in\">type</span>;</span><br><span class=\"line\">* x：<span class=\"keyword\">for</span> an SCO OpenServer Xenix lock on part      of the file;</span><br><span class=\"line\">* X：<span class=\"keyword\">for</span> an SCO OpenServer Xenix lock on the      entire file;</span><br><span class=\"line\">* space：<span class=\"keyword\">if</span> there is no lock.</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#文件类型：TYEP</span></span><br><span class=\"line\">* DIR：表示目录。</span><br><span class=\"line\">* CHR：表示字符类型。</span><br><span class=\"line\">* BLK：块设备类型。</span><br><span class=\"line\">* UNIX： UNIX 域套接字。</span><br><span class=\"line\">* FIFO：先进先出 (FIFO) 队列。</span><br><span class=\"line\">* IPv4：网际协议 (IP) 套接字。</span><br><span class=\"line\">* DEVICE：指定磁盘的名称</span><br><span class=\"line\"></span><br><span class=\"line\">SIZE：文件的大小</span><br><span class=\"line\">NODE：索引节点（文件在磁盘上的标识）</span><br><span class=\"line\">NAME：打开文件的确切名称</span><br></pre></td></tr></table></figure></p>\n<p>实际案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#示例1.lsof命令输出解释</span></span><br><span class=\"line\"><span class=\"variable\">$lsof</span></span><br><span class=\"line\"><span class=\"built_in\">command</span>     PID USER      FD      <span class=\"built_in\">type</span>             DEVICE     SIZE       NODE NAME</span><br><span class=\"line\"><span class=\"comment\"># init         1 root     txt     REG                8,2    43496    6121706 /sbin/init</span></span><br><span class=\"line\"><span class=\"comment\"># sshd      6058   root   3u      IPv4              33503      0t0        TCP localhost.localdomain:ssh-&gt;10.19.172.88:51165 (ESTABLISHED)</span></span><br><span class=\"line\"><span class=\"comment\">#lsof输出各列信息的意义如下：</span></span><br><span class=\"line\">* COMMAND：进程的名称</span><br><span class=\"line\">* PID：进程标识符</span><br><span class=\"line\">* PPID：父进程标识符（需要指定-R参数）</span><br><span class=\"line\">* FD：文件描述符，应用程序通过文件描述符识别该文件。</span><br><span class=\"line\">* USER：进程所有者</span><br><span class=\"line\">* PGID：进程所属组</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例2.查找未链接的文件</span></span><br><span class=\"line\">lsof +L 1 | head</span><br><span class=\"line\">lsof +L 2 | head</span><br><span class=\"line\"><span class=\"comment\"># COMMAND    PID    USER   FD      TYPE DEVICE  SIZE/OFF NLINK       NODE NAME</span></span><br><span class=\"line\"><span class=\"comment\"># systemd      1    root  txt       REG  253,0   1620416     1  100755256 /usr/lib/systemd/systemd</span></span><br><span class=\"line\"><span class=\"comment\"># systemd      1    root  mem       REG  253,0     20112     1      31765 /usr/lib64/libuuid.so.1.3.0</span></span><br><span class=\"line\"><span class=\"comment\"># systemd      1    root  mem       REG  253,0    265624     1      31772 /usr/lib64/libblkid.so.1.1.0</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例3.查找某个文件相关的进程</span></span><br><span class=\"line\">lsof /usr/sbin/sshd</span><br><span class=\"line\"><span class=\"comment\"># COMMAND   PID USER  FD   TYPE DEVICE SIZE/OFF     NODE NAME</span></span><br><span class=\"line\"><span class=\"comment\"># sshd     9427 root txt    REG  253,1   852856 51767854 /usr/sbin/sshd</span></span><br><span class=\"line\"><span class=\"comment\"># sshd    28834 root txt    REG  253,1   852856 51767854 /usr/sbin/sshd</span></span><br><span class=\"line\"><span class=\"comment\"># sshd    28838 root txt    REG  253,1   852856 51767854 /usr/sbin/sshd</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例4.递归查找某个目录中所有打开的文件（即被应用程序调用的文件）</span></span><br><span class=\"line\">lsof +D /usr/sbin/</span><br><span class=\"line\">lsof | grep <span class=\"string\">'/usr/sbin/'</span> <span class=\"comment\">#不使用+D选项，遍历查看某个目录的所有文件信息的方法</span></span><br><span class=\"line\"><span class=\"comment\"># COMMAND     PID   USER  FD   TYPE DEVICE SIZE/OFF     NODE NAME</span></span><br><span class=\"line\"><span class=\"comment\"># rsyslogd   2772   root txt    REG  253,1   663864 50668535 /usr/sbin/rsyslogd</span></span><br><span class=\"line\"><span class=\"comment\"># chronyd    3525 chrony txt    REG  253,1   252512 50668522 /usr/sbin/chronyd</span></span><br><span class=\"line\"><span class=\"comment\"># acpid      3624   root txt    REG  253,1    53560 50736074 /usr/sbin/acpid</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#实例5：列出某个用户打开的文件信息</span></span><br><span class=\"line\">lsof -u root</span><br><span class=\"line\">lsof -u weiyigeek |more   <span class=\"comment\">#单个用户</span></span><br><span class=\"line\">lsof -u root,weiyigeel    <span class=\"comment\">#多个用户</span></span><br><span class=\"line\">lsof -u ^root | more  <span class=\"comment\"># 列出除root用户外的所有用户打开的文件</span></span><br><span class=\"line\"><span class=\"comment\"># COMMAND    PID  TID    USER   FD      TYPE             DEVICE SIZE/OFF      NODE NAME</span></span><br><span class=\"line\"><span class=\"comment\"># dbus-daem 5113         dbus  cwd       DIR              253,0      250        64 /</span></span><br><span class=\"line\"><span class=\"comment\"># dbus-daem 5113         dbus  rtd       DIR              253,0      250        64 /</span></span><br><span class=\"line\"><span class=\"comment\"># dbus-daem 5113         dbus  txt       REG              253,0   223320 100767271 /usr/bin/dbus-daemon</span></span><br><span class=\"line\">lsof -g 5555  <span class=\"comment\">#某个用户组所打开的文件信息</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例6.查看关联文件(查找某个程序打开的所有文件)</span></span><br><span class=\"line\">lsof -c 进程名</span><br><span class=\"line\">lsof -c sshd</span><br><span class=\"line\">lsof | grep mysql</span><br><span class=\"line\">lsof -c mysql -c apache <span class=\"comment\">#列出多个进程多个打开的文件信息</span></span><br><span class=\"line\"><span class=\"comment\"># sshd    6058 root    0u   CHR                1,3      0t0      5334 /dev/null</span></span><br><span class=\"line\"><span class=\"comment\"># sshd    6058 root    1u   CHR                1,3      0t0      5334 /dev/null</span></span><br><span class=\"line\"><span class=\"comment\"># sshd    6058 root    2u   CHR                1,3      0t0      5334 /dev/null</span></span><br><span class=\"line\"><span class=\"comment\"># sshd    6058 root    3u  IPv4              33503      0t0       TCP localhost.localdomain:ssh-&gt;127.0.0.1:51165 (ESTABLISHED)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#实例7：列出某个用户以及某个进程所打开的文件信息</span></span><br><span class=\"line\">lsof -u <span class=\"built_in\">test</span> -c mysql   <span class=\"comment\">#用户与进程可相关，也可以不相关</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例8.查看进程所打开的端口及文件</span></span><br><span class=\"line\">lsof -p pid</span><br><span class=\"line\">lsof -p 22  <span class=\"comment\">#通过某个进程号显示该进行打开的文件</span></span><br><span class=\"line\"><span class=\"comment\"># COMMAND PID USER   FD      TYPE DEVICE SIZE/OFF NODE NAME</span></span><br><span class=\"line\"><span class=\"comment\"># md       22 root  cwd       DIR  253,0      250   64 /</span></span><br><span class=\"line\"><span class=\"comment\"># md       22 root  rtd       DIR  253,0      250   64 /</span></span><br><span class=\"line\"><span class=\"comment\"># md       22 root  txt   unknown                      /proc/22/exe</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 列出除了某个进程号，其他进程号所打开的文件信息</span></span><br><span class=\"line\">lsof -p ^1</span><br><span class=\"line\"><span class=\"comment\"># 列出多个进程号对应的文件信息</span></span><br><span class=\"line\">lsof -p 1,2,3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#示例9.获取进程打开端口的信息</span></span><br><span class=\"line\">lsof -i <span class=\"comment\">#列出端口号占用的进程</span></span><br><span class=\"line\"><span class=\"comment\"># COMMAND     PID   USER   FD   TYPE   DEVICE SIZE/OFF NODE NAME</span></span><br><span class=\"line\"><span class=\"comment\"># chronyd     682 chrony    5u  IPv4    14710      0t0  UDP localhost:323</span></span><br><span class=\"line\"><span class=\"comment\"># chronyd     682 chrony    6u  IPv6    14711      0t0  UDP localhost:323</span></span><br><span class=\"line\"><span class=\"comment\"># dhclient    996   root    6u  IPv4    16109      0t0  UDP *:bootpc</span></span><br><span class=\"line\"><span class=\"comment\"># sshd       1202   root    3u  IPv4    20035      0t0  TCP *:EtherNet/IP-1 (LISTEN)</span></span><br><span class=\"line\"><span class=\"comment\"># sshd       1202   root    4u  IPv6    20037      0t0  TCP *:EtherNet/IP-1 (LISTEN)</span></span><br><span class=\"line\"><span class=\"comment\"># master     1203   root   13u  IPv4    18762      0t0  TCP localhost:smtp (LISTEN)</span></span><br><span class=\"line\"><span class=\"comment\"># master     1203   root   14u  IPv6    18763      0t0  TCP localhost:smtp (LISTEN</span></span><br><span class=\"line\">lsof -i :53 </span><br><span class=\"line\"><span class=\"comment\"># COMMAND   PID            USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span></span><br><span class=\"line\"><span class=\"comment\"># systemd-r 538 systemd-resolve   12u  IPv4  13925      0t0  UDP localhost:domain</span></span><br><span class=\"line\"><span class=\"comment\"># systemd-r 538 systemd-resolve   13u  IPv4  13926      0t0  TCP localhost:domain (LISTEN)</span></span><br><span class=\"line\">lsof -i :22 <span class=\"comment\">#指定服务或者端口,查看一下80端口的进程</span></span><br><span class=\"line\"><span class=\"comment\"># sshd    5460 root    3u  IPv4  31918      0t0  TCP *:ssh (LISTEN)</span></span><br><span class=\"line\"><span class=\"comment\"># sshd    5460 root    4u  IPv6  31920      0t0  TCP *:ssh (LISTEN)</span></span><br><span class=\"line\"><span class=\"comment\"># sshd    5971 root    3u  IPv4  32781      0t0  TCP localhost.localdomain:ssh-&gt;127.0.0.1:51147 (ESTABLISHED)</span></span><br><span class=\"line\">lsof -i :ssh <span class=\"comment\">#指定服务或者端口</span></span><br><span class=\"line\"><span class=\"comment\">#列出谁在使用某个特定的udp端口以及特定的tcp端口</span></span><br><span class=\"line\">lsof -i tcp:80</span><br><span class=\"line\">lsof -i udp:68</span><br><span class=\"line\"><span class=\"comment\"># COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span></span><br><span class=\"line\"><span class=\"comment\"># dhclient 3966 root    6u  IPv4  30736      0t0  UDP *:bootpc</span></span><br><span class=\"line\">lsof -i udp -i tcp  <span class=\"comment\">#列出所有TCP/UDP网络连接</span></span><br><span class=\"line\"><span class=\"comment\"># COMMAND  PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span></span><br><span class=\"line\"><span class=\"comment\"># chronyd 5116 chrony    1u  IPv4  28218      0t0  UDP localhost:323</span></span><br><span class=\"line\"><span class=\"comment\"># chronyd 5116 chrony    2u  IPv6  28219      0t0  UDP localhost:323</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#实例10：列出某个用户的所有活跃的网络端口</span></span><br><span class=\"line\">lsof -a -u root -i</span><br><span class=\"line\">lsof -a -u root -i -n  <span class=\"comment\">#将服务名称变成端口</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#实例11：列出所有网络文件系统</span></span><br><span class=\"line\">lsof -N</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#实例12：根据文件描述列出对应的文件信息（FD）</span></span><br><span class=\"line\">lsof -d txt</span><br><span class=\"line\">lsof -d 1</span><br><span class=\"line\">lsof -d 2</span><br><span class=\"line\">lsof -d 2-3  <span class=\"comment\">#根据文件描述范围列出文件信息</span></span><br><span class=\"line\"><span class=\"comment\">#0表示标准输入，1表示标准输出，2表示标准错误，从而可知：所以大多数应用程序所打开的文件的 FD 都是从 3 开始</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#实例13.列出COMMAND列中包含字符串\" sshd\"，且文件描符的类型为txt的文件信息</span></span><br><span class=\"line\">lsof -c sshd -a -d txt</span><br><span class=\"line\"><span class=\"comment\"># COMMAND   PID USER  FD   TYPE DEVICE SIZE/OFF     NODE NAME</span></span><br><span class=\"line\"><span class=\"comment\"># sshd     9427 root txt    REG  253,1   852856 51767854 /usr/sbin/sshd</span></span><br><span class=\"line\"><span class=\"comment\"># sshd    28834 root txt    REG  253,1   852856 51767854 /usr/sbin/sshd</span></span><br><span class=\"line\"><span class=\"comment\"># sshd    28838 root txt    REG  253,1   852856 51767854 /usr/sbin/sshd</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#实例14：列出被进程号为9427的进程所打开的所有IPV4 network files </span></span><br><span class=\"line\">lsof -i 4 -a -p 9427</span><br><span class=\"line\">COMMAND  PID USER   FD   TYPE   DEVICE SIZE/OFF NODE NAME</span><br><span class=\"line\">sshd    9427 root    3u  IPv4 11551516      0t0  TCP *:EtherNet/IP-1 (LISTEN)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#实例15：列出目前连接主机peida.linux上端口为：20，21，22，25，53，80相关的所有文件信息，且每隔3秒不断的执行lsof指令</span></span><br><span class=\"line\">lsof -i @weiyigeek:20,21,22,25,53,80 -r 3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#实例16.查看打开句柄总数</span></span><br><span class=\"line\">lsof -n|awk <span class=\"string\">'&#123;print $2&#125;'</span>|wc -l</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#实例17.查看系统中进程占用的句柄数，根据打开文件句柄的数量降序排列，其中第二列为进程ID：</span></span><br><span class=\"line\">lsof -n|awk <span class=\"string\">'&#123;print $2&#125;'</span>|sort|uniq -c|sort -nr|more</span><br><span class=\"line\">  <span class=\"comment\"># 1160 3220194</span></span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190611164458.png\" alt=\"WeiyiGeek.lsof目录递归\" title=\"\" class=\"\">\n                <p>WeiyiGeek.lsof目录递归</p>\n            </figure>\n<hr>\n<h4 id=\"系统资源查看\"><a href=\"#系统资源查看\" class=\"headerlink\" title=\"系统资源查看\"></a>系统资源查看</h4><h5 id=\"lsmem-命令-列出内存范围与在线状态\"><a href=\"#lsmem-命令-列出内存范围与在线状态\" class=\"headerlink\" title=\"lsmem 命令 - 列出内存范围与在线状态\"></a>lsmem 命令 - 列出内存范围与在线状态</h5><p>描述:列出可用内存的范围与他们的在线状态,所列出的存储块对应于在sysfs存储器框图表示。该命令还示出了存储器块大小与内存在在线和离线状态的量。</p>\n<p>基础示例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$lsmem</span></span><br><span class=\"line\">RANGE                                  SIZE  STATE REMOVABLE BLOCK</span><br><span class=\"line\">0x0000000000000000-0x0000000007ffffff  128M online        否     0</span><br><span class=\"line\">0x0000000008000000-0x0000000027ffffff  512M online        是   1-4</span><br><span class=\"line\">0x0000000028000000-0x0000000037ffffff  256M online        否   5-6</span><br><span class=\"line\">0x0000000038000000-0x000000003fffffff  128M online        是     7</span><br><span class=\"line\">0x0000000040000000-0x000000004fffffff  256M online        否   8-9</span><br><span class=\"line\">0x0000000050000000-0x0000000067ffffff  384M online        是 10-12</span><br><span class=\"line\">0x0000000068000000-0x00000000bfffffff  1.4G online        否 13-23</span><br><span class=\"line\">0x0000000100000000-0x0000000117ffffff  384M online        是 32-34</span><br><span class=\"line\">0x0000000118000000-0x000000013fffffff  640M online        否 35-39</span><br><span class=\"line\"></span><br><span class=\"line\">Memory block size:       128M</span><br><span class=\"line\">Total online memory:       4G</span><br><span class=\"line\">Total offline memory:      0B</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h5 id=\"lsns-命令-列出当前名称空间信息\"><a href=\"#lsns-命令-列出当前名称空间信息\" class=\"headerlink\" title=\"lsns 命令 - 列出当前名称空间信息\"></a>lsns 命令 - 列出当前名称空间信息</h5><p>描述:列出所有当前访问的命名空间或对给定的命名空间信息。命名空间标识符是inode编号。</p>\n<p>基础示例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$lsns</span></span><br><span class=\"line\">NS        TYPE  NPROCS   PID  USER   COMMAND</span><br><span class=\"line\">4026531836 pid      126     1 root   /usr/lib/systemd/systemd --switched-root --system --deserialize 22</span><br><span class=\"line\">4026531837 user     126     1 root   /usr/lib/systemd/systemd --switched-root --system --deserialize 22</span><br><span class=\"line\">4026531838 uts      126     1 root   /usr/lib/systemd/systemd --switched-root --system --deserialize 22</span><br><span class=\"line\">4026531839 ipc      126     1 root   /usr/lib/systemd/systemd --switched-root --system --deserialize 22</span><br><span class=\"line\">4026531840 mnt      123     1 root   /usr/lib/systemd/systemd --switched-root --system --deserialize 22</span><br><span class=\"line\">4026531856 mnt        1    28 root   kdevtmpfs</span><br><span class=\"line\">4026531956 net      126     1 root   /usr/lib/systemd/systemd --switched-root --system --deserialize 22</span><br><span class=\"line\">4026532156 mnt        1   682 chrony /usr/sbin/chronyd</span><br><span class=\"line\">4026532157 mnt        1   766 root   /usr/sbin/NetworkManager --no-daemon</span><br></pre></td></tr></table></figure></p>\n<hr>\n<h4 id=\"系统优化\"><a href=\"#系统优化\" class=\"headerlink\" title=\"系统优化\"></a>系统优化</h4>","comments":true,"excerpt":"[TOC]","categories":[{"name":"Linux命令","path":"api/categories/Linux命令.json"}],"tags":[{"name":"基础运维类","path":"api/tags/基础运维类.json"}]}