<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>🌐 系统安全加密验证签名之Openssl命令|WeiyiGeek Blog|唯一极客Geek-IT网络安全运维开发技术知识分享-博客站点</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Openssl">
    <meta name="Description" content="WeiyiGeek-唯一极客博客站点,关注于网络安全运维,Web安全开发,IOT物联网安全开发,应用开发,分享技术学习知识与入坑解决,提升网络安全技术与自身技术能力,立志维护大众网络安全为己任,做一个对国家有用的人,为实现中华民族伟大复兴的中国梦不懈奋斗">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-头像">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                首页
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                文章分类
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                文章标签
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                文章归档
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                学习书籍
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                关于作者
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                站点导航
              </a>
            </li>
        
            <li class="">
              <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                公众账号
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                哔哩哔哩
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>系统安全加密验证签名之Openssl命令</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="文章头部背景">
    <div class="container fade-scale">
        <h1 class="title">系统安全加密验证签名之Openssl命令</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-08-20T10:34:30.000Z" itemprop="datePublished" class="page-time">
  2019-08-20
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/">加密算法</a></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-解密编码/加密算法/系统安全加密验证签名之Openssl命令"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">系统安全加密验证签名之Openssl命令</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-08-20 18:34:30" datetime="2019-08-20T10:34:30.000Z"  itemprop="datePublished">2019-08-20</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/">加密算法</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h4 id="0x00-前言简述"><a href="#0x00-前言简述" class="headerlink" title="0x00 前言简述"></a>0x00 前言简述</h4><p>描述:OpenSSL是一个开源项目,它是<code>安全套接字层密码库(Secrue socket layer)</code>和传输层安全<code>(transport layer security,TLS)</code>协议的实现，囊括主要的<code>密码算法</code>、常用的<code>密钥</code>和<code>证书封装管理功能及SSL协议</code>(SSL/TLS工具集)，并提供丰富的应用程序供测试或其它目的使用。</p>
<p>OpenSSL在这一领域已经成为事实上的标准，并且拥有比较长的历史，在OpenSSL被曝出现严重安全漏洞后，发现多数通过SSL协议加密的网站使用名为OpenSSL的开源软件包。由于这是互联网应用最广泛的安全传输方法，被网银、在线支付、电商网站、门户网站、电子邮件等重要网站广泛使用，所以该漏洞影响范围广大</p>
<p>现在几乎所有的服务器软件和很多客户端软件都在使用OpenSSL，其中基于命令行的工具是进行密钥、证书管理以及测试最常用到的软件了。</p>
<p>在很多情况下，我们需要在公司局域网内的网站中启用 HTTPS，比如测试环境或者是公司内网中的管理系统(现在主流的浏览器都把 HTTP 站点标记为不安全)。此时通过 OpenSSL 创建私有 CA 并颁发证书就是很好的选择了。</p>
<p>等待学习:<br><a href="https://www.cnblogs.com/xdyixia/p/11673785.html" target="_blank" rel="noopener">https://www.cnblogs.com/xdyixia/p/11673785.html</a><br><a href="https://www.cnblogs.com/sparkdev/p/10369313.html" target="_blank" rel="noopener">https://www.cnblogs.com/sparkdev/p/10369313.html</a></p>
<hr>
<p><br></p>
<h4 id="0x01-算法实现"><a href="#0x01-算法实现" class="headerlink" title="0x01 算法实现"></a>0x01 算法实现</h4><p><strong>1.对称加密算法</strong><br>OpenSSL一共提供了8种对称加密算法，其中7种是分组加密算法，仅有的一种流加密算法是RC4(已经证明不安全)。<br>这7种分组加密算法分别是 <code>AES、DES、Blowfish、CAST、IDEA、RC2、RC5</code>,</p>
<p>四种常用的分组密码加密模式(上面七种):</p>
<ul>
<li>电子密码本模式（ECB）</li>
<li>加密分组链接模式（CBC）</li>
<li>加密反馈模式（CFB）</li>
<li>输出反馈模式（OFB）</li>
</ul>
<p>注意:</p>
<ul>
<li>AES使用的加密反馈模式（CFB）和输出反馈模式（OFB）分组长度是128位，其它算法使用的则是64位。</li>
<li>DES算法里面不仅仅是常用的DES算法，还支持三个密钥和两个密钥3DES算法。</li>
</ul>
<p><em>对称加密应用例子:</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#用DES3算法的CBC模式加密文件plaintext.txt，加密结果输出到文件ciphertext.bin</span></span><br><span class="line">openssl enc -des3 -salt -<span class="keyword">in</span> plaintext.txt -out ciphertext.bin</span><br><span class="line"><span class="comment">#用DES3算法的CBC模式解密文件ciphertext.bin，提供的口令为trousers，输出到文件plaintext.doc</span></span><br><span class="line">openssl enc -des-ede3-cbc -d -<span class="keyword">in</span> ciphertext.bin -out plaintext.doc -pass pass:trousers</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#用DES3算法的OFB模式解密文件ciphertext.bin，提供的口令为trousers，输出到文件plaintext.doc</span></span><br><span class="line">openssl enc -des-ede3-ofb -d -<span class="keyword">in</span> ciphertext.bin -out plaintext.doc -pass pass:trousers</span><br><span class="line"></span><br><span class="line"><span class="comment">#用Blowfish的CFB模式加密plaintext.doc，口令从环境变量PASSWORD中取，输出到文件ciphertext.bin。</span></span><br><span class="line">openssl bf-cfb -salt -<span class="keyword">in</span> plaintext.doc -out ciphertext.bin -pass pass:123456</span><br><span class="line"></span><br><span class="line"><span class="comment">#用RC5算法的CBC模式加密文件plaintext.doc，输出到文件ciphertext.bin，salt、key和初始化向量(iv)在命令行指定</span></span><br><span class="line"><span class="comment">#貌似已经更名或者不用RC5 给文件ciphertext.bin用base64编码，输出到文件base64.txt。</span></span><br><span class="line">openssl rc5 -<span class="keyword">in</span> plaintext.doc -out ciphertext.bin -S C62CB1D49F158ADC -iv E9EDACA1BD7090C6 -K 89D4B1678D604FAA3DBFFD030A314B29</span><br><span class="line"></span><br><span class="line"><span class="comment">#给文件ciphertext.bin用base64编码(类似于base64 filenames)，输出到文件base64.txt。</span></span><br><span class="line">openssl base64 -<span class="keyword">in</span> ciphertext.bin -out base64.txt</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=系统安全加密验证签名之Openssl命令 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190819092933.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190819092933.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure></p>
<p>注意事项:</p>
<ul>
<li>因为模式不同，该命令不能对以上的文件进行解密。</li>
</ul>
<p><br></p>
<p><strong>2.非对称加密算法</strong><br>描述:OpenSSL一共实现了4种非对称加密算法，包括DH算法、RSA算法、DSA算法和椭圆曲线算法（EC）</p>
<ul>
<li>DH算法一般用户密钥交换</li>
<li>RSA算法既可以用于密钥交换(如SSH密匙登录),也可以用于数字签名,当然如果你能够忍受其缓慢的速度，那么也可以用于数据加密</li>
<li>DSA算法则一般只用于数字签名</li>
</ul>
<p><em>非对称加密应用例子应用例子</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#DDiffie-Hellman应用例子</span></span><br><span class="line"><span class="comment">#1.使用生成因子2和随机的1024-bit的素数产生D0ffie-Hellman参数，输出保存到文件dhparam.pem</span></span><br><span class="line">openssl dhparam -out dhparam.pem -2 1024</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.从dhparam.pem中读取Diffie-Hell参数，以C代码的形式，输出到stdout</span></span><br><span class="line">openssl dhparam -<span class="keyword">in</span> dhparam.pem -noout -C</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=系统安全加密验证签名之Openssl命令 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190819093507.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190819093507.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure></p>
<p><br></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#DSA应用例子:</span></span><br><span class="line">1.生成1024位DSA参数集，并输出到文件dsaparam.pem</span><br><span class="line">openssl dsaparam -out dsaparam.pem 1024</span><br><span class="line"></span><br><span class="line">2.使用参数文件dsaparam.pem生成DSA私钥匙，采用3DES加密后输出到文件dsaprivatekey.pem （需要输入密码 <span class="built_in">test</span>）</span><br><span class="line">openssl gendsa -out dsaprivatekey.pem -des3 dsaparam.pem </span><br><span class="line"></span><br><span class="line">3.使用私钥匙dsaprivatekey.pem生成公钥匙，输出到dsapublickey.pem （必修输入上面的密码）</span><br><span class="line">openssl dsa -<span class="keyword">in</span> dsaprivatekey.pem -pubout -out dsapublickey.pem </span><br><span class="line"></span><br><span class="line">4.从dsaprivatekey.pem中读取私钥匙，解密并输入新口令进行加密，然后写回文件dsaprivatekey.pem（输入原有的密码和现在最新的密码）</span><br><span class="line">openssl dsa -<span class="keyword">in</span> dsaprivatekey.pem -out dsaprivatekey.pem -des3</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=系统安全加密验证签名之Openssl命令 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190819094500.png" target="_blank" title="WeiyiGeek.12" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190819094500.png" alt="WeiyiGeek.12" title="" class=""></a>
                <p>WeiyiGeek.12</p>
            </figure>
<figure class="image-box">
                <a rel=系统安全加密验证签名之Openssl命令 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190819094538.png" target="_blank" title="WeiyiGeek.34" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190819094538.png" alt="WeiyiGeek.34" title="" class=""></a>
                <p>WeiyiGeek.34</p>
            </figure>
<p><br></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#RSA应用例子:</span></span><br><span class="line">1.产生1024位RSA私匙，用3DES加密它，口令为trousers，输出到文件rsaprivatekey.pem</span><br><span class="line">openssl genrsa -out rsaprivatekey.pem -passout pass:trousers -des3 1024</span><br><span class="line"></span><br><span class="line">2.从文件rsaprivatekey.pem读取私匙，用口令trousers解密，生成的公钥匙输出到文件rsapublickey.pem</span><br><span class="line">openssl rsa -<span class="keyword">in</span> rsaprivatekey.pem -passin pass:trousers -pubout -out rsapublickey.pem</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.使用公钥匙rsapublickey.pem加密文件plain.txt，输出到文件cipher.txt</span></span><br><span class="line">openssl rsautl -encrypt -pubin -inkey rsapublickey.pem -<span class="keyword">in</span> plain.txt -out cipher.txt</span><br><span class="line"><span class="comment">#3.用公钥匙rsapublickey.pem验证签名signature.bin，输出到文件plain.tct (decript)</span></span><br><span class="line">openssl rsautl -verify -pubin -inkey rsapublickey.pem -<span class="keyword">in</span> signature.bin -out plain.tct</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.使用私钥匙rsaprivatekey.pem给文件plain.txt签名，输出到文件signature.bin (encrpty)</span></span><br><span class="line">openssl rsautl -verify -pubin -inkey rsapublickey.pem -<span class="keyword">in</span> signature.bin -out plain.tct</span><br><span class="line"><span class="comment">#4.使用私钥匙rsaprivatekey.pem解密密文cipher.txt，输出到文件plain.txt</span></span><br><span class="line">openssl rsautl -decrypt -inkey rsaprivatekey.pem -<span class="keyword">in</span> cipher.txt -out plain.txt</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=系统安全加密验证签名之Openssl命令 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190819095341.png" target="_blank" title="WeiyiGeek.rsa密钥和公钥" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190819095341.png" alt="WeiyiGeek.rsa密钥和公钥" title="" class=""></a>
                <p>WeiyiGeek.rsa密钥和公钥</p>
            </figure>
<figure class="image-box">
                <a rel=系统安全加密验证签名之Openssl命令 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190819095533.png" target="_blank" title="WeiyiGeek.公钥私钥加解密" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190819095533.png" alt="WeiyiGeek.公钥私钥加解密" title="" class=""></a>
                <p>WeiyiGeek.公钥私钥加解密</p>
            </figure>
<p><br></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#X.509应用例子；</span></span><br><span class="line">1.从证书文件cert.pem中获取公钥匙，用3DES加密mail.txt，输出到文件mail.enc</span><br><span class="line">openssl smime -encrypt -<span class="keyword">in</span> mail.txt -des3 -out mail.enc cert.pem</span><br><span class="line"></span><br><span class="line">2.从X.509证书文件cert.pem中获取接收人的公钥匙，用私钥匙key.pem解密S/MIME消息mail.enc，结果输出到文件mail.txt</span><br><span class="line">openssl smime -decrypt -<span class="keyword">in</span> mail.enc -recip cert.pem -inkey key.pem -out mail.txt</span><br><span class="line"></span><br><span class="line">3.cert.pem为X.509证书文件，用私匙key,pem为mail.txt签名，证书被包含在S/MIME消息中，输出到文件mail.sgn</span><br><span class="line">openssl smime -sign -<span class="keyword">in</span> mail.txt -signer cert.pem -inkey key.pem -out mail.sgn</span><br><span class="line"></span><br><span class="line">4.验证S/MIME消息mail.sgn，输出到文件mail.txt，签名者的证书应该作为S/MIME消息的一部分包含在mail.sgn中</span><br><span class="line">openssl smime -verify -<span class="keyword">in</span> mail.sgn -out mail.txt</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><strong>3.信息摘要算法</strong><br>OpenSSL实现了5种信息摘要算法，分别是MD2、MD5、MDC2、SHA（SHA1）和RIPEMD;SHA算法事实上包括了<code>SHA和SHA1两种信息摘要算法此外</code>，OpenSSL还实现了DSS标准中规定的<code>两种信息摘要算法DSS和DSS1</code>;<br>信息摘要算法:主要验证文件是否被更改,如果被更改则生成于验证的摘要算法不同;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#消息摘要算法应用例子:</span></span><br><span class="line">1.用SHA1/MD5算法计算文件file.txt的哈西值，输出到stdout;</span><br><span class="line">openssl dgst -sha1 file.txt</span><br><span class="line">openssl dgst -md5 file.txt</span><br><span class="line"></span><br><span class="line">2.用SHA1算法计算文件file.txt的哈西值，输出到文件digest.txt:</span><br><span class="line">openssl sha1 -out digest.txt file.txt</span><br></pre></td></tr></table></figure>
<p><br></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1.用DSS1(SHA1)算法为文件file.txt签名(signature)，输出到文件dsasign.bin;</span><br><span class="line"><span class="comment">#签名的private key必须为DSA算法产生的，保存在文件dsakey.pem中</span></span><br><span class="line">openssl dgst -dss1 -sign dsakey.pem -out dsasign.bin file.txt</span><br><span class="line"></span><br><span class="line">2.用dss1算法验证file.txt的数字签名dsasign.bin，验证的private key为DSA算法产生的文件dsakey.pem。</span><br><span class="line">openssl dgst -dss1 -prverify dsakey.pem -signature dsasign.bin file.txt</span><br><span class="line"></span><br><span class="line">3.用sha1算法为文件file.txt签名,输出到文件rsasign.bin，签名的private key为RSA算法产生的文件rsaprivate.pem。</span><br><span class="line">openssl sha1 -sign rsaprivate.pem -out rsasign.bin file.txt</span><br><span class="line"></span><br><span class="line">4.用sha1算法验证(verify)file.txt的数字签名rsasign.bin，验证的public key为RSA算法生成的rsapublic.pem。</span><br><span class="line">openssl sha1 -verify rsapublic.pem -signature rsasign.bin file.txt</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="0x03-证书密钥管理"><a href="#0x03-证书密钥管理" class="headerlink" title="0x03 证书密钥管理"></a>0x03 证书密钥管理</h4><p>首先，OpenSSL实现了ASN.1的证书和密钥相关标准，提供了对证书、公钥、私钥、证书请求以及CRL等数据对象的DER、PEM和BASE64的编解码功能<br>OpenSSL提供了产生各种公开密钥对和对称密钥的方法、函数和应用程序，同时提供了对公钥和私钥的DER编解码功能。并实现了私钥的PKCS#12和PKCS#8的编解码功能;</p>
<p><code>密钥和证书管理是PKI的一个重要组成部分</code>，OpenSSL为之提供了丰富的功能，支持多种标准；OpenSSL在标准中提供了对私钥的加密保护功能，使得密钥可以安全地进行存储和分发:<br>在此基础上，OpenSSL实现了对证书的<code>X.509标准编解码、</code>PKCS#12格式的编解码以及PKCS#7的编解码功能,并提供了一种文本数据库，支持证书的管理功能，<code>包括证书密钥产生、请求产生、证书签发、吊销和验证</code>等功能<br>事实上，OpenSSL提供的CA应用程序就是一个小型的证书管理中心（CA），实现了证书签发的整个流程和证书管理的大部分机制.</p>
<p>这里不得不提到SSL证书通过在客户端浏览器和Web服务器之间建立一条SSL安全通道（Secure socketlayer(SSL),SSL安全协议主要用来提供对用户和服务器的认证；对传送的数据进行加密和隐藏；确保数据在传送中不被改变，即数据的完整性，现已成为该领域中全球化的标准。由于SSL技术已建立到所有主要的浏览器和WEB服务器程序中，因此仅需安装服务器证书就可以激活该功能了）。即通过它可以激活SSL协议，实现数据信息在客户端和服务器之间的加密传输，可以防止数据信息的泄露。保证了双方传递信息的安全性，而且用户可以通过服务器证书验证他所访问的网站是否是真实可靠。</p>
<p>SSL网站不同于一般的Web站点，它使用的是“HTTPS”协议，而不是普通的“HTTP”协议。因此它的URL（统一资源定位器）格式为“<a href="https://www.baidu.com”。" target="_blank" rel="noopener">https://www.baidu.com”。</a></p>
<p><em>什么是x509证书链</em>?<br>答:x509证书一般会用到三类文件，key，csr，crt。</p>
<ul>
<li>Key是私用密钥，openssl格式，通常是rsa算法。</li>
<li>csr是证书请求文件，用于申请证书。在制作csr文件的时候，必须使用自己的私钥来签署申请，还可以设定一个密钥。</li>
<li>crt是CA认证后的证书文件（windows下面的csr，其实是crt），签署人用自己的key给你签署的凭证。</li>
</ul>
<p>首先要有一个CA根证书，然后用CA根证书来签发用户证书。用户进行证书申请:一般先生成一个私钥，然后用私钥生成证书请求(证书请求里应含有公钥信息)，再利用证书服务器的CA根证书来签发证书。</p>
<p><em>什么是CA根证书</em>？<br>答:CA认证即电子认证服务，是指为电子签名相关各方提供真实性、可靠性验证的活动，实际上它相当于是一个机构。</p>
<p>特别说明:</p>
<ul>
<li>自签名证书(一般用于顶级证书、根证书): 证书的名称和认证机构的名称相同.</li>
<li>根证书:根证书是CA认证中心给自己颁发的证书,是信任链的起始点。任何安装CA根证书的服务器都意味着对这个CA认证中心是信任的。</li>
<li>数字证书则是由证书认证机构（CA）对证书申请者真实身份验证之后，用CA的根证书对申请人的一些基本信息以及申请人的公钥进行签名（相当于加盖发证书机构的公章）后形成的一个数字文件。</li>
<li>数字证书包含证书中所标识的实体的公钥（就是说你的证书里有你的公钥），由于证书将公钥与特定的个人匹配，并且该证书的真实性由颁发机构保证（就是说可以让大家相信你的证书是真的），因此，数字证书为如何找到用户的公钥并知道它是否有效这一问题提供了解决方案。</li>
</ul>
<figure class="image-box">
                <a rel=系统安全加密验证签名之Openssl命令 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200820175635.png" target="_blank" title="WeiyiGeek.CA机构" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200820175635.png" alt="WeiyiGeek.CA机构" title="" class=""></a>
                <p>WeiyiGeek.CA机构</p>
            </figure>
<p><br></p>
<h5 id="证书类型与协议"><a href="#证书类型与协议" class="headerlink" title="证书类型与协议"></a>证书类型与协议</h5><p>描述:通常我们提到的证书里面包含了公钥、发布者的数字签名、有效期等内容，大多数证书文件它里面是不包含私钥的, 除了像PFX与JKS这样的密钥库带有密钥外;<br>X.509是一个度最基本的公钥格式(证书)标准，其主要定义了证书中需要包含的各种信息，我们常见的SSL就是使用这种证书标准,其详情可以参考RFC5280标准;</p>
<p>证书主要的文件类型和协议有: <code>PEM(证书厂商常用)、DER、PFX(ISS常用)、JKS(Java常用)、KEY、KDB、CER(证书文件)、CSR(证书签名申请)、CRT(证书文件)、CRL、OCSP、SCEP</code>等。<br>常见几种证书编码格式。</p>
<ul>
<li>1.带有私钥的证书: PKCS#12以pfx/JKS作为证书文件后缀名(证书密钥库)</li>
<li>2.二进制编码的证书: 证书中没有私钥，DER 编码二进制格式的证书文件，以cer作为证书文件后缀名。</li>
<li>3.Base64编码的证书: 证书中没有私钥，BASE64 编码格式的证书文件，也是以cer作为证书文件后缀名。</li>
</ul>
<p><br></p>
<p><strong>证书编码格式</strong><br>(1) PEM - <code>Privacy Enhanced Mail</code>:Openssl使用该PEM格式来存放各种信息，它是 openssl 默认采用的信息存放方式，<code>Apache和NGINX</code>服务器偏向于使用这种编码格式。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#PEM格式证书的信息查看</span></span><br><span class="line">openssl x509 -<span class="keyword">in</span> certificate.pem -text -noout</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=系统安全加密验证签名之Openssl命令 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200519161754.png" target="_blank" title="WeiyiGeek.pem" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200519161754.png" alt="WeiyiGeek.pem" title="" class=""></a>
                <p>WeiyiGeek.pem</p>
            </figure></p>
<p>Openssl 中的 PEM 文件一般包含如下信息:</p>
<ul>
<li>1) 内容类型:表明本文件存放的是什么信息内容;</li>
<li>2) 头信息:表明数据是如果被处理后存放, openssl 中用的最多的是加密信息, 比如<code>加密算法以及初始化向量 iv</code>;</li>
<li>3) 信息体:为 BASE64 编码的数据:<code>可以包括所有私钥（RSA 和 DSA）、公钥（RSA 和 DSA）和 (x509) 证书</code>。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PEM格式样式说明</span></span><br><span class="line"><span class="comment"># 1.使用PEM格式存储的证书:</span></span><br><span class="line">-----BEGIN CERTIFICATE-----</span><br><span class="line">MIIDBjCCAe6gAwIBAgIBATANBgkqhkiG9w0BAQsFADA8MTowOAYDVQQDDDFNeVNR</span><br><span class="line">TF9TZXJ2ZXJfOC4wLjE2X0F1dG9fR2VuZXJhdGVkX0NBX0NlcnRpZmljYXRlMB4X</span><br><span class="line">DTE5MDgxNTA5NDc0NloXDTI5MDgxMjA5NDc0NlowPDE6MDgGA1UEAwwxTXlTUUxf</span><br><span class="line">U2VydmVyXzguMC4xNl9BdXRvX0dlbmVyYXRlZF9DQV9DZXJ0aWZpY2F0ZTCCASIw</span><br><span class="line">DQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAOMzxWH6GiFOaENGcgN1AKxVlOfB</span><br><span class="line">uVKM43J0i1sqyqJ+U2cGUYXyDYIgDaYio1Al75Esy7WgBdgKPD1XHBIVAHhfwBeD</span><br><span class="line">YC2fUO1dl2LsqCHFy29ds8exEcAZgqsU51kSCakTJ5FIxSQj5G39G1+OG0B2xyUq</span><br><span class="line">9FBMS+e3Ks/qmGruWoLjo8a7DUDtNxj/GKavRbWhtNu5yxc0A1xUq/MjnWWbwQog</span><br><span class="line">dstoW2Pxo6xPih2jgRP1Mt9XtlxldsDPJQxXV3Ivi+w9Omtc1TK+HMY9YJu9S/oI</span><br><span class="line">KpM6d0lUOxCt0OGPGaEn9fdYC74tNhwGUOrb6uLIXTrZFgIU9g/ozhxvm78CAwEA</span><br><span class="line">AaMTMBEwDwYDVR0TAQH/BAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEA3opxpm/N</span><br><span class="line">oN7778t6f0MU9xaNoIcMqzioPjyGJozFqdLJGJ2RHyuYPf15epUfOoJVhJ7tzvbF</span><br><span class="line">S7m4odUkIG6nMMme0V9XnZn0W7NJFpb1UPJNBwymSSSzDMw2N9V6J1FDyQtn41XE</span><br><span class="line">2mJT0aORrNimqehR2QccH/AZ7hIg/a/f6u7OTbqZ+pckBKsViboDcmo7dL0mUjKb</span><br><span class="line">lvZttFXN+kVCGOptIfSccQyJlQByNgVUQSVpE1WyX+/zwwU+iXr7/LbRzzyHgR1l</span><br><span class="line">zZEgvr7QHelBFzOYIST1h5vHhFAWGa4EtjhuAQZWBXh/xwG4o1VdciOpsvvz3COH</span><br><span class="line">8EUv8YZROdrA5A==</span><br><span class="line">-----END CERTIFICATE-----</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.使用PEM格式存储的私钥:</span></span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIICJjCCAdCgAwIBAgIBITANBgkqhkiG9w0BAQQFADCBqTELMAkGA1UEBhMCVVMx</span><br><span class="line">.....</span><br><span class="line">1p8h5vkHVbMu1frD1UgGnPlOO/K7Ig/KrsU=</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#3.使用PEM格式存储的证书请求文件:</span></span><br><span class="line">-----BEGIN CERTIFICATE REQUEST-----</span><br><span class="line">MIICJjCCAdCgAwIBAgIBITANBgkqhkiG9w0BAQQFADCBqTELMAkGA1UEBhMCVVMx</span><br><span class="line">.....</span><br><span class="line">1p8h5vkHVbMu1frD1UgGnPlOO/K7Ig/KrsU=</span><br><span class="line">-----END CERTIFICATE REQUEST-----</span><br></pre></td></tr></table></figure>
<p>(2) DER - Distinguished Encoding Rules:辨别编码规则 (DER) 可包含所有<code>私钥、公钥和证书</code>。<br>它是大多数浏览器的缺省格式，并按 ASN1 DER 格式存储, 它是无报头的 PEM 是用文本报头包围的 DER，Java和Windows服务器偏向于使用这种编码格式.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看DER格式证书的信息</span></span><br><span class="line">openssl x509 -<span class="keyword">in</span> certificate.der -inform der -text -noout</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>证书编码的转换</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#PEM转为DER</span></span><br><span class="line">openssl x509 -<span class="keyword">in</span> cert.crt -outform der -out cert.der</span><br><span class="line"></span><br><span class="line"><span class="comment">#DER转为PEM </span></span><br><span class="line">openssl x509 -<span class="keyword">in</span> cert.crt -inform der -outform pem -out cert.pem</span><br></pre></td></tr></table></figure></p>
<p>提示:要转换KEY文件也类似,只不过把x509换成rsa要转CSR的话,把x509换成req.</p>
<p><br></p>
<p><strong>核心重点</strong><br>描述:在我们学习证书申请，以及自签CA的时候对于不同的证书格式文件，总是搞得使用者一片茫然;<br>因为虽然我们已经知道有<code>PEM和DER这两种编码格式</code>, 但文件扩展名并不一定就叫”PEM”或者”DER”, 它们除了编码格式可能不同之外其内容也有差别,但它们大多数都能相互转换编码格式.</p>
<p>证书文件文件扩展名:</p>
<ul>
<li>(1) .crt 格式:证书文件<code>certificate</code>的缩写，用于证书抄证书可以是DER编码,也可以是PEM编码(<code>扩展名CER和CRT几乎是同义词</code>), 常用于Linux系统大多数是PEM编码;</li>
<li>(2) .cer 格式:证书文件<code>certificate</code>的缩写，<code>CRT证书的微软型式</code>可以用微软的工具把CRT文件转换袭为CER文件（<code>CRT和CER必须是相同编码的DER或者PEM</code>）, 常用于Windows系统大多数是DER编码(表现形式二进制格式的证书文件),;</li>
<li>(3) .key 格式:通常用来存放一个公钥或者私钥,并非X.509证书，编码可能是PEM或者DER<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#PEM编码查看</span></span><br><span class="line">openssl rsa -<span class="keyword">in</span> private.key -text -noout</span><br><span class="line"><span class="variable">$cat</span> private.key</span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIICJjCCAdCgAwIBAgIBITANBgkqhkiG9w0BAQQFADCBqTELMAkGA1UEBhMCVVMx</span><br><span class="line">.....</span><br><span class="line">1p8h5vkHVbMu1frD1UgGnPlOO/K7Ig/KrsU=</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br><span class="line"></span><br><span class="line"><span class="comment">#DER编码查看</span></span><br><span class="line">openssl rsa -<span class="keyword">in</span> private.key -text -noout -inform der</span><br></pre></td></tr></table></figure></li>
<li>(4).csr 格式:证书签名请求(<code>Certificate Signing Request</code>),它是向权威证书颁发机构获得签名证书的申请,其核心内容是一个公钥(当然还附带了一些别的信息),在生成这个申请的时候,同时也会生成一个私钥,私钥要自己保管好;<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#PEM编码查看</span></span><br><span class="line">openssl req -noout -text -<span class="keyword">in</span> my.csr</span><br><span class="line"></span><br><span class="line"><span class="comment">#DER编码查看</span></span><br><span class="line">openssl req -noout -text -inform der -<span class="keyword">in</span> my.csr</span><br></pre></td></tr></table></figure></li>
<li>(5)PFX/P12 格式: <code>predecessor of PKCS#12</code>包含公钥和私钥的二进制格式证书,对于nginx来说是分开存放在不同文件中(相对安全)，但Windows的IIS则将它们存在一个PFX文件中(因此这个文件包含了证书及私钥)为了提高安全性PFX格式证书通常会有一个提取密码，当您想提取任何东西的时候都需要输入该密码;<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#PFX -&gt; PEM</span></span><br><span class="line">openssl pkcs12 -<span class="keyword">in</span> <span class="keyword">for</span>-iis.pfx -out iiscetificate.pem -nodes</span><br><span class="line"></span><br><span class="line"><span class="comment">#PFX -&gt; 导出crt和key</span></span><br><span class="line">openssl pkcs12 -<span class="keyword">in</span> example.cn.ssl.pfx -nocerts -nodes -out example.key</span><br><span class="line">openssl pkcs12 -<span class="keyword">in</span> example.cn.ssl.pfx -clcerts -nokeys -out example.crt</span><br><span class="line"></span><br><span class="line"><span class="comment">#PEM -&gt; PFX:将crt和key合并出pfx</span></span><br><span class="line">openssl pkcs12 -<span class="built_in">export</span> -<span class="keyword">in</span> certificate.crt -inkey privateKey.key -out certificate.pfx</span><br><span class="line"></span><br><span class="line"><span class="comment">#其中CACert.crt是CA(权威证书颁发机构)的根证书,有的话也通过-certfile参数一起带进去,实际上PFX其实是个证书密钥库;</span></span><br></pre></td></tr></table></figure></li>
<li><p>(6).jks 格式:即Java Key Storage实际也是一个证书密钥库Java的专利,跟OpenSSL关系不大利用Java的一个叫”keytool”的工具,可以将PFX转为JKS当然了keytool也能直接生成JKS(可以参考我的另外一篇文章<code>Java工具使用补充说明</code>)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PEM -&gt; JKS 把用户证书文件转换成keystore.jks文件</span></span><br><span class="line"><span class="comment"># 1.把用户证书转换成P12格式</span></span><br><span class="line">$ openssl pkcs12 -<span class="built_in">export</span> -<span class="keyword">in</span> cert.pem -inkey cert.key -out keystore.p12 -passout pass:&lt;passvalue&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.把p12格式文件加入到JKS格式</span></span><br><span class="line">$ keytool -importkeystore -srckeystore keystore.p12 -srcstoretype PKCS12 -destkeystore keystore.jks \</span><br><span class="line">  -srcstorepass &lt;passvalue&gt; -deststorepass &lt;passvalue&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.查看结果</span></span><br><span class="line">$ keytool --list -keystore keystore.jks -storepass &lt;passvalue&gt;</span><br><span class="line">  Keystore <span class="built_in">type</span>: JKS</span><br><span class="line">  Keystore provider: SUN</span><br><span class="line">  Your keystore contains 1 entry</span><br><span class="line">  1, Dec 13, 2018, PrivateKeyEntry, </span><br><span class="line">  Certificate fingerprint (SHA1): 7D:38:3C:9E:B6:DC:4B:D1:A9:EC:D9:5C:C8:DF:01:E1:D2:C4:01:00</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.另外，如果需要在keystore里面包含CA证书，则需要：</span></span><br><span class="line">$ openssl pkcs12 -<span class="built_in">export</span> -name myalias2 -<span class="keyword">in</span> cert.pem -inkey cert.key -chain -CAfile ca.pem -out keystore.p12 -passout pass:&lt;passvalue&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>(7).p7b 格式:以树状展示证书链(certificate chain)，同时也支持单个证书，不含私钥。</p>
</li>
<li>(8).crl 格式:证书吊销列表Certificate Revocation List的缩写</li>
</ul>
<p><br></p>
<h5 id="自签证书-交互式"><a href="#自签证书-交互式" class="headerlink" title="自签证书-交互式"></a>自签证书-交互式</h5><p><a href="https://www.jianshu.com/p/81dbcde4fd7c" target="_blank" rel="noopener">https://www.jianshu.com/p/81dbcde4fd7c</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -x509 -newkey rsa:2048 -keyout ./server.key -out ./server.crt</span><br></pre></td></tr></table></figure><br><strong>CA根证书的生成步骤</strong>:</p>
<ul>
<li>1.生成CA私钥（.key）</li>
<li>2.生成CA证书请求（.csr）</li>
<li>3.自签名得到根证书（.crt）（CA给自已颁发的证书）。<br>在实际的软件开发工作中，往往服务器就采用这种SSL自签名的方式，因为毕竟找第三方签名机构是要给钱的，也是需要花时间的。</li>
<li>4采用dhparam加密服务器密钥 </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) 创建私钥:Generate CA private key </span></span><br><span class="line">openssl genrsa -out ca.key 2048 </span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) 创建CSR证书申请文件:Generate CSR </span></span><br><span class="line">openssl req -new -key ca.key -out ca.csr</span><br><span class="line"><span class="comment"># Country Name (2 letter code) [XX]:CN  #地区</span></span><br><span class="line"><span class="comment"># State or Province Name (full name) []:CN #省份 </span></span><br><span class="line"><span class="comment"># Locality Name (eg, city) [Default City]:CQ #城市</span></span><br><span class="line"><span class="comment"># Organization Name (eg, company) [Default Company Ltd]:weiyigeek #组织名称</span></span><br><span class="line"><span class="comment"># Organizational Unit Name (eg, section) []:weiyigeek  #单元名称</span></span><br><span class="line"><span class="comment"># Common Name (eg, your name or your servers hostname) []:weiyigeek.top  #通用名称即网站域名</span></span><br><span class="line"><span class="comment"># Email Address []:test@qq.com</span></span><br><span class="line"><span class="comment"># A challenge password []:weiyigeek  #认证密码</span></span><br><span class="line"><span class="comment"># An optional company name []:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) Generate Self Signed certificate（CA 根证书）</span></span><br><span class="line">openssl x509 -req -days 365 -<span class="keyword">in</span> ca.csr -signkey ca.key -out ca.crt</span><br><span class="line"><span class="comment"># Signature ok</span></span><br><span class="line"><span class="comment"># subject=/C=CN/ST=CN/L=CQ/O=weiyigeek/OU=weiyigeek/CN=weiyigeek.top/emailAddress=test@qq.com</span></span><br><span class="line"><span class="comment"># Getting Private key</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) 用dhparam加密服务器密钥 </span></span><br><span class="line">openssl dhparam -out dhparam.pem 2048</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><strong>用户证书的生成步骤</strong>:<br>描述:生成私钥（.key）–&gt;生成证书请求（.csr）–&gt;用CA根证书签名得到证书（.crt）于上面的步骤差不多多的只是加密;</p>
<ul>
<li><p>1.服务器端用户证书:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># private key</span></span><br><span class="line"><span class="variable">$openssl</span> genrsa -des3 -out server.key 2048</span><br><span class="line"><span class="comment"># generate csr</span></span><br><span class="line"><span class="variable">$openssl</span> req -new -key server.key -out server.csr</span><br><span class="line"><span class="comment"># generate certificate</span></span><br><span class="line"><span class="variable">$openssl</span> ca -<span class="keyword">in</span> server.csr -out server.crt -cert ca.crt -keyfile ca.key</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.客户端用户证书:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># private key</span></span><br><span class="line"><span class="variable">$openssl</span> genrsa -des3 -out client.key 1024 </span><br><span class="line"><span class="comment"># generate csr</span></span><br><span class="line"><span class="variable">$openssl</span> req -new -key client.key -out client.csr</span><br><span class="line"><span class="comment"># generate certificate</span></span><br><span class="line"><span class="variable">$openssl</span> ca -<span class="keyword">in</span> client.csr -out client.crt -cert ca.crt -keyfile ca.key</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<p><strong>生成pem格式证书步骤</strong><br>描述:有时需要用到pem格式的证书，可以用以下方式合并证书文件（crt）和私钥文件（key）来生成<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cat</span> client.crt client.key &gt; client.pem </span><br><span class="line"><span class="variable">$cat</span> server.crt server.key &gt; server.pem</span><br></pre></td></tr></table></figure></p>
<p>最后生成结果:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">服务端证书: ca.crt, server.key, server.crt, server.pem</span><br><span class="line">客户端证书: ca.crt, client.key, client.crt, client.pem</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>生成带有SAN的证书步骤</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 利用 addext 参数添加指定证书的SAN.</span></span><br><span class="line">openssl req \</span><br><span class="line">  -newkey rsa:4096 -nodes -sha256 -keyout certs/domain.key \</span><br><span class="line">  -addext <span class="string">"subjectAltName = DNS:registry-1.docker.io"</span> \</span><br><span class="line">  -addext <span class="string">"subjectAltName = DNS:harbor.weiyigeek.top"</span> \</span><br><span class="line">  -x509 -days 365 -out certs/domain.crt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看证书有效期 </span></span><br><span class="line">openssl x509 -<span class="keyword">in</span> domain.crt -noout -dates</span><br></pre></td></tr></table></figure></p>
<p><strong>【附录:在线SSL证书格式转换工具】</strong></p>
<ul>
<li>工具地址: <a href="https://www.sslshopper.com/ssl-converter.html" target="_blank" rel="noopener">https://www.sslshopper.com/ssl-converter.html</a></li>
<li>SSL证书格式转换工具-中国数字证书CHINASSL: <a href="https://www.chinassl.net/ssltools/convert-ssl.html" target="_blank" rel="noopener">https://www.chinassl.net/ssltools/convert-ssl.html</a></li>
</ul>
<hr>
<h4 id="0x04-私有CA创建"><a href="#0x04-私有CA创建" class="headerlink" title="0x04 私有CA创建"></a>0x04 私有CA创建</h4><h5 id="自签证书-ca-conf"><a href="#自签证书-ca-conf" class="headerlink" title="自签证书-ca.conf"></a>自签证书-ca.conf</h5><p>描述:我们会创建一个与公共CA类似的私有CA架构。会先有一个根CA，然后创建其他的二级CA。接着我们会通过CRL和OCSP服务提供证书吊销信息。为了让根CA的私钥可以离线保存， OCSP响应程序需要使用它们自己的身份。这并非是最简单的CA，但是相对来说比较安全。另外二级CA会在技术上进行限制，只能给允许的主机名签发证书</p>
<p>完成设置之后，必须将根证书安全地分发给所有客户端。一旦根证书分发完毕，就可以开始签发客户端和服务器证书了。有一个限制是以这种方式设置的OCSP响应程序主要用来测试，因为只能承受比较小的负载。</p>
<p><strong>创建根 CA 说明:</strong><br>本节描述了整个过程和常见的CA操作,即创建全新的CA有几个步骤：配置、创建目录结构和初始化密钥文件，最后生成根密钥和证书</p>
<p><strong>根CA配置如下:</strong></p>
<ul>
<li><p>1.第一部分包括了CA的名称、基础URL和CA可分辨名称等基本信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[default]</span><br><span class="line">name &#x3D; root-ca</span><br><span class="line">domain_suffix &#x3D; wieyigeek.top</span><br><span class="line">default_ca &#x3D; ca_default  #默认CA配置</span><br><span class="line">aia_url &#x3D; http:&#x2F;&#x2F;$name.$domain_suffix&#x2F;$name.crt</span><br><span class="line">crl_url &#x3D; http:&#x2F;&#x2F;$name.$domain_suffix&#x2F;$name.crl</span><br><span class="line">ocsp_url &#x3D; http:&#x2F;&#x2F;ocsp.$name.$domain_suffix:9080</span><br><span class="line">name_opt &#x3D; utf8,esc_ctrl,multiline,lname,align</span><br><span class="line"></span><br><span class="line">[ca_dn]</span><br><span class="line">countryName &#x3D; &quot;CN&quot;</span><br><span class="line">organizationName &#x3D; &quot;WeiyiGeek&quot;</span><br><span class="line">commonName &#x3D; &quot;Root CA&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.第二部分直接控制了CA的操作以及告诉OpenSSL存放文件的路径，注意由于根CA只用作二级CA的签发，此处我将设置未10年;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[ca_default]</span><br><span class="line">home = /opt/cert</span><br><span class="line">database = <span class="variable">$home</span>/db/index</span><br><span class="line">serial = <span class="variable">$home</span>/db/serial</span><br><span class="line">crlnumber = <span class="variable">$home</span>/db/crlnumber</span><br><span class="line">new_certs_dir = <span class="variable">$home</span>/certs</span><br><span class="line">certificate = <span class="variable">$home</span>/certs/<span class="variable">$name</span>.crt</span><br><span class="line">private_key = <span class="variable">$home</span>/private/<span class="variable">$name</span>.key</span><br><span class="line">RANDFILE = <span class="variable">$home</span>/private/.random</span><br><span class="line">unique_subject = no</span><br><span class="line">default_days = 3650</span><br><span class="line">default_crl_days = 365</span><br><span class="line">copy_extensions = none</span><br><span class="line"><span class="comment"># - 默认情况下使用SHA256作为签名摘要算法</span></span><br><span class="line">default_md = sha256</span><br><span class="line">policy = policy_c_o_match  <span class="comment"># 安全策略配置</span></span><br><span class="line"><span class="comment"># - 默认策略（ policy_c_o_match）限制了这张CA签发的证书的国家名和组织名会与CA本身一样 (公共CA通常不会这样使用但对于私有CA来说该方式比较合适)</span></span><br><span class="line"><span class="comment"># - supplied(提供),optional(可选择的)</span></span><br><span class="line">[policy_c_o_match]</span><br><span class="line">countryName = match</span><br><span class="line">stateOrProvinceName = optional</span><br><span class="line">organizationName = match</span><br><span class="line">organizationalUnitName = optional</span><br><span class="line">commonName = supplied</span><br><span class="line">emailAddress = optional</span><br><span class="line"></span><br><span class="line"><span class="comment"># - 公共CA策略 </span></span><br><span class="line"><span class="comment"># policy = policy_any</span></span><br><span class="line"><span class="comment"># [policy_any]</span></span><br><span class="line"><span class="comment"># countryName = match</span></span><br><span class="line"><span class="comment"># stateOrProvinceName = match</span></span><br><span class="line"><span class="comment"># organizationName = match</span></span><br><span class="line"><span class="comment"># organizationalUnitName = match</span></span><br><span class="line"><span class="comment"># localityName = optional</span></span><br><span class="line"><span class="comment"># commonName   = supplied</span></span><br><span class="line"><span class="comment"># emailAddress = optional</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>3.第三部包含了req命令的配置， req命令只会在创建自签发根证书的时候用到一次。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 最重要的部分是扩展：基本限制（ basicContraints）扩展表明这个证书是一张CA，密钥用法（ keyUsage）扩展用来说明这个CA的用处：</span></span><br><span class="line">[req]</span><br><span class="line">default_bits = 4096</span><br><span class="line">encrypt_key = yes</span><br><span class="line">default_md = sha256</span><br><span class="line">utf8 = yes</span><br><span class="line">string_mask = utf8only</span><br><span class="line">prompt = no</span><br><span class="line">distinguished_name = ca_dn <span class="comment">#辨别名称 </span></span><br><span class="line">req_extensions = ca_ext    <span class="comment">#证书请求扩展配置</span></span><br><span class="line"></span><br><span class="line">[ca_ext]</span><br><span class="line">basicConstraints = critical,CA:<span class="literal">true</span></span><br><span class="line">subjectKeyIdentifier = <span class="built_in">hash</span></span><br><span class="line">keyUsage = critical,keyCertSign,cRLSign</span><br></pre></td></tr></table></figure>
</li>
<li><p>4.第四部分包括了根CA创建证书所需要的信息。因为基本限制（ basicContraints）扩展的设置，所有的证书都将成为CA，但是我们需要把pathlen设置为0，表示这些CA无法再签发新的CA了。所有二级CA都会受到限制，也就是说他们签发的证书只能对一些域名的子集有效，并且会被限制使用场景</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一、扩展密钥用法（ extendedKeyUsage）扩展限制了只能进行客户端验证（ clientAuth）和服务器验证（ serverAuth），也就是TLS的客户端和服务器验证。</span></span><br><span class="line"><span class="comment"># 第二、名称限制（ nameContraints）扩展限制了允许签发的域名只有example.com和example.org。理论上这样的设置让你可以签发二级CA给第三方，同时可以通过限制他们无法签发任意域名的主机名来保证安全。排除这两个IP段的要求来自CAB论坛的Baseline Requirements，该规范从技术上定义了对二级CA的限制。</span></span><br><span class="line"></span><br><span class="line">[sub_ca_ext]</span><br><span class="line">authorityInfoAccess = @issuer_info</span><br><span class="line">authorityKeyIdentifier = keyid:always</span><br><span class="line">basicConstraints = critical,CA:<span class="literal">true</span>,pathlen:0</span><br><span class="line">crlDistributionPoints = @crl_info</span><br><span class="line">extendedKeyUsage = clientAuth,serverAuth</span><br><span class="line">keyUsage = critical,keyCertSign,cRLSign</span><br><span class="line">nameConstraints = @name_constraints</span><br><span class="line">subjectKeyIdentifier = <span class="built_in">hash</span></span><br><span class="line"></span><br><span class="line">[crl_info]</span><br><span class="line">URI.0 = <span class="variable">$crl_url</span></span><br><span class="line"></span><br><span class="line">[issuer_info]</span><br><span class="line">caIssuers;URI.0 = <span class="variable">$aia_url</span></span><br><span class="line">OCSP;URI.0 = <span class="variable">$ocsp_url</span></span><br><span class="line"></span><br><span class="line">[name_constraints]</span><br><span class="line">permitted;DNS.0=example.com</span><br><span class="line">permitted;DNS.1=example.org</span><br><span class="line">excluded;IP.0=0.0.0.0/0.0.0.0</span><br><span class="line">excluded;IP.1=0:0:0:0:0:0:0:0/0:0:0:0:0:0:0:0</span><br></pre></td></tr></table></figure>
<p>Tips: 实际上，名称限制（ nameContraints）并不完美，因为当前还有很多主流的平台无法识别名称限制扩展。如果你将这个扩展标记为关键扩展，就会导致很多平台拒绝识别你的证书。如果将其标记为关键扩展，那么很多平台就不会识别这个扩展，导致名称限制实际没有任何效果。</p>
</li>
<li><p>5.最后两部分的配置表示有了这个扩展的证书可以对OCSP响应进行签名。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为了能够运行OCSP响应程序，我们生成一个特别的证书，并且将OCSP的签名能力赋予这张证书。</span></span><br><span class="line">[ocsp_ext]</span><br><span class="line">authorityKeyIdentifier = keyid:always</span><br><span class="line"><span class="comment"># 从扩展可以看出这张证书不是一个CA</span></span><br><span class="line">basicConstraints = critical,CA:<span class="literal">false</span></span><br><span class="line">extendedKeyUsage = OCSPSigning</span><br><span class="line">keyUsage = critical,digitalSignature</span><br><span class="line">subjectKeyIdentifier = <span class="built_in">hash</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<p><strong>实际案例:</strong></p>
<ul>
<li><p>1.创建“根CA配置”中说到的目录结构，并且会初始化一些CA操作中会用到的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根CA的目录结构</span></span><br><span class="line">sudo mkdir -vp /opt/cert/&#123;certs,private,conf,server,client,db&#125; &amp;&amp; <span class="built_in">cd</span> /opt/cert/</span><br><span class="line"><span class="comment"># certs 目录将用于存放CA签署过的数字证书。</span></span><br><span class="line"><span class="comment"># private 目录用于存放CA的私钥(安全的重点)。</span></span><br><span class="line"><span class="comment"># conf 目录用于存放一些简化参数用的配置文件。</span></span><br><span class="line"><span class="comment"># server 目录存放服务器证书文件。</span></span><br><span class="line"><span class="comment"># client 目录存放客户端证书签名文件。</span></span><br><span class="line"><span class="comment"># db     目录用于证书数据库(index),包括下一张证书以及CRL数字的文件。 OpenSSL会创建额外需要的一些文件</span></span><br><span class="line">sudo chmod 700 private</span><br><span class="line">touch db/index</span><br><span class="line">openssl rand -hex 16 &gt; db/serial</span><br><span class="line"><span class="built_in">echo</span> 1001 &gt; db/crlnumber</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.根CA证书与私钥生成需要分两步来创建；</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) 首先生成密钥和CSR文件，备注--config 参数指定ca配置文件</span></span><br><span class="line">$ openssl req -new \</span><br><span class="line">-config conf/root-ca.conf \</span><br><span class="line">-out certs/root-ca.csr \</span><br><span class="line">-keyout private/root-ca.key</span><br><span class="line"><span class="comment"># Generating a 4096 bit RSA private key</span></span><br><span class="line"><span class="comment"># ..............................................++</span></span><br><span class="line"><span class="comment"># ..............................................++</span></span><br><span class="line"><span class="comment"># writing new private key to 'private/root-ca.key'</span></span><br><span class="line"><span class="comment"># 输入 Privacy Enhanced Mail PEM 密码</span></span><br><span class="line"><span class="comment"># Enter PEM pass phrase:</span></span><br><span class="line"><span class="comment"># Verifying - Enter PEM pass phrase:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) 其次创建自签证书，备注采用-extension参数指向了配置文件的ca_ext部分;</span></span><br><span class="line">openssl ca -selfsign \</span><br><span class="line">-config conf/root-ca.conf \</span><br><span class="line">-<span class="keyword">in</span> certs/root-ca.csr \</span><br><span class="line">-out certs/root-ca.crt \</span><br><span class="line">-extensions ca_ext</span><br><span class="line"><span class="comment"># Using configuration from conf/root-ca.conf</span></span><br><span class="line"><span class="comment"># Enter pass phrase for /opt/cert/private/root-ca.key:</span></span><br><span class="line"><span class="comment"># Check that the request matches the signature</span></span><br><span class="line"><span class="comment"># Signature ok</span></span><br><span class="line"><span class="comment"># Certificate Details:</span></span><br><span class="line"><span class="comment"># Certificate:</span></span><br><span class="line"><span class="comment">#     Data:</span></span><br><span class="line"><span class="comment">#         Version: 3 (0x2)</span></span><br><span class="line"><span class="comment">#         Serial Number: # 它会存储在数据库文件中</span></span><br><span class="line"><span class="comment">#             37:56:c1:be:ba:88:0b:33:0e:06:ac:fe:58:fd:87:24</span></span><br><span class="line"><span class="comment">#         Issuer:</span></span><br><span class="line"><span class="comment">#             countryName               = CN</span></span><br><span class="line"><span class="comment">#             organizationName          = WeiyiGeek</span></span><br><span class="line"><span class="comment">#             commonName                = Root CA</span></span><br><span class="line"><span class="comment">#         Validity</span></span><br><span class="line"><span class="comment">#             Not Before: Aug 20 04:58:11 2020 GMT</span></span><br><span class="line"><span class="comment">#             Not After : Aug 18 04:58:11 2030 GMT</span></span><br><span class="line"><span class="comment">#         Subject:</span></span><br><span class="line"><span class="comment">#             countryName               = CN</span></span><br><span class="line"><span class="comment">#             organizationName          = WeiyiGeek</span></span><br><span class="line"><span class="comment">#             commonName                = Root CA</span></span><br><span class="line"><span class="comment">#         Subject Public Key Info:</span></span><br><span class="line"><span class="comment">#             Public Key Algorithm: rsaEncryption</span></span><br><span class="line"><span class="comment">#                 Public-Key: (4096 bit)</span></span><br><span class="line"><span class="comment">#                 Modulus:</span></span><br><span class="line"><span class="comment">#                     00:c3:80:3f:cf:fc:f8:8a:1f:74:d8:1f:9c:e3:b2:</span></span><br><span class="line"><span class="comment">#                     ..........................................</span></span><br><span class="line"><span class="comment">#                     7c:69:69:32:5b:40:c1:70:1f:8e:2c:c6:20:6a:e9:</span></span><br><span class="line"><span class="comment">#                     81:d9:8b</span></span><br><span class="line"><span class="comment">#                 Exponent: 65537 (0x10001)</span></span><br><span class="line"><span class="comment">#         X509v3 extensions:</span></span><br><span class="line"><span class="comment">#             X509v3 Basic Constraints: critical</span></span><br><span class="line"><span class="comment">#                 CA:TRUE</span></span><br><span class="line"><span class="comment">#             X509v3 Subject Key Identifier:</span></span><br><span class="line"><span class="comment">#                 4B:B7:11:BE:C3:61:01:5F:C4:57:CC:9C:CE:E4:3C:3D:A6:E7:7F:56</span></span><br><span class="line"><span class="comment">#             X509v3 Key Usage: critical</span></span><br><span class="line"><span class="comment">#                 Certificate Sign, CRL Sign</span></span><br><span class="line"><span class="comment"># Certificate is to be certified until Aug 18 04:58:11 2030 GMT (3650 days)</span></span><br><span class="line"><span class="comment"># 签署的证书</span></span><br><span class="line"><span class="comment"># Sign the certificate? [y/n]:y </span></span><br><span class="line"><span class="comment"># 证书被提交并且被更新</span></span><br><span class="line"><span class="comment"># 1 out of 1 certificate requests certified, commit? [y/n]y</span></span><br><span class="line"><span class="comment"># Write out database with 1 new entries</span></span><br><span class="line"><span class="comment"># Data Base Updated</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>3.查看生成的数据库文件及其结构;<br>描述:db/index中的数据库是一个包含证书信息的明文文件，每行一个证书。我们刚刚创建根CA现在这个文件只有一行信息;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 证书 Serial Number:</span></span><br><span class="line"><span class="variable">$cat</span> /opt/cert/db/serial</span><br><span class="line">3756C1BEBA880B330E06ACFE58FD8725</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根中的所有证书信息包括(CA证书)</span></span><br><span class="line"><span class="variable">$cat</span> /opt/cert/db/index</span><br><span class="line">V 300818045811Z 3756C1BEBA880B330E06ACFE58FD8724  unknown /C=CN/O=WeiyiGeek/CN=Root CA</span><br><span class="line"><span class="comment"># (1) 状态标记［ V表示有效（ valid）， R表示已吊销（ revoked）， E表示已过期（ expired）］</span></span><br><span class="line"><span class="comment"># (2) 过期时间（以YYMMDDHHMMSSZ格式表示）</span></span><br><span class="line"><span class="comment"># (3) 吊销日期，如果没有被吊销则为空</span></span><br><span class="line"><span class="comment"># (4) 序列号（十六进制）</span></span><br><span class="line"><span class="comment"># (5) 文件路径（如果不知道就显示unknown）</span></span><br><span class="line"><span class="comment"># (6) 可分辨名称</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>4.根CA操作来签发电子证书</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) 使用ca命令的-gencrl开关给新CA生成root-ca.crl文件</span></span><br><span class="line"><span class="variable">$sudo</span> openssl ca -gencrl -config conf/root-ca.conf -out certs/root-ca.crl</span><br><span class="line"><span class="comment"># Using configuration from conf/root-ca.conf</span></span><br><span class="line"><span class="comment"># Enter pass phrase for /opt/cert/private/root-ca.key:  # 输入根密钥密码</span></span><br><span class="line"><span class="variable">$cat</span> certs/root-ca.crl</span><br><span class="line"><span class="comment"># -----BEGIN X509 CRL-----</span></span><br><span class="line"><span class="comment"># MIICjDB2AgEBMA0GCSqGSIb3DQEBCwUAMDMxCzAJBgNVBAYTAkNOMRIwEAYDVQQK</span></span><br><span class="line"><span class="comment"># DAlXZWl5aUdlZWsxEDAOBgNVBAMMB1Jvb3QgQ0EXDTIwMDgyMDA2MzE1NVoXDTIx</span></span><br><span class="line"><span class="comment"># MDgyMDA2MzE1NVqgDzANMAsGA1UdFAQEAgIQATANBgkqhkiG9w0BAQsFAAOCAgEA</span></span><br><span class="line"><span class="comment"># fEI2Jd1gPYFUGDWfpveZMDsNDkg9sd+DROes2jSCx1r8+Mbg122IpijFYRTmaz8f</span></span><br><span class="line"><span class="comment"># sz22AvB6FdMcvlVVB2zEVY+B0RykWU3uScE3Ns6mIHVmT7um5dISj/vYvEe0Fotj</span></span><br><span class="line"><span class="comment"># VGXxaqvGffbDXRJHJ1ugbgJJHjvWOzrfp+aVayg6R89hYnoeZ5Zrv3LckUXh3WJ9</span></span><br><span class="line"><span class="comment"># I23wYsy2XE9murZZ9ihgSMfVwrbY4D2pE/uPK/Tnrqgvw9qJgqyOpxVNKIJrkZWq</span></span><br><span class="line"><span class="comment"># LcFG0sORLWkTeuHIaqZstGbD+bYfMuJNGXY7IZltdaS4/dONcz1DAa0hOBHmipwi</span></span><br><span class="line"><span class="comment"># cTMON51SXDYuqQ3hjNBuevsxjWW99/tpVrtX/aWhFmgGoVEswy7uIQTca3y6goai</span></span><br><span class="line"><span class="comment"># MKvBesHiL6B1JU2hTEEBMGVL+UXuGsFS4E+GfIAkdbnVd2uc806c7mtzIYvfG4Cu</span></span><br><span class="line"><span class="comment"># bccjqWvo4Wr6irkbFdS/TY5dCsjeuEZ1vr15aYwAvmozOsRXfEhbXnB7eJXDZucq</span></span><br><span class="line"><span class="comment"># ze7Zgc0I/G3Wy8TVHKnxCOL9CmffsVfsCrYFHd6Bvd2RvH2MtqdJpbGfpQd8Oc4S</span></span><br><span class="line"><span class="comment"># nBJEQ6dz3aVBaxeY/3hLnuSjqr+z7x/0PMGXMTS6ohAw4ZPnva8qaCDscb6+kgGg</span></span><br><span class="line"><span class="comment"># 0FxKZz/D0JYkrlSp3GOxwl8vvFnsiCavo8InFtQp4SM=</span></span><br><span class="line"><span class="comment"># -----END X509 CRL-----</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) 使用ca的命令来签发证书，注意的是-extensions开关需要指向配置文件里面正确的部分;</span></span><br><span class="line"><span class="comment"># 例如，你肯定不希望再生成另一个根CA</span></span><br><span class="line">$ openssl ca \</span><br><span class="line">-config conf/root-ca.conf \</span><br><span class="line">-<span class="keyword">in</span> certs/root-ca.csr \</span><br><span class="line">-out certs/sub-ca.crt \</span><br><span class="line">-extensions sub_ca_ext</span><br><span class="line"><span class="comment"># Enter pass phrase for /opt/cert/private/root-ca.key:</span></span><br><span class="line"><span class="comment"># Check that the request matches the signature</span></span><br><span class="line"><span class="comment"># Signature ok</span></span><br><span class="line"><span class="comment"># Certificate Details:</span></span><br><span class="line"><span class="comment"># Certificate:</span></span><br><span class="line"><span class="comment">#     Data:</span></span><br><span class="line"><span class="comment">#         Version: 3 (0x2)</span></span><br><span class="line"><span class="comment">#         Serial Number:</span></span><br><span class="line"><span class="comment">#             37:56:c1:be:ba:88:0b:33:0e:06:ac:fe:58:fd:87:25</span></span><br><span class="line"><span class="comment">#         Issuer:</span></span><br><span class="line"><span class="comment">#             countryName               = CN</span></span><br><span class="line"><span class="comment">#             organizationName          = WeiyiGeek</span></span><br><span class="line"><span class="comment">#             commonName                = Root CA</span></span><br><span class="line"><span class="comment">#         Validity</span></span><br><span class="line"><span class="comment">#             Not Before: Aug 20 06:55:58 2020 GMT</span></span><br><span class="line"><span class="comment">#             Not After : Aug 18 06:55:58 2030 GMT</span></span><br><span class="line"><span class="comment">#         Subject:</span></span><br><span class="line"><span class="comment">#             countryName               = CN</span></span><br><span class="line"><span class="comment">#             organizationName          = WeiyiGeek</span></span><br><span class="line"><span class="comment">#             commonName                = Root CA</span></span><br><span class="line"><span class="comment">#         Subject Public Key Info:</span></span><br><span class="line"><span class="comment">#             Public Key Algorithm: rsaEncryption</span></span><br><span class="line"><span class="comment">#                 Public-Key: (4096 bit)</span></span><br><span class="line"><span class="comment">#                 Modulus:</span></span><br><span class="line"><span class="comment">#                     00:c3:80:3f:cf:fc:f8:8a:1f:74:d8:1f:9c:e3:b2:</span></span><br><span class="line"><span class="comment">#                     7c:e5:b8:b3:2e:19:c7:91:b5:26:b4:c9:22:e1:3e:</span></span><br><span class="line"><span class="comment">#                     ..............................................</span></span><br><span class="line"><span class="comment">#                     7c:69:69:32:5b:40:c1:70:1f:8e:2c:c6:20:6a:e9:</span></span><br><span class="line"><span class="comment">#                     81:d9:8b</span></span><br><span class="line"><span class="comment">#                 Exponent: 65537 (0x10001)</span></span><br><span class="line"><span class="comment">#         X509v3 extensions:</span></span><br><span class="line"><span class="comment">#             Authority Information Access:</span></span><br><span class="line"><span class="comment">#                 CA Issuers - URI:http://root-ca.wieyigeek.top/root-ca.crt</span></span><br><span class="line"><span class="comment">#                 OCSP - URI:http://ocsp.root-ca.wieyigeek.top:9080</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#             X509v3 Authority Key Identifier:</span></span><br><span class="line"><span class="comment">#                 keyid:4B:B7:11:BE:C3:61:01:5F:C4:57:CC:9C:CE:E4:3C:3D:A6:E7:7F:56</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#             X509v3 Basic Constraints: critical</span></span><br><span class="line"><span class="comment">#                 CA:TRUE, pathlen:0</span></span><br><span class="line"><span class="comment">#             X509v3 CRL Distribution Points:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#                 Full Name:</span></span><br><span class="line"><span class="comment">#                   URI:http://root-ca.wieyigeek.top/root-ca.crl</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#             X509v3 Extended Key Usage:</span></span><br><span class="line"><span class="comment">#                 TLS Web Client Authentication, TLS Web Server Authentication</span></span><br><span class="line"><span class="comment">#             X509v3 Key Usage: critical</span></span><br><span class="line"><span class="comment">#                 Certificate Sign, CRL Sign</span></span><br><span class="line"><span class="comment">#             X509v3 Name Constraints:</span></span><br><span class="line"><span class="comment">#                 Permitted:</span></span><br><span class="line"><span class="comment">#                   DNS:example.com</span></span><br><span class="line"><span class="comment">#                   DNS:example.org</span></span><br><span class="line"><span class="comment">#                 Excluded:</span></span><br><span class="line"><span class="comment">#                   IP:0.0.0.0/0.0.0.0</span></span><br><span class="line"><span class="comment">#                   IP:0:0:0:0:0:0:0:0/0:0:0:0:0:0:0:0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#             X509v3 Subject Key Identifier:</span></span><br><span class="line"><span class="comment">#                 4B:B7:11:BE:C3:61:01:5F:C4:57:CC:9C:CE:E4:3C:3D:A6:E7:7F:56</span></span><br><span class="line"><span class="comment"># Certificate is to be certified until Aug 18 06:55:58 2030 GMT (3650 days)</span></span><br><span class="line"><span class="comment"># Sign the certificate? [y/n]:y</span></span><br><span class="line"><span class="comment"># 1 out of 1 certificate requests certified, commit? [y/n]y</span></span><br><span class="line"><span class="comment"># Write out database with 1 new entries</span></span><br><span class="line"><span class="comment"># Data Base Updated</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) 如果要吊销证书，可以使用ca命令的-revoke开关，不过需要有一份你想吊销的证书的副本。不过因为所有的证书都存在certs/目录下所以只需要知道序列号即可。如果知道证书的可分辨名称，就可以在数据库里面查到它的序列号了。 </span></span><br><span class="line"><span class="comment"># 选项 -crl_reason 可选参数值: unspecified、keyCompromise 、 CACompromise 、 affiliationChanged 、 superseded 、 cessationOfOperation 、certificateHold和removeFromCRL;</span></span><br><span class="line">$ openssl ca \</span><br><span class="line">-config conf/root-ca.conf \</span><br><span class="line">-revoke certs/serialnumber.pem \</span><br><span class="line">-crl_reason keyCompromise</span><br><span class="line"><span class="comment"># $ openssl ca -config conf/root-ca.conf -revoke certs/sub-ca.crt -crl_reason keyCompromise</span></span><br><span class="line"><span class="comment"># Using configuration from conf/root-ca.conf</span></span><br><span class="line"><span class="comment"># Enter pass phrase for /opt/cert/private/root-ca.key:</span></span><br><span class="line"><span class="comment"># Revoking Certificate 3756C1BEBA880B330E06ACFE58FD8725.</span></span><br><span class="line"><span class="comment"># Data Base Updated</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>5.创建用于OCSP签名的证书</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) 首先需要给OCSP响应程序创建一个私钥private和csr，备注该操作对所有的非CA证书都适用所以缺省即可;</span></span><br><span class="line">openssl req -new \</span><br><span class="line">-newkey rsa:2048 \</span><br><span class="line">-subj <span class="string">"/C=CN/O=WeiyiGeek/CN=OCSP Root Responder"</span> \</span><br><span class="line">-keyout private/root-ocsp.key \</span><br><span class="line">-out certs/root-ocsp.csr</span><br><span class="line"><span class="comment"># Generating a 2048 bit RSA private key</span></span><br><span class="line"><span class="comment"># ....................+++</span></span><br><span class="line"><span class="comment"># .................................+++</span></span><br><span class="line"><span class="comment"># writing new private key to 'private/root-ocsp.key'</span></span><br><span class="line"><span class="comment"># Enter PEM pass phrase:  # weiyigeekocsp</span></span><br><span class="line"><span class="comment"># Verifying - Enter PEM pass phrase:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) 其次需要使用根CA签发一张证书，任然采用-extensions选择ocsp_ext以确保设置了OCSP签名所需要的扩展;</span></span><br><span class="line"><span class="comment"># 在root-ca.conf配置文件中设置键值对如default_crl_days = 365,证书的生命周期减少为365天;</span></span><br><span class="line">$ openssl ca \</span><br><span class="line">-config conf/root-ca.conf \</span><br><span class="line">-<span class="keyword">in</span> certs/root-ocsp.csr \</span><br><span class="line">-out certs/root-ocsp.crt \</span><br><span class="line">-extensions ocsp_ext \</span><br><span class="line">-days 30</span><br><span class="line"><span class="comment"># Enter pass phrase for /opt/cert/private/root-ca.key:</span></span><br><span class="line"><span class="comment"># Check that the request matches the signature</span></span><br><span class="line"><span class="comment"># Signature ok</span></span><br><span class="line"><span class="comment"># Certificate Details:</span></span><br><span class="line"><span class="comment"># Certificate:</span></span><br><span class="line"><span class="comment">#     Data:</span></span><br><span class="line"><span class="comment">#         Version: 3 (0x2)</span></span><br><span class="line"><span class="comment">#         Serial Number:</span></span><br><span class="line"><span class="comment">#             37:56:c1:be:ba:88:0b:33:0e:06:ac:fe:58:fd:87:26</span></span><br><span class="line"><span class="comment">#         Issuer:</span></span><br><span class="line"><span class="comment">#             countryName               = CN</span></span><br><span class="line"><span class="comment">#             organizationName          = WeiyiGeek</span></span><br><span class="line"><span class="comment">#             commonName                = Root CA</span></span><br><span class="line"><span class="comment">#         Validity</span></span><br><span class="line"><span class="comment">#             Not Before: Aug 20 07:15:03 2020 GMT</span></span><br><span class="line"><span class="comment">#             Not After : Sep 19 07:15:03 2020 GMT</span></span><br><span class="line"><span class="comment">#         Subject:</span></span><br><span class="line"><span class="comment">#             countryName               = CN</span></span><br><span class="line"><span class="comment">#             organizationName          = WeiyiGeek</span></span><br><span class="line"><span class="comment">#             commonName                = OCSP Root Responder</span></span><br><span class="line"><span class="comment">#         Subject Public Key Info:</span></span><br><span class="line"><span class="comment">#             Public Key Algorithm: rsaEncryption</span></span><br><span class="line"><span class="comment">#                 Public-Key: (2048 bit)</span></span><br><span class="line"><span class="comment">#                 Modulus:</span></span><br><span class="line"><span class="comment">#                     00:d1:6b:fe:4e:f1:a4:19:02:17:6e:62:69:d6:77:</span></span><br><span class="line"><span class="comment">#                     ....</span></span><br><span class="line"><span class="comment">#                     08:1f:8b:d0:1c:45:29:50:56:16:e6:4f:13:1e:7f:</span></span><br><span class="line"><span class="comment">#                     5f:8b</span></span><br><span class="line"><span class="comment">#                 Exponent: 65537 (0x10001)</span></span><br><span class="line"><span class="comment">#         X509v3 extensions:</span></span><br><span class="line"><span class="comment">#             X509v3 Authority Key Identifier:</span></span><br><span class="line"><span class="comment">#                 keyid:4B:B7:11:BE:C3:61:01:5F:C4:57:CC:9C:CE:E4:3C:3D:A6:E7:7F:56</span></span><br><span class="line"><span class="comment">#             X509v3 Basic Constraints: critical</span></span><br><span class="line"><span class="comment">#                 CA:FALSE</span></span><br><span class="line"><span class="comment">#             X509v3 Extended Key Usage:</span></span><br><span class="line"><span class="comment">#                 OCSP Signing</span></span><br><span class="line"><span class="comment">#             X509v3 Key Usage: critical</span></span><br><span class="line"><span class="comment">#                 Digital Signature</span></span><br><span class="line"><span class="comment">#             X509v3 Subject Key Identifier:</span></span><br><span class="line"><span class="comment">#                 42:F1:20:F8:82:77:81:F5:92:61:69:41:D8:40:C0:EA:35:03:E0:51</span></span><br><span class="line"><span class="comment"># Certificate is to be certified until Sep 19 07:15:03 2020 GMT (30 days)</span></span><br><span class="line"><span class="comment"># Sign the certificate? [y/n]:y</span></span><br><span class="line"><span class="comment"># 1 out of 1 certificate requests certified, commit? [y/n]y</span></span><br><span class="line"><span class="comment"># Write out database with 1 new entries</span></span><br><span class="line"><span class="comment"># Data Base Updated</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) OCSP响应程序可以直接在根CA所在的服务器上进行测试，注意如果在生产环境中使用就必须将OCSP响应程序的密钥和证书放在别的地方;</span></span><br><span class="line"><span class="comment"># Server (注意需要输入OCSP密钥密码)</span></span><br><span class="line">$ openssl ocsp -port 9080 \</span><br><span class="line">-index db/index \</span><br><span class="line">-rsigner certs/root-ocsp.crt \</span><br><span class="line">-rkey private/root-ocsp.key \</span><br><span class="line">-CA certs/root-ca.crt \</span><br><span class="line">-text</span><br><span class="line"></span><br><span class="line"><span class="comment"># client 测试OCSP响应程序即ocsp证书是否过期(其他签名证书也可验证)</span></span><br><span class="line">$ openssl ocsp \</span><br><span class="line">-issuer certs/root-ca.crt \</span><br><span class="line">-CAfile certs/root-ca.crt \</span><br><span class="line">-cert certs/root-ocsp.crt \</span><br><span class="line">-url http://127.0.0.1:9080</span><br></pre></td></tr></table></figure>
<p>输出结果中的verify OK表示已经成功验证签名，而good表示这张证书还没有被吊销。 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Response verify OK</span><br><span class="line">certs/root-ocsp.crt: good</span><br><span class="line">This Update: Aug 20 07:24:56 2020 GMT</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=系统安全加密验证签名之Openssl命令 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200820152842.png" target="_blank" title="WeiyiGeek.vertify-OCSP" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200820152842.png" alt="WeiyiGeek.vertify-OCSP" title="" class=""></a>
                <p>WeiyiGeek.vertify-OCSP</p>
            </figure>
</li>
</ul>
<p>Tips: 由于OCSP证书是没有吊销信息的所以无法吊销它们，因此您会希望极可能去减少他们的声明周期,上面设置成为30天但是后续需要频繁地创建新的OCSP证书(<code>所以万事皆有好有坏</code>);</p>
<p><br></p>
<ul>
<li>6.创建二级CA的过程和根CA几乎完全一样,但我们需要对原有的<code>root-ca.conf</code>进行适当的修改生成二级CA的配置;<br>需求如下:<blockquote>
<p>1) 二级CA名称更改为sub-ca并且使用另一个可分辨名称;<br>2) 将二级CA的OCSP响应程序放在另外一个端口，主要是因为ocsp命令不识别虚拟主机;<br>3) 同样证书默认生命周期是365天我们会每隔30天生成全新的CRL文件;</p>
</blockquote>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) 二级CA初始化与配置文件</span></span><br><span class="line">mkdir -vp /opt/cert/sub/&#123;certs,private,conf,server,client,db&#125;</span><br><span class="line">sudo chmod 700 /opt/cert/sub/private</span><br><span class="line">touch /opt/cert/sub/db/index</span><br><span class="line">openssl rand -hex 16 &gt; /opt/cert/sub/db/serial</span><br><span class="line"><span class="built_in">echo</span> 1001 &gt; /opt/cert/sub/db/crlnumber</span><br><span class="line"></span><br><span class="line">tee conf/sub-ca.conf &lt;&lt;-<span class="string">'EOF'</span></span><br><span class="line">[default]</span><br><span class="line">domain_suffix = wieyigeek.top</span><br><span class="line">default_ca = sub_ca_default  <span class="comment">#默认CA配置</span></span><br><span class="line"><span class="comment"># -- 修改点开始---</span></span><br><span class="line">name = sub-ca</span><br><span class="line">ocsp_url = http://ocsp.<span class="variable">$name</span>.<span class="variable">$domain_suffix</span>:9081</span><br><span class="line"><span class="comment"># -- 修改点结束---</span></span><br><span class="line">aia_url = http://<span class="variable">$name</span>.<span class="variable">$domain_suffix</span>/<span class="variable">$name</span>.crt</span><br><span class="line">crl_url = http://<span class="variable">$name</span>.<span class="variable">$domain_suffix</span>/<span class="variable">$name</span>.crl</span><br><span class="line">name_opt = utf8,esc_ctrl,multiline,lname,align</span><br><span class="line"></span><br><span class="line">[ca_dn]</span><br><span class="line">countryName = <span class="string">"CN"</span></span><br><span class="line">organizationName = <span class="string">"WeiyiGeek"</span></span><br><span class="line"><span class="comment"># --- 修改点 ----</span></span><br><span class="line">commonName = <span class="string">"Sub CA"</span> </span><br><span class="line"></span><br><span class="line">[sub_ca_default]</span><br><span class="line">home = /opt/cert/sub</span><br><span class="line">database = <span class="variable">$home</span>/db/index</span><br><span class="line">serial = <span class="variable">$home</span>/db/serial</span><br><span class="line">crlnumber = <span class="variable">$home</span>/db/crlnumber</span><br><span class="line">new_certs_dir = <span class="variable">$home</span>/certs</span><br><span class="line">certificate = <span class="variable">$home</span>/certs/<span class="variable">$name</span>.crt</span><br><span class="line">private_key = <span class="variable">$home</span>/private/<span class="variable">$name</span>.key</span><br><span class="line">RANDFILE = <span class="variable">$home</span>/private/.random</span><br><span class="line">unique_subject = no</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 修改开始 ---</span></span><br><span class="line">default_days = 365</span><br><span class="line">default_crl_days = 30</span><br><span class="line">copy_extensions = copy</span><br><span class="line"><span class="comment"># --- 修改结束 ---</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - 默认情况下使用SHA256作为签名摘要算法</span></span><br><span class="line">default_md = sha256</span><br><span class="line">policy = policy_c_o_match  <span class="comment"># 安全策略配置</span></span><br><span class="line"><span class="comment"># - 默认策略（ policy_c_o_match）限制了这张CA签发的证书的国家名和组织名会与CA本身一样 (公共CA通常不会这样使用但对于私有CA来说该方式比较合适)</span></span><br><span class="line"><span class="comment"># - supplied(提供),optional(可选择的)</span></span><br><span class="line">[policy_c_o_match]</span><br><span class="line">countryName = match</span><br><span class="line">stateOrProvinceName = optional</span><br><span class="line">organizationName = match</span><br><span class="line">organizationalUnitName = optional</span><br><span class="line">commonName = supplied</span><br><span class="line">emailAddress = optional</span><br><span class="line"></span><br><span class="line">[req]</span><br><span class="line">default_bits = 4096</span><br><span class="line">encrypt_key = yes</span><br><span class="line">default_md = sha256</span><br><span class="line">utf8 = yes</span><br><span class="line">string_mask = utf8only</span><br><span class="line">prompt = no</span><br><span class="line">distinguished_name = ca_dn <span class="comment">#辨别名称</span></span><br><span class="line">req_extensions = ca_ext    <span class="comment">#证书请求扩展配置</span></span><br><span class="line"></span><br><span class="line">[ca_ext]</span><br><span class="line">basicConstraints = critical,CA:<span class="literal">true</span></span><br><span class="line">subjectKeyIdentifier = <span class="built_in">hash</span></span><br><span class="line">keyUsage = critical,keyCertSign,cRLSign</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[sub_ca_ext]</span><br><span class="line">authorityInfoAccess = @issuer_info</span><br><span class="line">authorityKeyIdentifier = keyid:always</span><br><span class="line">basicConstraints = critical,CA:<span class="literal">true</span>,pathlen:0</span><br><span class="line">crlDistributionPoints = @crl_info</span><br><span class="line">extendedKeyUsage = clientAuth,serverAuth</span><br><span class="line">keyUsage = critical,keyCertSign,cRLSign</span><br><span class="line">nameConstraints = @name_constraints</span><br><span class="line">subjectKeyIdentifier = <span class="built_in">hash</span></span><br><span class="line"></span><br><span class="line">[crl_info]</span><br><span class="line">URI.0 = <span class="variable">$crl_url</span></span><br><span class="line"></span><br><span class="line">[issuer_info]</span><br><span class="line">caIssuers;URI.0 = <span class="variable">$aia_url</span></span><br><span class="line">OCSP;URI.0 = <span class="variable">$ocsp_url</span></span><br><span class="line"></span><br><span class="line">[name_constraints]</span><br><span class="line">permitted;DNS.0=example.com</span><br><span class="line">permitted;DNS.1=example.org</span><br><span class="line">excluded;IP.0=0.0.0.0/0.0.0.0</span><br><span class="line">excluded;IP.1=0:0:0:0:0:0:0:0/0:0:0:0:0:0:0:0</span><br><span class="line"></span><br><span class="line">[ocsp_ext]</span><br><span class="line">authorityKeyIdentifier = keyid:always</span><br><span class="line"><span class="comment"># 从扩展可以看出这张证书不是一个CA</span></span><br><span class="line">basicConstraints = critical,CA:<span class="literal">false</span></span><br><span class="line">extendedKeyUsage = OCSPSigning</span><br><span class="line">keyUsage = critical,digitalSignature</span><br><span class="line">subjectKeyIdentifier = <span class="built_in">hash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -- 修改点:server_ext 与client_ext 用于服务器和客户端证书的生成 ---</span></span><br><span class="line">[server_ext]</span><br><span class="line">authorityInfoAccess = @issuer_info</span><br><span class="line">authorityKeyIdentifier = keyid:always</span><br><span class="line">basicConstraints = critical,CA:<span class="literal">false</span></span><br><span class="line">crlDistributionPoints = @crl_info</span><br><span class="line">extendedKeyUsage = clientAuth,serverAuth</span><br><span class="line">keyUsage = critical,digitalSignature,keyEncipherment</span><br><span class="line">subjectKeyIdentifier = <span class="built_in">hash</span></span><br><span class="line"></span><br><span class="line">[client_ext]</span><br><span class="line">authorityInfoAccess = @issuer_info</span><br><span class="line">authorityKeyIdentifier = keyid:always</span><br><span class="line">basicConstraints = critical,CA:<span class="literal">false</span></span><br><span class="line">crlDistributionPoints = @crl_info</span><br><span class="line">extendedKeyUsage = clientAuth</span><br><span class="line">keyUsage = critical,digitalSignature</span><br><span class="line">subjectKeyIdentifier = <span class="built_in">hash</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p>Tips: 配置文件中copy_extensions值为copy意味着在生成新证书的时候如果配置文件里面没有设置某些扩展，此时它将会使用CSR文件里面的扩展字段; 但是这个特性有几分危险因为允许其他人可以在一定程度上直接控制证书里面的内容(<code>在准备CSR文件的时候有可能被攻击者加入某些需要字段，此时在生成证书便可能被复制加入到证书中</code>)，不过我认为在较小的环境中这么做是可以的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (2) 按照根CA的过程创建一个同样的目录结构，不过可以使用另外一个名称比如sub-ca。</span></span><br><span class="line"><span class="comment"># 根二级CA的证书请求文件与密钥生成</span></span><br><span class="line">openssl req -new \</span><br><span class="line">-config conf/sub-ca.conf \</span><br><span class="line">-out sub/certs/sub-ca.csr \</span><br><span class="line">-keyout sub/private/sub-ca.key</span><br><span class="line"><span class="comment"># Generating a 4096 bit RSA private key</span></span><br><span class="line"><span class="comment"># writing new private key to 'sub/private/sub-ca.key'</span></span><br><span class="line"><span class="comment"># Enter PEM pass phrase: #pass -&gt; weiyigeeksub</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) 使用根CA来签发证书,-extensions开关指向配置文件中的sub_ca_ext 从而使用二级CA所需要的扩展;</span></span><br><span class="line">$ openssl ca \</span><br><span class="line">-config conf/root-ca.conf \  <span class="comment"># 此处的特殊性采用根CA签发二级CA</span></span><br><span class="line">-<span class="keyword">in</span> sub/certs/sub-ca.csr \</span><br><span class="line">-out sub/certs/sub-ca.crt \</span><br><span class="line">-extensions sub_ca_ext</span><br><span class="line"><span class="comment"># Using configuration from conf/root-ca.conf</span></span><br><span class="line"><span class="comment"># Enter pass phrase for /opt/cert/private/root-ca.key: weiyigeek</span></span><br><span class="line"><span class="comment"># 检查请求是否与签名匹配</span></span><br><span class="line"><span class="comment"># Signature ok</span></span><br><span class="line"><span class="comment"># Certificate:</span></span><br><span class="line"><span class="comment">#     Data:</span></span><br><span class="line"><span class="comment">#         Version: 3 (0x2)</span></span><br><span class="line"><span class="comment">#         Serial Number:</span></span><br><span class="line"><span class="comment">#             37:56:c1:be:ba:88:0b:33:0e:06:ac:fe:58:fd:87:27</span></span><br><span class="line"><span class="comment">#         Issuer:</span></span><br><span class="line"><span class="comment">#             countryName               = CN</span></span><br><span class="line"><span class="comment">#             organizationName          = WeiyiGeek</span></span><br><span class="line"><span class="comment">#             commonName                = Root CA</span></span><br><span class="line"><span class="comment">#         Validity</span></span><br><span class="line"><span class="comment">#             Not Before: Aug 20 09:06:16 2020 GMT</span></span><br><span class="line"><span class="comment">#             Not After : Aug 18 09:06:16 2030 GMT</span></span><br><span class="line">          <span class="comment"># 证书包含二级CA (关键点)</span></span><br><span class="line"><span class="comment">#         Subject:</span></span><br><span class="line"><span class="comment">#             countryName               = CN</span></span><br><span class="line"><span class="comment">#             organizationName          = WeiyiGeek</span></span><br><span class="line"><span class="comment">#             commonName                = Sub CA</span></span><br><span class="line"><span class="comment">#         Subject Public Key Info:</span></span><br><span class="line"><span class="comment">#             Public Key Algorithm: rsaEncryption</span></span><br><span class="line"><span class="comment">#                 Public-Key: (4096 bit)</span></span><br><span class="line"><span class="comment">#                 Modulus:</span></span><br><span class="line"><span class="comment">#                     00:b6:cc:db:86:9a:65:2d:f7:89:38:88:8d:52:9c:</span></span><br><span class="line"><span class="comment">#                     .....</span></span><br><span class="line"><span class="comment">#                     93:39:c1</span></span><br><span class="line"><span class="comment">#                 Exponent: 65537 (0x10001)</span></span><br><span class="line"><span class="comment">#         X509v3 extensions:</span></span><br><span class="line"><span class="comment">#             Authority Information Access:</span></span><br><span class="line"><span class="comment">#                 CA Issuers - URI:http://root-ca.wieyigeek.top/root-ca.crt</span></span><br><span class="line"><span class="comment">#                 OCSP - URI:http://ocsp.root-ca.wieyigeek.top:9080</span></span><br><span class="line"><span class="comment">#             X509v3 Authority Key Identifier:</span></span><br><span class="line"><span class="comment">#                 keyid:4B:B7:11:BE:C3:61:01:5F:C4:57:CC:9C:CE:E4:3C:3D:A6:E7:7F:56</span></span><br><span class="line"><span class="comment">#             X509v3 Basic Constraints: critical</span></span><br><span class="line"><span class="comment">#                 CA:TRUE, pathlen:0</span></span><br><span class="line"><span class="comment">#             X509v3 CRL Distribution Points:</span></span><br><span class="line"><span class="comment">#                 Full Name:</span></span><br><span class="line"><span class="comment">#                   URI:http://root-ca.wieyigeek.top/root-ca.crl</span></span><br><span class="line"><span class="comment">#             X509v3 Extended Key Usage:</span></span><br><span class="line"><span class="comment">#                 TLS Web Client Authentication, TLS Web Server Authentication</span></span><br><span class="line"><span class="comment">#             X509v3 Key Usage: critical</span></span><br><span class="line"><span class="comment">#                 Certificate Sign, CRL Sign</span></span><br><span class="line">              .....</span><br><span class="line"><span class="comment">#             X509v3 Subject Key Identifier:</span></span><br><span class="line"><span class="comment">#                 2E:68:BB:4E:04:63:99:70:0F:FB:DC:D9:9C:C2:9B:D6:27:D7:97:86</span></span><br><span class="line"><span class="comment"># Certificate is to be certified until Aug 18 09:06:16 2030 GMT (3650 days)</span></span><br><span class="line"><span class="comment"># 签署的证书? [y/n]:y</span></span><br><span class="line"><span class="comment">#1 / 1的证书请求被认证，提交? [y/n]y</span></span><br><span class="line"><span class="comment"># Write out database with 1 new entries | 写出有1个新条目的数据库</span></span><br><span class="line"><span class="comment"># Data Base Updated | 数据库更新</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) 使用ca命令的-gencrl开关给二级CA生成sub-ca.crl文件</span></span><br><span class="line">$ sudo openssl ca -gencrl -config conf/sub-ca.conf -out sub/certs/sub-ca.crl</span><br><span class="line"><span class="comment"># Enter pass phrase for /opt/cert/sub/private/sub-ca.key: weiyigeeksub</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5)二级CA之OCSP响应程序的密钥和证书生成：</span></span><br><span class="line"><span class="comment">#  OCSP 密钥与证书请求文件生成</span></span><br><span class="line">openssl req -new \</span><br><span class="line">-newkey rsa:2048 \</span><br><span class="line">-subj <span class="string">"/C=CN/O=WeiyiGeek/CN=OCSP Sub Responder"</span> \</span><br><span class="line">-keyout sub/private/sub-ocsp.key \</span><br><span class="line">-out sub/certs/sub-ocsp.csr</span><br><span class="line"><span class="comment"># writing new private key to 'sub/private/sub-ocsp.key'</span></span><br><span class="line"><span class="comment"># Enter PEM pass phrase: # weiyigeeksubocsp</span></span><br><span class="line"><span class="comment"># Verifying - Enter PEM pass phrase:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 其次需要使用根CA签发一张证书，任然采用-extensions选择ocsp_ext以确保设置了OCSP签名所需要的扩展;</span></span><br><span class="line"><span class="comment"># 在root-ca.conf 配置文件中设置键值对如default_crl_days = 365,证书的生命周期减少为365天;</span></span><br><span class="line">$ openssl ca \</span><br><span class="line">-config conf/sub-ca.conf \</span><br><span class="line">-<span class="keyword">in</span> sub/certs/sub-ocsp.csr \</span><br><span class="line">-out sub/certs/sub-ocsp.crt \</span><br><span class="line">-extensions ocsp_ext \</span><br><span class="line">-days 30</span><br><span class="line"><span class="comment"># Enter pass phrase for /opt/cert/sub/private/sub-ca.key: weiyigeeksub</span></span><br><span class="line"><span class="comment"># Check that the request matches the signature</span></span><br><span class="line"><span class="comment"># Signature ok</span></span><br><span class="line"><span class="comment"># Certificate Details:</span></span><br><span class="line"><span class="comment"># Certificate:</span></span><br><span class="line"><span class="comment">#     Data:</span></span><br><span class="line"><span class="comment">#         Version: 3 (0x2)</span></span><br><span class="line"><span class="comment">#         Serial Number:</span></span><br><span class="line"><span class="comment">#             37:56:c1:be:ba:88:0b:33:0e:06:ac:fe:58:fd:87:2a</span></span><br><span class="line"><span class="comment">#         Issuer:</span></span><br><span class="line"><span class="comment">#             countryName               = CN</span></span><br><span class="line"><span class="comment">#             organizationName          = WeiyiGeek</span></span><br><span class="line"><span class="comment">#             commonName                = Sub CA</span></span><br><span class="line"><span class="comment">#         Validity</span></span><br><span class="line"><span class="comment">#             Not Before: Aug 20 14:58:01 2020 GMT</span></span><br><span class="line"><span class="comment">#             Not After : Sep 19 14:58:01 2020 GMT</span></span><br><span class="line"><span class="comment">#         Subject:</span></span><br><span class="line"><span class="comment">#             countryName               = CN</span></span><br><span class="line"><span class="comment">#             organizationName          = WeiyiGeek</span></span><br><span class="line"><span class="comment">#             commonName                = OCSP Sub Responder</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) 服务端/客户端证书请文件和密钥生成</span></span><br><span class="line"><span class="comment"># private key  (此处采用私钥加密，在测试的时候可-nodes即禁止对私钥文件加密)</span></span><br><span class="line">openssl genrsa -des3 -out sub/private/server.key 2048 <span class="comment"># weiyigeekserver</span></span><br><span class="line">openssl genrsa -des3 -out sub/private/client.key 2048 <span class="comment"># weiyigeekclient</span></span><br><span class="line"><span class="comment"># generate csr (需要注意Organization Name与CA机构CA certificate一致为WeiyiGeek)</span></span><br><span class="line">openssl req -new -key sub/private/server.key -out sub/certs/server.csr</span><br><span class="line"><span class="comment"># -----</span></span><br><span class="line"><span class="comment"># Country Name (2 letter code) [XX]:CN</span></span><br><span class="line"><span class="comment"># State or Province Name (full name) []:ChongQing</span></span><br><span class="line"><span class="comment"># Locality Name (eg, city) [Default City]:CQ</span></span><br><span class="line"><span class="comment"># Organization Name (eg, company) [Default Company Ltd]:WeiyiGeek</span></span><br><span class="line"><span class="comment"># Organizational Unit Name (eg, section) []:weiyigeek</span></span><br><span class="line"><span class="comment"># Common Name (eg, your name or your server's hostname) []:server.weiyigeek.top</span></span><br><span class="line"><span class="comment"># Email Address []:master@weiyigeek.top</span></span><br><span class="line">openssl req -new -key sub/private/client.key -out sub/certs/client.csr  </span><br><span class="line"><span class="comment"># -----</span></span><br><span class="line"><span class="comment"># Country Name (2 letter code) [XX]:CN</span></span><br><span class="line"><span class="comment"># State or Province Name (full name) []:ChongQing</span></span><br><span class="line"><span class="comment"># Locality Name (eg, city) [Default City]:CQ</span></span><br><span class="line"><span class="comment"># Organization Name (eg, company) [Default Company Ltd]:WeiyiGeek</span></span><br><span class="line"><span class="comment"># Organizational Unit Name (eg, section) []:client</span></span><br><span class="line"><span class="comment"># Common Name (eg, your name or your server's hostname) []:weiyigeek.top</span></span><br><span class="line"><span class="comment"># Email Address []:master@weiyigeek.top</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) 二级CA操作之签发服务器证书，即-extension server_ext</span></span><br><span class="line">openssl ca \</span><br><span class="line">-config conf/sub-ca.conf \</span><br><span class="line">-<span class="keyword">in</span> sub/certs/server.csr \</span><br><span class="line">-out sub/certs/server.crt \</span><br><span class="line">-extensions server_ext</span><br><span class="line"><span class="comment"># Enter pass phrase for /opt/cert/sub/private/sub-ca.key:</span></span><br><span class="line"><span class="comment"># Check that the request matches the signature</span></span><br><span class="line"><span class="comment"># Certificate:</span></span><br><span class="line"><span class="comment">#     Data:</span></span><br><span class="line"><span class="comment">#         Version: 3 (0x2)</span></span><br><span class="line"><span class="comment">#         Serial Number:</span></span><br><span class="line"><span class="comment">#             5e:75:c7:d6:4e:33:0f:03:58:d4:82:d3:94:75:03:46</span></span><br><span class="line"><span class="comment">#         Issuer:</span></span><br><span class="line"><span class="comment">#             countryName               = CN</span></span><br><span class="line"><span class="comment">#             organizationName          = WeiyiGeek</span></span><br><span class="line"><span class="comment">#             commonName                = Sub CA</span></span><br><span class="line"><span class="comment">#         Validity</span></span><br><span class="line"><span class="comment">#             Not Before: Aug 20 15:40:41 2020 GMT</span></span><br><span class="line"><span class="comment">#             Not After : Aug 20 15:40:41 2021 GMT</span></span><br><span class="line"><span class="comment">#         Subject:</span></span><br><span class="line"><span class="comment">#             countryName               = CN</span></span><br><span class="line"><span class="comment">#             stateOrProvinceName       = ChongQing</span></span><br><span class="line"><span class="comment">#             organizationName          = WeiyiGeek</span></span><br><span class="line"><span class="comment">#             organizationalUnitName    = weiyigeek</span></span><br><span class="line"><span class="comment">#             commonName                = server.weiyigeek.top</span></span><br><span class="line"><span class="comment">#             emailAddress              = master@weiyigeek.top</span></span><br><span class="line"><span class="comment">#         Subject Public Key Info:</span></span><br><span class="line"><span class="comment">#             Public Key Algorithm: rsaEncryption</span></span><br><span class="line"><span class="comment">#                 Public-Key: (2048 bit)</span></span><br><span class="line"><span class="comment">#                 Modulus:</span></span><br><span class="line"><span class="comment">#                     00:e6:17:73:d8:66:9c:08:b6:2d:99:66:0c:a5:a3:</span></span><br><span class="line"><span class="comment">#                    ........</span></span><br><span class="line"><span class="comment">#                     38:30:4e:c1:66:c2:cd:f3:b2:5e:2c:dd:17:3d:5b:</span></span><br><span class="line"><span class="comment">#                     04:6d</span></span><br><span class="line"><span class="comment">#                 Exponent: 65537 (0x10001)</span></span><br><span class="line"><span class="comment">#         X509v3 extensions:</span></span><br><span class="line"><span class="comment">#             Authority Information Access:</span></span><br><span class="line"><span class="comment">#                 CA Issuers - URI:http://sub-ca.wieyigeek.top/sub-ca.crt</span></span><br><span class="line"><span class="comment">#                 OCSP - URI:http://ocsp.sub-ca.wieyigeek.top:9081  # Certificate Reponse 认证</span></span><br><span class="line"><span class="comment">#             X509v3 Authority Key Identifier:</span></span><br><span class="line"><span class="comment">#                 keyid:0E:1B:6D:AA:0E:D5:6E:E4:C4:85:D6:48:37:3F:18:1B:FF:4C:BC:08</span></span><br><span class="line"><span class="comment">#             X509v3 Basic Constraints: critical</span></span><br><span class="line"><span class="comment">#                 CA:FALSE</span></span><br><span class="line"><span class="comment">#             X509v3 CRL Distribution Points:</span></span><br><span class="line"><span class="comment">#                 Full Name:</span></span><br><span class="line"><span class="comment">#                   URI:http://sub-ca.wieyigeek.top/sub-ca.crl</span></span><br><span class="line"><span class="comment">#             X509v3 Extended Key Usage:</span></span><br><span class="line"><span class="comment">#                 TLS Web Client Authentication, TLS Web Server Authentication</span></span><br><span class="line"><span class="comment">#             X509v3 Key Usage: critical</span></span><br><span class="line"><span class="comment">#                 Digital Signature, Key Encipherment</span></span><br><span class="line"><span class="comment">#             X509v3 Subject Key Identifier:</span></span><br><span class="line"><span class="comment">#                 20:F4:A9:32:B3:05:57:B1:10:E5:F7:73:D2:DF:E1:8D:45:8C:1D:67</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (6) 二级CA操作之签发客户端证书，即-extension client_ext</span></span><br><span class="line">openssl ca \</span><br><span class="line">-config conf/sub-ca.conf \</span><br><span class="line">-<span class="keyword">in</span> sub/certs/client.csr \</span><br><span class="line">-out sub/certs/client.crt \</span><br><span class="line">-extensions client_ext</span><br></pre></td></tr></table></figure>
<p>测试证书：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Listen</span></span><br><span class="line">openssl ocsp -port 9081  \</span><br><span class="line">-index sub/db/index \</span><br><span class="line">-rsigner sub/certs/sub-ocsp.crt \</span><br><span class="line">-rkey sub/private/sub-ocsp.key \</span><br><span class="line">-CA sub/certs/sub-ca.crt -text</span><br><span class="line"><span class="comment"># Enter pass phrase for sub/private/sub-ocsp.key: weiyigeeksubocsp</span></span><br><span class="line"><span class="comment"># Waiting for OCSP client connections...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Client connection Test</span></span><br><span class="line">openssl ocsp \</span><br><span class="line">-issuer sub/certs/sub-ca.crt \</span><br><span class="line">-CAfile certs/root-ca.crt \</span><br><span class="line">-cert sub/certs/server.crt \</span><br><span class="line">-url http://127.0.0.1:9081</span><br></pre></td></tr></table></figure></p>
<p><strong>注意事项:</strong></p>
<ul>
<li>(1) 当收到新证书申请请求的时候，你需要在对所有信息进行验证之后才能进行操作。你需要确保所有资料符合规定，特别是当你处理的CSR文件是别人生成的时。特别要注意证书的可分辨名称以及<code>basicContraints和subjectAlternativeName</code>扩展。</li>
<li>(2) 二级CA的CRL生成和证书的吊销过程与根CA是一样的。</li>
<li>(3) 唯一不同的是OCSP响应程序所使用的端口；二级CA使用的是9081端口;</li>
<li>(4) 推荐OCSP响应程序使用独立的证书，这样可以避免将二级CA部署到公开的服务器上.</li>
</ul>

        </div>
        
  <hr>
  <p> 欢迎各位志同道合的朋友一起学习交流，如文章有误请在下方留下您宝贵的经验知识，个人邮箱地址<b style="color:#ff654e"><code>【master#weiyigeek.top】</code></b>或者个人公众号<b style="color:#ff654e"><code>【WeiyiGeek】</code></b>联系我。 </p>

  <p> 更多文章来源于<b style="color:#03a9f4">【WeiyiGeek Blog - 为了能到远方，脚下的每一步都不能少】</b>, 个人首页地址( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>

  <p>专栏书写不易，如果您觉得这个专栏还不错的，请给这篇专栏 <b style="color: red;">【点个赞、投个币、收个藏、关个注，转个发】(人间五大情)</b>，这将对我的肯定，谢谢！。</p>

  <div>
    <img src="https://www.weiyigeek.top/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"【点个赞】，动动你那粗壮的拇指或者芊芊玉手，亲！"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"【投个币】，万水千山总是情，投个硬币行不行，亲！")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("【收个藏】，阅后即焚不吃灰，亲！")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("【转个发】，让更多的志同道合的朋友一起学习交流，亲！")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("【关个注】，后续浏览查看不迷路哟，亲！")</span></p>
    </li>
  </ul>

  <div>
    <img src="/img/wechat-search.png" class="img-responsive" alt="扫描Follow(关注)WeiyiGeek公众号"  width="380" height="170">
    <img src="/img/wechat-app.png" class="img-responsive" alt="扫描Visit(浏览)极客全栈修炼小程序"  width="385" height="170">
  </div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    最后更新时间：<time datetime="2022-07-12T13:45:43.673Z" itemprop="dateUpdated">2022-07-12 21:45:43</time>
</span><br>


        <span>文章原始路径：<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/解密编码/加密算法/系统安全加密验证签名之Openssl命令.md" target="_blank" rel="noopener noreferrer">_posts/解密编码/加密算法/系统安全加密验证签名之Openssl命令.md</a></span><br>
         <span class="copy-copyright">转载注明出处，原文地址：<a href="/2019/8-20-497.html" target="_blank" rel="external">https://blog.weiyigeek.top/2019/8-20-497.html</a></span><br>本站文章内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">👍 钟意作者</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Openssl/" rel="tag">Openssl</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/8-20-497.html&title=《系统安全加密验证签名之Openssl命令》 — WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/8-20-497.html&title=《系统安全加密验证签名之Openssl命令》 — WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/8-20-497.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《系统安全加密验证签名之Openssl命令》 — WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/8-20-497.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/8-20-497.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- 评论组件 -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/8-20-142.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">OpenSSL安全套接字密码库命令</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/8-20-292.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">JAVA入门学习六</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x00-前言简述"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 前言简述</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x01-算法实现"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 算法实现</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x03-证书密钥管理"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x03 证书密钥管理</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x04-私有CA创建"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x04 私有CA创建</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

  <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        如果此篇文章对您有帮助，还请支持一下博主哟, 谢谢各位看友♥!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="228" height="228" alt="打赏二维码">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="228" height="228" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>

  
 <!-- 微信公众号关注/文章版权复制 -->

  <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">你好朋友,可以关个注吗? ❤ <br> 这将是我持续更新文章的动力源泉，谢谢支持！(๑′ᴗ‵๑) </b> <br> 如不想关注请点击右上角的【X】<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">【My Twitter】</a></strong>. There is an article verification code in the homepage.
<br>方式2.请访问本博主的B站<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">【WeiyiGeek】</a></strong>首页关注UP主,<br>将自动随机获取解锁验证码。
<br>方式3.扫一扫下方二维码，关注本站<strong>官方公众号</strong><br>
回复：<strong style="color: rgb(240, 65, 52);">验证码</strong>
将获取<strong style="color: rgb(240, 65, 52);">解锁(有效期7天)</strong>本站所有技术文章哟!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="请输入验证码|Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">提
    交</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - 为了能到远方，脚下的每一步都不能少</p>
</div>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">公众账号</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">哔哩哔哩专栏</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">个人Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">个人Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">个人知乎</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">博客园</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">今日头条</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">简书</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">腾讯云+云社区</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">百度文库</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">IT极客知识分享</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTO博客</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">掘金</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">微博文章</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">小红书</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">抖音主页</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved. IT唯一极客 版权所有 </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>访问统计
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-站点地图">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-百度站点地图">站点地图</a> </span>
        <!-- 
  -->
        <br/>ICP备案号<span><a href="https://beian.miit.gov.cn" target="_blank">渝ICP备2022003447号</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSL安全认证" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/8-20-497.html&title=《系统安全加密验证签名之Openssl命令》 — WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/8-20-497.html&title=《系统安全加密验证签名之Openssl命令》 — WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/8-20-497.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《系统安全加密验证签名之Openssl命令》 — WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/8-20-497.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/8-20-497.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACL0lEQVR42u3aS27jMBAFQN//0s56MJD1XlMOIqq0MhKDYnnR6N/rFT/vg+f//x59/+jMo7e8vvFgYGDclvH++Hx+QY45uvrROfndMDAwnsOYHZ0gP79+nY2BgYHRfl4PwRgYGBjXMvLi808HXAwMjJswkiL2cystKjXL9txXanEMDIwbMvKu++9//sp8AwMD41aMd/lcVdyu3+SfMzEwMLZm5AFutmbRFrSz+2BgYOzNyJto7eLXVQ246C8YGBhbM/IGfX1c2fSfpaEnUw4MDIztGLN0MAnT67A2ucTAwHgOox0VJK/MFztWkk4MDIy9Ge0KRbvUlSd/yQAVAwPjOYy8QX/xRGJUDEe9QwwMjI0Y+Uhy1vzKB5xtSXy4M4KBgbEpY9a4b2viPMVMguzJJBYDA2MjRp4O5ldvwbPRadELxMDA2IKxPjhsL5onf8U9MTAwHsZYmXzmheusbVcEXAwMjI0YeZHZDiln7bx8sQwDAwNjtlqxnvy1KxoYGBhPYOQNsjwEX/VzFOMEDAyMBzBmo4JZYZx/vxhzYmBgPIDRjgSuDbIrQ1YMDIy9Ge/yaUvfWVDOfwgMDIwnMGaTwTxk5yOBWZpYYzAwMG7LqBtb5ZpFPuDMU9Vh1xADA+PmjJXUrS2AVxbCDk/DwMDAiBcgZgG3XbDAwMDAmLXDZoGyXSw7KWIxMDC2ZiRFbFvcroTXL7bbMDAwbshY2dQ4WdUqG215QjkcZGJgYNyP8QNp5rJQ72DYowAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 



  


<script>
  var _hmt = _hmt || [];
  (function() {
    // 百度统计
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-关注于网络安全_物联网安全开发_网络安全运维-学习心得分享';
                clearTimeout(titleTime);
            } else {
                document.title = '(つェ⊂)咦!又好了!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 
     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>
