<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ Multipathå¤šè·¯å¾„ç®¡ç†åŸºç¡€ä»‹ç»ä¸å®‰è£…é…ç½®ä½¿ç”¨|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Multipath">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
        
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>Multipathå¤šè·¯å¾„ç®¡ç†åŸºç¡€ä»‹ç»ä¸å®‰è£…é…ç½®ä½¿ç”¨</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">Multipathå¤šè·¯å¾„ç®¡ç†åŸºç¡€ä»‹ç»ä¸å®‰è£…é…ç½®ä½¿ç”¨</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-12-26T01:34:30.000Z" itemprop="datePublished" class="page-time">
  2019-12-26
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Storage/">Storage</a></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
  <article id="post-åŸºç¡€çŸ¥è¯†/æœºå™¨ç¡¬ä»¶/Storage/Multipathå¤šè·¯å¾„ç®¡ç†åŸºç¡€ä»‹ç»ä¸å®‰è£…é…ç½®ä½¿ç”¨"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">Multipathå¤šè·¯å¾„ç®¡ç†åŸºç¡€ä»‹ç»ä¸å®‰è£…é…ç½®ä½¿ç”¨</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-12-26 09:34:30" datetime="2019-12-26T01:34:30.000Z"  itemprop="datePublished">2019-12-26</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Storage/">Storage</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h4 id="0x00-å‰è¨€ç®€è¿°"><a href="#0x00-å‰è¨€ç®€è¿°" class="headerlink" title="0x00 å‰è¨€ç®€è¿°"></a>0x00 å‰è¨€ç®€è¿°</h4><p><strong>Q:ä»€ä¹ˆæ˜¯Multipathå¤šè·¯å¾„?</strong></p>
<blockquote>
<p>ç­”:Multipath I/O ç”µè„‘å‚¨å­˜æŠ€æœ¯ï¼ŒæŒ‡åˆ©ç”¨ä¸¤ä¸ªä»¥ä¸Šçš„è·¯å¾„åŒæ—¶åœ¨CPUä¸å‚¨å­˜è®¾å¤‡ä¹‹é—´ä¼ é€è®¯å·ï¼Œä»¥è¾¾åˆ°ä¾¦é”™ä¸å¼ºåŒ–æ•ˆèƒ½çš„ç›®çš„ã€‚<br>ç®€å•çš„è¯´å½“æœåŠ¡å™¨åˆ°æŸä¸€å­˜å‚¨è®¾å¤‡æœ‰å¤šæ¡è·¯å¾„æ—¶ï¼Œæ¯æ¡è·¯å¾„éƒ½ä¼šè¯†åˆ«ä¸ºä¸€ä¸ªå•ç‹¬çš„è®¾å¤‡(ä¸ä¾¿äºä½¿ç”¨)ï¼Œè€Œå¤šè·¯å¾„å…è®¸æ‚¨å°†æœåŠ¡å™¨èŠ‚ç‚¹å’Œå‚¨å­˜é˜µåˆ—é—´çš„å¤šä¸ªI/Oè·¯å¾„é…ç½®ä¸ºä¸€ä¸ªå•ä¸€è®¾å¤‡(<code>å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„é“¾è·¯èšåˆ</code>)å³å¤šè·¯å¾„èšåˆäº†I/Oè·¯å¾„å¹¶ç”Ÿæˆç”±è¿™äº›é›†åˆè·¯å¾„ç»„æˆçš„æ–°è®¾å¤‡ï¼Œè¿™äº›I/Oè·¯å¾„å¯<code>åŒ…å«ç‹¬ç«‹ç”µç¼†ã€äº¤æ¢å™¨å’Œæ§åˆ¶å™¨çš„å®ä½“SANé“¾æ¥(FC / SAS / iSCSI)</code>ç­‰;</p>
</blockquote>
<figure class="image-box">
                <a rel=Multipathå¤šè·¯å¾„ç®¡ç†åŸºç¡€ä»‹ç»ä¸å®‰è£…é…ç½®ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200912205044.png" target="_blank" title="WeiyiGeek.å¤šè·¯å¾„å›¾ç¤º" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200912205044.png" alt="WeiyiGeek.å¤šè·¯å¾„å›¾ç¤º" title="" class=""></a>
                <p>WeiyiGeek.å¤šè·¯å¾„å›¾ç¤º</p>
            </figure>
<p><br></p>
<p><strong>å·¥ä½œåŸç†:</strong><br>å½“å› ä¸ºä¸»æœºHBAå¡ã€çº¿ç¼†ã€äº¤æ¢æœºæˆ–è€…å­˜å‚¨è®¾å¤‡çš„RAIDæ§åˆ¶å™¨æ•…éšœç­‰åŸå› é€ æˆä¸€æ¡ç‰©ç†è·¯å¾„å¤±æ•ˆæ—¶,æœåŠ¡å™¨å¯ä»¥å°†é€šè¿‡æ­¤ç‰©ç†è·¯å¾„çš„I/Oè½¬ç§»åˆ°å…¶ä»–æ­£å¸¸çš„ç‰©ç†è·¯å¾„ä¸Šé¢,åº”ç”¨ç¨‹åºä¸ä¼šè§‰å¯Ÿåˆ°è¿™ç§æ”¹å˜ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p>
<p><strong>ç¡¬ä»¶è¦æ±‚ï¼š</strong><br>ç¡¬ä»¶æ–¹é¢éœ€è¦æœåŠ¡å™¨æœ‰2å—æˆ–ä»¥ä¸Šçš„HBAæ¥å£å¡ï¼Œç½‘ç»œä¸Šæœ‰ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„äº¤æ¢æœºï¼Œå—å­˜å‚¨è®¾å¤‡æœ‰ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„å†—ä½™æ§åˆ¶å™¨ï¼Œå„ä¸ªç‰©ç†è·¯å¾„ä¹‹é—´æ²¡æœ‰ä»»ä½•ç¡¬ä»¶ç›¸äº’ä¾èµ–ã€‚å¤šè·¯å¾„å†—ä½™I/Oä¹Ÿå¯ä»¥å®ç°I/Oçš„è´Ÿè½½å‡è¡¡ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ï¼Œä½†ä¸»è¦è¿˜æ˜¯ä¸€ç§å®¹é”™æœºåˆ¶ã€‚</p>
<p><br/></p>
<p><strong>Q:å®ƒæœ‰ä»€ä¹ˆç”¨?</strong></p>
<ul>
<li>å†—ä½™: ä¸»å¤‡æ¨¡å¼ï¼Œé«˜å¯ç”¨;</li>
<li>æ€§èƒ½ä¼˜åŒ–: ä¸»ä¸»æ¨¡å¼ï¼Œè´Ÿè½½å‡è¡¡;</li>
</ul>
<p><br/></p>
<p><strong>Q: å¦‚ä½•ä½¿ç”¨Multipath?</strong><br>æè¿°: å¯ä»¥å‚ç…§ä¸‹é¢çš„ç« èŠ‚å¹¶å­˜åœ¨ç›¸åº”çš„æµ‹è¯•ç¯å¢ƒè¿›è¡Œå®è·µï¼Œå¸¸è§ä¸‰ç§æƒ…å†µä¼šä½¿ç”¨åˆ°æ¯”å¦‚æœ‰å­˜å‚¨è®¾å¤‡å¹¶ä¸”ä¸ä¸»æœºé€šè¿‡(<code>FC-å…‰çº¤çº¿ã€SAS-çº¿ç¼†ã€ä»¥å¤ªç½‘-å…­ç±»çº¿</code>)è¿›è¡Œç›´è¿;<br>å…¶åº”ç”¨åœºæ™¯:</p>
<ul>
<li>1.é’ˆå¯¹äºå—å­˜å‚¨ç£ç›˜å¤šè·¯å¾„IOè®¾å¤‡</li>
<li>2.ä½¿ç”¨åœ¨Oracleçš„ASMç¯å¢ƒä¸­</li>
</ul>
<p><br/></p>
<h5 id="å¤šè·¯å¾„æŠ€æœ¯"><a href="#å¤šè·¯å¾„æŠ€æœ¯" class="headerlink" title="å¤šè·¯å¾„æŠ€æœ¯"></a>å¤šè·¯å¾„æŠ€æœ¯</h5><p>æè¿°:å®ç°çš„æ ¸å¿ƒé€šè¿‡å­˜å‚¨è®¾å¤‡å»é€‚é…æ“ä½œç³»ç»Ÿï¼Œä»è€Œå®ç°å¤šè·¯å¾„æŠ€æœ¯ï¼Œæ”¯æŒALUAæ˜¯å…¶ä¸­ä¸»è¦éƒ¨åˆ†ã€‚</p>
<h6 id="1-ALUA"><a href="#1-ALUA" class="headerlink" title="1.ALUA"></a>1.ALUA</h6><p>æè¿°ï¼šALUAå¤šè·¯å¾„æŠ€æœ¯(Asymmetric Logical Unit Access-éå¯¹ç§°é€»è¾‘å•å…ƒå­˜å–),å…¶æä¾›äº†ä¸€ä¸ªè·¯å¾„å‘ç°å’Œç¡®å®šä¼˜å…ˆæ¬¡åºçš„æ ‡å‡†åŒ–æœºåˆ¶ï¼Œ<code>å®ç°ä¸»æœºå’Œå­˜å‚¨è®¾å¤‡çš„è·¯å¾„è‡ªåå•†å’ŒåŠ¨æ€ç®¡ç†</code>ã€‚</p>
<p>ç‰¹ç‚¹ï¼šå¯¹äºç‰¹å®šçš„LUNæ¥è¯´ï¼Œåœ¨å®ƒçš„è·¯å¾„ä¸­ï¼Œä¸€ä¸ªæ§åˆ¶å™¨çš„ç›®æ ‡ç«¯å£å¤„äº<code>ä¸»åŠ¨/ä¼˜åŒ–</code>çŠ¶æ€ï¼Œå¦ä¸€ä¸ªæ§åˆ¶å™¨çš„ç›®æ ‡ç«¯å£å¤„<code>äºä¸»åŠ¨/éä¼˜</code>çŠ¶æ€ã€‚åœ¨æŸä¸€ä¸ªæ—¶åˆ»ï¼ŒæŸä¸ªLUNåªæ˜¯å±äºæŸä¸€ä¸ªæ§åˆ¶å™¨ï¼Œè¦æƒ³å®ç°ä¸¤è¾¹çš„è´Ÿè½½å‡è¡¡ï¼Œå°±æ˜¯å°†ä»»åŠ¡Aæ‰”ç»™æ§åˆ¶å™¨Aï¼Œå°†ä»»åŠ¡Bæ‰”ç»™æ§åˆ¶å™¨Bï¼Œ<code>å¯¹äºåŒä¸€ä¸ªä»»åŠ¡æ¥è¯´ä»»ä½•æ—¶å€™åªæœ‰ä¸€ä¸ªæ§åˆ¶å™¨åœ¨æ§åˆ¶</code>ã€‚</p>
<h6 id="2-SLUA"><a href="#2-SLUA" class="headerlink" title="2.SLUA"></a>2.SLUA</h6><p>æè¿°:SLUAå¤šè·¯å¾„æŠ€æœ¯(Symmetric Logical Unit Access-å¯¹ç§°é€»è¾‘å•å…ƒå­˜å–)åˆ«åå¯¹ç§°é•œåƒå·ï¼Œå®ƒæ˜¯å¤šè·¯å¾„çš„åŸºæœ¬ç‰¹æ€§ã€‚<br>ç‰¹ç‚¹ï¼šå¯¹äºç‰¹å®šçš„LUNæ¥è¯´ï¼Œåœ¨å®ƒçš„è·¯å¾„ä¸­ä¸¤ä¸ªå­˜å‚¨æ§åˆ¶å™¨çš„ç›®æ ‡ç«¯å£<code>å‡å¤„äºä¸»åŠ¨/ä¼˜åŒ–</code>çŠ¶æ€ã€‚ä¸¤ä¸ªæ§åˆ¶å™¨ä¹‹é—´å®ç°é«˜é€Ÿäº’è”çš„é€šè®¯ï¼Œä¸€ä¸ªIOå‘åˆ°æ§åˆ¶å™¨ç«¯ï¼Œä¸¤ä¸ªæ§åˆ¶å™¨å¯åŒæ—¶å‚ä¸å¤„ç†ï¼›<code>å½“ä¸€ä¸ªæ§åˆ¶å™¨ç¹å¿™ç³»ç»Ÿæ—¶å€™ä¸éœ€è¦ä¸»æœºç«¯çš„è´Ÿè½½å‡è¡¡è½¯ä»¶å‚ä¸å°±å¯ä»¥è‡ªåŠ¨å®ç°è´Ÿè½½å‡è¡¡</code>ã€‚</p>
<p><strong>SLUAä¸ALUAå¯¹æ¯”:</strong></p>
<ul>
<li>å‰è€…: åŒä¸»/ä¼˜åŒ–, ä¸€ä¸ªLUNå¯ä»¥å±äºä¸¤ä¸ªæ§åˆ¶å™¨è´Ÿè½½å‡è¡¡ã€åŒä¸€ä¸ªRAIDä¸Šçš„ä¸åŒLUNç»„å¯ä»¥è·¨æ§åˆ¶å™¨ï¼ŒLUNè·¨æ§åˆ¶å™¨è¿ç§»ä¸å½±å“åº”ç”¨ã€å¸¦å®½åŠ å€1ç§’è‡ªåŠ¨åˆ‡æ¢;</li>
<li>åè€…: åŒä¸»/éä¼˜åŒ–ï¼ŒåŒä¸€ä¸ªLUNå½’å±æŸä¸€ä¸ªæ§åˆ¶å™¨ï¼ŒåŒæ§ä¹‹é—´ä¸å¯è‡ªåŠ¨å®ç°è´Ÿè½½å‡è¡¡ï¼Œå¹¶ä¸”åˆ‡æ¢æ—¶é—´ä¸€èˆ¬ä¸ºåå‡ ç§’;</li>
</ul>
<figure class="image-box">
                <a rel=Multipathå¤šè·¯å¾„ç®¡ç†åŸºç¡€ä»‹ç»ä¸å®‰è£…é…ç½®ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200912135557.png" target="_blank" title="WeiyiGeek.å¤šè·¯å¾„æŠ€æœ¯" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200912135557.png" alt="WeiyiGeek.å¤šè·¯å¾„æŠ€æœ¯" title="" class=""></a>
                <p>WeiyiGeek.å¤šè·¯å¾„æŠ€æœ¯</p>
            </figure>
<p><br/></p>
<h5 id="åè¯è§£æ"><a href="#åè¯è§£æ" class="headerlink" title="åè¯è§£æ"></a>åè¯è§£æ</h5><h6 id="1-DM-Multipath-å¤šè·¯å¾„è®¾å¤‡"><a href="#1-DM-Multipath-å¤šè·¯å¾„è®¾å¤‡" class="headerlink" title="1.DM Multipath - å¤šè·¯å¾„è®¾å¤‡"></a>1.DM Multipath - å¤šè·¯å¾„è®¾å¤‡</h6><p>æè¿°:è‹¥ä¸é‡‡ç”¨ DM Multipath é‚£ä¹ˆä»æœåŠ¡å™¨èŠ‚ç‚¹åˆ°å‚¨å­˜æ§åˆ¶å™¨çš„æ¯ä¸€æ¡è·¯å¾„éƒ½ä¼šè¢«ç³»ç»Ÿè§†ä¸ºç‹¬ç«‹çš„è®¾å¤‡ï¼Œå³ä½¿I/Oè·¯å¾„è¿æ¥çš„æ˜¯ç›¸åŒçš„æœåŠ¡å™¨èŠ‚ç‚¹åˆ°ç›¸åŒçš„å‚¨å­˜æ§åˆ¶å™¨ä¹Ÿæ˜¯å¦‚æ­¤, <code>DM Multipath</code>æä¾›äº†æœ‰é€»è¾‘çš„ç®¡ç†I/Oè·¯å¾„çš„æ–¹æ³•ï¼Œå³åœ¨åŸºç¡€è®¾å¤‡é¡¶ç«¯ç”Ÿæˆå•ä¸€å¤šè·¯å¾„è®¾å¤‡;</p>
<h6 id="2-WWID-å…¨çƒè¯†åˆ«ç¬¦"><a href="#2-WWID-å…¨çƒè¯†åˆ«ç¬¦" class="headerlink" title="2.WWID - å…¨çƒè¯†åˆ«ç¬¦"></a>2.WWID - å…¨çƒè¯†åˆ«ç¬¦</h6><p>æè¿°:æ¯ä¸ªå¤šè·¯å¾„è®¾å¤‡éƒ½æœ‰ä¸€ä¸ªWWIDï¼ˆå…¨çƒè¯†åˆ«ç¬¦ï¼‰ï¼Œå®ƒæ˜¯å…¨çƒå”¯ä¸€çš„æ— æ³•æ›´æ”¹çš„å·ç , <code>é»˜è®¤æƒ…å†µä¸‹ä¼šå°†å¤šè·¯å¾„è®¾å¤‡çš„åç§°è®¾å®šä¸ºå®ƒçš„WWID</code>, å¯ä»¥åœ¨å¤šè·¯å¾„é…ç½®æ–‡ä»¶(<code>/etc/multipath.conf</code>)ä¸­è®¾ç½®<code>user_friendly_names</code>é€‰é¡¹ï¼Œè¯¥é€‰é¡¹å¯å°†åˆ«åè®¾ä¸ºæ ¼å¼ä¸ºmpathnçš„èŠ‚ç‚¹å”¯ä¸€åç§°ä¹Ÿå¯ä»¥ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å­˜å‚¨è®¾å¤‡åç§°;</p>
<p>ç¤ºä¾‹.æŸ¥çœ‹è®¾å¤‡çš„ scsi id å³WWIDæŸ¥çœ‹, è·å– iscsi å…±äº«ç›˜çš„ wwid å…¨çƒå”¯ä¸€è¯†åˆ«å·ä¸‰ç§æ–¹å¼<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼1.æ‰«æSCSIè®¾å¤‡å·å‘½ä»¤</span></span><br><span class="line">$/usr/lib/udev/scsi_id -u -g /dev/mapper/asm08  <span class="comment">#å»æ‰ç©ºæ ¼--replace-whitespace</span></span><br><span class="line">360050768xxx000000010d2</span><br><span class="line">$/usr/lib/udev/scsi_id --whitelisted --device=/dev/sdb</span><br><span class="line">36000d3100366e600000000000000001c</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2</span></span><br><span class="line"><span class="variable">$cat</span> /etc/multipath/wwids</span><br><span class="line"><span class="comment"># Valid WWIDs:</span></span><br><span class="line">/36000d3100366e600000000000000001c/</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼3</span></span><br><span class="line"><span class="variable">$multipath</span> -ll | grep <span class="string">"mpath"</span></span><br><span class="line">mpatha (36000d3100366e600000000000000001c) dm-0 COMPELNT,Compellent Vol</span><br></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹2.è‡ªå®šä¹‰å­˜å‚¨è®¾å¤‡åç§°;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/multipath.conf</span></span><br><span class="line"><span class="comment"># æ–¹å¼1</span></span><br><span class="line">defaults &#123;</span><br><span class="line">  user_friendly_names yes</span><br><span class="line">  ....</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># ç»“æœ</span></span><br><span class="line"><span class="variable">$multipath</span> -ll</span><br><span class="line"><span class="comment"># mpatha (36000d3100366e600000000000000001c) dm-0 COMPELNT,Compellent Vol</span></span><br><span class="line"><span class="comment"># size=500G features='1 queue_if_no_path' hwhandler='1 alua' wp=rw</span></span><br><span class="line"><span class="comment"># `-+- policy='service-time 0' prio=25 status=enabled</span></span><br><span class="line"><span class="comment">#   |- 4:0:0:1 sdb 8:16 active ready running</span></span><br><span class="line"><span class="comment">#   |- 4:0:0:2 sdc 3:32 active ready running</span></span><br><span class="line"><span class="variable">$ls</span> -alh /dev/mapper/mpatha-part1</span><br><span class="line"><span class="comment"># lrwxrwxrwx 1 root root 7 Sep  8  2020 /dev/mapper/mpatha-part1 -&gt; ../dm-0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------------------------------  #</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2:ç»‘å®šåéœ€é‡æ–°ç”Ÿæˆè·¯å¾„çš„æ˜ å°„è¡¨</span></span><br><span class="line">multipaths &#123;</span><br><span class="line">  multipath &#123;</span><br><span class="line">    wwid  <span class="string">"36000d3100366e600000000000000001c"</span></span><br><span class="line">    <span class="built_in">alias</span> k8sapp</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># ç»“æœ</span></span><br><span class="line"><span class="variable">$multipath</span> -v2</span><br><span class="line"><span class="variable">$multipath</span> -ll</span><br><span class="line"><span class="comment"># k8sapp (36000d3100366e600000000000000001c) dm-0 COMPELNT,Compellent Vol</span></span><br><span class="line"><span class="comment"># size=1.0T features='1 queue_if_no_path' hwhandler='1 alua' wp=rw</span></span><br><span class="line"><span class="comment"># -+- policy='service-time 0' prio=25 status=active</span></span><br><span class="line"><span class="comment">#   |- 5:0:8:1 sdb 8:16 active ready running</span></span><br><span class="line"><span class="comment">#   |- 5:0:9:1 sdc 8:32 failed ready running</span></span><br><span class="line"><span class="variable">$ls</span> -alh /dev/mapper/k8sapp </span><br><span class="line"><span class="comment"># lrwxrwxrwx 1 root root 7 Sep  8  2020 /dev/mapper/k8sapp  -&gt; ../dm-0</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h6 id="3-scsi-id-è®¾å¤‡id"><a href="#3-scsi-id-è®¾å¤‡id" class="headerlink" title="3.scsi_id - è®¾å¤‡id"></a>3.scsi_id - è®¾å¤‡id</h6><p>æè¿°:å…¶åŒ…å«åœ¨udevç¨‹åºåŒ…ä¸­ï¼Œå¯ä»¥åœ¨multipath.confä¸­é…ç½®è¯¥ç¨‹åºæ¥è·å–scsiè®¾å¤‡çš„åºå·ã€‚é€šè¿‡åºå·ä¾¿å¯ä»¥åˆ¤æ–­å¤šä¸ªè·¯å¾„å¯¹åº”äº†åŒä¸€è®¾å¤‡ã€‚è¿™ä¸ªæ˜¯å¤šè·¯å¾„å®ç°çš„å…³é”®ã€‚<br>multipathç¨‹åºåœ¨åˆ›å»ºmultipathè®¾å¤‡æ—¶ï¼Œä¼šè°ƒç”¨scsi_idï¼Œä»å…¶æ ‡å‡†è¾“å‡ºä¸­è·å¾—è¯¥è®¾å¤‡çš„scsi idã€‚åœ¨æ”¹å†™æ—¶éœ€è¦ä¿®æ”¹scsi_idç¨‹åºçš„è¿”å›å€¼ä¸º0ã€‚å› ä¸ºåœ¨multipathç¨‹åºä¸­ï¼Œä¼šæ£€æŸ¥è¯¥å€¼æ¥ç¡®å®šscsi idæ˜¯å¦å·²ç»æˆåŠŸå¾—åˆ°ã€‚</p>
<p><br/></p>
<h6 id="4-å¤šè·¯å¾„èšåˆå’Œæ˜ å°„"><a href="#4-å¤šè·¯å¾„èšåˆå’Œæ˜ å°„" class="headerlink" title="4.å¤šè·¯å¾„èšåˆå’Œæ˜ å°„"></a>4.å¤šè·¯å¾„èšåˆå’Œæ˜ å°„</h6><p>Q:ä»€ä¹ˆæ˜¯å­˜å‚¨çš„å¤šè·¯å¾„èšåˆå’Œæ˜ å°„?<br>Linux ä¸»æœºä¸Šé€šè¿‡å¤–æ¥ FC / SAS åˆ°ç‰©ç†å­˜å‚¨è®¾å¤‡æ—¶ï¼Œä¸€èˆ¬éƒ½ä¼šåœ¨ä¸»æœºä¸ŠåŠ è£…HBAå¡ï¼Œ<code>HBAå¡é€šè¿‡WWNå·è¿æ¥å…‰çº¤äº¤æ¢æœºæˆ–ç›´æ¥å­˜å‚¨</code>ã€‚å¦‚æœHBAå¡å‡ºé—®é¢˜éœ€è¦æ›´æ¢æ—¶ï¼ŒWWNå·ç›¸åº”çš„ä¹Ÿä¼šæ”¹å˜ï¼Œä¸­é—´çš„è¿™ä¸ªçº½å¸¦ç›¸å½“äºæ–­äº†ï¼Œå°±æ— æ³•æ­£å¸¸è¯†åˆ«å­˜å‚¨ç£ç›˜åˆ†åŒºã€‚<br>å½“ç„¶æœ‰äº›HBAä¸Šé¢è´´çš„æœ‰WWNå·ï¼Œå¯ä»¥åœ¨æ›´æ¢HBAå¡ä¹‹å‰åœ¨å…‰äº¤æˆ–å­˜å‚¨ä¸Šæ›´æ¢ç›¸åº”çš„é…ç½®ã€‚ä¸è¿‡å¾ˆå¤šæ²¡æœ‰æ ‡è¿™ä¸ªWWNæ‰€ä»¥éœ€è¦éå¸¸ï¼Œå»ºè®®æ›´æ¢ååˆ°ç³»ç»Ÿä¸‹é€šè¿‡å‘½ä»¤æŸ¥çœ‹æ–°è¯†åˆ«çš„WWNå·ç¡®è®¤ä»¥ä¸‹å³å¯ã€‚</p>
<p>ä¸»æœºä¸ŠHBAå¡WWNå·æŸ¥çœ‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># FC SAN</span></span><br><span class="line">cat /sys/class/fc_host/host*/port_name</span><br><span class="line">0x2002d0431efb7f5d  <span class="comment">#HBAå¡WWNå·</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SAS SAN</span></span><br><span class="line"><span class="variable">$cat</span> /sys/class/sas_phy/phy-*/sas_address|sort|uniq</span><br><span class="line">0x51866da091944100  <span class="comment">#HBAå¡WWNå·</span></span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=Multipathå¤šè·¯å¾„ç®¡ç†åŸºç¡€ä»‹ç»ä¸å®‰è£…é…ç½®ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200913213655.png" target="_blank" title="WeiyiGeek.æœåŠ¡å™¨HBAæ ‡è¯†" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200913213655.png" alt="WeiyiGeek.æœåŠ¡å™¨HBAæ ‡è¯†" title="" class=""></a>
                <p>WeiyiGeek.æœåŠ¡å™¨HBAæ ‡è¯†</p>
            </figure></p>
<hr>
<h4 id="0x01-Multipath-ç®¡ç†"><a href="#0x01-Multipath-ç®¡ç†" class="headerlink" title="0x01 Multipath ç®¡ç†"></a>0x01 Multipath ç®¡ç†</h4><p>æè¿°:å¯¹äºå­˜å‚¨è®¾å¤‡åˆ›å»ºçš„LUNå·ä»¥åŠæ˜ å°„åˆ†é…ç»™æœåŠ¡å™¨åå¾€å¾€æœ‰å¤šä¸ªæ§åˆ¶å™¨è¿›è¡Œå†—ä½™ï¼Œåˆ·æ–°scsiè®¾å¤‡åä½ å°†ä¼šåœ¨æœåŠ¡å™¨ä¸­æŸ¥çœ‹åˆ°å¤šä¸ª/dev/sd[b-z]ç£ç›˜è®¾å¤‡ï¼Œæ­¤æ—¶éœ€è¦é‡‡ç”¨å¤šè·¯å¾„è½¯ä»¶è¿›è¡Œèšåˆé“¾è·¯ï¼Œä½¿åŸæœ¬æœ‰å¤šä¸ªSCSIç£ç›˜çš„ç£ç›˜æŒ‚è½½åˆ°æœ¬åœ°æ—¶å€™èšåˆä¸ºä¸€ä¸ªè®¾å¤‡ï¼›æ³¨æ„è¿™ä¸æ‚¨çš„å­˜å‚¨è®¾å¤‡æ¯æ¯ç›¸å…³å¤§å¤šæ•°å­˜å‚¨è¿æ¥åˆ°Linuxä¸»æœºä¸Šå¯ä»¥ä½¿ç”¨multipathè‡ªå¸¦çš„å¤šè·¯å¾„è½¯ä»¶ï¼Œç„¶è€Œå‘Huaweiçš„å­˜å‚¨åˆ™éœ€è¦å•ç‹¬å®‰è£…ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„å¤šè·¯å¾„è½¯ä»¶æ‰è¡Œ;</p>
<h5 id="Linux-Multipath"><a href="#Linux-Multipath" class="headerlink" title="Linux - Multipath"></a>Linux - Multipath</h5><p>æè¿°ï¼šåœ¨linuxä¸­å¼€æºçš„multipathå·¥å…·æ˜¯ç”¨æ¥è¿›è¡Œå¤šè·¯å¾„IOç®¡ç†ï¼Œå½“ä¸€æ¡é“¾è·¯ä¸ç¨³å®šæ—¶å¯è‡ªåŠ¨åˆ‡æ¢åˆ°å¦ä¸€æ¡é“¾è·¯ï¼Œå½“ç„¶è¦ä½¿ç”¨å¤šè·¯å¾„è®¾å¤‡å°±å¿…é¡»å®‰è£…ç›¸å¯¹åº”çš„multipathè½¯ä»¶ï¼›</p>
<p><strong>Multipath å®‰è£…&amp;å¯åŠ¨</strong><br>å¤‡æ³¨:CentOS 7.8 / Ubuntu 20.04 tls è‡ªå¸¦æ— éœ€å®‰è£…<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS </span></span><br><span class="line">rpm -qa | grep <span class="string">"multipath"</span>           <span class="comment"># æŸ¥çœ‹ç³»ç»Ÿæ˜¯å¦å®‰è£…</span></span><br><span class="line">yum install device-mapper-multipath  </span><br><span class="line">systemctl <span class="built_in">enable</span> multipathd || chkconfig multipathd on  <span class="comment"># å¯ç”¨å¤šè·¯å¾„è½¯ä»¶å¼€æœºè‡ªå¯</span></span><br><span class="line">systemctl start multipathd || service multipathd status <span class="comment"># å¯åŠ¨multipathå¤šè·¯å¾„æœåŠ¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ubuntu</span></span><br><span class="line">apt list | grep <span class="string">"multipath"</span> <span class="comment"># æŸ¥çœ‹ç³»ç»Ÿæ˜¯å¦å®‰è£…</span></span><br><span class="line"><span class="comment"># multipath-tools-boot/focal 0.8.3-1ubuntu2 all</span></span><br><span class="line"><span class="comment"># multipath-tools/focal,now 0.8.3-1ubuntu2 amd64 [installed,automatic]</span></span><br><span class="line">apt-get install multipath-tools</span><br><span class="line">systemctl <span class="built_in">enable</span> multipathd &amp;&amp; systemctl start multipathd</span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¯ä»¶åŒ…è¯´æ˜</span></span><br><span class="line">(1) device-mapper-multipathï¼šå³multipath-toolsã€‚ä¸»è¦æä¾›multipathdå’Œmultipathç­‰å·¥å…·å’Œ multipath.confç­‰é…ç½®æ–‡ä»¶ã€‚åˆ›å»ºçš„å¤šè·¯å¾„è®¾å¤‡ä¼šåœ¨/dev/mapperä¸­ã€‚</span><br><span class="line">(2) device-mapperï¼šä¸»è¦åŒ…æ‹¬ä¸¤å¤§éƒ¨åˆ†å†…æ ¸éƒ¨åˆ†å’Œç”¨æˆ·éƒ¨åˆ†ã€‚</span><br><span class="line">  * å†…æ ¸éƒ¨åˆ†ä¸»è¦åŒ…æ‹¬device mapperæ ¸å¿ƒ(dm.ko)å’Œä¸€äº›target driver(md-multipath.ko)ã€‚æ ¸å¿ƒå®Œæˆè®¾å¤‡çš„æ˜ å°„ï¼Œè€Œtargetæ ¹æ®æ˜ å°„å…³ç³»å’Œè‡ªèº«ç‰¹ç‚¹å…·ä½“å¤„ç†ä»mappered device ä¸‹æ¥çš„i/oã€‚</span><br><span class="line">  * ç”¨æˆ·ç©ºé—´éƒ¨åˆ†ä¸»è¦åŒ…æ‹¬device-mapperè¿™ä¸ªåŒ…ã€‚å…¶ä¸­åŒ…æ‹¬dmsetupå·¥å…·å’Œä¸€äº›å¸®åŠ©åˆ›å»ºå’Œé…ç½®mappered deviceçš„åº“ã€‚è¿™äº›åº“ä¸»è¦æŠ½è±¡ï¼Œå°è£…äº†ä¸ioctré€šä¿¡çš„æ¥å£ï¼Œä»¥ä¾¿æ–¹ä¾¿åˆ›å»ºå’Œé…ç½®mappered deviceã€‚multipath-toolçš„ç¨‹åºä¸­å°±éœ€è¦è°ƒç”¨è¿™äº›åº“ã€‚</span><br><span class="line">(3) dm-multipath.koå’Œdm.koï¼šdm.koæ˜¯device mapperé©±åŠ¨ã€‚å®ƒæ˜¯å®ç°multipathçš„åŸºç¡€dm-multipathå…¶å®æ˜¯dmçš„ä¸€ä¸ªtargeté©±åŠ¨ã€‚</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=Multipathå¤šè·¯å¾„ç®¡ç†åŸºç¡€ä»‹ç»ä¸å®‰è£…é…ç½®ä½¿ç”¨ href="https://img-blog.csdnimg.cn/20200616152900412.png" target="_blank" title="redhat.multipath" data-fancybox="images"><img src="https://img-blog.csdnimg.cn/20200616152900412.png" alt="redhat.multipath" title="" class=""></a>
                <p>redhat.multipath</p>
            </figure>
<p><br></p>
<p><strong>æ¥å£é©±åŠ¨æŸ¥çœ‹</strong></p>
<ul>
<li><p>1.é’ˆå¯¹äº FC SAN å¤šè·¯å¾„å—å­˜å‚¨å·ç£ç›˜</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) å­˜å‚¨ä¸Šå°†LUNæ˜ å°„ç»™éœ€è¦çš„ä¸»æœº,ç„¶åæŸ¥çœ‹ä¸»æœºæˆ–è€…å­˜å‚¨äº¤æ¢æœºä¸Šçš„wwnå·</span></span><br><span class="line">cat /sys/class/fc_host/host*/port_name</span><br><span class="line">0x2002d0431efb7f5d  <span class="comment">#HBAå¡WWNå·æ ‡è¯†</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>2.é’ˆå¯¹äº SAS SAN å¤šè·¯å¾„å—å­˜å‚¨å·ç£ç›˜</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) SAS HBAå¡wwnæ ‡è¯†å·æ ‡è¯†</span></span><br><span class="line"><span class="variable">$cat</span> /sys/class/sas_host/host5/device/phy-*/sas_phy/phy-*/sas_address|sort|uniq</span><br><span class="line"><span class="variable">$cat</span> /sys/class/sas_phy/phy-*/sas_address|sort|uniq</span><br><span class="line">0x51866da091944100</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) SAS-HBAå¡é©±åŠ¨æŸ¥çœ‹  </span></span><br><span class="line"><span class="variable">$lspci</span> | grep LSI</span><br><span class="line">01:00.0 RAID bus controller: Broadcom / LSI MegaRAID SAS-3 3108 [Invader] (rev 02)</span><br><span class="line">04:00.0 Serial Attached SCSI controller: Broadcom / LSI SAS3008 PCI-Express Fusion-MPT SAS-3 (rev 02)</span><br><span class="line"><span class="comment"># ç³»ç»Ÿå—è®¾å¤‡æŸ¥çœ‹</span></span><br><span class="line"><span class="variable">$ll</span> /sys/block/ | grep 04:00.0</span><br><span class="line">lrwxrwxrwx  1 root root 0 Sep 11 16:57 sdb -&gt; ../devices/pci0000:00/0000:00:02.0/0000:04:00.0/host4/port-4:2/end_device-4:2/target4:0:2/4:0:2:1/block/sdb/</span><br><span class="line">lrwxrwxrwx  1 root root 0 Sep 11 16:57 sdc -&gt; ../devices/pci0000:00/0000:00:02.0/0000:04:00.0/host4/port-4:2/end_device-4:2/target4:0:2/4:0:2:2/block/sdc/</span><br><span class="line">lrwxrwxrwx  1 root root 0 Sep 11 15:15 sdd -&gt; ../devices/pci0000:00/0000:00:02.0/0000:04:00.0/host4/port-4:1/end_device-4:1/target4:0:1/4:0:1:1/block/sdd/</span><br><span class="line">lrwxrwxrwx  1 root root 0 Sep 11 15:15 sde -&gt; ../devices/pci0000:00/0000:00:02.0/0000:04:00.0/host4/port-4:1/end_device-4:1/target4:0:1/4:0:1:2/block/sde/</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) systool å‘½ä»¤:http://fibrevillage.com/storage/61-systool-a-useful-tool-for-san-as-well-for-sysfs-devices</span></span><br><span class="line"><span class="variable">$apt</span> install sysfsutils</span><br><span class="line"><span class="variable">$systool</span> -c sas_host -v</span><br><span class="line"><span class="comment"># Class = "sas_host"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Class Device = "host5"</span></span><br><span class="line"><span class="comment"># Class Device path = "/sys/devices/pci0000:00/0000:00:02.0/0000:04:00.0/host5/sas_host/host5"</span></span><br><span class="line"><span class="comment"># uevent              =</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Device = "host5"</span></span><br><span class="line"><span class="comment"># Device path = "/sys/devices/pci0000:00/0000:00:02.0/0000:04:00.0/host5"</span></span><br><span class="line"><span class="comment"># uevent              = "DEVTYPE=scsi_host"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>3.é’ˆå¯¹äº iSCSI å—å­˜å‚¨ç£ç›˜</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æš‚ä»£è¡¥å……</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<p><strong>ç£ç›˜SCSIè®¾å¤‡æ‰«ææ·»åŠ ä¸å¸è½½</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) SCSIå­˜å‚¨è®¾å¤‡æ‰«æ</span></span><br><span class="line"><span class="comment"># æ–¹å¼1:</span></span><br><span class="line"><span class="comment"># yum install â€“y sg3_utils</span></span><br><span class="line">$ sudo rescan-scsi-bus.sh <span class="comment">#/usr/bin/rescan-scsi-bus.sh</span></span><br><span class="line">Scanning SCSI subsystem <span class="keyword">for</span> new devices</span><br><span class="line">Scanning host 0 <span class="keyword">for</span>  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs</span><br><span class="line"> Scanning <span class="keyword">for</span> device 0 2 0 0 ...</span><br><span class="line">OLD: Host: scsi0 Channel: 02 Id: 00 Lun: 00</span><br><span class="line">      Vendor: DELL     Model: PERC H730 Mini   Rev: 4.27</span><br><span class="line">      Type:   Direct-Access                    ANSI SCSI revision: 05</span><br><span class="line">Scanning host 1 <span class="keyword">for</span>  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs</span><br><span class="line"> Scanning <span class="keyword">for</span> device 1 0 0 1 ...</span><br><span class="line">OLD: Host: scsi1 Channel: 00 Id: 00 Lun: 01</span><br><span class="line">      Vendor: COMPELNT Model: Compellent Vol   Rev: 0701</span><br><span class="line">      Type:   Direct-Access                    ANSI SCSI revision: 05</span><br><span class="line">sg2 changed: LU not available (PQual 1)</span><br><span class="line">OLD: Host: scsi1 Channel: 00 Id: 00 Lun: 02</span><br><span class="line">      Vendor: COMPELNT Model: Compellent Vol   Rev: 0701</span><br><span class="line">      Type:   Direct-Access                    ANSI SCSI revision: 05</span><br><span class="line"> Scanning <span class="keyword">for</span> device 1 0 1 1 ...</span><br><span class="line">OLD: Host: scsi1 Channel: 00 Id: 01 Lun: 01</span><br><span class="line">      Vendor: COMPELNT Model: Compellent Vol   Rev: 0701</span><br><span class="line">      Type:   Direct-Access                    ANSI SCSI revision: 05</span><br><span class="line">sg4 changed: LU not available (PQual 1)</span><br><span class="line">OLD: Host: scsi1 Channel: 00 Id: 01 Lun: 02</span><br><span class="line">      Vendor: COMPELNT Model: Compellent Vol   Rev: 0701</span><br><span class="line">      Type:   Direct-Access                    ANSI SCSI revision: 05</span><br><span class="line">Scanning host 2 <span class="keyword">for</span>  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs</span><br><span class="line">Scanning host 3 <span class="keyword">for</span>  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs</span><br><span class="line">Scanning host 4 <span class="keyword">for</span>  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs</span><br><span class="line">Scanning host 5 <span class="keyword">for</span>  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs</span><br><span class="line">Scanning host 6 <span class="keyword">for</span>  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs</span><br><span class="line">Scanning host 7 <span class="keyword">for</span>  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs</span><br><span class="line">Scanning host 8 <span class="keyword">for</span>  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs</span><br><span class="line">Scanning host 9 <span class="keyword">for</span>  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs</span><br><span class="line">Scanning host 10 <span class="keyword">for</span>  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs</span><br><span class="line">Scanning host 11 <span class="keyword">for</span>  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs</span><br><span class="line"> Scanning <span class="keyword">for</span> device 11 0 0 0 ...</span><br><span class="line">OLD: Host: scsi11 Channel: 00 Id: 00 Lun: 00</span><br><span class="line">      Vendor: PLDS     Model: DVD+-RW DU-8A5LH Rev: 6D51</span><br><span class="line">      Type:   CD-ROM                           ANSI SCSI revision: 05</span><br><span class="line">.0 new or changed device(s) found.</span><br><span class="line">0 remapped or resized device(s) found.</span><br><span class="line">0 device(s) removed.</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2ï¼šå¦‚æœæ›´æ¢HBAå¡æˆ–è€…æ·»åŠ äº†æ–°çš„LUNå·å—å­˜å‚¨åˆ™éœ€è¦é‡æ–°æ‰«ç›˜</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> /sys/class/scsi_host/*; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="string">"- - -"</span> &gt; <span class="variable">$i</span>/scan; <span class="keyword">done</span></span><br><span class="line"><span class="comment"># Tips:æŸäº›å­˜å‚¨æˆ–ç³»ç»Ÿæ²¡æœ‰scanæ–‡ä»¶ï¼Œå¯ä»¥é€šissue_lipæ–‡ä»¶è¯†åˆ«</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"1"</span> &gt; /sys/class/fc_host/host4/issue_lip  </span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æŸ¥çœ‹å­˜å‚¨è®¾å¤‡æ˜¯å¦æ˜ å°„åˆ°ä¸»æœºLUNå·å­˜å‚¨æ˜¯å¦è¢«æ·»åŠ åˆ°æœ¬åœ°</span></span><br><span class="line">$ fdisk -l | grep <span class="string">"/dev"</span></span><br><span class="line"><span class="comment"># Disk /dev/sde: 1 TiB, 1099511627776 bytes, 2147483648 sectors</span></span><br><span class="line"><span class="comment"># Disk /dev/sdd: 1.2 TiB, 1319413953024 bytes, 2576980377 sectors</span></span><br><span class="line"><span class="comment"># Disk /dev/mapper/k8sapp: 1.2 TiB, 1319413953024 bytes, 2576980377 sectors</span></span><br><span class="line"><span class="comment"># Disk /dev/mapper/k8slog: 1 TiB, 1099511627776 bytes, 2147483648 sectors</span></span><br><span class="line"></span><br><span class="line">$ lsblk</span><br><span class="line"><span class="comment"># sdb        8:16   0  1.2T  0 disk</span></span><br><span class="line"><span class="comment"># â””â”€k8sapp 253:0    0  1.2T  0 mpath /mnt/nfs/k8sapp</span></span><br><span class="line"><span class="comment"># sdc        8:32   0    1T  0 disk</span></span><br><span class="line"><span class="comment"># â””â”€k8slog 253:1    0    1T  0 mpath /mnt/nfs/k8slog</span></span><br><span class="line"><span class="comment"># sdd        8:48   0  1.2T  0 disk</span></span><br><span class="line"><span class="comment"># â””â”€k8sapp 253:0    0  1.2T  0 mpath /mnt/nfs/k8sapp</span></span><br><span class="line"><span class="comment"># sde        8:64   0    1T  0 disk</span></span><br><span class="line"><span class="comment"># â””â”€k8slog 253:1    0    1T  0 mpath /mnt/nfs/k8slog</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$cat</span> /proc/partitions <span class="comment"># åˆ†åŒºä¿¡æ¯å¸¦æœ‰(major|minor)</span></span><br><span class="line">major minor  <span class="comment">#blocks  name</span></span><br><span class="line">   7        0      56648 loop0</span><br><span class="line">   7        1      72256 loop1</span><br><span class="line">   7        2      30600 loop2</span><br><span class="line">   7        3      72984 loop3</span><br><span class="line">   7        4      30608 loop4</span><br><span class="line">   7        5      56276 loop5</span><br><span class="line">   8        0 1170997248 sda</span><br><span class="line">   8        1       1024 sda1</span><br><span class="line">   8        2  524288000 sda2</span><br><span class="line">   8        3    4194304 sda3</span><br><span class="line">   8        4   10485760 sda4</span><br><span class="line">   8        5  629145600 sda5</span><br><span class="line">   8       64 1073741824 sde</span><br><span class="line">   8       48 1288490188 sdd</span><br><span class="line">  11        0    1048575 sr0</span><br><span class="line"> 253        0 1288490188 dm-0</span><br><span class="line"> 253        1 1073741824 dm-1</span><br><span class="line">   8       32 1073741824 sdc</span><br><span class="line">   8       16 1288490188 sdb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) ä¼—æ‰€å‘¨çŸ¥SATAå’ŒSCSIæ˜¯æ”¯æŒçƒ­æ’æ‹”çš„,é€šè¿‡å­˜å‚¨è®¾å¤‡ç›´è¿çš„LUNåˆ°æœåŠ¡å™¨æ—¶å€™ï¼Œç³»ç»Ÿä¸èƒ½è‡ªåŠ¨è¯†åˆ«å¾€å¾€éœ€è¦é‡å¯ç³»ç»Ÿæ¥è¯†åˆ«ï¼Œä½†æ˜¯æœ‰å¦å¤–ä¸€ç§æ–¹æ³•å¯ä»¥å¾ˆæ–¹é¢çš„è®©ç³»ç»Ÿè¯†åˆ«æ–°çš„è®¾å¤‡ï¼Œå³é€šè¿‡`/proc/scsi/scsi`ä½¿ç³»ç»Ÿè¯†åˆ«æ–°çš„é©±åŠ¨å™¨</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"scsi add-single-device w x y z"</span> &gt; /proc/scsi/scsi</span><br><span class="line"><span class="comment"># ä¸ºä½¿è¯¥å‘½ä»¤æ­£å¸¸è¿è¡Œï¼Œå¿…é¡»æŒ‡å®šæ­£ç¡®çš„å‚æ•°å€¼ wã€xã€y å’Œ zï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</span></span><br><span class="line"><span class="comment"># w æ˜¯ä¸»æœºé€‚é…å™¨æ ‡è¯†ï¼Œç¬¬ä¸€ä¸ªé€‚é…å™¨ä¸ºé›¶(0)</span></span><br><span class="line"><span class="comment"># x æ˜¯ä¸»æœºé€‚é…å™¨ä¸Šçš„ SCSI é€šé“ï¼Œç¬¬ä¸€ä¸ªé€šé“ä¸ºé›¶(0)</span></span><br><span class="line"><span class="comment"># y æ˜¯è®¾å¤‡çš„ SCSI æ ‡è¯†</span></span><br><span class="line"><span class="comment"># z æ˜¯ LUN å·ï¼Œç¬¬ä¸€ä¸ª LUN ä¸ºé›¶(0)</span></span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚:ä»rescan-scsi-bus.shæ‰§è¡Œä¸­è·å¾—è®¾å¤‡å‚æ•°å€¼ Scanning <span class="keyword">for</span> device 1 0 0 1</span><br><span class="line"><span class="comment"># æ·»åŠ ç¡¬ç›˜å¹¶æŸ¥çœ‹</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"scsi add-single-device 1 0 0 0"</span> &gt;/proc/scsi/scsi &amp;&amp; fdisk -l</span><br><span class="line"><span class="comment"># åˆ é™¤ç¡¬ç›˜å¹¶æŸ¥çœ‹(ç¡®ä¿é¦–å…ˆå¸ä¸‹çš„ç£ç›˜è®¾å¤‡ä»ç³»ç»Ÿä¸­umount)</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"scsi remove-single-device 0 0 1 0"</span> &gt;/proc/scsi/scsi &amp;&amp; fdisk -l</span><br><span class="line"></span><br><span class="line"><span class="variable">$cat</span> /proc/scsi/scsi</span><br><span class="line"><span class="comment"># Attached devices:</span></span><br><span class="line"><span class="comment"># Host: scsi0 Channel: 02 Id: 00 Lun: 00</span></span><br><span class="line"><span class="comment">#   Vendor: DELL     Model: PERC H730 Mini   Rev: 4.27</span></span><br><span class="line"><span class="comment">#   Type:   Direct-Access                    ANSI  SCSI revision: 05</span></span><br><span class="line"><span class="comment"># Host: scsi4 Channel: 00 Id: 01 Lun: 01     # ä¾‹å¦‚:device ID = 4 0 1 1</span></span><br><span class="line"><span class="comment">#   Vendor: COMPELNT Model: Compellent Vol   Rev: 0701</span></span><br><span class="line"><span class="comment">#   Type:   Direct-Access                    ANSI  SCSI revision: 05</span></span><br><span class="line"><span class="comment"># Host: scsi4 Channel: 00 Id: 01 Lun: 02     # ä¾‹å¦‚:device ID = 4 0 1 2</span></span><br><span class="line"><span class="comment">#   Vendor: COMPELNT Model: Compellent Vol   Rev: 0701</span></span><br><span class="line"><span class="comment">#   Type:   Direct-Access                    ANSI  SCSI revision: 05</span></span><br><span class="line"><span class="comment"># Host: scsi11 Channel: 00 Id: 00 Lun: 00  </span></span><br><span class="line"><span class="comment">#   Vendor: PLDS     Model: DVD+-RW DU-8A5LH Rev: 6D51</span></span><br><span class="line"><span class="comment">#   Type:   CD-ROM                           ANSI  SCSI revision: 05</span></span><br><span class="line"><span class="comment"># Host: scsi4 Channel: 00 Id: 02 Lun: 01     # ä¾‹å¦‚:device ID = 4 0 2 2</span></span><br><span class="line"><span class="comment">#   Vendor: COMPELNT Model: Compellent Vol   Rev: 0701</span></span><br><span class="line"><span class="comment">#   Type:   Direct-Access                    ANSI  SCSI revision: 05</span></span><br><span class="line"><span class="comment"># Host: scsi4 Channel: 00 Id: 02 Lun: 02     # ä¾‹å¦‚:device ID = 4 0 2 2</span></span><br><span class="line"><span class="comment">#   Vendor: COMPELNT Model: Compellent Vol   Rev: 0701</span></span><br><span class="line"><span class="comment">#   Type:   Direct-Access                    ANSI  SCSI revision: 05</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>multipath é…ç½®å’Œä½¿ç”¨</strong></p>
<ul>
<li>æ¡ˆä¾‹1.SAS FAN å¤šè·¯å¾„<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (0) å¤šè·¯å¾„è‡ªåŠ¨å¤„ç†å¯è½½å…¥æ¨¡å—</span></span><br><span class="line">modprobe dm-multipath    <span class="comment"># åˆå§‹åŒ–DM</span></span><br><span class="line">modprobe dm-round-robin</span><br><span class="line">lsmod | grep multipath   <span class="comment"># æŸ¥çœ‹ </span></span><br><span class="line"><span class="comment"># dm_multipath           32768  4 dm_round_robin,dm_service_time</span></span><br><span class="line"><span class="comment"># multipath              20480  0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (1) æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸‹å„ç£ç›˜åˆ†åŒº</span></span><br><span class="line">root@ubuntu:/mnt/ww<span class="comment"># fdisk -l | egrep "^/dev"</span></span><br><span class="line"><span class="comment"># æ¯”å¦‚ /dev/mapper/xxxxx çš„ç£ç›˜å¯èƒ½æ˜¯é€»è¾‘å·(LVM)æˆ–è€…å¤šè·¯å¾„(Multipath)</span></span><br><span class="line">Disk /dev/mapper/mpatha-part1  4096 0 2576980377  1.2T Linux filesystem</span><br><span class="line">Disk /dev/mapper/mpatha-part2  4096 0 2147483648  1T Linux filesystem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸‹æ˜¯å¦å­˜åœ¨é€»è¾‘å·åœ¨è¿›è¡Œåˆ¤åˆ«;</span></span><br><span class="line"><span class="variable">$lvdisplay</span></span><br><span class="line"><span class="comment"># æˆ–è€…é‡‡ç”¨ä»¥ä¸‹å‘½ä»¤åˆ†åŒºä»¥åŠé€»è¾‘å·ä¸€ç›®äº†ç„¶</span></span><br><span class="line"><span class="variable">$lvmdiskscan</span></span><br><span class="line">dev/loop0                [      55.32 MiB]</span><br><span class="line">/dev/mapper/mpatha-part1 [      &lt;1.20 TiB]</span><br><span class="line">/dev/loop1               [      70.56 MiB]</span><br><span class="line">/dev/mapper/mpatha-part2 [       1.00 TiB]</span><br><span class="line">/dev/loop2         [      29.88 MiB]</span><br><span class="line">/dev/sda2          [     500.00 GiB]</span><br><span class="line">/dev/loop3         [      71.27 MiB]</span><br><span class="line">/dev/sda3          [       4.00 GiB]</span><br><span class="line">/dev/loop4         [      29.89 MiB]</span><br><span class="line">/dev/sda4          [      10.00 GiB]</span><br><span class="line">/dev/loop5         [     &lt;54.96 MiB]</span><br><span class="line">/dev/sda5          [     600.00 GiB]</span><br><span class="line">2 disks</span><br><span class="line">10 partitions</span><br><span class="line">0 LVM physical volume whole disks</span><br><span class="line">0 LVM physical volumes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸‹æ˜¯å¦å­˜åœ¨å¤šè·¯å¾„ç£ç›˜å¤šè·¯å¾„ä¸€èˆ¬çš„ /dev/mapper/xxxx é“¾æ¥åˆ°ä¸€ä¸ªç£ç›˜ /dev/dm-x çš„å—è®¾å¤‡æ–‡ä»¶</span></span><br><span class="line">$ ls -alh /dev/mapper/mpatha-part1</span><br><span class="line">lrwxrwxrwx 1 root root 7 Sep  8  2020 /dev/mapper/mpatha-part1 -&gt; ../dm-1</span><br><span class="line">$ multipath -ll </span><br><span class="line"><span class="comment"># mpatha (36000d3100366e6000000000000000020) dm-1 COMPELNT,Compellent Vol</span></span><br><span class="line"><span class="comment"># size=1.0T features='1 queue_if_no_path' hwhandler='1 alua' wp=rw</span></span><br><span class="line"><span class="comment"># `-+- policy='service-time 0' prio=25 status=active</span></span><br><span class="line"><span class="comment">#   |- 4:0:1:2 sde 8:64 failed ready running   # æœªæŒ‚è½½çš„æ—¶å€™æ˜¾ç¤ºfailed</span></span><br><span class="line"><span class="comment">#   `- 4:0:2:2 sdc 8:32 active ready running</span></span><br><span class="line"><span class="comment"># mpathb (36000d3100366e6000000000000000021) dm-0 COMPELNT,Compellent Vol</span></span><br><span class="line"><span class="comment"># size=1.2T features='1 queue_if_no_path' hwhandler='1 alua' wp=rw</span></span><br><span class="line"><span class="comment"># `-+- policy='service-time 0' prio=25 status=active</span></span><br><span class="line"><span class="comment">#   |- 4:0:1:1 sdd 8:48 failed ready running</span></span><br><span class="line"><span class="comment">#   `- 4:0:2:1 sdb 8:16 active ready running</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) multipath.conf é…ç½®</span></span><br><span class="line">blacklist &#123;</span><br><span class="line">  devnode <span class="string">"^(ram|raw|loop|fd|md|dm-|sr|scd|st|sda)[0-9]*"</span>  </span><br><span class="line">&#125;</span><br><span class="line">defaults &#123;</span><br><span class="line">  user_friendly_names yes  <span class="comment"># ç£ç›˜åç§°å‹å¥½æ˜¾ç¤º</span></span><br><span class="line">  path_grouping_policy multibus</span><br><span class="line">  failback immediate</span><br><span class="line">  no_path_retry fail</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># åœ¨/etc/multipath.confä¸­å¯ä»¥é…ç½®è®¾å¤‡scsi idå’Œè®¾å¤‡è·¯å¾„å½¢æˆç»‘å®š</span></span><br><span class="line">multipaths &#123;</span><br><span class="line">  multipath &#123;</span><br><span class="line">    wwid  <span class="string">"36000d3100366e6000000000000000021"</span></span><br><span class="line">    <span class="built_in">alias</span> k8sapp</span><br><span class="line">  &#125;</span><br><span class="line">  multipath &#123;</span><br><span class="line">    wwid <span class="string">"36000d3100366e6000000000000000020"</span></span><br><span class="line">    <span class="built_in">alias</span> k8slog</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) multipath æ“ä½œ(é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶å¹¶åˆå¹¶è·¯å¾„)</span></span><br><span class="line">systemctl restart multipathd &amp;&amp; systemctl status multipathd  <span class="comment"># é‡å¯ä¸æŸ¥çœ‹å¤šè·¯å¾„æœåŠ¡å¯ç”¨çŠ¶æ€</span></span><br><span class="line">multipath -F    <span class="comment"># åˆ é™¤ç°æœ‰é“¾è·¯</span></span><br><span class="line">multipath -v2   <span class="comment"># æ‰“å°åˆ›å»ºæˆ–ä¿®æ”¹çš„å¤šè·¯å¾„æ˜ å°„çš„æ‹“æ‰‘å³å¤šè·¯å¾„è®¾å¤‡ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">multipath -v3   <span class="comment"># æŸ¥çœ‹å¤šè·¯å¾„ blacklistã€whitelistå’Œè®¾å¤‡wwid</span></span><br><span class="line">multipath -ll   <span class="comment"># æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„å¤šè·¯å¾„æ‹“æ‰‘</span></span><br><span class="line"><span class="comment"># k8slog (36000d3100366e6000000000000000020) dm-1 COMPELNT,Compellent Vol</span></span><br><span class="line"><span class="comment"># size=1.0T features='1 queue_if_no_path' hwhandler='1 alua' wp=rw</span></span><br><span class="line"><span class="comment"># `-+- policy='service-time 0' prio=25 status=active</span></span><br><span class="line"><span class="comment">#   |- 4:0:1:2 sde 8:64 active ready running</span></span><br><span class="line"><span class="comment">#   `- 4:0:2:2 sdc 8:32 active ready running</span></span><br><span class="line"><span class="comment"># k8sapp (36000d3100366e6000000000000000021) dm-0 COMPELNT,Compellent Vol</span></span><br><span class="line"><span class="comment"># size=1.2T features='1 queue_if_no_path' hwhandler='1 alua' wp=rw</span></span><br><span class="line"><span class="comment"># `-+- policy='service-time 0' prio=25 status=active</span></span><br><span class="line"><span class="comment">#   |- 4:0:1:1 sdd 8:48 active ready running</span></span><br><span class="line"><span class="comment">#   `- 4:0:2:1 sdb 8:16 active ready running</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»ä¸Šé¢çš„ä¿¡æ¯å¯ä»¥çœ‹å‡ºmultipatè·å–åˆ°äº†2ä¸ªè·¯å¾„`å®é™…è®¾å¤‡sde/è™šæ‹Ÿè®¾å¤‡sdc`è®¾å¤‡èšåˆæˆä¸ºä¸€ä¸ªk8slogç£ç›˜è®¾å¤‡åç§°ï¼Œk8slogæ˜¯å¤šè·¯å¾„æ˜ å°„åç§°ï¼ŒæŒ‡å‘dm-1å®ƒæ˜¯blockè®¾å¤‡ã€‚</span></span><br><span class="line"><span class="comment"># è€Œ /dev/mapper/k8sapp ä¸ /dev/dm-1å®é™…ä¸ŠæŒ‡å‘çš„åŒä¸€ä¸ªè®¾å¤‡</span></span><br><span class="line">/usr/lib/udev/scsi_id -g /dev/dm-1</span><br><span class="line">36000d3100366e6000000000000000020</span><br><span class="line">/usr/lib/udev/scsi_id -g /dev/mapper/k8sapp</span><br><span class="line">36000d3100366e6000000000000000021</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (6) å¤šè·¯å¾„è®¾å¤‡ç£ç›˜åˆ†åŒºä¸æ ¼å¼</span></span><br><span class="line"><span class="comment"># æ­¤å¤„ç”±äºä½¿ç”¨çš„ç£ç›˜æ— éœ€åˆ†åŒºç€å°±ä½¿ç”¨è®¾å¤‡çš„å…¨éƒ¨æ§åˆ¶ï¼Œä½†æ˜¯æ³¨æ„å¦‚æœç£ç›˜å¤§äº2Tåˆ™éœ€è¦é‡‡ç”¨partedå‘½ä»¤è¿›è¡Œç£ç›˜åˆ†åŒº;</span></span><br><span class="line">$ mkfs.xfs /dev/mapper/k8sapp </span><br><span class="line">$ mkfs.xfs /dev/mapper/k8slog</span><br><span class="line">$ fdisk -l</span><br><span class="line"><span class="comment"># Disk /dev/mapper/k8sapp: 1.2 TiB, 1319413953024 bytes, 2576980377 sectors</span></span><br><span class="line"><span class="comment"># Units: sectors of 1 * 512 = 512 bytes</span></span><br><span class="line"><span class="comment"># Sector size (logical/physical): 512 bytes / 4096 bytes</span></span><br><span class="line"><span class="comment"># I/O size (minimum/optimal): 2097152 bytes / 2097152 bytes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Disk /dev/mapper/k8slog: 1 TiB, 1099511627776 bytes, 2147483648 sectors</span></span><br><span class="line"><span class="comment"># Units: sectors of 1 * 512 = 512 bytes</span></span><br><span class="line"><span class="comment"># Sector size (logical/physical): 512 bytes / 4096 bytes</span></span><br><span class="line"><span class="comment"># I/O size (minimum/optimal): 2097152 bytes / 2097152 bytes</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (7) æŸ¥çœ‹dm-1 ã€dm-2è®¾å¤‡çš„uuid</span></span><br><span class="line"><span class="variable">$ls</span> -alh /dev/disk/by-uuid/</span><br><span class="line">lrwxrwxrwx 1 root root  10 Sep 12 23:23 40fd2fd5-997f-4266-a0c8-95c0e534a23b -&gt; ../../dm-1</span><br><span class="line">lrwxrwxrwx 1 root root  10 Sep 12 23:23 acccde8a-16b2-4a87-a8da-0ba2c72aa688 -&gt; ../../dm-0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (8) æŒ‚è½½å¤šè·¯å¾„è®¾å¤‡åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­(æ¨èé‡‡ç”¨UUIDè¿›è¡ŒæŒ‚è½½)</span></span><br><span class="line"><span class="comment"># k8sapp</span></span><br><span class="line">/dev/disk/by-uuid/acccde8a-16b2-4a87-a8da-0ba2c72aa688 /mnt/nfs/k8sapp xfs defaults 0 0</span><br><span class="line"><span class="comment"># k8slog</span></span><br><span class="line">/dev/disk/by-uuid/40fd2fd5-997f-4266-a0c8-95c0e534a23b /mnt/nfs/k8slog xfs defaults 0 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (9) æŸ¥çœ‹æŒ‚è½½çš„å¤šè·¯å¾„è®¾å¤‡</span></span><br><span class="line">$ lsblk</span><br><span class="line">sdb        8:16   0  1.2T  0 disk</span><br><span class="line">â””â”€k8sapp 253:0    0  1.2T  0 mpath /mnt/nfs/k8sapp</span><br><span class="line">sdc        8:32   0    1T  0 disk</span><br><span class="line">â””â”€k8slog 253:1    0    1T  0 mpath /mnt/nfs/k8slog</span><br><span class="line">sdd        8:48   0  1.2T  0 disk</span><br><span class="line">â””â”€k8sapp 253:0    0  1.2T  0 mpath /mnt/nfs/k8sapp</span><br><span class="line">sde        8:64   0    1T  0 disk</span><br><span class="line">â””â”€k8slog 253:1    0    1T  0 mpath /mnt/nfs/k8slog</span><br><span class="line"></span><br><span class="line">$ df -h</span><br><span class="line">/dev/mapper/k8sapp              1.2T  8.6G  1.2T   1% /mnt/nfs/k8sapp</span><br><span class="line">/dev/mapper/k8slog              1.0T  7.2G 1017G   1% /mnt/nfs/k8slog</span><br><span class="line">192.168.1.216:/mnt/nfs/k8sapp  1.2T  8.6G  1.2T   1% /nfs/k8sapp</span><br><span class="line">192.168.1.216:/mnt/nfs/k8slog  1.0T  7.2G 1017G   1% /nfs/k8slog</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>è‡³æ­¤é€šè¿‡å­˜å‚¨è®¾å¤‡åˆ†é…ç»™ä¸»æœºçš„å­˜å‚¨å·é€šè¿‡<code>SAS SANçº¿ç¼†</code>è¿æ¥åˆ°ä¸»æœºHBAè®¾å¤‡ä¸­è¢«æ­£å¸¸è¯†åˆ«ä¸ä½¿ç”¨ã€‚</p>
<p><br/></p>
<ul>
<li>æ¡ˆä¾‹2.FC SAN å­˜å‚¨ç›´é“¾<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.æ£€æŸ¥ç”¨æˆ·ç™»å½•ä¿¡æ¯ &amp; åŒæ­¥æœåŠ¡å™¨æ—¶é—´ ä¸ºäº†ä¸å­˜å‚¨ä¸Šçš„æ—¶é—´å¯¹åº”</span></span><br><span class="line"><span class="variable">$id</span> &amp;&amp; ntpdate 10.10.6.101</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">23 May 21:55:37 ntpdate[72045]: step time server 10.10.6.101 offset 448.347362 sec</span><br><span class="line">$ hwclock -w</span><br><span class="line">$ date</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æŸ¥çœ‹å­˜å‚¨æ˜ å°„åˆ°ä¸»æœºçš„å…‰çº¤å¡æ ‡è¯†(æ­¤æ ‡è¯†ä¹Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨å¤šæ¡FC å…‰çº¤æ¥åˆ°ä¸»æœºæ—¶åŒºåˆ†ç»‘å®šçš„ä¸»æœºæ˜¯å¦å¯¹åº”ä¸»æœºä¸Šçš„HBAå¡æ ‡è¯†)</span></span><br><span class="line"><span class="variable">$cat</span> /sys/class/fc_host/host15/port_name</span><br><span class="line">0x100000109b341bc8</span><br><span class="line"><span class="variable">$cat</span> /sys/class/fc_host/host16/port_name</span><br><span class="line">0x100000109b341bc4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.å¯¹å…‰çº¤äº¤æ¢æœºè¿›è¡Œæˆæƒå®é™…ä¸Šæ˜¯è¿›è¡Œscsiè®¾å¤‡è¿›è¡Œçƒ­å¤‡æ·»åŠ åˆ°ä¸»æœºä¸Šè€Œä¸ç”¨é‡å¯</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'- - -'</span> &gt; /sys/class/scsi_host/host16/scan</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'- - -'</span> &gt; /sys/class/scsi_host/host15/scan</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.æŸ¥çœ‹linuxç£ç›˜åˆ†åŒº</span></span><br><span class="line">lvmdiskscan</span><br><span class="line">fdisk -l</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.å¤šè·¯å¾„multipathdé…ç½®æ–‡ä»¶ç”Ÿæˆ(æ‰‹åŠ¨ç¼–è¯‘å®‰è£…)</span></span><br><span class="line">nano /usr/share/doc/device-mapper-multipath-0.4.9/multipath.conf</span><br><span class="line">multipaths &#123;</span><br><span class="line">  multipath &#123;</span><br><span class="line">    wwid 3600a09803830447967244c61626d6e2f</span><br><span class="line">    <span class="built_in">alias</span> o3db</span><br><span class="line">    path_grouping_policy multibus <span class="comment">#failover</span></span><br><span class="line">    <span class="comment">#path_checker readsector0   #å†³å®šè·¯å¾„çŠ¶æ€çš„æ–¹æ³• </span></span><br><span class="line">    path_selector <span class="string">"round-robin 0"</span></span><br><span class="line">    failback immediate</span><br><span class="line">  &#125;</span><br><span class="line">  multipath &#123;</span><br><span class="line">    wwid 3600a09803830447967244c61626d6e59</span><br><span class="line">    <span class="built_in">alias</span> o3app</span><br><span class="line">    path_grouping_policy multibus <span class="comment">#failover</span></span><br><span class="line">    <span class="comment">#path_checker readsector0</span></span><br><span class="line">    path_selector <span class="string">"round-robin 0"</span></span><br><span class="line">    failback immediate</span><br><span class="line">  &#125;</span><br><span class="line">  multipath &#123;</span><br><span class="line">    wwid 3600a09803830447967244c61626d6e63</span><br><span class="line">    <span class="built_in">alias</span> fbapp</span><br><span class="line">    path_grouping_policy multibus <span class="comment">#failover</span></span><br><span class="line">    <span class="comment">#path_checker readsector0</span></span><br><span class="line">    path_selector <span class="string">"round-robin 0"</span></span><br><span class="line">    failback immediate</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ­¤æ–‡ä»¶å¤åˆ¶åˆ°ä¿®æ”¹åçš„æ–‡ä»¶å¤åˆ¶åˆ° /etc</span></span><br><span class="line">cp /usr/share/doc/device-mapper-multipath-0.4.9/multipath.conf /etc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.åˆå§‹åŒ–DMå¹¶æ£€æŸ¥mathconfæœåŠ¡æ˜¯å¦å¼€å¯ /sbin/mpathconf</span></span><br><span class="line">modprobe dm-multipath</span><br><span class="line">modprobe dm-round-robin</span><br><span class="line">systemctl restart multipathd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.è¿›åˆ°/dev/mapperè¿›è¡ŒæŸ¥çœ‹æ˜ å°„æˆåŠŸçš„LUNåç§°</span></span><br><span class="line">ls -ltr /dev/mapper</span><br><span class="line">crw------- 1 root root 10, 236 Jan 3 14:04 control</span><br><span class="line">lrwxrwxrwx 1 root root 7 Jan 3 14:04 rhel-var_log_audit -&gt; ../dm-3</span><br><span class="line">lrwxrwxrwx 1 root root 7 Jan 3 14:04 rhel-var_log -&gt; ../dm-2</span><br><span class="line">lrwxrwxrwx 1 root root 7 Jan 3 14:04 rhel-var -&gt; ../dm-1</span><br><span class="line">lrwxrwxrwx 1 root root 7 Jan 3 14:04 rhel-swa p -&gt; ../dm-5</span><br><span class="line">lrwxrwxrwx 1 root root 7 Jan 3 14:04 rhel-root -&gt; ../dm-6</span><br><span class="line">lrwxrwxrwx 1 root root 7 Jan 3 14:04 rhel-tmp -&gt; ../dm-0</span><br><span class="line">lrwxrwxrwx 1 root root 7 Jan 3 14:04 rhel-home -&gt; ../dm-4</span><br><span class="line">lrwxrwxrwx 1 root root 7 May 23 22:37 vgo3app-lvo3app -&gt; ../dm-7  <span class="comment"># å…³é”®ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.vgo3app-lvo3app</span></span><br><span class="line">vgchange -an vgo3db</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>æ¡ˆä¾‹3.å¤šè·¯å¾„ISCSIç£ç›˜çš„å­˜å‚¨æ± é…ç½®<br>æµ‹è¯•ç¯å¢ƒ: Ubuntu 14.04<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å®‰è£…éœ€è¦è½¯ä»¶: </span></span><br><span class="line">apt-get install multipath-tools tgt open-iscsi</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.åˆ›å»ºè£¸ç£ç›˜(RAW): </span></span><br><span class="line">qemu-img -f raw testmul.raw 5G</span><br><span class="line"><span class="comment"># æˆ–è€… </span></span><br><span class="line">dd <span class="keyword">if</span>=/dev/zero of=testmul.raw bs=1M count=0 seek=5120</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æŒ‚è½½RAWç£ç›˜æ–‡ä»¶ </span></span><br><span class="line">losetup -f --show testmul.raw</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>åˆ›å»ºISISCç›˜:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.æ·»åŠ tgté…ç½®æ–‡ä»¶(/etc/tgt/targets.conf) : /dev/loop0 ä¸ºç¬¬ä¸‰æ­¥æŒ‚è½½çš„loopè®¾å¤‡</span></span><br><span class="line">&lt;target iqn.2013-10.cn.openstack:cinder-volume.target&gt;</span><br><span class="line">  backing-store /dev/loop0</span><br><span class="line">&lt;/target&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.é‡å¯tgt</span></span><br><span class="line">service tgt restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æŸ¥çœ‹ISISCä¿¡æ¯ ï¼ˆ192.168.1.3æœ¬æœºipåœ°å€ï¼›é»˜è®¤ç«¯å£ä¸º3260ï¼›iptableså¼€å¯ï¼Œå¯ä»¥å…³é—­æˆ–è€…å®šä¹‰å…è®¸è§„åˆ™ï¼‰</span></span><br><span class="line">iscsiadm -m discovery -t st -p 192.168.1.3:3260</span><br><span class="line"><span class="comment"># è¾“å‡ºä¿¡æ¯:</span></span><br><span class="line"><span class="comment"># 192.168.1.3:3260,1 iqn.2013-10.cn.openstack:cinder-volume.target</span></span><br></pre></td></tr></table></figure></p>
<p>é…ç½®å¤šè·¯å¾„ (multipath) ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.è·¯å¾„é…ç½® iface0ä¸ºè·¯å¾„åï¼Œwlan0ä¸ºç½‘å¡ ï¼ˆæ­¤å¤„åªé…ç½®äº†å•è·¯å¾„éœ€è¦é…ç½®å¤šè·¯è‡ªè¡Œé…ç½®ã€‚ ï¼‰</span></span><br><span class="line">iscsiadm -m iface -I iface0 â€“op=new</span><br><span class="line">iscsiadm -m iface -I iface0 â€“op=update -n iface.net_ifacename -v wlan0</span><br><span class="line">iface0 è·¯å¾„å…·ä½“é…ç½®ä¿¡æ¯ï¼š /etc/iscsi/ifaces/iface0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ç™»é™†ISISCç£ç›˜</span></span><br><span class="line">iscsiadm -m node -T iqn.2013-10.cn.openstack:cinder-volume.target -p 192.16.1.3:3260 -I iface0 -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æŸ¥çœ‹æ–°å¢ç£ç›˜</span></span><br><span class="line">fdisl -l <span class="comment">#å¯ä»¥çœ‹åˆ°å¢åŠ çš„ç£ç›˜: /dev/sdb </span></span><br><span class="line"><span class="comment"># Disk /dev/sdb: 5368 MB, 5368709120 bytes</span></span><br><span class="line"><span class="comment"># 166 heads, 62 sectors/track, 1018 cylinders, total 10485760 sectors</span></span><br><span class="line"><span class="comment"># Units = æ‰‡åŒº of 1 * 512 = 512 bytes</span></span><br><span class="line"><span class="comment"># Sector size (logical/physical): 512 bytes / 512 bytes</span></span><br><span class="line"><span class="comment"># I/O size (minimum/optimal): 512 bytes / 512 bytes</span></span><br><span class="line"><span class="comment"># Disk identifier: 0x00000000</span></span><br><span class="line"><span class="comment"># Disk /dev/sdb doesnt contain a valid partition table</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.multipathé…ç½®æ–‡ä»¶ </span></span><br><span class="line"><span class="comment"># a.é…ç½®æ–‡ä»¶ä¿®æ”¹ ï¼ˆ/etc/multipath.confï¼‰,å¹¶é‡å¯åŠ¨multipath-toolsæœåŠ¡</span></span><br><span class="line">blacklist &#123;</span><br><span class="line">  devnode <span class="string">"^sda"</span> </span><br><span class="line">&#125;</span><br><span class="line">defaults &#123;</span><br><span class="line">  user_friendly_names yes</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># b.è¿è¡Œmulpath </span></span><br><span class="line"><span class="variable">$multipath</span> -ll</span><br><span class="line"><span class="comment"># è¾“å‡ºä¿¡æ¯ï¼š</span></span><br><span class="line">iscsidisk1 (33000000100000001) dm-0 IET     ,VIRTUAL-DISK    </span><br><span class="line">size=5.0G features=<span class="string">'1 queue_if_no_path'</span> hwhandler=<span class="string">'0'</span> wp=rw</span><br><span class="line">`-+- policy=<span class="string">'round-robin 0'</span> prio=1 status=active</span><br><span class="line">  `- 6:0:0:1 sdb 8:16 active ready running</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤‡æ³¨ï¼šå¦‚æœæ‰§è¡Œä¸Šè¿°å‘½ä»¤ï¼Œæ²¡æœ‰ä¿¡æ¯è¾“å‡ºæ‰§è¡Œ multipath -v3 è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ </span></span><br><span class="line"><span class="comment"># æŠŠ /dev/sdbçš„uuid æ·»åŠ åˆ° /etc/multipath/wwids ä¸­ï¼Œè¿™æ ·multipathå°±ä¸ä¼šè¿‡æ»¤æ‰è®¾å¤‡ /dev/sdb å¹¶é‡å¯multipath-toolsæœåŠ¡ã€‚</span></span><br><span class="line">===== paths list =====</span><br><span class="line">uuid              hcil    dev dev_t pri dm_st chk_st vend/prod/rev            </span><br><span class="line">33000000100000001 6:0:0:1 sdb 8:16  1   undef ready  IET     ,VIRTUAL-DISK    </span><br><span class="line">Apr 10 19:59:27 | params = 1 queue_if_no_path 0 1 1 round-robin 0 1 1 8:16 1000 </span><br><span class="line">Apr 10 19:59:27 | status = 2 0 0 0 1 1 A 0 1 0 8:16 A 0 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># c. æ·»åŠ  multipath ä¿¡æ¯/etc/multipath.conf</span></span><br><span class="line">multipaths &#123;</span><br><span class="line">  multipath &#123;</span><br><span class="line">    wwid  <span class="string">"33000000100000001"</span></span><br><span class="line">    <span class="built_in">alias</span> iscsidisk1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.é‡å¯multipath-toolsæœåŠ¡æ‰§è¡Œ</span></span><br><span class="line">systemctl restart multipath-tools</span><br><span class="line"><span class="variable">$lsblk</span></span><br><span class="line">sdb                   8:16   0     5G  0 disk  </span><br><span class="line">â””â”€iscsidisk1 (dm-0) 252:0    0     5G  0 mpath</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>è¡¥å……partedç£ç›˜åˆ†åŒºä¸æ ¼å¼åŒ–æŒ‚è½½:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å¤šè·¯å¾„è¯†åˆ«çš„è®¾å¤‡ç”¨partedå·¥å…·æ¥åšåˆ†åŒºæ ¼å¼åŒ–</span></span><br><span class="line">parted /dev/sdb  </span><br><span class="line">(parted) mklabel gpt       <span class="comment"># æŠŠç¡¬ç›˜è½¬æ¢æˆGPTåˆ†åŒº</span></span><br><span class="line">(parted) mkpart primary 1  <span class="comment"># åˆ›å»ºä¸»åˆ†åŒºæ³¨æ„éœ€è¦`é€‰æ‹©åˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ext4ï¼Œext3ï¼Œxfs`</span></span><br><span class="line">(parted) <span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ä¸»åˆ†åŒºæ–‡ä»¶ç³»ç»ŸXFSæ ¼å¼åŒ–</span></span><br><span class="line">mkfs.xfs -f /dev/sdc1 <span class="comment">#æ ¼å¼åŒ–æˆxfs</span></span><br><span class="line">mkfs.xfs -f -i size=512 -l size=128m,lazy-count=1 -d agcount=64 /dev/mapper/mpathbp1 <span class="comment">#&gt;=20Tæ—¶å€™  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æ‰‹åŠ¨æŒ‚è½½</span></span><br><span class="line">mount /dev/sdc1 /home/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.å¼€æœºè‡ªåŠ¨æŒ‚è½½</span></span><br><span class="line">/dev/sdb1(ç£ç›˜)       /homeï¼ˆæŒ‚è½½ç‚¹ï¼‰    xfsï¼ˆæ–‡ä»¶æ ¼å¼ï¼‰   defaults 0 0</span><br><span class="line">df -hæŸ¥çœ‹æŒ‚è½½ç‚¹æ–‡ä»¶å</span><br><span class="line">/dev/sdb1              16T   33M   16T   1% /home</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>multipath å‘½ä»¤ - è®¾å¤‡æ˜ å°„å™¨ç›®æ ‡è‡ªåŠ¨é…ç½®</strong><br>æè¿°: è¯¥å‘½ä»¤ä¸»è¦ä½œç”¨æ˜¯è®¾å¤‡è¿›è¡Œæ˜ å°„å™¨ç›®æ ‡è‡ªåŠ¨é…ç½®ï¼Œå³ç”¨äºæ£€æµ‹å’Œåˆå¹¶åˆ°è®¾å¤‡çš„å¤šæ¡è·¯å¾„ï¼Œä»¥ç”¨äºæ•…éšœè½¬ç§»æˆ–æ€§èƒ½åŸå› ã€‚</p>
<p>è¯­æ³•å‚æ•°:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¸®åŠ©è¯´æ˜</span></span><br><span class="line">man multipath</span><br><span class="line"></span><br><span class="line"><span class="comment"># SYNOPSIS | å¤§çº²</span></span><br><span class="line">multipath [-v level] [-B|-d|-i|-q|-r] [-b file] [-p policy] [device]</span><br><span class="line">multipath [-v level] [-R retries] -f device</span><br><span class="line">multipath [-v level] [-R retries] -F</span><br><span class="line">multipath [-v level] [-l|-ll] [device]</span><br><span class="line">multipath [-v level] [-a|-w] device</span><br><span class="line">multipath [-v level] -W</span><br><span class="line">multipath [-v level] [-i] [-c|-C] device</span><br><span class="line">multipath [-v level] [-i] [-u|-U]</span><br><span class="line">multipath [-h|-t|-T]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ARGUMENTS | å‘½ä»¤è¡Œå‚æ•°</span></span><br><span class="line"><span class="comment"># è®¾å¤‡å‚æ•°å°†multipathçš„æ“ä½œé™åˆ¶ä¸ºä¸ç»™å®šè¡¨è¾¾å¼åŒ¹é…çš„è®¾å¤‡,å‚æ•°å¯ä»¥å¼•ç”¨å¤šè·¯å¾„æ˜ å°„æˆ–å…¶ç»„ä»¶(â€œè·¯å¾„â€)</span></span><br><span class="line">device node  <span class="comment"># è®¾å¤‡èŠ‚ç‚¹çš„æ–‡ä»¶åï¼Œä¾‹å¦‚/dev/dm-10æˆ–/dev/sda.å¦‚æœèŠ‚ç‚¹å¼•ç”¨è¡¨ç¤ºå¤šè·¯å¾„æ˜ å°„çš„ç°æœ‰è®¾å¤‡æ˜ å°„å™¨è®¾å¤‡ï¼Œåˆ™æ ¹æ®æ“ä½œæ¨¡å¼é€‰æ‹©æ˜ å°„æˆ–å…¶è·¯å¾„ã€‚å¦åˆ™å®ƒé€‰æ‹©è·¯å¾„è®¾å¤‡ã€‚</span></span><br><span class="line">device ID    <span class="comment"># ç”±ä¸»è®¾å¤‡å·æŒ‡å®šçš„å†…æ ¸è®¾å¤‡å·:å‰¯è®¾å¤‡å·ä¾‹å¦‚lsblkä¸­MAJ:MINå±æ€§å€¼65:16ï¼Œæ­¤æ ¼å¼åªèƒ½ç”¨äºè·¯å¾„è®¾å¤‡</span></span><br><span class="line">WWID         <span class="comment"># è¦åˆ—å‡ºç³»ç»Ÿä¸­å­˜åœ¨çš„è®¾å¤‡çš„WWIDsï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤"multipath -d -v3 2&gt;/dev/null"</span></span><br><span class="line"><span class="comment"># device action limited to:</span></span><br><span class="line"><span class="comment">#   . multipath named 'device' (ex: mpath0)</span></span><br><span class="line"><span class="comment">#   . multipath whose wwid is 'device' (ex: 60051...)</span></span><br><span class="line"><span class="comment">#   . multipath including the path named 'device' (ex: /dev/sda or/dev/dm-0)</span></span><br><span class="line"><span class="comment">#   . multipath including the path with maj:min 'device' (ex: 8:0)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œæ¨¡å¼</span></span><br><span class="line"><span class="comment"># é»˜è®¤çš„æ“ä½œæ¨¡å¼æ˜¯ä»ç³»ç»Ÿä¸­æ‰¾åˆ°çš„è®¾å¤‡ä¸­æ£€æµ‹å¹¶è®¾ç½®å¤šè·¯å¾„æ˜ å°„ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¡Œå¼€å…³é€‰æ‹©å…¶ä»–æ“ä½œæ¨¡å¼:</span></span><br><span class="line">-f     <span class="comment">#å¦‚æœå¤šè·¯å¾„è®¾å¤‡æœªä½¿ç”¨ï¼Œåˆ™åˆ·æ–°(åˆ é™¤)æŒ‡å®šä¸ºå‚æ•°çš„å¤šè·¯å¾„è®¾å¤‡æ˜ å°„</span></span><br><span class="line">-F     <span class="comment">#åˆ·æ–°(åˆ é™¤)æ‰€æœ‰æœªä½¿ç”¨çš„å¤šè·¯å¾„è®¾å¤‡æ˜ å°„ </span></span><br><span class="line">-l     <span class="comment">#ä»ç³»ç»Ÿæ–‡ä»¶å’Œè®¾å¤‡æ˜ å°„å™¨ä¸­è·å–çš„ä¿¡æ¯ä¸­æ˜¾ç¤º(â€œåˆ—è¡¨â€)å½“å‰çš„å¤šè·¯å¾„æ‹“æ‰‘</span></span><br><span class="line">-ll    <span class="comment">#ä»æ‰€æœ‰å¯ç”¨çš„ä¿¡æ¯(sysfsï¼Œè®¾å¤‡æ˜ å°„å™¨ï¼Œè·¯å¾„æ£€æŸ¥å™¨â€¦)æ˜¾ç¤º(â€œåˆ—è¡¨â€)å½“å‰çš„å¤šè·¯å¾„æ‹“æ‰‘</span></span><br><span class="line">-a     <span class="comment">#å°†æŒ‡å®šè®¾å¤‡çš„WWIDæ·»åŠ åˆ°WWIDsæ–‡ä»¶ä¸­</span></span><br><span class="line">-w     <span class="comment">#ä»WWIDsæ–‡ä»¶ä¸­åˆ é™¤æŒ‡å®šè®¾å¤‡çš„WWID</span></span><br><span class="line">-W     <span class="comment">#å°†WWIDsæ–‡ä»¶é‡ç½®ä¸ºåªåŒ…å«å½“å‰çš„å¤šè·¯å¾„è®¾å¤‡</span></span><br><span class="line">-c     <span class="comment">#æ£€æŸ¥ä¸€ä¸ªå—è®¾å¤‡æ˜¯å¦åº”è¯¥æ˜¯å¤šè·¯å¾„è®¾å¤‡ä¸­çš„ä¸€ä¸ªè·¯å¾„</span></span><br><span class="line">-C     <span class="comment">#æ£€æŸ¥å¤šè·¯å¾„è®¾å¤‡æ˜¯å¦æœ‰å¯ç”¨çš„è·¯å¾„ã€‚è¿™å¯ä»¥ç”¨æ¥æµ‹è¯•è¯¥è®¾å¤‡ä¸Šçš„I/Oæ˜¯å¦å¯èƒ½æˆåŠŸã€‚å‘½ä»¤æœ¬èº«ä¸å°è¯•åœ¨è®¾å¤‡ä¸Šæ‰§è¡ŒI/Oã€‚</span></span><br><span class="line">-u     <span class="comment">#æ£€æŸ¥ç¨‹åºç¯å¢ƒä¸­æŒ‡å®šçš„è®¾å¤‡æ˜¯å¦åº”è¯¥æ˜¯å¤šè·¯å¾„è®¾å¤‡ä¸­çš„è·¯å¾„</span></span><br><span class="line">-U     <span class="comment">#æ£€æŸ¥ç¨‹åºç¯å¢ƒä¸­æŒ‡å®šçš„è®¾å¤‡æ˜¯å¦æ˜¯å…·æœ‰å¯ç”¨è·¯å¾„çš„å¤šè·¯å¾„è®¾å¤‡ä¸-Cæ•ˆæœä¸€è‡´</span></span><br><span class="line">-h     <span class="comment">#æ‰“å°ä½¿ç”¨æ–‡æœ¬(å¸®åŠ©)</span></span><br><span class="line">-t     <span class="comment">#æ˜¾ç¤ºå½“å‰ä½¿ç”¨çš„é»˜è®¤å¤šè·¯å¾„é…ç½®</span></span><br><span class="line">-T     <span class="comment">#æ˜¾ç¤ºå½“å‰ä½¿ç”¨çš„multipathdé…ç½®ï¼Œå°†è¾“å‡ºé™åˆ¶ä¸ºç³»ç»Ÿä¸­å®é™…å‡ºç°çš„è®¾å¤‡ã€‚è¿™å¯ä»¥ç”¨ä½œåˆ›å»ºmultipath.confçš„æ¨¡æ¿ã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># é€‰é¡¹</span></span><br><span class="line">-v level <span class="comment">#åœ¨é»˜è®¤å’Œâ€œåˆ—è¡¨â€æ“ä½œæ¨¡å¼ä¸‹æ‰“å°åˆ°stdoutçš„å†—é•¿ä¿¡æ¯ã€‚é»˜è®¤çš„çº§åˆ«æ˜¯- v2ã€‚</span></span><br><span class="line">  0    <span class="comment">#Nothing is printed. æ²¡æœ‰æ‰“å°</span></span><br><span class="line">  1    <span class="comment">#åœ¨åˆ—è¡¨æ¨¡å¼ä¸‹ï¼Œæ‰“å°æ‰€æœ‰å¤šè·¯å¾„æ˜ å°„çš„WWIDsã€‚</span></span><br><span class="line">  2    <span class="comment">#åœ¨é»˜è®¤æ¨¡å¼ä¸‹ï¼Œæ‰“å°åˆ›å»ºæˆ–ä¿®æ”¹çš„å¤šè·¯å¾„æ˜ å°„çš„æ‹“æ‰‘ã€‚(åœ¨åˆ—è¡¨æ¨¡å¼ä¸‹ï¼Œã€‚)      </span></span><br><span class="line">  3    <span class="comment">#æ‰“å°æ‰€æœ‰æ£€æµ‹åˆ°çš„è·¯å¾„å’Œæ‰€æœ‰å¤šè·¯å¾„æ˜ å°„çš„æ‹“æ‰‘ã€‚ (åŒ…å«å¤šè·¯å¾„è¯¦æƒ…blacklistã€whitelistå’Œè®¾å¤‡wwidç­‰ç­‰ä¿¡æ¯)     </span></span><br><span class="line">       <span class="comment">#å†—ä½™çº§åˆ«è¿˜æ§åˆ¶æ‰“å°åˆ°stderrçš„æ—¥å¿—å’Œè°ƒè¯•æ¶ˆæ¯çš„çº§åˆ«ã€‚é»˜è®¤çš„çº§åˆ«å¯¹åº”äºLOG_NOTICE(åœ¨æ­£å¸¸è¿è¡Œä¸­ä¸åº”è¯¥é”™è¿‡çš„é‡è¦æ¶ˆæ¯)ã€‚</span></span><br><span class="line"></span><br><span class="line">-d     <span class="comment">#é¢„æ¼”ï¼Œä¸è¦åˆ›å»ºæˆ–æ›´æ–°devmapã€‚</span></span><br><span class="line">-i     <span class="comment">#å¤„ç†è®¾å¤‡æ—¶å¿½ç•¥WWIDsæ–‡ä»¶ã€‚å¦‚æœfind_multipathsä¸¥æ ¼æˆ–åœ¨multipathä¸­è®¾ç½®find_multipaths noã€‚conf, multipathåªè€ƒè™‘WWIDsæ–‡ä»¶ä¸­åˆ—å‡ºçš„è®¾å¤‡ã€‚è¿™ç§é€‰æ‹©å‡Œé©¾äºè¡Œä¸ºä¹‹ä¸Šã€‚å¯¹äºfind_multipathsçš„å…¶ä»–å€¼ï¼Œæ­¤é€‰é¡¹ä¸èµ·ä½œç”¨ã€‚</span></span><br><span class="line">-B      <span class="comment">#å°†ç»‘å®šæ–‡ä»¶è§†ä¸ºåªè¯»ã€‚</span></span><br><span class="line">-b file <span class="comment">#è®¾ç½®user_friendly_namesç»‘å®šæ–‡ä»¶ä½ç½®ã€‚The default is /etc/multipath/bindings.</span></span><br><span class="line">-q      <span class="comment">#ä¸è¦ä¸ºå¤šè·¯å¾„æ˜ å°„å–æ¶ˆè®¾ç½®è®¾å¤‡æ˜ å°„å™¨ queue_if_no_path åŠŸèƒ½ã€‚é€šå¸¸å¦‚æœmultipathdä¸è¿è¡Œmultipathä¼šè¿™æ ·åšï¼Œå› ä¸ºåªæœ‰è¿è¡Œä¸­çš„å¤šè·¯å¾„å®ˆæŠ¤è¿›ç¨‹ä¿è¯ä¸å¯ç”¨çš„è·¯å¾„åœ¨å†æ¬¡å¯ç”¨æ—¶è¢«æ¢å¤ã€‚</span></span><br><span class="line">-p policy <span class="comment">#å¼ºåˆ¶æ‰€æœ‰æ˜ å°„åˆ°æŒ‡å®šçš„è·¯å¾„åˆ†ç»„ç­–ç•¥ï¼Œç­–ç•¥çš„å¯èƒ½å€¼ä¸multipath.conf(5)ä¸­çš„path_grouping_policyçš„å€¼ç›¸åŒï¼Œå¯é€‰ç­–ç•¥ç­–ç•¥ï¼›</span></span><br><span class="line">          <span class="comment"># . failover            æ¯ä¸ªä¼˜å…ˆçº§ç»„ä¸€ä¸ªè·¯å¾„</span></span><br><span class="line">          <span class="comment"># . multibus            æ‰€æœ‰è·¯å¾„åœ¨ä¸€ä¸ªä¼˜å…ˆçº§ç»„ä¸­</span></span><br><span class="line">          <span class="comment"># . group_by_serial     æ¯ä¸ªä¸²è¡Œä¸€ä¸ªä¼˜å…ˆçº§ç»„</span></span><br><span class="line">          <span class="comment"># . group_by_prio       æ¯ä¸ªä¼˜å…ˆçº§lvlæœ‰ä¸€ä¸ªä¼˜å…ˆçº§ç»„</span></span><br><span class="line">          <span class="comment"># . group_by_node_name  æ¯ä¸ªç›®æ ‡èŠ‚ç‚¹ä¸€ä¸ªä¼˜å…ˆçº§ç»„</span></span><br><span class="line"></span><br><span class="line">-r        <span class="comment">#å¼ºåˆ¶é‡æ–°åŠ è½½æ‰€æœ‰ç°æœ‰çš„å¤šè·¯å¾„æ˜ å°„ã€‚å¦‚æœmultipathdå®ˆæŠ¤è¿›ç¨‹æ­£åœ¨è¿è¡Œï¼Œåˆ™å°†æ­¤å‘½ä»¤å§”æ‰˜ç»™å®ƒ</span></span><br><span class="line">-R retries <span class="comment">#é‡è¯•åˆ·æ–°æ­£åœ¨ä½¿ç”¨çš„å¤šè·¯å¾„è®¾å¤‡çš„æ¬¡æ•°ã€‚é»˜è®¤å€¼æ˜¯0ã€‚</span></span><br></pre></td></tr></table></figure></p>
<p>åŸºç¡€ç¤ºä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) å¸¸ç”¨å‘½ä»¤</span></span><br><span class="line">multipath -F  <span class="comment"># åˆ·æ–°(åˆ é™¤)æ‰€æœ‰æœªä½¿ç”¨çš„å¤šè·¯å¾„è®¾å¤‡æ˜ å°„ </span></span><br><span class="line">multipath -v2 <span class="comment"># æ‰“å°åˆ›å»ºæˆ–ä¿®æ”¹çš„å¤šè·¯å¾„æ˜ å°„çš„æ‹“æ‰‘æˆ–æ‰“å°æ‰€æœ‰å¤šè·¯å¾„æ˜ å°„çš„æ‹“æ‰‘</span></span><br><span class="line">multipath -r  <span class="comment"># å¼ºåˆ¶é‡æ–°åŠ è½½æ‰€æœ‰ç°æœ‰çš„å¤šè·¯å¾„æ˜ å°„,å³ä¿®æ”¹multipath.confé…ç½®æ–‡ä»¶ä¹‹åé‡‡ç”¨å…¶å¯ä»¥çƒ­åŠ è½½</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) åˆ—ä¸¾æ‰€å¤šè·¯å¾„è®¾å¤‡ä¸­æ‰€æœ‰wwidsä¿¡æ¯ã€è®¾å¤‡idå·ä»¥åŠMAJ:MINå±æ€§å€¼ä¿¡æ¯</span></span><br><span class="line">multipath -v3 2&gt;/dev/null</span><br><span class="line"><span class="comment"># ===== paths list =====</span></span><br><span class="line"><span class="comment"># uuid                              hcil    dev dev_t pri dm_st chk_st vend/prod</span></span><br><span class="line"><span class="comment"># 36000d3100366e6000000000000000021 4:0:1:1 sdd 8:48  50  undef undef  COMPELNT,</span></span><br><span class="line"><span class="comment"># 36000d3100366e6000000000000000020 4:0:1:2 sde 8:64  50  undef undef  COMPELNT,</span></span><br><span class="line"><span class="comment"># 36000d3100366e6000000000000000021 4:0:2:1 sdb 8:16  1   undef undef  COMPELNT,</span></span><br><span class="line"><span class="comment"># 36000d3100366e6000000000000000020 4:0:2:2 sdc 8:32  1   undef undef  COMPELNT,</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) ç¼ºçœä»¥åŠå½“å‰å¤šè·¯å¾„è½¯ä»¶é…ç½®ä¿¡æ¯</span></span><br><span class="line">multipath -t | more</span><br><span class="line">multipath -T</span><br><span class="line">defaults &#123;</span><br><span class="line">  verbosity 2</span><br><span class="line">  polling_interval 5</span><br><span class="line">  max_polling_interval 20</span><br><span class="line">  .....</span><br><span class="line">  marginal_pathgroups <span class="string">"no"</span></span><br><span class="line">&#125;</span><br><span class="line">blacklist &#123;</span><br><span class="line">  devnode <span class="string">"^sda"</span></span><br><span class="line">  devnode <span class="string">"^hd[a-z]"</span></span><br><span class="line">  devnode <span class="string">"^(ram|raw|loop|fd|md|dm-|sr|scd|st)[0-9]*"</span></span><br><span class="line">  devnode <span class="string">"^dcssblk[0-9]*"</span></span><br><span class="line">&#125;</span><br><span class="line">blacklist_exceptions &#123;</span><br><span class="line">  property <span class="string">"(SCSI_IDENT_|ID_WWN)"</span></span><br><span class="line">&#125;</span><br><span class="line">devices &#123;</span><br><span class="line">  device &#123;</span><br><span class="line">    vendor <span class="string">"NVME"</span></span><br><span class="line">    product <span class="string">".*"</span></span><br><span class="line">    uid_attribute <span class="string">"ID_WWN"</span></span><br><span class="line">    path_checker <span class="string">"none"</span>   <span class="comment">#å†³å®šè·¯å¾„çŠ¶æ€çš„æ–¹æ³• </span></span><br><span class="line">    retain_attached_hw_handler <span class="string">"no"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h6 id="multipath-conf-é…ç½®è¯¦è§£"><a href="#multipath-conf-é…ç½®è¯¦è§£" class="headerlink" title="multipath.conf - é…ç½®è¯¦è§£"></a>multipath.conf - é…ç½®è¯¦è§£</h6><p>é…ç½®å¤šè·¯å¾„æ–‡ä»¶ /etc/multipath.conf å‚æ•°è¯´æ˜<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$multipath</span> -T</span><br><span class="line">defaults &#123;</span><br><span class="line">  verbosity 2</span><br><span class="line">  polling_interval 5</span><br><span class="line">  max_polling_interval 20</span><br><span class="line">  reassign_maps <span class="string">"no"</span></span><br><span class="line">  multipath_dir <span class="string">"//lib/multipath"</span></span><br><span class="line">  path_selector <span class="string">"service-time 0"</span>  <span class="comment">#é€‰æ‹©é‚£ä¸€æ¡è·¯å¾„è¿›è¡Œä¸‹æ¬¡IOæ“ä½œ</span></span><br><span class="line">  path_grouping_policy <span class="string">"multibus"</span> <span class="comment">#è·¯å¾„ç»„ç­–ç•¥ </span></span><br><span class="line">  uid_attribute <span class="string">"ID_SERIAL"</span></span><br><span class="line">  prio <span class="string">"const"</span></span><br><span class="line">  prio_args <span class="string">""</span></span><br><span class="line">  features <span class="string">"0"</span></span><br><span class="line">  path_checker <span class="string">"tur"</span>  <span class="comment"># å†³å®šè·¯å¾„çŠ¶æ€çš„æ–¹æ³• </span></span><br><span class="line">  alias_prefix <span class="string">"mpath"</span></span><br><span class="line">  failback <span class="string">"immediate"</span> <span class="comment">#æ•…éšœæ¢å¤çš„æ¨¡å¼ </span></span><br><span class="line">  rr_min_io 1000   <span class="comment"># åœ¨å½“å‰çš„ç”¨æˆ·ç»„ä¸­ï¼Œåœ¨åˆ‡æ¢åˆ°å¦å¤–ä¸€æ¡è·¯å¾„ä¹‹å‰çš„IOè¯·æ±‚çš„æ•°ç›® </span></span><br><span class="line">  rr_min_io_rq 1</span><br><span class="line">  max_fds <span class="string">"max"</span></span><br><span class="line">  rr_weight <span class="string">"uniform"</span></span><br><span class="line">  no_path_retry <span class="string">"fail"</span> <span class="comment">#é»˜è®¤failï¼Œåœ¨disable queueä¹‹å‰ç³»ç»Ÿå°è¯•ä½¿ç”¨å¤±æ•ˆè·¯å¾„çš„æ¬¡æ•°çš„æ•°å€¼ </span></span><br><span class="line">  queue_without_daemon <span class="string">"no"</span></span><br><span class="line">  flush_on_last_del <span class="string">"no"</span></span><br><span class="line">  user_friendly_names <span class="string">"yes"</span></span><br><span class="line">  fast_io_fail_tmo 5</span><br><span class="line">  bindings_file <span class="string">"/etc/multipath/bindings"</span></span><br><span class="line">  wwids_file <span class="string">"/etc/multipath/wwids"</span></span><br><span class="line">  prkeys_file <span class="string">"/etc/multipath/prkeys"</span></span><br><span class="line">  log_checker_err always</span><br><span class="line">  all_tg_pt <span class="string">"no"</span></span><br><span class="line">  retain_attached_hw_handler <span class="string">"yes"</span></span><br><span class="line">  detect_prio <span class="string">"yes"</span></span><br><span class="line">  detect_checker <span class="string">"yes"</span></span><br><span class="line">  force_sync <span class="string">"no"</span></span><br><span class="line">  strict_timing <span class="string">"no"</span></span><br><span class="line">  deferred_remove <span class="string">"no"</span></span><br><span class="line">  config_dir <span class="string">"/etc/multipath/conf.d"</span></span><br><span class="line">  delay_watch_checks <span class="string">"no"</span></span><br><span class="line">  delay_wait_checks <span class="string">"no"</span></span><br><span class="line">  san_path_err_threshold <span class="string">"no"</span></span><br><span class="line">  san_path_err_forget_rate <span class="string">"no"</span></span><br><span class="line">  san_path_err_recovery_time <span class="string">"no"</span></span><br><span class="line">  marginal_path_err_sample_time <span class="string">"no"</span></span><br><span class="line">  marginal_path_err_rate_threshold <span class="string">"no"</span></span><br><span class="line">  marginal_path_err_recheck_gap_time <span class="string">"no"</span></span><br><span class="line">  marginal_path_double_failed_time <span class="string">"no"</span></span><br><span class="line">  find_multipaths <span class="string">"on"</span></span><br><span class="line">  uxsock_timeout 4000</span><br><span class="line">  retrigger_tries 0</span><br><span class="line">  retrigger_delay 10</span><br><span class="line">  missing_uev_wait_timeout 30</span><br><span class="line">  skip_kpartx <span class="string">"no"</span></span><br><span class="line">  disable_changed_wwids ignored</span><br><span class="line">  remove_retries 0</span><br><span class="line">  ghost_delay <span class="string">"no"</span></span><br><span class="line">  find_multipaths_timeout -10</span><br><span class="line">  enable_foreign <span class="string">""</span></span><br><span class="line">  marginal_pathgroups <span class="string">"no"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åç«¯è®¾å¤‡(ä¸åŒ…å«ä»¥ä¸‹è®¾å¤‡èŠ‚ç‚¹)</span></span><br><span class="line">blacklist &#123;</span><br><span class="line">  devnode <span class="string">"^sda"</span></span><br><span class="line">  devnode <span class="string">"^hd[a-z]"</span></span><br><span class="line">  devnode <span class="string">"^(ram|raw|loop|fd|md|dm-|sr|scd|st)[0-9]*"</span></span><br><span class="line">  devnode <span class="string">"^dcssblk[0-9]*"</span></span><br><span class="line">  devnode <span class="string">"^(ram|zram|raw|loop|fd|md|dm-|sr|scd|st|dcssblk)[0-9]"</span></span><br><span class="line">  devnode <span class="string">"^(td|hd|vd)[a-z]"</span></span><br><span class="line">  devnode <span class="string">"^cciss!c[0-9]d[0-9]*"</span></span><br><span class="line">&#125;</span><br><span class="line">  device &#123;</span><br><span class="line">    vendor <span class="string">"SGI"</span>  <span class="comment">#å‚å•†åç§°ï¼Œå¯é€šè¿‡multipath â€“v3è·å–åˆ° </span></span><br><span class="line">    product <span class="string">"Universal Xport"</span>  <span class="comment">#äº§å“å‹å· </span></span><br><span class="line">    getuid_callout <span class="string">"/sbin/scsi_id -g -u -s /block/%n"</span> <span class="comment">#è·å¾—å”¯ä¸€è®¾å¤‡å·ä½¿ç”¨çš„é»˜è®¤ç¨‹åº </span></span><br><span class="line">  &#125;</span><br><span class="line">  device &#123;</span><br><span class="line">          vendor <span class="string">"^DGC"</span></span><br><span class="line">          product <span class="string">"LUNZ"</span></span><br><span class="line">  &#125;</span><br><span class="line">  device &#123;</span><br><span class="line">          vendor <span class="string">"EMC"</span></span><br><span class="line">          product <span class="string">"LUNZ"</span></span><br><span class="line">  &#125;</span><br><span class="line">  device &#123;</span><br><span class="line">          vendor <span class="string">"DELL"</span></span><br><span class="line">          product <span class="string">"Universal Xport"</span></span><br><span class="line">  &#125;</span><br><span class="line">  device &#123;</span><br><span class="line">          vendor <span class="string">"IBM"</span></span><br><span class="line">          product <span class="string">"Universal Xport"</span></span><br><span class="line">  &#125;</span><br><span class="line">  device &#123;</span><br><span class="line">          vendor <span class="string">"IBM"</span></span><br><span class="line">          product <span class="string">"S/390"</span></span><br><span class="line">  &#125;</span><br><span class="line">  device &#123;</span><br><span class="line">          vendor <span class="string">"LENOVO"</span></span><br><span class="line">          product <span class="string">"Universal Xport"</span></span><br><span class="line">  &#125;</span><br><span class="line">  device &#123;</span><br><span class="line">          vendor <span class="string">"(NETAPP|LSI|ENGENIO)"</span></span><br><span class="line">          product <span class="string">"Universal Xport"</span></span><br><span class="line">  &#125;</span><br><span class="line">  device &#123;</span><br><span class="line">          vendor <span class="string">"STK"</span></span><br><span class="line">          product <span class="string">"Universal Xport"</span></span><br><span class="line">  &#125;</span><br><span class="line">  device &#123;</span><br><span class="line">          vendor <span class="string">"SUN"</span></span><br><span class="line">          product <span class="string">"Universal Xport"</span></span><br><span class="line">  &#125;</span><br><span class="line">  device &#123;</span><br><span class="line">          vendor <span class="string">"(Intel|INTEL)"</span></span><br><span class="line">          product <span class="string">"VTrak V-LUN"</span></span><br><span class="line">  &#125;</span><br><span class="line">  device &#123;</span><br><span class="line">          vendor <span class="string">"Promise"</span></span><br><span class="line">          product <span class="string">"VTrak V-LUN"</span></span><br><span class="line">  &#125;</span><br><span class="line">  device &#123;</span><br><span class="line">          vendor <span class="string">"Promise"</span></span><br><span class="line">          product <span class="string">"Vess V-LUN"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">blacklist_exceptions &#123;</span><br><span class="line">  property <span class="string">"(SCSI_IDENT_|ID_WWN)"</span></span><br><span class="line">&#125;</span><br><span class="line">devices &#123;</span><br><span class="line">  device &#123;</span><br><span class="line">    vendor <span class="string">"COMPELNT"</span></span><br><span class="line">    product <span class="string">"Compellent Vol"</span></span><br><span class="line">    path_grouping_policy <span class="string">"multibus"</span></span><br><span class="line">    no_path_retry <span class="string">"queue"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">overrides &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">multipaths &#123;</span><br><span class="line">  multipath &#123;</span><br><span class="line">    wwid <span class="string">"36000d3100366e6000000000000000021"</span>   <span class="comment">#ç£ç›˜çš„WWID </span></span><br><span class="line">    <span class="built_in">alias</span> <span class="string">"k8sapp"</span></span><br><span class="line">  &#125;</span><br><span class="line">  multipath &#123;</span><br><span class="line">    wwid <span class="string">"36000d3100366e6000000000000000020"</span></span><br><span class="line">    <span class="built_in">alias</span> <span class="string">"k8slog"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h6 id="bindings-å¤šè·¯å¾„ç¼ºçœç»‘å®šçš„åˆ«å"><a href="#bindings-å¤šè·¯å¾„ç¼ºçœç»‘å®šçš„åˆ«å" class="headerlink" title="bindings - å¤šè·¯å¾„ç¼ºçœç»‘å®šçš„åˆ«å"></a>bindings - å¤šè·¯å¾„ç¼ºçœç»‘å®šçš„åˆ«å</h6><p>æè¿°:/etc/multipath/bindingsæ–‡ä»¶æ˜¯åœ¨multipath.confä¸­å®šä¹‰äº†user_friendly_nameså±æ€§æ—¶å€™ï¼Œé»˜è®¤é‡‡ç”¨ä»¥ä¸‹å‹å¥½çš„åˆ«ååç§°;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cat</span> /etc/multipath/bindings</span><br><span class="line"><span class="comment"># Format:</span></span><br><span class="line"><span class="comment"># alias wwid</span></span><br><span class="line">mpatha 36000d3100366e6000000000000000020</span><br><span class="line">mpathd 36000d3100366e6000000000000000021</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="Windows-MPIO"><a href="#Windows-MPIO" class="headerlink" title="Windows - MPIO"></a>Windows - MPIO</h5><p>æè¿°: åœ¨Windowsä¸‹ä¹Ÿè‡ªå¸¦å¤šè·¯å¾„ç®¡ç†è½¯ä»¶å®ƒå«MPIOï¼ŒWindows MPIOé›†æˆåœ¨Windowsçš„ç³»ç»Ÿä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ä¼šå®‰è£…ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…èµ·æ¥ã€‚</p>
<p>Step 1.æ‰“å¼€â€œServer Manager-æœåŠ¡å™¨ç®¡ç†â€ï¼Œé€‰æ‹©â€œFeatureâ€ï¼Œé€‰æ‹©å³é”®èœå•ä¸­çš„â€œAdd Features-æ·»åŠ åŠŸèƒ½â€</p>
<p>Step 2.æ·»åŠ â€œMultiPath I/Oâ€åœ¨å¼¹å‡ºçš„Featuresé€‰æ‹©æ¡†ä¸­ï¼Œé€‰æ‹©â€œMultiPath I/Oâ€<br><figure class="image-box">
                <a rel=Multipathå¤šè·¯å¾„ç®¡ç†åŸºç¡€ä»‹ç»ä¸å®‰è£…é…ç½®ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200912141229.png" target="_blank" title="WeiyiGeek.MultiPath I/O" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200912141229.png" alt="WeiyiGeek.MultiPath I/O" title="" class=""></a>
                <p>WeiyiGeek.MultiPath I/O</p>
            </figure></p>
<p>Step 3.éœ€è¦å¯¹MPIOå¤šè·¯å¾„è¿›è¡Œé…ç½®æ‰èƒ½è®©å…¶æ¥ç®¡å­˜å‚¨ç³»ç»Ÿã€‚Windows 2008åŠåç»­ç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿæä¾›mpclaimå¤šè·¯å¾„å‘½ä»¤å¯ä»¥ç”¨äºæŸ¥è¯¢ç£ç›˜ä¿¡æ¯;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢è®¾å¤‡VIDå’ŒPID,æ­¤å¤„ä¸¾ä¾‹æ‰€ç”¨ï¼Œå®é™…é…ç½®çš„æ—¶å€™éœ€è¦ä»¥ç°åœºç¯å¢ƒçš„æ˜¾ç¤ºä¸ºå‡†ã€‚</span></span><br><span class="line">VIDï¼šVendor IDï¼Œå‚å•†IDã€‚ä¾‹å¦‚HUAWEIç­‰ã€‚</span><br><span class="line">PIDï¼šProduct IDï¼Œäº§å“IDã€‚ä¾‹å¦‚S5500Tã€S5600Tã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢ç£ç›˜ä¿¡æ¯</span></span><br><span class="line">mpclaim -e</span><br></pre></td></tr></table></figure>
<p>Step 4.è¿è¡ŒMPIOç®¡ç†æ§åˆ¶å°<code>%windir%\system32\mpiocpl.exe</code>ä¹Ÿå¯åœ¨ç®¡ç†å·¥å…·æ‰¾åˆ°å®ƒ,è¿›è¡Œæ·»åŠ å¾…ç®¡ç†å­˜å‚¨è®¾å¤‡çš„ä¿¡æ¯<br>åœ¨â€œMPIO Deviceâ€ä¸­ç‚¹å‡»â€œAddâ€æ·»åŠ å­˜å‚¨è®¾å¤‡ã€‚</p>
<ul>
<li>å¦‚æœå¯¹iSCSI initiatorä½¿ç”¨MPIOï¼Œåˆ™è¦æ±‚åœ¨â€œDiscover Multi-Pathsâ€èœå•ä¸­å¼€å¯â€œAdd Support for iSCSI deviceâ€é€‰é¡¹ã€‚</li>
<li>å¤§å¤šæ•°å‹å·çš„è®¾å¤‡å¯ä»¥åœ¨â€œDiscover MultiPathsâ€é€‰é¡¹ä¸‹çš„Othersé€‰é¡¹ä¸­è‡ªåŠ¨è¯†åˆ«ï¼Œæ­¤æ—¶åªéœ€ç‚¹å‡» Addå°†å…¶åŠ å…¥å³å¯ã€‚<figure class="image-box">
                <a rel=Multipathå¤šè·¯å¾„ç®¡ç†åŸºç¡€ä»‹ç»ä¸å®‰è£…é…ç½®ä½¿ç”¨ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200912142049.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200912142049.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure>
</li>
</ul>
<p>Step 5.é‡å¯ä¸»æœºä½¿å¤šè·¯å¾„ç”Ÿæ•ˆï¼Œç„¶åæŸ¥çœ‹MPIOç­–ç•¥ã€‚é‡å¯ä¸»æœºåå°†é‡æ–°æ‰«æç£ç›˜ã€‚ç£ç›˜æ•°é‡ä¸æ˜ å°„ç»™ä¸»æœºçš„LUNçš„æ•°é‡ä¸€è‡´ã€‚å³é”®å•å‡»ç£ç›˜ï¼Œé€‰æ‹©â€œPropertiesâ€å¯ä»¥çœ‹åˆ°å±æ€§ä¸­MPIOé€‰é¡¹ï¼Œä¸€èˆ¬æ¥è¯´å¦‚æ— ç‰¹åˆ«è¦æ±‚ï¼Œä¼˜å…ˆä½¿ç”¨é»˜è®¤MPIOç­–ç•¥ã€‚<br>ä¸åŒæƒ…å†µä¸‹é»˜è®¤çš„ç­–ç•¥æ˜¯ä¸åŒçš„ï¼Œå¸¸ç”¨æ“ä½œç³»ç»Ÿçš„é»˜è®¤ç­–ç•¥å¦‚è¡¨1-1æ‰€ç¤ºã€‚</p>
<table>
<thead>
<tr>
<th>æ“ä½œç³»ç»Ÿ</th>
<th>å­˜å‚¨ç³»ç»Ÿ</th>
<th>é»˜è®¤MPIOç­–ç•¥</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>Windows Server 2008</td>
<td>å¼€å¯ALUA</td>
<td>Round Robin With Subset</td>
<td></td>
</tr>
<tr>
<td>å…³é—­ALUA</td>
<td>Fail over only</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Windows Server 2008 R2</td>
<td>å¼€å¯ALUA</td>
<td>Round Robin With Subset</td>
<td></td>
</tr>
<tr>
<td>å…³é—­ALUA</td>
<td>Round Robin</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Windows Server 2012 DC</td>
<td>å¼€å¯ALUA</td>
<td>Round Robin With Subset</td>
<td></td>
</tr>
<tr>
<td>å…³é—­ALUA</td>
<td>Round Robin</td>
<td></td>
</tr>
</tbody>
</table>
<p>Step 6.ä¿®æ”¹è·¯å¾„çŠ¶æ€æŸäº›ç‰¹å®šåœºæ™¯æˆ–éœ€æ±‚ï¼Œéœ€å¯¹è·¯å¾„çŠ¶æ€é‡æ–°é…ç½®ã€‚</p>
<p>ä¾‹å¦‚ï¼šå¯¹äºâ€œFail Over Onlyâ€ç­–ç•¥ï¼Œåªå…è®¸ä¸€æ¡è·¯å¾„ä¸ºActivateçŠ¶æ€ï¼Œå…¶ä½™è·¯å¾„å¿…é¡»ç¼–è¾‘æˆStandbyçŠ¶æ€ï¼›å¯¹äºWindows 2008ï¼Œéœ€è¦å°†è¿æ¥åˆ°å½’å±æ§åˆ¶å™¨çš„è·¯å¾„çŠ¶æ€è®¾ç½®ä¸ºâ€œActive/Optimizedâ€ï¼Œå°†è¿æ¥åˆ°å…¶ä»–æ§åˆ¶å™¨çš„è·¯å¾„çŠ¶æ€è®¾ç½®ä¸ºâ€œActive/Unoptimizedâ€ã€‚</p>
<p>Step 7. ä¿å­˜è·¯å¾„çŠ¶æ€é…ç½®</p>
<p>ç£ç›˜çš„æ‰€æœ‰è·¯å¾„çŠ¶æ€ä¿®æ”¹å®Œæˆååœ¨ç•Œé¢ä¸Šå¹¶ä¸ä¼šç«‹åˆ»æ›´æ–°ï¼Œéœ€è¦å•å‡»MPIOç­–ç•¥é…ç½®ç•Œé¢â€œOKâ€æŒ‰é’®ä¿å­˜é…ç½®ï¼Œå¹¶é‡æ–°æ‰“å¼€MPIOç­–ç•¥é…ç½®ç•Œé¢æŸ¥çœ‹æ›´æ”¹æ˜¯å¦ç”Ÿæ•ˆã€‚</p>
<p><br></p>
<p><strong>mpclaim å‘½ä»¤</strong></p>
<p>æè¿°:åœ¨cmdä¸‹é¢ä¹Ÿå¯ä»¥å¯¹MPIOè¿›è¡Œç®¡ç†åœ¨ä½¿ç”¨å‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰å®‰è£…çš„features</span></span><br><span class="line">dism /online /get-features</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¿€æ´»MPIO</span></span><br><span class="line">dism /online /<span class="built_in">enable</span>-feature:MultipathIo</span><br><span class="line"></span><br><span class="line"><span class="comment"># å–æ¶ˆæ¿€æ´»MPIO</span></span><br><span class="line">dism /online /<span class="built_in">disable</span>-feature:MultipathIo</span><br></pre></td></tr></table></figure>
<p>åŸºç¡€ç¤ºä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹Microsoft DSM ç®¡ç†çš„å­˜å‚¨è®¾å¤‡</span></span><br><span class="line">mpclaim -r</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç³»ç»Ÿå‘ç°çš„å­˜å‚¨è®¾å¤‡</span></span><br><span class="line">mpclaim -e</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨MPIOç®¡ç†æ‰€æœ‰å­˜å‚¨è®¾å¤‡</span></span><br><span class="line">mpclaim.exe -r -i -a <span class="string">""</span></span><br><span class="line"><span class="comment"># å»æ‰MPIOå¯¹æ‰€æœ‰è®¾å¤‡çš„ç®¡ç†</span></span><br><span class="line">mpclaim.exe -r -u -a <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨MPIOç®¡ç†å…‰çº¤é€šé“è®¾å¤‡</span></span><br><span class="line">mpclaim.exe -r -i -d &lt;_VendorID&gt; &lt;_ProductID&gt;</span><br><span class="line"><span class="comment"># å»é™¤MPIOå¯¹å…‰çº¤é€šé“è®¾å¤‡çš„ç®¡ç†</span></span><br><span class="line">mpclaim.exe -r -u -d &lt;_VendorID&gt; &lt;_ProductID&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨MPIOç®¡ç† iSCSI è®¾å¤‡</span></span><br><span class="line">mpclaim -r -i -d <span class="string">"MSFT2005iSCSIBusType_0x9"</span></span><br><span class="line"><span class="comment">#å»æ‰MPIOå¯¹iSCSIè®¾å¤‡çš„ç®¡ç†</span></span><br><span class="line">mpclaim.exe -r -u -d <span class="string">"MSFT2005iSCSIBusType_0x9"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹è´Ÿè½½å¹³è¡¡ç­–ç•¥</span></span><br><span class="line">mpclaim.exe â€“L â€“M &lt;_num&gt;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>æ³¨æ„äº‹é¡¹:</strong></p>
<ul>
<li><p>Windows MPIOå¤šè·¯å¾„è½¯ä»¶æ”¯æŒæ¯ä¸ªLunçš„æœ€å¤§è·¯å¾„æ•°ä¸º32ä¸ª(å»ºè®®æ¯ä¸ªLunçš„è·¯å¾„æ•°ä¸å¤§äº32æ¡)ï¼Œå¤§äº32æ¡è·¯å¾„ä¼šå¯¼è‡´Windows ä¸»æœºç³»ç»Ÿè“å±ã€‚</p>
</li>
<li><p>å¯¹äºä¸æ”¯æŒALUAçš„å­˜å‚¨ï¼Œè¯·æŒ‰ç…§â€œå…³é—­ALUAâ€çš„æ–¹å¼æ¥é…ç½®MPIOç­–ç•¥ã€‚</p>
</li>
<li><p>VendorIDéœ€è¦ä¸º8ä½å­—èŠ‚ï¼ŒProductIDä¸º16ä½å­—èŠ‚ï¼Œä¸è¶³çš„ä»¥ç©ºæ ¼å¡«å……ã€‚</p>
</li>
<li>ä¿®æ”¹è´Ÿè½½å¹³è¡¡ç­–ç•¥å‘½ä»¤ä¸­çš„numå‚æ•°ä»£è¡¨çš„æ„æ€è§è¡¨</li>
</ul>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Clear the Policy   -  æ˜ç¡®çš„æ”¿ç­–</td>
</tr>
<tr>
<td>1</td>
<td>Failover Only  - æ•…éšœè½¬ç§»</td>
</tr>
<tr>
<td>2</td>
<td>Round Robin  - å¾ªç¯</td>
</tr>
<tr>
<td>3</td>
<td>Round Robin with  Subset  - å­é›†å¾ªç¯</td>
</tr>
<tr>
<td>4</td>
<td>Least Queue Depth  - è‡³å°‘é˜Ÿåˆ—æ·±åº¦</td>
</tr>
<tr>
<td>5</td>
<td>Weighted Paths   -åŠ æƒè·¯å¾„</td>
</tr>
<tr>
<td>6</td>
<td>Least Blocks  - è‡³å°‘å—</td>
</tr>
<tr>
<td>7</td>
<td>Vendor Specific - ç‰¹å®šäºä¾›åº”å•†çš„</td>
</tr>
</tbody>
</table>
<hr>
<h4 id="0x02-å…¥å‘è§£å†³"><a href="#0x02-å…¥å‘è§£å†³" class="headerlink" title="0x02 å…¥å‘è§£å†³"></a>0x02 å…¥å‘è§£å†³</h4><p>é—®é¢˜1.åœ¨æœªè¿›è¡Œå¤šè·¯å¾„è®¾å¤‡æŒ‚è½½æ—¶å€™æ˜¾ç¤ºailed ready running<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$multipath</span> -ll</span><br><span class="line"><span class="comment"># k8slog (36000d3100366e6000000000000000020) dm-1 COMPELNT,Compellent Vol</span></span><br><span class="line"><span class="comment"># size=1.0T features='1 queue_if_no_path' hwhandler='1 alua' wp=rw</span></span><br><span class="line"><span class="comment"># `-+- policy='service-time 0' prio=25 status=active</span></span><br><span class="line"><span class="comment">#   |- 5:0:0:2 sdc 8:32 failed ready running  # å…³é”®ç‚¹</span></span><br><span class="line"><span class="comment">#   `- 5:0:1:2 sde 8:64 active ready running</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å†³åŠæ³•</span></span><br><span class="line"><span class="variable">$mount</span> /dev/mapper/k8slog /mnt/nfs/k8slog/  <span class="comment"># å…³é”®ç‚¹</span></span><br><span class="line"><span class="variable">$multipath</span> -ll</span><br><span class="line"><span class="comment"># k8slog (36000d3100366e6000000000000000020) dm-1 COMPELNT,Compellent Vol</span></span><br><span class="line"><span class="comment"># size=1.0T features='1 queue_if_no_path' hwhandler='1 alua' wp=rw  </span></span><br><span class="line"><span class="comment"># `-+- policy='service-time 0' prio=25 status=active # å…³é”®ç‚¹</span></span><br><span class="line"><span class="comment">#   |- 5:0:0:2 sdc 8:32 active ready running</span></span><br><span class="line"><span class="comment">#   `- 5:0:1:2 sde 8:64 active ready running</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>é—®é¢˜2.è™šæ‹Ÿæœºå®‰è£…ubuntu20.04åï¼ŒæŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼Œå¤§é‡çš„ä»¥ä¸‹é”™è¯¯ä¿¡æ¯ã€‚æ’æŸ¥åå‘ç°æ˜¯multipath çš„é…ç½®é—®é¢˜ï¼Œéœ€è¦æ’é™¤æœ¬åœ°çš„sdaç£ç›˜<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é—®é¢˜ä¿¡æ¯</span></span><br><span class="line">Jun 13 14:31:12 multipathd[615]: sda: add missing path</span><br><span class="line">Jun 13 14:31:12 multipathd[615]: sda: failed to get udev uid: Invalid argument</span><br><span class="line">Jun 13 14:31:12 multipathd[615]: sda: failed to get sysfs uid: Invalid argument</span><br><span class="line">Jun 13 14:31:12 multipathd[615]: sda: failed to get sgio uid: No such file or directory</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å†³æµç¨‹æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œsdaè§†æœ¬åœ°ç¯å¢ƒåšè°ƒæ•´ç„¶åé‡å¯æœåŠ¡å³å¯ã€‚</span></span><br><span class="line">sudo vi /etc/multipath.conf</span><br><span class="line">blacklist &#123;</span><br><span class="line">  devnode <span class="string">"^sda"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sudo service multipath-tools restart</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="0x03-å‚è€ƒè¿æ¥"><a href="#0x03-å‚è€ƒè¿æ¥" class="headerlink" title="0x03 å‚è€ƒè¿æ¥"></a>0x03 å‚è€ƒè¿æ¥</h4><ul>
<li><a href="http://www.voidcn.com/article/p-dbvqeerl-bmp.html" target="_blank" rel="noopener">http://www.voidcn.com/article/p-dbvqeerl-bmp.html</a></li>
</ul>

        </div>
        <!-- Google å¹¿å‘Š -->
          

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-03-29T05:39:06.314Z" itemprop="dateUpdated">2022-03-29 13:39:06</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/åŸºç¡€çŸ¥è¯†/æœºå™¨ç¡¬ä»¶/Storage/Multipathå¤šè·¯å¾„ç®¡ç†åŸºç¡€ä»‹ç»ä¸å®‰è£…é…ç½®ä½¿ç”¨.md" target="_blank" rel="noopener noreferrer">_posts/åŸºç¡€çŸ¥è¯†/æœºå™¨ç¡¬ä»¶/Storage/Multipathå¤šè·¯å¾„ç®¡ç†åŸºç¡€ä»‹ç»ä¸å®‰è£…é…ç½®ä½¿ç”¨.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2019/12-26-34.html" target="_blank" rel="external">https://blog.weiyigeek.top/2019/12-26-34.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Multipath/" rel="tag">Multipath</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/12-26-34.html&title=ã€ŠMultipathå¤šè·¯å¾„ç®¡ç†åŸºç¡€ä»‹ç»ä¸å®‰è£…é…ç½®ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/12-26-34.html&title=ã€ŠMultipathå¤šè·¯å¾„ç®¡ç†åŸºç¡€ä»‹ç»ä¸å®‰è£…é…ç½®ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/12-26-34.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠMultipathå¤šè·¯å¾„ç®¡ç†åŸºç¡€ä»‹ç»ä¸å®‰è£…é…ç½®ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/12-26-34.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/12-26-34.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/12-26-647.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">PSå‘½ä»¤ä¹‹ä¸­ç³»ç»Ÿæ—¥å¿—ç›¸å…³ä¿¡æ¯æŸ¥çœ‹ä¸ç®¡ç†</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/12-26-219.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">DELLæœåŠ¡å™¨iDRACè¿œç¨‹è®¿é—®ç®¡ç†æ§åˆ¶å°ä½¿ç”¨</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x00-å‰è¨€ç®€è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å‰è¨€ç®€è¿°</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x01-Multipath-ç®¡ç†"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 Multipath ç®¡ç†</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x02-å…¥å‘è§£å†³"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 å…¥å‘è§£å†³</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x03-å‚è€ƒè¿æ¥"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 å‚è€ƒè¿æ¥</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    


    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      

    <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
    
      <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
        
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/search-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/12-26-34.html&title=ã€ŠMultipathå¤šè·¯å¾„ç®¡ç†åŸºç¡€ä»‹ç»ä¸å®‰è£…é…ç½®ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/12-26-34.html&title=ã€ŠMultipathå¤šè·¯å¾„ç®¡ç†åŸºç¡€ä»‹ç»ä¸å®‰è£…é…ç½®ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/12-26-34.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠMultipathå¤šè·¯å¾„ç®¡ç†åŸºç¡€ä»‹ç»ä¸å®‰è£…é…ç½®ä½¿ç”¨ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/12-26-34.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/12-26-34.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACNklEQVR42u3ay47iMBAFUP7/pxlpVkhMwr3ldGtwjlcIQuLTLRX18OMRr+ff9fr6/Z38ytd33p9y9OkFCwMD42sZz9N1dM37ps/veb7d5A9xfk8MDIw7MNoge/74JHAn90mux8DAwDi6JgnHsxCMgYGBcRXjnDdjY2BgYJwzkiI2D6BJmM4D7sW1OAYGxhcyZoOB33n94/MNDAyM/57xLNdskNA24OpdYWBgbM2YtbraBDFJDWfRtcguMTAwvpaRB9M2H8ubcRcc18DAwLgBoz1a0Ybm9ad8GCpgYGBszWgPUsw2l+DbsP6Pb2FgYGzKyA86tGVqDmuL2w+nRTAwMLZjLDXiZ729GFwPHjAwMDZltKPHqJgsm2v5p4f7wcDA2JqRl6Oz9v1Vrbq63YaBgbERIxkTrhznmt2tbeRhYGDszWjTwVlrrC1N68MWGBgYN2CshMWV0WY+AGgTVgwMjP0YScNr/WjFVSPP6D+AgYGxESNv6K+32NbHBh/abRgYGJsy8oLzqhCcRMh8kICBgXEHRpvAzRK72d0KEgYGxm0YbVN+Vpq2LbyonYeBgbE1I1/XpnqPhdW28zAwML6d8SzX7EhE0oBry9cPvxsYGBgbMWYBN9/Q7NhEPlLFwMC4DyMPsjmmHTnkvEMkBgbGDRhJCboysMwZbTmNgYGB0RarbQY6a95hYGBgrLfV1kcILR4DA+MOjLyIXRlGtklhcRAEAwNja8ZS6Rhf0z6ybfxhYGBsyvgDdvb+9TGzStoAAAAASUVORK5CYII=" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// ç«™ç‚¹è¿è¡Œæ—¶é—´
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + "å¤©" + RunHours + "æ—¶" + RunMinutes + "åˆ†" + RunSeconds + "ç§’";
  document.getElementById(id).innerHTML = "ç½‘ç«™å·²åœ¨é£é›¨ä¸­å‹‰å‹‰å¼ºå¼ºè¿è¡Œäº†ã€" + RunTime + "ã€‘";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
</body>
</html>