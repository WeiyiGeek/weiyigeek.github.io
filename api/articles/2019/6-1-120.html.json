{"title":"运维之LNMP环境安装与配置","slug":"系统运维/Application/Web/LNMP/运维之LNMP环境安装与配置","date":"2019-06-01T05:34:30.000Z","updated":"2023-01-31T02:29:10.469Z","url":"2019/6-1-120.html","path":"api/articles/2019/6-1-120.html.json","covers":["https://img.weiyigeek.top/2020/1/20200305224453.png","https://img.weiyigeek.top/2020/1/20200305223525.png","https://img.weiyigeek.top/2020/1/20200305162415.png","https://img.weiyigeek.top/2020/1/20200305121626.png","https://img.weiyigeek.top/2020/1/20200305224619.png","https://img.weiyigeek.top/2020/1/20200305222624.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-快速入门\"><a href=\"#0x00-快速入门\" class=\"headerlink\" title=\"0x00 快速入门\"></a>0x00 快速入门</h4><p>描述:1）LNMP是目前互联网主流的WEB服务器架构，主要是由<code>Linux+Nginx+MYSQL|Mariadb+PHP</code>组合，可以发布企业门户网站代码（PHP动态网页），运维人员要能够独立构建LNMP平台。</p>\n<ul>\n<li>Nginx 是一个web服务器和代理服务器(其功能是负载均衡，正反向代理)</li>\n<li>Mysql 是一个关系型数据库已经被Oracle收购</li>\n<li>php-fpm 是一个FastCGI Process Manager(FastCGI进程管理器)</li>\n</ul>\n<p>在Linux中安装软件常见的三种方式就是<code>yum安装、rpm包或者源码</code>编译安装;</p>\n<hr>\n\n<h4 id=\"0x01-YUM手动安装LNMP\"><a href=\"#0x01-YUM手动安装LNMP\" class=\"headerlink\" title=\"0x01 YUM手动安装LNMP\"></a>0x01 YUM手动安装LNMP</h4><p>安装环境：Centos 7<br>安装方法：yum</p>\n<p>Step 1.安装LNMP之前要安装EPEL，以便安装源以外的软件，如Nginx，phpMyAdmin等。<br>提示：EPEL即Extra Packages for Enterprise Linux，企业版linux附加包;这个软件仓库里有很多非常常用的软件,而且是专门针对RHEL设计的，对RHEL标准yum源是一个很好的补充，完全免费使用，由Fedora项目维护，所以如果你使用的是RHEL，或者CentOS，Scientific等RHEL系的linux，可以非常放心的使用EPEL的yum源。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum update -y &amp;&amp; yum upgrade -y</span><br><span class=\"line\">yum install epel-release</span><br></pre></td></tr></table></figure><br><br></p>\n<p>Step 2.yum update<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install nginx </span><br><span class=\"line\">systemctl start nginx <span class=\"comment\">#启动nginx </span></span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> nginx <span class=\"comment\">#设置开机启动</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p>Step 3.安装PHP<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y php php-devel php-fpm php-mysql php-common php-devel php-gd libjpeg* php-imap php-ldap php-odbc php-pear php-xml php-xmlrpc php-mbstring php-mcrypt php-bcmath php-mhash libmcrypt libmcrypt-devel</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p>Step 4.开启php-fpm<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start php-fpm <span class=\"comment\">#开启php-fpm </span></span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> php-fpm <span class=\"comment\">#开机自动启动</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p>Step 5.安装mysql<br>CentOS 7的yum源中貌似没有正常安装mysql时的mysql-sever文件，需要去官网上下载（也可以参照网站上的）<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># wget http:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;mysql-community-release-el7-5.noarch.rpm</span><br><span class=\"line\"># rpm -ivh mysql-community-release-el7-5.noarch.rpm</span><br><span class=\"line\"># yum install mysql-community-server</span><br></pre></td></tr></table></figure><br>成功安装之后重启mysql服务<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># service mysqld restart</span></span><br><span class=\"line\">初次安装mysql是root账户是没有密码的设置密码的方法</span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\"># mysql -uroot</span></span><br><span class=\"line\">mysql&gt; <span class=\"built_in\">set</span> password <span class=\"keyword\">for</span> <span class=\"string\">'root'</span>@<span class=\"string\">'localhost'</span> = password(<span class=\"string\">'mypasswd'</span>);</span><br><span class=\"line\">mysql&gt; <span class=\"built_in\">exit</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p>Step 6.配置PHP/nginx参数</p>\n<ul>\n<li><p>A) 修改php.ini的配置</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/php.ini </span><br><span class=\"line\">cgi.fix_pathinfo=1 <span class=\"comment\">#将注释去掉，开启PHP的pathinfo伪静态功能。</span></span><br><span class=\"line\">max_execution_time = 0  <span class=\"comment\">#脚本运行的最长时间，默认30秒</span></span><br><span class=\"line\">max_input_time = 300 <span class=\"comment\">#脚本可以消耗的时间，默认60秒</span></span><br><span class=\"line\">memory_limit = 256M <span class=\"comment\">#脚本运行最大消耗的内存，根据你的需求更改数值，默认128M</span></span><br><span class=\"line\">post_max_size = 100M  <span class=\"comment\">#单提交的最大数据，此项不是限制上传单个文件的大小,而是针对整个表单的提交数据进行限制的。限制范围包括表单提交的所有内容.例如:发表贴子时,贴子标题,内容,附件等…默认8M</span></span><br><span class=\"line\">upload_max_filesize = 10M <span class=\"comment\">#上载文件的最大许可大小 ，默认2M</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>B) 修改php-fpm的配置</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/php-fpm.d/www.conf </span><br><span class=\"line\"><span class=\"comment\">#找到以下两行，解除注释 </span></span><br><span class=\"line\">listen.owner = nobody </span><br><span class=\"line\">listen.group = nobody </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#找下以下两行，将各自的apache改为nginx </span></span><br><span class=\"line\">user = apache -&gt; user = nginx </span><br><span class=\"line\">group = apache -&gt; group = nginx</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>C) 修改nginx的配置</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/nginx/conf.d/default.conf  </span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">  listen       80;</span><br><span class=\"line\">  server_name  服务器IP或者域名;</span><br><span class=\"line\">  root   /usr/share/nginx/html;</span><br><span class=\"line\">  location / &#123;</span><br><span class=\"line\">    root   /usr/share/nginx/html;</span><br><span class=\"line\">    index index.php index.html index.htm;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  error_page  404              /404.html;</span><br><span class=\"line\">  <span class=\"comment\"># redirect server error pages to the static page /50x.html  </span></span><br><span class=\"line\">  error_page   500 502 503 504  /50x.html;</span><br><span class=\"line\">  location = /50x.html &#123;</span><br><span class=\"line\">      root   /usr/share/nginx/html;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">#支持php解析</span></span><br><span class=\"line\">  location ~ \\.php$ &#123;</span><br><span class=\"line\">      root           /usr/share/nginx/html;</span><br><span class=\"line\">      try_files <span class=\"variable\">$uri</span> = 404;</span><br><span class=\"line\">      fastcgi_pass   127.0.0.1:9000;</span><br><span class=\"line\">      fastcgi_index  index.php;</span><br><span class=\"line\">      fastcgi_param  SCRIPT_FILENAME  <span class=\"variable\">$document_root</span><span class=\"variable\">$fastcgi_script_name</span>;</span><br><span class=\"line\">      include        fastcgi_params;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<p>Step 7.调试<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#查找配置</span></span><br><span class=\"line\">find / -name nginx.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#查看PHP-FPM 监听9000 端口正常</span></span><br><span class=\"line\"><span class=\"variable\">$netstat</span> -npa | grep 9000 </span><br><span class=\"line\">tcp 0 0 127.0.0.1:9000 0.0.0.0:* LISTEN 2142/php-fpm: maste</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#改变目录的组和用户</span></span><br><span class=\"line\">chown nginx.nginx modules/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#修改目录下所有文件所属</span></span><br><span class=\"line\">chown -R nginx.nginx html</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#修改目录下所有文件权限</span></span><br><span class=\"line\">chmod -R 777 html</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p>8.安装phpmyadmin<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a) wget https://files.phpmyadmin.net/phpMyAdmin/4.4.12/phpMyAdmin-4.4.12-all-languages.zip </span><br><span class=\"line\">b) unzip phpMyAdmin-4.4.12-all-languages.zip </span><br><span class=\"line\">c) mv phpMyAdmin-4.4.12-all-languages /usr/share/nginx/html/phpmyadmin</span><br><span class=\"line\">d) chown -R nginx.nginx /var/lib/php/session</span><br></pre></td></tr></table></figure></p>\n<p>注：/usr/share/nginx/html/为网站跟目录，我采用Docker进行安装Centos进行验证的</p>\n<p><br/></p>\n<h4 id=\"0x02-源码编译安装LNMP\"><a href=\"#0x02-源码编译安装LNMP\" class=\"headerlink\" title=\"0x02 源码编译安装LNMP\"></a>0x02 源码编译安装LNMP</h4><p>描述:基于手工MAKE源码方式构建LNMP WEB平台，操作步骤、指令非常的繁琐，如果企业要求快速、高效的配置平台，通过手工操作会消耗大量的人力成本，可以引入SHELL编程自动化实现。流程步骤如下:</p>\n<ul>\n<li>Nginx官网下载Nginx软件包&amp;解压&amp;编译&amp;安装；</li>\n<li>MYSQL官网下载MYSQL软件包&amp;解压&amp;编译&amp;安装；</li>\n<li>PHP官网下载PHP软件包&amp;解压&amp;编译&amp;安装；</li>\n<li>LNMP配置文件整合，创建PHPinfo测试页面&amp;访问。</li>\n</ul>\n<p>变量定义说明:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## Define nginx variable</span></span><br><span class=\"line\">NGX_VER=1.17.9</span><br><span class=\"line\">NGX_URI=<span class=\"string\">\"http://nginx.org/download/nginx-<span class=\"variable\">$&#123;NGX_VER&#125;</span>.tar.gz\"</span></span><br><span class=\"line\">NGX_NAME=<span class=\"string\">\"nginx-<span class=\"variable\">$&#123;NGX_VER&#125;</span>.tar.gz\"</span></span><br><span class=\"line\">NGX_SRC=<span class=\"string\">\"<span class=\"variable\">$&#123;NGX_NAME%.tar.gz&#125;</span>\"</span></span><br><span class=\"line\">NGX_DIR=<span class=\"string\">\"/usr/local/nginx/<span class=\"variable\">$&#123;NGX_VER&#125;</span>\"</span></span><br><span class=\"line\">NGX_ARGS=<span class=\"string\">\"--user=nginx --group=nginx --with-http_stub_status_module\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## Define php-fpm variable</span></span><br><span class=\"line\">PHP_VER=7.4.3</span><br><span class=\"line\">PHP_SOFT=<span class=\"string\">\"php-<span class=\"variable\">$&#123;PHP_VER&#125;</span>.tar.bz2\"</span></span><br><span class=\"line\">PHP_URL=<span class=\"string\">\"http://mirrors.sohu.com/php/<span class=\"variable\">$&#123;PHP_SOFT&#125;</span>\"</span></span><br><span class=\"line\">PHP_SRC=<span class=\"variable\">$&#123;PHP_SOFT%.tar.bz2&#125;</span></span><br><span class=\"line\">PHP_DIR=<span class=\"string\">\"/usr/local/php/<span class=\"variable\">$&#123;PHP_VER&#125;</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## Define Mysql-Boost variable</span></span><br><span class=\"line\">MYSQL_VER=5.7.29</span><br><span class=\"line\">MYSQL_NAME=<span class=\"string\">\"mysql-boost-<span class=\"variable\">$&#123;MYSQL_VER&#125;</span>.tar.gz\"</span></span><br><span class=\"line\">MYSQL_URL=<span class=\"string\">\"http://mirrors.163.com/mysql/Downloads/MySQL-<span class=\"variable\">$&#123;MYSQL_VER%.*&#125;</span>/mysql-boost-<span class=\"variable\">$&#123;MYSQL_VER&#125;</span>\"</span></span><br><span class=\"line\">MYSQL_SRC=<span class=\"string\">\"<span class=\"variable\">$&#123;MYSQL_NAME%.tar.gz&#125;</span>\"</span></span><br><span class=\"line\">MYSQL_DIR=<span class=\"string\">\"/usr/local/mysql/<span class=\"variable\">$&#123;MYSQL_VER&#125;</span>\"</span></span><br><span class=\"line\">MYSQL_DATADIR=<span class=\"string\">\"/data/mysql/db\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## Define GCC Variable</span></span><br><span class=\"line\">GCC_VER=5.5.0</span><br><span class=\"line\">GCC_NAME=<span class=\"string\">\"gcc-<span class=\"variable\">$&#123;GCC_VER&#125;</span>\"</span></span><br><span class=\"line\">GCC_SRC=<span class=\"string\">\"<span class=\"variable\">$&#123;GCC_VER&#125;</span>.tar.xz\"</span></span><br><span class=\"line\">GCC_URL=<span class=\"string\">\"http://ftp.tsukuba.wide.ad.jp/software/gcc/releases/<span class=\"variable\">$&#123;GCC_NAME&#125;</span>/gcc-5.5.0.tar.xz\"</span></span><br></pre></td></tr></table></figure></p>\n<p>软件包说明:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$ls</span> /opt/LNMP/*.tar.gz</span><br><span class=\"line\">/opt/LNMP/mysql-5.7.29.tar.gz  </span><br><span class=\"line\">/opt/LNMP/mysql-boost-5.7.29.tar.gz <span class=\"comment\">#推荐下载此版本</span></span><br><span class=\"line\">/opt/LNMP/mysql-8.0.19.tar.gz  </span><br><span class=\"line\">/opt/LNMP/nginx-1.17.9.tar.gz</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h5 id=\"Nginx\"><a href=\"#Nginx\" class=\"headerlink\" title=\"Nginx\"></a>Nginx</h5><p>Nginx 安装Shell脚本:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## [ 安装 nginx ]</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">nginx_install</span></span>()&#123;</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m 安装Nginx中..... \\e[0m\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    CHECK_NUM=$(rpm -qa|grep -wcE <span class=\"string\">\"gcc|pcre-devel\"</span>)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ <span class=\"variable\">$CHECK_NUM</span> -lt 2 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    yum install -y wget gzip tar make gcc</span><br><span class=\"line\">    yum install -y pcre pcre-devel zlib zlib-devel</span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">    CHECK_USER=$(getent passwd | grep -wc nginx)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ <span class=\"variable\">$CHECK_USER</span> -eq 0 ];<span class=\"keyword\">then</span> useradd -s /sbin/nologin nginx -M; <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ ! -f <span class=\"variable\">$NGX_NAME</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        wget <span class=\"variable\">$NGX_URI</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[31m#Messge: Nginx 已存在 无需下载 \\e[0m\"</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ ! -d <span class=\"variable\">$NGX_SRC</span> ];<span class=\"keyword\">then</span> tar -zxf <span class=\"variable\">$NGX_NAME</span>; <span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ ! -d <span class=\"variable\">$NGX_DIR</span> ];<span class=\"keyword\">then</span> mkdir -p <span class=\"variable\">$NGX_DIR</span>; <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">cd</span> <span class=\"variable\">$NGX_SRC</span> &amp;&amp; ./configure --prefix=<span class=\"variable\">$NGX_DIR</span> <span class=\"variable\">$NGX_ARGS</span> </span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ $? -eq 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    make &amp;&amp; make install</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[31m#Error: 编译失败!终止安装 \\e[0m\"</span></span><br><span class=\"line\">        <span class=\"built_in\">exit</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#echo -e \"\\e[32m#Messge: Nginx安装成功正在进行防火墙设置 \\e[0m\"</span></span><br><span class=\"line\">    <span class=\"comment\">#fireall_set nginx</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m#Messge: 正在启动 Nginx \\e[0m\"</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ ! -f /usr/bin/nginx ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        ln -s <span class=\"variable\">$NGX_DIR</span>/sbin/nginx /usr/bin/nginx</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"variable\">$NGX_DIR</span>/sbin/nginx</span><br><span class=\"line\"></span><br><span class=\"line\">    CHECK_STATUS=$(netstat -tlnp | grep -wc <span class=\"string\">\"nginx\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ <span class=\"variable\">$CHECK_STATUS</span> -ne 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m#Nginx 启动成功.... \\e[0m\"</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[31m#Nginx 启动失败.... \\e[0m\"</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h5 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h5><p>MySQL 安装Shell脚本:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">## [ 安装 mysql ]</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">mysql_install</span></span>()&#123;</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m 安装Mysql及其yum 依赖安装中..... \\e[0m\"</span></span><br><span class=\"line\">    yum install -y gcc.x86_64 gcc-c++.x86_64 make perl autoconf openssl* ncurses ncurses-devel bison bison-devel xz -y </span><br><span class=\"line\">  yum install -y automake zlib libxml2 libxml2-devel libgcrypt libtool bison</span><br><span class=\"line\">    <span class=\"comment\"># 验证系统中mariadb版本</span></span><br><span class=\"line\">    <span class=\"comment\"># CHECK_MARIADB=$(rpm -qa | grep -w mariadb)</span></span><br><span class=\"line\">    <span class=\"comment\"># if [ $CHECK_MARIADB != \"\" ];then</span></span><br><span class=\"line\">    <span class=\"comment\">#     rpm -e $CHECK_MARIADB</span></span><br><span class=\"line\">    <span class=\"comment\"># fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># MySQL 8.X 需要环境准备gcc 5.0 (还是推荐二进制的吧)</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ ! -f <span class=\"variable\">$&#123;GCC_SRC&#125;</span> -a <span class=\"variable\">$&#123;MYSQL_VER%.*.*&#125;</span> == <span class=\"string\">\"8\"</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"comment\">#yum install -y cmake3 </span></span><br><span class=\"line\">        <span class=\"comment\">#wget $GCC_URL</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">\"由于8.x需要安装更高版本的GCC暂时放弃\"</span></span><br><span class=\"line\">        <span class=\"built_in\">exit</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"string\">\"#当前 MySQL 版本 无需安装高版本的 cmake 以及 gcc\"</span></span><br><span class=\"line\">        yum install -y cmake &amp;&amp; cmake --version</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    CHECK_USER=$(getent passwd | grep -wc mysql)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ <span class=\"variable\">$CHECK_USER</span> -eq 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        useradd -s /sbin/nologin mysql -M</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">\"MySQL用户已添加\"</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ ! -f <span class=\"variable\">$MYSQL_NAME</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        wget <span class=\"variable\">$MYSQL_URL</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m#Messge: MySQL 已存在 无需下载 \\e[0m\"</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ ! -d <span class=\"variable\">$MYSQL_SRC</span> ];<span class=\"keyword\">then</span> tar -zxf <span class=\"variable\">$MYSQL_NAME</span>; <span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ ! -d <span class=\"variable\">$MYSQL_DATADIR</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        mkdir -p <span class=\"variable\">$MYSQL_DATADIR</span></span><br><span class=\"line\">        mkdir -p /data/mysql/tmp/</span><br><span class=\"line\">        chown -R mysql.mysql /data</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ ! -f <span class=\"variable\">$MYSQL_DIR</span>/bin/mysqld ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        mkdir -p <span class=\"variable\">$MYSQL_DIR</span></span><br><span class=\"line\">        <span class=\"built_in\">cd</span> <span class=\"variable\">$MYSQL_SRC</span> &amp;&amp; cmake . -DWITH_BOOST=./boost -DCMAKE_INSTALL_PREFIX=<span class=\"variable\">$MYSQL_DIR</span>/ -DSYSCONFDIR=/etc/my.cnf -DSYSTEMD_PID_DIR=<span class=\"variable\">$MYSQL_DATADIR</span>/ -DMYSQL_UNIX_ADDR=/tmp/mysql.sock -DMYSQL_DATADIR=<span class=\"variable\">$MYSQL_DATADIR</span>/ -DMYSQL_USER=mysql -DMYSQL_TCP_PORT=3306 -DMYSQLX_TCP_PORT=33060 -DTMPDIR=<span class=\"variable\">$MYSQL_DATADIR</span>/tmp/ -DWITH_XTRADB_STORAGE_ENGINE=1 -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_PARTITION_STORAGE_ENGINE=1 -DWITH_BLACKHOLE_STORAGE_ENGINE=1 -DWITH_MYISAM_STORAGE_ENGINE=1 -DWITH_JEMALLOC=1 -DMAX_INDEXES=64 -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> [ $? -eq 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"comment\">#安装编译时候不建议使用 make -j 4 ，虽然安装快但是可能影响程序的完整性;</span></span><br><span class=\"line\">        make &amp;&amp; make install</span><br><span class=\"line\">        ln -s <span class=\"variable\">$MYSQL_DIR</span>/bin/* /usr/bin/</span><br><span class=\"line\">        <span class=\"keyword\">else</span>  </span><br><span class=\"line\">            <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[31m#Error: 编译失败,终止安装.... \\e[0m\"</span></span><br><span class=\"line\">            <span class=\"built_in\">exit</span></span><br><span class=\"line\">        <span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ $? -eq 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m#MySQL 安装成功 .....\\e[0m\"</span></span><br><span class=\"line\">        cp /etc/my.cnf /etc/my.cnf.bak</span><br><span class=\"line\">cat &gt; /etc/my.cnf&lt;&lt;END</span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">datadir=/data/mysql/db/</span><br><span class=\"line\">socket=/tmp/mysql.sock</span><br><span class=\"line\">symbolic-links=0</span><br><span class=\"line\">default_authentication_plugin=mysql_native_password</span><br><span class=\"line\">character-set-server=utf8</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld_safe]</span><br><span class=\"line\"><span class=\"built_in\">log</span>-error=/data/mysql/db/error.log</span><br><span class=\"line\">pid-file=/data/mysql/db/mysql.pid</span><br><span class=\"line\">END</span><br><span class=\"line\">        <span class=\"built_in\">cd</span> <span class=\"variable\">$MYSQL_DIR</span>/</span><br><span class=\"line\">        cp support-files/mysql.server /etc/init.d/mysqld</span><br><span class=\"line\">        chmod +x /etc/init.d/mysqld</span><br><span class=\"line\">        chkconfig --add mysqld</span><br><span class=\"line\">        chkconfig --level 35 mysqld on</span><br><span class=\"line\">        service  mysqld stop</span><br><span class=\"line\">        sed -i <span class=\"string\">\"s#^basedir=#basedir=<span class=\"variable\">$&#123;MYSQL_DIR&#125;</span>#g\"</span> /etc/init.d/mysqld</span><br><span class=\"line\">        sed -i <span class=\"string\">\"s#^datadir=#datadir=<span class=\"variable\">$&#123;MYSQL_DATADIR&#125;</span>/#g\"</span> /etc/init.d/mysqld</span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m##MySQL单机多实例初始化......\\e[0m'\"</span></span><br><span class=\"line\">        <span class=\"comment\">#--initialize-insecure  不安全即密码为空</span></span><br><span class=\"line\">        ./bin/mysqld --initialize --user=mysql --basedir=<span class=\"variable\">$MYSQL_DIR</span> --datadir=<span class=\"variable\">$MYSQL_DATADIR</span></span><br><span class=\"line\">        <span class=\"comment\"># ./bin/mysqld_safe --defaults-file=/etc/my.cnf --basedir=/usr/local/mysql/5.7.29/ --user=mysql</span></span><br><span class=\"line\">        service mysqld start</span><br><span class=\"line\"></span><br><span class=\"line\">        CHECK_STATUS=$(netstat -tlnp | grep -wc <span class=\"string\">\"mysqld\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> [ <span class=\"variable\">$CHECK_STATUS</span> -ne 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">            <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m#MySQL 启动成功.... \\e[0m\"</span></span><br><span class=\"line\">            <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m#sql&gt; mysql -uroot -p'!/K+ak7*RAkR' --connect-expired-password &lt;&lt;EOF\\e[0\"</span></span><br><span class=\"line\">            <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m#alter user user() identified by 'WeiyiGeek' \\e[0\"</span></span><br><span class=\"line\">            <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m#EOF \\e[0\"</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[31m#MySQL 启动失败.... \\e[0m\"</span></span><br><span class=\"line\">        <span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>   </span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[31m#Error:安装失败，请检查报错....\\e[0m\"</span></span><br><span class=\"line\">        <span class=\"built_in\">exit</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m#Messge: MySQL安装成功正在进行防火墙设置 \\e[0m\"</span></span><br><span class=\"line\">    <span class=\"comment\">#fireall_set mysql</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> .</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200305224453.png\" alt=\"WeiyiGeek.PHP-fpm安装效果\" title=\"\" class=\"\">\n                <p>WeiyiGeek.PHP-fpm安装效果</p>\n            </figure></p>\n<p><br></p>\n<p>补充知识:<br><strong>(1) MySQL Boost编译包依赖</strong><br>描述:从MySQL 5.7.5版本开始依赖于Boost C++库，我们在安装编译的时候需要指定boost目录的路径<code>-DWITH_BOOST=/opt/mysql-8.0.15/boost/</code>，推荐下载含有Boost源码的源码包;<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200305223525.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p>下面主要描述自行安装boost的流程步骤:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1.YUM/RPM包方式安装boost</span></span><br><span class=\"line\">https://www.rpmfind.net/linux/rpm2html/search.php</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.官网进行安装(上面那种方式版本数量有限，不一定满足需求)</span></span><br><span class=\"line\">https://sourceforge.net/projects/boost/</span><br><span class=\"line\"><span class=\"comment\">#安装方式</span></span><br><span class=\"line\">tar -zxf boost.tar.gz &amp;&amp; <span class=\"built_in\">cd</span> ./boost</span><br><span class=\"line\">./bootstrap.sh --prefix=/usr/<span class=\"built_in\">local</span>/boost</span><br><span class=\"line\">./b2 install</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><em>注意事项:</em></p>\n<ul>\n<li>1.源码安装MySQL时候选择带boost源码的MySQL源码安装包进行安装<code>-DWITH_BOOST=./boost</code>，否则在编译时候在线下载<code>-DDOWNLOAD_BOOST=1 -DWITH_BOOST=/usr/local/boost/</code>(科学上网时选择否则您会知道什么叫做绝望);<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200305162415.png\" alt=\"WeiyiGeek.DDOWNLOAD_BOOST\" title=\"\" class=\"\">\n                <p>WeiyiGeek.DDOWNLOAD_BOOST</p>\n            </figure></li>\n<li>2.安装编译时候不建议使用 make -j 4 ，虽然安装快但是可能影响程序的完整性;</li>\n<li>3.如果想修改MySQL版本号的头文件，实际不建议进行修改<code>include/mysql_version.h.in</code>;</li>\n<li>4.MySQL 8.0 需要依赖 <code>cmake3</code> 可选 gcc 5.x(4.8.5经测试没有问题)，如果编译过程中产生错误<code>则清空CMakeCache.txt文件后解决对应错误</code>，重新编译即可。</li>\n<li>5.安装新版本的GCC后，为了保证原始的GCC可用把新版本做个软链接即可，并且可以在cmake编译参数里设置绝对路径<code>-DCMAKE_CXX_COMPILER=/usr/local/bin/g++ -DCMAKE_C_COMPILER=/usr/local/bin/gcc</code></li>\n<li>6.不同的MySQL版本依赖的最低Boost版本是不一样的需要在cmake编译前查看boost中<code>requires boost_1_xx_0</code>;</li>\n</ul>\n<p><br></p>\n<h5 id=\"PHP-FPM\"><a href=\"#PHP-FPM\" class=\"headerlink\" title=\"PHP-FPM\"></a>PHP-FPM</h5><p>描述: FPM(`FastCGI 进程管理器|FastCGI Process Manager)用于替换 PHP FastCGI 的大部分附加功能，对于高负载网站是非常有用的。<br>PHP 安装Shell脚本:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">php_install</span></span>()&#123;</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m#Message: 正在进行安装php环境..... \\e[0m\"</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ ! -f <span class=\"variable\">$PHP_SOFT</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        wget <span class=\"variable\">$PHP_URL</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">       <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m#Message: 源码文件已经存在无需重新下载 \\e[0m\"</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">    CHECK_USER=$(getent passwd | grep -wc <span class=\"string\">\"www\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ <span class=\"variable\">$CHECK_USER</span> -eq 0 ];<span class=\"keyword\">then</span> useradd -M -s/sbin/nologin www; <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">\"#PHP依赖安装\"</span></span><br><span class=\"line\">    yum install libxml2 libxml2-devel gzip bzip2 sqlite-devel -y</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ ! -d <span class=\"variable\">$PHP_SRC</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        tar jxf <span class=\"variable\">$PHP_SOFT</span></span><br><span class=\"line\">        mkdir -p <span class=\"variable\">$PHP_DIR</span></span><br><span class=\"line\">        mkdir -p /etc/php/</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">cd</span> <span class=\"variable\">$PHP_SRC</span> &amp;&amp; ./configure --prefix=<span class=\"variable\">$PHP_DIR</span> --with-config-file-path=<span class=\"variable\">$PHP_DIR</span>/php-config --with-pdo-mysql=mysqlnd --<span class=\"built_in\">enable</span>-mysqlnd --<span class=\"built_in\">enable</span>-fpm</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ $? -eq 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m#Message: PHP 编译成功正在执行make &amp;&amp; make install 安装操作 \\e[0m\"</span></span><br><span class=\"line\">        make &amp;&amp; make install</span><br><span class=\"line\">        ln -s <span class=\"variable\">$PHP_DIR</span>/etc/* /etc/php/</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[31m#Error: 编译失败终止安装.... \\e[0m\"</span></span><br><span class=\"line\">        <span class=\"built_in\">exit</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#配置 php-fpm 配置文件</span></span><br><span class=\"line\">    cp php.ini-development <span class=\"variable\">$PHP_DIR</span>/php.ini</span><br><span class=\"line\">  cp <span class=\"variable\">$PHP_DIR</span>/etc/php-fpm.conf.default <span class=\"variable\">$PHP_DIR</span>/etc/php-fpm.conf</span><br><span class=\"line\">    cp <span class=\"variable\">$PHP_DIR</span>/etc/php-fpm.d/www.conf.default <span class=\"variable\">$PHP_DIR</span>/etc/php-fpm.d/www.conf</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#由于下面需要使用systemctl来启动为了不动启动配置文件所以进行设置</span></span><br><span class=\"line\">    sed -i <span class=\"string\">'s#;error_log = log/php-fpm.log#error_log = /var/log/php-fpm.log'</span> <span class=\"variable\">$PHP_DIR</span>/etc/php-fpm.conf</span><br><span class=\"line\">    sed -i <span class=\"string\">'s#;pid = run/php-fpm.pid#pid = /var/run/php-fpm.pid'</span> <span class=\"variable\">$PHP_DIR</span>/etc/php-fpm.conf</span><br><span class=\"line\">    sed -i <span class=\"string\">'s#nobody#www#g'</span> <span class=\"variable\">$PHP_DIR</span>/etc/php-fpm.conf</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#方式1:配置/etc/init.d/进行启动</span></span><br><span class=\"line\">    cp sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm</span><br><span class=\"line\">  chmod o+x /etc/init.d/php-fpm</span><br><span class=\"line\">    service php-fpm restart</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#方式2:配置systectl启动</span></span><br><span class=\"line\">    cp sapi/fpm/php-fpm.service /usr/lib/systemd/user/php-fpm.servic</span><br><span class=\"line\">    systemctl daemon-reload</span><br><span class=\"line\">    <span class=\"comment\"># systemctl start php-fpm</span></span><br><span class=\"line\">    <span class=\"comment\"># systemctl status php-fpm</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ ! -f /usr/bin/php-fpm ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        ln -s <span class=\"variable\">$PHP_DIR</span>/sbin/php-fpm /usr/bin/php-fpm</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">    CHECK_STATUS=$(netstat -tlnp | grep -wc <span class=\"string\">\"php-fpm\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ <span class=\"variable\">$CHECK_STATUS</span> -eq 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m#Message: 启动失败请请检查错误原因后重试.... \\e[0m\"</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">         <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m#Message: 启动成功.... \\e[0m\"</span></span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200305121626.png\" alt=\"WeiyiGeek.PHP-FPM编译执行结果\" title=\"\" class=\"\">\n                <p>WeiyiGeek.PHP-FPM编译执行结果</p>\n            </figure>\n<p>脚本执行效果:<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200305224619.png\" alt=\"WeiyiGeek.php-FPM执行效果\" title=\"\" class=\"\">\n                <p>WeiyiGeek.php-FPM执行效果</p>\n            </figure></p>\n<p><br></p>\n<p><strong>安装异常记录:</strong></p>\n<p><em>问题1: php-fpm Failed to open error_log  Read-only file system (30)</em><br>错误信息:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Mar 05 13:26:13 weiyigeek php-fpm[18283]: [05-Mar-2020 13:26:13] ERROR: failed to open error_log (/usr/<span class=\"built_in\">local</span>/php/7.4.3/var/<span class=\"built_in\">log</span>/php-fpm.log): Read-only file system (30)</span><br></pre></td></tr></table></figure><br>错误原因:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1.由于我们安装路径在/usr/且没有进行error 与 pid file文件的默认路径</span></span><br><span class=\"line\">/usr/<span class=\"built_in\">local</span>/php/7.4.3/var/<span class=\"built_in\">log</span>/php-fpm.log</span><br><span class=\"line\">/usr/<span class=\"built_in\">local</span>/php/7.4.3/var/run/php-fpm.pid</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.我们采用Systemctl管理的方式进行启动，由于Systemctl有一个ProtectSystem参数，从描述中我们可以知道 /usr, /boot, and /etc 对于这个单元调用的进程，目录是只读的不能进行写操作(注意通过/etc/init.d/启动不存在该错误)</span></span><br><span class=\"line\"><span class=\"comment\"># Mounts the /usr, /boot, and /etc directories read-only for processes invoked by this unit.</span></span><br><span class=\"line\">ProtectSystem=full</span><br></pre></td></tr></table></figure><br>解决办法:</p>\n<ul>\n<li>方式1:打开 <code>/usr/lib/systemd/system/php-fpm.service</code> 设置如下 ProtectSystem=false</li>\n<li>方式2:修改 php-fpm.conf 配置文件夹中的error_file 和 pid_file 到 /var/目录中即可</li>\n</ul>\n<p><br></p>\n<p><em>问题2: ERROR: failed to post process the configuration</em><br>报错信息:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALERT: [pool www] pm.min_spare_servers(0) must be a positive value</span><br><span class=\"line\">ERROR: failed to post process the configuration</span><br></pre></td></tr></table></figure><br>问题原因:</p>\n<ul>\n<li>#1.在php-fpm安装目录下的/etc/php-fpm.conf未配置pm.min_spare_servers(0)参数以及pid/log配置文件有误</li>\n</ul>\n<p>解决方法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1.再次编辑php-fpm.conf找到pm.min_spare_server ;pm.min_spare_servers = 5 去除;号。</span></span><br><span class=\"line\">sed -i <span class=\"string\">'s/;pm.max_spare_servers = 35/pm.max_spare_servers = 35/g'</span> /usr/<span class=\"built_in\">local</span>/php/etc/php-fpm.conf</span><br><span class=\"line\">sed -i <span class=\"string\">'s/;pm.start_servers = 20/pm.start_servers = 20/g'</span> /usr/<span class=\"built_in\">local</span>/php/etc/php-fpm.conf</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><em>问题3:php-fpm启动时候:No pool defined</em><br>报错信息:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[28-Nov-2018 17:13:23] ERROR: No pool defined. at least one pool section must be specified <span class=\"keyword\">in</span> config file</span><br><span class=\"line\">[28-Nov-2018 17:13:23] ERROR: failed to post process the configuration <span class=\"comment\">#上面出现过常常就是配置文件错问题</span></span><br><span class=\"line\">[28-Nov-2018 17:13:23] ERROR: FPM initialization failed</span><br></pre></td></tr></table></figure><br>错误原因:由于我们没有进行对pool配置文件进行配置；<br>解决方法:进入PHP安装目录/etc/php-fpm.d/然后执行 <code>cp www.conf.default www.conf</code> 即可</p>\n<p><br></p>\n<p><strong>暂时存放</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#php-fpm的运行参数</span></span><br><span class=\"line\">$ php-fpm --fpm-config /usr/<span class=\"built_in\">local</span>/etc/php/5.4/php-fpm.conf --prefix /usr/<span class=\"built_in\">local</span>/var</span><br><span class=\"line\"></span><br><span class=\"line\">-p,--prefix) 指定放置运行时文件的相对路径前缀</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"0x03-LNMP综合实践\"><a href=\"#0x03-LNMP综合实践\" class=\"headerlink\" title=\"0x03 LNMP综合实践\"></a>0x03 LNMP综合实践</h3><p>综合配置脚本示例说明:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">lnmp_config</span></span>()&#123;</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m#LNMP 测试配置....\\e[0m\"</span></span><br><span class=\"line\">    cp <span class=\"variable\">$NGX_DIR</span>/conf/nginx.conf&#123;,.bak&#125;</span><br><span class=\"line\">cat &gt; <span class=\"variable\">$NGX_DIR</span>/conf/nginx.conf &lt;&lt;EOF</span><br><span class=\"line\">user nginx;</span><br><span class=\"line\">worker_processes  1;</span><br><span class=\"line\">error_log  logs/error.log;</span><br><span class=\"line\"><span class=\"comment\">#pid       logs/nginx.pid;</span></span><br><span class=\"line\">events &#123;</span><br><span class=\"line\">    worker_connections  1024;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">http &#123;</span><br><span class=\"line\">    include       mime.types;</span><br><span class=\"line\">    default_type  application/octet-stream;</span><br><span class=\"line\">    <span class=\"comment\">#log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '</span></span><br><span class=\"line\">    <span class=\"comment\">#                  '$status $body_bytes_sent \"$http_referer\" '</span></span><br><span class=\"line\">    <span class=\"comment\">#                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';</span></span><br><span class=\"line\">    <span class=\"comment\">#access_log  logs/access.log  main;</span></span><br><span class=\"line\">    sendfile        on;</span><br><span class=\"line\">    <span class=\"comment\">#tcp_nopush     on;</span></span><br><span class=\"line\">    keepalive_timeout  65;</span><br><span class=\"line\">    <span class=\"comment\">#gzip  on;</span></span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        listen       9081;</span><br><span class=\"line\">        server_name  my.weiyigeek.top;</span><br><span class=\"line\">        charset utf-8;</span><br><span class=\"line\">        <span class=\"comment\">#access_log  logs/host.access.log  main;</span></span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">            root   html;</span><br><span class=\"line\">            index  index.html index.htm;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">#error_page  404              /404.html;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># redirect server error pages to the static page /50x.html</span></span><br><span class=\"line\">        <span class=\"comment\">#</span></span><br><span class=\"line\">        error_page   500 502 503 504  /50x.html;</span><br><span class=\"line\">        location = /50x.html &#123;</span><br><span class=\"line\">            root   html;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">           root           html;</span><br><span class=\"line\">           fastcgi_pass   127.0.0.1:9000;</span><br><span class=\"line\">           fastcgi_index  index.php;</span><br><span class=\"line\">           fastcgi_param  SCRIPT_FILENAME  \\<span class=\"variable\">$document_root</span>\\<span class=\"variable\">$fastcgi_script_name</span>;</span><br><span class=\"line\">           include        fastcgi_params;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\"># deny access to .htaccess files, if Apache's document root</span></span><br><span class=\"line\">        <span class=\"comment\"># concurs with nginx's one</span></span><br><span class=\"line\">        location ~ /\\.ht &#123;</span><br><span class=\"line\">           deny  all;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"&lt;?php  phpinfo(); ?&gt;\"</span> &gt; <span class=\"variable\">$NGX_DIR</span>/html/phpinfo.php</span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"&lt;?php  echo \"</span>Hello World! php<span class=\"string\">\" ?&gt;\"</span> &gt; <span class=\"variable\">$NGX_DIR</span>/html/index.php</span><br><span class=\"line\">    <span class=\"variable\">$NGX_DIR</span>/sbin/nginx -s reload</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>最终执行程序所属者查看:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$ps</span> aux | grep -E <span class=\"string\">\"nginx|php-fpm|mysql\"</span></span><br><span class=\"line\">root      4511  0.0  0.0  11820  1592 ?        S    20:54   0:00 /bin/sh /usr/<span class=\"built_in\">local</span>/mysql/5.7.29/bin/mysqld_safe --datadir=/data/mysql/db/ --pid-file=/data/mysql/db//weiyigeek.pid</span><br><span class=\"line\">mysql     4687  0.0  1.1 1797852 186644 ?      Sl   20:54   0:00 /usr/<span class=\"built_in\">local</span>/mysql/5.7.29/bin/mysqld --basedir=/usr/<span class=\"built_in\">local</span>/mysql/5.7.29 --datadir=/data/mysql/db --plugin-dir=/usr/<span class=\"built_in\">local</span>/mysql/5.7.29/lib/plugin --user=mysql --<span class=\"built_in\">log</span>-error=/data/mysql/db/error.log --pid-file=/data/mysql/db//weiyigeek.pid --socket=/tmp/mysql.sock</span><br><span class=\"line\">root     13942  0.0  0.0  47916  4804 ?        Ss   21:49   0:00 php-fpm: master process (/usr/<span class=\"built_in\">local</span>/php/7.4.3/etc/php-fpm.conf)</span><br><span class=\"line\">php      13943  0.0  0.0  47916  5124 ?        S    21:49   0:00 php-fpm: pool www</span><br><span class=\"line\">php      13944  0.0  0.0  47916  5628 ?        S    21:49   0:00 php-fpm: pool www</span><br><span class=\"line\">root     14917  0.0  0.0  20568   652 ?        Ss   21:58   0:00 nginx: master process nginx</span><br><span class=\"line\">nginx    14918  0.0  0.0  20928  1596 ?        S    21:58   0:00 nginx: worker process</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>安装异常记录:</strong><br>问题1.Nginx + php-fpm 访问php文件时候显示<br>常见错误原因:</p>\n<ol>\n<li>php-fpm找不到SCRIPT_FILENAME里执行的php文件</li>\n<li>php-fpm不能访问所执行的php也就是权限问题</li>\n</ol>\n<p>情况1解决方法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#（1）在location体中里面添加当文件不存在时返回404而不是交给php-fpm进行处理</span></span><br><span class=\"line\">location ~ \\.php$ &#123;</span><br><span class=\"line\">    <span class=\"comment\">#文件不存在转404</span></span><br><span class=\"line\">    try_files <span class=\"variable\">$uri</span> = 404;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#（2）fastcgi_param 参数指定有误</span></span><br><span class=\"line\">location ~ \\.php$ &#123;</span><br><span class=\"line\">    root           html;</span><br><span class=\"line\">    fastcgi_pass   127.0.0.1:9000;</span><br><span class=\"line\">    fastcgi_index  index.php;</span><br><span class=\"line\">    <span class=\"comment\">#fastcgi_param  SCRIPT_FILENAME  /script$fastcgi_script_name; //采用下面方式进行替换</span></span><br><span class=\"line\">    fastcgi_param  SCRIPT_FILENAME  <span class=\"variable\">$document_root</span><span class=\"variable\">$fastcgi_script_name</span>;</span><br><span class=\"line\">    include        fastcgi_params;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">systemctl restart nginx（/usr/<span class=\"built_in\">local</span>/nginx/sbin/nginx） <span class=\"comment\">#重新加载nginx配置文件</span></span><br></pre></td></tr></table></figure></p>\n<p>情况2解决方法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">第一种，就是把你root文件夹设为其他用户允许</span><br><span class=\"line\">第二种，找到你的php-fpm.conf的配置文件，找到下面这段，把apache替换成你要的用户组</span><br><span class=\"line\"></span><br><span class=\"line\">; RPM: apache Choosed to be able to access some dir as httpd</span><br><span class=\"line\">user = apache</span><br><span class=\"line\">; RPM: Keep a group allowed to write <span class=\"keyword\">in</span> <span class=\"built_in\">log</span> dir.</span><br><span class=\"line\">group = apache</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2020/1/20200305222624.png\" alt=\"WeiyiGeek.phpinfo\" title=\"\" class=\"\">\n                <p>WeiyiGeek.phpinfo</p>\n            </figure>\n<hr>\n<h3 id=\"0x04-工具补充\"><a href=\"#0x04-工具补充\" class=\"headerlink\" title=\"0x04 工具补充\"></a>0x04 工具补充</h3><h4 id=\"wlnmp安装部署包\"><a href=\"#wlnmp安装部署包\" class=\"headerlink\" title=\"wlnmp安装部署包\"></a>wlnmp安装部署包</h4><p>描述:wlnmp支持CentOS6、7、8一键部署lnmp环境官网:<code>https://www.wlnmp.com</code><br>安装使用简单说明:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#(1)建议阿里云镜像配置epel源（必须）</span></span><br><span class=\"line\">yum install epel-release</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(2)添加WLNMP一键安装包源</span></span><br><span class=\"line\">rpm -ivh http://mirrors.wlnmp.com/centos/wlnmp-release-centos.noarch.rpm</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(3)安装LNMP</span></span><br><span class=\"line\"><span class=\"comment\"># Nginx</span></span><br><span class=\"line\"><span class=\"comment\"># php: php5.6/php7.0/php7.1/php7.2/php7.3/php7.4</span></span><br><span class=\"line\"><span class=\"comment\"># php扩展: php5.6/php7.0/php7.1/php7.2/php7.3</span></span><br><span class=\"line\"><span class=\"comment\"># k-v数据库:redis4.x/redis5.x/memcached</span></span><br><span class=\"line\"><span class=\"comment\"># 关系型数据库:MySQL5.5/MySQL5.6/MySQL5.7/MySQL8.0</span></span><br><span class=\"line\">yum install wnginx wphp74 wmysql57 wphp57-memcache</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(4)修改MySQL密码（默认密码为空）</span></span><br><span class=\"line\">mysql -uroot -p</span><br><span class=\"line\">mysql&gt; <span class=\"built_in\">set</span> password = password(<span class=\"string\">'weiyigeek'</span>);  <span class=\"comment\">#5.7.x</span></span><br><span class=\"line\">mysql&gt; ALTER USER <span class=\"string\">'root'</span>@<span class=\"string\">'localhost'</span> IDENTIFIED BY <span class=\"string\">'WeiyiGeek'</span>; <span class=\"comment\">#8.x</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(5)nginx中php配置，在nginx配置文件中，找到安装对应php的版本，取消前面#注释，重启nginx即可</span></span><br><span class=\"line\"><span class=\"comment\">#include enable-php56.conf;</span></span><br><span class=\"line\"><span class=\"comment\">#include enable-php70.conf;</span></span><br><span class=\"line\"><span class=\"comment\">#include enable-php71.conf;</span></span><br><span class=\"line\"><span class=\"comment\">#include enable-php72.conf;</span></span><br><span class=\"line\"><span class=\"comment\">#include enable-php73.conf;</span></span><br><span class=\"line\"><span class=\"comment\">#include enable-php74.conf;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(6)各项服务启动</span></span><br><span class=\"line\">/etc/init.d/*</span><br><span class=\"line\">/etc/init.d/nginx start</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(7)版本升级</span></span><br><span class=\"line\">yum update wnginx</span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"系统运维","path":"api/categories/系统运维.json"}],"tags":[{"name":"Web服务器","path":"api/tags/Web服务器.json"},{"name":"LNMP","path":"api/tags/LNMP.json"}]}