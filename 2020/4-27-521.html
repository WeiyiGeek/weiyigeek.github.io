<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 4-Kuberneteså…¥é—¨åŸºç¡€ä¹‹Podä»‹ç»|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="k8s">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/2018/1-1-1.html"  >
                <i class="icon icon-lg icon-mortar-board"></i>
                å­¦ä¹ ä¹‹è·¯
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="/img/video-account.jpg" target="_blank" >
                <i class="icon icon-lg icon-video-camera"></i>
                è§†é¢‘å·
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>4-Kuberneteså…¥é—¨åŸºç¡€ä¹‹Podä»‹ç»</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">4-Kuberneteså…¥é—¨åŸºç¡€ä¹‹Podä»‹ç»</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-04-27T10:37:47.000Z" itemprop="datePublished" class="page-time">
  2020-04-27
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap" style="display: none;">
  <article id="post-è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/4-Kuberneteså…¥é—¨åŸºç¡€ä¹‹Podä»‹ç»"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">4-Kuberneteså…¥é—¨åŸºç¡€ä¹‹Podä»‹ç»</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-04-27 18:37:47" datetime="2020-04-27T10:37:47.000Z"  itemprop="datePublished">2020-04-27</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>



            

            


            
        </div>
        <span class="post-href" style="display: none;">|</span> 
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[toc]</p>
<h2 id="0x00-å‰è¨€ç®€è¿°"><a href="#0x00-å‰è¨€ç®€è¿°" class="headerlink" title="0x00 å‰è¨€ç®€è¿°"></a>0x00 å‰è¨€ç®€è¿°</h2><p>å‰é¢ç®€å•çš„ä»‹ç»äº†KubernetesåŸºç¡€çŸ¥è¯†ä»¥åŠå•èŠ‚ç‚¹å’Œé«˜å¯ä»¥ç”¨é›†ç¾¤çš„æ­å»º, æœ¬ç« å°†ä»å®æ“æ¥ä»‹ç»Kubernetesæ¦‚å¿µå’Œæœ¯è¯­ä»¥åŠæ§åˆ¶å™¨ï¼Œä¾¿äºå„ä½è¯»è€…è¿›è¡Œå­¦ä¹ ;</p>
<p><br></p>
<h2 id="0x01-èµ„æºæ¸…å•"><a href="#0x01-èµ„æºæ¸…å•" class="headerlink" title="0x01 èµ„æºæ¸…å•"></a>0x01 èµ„æºæ¸…å•</h2><p><strong>Q: ä»€ä¹ˆæ˜¯èµ„æº?</strong></p>
<blockquote>
<p>ç­”: K8sä¸­æ‰€æœ‰çš„å†…å®¹éƒ½æŠ½è±¡ä¸ºèµ„æºåœ¨èµ„æºå®ä¾‹åŒ–(<code>å®¹å™¨è¢«æ‰§è¡Œ</code>)ä¹‹åå«åšå¯¹è±¡;</p>
</blockquote>
<p><strong>Q: ä»€ä¹ˆæ˜¯Kuberneteså¯¹è±¡?</strong></p>
<blockquote>
<p>ç­”ï¼šKuberneteså¯¹è±¡æŒ‡çš„æ˜¯Kubernetesç³»ç»Ÿçš„æŒä¹…åŒ–å®ä½“ï¼Œæ‰€æœ‰è¿™äº›å¯¹è±¡åˆèµ·æ¥ä»£è¡¨äº†ä½ é›†ç¾¤çš„å®é™…æƒ…å†µã€‚åˆ›å»ºä¸€ä¸ªk8så¯¹è±¡å°±æ˜¯å‘Šè¯‰Kubernetesï¼Œæ‚¨éœ€è¦çš„é›†ç¾¤ä¸­çš„å·¥ä½œè´Ÿè½½æ˜¯ä»€ä¹ˆï¼ˆé›†ç¾¤çš„ç›®æ ‡çŠ¶æ€ï¼‰, å› ä¸ºä¸€ä¸ªKuberneteså¯¹è±¡ä»£è¡¨ç€ç”¨æˆ·çš„ä¸€ä¸ªæ„å›¾ï¼ˆa record of intentï¼‰ï¼Œä¸€æ—¦æ‚¨åˆ›å»ºäº†ä¸€ä¸ªKuberneteså¯¹è±¡ï¼ŒKuberneteså°†æŒç»­å·¥ä½œä»¥å°½é‡å®ç°æ­¤ç”¨æˆ·çš„æ„å›¾ã€‚</p>
</blockquote>
<p>å¸¸è§„çš„åº”ç”¨é‡Œæˆ‘ä»¬æŠŠåº”ç”¨ç¨‹åºçš„æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼ŒKuberneteså°†å…¶æ•°æ®ä»¥Kuberneteså¯¹è±¡çš„å½¢å¼é€šè¿‡ <code>api server</code> å­˜å‚¨åœ¨ etcd ä¸­ï¼›<br>Kuberneteså¯¹è±¡æ•°æ®æè¿°çš„ä¿¡æ¯:</p>
<ul>
<li>é›†ç¾¤ä¸­è¿è¡Œäº†å“ªäº›å®¹å™¨åŒ–åº”ç”¨ç¨‹åºï¼ˆä»¥åŠåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼‰</li>
<li>é›†ç¾¤ä¸­å¯¹åº”ç”¨ç¨‹åºå¯ç”¨çš„èµ„æº</li>
<li>åº”ç”¨ç¨‹åºç›¸å…³çš„ç­–ç•¥å®šä¹‰ï¼Œä¾‹å¦‚ï¼Œé‡å¯ç­–ç•¥ã€å‡çº§ç­–ç•¥ã€å®¹é”™ç­–ç•¥</li>
<li>å…¶ä»–Kubernetesç®¡ç†åº”ç”¨ç¨‹åºæ—¶æ‰€éœ€è¦çš„ä¿¡æ¯</li>
</ul>
<p><strong>å¦‚ä½•è¿›è¡ŒKuberneteså¯¹è±¡çš„CURDå‘¢?</strong></p>
<blockquote>
<p>ç­”:è‡ªå¸¦çš„kubectlå‘½ä»¤æˆ–è€…ä¸€äº›ç®¡ç†k8sçš„å›¾å½¢åŒ–ç•Œé¢å·¥å…·æ¯”å¦‚Kuboardæˆ–è€…Kubedash;</p>
</blockquote>
<p>PS: kubectlã€kuboard æœ€ç»ˆéƒ½é€šè¿‡è°ƒç”¨ kubernetes API æ¥å®ç°å¯¹ Kubernetes å¯¹è±¡çš„æ“ä½œã€‚æ‚¨ä¹Ÿå¯ä»¥ç›´æ¥åœ¨è‡ªå·±çš„ç¨‹åºä¸­è°ƒç”¨ Kubernetes APIï¼Œæ­¤æ—¶æ‚¨å¯èƒ½è¦æœ‰ç”¨åˆ° Client Libraries </p>
<p><br></p>
<p><strong>åŸºç¡€è¡¥å……:</strong></p>
<ul>
<li><p>1.åç§°ç©ºé—´çº§åˆ«èµ„æº (Namespace Level): ä»…åœ¨æ­¤åç§°ç©ºé—´ä¸‹ç”Ÿæ•ˆ<code>k8sçš„ç³»ç»Ÿç»„ä»¶æ˜¯é»˜è®¤æ”¾åœ¨kube-systemåç§°ç©ºé—´ä¸‹</code>çš„ï¼Œè€Œkubectl get podç­‰ä»·äºkubectl get pod -n defaultï¼Œå› æ­¤æŸ¥çœ‹ä¸åˆ°k8sçš„ç³»ç»Ÿç»„ä»¶ã€‚</p>
<ul>
<li><p>å·¥ä½œè´Ÿè½½å‹èµ„æº(workload)ï¼šPodã€ReplicaSet(è°ƒåº¦å™¨æ§åˆ¶å™¨é€šè¿‡æ ‡ç­¾ä¿è¯Podçš„å‰¯æœ¬æ•°ä»¥åŠåˆ›å»ºPod)ã€Deploymentã€StatefulSet(æœ‰çŠ¶æ€æœåŠ¡çš„æ§åˆ¶å™¨)ã€DaemonSet(å¯ä»¥åœ¨æ¯ä¸ªèŠ‚ç‚¹éƒ½è¿è¡Œä¸€ä¸ªPodçš„ç»„ä»¶)ã€Jobã€CronJob(ReplicationControlleråœ¨v1.11ç‰ˆæœ¬è¢«åºŸå¼ƒ)</p>
</li>
<li><p>æœåŠ¡å‘ç°åŠè´Ÿè½½å‡è¡¡å‹èµ„æº(Service Discovery LoadBalance):Serviceã€Ingressã€â€¦</p>
</li>
<li><p>é…ç½®ä¸å­˜å‚¨å‹èµ„æºï¼šVolume(å­˜å‚¨å·)ã€CSI(å®¹å™¨å­˜å‚¨æ¥å£å¯ä»¥æ‰©å±•å„ç§å„æ ·çš„ç¬¬ä¸‰æ–¹å­˜å‚¨å·)</p>
</li>
<li><p>ç‰¹æ®Šç±»å‹çš„å­˜å‚¨å·ï¼šConfigMap(å½“é…ç½®ä¸­å¿ƒæ¥ä½¿ç”¨çš„èµ„æºç±»å‹å¯ä»¥è¾¾åˆ°çƒ­æ›´æ–°)ã€Secret(ä¿å­˜æ•æ„Ÿæ•°æ®)ã€DownwardAPI(æŠŠå¤–éƒ¨ç¯å¢ƒä¸­çš„ä¿¡æ¯è¾“å‡ºç»™å®¹å™¨)</p>
</li>
</ul>
</li>
<li><p>2.é›†ç¾¤çº§èµ„æºï¼šä¸ç®¡åœ¨ä»»ä½•åç§°ç©ºé—´ä¸‹å®šä¹‰ï¼Œåœ¨å…¶ä»–çš„åç§°ç©ºé—´ä¸‹éƒ½èƒ½çœ‹å¾—åˆ°ï¼Œåœ¨å®šä¹‰çš„æ—¶å€™æ— éœ€æŒ‡å®šåç§°ç©ºé—´</p>
<ul>
<li>Namespaceã€Nodeã€Roleã€ClusterRoleã€RoleBindingã€ClusterRoleBinding</li>
</ul>
</li>
<li><p>3.å…ƒæ•°æ®å‹èµ„æºï¼šæä¾›ä¸€ä¸ªæŒ‡æ ‡ï¼Œä¸åƒæ˜¯åç§°ç©ºé—´ç±»å‹åˆä¸åƒé›†ç¾¤çº§åˆ«ï¼Œæœ¬è´¨ä¸Šæ›´åƒæ˜¯åœ¨ä¸¤è€…ä¹‹é—´ï¼Œä½†æ˜¯å®ƒæœ‰è‡ªå·±çš„ç‰¹ç‚¹ï¼Œæ‰€ä»¥æ›´åº”è¯¥ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„åˆ†ç±»ï¼Œä¾‹å¦‚HPAã€é€šè¿‡cpuçš„åˆ©ç”¨ç‡è¿›è¡Œå¹³æ»‘æ‰©å±•ã€‘å°±æ˜¯ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„å…ƒæ•°æ®ç±»å‹ï¼Œé€šè¿‡æŒ‡æ ‡è¿›è¡Œæ“ä½œã€‚</p>
<ul>
<li>HPAã€PodTemplateã€LimitRange(æ ¹æ®æŒ‡æ ‡è¿›è¡Œç›¸å¯¹åº”çš„æ“ä½œ)</li>
</ul>
</li>
</ul>
<p><br></p>
<p><strong>Q: ä»€ä¹ˆæ˜¯èµ„æºæ¸…å•?</strong></p>
<blockquote>
<p>ç­”: æ‚¨å¯ä»¥å°†å…¶ç†è§£ä¸ºå‰§æœ¬ï¼Œé‡Œé¢è§„å®šäº†æ¯ä¸€æ­¥å¦‚ä½•æ“ä½œï¼ŒKubernetsåªéœ€è¦æŒ‰ç…§è¦æ±‚å»åšå³å¯;<br>åœ¨ K8s ä¸­ä¸€èˆ¬ä½¿ç”¨Yamlæ ¼å¼æˆ–è€…Jsonæ ¼å¼çš„æ–‡ä»¶æ¥åˆ›å»ºç¬¦åˆæˆ‘ä»¬é¢„æœŸæœŸæœ›çš„Podï¼Œè¯¥yamlæ–‡ä»¶æˆ‘ä»¬ç§°ä¸ºèµ„æºæ¸…å•;</p>
</blockquote>
<p><br></p>
<p><strong>Q: å¦‚ä½•ç¼–è¾‘èµ„æºæ¸…å•?</strong></p>
<blockquote>
<p>ç­”: åœ¨ç¼–å†™æ¸…å•æ—¶å€™å¿…é¡»å¯¹Kuberneteså®šä¹‰Podä»¥åŠæ§åˆ¶å™¨(Controller)çš„å¸¸ç”¨å­—æ®µæœ‰ä¸€å®šçš„äº†è§£, å¦‚æœå¿˜è®°å¯¹è±¡çš„èµ„æºæ¸…å•å­—æ®µå¯ä»¥é€šè¿‡explainå‘½ä»¤æŸ¥çœ‹ç›¸å¯¹åº”çš„æ§åˆ¶æ¸…å•ç¼–å†™å­—æ®µ;</p>
</blockquote>
<p>èµ„æºæ¸…å•ç¼–å†™å¸®åŠ©: è·å–èµ„æºçš„apiVersionçš„ç‰ˆæœ¬ä¿¡æ¯(ä»¥podä¸ºä¾‹)ï¼Œè¯¥å‘½ä»¤åŒæ—¶è¾“å‡ºå±æ€§è®¾ç½®å¸®åŠ©æ–‡æ¡£<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">kubectl explain pod</span><br><span class="line">  <span class="comment"># KIND:     Pod</span></span><br><span class="line">  <span class="comment"># VERSION:  v1</span></span><br><span class="line">  <span class="comment"># DESCRIPTION:</span></span><br><span class="line">  <span class="comment"># 		Pod is a collection of containers that can run on a host. This resource is</span></span><br><span class="line">  <span class="comment"># 		created by clients and scheduled onto hosts.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># FIELDS: </span></span><br><span class="line">  <span class="comment"># 	apiVersion   &lt;string&gt;</span></span><br><span class="line">  <span class="comment"># 		APIVersion defines the versioned schema of this representation of an</span></span><br><span class="line">  <span class="comment"># 		object. Servers should convert recognized schemas to the latest internal</span></span><br><span class="line">  <span class="comment"># 		value, and may reject unrecognized values. More info:</span></span><br><span class="line">  <span class="comment"># 		https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 	kind &lt;string&gt;</span></span><br><span class="line">  <span class="comment"># 		Kind is a string value representing the REST resource this object</span></span><br><span class="line">  <span class="comment"># 		represents. Servers may infer this from the endpoint the client submits</span></span><br><span class="line">  <span class="comment"># 		requests to. Cannot be updated. In CamelCase. More info:</span></span><br><span class="line">  <span class="comment"># 		https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 	metadata     &lt;Object&gt;</span></span><br><span class="line">  <span class="comment"># 		Standard object's metadata. More info:</span></span><br><span class="line">  <span class="comment"># 		https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 	spec &lt;Object&gt;</span></span><br><span class="line">  <span class="comment"># 		Specification of the desired behavior of the pod. More info:</span></span><br><span class="line">  <span class="comment"># 		https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 	status       &lt;Object&gt;</span></span><br><span class="line">  <span class="comment"># 		Most recently observed status of the pod. This data may not be up to date.</span></span><br><span class="line">  <span class="comment"># 		Populated by the system. Read-only. More info:</span></span><br><span class="line">  <span class="comment"># 		https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</span></span><br><span class="line"></span><br><span class="line">kubectl explain pod.apiVersion <span class="comment">#æŸ¥çœ‹æŒ‡å®šå±æ€§è¯´æ˜</span></span><br><span class="line">  <span class="comment"># KIND:     Pod</span></span><br><span class="line">  <span class="comment"># VERSION:  v1</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># FIELD:    apiVersion &lt;string&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># DESCRIPTION:</span></span><br><span class="line">  <span class="comment"># 		APIVersion defines the versioned schema of this representation of an</span></span><br><span class="line">  <span class="comment"># 		object. Servers should convert recognized schemas to the latest internal</span></span><br><span class="line">  <span class="comment"># 		value, and may reject unrecognized values. More info:</span></span><br><span class="line">  <span class="comment"># 		https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources</span></span><br></pre></td></tr></table></figure></p>
<p>æŸ¥çœ‹k8sä¸­æœ‰å¯¹è±¡å¯ç”¨é‚£äº›èµ„æºçš„APIç‰ˆæœ¬ï¼ˆ1.19.6ï¼‰<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl api-versions</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¸¸ç”¨</span></span><br><span class="line">apiVersion: apps/v1</span><br><span class="line"><span class="comment"># APIç‰ˆæœ¬</span></span><br><span class="line">apps/v1</span><br><span class="line">v1</span><br><span class="line">admissionregistration.k8s.io/v1</span><br><span class="line">admissionregistration.k8s.io/v1beta1</span><br><span class="line">apiextensions.k8s.io/v1</span><br><span class="line">apiextensions.k8s.io/v1beta1</span><br><span class="line">apiregistration.k8s.io/v1</span><br><span class="line">apiregistration.k8s.io/v1beta1</span><br><span class="line">authentication.k8s.io/v1</span><br><span class="line">authentication.k8s.io/v1beta1</span><br><span class="line">authorization.k8s.io/v1</span><br><span class="line">authorization.k8s.io/v1beta1</span><br><span class="line">autoscaling/v1</span><br><span class="line">autoscaling/v2beta1</span><br><span class="line">autoscaling/v2beta2</span><br><span class="line">batch/v1</span><br><span class="line">batch/v1beta1</span><br><span class="line">certificates.k8s.io/v1beta1</span><br><span class="line">coordination.k8s.io/v1</span><br><span class="line">coordination.k8s.io/v1beta1</span><br><span class="line">crd.projectcalico.org/v1</span><br><span class="line">discovery.k8s.io/v1beta1</span><br><span class="line">events.k8s.io/v1beta1</span><br><span class="line">extensions/v1beta1</span><br><span class="line">networking.k8s.io/v1</span><br><span class="line">networking.k8s.io/v1beta1</span><br><span class="line">node.k8s.io/v1beta1</span><br><span class="line">policy/v1beta1</span><br><span class="line">rbac.authorization.k8s.io/v1</span><br><span class="line">rbac.authorization.k8s.io/v1beta1</span><br><span class="line">scheduling.k8s.io/v1</span><br><span class="line">scheduling.k8s.io/v1beta1</span><br><span class="line">storage.k8s.io/v1</span><br><span class="line">storage.k8s.io/v1beta1</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="1-å¯¹è±¡å­—æ®µ"><a href="#1-å¯¹è±¡å­—æ®µ" class="headerlink" title="(1) å¯¹è±¡å­—æ®µ"></a>(1) å¯¹è±¡å­—æ®µ</h3><p>æè¿°: æ¯ä¸ªK8sæ§åˆ¶å™¨å¯¹è±¡éƒ½åŒ…å«äº†ä¸¤ä¸ªé‡è¦çš„å­—æ®µï¼Œå³ <code>spec</code> å’Œ <code>status</code> å­—æ®µ, Kubernetesé€šè¿‡å¯¹åº”çš„æ§åˆ¶å™¨ï¼Œä¸æ–­åœ°ä½¿å®é™…çŠ¶æ€è¶‹å‘äºæ‚¨æœŸæœ›çš„ç›®æ ‡çŠ¶æ€ã€‚</p>
<ul>
<li>spec å¿…é¡»ç”±æ‚¨æ¥æä¾›ï¼Œæè¿°äº†æ‚¨å¯¹è¯¥å¯¹è±¡æ‰€<code>æœŸæœ›</code>çš„ ç›®æ ‡çŠ¶æ€</li>
<li>status åªèƒ½ç”± Kubernetes ç³»ç»Ÿæ¥ä¿®æ”¹ï¼Œæè¿°äº†è¯¥å¯¹è±¡åœ¨ Kubernetes ç³»ç»Ÿä¸­çš„ <code>å®é™…çŠ¶æ€</code></li>
</ul>
<p>ä¾‹å¦‚,ä¸€ä¸ª Kubernetes Deployment å¯¹è±¡å¯ä»¥ä»£è¡¨ä¸€ä¸ªåº”ç”¨ç¨‹åºåœ¨é›†ç¾¤ä¸­çš„è¿è¡ŒçŠ¶æ€ã€‚å½“æ‚¨åˆ›å»º Deployment å¯¹è±¡æ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡ Deployment çš„ spec å­—æ®µæŒ‡å®šéœ€è¦è¿è¡Œåº”ç”¨ç¨‹åºå‰¯æœ¬æ•°ï¼ˆreplicaså‡è®¾ä¸º3ï¼‰ã€‚Kubernetes ä» Deployment çš„ spec ä¸­è¯»å–è¿™äº›ä¿¡æ¯ï¼Œå¹¶ä¸ºæ‚¨åˆ›å»ºæŒ‡å®šå®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„ 3 ä¸ªå‰¯æœ¬ï¼Œå†å°†å®é™…çš„çŠ¶æ€æ›´æ–°åˆ° Deployment çš„ status å­—æ®µã€‚Kubernetes ç³»ç»Ÿå°†ä¸æ–­åœ°æ¯”è¾ƒ å®é™…çŠ¶æ€ staus å’Œ ç›®æ ‡çŠ¶æ€ spec ä¹‹é—´çš„å·®å¼‚ï¼Œå¹¶æ ¹æ®å·®å¼‚åšå‡ºå¯¹åº”çš„è°ƒæ•´ã€‚<br>ä¾‹å¦‚,å¦‚æœä»»ä½•ä¸€ä¸ªå‰¯æœ¬è¿è¡Œå¤±è´¥äº†ï¼ŒKubernetes å°†å¯åŠ¨ä¸€ä¸ªæ–°çš„å‰¯æœ¬ï¼Œä»¥æ›¿ä»£å¤±è´¥çš„å‰¯æœ¬ã€‚</p>
<h4 id="apiVersion-å¿…é¡»"><a href="#apiVersion-å¿…é¡»" class="headerlink" title="apiVersion - å¿…é¡»"></a>apiVersion - å¿…é¡»</h4><p>æè¿°: ç”¨æ¥åˆ›å»ºå¯¹è±¡æ—¶æ‰€ä½¿ç”¨çš„Kubernetes APIç‰ˆæœ¬,å¯é€šè¿‡<code>kubectl api-versions</code>å‘½ä»¤æŸ¥è¯¢å¯ç”¨APIç‰ˆæœ¬;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">kubectl api-versions</span><br><span class="line">admissionregistration.k8s.io/v1</span><br><span class="line">apiextensions.k8s.io/v1</span><br><span class="line">apiregistration.k8s.io/v1</span><br><span class="line">apps/v1</span><br><span class="line">authentication.k8s.io/v1</span><br><span class="line">authorization.k8s.io/v1</span><br><span class="line">autoscaling/v1</span><br><span class="line">autoscaling/v2</span><br><span class="line">autoscaling/v2beta1</span><br><span class="line">autoscaling/v2beta2</span><br><span class="line">batch/v1</span><br><span class="line">batch/v1beta1</span><br><span class="line">certificates.k8s.io/v1</span><br><span class="line">coordination.k8s.io/v1</span><br><span class="line">crd.projectcalico.org/v1</span><br><span class="line">discovery.k8s.io/v1</span><br><span class="line">discovery.k8s.io/v1beta1</span><br><span class="line">events.k8s.io/v1</span><br><span class="line">events.k8s.io/v1beta1</span><br><span class="line">flowcontrol.apiserver.k8s.io/v1beta1</span><br><span class="line">flowcontrol.apiserver.k8s.io/v1beta2</span><br><span class="line">networking.k8s.io/v1</span><br><span class="line">node.k8s.io/v1</span><br><span class="line">node.k8s.io/v1beta1</span><br><span class="line">policy/v1</span><br><span class="line">policy/v1beta1</span><br><span class="line">rbac.authorization.k8s.io/v1</span><br><span class="line">scheduling.k8s.io/v1</span><br><span class="line">storage.k8s.io/v1</span><br><span class="line">storage.k8s.io/v1beta1</span><br><span class="line">v1</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="kind-å¿…é¡»"><a href="#kind-å¿…é¡»" class="headerlink" title="kind - å¿…é¡»"></a>kind - å¿…é¡»</h4><p>æè¿°:è¢«åˆ›å»ºå¯¹è±¡çš„ç±»å‹å¸¸ç”¨çš„æœ‰<code>Deployment(éƒ¨ç½²)ã€Service(æœåŠ¡ç«¯å£)</code></p>
<p><br></p>
<h4 id="metadata-å¿…é¡»"><a href="#metadata-å¿…é¡»" class="headerlink" title="metadata - å¿…é¡»"></a>metadata - å¿…é¡»</h4><p>æè¿°:ç”¨äºå”¯ä¸€ç¡®å®šè¯¥å¯¹è±¡çš„å…ƒæ•°æ®,åŒ…æ‹¬ <code>name</code> å’Œ <code>namespace</code>ï¼Œå¦‚æœ namespace ä¸ºç©ºï¼Œåˆ™é»˜è®¤å€¼ä¸º default;<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nginx-deployment</span>   <span class="comment"># åˆ›å»ºçš„èµ„æºå¯¹è±¡åç§°</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">nginx-app</span>     <span class="comment"># è®¾ç½®æŒ‡å®šçš„åç§°ç©ºé—´ï¼Œé»˜è®¤ä¸ºdefault</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="Annotation-æ³¨è§£"><a href="#Annotation-æ³¨è§£" class="headerlink" title="Annotation - æ³¨è§£"></a>Annotation - æ³¨è§£</h4><p>æè¿°: ä»Annotationå­—é¢æ„æ€ç†è§£å…¶ç”¨é€”å°±æ˜¯æ³¨è§£,æˆ–è€…æœ‰ä¸€äº›å°ä¼™ä¼´çœ‹åˆ°è¿‡å®ƒï¼Œå®ƒç±»ä½¿ç”¨å‰é¢æ‰€æåˆ°çš„Labelå…¶ä¹Ÿæ˜¯é‡‡ç”¨Key/Valueé”®å€¼å¯¹è¿›è¡Œè¡¨ç¤º;<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  annotation:</span></span><br><span class="line"><span class="attr">    key1:</span> <span class="string">value1</span></span><br><span class="line"><span class="attr">    key2:</span> <span class="string">value2</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>Q: Annotation ä¸ Lables ä¸åŒä¹‹å¤„?</strong></p>
<blockquote>
<p>ç­”: Lable å…·æœ‰æ›´ä¸ºä¸¥æ ¼çš„å‘½ä»¤è§„åˆ™ï¼Œä¸»è¦ç”¨äºå®šä¹‰èµ„æºå¯¹è±¡çš„å…ƒæ•°æ®(Metadata)å¹¶ä¸”è¢«Label Seletorä½¿ç”¨<br>Annotation æ˜¯ç”¨æˆ·ä»»æ„å®šä¹‰çš„é™„åŠ ä¿¡æ¯ï¼Œä¾¿äºå¤–éƒ¨å·¥å…·æŸ¥æ‰¾;</p>
</blockquote>
<p><strong>Q: Annotation è®°å½•çš„ä¿¡æ¯?</strong></p>
<blockquote>
<p>A: Build ä¿¡æ¯ã€Release ä¿¡æ¯ã€Docker Image ä¿¡æ¯ã€Docker Registryåœ°å€<br>A: å¼€å‘ç¯å¢ƒä¿¡æ¯ã€å·¥å…·åç§°ã€ç‰ˆæœ¬å·ç­‰<br>A: å›¢é˜Ÿå¼€å‘ä¿¡æ¯ã€ç”µè¯å·ç ã€è´Ÿè´£äººã€ä»¥åŠç½‘ç«™ç­‰</p>
</blockquote>
<p><br></p>
<h4 id="spec-å¿…é¡»"><a href="#spec-å¿…é¡»" class="headerlink" title="spec - å¿…é¡»"></a>spec - å¿…é¡»</h4><p>æè¿°:æ‚¨å¯¹è¯¥å¯¹è±¡çš„æœŸæœ›çŠ¶æ€ä½†æ˜¯éœ€æ³¨æ„ä¸åŒç±»å‹çš„ Kubernetesï¼Œå…¶ spec å¯¹è±¡çš„æ ¼å¼ä¸åŒï¼ˆå«æœ‰ä¸åŒçš„å†…åµŒå­—æ®µï¼‰ï¼Œé€šè¿‡ <a href="https://kubernetes.io/docs/reference/#api-reference" target="_blank" rel="noopener">API æ‰‹å†Œ</a> å¯ä»¥æŸ¥çœ‹ Kubernetes å¯¹è±¡çš„å­—æ®µå’Œæè¿°;</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æƒ³äº†è§£ Pod çš„ spec å®šä¹‰ï¼Œå¯ä»¥åœ¨ <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.16/#podspec-v1-core" target="_blank" rel="noopener">è¿™é‡Œ</a> æ‰¾åˆ°ï¼ŒDeployment çš„ spec å®šä¹‰å¯ä»¥åœ¨ <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.16/#deploymentspec-v1-apps" target="_blank" rel="noopener">è¿™é‡Œ</a> æ‰¾åˆ°;</p>
<p><br></p>
<p><strong>èµ„æºæ¸…å•å¸¸ç”¨çš„å­—æ®µæè¿°:</strong></p>
<ul>
<li><p>1.å¿…é¡»å­˜åœ¨çš„å±æ€§ã€åˆ›å»ºèµ„æºæ¸…å•çš„æ—¶å€™æ²¡æœ‰è¿™äº›å±æ€§çš„å­˜åœ¨å®ƒæ˜¯ä¸å…è®¸è¢«æ‰§è¡Œçš„ã€‘</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å‚æ•°åç§° 	å­—æ®µç±»å‹ 	è¯´æ˜</span></span><br><span class="line">version 	String 	è¿™é‡Œæ˜¯æŒ‡çš„æ˜¯K8SAPIçš„ç‰ˆæœ¬ï¼Œç›®å‰åŸºæœ¬ä¸Šæ˜¯v1ï¼Œå¯ä»¥ç”¨ `kubectl api-version` å‘½ä»¤æŸ¥è¯¢</span><br><span class="line">kind 	String 	    è¿™é‡ŒæŒ‡çš„æ˜¯yamæ–‡ä»¶å®šä¹‰çš„èµ„æºç±»å‹å’Œè§’è‰²ï¼Œæ¯”å¦‚ï¼šPod</span><br><span class="line">metadata 	Object 	å…ƒæ•°æ®å¯¹è±¡ï¼Œå›ºå®šå€¼å°±å†™metadata</span><br><span class="line">metadata.name 	String 	å…ƒæ•°æ®å¯¹è±¡çš„åå­—ï¼Œè¿™é‡Œç”±æˆ‘ä»¬ç¼–å†™ï¼Œæ¯”å¦‚å‘½åPodçš„åå­—</span><br><span class="line">metadata.namespace 	String 	å…ƒæ•°æ®å¯¹è±¡çš„å‘½åç©ºé—´ï¼Œç”±æˆ‘ä»¬è‡ªèº«å®šä¹‰ï¼Œå¦‚æœä¸å®šä¹‰çš„è¯åˆ™é»˜è®¤æ˜¯defaultåç§°ç©ºé—´</span><br><span class="line">Spec 	Object 	è¯¦ç»†å®šä¹‰å¯¹è±¡ï¼Œå›ºå®šå€¼å°±å†™Spec</span><br><span class="line">spec.containers[] 	List 	è¿™é‡Œæ˜¯Specå¯¹è±¡çš„å®¹å™¨åˆ—è¡¨å®šä¹‰ï¼Œæ˜¯ä¸ªåˆ—è¡¨</span><br><span class="line">spec.containers[].name 	String 	è¿™é‡Œå®šä¹‰å®¹å™¨çš„åå­—</span><br><span class="line">spec.containers[].image 	String 	è¿™é‡Œå®šä¹‰è¦ç”¨åˆ°çš„é•œåƒåç§°</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.ä¸»è¦å±æ€§ã€è¿™äº›å±æ€§æ¯”è¾ƒé‡è¦ï¼Œå¦‚æœä¸æŒ‡å®šçš„è¯ç³»ç»Ÿä¼šè‡ªåŠ¨è¡¥å……é»˜è®¤å€¼ã€‘</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å‚æ•°åç§° 	å­—æ®µç±»å‹ 	è¯´æ˜</span></span><br><span class="line">spec.containers[].name 	String 	è¿™é‡Œå®šä¹‰å®¹å™¨çš„åå­—</span><br><span class="line">spec.containers[].image 	String 	è¿™é‡Œå®šä¹‰è¦ç”¨åˆ°çš„é•œåƒåç§°</span><br><span class="line">spec.containers[].imagePullPolicy 	String 	å®šä¹‰é•œåƒæ‹‰å–ç­–ç•¥ï¼Œæœ‰Alwaysã€Neverã€ IfNotPresentä¸‰ä¸ªå€¼å¯é€‰ï¼ˆ1ï¼‰Always:æ„æ€æ˜¯æ¯æ¬¡éƒ½å°è¯•é‡æ–°æ‹‰å–é•œåƒï¼ˆ2ï¼‰Never:è¡¨ç¤ºä»…ä½¿ç”¨æœ¬åœ°é•œåƒï¼ˆ3ï¼‰lfNotPresent:å¦‚æœæœ¬åœ°æœ‰é•œåƒå°±ä½¿ç”¨æœ¬åœ°é•œåƒï¼Œæ²¡æœ‰å°±æ‹‰å–åœ¨çº¿é•œåƒã€‚ä¸Šé¢ä¸‰ä¸ªå€¼éƒ½æ²¡è®¾ç½®çš„è¯ï¼Œé»˜è®¤æ˜¯Alwaysã€‚</span><br><span class="line">spec.containers[].<span class="built_in">command</span>[] 	List 	æŒ‡å®šå®¹å™¨å¯åŠ¨å‘½ä»¤ï¼Œå› ä¸ºæ˜¯æ•°ç»„å¯ä»¥æŒ‡å®šå¤šä¸ªï¼Œä¸æŒ‡å®šåˆ™ä½¿ç”¨é•œåƒæ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤ã€‚</span><br><span class="line">spec.containers[].args[] 	List 	æŒ‡å®šå®¹å™¨å¯åŠ¨å‘½ä»¤å‚æ•°ï¼Œå› ä¸ºæ˜¯æ•°ç»„å¯ä»¥æŒ‡å®šå¤šä¸ªã€‚</span><br><span class="line">spec.containers[].workingDir 	String 	æŒ‡å®šå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œè¿›å…¥å®¹å™¨æ—¶é»˜è®¤æ‰€åœ¨çš„ç›®å½•</span><br><span class="line">spec.containers[].volumeMounts[] 	List 	æŒ‡å®šå®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®</span><br><span class="line">spec.containers[].volumeMounts[].name 	String 	æŒ‡å®šå¯ä»¥è¢«å®¹å™¨æŒ‚è½½çš„å­˜å‚¨å·çš„åç§°</span><br><span class="line">spec.containers[].volumeMounts[].mountPath 	String 	æŒ‡å®šå¯ä»¥è¢«å®¹å™¨æŒ‚è½½çš„å­˜å‚¨å·çš„è·¯å¾„</span><br><span class="line">spec.containers[].volumeMounts[].readOnly 	String 	è®¾ç½®å­˜å‚¨å·è·¯ç»çš„è¯»å†™æ¨¡å¼ï¼Œ<span class="literal">true</span>æˆ–è€…<span class="literal">false</span>ï¼Œé»˜è®¤ä¸ºè¯»å†™æ¨¡å¼</span><br><span class="line">spec.containers[].ports[] 	List 	æŒ‡å®šå®¹å™¨éœ€è¦ç”¨åˆ°çš„ç«¯å£åˆ—è¡¨</span><br><span class="line">spec.containers[].ports[].name 	String 	æŒ‡å®šç«¯å£åç§°</span><br><span class="line">spec.containers[].ports[].containerPort 	String 	æŒ‡å®šå®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å·</span><br><span class="line">spec.containers[].ports[].hostPort 	String 	æŒ‡å®šå®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤è·Ÿä¸Šé¢containerPortç›¸åŒï¼Œæ³¨æ„è®¾ç½®äº†hostPortåŒä¸€å°ä¸»æœºæ— æ³•å¯åŠ¨è¯¥å®¹å™¨çš„ç›¸åŒå‰¯æœ¬ï¼ˆå› ä¸ºä¸»æœºçš„ç«¯å£å·ä¸èƒ½ç›¸åŒï¼Œè¿™æ ·ä¼šå†²çª)</span><br><span class="line">spec.containers[].ports[].protocol 	String 	æŒ‡å®šç«¯å£åè®®ï¼Œæ”¯æŒTCPå’ŒUDPï¼Œé»˜è®¤å€¼ä¸º TCP</span><br><span class="line">spec.containers[].env[] 	List 	æŒ‡å®šå®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨</span><br><span class="line">spec.containers[].env[].name 	String 	æŒ‡å®šç¯å¢ƒå˜é‡åç§°</span><br><span class="line">spec.containers[].env[].value 	String 	æŒ‡å®šç¯å¢ƒå˜é‡å€¼</span><br><span class="line">spec.containers[].resources 	Object 	æŒ‡å®šèµ„æºé™åˆ¶å’Œèµ„æºè¯·æ±‚çš„å€¼ï¼ˆè¿™é‡Œå¼€å§‹å°±æ˜¯è®¾ç½®å®¹å™¨çš„èµ„æºä¸Šé™ï¼‰</span><br><span class="line">spec.containers[].resources.limits 	Object 	æŒ‡å®šè®¾ç½®å®¹å™¨è¿è¡Œæ—¶èµ„æºçš„è¿è¡Œä¸Šé™</span><br><span class="line">spec.containers[].resources.limits.cpu 	String 	æŒ‡å®šCPUçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°ï¼Œå°†ç”¨äºdocker run --cpu-shareså‚æ•°è¿™é‡Œå‰é¢æ–‡ç«  Podèµ„æºé™åˆ¶æœ‰è®²è¿‡ï¼‰</span><br><span class="line">spec.containers[].resources.limits.memory 	String 	æŒ‡å®šMEMå†…å­˜çš„é™åˆ¶ï¼Œå•ä½ä¸ºMlBã€GiB </span><br><span class="line">spec.containers[].resources.requests 	Object 	æŒ‡å®šå®¹å™¨å¯åŠ¨å’Œè°ƒåº¦æ—¶çš„é™åˆ¶è®¾ç½®</span><br><span class="line">spec.containers[].resources.requests.cpu 	String 	CPUè¯·æ±‚ï¼Œå•ä½ä¸ºcoreæ•°ï¼Œå®¹å™¨å¯åŠ¨æ—¶åˆå§‹åŒ–å¯ç”¨æ•°é‡</span><br><span class="line">spec.containers[].resources.requests.memory 	String 	å†…å­˜è¯·æ±‚ï¼Œå•ä½ä¸ºMIBã€GiBï¼Œå®¹å™¨å¯åŠ¨çš„åˆå§‹åŒ–å¯ç”¨æ•°é‡</span><br></pre></td></tr></table></figure>
</li>
<li><p>3.é¢å¤–çš„å‚æ•°é¡¹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å‚æ•°åç§° 	å­—æ®µç±»å‹ 	è¯´æ˜</span><br><span class="line">spec.restartPolicy 	 String 	å®šä¹‰Podçš„é‡å¯ç­–ç•¥ï¼Œå¯é€‰å€¼ä¸ºAlwaysã€OnFailureã€Never é»˜è®¤å€¼ä¸ºAlwaysã€‚1.Always:Podä¸€æ—¦ç»ˆæ­¢è¿è¡Œï¼Œåˆ™æ— è®ºå®¹å™¨æ˜¯å¦‚ä½•ç»ˆæ­¢çš„ï¼ŒkubeletæœåŠ¡éƒ½å°†é‡å¯å®ƒã€‚2.OnFailure:åªæœ‰Podä»¥éé›¶é€€å‡ºç ç»ˆæ­¢æ—¶ï¼Œkubeletæ‰ä¼šé‡å¯è¯¥å®¹å™¨ã€‚å¦‚æœå®¹å™¨æ­£å¸¸ç»“æŸï¼ˆé€€å‡ºç ä¸º0ï¼‰ï¼Œåˆ™kubeletå°†ä¸ä¼šé‡å¯å®ƒã€‚3.Never:Podç»ˆæ­¢åï¼Œkubeletå°†é€€å‡ºç æŠ¥å‘Šç»™Masterï¼Œä¸ä¼šé‡å¯è¯¥Podã€‚</span><br><span class="line">spec.nodeSelector 	Object 	å®šä¹‰Nodeçš„Labelè¿‡æ»¤æ ‡ç­¾ï¼Œä»¥key:valueæ ¼å¼æŒ‡å®šï¼Œé€‰æ‹©nodeèŠ‚ç‚¹å»è¿è¡Œ</span><br><span class="line">spec.imagePullSecrets 	Object 	å®šä¹‰pullé•œåƒæ—¶ä½¿ç”¨secretåç§°ï¼Œä»¥name:secretkeyæ ¼å¼æŒ‡å®š</span><br><span class="line">spec.hostNetwork 	Boolean 	å®šä¹‰æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤å€¼ä¸º<span class="literal">false</span>ã€‚è®¾ç½®<span class="literal">true</span>è¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œï¼Œä¸ä½¿ç”¨dockerç½‘æ¡¥ï¼ŒåŒæ—¶è®¾ç½®äº†<span class="literal">true</span>å°†æ— æ³•åœ¨åŒä¸€å°å®¿ä¸»æœºä¸Šå¯åŠ¨ç¬¬äºŒä¸ªå‰¯æœ¬ã€‚</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<p><strong>èµ„æºæ¸…å•æ ¼å¼:</strong><br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">group/apiversion</span> <span class="comment">#å®šä¹‰å¯¹è±¡çš„ç‰ˆæœ¬æ¨¡å¼; å¦‚æœæ²¡æœ‰ç»™å®šgroupåç§°ï¼Œé‚£ä¹ˆé»˜è®¤ä¸ºcoreå¯ä»¥ä½¿ç”¨kubectlapi-versionså‘½ä»¤è·å–å½“å‰k8sç‰ˆæœ¬ä¸Šæ‰€æœ‰çš„apiversionç‰ˆæœ¬ä¿¡æ¯ï¼ˆæ¯ä¸ªç‰ˆæœ¬å¯èƒ½ä¸åŒï¼‰</span></span><br><span class="line"><span class="attr">kind:</span>     <span class="comment">#èµ„æºç±»åˆ«: è¯¥å¯¹è±¡è¡¨ç¤ºçš„RESTèµ„æº</span></span><br><span class="line"><span class="attr">metadata:</span> <span class="comment">#èµ„æºå…ƒæ•°æ®</span></span><br><span class="line"><span class="attr"> name:</span>    <span class="comment">#èµ„æºè‡ªå®šä¹‰åç§°</span></span><br><span class="line"><span class="attr"> namespace:</span> <span class="comment">#èµ„æºæ‰€å±çš„åç§°ç©ºé—´</span></span><br><span class="line"><span class="attr"> lables:</span>    <span class="comment">#èµ„æº</span></span><br><span class="line"><span class="attr"> annotations:</span> <span class="comment">#æ³¨è§£:ä¸»è¦ç›®çš„æ˜¯æ–¹ä¾¿ç”¨æˆ·é˜…è¯»æŸ¥æ‰¾</span></span><br><span class="line"><span class="attr">spec:</span>   <span class="comment">#æœŸæœ›çš„çŠ¶æ€ï¼ˆdisired state)</span></span><br><span class="line"><span class="attr">status:</span> <span class="comment">#å½“å‰çŠ¶æ€ï¼Œæœ¬å­—æ®µç”±Kubernetesè‡ªèº«ç»´æŠ¤ï¼Œç”¨æˆ·ä¸èƒ½å»å®šä¹‰</span></span><br></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹ï¼šä»¥ä¸‹æ˜¯åˆ›å»ºPodæ‰€å®šä¹‰æ¸…å•æ–‡ä»¶å†…å®¹<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr"> name:</span> <span class="string">pod-demo</span> </span><br><span class="line"><span class="attr"> namespace:</span> <span class="string">default</span> </span><br><span class="line"> <span class="number">1</span><span class="attr">abels:</span></span><br><span class="line"><span class="attr">  app:</span><span class="string">myapp</span> </span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr"> containers:</span></span><br><span class="line"><span class="attr"> - name:</span> <span class="string">myapp-1</span> </span><br><span class="line"><span class="attr">   image:</span> <span class="string">harbor.weiyigeek.top/1ibrary/myapp:v1</span>    <span class="comment"># æ”¯æŒå¤šä¸ªå®¹å™¨è¿è¡Œåœ¨åŒä¸€ä¸ªPodä¹‹ä¸­</span></span><br><span class="line"><span class="attr"> - name:</span> <span class="string">busybox-1</span> </span><br><span class="line"><span class="attr">   image:</span> <span class="attr">busybox:latest</span> </span><br><span class="line"><span class="attr">   command:</span></span><br><span class="line"><span class="bullet">   -</span> <span class="string">"/bin/sh"</span></span><br><span class="line"><span class="bullet">   -</span> <span class="string">"-c"</span></span><br><span class="line"><span class="bullet">   -</span> <span class="string">"sleep 3600"</span></span><br></pre></td></tr></table></figure></p>
<p>PS: åˆ›å»ºpodæ—¶å¦‚å‘ç”Ÿé”™è¯¯å¯ä»¥é€šè¿‡<code>kubectl describe pod myapp-pod-name</code>å’Œ<code>kubectl logs myapp-pod-name</code>å‘½ä»¤æŸ¥çœ‹podç›¸å…³ä¿¡æ¯(æ³¨æ„å¦‚æœæœ‰åç§°ç©ºé—´åˆ™éœ€è¦åŠ ä¸Š);<br>PS: ä¸€ä¸ªPodå†…æ”¯æŒå¤šä¸ªå®¹å™¨è¿è¡Œæ‰€ä»¥åœ¨å®šä¹‰èµ„æºæ¸…å•çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨<code>spec.containers</code>æ•°ç»„ä¸­æŒ‡å®šå¤šä¸ªè¿è¡Œçš„å®¹å™¨åŠå…¶é•œåƒ;</p>
<hr>
<h2 id="0x02-NameSpace-åç§°ç©ºé—´"><a href="#0x02-NameSpace-åç§°ç©ºé—´" class="headerlink" title="0x02 NameSpace - åç§°ç©ºé—´"></a>0x02 NameSpace - åç§°ç©ºé—´</h2><p>æè¿°: Namespaceå³åç§°ç©ºé—´ï¼Œæ‚¨å¯èƒ½åœ¨<code>c++</code>æˆ–è€…<code>c#</code>ä¸­å¬è¯´å®ƒ, å®ƒä¹Ÿæ˜¯K8sç³»ç»Ÿä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µ;</p>
<p>Tips : ç”±äºåˆ›å»ºå¤šä¸ªé›†ç¾¤ä¼šå¯¼è‡´é›†ç¾¤èµ„æºä½¿ç”¨ç¢ç‰‡åŒ–ä»¥åŠæ›´å¤šçš„ç»´æŠ¤æˆæœ¬ï¼Œå¯ä»¥é€šè¿‡Kubernetesçš„NameSpaceå¯¹ä¸åŒå·¥ä½œç»„çš„éœ€æ±‚éš”ç¦»ã€‚</p>
<p><strong>Q: namespace æœ‰ä½•ä½œç”¨?</strong></p>
<blockquote>
<p>A: å®ƒå¯ä»¥é€šè¿‡ä¸åŒçš„èµ„æºå¯¹è±¡è°ƒåº¦åˆ°ä¸åŒçš„Namespaceä¸­, ä»é€»è¾‘ä¸Šå½¢æˆä¸åŒé¡¹ç›®ã€å°ç»„æˆ–ç”¨æˆ·ç»„ï¼Œä¾¿äºä¸åŒçš„åˆ†ç»„ä¹‹é—´èƒ½å¤Ÿå…±äº«ä½¿ç”¨æ•´ä¸ªé›†ç¾¤çš„èµ„æºåŒæ—¶è¿˜èƒ½åˆ†åˆ«ç®¡ç†;<br>ç®€è€Œè¨€ä¹‹: namespace èƒ½å¤Ÿå¸®åŠ©ä¸åŒçš„ç§Ÿæˆ·(å¤šç§Ÿæˆ·ç®¡ç†)å…±äº«ä¸€ä¸ªk8sé›†ç¾¤çš„èµ„æºï¼Œä½¿å¾—æ•´ä¸ªé›†ç¾¤çš„é…ç½®éå¸¸çµã€æ–¹ä¾¿ã€‚</p>
</blockquote>
<p><strong>Q: namespace å‘½åè§„åˆ™?</strong></p>
<blockquote>
<p>A: åªèƒ½åŒ…æ‹¬<code>[a-z0-9]</code>å¹¶ä¸”æœ€å¤§é•¿åº¦ä¸º63ä½;</p>
</blockquote>
<p>Tips : é»˜è®¤æƒ…å†µä¸‹k8sé›†ç¾¤ä¼šåˆ›å»ºä¸€ä¸ªé»˜è®¤çš„åç§°ç©ºé—´å³Default, å¦‚æœé‡‡ç”¨èµ„æºå¯¹è±¡æœªæŒ‡å®šnamespaceæ—¶ï¼Œåˆ™ç”¨æˆ·æ‰€åˆ›å»ºçš„æ‰€æœ‰èµ„æºå¯¹è±¡<code>å¦‚Podã€RCã€RSã€Deploymentã€Service</code>éƒ½å°†è¢«åˆ†é…åˆ°defaultçš„namespaceä¹‹ä¸­;</p>
<p><br></p>
<h3 id="namespace-åˆ›å»ºæŸ¥çœ‹"><a href="#namespace-åˆ›å»ºæŸ¥çœ‹" class="headerlink" title="namespace åˆ›å»ºæŸ¥çœ‹"></a>namespace åˆ›å»ºæŸ¥çœ‹</h3><ul>
<li><p>Step 1.åç§°ç©ºé—´åˆ›å»ºçš„ä¸¤ç§æ–¹å¼å‘½ä»¤è¡Œã€yamlé…ç½®æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼1</span></span><br><span class="line">kubectl create namespace dev-ops</span><br><span class="line"><span class="comment"># namespace/dev-ops created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:</span><br><span class="line">  name: dev-ops</span><br><span class="line"></span><br><span class="line">kubecrl create -f namespace-create.yaml</span><br><span class="line"><span class="comment"># namespace/dev-ops created</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Step 2.æŸ¥çœ‹åç§°ç©ºé—´</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl get ns</span><br><span class="line">  <span class="comment"># NAME                   STATUS   AGE</span></span><br><span class="line">  <span class="comment"># default                Active   89d</span></span><br><span class="line">  <span class="comment"># dev-ops                Active   16s</span></span><br><span class="line"></span><br><span class="line">~$ kubectl describe ns dev-ops</span><br><span class="line">  <span class="comment"># Name:         dev-ops</span></span><br><span class="line">  <span class="comment"># Labels:       &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># Annotations:  &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># Status:       Active</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># No resource quota.  # åç»­è®²è§£èµ„æºé…é¢</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># No LimitRange resource.</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Step 3.åˆ é™¤åç§°ç©ºé—´(éå¸¸æ³¨æ„åˆ é™¤åç§°ç©ºé—´æ˜¯éå¸¸æ³¨æ„æ˜¯è¯¥namespaceä¸‹å­˜åœ¨<code>pvc/deployment/rc</code>ç­‰èµ„æºå¯¹è±¡, å¦åˆ™åˆ é™¤åç§°ç©ºé—´åå…¶èµ„æºå°†è¢«é”€æ¯)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete namespace dev-ops <span class="comment"># æ…ç”¨ -force,-f é€‰é¡¹;</span></span><br><span class="line">kubectl delete -f namespace-create.yaml</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h3 id="namespace-é…é¢"><a href="#namespace-é…é¢" class="headerlink" title="namespace é…é¢"></a>namespace é…é¢</h3><p>æè¿°: é»˜è®¤æƒ…å†µä¸‹åˆ›å»ºçš„namespaceå¹¶ä¸ä¼šå¯¹èµ„æºè¿›è¡Œé…é¢,å¦‚æœéœ€è¦å¯¹æŸä¸€ä¸ªNamespaceé…é¢åˆ™éœ€è¦é…åˆ<code>ResourceQuota</code>ä½¿ç”¨;</p>
<p>åŸºç¡€ç¤ºä¾‹: ResourceQuota é…é¢ç®¡ç†<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) åˆ›å»ºåç§°ç©ºé—´</span></span><br><span class="line">kubectl create namespace dev-ops</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) resource-quote-demo.yaml | èµ„æºæ¸…å•yamlæ–‡ä»¶</span></span><br><span class="line">cat &gt; K8s/Day1/resource-quote-demo.yaml &lt;&lt;<span class="string">'end'</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ResourceQuota</span><br><span class="line">metadata:</span><br><span class="line">  name: resource-quote-demo</span><br><span class="line">spec:</span><br><span class="line">  hard:</span><br><span class="line">    <span class="comment"># è¡¨ç¤ºå…¨éƒ¨Containerçš„å†…å­˜requestsæ€»å’Œä¸èƒ½è¶…è¿‡1Gï¼Œè€Œå†…å­˜Limitsçš„æ€»å’Œä¸èƒ½è¶…è¿‡2GiB (CPU ä¸ä¹‹ç›¸åŒ)</span></span><br><span class="line">    requests.cpu: <span class="string">"1"</span></span><br><span class="line">    requests.memory: 1Gi</span><br><span class="line">    limits.cpu: <span class="string">"2"</span></span><br><span class="line">    limits.memory: 2Gi</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) åˆ›å»ºResourceQuotaå¹¶ä¸ºå…¶æŒ‡å®šåç§°ç©ºé—´</span></span><br><span class="line">~/K8s/Day1$ kubectl create -f resource-quote-demo.yaml -n dev-ops</span><br><span class="line">  <span class="comment"># resourcequota/resource-quote-demo created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) è·å–åç§°ç©ºé—´çš„é…é¢ä¿¡æ¯</span></span><br><span class="line">~/K8s/Day1$ kubectl get resourcequota -n dev-ops  <span class="comment"># -o yaml å¯ä»¥æŸ¥çœ‹åˆ°ä½¿ç”¨çš„æƒ…å†µ</span></span><br><span class="line">  <span class="comment"># NAME                  AGE   REQUEST                                     LIMIT</span></span><br><span class="line">  <span class="comment"># resource-quote-demo   73s   requests.cpu: 0/1, requests.memory: 0/1Gi   limits.cpu: 0/2, limits.memory: 0/2Gi</span></span><br><span class="line">~/K8s/Day1$ kubectl describe resourcequota -n dev-ops</span><br><span class="line">  <span class="comment"># Name:            resource-quote-demo</span></span><br><span class="line">  <span class="comment"># Namespace:       dev-ops</span></span><br><span class="line">  <span class="comment"># Resource         Used  Hard</span></span><br><span class="line">  <span class="comment"># --------         ----  ----</span></span><br><span class="line">  <span class="comment"># limits.cpu       0     2</span></span><br><span class="line">  <span class="comment"># limits.memory    0     2Gi</span></span><br><span class="line">  <span class="comment"># requests.cpu     0     1</span></span><br><span class="line">  <span class="comment"># requests.memory  0     1Gi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) å¦‚æœåœ¨è¯¥åç§°ç©ºé—´ä¸­åˆ›å»ºPodå¹¶è®¾ç½®äº†resourceï¼Œåˆ™ é€šè¿‡ -o yaml å¯ä»¥æŸ¥çœ‹åˆ°è¯¥åç§°ç©ºé—´ä½¿ç”¨çš„æƒ…å†µ</span></span><br><span class="line">~/K8s/Day1$ kubectl get resourcequota -n dev-ops -o yaml </span><br><span class="line"><span class="comment"># status:</span></span><br><span class="line"><span class="comment">#   hard:</span></span><br><span class="line"><span class="comment">#     limits.cpu: "2"</span></span><br><span class="line"><span class="comment">#     limits.memory: 2Gi</span></span><br><span class="line"><span class="comment">#     requests.cpu: "1"</span></span><br><span class="line"><span class="comment">#     requests.memory: 1Gi</span></span><br><span class="line"><span class="comment">#   used:</span></span><br><span class="line"><span class="comment">#     limits.cpu: "1"</span></span><br><span class="line"><span class="comment">#     limits.memory: "1.5Gi"</span></span><br><span class="line"><span class="comment">#     requests.cpu: "800m"</span></span><br><span class="line"><span class="comment">#     requests.memory: "700Mi"</span></span><br></pre></td></tr></table></figure></p>
<p>Tips : å¦‚æœæ­¤æ—¶å†åˆ›å»ºä¸€ä¸ªPodå¹¶è®¾ç½®<code>resources.requests.memory</code>çš„å€¼ä¸º700Miã€‚åˆ™ä¼šæ˜¾ç¤ºé”™è¯¯ç”±äºè¯·æ±‚700Miå·²ç»è¶…å‡ºå‰©ä½™çš„å‰©ä½™çš„Memoryquotaçš„å€¼ï¼Œæ‰€ä»¥æ–°åˆ›å»ºPodçš„è¯·æ±‚å°†ä¼šè¢«ç»ˆæ­¢;</p>
<p>Tips : éå¸¸å»ºè®®æ¯ä¸ªContainerè®¾ç½®CPU/Memoryçš„requestä¸limitå€¼(æ¶‰åŠåˆ°Qosåæ–‡è®²è¿°)</p>
<p>Tips ï¼šæˆ‘ä»¬ä¸å•å•å¯ä»¥å¯¹Namespaceåšåç§°ç©ºé—´èµ„æºé™åˆ¶è¿˜å¯ä»¥é€šè¿‡å…¶å¯¹åº”Containerã€Podæ•°é‡é…é¢(å‰¯æœ¬æ•°)ã€APIå¯¹è±¡çš„é…é¢ç­‰;</p>
<hr>
<h2 id="0x03-Pod-åŸºç¡€-amp-è¿›é˜¶"><a href="#0x03-Pod-åŸºç¡€-amp-è¿›é˜¶" class="headerlink" title="0x03 Pod åŸºç¡€&amp;è¿›é˜¶"></a>0x03 Pod åŸºç¡€&amp;è¿›é˜¶</h2><p>æˆ‘ä»¬çŸ¥é“ Pod æ˜¯Kubernetesé‡Œæœ€å°å•å…ƒï¼Œéƒ¨ç½²åœ¨èŠ‚ç‚¹ä¹‹ä¸ŠåŒ…å«ä¸€ç»„<code>å®¹å™¨(Container)å’Œå·(Volume)</code>, åŒä¸€ä¸ªPodä¸­çš„å®¹å™¨å…±äº«åŒä¸€ä¸ªç½‘ç»œå‘½åç©ºé—´å³å¯ä»¥é€šè¿‡localhostè¿›è¡Œç›¸äº’é€šä¿¡;<br>ç®€å•çš„è¯´ Pod æ˜¯ä¸€ç»„å¯ä»¥åœ¨ä¸»æœºä¸Šè¿è¡Œçš„å®¹å™¨ï¼Œè¯¥èµ„æºç”±å®¢æˆ·ç«¯åˆ›å»ºå¹¶è°ƒåº¦åˆ°ä¸»æœºä¸Šã€‚</p>
<p>å…ˆæ¥æå‡ºå‡ ä¸ªé—®é¢˜&amp;å›ç­”:</p>
<ul>
<li>(1) å¦‚æœPodç”Ÿå‘½å‘¨æœŸæ˜¯çŸ­æš‚çš„é‚£ä¹ˆå¦‚ä½•æ‰èƒ½æŒä¹…åŒ–å®¹å™¨æ•°æ®,å³ä½¿åœ¨Podè¢«é”€æ¯æˆ–è€…é‡å¯åˆ°å…¶å®ƒæœºå™¨ä¸Šå­˜åœ¨?<ul>
<li>ç­”: k8sæ”¯æŒ(Volumeï¼ŒPersistent Volumes)çš„æ¦‚å¿µæ‰€ä»¥å¯ä»¥ä½¿ç”¨æŒä¹…åŒ–çš„å·ç±»å‹;</li>
</ul>
</li>
<li>(2) å¦‚ä½•åˆ›å»ºå¤§æ‰¹é‡çš„å®ä¾‹å‰¯æœ¬?<ul>
<li>ç­”: å»ºè®®é‡‡ç”¨ <code>Replication Controller / Replica Set / Deployment / StateSetful</code> ä½¿ç”¨Podæ¨¡æ¿åˆ›å»ºå¤šä»½æ‹·è´;</li>
</ul>
</li>
<li>(3) å¦‚æœPodç”Ÿå‘½å‘¨æœŸæ˜¯çŸ­æš‚çš„é‚£ä¹ˆé‡å»ºpodåæ„å‘³ç€IPåœ°å€å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–,é‚£å¦‚ä½•æ‰èƒ½ä»å‰ç«¯å®¹å™¨æ­£ç¡®å¯é çš„æŒ‡å‘åç«¯å®¹å™¨?<ul>
<li>ç­”: ä½¿ç”¨ Service æœåŠ¡å‘ç°å¯¹è±¡</li>
</ul>
</li>
</ul>
<p><br></p>
<p><strong>Pod åˆ†ç±»</strong></p>
<ul>
<li>è‡ªåŠ©å¼pod åªè¦podé€€å‡ºäº†ï¼Œæ­¤ç±»å‹çš„podä¸ä¼šè¢«é‡å»ºï¼Œè¯¥podæ²¡æœ‰ç®¡ç†è€…ï¼Œæ­»äº¡åä¸ä¼šè¢«æ‹‰èµ·ã€‚</li>
<li>æ§åˆ¶å™¨ç®¡ç†çš„podã€ç”Ÿäº§ç¯å¢ƒä¸­å¤§å¤šæ•°éƒ½æ˜¯é€‰æ‹©æ§åˆ¶å™¨å»ç®¡ç†podã€‘ åœ¨æ§åˆ¶å™¨çš„ç”Ÿå‘½å‘¨æœŸé‡Œå§‹ç»ˆè¦ç»´æŒpodçš„å‰¯æœ¬æ•°ç›®</li>
</ul>
<p><em>è‡ªåŠ©å¼podä¸æ§åˆ¶å™¨ç®¡ç†çš„podæœ‰ä½•åŒºåˆ«?</em></p>
<blockquote>
<p>ç­”: å…¶<code>ç”Ÿå‘½å‘¨æœŸ</code>è¢«ç®¡ç†çš„æœºåˆ¶ä¸å¤ªä¸€è‡´</p>
</blockquote>
<p><br></p>
<h3 id="1-Pod-Template-amp-Controller"><a href="#1-Pod-Template-amp-Controller" class="headerlink" title="(1) Pod Template &amp; Controller"></a>(1) Pod Template &amp; Controller</h3><p>æè¿°: æˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šåœ¨k8sä¸­ç›´æ¥åˆ›å»ºå•ä¸ªPodï¼Œå› ä¸ºå…¶çš„ç”Ÿå‘½å‘¨æœŸæ˜¯çŸ­æš‚çš„ï¼ˆå³ç”¨åå³ç„šçš„å®ä½“ï¼‰ï¼Œå½“Podè¢«åˆ›å»ºåéƒ½ä¼šè¢«k8sè°ƒåº¦åˆ°é›†ç¾¤çš„Nodeä¹‹ä¸Š, ç›´åˆ°Podè¿›ç¨‹ç»ˆæ­¢è¢«åˆ é™¤, å› ä¸ºç¼ºå°‘èµ„æºè€Œè¢«é©±é€æˆ–è€…Nodeæ•…éšœä¹‹å‰è¿™ä¸ªPodéƒ½ä¼šä¸€ç›´ä¿æŒåœ¨é‚£ä¸ªNodeä¸Š;</p>
<p>æ³¨æ„äº‹é¡¹:</p>
<ul>
<li>1.é‡å¯Podä¸­çš„å®¹å™¨å’Œé‡å¯Podæ˜¯ä¸¤ç§æ¦‚å¿µï¼Œå› ä¸ºPodåªæä¾›å®¹å™¨è¿è¡Œç¯å¢ƒå¹¶ä¿æŒå®¹å™¨çš„è¿è¡ŒçŠ¶æ€æ‰€æœ‰é‡å¯å®¹å™¨å¹¶ä¸ä¼šå¯¼è‡´Podé‡å¯, æœ€å¤–å±‚è¿˜æœ‰ä¸ªPauseå®¹å™¨åœ¨è¿è¡Œï¼›</li>
<li>2.è‡ªåŠ©å¼Podå¹¶ä¸ä¼šè‡ªæ„ˆï¼Œå¦‚æœå½“Podè¿è¡Œçš„NodeèŠ‚ç‚¹æ•…éšœæˆ–è€…è°ƒåº¦å™¨æœ¬èº«æ•…éšœè¯¥Podå°±ä¼šè¢«åˆ é™¤ï¼ŒåŒæ ·çš„å¦‚æœPodæ‰€åœ¨Nodeç¼ºå°‘èµ„æºæˆ–è€…Podå¤„äºç»´æŠ¤çŠ¶æ€ä¹Ÿå°†ä¼šè¢«é©±é€ï¼Œæ‰€ä»¥å¸¸å¸¸ä½¿ç”¨Controlleræ¥ç®¡ç†Podçš„ã€‚</li>
</ul>
<p>Controller å¯ä»¥åˆ›å»ºå’Œç®¡ç†å¤šä¸ªPodå¹¶ä¸”æä¾›å‰¯æœ¬ç®¡ç†ã€æ»šåŠ¨å‡çº§å’Œé›†ç¾¤çº§åˆ«çš„è‡ªæ„ˆèƒ½åŠ›ï¼›<br>ä¾‹å¦‚ï¼šå½“ä¸€ä¸ªNodeæ•…éšœControllerå°±èƒ½è‡ªåŠ¨å°†è¯¥èŠ‚ç‚¹ä¸Šçš„Podè°ƒåº¦åˆ°å…¶ä»–å¥åº·çš„Nodeä¸Š;</p>
<p><br></p>
<p><strong>å¸¸ç”¨äºåˆ›å»ºPodçš„æ§åˆ¶å™¨åˆ—è¡¨:</strong><br>ä¸€èˆ¬æ¥è¯´Podå¹¶ä¸ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œé™¤éæ˜¯ç‰¹æ„å°†å®ƒä»¬è¿›è¡Œé”€æ¯å¦‚äººä¸ºæ“ä½œæˆ–è€…æ§åˆ¶å™¨æ“ä½œ, è¯¥è§„åˆ™å”¯ä¸€ä¾‹å¤–çš„æ˜¯æˆåŠŸæˆ–è€…å¤±è´¥çš„Phaseè¶…è¿‡ä¸€æ®µæ—¶é—´ï¼ˆç”±Masterç¡®å®šæ“ä½œï¼‰çš„Podå°†è¿‡æœŸå¹¶è¢«è‡ªåŠ¨é”€æ¯ï¼›<br>å¦‚ä¸‹åˆ—æ§åˆ¶å™¨:</p>
<ul>
<li>Replication Controller</li>
<li>Delopyment</li>
<li>StatefulSet</li>
<li>DaemonSet</li>
<li>Job</li>
</ul>
<p>Tips : é€šå¸¸Controllerä¼šé€šè¿‡<code>Pod Template</code>æ¥åˆ›å»ºç›¸åº”çš„Pod, è€Œåˆä¸ºä»€ä¹ˆå»ºè®®ä½¿ç”¨æ§åˆ¶å™¨åˆ›å»ºPodè€Œéç›´æ¥åˆ›å»ºå‘¢?;</p>
<blockquote>
<p>ç­”: å› ä¸ºå•ç‹¬çš„Podåœ¨æœºå™¨æ•…éšœçš„æƒ…å†µä¸‹æ²¡æœ‰åŠæ³•è‡ªåŠ¨å¤åŸè€Œæ§åˆ¶å™¨åˆ™å¯ä»¥æŒ‰ç…§æœŸæœ›å‰¯æœ¬æ•°è¿›è¡Œæ„å»ºå¤åŸ;</p>
</blockquote>
<p><br/></p>
<p><strong>ä»€ä¹ˆæ˜¯Podæ¨¡æ¿?</strong><br>ç­”: Pod æ¨¡æ¿æ˜¯åŒ…å«äº†å…¶ä»–å¯¹è±¡(ä¾‹å¦‚RCã€Jobså’ŒDeamonSets)ä¸­çš„Podå®šä¹‰ã€‚Controller æ§åˆ¶å™¨ä½¿ç”¨ Podæ¨¡æ¿ ä»¥åŠ selectoré€‰æ‹©å™¨ æ¥åˆ›å»ºå®é™…éœ€è¦çš„Pod;</p>
<p><br></p>
<p><strong>(1) Pod èµ„æºé…é¢ä¸é™é¢</strong><br>æè¿°: æ¯ä¸ªPodéƒ½å¯ä»¥å¯¹å…¶èƒ½ä½¿ç”¨çš„æœåŠ¡å™¨ä¸Šçš„è®¡ç®—æœºèµ„æºæ¯”å¦‚CPUå’ŒMemoryè¿›è¡Œè®¾ç½®é™é¢ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯CPUçš„èµ„æºå•ä½ä¸ºCPU(Core)çš„æ•°é‡æ˜¯ä¸€ä¸ªç»å¯¹å€¼è€Œéç›¸å¯¹å€¼ï¼ŒåŒæ ·Memoryä¹Ÿæ˜¯ä¸€ä¸ªç»å¯¹å€¼;</p>
<p>åœ¨Kubernetsä¸­CPUå¸¸ä»¥åƒåˆ†ä¹‹ä¸€çš„CPUé…é¢ä½œä¸ºæœ€å°çš„å•å…ƒé€šå¸¸ç”¨<code>m</code>è¡¨ç¤ºï¼Œè€ŒMemoryé…é¢å•ä½æ˜¯å†…å­˜å­—èŠ‚æ•°é€šå¸¸ç”¨<code>Mi</code>è¡¨ç¤ºï¼›<br>ä¾‹å¦‚: é€šå¸¸ä¸€ä¸ªå®¹å™¨çš„é…é¢è¢«å®šä¹‰ä¸º100~300må³å ç”¨0.1~0.3ä¸ªCPUï¼Œç”±äºCPUé…é¢æ˜¯ä¸ªç»å¯¹å€¼æ‰€ä»¥è¯´æ— è®ºæ˜¯1Cæˆ–è€…48Cçš„æœºå™¨ä¸Š100mä»£è¡¨çš„é…é¢éƒ½æ˜¯ä¸€æ ·çš„;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">resources:</span><br><span class="line">  <span class="comment"># é™åˆ¶</span></span><br><span class="line">  limits:</span><br><span class="line">    cpu: 500m</span><br><span class="line">    memory: 500Mi</span><br><span class="line">  <span class="comment"># è¯·æ±‚(ä¾èµ–)</span></span><br><span class="line">  requests:</span><br><span class="line">    cpu: 500m</span><br><span class="line">    memory: 6Gi</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>ç¤ºä¾‹.Pod Template &amp; Pod resources<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>        <span class="comment"># apiserverç‰ˆæœ¬</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span>           <span class="comment"># ç»‘å®šåŠ¨ä½œ</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nginx-deployment</span>   <span class="comment"># åº”ç”¨ + ç»‘å®šç±»å‹ </span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">nginx-app</span>     <span class="comment"># åç§°ç©ºé—´</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  selector:</span>      <span class="comment"># é€‰æ‹©å™¨ï¼ŒåŒ¹é…Podæ¨¡æ¿ä¸­çš„æ ‡ç­¾æ‰çŸ¥é“è¿è¡Œäº†å‡ ä¸ªå‰¯æœ¬å®ä¾‹;</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">      role:</span> <span class="string">master</span></span><br><span class="line"><span class="attr">      tier:</span> <span class="string">backend</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">2</span>    <span class="comment"># è¿è¡Œ 2 ä¸ªå®¹å™¨åŒ–åº”ç”¨ç¨‹åºå‰¯æœ¬</span></span><br><span class="line"><span class="attr">  template:</span>      <span class="comment"># Pod æ¨¡æ¿</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">        role:</span> <span class="string">master</span></span><br><span class="line"><span class="attr">        tier:</span> <span class="string">backend</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">nginx:1.7.9</span></span><br><span class="line"><span class="attr">        resources:</span></span><br><span class="line"><span class="attr">          requests:</span></span><br><span class="line"><span class="attr">            cpu:</span> <span class="number">100</span><span class="string">m</span></span><br><span class="line"><span class="attr">            memory:</span> <span class="number">100</span><span class="string">Mi</span></span><br><span class="line"><span class="attr">          limits:</span></span><br><span class="line"><span class="attr">            cpu:</span> <span class="number">800</span><span class="string">m</span></span><br><span class="line"><span class="attr">            memory:</span> <span class="number">800</span><span class="string">Mi</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="attr">        - containerPort:</span> <span class="number">8080</span>  <span class="comment"># æš´éœ²çš„ç«¯å£</span></span><br></pre></td></tr></table></figure></p>
<p>Yaml é…ç½®æ–‡ä»¶ç›¸å…³æ“ä½œ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.ä½¿ç”¨ kube apply å‘½ä»¤å¯ä»¥åˆ›å»ºè¯¥ .yaml æ–‡ä»¶ä¸­çš„ Deployment å¯¹è±¡</span></span><br><span class="line">kubectl apply -f deployment.yaml</span><br><span class="line">kubectl apply -f https://weiyigeek.top/k8s/deployment.yaml</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>Tips : å¯ä»¥é‡‡ç”¨ç›´æ¥ RUN åˆ›å»ºPod, å®é™…ä¸Šä¸åŠ portä¹Ÿèƒ½é€šè¿‡æœåŠ¡è¿›è¡Œå‘ç°å®é™…å·¥ä½œä¸­ä¸€å®šè¦åŠ ä¸Šä¸ºäº†åæœŸé—®é¢˜çš„æ’æŸ¥<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run nginx --image nginx:latest --port=80 --replicas=2</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="2-Static-Pod-é™æ€"><a href="#2-Static-Pod-é™æ€" class="headerlink" title="(2) Static Pod (é™æ€)"></a>(2) Static Pod (é™æ€)</h3><p>Q: ä»€ä¹ˆæ˜¯é™æ€Pod?</p>
<blockquote>
<p>ç­”: åœ¨ k8s ä¸­ç”±kubeletåˆ›å»ºå¹¶è¿è¡Œçš„Pod, è¯¥ç§ç±»å‹çš„Podå¯ä»¥åœ¨æŸä¸ªèŠ‚ç‚¹ä¸Šé•¿æœŸè¿è¡Œï¼ˆå³é™æ€Podï¼‰ã€‚<br>ç®€å•è¯´é™æ€ pod æ˜¯ç”± kubelet åˆ›å»ºå’Œç®¡ç†çš„åªåœ¨ç‰¹å®šnodeä¸Šå­˜åœ¨çš„ podï¼Œå¹¶ä¸”åªåœ¨kubeletæ‰€åœ¨çš„Nodeä¸Šè¿è¡Œã€‚</p>
</blockquote>
<p><br></p>
<p><strong>é™æ€Podç‰¹ç‚¹:</strong></p>
<ul>
<li>1.é™æ€ pod æ€»æ˜¯ç”±æŸä¸ªèŠ‚ç‚¹ä¸Šçš„ kubelet åˆ›å»ºå’Œç®¡ç†çš„, å³ä¸èƒ½é€šè¿‡ api-server æ¥ç®¡ç†,æ‰€ä»¥æ— æ³•å’Œ <code>RCï¼ŒRSï¼ŒDeployment æˆ–è€… DaemonSetæ§åˆ¶å™¨</code>è¿›è¡Œå…³è”ã€‚</li>
<li>2.kubelet æ— æ³•å¯¹ é™æ€ pod è¿›è¡Œå¥åº·æ£€æŸ¥ã€‚</li>
</ul>
<ul>
<li>3.å¦‚æœæŠŠ pod çš„yamlæè¿°æ–‡ä»¶æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸­ï¼Œç­‰kubeletæ‰«æåˆ°æ–‡ä»¶ï¼Œä¼šè‡ªåŠ¨åœ¨æœ¬æœºåˆ›å»ºå‡ºæ¥ podï¼›</li>
<li>4.å¦‚æœæŠŠ pod çš„yamlæ–‡ä»¶æ›´æ”¹äº†ï¼Œkubeletä¹Ÿä¼šè¯†åˆ«åˆ°ï¼Œä¼šè‡ªåŠ¨æ›´æ–° podï¼›</li>
<li>5.å¦‚æœæŠŠ pod çš„yamlæ–‡ä»¶åˆ é™¤äº†ï¼Œkubeletä¼šè‡ªåŠ¨åˆ é™¤æ‰podï¼›</li>
</ul>
<ul>
<li>6.å¦‚æœå½“ kubelet å‘ç°é™æ€Podåœæ­¢æ‰æ—¶å€™ï¼Œå°†ä¼šé‡æ–°å¯åŠ¨é™æ€Pod;</li>
</ul>
<p>Tips: å› ä¸ºé™æ€ pod ä¸èƒ½è¢« api-server ç›´æ¥ç®¡ç†ï¼Œæ‰€ä»¥å®ƒçš„æ›´æ–°åˆ é™¤æ“ä½œä¸èƒ½ç”± kubectl æ¥æ‰§è¡Œï¼Œåªèƒ½ç›´æ¥ä¿®æ”¹æˆ–åˆ é™¤æ–‡æœ¬æ–‡ä»¶ã€‚</p>
<p><strong>é™æ€Podåˆ›å»ºçš„ä¸¤ç§æ–¹å¼:</strong></p>
<ul>
<li>1.HTTPï¼š kubelet å‘¨æœŸåœ°ä»é‡‡ç”¨ <code>--manifest-url</code> å‚æ•°æŒ‡å®šçš„åœ°å€ä¸‹è½½æ–‡ä»¶ï¼Œå¹¶ä¸”å°†å®ƒç¿»è¯‘æˆJSON/YAMLæ ¼å¼çš„Podå®šä¹‰(å®é™…ä¸ä¸‹é¢å·®è·ä¸å¤§åªæ˜¯å¢åŠ äº†ä¸‹è´¦çš„æ­¥éª¤)</li>
<li>2.é…ç½®æ–‡ä»¶ï¼škubelet å¯åŠ¨æ—¶é‡‡ç”¨ <code>--pod-manifest-path=/etc/kubernetes/manifests</code> æŒ‡å®šyamlæ–‡ä»¶å­˜æ”¾ç›®å½• ä¼šå®šæœŸæ‰«æè¿™ä¸ªç›®å½•ï¼Œå¹¶æ ¹æ®è¿™ä¸ªç›®å½•ä¸‹çš„ .yaml æˆ– .json æ–‡ä»¶è¿›è¡Œåˆ›å»ºå’Œæ›´æ–°æ“ä½œ </li>
</ul>
<p>ä¾‹å¦‚å°†static-nginx-web.yamlæ–‡ä»¶åŠ å…¥åˆ°è¯¥æ–‡ä»¶å¤¹ä¹‹ä¸­, é‡å¯ Kubelet æœåŠ¡æˆ–è€…ç­‰å¾…å‡ ç§’å³å¯åˆ›å»ºé™æ€ Pod;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sudo tee /etc/kubernetes/manifests/static-pod.yaml &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: static-nginx-web</span><br><span class="line">  lables:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name : web</span><br><span class="line">    image: nginx:latest</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    ports:</span><br><span class="line">      - name: nginx-port</span><br><span class="line">        containerPort: 80</span><br><span class="line">        protocol: TCP</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></p>
<p><strong>æ“ä½œæµç¨‹:</strong></p>
<ul>
<li><p>(1) å†™å…¥åˆ°<code>/etc/kubernetes/manifests/</code>ç›®å½•åæŸ¥çœ‹kubeletçŠ¶æ€</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl status kubelet</span><br><span class="line"><span class="comment"># â— kubelet.service - kubelet: The Kubernetes Node Agent</span></span><br><span class="line"><span class="comment">#      Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)</span></span><br><span class="line"><span class="comment">#     Drop-In: /etc/systemd/system/kubelet.service.d</span></span><br><span class="line"><span class="comment">#              â””â”€10-kubeadm.conf</span></span><br><span class="line"><span class="comment">#      Active: active (running) since Wed 2021-01-20 03:18:21 UTC; 1h 24min ago</span></span><br><span class="line"><span class="comment">#        Docs: https://kubernetes.io/docs/home/</span></span><br><span class="line"><span class="comment">#    Main PID: 1436080 (kubelet)</span></span><br><span class="line"><span class="comment">#       Tasks: 19 (limit: 9450)</span></span><br><span class="line"><span class="comment">#      Memory: 50.7M</span></span><br><span class="line"><span class="comment">#      CGroup: /system.slice/kubelet.service</span></span><br><span class="line"><span class="comment">#              â””â”€1436080 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml --network-plugin=cni --pod-infra-container-image=</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>(2) é™æ€ Pod æŸ¥çœ‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ls /etc/kubernetes/manifests</span><br><span class="line">etcd.yaml  kube-apiserver.yaml  kube-controller-manager.yaml  kube-scheduler.yaml  static-pod.yaml</span><br><span class="line"></span><br><span class="line">$ kubectl get pod -o wide | grep <span class="string">"static"</span></span><br><span class="line"><span class="comment"># static-nginx-web-weiyigeek-107   1/1  Running   0   82m  172.16.0.197  weiyigeek-107   &lt;none&gt;  &lt;none&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>(3) ç§»é™¤é™æ€ Pod</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„:ç§»é™¤é™æ€Podè™½ç„¶ç”¨api serverå¯ä»¥åˆ é™¤é™æ€Podï¼Œä½†ä»–å¾ˆå¿«è‡ªåŠ¨é‡æ–°ç”ŸæˆPod,æ‰€ä»¥é€šè¿‡åˆ é™¤é™æ€Podçš„yamlé…ç½®èµ„æºæ–‡ä»¶åˆ™å®Œæˆç§»é™¤é™æ€Pod;</span></span><br><span class="line">$ rm /etc/kubernetes/manifests/static-pod.yaml</span><br><span class="line">$ kubectl get pod</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h3 id="3-Pod-ç”Ÿå‘½å‘¨æœŸ"><a href="#3-Pod-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="(3) Pod ç”Ÿå‘½å‘¨æœŸ"></a>(3) Pod ç”Ÿå‘½å‘¨æœŸ</h3><p><strong>Q: ä¸»è¦é€šè¿‡ä»¥ä¸‹å±‚é¢äº†è§£Podçš„å£°æ˜å‘¨æœŸ;</strong></p>
<ol>
<li>åœ¨Podè¢«åˆ›å»ºåç»å†çš„è¿‡ç¨‹åŠå…¶çŠ¶æ€;</li>
<li>Podä¸­å®¹å™¨æ¢æµ‹çº å¯Ÿ;</li>
</ol>
<p><em>Pod åˆ›å»ºè¿‡ç¨‹ä¸å„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾ï¼š</em><br><figure class="image-box">
                <a rel=4-Kuberneteså…¥é—¨åŸºç¡€ä¹‹Podä»‹ç» href="https://img.weiyigeek.top/2020/2/20201108213611.png" target="_blank" title="WeiyiGeek.k8sä¸­Podåˆ›å»ºè¿‡ç¨‹ä¸ç”Ÿå‘½å‘¨æœŸ" data-fancybox="images"><img src="https://img.weiyigeek.top/2020/2/20201108213611.png" alt="WeiyiGeek.k8sä¸­Podåˆ›å»ºè¿‡ç¨‹ä¸ç”Ÿå‘½å‘¨æœŸ" title="" class=""></a>
                <p>WeiyiGeek.k8sä¸­Podåˆ›å»ºè¿‡ç¨‹ä¸ç”Ÿå‘½å‘¨æœŸ</p>
            </figure></p>
<p><br></p>
<p><strong>ç®€å•è¯´æ˜:</strong></p>
<ul>
<li>1.å‰é¢æˆ‘ä»¬è®²è§£äº†Kubectlã€KubeAPI-Serverã€ETCDã€Kubeletã€CRIç­‰ç»„ä»¶æ­¤å¤„ä¸åœ¨ç´¯è¿°;</li>
<li>2.Pause å®¹å™¨: Pod åˆ›å»ºä¹‹åˆçš„åˆ›å»ºå®ƒæ˜¯Podé‡Œå®¹å™¨å…±äº«ç½‘ç»œæ ˆä»¥åŠå­˜å‚¨å·å¿…å¤‡çš„;</li>
<li>3.Init C(åˆå§‹åŒ–å®¹å™¨): Pod èƒ½å¤Ÿå…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼Œåº”ç”¨è¿è¡Œåœ¨å®¹å™¨é‡Œé¢ï¼Œä½†æ˜¯å®ƒä¹Ÿå¯èƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå…ˆäºåº”ç”¨å®¹å™¨å¯åŠ¨çš„Initå®¹å™¨ã€‚<ul>
<li>2.1 Initå®¹å™¨ä¸æ™®é€šçš„å®¹å™¨åŒºåˆ«: Initå®¹å™¨æ€»æ˜¯è¿è¡Œåˆ°æˆåŠŸå®Œæˆä¸ºæ­¢ï¼Œæ¯ä¸ªInitå®¹å™¨éƒ½å¿…é¡»åœ¨ä¸‹ä¸€ä¸ªInitå®¹å™¨å¯åŠ¨ä¹‹å‰æˆåŠŸå®Œæˆï¼ˆ<code>æœ‰ä¸€å®šçš„é¡ºåº</code>ï¼‰ã€‚</li>
<li>2.2 å¦‚æœPodçš„Initå®¹å™¨å¤±è´¥ Kubernetesä¼šä¸æ–­åœ°é‡å¯è¯¥Podï¼Œç›´åˆ°Initå®¹å™¨æˆåŠŸä¸ºæ­¢ã€‚ä½†æ˜¯å¦‚æœ Pod å¯¹åº”çš„ <code>restartPolicyã€é»˜è®¤ä¸ºAlwaysã€‘ è®¾ç½®ä¸ºNever</code>ï¼Œå®ƒå°†ä¸ä¼šé‡æ–°å¯åŠ¨ã€‚</li>
</ul>
</li>
<li>4.Mian C(ä¸»å®¹å™¨ ): åœ¨Podä¸­å¯ä»¥è¿è¡Œä¸€ä¸ªå¤šä¸ªå®¹å™¨å®ƒä»¬éƒ½æœ‰å„è‡ªçš„ç”Ÿå‘½å‘¨æœŸ, å½“Podä¸­ä¸»å®¹å™¨ç»“æŸé€€å‡ºæ—¶Podå°†ç»“æŸ;</li>
<li>5.Start / Stop : åœ¨å®¹å™¨å¯åŠ¨æˆ–è€…åœæ­¢æ—¶å€™æ‰§è¡Œçš„è„šæœ¬</li>
<li>6.Readiness : åœ¨ä¸»å®¹å™¨å¯åŠ¨åè¿›è¡Œå…¶åº”ç”¨è¿›ç¨‹æ¢æµ‹ï¼Œå®Œæˆåå®¹å™¨çš„çŠ¶æ€å°†æ”¹å˜æˆRunning;</li>
<li>7.Liveness : åœ¨ä¸»å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸéƒ½æœ‰å®ƒçš„èº«å½±ï¼Œå…¶ä½œç”¨æ˜¯åœ¨ä¸»å®¹å™¨çš„è¿›ç¨‹ä¸å…¶æ£€æµ‹ç»“æœä¸ä¸€è‡´çš„æƒ…å†µä¸‹å°†æ‰§è¡Œé‡å¯æˆ–è€…åˆ é™¤å®¹å™¨;</li>
</ul>
<p><br/></p>
<h4 id="Pod-Phase"><a href="#Pod-Phase" class="headerlink" title="Pod Phase"></a>Pod Phase</h4><p>æè¿°: Podçš„statuså­—æ®µæ˜¯ä¿å­˜åœ¨ä¸€ä¸ªPodStatuså¯¹è±¡ä¸­ï¼Œè¯¥ PodStatus ä¸­æœ‰ä¸€ä¸ª phase å­—æ®µã€‚<br>Podçš„ç›¸ä½ï¼ˆphase) æ˜¯ Pod åœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­çš„ç®€å•å®è§‚æ¦‚è¿°ã€‚</p>
<p>PS : è¯¥é˜¶æ®µå¹¶ä¸æ˜¯å¯¹å®¹å™¨æˆ–Podçš„ç»¼åˆæ±‡æ€»ï¼Œä¹Ÿä¸æ˜¯ä¸ºäº†åšä¸ºç»¼åˆçŠ¶æ€æœº, å¹¶ä¸”Podç›¸ä½çš„æ•°é‡å’Œå«ä¹‰æ˜¯ä¸¥æ ¼æŒ‡å®šçš„ã€‚<br>PS : é™¤äº†æœ¬æ–‡æ¡£ä¸­åˆ—ä¸¾çš„çŠ¶æ€å¤–ä¸åº”è¯¥åœ¨å‡å®šPodæœ‰å…¶ä»–çš„phaseå€¼ </p>
<p><strong>Pod phase å¯èƒ½å­˜åœ¨çš„å‡ ç§çŠ¶æ€å€¼:</strong></p>
<ul>
<li>æŒ‚èµ·ï¼ˆPendingï¼‰ï¼šPod å·²è¢« Kubernetesç³»ç»Ÿæ¥å—ï¼Œä½†æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨é•œåƒå°šæœªåˆ›å»ºã€‚ç­‰å¾…æ—¶é—´åŒ…æ‹¬è°ƒåº¦Podçš„æ—¶é—´å’Œé€šè¿‡ç½‘ç»œä¸‹è½½é•œåƒçš„æ—¶é—´ï¼Œè¿™å¯èƒ½éœ€è¦èŠ±ç‚¹æ—¶é—´</li>
<li>è¿è¡Œä¸­ï¼ˆRunningï¼‰ï¼šè¯¥Pod å·²ç»ç»‘å®šåˆ°äº†ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼ŒPodä¸­æ‰€æœ‰çš„å®¹å™¨éƒ½å·²è¢«åˆ›å»ºã€‚è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨æ­£åœ¨è¿è¡Œï¼Œæˆ–è€…æ­£å¤„äºå¯åŠ¨æˆ–é‡å¯çŠ¶æ€</li>
<li>æˆåŠŸï¼ˆSucceededï¼‰ï¼šPodä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½è¢«æˆåŠŸç»ˆæ­¢ï¼Œå¹¶ä¸”ä¸ä¼šå†é‡å¯</li>
<li>å¤±è´¥ï¼ˆFailed)ï¼šPodä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å·²ç»ˆæ­¢äº†ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨æ˜¯å› ä¸ºå¤±è´¥ç»ˆæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´å®¹å™¨ä»¥é0çŠ¶æ€é€€å‡ºæˆ–è€…è¢«ç³»ç»Ÿç»ˆæ­¢</li>
<li>æœªçŸ¥ï¼ˆUnknownï¼‰ï¼šå› ä¸ºæŸäº›åŸå› æ— æ³•å–å¾—Podçš„çŠ¶æ€ï¼Œé€šå¸¸æ˜¯å› ä¸ºä¸Podæ‰€åœ¨ä¸»æœºé€šä¿¡å¤±è´¥</li>
</ul>
<p><br><br>Pod çš„ç”Ÿå‘½å‘¨æœŸç¤ºæ„å›¾ï¼ˆä»å›¾ä¸­å¯ä»¥çœ‹åˆ°PodçŠ¶æ€çš„å˜åŒ–ï¼‰</p>
<figure class="image-box">
                <a rel=4-Kuberneteså…¥é—¨åŸºç¡€ä¹‹Podä»‹ç» href="https://img.weiyigeek.top/2021/1/20210120152027.png" target="_blank" title="WeiyiGeek.Pod çš„ç”Ÿå‘½å‘¨æœŸç¤ºæ„å›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2021/1/20210120152027.png" alt="WeiyiGeek.Pod çš„ç”Ÿå‘½å‘¨æœŸç¤ºæ„å›¾" title="" class=""></a>
                <p>WeiyiGeek.Pod çš„ç”Ÿå‘½å‘¨æœŸç¤ºæ„å›¾</p>
            </figure>
<p><br></p>
<p>ç¤ºä¾‹1.Pod Phase ä¸ Pod è¿è¡ŒçŠ¶æ€æŸ¥çœ‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get  pod redis-cluster-operator-6669898858-rwm7s -o yaml  | grep <span class="string">" phase"</span></span><br><span class="line">  phase: Running</span><br><span class="line"></span><br><span class="line">$ kubectl describe pod redis-cluster-operator-6669898858-rwm7s | grep <span class="string">"^Status"</span></span><br><span class="line">  Status: Running</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="Pod-é‡å¯ç­–ç•¥"><a href="#Pod-é‡å¯ç­–ç•¥" class="headerlink" title="Pod é‡å¯ç­–ç•¥"></a>Pod é‡å¯ç­–ç•¥</h4><p>æè¿°: å½“ Pod ä¸­æŸä¸€ä¸ª Container å¤„äºé€€å‡ºçŠ¶æ€(Exited)æ—¶, Kubelet ä¼šæ ¹æ® Pod Sepc ä¸­ restartPolicy å­—æ®µçš„å–å€¼(<code>Always [ç¼ºçœ]ã€OnFailureå’ŒNever</code> è¿›è¡Œç›¸åº”çš„æ“ä½œ;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl explain statefulset.spec.template.spec | grep <span class="string">"restartPolicy"</span></span><br><span class="line">  restartPolicy. The name <span class="keyword">for</span> an init container or normal container must be</span><br><span class="line">  restartPolicy &lt;string&gt; <span class="comment"># only Support Always</span></span><br></pre></td></tr></table></figure>
<p><br/></p>
<p><strong>é‡å¯ç­–ç•¥è¯´æ˜:</strong></p>
<ul>
<li>Always : é»˜è®¤é‡å¯ç­–ç•¥åªè¦æœ‰ä¸€ä¸ªContainerå¤„äºExitedæ—¶ï¼Œå³ä¼šé‡å¯</li>
<li>OnFailure : å½“å®¹å™¨å¼‚å¸¸é€€å‡ºæˆ–é€€å‡ºçŠ¶æ€ä¸ä¸º0æ—¶ï¼Œå³ä¼šé‡å¯</li>
<li>Never : æ— è®ºå¦‚ä½•éƒ½ä¸é‡å¯</li>
</ul>
<p><br/></p>
<p><strong>è¡¥å……è¯´æ˜:</strong></p>
<ul>
<li><p>(1) å½“ä¸€ä¸ªpodè®¾ç½®é‡å¯ç­–ç•¥<code>restartPolicy</code>åˆ™é€‚ç”¨äºPod ä¸­çš„æ‰€æœ‰å®¹å™¨, è§¦å‘è§„åˆ™æ—¶é€šè¿‡åŒä¸€èŠ‚ç‚¹ä¸Šçš„kubeleté‡æ–°å¯åŠ¨å®¹å™¨ã€‚<br>restartPolicy ä»…æŒ‡, å¤±è´¥çš„å®¹å™¨<code>ç”± kubelet ä»¥äº”åˆ†é’Ÿä¸ºä¸Šé™çš„æŒ‡æ•°é€€é¿å»¶è¿Ÿï¼ˆ10ç§’ï¼Œ20ç§’ï¼Œ40ç§’...) é‡æ–°å¯åŠ¨</code>ï¼Œå¹¶åœ¨æˆåŠŸæ‰§è¡Œååˆ†é’Ÿåé‡ç½®ã€‚</p>
</li>
<li><p>(2) ä¸åŒæ§åˆ¶å™¨å¯¹ä¸åŒPodé‡å¯ç­–ç•¥çš„å¤„ç†æœºåˆ¶æ˜¯ä¸ä¸€æ ·çš„ä¾‹å¦‚</p>
<ul>
<li>2.1 ä½¿ç”¨ Job æ§åˆ¶å™¨åˆ›å»ºPODè¿è¡Œé¢„æœŸä¼šç»ˆæ­¢, å¦‚æ‰¹é‡è®¡ç®—æ­¤æ—¶Jobä»…é€‚ç”¨äºé‡å¯ç­–ç•¥ä¸º OnFailure æˆ– Never çš„ Pod;</li>
<li>2.2 ä½¿ç”¨ RCã€RSã€Deploymentã€StatefulSetæ§åˆ¶å™¨åˆ›å»ºçš„Podé¢„æœŸæ˜¯ä¸ä¼šç»ˆæ­¢çš„ï¼Œå¦‚WebæœåŠ¡å™¨æ³¨æ„RCä»…é€‚ç”¨äºå…·æœ‰ RestartPolicy ä¸º Always çš„Podã€‚</li>
<li>2.3 ä½¿ç”¨ DeamonSet æ§åˆ¶å™¨åˆ›å»ºçš„Podå°†ä¼šåœ¨æ¯å°å·¥ä½œèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œæä¾›ç‰¹å®šäºæœºå™¨çš„ç³»ç»ŸæœåŠ¡;</li>
</ul>
</li>
</ul>
<p>Tips : å¦‚Podæ–‡æ¡£ä¸­æ‰€è¿°ä¸€æ—¦ç»‘å®šåˆ°ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒPodå°†æ°¸è¿œä¸ä¼šé‡æ–°ç»‘å®šåˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>
<p><br/></p>
<p><strong>PodçŠ¶æ€ç¤ºä¾‹</strong></p>
<ul>
<li><p>â’ˆPod ä¸­åªæœ‰ä¸€ä¸ªå®¹å™¨å¹¶ä¸”æ­£åœ¨è¿è¡Œï¼Œå®¹å™¨æˆåŠŸé€€å‡º </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Â·è®°å½•äº‹ä»¶å®Œæˆ </span><br><span class="line">Â·å¦‚æœrestartPolicyä¸ºï¼š </span><br><span class="line">ã€€Alwaysï¼šé‡å¯å®¹å™¨ï¼›   <span class="comment">#Pod phase ä»ä¸º Running </span></span><br><span class="line">  OnFailure:         <span class="comment">#Pod phase å˜æˆ Succeeded </span></span><br><span class="line">ã€€Never:              <span class="comment">#Pod phase å˜æˆ Succeeded</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>â’‰Pod ä¸­åªæœ‰ä¸€ä¸ªå®¹å™¨å¹¶ä¸”æ­£åœ¨è¿è¡Œ,å®¹å™¨é€€å‡ºå¤±è´¥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Â·è®°å½•å¤±è´¥äº‹ä»¶</span><br><span class="line">Â·å¦‚æœrestartPolicyä¸ºï¼š</span><br><span class="line">  Always:é‡å¯å®¹å™¨ï¼›    <span class="comment">#Pod phase ä»ä¸º Running</span></span><br><span class="line">  OnFailureï¼šé‡å¯å®¹å™¨ï¼›<span class="comment">#Pod phase ä»ä¸º Running</span></span><br><span class="line">  Never:              <span class="comment">#Pod phase å˜æˆ Failed</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>â’ŠPod ä¸­æœ‰ä¸¤ä¸ªå®¹å™¨å¹¶ä¸”æ­£åœ¨è¿è¡Œã€‚<br>å¦‚æœå®¹å™¨1é€€å‡ºå¤±è´¥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è®°å½•å¤±è´¥äº‹ä»¶Â·</span><br><span class="line">å¦‚æœrestartPolicyä¸ºï¼š</span><br><span class="line">  Alwaysï¼šé‡å¯å®¹å™¨ï¼›   <span class="comment">#Pod phaseä»ä¸ºRunning </span></span><br><span class="line">  OnFailureï¼šé‡å¯å®¹å™¨ï¼›<span class="comment">#Pod phaseä»ä¸ºRunning</span></span><br><span class="line">  Neverï¼šä¸é‡å¯å®¹å™¨ï¼›  <span class="comment">#Pod phaseä»ä¸ºRunning</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>4.å¦‚æœæœ‰å®¹å™¨1æ²¡æœ‰å¤„äºè¿è¡ŒçŠ¶æ€å¹¶ä¸”å®¹å™¨2é€€å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è®°å½•å¤±è´¥äº‹ä»¶</span><br><span class="line">å¦‚æœrestartPolicyä¸ºï¼š</span><br><span class="line">  Alwaysï¼šé‡å¯å®¹å™¨ï¼›     <span class="comment">#Pod phaseä»ä¸ºRunning</span></span><br><span class="line">  OnFailureï¼šé‡å¯å®¹å™¨ï¼›  <span class="comment">#Pod phaseä»ä¸ºRunning</span></span><br><span class="line">  Neverï¼š               <span class="comment">#Pod phaseå˜æˆFailed</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>â’ŒPod ä¸­åªæœ‰ä¸€ä¸ªå®¹å™¨å¹¶å¤„äºè¿è¡ŒçŠ¶æ€ã€‚å®¹å™¨è¿è¡Œæ—¶å†…å­˜è¶…å‡ºé™åˆ¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Â·å®¹å™¨ä»¥å¤±è´¥çŠ¶æ€ç»ˆæ­¢è®°å½•0OMäº‹ä»¶</span><br><span class="line">Â·å¦‚æœrestartPolicyä¸ºï¼š</span><br><span class="line">  Always:é‡å¯å®¹å™¨ï¼›   <span class="comment">#Pod phaseä»ä¸ºRunning </span></span><br><span class="line">  OnFailure:é‡å¯å®¹å™¨ï¼›<span class="comment">#Pod phaseä»ä¸ºRunning</span></span><br><span class="line">  Neverï¼šè®°å½•å¤±è´¥äº‹ä»¶ï¼›<span class="comment">#Pod phaseä»ä¸ºFailed</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>â’Pod æ­£åœ¨è¿è¡Œç£ç›˜æ•…éšœ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Â·æ€æ‰æ‰€æœ‰å®¹å™¨ï¼Œè®°å½•é€‚å½“äº‹ä»¶</span><br><span class="line">Â·Pod phase å˜æˆ Failed</span><br><span class="line">Â·å¦‚æœä½¿ç”¨æ§åˆ¶å™¨æ¥è¿è¡Œ Pod å°†åœ¨å…¶ä»–èŠ‚ç‚¹é‡å»º</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>â’Pod æ­£åœ¨è¿è¡Œï¼Œå…¶èŠ‚ç‚¹è¢«åˆ†æ®µ<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Â·èŠ‚ç‚¹æ§åˆ¶å™¨ç­‰å¾…ç›´åˆ°è¶…æ—¶</span><br><span class="line">Â·èŠ‚ç‚¹æ§åˆ¶å™¨å°†Pod phaseè®¾ç½®ä¸ºFailed</span><br><span class="line">Â·å¦‚æœæ˜¯ç”¨æ§åˆ¶å™¨æ¥è¿è¡Œï¼ŒPod å°†åœ¨åˆ«å¤„é‡å»º</span><br></pre></td></tr></table></figure>
</li>
</ul>
<BR>

<h4 id="Pod-Init-å®¹å™¨"><a href="#Pod-Init-å®¹å™¨" class="headerlink" title="Pod Init å®¹å™¨"></a>Pod Init å®¹å™¨</h4><p><strong>Q: ä»€ä¹ˆæ˜¯ Init Container?</strong><br>æè¿°: ä¸€ä¸ªPodä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ª Init Container å³åˆå§‹åŒ–å®¹å™¨æ“ä½œ, å…¶å¯åŠ¨é¡ºåºå—yamlæ–‡ä»¶ä¸­æè¿°é¡ºåºå½±å“è¿›è¡Œå¯åŠ¨ï¼ˆä¸²è¡Œæ–¹å¼ï¼‰, è¿™è¡¨ç¤ºäº†æ¯ä¸ªå®¹å™¨å¿…é¡»åœ¨ä¸‹ä¸€ä¸ªå®¹å™¨å¯åŠ¨ä¹‹å‰æˆåŠŸé€€å‡ºï¼Œå¦åˆ™å°†ä¼šé˜»æ­¢åç»­çš„ init Container ä¸ app Container æœåŠ¡å¯åŠ¨ï¼Œä¾‹å¦‚ <code>init Container 1 -&gt;  init Container 2 .. -&gt;  init Container n -&gt; app Container</code>;</p>
<p><br/></p>
<p><strong>Q: Initå®¹å™¨çš„ä½œç”¨æœ‰é‚£äº›?</strong></p>
<blockquote>
<p>ç­”: å› ä¸ºInitå®¹å™¨å…·æœ‰ä¸åº”ç”¨ç¨‹åºå®¹å™¨åˆ†ç¦»çš„å•ç‹¬é•œåƒï¼Œæ‰€ä»¥åˆ©ç”¨å…¶ç‰¹å¾ä¸»è¦ä½œä¸º<code>æœåŠ¡ä¾èµ–å¤„ç†</code>, ä¾‹å¦‚æŸä¸ªæœåŠ¡Aéœ€ä¾èµ–dbæˆ–è€…Memcached, é‚£ä¹ˆå¯ä»¥åˆ©ç”¨æœåŠ¡A podçš„Init Containeråˆ¤æ–­dbdbæˆ–è€…Memcachedæ˜¯å¦æ­£å¸¸æä¾›æœåŠ¡ï¼Œå¦‚æœå¯åŠ¨æœåŠ¡å¤±è´¥æˆ–è€…å·¥ä½œå¼‚å¸¸ï¼Œåˆ™è®¾ç½®init å®¹å™¨ä¹Ÿå°†å¯åŠ¨å¤±è´¥å¹¶ä¸”podä¸­çš„app å®¹å™¨ä¹Ÿå°†ä¸ä¼šè¿è¡Œã€‚</p>
</blockquote>
<p>æ‰€ä»¥å®ƒä»¬çš„å¯åŠ¨ç›¸å…³ä»£ç å…·æœ‰å…¶å®ƒä¼˜åŠ¿ï¼š</p>
<blockquote>
<p>(1) å®ƒä»¬å¯ä»¥åŒ…å«å¹¶è¿è¡Œå®ç”¨å·¥å…·ï¼Œä½†æ˜¯å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæ˜¯ä¸å»ºè®®åœ¨åº”ç”¨ç¨‹åºå®¹å™¨é•œåƒä¸­åŒ…å«è¿™äº›å®ç”¨å·¥å…·çš„<br>(2) å®ƒä»¬å¯ä»¥åŒ…å«ä½¿ç”¨å·¥å…·å’Œå®šåˆ¶åŒ–ä»£ç æ¥å®‰è£…ï¼Œä½†æ˜¯ä¸èƒ½å‡ºç°åœ¨åº”ç”¨ç¨‹åºé•œåƒä¸­ã€‚ä¾‹å¦‚åˆ›å»ºé•œåƒæ²¡å¿…è¦FROMå¦ä¸€ä¸ªé•œåƒï¼Œåªéœ€è¦åœ¨å®‰è£…è¿‡ç¨‹ä¸­ä½¿ç”¨ç±»ä¼¼sedã€awkã€pythonæˆ–digè¿™æ ·çš„å·¥å…·ã€‚<br>(3) åº”ç”¨ç¨‹åºé•œåƒå¯ä»¥åˆ†ç¦»å‡ºåˆ›å»ºå’Œéƒ¨ç½²çš„è§’è‰²ï¼Œè€Œæ²¡æœ‰å¿…è¦è”åˆå®ƒä»¬æ„å»ºä¸€ä¸ªå•ç‹¬çš„é•œåƒã€‚<br>(4) Init å®¹å™¨ä½¿ç”¨Linux Namespaceï¼Œæ‰€ä»¥ç›¸å¯¹åº”ç”¨ç¨‹åºå®¹å™¨æ¥è¯´å…·æœ‰ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿè§†å›¾ã€‚å› æ­¤å®ƒä»¬èƒ½å¤Ÿå…·æœ‰è®¿é—®Secretçš„æƒé™è€Œåº”ç”¨ç¨‹åºå®¹å™¨åˆ™ä¸èƒ½(<code>ç®€å•çš„è¯´ Init Containerä¹Ÿå¯è¢«æˆæƒè®¿é—®åº”ç”¨Containeræ— æƒè®¿é—®çš„å†…å®¹</code>)ã€‚<br>(5) å®ƒä»¬å¿…é¡»åœ¨åº”ç”¨ç¨‹åºå®¹å™¨å¯åŠ¨ä¹‹å‰è¿è¡Œå®Œæˆï¼Œè€Œ<code>åº”ç”¨ç¨‹åºå®¹å™¨æ˜¯å¹¶è¡Œè¿è¡Œçš„</code>ï¼Œæ‰€ä»¥Initå®¹å™¨èƒ½å¤Ÿæä¾›äº†ä¸€ç§ç®€å•çš„é˜»å¡æˆ–å»¶è¿Ÿåº”ç”¨å®¹å™¨çš„å¯åŠ¨çš„æ–¹æ³•ï¼Œç›´åˆ°æ»¡è¶³äº†ä¸€ç»„å…ˆå†³æ¡ä»¶ã€‚</p>
</blockquote>
<p><br></p>
<p><strong>init å®¹å™¨è¡¥å……è¯´æ˜:</strong></p>
<ul>
<li><p>åœ¨Podå¯åŠ¨è¿‡ç¨‹ä¸­Init å®¹å™¨ä¼šæŒ‰é¡ºåºåœ¨ç½‘ç»œå’Œæ•°æ®å·åˆå§‹åŒ–ä¹‹åå¯åŠ¨ã€å³åœ¨pauseå¯åŠ¨ä¹‹åå¯åŠ¨ï¼Œpodç¬¬ä¸€ä¸ªå¯åŠ¨çš„å®¹å™¨å¹¶ä¸æ˜¯Initè€Œæ˜¯pause, ä½†pauseä»…ä»…åªè´Ÿè´£åˆå§‹åŒ–ç½‘ç»œå’Œæ•°æ®å·å…¶å®ƒä»€ä¹ˆæ“ä½œéƒ½ä¸èƒ½åšï¼Œæˆ‘ä»¬å¯æ“ä½œçš„ç©ºé—´å‡ ä¹ä¸º0å› æ­¤ä¸åšæè¿°ã€‘ã€‚</p>
</li>
<li><p>å¦‚æœç”±äºè¿è¡Œæ—¶æˆ–å¤±è´¥é€€å‡ºï¼Œå°†å¯¼è‡´å®¹å™¨å¯åŠ¨å¤±è´¥ï¼Œå®ƒä¼šæ ¹æ®Podçš„<code>restart Policy</code>æŒ‡å®šçš„ç­–ç•¥è¿›è¡Œé‡è¯•ã€‚ç„¶è€Œï¼Œå¦‚æœPodçš„restartPolicyè®¾ç½®ä¸ºAlwaysï¼ŒInit å®¹å™¨å¤±è´¥æ—¶ä¼šä½¿ç”¨RestartPolicy ç­–ç•¥</p>
</li>
<li><p>ä»ä¸Šé¢<code>Pod åˆ›å»ºè¿‡ç¨‹ä¸å„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾</code>ä¸­å¯çŸ¥<code>Init Container</code>å¿…é¡»è¦åœ¨PodçŠ¶æ€å˜æˆReadyä¹‹å‰å®Œæˆ(å…¶ä¸éœ€è¦readiness), ä»¥åŠåœ¨èµ„æºçš„requestå’Œlimitsä¸app container æœ‰äº›è®¸å·®åˆ«ï¼Œé™¤ä»¥ä¸Šä¸¤ç§init å®¹å™¨ ä¸ app å®¹å™¨ å¤§è‡´ç›¸åŒï¼›</p>
</li>
<li><p>åœ¨æ‰€æœ‰çš„Initå®¹å™¨æ²¡æœ‰æˆåŠŸä¹‹å‰ï¼ŒPodå°†ä¸ä¼šå˜æˆReadyçŠ¶æ€ã€‚Initå®¹å™¨çš„ç«¯å£å°†ä¸ä¼šåœ¨Serviceä¸­è¿›è¡Œèšé›†ã€‚æ­£åœ¨åˆå§‹åŒ–ä¸­çš„Podå¤„äºPendingçŠ¶æ€ï¼Œä½†åº”è¯¥ä¼šå°†InitializingçŠ¶æ€è®¾ç½®ä¸ºtrue</p>
</li>
<li><p>å¦‚æœPod é‡å¯ï¼Œæ‰€æœ‰Initå®¹å™¨å¿…é¡»é‡æ–°æ‰§è¡Œï¼Œå› æ­¤Initå®¹å™¨åº”è¯¥é…ç½®ä¸ºå¹‚ç­‰çš„çŠ¶æ€ã€‚</p>
</li>
<li><p>Init å®¹å™¨å…·æœ‰åº”ç”¨å®¹å™¨çš„æ‰€æœ‰å­—æ®µã€‚é™¤äº†readiness Probeå› ä¸ºInitå®¹å™¨æ— æ³•å®šä¹‰ä¸åŒäºå®Œæˆï¼ˆcompletion)çš„å°±ç»ªï¼ˆreadiness)ä¹‹å¤–çš„å…¶ä»–çŠ¶æ€(<code>ä¼šåœ¨éªŒè¯è¿‡ç¨‹ä¸­å¼ºåˆ¶æ‰§è¡Œ</code>)</p>
</li>
<li><p>åœ¨ Pod ä¸­çš„æ¯ä¸ªappå’ŒInitå®¹å™¨çš„åç§°å¿…é¡»å”¯ä¸€ï¼›ä¸ä»»ä½•å…¶å®ƒå®¹å™¨å…±äº«åŒä¸€ä¸ªåç§°ï¼Œä¼šåœ¨éªŒè¯æ—¶æŠ›å‡ºé”™è¯¯ï¼›å½“ç„¶ä½ å¯ä»¥åŠ ä¸Šä¸€ä¸ªåç§°ç©ºé—´æ¥é˜²æ­¢å†²çª;</p>
</li>
</ul>
<ul>
<li>å¯¹Initå®¹å™¨specçš„ä¿®æ”¹è¢«é™åˆ¶åœ¨å®¹å™¨imageå­—æ®µï¼Œä¿®æ”¹å…¶ä»–å­—æ®µéƒ½ä¸ä¼šç”Ÿæ•ˆã€‚æ›´æ”¹Initå®¹å™¨çš„imageå­—æ®µï¼Œç­‰ä»·äºé‡å¯è¯¥Pod<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl edit -n <span class="built_in">test</span> pod myapp-pod</span><br><span class="line">......</span><br><span class="line"><span class="comment"># ä»¥ä¸€ä¸ª init C å®¹å™¨ ä¸ºä¾‹</span></span><br><span class="line">initContainers:</span><br><span class="line">  - <span class="built_in">command</span>:</span><br><span class="line">    - sh</span><br><span class="line">    - -c</span><br><span class="line">    - until nslookup myservice;<span class="keyword">do</span> <span class="built_in">echo</span> waiting <span class="keyword">for</span> myservice;sleep 2; <span class="keyword">done</span>;</span><br><span class="line">    image: busybox  <span class="comment"># è¡¨æ˜çš„æ„æ€æ˜¯åªæœ‰åœ¨æ›´æ”¹é•œåƒåç§°æ—¶ Init å®¹å™¨æ‰ä¼šé‡æ–°æ‰§è¡Œinit Cé˜¶æ®µ, ä¿®æ”¹å…¶ä»–å­—æ®µæ— ä»»ä½•æ•ˆæœ;</span></span><br><span class="line">    imagePullPolicy: Always</span><br><span class="line">    name: init-myservice</span><br><span class="line">    resources: &#123;&#125;</span><br><span class="line">    terminationMessagePath: /dev/termination-log</span><br><span class="line">    terminationMessagePolicy: File</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - mountPath: /var/run/secrets/kubernetes.io/serviceaccount</span><br><span class="line">      name: default-token-bk9vl</span><br><span class="line">      readOnly: <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<p><strong>Init å®¹å™¨ä½¿ç”¨ç®€å•ç¤ºä¾‹:</strong></p>
<ul>
<li>Podèµ„æºæ¸…å•<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; ~/K8s/Day3/initC.yaml &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line"><span class="comment"># åç§°ç©ºé—´çš„åˆ›å»º</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:   </span><br><span class="line">  name: <span class="built_in">test</span>     <span class="comment"># åˆ›å»ºçš„åç§°ç©ºé—´çš„åç§°(æ³¨æ„å»ºè®®å’Œlabelsä¿æŒä¸€è‡´å¹¶ä¸”ä¸ºå°å†™)</span></span><br><span class="line">  labels:     </span><br><span class="line">    name: <span class="built_in">test</span></span><br><span class="line">---</span><br><span class="line">kind: Pod         <span class="comment"># å¯¹è±¡çš„RESTèµ„æºç±»å‹æ³¨æ„é¦–å­—æ¯å¿…é¡»å¤§å°(å‘)</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: myapp-pod  <span class="comment"># podçš„åç§°</span></span><br><span class="line">  namespace: <span class="built_in">test</span>  <span class="comment"># è¯¥PodåŠ å…¥çš„åç§°ç©ºé—´</span></span><br><span class="line">  labels:</span><br><span class="line">    app: myapp     <span class="comment">#è¯¥podæ‰€æ‹¥æœ‰çš„æ ‡ç­¾</span></span><br><span class="line">    version: v1    </span><br><span class="line">    author: weiyigeek</span><br><span class="line">spec:</span><br><span class="line">  containers:       <span class="comment"># è¦è¿è¡Œå®¹å™¨çš„åˆ—è¡¨</span></span><br><span class="line">  - name: myapp-main-container </span><br><span class="line">    image: busybox </span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">'sh'</span>,<span class="string">'-c'</span>,<span class="string">'echo The app is running!&amp;&amp; sleep 3600'</span>] </span><br><span class="line">  initContainers:   <span class="comment"># åœ¨Main Cå®¹å™¨åˆ›å»ºå‰è¿è¡Œçš„Init Cå®¹å™¨ï¼Œæ³¨æ„å®‰è£…å®šä¹‰çš„é¡ºåºä¾æ¬¡æ‰§è¡Œ;</span></span><br><span class="line">  - name: init-myservice   <span class="comment"># é˜¶æ®µ1.ä»¥ç®€å•çš„æ¢æµ‹æœåŠ¡æ˜¯å¦å­˜å†æ¥è¿è¡Œä¸»å®¹å™¨ä»¥è¾¾åˆ°å®¹å™¨é—´ä¾èµ–é—®é¢˜çš„è§£å†³;</span></span><br><span class="line">    image: busybox </span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">'sh'</span>,<span class="string">'-c'</span>,<span class="string">'until nslookup myservice;do echo waiting for myservice;sleep 2; done;'</span>]  <span class="comment"># è¿”å›ä¸º0æ—¶å€™è¿›å…¥ä¸‹ä¸€init Cå®¹å™¨é˜¶æ®µ</span></span><br><span class="line">  - name: init-mydb        <span class="comment"># é˜¶æ®µ2</span></span><br><span class="line">    image: busybox  </span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">'sh'</span>,<span class="string">'-c'</span>,<span class="string">'until nslookup mydb;do echo waiting for mydb;sleep 2;done;'</span>]</span><br><span class="line">  - name: init-serverA</span><br><span class="line">    images: busybox</span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">'sh'</span>,<span class="string">'-c'</span>,<span class="string">"curl --connect-timeout 3 --max-time 5 --retry 10 --retry-delay 5 --retry-max-time 60 http://serverB:port/Path/"</span>]</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li>
<li>Service èµ„æºæ¸…å•<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; ~/K8s/Day3/dependService.yaml &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line"> name: myservice</span><br><span class="line"> namespace: <span class="built_in">test</span></span><br><span class="line">spec:</span><br><span class="line"> selector:</span><br><span class="line">    app: myapp</span><br><span class="line"> ports:</span><br><span class="line">  - protocol: TCP</span><br><span class="line">    port: 80 </span><br><span class="line">    targetPort: 9376</span><br><span class="line">---</span><br><span class="line">kind: Service </span><br><span class="line">apiVersion: v1 </span><br><span class="line">metadata:</span><br><span class="line">  name: mydb</span><br><span class="line">  namespace: <span class="built_in">test</span></span><br><span class="line">spec:</span><br><span class="line"> selector:</span><br><span class="line">    author: weiyigeek</span><br><span class="line"> ports:</span><br><span class="line">  - protocol: TCP </span><br><span class="line">    port: 80 </span><br><span class="line">    targetPort: 9377</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>æ‰§è¡Œéƒ¨ç½²:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0.éƒ¨ç½²æµ‹è¯•init Cçš„podèµ„æºæ¸…å•</span></span><br><span class="line">weiyigeek@ubuntu:~/K8s/Day3$ kubectl create -f initC.yaml</span><br><span class="line">  <span class="comment"># namespace/test created</span></span><br><span class="line">  <span class="comment"># pod/myapp-pod created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.æŸ¥çœ‹ åç§°ç©ºé—´ä¸Pod çŠ¶æ€(æ­¤æ—¶å¯ä»¥çœ‹è§Init0/2è¿˜æœªé€šè¿‡åˆ™è¯¥Podçš„çŠ¶æ€ä¸ºNot Ready, æ˜¯ç”±äºInit å®¹å™¨æ£€æµ‹æœªé€šè¿‡)</span></span><br><span class="line">weiyigeek@ubuntu:~/K8s/Day3$ kubectl get pod -n <span class="built_in">test</span></span><br><span class="line">  <span class="comment"># NAME        READY   STATUS     RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># myapp-pod   0/1     Init:0/3   0          33s</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.éƒ¨ç½²æµ‹è¯•init Cçš„Serviceèµ„æºæ¸…å•</span></span><br><span class="line">kubectl create -f dependService.yaml</span><br><span class="line">  <span class="comment"># service/myservice created</span></span><br><span class="line">  <span class="comment"># service/mydb created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æŸ¥å…¶å®¹å™¨è¿è¡Œæµç¨‹æ—¥å¿—ä»¥åŠçŠ¶æ€</span></span><br><span class="line">weiyigeek@ubuntu:~$ kubectl describe pod -n <span class="built_in">test</span> myapp-pod</span><br><span class="line">  <span class="comment"># Init Containers:</span></span><br><span class="line">  <span class="comment">#   init-myservice:  # é˜¶æ®µ1</span></span><br><span class="line">  <span class="comment">#     Container ID:  docker://70ab169e9359e448c55267ff818f210a54b0348dc436cd4abd2b4db27fc4932c</span></span><br><span class="line">  <span class="comment">#     Image:         busybox</span></span><br><span class="line">  <span class="comment">#     Image ID:      docker-pullable://busybox@sha256:a9286defaba7b3a519d585ba0e37d0b2cbee74ebfe590960b0b1d6a5e97d1e1d</span></span><br><span class="line">  <span class="comment">#     Port:          &lt;none&gt;</span></span><br><span class="line">  <span class="comment">#     Host Port:     &lt;none&gt;</span></span><br><span class="line">  <span class="comment">#     Command:</span></span><br><span class="line">  <span class="comment">#       sh</span></span><br><span class="line">  <span class="comment">#       -c</span></span><br><span class="line">  <span class="comment">#       until nslookup myservice;do echo waiting for myservice;sleep 2; done;</span></span><br><span class="line">  <span class="comment">#     State:          Terminated</span></span><br><span class="line">  <span class="comment">#       Reason:       Completed</span></span><br><span class="line">  <span class="comment">#       Exit Code:    0    # æ­£å¸¸é€€å‡º</span></span><br><span class="line">  <span class="comment">#       Started:      Sun, 08 Nov 2020 22:49:58 +0800</span></span><br><span class="line">  <span class="comment">#       Finished:     Sun, 08 Nov 2020 22:51:06 +0800</span></span><br><span class="line">  <span class="comment">#     Ready:          True  # å®¹å™¨çŠ¶æ€</span></span><br><span class="line">  <span class="comment">#     Restart Count:  0</span></span><br><span class="line">  <span class="comment">#     Environment:    &lt;none&gt;</span></span><br><span class="line">  <span class="comment">#     Mounts:</span></span><br><span class="line">  <span class="comment">#       /var/run/secrets/kubernetes.io/serviceaccount from default-token-bk9vl (ro)</span></span><br><span class="line">  <span class="comment">#   init-mydb:       # é˜¶æ®µ2 </span></span><br><span class="line">  <span class="comment">#     Container ID:  docker://306e36d57d75c92f3df10756140f3901dbcc22c1fd89439b8e365a348ca4cb6b</span></span><br><span class="line">  <span class="comment">#     Image:         busybox</span></span><br><span class="line">  <span class="comment">#     Image ID:      docker-pullable://busybox@sha256:a9286defaba7b3a519d585ba0e37d0b2cbee74ebfe590960b0b1d6a5e97d1e1d</span></span><br><span class="line">  <span class="comment">#     Port:          &lt;none&gt;</span></span><br><span class="line">  <span class="comment">#     Host Port:     &lt;none&gt;</span></span><br><span class="line">  <span class="comment">#     Command:</span></span><br><span class="line">  <span class="comment">#       sh</span></span><br><span class="line">  <span class="comment">#       -c</span></span><br><span class="line">  <span class="comment">#       until nslookup mydb;do echo waiting for mydb;sleep 2;done;</span></span><br><span class="line">  <span class="comment">#     State:          Terminated</span></span><br><span class="line">  <span class="comment">#       Reason:       Completed</span></span><br><span class="line">  <span class="comment">#       Exit Code:    0</span></span><br><span class="line">  <span class="comment">#       Started:      Sun, 08 Nov 2020 22:51:12 +0800</span></span><br><span class="line">  <span class="comment">#       Finished:     Sun, 08 Nov 2020 22:51:17 +0800</span></span><br><span class="line">  <span class="comment">#     Ready:          True</span></span><br><span class="line">  <span class="comment">#     Restart Count:  0</span></span><br><span class="line">  <span class="comment">#     Environment:    &lt;none&gt;</span></span><br><span class="line">  <span class="comment">#     Mounts:</span></span><br><span class="line">  <span class="comment">#       /var/run/secrets/kubernetes.io/serviceaccount from default-token-bk9vl (ro)</span></span><br><span class="line">...</span><br><span class="line">Events:  <span class="comment"># Pod åˆ›å»º ä»¥åŠ å®¹å™¨åˆ›å»ºçš„äº‹ä»¶è¿‡ç¨‹</span></span><br><span class="line">  Type    Reason     Age   From               Message</span><br><span class="line">  ----    ------     ----  ----               -------</span><br><span class="line">  Normal  Scheduled  113s  default-scheduler  Successfully assigned <span class="built_in">test</span>/myapp-pod to k8s-node-4</span><br><span class="line"></span><br><span class="line">  Normal  Pulling    113s  kubelet            Pulling image <span class="string">"busybox"</span></span><br><span class="line">  Normal  Pulled     108s  kubelet            Successfully pulled image <span class="string">"busybox"</span> <span class="keyword">in</span> 4.499850144s</span><br><span class="line">  Normal  Created    108s  kubelet            Created container init-myservice</span><br><span class="line">  Normal  Started    108s  kubelet            Started container init-myservice</span><br><span class="line"></span><br><span class="line">  Normal  Pulling    40s   kubelet            Pulling image <span class="string">"busybox"</span></span><br><span class="line">  Normal  Pulled     34s   kubelet            Successfully pulled image <span class="string">"busybox"</span> <span class="keyword">in</span> 5.078096509s</span><br><span class="line">  Normal  Created    34s   kubelet            Created container init-mydb</span><br><span class="line">  Normal  Started    34s   kubelet            Started container init-mydb</span><br><span class="line"></span><br><span class="line">  Normal  Pulling    28s   kubelet            Pulling image <span class="string">"busybox"</span></span><br><span class="line">  Normal  Pulled     25s   kubelet            Successfully pulled image <span class="string">"busybox"</span> <span class="keyword">in</span> 3.215811094s</span><br><span class="line">  Normal  Created    25s   kubelet            Created container myapp-main-container</span><br><span class="line">  Normal  Started    25s   kubelet            Started container myapp-main-container</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.åœ¨Init Cå®¹å™¨å¯åŠ¨å®Œæ¯•åï¼ŒMain Cè¿›è¡Œå¯åŠ¨æ­£å¸¸åçŠ¶æ€ä¸ºRuning</span></span><br><span class="line">weiyigeek@ubuntu:~$ kubectl get pod -n <span class="built_in">test</span></span><br><span class="line">  <span class="comment"># NAME        READY   STATUS    RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># myapp-pod   1/1     Running   0          2m8s</span></span><br></pre></td></tr></table></figure></p>
<p>Tips : å¦‚Podé‡å¯äº†æ‰€æœ‰çš„Init Containerå°†ä¼šé‡æ–°è¿è¡Œï¼Œç”±äºK8sç¦æ­¢init Containerä½¿ç”¨ <code>readiness</code> æ¢é’ˆ, åˆ™å¯ä»¥ä½¿ç”¨Podå®šä¹‰ activeDeadineSeconds (<code>åŒ…å« init Container å¯åŠ¨æ—¶é—´</code>) å’Œ Container çš„ <code>livenessProbe</code> é˜²æ­¢ init å®¹å™¨é‡å¤å¤±è´¥</p>
<p><br/></p>
<h4 id="Pod-å®¹å™¨æ¢é’ˆ"><a href="#Pod-å®¹å™¨æ¢é’ˆ" class="headerlink" title="Pod å®¹å™¨æ¢é’ˆ"></a>Pod å®¹å™¨æ¢é’ˆ</h4><p><strong>Q: ä»€ä¹ˆæ˜¯å®¹å™¨æ¢é’ˆ(Probe)?</strong></p>
<blockquote>
<p>ç­”: æ¢é’ˆæ˜¯ç”±å„ä¸ªèŠ‚ç‚¹(Node)çš„kubeletå¯¹å®¹å™¨æ‰§è¡Œçš„å®šæœŸè¯Šæ–­ï¼Œè€Œæ‰§è¡Œè¯Šæ–­æ—¶kubeletéœ€è°ƒç”¨ç”±å®¹å™¨å®ç°çš„<code>Handler å¤„ç†ç¨‹åº</code>, æ³¨æ„å®ƒä¸æ˜¯åœ¨<code>Main C</code>ä¹‹å†…è¿™æ˜¯ä¸ºäº†ä¾¿äºå‡å°‘ä¸»å®¹å™¨è¿è¡Œå‹åŠ›ã€‚</p>
</blockquote>
<p><br></p>
<p><strong>Q: ä¸ºä»€ä¹ˆéœ€è¦æ¢é’ˆ?</strong></p>
<blockquote>
<p>ç­”: å¯¹äºçº¿ä¸Šä¸šåŠ¡æ¥è¯´ä¿è¯æœåŠ¡çš„æ­£å¸¸æ˜¯ç¨³å®šæ˜¯é‡ä¸­ä¹‹é‡,è€Œå¯¹æ•…éšœæœåŠ¡çš„åŠæ—¶å¤„ç†é¿å…å½±å“ä¸šåŠ¡ä»¥åŠå¿«é€Ÿæ¢å¤ä¸€ç›´æ˜¯å¼€å‘è¿ç»´çš„éš¾ç‚¹ã€‚è€Œé‡‡ç”¨ K8s æä¾›çš„ä¸¤ç§æ¢é’ˆæ–¹å¼ï¼ˆreadiness Probeã€Liveness Probeï¼‰è¿›è¡Œå¥åº·æ£€æŸ¥æœåŠ¡ï¼Œå¦‚æ£€æµ‹åˆ°æ•…éšœæœåŠ¡å°†ä¼šè¢«åŠæ—¶ä¸‹çº¿åŠé€šè¿‡é‡å¯æœåŠ¡çš„æ–¹å¼ä½¿æœåŠ¡è‡ªåŠ¨æ¢å¤;</p>
</blockquote>
<p><br></p>
<p><strong>Q: readiness Probe<code>è‹± /ËˆredinÉ™s/(å‡†å¤‡å°±ç»ª) è‹± /prÉ™ÊŠb/</code> ä¸ liveness Probe<code>/laivnis/(ç”Ÿå­˜)</code> æ¢æµ‹æ–¹å¼?</strong></p>
<ul>
<li><p><code>readiness Probe</code>ã€å°±ç»ªæŒ‡é’ˆæˆ–å«å°±ç»ªæ¢é’ˆ-é’ˆå¯¹äºæœåŠ¡ã€‘: æŒ‡ç¤ºåˆ¤æ–­å®¹å™¨æ˜¯å¦å‡†å¤‡å¥½<code>æœåŠ¡</code>è¯·æ±‚ã€‚å¦‚æœå°±ç»ªæ¢æµ‹å¤±è´¥ï¼ˆæœåŠ¡æœªåŠ è½½æˆ–å·¥ä½œåŠ è½½å¼‚å¸¸ï¼‰ï¼Œç«¯ç‚¹æ§åˆ¶å™¨å°†ä»ä¸ Pod æ‰€åŒ¹é…çš„Service çš„ç«¯ç‚¹ä¸­åˆ é™¤è¯¥Podçš„IPåœ°å€ã€‚</p>
<ul>
<li>ç®€å•çš„è¯´å½“æœåŠ¡æ²¡æœ‰Readyæ—¶ä¼šå°†å…¶ä»æœåŠ¡çš„Load Balancerä¸­ç§»é™¤ï¼Œå¹¶ä¸ä¼šå†æ¥å—æˆ–è€…å“åº”ä»»ä½•è¯·æ±‚; </li>
<li>å¦‚æœå®¹å™¨ä¸æä¾›å°±ç»ªæ¢é’ˆ, åˆ™é»˜è®¤çŠ¶æ€ä¸ºSuccessï¼›åˆå§‹å»¶è¿Ÿä¹‹å‰çš„å°±ç»ªçŠ¶æ€é»˜è®¤ä¸ºFailureã€‚</li>
</ul>
</li>
<li><p><code>liveness Probe</code>ã€å­˜æ´»æŒ‡é’ˆæˆ–å«å­˜æ´»æ¢é’ˆ-é’ˆå¯¹äºå®¹å™¨ã€‘: æŒ‡ç¤ºåˆ¤æ–­<code>å®¹å™¨</code>æ˜¯å¦æ­£åœ¨è¿è¡Œã€‚å¦‚æœå­˜æ´»æ¢æµ‹å¤±è´¥(æœåŠ¡Crashæˆ–è€…æ­»é”ç­‰æƒ…å†µå‘é€æ—¶)ï¼Œåˆ™kubeletä¼šæ€æ­»å®¹å™¨ï¼Œè€Œå®¹å™¨å°†å—åˆ°å…¶é‡å¯ç­–ç•¥(<code>spec.restartPolicy: Always</code>)çš„å½±å“è¿›è¡Œé‡å¯å®¹å™¨æˆ–è€…åˆ†å‘åˆ°å…¶å®ƒæœºå™¨ä¸Šè¿›è¡Œè¿è¡Œ;</p>
<ul>
<li>å¦‚æœå®¹å™¨ä¸æä¾›å­˜æ´»æ¢é’ˆ, åˆ™é»˜è®¤çŠ¶æ€ä¸ºSuccess;</li>
</ul>
</li>
</ul>
<p><br></p>
<p><strong>Q: æ¢é’ˆå¦‚ä½•å®ç°æœåŠ¡å¯ç”¨æ€§ä¸è‡ªåŠ¨æ¢å¤?</strong></p>
<blockquote>
<p>1) å¦‚æœåŠ¡çš„ Readiness Probe å¥åº·æ£€æŸ¥å¤±è´¥, åˆ™æ•…éšœæœåŠ¡å®ä¾‹ä»Service Endpointä¸­å‰”é™¤ï¼Œå¤–éƒ¨è¯·æ±‚å°†ä¸ä¼šè½¬å‘åˆ°è¯¥æ•…éšœæœåŠ¡å®ä¾‹ä¸­;<br>2) å¦‚å¯¹è¯¥æ•…éšœæœåŠ¡å®ä¾‹è®¾ç½®äº† Liveness çš„æ¢é’ˆå°†ä¼šå¤±æ•ˆï¼Œ å¹¶ä¸”è¯¥Containerä¼šè¢«Killæ‰ï¼Œç„¶åæ ¹æ®restartPolicyç­–ç•¥å°†ä¼šåœ¨å½“å‰èŠ‚ç‚¹é‡å¯å®¹å™¨æˆ–è€…å…¶å®ƒå¯ç”¨èŠ‚ç‚¹é‡å»ºå®¹å™¨;</p>
</blockquote>
<p>Tips : å¦‚æ­¤æ—¶æœåŠ¡è‡ªæˆ‘æ¢å¤äº†(ç½‘ç»œé—®é¢˜å¯¼è‡´)ï¼Œå…¶å°†ä¼šè‡ªåŠ¨é‡æ–°åŠ å…¥<code>Service Endpoint</code>å¯¹å¤–æä¾›æœåŠ¡, åŸºäºä¸Šè¿°æœºåˆ¶æ•´ä¸ªæœåŠ¡å®ç°äº†è‡ªèº«å¯ç”¨ä¸è‡ªåŠ¨æ¢å¤;</p>
<p><br></p>
<p><strong>Probe æ¢æµ‹åé¦ˆç»“æœ</strong></p>
<blockquote>
<p>æˆåŠŸ(Success)ï¼šå®¹å™¨é€šè¿‡äº†è¯Šæ–­ã€‚<br>å¤±è´¥(Failure)ï¼šå®¹å™¨æœªé€šè¿‡è¯Šæ–­ã€‚<br>æœªçŸ¥(Unknown)ï¼šè¯Šæ–­å¤±è´¥å› æ­¤ä¸ä¼šé‡‡å–ä»»ä½•è¡ŒåŠ¨ã€è¿™å°†å¯¼è‡´å®¹å™¨æŒ‚æ­»ï¼Œå› ä¸ºæ¢é’ˆä¸æ‰§è¡ŒæˆåŠŸçš„è¯å®¹å™¨ä¼šä¸€ç›´åœ¨ç­‰å¾…ã€‘</p>
</blockquote>
<p><br></p>
<p><strong>Probe ç›‘æ§æ£€æŸ¥æ–¹å¼</strong><br>Probe Handler å¤„ç†ç¨‹åºç±»å‹:</p>
<blockquote>
<p>ExecActionï¼šåœ¨å®¹å™¨ Container å†…æ‰§è¡ŒæŒ‡å®š Shell å‘½ä»¤ã€‚ <code>å¦‚æœå‘½ä»¤é€€å‡ºæ—¶è¿”å›ç ä¸º0åˆ™è®¤ä¸ºè¯Šæ–­æˆåŠŸã€‚</code><br>TCPSocketAction: å¯¹æŒ‡å®šç«¯å£ä¸Šçš„å®¹å™¨ Container çš„IPåœ°å€ã€ç«¯å£è¿›è¡ŒTCPæ£€æŸ¥ã€‚<code>å¦‚æœç«¯å£æ‰“å¼€åˆ™è¯Šæ–­è¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„ã€‚</code><br>HTTPGetAction: å¯¹æŒ‡å®šçš„ç«¯å£å’Œè·¯å¾„ä¸Šçš„å®¹å™¨ Container çš„IPåœ°å€ã€ç«¯å£ã€Pathè·¯å¾„æ‰§è¡ŒHTTPGetè¯·æ±‚ã€‚<code>å¦‚æœå“åº”çš„çŠ¶æ€ç å¤§äºç­‰äº200ä¸”å°äº400 [2xxï¼šæˆåŠŸï¼Œ3xxï¼šè·³è½¬] åˆ™è¯Šæ–­è¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„;</code></p>
</blockquote>
<p><br></p>
<p><strong>Probe ä½¿ç”¨å»ºè®®</strong></p>
<blockquote>
<p>1.å»ºè®®å¯¹å…¨éƒ¨æœåŠ¡å®ä¾‹åŒæ—¶è®¾ç½® <code>æœåŠ¡ Readiness æ¢é’ˆ</code> å’Œ <code>å®¹å™¨ Liveiness æ¢é’ˆ</code>è¿›è¡Œå¥åº·æ£€æŸ¥;<br>2.åœ¨å¯¹ç«¯å£TCPSocketActionæ£€æµ‹çš„åŒæ—¶ä¸€èˆ¬å»ºè®®ä½¿ç”¨ExecActionæˆ–è€…HTTPGetActionå»è¿›è¡Œå¥åº·æ£€æŸ¥;<br>3.æ— è®ºé‡‡ç”¨å“ªç§ç±»å‹æ¢é’ˆå»ºè®®Readiness æ¢é’ˆçš„æ—¶é—´çŸ­äº Liveiness æ¢é’ˆæ—¶é—´ï¼Œå½“ç„¶æ‚¨ä¹Ÿå¯ä»¥è®¾ç½®ä¸€è‡´å…¶ç›®çš„éƒ½æ˜¯ä¸ºäº†å°†æ•…éšœæœåŠ¡ä¸‹çº¿å¹¶ç­‰å¾…æ¢å¤;</p>
</blockquote>
<p><br/></p>
<p><strong>Probe ä½¿ç”¨ç¤ºä¾‹</strong></p>
<ul>
<li>(1) å°±ç»ªæŒ‡é’ˆ or å°±ç»ªæ¢é’ˆ<br>readinessProbeå­—æ®µ: å®šæœŸæ£€æŸ¥é›†è£…ç®±<code>æœåŠ¡</code>å‡†å¤‡æƒ…å†µ(è¿è¡ŒçŠ¶æ€)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl explain pod.spec.containers.readinessProbe | egrep <span class="string">"FIELDS|&gt;"</span></span><br><span class="line">RESOURCE: readinessProbe &lt;Object&gt;</span><br><span class="line">FIELDS:</span><br><span class="line">   <span class="built_in">exec</span> &lt;Object&gt;</span><br><span class="line">   httpGet      &lt;Object&gt;</span><br><span class="line">   tcpSocket    &lt;Object&gt;</span><br><span class="line">   initialDelaySeconds  &lt;<span class="built_in">integer</span>&gt;</span><br><span class="line">   periodSeconds        &lt;<span class="built_in">integer</span>&gt;</span><br><span class="line">   timeoutSeconds       &lt;<span class="built_in">integer</span>&gt;</span><br><span class="line">   failureThreshold     &lt;<span class="built_in">integer</span>&gt;</span><br><span class="line">   successThreshold     &lt;<span class="built_in">integer</span>&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>ç®€å•å®ä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) httpGet æ£€æµ‹æ–¹æ¡ˆ </span></span><br><span class="line">cat &gt; readinessProbe-httpget.yaml&lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">apiVersion: v1 </span><br><span class="line">kind: Pod </span><br><span class="line">metadata:</span><br><span class="line">  name: readiness-httpget-pod </span><br><span class="line">  namespace: <span class="built_in">test</span></span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: readiness-httpget-container </span><br><span class="line">    image: harbor.weiyigeek.top/<span class="built_in">test</span>/nginx:v2.2</span><br><span class="line">    imagePullPolicy: IfNotPresent <span class="comment">#é•œåƒä¸‹è½½ç­–ç•¥å¦‚æœå­˜åœ¨åˆ™ä¸ä¸‹è½½</span></span><br><span class="line">    readinessProbe: <span class="comment"># å°±ç»ªæ¢é’ˆ</span></span><br><span class="line">      httpGet:      <span class="comment"># æ£€æµ‹æ–¹æ¡ˆ</span></span><br><span class="line">        port: 80             <span class="comment"># è¯·æ±‚ç«¯å£</span></span><br><span class="line">        path: /index1.html   <span class="comment"># è¯·æ±‚è·¯å¾„</span></span><br><span class="line">      initialDelaySeconds: 1 <span class="comment"># åˆå§‹åŒ–æ£€æµ‹å»¶æ—¶ï¼ˆ1ç§’ä»¥åï¼‰</span></span><br><span class="line">      timeoutSeconds: 1      <span class="comment"># è¯·æ±‚ç­‰å¾…è¶…æ—¶æ—¶é—´ ï¼ˆ1ç§’ä»¥åï¼‰</span></span><br><span class="line">      periodSeconds: 3       <span class="comment"># é‡è¯•çš„æ£€æµ‹æ—¶é—´ï¼ˆ3ç§’ä»¥åï¼‰</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) éƒ¨ç½²èµ„æºæ¸…å•</span></span><br><span class="line">~/K8s/Day4$ kubectl create -f readinessProbe-httpget.yaml</span><br><span class="line">pod/readiness-httpget-pod created</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) æŸ¥çœ‹ &amp; ç»“æœ</span></span><br><span class="line">~/K8s/Day4$ kubectl get pod -n <span class="built_in">test</span> | grep <span class="string">"readiness-httpget-pod"</span></span><br><span class="line">NAME                    READY   STATUS    RESTARTS   AGE   IP            NODE         NOMINATED NODE   READINESS GATES</span><br><span class="line">readiness-httpget-pod   1/1     Running   0          40m   10.244.1.14   k8s-node-4   &lt;none&gt;  &lt;none&gt;  <span class="comment"># å¯ä»¥çœ‹è§READYä¸æ˜¯å°±ç»ªçš„ </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">~/K8s/Day4$ kubectl describe -n <span class="built_in">test</span> pod readiness-httpget-pod</span><br><span class="line">  <span class="comment"># Events:</span></span><br><span class="line">  <span class="comment">#   Type     Reason     Age                      From               Message</span></span><br><span class="line">  <span class="comment">#   ----     ------     ----                     ----               -------</span></span><br><span class="line">  <span class="comment">#   Normal   Scheduled  7m35s                    default-scheduler  Successfully assigned test/readiness-httpget-pod to k8s-node-4</span></span><br><span class="line">  <span class="comment">#   Normal   Pulling    7m35s                    kubelet            Pulling image "harbor.weiyigeek.top/test/nginx:v2.2"</span></span><br><span class="line">  <span class="comment">#   Normal   Pulled     7m35s                    kubelet            Successfully pulled image "harbor.weiyigeek.top/test/nginx:v2.2" in 179.781569ms</span></span><br><span class="line">  <span class="comment">#   Normal   Created    7m34s                    kubelet            Created container readiness-httpget-container</span></span><br><span class="line">  <span class="comment">#   Normal   Started    7m34s                    kubelet            Started container readiness-httpget-container</span></span><br><span class="line">  Warning  Unhealthy  2m32s (x101 over 7m32s)  kubelet            Readiness probe failed: HTTP probe failed with statuscode: 404  <span class="comment"># å…³é”®ç‚¹</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) è¿›å…¥å®¹å™¨ä¸­åˆ›å»ºindex1.htmlæ–‡ä»¶</span></span><br><span class="line">~/K8s/Day4$ kubectl <span class="built_in">exec</span> -n <span class="built_in">test</span> readiness-httpget-pod -it sh</span><br><span class="line">  <span class="comment"># echo "readiness-httpget-pod" &gt; /usr/share/nginx/html/index1.html</span></span><br><span class="line">  <span class="comment"># ls /usr/share/nginx/html/</span></span><br><span class="line">  <span class="comment"># 50x.html  host.html  index.html  index1.html</span></span><br><span class="line"></span><br><span class="line">~/K8s/Day4$ curl http://10.244.1.14/index1.html</span><br><span class="line"><span class="comment"># readiness-httpget-pod</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) æ·»åŠ æ–‡ä»¶åå®¹å™¨çŠ¶æ€çš„è½¬å˜</span></span><br><span class="line">~/K8s/Day4$ kubectl get pod -n <span class="built_in">test</span></span><br><span class="line">  <span class="comment"># NAME                    READY   STATUS    RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># readiness-httpget-pod   1/1     Running   0          9m28s  # æ­¤æ—¶å¯ä»¥çœ‹è§READYå·²ç»å°±ç»ª</span></span><br><span class="line"></span><br><span class="line">~/K8s/Day4$  kubectl logs -n <span class="built_in">test</span> readiness-httpget-pod</span><br><span class="line">  <span class="comment"># 2020/11/09 08:37:06 [error] 9#9: *128 open() "/usr/share/nginx/html/index1.html" failed (2: No such file or directory), client: 10.244.1.1, server: localhost, request: "GET /index1.html HTTP/1.1", host: "10.244.1.14:80"</span></span><br><span class="line">  <span class="comment"># 10.244.1.1 - - [09/Nov/2020:08:37:06 +0000] "GET /index1.html HTTP/1.1" 404 153 "-" "kube-probe/1.19" "-"</span></span><br><span class="line">  <span class="comment"># 10.244.1.1 - - [09/Nov/2020:08:37:09 +0000] "GET /index1.html HTTP/1.1" 200 22 "-" "kube-probe/1.19" "-"</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<ul>
<li>(2) å­˜æ´»æŒ‡é’ˆ or å­˜æ´»æ¢é’ˆ<br>HttpGetæ–¹å¼: å³ é€šè¿‡ Http è¯·æ±‚çš„æ–¹å¼éªŒè¯åº”ç”¨æœåŠ¡æˆ–è€…Podå®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ;<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">liveness-httpget-pod</span> </span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span> </span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span> </span><br><span class="line"><span class="attr">  - name:</span> <span class="string">liveness-httpget-container</span> </span><br><span class="line"><span class="attr">    image:</span> <span class="string">harbor.weiyigeek.top/test/nginx:v2.2</span></span><br><span class="line"><span class="attr">    imagePu11Policy:</span> <span class="string">IfNotPresent</span> </span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">http</span> </span><br><span class="line"><span class="attr">      containerPort:</span> <span class="number">80</span> </span><br><span class="line">    <span class="number">1</span><span class="attr">ivenessProbe:</span></span><br><span class="line"><span class="attr">      httpGet:</span></span><br><span class="line"><span class="attr">        port:</span> <span class="string">http</span> </span><br><span class="line"><span class="attr">        path:</span> <span class="string">/index.html</span> </span><br><span class="line"><span class="attr">        httpHeaders:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">X-Custom-Header</span></span><br><span class="line"><span class="attr">          value:</span> <span class="string">WeiyiGeek</span></span><br><span class="line"><span class="attr">      initialDelaySeconds:</span> <span class="number">1</span>  <span class="comment"># å»¶è¿Ÿ1ç§’ä»¥åå¼€å§‹æ£€æµ‹</span></span><br><span class="line"><span class="attr">      timeoutSeconds:</span> <span class="number">10</span>      <span class="comment"># æ¯æ¬¡è®¿é—®æ—¶æœ€å¤§çš„è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="attr">      periodSeconds:</span> <span class="number">3</span>        <span class="comment"># æ¯3ç§’é‡å¤æ£€æµ‹ä¸€æ¬¡</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<p>Execæ–¹å¼: å³é€šè¿‡éªŒè¯å®¹å™¨ä¸­æœåŠ¡æ­£å¸¸å¯åŠ¨åçš„æ ‡å¿—æ€§æ–‡ä»¶æ˜¯è¢«å­˜åœ¨åˆ›å»º;<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">liveness-exec-pod</span> </span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">test</span> </span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span> </span><br><span class="line"><span class="attr">  - name:</span> <span class="string">liveness-exec-container</span> </span><br><span class="line"><span class="attr">    image:</span> <span class="string">hub.coreqi.cn/1ibrary/busybox</span> </span><br><span class="line"><span class="attr">    imagePullPolicy:</span> <span class="string">IfNotPresent</span> </span><br><span class="line"><span class="attr">    command:</span> <span class="string">["/bin/sh","-c","touch</span> <span class="string">/tmp/live;sleep</span> <span class="number">60</span><span class="string">;rm</span> <span class="bullet">-rf</span> <span class="string">/tmp/live;sleep</span> <span class="number">3600</span><span class="string">"] </span></span><br><span class="line"><span class="string">    livenessProbe:  #æ¢æ´»æŒ‡é’ˆ</span></span><br><span class="line"><span class="string">      exec: #æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line"><span class="string">        command: ["</span><span class="string">test","-e","/tmp/live"]</span> <span class="comment">#æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="attr">      initialDelaySeconds:</span> <span class="number">1</span>     <span class="comment"># å®¹å™¨å¯åŠ¨1ç§’åæ‰§è¡Œ</span></span><br><span class="line"><span class="attr">      periodSeconds:</span> <span class="number">3</span>           <span class="comment"># é‡è¯•çš„å¾ªç¯æ—¶é—´ä¸º3ç§’</span></span><br></pre></td></tr></table></figure></p>
<p>Tcpæ–¹å¼: æˆ‘ä»¬ä»¥æ­¤æ–¹å¼è¿›è¡Œæ¼”ç¤ºä¸Šé¢ä¸ä¸‹é¢çš„æ“ä½œä¸ä¹‹ç±»ä¼¼;<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">&gt; ~/K8s/Day4/livenessProbe-tcpSocket.yaml &lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">livenessprobe-tcpsocket</span>  <span class="comment"># æ³¨æ„åªèƒ½å°å†™</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">nginx</span> </span><br><span class="line"><span class="attr">    image:</span> <span class="string">harbor.weiyigeek.top/test/nginx:v2.2</span></span><br><span class="line"><span class="attr">    livenessProbe:</span></span><br><span class="line"><span class="attr">      tcpSocket:</span></span><br><span class="line"><span class="attr">        port:</span> <span class="number">81</span>             <span class="comment"># æ£€æµ‹ 81 ç«¯å£ (å®é™…å¯åŠ¨çš„ç«¯å£æ˜¯80æ‰€ä»¥å®ƒä¼šä¸€ç›´é‡è¯•æ£€æµ‹)</span></span><br><span class="line"><span class="attr">      initialDelaySeconds:</span> <span class="number">5</span> <span class="comment"># åˆå§‹åŒ–å5sæ‰§è¡Œ </span></span><br><span class="line"><span class="attr">      timeoutSeconds:</span> <span class="number">1</span>      <span class="comment"># è¿æ¥è¶…æ—¶</span></span><br><span class="line"><span class="attr">      periodSeconds:</span> <span class="number">3</span>       <span class="comment"># é‡è¯•é—´éš”3s </span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></p>
<p>æ“ä½œæ­¥éª¤:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.éƒ¨ç½²èµ„æºæ¸…å•</span></span><br><span class="line">~/K8s/Day4$ kubectl create -f livenessProbe-tcpSocket.yaml</span><br><span class="line">  <span class="comment"># pod/livenessprobe-tcpsocket created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ç»“æœæŸ¥çœ‹(å…³é”®ç‚¹)</span></span><br><span class="line">~/K8s/Day4$ kubectl get pod -n <span class="built_in">test</span> -o wide</span><br><span class="line">  <span class="comment"># NAME                      READY   STATUS    RESTARTS   AGE     IP            NODE         NOMINATED NODE   READINESS GATES</span></span><br><span class="line">  <span class="comment"># livenessprobe-tcpsocket   1/1     Running   0   èµ·åˆ       23s     10.244.1.15   k8s-node-4   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"></span><br><span class="line">~/K8s/Day4$  kubectl get pod -n <span class="built_in">test</span> -o wide -w  <span class="comment">#  ç”Ÿå‘½å‘¨æœŸå†…æ¢æµ‹ä¸ºæ»¡è¶³æ¡ä»¶é€€å‡º é‡å¯ </span></span><br><span class="line">  <span class="comment"># NAME                      READY   STATUS    RESTARTS   AGE     IP            NODE         NOMINATED NODE   READINESS GATES</span></span><br><span class="line">  <span class="comment"># livenessprobe-tcpsocket   1/1     Running   2  å…³é”®ç‚¹   91s     10.244.1.15   k8s-node-4   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># ....</span></span><br><span class="line">  <span class="comment"># livenessprobe-tcpsocket   1/1     Running   3          2m7s    10.244.1.15   k8s-node-4   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># .... 5æ¬¡é‡å¯åæ¢æµ‹è¿˜æœªé€šè¿‡ï¼Œè¿”å›å´©æºƒå¾ªç¯ å¹¶ä¸”æ­¤æ—¶çŠ¶æ€NotReady  </span></span><br><span class="line">  <span class="comment"># livenessprobe-tcpsocket   0/1     CrashLoopBackOff   5   4m13s   10.244.1.15   k8s-node-4   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># livenessprobe-tcpsocket   1/1     Running            6   5m42s   10.244.1.15   k8s-node-4   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># livenessprobe-tcpsocket   0/1     CrashLoopBackOff   6   6m26s   10.244.1.15   k8s-node-4   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.Pod è¿è¡Œäº‹ä»¶æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">~/K8s/Day4$ kubectl describe pod -n <span class="built_in">test</span> livenessprobe-tcpsocket</span><br><span class="line">  <span class="comment"># Events:  # é€šè¿‡Eventsxiangè¯¦ç»†æè¿°ä¿¡æ¯å¯çŸ¥Contianer livenessä¸å¥åº·ï¼Œå…¶å°†è¢«Killæ‰é‡æ–°ç”Ÿæˆã€‚</span></span><br><span class="line">  <span class="comment">#   Type     Reason     Age                    From               Message</span></span><br><span class="line">  <span class="comment">#   ----     ------     ----                   ----               -------</span></span><br><span class="line">  <span class="comment">#   Normal   Scheduled  8m7s                   default-scheduler  Successfully assigned test/livenessprobe-tcpsocket to k8s-node-4</span></span><br><span class="line">  <span class="comment">#   Normal   Killing    6m30s (x3 over 7m54s)  kubelet            Container nginx failed liveness probe, will be restarted</span></span><br><span class="line">  <span class="comment">#   Normal   Pulled     6m (x4 over 8m6s)      kubelet            Container image "harbor.weiyigeek.top/test/nginx:v2.2" already present on machine</span></span><br><span class="line">  <span class="comment">#   Normal   Created    6m (x4 over 8m6s)      kubelet            Created container nginx</span></span><br><span class="line">  <span class="comment">#   Normal   Started    6m (x4 over 8m6s)      kubelet            Started container nginx</span></span><br><span class="line">  <span class="comment">#  Liveness probe æ£€æµ‹ä¿¡æ¯</span></span><br><span class="line">  <span class="comment"># Warning  Unhealthy  5m54s (x10 over 8m)    kubelet            Liveness probe failed: dial tcp 10.244.1.15:81: connect: connection refused</span></span><br><span class="line">  <span class="comment"># Warning  BackOff    3m5s (x6 over 3m54s)   kubelet            Back-off restarting failed container</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>Init Container ä½¿ç”¨ç¤ºä¾‹: ä¸€ä¸ªç”¨æ¥æ£€æŸ¥ redis æ˜¯å¦å¯åŠ¨æˆåŠŸï¼Œå¦å¤–ä¸€ä¸ªç”¨æ¥æ£€æŸ¥ mysql æ˜¯å¦å¯åŠ¨æˆåŠŸï¼Œå¼€å§‹éƒ¨ç½²çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šé€šè¿‡ nslookup æ£€æŸ¥ redis æ˜¯å¦æˆåŠŸå¯åŠ¨ï¼Œæ£€æµ‹åˆ° redis å¯åŠ¨äº†ä¹‹åï¼ŒåŸŸåè§£æä¹Ÿå°±ä¼šæˆåŠŸï¼Œç„¶åä¼šæ£€æŸ¥ mysql çš„çŠ¶æ€ mysql ä¹ŸæˆåŠŸå¯åŠ¨ä¹‹åæ‰ä¼šå¼€å§‹å¯åŠ¨ <code>reservation-server</code> containerã€‚<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">myapp-pod</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">myapp</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">reservation-server</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">weiyigeek/activityreservation:dev</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">http</span></span><br><span class="line"><span class="attr">        containerPort:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">        protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">    livenessProbe:</span></span><br><span class="line"><span class="attr">        httpGet:</span></span><br><span class="line"><span class="attr">            path:</span> <span class="string">/health</span></span><br><span class="line"><span class="attr">            port:</span> <span class="string">http</span></span><br><span class="line"><span class="attr">        initialDelaySeconds:</span> <span class="number">60</span></span><br><span class="line"><span class="attr">        periodSeconds:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">    readinessProbe:</span></span><br><span class="line"><span class="attr">        httpGet:</span></span><br><span class="line"><span class="attr">            path:</span> <span class="string">/api/notice</span></span><br><span class="line"><span class="attr">            port:</span> <span class="string">http</span></span><br><span class="line"><span class="attr">        initialDelaySeconds:</span> <span class="number">60</span></span><br><span class="line"><span class="attr">        periodSeconds:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">  initContainers:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">init-redis</span></span><br><span class="line"><span class="attr">      image:</span> <span class="attr">busybox:1.31</span></span><br><span class="line"><span class="attr">      command:</span> <span class="string">['sh',</span> <span class="string">'-c'</span><span class="string">,</span> <span class="string">'until nslookup redis-server; do echo waiting for redis; sleep 2; done;'</span><span class="string">]</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">init-mysql</span></span><br><span class="line"><span class="attr">      image:</span> <span class="attr">busybox:1.31</span></span><br><span class="line"><span class="attr">      command:</span> <span class="string">['sh',</span> <span class="string">'-c'</span><span class="string">,</span> <span class="string">'until nslookup mysql-server; do echo waiting for mysql; sleep 2; done;'</span><span class="string">]</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h4 id="Pod-Hook"><a href="#Pod-Hook" class="headerlink" title="Pod Hook"></a>Pod Hook</h4><p>æè¿°: Pod hookï¼ˆé’©å­ï¼‰æ˜¯ç”±Kubernetesç®¡ç†çš„kubeletå‘èµ·çš„ï¼Œå®ƒåœ¨Podç”Ÿå‘½å‘¨æœŸï¼ˆPod Lifecycleï¼‰å†…æä¾›ä¸¤ç§é’©å­ (Hook) åˆ†åˆ«åœ¨å®¹å™¨ä¸­çš„<code>è¿›ç¨‹å¯åŠ¨å‰ (postStart)</code>æˆ–<code>è€…å®¹å™¨ä¸­çš„è¿›ç¨‹ç»ˆæ­¢ä¹‹å‰ (preStop)</code>è¿è¡Œï¼Œå¯ä»¥åŒæ—¶ä¸ºPodä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½é…ç½® hook, å®ƒä»¬åŒ…å«åœ¨å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸä¹‹ä¸­ã€‚</p>
<p><strong>Hook äº‹ä»¶åˆ†ç±»:</strong></p>
<ul>
<li>1) PostStart: åœ¨å®¹å™¨åˆ›å»ºå¯åŠ¨ä¹‹åPostStart Hookå°†ä¼šè¢«ç«‹å³æ‰§è¡Œï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯å®¹å™¨é‡Œçš„Entrypoint å’Œ Poststartçš„æ‰§è¡Œé¡ºåºå‰åå¹¶ä¸ç¡®å®š</li>
<li>2) PreStart: åœ¨å®¹å™¨è¢«ç»ˆæ­¢ä¹‹å‰æ‰§è¡Œé‡‡ç”¨ä¸€ç§é˜»å¡å¼çš„æ–¹å¼ï¼Œå³åœ¨PreStop Hookæ‰§è¡Œå®Œæ¯•ä¹‹åé”€æ¯å®¹å™¨çš„åŠ¨ä½œæ‰ä¼šæ‰§è¡Œ;</li>
</ul>
<p><br/></p>
<p><strong>Hook Handler åˆ†ç±»ï¼š</strong><br>æè¿°: å®¹å™¨é€šè¿‡å®ç°å’Œæ³¨å†Œä¸€ä¸ªHandleræ¥å®ç°å¯¹Hookçš„è®¿é—®æœ‰ä¸¤ç§ç±»å‹çš„ <code>Hook Handlers</code>;</p>
<ul>
<li>exec: æ‰§è¡Œ ä¸€ä¸ª Shellå‘½ä»¤</li>
<li>httpï¼šå‘ ä¸€ä¸ªendpoint å‘é€HTTPè¯·æ±‚</li>
</ul>
<p>Tips : å¦‚æœ <code>PostStart</code> æˆ– <code>PreStop</code> hook æ‰§è¡Œå¤±è´¥å®¹å™¨å°†ä¼šè¢«Killæ‰;</p>
<p><br/></p>
<p>ç®€å•å®ä¾‹: åœ¨ Pod ç”Ÿå­˜å‘¨æœŸå†…åœ¨å®¹å™¨åˆ›å»ºæˆ–è€…åœ¨å®¹å™¨ç»“æŸæ—¶, æŒ‡å®šæ‰§è¡Œçš„å‘½ä»¤æˆ–è€…è„šæœ¬;</p>
<ul>
<li><p>1.å°†é•œåƒä¸Šä¼ åˆ°Harborä»“åº“ä¹‹ä¸­</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker tag nginx:latest harbor.weiyigeek.top/<span class="built_in">test</span>/nginx:latest</span><br><span class="line">$ docker push harbor.weiyigeek.top/<span class="built_in">test</span>/nginx:latest</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.Podèµ„æºæ¸…å•çš„ç¼–å†™</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">kubectl</span> <span class="string">explain</span> <span class="string">Pod.spec.containers.lifecycle</span></span><br><span class="line"></span><br><span class="line"><span class="string">cat</span> <span class="string">&gt; ~/K8s/Day4/lifecycle-demoStartStop.yaml&lt;&lt;'EOF'</span></span><br><span class="line"><span class="string"></span><span class="attr">apiVersion:</span> <span class="string">v1</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">lifecycle-demo</span> </span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">  labels:</span> </span><br><span class="line"><span class="attr">    app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">lifecycle-demo-container</span> </span><br><span class="line"><span class="attr">    image:</span> <span class="string">harbor.weiyigeek.top/test/nginx</span></span><br><span class="line"><span class="attr">    imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">    lifecycle:</span>    <span class="comment"># [é‡ç‚¹ç”Ÿå­˜å‘¨æœŸ] </span></span><br><span class="line"><span class="attr">      postStart:</span>  <span class="comment"># å¯åŠ¨æ—¶è¿è¡Œ</span></span><br><span class="line"><span class="attr">        exec:</span></span><br><span class="line"><span class="attr">          command:</span> <span class="string">["/bin/sh","-c","echo</span> <span class="string">$&#123;HOSTNAME&#125;,$&#123;NGINX_VERSION&#125;&gt;</span> <span class="string">/usr/share/nginx/html/info.html"]</span> </span><br><span class="line"><span class="attr">      preStop:</span>    <span class="comment"># é€€å‡ºæ—¶è¿è¡Œ(éœ€è¦æ­£å¸¸é€€å‡ºé˜²æ­¢æ•°æ®æŸå)</span></span><br><span class="line"><span class="attr">        exec:</span> </span><br><span class="line"><span class="attr">          command:</span> <span class="string">["/usr/sbin/nginx","-s","quit"]</span></span><br><span class="line"><span class="attr">  restartPolicy:</span> <span class="string">OnFailure</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>3.éƒ¨ç½²èµ„æºæ¸…å•ä¸éƒ¨ç½²ä¿¡æ¯æŸ¥çœ‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) æ‰§è¡Œéƒ¨ç½²</span></span><br><span class="line">weiyigeek@ubuntu:~/K8s/Day4$ kubectl create -f lifecycle-demoStartStop.yaml</span><br><span class="line">  <span class="comment"># pod/lifecycle-demo created</span></span><br><span class="line"></span><br><span class="line">weiyigeek@ubuntu:~/K8s/Day4$ kubectl get pod -n <span class="built_in">test</span> -o wide | grep <span class="string">"lifecycle-demo"</span></span><br><span class="line">  <span class="comment"># lifecycle-demo   1/1     Running   0          41s   10.244.1.13   k8s-node-4   &lt;none&gt;           &lt;none&gt;</span></span><br><span class="line"></span><br><span class="line">weiyigeek@ubuntu:~/K8s/Day4$ kubectl logs -n <span class="built_in">test</span> lifecycle-demo</span><br><span class="line">  <span class="comment"># /docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration</span></span><br><span class="line">  <span class="comment"># /docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/</span></span><br><span class="line">  <span class="comment"># /docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</span></span><br><span class="line">  <span class="comment"># 10-listen-on-ipv6-by-default.sh: Getting the checksum of /etc/nginx/conf.d/default.conf</span></span><br><span class="line">  <span class="comment"># 10-listen-on-ipv6-by-default.sh: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf</span></span><br><span class="line">  <span class="comment"># /docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</span></span><br><span class="line">  <span class="comment"># /docker-entrypoint.sh: Configuration complete; ready for start up</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) è®¿é—®æŸ¥çœ‹</span></span><br><span class="line">~/K8s/Day4$ curl http://10.244.1.13/info.html</span><br><span class="line">  <span class="comment"># lifecycle-demo,1.19.4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) åœæ­¢ä¸»å®¹å™¨ç„¶ååˆ é™¤Pod</span></span><br><span class="line">kubectl delete -f lifecycle-demoStartStop.yaml</span><br><span class="line">  <span class="comment"># pod "lifecycle-demo" deleted</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<p> å‘½ä»¤è¡¥å……è¯´æ˜<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤Deploymentåˆ›å»ºçš„æ‰€æœ‰Pod</span></span><br><span class="line">~$ kubectl get deployment</span><br><span class="line">  NAME               READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">  nginx-deployment   3/3     3            3           2d14h</span><br><span class="line"></span><br><span class="line">~$ kubectl delete deployment --all <span class="comment"># å…ˆåˆ é™¤deployment</span></span><br><span class="line">  deployment.apps <span class="string">"nginx-deployment"</span> deleted</span><br><span class="line"></span><br><span class="line">~$ kubectl delete pod --all</span><br><span class="line">  pod <span class="string">"nginx-deployment-7f5d9779c6-dr5h8"</span> deleted</span><br><span class="line">  pod <span class="string">"nginx-deployment-7f5d9779c6-hhl7k"</span> deleted</span><br><span class="line">  pod <span class="string">"nginx-deployment-7f5d9779c6-sk2f4"</span> deleted</span><br><span class="line"></span><br><span class="line">~$ kubectl delete svc nginx-deployment</span><br><span class="line"></span><br><span class="line">~$ kubectl <span class="built_in">exec</span> nginx-deployment-7f5d9779c6-dr5h8 -it -- /bin/sh env</span><br><span class="line">  <span class="comment"># KUBERNETES_SERVICE_PORT=443</span></span><br><span class="line">  <span class="comment"># KUBERNETES_PORT=tcp://10.96.0.1:443</span></span><br><span class="line">  <span class="comment"># HOSTNAME=nginx-deployment-7f5d9779c6-dr5h8</span></span><br><span class="line">  <span class="comment"># HOME=/root</span></span><br><span class="line">  <span class="comment"># PKG_RELEASE=1~buster</span></span><br><span class="line">  <span class="comment"># TERM=xterm</span></span><br><span class="line">  <span class="comment"># KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1</span></span><br><span class="line">  <span class="comment"># NGINX_VERSION=1.19.4</span></span><br><span class="line">  <span class="comment"># PATH=/usr/local/nginx/sbin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span></span><br><span class="line">  <span class="comment"># KUBERNETES_PORT_443_TCP_PORT=443</span></span><br><span class="line">  <span class="comment"># NJS_VERSION=0.4.4</span></span><br><span class="line">  <span class="comment"># KUBERNETES_PORT_443_TCP_PROTO=tcp</span></span><br><span class="line">  <span class="comment"># IMAGE_VERSION=2.2</span></span><br><span class="line">  <span class="comment"># KUBERNETES_SERVICE_PORT_HTTPS=443</span></span><br><span class="line">  <span class="comment"># KUBERNETES_PORT_443_TCP=tcp://10.96.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºpodçš„Initå®¹å™¨æŸ¥çœ‹</span></span><br><span class="line">kubectl get pod</span><br><span class="line">kubecrl describe pod</span><br></pre></td></tr></table></figure></p>

        </div>
        
        <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
        
        <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½çœ‹å‹,æ¬¢è¿å…³æ³¨åšä¸»å¾®ä¿¡å…¬ä¼—å·å“Ÿ! â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘å³å¯å…³é—­ç»§ç»­æµè§ˆæ–‡ç« .<br>  <b style="color:red;"> æ¸©é¦¨æç¤º: æœªè§£é”çš„ç”¨æˆ·ä¸èƒ½ç²˜è´´å¤åˆ¶æ–‡ç« å†…å®¹å“Ÿ!</b> <br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
           

        <!-- Google å¹¿å‘Š -->
        
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
  

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2023-01-31T02:29:10.471Z" itemprop="dateUpdated">2023-01-31 10:29:10</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/4-Kuberneteså…¥é—¨åŸºç¡€ä¹‹Podä»‹ç».md" target="_blank" rel="noopener noreferrer">_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/4-Kuberneteså…¥é—¨åŸºç¡€ä¹‹Podä»‹ç».md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2020/4-27-521.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/4-27-521.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/4-27-521.html&title=ã€Š4-Kuberneteså…¥é—¨åŸºç¡€ä¹‹Podä»‹ç»ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/4-27-521.html&title=ã€Š4-Kuberneteså…¥é—¨åŸºç¡€ä¹‹Podä»‹ç»ã€‹ â€” WeiyiGeek Blog&source=WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ª..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/4-27-521.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š4-Kuberneteså…¥é—¨åŸºç¡€ä¹‹Podä»‹ç»ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/4-27-521.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/4-27-521.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/4-27-530.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">11-Kubernetesè¿›é˜¶ä¹‹åŸç†æ¶æ„å­¦ä¹ åŠæ“ä½œé…ç½®</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/4-27-606.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">2.Goè¯­è¨€é¡¹ç›®æ“ä½œMySQLæ•°æ®åº“å®è·µ</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-å‰è¨€ç®€è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å‰è¨€ç®€è¿°</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-èµ„æºæ¸…å•"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 èµ„æºæ¸…å•</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-å¯¹è±¡å­—æ®µ"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">(1) å¯¹è±¡å­—æ®µ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#apiVersion-å¿…é¡»"><span class="post-toc-number">2.1.1.</span> <span class="post-toc-text">apiVersion - å¿…é¡»</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#kind-å¿…é¡»"><span class="post-toc-number">2.1.2.</span> <span class="post-toc-text">kind - å¿…é¡»</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#metadata-å¿…é¡»"><span class="post-toc-number">2.1.3.</span> <span class="post-toc-text">metadata - å¿…é¡»</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Annotation-æ³¨è§£"><span class="post-toc-number">2.1.4.</span> <span class="post-toc-text">Annotation - æ³¨è§£</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#spec-å¿…é¡»"><span class="post-toc-number">2.1.5.</span> <span class="post-toc-text">spec - å¿…é¡»</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-NameSpace-åç§°ç©ºé—´"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 NameSpace - åç§°ç©ºé—´</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#namespace-åˆ›å»ºæŸ¥çœ‹"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">namespace åˆ›å»ºæŸ¥çœ‹</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#namespace-é…é¢"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">namespace é…é¢</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x03-Pod-åŸºç¡€-amp-è¿›é˜¶"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 Pod åŸºç¡€&amp;è¿›é˜¶</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-Pod-Template-amp-Controller"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">(1) Pod Template &amp; Controller</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-Static-Pod-é™æ€"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">(2) Static Pod (é™æ€)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-Pod-ç”Ÿå‘½å‘¨æœŸ"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">(3) Pod ç”Ÿå‘½å‘¨æœŸ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Pod-Phase"><span class="post-toc-number">4.3.1.</span> <span class="post-toc-text">Pod Phase</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Pod-é‡å¯ç­–ç•¥"><span class="post-toc-number">4.3.2.</span> <span class="post-toc-text">Pod é‡å¯ç­–ç•¥</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Pod-Init-å®¹å™¨"><span class="post-toc-number">4.3.3.</span> <span class="post-toc-text">Pod Init å®¹å™¨</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Pod-å®¹å™¨æ¢é’ˆ"><span class="post-toc-number">4.3.4.</span> <span class="post-toc-text">Pod å®¹å™¨æ¢é’ˆ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Pod-Hook"><span class="post-toc-number">4.3.5.</span> <span class="post-toc-text">Pod Hook</span></a></li></ol></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
    <!-- 
  <div class="post-wechat" style="position:fixed;top: 360px;bottom: 500px;right: 3%;width: 190px;text-align: center;">
    <p><b>å…³æ³¨ã€å…¨æ ˆå·¥ç¨‹å¸ˆä¿®ç‚¼æŒ‡å—ã€‘</b></p>
    <img src="/img/wechat-gzh.jpg" class="img-responsive" alt="weiyigeek">
    <p><b>æ¬¢è¿æ·»åŠ ã€ä½œè€…ã€‘å¾®ä¿¡</b></p>
    <img src="/img/wehat.jpg" class="img-responsive" alt="weiyigeek">
  </div>
 -->

    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="/img/share-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2023 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>

<div id="go" class="waves-effect waves-light">
  <a href="javascript:;" id="goqrcode"> <span class="icon icon-lg icon-qrcode"></span> </a>
  <a href="javascript:;" id="gotop"> <span class="icon icon-lg icon-chevron-up"></span></a>
</div>





<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/4-27-521.html&title=ã€Š4-Kuberneteså…¥é—¨åŸºç¡€ä¹‹Podä»‹ç»ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/4-27-521.html&title=ã€Š4-Kuberneteså…¥é—¨åŸºç¡€ä¹‹Podä»‹ç»ã€‹ â€” WeiyiGeek Blog&source=WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ª..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/4-27-521.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š4-Kuberneteså…¥é—¨åŸºç¡€ä¹‹Podä»‹ç»ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/4-27-521.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/4-27-521.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACIUlEQVR42u3aQXLDIAwF0Nz/0um2nYzpF7I7BZ5XGdcGnhcqSHq94uv9cV39NXn++zPjcW6+MDAwlmW8h9d4oTnm6q3P++PPcUnFwMA4gFEduhqIx8902BgYGBhzpE4IxsDAwLiXkR8+/3XAxcDAWISRHGKTyfJEW/LWI2dxDAyMBRl51v3vfz9S38DAwFiK8S5ed9UN+yv5MSYGBsbWjDzAzW3mqgfaznowMDB2ZVSPmvlkdyXgojsYGBgHMO5qjEiOvp32r8vRMDAwtmbkhcxqe0SnYJmXMDEwME5gVK05ZpxKy0NztAYMDIytGfmmrZoIG1Or40drwMDA2JQxFzTzJfaTd9FbGBgYBzDyhoa5gJukyZL7v2QNMTAwNmVUQ2oydFKwrKbwCsVRDAyMrRk5LN8gdhJteWMHBgbG3oy8eaIaWOcScJPlTwwMjK0Z1W3cg1NOFSEK/zEwMDA2YuRtqdVW1P67BR4GBsZ2jDyVP1c2qKbYqi0aGBgYpzH6afoq+LYPh4GBcQAj2cxVn+y0aOSpOgwMjJMZ+VEzD6OTDRP5IRYDA2M7Rj/131lo/zNhYGCcwOi3iFV/5+m56mgYGBh7MzpJ/7ljZx7K8zQfBgbGCYxOk1Z1E1k4YedzYWBgYBQbI6oBt4qPmi0wMDAw8gmK7PyZ2wIuBgbGIoxOy8U4odYJr4+k2zAwMBZktDo1pkoL1W1fp+EMAwNjccYXdf9Bz1VjTmsAAAAASUVORK5CYII=" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  





<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// ç«™ç‚¹è¿è¡Œæ—¶é—´
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + "å¤©" + RunHours + "æ—¶" + RunMinutes + "åˆ†" + RunSeconds + "ç§’";
  document.getElementById(id).innerHTML = "ç½‘ç«™å·²åœ¨é£é›¨ä¸­å‹‰å‹‰å¼ºå¼ºè¿è¡Œäº†ã€" + RunTime + "ã€‘";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
    
  <div class="post-wechat" style="position:fixed;top: 360px;bottom: 500px;right: 3%;width: 190px;text-align: center;">
    <p><b>å…³æ³¨ã€å…¨æ ˆå·¥ç¨‹å¸ˆä¿®ç‚¼æŒ‡å—ã€‘</b></p>
    <img src="/img/wechat-gzh.jpg" class="img-responsive" alt="weiyigeek">
    <p><b>æ¬¢è¿æ·»åŠ ã€ä½œè€…ã€‘å¾®ä¿¡</b></p>
    <img src="/img/wehat.jpg" class="img-responsive" alt="weiyigeek">
  </div>

</body>
</html>