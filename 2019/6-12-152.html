<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ systemdæœåŠ¡ç®¡ç†è¯¦è§£ä¸å­å‘½ä»¤ä¸€è§ˆ|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="æœåŠ¡ç®¡ç†">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
        
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>systemdæœåŠ¡ç®¡ç†è¯¦è§£ä¸å­å‘½ä»¤ä¸€è§ˆ</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">systemdæœåŠ¡ç®¡ç†è¯¦è§£ä¸å­å‘½ä»¤ä¸€è§ˆ</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-06-12T14:35:30.000Z" itemprop="datePublished" class="page-time">
  2019-06-12
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Linux%E5%91%BD%E4%BB%A4/">Linuxå‘½ä»¤</a></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
  <article id="post-ç³»ç»Ÿè¿ç»´/Linux/å¸¸ç”¨å‘½ä»¤/å®‰è£…è½¯ä»¶ç±»å‘½ä»¤/systemdæœåŠ¡ç®¡ç†è¯¦è§£ä¸å­å‘½ä»¤ä¸€è§ˆ"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">systemdæœåŠ¡ç®¡ç†è¯¦è§£ä¸å­å‘½ä»¤ä¸€è§ˆ</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-06-12 22:35:30" datetime="2019-06-12T14:35:30.000Z"  itemprop="datePublished">2019-06-12</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Linux%E5%91%BD%E4%BB%A4/">Linuxå‘½ä»¤</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h4 id="0x00-Systemd-ç®€è¿°"><a href="#0x00-Systemd-ç®€è¿°" class="headerlink" title="0x00 Systemd ç®€è¿°"></a>0x00 Systemd ç®€è¿°</h4><p>æè¿°:ç³»ç»Ÿå¯åŠ¨å’ŒæœåŠ¡å™¨å®ˆæŠ¤è¿›ç¨‹ç®¡ç†å™¨ï¼Œè´Ÿè´£åœ¨ç³»ç»Ÿå¯åŠ¨æˆ–è¿è¡Œæ—¶æ¿€æ´»ç³»ç»Ÿèµ„æºï¼Œå¹¶ä¸”ç®¡ç†æœåŠ¡å™¨è¿›ç¨‹å’Œå…¶å®ƒè¿›ç¨‹ï¼Œå¯ä»¥è¯´ä»–æ˜¯Linuxçš„å°ä¼™ä¼´ç³»ç»Ÿå¯åŠ¨æ—¶å€™æœ€å…ˆéƒ½æ˜¯è¿è¡Œçš„systemd;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ps</span> aux</span><br><span class="line">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root          1  0.0  0.1 128204  5884 ?        Ss   3æœˆ25   2:19 /usr/lib/systemd/systemd --switched-root --system --deserialize 22</span><br></pre></td></tr></table></figure></p>
<h5 id="1-Linux-å¯åŠ¨æµç¨‹"><a href="#1-Linux-å¯åŠ¨æµç¨‹" class="headerlink" title="1.Linux å¯åŠ¨æµç¨‹"></a>1.Linux å¯åŠ¨æµç¨‹</h5><p>æè¿°:è¦æƒ³æ¸…æ¥š systemd åœ¨ Linux ç³»ç»Ÿä¸­çš„åœ°ä½å’Œä½œç”¨ï¼Œå°±ä¸å¾—ä¸æä¸€ä¸‹ Linux çš„å¯åŠ¨æµç¨‹ï¼›<br>Linux ä»æŒ‰ä¸‹ç”µæºé”®åˆ°è¿›å…¥ç”¨æˆ·äº¤äº’ç•Œé¢æ•´ä¸ªå¯åŠ¨æµç¨‹å¤§è‡´å¯ä»¥åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>BIOS é˜¶æ®µ: åŸºæœ¬çš„ç¡¬ä»¶è‡ªæ£€å‡†å¤‡ä»¥åŠåŠ è½½ bootloader ç¨‹åº;</li>
<li>BootLoader é˜¶æ®µ</li>
<li>kernel åŠ è½½é˜¶æ®µ</li>
<li>init (<code>systemd/sysvinit åˆå§‹åŒ–é˜¶æ®µ</code>)</li>
</ul>
<p><strong>(1) BIOS é˜¶æ®µ</strong><br>Step 1.åœ¨æŒ‰ä¸‹ç”µæºç”µæºé”®ï¼ˆå†·å¯åŠ¨ï¼‰åï¼Œ<code>CPU çš„ç¨‹åºè®¡æ•°å™¨è¢«åˆå§‹åŒ–ä¸ºä¸€ä¸ªç‰¹å®šçš„å…§å­˜åœ°å€</code>(æ‰€ä»¥æ²¡æœ‰ CPU æ˜¯æ— æ³•å¯åŠ¨ä¸»æ¿ä¸Šçš„ BIOS çš„)ï¼Œå­˜å‚¨åœ¨åªè¯»å­˜å‚¨å™¨ï¼ˆROMï¼‰ä¸­çš„ BIOS å°±æ˜¯ä»è¿™ä¸ªç‰¹å®šçš„å…§å­˜åœ°å€å¼€å§‹æ‰§è¡Œï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯å¯¹äºåµŒå…¥å¼ç³»ç»Ÿä¸­çš„ CPU ï¼Œå°†ä¼šåŠ è½½å¼•å¯¼åŒºå»å¯åŠ¨ flash/ROM ä¸­å·²çŸ¥åœ°å€çš„ç¨‹åºï¼›<br>Step2.BIOS å¯åŠ¨åå°±å¼€å§‹æ‰§è¡Œç¡¬ä»¶çš„åŸºæœ¬åˆå§‹åŒ–ä¹Ÿç§°ä¹‹ä¸º<code>ä¸Šç”µè‡ªæ£€</code>,å¹¶æ ¹æ®å¼•å¯¼è®¾å¤‡çš„ä¼˜å…ˆçº§å°†ç³»ç»Ÿæ§åˆ¶æƒäº¤ç»™ç¡¬ä»¶å¯åŠ¨é¡¹ï¼ˆ<code>æ¯”å¦‚ç¡¬ç›˜/ç½‘ç»œ/Uç›˜ç­‰</code>ï¼‰,æ­¤é˜¶æ®µå¯ä»¥è¿›è¡Œå¤–éƒ¨ä¸­æ–­æˆ‘ä»¬æŒ‰ä¸‹ F12 æˆ–è€… ESC é”®ï¼ˆæ ¹æ®ä¸»æ¿èŠ¯ç‰‡ç»„è€Œå¼‚ï¼‰å°±ä¼šå¼¹å‡ºé€‰æ‹©å¯åŠ¨é¡¹çš„ç•Œé¢ï¼Œè€Œä¸”è¿™äº›æŒ‰é”®é«˜åº¦ä¾èµ–ç¡¬ä»¶ã€‚<br>Step3.BIOS é€‰æ‹©å¥½ç¡¬ä»¶å¯åŠ¨é¡¹ä¹‹åå°±<code>å¼€å§‹æ‰§è¡Œç¡¬ä»¶è®¾å¤‡ä¸Šçš„åˆçº§å¼•å¯¼ç¨‹åºä»£ç </code>ï¼Œå¯¹äº MBR ç¡¬ç›˜æ¥è®²æ˜¯æœ€å¼€å§‹çš„ä¸€ä¸ªæ‰‡åŒºï¼ˆ512å­—èŠ‚ï¼‰å°‡è¢«åŠ è½½åˆ°å…§å­˜ï¼Œä¸¦æ‰§è¡Œè¡Œå…¶ä¸­çš„åˆå§‹åŒ–ä»£ç æ¥åŠ è½½ä¸‹ä¸€é˜¶æ®µçš„ Bootloader</p>
<p>PS:æ­¤å¤„ä»¥MBRå¼•å¯¼çš„ç³»ç»Ÿè®°å½•ä¸ºä¾‹ï¼ŒMBR ä¸»å¼•å¯¼è®°å½•æ˜¯ä¸€ä¸ª 512 å­—èŠ‚çš„æ‰‡åŒºï¼Œä½äºç¡¬ç›˜çš„ç¬¬ä¸€æ‰‡åŒºï¼ˆ0é“0æŸ±1æ‰‡åŒºï¼‰ï¼Œå¯¹äº GPT/EFI å¼•å¯¼ç­‰æœ‰ç»éªŒçš„æ—¶å€™å†æ¥è®²è§£è¡¥å……;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#dd å‘½ä»¤è¯»å– MBR ä¸»å¼•å¯¼è®°å½•</span></span><br><span class="line">dd <span class="keyword">if</span>=/dev/sda of=mbr.bin bs=512 count=1</span><br><span class="line"></span><br><span class="line"><span class="comment">#od å‘½ä»¤æ¥æŸ¥çœ‹äºŒè¿›åˆ¶æ–‡ä»¶</span></span><br><span class="line">od -xa mbr.bin</span><br><span class="line"><span class="comment"># 0000000    63eb    0090    0000    0000    0000    0000    0000    0000</span></span><br><span class="line"><span class="comment">#           k   c dle nul nul nul nul nul nul nul nul nul nul nul nul nul</span></span><br><span class="line"><span class="comment"># 0000020    0000    0000    0000    0000    0000    0000    0000    0000</span></span><br><span class="line"><span class="comment">#         nul nul nul nul nul nul nul nul nul nul nul nul nul nul nul nul</span></span><br><span class="line"><span class="comment"># *</span></span><br><span class="line"><span class="comment"># 0000120    0000    0000    0000    0000    0000    8000    0800    0000</span></span><br><span class="line"><span class="comment">#         nul nul nul nul nul nul nul nul nul nul nul nul nul  bs nul nul</span></span><br><span class="line"><span class="comment"># 0000140    0000    0000    faff    9090    c2f6    7480    f605    70c2</span></span><br><span class="line"><span class="comment">#         nul nul nul nul del   z dle dle   v   B nul   t enq   v   B   p</span></span><br><span class="line"><span class="comment"># 0000160    0274    80b2    79ea    007c    3100    8ec0    8ed8    bcd0</span></span><br><span class="line"><span class="comment">#           t stx   2 nul   j   y   | nul nul   1   @  so   X  so   P   &lt;</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>(2) BootLoader é˜¶æ®µ</strong><br>ä¸»å¼•å¯¼è®°å½•åŠ è½½å®Œ Bootloaderï¼ˆä¸»è¦ä¸ºGRUBï¼‰åˆ° RAM ä¸­ä¹‹åï¼ŒGRUB ä¼šæ ¹æ®éœ€æ±‚æ˜¾ç¤ºä¸€ä¸ªå¯ç”¨çš„å†…æ ¸åˆ—è¡¨ï¼ˆ<code>å®šä¹‰åœ¨/etc/grub.confï¼Œ/etc/grub/menu.lstå’Œ/etc/grub.confçš„è½¯è¿æ¥</code>ï¼‰<br>æ ¹æ® GRUB çš„é…ç½®åŠ è½½é»˜è®¤å†…æ ¸é•œåƒå’Œ initrd é•œåƒåˆ°å†…å­˜ä¸­ï¼Œå½“æ‰€æœ‰é•œåƒå‡†å¤‡å¥½åï¼Œå³è·³è½¬åˆ°å†…æ ¸é•œåƒï¼ˆé’ˆå¯¹äºWindowså¯èƒ½æœ‰äº›è®¸ä¸åŒä½†éƒ½å¤§åŒå°å¼‚ï¼‰ã€‚</p>
<p><br></p>
<p><strong>(3) kernel é˜¶æ®µ</strong><br>å½“BootLoader é˜¶æ®µå®Œæˆä¹‹åå†…æ ¸é•œåƒ(kernel image)è¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç³»ç»Ÿçš„æ§åˆ¶æƒå°±äº¤ç»™å†…æ ¸é•œåƒç”±æ­¤å†…æ ¸é˜¶æ®µå¼€å§‹äº†;</p>
<p>å†…æ ¸é•œåƒä¸æ˜¯ä¸€ä¸ªå¯ä»¥æ‰§è¡Œçš„å†…æ ¸ï¼Œè€Œæ˜¯ä¸€ä¸ªè¢«å‹ç¼©çš„å†…æ ¸é•œåƒ ï¼ˆ<code>zImage æˆ– bzImage</code>ï¼‰, åœ¨å†…æ ¸é•œåƒçš„å¤´éƒ¨æœ‰ä¸€ä¸ªå°å‹ç¨‹åº routine å…¶åšå°‘é‡çš„ç¡¬ä»¶è®¾ç½® ï¼Œç„¶åè‡ªè§£å‹å‹ç¼©çš„å†…æ ¸é•œåƒå¹¶æ”¾åˆ°é«˜ç«¯å†…å­˜ã€‚<br>å¦‚æœå­˜åœ¨åˆå§‹ç£ç›˜é•œåƒï¼ˆinitrdï¼‰, routine å°†æ‹·è´ initrd ä»¥ä¾›ç¨åå®‰è£…ä½¿ç”¨ï¼Œç„¶å routine å°†è°ƒç”¨å†…æ ¸å¼€å§‹å†…æ ¸å¯åŠ¨ã€‚</p>
<blockquote>
<p>åœ¨å†…æ ¸å¼•å¯¼è¿‡ç¨‹ä¸­ï¼Œåˆå§‹ RAM ç£ç›˜ï¼ˆinitrdï¼‰æ˜¯ç”± BootLoader åŠ è½½åˆ°å†…å­˜ä¸­çš„ï¼Œå®ƒä¼šè¢«å¤åˆ¶åˆ° RAM ä¸­å¹¶æŒ‚è½½åˆ°ç³»ç»Ÿä¸Šã€‚<br>initrd ä½œä¸º RAM ä¸­çš„ä¸´æ—¶æ ¹æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ï¼Œå¹¶å…è®¸å†…æ ¸åœ¨æ²¡æœ‰æŒ‚è½½ä»»ä½•ç‰©ç†ç£ç›˜çš„æƒ…å†µä¸‹å®Œæ•´åœ°å®ç°å¼•å¯¼(å®é™…ä¸ŠCentOS7å¿˜è®°ä½¿ç”¨è¿›è¡Œæ¢å¤ä¹Ÿæ˜¯ä¸»è¦ä¾èµ–äº<code>initrd</code>),ç”±äºä¸å¤–å›´è®¾å¤‡è¿›è¡Œäº¤äº’æ‰€éœ€è¦çš„æ¨¡å—å¯æ˜¯ initrd çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤å†…æ ¸å¯ä»¥éå¸¸å°ï¼Œä½†æ˜¯ä»ç„¶æ”¯æŒå¤§é‡å¯èƒ½çš„ç¡¬ä»¶é…ç½®<br>åœ¨å†…æ ¸å¯åŠ¨åå°±å¯ä»¥æ­£å¼è£…å¤‡æ ¹æ–‡ä»¶ç³»ç»Ÿäº†ï¼ˆé€šè¿‡ pivot_rootï¼‰ï¼Œæ­¤æ—¶ä¼šå°† initrd æ ¹æ–‡ä»¶ç³»ç»Ÿå¸è½½æ‰å¹¶æŒ‚è½½çœŸæ­£çš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚<br>initrd å‡½æ•°å¯ä»¥åˆ›å»ºä¸€ä¸ªå°å‹çš„ Linux å†…æ ¸ï¼Œå…¶ä¸­åŒ…æ‹¬ä½œä¸ºå¯åŠ è½½æ¨¡å—ç¼–è¯‘çš„é©±åŠ¨ç¨‹åº, å¹¶ä¸”è¯¥æ¨¡å—å¯ä»¥ä¸ºå†…æ ¸æä¾›äº†è®¿é—®ç£ç›˜å’Œç£ç›˜ä¸Šçš„æ–‡ä»¶ç³»ç»Ÿçš„æ–¹æ³•ï¼Œå¹¶ä¸ºå…¶ä»–ç¡¬ä»¶æä¾›äº†é©±åŠ¨ç¨‹åº<br>ç”±äºæ ¹æ–‡ä»¶ç³»ç»Ÿæ˜¯ç£ç›˜ä¸Šçš„ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤ initrd å‡½æ•°ä¼šæä¾›ä¸€ç§å¯åŠ¨æ–¹æ³•æ¥è·å¾—å¯¹ç£ç›˜çš„è®¿é—®ï¼Œå¹¶æŒ‚è½½çœŸæ­£çš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚ä½†æ˜¯åœ¨æ²¡æœ‰ç¡¬ç›˜çš„åµŒå…¥å¼ç›®æ ‡ä¸­ï¼Œinitrd å¯ä»¥æ˜¯æœ€ç»ˆçš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œæˆ–è€…ä¹Ÿå¯ä»¥é€šè¿‡ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆNFSï¼‰æ¥æŒ‚è½½æœ€ç»ˆçš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä½¿ç”¨ dmesg æ¥æŸ¥çœ‹ä»åŠ è½½å†…æ ¸åçš„æµç¨‹</span></span><br><span class="line">$ dmesg</span><br><span class="line">[    0.000000] Linux version 5.0.0-1031-gcp (buildd@lcy01-amd64-020) (gcc version 7.4.0 (Ubuntu 7.4.0-1ubuntu1~18.04.1)) <span class="comment">#32-Ubuntu SMP Tue Feb 11 03:55:48 UTC 2020 (Ubuntu 5.0.0-1031.32-gcp 5.0.21)</span></span><br><span class="line">[    0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-5.0.0-1031-gcp root=PARTUUID=9b22aacc-c8b9-497a-9583-a20c1be968c4 ro scsi_mod.use_blk_mq=Y console=ttyS0</span><br><span class="line">[    0.000000] KERNEL supported cpus:</span><br><span class="line">[    0.000000]   Intel GenuineIntel</span><br><span class="line">[    0.000000]   AMD AuthenticAMD</span><br><span class="line">[    0.000000]   Hygon HygonGenuine</span><br><span class="line">[    0.000000]   Centaur CentaurHauls</span><br><span class="line">â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class="line">[    2.486896] Write protecting the kernel <span class="built_in">read</span>-only data: 22528k</span><br><span class="line">[    2.489395] Freeing unused kernel image memory: 2016K</span><br><span class="line">[    2.490937] Freeing unused kernel image memory: 1708K</span><br><span class="line">[    2.500867] x86/mm: Checked W+X mappings: passed, no W+X pages found.</span><br><span class="line">[    2.503126] x86/mm: Checking user space page tables</span><br><span class="line">[    2.513767] x86/mm: Checked W+X mappings: passed, no W+X pages found.</span><br><span class="line">[    2.516258] Run /sbin/init as init process</span><br><span class="line">[    3.992535] systemd[1]: systemd 237 running <span class="keyword">in</span> system mode. (+PAM +AUDIT +SELINUX +IMA +APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 +SECCOMP +BLKID +ELFUTILS +KMOD -IDN2 +IDN -PCRE2 default-hierarchy=hybrid)</span><br><span class="line">[    4.002297] systemd[1]: Detected virtualization kvm.</span><br><span class="line">[    4.004593] systemd[1]: Detected architecture x86-64.</span><br><span class="line">[    4.031531] systemd[1]: Set hostname to &lt;blog&gt;.</span><br><span class="line">[    5.343604] systemd[1]: Reached target Swap.</span><br><span class="line">[    5.355156] systemd[1]: Started Dispatch Password Requests to Console Directory Watch.</span><br><span class="line">[    5.367360] systemd[1]: Created slice User and Session Slice.</span><br><span class="line">[    5.379321] systemd[1]: Set up automount Arbitrary Executable File Formats File System Automount Point.</span><br><span class="line">[    5.395189] systemd[1]: Started Forward Password Requests to Wall Directory Watch.</span><br><span class="line">[    5.411078] systemd[1]: Reached target Local Encrypted Volumes.</span><br><span class="line">[    5.644759] EXT4-fs (sda1): re-mounted. Opts: (null)</span><br><span class="line">[   11.663490] bpfilter: Loaded bpfilter_umh pid 456</span><br></pre></td></tr></table></figure>
<p><strong>ï¼ˆ4ï¼‰init é˜¶æ®µ</strong><br>å½“å†…æ ¸è‡ªè§£å‹å®Œæˆå¯åŠ¨å¹¶åˆå§‹åŒ–åï¼Œå†…æ ¸å¯åŠ¨ç¬¬ä¸€ä¸ªç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åºå³ systemd è¿›ç¨‹ï¼ˆ<code>å…¶å®æ˜¯è€å¼ System V ç³»ç»Ÿçš„ init ç¨‹åºçš„æ›¿ä»£å“</code>)å¹¶å°†æ§åˆ¶æƒç§»äº¤ç»™å®ƒ; è¿™æ˜¯ç³»ç»Ÿå¯åŠ¨åè°ƒç”¨çš„ç¬¬ä¸€ä¸ªä½¿ç”¨æ ‡å‡† C åº“ç¼–è¯‘çš„ç¨‹åºï¼Œåœ¨æ­¤è¿›ç¨‹ä¹‹å‰è¿˜æ²¡æœ‰æ‰§è¡Œä»»ä½•æ ‡å‡†çš„ C åº”ç”¨ç¨‹åºï¼Œè‡³æ­¤æ•´ä¸ªç³»ç»Ÿå¼•å¯¼è¿‡ç¨‹çš„ç»“æŸï¼›</p>
<p>æ­¤æ—¶ kernelå’Œ systemd å¤„äºå·¥ä½œè¿è¡ŒçŠ¶æ€ç„¶åå°±ç”±systemdæ¥ç®¡ç†å„é¡¹ç¨‹åºï¼Œæœ‰å¯èƒ½æ‚¨ä»dmesgè¾“é”™çš„æ—¥å¿—ä¸Šè¯¥é˜¶æ®µé¦–å…ˆæ‰§è¡Œ/sbin/initå‘½ä»¤è€Œå¯¹äºé‡‡ç”¨systemdçš„å‘è¡Œç‰ˆæ¥è¯´ï¼Œå®é™…ä¸Š<code>/sbin/init æ˜¯æŒ‡å‘ /lib/systemd/systemd</code>çš„è½¯é“¾æ¥æ–‡ä»¶;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[    2.516258] Run /sbin/init as init process</span><br><span class="line">[    3.992535] systemd[1]: systemd 237 running <span class="keyword">in</span> system mode. (+PAM +AUDIT +SELINUX +IMA +APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 +SECCOMP +BLKID +ELFUTILS +KMOD -IDN2 +IDN -PCRE2 default-hierarchy=hybrid)</span><br></pre></td></tr></table></figure></p>
<hr>
<h5 id="2-ä¸»è§’ç™»åœº"><a href="#2-ä¸»è§’ç™»åœº" class="headerlink" title="2.ä¸»è§’ç™»åœº"></a>2.ä¸»è§’ç™»åœº</h5><p><em>Q:ä¸ºä»€ä¹ˆä¸ºsystemdæ˜¯ Linux çš„å°ä¼™ä¼´?</em><br>ç­”:å…¶å®å¹¿ä¹‰ä¸Šæ¥è®² Linux æ˜¯ä¼—å¤š Linux ç³»ç»Ÿå‘è¡Œç‰ˆçš„é›†åˆï¼Œä½†ä¸¥æ ¼æ¥è®² Linux ä»…ä»…æ˜¯ä¸€ä¸ª OS çš„ kernel è€Œå·²ï¼Œä»…ä»…æœ‰ä¸€ä¸ªå†…æ ¸æ˜¯æ— æ³•ç»„æˆä¸€ä¸ªç³»ç»Ÿçš„ï¼Œæ‰€ä»¥ Linux kernel è¿˜éœ€è¦ä»–çš„å‡ ä¸ªå…„å¼Ÿ<code>æ¯”å¦‚ GNU ã€ systemd ã€X Window ã€GNOME ã€ KDE ã€Xfce ç­‰ç­‰</code>å…¶ä»–ç”¨æˆ·å±‚é¢çš„ç¨‹åºæ¥æ„å»ºå‡ºä¸€å¥—å®Œæ•´çš„æ“ä½œç³»ç»Ÿå‡ºæ¥</p>
<p>æ¯”å¦‚: GNU/Linux å°† Debian å“²å­¦ä¸æ–¹æ³•è®ºï¼ŒGNU å·¥å…·é›†ã€Linux å†…æ ¸ï¼Œä»¥åŠå…¶ä»–é‡è¦çš„è‡ªç”±è½¯ä»¶ç»“åˆåœ¨ä¸€èµ·æ‰€æ„æˆçš„ç‹¬ç‰¹çš„è½¯ä»¶å‘è¡Œç‰ˆç§°ä¸º Debian GNU/Linuxã€‚</p>
<p><strong>systemd ç®€ä»‹</strong><br>æè¿°:åœ¨ç‰‡å¤´çš„æ—¶å€™æˆ‘å¤§è‡´å¯¹systemdçš„å·¥ä½œåšäº†ä¸€ä¸ªæ€»ç»“ï¼Œåœ¨æœ¬ç« èŠ‚æˆ‘å¯¹å…¶æ·±å…¥çš„è®²è§£</p>
<p>systemd æ˜¯ä¸€ä¸ª Linux ç³»ç»ŸåŸºç¡€ç»„ä»¶çš„é›†åˆï¼Œæä¾›äº†ä¸€ä¸ªç³»ç»Ÿå’ŒæœåŠ¡ç®¡ç†å™¨ï¼Œè¿è¡Œä¸º PID 1 å¹¶è´Ÿè´£å¯åŠ¨å…¶å®ƒç¨‹åºã€‚<br><em>åŠŸèƒ½åŒ…æ‹¬ï¼š</em></p>
<ul>
<li>æ”¯æŒå¹¶è¡ŒåŒ–ä»»åŠ¡ï¼›</li>
<li>åŒæ—¶é‡‡ç”¨ socket å¼ä¸ D-Bus æ€»çº¿å¼æ¿€æ´»æœåŠ¡ï¼›</li>
<li>æŒ‰éœ€å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰ï¼›</li>
<li>åˆ©ç”¨ Linux çš„ cgroups ç›‘è§†è¿›ç¨‹ï¼› <code>æ¯”å¦‚systemctl æ˜¾ç¤º CPU å’Œ Mem ä¿¡æ¯å°±æ˜¯åŸºäºæ­¤å“¦</code>ã€‚</li>
<li>æ”¯æŒå¿«ç…§å’Œç³»ç»Ÿæ¢å¤ï¼›</li>
<li>ç»´æŠ¤æŒ‚è½½ç‚¹å’Œè‡ªåŠ¨æŒ‚è½½ç‚¹ï¼›</li>
<li>å„æœåŠ¡é—´åŸºäºä¾èµ–å…³ç³»è¿›è¡Œç²¾å¯†æ§åˆ¶ã€‚</li>
<li>systemd* æ”¯æŒ SysV å’Œ LSB åˆå§‹è„šæœ¬ï¼Œå¯ä»¥æ›¿ä»£ sysvinitã€‚</li>
<li>é™¤æ­¤ä¹‹å¤–åŠŸèƒ½è¿˜åŒ…æ‹¬æ—¥å¿—è¿›ç¨‹ã€æ§åˆ¶åŸºç¡€ç³»ç»Ÿé…ç½®ï¼Œç»´æŠ¤ç™»é™†ç”¨æˆ·åˆ—è¡¨ä»¥åŠç³»ç»Ÿè´¦æˆ·ã€è¿è¡Œæ—¶ç›®å½•å’Œè®¾ç½®ï¼Œå¯ä»¥è¿è¡Œå®¹å™¨å’Œè™šæ‹Ÿæœºï¼Œå¯ä»¥ç®€å•çš„ç®¡ç†ç½‘ç»œé…ç½®ã€ç½‘ç»œæ—¶é—´åŒæ­¥ã€æ—¥å¿—è½¬å‘å’Œåç§°è§£æç­‰ã€‚</li>
</ul>
<p><strong>systemd è®¾è®¡ç›®æ ‡</strong><br>æè¿°:åœ¨Redhatã€CentOSç­‰ç³»åˆ—å‘è¡Œç‰ˆä¸­ä»7.x ~ 8.x æ­£å¼é‡‡ç”¨systemdä½œä¸ºç³»ç»ŸæœåŠ¡ç®¡ç†å·¥å…·çš„å†…æ ¸ç³»ç»ŸæœåŠ¡;å®ƒèåˆä¹‹å‰serviceå’Œchkconfigçš„åŠŸèƒ½äºä¸€ä½“,æ‰€ä»¥è¯´å®ƒä¹Ÿèƒ½åœ¨ <code>/etc/init.d/</code> å¯åŠ¨è„šæœ¬è¿›è¡Œæ‰«ææŸ¥çœ‹ç›¸ç¨‹åº;</p>
<p>ä¸»è¦ç›®æ ‡ï¼š</p>
<ul>
<li>æ”¹è¿›æ•ˆèƒ½ï¼šä½¿ç”¨äºŒè¿›åˆ¶ä»£ç æ›¿æ¢æ¾æ•£çš„SYSVå¯åŠ¨è„šæœ¬ï¼Œå‡å°‘é¢‘ç¹çš„è¿›ç¨‹åˆ›å»º/ åº“åŠ è½½/ å†…æ ¸/ç”¨æˆ·åˆ‡æ¢ï¼›</li>
<li>å¯åŠ¨å¹¶è¡ŒåŒ–: åˆ©ç”¨ Dbus è¿›ç¨‹é—´é€šè®¯ä¸ socket æ¿€æ´»æœºåˆ¶ï¼Œè§£å†³ä»»åŠ¡å¯åŠ¨æ—¶çš„ä¾èµ–é—®é¢˜</li>
<li>å®ç°ä»»åŠ¡ï¼ˆdaemonsï¼‰ç²¾ç¡®æ§åˆ¶ï¼šä½¿ç”¨å†…æ ¸çš„ cgroup æœºåˆ¶ï¼Œä¸ä¾èµ– pid æ¥è¿½è¸ªè¿›ç¨‹ï¼Œå³ä½¿æ˜¯ä¸¤æ¬¡ forkä¹‹åç”Ÿæˆçš„å®ˆæŠ¤è¿›ç¨‹ä¹Ÿä¸ä¼šè„±ç¦» systemd çš„æ§åˆ¶</li>
<li>ç»Ÿä¸€ä»»åŠ¡å®šä¹‰: ç”¨æˆ·ä¸éœ€è¦è‡ªè¡Œç¼–å†™ shell è„šæœ¬ï¼Œè€Œä»…ä¾æ® systemd åˆ¶å®šçš„ unit è§„åˆ™ï¼›</li>
</ul>
<p><strong>systemd ä½“ç³»æ¶æ„</strong><br>systemdä½“ç³»æ¶æ„å¦‚ä¸‹:</p>
<ul>
<li>1.æœ€åº•å±‚ï¼š<code>systemd å†…æ ¸å±‚</code>é¢ä¾èµ– cgroupã€autofsã€kdbus</li>
<li>2.ç¬¬äºŒå±‚ï¼š<code>systemd libraries</code> æ˜¯ systemd ä¾èµ–åº“</li>
<li>3.ç¬¬ä¸‰å±‚ï¼š<code>systemd Core</code> æ˜¯ systemd è‡ªå·±çš„åº“</li>
<li>4.ç¬¬å››å±‚ï¼š<code>systemd daemons</code> ä»¥åŠ targets æ˜¯è‡ªå¸¦çš„ä¸€äº›åŸºæœ¬ unitã€targetï¼Œç±»ä¼¼äº sysvinit ä¸­è‡ªå¸¦çš„è„šæœ¬</li>
<li>5.æœ€ä¸Šå±‚å°±æ˜¯å’Œ systemd äº¤äº’çš„ä¸€äº›å·¥å…·ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸‹é¢å°†è¦å­¦ä¹ çš„systemctl;</li>
</ul>
<figure class="image-box">
                <a rel=systemdæœåŠ¡ç®¡ç†è¯¦è§£ä¸å­å‘½ä»¤ä¸€è§ˆ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200420194736.png" target="_blank" title="WeiyiGeek.systemdä½“ç³»" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200420194736.png" alt="WeiyiGeek.systemdä½“ç³»" title="" class=""></a>
                <p>WeiyiGeek.systemdä½“ç³»</p>
            </figure>
<p>Linux æ•´ä½“ç¡¬ä»¶ä¸systemdä½“ç³»æ¶æ„ï¼š<br><figure class="image-box">
                <a rel=systemdæœåŠ¡ç®¡ç†è¯¦è§£ä¸å­å‘½ä»¤ä¸€è§ˆ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200420195050.png" target="_blank" title="WeiyiGeek.Linuxç¡¬ä»¶" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200420195050.png" alt="WeiyiGeek.Linuxç¡¬ä»¶" title="" class=""></a>
                <p>WeiyiGeek.Linuxç¡¬ä»¶</p>
            </figure></p>
<hr>
<h4 id="0x01-Systemd-Unit"><a href="#0x01-Systemd-Unit" class="headerlink" title="0x01 Systemd Unit"></a>0x01 Systemd Unit</h4><p>æè¿°ï¼šsystemdæ ¸å¿ƒæ¦‚å¿µunitï¼ˆå•å…ƒï¼‰ç±»å‹ï¼šunitè¡¨ç¤ºä¸åŒç±»å‹çš„systemdå¯¹è±¡ï¼Œå¹¶æä¾›äº†å¤„ç†ä¸åŒå•å…ƒä¹‹é—´ä¾èµ–å…³ç³»çš„èƒ½åŠ›,é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œæ ‡è¯†å’Œé…ç½®ï¼›</p>
<p>Systemd æœåŠ¡ç¼–å†™å‚è€ƒ: <a href="http://www.jinbuguo.com/systemd/systemd.service.html" target="_blank" rel="noopener">http://www.jinbuguo.com/systemd/systemd.service.html</a></p>
<p>æ–‡ä»¶ä¸­ä¸»è¦åŒ…å«äº†ç³»ç»ŸæœåŠ¡ã€ç›‘å¬socketã€ä¿å­˜çš„ç³»ç»Ÿå¿«ç…§ä»¥åŠå…¶å®ƒä¸initç›¸å…³çš„ä¿¡æ¯;</p>
<table>
<thead>
<tr>
<th>type</th>
<th>name</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>Service unit</td>
<td>.service</td>
<td>ç”¨äºå°è£…ä¸€ä¸ªåå°æœåŠ¡è¿›ç¨‹</td>
</tr>
<tr>
<td>Target unit</td>
<td>.target</td>
<td>ç”¨äºå°†å¤šä¸ªå•å…ƒåœ¨é€»è¾‘ä¸Šç»„åˆåœ¨ä¸€èµ·ã€‚</td>
</tr>
<tr>
<td>Device unit</td>
<td>.device</td>
<td>ç”¨äºå®šä¹‰å†…æ ¸è¯†åˆ«çš„è®¾å¤‡ï¼Œåœ¨ sysfs(5) é‡Œé¢ä½œä¸º udev(7) è®¾å¤‡æ ‘å±•ç¤º</td>
</tr>
<tr>
<td>Socket unit</td>
<td>.socket</td>
<td>ç”¨äºæ ‡è¯†è¿›ç¨‹é—´é€šä¿¡ç”¨åˆ°çš„socketæ–‡ä»¶</td>
</tr>
<tr>
<td>Snapshot unit</td>
<td>.snapshot</td>
<td>ç®¡ç†ç³»ç»Ÿå¿«ç…§</td>
</tr>
<tr>
<td>Swap unit</td>
<td>.swap</td>
<td>ç”¨äºæ ‡è¯†swap æ–‡ä»¶æˆ–è®¾å¤‡</td>
</tr>
<tr>
<td>Mount unit</td>
<td>.mount</td>
<td>ç”¨äºå°è£…ä¸€ä¸ªæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹(ä¹Ÿå‘åå…¼å®¹ä¼ ç»Ÿçš„ /etc/fstab æ–‡ä»¶)</td>
</tr>
<tr>
<td>Automount unit</td>
<td>.automount</td>
<td>ç”¨äºå°è£…ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿè‡ªåŠ¨æŒ‚è½½ç‚¹</td>
</tr>
<tr>
<td>Path unit</td>
<td>.path</td>
<td>ç”¨äºæ ¹æ®æ–‡ä»¶ç³»ç»Ÿä¸Šç‰¹å®šå¯¹è±¡çš„å˜åŒ–æ¥å¯åŠ¨å…¶ä»–æœåŠ¡ã€‚</td>
</tr>
<tr>
<td>Time unit</td>
<td>.timer</td>
<td>ç”¨äºå°è£…ä¸€ä¸ªåŸºäºæ—¶é—´è§¦å‘çš„åŠ¨ä½œã€‚å–ä»£ä¼ ç»Ÿçš„ crond ç­‰ä»»åŠ¡è®¡åˆ’æœåŠ¡</td>
</tr>
<tr>
<td>Slice unit</td>
<td>*.slice</td>
<td>ç”¨äºæ§åˆ¶ç‰¹å®š CGroup å†…æ‰€æœ‰è¿›ç¨‹çš„æ€»ä½“èµ„æºå ç”¨ã€‚</td>
</tr>
</tbody>
</table>
<p>systemd åªåœ¨å†…å­˜ä¸­åŠ è½½æœ€å°åŒ–çš„ä¸€ç»„å•å…ƒ åªæœ‰è‡³å°‘æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ä¹‹ä¸€çš„å•å…ƒï¼Œæ‰ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼š</p>
<ul>
<li><p>1.å¤„äº æ´»åŠ¨(active)ã€å¯åŠ¨ä¸­(activating)ã€åœæ­¢ä¸­(deactivating)ã€å¤±è´¥(failed) çŠ¶æ€ä¹‹ä¸€(ä¹Ÿå°±æ˜¯åœæ­¢(inactive)ä¹‹å¤–çš„çŠ¶æ€)</p>
</li>
<li><p>2.è‡³å°‘æœ‰ä¸€ä¸ªä½œä¸šæ­£åœ¨ä½œä¸šé˜Ÿåˆ—ä¸­</p>
</li>
<li><p>3.è‡³å°‘æœ‰ä¸€ä¸ªå…¶ä»–å·²ç»åŠ è½½åˆ°å†…å­˜ä¸­çš„å•å…ƒä¾èµ–äºå®ƒ</p>
</li>
<li><p>4.ä»ç„¶å æœ‰æŸäº›èµ„æº (ä¾‹å¦‚ä¸€ä¸ªå·²åœæ­¢çš„æœåŠ¡å•å…ƒçš„è¿›ç¨‹å¿½ç•¥äº†ç»ˆæ­¢è¯·æ±‚ï¼Œä»åœ¨é€—ç•™)</p>
</li>
<li><p>5.è¢« D-Bus è°ƒç”¨ä»¥ç¨‹åºåŒ–çš„æ–¹å¼å›ºå®šåˆ°äº†å†…å­˜ä¸­</p>
</li>
</ul>
<p>  å®é™…ä¸Šç”¨æˆ·å¹¶ä¸èƒ½æ˜¾è€Œæ˜“è§çš„çœ‹åˆ°æŸä¸ªå•å…ƒæ˜¯å¦å·²è¢«åŠ è½½åˆ°å†…å­˜ç”¨ <code>systemctl list-units â€“all</code> å‘½ä»¤å¯ä»¥æ˜¾ç¤ºå½“å‰å·²åŠ è½½åˆ°å†…å­˜ä¸­çš„æ‰€æœ‰å•å…ƒä¸æ»¡è¶³åŠ è½½æ¡ä»¶(è§ä¸Šæ–‡)çš„å•å…ƒä¼šè¢«ç«‹å³ä»å†…å­˜ä¸­å¸è½½ï¼Œå¹¶ä¸”å®ƒçš„è®°å¸æ•°æ®(accounting data)ä¹Ÿä¼šè¢«æ¸…ç©ºã€‚ ä¸è¿‡å› ä¸ºæ¯å½“ä¸€ä¸ªå•å…ƒå…³é—­æ—¶ï¼Œéƒ½ä¼šç”Ÿæˆä¸€æ¡æ—¥å¿—è®°å½•å£°æ˜è¯¥å•å…ƒæ‰€æ¶ˆè€—çš„èµ„æºï¼Œ æ‰€ä»¥è¿™äº›æ•°æ®é€šå¸¸ä¸ä¼šå½»åº•æ¶ˆå¤±ã€‚</p>
<h5 id="1-é…ç½®æ–‡ä»¶"><a href="#1-é…ç½®æ–‡ä»¶" class="headerlink" title="1.é…ç½®æ–‡ä»¶"></a>1.é…ç½®æ–‡ä»¶</h5><ul>
<li><p>åœ¨ CentOS/RedHat å‘è¡Œç‰ˆä¸­ <code>man systemd.unit</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Table 1.  Load path when running <span class="keyword">in</span> system mode (--system).</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚Path                    â”‚ Description                 â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚/etc/systemd/system     â”‚ Local configuration         â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚/run/systemd/system     â”‚ Runtime units               â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚/usr/lib/systemd/system â”‚ Units of installed packages â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>åœ¨ Ubuntu/Debian å‘è¡Œç‰ˆä¸­ <code>man systemd.unit</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Table 1.  Load path when running in system mode (--system).</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚Path                â”‚ Description                 â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚&#x2F;etc&#x2F;systemd&#x2F;system â”‚ Local configuration         â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚&#x2F;run&#x2F;systemd&#x2F;system â”‚ Runtime units               â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚&#x2F;lib&#x2F;systemd&#x2F;system â”‚ Units of installed packages â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>  åœ¨ä½¿ç”¨ yum/apt æˆ–å…¶ä»–åŒ…ç®¡ç†å™¨ï¼Œä»¥åŠ rpm/deb ç­‰è½¯ä»¶åŒ…å®‰è£…è½¯ä»¶çš„æ—¶å€™ï¼Œå¦‚æœè¯¥è½¯ä»¶æ”¯æŒ systemd ç®¡ç†çš„è¯ï¼Œå°±ä¼šè‡ªåŠ¨åœ¨<code>/usr/lib/systemd/system</code>ç›®å½•æ·»åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶(é’ˆå¯¹äºCentOSè¯´æ˜)ï¼Œæ­¤æ—¶å¯ä»¥é‡‡ç”¨<code>systemctl cat name æ¥æŸ¥çœ‹è¯¥è½¯ä»¶çš„ systemd å•å…ƒæ–‡ä»¶</code></p>
<p>  ä½†æ˜¯å¦‚æœè½¯ä»¶æ²¡æœ‰è‡ªå¸¦ systemd é…ç½®æ–‡ä»¶çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±æ“ä¸€ä¸ªé…ç½®æ–‡ä»¶å‡ºæ¥ï¼Œå¹¶å¤åˆ¶åˆ°ç›¸åº”çš„ç›®å½•ä¸‹å³å¯ï¼ˆåç»­æˆ‘ä¼šç®€å•é…ç½®ä¸€ä¸ªå®ä¾‹<code>[Webp Server Go](https://github.com/webp-sh/webp_server_go)</code>ï¼‰</p>
<p>  <br></p>
<p>  <em>service unitæ–‡ä»¶æ ¼å¼è¯´æ˜ï¼ˆç±»ä¼¼äºwindowsä¸‹çš„iniï¼‰ï¼š</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">man systemd.service  <span class="comment">#å‚è€ƒ</span></span><br><span class="line"></span><br><span class="line">[unit]</span><br><span class="line">Descriptionï¼šæè¿°ä¿¡æ¯</span><br><span class="line">Afterï¼šå®šä¹‰unitçš„å¯åŠ¨æ¬¡åºï¼Œè¡¨ç¤ºå½“å‰unitåº”è¯¥æ™šäºå“ªäº›unitå¯åŠ¨ï¼Œå…¶åŠŸèƒ½ä¸Beforeç›¸å</span><br><span class="line">Requiresï¼šä¾èµ–åˆ°çš„å…¶å®ƒunitsï¼Œå¼ºä¾èµ–ï¼Œè¢«ä¾èµ–çš„unitsæ— æ³•æ¿€æ´»æ—¶ï¼Œå½“å‰unitä¹Ÿæ— æ³•æ¿€æ´»</span><br><span class="line">Wantsï¼šä¾èµ–åˆ°çš„å…¶å®ƒunitsï¼Œå¼±ä¾èµ–</span><br><span class="line">Conflictsï¼šå®šä¹‰unitsé—´çš„å†²çªå…³ç³»			</span><br><span class="line"></span><br><span class="line">[Service] <span class="comment">#ä¸ç‰¹å®šç±»å‹ç›¸å…³çš„ä¸“ç”¨é€‰é¡¹ï¼›æ­¤å¤„ä¸ºServiceç±»å‹</span></span><br><span class="line">Typeï¼šå®šä¹‰å½±å“ExecStartåŠç›¸å…³å‚æ•°çš„åŠŸèƒ½çš„unitè¿›ç¨‹å¯åŠ¨ç±»å‹</span><br><span class="line">    simpleï¼šé»˜è®¤å€¼ï¼Œè¿™ä¸ªdaemonä¸»è¦ç”±ExecStartæ¥çš„æŒ‡ä»¤ä¸²æ¥å¯åŠ¨ï¼Œå¯åŠ¨åå¸¸é©»äºå†…å­˜ä¸­</span><br><span class="line">    forkingï¼šç”±ExecStartå¯åŠ¨çš„ç¨‹åºé€è¿‡spawnså»¶ä¼¸å‡ºå…¶ä»–å­ç¨‹åºæ¥ä½œä¸ºæ­¤daemonçš„ä¸»è¦æœåŠ¡ã€‚åŸç”Ÿçˆ¶ç¨‹åºåœ¨å¯åŠ¨ç»“æŸåå°±ä¼šç»ˆæ­¢</span><br><span class="line">    oneshotï¼šä¸simpleç±»ä¼¼ï¼Œä¸è¿‡è¿™ä¸ªç¨‹åºåœ¨å·¥ä½œå®Œæ¯•åå°±ç»“æŸäº†ï¼Œä¸ä¼šå¸¸é©»åœ¨å†…å­˜ä¸­</span><br><span class="line">    dbusï¼šä¸simpleç±»ä¼¼ï¼Œä½†è¿™ä¸ªdaemonå¿…é¡»è¦åœ¨å–å¾—ä¸€ä¸ªD-Busçš„åç§°åï¼Œæ‰ä¼šç»§ç»­è¿ä½œ.å› æ­¤é€šå¸¸ä¹Ÿè¦åŒæ—¶è®¾å®šBusNname=æ‰è¡Œ</span><br><span class="line">    notifyï¼šåœ¨å¯åŠ¨å®Œæˆåä¼šå‘é€ä¸€ä¸ªé€šçŸ¥æ¶ˆæ¯ã€‚è¿˜éœ€è¦é…åˆ NotifyAccess æ¥è®© Systemd æ¥æ”¶æ¶ˆæ¯</span><br><span class="line">    idleï¼šä¸simpleç±»ä¼¼ï¼Œè¦æ‰§è¡Œè¿™ä¸ªdaemonå¿…é¡»è¦æ‰€æœ‰çš„å·¥ä½œéƒ½é¡ºåˆ©æ‰§è¡Œå®Œæ¯•åæ‰ä¼šæ‰§è¡Œã€‚è¿™ç±»çš„daemoné€šå¸¸æ˜¯å¼€æœºåˆ°æœ€åæ‰æ‰§è¡Œå³å¯çš„æœåŠ¡</span><br><span class="line">EnvironmentFile=/etc/sysconfig/sshd   <span class="comment">#ç¯å¢ƒfile</span></span><br><span class="line">ExecStart=/usr/sbin/sshd -D <span class="variable">$OPTIONS</span>  <span class="comment">#å¯åŠ¨</span></span><br><span class="line">ExecReload=/bin/<span class="built_in">kill</span> -HUP <span class="variable">$MAINPID</span>  <span class="comment">#é‡å¯</span></span><br><span class="line">KillMode=process     <span class="comment">#å…³é—­</span></span><br><span class="line">Restart=on-failure   <span class="comment"># Restart: fail æ—¶é‡å¯</span></span><br><span class="line">RestartSec=42s</span><br><span class="line"></span><br><span class="line">[Target]</span><br><span class="line"><span class="comment">#.targetå®šä¹‰äº†ä¸€äº›åŸºç¡€çš„ç»„ä»¶ï¼Œä¾›.serviceæ–‡ä»¶è°ƒç”¨</span></span><br><span class="line"></span><br><span class="line">[Mount]</span><br><span class="line"><span class="comment">#.mountæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªæŒ‚è½½ç‚¹ï¼Œ[Mount]èŠ‚ç‚¹é‡Œé…ç½®äº†What,Where,Typeä¸‰ä¸ªæ•°æ®é¡¹</span></span><br><span class="line"><span class="comment">#ç­‰åŒäºä»¥ä¸‹å‘½ä»¤ï¼šmount -t hugetlbfs /dev/hugepages hugetlbfs</span></span><br><span class="line">What=hugetlbfs </span><br><span class="line">Where-/dev/hugepages</span><br><span class="line">Type=hugetlbfs</span><br><span class="line"></span><br><span class="line">[Install]ï¼š<span class="comment">#å®šä¹‰ç”±â€œsystemctl enableâ€ä»¥åŠ"systemctl disableâ€œå‘½ä»¤åœ¨å®ç°æœåŠ¡å¯ç”¨æˆ–ç¦ç”¨æ—¶ç”¨åˆ°çš„ä¸€äº›é€‰é¡¹</span></span><br><span class="line">Aliasï¼šåˆ«åï¼Œå¯ä½¿ç”¨systemctl <span class="built_in">command</span> Alias.service</span><br><span class="line">RequiredByï¼šè¢«å“ªäº›unitsæ‰€ä¾èµ–ï¼Œå¼ºä¾èµ–</span><br><span class="line">WantedByï¼šè¢«å“ªäº›unitsæ‰€ä¾èµ–ï¼Œå¼±ä¾èµ– å¤šç”¨æˆ·æ¨¡å¼ä¸‹éœ€è¦çš„</span><br><span class="line">Alsoï¼šå®‰è£…æœ¬æœåŠ¡çš„æ—¶å€™è¿˜è¦å®‰è£…åˆ«çš„ç›¸å…³æœåŠ¡</span><br></pre></td></tr></table></figure></p>
<p>  æ³¨æ„äº‹é¡¹:</p>
<ul>
<li>ä¸åŒçš„å‘è¡Œç‰ˆ systemd unit çš„ path ä¸ä¸€æ ·ï¼Œä½†æ˜¯æ€»ä½“æ¥è¯´systemd çš„é…ç½®æ–‡ä»¶ä¸»è¦ä½äºä»¥ä¸‹ä¸‰ä¸ªç›®å½•ä¸­<ul>
<li><code>/usr/lib/systemd/system</code> æˆ– <code>/lib/systemd</code> : ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…çš„è½¯ä»¶çš„ systemd unit ä»¶å®é™…é…ç½®æ–‡ä»¶çš„å­˜æ”¾ä½ç½®</li>
<li><code>/run/systemd/system</code>ï¼šåœ¨è¿è¡Œæ—¶åˆ›å»ºçš„s ystemd unit æ–‡ä»¶ã€‚è¯¥ç›®å½•ä¼˜å…ˆäºå·²å®‰è£…æœåŠ¡å•å…ƒæ–‡ä»¶çš„ç›®å½•ã€‚</li>
<li><code>/etc/systemd/system</code>: <code>ä¼˜å…ˆçº§æœ€é«˜</code>ï¼Œç”± systemctl å‘½ä»¤åˆ›å»ºçš„ systemd unit æ–‡ä»¶ä»¥åŠä¸ºæ‰©å±•æœåŠ¡è€Œæ·»åŠ çš„ unit æ–‡ä»¶éƒ½å°†å¯ç”¨ã€‚</li>
</ul>
</li>
</ul>
<h5 id="2-å¯åŠ¨æµç¨‹"><a href="#2-å¯åŠ¨æµç¨‹" class="headerlink" title="2.å¯åŠ¨æµç¨‹"></a>2.å¯åŠ¨æµç¨‹</h5><p>å½“å†…æ ¸åŠ è½½åˆ°å†…å­˜ä¸­åå¼€å§‹æ‰§è¡Œ systemdï¼Œå¹¶ä¸”æ ¹æ® dmesg çš„æ—¥å¿—æˆ‘ä»¬å¯ä»¥äº†è§£åˆ° systemd å¯åŠ¨åæ‰§è¡Œäº†å“ªä¸€äº›æ“ä½œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[    2.516258] Run &#x2F;sbin&#x2F;init as init process</span><br><span class="line">[    3.992535] systemd[1]: systemd 237 running in system mode. (+PAM +AUDIT +SELINUX +IMA +APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 +SECCOMP +BLKID +ELFUTILS +KMOD -IDN2 +IDN -PCRE2 default-hierarchy&#x3D;hybrid)</span><br><span class="line">[    4.002297] systemd[1]: Detected virtualization kvm.</span><br><span class="line">[    4.004593] systemd[1]: Detected architecture x86-64.</span><br><span class="line">[    4.031531] systemd[1]: Set hostname to &lt;blog&gt;.</span><br><span class="line">[    5.343604] systemd[1]: Reached target Swap.</span><br><span class="line">[    5.355156] systemd[1]: Started Dispatch Password Requests to Console Directory Watch.</span><br><span class="line">[    5.367360] systemd[1]: Created slice User and Session Slice.</span><br><span class="line">[    5.379321] systemd[1]: Set up automount Arbitrary Executable File Formats File System Automount Point.</span><br><span class="line">[    5.395189] systemd[1]: Started Forward Password Requests to Wall Directory Watch.</span><br><span class="line">[    5.411078] systemd[1]: Reached target Local Encrypted Volumes.</span><br><span class="line">[    5.644759] EXT4-fs (sda1): re-mounted. Opts: (null)</span><br><span class="line">[    5.702603] RPC: Registered named UNIX socket transport module.</span><br><span class="line">[    5.704115] RPC: Registered udp transport module.</span><br><span class="line">[    5.705318] RPC: Registered tcp transport module.</span><br><span class="line">[    5.706573] RPC: Registered tcp NFSv4.1 backchannel transport module.</span><br><span class="line">[    5.825727] Loading iSCSI transport class v2.0-870.</span><br><span class="line">[    5.912079] iscsi: registered transport (tcp)</span><br><span class="line">[    5.942499] systemd-journald[196]: Received request to flush runtime journal from PID 1</span><br><span class="line">[    5.973269] systemd-journald[196]: File &#x2F;var&#x2F;log&#x2F;journal&#x2F;7bc72ce3e0aa559e38159aa4fa0547f9&#x2F;system.journal corrupted or uncleanly shut down, renaming and replacing.</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢çš„å›¾è¡¨è§£é‡Šäº† è¿™äº›å…·æœ‰ç‰¹å®šå«ä¹‰çš„ target å•å…ƒä¹‹é—´çš„ä¾èµ–å…³ç³» ä»¥åŠå„è‡ªåœ¨å¯åŠ¨æµç¨‹ä¸­çš„ä½ç½®ã€‚å›¾ä¸­çš„ç®­å¤´è¡¨ç¤ºäº†å•å…ƒä¹‹é—´çš„ä¾èµ–å…³ç³»ä¸å…ˆåé¡ºåºï¼Œ æ•´ä¸ªå›¾è¡¨æŒ‰ç…§è‡ªä¸Šè€Œä¸‹çš„æ—¶é—´é¡ºåºæ‰§è¡Œã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">local-fs-pre.target</span><br><span class="line">            |</span><br><span class="line">            v</span><br><span class="line">   (various mounts and   (various swap   (various cryptsetup</span><br><span class="line">    fsck services...)     devices...)        devices...)       (various low-level   (various low-level</span><br><span class="line">            |                  |                  |             services: udevd,     API VFS mounts:</span><br><span class="line">            v                  v                  v             tmpfiles, random     mqueue, configfs,</span><br><span class="line">     local-fs.target      swap.target     cryptsetup.target    seed, sysctl, ...)      debugfs, ...) #ä¸»è¦å•å…ƒUnti</span><br><span class="line">            |                  |                  |                    |                    |</span><br><span class="line">            \__________________|_________________ | &#96;_______________&#96; |____________________&#x2F;</span><br><span class="line">                                                 \|&#x2F;</span><br><span class="line">                                                  v</span><br><span class="line">                                           sysinit.target</span><br><span class="line">                                                  |</span><br><span class="line">             &#96;________________________________&#96; &#x2F;|\________________________________________</span><br><span class="line">            &#x2F;                  |                  |                    |                    \</span><br><span class="line">            |                  |                  |                    |                    |</span><br><span class="line">            v                  v                  |                    v                    v</span><br><span class="line">        (various           (various               |                (various          rescue.service</span><br><span class="line">       timers...)          paths...)              |               sockets...)               |</span><br><span class="line">            |                  |                  |                    |                    v</span><br><span class="line">            v                  v                  |                    v             *rescue.target</span><br><span class="line">      timers.target      paths.target             |             sockets.target</span><br><span class="line">            |                  |                  |                    |</span><br><span class="line">            v                  \_________________ | &#96;_______________&#96; &#x2F;</span><br><span class="line">                                                 \|&#x2F;</span><br><span class="line">                                                  v</span><br><span class="line">                                            basic.target</span><br><span class="line">                                                  |</span><br><span class="line">             &#96;________________________________&#96; &#x2F;|                                 emergency.service</span><br><span class="line">            &#x2F;                  |                  |                                         |</span><br><span class="line">            |                  |                  |                                         v</span><br><span class="line">            v                  v                  v                                *emergency.target</span><br><span class="line">        display-        (various system    (various system</span><br><span class="line">    manager.service         services           services)</span><br><span class="line">            |             required for            |</span><br><span class="line">            |            graphical UIs)           v</span><br><span class="line">            |                  |          *multi-user.target</span><br><span class="line">            |                  |                  |</span><br><span class="line">            \_________________ | &#96;_____________&#96; &#x2F;</span><br><span class="line">                              \|&#x2F;</span><br><span class="line">                               v</span><br><span class="line">                  *graphical.target</span><br></pre></td></tr></table></figure>
<p>(1) systemd æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªç›®æ ‡æ˜¯ <strong>default.target</strong>ã€‚ä½†å®é™…ä¸Š default.target æ˜¯æŒ‡å‘ <strong>graphical.target</strong> çš„è½¯é“¾æ¥ã€‚Graphical.target çš„å®é™…ä½ç½®æ˜¯<code>/usr/lib/systemd/system/graphical.target</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ cat /usr/lib/systemd/system/graphical.target</span><br><span class="line"><span class="comment">#  This file is part of systemd.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  systemd is free software; you can redistribute it and/or modify it</span></span><br><span class="line"><span class="comment">#  under the terms of the GNU Lesser General Public License as published by</span></span><br><span class="line"><span class="comment">#  the Free Software Foundation; either version 2.1 of the License, or</span></span><br><span class="line"><span class="comment">#  (at your option) any later version.</span></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Graphical Interface</span><br><span class="line">Documentation=man:systemd.special(7)</span><br><span class="line">Requires=multi-user.target <span class="comment">#æ³¨æ„ä¾èµ–</span></span><br><span class="line">Wants=display-manager.service</span><br><span class="line">Conflicts=rescue.service rescue.target</span><br><span class="line">After=multi-user.target rescue.service rescue.target display-manager.service</span><br><span class="line">AllowIsolate=yes</span><br></pre></td></tr></table></figure>
<p>(2) åœ¨<strong>default.target</strong>è¿™ä¸ªé˜¶æ®µï¼Œä¼šå¯åŠ¨<strong>multi-user.target</strong>è€Œè¿™ä¸ª target å°†è‡ªå·±çš„å­å•å…ƒæ”¾åœ¨ç›®å½•<code>/etc/systemd/system/multi-user.target.wants</code>é‡Œã€‚è¿™ä¸ª target ä¸ºå¤šç”¨æˆ·æ”¯æŒè®¾å®šç³»ç»Ÿç¯å¢ƒã€‚é rootç”¨æˆ·ä¼šåœ¨è¿™ä¸ªé˜¶æ®µçš„å¼•å¯¼è¿‡ç¨‹ä¸­å¯ç”¨ã€‚é˜²ç«å¢™ç›¸å…³çš„æœåŠ¡ä¹Ÿä¼šåœ¨è¿™ä¸ªé˜¶æ®µå¯åŠ¨ã€‚<strong>multi-user.target</strong>ä¼šå°†æ§åˆ¶æƒäº¤ç»™å¦ä¸€å±‚<strong>basic.target</strong>ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/lib/systemd/system/multi-user.target</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Multi-User System</span><br><span class="line">Documentation=man:systemd.special(7)</span><br><span class="line">Requires=basic.target <span class="comment">#æ³¨æ„ä¾èµ–</span></span><br><span class="line">Conflicts=rescue.service rescue.target</span><br><span class="line">After=basic.target rescue.service rescue.target</span><br><span class="line">AllowIsolate=yes</span><br></pre></td></tr></table></figure>
<p>ï¼ˆ3ï¼‰<strong>basic.target</strong>å•å…ƒç”¨äºå¯åŠ¨æ™®é€šæœåŠ¡ç‰¹åˆ«æ˜¯å›¾å½¢ç®¡ç†æœåŠ¡ã€‚å®ƒé€šè¿‡<code>/etc/systemd/system/basic.target.wants</code>ç›®å½•æ¥å†³å®šå“ªäº›æœåŠ¡ä¼šè¢«å¯åŠ¨ï¼Œ<strong>basic.target</strong> ä¹‹åå°†æ§åˆ¶æƒäº¤ç»™ <strong>sysinit.target</strong>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ tree /etc/systemd/system/multi-user.target.wants</span><br><span class="line">/etc/systemd/system/multi-user.target.wants</span><br><span class="line">â”œâ”€â”€ auditd.service -&gt; /usr/lib/systemd/system/auditd.service</span><br><span class="line">â”œâ”€â”€ chronyd.service -&gt; /usr/lib/systemd/system/chronyd.service</span><br><span class="line">â”œâ”€â”€ crond.service -&gt; /usr/lib/systemd/system/crond.service</span><br><span class="line">â”œâ”€â”€ docker.service -&gt; /usr/lib/systemd/system/docker.service</span><br><span class="line">â”œâ”€â”€ firewalld.service -&gt; /usr/lib/systemd/system/firewalld.service</span><br><span class="line">â”œâ”€â”€ gitlab-runner.service -&gt; /etc/systemd/system/gitlab-runner.service</span><br><span class="line">â”œâ”€â”€ irqbalance.service -&gt; /usr/lib/systemd/system/irqbalance.service</span><br><span class="line">â”œâ”€â”€ kdump.service -&gt; /usr/lib/systemd/system/kdump.service</span><br><span class="line">â”œâ”€â”€ NetworkManager.service -&gt; /usr/lib/systemd/system/NetworkManager.service</span><br><span class="line">â”œâ”€â”€ postfix.service -&gt; /usr/lib/systemd/system/postfix.service</span><br><span class="line">â”œâ”€â”€ remote-fs.target -&gt; /usr/lib/systemd/system/remote-fs.target</span><br><span class="line">â”œâ”€â”€ rhel-configure.service -&gt; /usr/lib/systemd/system/rhel-configure.service</span><br><span class="line">â”œâ”€â”€ rsyslog.service -&gt; /usr/lib/systemd/system/rsyslog.service</span><br><span class="line">â”œâ”€â”€ sshd.service -&gt; /usr/lib/systemd/system/sshd.service</span><br><span class="line">â””â”€â”€ tuned.service -&gt; /usr/lib/systemd/system/tuned.service</span><br></pre></td></tr></table></figure>
<p>(4) <strong>sysinit.target</strong>ä¼šå¯åŠ¨é‡è¦çš„ç³»ç»ŸæœåŠ¡ä¾‹å¦‚ç³»ç»ŸæŒ‚è½½ï¼Œå†…å­˜äº¤æ¢ç©ºé—´å’Œè®¾å¤‡ï¼Œå†…æ ¸è¡¥å……é€‰é¡¹ç­‰ç­‰ã€‚sysinit.target åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ä¼šä¼ é€’ç»™<strong>local-fs.target</strong>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tree &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;basic.target.wants</span><br><span class="line">&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;basic.target.wants</span><br><span class="line">â”œâ”€â”€ microcode.service -&gt; &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;microcode.service</span><br><span class="line">â””â”€â”€ rhel-dmesg.service -&gt; &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;rhel-dmesg.service</span><br></pre></td></tr></table></figure>
<p>(5) <code>local-fs.target</code>ï¼Œè¿™ä¸ª target å•å…ƒä¸ä¼šå¯åŠ¨ç”¨æˆ·ç›¸å…³çš„æœåŠ¡ï¼Œå®ƒåªå¤„ç†åº•å±‚æ ¸å¿ƒæœåŠ¡ã€‚è¿™ä¸ª target ä¼šæ ¹æ® /etc/fstab å’Œ /etc/inittab æ¥æ‰§è¡Œç›¸å…³æ“ä½œã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;sysinit.target</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description&#x3D;System Initialization</span><br><span class="line">Documentation&#x3D;man:systemd.special(7)</span><br><span class="line">Conflicts&#x3D;emergency.service emergency.target</span><br><span class="line">Wants&#x3D;local-fs.target swap.target</span><br><span class="line">After&#x3D;local-fs.target swap.target emergency.service emergency.target</span><br></pre></td></tr></table></figure>
<h5 id="3-è¿›ç¨‹æ ‘-Process-tree"><a href="#3-è¿›ç¨‹æ ‘-Process-tree" class="headerlink" title="3.è¿›ç¨‹æ ‘(Process tree)"></a>3.è¿›ç¨‹æ ‘(Process tree)</h5><p>ä½¿ç”¨ pstree å‘½ä»¤æ¥çœ‹ä¸€å“ˆè¿›ç¨‹æ ‘çš„çŠ¶æ€ï¼Œç”¨æˆ·ç©ºé—´çš„è¿›ç¨‹éƒ½æŒ‚åœ¨ PID ä¸º 1 çš„ systemd ä¸‹ï¼Œæ³¨æ„è¯¥å‘½ä»¤ä¸æ˜¯å‘è¡Œç‰ˆæœ¬å†…ç½®çš„éœ€è¦è¿›è¡Œå®‰è£… <code>yum install pstree</code>;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€root@sg-02 ~</span><br><span class="line">â•°â”€# pstree -p</span><br><span class="line">systemd(1)â”€â”¬â”€accounts-daemon(661)â”€â”¬â”€&#123;accounts-daemon&#125;(689)</span><br><span class="line">           â”‚                      â””â”€&#123;accounts-daemon&#125;(729)</span><br><span class="line">           â”œâ”€agetty(971)</span><br><span class="line">           â”œâ”€agetty(992)</span><br><span class="line">           â”œâ”€aria2c(1010)</span><br><span class="line">           â”œâ”€atd(653)</span><br><span class="line">           â”œâ”€containerd(2915)â”€â”¬â”€&#123;containerd&#125;(2928)</span><br><span class="line">           â”‚                  â”œâ”€&#123;containerd&#125;(2929)</span><br><span class="line">           â”‚                  â”œâ”€&#123;containerd&#125;(2930)</span><br><span class="line">           â”‚                  â”œâ”€&#123;containerd&#125;(2934)</span><br><span class="line">           â”‚                  â”œâ”€&#123;containerd&#125;(2935)</span><br><span class="line">           â”‚                  â”œâ”€&#123;containerd&#125;(2950)</span><br><span class="line">           â”‚                  â”œâ”€&#123;containerd&#125;(2951)</span><br><span class="line">           â”‚                  â”œâ”€&#123;containerd&#125;(2978)</span><br><span class="line">           â”‚                  â”œâ”€&#123;containerd&#125;(5360)</span><br><span class="line">           â”‚                  â””â”€&#123;containerd&#125;(8299)</span><br><span class="line">           â”œâ”€cron(639)â”€â”€â”€cron(20506)â”€â”€â”€sh(20507)â”€â”€â”€monitor.sh(20509)â”€â”€â”€ffmpeg(20514)</span><br><span class="line">           â”œâ”€dbus-daemon(664)</span><br><span class="line">           â”œâ”€dockerd(17771)â”€â”¬â”€&#123;dockerd&#125;(17783)</span><br><span class="line">           â”‚                â”œâ”€&#123;dockerd&#125;(17784)</span><br><span class="line">           â”‚                â”œâ”€&#123;dockerd&#125;(17785)</span><br><span class="line">           â”‚                â”œâ”€&#123;dockerd&#125;(17791)</span><br><span class="line">           â”‚                â”œâ”€&#123;dockerd&#125;(17793)</span><br><span class="line">           â”‚                â”œâ”€&#123;dockerd&#125;(17800)</span><br><span class="line">           â”‚                â”œâ”€&#123;dockerd&#125;(17803)</span><br><span class="line">           â”‚                â”œâ”€&#123;dockerd&#125;(3030)</span><br><span class="line">           â”‚                â””â”€&#123;dockerd&#125;(3031)</span><br><span class="line">           â”œâ”€fail2ban-server(755)â”€â”¬â”€&#123;fail2ban-server&#125;(1059)</span><br><span class="line">           â”‚                      â””â”€&#123;fail2ban-server&#125;(1060)</span><br><span class="line">           â”œâ”€iscsid(896)</span><br><span class="line">           â”œâ”€iscsid(897)</span><br><span class="line">           â”œâ”€lvmetad(392)</span><br><span class="line">           â”œâ”€networkd-dispat(622)â”€â”€â”€&#123;networkd-dispat&#125;(982)</span><br><span class="line">           â”œâ”€nginx(3305)â”€â”€â”€nginx(17700)</span><br><span class="line">           â”œâ”€php-fpm7.2(7497)â”€â”¬â”€php-fpm7.2(1295)</span><br><span class="line">           â”‚                  â”œâ”€php-fpm7.2(1296)</span><br><span class="line">           â”‚                  â””â”€php-fpm7.2(5611)</span><br><span class="line">           â”œâ”€polkitd(808)â”€â”¬â”€&#123;polkitd&#125;(820)</span><br><span class="line">           â”‚              â””â”€&#123;polkitd&#125;(822)</span><br><span class="line">           â”œâ”€rngd(981)</span><br><span class="line">           â”œâ”€rpcbind(7125)</span><br><span class="line">           â”œâ”€rsyslogd(11567)â”€â”¬â”€&#123;rsyslogd&#125;(11598)</span><br><span class="line">           â”‚                 â”œâ”€&#123;rsyslogd&#125;(11599)</span><br><span class="line">           â”‚                 â””â”€&#123;rsyslogd&#125;(11600)</span><br><span class="line">           â”œâ”€ss-server(17126)â”€â”€â”€obfs-server(17138)</span><br><span class="line">             â”œâ”€sshd(5357)â”€â”¬â”€sshd(15490)â”€â”€â”€sshd(15598)â”€â”€â”€zsh(15619)â”€â”€â”€pstree(20539)</span><br><span class="line">           â”‚            â”œâ”€sshd(20413)â”€â”€â”€sshd(20414)</span><br><span class="line">           â”‚            â””â”€sshd(20517)</span><br><span class="line">           â”œâ”€systemd(5715)â”€â”€â”€(sd-pam)(5718)</span><br><span class="line">           â”œâ”€systemd-journal(12866)</span><br><span class="line">           â”œâ”€systemd-logind(652)</span><br><span class="line">           â”œâ”€systemd-network(12827)</span><br><span class="line">           â”œâ”€systemd-resolve(12839)</span><br><span class="line">           â”œâ”€systemd-timesyn(12852)â”€â”€â”€&#123;systemd-timesyn&#125;(12861)</span><br><span class="line">           â””â”€systemd-udevd(8171)</span><br></pre></td></tr></table></figure>
<h5 id="4-è¿è¡Œçº§åˆ«"><a href="#4-è¿è¡Œçº§åˆ«" class="headerlink" title="4.è¿è¡Œçº§åˆ«"></a>4.è¿è¡Œçº§åˆ«</h5><p>æè¿°: å¦‚ä»Šsystemd å¼•å…¥äº†ä¸€ä¸ªå’Œå¯åŠ¨çº§åˆ«(ä¸€ä¸ªæ—§çš„æ¦‚å¿µ)åŠŸèƒ½ç›¸ä¼¼åˆä¸åŒçš„æ¦‚å¿µâ€”â€”ç›®æ ‡ï¼ˆtargetï¼‰ã€‚ä¸åƒæ•°å­—è¡¨ç¤ºçš„å¯åŠ¨çº§åˆ«ï¼Œæ¯ä¸€ä¸ªç›®æ ‡éƒ½æœ‰åå­—å’Œç‹¬ç‰¹çš„åŠŸèƒ½ï¼Œè€Œä¸”èƒ½åŒä¸€æ—¶å€™å¯ç”¨å¤šä¸ªï¼Œä¸€äº›ç›®æ ‡ç»§æ‰¿å…¶å®ƒç›®æ ‡çš„æœåŠ¡ï¼Œå¹¶å¯åŠ¨æ–°æœåŠ¡ã€‚</p>
<table>
<thead>
<tr>
<th>SysV å¯åŠ¨çº§åˆ«</th>
<th>Systemd ç›®æ ‡</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>runlevel0.target, poweroff.target</td>
<td>ä¸­æ–­ç³»ç»Ÿï¼ˆhaltï¼‰</td>
</tr>
<tr>
<td>1, s, single</td>
<td>runlevel1.target, rescue.target</td>
<td>å•ç”¨æˆ·æ¨¡å¼</td>
</tr>
<tr>
<td>2, 4</td>
<td>runlevel2.target, runlevel4.target, multi-user.target</td>
<td>ç”¨æˆ·è‡ªå·±å®šä¹‰å¯åŠ¨çº§åˆ«ã€‚é€šå¸¸è¯†åˆ«ä¸ºçº§åˆ«3ã€‚</td>
</tr>
<tr>
<td>3</td>
<td>runlevel3.target, multi-user.target</td>
<td>å¤šç”¨æˆ·ï¼Œæ— å›¾å½¢ç•Œé¢ã€‚ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡ç»ˆç«¯æˆ–ç½‘ç»œç™»å½•ã€‚</td>
</tr>
<tr>
<td>5</td>
<td>runlevel5.target, graphical.target</td>
<td>å¤šç”¨æˆ·ã€‚å›¾å½¢ç•Œé¢ã€‚ç»§æ‰¿çº§åˆ«3çš„æœåŠ¡ã€‚å¹¶å¯åŠ¨å›¾å½¢ç•Œé¢æœåŠ¡ã€‚</td>
</tr>
<tr>
<td>6</td>
<td>runlevel6.target, reboot.target</td>
<td>é‡æ–°å¯åŠ¨</td>
</tr>
<tr>
<td>emergency</td>
<td>emergency.target</td>
<td>æ€¥æ•‘æ¨¡å¼ï¼ˆEmergency shellï¼‰</td>
</tr>
</tbody>
</table>
<h4 id="0x02-Systemd-Manager"><a href="#0x02-Systemd-Manager" class="headerlink" title="0x02 Systemd Manager"></a>0x02 Systemd Manager</h4><p>æ§åˆ¶ systemd çš„ä¸»è¦å‘½ä»¤ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>systemctl å‘½ä»¤æ§åˆ¶ <code>systemd</code> çš„ç®¡ç†ç³»ç»Ÿå’ŒæœåŠ¡çš„å‘½ä»¤è¡Œå·¥å…·</li>
<li>systemsdm å‘½ä»¤æ§åˆ¶ <code>systemd</code> çš„ç®¡ç†å’ŒæœåŠ¡çš„å›¾å½¢åŒ–å·¥å…·</li>
<li>journalctl å‘½ä»¤æŸ¥è¯¢<code>systemd</code> æ—¥å¿—ç³»ç»Ÿ</li>
<li>loginctl å‘½ä»¤æ§åˆ¶ <code>systemd</code> ç™»å…¥ç®¡ç†å™¨</li>
<li>systemd-analyze åˆ†æç³»ç»Ÿå¯åŠ¨æ•ˆèƒ½ï¼ˆç±»ä¼¼å¼€æœºæ—¶é—´)</li>
</ul>
<p><br/></p>
<h5 id="1-Systemctl-å‘½ä»¤"><a href="#1-Systemctl-å‘½ä»¤" class="headerlink" title="1.Systemctl å‘½ä»¤"></a>1.Systemctl å‘½ä»¤</h5><p>æè¿°:systemctl help &lt;å•å…ƒ&gt; ## æ˜¾ç¤ºå•å…ƒçš„æ‰‹å†Šé¡µï¼ˆå¿…é¡»ç”±å•å…ƒæ–‡ä»¶æä¾›ï¼‰ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#unitç±»å‹æˆ–è€…å•å…ƒï¼š</span><br><span class="line">service ï¼šæ–‡ä»¶æ‰©å±•åä¸º.service, ç”¨äºå®šä¹‰ç³»ç»ŸæœåŠ¡</span><br><span class="line">target ï¼šæ–‡ä»¶æ‰©å±•åä¸º.targetï¼Œç”¨äºæ¨¡æ‹Ÿå®ç°è¿è¡Œçº§åˆ«</span><br><span class="line">device  ï¼šç”¨äºå®šä¹‰å†…æ ¸è¯†åˆ«çš„è®¾å¤‡ </span><br><span class="line">mountï¼šå®šä¹‰æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹   </span><br><span class="line">socketï¼šç”¨äºæ ‡è¯†è¿›ç¨‹é—´é€šä¿¡ç”¨çš„socketæ–‡ä»¶ï¼Œä¹Ÿå¯åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œå»¶è¿Ÿå¯åŠ¨æœåŠ¡ï¼Œå®ç°æŒ‰éœ€å¯åŠ¨   </span><br><span class="line">snapshot ï¼šç®¡ç†ç³»ç»Ÿå¿«ç…§  </span><br><span class="line">swapï¼šç”¨äºæ ‡è¯†swapè®¾å¤‡   </span><br><span class="line">automount ï¼šæ–‡ä»¶ç³»ç»Ÿçš„è‡ªåŠ¨æŒ‚è½½ç‚¹  </span><br><span class="line">pathï¼šç”¨äºå®šä¹‰æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•ä½¿ç”¨,å¸¸ç”¨äºå½“æ–‡ä»¶ç³»ç»Ÿå˜åŒ–æ—¶ï¼Œå»¶è¿Ÿæ¿€æ´»æœåŠ¡</span><br></pre></td></tr></table></figure></p>
<p>Systemctl æ–°ç‰¹æ€§: </p>
<ul>
<li>ç³»ç»Ÿå¼•å¯¼æ—¶å®ç°æœåŠ¡å¹¶è¡Œå¯åŠ¨</li>
<li>æŒ‰éœ€å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹</li>
<li>è‡ªåŠ¨åŒ–çš„æœåŠ¡ä¾èµ–å…³ç³»ç®¡ç†</li>
<li>åŒæ—¶é‡‡ç”¨socketå¼ä¸D-Busæ€»çº¿å¼æ¿€æ´»æœåŠ¡</li>
<li>ç³»ç»ŸçŠ¶æ€å¿«ç…§</li>
</ul>
<p><em>ä¼˜å…ˆçº§ä»ä½åˆ°é«˜å„è‡ªæ˜¯ï¼š</em></p>
<ul>
<li>/usr/lib/systemd/system/: è½¯ä»¶åŒ…å®‰è£…çš„å•å…ƒ  #(Centos) <code>Ubuntuï¼š/lib/systemd/system</code></li>
<li>/etc/systemd/system/: ç³»ç»Ÿç®¡ç†å‘˜å®‰è£…çš„å•å…ƒ   </li>
<li>/etc/init.d/ ï¼šè½¯ä»¶å®‰è£…æœåŠ¡å•å…ƒï¼ˆ#ä»»ç„¶æœ‰éƒ¨åˆ†è½¯ä»¶é‡‡ç”¨å’Œç”¨æˆ·è‡ªå®šä¹‰è„šæœ¬ï¼‰</li>
<li>å½“systemdæ‰§è¡Œåœ¨ç”¨æˆ·æ¨¡å¼ä¸‹æ—¶ï¼Œä½¿ç”¨çš„è½½å…¥è·¯å¾„æ˜¯å…¨ç„¶ä¸åŒçš„;systemd å•å…ƒåä»…èƒ½åŒ…æ‹¬ ASCII å­—ç¬¦, ä¸‹åˆ’çº¿å’Œç‚¹å·. å…¶å®ƒå­—ç¬¦é¡»è¦ç”¨ C-style â€œ\x2dâ€ æ›¿æ¢. åƒé˜… man systemd.unit å’Œ man systemd-escape.}}</li>
</ul>
<p><strong>å‚æ•°è¯­æ³•</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#0.å¯åŠ¨/é‡å¯/åœæ­¢/é‡è½½æœåŠ¡</span></span><br><span class="line">systemctl start NAME</span><br><span class="line">systemctl restart NAME</span><br><span class="line">systemctl stop NAME</span><br><span class="line">systemctl reload NAME</span><br><span class="line"></span><br><span class="line"><span class="comment">#1.æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span></span><br><span class="line">systemctl status NAME</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.é‡å¯å®ˆæŠ¤ç¨‹åº-ä¿®æ”¹è¿‡æœåŠ¡å•å…ƒé…ç½®æ–‡ä»¶å¿…é¡»æ‰§è¡Œå®ƒï¼ˆæ‰«ææ–°çš„æˆ–æœ‰å˜åŠ¨çš„å•å…ƒï¼‰</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.å¯ä»¥å®ç°å¯¹å…¶ä»–æœºå™¨çš„è¿œç¨‹æ§åˆ¶ï¼Œè¯¥åŠŸèƒ½ä½¿ç”¨ SSH è¿æ¥ã€‚</span></span><br><span class="line">systemctl å‚æ•°ä¸­æ·»åŠ  -H &lt;ç”¨æˆ·å&gt;@&lt;ä¸»æœºå&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.æ€æ­»æœåŠ¡</span></span><br><span class="line">systemctl <span class="built_in">kill</span> NAME</span><br><span class="line"></span><br><span class="line"><span class="comment">#5.Systemctlé…ç½®æŸ¥çœ‹</span></span><br><span class="line">systemctl show</span><br><span class="line"><span class="comment"># Version=219</span></span><br><span class="line"><span class="comment"># Features=+PAM +AUDIT +SELINUX +IMA -APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 -SECCOMP +BLKID +ELFUTILS +KMOD +IDN</span></span><br><span class="line"><span class="comment"># Virtualization=vmware</span></span><br><span class="line"><span class="comment"># Architecture=x86-64</span></span><br><span class="line"><span class="comment"># FirmwareTimestampMonotonic=0</span></span><br><span class="line"><span class="comment"># LogLevel=info</span></span><br><span class="line"><span class="comment"># LogTarget=journal-or-kmsg</span></span><br><span class="line"><span class="comment"># NNames=259</span></span><br><span class="line"><span class="comment"># NFailedUnits=1</span></span><br><span class="line"><span class="comment"># NJobs=0</span></span><br><span class="line"><span class="comment"># NInstalledJobs=64971823</span></span><br><span class="line"><span class="comment"># NFailedJobs=65792</span></span><br><span class="line"><span class="comment"># Progress=1</span></span><br><span class="line"><span class="comment"># Environment=LANG=zh_CN.UTF-8 PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin</span></span><br><span class="line"><span class="comment"># ConfirmSpawn=no</span></span><br><span class="line"><span class="comment"># ShowStatus=no</span></span><br><span class="line"><span class="comment"># UnitPath=/etc/systemd/system /run/systemd/system /run/systemd/generator /usr/local/lib/systemd/system /usr/lib/systemd/system /run/systemd/generator.late</span></span><br><span class="line"><span class="comment"># DefaultStandardOutput=journal</span></span><br><span class="line"><span class="comment"># DefaultStandardError=journal</span></span><br><span class="line"><span class="comment"># RuntimeWatchdogUSec=0</span></span><br><span class="line"><span class="comment"># ShutdownWatchdogUSec=10min</span></span><br><span class="line"><span class="comment"># SystemState=degraded</span></span><br><span class="line"><span class="comment"># DefaultTimerAccuracyUSec=1min</span></span><br><span class="line"><span class="comment"># DefaultTimeoutStartUSec=1min 30s</span></span><br><span class="line"><span class="comment"># DefaultTimeoutStopUSec=1min 30s</span></span><br><span class="line"><span class="comment"># DefaultRestartUSec=100ms</span></span><br><span class="line"><span class="comment"># DefaultStartLimitInterval=10000000</span></span><br><span class="line"><span class="comment"># DefaultStartLimitBurst=5</span></span><br><span class="line"><span class="comment"># DefaultCPUAccounting=yes</span></span><br><span class="line"><span class="comment"># DefaultBlockIOAccounting=no</span></span><br><span class="line"><span class="comment"># DefaultMemoryAccounting=yes</span></span><br><span class="line"><span class="comment"># DefaultTasksAccounting=yes</span></span><br><span class="line"><span class="comment"># DefaultLimitCPU=18446744073709551615</span></span><br><span class="line"><span class="comment"># DefaultLimitFSIZE=18446744073709551615</span></span><br><span class="line"><span class="comment"># DefaultLimitDATA=18446744073709551615</span></span><br><span class="line"><span class="comment"># DefaultLimitSTACK=18446744073709551615</span></span><br><span class="line"><span class="comment"># DefaultLimitCORE=18446744073709551615</span></span><br><span class="line"><span class="comment"># DefaultLimitRSS=18446744073709551615</span></span><br><span class="line"><span class="comment"># DefaultLimitNOFILE=4096</span></span><br><span class="line"><span class="comment"># DefaultLimitAS=18446744073709551615</span></span><br><span class="line"><span class="comment"># DefaultLimitNPROC=14991</span></span><br><span class="line"><span class="comment"># DefaultLimitMEMLOCK=65536</span></span><br><span class="line"><span class="comment"># DefaultLimitLOCKS=18446744073709551615</span></span><br><span class="line"><span class="comment"># DefaultLimitSIGPENDING=14991</span></span><br><span class="line"><span class="comment"># DefaultLimitMSGQUEUE=819200</span></span><br><span class="line"><span class="comment"># DefaultLimitNICE=0</span></span><br><span class="line"><span class="comment"># DefaultLimitRTPRIO=0</span></span><br><span class="line"><span class="comment"># DefaultLimitRTTIME=18446744073709551615</span></span><br><span class="line"><span class="comment"># DefaultTasksMax=18446744073709551615</span></span><br></pre></td></tr></table></figure></p>
<p><strong>åŸºæœ¬ç”¨æ³•</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç¤ºä¾‹0.è‡ªå¯ä¸å¯åŠ¨ç­‰å¸¸ç”¨å‘½ä»¤</span></span><br><span class="line">systemctl <span class="built_in">enable</span> nginx.service</span><br><span class="line">systemctl <span class="built_in">disable</span> xinetd.service  <span class="comment">#å…³é—­è‡ªå¯åŠ¨æœåŠ¡</span></span><br><span class="line"></span><br><span class="line">systemctl start nginx.service</span><br><span class="line">systemctl stop  xinetd.service     <span class="comment">#åœæ­¢æœåŠ¡</span></span><br><span class="line">systemctl restart xinetd.service   <span class="comment">#é‡å¯æœåŠ¡</span></span><br><span class="line"></span><br><span class="line">systemctl status firewalld          <span class="comment">#æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">systemctl status cobbler.service</span><br><span class="line"><span class="comment"># â— cobbler.service - SYSV: cobbler</span></span><br><span class="line"><span class="comment">#    Loaded: loaded (/etc/rc.d/init.d/cobbler; bad; vendor preset: disabled)</span></span><br><span class="line"><span class="comment">#    Active: inactive (dead)</span></span><br><span class="line"><span class="comment">#      Docs: man:systemd-sysv-generator(8)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¤ºä¾‹1.æ˜¾ç¤ºå½“å‰å·²åŠ è½½åˆ°å†…å­˜ä¸­çš„æ‰€æœ‰å•å…ƒ(Active)</span></span><br><span class="line">systemctl list-units --all</span><br><span class="line"><span class="comment">#UNIT                                                                LOAD      ACTIVE   SUB       DESCRIPTION</span></span><br><span class="line"><span class="comment">#proc-sys-fs-binfmt_misc.automount                                   loaded    active   running   Arbitrary Executable File Formats File System Automount Point</span></span><br><span class="line"><span class="comment">#dev-block-8:2.device                                                loaded    active   plugged   LVM PV dKOf4k-3rna-sW69-3GHn-79gA-cfLX-DbC5oJ on /dev/sda2 2</span></span><br><span class="line">systemctl list-units --<span class="built_in">type</span>=target  <span class="comment">#è·å–æŒ‡å®šå•å…ƒç›®æ ‡</span></span><br><span class="line">UNIT                  LOAD   ACTIVE SUB    DESCRIPTION</span><br><span class="line">basic.target          loaded active active Basic System</span><br><span class="line">cryptsetup.target     loaded active active Local Encrypted Volumes</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment">#ç¤ºä¾‹2.æŸ¥çœ‹å’Œç¼–è¾‘è¯¥è½¯ä»¶çš„ systemd å•å…ƒæ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line">systemctl cat docker</span><br><span class="line"><span class="comment"># /usr/lib/systemd/system/docker.service</span></span><br><span class="line"><span class="comment"># [Unit]</span></span><br><span class="line"><span class="comment"># Description=Docker Application Container Engine</span></span><br><span class="line"><span class="comment"># Documentation=https://docs.docker.com</span></span><br><span class="line"><span class="comment"># BindsTo=containerd.service</span></span><br><span class="line"><span class="comment"># After=network-online.target firewalld.service containerd.service</span></span><br><span class="line"><span class="comment"># Wants=network-online.target</span></span><br><span class="line"><span class="comment"># Requires=docker.socket</span></span><br><span class="line">systemctl edit docker.service  <span class="comment">#è®¾ç½®ç¼–è¾‘è¦†ç›–è§„åˆ™</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¤ºä¾‹3.æŸ¥çœ‹æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨,æœåŠ¡æ˜¯å¦æ¿€æ´»</span></span><br><span class="line"><span class="variable">$systemctl</span> is-enabled firewalld.service</span><br><span class="line"><span class="comment"># disabled</span></span><br><span class="line">systemctl is-enabled sshd.service</span><br><span class="line"><span class="comment"># enabled</span></span><br><span class="line">systemctl is-active sshd</span><br><span class="line"><span class="comment"># active</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¤ºä¾‹4.åˆ—å‡º systemd ç›®å½•ä¸‹é¢çš„æœåŠ¡å•å…ƒ</span></span><br><span class="line">systemctl list-unit-files</span><br><span class="line">systemctl list-unit-files | grep mysqld  <span class="comment">#æŸ¥çœ‹mysqldæœåŠ¡æ˜¯ä¸æ˜¯å¯åŠ¨</span></span><br><span class="line">systemctl list-unit-files | grep enabled  <span class="comment">#æŸ¥çœ‹å·²å¯åŠ¨çš„æœåŠ¡åˆ—è¡¨</span></span><br><span class="line"><span class="comment"># auditd.service                                enabled</span></span><br><span class="line"><span class="comment"># autovt@.service                               enabled</span></span><br><span class="line"><span class="comment"># chronyd.service                               enabled</span></span><br><span class="line"><span class="comment"># crond.service                                 enabled</span></span><br><span class="line">systemctl list-unit-files --failed <span class="comment">#æŸ¥çœ‹å¯åŠ¨å¤±è´¥çš„æœåŠ¡åˆ—è¡¨</span></span><br><span class="line"><span class="comment"># UNIT FILE STATE</span></span><br><span class="line"><span class="comment"># 0 unit files listed.</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç³»ç»Ÿå¼€æœºå¯åŠ¨é¡¹</span></span><br><span class="line">systemctl list-unit-files --<span class="built_in">type</span>=service | grep enabled</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¤ºä¾‹5.æ¬²æŸ¥çœ‹å¯¹ç‰¹å®š target å¯ç”¨çš„æœåŠ¡è¯·æ‰§è¡Œ </span></span><br><span class="line">systemctl list-dependencies</span><br><span class="line">systemctl list-dependencies [target]</span><br><span class="line">systemctl list-dependencies microcode.service</span><br><span class="line"><span class="comment"># microcode.service</span></span><br><span class="line"><span class="comment"># â— â”œâ”€system.slice</span></span><br><span class="line"><span class="comment"># â— â””â”€basic.target</span></span><br><span class="line"><span class="comment">#   â”‚ â””â”€...</span></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼šè¯¥è¾“å‡ºç»“æœåªæ˜¾ç¤º SysV æœåŠ¡ï¼Œå¹¶ä¸åŒ…å«åŸç”Ÿ systemd æœåŠ¡ï¼ŒSysV é…ç½®æ•°æ®å¯èƒ½è¢«åŸç”Ÿ systemd é…ç½®è¦†ç›–ã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¤ºä¾‹6.åˆ‡æ¢å¹¶æŸ¥çœ‹å¯åŠ¨çº§åˆ«/ç›®æ ‡</span></span><br><span class="line"><span class="variable">$systemctl</span> <span class="built_in">set</span>-default multi-user.target</span><br><span class="line">rm <span class="string">'/etc/systemd/system/default.target'</span></span><br><span class="line">ln -s <span class="string">'/usr/lib/systemd/system/multi-user.target'</span> <span class="string">'/etc/systemd/system/default.target'</span></span><br><span class="line"><span class="comment">#èƒ½å¤Ÿåœ¨ systemctl çš„è¾“å‡ºä¸­çœ‹åˆ°å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœï¼šé“¾æ¥ /etc/systemd/system/default.target è¢«åˆ›å»ºã€‚æŒ‡å‘æ–°çš„é»˜è®¤å¯åŠ¨çº§åˆ«ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$systemctl</span> isolate graphical.target  <span class="comment">#ç­‰ä»·äºtelinit 3 æˆ– telinit 5ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$systemctl</span> get-default</span><br><span class="line">graphical.target <span class="comment">#å½“å‰ä¸º graphical.target ä¿®æ”¹ä¸ºå‘½ä»¤æ¨¡å¼multi-user.targetï¼š</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¤ºä¾‹7.æŸ¥çœ‹unitä¸­çš„ç±»å‹</span></span><br><span class="line">systemctl -t service</span><br><span class="line"><span class="comment"># UNIT                               LOAD   ACTIVE SUB     DESCRIPTION</span></span><br><span class="line"><span class="comment"># auditd.service                     loaded active running Security Auditing Service</span></span><br><span class="line">systemctl --<span class="built_in">type</span> target</span><br><span class="line"><span class="comment"># UNIT                  LOAD   ACTIVE SUB    DESCRIPTION</span></span><br><span class="line"><span class="comment"># basic.target          loaded active active Basic System</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¤ºä¾‹8.ç¦ç”¨å’Œå–æ¶ˆç¦ç”¨å•å…ƒ</span></span><br><span class="line"><span class="comment"># ç¦ç”¨ä¸€ä¸ªå•å…ƒ(ç¦ç”¨åï¼Œé—´æ¥å¯åŠ¨ä¹Ÿæ˜¯ä¸å¯èƒ½çš„)ï¼š</span></span><br><span class="line">systemctl mask &lt;å•å…ƒ&gt;</span><br><span class="line"><span class="comment"># å–æ¶ˆç¦ç”¨ä¸€ä¸ªå•å…ƒï¼š</span></span><br><span class="line">systemctl unmask &lt;å•å…ƒ&gt;</span><br><span class="line">systemctl unmask containerd</span><br><span class="line">  <span class="comment"># Removed /etc/systemd/system/containerd.service.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¤ºä¾‹9.ç”µæºç®¡ç†</span></span><br><span class="line"><span class="comment">#å®‰è£… polkit åæ‰å¹²å¤Ÿä¸€èˆ¬ç”¨æˆ·èº«ä»½ä½¿ç”¨ç”µæºç®¡ç†ã€‚</span></span><br><span class="line"><span class="comment">#å‡è®¾ä½ æ­£ç™»å½•åœ¨ä¸€ä¸ªæœ¬åœ°çš„systemd-logindç”¨æˆ·ä¼šè¯ã€‚ä¸”å½“å‰æ²¡æœ‰å…¶å®ƒæ´»åŠ¨çš„ä¼šè¯ã€‚é‚£ä¹ˆä¸‹é¢å‘½ä»¤æ— éœ€rootæƒé™å°±å¯ä»¥æ‰§è¡Œã€‚å¦åˆ™ï¼ˆæ¯”å¦‚å½“å‰æœ‰è¿˜æœ‰ä¸€ä¸ªç”¨æˆ·ç™»å½•åœ¨æŸä¸ªttyï¼‰ï¼Œsystemd å°†ä¼šè‡ªå·±ä¸»åŠ¨è¯·æ±‚è¾“å…¥rootpasswordã€‚</span></span><br><span class="line">$ systemctl reboot  <span class="comment">#é‡æ–°å¯åŠ¨</span></span><br><span class="line">$ systemctl poweroff  <span class="comment">#é€€å‡ºç³»ç»Ÿå¹¶åœæ­¢ç”µæº</span></span><br><span class="line">$ systemctl <span class="built_in">suspend</span>  <span class="comment">#å¾…æœº</span></span><br><span class="line">$ systemctl hibernate  <span class="comment">#ä¼‘çœ </span></span><br><span class="line">$ systemctl hybrid-sleep <span class="comment">#æ··åˆä¼‘çœ æ¨¡å¼ï¼ˆåŒä¸€æ—¶å€™ä¼‘çœ åˆ°ç¡¬ç›˜å¹¶å¾…æœºï¼‰ï¼š</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¤ºä¾‹10.è¿œç¨‹æ§åˆ¶å…¶ä»–æœåŠ¡å™¨çš„ systemd</span></span><br><span class="line">systemctl status nginx -H root@weiyigeek.top</span><br></pre></td></tr></table></figure>
<p><br></p>
<h5 id="2-Journal-å‘½ä»¤"><a href="#2-Journal-å‘½ä»¤" class="headerlink" title="2.Journal å‘½ä»¤"></a>2.Journal å‘½ä»¤</h5><p>æè¿°ï¼šä½œä¸ºæœ€å…·å¸å¼•åŠ›çš„ä¼˜åŠ¿ï¼Œsystemdæ‹¥æœ‰å¼ºå¤§çš„å¤„ç†ä¸ç³»ç»Ÿæ—¥å¿—è®°å½•åŠŸèƒ½ã€‚åœ¨ä½¿ç”¨å…¶å®ƒå·¥å…·æ—¶ï¼Œæ—¥å¿—å¾€å¾€è¢«åˆ†æ•£åœ¨æ•´å¥—ç³»ç»Ÿå½“ä¸­ï¼Œç”±ä¸åŒçš„å®ˆæŠ¤è¿›ç¨‹åŠè¿›ç¨‹è´Ÿè´£å¤„ç†ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¾ˆéš¾è·¨è¶Šå¤šç§åº”ç”¨ç¨‹åºå¯¹å…¶å†…å®¹è¿›è¡Œè§£è¯»ã€‚</p>
<p>systemd çš„ç¬¬äºŒä¸ªä¸»è¦éƒ¨åˆ†æ˜¯ journal æ—¥å¿—ç³»ç»Ÿï¼Œç±»ä¼¼äº syslog ä½†ä¹Ÿæœ‰äº›æ˜¾è‘—åŒºåˆ«ã€‚</p>
<p>Tips : å¦‚æœä½ å–œæ¬¢ç”¨ <code>sed ã€grep ã€awk</code> ä¸‰å‰‘å®¢æ¥å¤„ç†æ—¥å¿—ï¼Œé‚£ä¹ˆå½“ä½ é¢å¯¹ journal æ—¥å¿—ç³»ç»Ÿçš„æ—¶å€™ä½ å°±å‡†å¤‡æ€æ¡Œå„¿å§ï¼å› ä¸ºè¿™æ˜¯ä¸ªäºŒè¿›åˆ¶æ—¥å¿—ï¼Œæ— æ³•ä½¿ç”¨å¸¸è§„çš„å‘½ä»¤è¡Œæ–‡æœ¬å¤„ç†å·¥å…·æ¥è§£æå®ƒ</p>
<p><strong>Systemd Journal çš„ä¼˜ç‚¹å¦‚ä¸‹ï¼š</strong></p>
<ul>
<li>ç®€å•æ€§ï¼šä»£ç å°‘ï¼Œä¾èµ–å°‘ï¼ŒæŠ½è±¡å¼€é”€æœ€å°ã€‚</li>
<li>é›¶ç»´æŠ¤ï¼šæ—¥å¿—æ˜¯é™¤é”™å’Œç›‘æ§ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå› æ­¤å®ƒè‡ªå·±ä¸èƒ½å†äº§ç”Ÿé—®é¢˜ã€‚ä¸¾ä¾‹è¯´ï¼Œè‡ªåŠ¨ç®¡ç†ç£ç›˜ç©ºé—´ï¼Œé¿å…ç”±äºæ—¥å¿—çš„ä¸æ–­äº§ç”Ÿè€Œå°†ç£ç›˜ç©ºé—´è€—å°½ã€‚</li>
<li>ç§»æ¤æ€§ï¼šæ—¥å¿— æ–‡ä»¶åº”è¯¥åœ¨æ‰€æœ‰ç±»å‹çš„ Linux ç³»ç»Ÿä¸Šå¯ç”¨ï¼Œæ— è®ºå®ƒä½¿ç”¨çš„ä½•ç§ CPU æˆ–è€…å­—èŠ‚åºã€‚</li>
<li>æ€§èƒ½ï¼šæ·»åŠ å’Œæµè§ˆ æ—¥å¿— éå¸¸å¿«ã€‚</li>
<li>æœ€å°èµ„æºå ç”¨ï¼šæ—¥å¿— æ•°æ®æ–‡ä»¶éœ€è¦è¾ƒå°ã€‚</li>
<li>ç»Ÿä¸€åŒ–ï¼šå„ç§ä¸åŒçš„æ—¥å¿—å­˜å‚¨æŠ€æœ¯åº”è¯¥ç»Ÿä¸€èµ·æ¥ï¼Œå°†æ‰€æœ‰çš„å¯è®°å½•äº‹ä»¶ä¿å­˜åœ¨åŒä¸€ä¸ªæ•°æ®å­˜å‚¨ä¸­ã€‚æ‰€ä»¥æ—¥å¿—å†…å®¹çš„å…¨å±€ä¸Šä¸‹æ–‡éƒ½ä¼šè¢«ä¿å­˜å¹¶ä¸”å¯ä¾›æ—¥åæŸ¥è¯¢ã€‚ä¾‹å¦‚ä¸€æ¡å›ºä»¶è®°å½•åé€šå¸¸ä¼šè·Ÿéšä¸€æ¡å†…æ ¸è®°å½•ï¼Œæœ€ç»ˆè¿˜ä¼šæœ‰ä¸€æ¡ç”¨æˆ·æ€è®°å½•ã€‚é‡è¦çš„æ˜¯å½“ä¿å­˜åˆ°ç¡¬ç›˜ä¸Šæ—¶è¿™ä¸‰è€…ä¹‹é—´çš„å…³ç³»ä¸ä¼šä¸¢å¤±ã€‚Syslog å°†ä¸åŒçš„ä¿¡æ¯ä¿å­˜åˆ°ä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œåˆ†æçš„æ—¶å€™å¾ˆéš¾ç¡®å®šå“ªäº›æ¡ç›®æ˜¯ç›¸å…³çš„ã€‚</li>
<li>æ‰©å±•æ€§ï¼šæ—¥å¿—çš„é€‚ç”¨èŒƒå›´å¾ˆå¹¿ï¼Œä»åµŒå…¥å¼è®¾å¤‡åˆ°è¶…çº§è®¡ç®—æœºé›†ç¾¤éƒ½å¯ä»¥æ»¡è¶³éœ€æ±‚ã€‚</li>
<li>å®‰å…¨æ€§ï¼šæ—¥å¿— æ–‡ä»¶æ˜¯å¯ä»¥éªŒè¯çš„ï¼Œè®©æ— æ³•æ£€æµ‹çš„ä¿®æ”¹ä¸å†å¯èƒ½ã€‚</li>
</ul>
<p><strong>æ—¥å¿—çš„ä¼˜å…ˆçº§å’Œåˆ†ç±»</strong></p>
<p>ç³»ç»Ÿæ—¥è®°æŒ‰(ä¼˜å…ˆçº§Priority level)å’Œ(è®¾æ–½Facility)å¯¹ä¿¡æ¯è¿›è¡Œåˆ†ç±»ã€‚æ—¥å¿—åˆ†ç±»å¯¹åº”äºç»å…¸çš„Syslogåè®®ï¼ˆRFC 5424ï¼‰ã€‚<br><em>æ³¨ï¼šä¸‹é¢è¡¨æ ¼æœ€åä¸€åˆ— (wc -l) æ˜¯ç»Ÿè®¡çš„è®°å½•æ•°æ¯”ä¾‹ï¼Œæ€»æ•°æ˜¯3ä¸ªæœˆçš„æ—¥å¿—ï¼Œå¤§çº¦100ä¸‡æ¡æ•°æ®ã€‚</em></p>
<p>ï¼ˆ1ï¼‰ä¼˜å…ˆçº§ï¼š<br><figure class="image-box">
                <a rel=systemdæœåŠ¡ç®¡ç†è¯¦è§£ä¸å­å‘½ä»¤ä¸€è§ˆ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200420212341.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200420212341.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure></p>
<p>ï¼ˆ2ï¼‰è®¾æ–½åˆ†ç±»ï¼š</p>
<figure class="image-box">
                <a rel=systemdæœåŠ¡ç®¡ç†è¯¦è§£ä¸å­å‘½ä»¤ä¸€è§ˆ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200420212505.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200420212505.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure>
<p><strong>journalctl å‘½ä»¤å¸®åŠ©</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">journalctl -h 	  	 </span><br><span class="line"><span class="comment">#Options: 	  	 </span></span><br><span class="line">--system 	Show the system journal 	æ˜¾ç¤ºç³»ç»Ÿæ—¥å¿—</span><br><span class="line">--user 	Show the user journal <span class="keyword">for</span> the current user 	æ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„ç”¨æˆ·æ—¥å¿—</span><br><span class="line"></span><br><span class="line">-M 	--machine=CONTAINER 	Operate on <span class="built_in">local</span> container 	åœ¨æœ¬åœ°å®¹å™¨ä¸Šæ“ä½œ</span><br><span class="line">-S 	--since=DATE 	Show entries not older than the specified date 	æ˜¾ç¤ºä¸æ—©äºæŒ‡å®šæ—¥æœŸçš„æ¡ç›®</span><br><span class="line">-U 	--until=DATE 	Show entries not newer than the specified date 	æ˜¾ç¤ºä¸æ™šäºæŒ‡å®šæ—¥æœŸçš„æ¡ç›®</span><br><span class="line">-c 	--cursor=CURSOR 	Show entries starting at the specified cursor 	æ˜¾ç¤ºä»æŒ‡å®šå…‰æ ‡å¼€å§‹çš„æ¡ç›®</span><br><span class="line">  	--after-cursor=CURSOR 	Show entries after the specified cursor 	åœ¨æŒ‡å®šçš„å…‰æ ‡åæ˜¾ç¤ºæ¡ç›®</span><br><span class="line">  	--show-cursor 	Print the cursor after all the entries 	åœ¨æ‰€æœ‰æ¡ç›®ä¹‹åæ‰“å°å…‰æ ‡</span><br><span class="line">  	--cursor-file=FILE 	Show entries after cursor <span class="keyword">in</span> FILE and update FILE 	åœ¨FILEä¸­æ˜¾ç¤ºå…‰æ ‡åçš„æ¡ç›®å¹¶æ›´æ–°FILE</span><br><span class="line">-b 	--boot[=ID] 	Show current boot or the specified boot 	æ˜¾ç¤ºå½“å‰å¼•å¯¼æˆ–æŒ‡å®šçš„å¼•å¯¼</span><br><span class="line">  	--list-boots 	Show terse information about recorded boots 	æ˜¾ç¤ºæœ‰å…³å½•åˆ¶çš„é´å­çš„ç®€æ´ä¿¡æ¯</span><br><span class="line">-k 	--dmesg 	Show kernel message <span class="built_in">log</span> from the current boot 	æ˜¾ç¤ºå½“å‰å¼•å¯¼çš„å†…æ ¸æ¶ˆæ¯æ—¥å¿—</span><br><span class="line">-u 	--unit=UNIT 	Show logs from the specified unit 	æ˜¾ç¤ºæŒ‡å®šå•ä½çš„æ—¥å¿—</span><br><span class="line">  	--user-unit=UNIT 	Show logs from the specified user unit 	æ˜¾ç¤ºæŒ‡å®šç”¨æˆ·å•å…ƒçš„æ—¥å¿—</span><br><span class="line">-t 	--identifier=STRING 	Show entries with the specified syslog identifier 	æ˜¾ç¤ºå…·æœ‰æŒ‡å®šsyslogæ ‡è¯†ç¬¦çš„æ¡ç›®</span><br><span class="line">-p 	--priority=RANGE 	Show entries with the specified priority 	æ˜¾ç¤ºå…·æœ‰æŒ‡å®šä¼˜å…ˆçº§çš„æ¡ç›®</span><br><span class="line">-g 	--grep=PATTERN 	Show entries with MESSAGE matching PATTERN 	æ˜¾ç¤ºMESSAGEåŒ¹é…PATTERNçš„æ¡ç›®</span><br><span class="line">  	--<span class="keyword">case</span>-sensitive[=BOOL] 	Force <span class="keyword">case</span> sensitive or insenstive matching 	å¼ºåˆ¶åŒºåˆ†å¤§å°å†™æˆ–ä¸åŒºåˆ†åŒ¹é…</span><br><span class="line">-e 	--pager-end 	Immediately jump to the end <span class="keyword">in</span> the pager 	ç«‹å³è·³åˆ°å¯»å‘¼æœºçš„æœ«å°¾</span><br><span class="line">-f 	--follow 	Follow the journal 	å…³æ³¨æœŸåˆŠ, æœ€æ–°çš„</span><br><span class="line">-n 	--lines[=INTEGER] 	Number of journal entries to show 	è¦æ˜¾ç¤ºçš„æ—¥è®°å¸åˆ†å½•æ•°</span><br><span class="line">  	--no-tail 	Show all lines, even <span class="keyword">in</span> follow mode 	å³ä½¿åœ¨è·Ÿéšæ¨¡å¼ä¸‹ä¹Ÿæ˜¾ç¤ºæ‰€æœ‰è¡Œ</span><br><span class="line">-r 	--reverse 	Show the newest entries first 	é¦–å…ˆæ˜¾ç¤ºæœ€æ–°çš„æ¡ç›®</span><br><span class="line">-o 	--output=STRING 	Change journal output mode (short, short-precise, short-iso, short-iso-precise, short-full, short-monotonic, short-unix, (preciseç²¾ç¡®,monotonicå•è°ƒ) 	æ›´æ”¹æ—¥å¿—è¾“å‡ºæ¨¡å¼: verbose, <span class="built_in">export</span>, </span><br><span class="line">json, json-pretty, json-sse, json-seq, </span><br><span class="line">cat, with-unit)</span><br><span class="line">  	--output-fields=LIST 	Select fields to <span class="built_in">print</span> <span class="keyword">in</span> verbose/<span class="built_in">export</span>/json modes 	é€‰æ‹©è¦ä»¥è¯¦ç»†/å¯¼å‡º/ jsonæ¨¡å¼æ‰“å°çš„å­—æ®µ</span><br><span class="line">  	--utc 	Express time <span class="keyword">in</span> Coordinated Universal Time (UTC) 	åè°ƒä¸–ç•Œæ—¶ï¼ˆUTCï¼‰çš„å¿«è½¦æ—¶é—´</span><br><span class="line">-x 	--catalog 	Add message explanations <span class="built_in">where</span> available 	æ·»åŠ æ¶ˆæ¯è¯´æ˜ï¼ˆå¦‚æœæœ‰ï¼‰</span><br><span class="line">  	--no-full 	Ellipsize fields 	Ellipsizeå­—æ®µ</span><br><span class="line">-a 	--all 	Show all fields, including long and unprintable 	æ˜¾ç¤ºæ‰€æœ‰å­—æ®µ,åŒ…æ‹¬é•¿å­—æ®µå’Œä¸å¯æ‰“å°å­—æ®µ</span><br><span class="line">-q 	--quiet 	Do not show info messages and privilege warning 	ä¸æ˜¾ç¤ºä¿¡æ¯æ¶ˆæ¯å’Œæƒé™è­¦å‘Š</span><br><span class="line">  	--no-pager 	Do not pipe output into a pager 	ä¸è¦å°†è¾“å‡ºä¼ è¾“åˆ°å¯»å‘¼æœº</span><br><span class="line">  	--no-hostname 	Suppress output of hostname field 	ç¦æ­¢è¾“å‡ºä¸»æœºåå­—æ®µ</span><br><span class="line">-m 	--merge 	Show entries from all available journals 	æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨æœŸåˆŠçš„æ¡ç›®</span><br><span class="line">-D 	--directory=PATH 	Show journal files from directory 	æ˜¾ç¤ºç›®å½•ä¸­çš„æ—¥å¿—æ–‡ä»¶</span><br><span class="line">  	--file=PATH 	Show journal file 	æ˜¾ç¤ºæ—¥å¿—æ–‡ä»¶</span><br><span class="line">  	--root=ROOT 	Operate on files below a root directory 	å¯¹æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶è¿›è¡Œæ“ä½œ</span><br><span class="line">  	--interval=TIME 	Time interval <span class="keyword">for</span> changing the FSS sealing key 	æ›´æ”¹FSSå¯†å°é”®çš„æ—¶é—´é—´éš”</span><br><span class="line">  	--verify-key=KEY 	Specify FSS verification key 	æŒ‡å®šFSSéªŒè¯å¯†é’¥</span><br><span class="line">  	--force 	Override of the FSS key pair with --setup-keys 	ä½¿ç”¨--setup-keysè¦†ç›–FSSå¯†é’¥å¯¹</span><br><span class="line">  	  	  	 </span><br><span class="line">  	Commands: 	  	 </span><br><span class="line">-h 	--<span class="built_in">help</span> 	Show this <span class="built_in">help</span> text 	æ˜¾ç¤ºæ­¤å¸®åŠ©æ–‡æœ¬</span><br><span class="line">  	--version 	Show package version 	æ˜¾ç¤ºåŒ…ç‰ˆæœ¬</span><br><span class="line">-N 	--fields 	List all field names currently used 	åˆ—å‡ºå½“å‰ä½¿ç”¨çš„æ‰€æœ‰å­—æ®µåç§°</span><br><span class="line">-F 	--field=FIELD 	List all values that a specified field takes 	åˆ—å‡ºæŒ‡å®šå­—æ®µæ‰€éœ€çš„æ‰€æœ‰å€¼</span><br><span class="line">  	--disk-usage 	Show total disk usage of all journal files 	æ˜¾ç¤ºæ‰€æœ‰æ—¥å¿—æ–‡ä»¶çš„æ€»ç£ç›˜ä½¿ç”¨æƒ…å†µ</span><br><span class="line">  	--vacuum-size=BYTES 	Reduce disk usage below specified size 	å°†ç£ç›˜ä½¿ç”¨é‡é™ä½åˆ°æŒ‡å®šå¤§å°ä»¥ä¸‹</span><br><span class="line">  	--vacuum-files=INT 	Leave only the specified number of journal files 	åªä¿ç•™æŒ‡å®šæ•°é‡çš„æ—¥å¿—æ–‡ä»¶</span><br><span class="line">  	--vacuum-time=TIME 	Remove journal files older than specified time 	åˆ é™¤æ—©äºæŒ‡å®šæ—¶é—´çš„æ—¥å¿—æ–‡ä»¶</span><br><span class="line">  	--verify 	Verify journal file consistency 	éªŒè¯æ—¥å¿—æ–‡ä»¶ä¸€è‡´æ€§</span><br><span class="line">  	--sync 	Synchronize unwritten journal messages to disk 	å°†æœªå†™å…¥çš„æ—¥å¿—æ¶ˆæ¯åŒæ­¥åˆ°ç£ç›˜</span><br><span class="line">  	--flush 	Flush all journal data from /run into /var 	å°†/ runä¸­çš„æ‰€æœ‰æ—¥å¿—æ•°æ®åˆ·æ–°åˆ°/var</span><br><span class="line">  	--rotate 	Request immediate rotation of the journal files 	è¯·æ±‚ç«‹å³è½®æ¢æ—¥å¿—æ–‡ä»¶</span><br><span class="line">  	--header 	Show journal header information 	æ˜¾ç¤ºæ—¥è®°æ ‡é¢˜ä¿¡æ¯</span><br><span class="line">  	--list-catalog 	Show all message IDs <span class="keyword">in</span> the catalog 	æ˜¾ç¤ºç›®å½•ä¸­çš„æ‰€æœ‰æ¶ˆæ¯ID</span><br><span class="line">  	--dump-catalog 	Show entries <span class="keyword">in</span> the message catalog 	åœ¨æ¶ˆæ¯ç›®å½•ä¸­æ˜¾ç¤ºæ¡ç›®</span><br><span class="line">  	--update-catalog 	Update the message catalog database 	æ›´æ–°æ¶ˆæ¯ç›®å½•æ•°æ®åº“</span><br><span class="line">  	--setup-keys 	Generate a new FSS key pair 	ç”Ÿæˆæ–°çš„FSSå¯†é’¥å¯¹</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><strong>å®é™…æ¡ˆä¾‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å®ä¾‹1.æ˜¾ç¤ºç³»ç»Ÿ bootloader å¯åŠ¨ä¿¡æ¯</span></span><br><span class="line">$ sudo journalctl -b           <span class="comment">#å¯åŠ¨ä¿¡æ¯23565</span></span><br><span class="line">$ sudo journalctl -b -0     </span><br><span class="line">$ sudo journalctl -b -1        <span class="comment">#å‰ä¸€æ¬¡å¯åŠ¨ä¿¡æ¯... é€šè¿‡æŸ¥è¯¢å¼•å¯¼åˆ—è¡¨å¯çœ‹åˆ°æœ€å¤šèƒ½æŸ¥çœ‹å‰å‡ æ¬¡å¯åŠ¨ä¿¡æ¯</span></span><br><span class="line">$ sudo journalctl --list-boots <span class="comment">#å¼•å¯¼åˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å®ä¾‹2.æ˜¾ç¤ºä¸æ—©äºæŒ‡å®šæ—¥æœŸçš„æ¡ç›®ä½•ç‰¹å®šåŒºé—´çš„æ•°æ®(åˆ©ç”¨--sinceä¸--untilé€‰é¡¹è®¾å®šæ—¶é—´æ®µ)ã€‚</span></span><br><span class="line">$ sudo journalctl --since=<span class="string">"2019-06-13 16:42:34"</span></span><br><span class="line">$ sudo journalctl --since <span class="string">"20 min ago"</span>  <span class="comment">#Show all messages since 20 minutes ago: æœ€è¿‘20åˆ†é’Ÿ</span></span><br><span class="line">$ sudo journalctl -S <span class="string">"20 min ago"</span></span><br><span class="line">$ journalctl --since <span class="string">"2015-01-10"</span> --until <span class="string">"2015-01-11 03:00"</span></span><br><span class="line">$ journalctl --since 09:00 --until <span class="string">"1 hour ago"</span> <span class="comment"># è·å¾—æ—©9ï¼š00åˆ°ä¸€å°æ—¶å‰è¿™æ®µæ—¶é—´å†…çš„æŠ¥å‘Š</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å®ä¾‹3.æŒç»­æ˜¾ç¤ºæœ€æ–°æ–°æ¶ˆæ¯é»˜è®¤10æ¡</span></span><br><span class="line">$ sudo journalctl -f</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®ä¾‹4.æ˜¾ç¤ºç‰¹å®šå¯æ‰§è¡Œæ–‡ä»¶çš„ä¿¡æ¯(æŒ‰ç»„ä»¶è·¯å¾„)</span></span><br><span class="line">$ sudo journalctl /usr/lib/systemd/systemd</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®ä¾‹5.æ˜¾ç¤ºç‰¹å®šè¿›ç¨‹PIDçš„æ—¥å¿—ä¿¡æ¯ï¼Œä»¥åŠç”¨æˆ·æˆ–è€…ç¾¤ç»„ID</span></span><br><span class="line">$ sudo journalctl _PID=1</span><br><span class="line">$ sudo journalctl _UID=33 --since today</span><br><span class="line">$ sudo journalctl -F _GID  <span class="comment"># æŸ¥çœ‹systemd journalæ‹¥æœ‰æ¡ç›®çš„ç¾¤ç»„ID</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å®ä¾‹6.æ˜¾ç¤ºç‰¹å®šå•å…ƒæ—¥å¿—ä¿¡æ¯</span></span><br><span class="line">$ sudo journalctl -u man-db.service</span><br><span class="line">journalctl -u nginx.service -u php-fpm.service --since today</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®ä¾‹7.æ˜¾ç¤ºå½“å‰å¼•å¯¼çš„å†…æ ¸æ¶ˆæ¯æ—¥å¿—(--dmesg)</span></span><br><span class="line">$ sudo journalctl -k</span><br><span class="line">$ sudo journalctl -k -b -5  <span class="comment"># æŸ¥è¯¢äº”æ¬¡ä¹‹å‰å¼•å¯¼ç¯å¢ƒçš„ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å®ä¾‹8.-p æ˜¾ç¤ºå…·æœ‰æŒ‡å®šä¼˜å…ˆçº§çš„æ¡ç›®(0-7)</span></span><br><span class="line"><span class="comment"># 0: emerg</span></span><br><span class="line"><span class="comment"># 1: alert</span></span><br><span class="line"><span class="comment"># 2: crit</span></span><br><span class="line"><span class="comment"># 3: err</span></span><br><span class="line"><span class="comment"># 4: warning</span></span><br><span class="line"><span class="comment"># 5: notice</span></span><br><span class="line"><span class="comment"># 6: info</span></span><br><span class="line"><span class="comment"># 7: debug</span></span><br><span class="line"><span class="comment"># ä»¥ä¸Šä¸ºå¯åœ¨-pé€‰é¡¹ä¸­ä½¿ç”¨çš„æ•°å­—æˆ–è€…åç§°ã€‚</span></span><br><span class="line">$ sudo journalctl -p err..alert</span><br><span class="line">$ sudo journalctl -p 3..1   //3-1</span><br><span class="line">$ sudo journalctl -p 3       //3-0</span><br><span class="line">$ sudo journalctl -p 3 -r    //3-0; åŠ -ré€‰é¡¹,é¦–å…ˆæ˜¾ç¤ºæœ€æ–°çš„æ¡ç›®</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®ä¾‹9.é€šè¿‡åœ¨syslogå·¥å…·ä¸Šè¿›è¡Œè¿‡æ»¤æ¥æ˜¾ç¤ºç­‰æ•ˆçš„auth.log(å†…æ ¸ç›¸å…³ä¿¡æ¯)</span></span><br><span class="line">$ sudo journalctl SYSLOG_FACILITY=10</span><br><span class="line"><span class="comment"># 0 kern å†…æ ¸ï¼›</span></span><br><span class="line"><span class="comment"># 1 user ç”¨æˆ·ï¼›</span></span><br><span class="line"><span class="comment"># 3 daemon å®ˆæŠ¤è¿›ç¨‹ï¼›</span></span><br><span class="line"><span class="comment"># 4 auth æˆæƒï¼›</span></span><br><span class="line"><span class="comment"># 10 authpriv æˆæƒï¼›</span></span><br><span class="line">$ sudo journalctl SYSLOG_FACILITY=0 -r</span><br><span class="line">$ sudo journalctl -k -r</span><br><span class="line">$ sudo journalctl SYSLOG_FACILITY=4 |wc -l</span><br><span class="line"><span class="comment">#14516</span></span><br><span class="line">$ sudo journalctl SYSLOG_FACILITY=10 |wc -l</span><br><span class="line"><span class="comment">#9049</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å®ä¾‹10.å¦‚æœæ—¥å¿—ç›®å½•(é»˜è®¤ä½äº/var/log/journalä¸‹)åŒ…å«å¤§é‡æ—¥å¿—æ•°æ®ï¼Œé‚£ä¹ˆjournalctlå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ¥è¿‡æ»¤è¾“å‡ºã€‚</span></span><br><span class="line"><span class="comment">#å®ƒå¯ä»¥é€šè¿‡ä½¿ç”¨â€”â€”fileé€‰é¡¹æ¥å¼ºåˆ¶journalctlåªæŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—ï¼Œä»è€Œæ˜¾è‘—åŠ å¿«é€Ÿåº¦:</span></span><br><span class="line">$ sudo journalctl --file /var/<span class="built_in">log</span>/journal/*/system.journal -f</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®ä¾‹11.æ‰‹åŠ¨æ¸…ç†æ—¥å¿—æ–‡ä»¶åˆ é™¤å·²å½’æ¡£çš„æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">$ sudo journalctl --vacuum-size=100M <span class="comment">#ç›´åˆ°å®ƒä»¬ä½¿ç”¨çš„ç£ç›˜ç©ºé—´ä½äº100Mï¼š</span></span><br><span class="line">$ sudo journalctl --vacuum-time=2weeks <span class="comment">#ä½¿æ‰€æœ‰æ—¥è®°æ–‡ä»¶ä¸åŒ…å«è¶…è¿‡2å‘¨çš„æ•°æ®ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å®ä¾‹12.æŸ¥çœ‹ kubelet æœåŠ¡çš„ç›¸å…³æ—¥å¿—</span></span><br><span class="line">journalctl -xeu kubelet</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹13.ä»¥UTCæ˜¾ç¤ºæ—¶é—´æˆ³</span></span><br><span class="line">journalctl --utc</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹14.æŸ¥çœ‹Journaldä¸­å·²ç»è®°å½•çš„å¼•å¯¼ä¿¡æ¯</span></span><br><span class="line">journalctl --list-boots</span><br><span class="line">-1 13883d180dc0420db0abcb5fa26d6198 Tue 2015-02-03 22:17:03 UTCâ€”Tue 2015-02-03 22:19:08 UTC</span><br><span class="line"> 0 bed718b17a73415fade0e4e7f4bea609 Tue 2015-02-03 22:19:12 UTCâ€”Tue 2015-02-03 23:01:01 UTC</span><br><span class="line">  <span class="comment"># ä¾‹å¦‚ï¼Œè¦æŸ¥çœ‹ä¸Šæ¬¡å¼•å¯¼çš„journalè®°å½•ï¼Œåˆ™å¯ä½¿ç”¨-1ç›¸å¯¹æŒ‡é’ˆé…åˆ-bæ ‡è®°ï¼š journalctl -b -1</span></span><br><span class="line">  <span class="comment"># journalctl -b caf0524a1d394ce0bdbcff75b94444fe</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹15.æˆªæ–­æˆ–è€…æ‰©å¤§è¾“å‡ºç»“æœï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹journalctlä¼šåœ¨pagerå†…æ˜¾ç¤ºå„æ¡ç›®ï¼Œå¹¶é€šè¿‡å³ç®­å¤´é”®è®¿é—®å…¶ä¿¡æ¯</span></span><br><span class="line">journalctl --no-full</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹16.æœ¬æ“ä½œå·¥å…·å¯¹æ•°æ®è¿›è¡Œå¤„ç†åˆ™å¯èƒ½éœ€è¦ä½¿ç”¨æ ‡å‡†æ ¼å¼</span></span><br><span class="line">journalclt --no-pager  <span class="comment"># æ ‡å‡†è¾“å‡ºç»“æœ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹17.è¾“å‡ºæ ¼å¼(ç‰¹å®š)</span></span><br><span class="line">  <span class="comment"># cat: åªæ˜¾ç¤ºä¿¡æ¯å­—æ®µæœ¬èº«ã€‚</span></span><br><span class="line">  <span class="comment"># export: é€‚åˆä¼ è¾“æˆ–å¤‡ä»½çš„äºŒè¿›åˆ¶æ ¼å¼ã€‚</span></span><br><span class="line">  <span class="comment"># json: æ ‡å‡†JSONï¼Œæ¯è¡Œä¸€ä¸ªæ¡ç›®ã€‚</span></span><br><span class="line">  <span class="comment"># json-pretty: JSONæ ¼å¼ï¼Œé€‚åˆäººç±»é˜…è¯»ä¹ æƒ¯ã€‚</span></span><br><span class="line">  <span class="comment"># json-sse: JSONæ ¼å¼ï¼Œç»è¿‡æ‰“åŒ…ä»¥å…¼å®¹server-sentäº‹ä»¶ã€‚</span></span><br><span class="line">  <span class="comment"># short: é»˜è®¤syslogç±»è¾“å‡ºæ ¼å¼ã€‚</span></span><br><span class="line">  <span class="comment"># short-iso: é»˜è®¤æ ¼å¼ï¼Œå¼ºè°ƒæ˜¾ç¤ºISO 8601æŒ‚é’Ÿæ—¶é—´æˆ³ã€‚</span></span><br><span class="line">  <span class="comment"># short-monotonic: é»˜è®¤æ ¼å¼ï¼Œæä¾›æ™®é€šæ—¶é—´æˆ³ã€‚</span></span><br><span class="line">  <span class="comment"># short-precise: é»˜è®¤æ ¼å¼ï¼Œæä¾›å¾®ç§’çº§ç²¾åº¦ã€‚</span></span><br><span class="line">  <span class="comment"># verbose: æ˜¾ç¤ºè¯¥æ¡ç›®çš„å…¨éƒ¨å¯ç”¨journalå­—æ®µï¼ŒåŒ…æ‹¬é€šå¸¸è¢«å†…éƒ¨éšè—çš„å­—æ®µã€‚</span></span><br><span class="line">  <span class="comment"># ä¸Šè¿°é€‰é¡¹å…è®¸å¤§å®¶ä»¥æœ€é€‚åˆéœ€æ±‚çš„æ ¼å¼æ˜¾ç¤ºjournalæ¡ç›®ã€‚</span></span><br><span class="line">journalctl -b -u nginx -o json</span><br><span class="line">journalctl -b -u nginx -o json-pretty</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹17.æŸ¥çœ‹è¿‘æœŸæ—¥å¿—æŒ‡å®šæ¡æ•°ã€‚</span></span><br><span class="line">journalctl -n 20 <span class="comment"># åŒæ ·ä¸ºtail -n 20</span></span><br><span class="line">journalctl -f    <span class="comment"># åŒæ ·ä¸ºtail -f</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹18.Journalç»´æŠ¤æ¸…ç†éƒ¨åˆ†é™ˆæ—§æ—¥å¿—ä»¥é‡Šæ”¾å­˜å‚¨ç©ºé—´ã€‚</span></span><br><span class="line">journalctl --disk-usage</span><br><span class="line">  <span class="comment"># Journals take up 8.0M on disk.</span></span><br><span class="line"><span class="comment"># â€“vacuum-sizeé€‰é¡¹: å…¶ä¼šä¸æ–­åˆ é™¤æ—§æœ‰è®°å½•ç›´åˆ°æ‰€å å®¹é‡ç¬¦åˆè¦æ±‚</span></span><br><span class="line">sudo journalctl --vacuum-size=1G</span><br><span class="line"><span class="comment"># â€“vacuum-timeé€‰é¡¹ï¼šä»»ä½•æ—©äºè¿™ä¸€æ—¶é—´ç‚¹çš„æ¡ç›®éƒ½å°†è¢«åˆ é™¤ (å»å¹´ä¹‹åçš„æ¡ç›®æ‰èƒ½ä¿ç•™)</span></span><br><span class="line">sudo journalctl --vacuum-time=1years</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹19.æŒç»­æŸ¥çœ‹æŒ‡å®šæœåŠ¡ç¨‹åºçš„ä¿¡æ¯ã€‚</span></span><br><span class="line">journalctl -xefu kubelet</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯</span></span><br><span class="line">systemctl restart journald</span><br></pre></td></tr></table></figure></p>
<p><strong>é…ç½®æ–‡ä»¶è®¾ç½®:</strong></p>
<p><em>(1) æ—¥å¿—å¤§å°é™åˆ¶è®¾ç½®</em><br>é»˜è®¤ä¸ºåŸºç¡€æ–‡ä»¶ç³»ç»Ÿçš„10%ï¼Œä½†ä¸Šé™ä¸º4GBã€‚<br>ä¾‹å¦‚æœ¬æœº/var/log/journal/ä½äº30Gbåˆ†åŒºä¸Šï¼Œæ—¥å¿—æœ€å¤šéœ€è¦3Gbã€‚è¶…è¿‡40Gbçš„åˆ†åŒºï¼Œæ—¥å¿—æ–‡ä»¶éœ€è¦æœ€å¤§å€¼éƒ½ä¸º4Gbã€‚</p>
<p>å¯ä»¥é€šè¿‡å–æ¶ˆæ³¨é‡Šå’Œæ›´æ”¹ä»¥ä¸‹å†…å®¹æ¥æ§åˆ¶æŒä¹…æ—¥å¿—çš„æœ€å¤§å¤§å°ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$vim</span> /etc/systemd/journald.conf</span><br><span class="line">SystemMaxUse=50M</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¹Ÿå¯ä»¥ä½¿ç”¨drop-in snippetsé…ç½®è¦†ç›–æœºåˆ¶ï¼Œè€Œä¸æ˜¯ç¼–è¾‘å…¨å±€é…ç½®æ–‡ä»¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†è¦†ç›–ç½®äº[Journal]æ ‡é¢˜ä¸‹ï¼š</span></span><br><span class="line"><span class="variable">$vim</span> /etc/systemd/journald.conf.d/00-journal-size.conf</span><br><span class="line">[Journal]</span><br><span class="line">SystemMaxUse=50M</span><br></pre></td></tr></table></figure><br>ä¿®æ”¹åé‡æ–°å¯åŠ¨æ—¥å¿—ç³»ç»Ÿ <code>systemd-journald.service</code> å³ systemctl restart systemd-journald.service;</p>
<p><br/></p>
<p><em>(2) è¿‡å¾€å¼•å¯¼è®°å½•æŒä¹…åŒ–</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼1.å½“Storage=autoé€‰é¡¹æ—¶åˆ›å»ºä»¥ä¸‹ç›®å½•è¿›è¡Œæ—¥å¿—çš„æŒä¹…åŒ–ã€‚</span></span><br><span class="line">sudo mkdir -p /var/<span class="built_in">log</span>/journal</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2:åœ¨[Journal]åŒºæ®µä¸‹å°†Storage=é€‰é¡¹è®¾å®šä¸ºâ€œpersistentâ€ä»¥å¯ç”¨æŒä¹…è®°å½•ï¼š</span></span><br><span class="line">vim /etc/systemd/journald.conf</span><br><span class="line">Storage=persistent</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><em>(3) é™å®šJournalæ‰©å±•</em><br>å¤§å®¶å¯ä»¥é…ç½®è‡ªå·±çš„æœåŠ¡å™¨ä»¥é™å®šjournalæ‰€èƒ½å ç”¨çš„æœ€é«˜å®¹é‡ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ç¼–è¾‘/etc/systemd/journald.confæ–‡ä»¶ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ä»¥ä¸‹æ¡ç›®å¯ç”¨äºé™å®šjournalä½“ç§¯çš„è†¨èƒ€é€Ÿåº¦ï¼š</span><br><span class="line"></span><br><span class="line">SystemMaxUse=: æŒ‡å®šjournalæ‰€èƒ½ä½¿ç”¨çš„æœ€é«˜æŒä¹…å­˜å‚¨å®¹é‡ã€‚</span><br><span class="line">SystemKeepFree=: æŒ‡å®šjournalåœ¨æ·»åŠ æ–°æ¡ç›®æ—¶éœ€è¦ä¿ç•™çš„å‰©ä½™ç©ºé—´ã€‚</span><br><span class="line">SystemMaxFileSize=: æ§åˆ¶å•ä¸€journalæ–‡ä»¶å¤§å°ï¼Œç¬¦åˆè¦æ±‚æ–¹å¯è¢«è½¬ä¸ºæŒä¹…å­˜å‚¨ã€‚</span><br><span class="line">RuntimeMaxUse=: æŒ‡å®šæ˜“å¤±æ€§å­˜å‚¨ä¸­çš„æœ€å¤§å¯ç”¨ç£ç›˜å®¹é‡ï¼ˆ/runæ–‡ä»¶ç³»ç»Ÿä¹‹å†…ï¼‰ã€‚</span><br><span class="line">RuntimeKeepFree=: æŒ‡å®šå‘æ˜“å¤±æ€§å­˜å‚¨å†…å†™å…¥æ•°æ®æ—¶ä¸ºå…¶å®ƒåº”ç”¨ä¿ç•™çš„ç©ºé—´é‡ï¼ˆ/runæ–‡ä»¶ç³»ç»Ÿä¹‹å†…ï¼‰ã€‚</span><br><span class="line">RuntimeMaxFileSize=: æŒ‡å®šå•ä¸€journalæ–‡ä»¶å¯å ç”¨çš„æœ€å¤§æ˜“å¤±æ€§å­˜å‚¨å®¹é‡ï¼ˆ/runæ–‡ä»¶ç³»ç»Ÿä¹‹å†…ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">é€šè¿‡è®¾ç½®ä¸Šè¿°å€¼ï¼Œå¤§å®¶å¯ä»¥æ§åˆ¶journaldå¯¹æœåŠ¡å™¨ç©ºé—´çš„æ¶ˆè€—åŠä¿ç•™æ–¹å¼ã€‚</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><em>(4) journaldæ—¥å¿—è¢«æ‰“æ»¡è®¾ç½®</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/systemd/journald.conf</span><br><span class="line">RateLimitInterval=30s</span><br><span class="line">RateLimitBurst=100000</span><br></pre></td></tr></table></figure></p>
<p>Tips : JSON(JavaScript Object Notation)æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚æ˜“äºäººé˜…è¯»å’Œç¼–å†™ã€‚åŒæ—¶ä¹Ÿæ˜“äºæœºå™¨è§£æå’Œç”Ÿæˆã€‚å®ƒåŸºäºJavaScriptProgramming Language, Standard ECMA-262 3rd Edition - December 1999çš„ä¸€ä¸ªå­é›†ã€‚JSONé‡‡ç”¨å®Œå…¨ç‹¬ç«‹äºè¯­è¨€çš„æ–‡æœ¬æ ¼å¼ï¼Œä½†æ˜¯ä¹Ÿä½¿ç”¨äº†ç±»ä¼¼äºCè¯­è¨€å®¶æ—çš„ä¹ æƒ¯ï¼ˆåŒ…æ‹¬C, C++, C#, Java,JavaScript, Perl, Pythonç­‰ï¼‰ã€‚è¿™äº›ç‰¹æ€§ä½¿JSONæˆä¸ºç†æƒ³çš„æ•°æ®äº¤æ¢è¯­è¨€ã€‚</p>
<p>JSONå»ºæ„äºä¸¤ç§ç»“æ„ï¼š</p>
<ul>
<li>â€œåç§°/å€¼â€å¯¹çš„é›†åˆï¼ˆA collection ofname/value pairsï¼‰ï¼šä¸åŒçš„è¯­è¨€ä¸­ï¼Œå®ƒè¢«ç†è§£ä¸ºå¯¹è±¡ï¼ˆobjectï¼‰ï¼Œçºªå½•ï¼ˆrecordï¼‰ï¼Œç»“æ„ï¼ˆstructï¼‰ï¼Œå­—å…¸ï¼ˆdictionaryï¼‰ï¼Œå“ˆå¸Œè¡¨ï¼ˆhash tableï¼‰ï¼Œæœ‰é”®åˆ—è¡¨ï¼ˆkeyed listï¼‰ï¼Œæˆ–è€…å…³è”æ•°ç»„ï¼ˆassociativearrayï¼‰ã€‚</li>
<li>å€¼çš„æœ‰åºåˆ—è¡¨ï¼ˆAn ordered list of valuesï¼‰ï¼šåœ¨å¤§éƒ¨åˆ†è¯­è¨€ä¸­ï¼Œå®ƒè¢«ç†è§£ä¸ºæ•°ç»„ï¼ˆarrayï¼‰ã€‚</li>
</ul>
<p>è¿™äº›éƒ½æ˜¯å¸¸è§çš„æ•°æ®ç»“æ„ã€‚äº‹å®ä¸Šå¤§éƒ¨åˆ†ç°ä»£è®¡ç®—æœºè¯­è¨€éƒ½ä»¥æŸç§å½¢å¼æ”¯æŒå®ƒä»¬,è¿™ä½¿å¾—ä¸€ç§æ•°æ®æ ¼å¼åœ¨åŒæ ·åŸºäºè¿™äº›ç»“æ„çš„ç¼–ç¨‹è¯­è¨€ä¹‹é—´äº¤æ¢æˆä¸ºå¯èƒ½ã€‚</p>
<p>æ€»ç»“åˆ°è¿™é‡Œ<code>systemd journal</code>å¯¹ç³»ç»ŸåŠåº”ç”¨æ•°æ®çš„æ”¶é›†ä¸ç®¡ç†æœºåˆ¶å°±ä»‹ç»å®Œæ¯•äº†ã€‚å…¶å‡ºè‰²çš„çµæ´»æ€§æºè‡ªå°†å¹¿æ³›çš„å…ƒæ•°æ®è‡ªåŠ¨è®°å½•è‡³é›†ä¸­åŒ–æ—¥å¿—ä¹‹å†…ã€‚å¦å¤– <code>journalctl</code> å‘½ä»¤ åˆ™æ˜¾è‘—ç®€åŒ–äº†journalçš„ä½¿ç”¨æ–¹å¼ï¼Œä»è€Œè®©æ›´å¤šç®¡ç†å‘˜å¾—ä»¥åˆ©ç”¨å®ƒå®Œæˆé¢å‘ä¸åŒåº”ç”¨ç»„ä»¶çš„åˆ†æä¸ç›¸å…³è°ƒè¯•å·¥ä½œã€‚ </p>
<p><br></p>
<h5 id="3-Systemd-analyze-å‘½ä»¤"><a href="#3-Systemd-analyze-å‘½ä»¤" class="headerlink" title="3.Systemd-analyze å‘½ä»¤"></a>3.Systemd-analyze å‘½ä»¤</h5><p>æè¿°: é…ç½®æ–‡ä»¶systemdï¼Œæ˜¾ç¤ºå•å…ƒä¾èµ–å…³ç³»ï¼Œå¹¶æ£€æŸ¥å•å…ƒæ–‡ä»¶ã€‚</p>
<p><strong>è¯­æ³•å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br><span class="line">  systemd-analyze [OPTIONS...] COMMAND ...</span><br><span class="line">Commands:</span><br><span class="line">  [time]                   æ‰“å°å¯åŠ¨æœºå™¨æ‰€éœ€çš„æ—¶é—´</span><br><span class="line">  blame                    æ‰“å°æŒ‰è€—æ—¶æ’åºçš„è¿è¡ŒæœåŠ¡serviceåˆ—è¡¨</span><br><span class="line">  critical-chain [UNIT...] æ‰“å°æ—¶é—´å…³é”®å•ä½é“¾çš„æ ‘</span><br><span class="line">  plot                     Output SVG graphic showing service initialization</span><br><span class="line">  dot [UNIT...]            Output dependency graph <span class="keyword">in</span> dot(1) format</span><br><span class="line">  dump                     Output state serialization of service manager</span><br><span class="line">  cat-config               Show configuration file and drop-ins</span><br><span class="line">  unit-files               List files and symlinks <span class="keyword">for</span> units</span><br><span class="line">  unit-paths               List load directories <span class="keyword">for</span> units</span><br><span class="line">  <span class="built_in">exit</span>-status [STATUS...]  List <span class="built_in">exit</span> status definitions</span><br><span class="line">  capability [CAP...]      List capability definitions</span><br><span class="line">  syscall-filter [NAME...] Print list of syscalls <span class="keyword">in</span> seccomp filter</span><br><span class="line">  condition CONDITION...   Evaluate conditions and asserts</span><br><span class="line">  verify FILE...           Check unit files <span class="keyword">for</span> correctness</span><br><span class="line">  calendar SPEC...         Validate repetitive calendar time events</span><br><span class="line">  timestamp TIMESTAMP...   Validate a timestamp</span><br><span class="line">  timespan SPAN...         Validate a time span</span><br><span class="line">  security [UNIT...]       Analyze security of unit</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -h --<span class="built_in">help</span>                Show this <span class="built_in">help</span></span><br><span class="line">     --version             Show package version</span><br><span class="line">     --no-pager            Do not pipe output into a pager</span><br><span class="line">     --system              Operate on system systemd instance</span><br><span class="line">     --user                Operate on user systemd instance</span><br><span class="line">     --global              Operate on global user configuration</span><br><span class="line">  -H --host=[USER@]HOST    Operate on remote host</span><br><span class="line">  -M --machine=CONTAINER   Operate on <span class="built_in">local</span> container</span><br><span class="line">     --order               Show only order <span class="keyword">in</span> the graph</span><br><span class="line">     --require             Show only requirement <span class="keyword">in</span> the graph</span><br><span class="line">     --from-pattern=GLOB   Show only origins <span class="keyword">in</span> the graph</span><br><span class="line">     --to-pattern=GLOB     Show only destinations <span class="keyword">in</span> the graph</span><br><span class="line">     --fuzz=SECONDS        Also <span class="built_in">print</span> services <span class="built_in">which</span> finished SECONDS earlier than the latest <span class="keyword">in</span> the branch</span><br><span class="line">     --man[=BOOL]          Do [not] check <span class="keyword">for</span> existence of man pages</span><br><span class="line">     --generators[=BOOL]   Do [not] run unit generators (requires privileges)</span><br><span class="line">     --iterations=N        Show the specified number of iterations</span><br><span class="line">     --base-time=TIMESTAMP Calculate calendar <span class="built_in">times</span> relative to specified time</span><br></pre></td></tr></table></figure></p>
<p><strong>ç¤ºä¾‹æ¼”ç¤º:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.Linuxç³»ç»Ÿå¼€æœºæ—¶é—´æµç¨‹æ‰€è€—è´¹æ—¶é—´ä¸€è§ˆ</span></span><br><span class="line">$ systemd-analyze</span><br><span class="line">  <span class="comment"># Startup finished in 473ms (kernel) + 3.990s (initrd) + 40.050s (userspace) = 44.515s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æŸ¥çœ‹ Linux ç³»ç»Ÿå¯åŠ¨æ—¶å„æœåŠ¡è€—æ—¶æƒ…å†µ</span></span><br><span class="line">~$ systemd-analyze blame</span><br><span class="line">13.701s systemd-networkd-wait-online.service</span><br><span class="line"> 6.002s systemd-journal-flush.service</span><br><span class="line"> 4.673s dev-mapper-ubuntu\x2d\x2dvg\x2dubuntu\x2d\x2dlv.device</span><br><span class="line"> 3.656s networkd-dispatcher.service</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="0x03-è¡¥å……çŸ¥è¯†"><a href="#0x03-è¡¥å……çŸ¥è¯†" class="headerlink" title="0x03 è¡¥å……çŸ¥è¯†"></a>0x03 è¡¥å……çŸ¥è¯†</h4><p>systemctl é…ç½®æ–‡ä»¶çš„è®¾ç½®å‚æ•°ä¸€è§ˆ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[Unit]  <span class="comment"># ä¸æ­¤ unit çš„è§£é‡Šã€æ‰§è¡ŒæœåŠ¡ç›¸ä¾æ€§æœ‰å…³</span></span><br><span class="line">Description=æè¿°</span><br><span class="line">Documentation=æ–‡æ¡£åœ°å€</span><br><span class="line">After=network.target   <span class="comment">#åœ¨æœåŠ¡ä¹‹å</span></span><br><span class="line">Before=test.target  <span class="comment">#åœ¨æœåŠ¡ä¹‹å‰</span></span><br><span class="line">Wants=sshd-keygen.service <span class="comment">#éœ€æ±‚æœåŠ¡</span></span><br><span class="line">Requires=network.target  <span class="comment">#ä¾èµ–çš„æœåŠ¡</span></span><br><span class="line">Conflicts=å†²çªè§£å†³</span><br><span class="line"></span><br><span class="line">[Service]        <span class="comment"># è¿™ä¸ªé¡¹ç›®ä¸å®é™…æ‰§è¡Œçš„æŒ‡ä»¤å‚æ•°æœ‰å…³</span></span><br><span class="line">Type=æœåŠ¡ç±»å‹</span><br><span class="line">EnvironmentFile=/etc/sysconfig/sshd</span><br><span class="line">ExecStart=/usr/sbin/sshd -D <span class="variable">$OPTIONS</span></span><br><span class="line">ExecReload=/bin/<span class="built_in">kill</span> -HUP <span class="variable">$MAINPID</span></span><br><span class="line">KillMode=process</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=42s</span><br><span class="line">RemainAfterExit</span><br><span class="line">TimeoutSec</span><br><span class="line"></span><br><span class="line">[Install]        <span class="comment"># æ­¤ unit è¦æŒ‚è½½å“ªä¸ª target ä¸‹é¢å³é»˜è®¤å¯åŠ¨çš„è¿è¡Œçº§åˆ«ï¼ˆè‡ªå¯åŠ¨è®¾ç½®ï¼‰</span></span><br><span class="line">WantedBy=multi-user.target <span class="comment">#åœ¨ä½•ç§æœåŠ¡æˆ–ç¯å¢ƒä¸‹å¯åŠ¨</span></span><br><span class="line">Also</span><br><span class="line">Alias</span><br></pre></td></tr></table></figure></p>
<h5 id="1-è‡ªå®šä¹‰æœåŠ¡å•å…ƒ"><a href="#1-è‡ªå®šä¹‰æœåŠ¡å•å…ƒ" class="headerlink" title="1.è‡ªå®šä¹‰æœåŠ¡å•å…ƒ"></a>1.è‡ªå®šä¹‰æœåŠ¡å•å…ƒ</h5><p><strong>æ–¹å¼1ï¼š</strong><br>æè¿°ï¼šä¸ºäº†é¿å…å’Œ pacman å†²çªä¸åº”è¯¥ç›´æ¥ç¼–è¾‘è½¯ä»¶åŒ…æä¾›çš„æ–‡ä»¶. è¦æ›´æ”¹ç”±è½¯ä»¶åŒ…æä¾›çš„å•å…ƒæ–‡ä»¶ï¼Œå…ˆåˆ›å»ºåä¸º<code>/etc/systemd/system/&lt;å•å…ƒå&gt;.d/ çš„æ–‡ä»¶å¤¹ï¼ˆå¦‚ /etc/systemd/system/httpd.service.d/</code>ï¼‰ï¼›ç„¶åæ”¾å…¥ *.conf æ–‡ä»¶ï¼Œå½“ä¸­èƒ½å¤ŸåŠ å…¥æˆ–é‡ç½®åƒæ•°ï¼Œè¿™é‡Œè®¾ç½®çš„åƒæ•°ä¼˜å…ˆçº§é«˜äºåŸæ¥çš„å•å…ƒæ–‡ä»¶ã€‚</p>
<p>å®é™…æ¡ˆä¾‹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.æ¯”å¦‚å‡è®¾æƒ³åŠ å…¥ä¸€ä¸ªé¢å¤–çš„ä¾èµ–ã€‚åˆ›å»ºè¿™ä¹ˆä¸€ä¸ªæ–‡ä»¶å°±å¯ä»¥ï¼š</span></span><br><span class="line">/etc/systemd/system/&lt;unit&gt;.d/customdependency.conf</span><br><span class="line">[Unit]</span><br><span class="line">Requires=&lt;æ–°ä¾èµ–&gt;</span><br><span class="line">After=&lt;æ–°ä¾èµ–&gt;</span><br><span class="line"></span><br><span class="line">/etc/systemd/system/unit.d/customexec.conf</span><br><span class="line">[Service]</span><br><span class="line"><span class="comment">#æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæ”¹åŠ¨ ExecStart å‰å¿…é¡»å°†å…¶ç½®ç©º</span></span><br><span class="line">ExecStart=</span><br><span class="line">ExecStart=new <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è‡ªå·±ä¸»åŠ¨é‡æ–°å¯åŠ¨æœåŠ¡</span></span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=30</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.ç„¶åæ‰§è¡Œä¸‹é¢å‘½ä»¤ä½¿æ›´æ”¹ç”Ÿæ•ˆï¼š</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart &lt;å•å…ƒ&gt;</span><br></pre></td></tr></table></figure></p>
<p>æ­¤å¤–ï¼ŒæŠŠæ—§çš„å•å…ƒæ–‡ä»¶ä» /usr/lib/systemd/system/ æ‹·è´åˆ° /etc/systemd/system/ï¼Œç„¶åè¿›è¡Œæ”¹åŠ¨ï¼Œä¹Ÿèƒ½å¤Ÿè¾¾åˆ°ç›¸åŒæ•ˆæœã€‚</p>
<p>æ€»ç»“ï¼š</p>
<ul>
<li><p>åœ¨ /etc/systemd/system/ æ–‡ä»¶å¤¹ä¸­çš„å•å…ƒæ–‡ä»¶çš„ä¼˜å…ˆçº§æ€»æ˜¯é«˜äº /usr/lib/systemd/system/ æ–‡ä»¶å¤¹ä¸­çš„åŒåå•å…ƒæ–‡ä»¶</p>
</li>
<li><p>ç”¨ systemd-delta å‘½ä»¤æ¥æŸ¥çœ‹å“ªäº›å•å…ƒæ–‡ä»¶è¢«è¦†ç›–ã€å“ªäº›è¢«æ”¹åŠ¨ï¼Œç³»ç»Ÿç»´æŠ¤çš„æ—¶å€™é¡»è¦åŠæ—¶äº†è§£å“ªäº›å•å…ƒå·²ç»æœ‰äº†æ›´æ–°ã€‚</p>
</li>
</ul>
<p><strong>æ–¹æ³•2</strong><br>è‡ªå®šä¹‰è½¯ä»¶çš„ Systemd å•å…ƒå®ä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=WebP Server Go</span><br><span class="line">Documentation=https://github.com/webp-sh/webp_server_go</span><br><span class="line">After=nginx.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=root</span><br><span class="line">Group=root</span><br><span class="line">Type=simple</span><br><span class="line">StandardError=journal</span><br><span class="line">WorkingDirectory=/opt/webps</span><br><span class="line"><span class="comment">#EnvironmentFile=-/etc/etcd/etcd.conf</span></span><br><span class="line">ExecStart=/opt/webps/webp-server --config /opt/webps/config.json</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=3s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åå°†å…¶ä¿å­˜åœ¨<code>/usr/lib/systemd/system/docker.service/webp.service</code>ï¼Œå¹¶ä¸” æ‰§è¡Œ <code>systemctl daemon-reload</code>é‡è½½å®ˆæŠ¤æœåŠ¡; ä¹‹åå°†å¯ä»¥é€šè¿‡systemctl status webp.service å¯¹æˆ‘ä»¬ç¼–å†™çš„æœåŠ¡å•å…ƒè¿›è¡Œç®¡ç†;</p>
<p>å…³äº systemd çš„å•å…ƒé…ç½®æ–‡ä»¶å¦‚ä½•ä¹¦å†™ï¼Œå› ä¸ºæ ¹æ®ä¸åŒçš„å•å…ƒç±»å‹åŒ…å«çš„é…ç½®é¡¹å®åœ¨æ˜¯å·¨å¤šã€‚å»ºè®®å‚<a href="http://www.jinbuguo.com/systemd/systemd.index.html" target="_blank" rel="noopener">è€ƒå®˜æ–¹æ–‡æ¡£/ç¤¾åŒºç¿»è¯‘æ–‡æ¡£</a></p>
<p><strong>ç¤ºä¾‹3.</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /usr/lib/systemd/system/nginx.service</span></span><br><span class="line">tee /usr/lib/systemd/system/nginx.service&lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Nginx - high performance web server service</span><br><span class="line">Documentation=http://nginx.org/en/docs/ </span><br><span class="line">After=network-online.target remote-fs.target nss-lookup.target </span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/usr/<span class="built_in">local</span>/nginx/logs/nginx.pid</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/nginx/sbin/nginx -c /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br><span class="line">ExecReload=/bin/<span class="built_in">kill</span> -s HUP <span class="variable">$MAINPID</span></span><br><span class="line">ExecStop=/bin/<span class="built_in">kill</span> -s TERM <span class="variable">$MAINPID</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></p>
<hr>
<h5 id="2-è‡ªå®šä¹‰é…ç½®"><a href="#2-è‡ªå®šä¹‰é…ç½®" class="headerlink" title="2.è‡ªå®šä¹‰é…ç½®"></a>2.è‡ªå®šä¹‰é…ç½®</h5><p><strong>ï¼ˆ1ï¼‰åŸºäºsystemdå®ç°æ˜¾ç¤ºæœåŠ¡CPU å’Œ Memory ä¿¡æ¯</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$vim</span> /etc/systemd/system.conf</span><br><span class="line">DefaultCPUAccounting=yes</span><br><span class="line">DefaultMemoryAccounting=yes</span><br><span class="line">DefaultTasksAccounting=yes</span><br></pre></td></tr></table></figure><br>ä¿®æ”¹é‡å¯ç³»ç»Ÿå³å¯çœ‹è§;<br><figure class="image-box">
                <a rel=systemdæœåŠ¡ç®¡ç†è¯¦è§£ä¸å­å‘½ä»¤ä¸€è§ˆ href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200420215715.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/1/20200420215715.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure></p>

        </div>
        <!-- Google å¹¿å‘Š -->
          

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-08-24T13:25:30.699Z" itemprop="dateUpdated">2022-08-24 21:25:30</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç³»ç»Ÿè¿ç»´/Linux/å¸¸ç”¨å‘½ä»¤/å®‰è£…è½¯ä»¶ç±»å‘½ä»¤/systemdæœåŠ¡ç®¡ç†è¯¦è§£ä¸å­å‘½ä»¤ä¸€è§ˆ.md" target="_blank" rel="noopener noreferrer">_posts/ç³»ç»Ÿè¿ç»´/Linux/å¸¸ç”¨å‘½ä»¤/å®‰è£…è½¯ä»¶ç±»å‘½ä»¤/systemdæœåŠ¡ç®¡ç†è¯¦è§£ä¸å­å‘½ä»¤ä¸€è§ˆ.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2019/6-12-152.html" target="_blank" rel="external">https://blog.weiyigeek.top/2019/6-12-152.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/" rel="tag">æœåŠ¡ç®¡ç†</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/6-12-152.html&title=ã€ŠsystemdæœåŠ¡ç®¡ç†è¯¦è§£ä¸å­å‘½ä»¤ä¸€è§ˆã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/6-12-152.html&title=ã€ŠsystemdæœåŠ¡ç®¡ç†è¯¦è§£ä¸å­å‘½ä»¤ä¸€è§ˆã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/6-12-152.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠsystemdæœåŠ¡ç®¡ç†è¯¦è§£ä¸å­å‘½ä»¤ä¸€è§ˆã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/6-12-152.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/6-12-152.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/6-13-168.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">ç³»ç»Ÿè¿›ç¨‹ç®¡ç†æŸ¥çœ‹</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/6-12-154.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">ç³»ç»Ÿè½¯ä»¶æœåŠ¡ç±»è®¾ç½®å‘½ä»¤</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x00-Systemd-ç®€è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 Systemd ç®€è¿°</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x01-Systemd-Unit"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 Systemd Unit</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x02-Systemd-Manager"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 Systemd Manager</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x03-è¡¥å……çŸ¥è¯†"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 è¡¥å……çŸ¥è¯†</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    


    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      

    <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
    
      <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
        
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/search-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/6-12-152.html&title=ã€ŠsystemdæœåŠ¡ç®¡ç†è¯¦è§£ä¸å­å‘½ä»¤ä¸€è§ˆã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/6-12-152.html&title=ã€ŠsystemdæœåŠ¡ç®¡ç†è¯¦è§£ä¸å­å‘½ä»¤ä¸€è§ˆã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/6-12-152.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠsystemdæœåŠ¡ç®¡ç†è¯¦è§£ä¸å­å‘½ä»¤ä¸€è§ˆã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/6-12-152.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/6-12-152.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACKElEQVR42u3awVLDMAxF0f7/T4dtmZJwn+TARL5ZMSGkPl08ZMmvF76Ot+v9zvVvP+9/vvP6UxZfMmTIeCzjuLyul8UxZ0s/ew9fmwwZMvZhpK8mQUk+vs+WIUOGDLJ0EtN8oTJkyJCxKnB5OJJQ/rf/GzJkyHgUg0Qnb66RRhv/ahbvxWXIkPFABu+6//3Pt8w3ZMiQ8SjGEV79UnLVSr69U4YMGaMZPOA6zX2+oa2tR4YMGbMZtdY/h/UbcOiODBkyNmaQ4o8slDT902FnELgyZMh4OKNfDpKYXgVLy0cZMmTMYNQKu9rz/J3pFyFDhozZjNrBrM4IgYQsHzkU61AZMmSMYNxxdqNWscYFogwZMsYx+kcr0o1upxj9pWsoQ4aM0Yy0+RU05cOBaDGCZciQMZqRRlvaVus02orTDBkyZIxjpH/A45g3yzgblYYyZMgYx6iNJ9NjFryUrBWdMmTImM1IQ7OGWbtV/gEpQ4aM0Yy7N58kiEngonGFDBkyNmaQjhYJTfJ8rcEnQ4aMfRhrRwXkuAb/UlD/X4YMGRswSKvrvpDtNARlyJAxm3GEVy2OVw1ET8NXhgwZoxn942LpB5Ol8DKxOOyUIUPGAxn9dlt6h49LeWTLkCFjB0Z/y5oOJtEOmx8dkyFDhozSMzxw0wMWMmTIkNEJ3DQoyQ4b4WXIkLEBgxR8vGXWj9cb220yZMh4IKN1UgM/mY5FSQNOhgwZGzC+AC46Qc/ZLexxAAAAAElFTkSuQmCC" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// ç«™ç‚¹è¿è¡Œæ—¶é—´
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + "å¤©" + RunHours + "æ—¶" + RunMinutes + "åˆ†" + RunSeconds + "ç§’";
  document.getElementById(id).innerHTML = "ç½‘ç«™å·²åœ¨é£é›¨ä¸­å‹‰å‹‰å¼ºå¼ºè¿è¡Œäº†ã€" + RunTime + "ã€‘";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
</body>
</html>