<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Jenkins">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/2018/1-1-1.html"  >
                <i class="icon icon-lg icon-mortar-board"></i>
                å­¦ä¹ ä¹‹è·¯
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹</h1>
        <h5 class="subtitle">
            
                <time datetime="2023-01-31T05:34:30.000Z" itemprop="datePublished" class="page-time">
  2023-01-31
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevSecOps/">DevSecOps</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevSecOps/CICD/">CICD</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
  <article id="post-ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/Jenkins/9.Jenkinså®è·µä¹‹è¿æ¥ä½¿ç”¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹</h1>
        <div class="post-meta">
            <time class="post-time" title="2023-01-31 13:34:30" datetime="2023-01-31T05:34:30.000Z"  itemprop="datePublished">2023-01-31</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevSecOps/">DevSecOps</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DevSecOps/CICD/">CICD</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="0x00-å‰è¨€ç®€è¿°"><a href="#0x00-å‰è¨€ç®€è¿°" class="headerlink" title="0x00 å‰è¨€ç®€è¿°"></a>0x00 å‰è¨€ç®€è¿°</h2><p>çœ‹è¿‡æˆ‘å‰é¢Jenkinså­¦ä¹ ä¹‹è·¯çš„æœ‹å‹è‚¯å®šçŸ¥é“ï¼Œåœ¨Kubenetesä¸­ä½¿ç”¨Jenkinså¯ä»¥è¿›è¡ŒåŠ¨æ€ç”Ÿæˆåˆ†å¸ƒå¼jnlp-slaveçš„agentèŠ‚ç‚¹ï¼Œç›¸æ¯”äºä¼ ç»Ÿçš„agentèŠ‚ç‚¹æ¥è¯´æå¤§çš„èŠ‚çº¦èµ„æºã€‚</p>
<p>ä½†æ˜¯æŸä¸€å¤©å¼€å‘åé¦ˆæŸä¸ªé¡¹ç›®CICDæ— æ³•æ­£å¸¸è¿›è¡Œï¼Œä½œä¸ºè¿ç»´äººå‘˜ï¼ˆæ¬ç –ï¼‰ç«‹é©¬è¿›å…¥K8Sé›†ç¾¤ï¼Œæ’é™¤å®‰è£…åœ¨é›†ç¾¤ä¸­çš„Jenkinsçš„å¼‚å¸¸é—®é¢˜ï¼Œæ’æŸ¥å¯çŸ¥ç”±äºK8Sé›†ç¾¤è¯ä¹¦åˆ°æœŸå¯¼è‡´åŠ¨æ€jenkins agentèŠ‚ç‚¹æ— æ³•æ­£å¸¸è¢«åˆ›å»ºï¼Œæ­¤æ—¶é¡¹ç›®åˆæ¯”è¾ƒç´§æ€¥ã€‚</p>
<p>é‚åˆ©ç”¨è£…æœ‰Dockerçš„æœºå™¨ï¼Œç«‹å³ä½¿ç”¨è‡ªè¡Œæ„å»ºçš„jenkins-jnlp-agenté•œåƒï¼Œå¹¶åœ¨ jenkins ä¸­åˆ›å»ºä¸€ä¸ªå›ºå®šèŠ‚ç‚¹ï¼Œé€šè¿‡dockerè¿è¡Œè¯¥é•œåƒå¹¶è¿æ¥åˆ°Jenkinsï¼Œåœ¨æµæ°´çº¿é¡¹ç›®ç»‘å®šåˆ°è¯¥èŠ‚ç‚¹æ‰§è¡Œï¼Œé€šè¿‡å‡ åˆ†é’Ÿçš„æ—¶é—´å°±å¿«é€Ÿè§£å†³äº†jenkins agenté—®é¢˜ï¼Œåœ¨é¡¹ç›®å®ŒæˆæŒç»­é›†æˆå’Œäº¤äº’åï¼Œè¶ç€é—´éš™æ›´æ–°Jenkinsä¸Šé…ç½®è¿æ¥kubernetes apiserverçš„è¯ä¹¦ï¼Œæ¢å¤äº†åŠ¨æ€ç”ŸæˆagentèŠ‚ç‚¹ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸ºäº†ä¾¿äºè‡ªå·±æ€»ç»“çŸ¥è¯†ï¼Œä»¥åŠæœ‰ç›¸åŒéœ€æ±‚çš„çœ‹å‹ï¼Œé‚å°†jenkinså¤–éƒ¨agentèŠ‚ç‚¹æ¥å…¥ä»¥åŠè‡ªè¡Œæ„å»ºjnlp-agenté•œåƒæµç¨‹è¿›è¡Œå®è·µï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°å¤§å®¶ã€‚</p>
<p>å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹ä½ æœ‰ç”¨ï¼Œè¯·æ‚¨ä¹Ÿè½¬å‘ã€ç‚¹èµã€åœ¨çœ‹ã€ç»™å‘¨è¾¹çš„æœ‹å‹å§!</p>
<p>æ¸©é¦¨æç¤º: è‹¥éœ€è¦ä¼ä¸š Jenkins Pipeline æµæ°´çº¿è„šæœ¬çš„æœ‹å‹ï¼Œå¯ä»¥å…³æ³¨ã€WeiyiGeekã€‘åå›å¤ã€Jenkinsæµæ°´çº¿ä»£ç ã€‘å³å¯ä¸‹è½½ <code>Jenkins-Pipeline.groovy</code> ç¤ºä¾‹æ–‡ä»¶ã€‚</p>
<figure class="image-box">
                <a rel=9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ href="https://img.weiyigeek.top/2023/1/20230207170309.png" target="_blank" title="WeiyiGeek.Jenkinsæµæ°´çº¿ä»£ç å›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2023/1/20230207170309.png" alt="WeiyiGeek.Jenkinsæµæ°´çº¿ä»£ç å›¾" title="" class=""></a>
                <p>WeiyiGeek.Jenkinsæµæ°´çº¿ä»£ç å›¾</p>
            </figure>
<hr>
<h2 id="0x01-åŸºç¡€ç¯å¢ƒå‡†å¤‡"><a href="#0x01-åŸºç¡€ç¯å¢ƒå‡†å¤‡" class="headerlink" title="0x01 åŸºç¡€ç¯å¢ƒå‡†å¤‡"></a>0x01 åŸºç¡€ç¯å¢ƒå‡†å¤‡</h2><h3 id="1-ç¯å¢ƒè¯´æ˜"><a href="#1-ç¯å¢ƒè¯´æ˜" class="headerlink" title="1.ç¯å¢ƒè¯´æ˜"></a>1.ç¯å¢ƒè¯´æ˜</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.K8s é›†ç¾¤ä¸­å®‰è£…çš„ Jenkins </span></span><br><span class="line">~$ kubectl get pod,svc -n devops -l app=jenkins</span><br><span class="line">NAME                           READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/jenkins-7fc6f4fcf6-glqxj   1/1     Running   0          28h</span><br><span class="line"></span><br><span class="line">NAME              TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)                          AGE</span><br><span class="line">service/jenkins   NodePort   10.109.163.223   &lt;none&gt;        8080:30001/TCP,50000:30634/TCP   382d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.Jenkins å®‰è£…ç‰ˆæœ¬</span></span><br><span class="line">Jenkins 2.330</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.åœ°å€è¯´æ˜</span></span><br><span class="line">Jenkins é¢æ¿: http://192.168.12.107:30001/</span><br><span class="line">TCP port <span class="keyword">for</span> inbound agents(Agent ç«¯å£): http://192.168.12.107:30634/  ( å†…éƒ¨ä¸º 50000ï¼Œè‹¥æ˜¯åœ¨é›†ç¾¤ä¸­ä½¿ç”¨åˆ™éœ€è¦å°†nodePortç«¯å£æ”¹æˆï¼Œå¯é€šè¿‡è½¬å‘çš„å½¢å¼ å› ä¸ºK8Sé»˜è®¤nodePortèŒƒå›´åœ¨ 30000-32767 ä¹‹ä¸­)</span><br></pre></td></tr></table></figure>
<p>æ¸©é¦¨æç¤º: æˆ‘ä»¬éœ€è¦ä¿®æ”¹ Jenkins Agent ç«¯å£ å¯ä»¥è®¿é—® Dashboard å…¨å±€å®‰å…¨é…ç½® -&gt; ä»£ç† (TCP port for inbound agents) æŒ‡å®šç«¯å£è®¾ç½®ä¸º 30634ï¼Œæ³¨æ„ç›¸å¯¹åº”Podæš´éœ²çš„ç«¯å£ä¹Ÿè¦ä¸€åŒä¿®æ”¹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl edit deployments.apps -n devops jenkins</span><br><span class="line">  ports:</span><br><span class="line">  - containerPort: 8080</span><br><span class="line">    name: web</span><br><span class="line">    protocol: TCP</span><br><span class="line">  - containerPort: 30634  <span class="comment"># ä¿®æ”¹ç‚¹</span></span><br><span class="line">    name: agent</span><br><span class="line">    protocol: TCP</span><br><span class="line"></span><br><span class="line">$ kubectl edit svc -n devops jenkins</span><br><span class="line">  - name: agent</span><br><span class="line">    nodePort: 30634    </span><br><span class="line">    port: 30634        <span class="comment"># ä¿®æ”¹ç‚¹ä¸ containerPort è¦ä¸€è‡´ã€‚</span></span><br><span class="line">    protocol: TCP:q</span><br><span class="line">    targetPort: agent</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯æŸ¥çœ‹ Pod ä¸ æœåŠ¡æ˜¯å¦æ­£å¸¸</span></span><br><span class="line">$ kubectl get svc,pod -n devops -l app=jenkins</span><br><span class="line">  NAME              TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)                          AGE</span><br><span class="line">  service/jenkins   NodePort   10.109.163.223   &lt;none&gt;        8080:30001/TCP,30634:30634/TCP   382d</span><br><span class="line">  </span><br><span class="line">  NAME                           READY   STATUS    RESTARTS   AGE</span><br><span class="line">  pod/jenkins-856bc9b47f-4t7k5   1/1     Running   0          2m9s</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ href="https://img.weiyigeek.top/2023/1/20230202172521.png" target="_blank" title="WeiyiGeek.Jenkins-inbound agentsç«¯å£ä¿®æ”¹å›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2023/1/20230202172521.png" alt="WeiyiGeek.Jenkins-inbound agentsç«¯å£ä¿®æ”¹å›¾" title="" class=""></a>
                <p>WeiyiGeek.Jenkins-inbound agentsç«¯å£ä¿®æ”¹å›¾</p>
            </figure>
<p>æˆ–è€…é‡‡ç”¨å¦‚ä¸‹ä¸´æ—¶è§£å†³åŠæ³•ï¼ˆä¸‹é¢å®è·µ1ä¸­é‡‡ç”¨çš„æ˜¯æ­¤ç§æ–¹æ³•ï¼Œæ­£å¼ç¯å¢ƒä¸‹è¿˜æ˜¯å»ºè®®ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•ç¨³å®šï¼Œä½†æ˜¯éœ€è¦æ›´æ”¹å’Œæ³¨æ„çš„äº‹é¡¹æ›´å¤šäº†ï¼‰<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl -n devops port-forward --address 127.0.0.1,192.168.12.107 jenkins-7fc6f4fcf6-glqxj 50000:50000</span><br><span class="line">  <span class="comment"># Forwarding from 127.0.0.1:50000 -&gt; 50000</span></span><br><span class="line">  <span class="comment"># Forwarding from 192.168.12.107:50000 -&gt; 50000</span></span><br><span class="line">  <span class="comment"># Handling connection for 50000</span></span><br><span class="line">  <span class="comment"># Handling connection for 50000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…åœ¨ jenkins æ§åˆ¶å™¨èµ„æºæ¸…å•ä¸­è®¾ç½® hostNetwork: true</span></span><br></pre></td></tr></table></figure></p>
<p>æ¸©é¦¨æç¤º: è‹¥çœ‹å‹ä¸äº†è§£JenkinsæŒç»­é›†æˆçš„ï¼Œæˆ–è€…éœ€è¦å®‰è£…å®è·µçš„ï¼Œå¯ä»¥å‚è€ƒåšä¸»å­¦ä¹ ã€Jenkinså­¦ä¹ ä¹‹è·¯æ±‡æ€»ã€‘æ±‡æ€»ï¼Œå…³æ³¨ <code>WeiyiGeek</code> å…¬ä¼—å·å›å¤ã€<code>jenkinså­¦ä¹ ä¹‹è·¯</code>ã€‘å³å¯è·å¾—å­¦ä¹ èµ„æ–™ï¼š</p>
<p><br/></p>
<h3 id="2-æ·»åŠ æ–°çš„Jenkins-agentèŠ‚ç‚¹"><a href="#2-æ·»åŠ æ–°çš„Jenkins-agentèŠ‚ç‚¹" class="headerlink" title="2.æ·»åŠ æ–°çš„Jenkins agentèŠ‚ç‚¹"></a>2.æ·»åŠ æ–°çš„Jenkins agentèŠ‚ç‚¹</h3><p>æ“ä½œæ­¥éª¤å¦‚ä¸‹: Dashboard ç³»ç»Ÿç®¡ç† -&gt; èŠ‚ç‚¹ç®¡ç† -&gt; æ–°å»ºèŠ‚ç‚¹ -&gt; æŒ‰ç…§æç¤ºè¾“å…¥å¦‚ä¸‹ä¿¡æ¯ -&gt; æœ€åç‚¹å‡»ä¿å­˜</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€é…ç½®</span></span><br><span class="line">èŠ‚ç‚¹åå­—: docker-jenkins-jnlp</span><br><span class="line">Number of executors (æœ€å¤§æ‰§è¡Œæ•°): 1~5 </span><br><span class="line">è¿œç¨‹å·¥ä½œç›®å½•: /home/jenkins/agent</span><br><span class="line">æ ‡ç­¾: docker-jnlp-1</span><br><span class="line">å¯åŠ¨æ–¹å¼: é€šè¿‡ Java Web å¯åŠ¨ä»£ç†</span><br><span class="line">å¯ç”¨æ€§: å°½é‡ä¿æŒä»£ç†åœ¨çº¿</span><br><span class="line"></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹å±æ€§</span></span><br><span class="line">- å·¥å…·ä½ç½®: è¯·æŒ‰ç…§å®é™…æƒ…å†µå¡«å†™ã€‚ </span><br><span class="line">  <span class="comment"># ä¾‹å¦‚, Docker é…ç½®ï¼Œåç§° Docker ï¼Œç›®å½• /var/run/docker.sock</span></span><br><span class="line">- ç¯å¢ƒå˜é‡:</span><br><span class="line">  <span class="comment"># ä¾‹å¦‚ï¼Œé”®å€¼å¯¹åˆ—è¡¨ï¼Œé”® name å€¼ weiyigeek</span></span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ href="https://img.weiyigeek.top/2023/1/20230202154237.png" target="_blank" title="WeiyiGeek.æ–°å»ºDocker-agentèŠ‚ç‚¹å›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2023/1/20230202154237.png" alt="WeiyiGeek.æ–°å»ºDocker-agentèŠ‚ç‚¹å›¾" title="" class=""></a>
                <p>WeiyiGeek.æ–°å»ºDocker-agentèŠ‚ç‚¹å›¾</p>
            </figure>
<p>æ¸©é¦¨æç¤º: åœ¨ç‚¹å‡»ä¿å­˜åï¼Œæˆ‘ä»¬å¯ä»¥ç‚¹å‡»æ­¤èŠ‚ç‚¹ï¼Œçœ‹åˆ°å…¶æç¤ºèŠ‚ç‚¹è¿æ¥Jenkinsçš„æ–¹å¼å¦‚ä¸‹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼1</span></span><br><span class="line">java -jar agent.jar -jnlpUrl http://192.168.12.107:30001/computer/docker%2Djenkins%2Djnlp/jenkins-agent.jnlp -secret b97b9d1e0cf083f9da5721caa6ebc63f6fe648375bd90cb2c2f484681d887bb7 -workDir <span class="string">"/home/jenkins/agent"</span></span><br><span class="line"></span><br><span class="line">java -Xms512m -Xmx1g -Xss1m  -jar /usr/<span class="built_in">local</span>/bin/agent.jar -jnlpUrl http://192.168.12.107:30001/computer/jenkinsAgentWork1/jenkins-agent.jnlp  -secret 2a789bbbd0193ef576e7b62eb2d205d1d024d0ea7b14f6f79f1cccdd6fb1ed20 -workDir <span class="string">"/home/jenkins/agent"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼2</span></span><br><span class="line"><span class="comment"># Run from agent command line, with the secret stored in a file:</span></span><br><span class="line"><span class="built_in">echo</span> b97b9d1e0cf083f9da5721caa6ebc63f6fe648375bd90cb2c2f484681d887bb7 &gt; secret-file</span><br><span class="line">java -jar agent.jar -jnlpUrl http://192.168.12.107:30001/computer/docker%2Djenkins%2Djnlp/jenkins-agent.jnlp -secret @secret-file -workDir <span class="string">"/home/jenkins/agent"</span></span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ href="https://img.weiyigeek.top/2023/1/20230206171800.png" target="_blank" title="WeiyiGeek.èŠ‚ç‚¹è¿æ¥Jenkinsçš„æ–¹å¼å›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2023/1/20230206171800.png" alt="WeiyiGeek.èŠ‚ç‚¹è¿æ¥Jenkinsçš„æ–¹å¼å›¾" title="" class=""></a>
                <p>WeiyiGeek.èŠ‚ç‚¹è¿æ¥Jenkinsçš„æ–¹å¼å›¾</p>
            </figure>
<p><br/></p>
<h3 id="3-è‡ªè¡Œæ„å»ºJenkins-Agenté•œåƒ-å¹²è´§"><a href="#3-è‡ªè¡Œæ„å»ºJenkins-Agenté•œåƒ-å¹²è´§" class="headerlink" title="3.è‡ªè¡Œæ„å»ºJenkins Agenté•œåƒ(å¹²è´§)"></a>3.è‡ªè¡Œæ„å»ºJenkins Agenté•œåƒ(å¹²è´§)</h3><p>æè¿°: åœ¨<code>WeiyiGeek</code>å¾®ä¿¡å…¬ä¼—å·å›å¤<code>20230206</code>å…³é”®å­—ï¼Œå³å¯è·å–æœ€æ–°Jenkins-jnlpé•œåƒæ„å»ºçš„DockerfileåŠä¸‹è¿°ç›¸å…³è„šæœ¬æ–‡ä»¶ï¼Œæ­¤å¤„æˆ‘ä»¬è‡ªå®šä¹‰çš„jnlpå®¹å™¨é•œåƒä¸»è¦å®ç°åŠŸèƒ½å¦‚ä¸‹: </p>
<ul>
<li>ç”¨æˆ·æƒé™æ§åˆ¶(sudo)</li>
<li>ssh è¿œç¨‹è¿æ¥</li>
<li>git ä»£ç ç‰ˆæœ¬æ§åˆ¶</li>
<li>docker å®¹å™¨ç®¡ç†</li>
<li>kubectl é›†ç¾¤ç®¡ç†</li>
<li>Java è¿è¡Œç¯å¢ƒ</li>
<li>Maven è¿è¡Œç¯å¢ƒ</li>
<li>NodeJS ç¯å¢ƒ</li>
<li>SonarQube æ‰«æç¯å¢ƒ</li>
<li>Gitlab-Release ä¸Šä¼ ç¯å¢ƒ</li>
<li>ä¸­æ–‡ç¯å¢ƒæ”¯æŒ</li>
<li>æ—¶åŒºæ›´æ”¹é…ç½®</li>
<li>è‡ªå®šä¹‰å·¥ä½œç›®å½•ï¼ˆ/home/jenkins/agentï¼‰</li>
</ul>
<p>æ¸©é¦¨æç¤º: å¦‚ä¸‹æ“ä½œæ„å»ºä¾èµ–äºDockerç¯å¢ƒ,è‹¥ä½ æ²¡æœ‰å®‰è£…Dockerç¯å¢ƒæˆ–è€…ä¸äº†è§£çš„Dockerå®¹å™¨çš„æœ‹å‹ï¼Œå¯ä»¥å‚è€ƒåšä¸»å­¦ä¹ ã€Dockerçš„ç³»åˆ—ç¬”è®°ã€‘æ±‡æ€»ï¼Œå…³æ³¨ <code>WeiyiGeek</code> å…¬ä¼—å·å›å¤ã€<code>Dockerå®¹å™¨å­¦ä¹ ä¹‹è·¯æ±‡æ€»</code>ã€‘å³å¯è·å¾—å­¦ä¹ èµ„æ–™ï¼š</p>
<p><br/></p>
<p><strong>æ„å»ºç›®å½•</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">~/k8s/jenkins/jnlp-slave$ tree .</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ agent.jar  <span class="comment"># Jenkins -&gt; 2.330</span></span><br><span class="line">â”œâ”€â”€ agent.jar.bak</span><br><span class="line">â”œâ”€â”€ apache-maven-3.8.4-bin.tar.gz</span><br><span class="line">â”œâ”€â”€ build</span><br><span class="line">â”‚Â Â  â””â”€â”€ Dockerfile</span><br><span class="line">â”œâ”€â”€ docker</span><br><span class="line">â”œâ”€â”€ glibc-2.32-r0.apk</span><br><span class="line">â”œâ”€â”€ glibc-bin-2.32-r0.apk</span><br><span class="line">â”œâ”€â”€ glibc-i18n-2.32-r0.apk</span><br><span class="line">â”œâ”€â”€ jdk-8u281-linux-x64.tar.gz</span><br><span class="line">â”œâ”€â”€ jenkins-agent.sh</span><br><span class="line">â”œâ”€â”€ kubectl</span><br><span class="line">â”œâ”€â”€ locale.md</span><br><span class="line">â”œâ”€â”€ release-cli-0.10.0-linux-amd64</span><br><span class="line">â”œâ”€â”€ remoting-4.11.2.jar</span><br><span class="line">â”œâ”€â”€ sgerrand.rsa.pub</span><br><span class="line">â””â”€â”€ sonar-scanner-cli-4.5.0.2216-linux.zip</span><br><span class="line"></span><br><span class="line">1 directory, 16 files</span><br></pre></td></tr></table></figure></p>
<p>æ¸©é¦¨æç¤º:  åœ¨Jenkins 2.330ç‰ˆæœ¬ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹, å³å¯è·å–åŒ¹é…å½“å‰ç‰ˆæœ¬çš„ agent.jar (<a href="http://youjenkins-domainname-or-ip/jnlpJars/agent.jar)" target="_blank" rel="noopener">http://youjenkins-domainname-or-ip/jnlpJars/agent.jar)</a>, æˆ–è€…æ˜¯åœ¨ jenkins å®˜ç½‘ <a href="https://repo.jenkins-ci.org/public/org/jenkins-ci/main/remoting" target="_blank" rel="noopener">https://repo.jenkins-ci.org/public/org/jenkins-ci/main/remoting</a> è¿›è¡Œä¸‹è½½;</p>
<p><br/></p>
<p><strong>è‡ªå®šä¹‰jnlpé•œåƒçš„ Dockerfile</strong><br>åšä¸»è‡ªå®šä¹‰jnlpé•œåƒhubåœ°å€: <a href="https://hub.docker.com/r/weiyigeek/alpine-jenkins-jnlp" target="_blank" rel="noopener">https://hub.docker.com/r/weiyigeek/alpine-jenkins-jnlp</a> ã€‚</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">$ cat build/Dockerfile</span><br><span class="line"><span class="comment">#----------------------------------------------------------------------#</span></span><br><span class="line"><span class="comment"># Title: Base in Alpine Images Create Custom Jenkins Kubernetes jnlp Images</span></span><br><span class="line"><span class="comment"># Author: WeiyiGeek</span></span><br><span class="line"><span class="comment"># WebSite: https://weiyigeek.top</span></span><br><span class="line"><span class="comment"># Email: mastr@weiyigeek.top</span></span><br><span class="line"><span class="comment"># Version: v1.12</span></span><br><span class="line"><span class="comment"># Image Version: alpine-3.13.1</span></span><br><span class="line"><span class="comment"># MainFunction:</span></span><br><span class="line"><span class="comment">#   Install ssh-server docker git openssh tzdata curl tar sudo git ca-certificates wget unzip docker zlib nodejs npm jq</span></span><br><span class="line"><span class="comment">#   Install JDK8 Version: 1.8.0_281</span></span><br><span class="line"><span class="comment">#   - https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html</span></span><br><span class="line"><span class="comment">#   - https://github.com/sgerrand/alpine-pkg-glibc/releases/</span></span><br><span class="line"><span class="comment">#   - https://alpine-pkgs.sgerrand.com/sgerrand.rsa.pub</span></span><br><span class="line"><span class="comment">#   Install jnlp Version: 4.11.2 (ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥ä¸‹è½½agent)</span></span><br><span class="line"><span class="comment">#   - https://repo.jenkins-ci.org/public/org/jenkins-ci/main/remoting/</span></span><br><span class="line"><span class="comment">#   - http://youjenkins-domainname/jnlpJars/agent.jar</span></span><br><span class="line"><span class="comment">#   Install Maven Version: 3.8.4</span></span><br><span class="line"><span class="comment">#   - https://apache.osuosl.org/maven/maven-3/$&#123;MAVEN_VERSION&#125;/binaries</span></span><br><span class="line"><span class="comment">#   Install SonarqubeScan Version: 4.5.0</span></span><br><span class="line"><span class="comment">#   - https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.5.0.2216-linux.zip</span></span><br><span class="line"><span class="comment">#   Install Gitlab Release Version: 0.10.0</span></span><br><span class="line"><span class="comment">#   - https://gitlab.com/gitlab-org/release-cli/-/releases</span></span><br><span class="line"><span class="comment">#   Install kubernetes cli</span></span><br><span class="line"><span class="comment">#   - kubectl Version: 1.23.1</span></span><br><span class="line"><span class="comment">#   Install docker cli</span></span><br><span class="line"><span class="comment">#   - kubectl Version: 20.10.3</span></span><br><span class="line"><span class="comment"># ChangeLog:</span></span><br><span class="line"><span class="comment"># v1.8  - å¢åŠ  docker</span></span><br><span class="line"><span class="comment"># v1.9  - å¢åŠ  ä¸­æ–‡ç¯å¢ƒ</span></span><br><span class="line"><span class="comment"># v1.10 - å¢åŠ  node.js ç¯å¢ƒæ”¯æŒ</span></span><br><span class="line"><span class="comment"># v1.11 - æ›´æ–°ä¾èµ–è½¯ä»¶ç‰ˆæœ¬åŠå…¶agent.jarç‰ˆæœ¬</span></span><br><span class="line"><span class="comment">#-------------------------------------------------#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> alpine:<span class="number">3.13</span>.<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">MAINTAINER</span>  Jenkins Custom Work Node Jnlp Container - &lt;master@weiyigeek.top&gt; - WeiyiGeek</span><br><span class="line"></span><br><span class="line"><span class="keyword">ARG</span> USERNAME=jenkins \</span><br><span class="line">    AGENT_WORKDIR=/home/jenkins \</span><br><span class="line">    BASE_DIR=/usr/local  \</span><br><span class="line">    BASE_BIN=/usr/local/bin  \</span><br><span class="line">    BASE_URL=http://<span class="number">192.168</span>.<span class="number">12.107</span>:<span class="number">8080</span>  \</span><br><span class="line">    LOCALE=locale.md \</span><br><span class="line">    JDK_NAME=jdk-<span class="number">8</span>u281-linux-x64   \</span><br><span class="line">    JDK_DIR=/usr/local/jdk1.<span class="number">8.0</span>_281  \</span><br><span class="line">    GLIBC_NAME=glibc-<span class="number">2.32</span>-r0.apk \</span><br><span class="line">    GLIBC_BIN_NAME=glibc-bin-<span class="number">2.32</span>-r0.apk \</span><br><span class="line">    GLIBC_I18N_NAME=glibc-i18n-<span class="number">2.32</span>-r0.apk \</span><br><span class="line">    MAVEN_NAME=apache-maven-<span class="number">3.8</span>.<span class="number">4</span>-bin \</span><br><span class="line">    MAVEN_DIR=/usr/local/apache-maven-<span class="number">3.8</span>.<span class="number">4</span> \</span><br><span class="line">    SONAR_SCANNER_NAME=sonar-scanner-cli-<span class="number">4.5</span>.<span class="number">0.2216</span>-linux \</span><br><span class="line">    SONAR_SCANNER_DIR=/usr/local/sonar-scanner-<span class="number">4.5</span>.<span class="number">0.2216</span>-linux \</span><br><span class="line">    GITLAB_CLI=release-cli-<span class="number">0.10</span>.<span class="number">0</span>-linux-amd64</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> LANG=en_US.UTF-<span class="number">8</span> \</span><br><span class="line">    LC_ALL=en_US.UTF-<span class="number">8</span> \</span><br><span class="line">    JAVA_HOME=/usr/local/jdk8  \</span><br><span class="line">    JRE_HOME=/usr/local/jdk8/jre \</span><br><span class="line">    MAVEN_HOME=/usr/local/maven \</span><br><span class="line">    MAVEN_RPEO=/home/jenkins/.m2 \</span><br><span class="line">    SONAR_SCANNER_HOME=/usr/local/sonar-scanner \</span><br><span class="line">    NODEJS_MODULES=/usr/lib/node_modules</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨æˆ·ROOTåˆ‡æ¢</span></span><br><span class="line"><span class="keyword">USER</span> root</span><br><span class="line"></span><br><span class="line"><span class="comment"># Shell å‘½ä»¤ - æ­¤ç§æ–¹å¼æå¤§å‡å°‘äº†æ„å»ºçš„é•œåƒå¤§å°;</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> sed -i <span class="string">'s/dl-cdn.alpinelinux.org/mirror.tuna.tsinghua.edu.cn/g'</span> /etc/apk/repositories \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apk update \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apk add --no-cache openssh tzdata curl tar sudo git ca-certificates wget unzip docker zlib nodejs npm jq \</span></span><br><span class="line"><span class="bash">    &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \</span></span><br><span class="line"><span class="bash">    &amp;&amp; chmod 4755 /bin/busybox \</span></span><br><span class="line"><span class="bash">    &amp;&amp; addgroup -g 1000 -S <span class="variable">$&#123;USERNAME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; adduser <span class="variable">$&#123;USERNAME&#125;</span> -D -g <span class="variable">$&#123;USERNAME&#125;</span> -G root -u 1000 -s /bin/sh \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">echo</span> <span class="string">"jenkins   ALL=(root) NOPASSWD:ALL"</span> &gt;&gt; /etc/sudoers \</span></span><br><span class="line"><span class="bash">    &amp;&amp; mkdir -p <span class="variable">$&#123;AGENT_WORKDIR&#125;</span>/.ssh <span class="variable">$&#123;AGENT_WORKDIR&#125;</span>/.m2 <span class="variable">$&#123;AGENT_WORKDIR&#125;</span>/agent\</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O /tmp/<span class="variable">$&#123;GLIBC_NAME&#125;</span> <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;GLIBC_NAME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O /tmp/<span class="variable">$&#123;GLIBC_BIN_NAME&#125;</span> <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;GLIBC_BIN_NAME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O /tmp/<span class="variable">$&#123;GLIBC_I18N_NAME&#125;</span> <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;GLIBC_I18N_NAME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O /etc/apk/keys/sgerrand.rsa.pub <span class="variable">$&#123;BASE_URL&#125;</span>/sgerrand.rsa.pub \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O /tmp/<span class="variable">$&#123;LOCALE&#125;</span> <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;LOCALE&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O /tmp/<span class="variable">$&#123;JDK_NAME&#125;</span>.tar.gz <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;JDK_NAME&#125;</span>.tar.gz \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q -O <span class="variable">$&#123;BASE_BIN&#125;</span>/agent.jar <span class="variable">$&#123;BASE_URL&#125;</span>/agent.jar \</span></span><br><span class="line"><span class="bash">    &amp;&amp; curl -fsSL -o <span class="variable">$&#123;BASE_BIN&#125;</span>/jenkins-agent.sh <span class="variable">$&#123;BASE_URL&#125;</span>/jenkins-agent.sh \</span></span><br><span class="line"><span class="bash">    &amp;&amp; curl -fsSL -o /tmp/<span class="variable">$&#123;MAVEN_NAME&#125;</span>.tar.gz <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;MAVEN_NAME&#125;</span>.tar.gz \</span></span><br><span class="line"><span class="bash">    &amp;&amp; curl -fsSL -o /tmp/<span class="variable">$&#123;SONAR_SCANNER_NAME&#125;</span>.zip <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;SONAR_SCANNER_NAME&#125;</span>.zip \</span></span><br><span class="line"><span class="bash">    &amp;&amp; curl -fsSL -o /usr/<span class="built_in">local</span>/bin/release-cli <span class="variable">$&#123;BASE_URL&#125;</span>/<span class="variable">$&#123;GITLAB_CLI&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; curl -fsSL -o /usr/<span class="built_in">local</span>/bin/kubectl <span class="variable">$&#123;BASE_URL&#125;</span>/kubectl \</span></span><br><span class="line"><span class="bash">    &amp;&amp; curl -fsSL -o /usr/<span class="built_in">local</span>/bin/docker <span class="variable">$&#123;BASE_URL&#125;</span>/docker \</span></span><br><span class="line"><span class="bash">    &amp;&amp; sed -i <span class="string">"s/#PermitRootLogin.*/PermitRootLogin yes/g"</span> /etc/ssh/sshd_config \</span></span><br><span class="line"><span class="bash">    &amp;&amp; sed -i <span class="string">"s/^#\s*StrictHostKeyChecking ask/StrictHostKeyChecking no/g"</span> /etc/ssh/ssh_config \</span></span><br><span class="line"><span class="bash">    &amp;&amp; ssh-keygen -t dsa -P <span class="string">""</span> -f /etc/ssh/ssh_host_dsa_key \</span></span><br><span class="line"><span class="bash">    &amp;&amp; ssh-keygen -t rsa -P <span class="string">""</span> -f /etc/ssh/ssh_host_rsa_key \</span></span><br><span class="line"><span class="bash">    &amp;&amp; ssh-keygen -t ecdsa -P <span class="string">""</span> -f /etc/ssh/ssh_host_ecdsa_key \</span></span><br><span class="line"><span class="bash">    &amp;&amp; ssh-keygen -t ed25519 -P <span class="string">""</span> -f /etc/ssh/ssh_host_ed25519_key \</span></span><br><span class="line"><span class="bash">    &amp;&amp; ssh-keygen -t ed25519 -P <span class="string">""</span> -C <span class="string">"master@weiyigeek.top"</span> -f /home/jenkins/.ssh/id_ed25519 \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apk add /tmp/<span class="variable">$&#123;GLIBC_NAME&#125;</span> /tmp/<span class="variable">$&#123;GLIBC_BIN_NAME&#125;</span> /tmp/<span class="variable">$&#123;GLIBC_I18N_NAME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; tar -zxf /tmp/<span class="variable">$&#123;JDK_NAME&#125;</span>.tar.gz -C <span class="variable">$&#123;BASE_DIR&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; mv <span class="variable">$&#123;JDK_DIR&#125;</span> <span class="variable">$&#123;JAVA_HOME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; tar -zxf /tmp/<span class="variable">$&#123;MAVEN_NAME&#125;</span>.tar.gz -C <span class="variable">$&#123;BASE_DIR&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; mv <span class="variable">$&#123;MAVEN_DIR&#125;</span> <span class="variable">$&#123;MAVEN_HOME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; unzip /tmp/<span class="variable">$&#123;SONAR_SCANNER_NAME&#125;</span>.zip -d <span class="variable">$&#123;BASE_DIR&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; mv <span class="variable">$&#123;SONAR_SCANNER_DIR&#125;</span> <span class="variable">$&#123;SONAR_SCANNER_HOME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org \</span></span><br><span class="line"><span class="bash">    &amp;&amp; chmod a+x <span class="variable">$&#123;BASE_BIN&#125;</span>/* \</span></span><br><span class="line"><span class="bash">    &amp;&amp; chown -R jenkins:jenkins <span class="variable">$&#123;BASE_DIR&#125;</span>/ <span class="variable">$&#123;AGENT_WORKDIR&#125;</span>/ <span class="variable">$&#123;NODEJS_MODULES&#125;</span>/ \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">echo</span> <span class="string">"root:WeiyiGeek"</span> | chpasswd \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">echo</span> <span class="string">"jenkins:WeiyiGeek"</span> | chpasswd \</span></span><br><span class="line"><span class="bash">    &amp;&amp; cat /tmp/<span class="variable">$&#123;LOCALE&#125;</span> | xargs -i /usr/glibc-compat/bin/localedef -i &#123;&#125; -f UTF-8 &#123;&#125;.UTF-8 \</span></span><br><span class="line"><span class="bash">    &amp;&amp; sed -i <span class="string">"s#use_embedded_jre=true#use_embedded_jre=false#g"</span> <span class="variable">$&#123;SONAR_SCANNER_HOME&#125;</span>/bin/sonar-scanner \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /var/cache/apk/* /tmp/* <span class="variable">$&#123;SONAR_SCANNER_HOME&#125;</span>/jre/* \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">cd</span> <span class="variable">$&#123;JAVA_HOME&#125;</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf COPYRIGHT LICENSE README release THIRDPARTYLICENSEREADME-JAVAFX.txt THIRDPARTYLICENSEREADME.txt Welcome.html  javafx-src.zip src.zip \</span></span><br><span class="line"><span class="bash">    lib/plugin.jar \</span></span><br><span class="line"><span class="bash">    lib/ext/jfxrt.jar \</span></span><br><span class="line"><span class="bash">    bin/javaws \</span></span><br><span class="line"><span class="bash">    lib/javaws.jar \</span></span><br><span class="line"><span class="bash">    lib/desktop \</span></span><br><span class="line"><span class="bash">    plugin \</span></span><br><span class="line"><span class="bash">    lib/deploy* \</span></span><br><span class="line"><span class="bash">    lib/*javafx* \</span></span><br><span class="line"><span class="bash">    lib/*jfx* \</span></span><br><span class="line"><span class="bash">    lib/amd64/libdecora_sse.so \</span></span><br><span class="line"><span class="bash">    lib/amd64/libprism_*.so \</span></span><br><span class="line"><span class="bash">    lib/amd64/libfxplugins.so \</span></span><br><span class="line"><span class="bash">    lib/amd64/libglass.so \</span></span><br><span class="line"><span class="bash">    lib/amd64/libgstreamer-lite.so \</span></span><br><span class="line"><span class="bash">    lib/amd64/libjavafx*.so \</span></span><br><span class="line"><span class="bash">    lib/amd64/libjfx*.so \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">echo</span> <span class="string">"export LANG=zh_CN.UTF-8"</span> &gt; /etc/profile.d/locale.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USER</span> jenkins</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> <span class="variable">$&#123;AGENT_WORKDIR&#125;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib/dt.jar:$&#123;JAVA_HOME&#125;/lib/tools.jar \</span><br><span class="line">    PATH=$&#123;JAVA_HOME&#125;/bin:$&#123;MAVEN_HOME&#125;/bin:$&#123;SONAR_SCANNER_HOME&#125;/bin:$PATH</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"/usr/local/bin/jenkins-agent.sh"</span>]</span></span><br></pre></td></tr></table></figure>
<p><br/></p>
<p><strong>é•œåƒæ„å»ºæ“ä½œ</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (0) å¯åŠ¨ä¸€ä¸ªä¸´æ—¶çš„webæœåŠ¡å™¨ï¼ˆ`å­˜æ”¾ä¸Šé¢çš„é•œåƒæ„å»ºæ‰€éœ€è½¯ä»¶`-éå¸¸é‡è¦-å¦åˆ™å°†ä¼šå¯¼è‡´æ„å»ºå¤±è´¥ï¼‰</span></span><br><span class="line">~/k8s/jenkins/jnlp-slave$ python3 -m http.server 8080</span><br><span class="line">Serving HTTP on 0.0.0.0 port 8080 (http://0.0.0.0:8080/) ...</span><br><span class="line"><span class="comment"># 172.17.0.4 - - [30/Mar/2021 17:32:00] "GET /glibc-2.32-r0.apk HTTP/1.1" 200 -</span></span><br><span class="line">...</span><br><span class="line"><span class="comment"># 172.17.0.4 - - [30/Mar/2021 17:32:00] "GET /kubectl HTTP/1.1" 200 -</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (1) é•œåƒæ„å»º (å»ºè®®ä¸€å®šè¦å¸¦ä¸Šæ„å»ºå¹³å°)</span></span><br><span class="line">docker build -t weiyigeek/alpine-jenkins-jnlp --platform linux/amd64 .</span><br><span class="line">  <span class="comment"># Sending build context to Docker daemon  25.09kB</span></span><br><span class="line">  <span class="comment"># Step 1/10 : FROM alpine:3.13.1</span></span><br><span class="line">  <span class="comment">#   ---&gt; e50c909a8df2</span></span><br><span class="line">  <span class="comment"># Step 2/10 : MAINTAINER  Jenkins Custom Work Node Jnlp Container - &lt;master@weiyigeek.top&gt; - WeiyiGeek</span></span><br><span class="line">  <span class="comment"># ....................................................................................................</span></span><br><span class="line">  <span class="comment"># Step 10/10 : ENTRYPOINT ["/usr/local/bin/jenkins-agent.sh"]</span></span><br><span class="line">  <span class="comment">#   ---&gt; Running in 1869aaba6a4e</span></span><br><span class="line">  <span class="comment"># Removing intermediate container 1869aaba6a4e</span></span><br><span class="line">  <span class="comment">#   ---&gt; 0dfabb8ae0ee</span></span><br><span class="line">  <span class="comment"># Successfully built 0dfabb8ae0ee</span></span><br><span class="line">  <span class="comment"># Successfully tagged weiyigeek/alpine-jenkins-jnlp:latest</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æŸ¥çœ‹æ„å»ºä¿¡æ¯</span></span><br><span class="line">docker images weiyigeek/alpine-jenkins-jnlp --all</span><br><span class="line">  <span class="comment"># REPOSITORY                                 TAG             IMAGE ID       CREATED             SIZE</span></span><br><span class="line">  <span class="comment"># harbor.weiyigeek.top/devops/jenkins-jnlp   3.13.1-alpine   b47b6581b712   About an hour ago   715MB</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) æ¨é€é•œåƒåˆ°Docker HUBä¸­</span></span><br><span class="line">docker push weiyigeek/alpine-jenkins-jnlp</span><br><span class="line">  <span class="comment"># The push refers to repository [harbor.weiyigeek.top/devops/jenkins-jnlp]</span></span><br><span class="line">  <span class="comment"># 059ea3fbd3b3: Pushed</span></span><br><span class="line">  <span class="comment"># 1119ff37d4a9: Layer already exists</span></span><br><span class="line">  <span class="comment"># 3.13.1-alpine: digest: sha256:1f869c553340c9399c7db9072169600a17ddb0ec41d41d3a4365b8c1571fc201 size: 741</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) å®Œæ¯•åä¾¿å¯é‡‡ç”¨Ansibleå„èŠ‚ç‚¹æ‹‰å–é•œåƒï¼ˆè‹¥æ²¡æœ‰å®‰è£…ansibleçš„æœ‹å‹è¯·è‡ªè¡Œsshç™»å½•ï¼‰</span></span><br><span class="line">ansible node -m shell -a <span class="string">"docker pull weiyigeek/alpine-jenkins-jnlp"</span></span><br></pre></td></tr></table></figure></p>
<p>è‡³æ­¤ï¼ŒJenkins Agent é•œåƒæ„å»ºå®Œæ¯•!</p>
<hr>
<h2 id="0x02-é¡¹ç›®å®è·µ"><a href="#0x02-é¡¹ç›®å®è·µ" class="headerlink" title="0x02 é¡¹ç›®å®è·µ"></a>0x02 é¡¹ç›®å®è·µ</h2><h3 id="1-ä½¿ç”¨åœ¨K8Séƒ¨ç½²çš„Jenkinsè¿æ¥Dockerå®¹å™¨ä¸­è¿è¡Œçš„Agentåˆ†å¸ƒå¼èŠ‚ç‚¹-ç¼ºçœç«¯å£-50000"><a href="#1-ä½¿ç”¨åœ¨K8Séƒ¨ç½²çš„Jenkinsè¿æ¥Dockerå®¹å™¨ä¸­è¿è¡Œçš„Agentåˆ†å¸ƒå¼èŠ‚ç‚¹-ç¼ºçœç«¯å£-50000" class="headerlink" title="1.ä½¿ç”¨åœ¨K8Séƒ¨ç½²çš„Jenkinsè¿æ¥Dockerå®¹å™¨ä¸­è¿è¡Œçš„Agentåˆ†å¸ƒå¼èŠ‚ç‚¹ (ç¼ºçœç«¯å£:50000)"></a>1.ä½¿ç”¨åœ¨K8Séƒ¨ç½²çš„Jenkinsè¿æ¥Dockerå®¹å™¨ä¸­è¿è¡Œçš„Agentåˆ†å¸ƒå¼èŠ‚ç‚¹ (ç¼ºçœç«¯å£:50000)</h3><p>æè¿°: ä»å‰é¢ç¯å¢ƒå¯çŸ¥ï¼Œæˆ‘å°†Jenkinså®‰è£…åœ¨Kubernetesé›†ç¾¤ä¹‹ä¸­äº†ï¼Œå¹¶ä¸”å°†Podä¸­çš„8080ç«¯å£æ˜ å°„åˆ°30001ç«¯å£ï¼Œè€Œagentç¼ºçœç«¯å£ä¸º50000ï¼Œåœ¨æ²¡æœ‰æ›´æ”¹çš„SVCæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼ä¸€ç§å°±æ˜¯ä½¿ç”¨<code>kubectl port-forward</code>è½¬å‘ï¼Œå¦å¤–ä¸€ç§æ˜¯åœ¨Jenkinsèµ„æºæ¸…å•ä¸­é…ç½® <code>hostNetwork: true</code>, æ­¤æ—¶è¿è¡Œjenkins Podçš„èŠ‚ç‚¹IP+50000ç«¯å£ä¾¿å¯ç›´æ¥è®¿é—®ã€‚</p>
<p>æ­¥éª¤ 01.é’ˆå¯¹ Jenkins è¿›è¡Œ inbound agents pod 50000 ç«¯å£è½¬å‘åˆ°192.168.12.107èŠ‚ç‚¹çš„50000ç«¯å£<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl -n devops port-forward --address 127.0.0.1,192.168.12.107 jenkins-7fc6f4fcf6-glqxj 50000:50000</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>æ­¥éª¤ 02.ç„¶ååœ¨å…¶ä»–æœ‰å®‰è£…Dockerçš„æœºå™¨èŠ‚ç‚¹ä¸Šè¿è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œjenkins jnlpå®¹å™¨çš„åˆ›å»ºï¼Œæ³¨æ„æ­¤å¤„ä¸ºäº†å¤šä¸ªagentæ„å»ºæ—¶mavenåŒ…çš„æ•°æ®å…±äº«ï¼Œä½¿ç”¨nfså…±äº«ç£ç›˜.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run --user jenkins -d --name jnlp \</span><br><span class="line">-e <span class="string">"JAVA_OPTS=-Xms512m -Xmx1g -Xss1m"</span> \</span><br><span class="line">-e <span class="string">"JENKINS_NAME=docker-jenkins-jnlp"</span> \</span><br><span class="line">-e <span class="string">"JENKINS_AGENT_NAME=docker-jenkins-jnlp"</span> \</span><br><span class="line">-e <span class="string">"JENKINS_SECRET=b97b9d1e0cf083f9da5721caa6ebc63f6fe648375bd90cb2c2f484681d887bb7"</span> \</span><br><span class="line">-e <span class="string">"JENKINS_AGENT_WORKDIR=/home/jenkins"</span> \</span><br><span class="line">-e <span class="string">"JENKINS_PURL=http://192.168.12.107:30001"</span>  \</span><br><span class="line">-w /home/jenkins \</span><br><span class="line">-v /nfsdisk-31/appstorage/mavenRepo:/home/jenkins/.m2 \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock weiyigeek/alpine-jenkins-jnlp:latest</span><br></pre></td></tr></table></figure><br>å‘½ä»¤æ‰§è¡Œè‹¥å‡ºç°<code>INFO: Connected</code>ç»“æœï¼Œåˆ™è¡¨ç¤ºè¿æ¥æˆåŠŸã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Java version: 1.8.0_281, vendor: Oracle Corporation, runtime: /usr/<span class="built_in">local</span>/jdk8/jre</span><br><span class="line">Default locale: en_US, platform encoding: UTF-8</span><br><span class="line">OS name: <span class="string">"linux"</span>, version: <span class="string">"5.4.0-137-generic"</span>, arch: <span class="string">"amd64"</span>, family: <span class="string">"unix"</span></span><br><span class="line">INFO: Scanner configuration file: /usr/<span class="built_in">local</span>/sonar-scanner/conf/sonar-scanner.properties</span><br><span class="line">INFO: Project root configuration file: NONE</span><br><span class="line">INFO: SonarScanner 4.5.0.2216</span><br><span class="line">INFO: Java 1.8.0_281 Oracle Corporation (64-bit)</span><br><span class="line">INFO: Linux 5.4.0-137-generic amd64</span><br><span class="line">Feb 04, 2023 10:51:19 PM hudson.remoting.jnlp.Main createEngine</span><br><span class="line">INFO: Setting up agent: docker-jenkins-jnlp</span><br><span class="line">Feb 04, 2023 10:51:19 PM hudson.remoting.jnlp.Main<span class="variable">$CuiListener</span> &lt;init&gt;</span><br><span class="line">INFO: Jenkins agent is running <span class="keyword">in</span> headless mode.</span><br><span class="line">Feb 04, 2023 10:51:19 PM hudson.remoting.Engine startEngine</span><br><span class="line">INFO: Using Remoting version: 4.11.2</span><br><span class="line">Feb 04, 2023 10:51:19 PM org.jenkinsci.remoting.engine.WorkDirManager initializeWorkDir</span><br><span class="line">INFO: Using /home/jenkins/remoting as a remoting work directory</span><br><span class="line">Feb 04, 2023 10:51:19 PM org.jenkinsci.remoting.engine.WorkDirManager setupLogging</span><br><span class="line">INFO: Both error and output logs will be printed to /home/jenkins/remoting</span><br><span class="line">Feb 04, 2023 10:51:19 PM hudson.remoting.jnlp.Main<span class="variable">$CuiListener</span> status</span><br><span class="line">INFO: Locating server among []</span><br><span class="line">Feb 04, 2023 10:51:19 PM hudson.remoting.jnlp.Main<span class="variable">$CuiListener</span> status</span><br><span class="line">INFO: Agent discovery successful</span><br><span class="line">  Agent address: 192.168.12.107</span><br><span class="line">  Agent port:    50000</span><br><span class="line">  Identity:      8e:c7:1e:e1:39:ee:f4:2a:43:f6:aa:d9:0e:b7:b6:62</span><br><span class="line">.....</span><br><span class="line">INFO: Connected</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ href="https://img.weiyigeek.top/2023/1/20230202145941.png" target="_blank" title="WeiyiGeek.åœ¨Dockerä¸­è¿è¡Œjenkins-jnlpç»“æœå›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2023/1/20230202145941.png" alt="WeiyiGeek.åœ¨Dockerä¸­è¿è¡Œjenkins-jnlpç»“æœå›¾" title="" class=""></a>
                <p>WeiyiGeek.åœ¨Dockerä¸­è¿è¡Œjenkins-jnlpç»“æœå›¾</p>
            </figure>
<p><br/></p>
<p>æ­¥éª¤ 03.å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡ç‚¹å‡» Jenkins Dashboard -&gt; èŠ‚ç‚¹åˆ—è¡¨ -&gt; docker-jenkins-jnlp æŸ¥çœ‹åˆ›å»ºçš„èŠ‚ç‚¹å·²ç»æ˜¯è¿è¡ŒçŠ¶æ€äº†ã€‚</p>
<figure class="image-box">
                <a rel=9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ href="https://img.weiyigeek.top/2023/1/20230202150507.png" target="_blank" title="WeiyiGeek.jenkinsä¸­jnlpèŠ‚ç‚¹agentçŠ¶æ€å›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2023/1/20230202150507.png" alt="WeiyiGeek.jenkinsä¸­jnlpèŠ‚ç‚¹agentçŠ¶æ€å›¾" title="" class=""></a>
                <p>WeiyiGeek.jenkinsä¸­jnlpèŠ‚ç‚¹agentçŠ¶æ€å›¾</p>
            </figure>
<p>æ¸©é¦¨æç¤ºï¼šæ­¤å¤„åªæ˜¯æ¶‰åŠjenkins agentèŠ‚ç‚¹çš„é…ç½®è¿æ¥ï¼Œè‹¥éœ€è¦è¿›è¡Œè°ƒç”¨æ‰§è¡ŒæŸä¸€ä¸ªé¡¹ç›®çš„CICDï¼Œè¯·ç»§ç»­å¾€ä¸‹çœ‹ã€‚</p>
<p><br/></p>
<h3 id="2-ä½¿ç”¨åœ¨K8Séƒ¨ç½²çš„Jenkinsè¿æ¥Dockerå®¹å™¨ä¸­è¿è¡Œçš„è‡ªå®šä¹‰Agentç«¯å£èŠ‚ç‚¹-ç›´è¿æ–¹å¼"><a href="#2-ä½¿ç”¨åœ¨K8Séƒ¨ç½²çš„Jenkinsè¿æ¥Dockerå®¹å™¨ä¸­è¿è¡Œçš„è‡ªå®šä¹‰Agentç«¯å£èŠ‚ç‚¹-ç›´è¿æ–¹å¼" class="headerlink" title="2.ä½¿ç”¨åœ¨K8Séƒ¨ç½²çš„Jenkinsè¿æ¥Dockerå®¹å™¨ä¸­è¿è¡Œçš„è‡ªå®šä¹‰Agentç«¯å£èŠ‚ç‚¹ (ç›´è¿æ–¹å¼)"></a>2.ä½¿ç”¨åœ¨K8Séƒ¨ç½²çš„Jenkinsè¿æ¥Dockerå®¹å™¨ä¸­è¿è¡Œçš„è‡ªå®šä¹‰Agentç«¯å£èŠ‚ç‚¹ (ç›´è¿æ–¹å¼)</h3><p>æè¿°: ç”±äºæˆ‘ä»¬æ›´æ”¹Jenkinsä¸­çš„agent TCP ç«¯å£ä»¥åŠåœ¨K8Sé›†ç¾¤ä¸­ä¹Ÿä½œå‡ºäº†ç›¸åº”æ›´æ”¹ï¼Œä½†æ˜¯è¿æ¥æ—¶éœ€è¦æŒ‡å®šæ›´å¤šçš„å‚æ•°ï¼Œä¾‹å¦‚ï¼ˆJENKINS_DIRECT_CONNECTIONä¸JENKINS_INSTANCE_IDENTITYï¼‰ï¼Œè¿™é‡Œé¢çš„å‘è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œä¸ºå•¥è¯´å‘å¤§è¯·çœ‹å‹ç»§ç»­çœ‹ã€‚</p>
<blockquote>
<p>JENKINS_DIRECT_CONNECTION : Connect directly to this TCP agent port, skipping the HTTP(S) connection parameter download. Value: â€œ<HOST>:<PORT>â€œ<br>JENKINS_INSTANCE_IDENTITY : The base64 encoded InstanceIdentity byte array of the Jenkins master. When this is set,the agent skips connecting to an HTTP(S) port for connection info.</p>
</blockquote>
<p>æ­¥éª¤ 00.å‰ç½®å‡†å¤‡ï¼Œé€šè¿‡å‰é¢æ‰€éœ€å‚æ•°å¯çŸ¥ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šè¦ç›´è¿çš„jenkins agentæœåŠ¡çš„IPä»¥åŠç«¯å£ ï¼ˆä¾‹å¦‚: 192.168.12.107:30634ï¼‰ï¼Œå’Œ  jenkins Instance Identityå€¼ï¼ˆæ­¤å¤„å€¼å¾—æ³¨æ„ï¼‰ã€‚</p>
<p>æœ€å¼€å§‹ï¼ŒJENKINS_INSTANCE_IDENTITY å…¶å€¼æˆ‘è®¤ä¸ºæ˜¯ Jenkins å®¶ç›®å½•ä¸­ secrets ä¸‹çš„ master.key çš„ base64 ç¼–ç ï¼Œä½†æ˜¯æ€ä¹ˆè¿æ¥éƒ½æ˜¯ä¸æ­£ç¡®çš„ï¼Œéšåæ²¡å¾—åŠæ³•åªèƒ½æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£ï¼ŒåŠŸå¤«ä¸è´Ÿæœ‰å¿ƒäººï¼Œåœ¨ jenkinsci çš„ remoting é¡¹ç›®ä¸‹æ‰¾åˆ°äº†ä¸€ä¸ªissueï¼Œç„¶åé¡ºè…¾æ‘¸ç“œæ‰¾åˆ°äº†è¯¥å€¼ã€‚</p>
<blockquote>
<p>Issue: <a href="https://github.com/jenkinsci/remoting/pull/338/files/07d7fd668b17123afd9ef7ac7a859bdda151f5cf#diff-8f973eec7a7bc04d532ba6b42015c903d7100b09f8ed655367d0fe893a9b6d0a" target="_blank" rel="noopener">https://github.com/jenkinsci/remoting/pull/338/files/07d7fd668b17123afd9ef7ac7a859bdda151f5cf#diff-8f973eec7a7bc04d532ba6b42015c903d7100b09f8ed655367d0fe893a9b6d0a</a><br>Document: <a href="https://wiki.jenkins.io/display/JENKINS/Instance+Identity" target="_blank" rel="noopener">https://wiki.jenkins.io/display/JENKINS/Instance+Identity</a></p>
</blockquote>
<figure class="image-box">
                <a rel=9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ href="https://img.weiyigeek.top/2023/1/20230206171322.png" target="_blank" title="WeiyiGeek.JENKINS-53461 Direct inbound TCP agent connection å›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2023/1/20230206171322.png" alt="WeiyiGeek.JENKINS-53461 Direct inbound TCP agent connection å›¾" title="" class=""></a>
                <p>WeiyiGeek.JENKINS-53461 Direct inbound TCP agent connection å›¾</p>
            </figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Jenkins : Instance Identity</span><br><span class="line">Created by Unknown User (kohsuke), last modified by Unknown User (songy) on Mar 26, 2015</span><br><span class="line">Each Jenkins instance maintains an RSA private/public key pair that can be used to uniquely identify Jenkins. This information is called <span class="string">"instance identity"</span>.</span><br><span class="line"></span><br><span class="line">From outside, the public key can be obtained by sending the GET request to the top page of Jenkins, and look <span class="keyword">for</span> the <span class="string">"X-Instance-Identity"</span> header <span class="keyword">in</span> the response. This header is always available, even <span class="keyword">if</span> the response is 401 access denied (<span class="built_in">which</span> can happen <span class="keyword">if</span> Jenkins is protected via security.) The value represents a base64-encoded ASN.1 DER serialization of X.509 SubjectPublicKeyInfo record.</span><br><span class="line"></span><br><span class="line">Plugins that run inside Jenkins can access this key pair programmatically through the org.jenkinsci.main.modules.instance_identity.InstanceIdentity class (add a provided scope dependency to this module into your plugin)</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°å¤§è‡´æ„æ€æ˜¯ï¼Œæ¯ä¸ªJenkinså®ä¾‹éƒ½ç»´æŠ¤ä¸€ä¸ªRSAç§é’¥/å…¬é’¥å¯¹ï¼Œå¯ç”¨äºå”¯ä¸€æ ‡è¯†Jenkinsï¼Œè¿™å°±æ˜¯å®ä¾‹æ ‡è¯†ï¼ˆinstance identityï¼‰ï¼Œè¯¥å€¼(å…¬é’¥)å¯ä»¥é€šè¿‡å°†GETè¯·æ±‚å‘é€åˆ°Jenkinsçš„é¦–é¡µæ¥è·å¾—ï¼Œå¹¶åœ¨å“åº”ä¸­æŸ¥æ‰¾â€œX-Instance-Identityâ€æ ‡å¤´ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Instance-Identity: MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIB******************1KQ5CLlISSjBaYrGqwsDThdDRbM6CjmP3UJ0NVhsMRJuQyAA2x4XktjEAYO3X0PWQIDAQAB</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ href="https://img.weiyigeek.top/2023/1/20230206171109.png" target="_blank" title="WeiyiGeek.è·å–X-Instance-Identityå›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2023/1/20230206171109.png" alt="WeiyiGeek.è·å–X-Instance-Identityå›¾" title="" class=""></a>
                <p>WeiyiGeek.è·å–X-Instance-Identityå›¾</p>
            </figure>
<p><br/></p>
<p>æ­¥éª¤ 01.è·å–åˆ°äº†X-Instance-Identityå€¼åï¼Œä¸€æ¡Dockerå‘½ä»¤åˆ›å»ºè¿è¡Œ jenkins agent å®¹å™¨è¿æ¥åˆ°Jenkinsä¹‹ä¸­<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run --user jenkins -d --name jnlp \</span><br><span class="line">-e <span class="string">"JAVA_OPTS=-Xms512m -Xmx1g -Xss1m"</span> \</span><br><span class="line">-e <span class="string">"JENKINS_NAME=docker-jenkins-jnlp"</span> \</span><br><span class="line">-e <span class="string">"JENKINS_AGENT_NAME=docker-jenkins-jnlp"</span> \</span><br><span class="line">-e <span class="string">"JENKINS_SECRET=b97b9d1e0cf083f9da5721caa6ebc63f6fe648375bd90cb2c2f484681d887bb7"</span> \</span><br><span class="line">-e <span class="string">"JENKINS_AGENT_WORKDIR=/home/jenkins"</span> \</span><br><span class="line">-e <span class="string">"JENKINS_DIRECT_CONNECTION=192.168.12.107:30634"</span> \</span><br><span class="line">-e <span class="string">"JENKINS_INSTANCE_IDENTITY=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAsFqtbTp5/xRS85YdURKk6Zc+qfl+RxrtnJ0zUXXLqXIa8S0MVk5U+xhu0Xo6Kz9MN/i7znfKpljk4/6+GphGFJbgGVw/1M2xbZjg7XN8QiXU64rlHC1NaGbKsa6R0PbWZEjbExR+sgTreiKwh08FcQemEDEajN5WihvvC0LmopYoSfHXW0fYMYIvVPO0Kow80MKoXighfhpK9msLWV4ay4ttP9zjBWml2gEeCXNjPQAt+r1l/kDT3c7vaIybzrxgRg2K9IVYmao/wemwDdpEP1KQ5CLlISSjBaYrGqwsDThdDRbM6CjmP3UJ0NVhsMRJuQyAA2x4XktjEAYO3X0PWQIDAQAB"</span> \</span><br><span class="line">-w /home/jenkins \</span><br><span class="line">-v /nfsdisk-31/appstorage/mavenRepo:/home/jenkins/.m2 \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock weiyigeek/alpine-jenkins-jnlp:latest</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>æ­¥éª¤ 02.æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨åŠå…¶ç»“æœï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨jenkins é¢æ¿ä¸Šçœ‹åˆ°è¿æ¥çš„èŠ‚ç‚¹ï¼Œå¦‚éœ€åˆ é™¤èŠ‚ç‚¹ç›´æ¥é€‰æ‹©å·¦è¾¹ï¼Œèœå•æ ä¸­åˆ é™¤èŠ‚ç‚¹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">~/k8s/jenkins/jnlp-slave$ docker ps</span><br><span class="line">  <span class="comment"># CONTAINER ID   IMAGE                                  COMMAND                  CREATED         STATUS        PORTS     NAMES</span></span><br><span class="line">  <span class="comment"># efb27bd9cb8e   weiyigeek/alpine-jenkins-jnlp:latest   "/usr/local/bin/jenkâ€¦"   3 seconds ago   Up 1 second             jnlp</span></span><br><span class="line"></span><br><span class="line">~/k8s/jenkins/jnlp-slave$ docker logs -f efb27bd9cb8e</span><br><span class="line">  <span class="comment"># INFO: Agent discovery successful</span></span><br><span class="line">  <span class="comment">#   Agent address: 192.168.12.107</span></span><br><span class="line">  <span class="comment">#   Agent port:    30634</span></span><br><span class="line">  <span class="comment">#   Identity:      8e:c7:1e:e1:39:ee:f4:2a:43:f6:aa:d9:0e:b7:b6:62</span></span><br><span class="line">  <span class="comment"># Feb 04, 2023 10:51:19 PM hudson.remoting.jnlp.Main$CuiListener status</span></span><br><span class="line">  <span class="comment"># INFO: Handshaking</span></span><br><span class="line">  <span class="comment"># Feb 04, 2023 10:51:19 PM hudson.remoting.jnlp.Main$CuiListener status</span></span><br><span class="line">  <span class="comment"># INFO: Connecting to 192.168.12.107:30634</span></span><br><span class="line">  <span class="comment"># Feb 04, 2023 10:51:19 PM hudson.remoting.jnlp.Main$CuiListener status</span></span><br><span class="line">  <span class="comment"># INFO: Trying protocol: JNLP4-connect</span></span><br><span class="line">  <span class="comment"># Feb 04, 2023 10:51:19 PM org.jenkinsci.remoting.protocol.impl.BIONetworkLayer$Reader run</span></span><br><span class="line">  <span class="comment"># INFO: Waiting for ProtocolStack to start.</span></span><br><span class="line">  <span class="comment"># Feb 04, 2023 10:51:19 PM hudson.remoting.jnlp.Main$CuiListener status</span></span><br><span class="line">  <span class="comment"># INFO: Remote identity confirmed: 8e:c7:1e:e1:39:ee:f4:2a:43:f6:aa:d9:0e:b7:b6:62</span></span><br><span class="line">  <span class="comment"># Feb 04, 2023 10:51:21 PM hudson.remoting.jnlp.Main$CuiListener status</span></span><br><span class="line">  <span class="comment"># INFO: Connected</span></span><br></pre></td></tr></table></figure>
<p><br/></p>
<p>æ­¥éª¤ 03.éªŒè¯è¿æ¥ä¸ŠJenkinsçš„agentèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡å·¦ä¾§çš„<code>è„šæœ¬å‘½ä»¤è¡Œ</code>è¿›è¡Œæµ‹, ä½ å¯ä»¥è®¿é—® http://ä½ jenkinsIPåœ°å€/computer/agentèŠ‚ç‚¹åç§°/script å³å¯åˆ° è„šæœ¬å‘½ä»¤è¡Œé¡µé¢ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Groovy script</span></span><br><span class="line">println <span class="string">"uname -a"</span>.execute().text</span><br><span class="line">println System.getenv(<span class="string">"PATH"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œç»“æœ:</span></span><br><span class="line">Linux 2736a6240d91 5.4.0-137-generic <span class="comment">#154-Ubuntu SMP Thu Jan 5 17:03:22 UTC 2023 x86_64 Linux</span></span><br><span class="line">/usr/<span class="built_in">local</span>/jdk8/bin:/usr/<span class="built_in">local</span>/maven/bin:/usr/<span class="built_in">local</span>/sonar-scanner/bin:/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="0x03-å®è·µè°ƒç”¨Jenkins-agentèŠ‚ç‚¹"><a href="#0x03-å®è·µè°ƒç”¨Jenkins-agentèŠ‚ç‚¹" class="headerlink" title="0x03 å®è·µè°ƒç”¨Jenkins agentèŠ‚ç‚¹"></a>0x03 å®è·µè°ƒç”¨Jenkins agentèŠ‚ç‚¹</h2><h3 id="1-ç‰›åˆ€å°è¯•"><a href="#1-ç‰›åˆ€å°è¯•" class="headerlink" title="1.ç‰›åˆ€å°è¯•"></a>1.ç‰›åˆ€å°è¯•</h3><p>æè¿°: æ­¤å¤„ä¸å†ç´¯è¿° Jenkins é¡¹ç›®çš„åˆ›å»ºè¯´æ˜ï¼Œä¸ä¼šçš„æœ‹å‹è¯·å‚ç…§æˆ‘çš„ã€Jenkinså­¦ä¹ ä¹‹è·¯æ±‡æ€»ã€‘( <a href="https://blog.weiyigeek.top/2018/1-1-1.html#Jenkinså­¦ä¹ ä¹‹è·¯æ±‡æ€»">https://blog.weiyigeek.top/2018/1-1-1.html#Jenkinså­¦ä¹ ä¹‹è·¯æ±‡æ€»</a> )ï¼Œå¸®åŠ©å¤§å®¶å¿«é€Ÿå…¥é—¨ã€‚</p>
<p><strong>agent ä»£ç†è¯­æ³•åŠä½¿ç”¨ä»‹ç»</strong><br>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢æµæ°´çº¿ä¸­å¯çŸ¥ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„å°±æ˜¯ agent ä»£ç å—åŒ…å«çš„ï¼Œæˆ‘ä»¬è®¾å®šçš„ jenkins agent æ ‡ç­¾å€¼çš„æœºå™¨ã€‚<br>æè¿°: æŒ‡å®šæ•´ä¸ªPipelineæˆ–ç‰¹å®šé˜¶æ®µå°†åœ¨Jenkinsç¯å¢ƒä¸­æ‰§è¡Œçš„ä½ç½®ï¼Œå…·ä½“å–å†³äºè¯¥<code>agent</code> éƒ¨åˆ†çš„æ”¾ç½®ä½ç½®;</p>
<p><strong>è¯­æ³•å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">å¿…é¡»: YES</span><br><span class="line">å‚æ•°ï¼šany / none / label /ã€€node / docker / dockerfile / kubernetes</span><br><span class="line">  - 1.åœ¨ä»»ä½•å¯ç”¨çš„ agent ä¸Šæ‰§è¡ŒPipelineæˆ–stage</span><br><span class="line">  - 2.åœ¨pipelineå—çš„é¡¶å±‚åº”ç”¨æ—¶ï¼Œä¸ä¼šä¸ºæ•´ä¸ª Pipelineè¿è¡Œåˆ†é…å…¨å±€ä»£ç†ï¼Œå¹¶ä¸”æ¯ä¸ªstageéƒ¨åˆ†éƒ½éœ€è¦åŒ…å«è‡ªå·±çš„agentéƒ¨åˆ†ã€‚</span><br><span class="line">  - 3.ä½¿ç”¨æä¾›çš„æ ‡ç­¾åœ¨Jenkinsç¯å¢ƒä¸­å¯ç”¨çš„ä»£ç†ä¸Šæ‰§è¡Œ Pipelineæˆ–é˜¶æ®µ, æ³¨æ„æ ‡ç­¾æ¡ä»¶ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚</span><br><span class="line">  - 4.nodeä½¿ç”¨ä¸lableç±»ä¼¼</span><br><span class="line">  - 5.æ‰§è¡ŒPipelineæˆ–stageæ—¶ä¼šåŠ¨æ€ä¾›åº”ä¸€ä¸ªdockerèŠ‚ç‚¹å»æ¥å—Docker-basedçš„Pipelinesã€‚</span><br><span class="line">  - 6.ä½¿ç”¨ä»Dockerfileæºå­˜å‚¨åº“ä¸­åŒ…å«çš„å®¹å™¨æ„å»ºçš„å®¹å™¨æ‰§è¡Œ Pipelineæˆ–é˜¶æ®µï¼ŒJenkinsfile å¿…é¡»ä»å¤šåˆ†æ”¯ Pipelineæˆ– SCM PipelineåŠ è½½ã€‚</span><br><span class="line">  - 7.åœ¨Kubernetesé›†ç¾¤ä¸Šéƒ¨ç½²çš„Podå†…æ‰§è¡Œ Pipelineæˆ–é˜¶æ®µï¼ŒåŒæ ·Jenkinsfile å¿…é¡»ä»å¤šåˆ†æ”¯ Pipelineæˆ– SCM PipelineåŠ è½½ï¼ŒPodæ¨¡æ¿åœ¨kubernetes &#123;&#125; å—å†…å®šä¹‰ã€‚</span><br><span class="line">å…è®¸ï¼šåœ¨é¡¶å±‚pipelineå—å’Œæ¯ä¸ªstageå—ä¸­ã€‚</span><br></pre></td></tr></table></figure></p>
<p><strong>è¯­æ³•ç¤ºä¾‹:</strong><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">  agent any</span><br><span class="line"></span><br><span class="line">  agent none</span><br><span class="line"></span><br><span class="line">  agent &#123; </span><br><span class="line">    label <span class="string">'my-label1 &amp;&amp; my-label2'</span> </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  agent &#123; node &#123; label <span class="string">'labelName'</span> &#125; &#125;  <span class="comment">// ç­‰åŒäº agent &#123; label 'labelName' &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// docker è¿˜å¯ä»¥æ¥å—ä¸€ä¸ªargsç›´æ¥ä¼ é€’ç»™`docker run`è°ƒç”¨ä»¥åŠä¸€ä¸ª alwaysPull é€‰é¡¹</span></span><br><span class="line">  <span class="comment">// registryUrlå’ŒregistryCredentialsIdå‚æ•° æœ‰åŠ©äºæŒ‡å®šè¦ä½¿ç”¨çš„Dockeræ³¨å†Œè¡¨åŠå…¶å‡­æ®</span></span><br><span class="line">  agent &#123;</span><br><span class="line">    docker &#123;</span><br><span class="line">      image <span class="string">'maven:3-alpine'</span></span><br><span class="line">      label <span class="string">'my-defined-label'</span></span><br><span class="line">      args  <span class="string">'-v /tmp:/tmp'</span></span><br><span class="line">      registryUrl <span class="string">'https://myregistry.com/'</span></span><br><span class="line">      registryCredentialsId <span class="string">'myPredefinedCredentialsInJenkins'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// dockerfile</span></span><br><span class="line">  agent &#123;</span><br><span class="line">    <span class="comment">// ç­‰åŒäº to "docker build -f Dockerfile.build --build-arg version=1.0.2 ./build/</span></span><br><span class="line">    dockerfile &#123;</span><br><span class="line">        filename <span class="string">'Dockerfile.build'</span></span><br><span class="line">        <span class="comment">// å¦‚æœè¦Dockerfileåœ¨å¦ä¸€ä¸ªç›®å½•ä¸­æ„å»ºï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹diré€‰é¡¹</span></span><br><span class="line">        dir <span class="string">'build'</span></span><br><span class="line">        label <span class="string">'my-defined-label'</span></span><br><span class="line">        additionalBuildArgs  <span class="string">'--build-arg version=1.0.2'</span></span><br><span class="line">        args <span class="string">'-v /tmp:/tmp'</span></span><br><span class="line">        <span class="comment">// åŒæ ·ä¹Ÿæ¥å—registryUrlå’ŒregistryCredentialsIdå‚æ•°</span></span><br><span class="line">        registryUrl <span class="string">'https://myregistry.com/'</span></span><br><span class="line">        registryCredentialsId <span class="string">'myPredefinedCredentialsInJenkins'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// kubernetes: ä¾‹å¦‚å¦‚æœè¦åœ¨å…¶ä¸­è£…æœ‰Kanikoå®¹å™¨çš„å®¹å™¨</span></span><br><span class="line">  agent &#123;</span><br><span class="line">    kubernetes &#123;</span><br><span class="line">      label podlabel</span><br><span class="line">      yaml <span class="string">"""</span></span><br><span class="line"><span class="string">  kind: Pod</span></span><br><span class="line"><span class="string">  metadata:</span></span><br><span class="line"><span class="string">    name: jenkins-agent</span></span><br><span class="line"><span class="string">  spec:</span></span><br><span class="line"><span class="string">    containers:</span></span><br><span class="line"><span class="string">    - name: kaniko</span></span><br><span class="line"><span class="string">      image: gcr.io/kaniko-project/executor:debug</span></span><br><span class="line"><span class="string">      imagePullPolicy: Always</span></span><br><span class="line"><span class="string">      command:</span></span><br><span class="line"><span class="string">      - /busybox/cat</span></span><br><span class="line"><span class="string">      tty: true</span></span><br><span class="line"><span class="string">      volumeMounts:</span></span><br><span class="line"><span class="string">        - name: aws-secret</span></span><br><span class="line"><span class="string">          mountPath: /root/.aws/</span></span><br><span class="line"><span class="string">        - name: docker-registry-config</span></span><br><span class="line"><span class="string">          mountPath: /kaniko/.docker</span></span><br><span class="line"><span class="string">    restartPolicy: Never</span></span><br><span class="line"><span class="string">    volumes:</span></span><br><span class="line"><span class="string">      - name: aws-secret</span></span><br><span class="line"><span class="string">        secret:</span></span><br><span class="line"><span class="string">          secretName: aws-secret</span></span><br><span class="line"><span class="string">      - name: docker-registry-config</span></span><br><span class="line"><span class="string">        configMap:</span></span><br><span class="line"><span class="string">          name: docker-registry-config</span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>å¸¸ç”¨é€‰é¡¹:</strong><br>æè¿°: ä¸‹é¢å¯ä»¥åº”ç”¨äºä¸¤ä¸ªæˆ–è€…å¤šä¸ªagentå®ç°çš„é€‰é¡¹å³labelã€customWorkspaceã€reuseNode;</p>
<ul>
<li>1.label (å‚æ•°:å­—ç¬¦ä¸²): è¿è¡Œ Pipelineæˆ–å•ä¸ª Pipelineçš„æ ‡ç­¾æˆ–æ ‡ç­¾æ¡ä»¶stageã€‚ ã€æ­¤é€‰é¡¹å¯¹nodeï¼Œdockerå’Œæœ‰æ•ˆå¯¹dockerfileå¿…éœ€ nodeã€‚ã€‘</li>
<li>2.customWorkspace (å‚æ•°: å­—ç¬¦ä¸²) : è¿è¡Œ Pipelineæˆ–ä¸ªäºº stage è¿™ agent æ˜¯è¿™ä¸ªè‡ªå®šä¹‰çš„å·¥ä½œç©ºé—´å†…çš„åº”ç”¨ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„, å®ƒå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ï¼ˆ<code>åœ¨è¿™ç§æƒ…å†µä¸‹è‡ªå®šä¹‰å·¥ä½œç©ºé—´å°†ä½äºèŠ‚ç‚¹ä¸Šçš„å·¥ä½œç©ºé—´æ ¹ç›®å½•ä¸‹</code>ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ã€‚ã€æ­¤é€‰é¡¹æ˜¯æœ‰æ•ˆçš„nodeï¼Œdockerå’Œdockerfileã€‚ã€‘</li>
<li>3.reuseNodeï¼ˆå‚æ•°: å¸ƒå°”å€¼-falseï¼‰: å¦‚æœä¸ºtrueåœ¨åŒä¸€å·¥ä½œç©ºé—´ä¸­åœ¨ Pipelineé¡¶çº§æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šè¿è¡Œå®¹å™¨ï¼Œè€Œä¸æ˜¯åœ¨æ•´ä¸ªæ–°èŠ‚ç‚¹ä¸Šè¿è¡Œ</li>
<li>4.args (å‚æ•°: å­—ç¬¦ä¸²): è¦ä¼ é€’ç»™çš„è¿è¡Œæ—¶å‚æ•°docker run,æ­¤é€‰é¡¹å¯¹dockerå’Œæœ‰æ•ˆdockerfileã€‚</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¤ºä¾‹1. Dockerä»£ç†ï¼Œå£°æ˜æ€§ Pipeline</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">  <span class="comment">// V.åœ¨å…·æœ‰ç»™å®šåç§°å’Œæ ‡ç­¾ï¼ˆmaven:3-alpineï¼‰çš„æ–°åˆ›å»ºå®¹å™¨ä¸­æ‰§è¡Œæ­¤ Pipelineä¸­å®šä¹‰çš„æ‰€æœ‰æ­¥éª¤ã€‚</span></span><br><span class="line">  agent &#123; docker <span class="string">'maven:3-alpine'</span> &#125; </span><br><span class="line">  stages &#123;</span><br><span class="line">      stage(<span class="string">'Example Build'</span>) &#123;</span><br><span class="line">          steps &#123;</span><br><span class="line">              sh <span class="string">'mvn -B clean verify'</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¾‹å­2.é˜¶æ®µçº§ä»£ç†éƒ¨åˆ†</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">  <span class="comment">/* agent noneåœ¨ Pipelineçš„é¡¶å±‚è¿›è¡Œå®šä¹‰å¯ç¡®ä¿ ä¸ä¼šä¸å¿…è¦åœ°åˆ†é…æ‰§è¡Œç¨‹åºã€‚ä½¿ç”¨agent noneè¿˜ä¼šå¼ºåˆ¶æ¯ä¸ªstageéƒ¨åˆ†åŒ…å«å…¶è‡ªå·±çš„agentéƒ¨åˆ†ã€‚ */</span></span><br><span class="line">  agent none </span><br><span class="line">  stages &#123;</span><br><span class="line">    stage(<span class="string">'Example Build'</span>) &#123;</span><br><span class="line">      <span class="comment">/* ä½¿ç”¨æ­¤æ˜ åƒåœ¨æ–°åˆ›å»ºçš„å®¹å™¨ä¸­æ‰§è¡Œæ­¤é˜¶æ®µä¸­çš„æ­¥éª¤ã€‚*/</span></span><br><span class="line">      agent &#123; docker <span class="string">'maven:3-alpine'</span> &#125; </span><br><span class="line">      steps &#123;</span><br><span class="line">          echo <span class="string">'Hello, Maven'</span></span><br><span class="line">          sh <span class="string">'mvn --version'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(<span class="string">'Example Test'</span>) &#123;</span><br><span class="line">      <span class="comment">/* ä½¿ç”¨ä¸ä¸Šä¸€é˜¶æ®µä¸åŒçš„å›¾åƒåœ¨æ–°åˆ›å»ºçš„å®¹å™¨ä¸­æ‰§è¡Œæ­¤é˜¶æ®µä¸­çš„æ­¥éª¤ã€‚ */</span></span><br><span class="line">      agent &#123; docker <span class="string">'openjdk:8-jre'</span> &#125; </span><br><span class="line">      steps &#123;</span><br><span class="line">          echo <span class="string">'Hello, JDK'</span></span><br><span class="line">          sh <span class="string">'java -version'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¥½äº†ï¼Œagent ä»‹ç»å®Œæ¯•ï¼Œæˆ‘ä»¬è¯¥å›å½’æ­£é¢˜äº†ã€‚</p>
<p><br/></p>
<p><strong>å®è·µæµç¨‹</strong></p>
<p>æ­¥éª¤ 01.æ­¤å¤„æˆ‘åˆ›å»ºäº†ä¸€ä¸ª Test é¡¹ç›®ç”¨äºæµ‹è¯•è°ƒç”¨æˆ‘ä»¬åœ¨Dockerä¸­è¿è¡Œçš„jenkins AgentèŠ‚ç‚¹ã€‚</p>
<figure class="image-box">
                <a rel=9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ href="https://img.weiyigeek.top/2023/1/20230206173815.png" target="_blank" title="WeiyiGeek.å›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2023/1/20230206173815.png" alt="WeiyiGeek.å›¾" title="" class=""></a>
                <p>WeiyiGeek.å›¾</p>
            </figure>
<p><br/></p>
<p>æ­¥éª¤ 02.æ­¤å¤„æ˜¯æˆ‘å‡†å¤‡çš„ jenkins æµæ°´çº¿ä»£ç , åœ¨åº”ç”¨ä¿å­˜åå³å¯ã€‚<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> JOB_WORKSPACE = <span class="string">"$&#123;env.WORKSPACE&#125;"</span></span><br><span class="line"><span class="keyword">def</span> JOB_NAME = <span class="string">"$&#123;env.JOB_NAME&#125;-$&#123;env.BUILD_NUMBER&#125;"</span></span><br><span class="line"></span><br><span class="line">pipeline &#123;</span><br><span class="line">  agent &#123;</span><br><span class="line">    label <span class="string">'docker-jnlp-1'</span></span><br><span class="line">  &#125;</span><br><span class="line">  environment &#123;</span><br><span class="line">    SONARQUBE_TIMEOUT = <span class="string">'10'</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  stages &#123;</span><br><span class="line">    stage (<span class="string">'Start Test'</span>) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        echo <span class="string">"[Test Jenkins JNLP Agent with docker]!"</span></span><br><span class="line">        echo <span class="string">"æµæ°´çº¿ç¯å¢ƒå˜é‡è¾“å‡º: $&#123;env.JOB_NAME&#125;-$&#123;env.JOB_WORKSPACE&#125;-$&#123;env.SONARQUBE_TIMEOUT&#125;"</span></span><br><span class="line">        script &#123;</span><br><span class="line">          <span class="comment">// å‘½ä»¤æ‰§è¡Œ</span></span><br><span class="line">          sh <span class="string">" echo -e '&lt;name&gt;weiyigeek&lt;/name&gt;\n&lt;addr&gt;https://weiyigeek.top&lt;/addr&gt;' &gt; demo.xml  &amp;&amp; cat demo.xml"</span></span><br><span class="line">          <span class="comment">// è¿”å›å‘½ä»¤æ‰§è¡Œç»“æœ</span></span><br><span class="line">          USERNAME=sh <span class="string">label:</span> <span class="string">'name'</span>,<span class="string">returnStdout:</span> <span class="literal">true</span>, <span class="string">script:</span> <span class="string">"""</span></span><br><span class="line"><span class="string">            awk '/&lt;\\/*name\\/*&gt;/&#123;gsub(/[[:space:]]*&lt;\\/*name\\/*&gt;/,"");print \$0&#125;' demo.xml | head -n 1</span></span><br><span class="line"><span class="string">          """</span></span><br><span class="line">          ADDRESS=sh <span class="string">label:</span> <span class="string">'name'</span>,<span class="string">returnStdout:</span> <span class="literal">true</span>, <span class="string">script:</span> <span class="string">"""</span></span><br><span class="line"><span class="string">            awk '/&lt;\\/*addr\\/*&gt;/&#123;gsub(/[[:space:]]*&lt;\\/*addr\\/*&gt;/,"");print \$0&#125;' demo.xml | head -n 1</span></span><br><span class="line"><span class="string">          """</span></span><br><span class="line">          sh <span class="string">"mkdir -vp test/demo &amp;&amp; ls &amp;&amp; pwd"</span></span><br><span class="line">        &#125;</span><br><span class="line">       echo <span class="string">"è„šæœ¬æ‰§è¡Œè¿”å›ç»“æœè¾“å‡º =&gt; $&#123;USERNAME&#125; =&gt; $&#123;ADDRESS&#125;"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     stage (<span class="string">'END Test'</span>) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        echo <span class="string">"è·¨é˜¶æ®µå˜é‡ä¼ é€’ =&gt; $&#123;USERNAME&#125;"</span></span><br><span class="line">        sh <span class="string">"ls &amp;&amp; pwd"</span></span><br><span class="line">        sh <span class="string">"java -version;mvn -version;release-cli -v;sonar-scanner --version"</span> </span><br><span class="line">        echo <span class="string">"[Test End Stage]!"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>æ­¥éª¤ 03.è¿”å›åˆ°Testé¡¹ç›®é¦–é¡µä¹‹ä¸­ï¼Œç‚¹å‡»ç«‹å³æ„å»ºï¼Œç„¶åå¯ä»¥åœ¨é˜¶æ®µè§†å›¾ä¸­æŸ¥çœ‹åˆ°æ‰§è¡Œç»“æœ,æˆ‘ä»¬å¯ä»¥é€šè¿‡Blue Oceanè¿›è¡Œæ›´åŠ ç›´è§‚çš„å±•ç¤ºã€‚</p>
<figure class="image-box">
                <a rel=9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ href="https://img.weiyigeek.top/2023/1/20230206174336.png" target="_blank" title="WeiyiGeek.Jenkins agentè¿æ¥è¿è¡Œæµ‹è¯•å›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2023/1/20230206174336.png" alt="WeiyiGeek.Jenkins agentè¿æ¥è¿è¡Œæµ‹è¯•å›¾" title="" class=""></a>
                <p>WeiyiGeek.Jenkins agentè¿æ¥è¿è¡Œæµ‹è¯•å›¾</p>
            </figure>
<p><br/></p>
<h3 id="2-å®Œæ•´çš„pipelineæµæ°´çº¿ä¼ä¸šé¡¹ç›®"><a href="#2-å®Œæ•´çš„pipelineæµæ°´çº¿ä¼ä¸šé¡¹ç›®" class="headerlink" title="2.å®Œæ•´çš„pipelineæµæ°´çº¿ä¼ä¸šé¡¹ç›®"></a>2.å®Œæ•´çš„pipelineæµæ°´çº¿ä¼ä¸šé¡¹ç›®</h3><p>æè¿°: ä¸Šä¸€ç« èŠ‚åªæ˜¯ç®€å•ä½¿ç”¨è¯¥é•œåƒåˆ›å»ºçš„å®¹å™¨ï¼Œæ˜¯å¦èƒ½è¢«Jenkinsæ­£å¸¸è°ƒåº¦ï¼Œæ­¤ç« èŠ‚ä¸ºä½œè€…å†…éƒ¨å®è·µé¡¹ç›®æŠ½å–çš„pipelineæµæ°´çº¿ï¼Œå®ç°äº†â€™ä»£ç æ‹‰å–â€™, â€˜ä»£ç æ£€æµ‹â€™, â€˜é¡¹ç›®æ„å»ºâ€™,â€™é•œåƒæ„å»ºâ€™,â€™éƒ¨ç½²æµ‹è¯•â€™,â€™æˆå“å½’æ¡£â€™ç­‰é˜¶æ®µï¼Œä¾›å¤§å®¶å‚è€ƒä½¿ç”¨ã€‚</p>
<p>æ­¥éª¤ 01.åœ¨ç™»å½•Jenkinsåï¼Œåˆ›å»ºä¸€ä¸ªæµ‹è¯•ä»»åŠ¡weiyigeek-oaï¼Œæ­¤å¤„æ ¹æ®ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ä»»åŠ¡å†…éƒ¨OAç³»ç»Ÿè¿›è¡Œå¤åˆ¶åˆ›å»ºï¼Œä¿®æ”¹å¯¹åº”çš„æµæ°´çº¿agentä»£ç å—ä¸ºæ ‡ç­¾é€‰æ‹©ã€‚</p>
<figure class="image-box">
                <a rel=9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ href="https://img.weiyigeek.top/2023/1/20230207093031.png" target="_blank" title="WeiyiGeek.åˆ›å»ºweiyigeek-oaä»»åŠ¡æµæ°´çº¿å›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2023/1/20230207093031.png" alt="WeiyiGeek.åˆ›å»ºweiyigeek-oaä»»åŠ¡æµæ°´çº¿å›¾" title="" class=""></a>
                <p>WeiyiGeek.åˆ›å»ºweiyigeek-oaä»»åŠ¡æµæ°´çº¿å›¾</p>
            </figure>
<p>æ¸©é¦¨æç¤ºï¼šç”±äº Jenkins Pipeline æµæ°´çº¿ä»£ç å¤ªé•¿ï¼Œéœ€è¦çš„æœ‹å‹å¯ä»¥å…³æ³¨ã€WeiyiGeekã€‘å…¬ä¼—å·åå›å¤ã€Jenkinsæµæ°´çº¿ä»£ç ã€‘å³å¯ä¸‹è½½ <code>Jenkins-Pipeline.groovy</code> ç¤ºä¾‹æ–‡ä»¶ã€‚</p>
<figure class="image-box">
                <a rel=9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ href="https://img.weiyigeek.top/2023/1/20230207170309.png" target="_blank" title="WeiyiGeek.Jenkinsæµæ°´çº¿ä»£ç å›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2023/1/20230207170309.png" alt="WeiyiGeek.Jenkinsæµæ°´çº¿ä»£ç å›¾" title="" class=""></a>
                <p>WeiyiGeek.Jenkinsæµæ°´çº¿ä»£ç å›¾</p>
            </figure>
<p><br/></p>
<p>æ­¥éª¤ 03.å›åˆ°é¡¹ç›®é¦–é¡µï¼Œç‚¹å‡» ã€build with Parametersã€‘é€‰æ‹©æ„å»ºé¡¹ç›®æŒ‡å®šå‚æ•°ï¼Œç‚¹å‡»ã€å¼€å§‹æ„å»ºã€‘ä¾¿å¯è¿›è¡Œæ„å»ºä»»åŠ¡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»æ§åˆ¶å°è¾“å‡ºçœ‹åˆ°å½“å‰ weiyigeek-oa è¿è¡Œåœ¨æˆ‘ä»¬ä½¿ç”¨dockeréƒ¨ç½²çš„agentèŠ‚ç‚¹ä¹‹ä¸Š(docker-jenkins-jnlp)</span></span><br><span class="line">Started by user Jenkins ç®¡ç†å‘˜</span><br><span class="line">[Pipeline] Start of Pipeline</span><br><span class="line">[Pipeline] node</span><br><span class="line">Running on docker-jenkins-jnlp <span class="keyword">in</span> /home/jenkins/agent/workspace/weiyigeek-oa</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ href="https://img.weiyigeek.top/2023/1/20230207093625.png" target="_blank" title="WeiyiGeek.æµæ°´çº¿ä»»åŠ¡æ„å»ºå‚æ•°è®¾å®šä¸è¿è¡Œå›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2023/1/20230207093625.png" alt="WeiyiGeek.æµæ°´çº¿ä»»åŠ¡æ„å»ºå‚æ•°è®¾å®šä¸è¿è¡Œå›¾" title="" class=""></a>
                <p>WeiyiGeek.æµæ°´çº¿ä»»åŠ¡æ„å»ºå‚æ•°è®¾å®šä¸è¿è¡Œå›¾</p>
            </figure>
<p><br/></p>
<p>æ­¥éª¤ 04.ä»»åŠ¡è¿è¡Œå®Œæ¯•åå¯ä»¥é€šè¿‡ Blue Ocean è¿›è¡ŒæŸ¥çœ‹å„é˜¶æ®µçš„æ‰§è¡Œæƒ…å†µï¼Œä»¥åŠæŸ¥çœ‹Jenkinså‘é€åœ¨ä¼ä¸šå¾®ä¿¡ä¸­æ„å»ºä¿¡æ¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Jenkins-æ¶ˆæ¯é€šçŸ¥ã€weiyigeek-oa-1ã€‘ä»»åŠ¡å¼€å§‹ </span><br><span class="line">é¡¹ç›®ä¿¡æ¯: overtime-leave-1.5.5.jar</span><br><span class="line">æäº¤ä¿¡æ¯: 6f335ad ç»Ÿè®¡æŸ¥è¯¢æ·»åŠ ç­›é€‰æ¡ä»¶</span><br><span class="line">æ„å»ºç‰ˆæœ¬: master - origin/master</span><br><span class="line">æ„å»ºæ“ä½œ: None</span><br><span class="line">é•œåƒæ„å»º: True</span><br><span class="line">éƒ¨ç½²ç¯å¢ƒ: Prod</span><br><span class="line">æˆå“å½’æ¡£: False</span><br><span class="line">è´¨é‡æµ‹è¯•: False</span><br><span class="line">é•œåƒä»“åº“1: harbor.weiyigeek.top/weiyigeek/oa:master</span><br><span class="line">é•œåƒä»“åº“2: harbor.weiyigeek.top/weiyigeek/oa:latest</span><br><span class="line">æŸ¥çœ‹å½“å‰ä»»åŠ¡æµæ°´çº¿</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ href="https://img.weiyigeek.top/2023/1/20230207094227.png" target="_blank" title="WeiyiGeek.æµæ°´çº¿ä»»åŠ¡é˜¶æ®µæ‰§è¡Œæƒ…å†µæŸ¥çœ‹è¯´æ˜å›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2023/1/20230207094227.png" alt="WeiyiGeek.æµæ°´çº¿ä»»åŠ¡é˜¶æ®µæ‰§è¡Œæƒ…å†µæŸ¥çœ‹è¯´æ˜å›¾" title="" class=""></a>
                <p>WeiyiGeek.æµæ°´çº¿ä»»åŠ¡é˜¶æ®µæ‰§è¡Œæƒ…å†µæŸ¥çœ‹è¯´æ˜å›¾</p>
            </figure>
<p>è‡³æ­¤ï¼Œåœ¨ Docker ä¸­è¿è¡Œ Jenkins Agent å®è·µå®Œæ¯•ï¼</p>

        </div>
        <!-- Google å¹¿å‘Š -->
        
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
  

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2023-02-07T15:21:11.368Z" itemprop="dateUpdated">2023-02-07 23:21:11</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/Jenkins/9.Jenkinså®è·µä¹‹è¿æ¥ä½¿ç”¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹.md" target="_blank" rel="noopener noreferrer">_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/CI-CD/Jenkins/9.Jenkinså®è·µä¹‹è¿æ¥ä½¿ç”¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2023/1-31-710.html" target="_blank" rel="external">https://blog.weiyigeek.top/2023/1-31-710.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2023/1-31-710.html&title=ã€Š9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2023/1-31-710.html&title=ã€Š9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2023/1-31-710.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2023/1-31-710.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2023/1-31-710.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2023/2-1-index.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Containerd/5</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2023/1-19-709.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">18.è®¡ç®—æœºç§‘å­¦å¯¼è®ºä¹‹äººå·¥æ™ºèƒ½åˆè¯†å­¦ä¹ ç¬”è®°</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-å‰è¨€ç®€è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å‰è¨€ç®€è¿°</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-åŸºç¡€ç¯å¢ƒå‡†å¤‡"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 åŸºç¡€ç¯å¢ƒå‡†å¤‡</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-ç¯å¢ƒè¯´æ˜"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">1.ç¯å¢ƒè¯´æ˜</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-æ·»åŠ æ–°çš„Jenkins-agentèŠ‚ç‚¹"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">2.æ·»åŠ æ–°çš„Jenkins agentèŠ‚ç‚¹</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-è‡ªè¡Œæ„å»ºJenkins-Agenté•œåƒ-å¹²è´§"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">3.è‡ªè¡Œæ„å»ºJenkins Agenté•œåƒ(å¹²è´§)</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-é¡¹ç›®å®è·µ"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 é¡¹ç›®å®è·µ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-ä½¿ç”¨åœ¨K8Séƒ¨ç½²çš„Jenkinsè¿æ¥Dockerå®¹å™¨ä¸­è¿è¡Œçš„Agentåˆ†å¸ƒå¼èŠ‚ç‚¹-ç¼ºçœç«¯å£-50000"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">1.ä½¿ç”¨åœ¨K8Séƒ¨ç½²çš„Jenkinsè¿æ¥Dockerå®¹å™¨ä¸­è¿è¡Œçš„Agentåˆ†å¸ƒå¼èŠ‚ç‚¹ (ç¼ºçœç«¯å£:50000)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-ä½¿ç”¨åœ¨K8Séƒ¨ç½²çš„Jenkinsè¿æ¥Dockerå®¹å™¨ä¸­è¿è¡Œçš„è‡ªå®šä¹‰Agentç«¯å£èŠ‚ç‚¹-ç›´è¿æ–¹å¼"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">2.ä½¿ç”¨åœ¨K8Séƒ¨ç½²çš„Jenkinsè¿æ¥Dockerå®¹å™¨ä¸­è¿è¡Œçš„è‡ªå®šä¹‰Agentç«¯å£èŠ‚ç‚¹ (ç›´è¿æ–¹å¼)</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x03-å®è·µè°ƒç”¨Jenkins-agentèŠ‚ç‚¹"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 å®è·µè°ƒç”¨Jenkins agentèŠ‚ç‚¹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-ç‰›åˆ€å°è¯•"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">1.ç‰›åˆ€å°è¯•</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-å®Œæ•´çš„pipelineæµæ°´çº¿ä¼ä¸šé¡¹ç›®"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">2.å®Œæ•´çš„pipelineæµæ°´çº¿ä¼ä¸šé¡¹ç›®</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    


    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      

    <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
    
      <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½çœ‹å‹,æ¬¢è¿å…³æ³¨åšä¸»å¾®ä¿¡å…¬ä¼—å·å“Ÿ! â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘å³å¯å…³é—­ç»§ç»­æµè§ˆæ–‡ç« .<br>  <b style="color:red;"> æ¸©é¦¨æç¤º: æœªè§£é”çš„ç”¨æˆ·ä¸èƒ½ç²˜è´´å¤åˆ¶æ–‡ç« å†…å®¹å“Ÿ!</b> <br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
        
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="/img/share-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2023 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>

<div id="go" class="waves-effect waves-light">
  <a href="javascript:;" id="goqrcode"> <span class="icon icon-lg icon-qrcode"></span> </a>
  <a href="javascript:;" id="gotop"> <span class="icon icon-lg icon-chevron-up"></span></a>
</div>





<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2023/1-31-710.html&title=ã€Š9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2023/1-31-710.html&title=ã€Š9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2023/1-31-710.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š9.Jenkinså®è·µä¹‹è¿æ¥å¤–éƒ¨Dockeréƒ¨ç½²çš„åˆ†å¸ƒå¼Agentå·¥ä½œèŠ‚ç‚¹ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2023/1-31-710.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2023/1-31-710.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMUlEQVR42u3awW6EMAxF0fn/n6bbShXhPhumirlZVS2QnCxSx/bng8fxa5C/Hn/G2Vt8lhuGDBkytmUcy8EnIG8R0no7TlciQ4aMFzD4p9dbQDZoPUvKliFDhoz0ECTLWi9UhgwZMu5lkO/wt/7twJUhQ8YmDHJ0koCPJ9rIW4/cxWXIkLEhg2fdv//zI/UNGTJkbMU4wvGdumG8KhkyZIxm8AOOBIudYie/DJ9+QYYMGUMZvPSYTtbBxL+RIUPGaAZJdcWfKyX9Oyk/GTJkzGYU3Xi5nYJlMK8MGTJGM4p/Dt9KA02yEaiQKUOGjEEM/uj6SVKMTJ8PCpwyZMgYyuChGL/Q8lYwflijCFeGDBmjGfc2jJJrKt8C1MAhQ4aM0Yx+OwWKPZcblJYcLrZVhgwZoxkpjF+Aa4m2fvpPhgwZ8xjpgciPQp6A65Q/ZciQMZXRCeb4NZUHc7VrswwZMt7GSAuKtdgsbWO9mF2GDBmjGXwRJICrJffT8gDCyJAhYxwjTcp3zrq0zBm0kcmQIeMFjE7xslPaJDOi7ZYhQ8YLGDzh1TlGiw0T5NCXIUPGUEbtskqWQhbaaTs7/Y8hQ4aMcYxOi1gtsEsLDzcf2TJkyNiWkSbIasFirYEjbrmQIUPGaAY/+Go9WjxMTDddhgwZMvjRmZLSS3LcbCFDhgwZYSJsvVz+zMUlVoYMGaMZvDm11tJaKzM8km6TIUPGhoxWp0aptNAPKIurkiFDxn6MHxsPS6lUQZYLAAAAAElFTkSuQmCC" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// ç«™ç‚¹è¿è¡Œæ—¶é—´
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + "å¤©" + RunHours + "æ—¶" + RunMinutes + "åˆ†" + RunSeconds + "ç§’";
  document.getElementById(id).innerHTML = "ç½‘ç«™å·²åœ¨é£é›¨ä¸­å‹‰å‹‰å¼ºå¼ºè¿è¡Œäº†ã€" + RunTime + "ã€‘";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
</body>
</html>