<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°2|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Ansible">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°2</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°2</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-07-28T06:34:30.000Z" itemprop="datePublished" class="page-time">
  2019-07-28
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/">è‡ªåŠ¨åŒ–è¿ç»´</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E5%9F%BA%E7%A1%80/">è¿ç»´åŸºç¡€</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/Ansible/Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°2"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°2</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-07-28 14:34:30" datetime="2019-07-28T06:34:30.000Z"  itemprop="datePublished">2019-07-28</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/">è‡ªåŠ¨åŒ–è¿ç»´</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E5%9F%BA%E7%A1%80/">è¿ç»´åŸºç¡€</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h4 id="0x04-variableå˜é‡"><a href="#0x04-variableå˜é‡" class="headerlink" title="0x04 variableå˜é‡"></a>0x04 variableå˜é‡</h4><p>å‰è¨€ï¼šåœ¨ansibleä¸­ä½¿ç”¨å˜é‡ï¼Œèƒ½è®©æˆ‘ä»¬çš„å·¥ä½œå˜å¾—æ›´åŠ çµæ´»ï¼Œåœ¨ansibleä¸­å˜é‡çš„ä½¿ç”¨æ–¹å¼æœ‰å¾ˆå¤šç§</p>
<p><em>ansibleå˜é‡è§„åˆ™ï¼š</em></p>
<ul>
<li>å˜é‡ååº”è¯¥ç”±å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ç»„æˆ</li>
<li>å˜é‡åéœ€è¦ä»¥å­—æ¯å¼€å¤´</li>
<li>ansibleå†…ç½®çš„å…³é”®å­—ä¸èƒ½ä½œä¸ºå˜é‡å</li>
</ul>
<p>ä¸‹é¢æ˜¯ä¼˜å…ˆçº§ä»æœ€å°åˆ°æœ€å¤§çš„é¡ºåº(æœ€ååˆ—å‡ºçš„å˜é‡èµ¢å¾—ä¼˜å…ˆçº§):</p>
<ul>
<li>command line values (eg â€œ-u userâ€)</li>
<li>role defaults [1]</li>
<li>inventory file or script group vars [2]</li>
<li>inventory group_vars/all [3]</li>
<li>playbook group_vars/all [3]</li>
<li>inventory group_vars/* [3]</li>
<li>playbook group_vars/* [3]</li>
<li>inventory file or script host vars [2]</li>
<li>inventory host_vars/* [3]</li>
<li>playbook host_vars/* [3]</li>
<li>host facts / cached set_facts [4]</li>
<li>play vars</li>
<li>play vars_prompt</li>
<li>play vars_files</li>
<li>role vars (defined in role/vars/main.yml)</li>
<li>block vars (only for tasks in block)</li>
<li>task vars (only for the task)</li>
<li>include_vars</li>
<li>set_facts / registered vars</li>
<li>role (and include_role) params</li>
<li>include params</li>
<li>extra vars (always win precedence)</li>
</ul>
<p><br></p>
<h5 id="1-vars-é…ç½®å®šä¹‰-playbook"><a href="#1-vars-é…ç½®å®šä¹‰-playbook" class="headerlink" title="(1) vars é…ç½®å®šä¹‰ (playbook)"></a>(1) vars é…ç½®å®šä¹‰ (playbook)</h5><p>åœ¨playä¸­å®šä¹‰å˜é‡çš„å‡ ç§å½¢å¼ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.å¯å®šä¹‰å•ä¸ªå˜é‡æˆ–è€…å¤šä¸ªå˜é‡ï¼ˆå¸¸è§„ï¼‰</span></span><br><span class="line">vars:</span><br><span class="line">  tvar1: testfile</span><br><span class="line">  tvar2: testfile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.ä½¿ç”¨YAMLçš„å—åºåˆ—è¯­æ³•ä¹Ÿå¯ä»¥å®šä¹‰å˜é‡</span></span><br><span class="line">vars:</span><br><span class="line">  - testvar1: testfile1</span><br><span class="line">  - testvar2: testfile2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#3.èƒ½å¤Ÿä»¥ç±»ä¼¼"å±æ€§"çš„æ–¹å¼å®šä¹‰å˜é‡ ï¼ˆæ¨èæ–¹æ³•ï¼‰</span></span><br><span class="line">vars:</span><br><span class="line">  nginx:</span><br><span class="line">    conf80: /etc/nginx/conf.d/80.conf</span><br><span class="line">    conf8080: /etc/nginx/conf.d/8080.conf</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>å˜é‡å¼•ç”¨çš„å‡ ç§æ–¹å¼ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç¤ºä¾‹1ï¼šä¸Šé¢1/2æ¡ˆä¾‹å˜é‡è°ƒç”¨</span></span><br><span class="line"><span class="string">"&#123;&#123; tvar1 &#125;&#125;"</span></span><br><span class="line"><span class="string">"&#123;&#123; testvar1 &#125;&#125;"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¤ºä¾‹2. ä¸Šé¢3æ¡ˆä¾‹å˜é‡è°ƒç”¨(ç”±äºæ˜¯å¯¹è±¡)</span></span><br><span class="line"><span class="string">"&#123;&#123;nginx.conf80&#125;&#125;"</span>  <span class="comment">#æ–¹å¼1</span></span><br><span class="line"><span class="string">"&#123;&#123;nginx['conf8080']&#125;&#125;"</span> <span class="comment">#æ–¹å¼2</span></span><br></pre></td></tr></table></figure></p>
<p>ä¸Šä¾‹ä¸­æˆ‘åœ¨å¼•ç”¨å˜é‡æ—¶ä½¿ç”¨äº†åŒå¼•å·ï¼Œè€Œåœ¨æœ¬æ–‡çš„ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­å¼•ç”¨å˜é‡æ—¶å´æ²¡æœ‰ä½¿ç”¨åŒå¼•å·ï¼Œè¿™æ˜¯å› ä¸ºç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­çš„å˜é‡åœ¨è¢«å¼•ç”¨æ—¶ï¼Œå¹¶æ²¡æœ‰å¤„äºâ€å¼€å¤´çš„ä½\â€ï¼Œç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­å˜é‡è¢«å¼•ç”¨æ—¶å¦‚ä¸‹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">path: /testdir/&#123;&#123; testvar1 &#125;&#125;  <span class="comment">#å½“ "ä¸å¤„äºå¼€å¤´ä½ç½®" ç›¸å½“äºæ˜¯æ‹¼æ¥è·¯å¾„å¯ä»¥ä¸ä½¿ç”¨""åŒ…å«</span></span><br><span class="line">path: <span class="string">"&#123;&#123;nginx.conf80&#125;&#125;"</span>  <span class="comment">#å˜é‡è¢«å¼•ç”¨æ—¶å¦‚ä¸‹ï¼Œå¤„äº"å¼€å¤´çš„ä½ç½®"å¿…é¡»ä½¿ç”¨åŒå¼•å·å¼•èµ·è¢«å¼•ç”¨çš„å˜é‡ï¼Œå¦åˆ™ä¼šæŠ¥è¯­æ³•é”™è¯¯ã€‚</span></span><br></pre></td></tr></table></figure><br>ä¸Šè¿°æƒ…å†µä¹Ÿæœ‰ä¾‹å¤–,å½“åœ¨playbookä¸­ä¸ºæ¨¡å—çš„å‚æ•°èµ‹å€¼æ—¶ï¼Œå¯ä»¥ä½¿ç”¨â€å†’å·â€ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨â€ç­‰å·â€ï¼Œå½“ä½¿ç”¨â€ç­‰å·â€ä¸ºæ¨¡å—çš„å‚æ•°èµ‹å€¼æ—¶ï¼Œåˆ™ä¸ç”¨è€ƒè™‘å¼•ç”¨å˜é‡æ—¶æ˜¯å¦ä½¿ç”¨â€å¼•å·â€çš„é—®é¢˜ï¼Œ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file:</span><br><span class="line">  path=&#123;&#123;nginx.conf80&#125;&#125;</span><br><span class="line">  path=&#123;&#123;nginx[<span class="string">'conf8080'</span>]&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="2-vars-files-ç‹¬ç«‹ymlæ–‡ä»¶å®šä¹‰"><a href="#2-vars-files-ç‹¬ç«‹ymlæ–‡ä»¶å®šä¹‰" class="headerlink" title="(2) vars_files ç‹¬ç«‹ymlæ–‡ä»¶å®šä¹‰"></a>(2) vars_files ç‹¬ç«‹ymlæ–‡ä»¶å®šä¹‰</h5><p>åœ¨æŸäº›åœºæ™¯ä¸­æˆ‘ä»¬è¿˜å¯ä»¥åœ¨æŸä¸ªæ–‡ä»¶ä¸­å®šä¹‰å˜é‡,ç„¶åå†åœ¨playbookä¸­å¼•å…¥å¯¹åº”çš„æ–‡ä»¶,å¼•å…¥æ–‡ä»¶åplaybookå³å¯ä½¿ç”¨æ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡,å³å¯ä½¿ç”¨æ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡</p>
<p><em>ä½ å¯èƒ½ä¼šé—®ä¸ºä»€ä¹ˆè¦å¤šæ­¤ä¸€ä¸¾å‘¢ï¼Ÿ</em></p>
<ul>
<li>æŸäº›å·¥ä½œåœºæ™¯ä¸­éœ€è¦ä½ æƒ³è¦è®©åˆ«äººé˜…è¯»ä½ çš„playbookï¼Œå´ä¸æƒ³è®©åˆ«äººçœ‹åˆ°æŸäº›å€¼åªèƒ½çœ‹åˆ°å¼•å…¥çš„å˜é‡åï¼Œä½†æ˜¯çœ‹ä¸åˆ°å˜é‡å¯¹åº”çš„å€¼ï¼Œè¿™ç§å°†å˜é‡åˆ†ç¦»åˆ°æŸä¸ªæ–‡ä»¶ä¸­çš„åšæ³•å«åšâ€å˜é‡æ–‡ä»¶åˆ†ç¦»â€</li>
<li>â€œå˜é‡æ–‡ä»¶åˆ†ç¦»â€ï¼šèƒ½å¤Ÿéšè—æŸäº›å€¼,å°†ä¸åŒç±»çš„ä¿¡æ¯æ”¾åœ¨ä¸åŒçš„æ–‡ä»¶,å˜é‡ä¿¡æ¯ä¸å‰§æœ¬åˆ†ç¦»(æ–¹ä¾¿ä¿®æ”¹)</li>
</ul>
<p><em>â€œå˜é‡æ–‡ä»¶åˆ†ç¦»â€ä¹‹å˜é‡å®šä¹‰</em><br>å»ºç«‹nginx.ymlåœ¨æ–‡ä»¶ä¸­å®šä¹‰å˜é‡æ—¶ï¼Œä¸è¦ä½¿ç”¨varså…³é”®å­—ï¼Œç›´æ¥å®šä¹‰å˜é‡å³å¯ï¼Œå®šä¹‰å˜é‡çš„è¯­æ³•ä¸åœ¨playbookä¸­å®šä¹‰å˜é‡çš„å‡ ç§è¯­æ³•ç›¸åŒ<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¯­æ³•ä¸€ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="attr">  testvar1:</span> <span class="string">testfile</span></span><br><span class="line"><span class="attr">  testvar2:</span> <span class="string">testfile2</span></span><br><span class="line"><span class="comment">#è¯­æ³•äºŒç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="attr">  - testvar1:</span> <span class="string">testfile</span></span><br><span class="line"><span class="attr">  - testvar2:</span> <span class="string">testfile2</span></span><br><span class="line"><span class="comment">#è¯­æ³•ä¸‰ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="attr">nginx:</span></span><br><span class="line"><span class="attr">  conf80:</span> <span class="string">/etc/nginx/conf.d/80.conf</span></span><br><span class="line"><span class="attr">  conf8080:</span> <span class="string">/etc/nginx/conf.d/8080.conf</span></span><br></pre></td></tr></table></figure></p>
<p><em>â€œå˜é‡æ–‡ä»¶åˆ†ç¦»â€ä¹‹å˜é‡åŒ…å«å¼•ç”¨</em><br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å•ä¸ªå˜é‡æ–‡ä»¶å¼•å…¥</span></span><br><span class="line"><span class="attr">vars_files:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">/testdir/ansible/nginx.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¹Ÿå¯ä»¥å¼•å…¥å¤šä¸ªå˜é‡æ–‡ä»¶ï¼Œæ¯ä¸ªè¢«å¼•å…¥çš„æ–‡ä»¶éƒ½éœ€è¦ä»¥\"- \"å¼€å¤´ï¼Œç¤ºä¾‹å¦‚ä¸‹</span></span><br><span class="line"><span class="attr">vars_files:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">/testdir/ansible/nginx_vars.yml</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">/testdir/ansible/other_vars.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#"vars"å…³é”®å­—å’Œ"vars_files"å…³é”®å­—å¯ä»¥åŒæ—¶ä½¿ç”¨</span></span><br><span class="line"><span class="attr">vars:</span></span><br><span class="line"><span class="attr">  - conf90:</span> <span class="string">/etc/nginx/conf.d/90.conf</span></span><br><span class="line"><span class="attr">vars_files:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">/testdir/ansible/nginx_vars.yml</span></span><br></pre></td></tr></table></figure></p>
<p>åŸºç¡€ç¤ºä¾‹ï¼šå®ç°å˜é‡æ–‡ä»¶åˆ†ç¦»å¼•ç”¨ä¸å‘½ä»¤æ¨¡å—æ–‡ä»¶æ¨¡å—ä½¿ç”¨<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#var.yml</span></span><br><span class="line"><span class="attr">create:</span></span><br><span class="line"><span class="attr">  directory:</span> <span class="string">Love</span></span><br><span class="line"><span class="attr">  filename:</span> <span class="string">Ansible.sh</span></span><br><span class="line"><span class="attr">  context:</span> <span class="string">"insert file a talk about \b \t \n"</span>  <span class="comment">#å»ºè®®å¯¹äºå­—ç¬¦ä¸²ä¸€å®šè¦æ·»åŠ åŒå¼•å·ï¼Œå¯ä½¿ç”¨è½¬ä¹‰å­—ç¬¦;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#variable.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  vars:</span> <span class="comment">#å…³é”®ç‚¹1-ç›´æ¥åœ¨playæ–‡ä»¶ä¸­å®šä¹‰å˜é‡</span></span><br><span class="line"><span class="attr">    - dirRoot:</span> <span class="string">/tmp/</span></span><br><span class="line"><span class="attr">  vars_files:</span> <span class="comment">#å…³é”®ç‚¹2-åŒ…å«å¤–éƒ¨è®¾å®šçš„å˜é‡æ–‡ä»¶</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">/root/var.yml</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">Create</span> <span class="string">directory</span></span><br><span class="line"><span class="attr">      file:</span> </span><br><span class="line"><span class="attr">        path:</span> <span class="string">"<span class="template-variable">&#123;&#123;dirRoot&#125;&#125;</span><span class="template-variable">&#123;&#123;create.directory&#125;&#125;</span>"</span>  <span class="comment">#å…³é”®ç‚¹3</span></span><br><span class="line"><span class="attr">        state:</span> <span class="string">directory</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">touch</span> <span class="string">file</span></span><br><span class="line"><span class="attr">      file:</span></span><br><span class="line">        <span class="string">path=&#123;&#123;dirRoot&#125;&#125;&#123;&#123;create.directory&#125;&#125;/&#123;&#123;create['filename']&#125;&#125;</span>  <span class="comment">#å…³é”®ç‚¹4 - ç‰¹æ®Šå­—ç¬¦å¯ä»¥ç›´æ¥æ‹¼æ¥ï¼ˆå®é™…ä½¿ç”¨æ—¶å€™ä¸å»ºè®®è¿™æ ·ï¼‰</span></span><br><span class="line">        <span class="string">state=touch</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">insert</span> <span class="string">context</span></span><br><span class="line"><span class="attr">      lineinfile:</span></span><br><span class="line">        <span class="string">path="&#123;&#123;dirRoot&#125;&#125;&#123;&#123;create.directory&#125;&#125;/&#123;&#123;create.filename&#125;&#125;"</span>  <span class="comment">#å…³é”®ç‚¹5 - æ¨èæ–¹æ³•é‡‡ç”¨å•åŒå¼•å·åŒ…å«é‡Œé¢å¯æ‹¼æ¥å­—ç¬¦</span></span><br><span class="line">        <span class="string">line=&#123;&#123;create['context']&#125;&#125;</span></span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°2 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190729164637.png" target="_blank" title="WeiyiGeek.å˜é‡åˆ†ç¦»æ¡ˆä¾‹" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190729164637.png" alt="WeiyiGeek.å˜é‡åˆ†ç¦»æ¡ˆä¾‹" title="" class=""></a>
                <p>WeiyiGeek.å˜é‡åˆ†ç¦»æ¡ˆä¾‹</p>
            </figure></p>
<p><br></p>
<h5 id="3-å˜é‡ç›¸å…³ä½¿ç”¨æ–¹æ³•"><a href="#3-å˜é‡ç›¸å…³ä½¿ç”¨æ–¹æ³•" class="headerlink" title="(3) å˜é‡ç›¸å…³ä½¿ç”¨æ–¹æ³•"></a>(3) å˜é‡ç›¸å…³ä½¿ç”¨æ–¹æ³•</h5><p>æè¿°ï¼šè¿™ç¯‡æ–‡ç« æ‰€æ¶‰åŠåˆ°çš„å†…å®¹éœ€è¦å€ŸåŠ©ä¸¤ä¸ªæ¨¡å—ï¼Œæ‰€ä»¥åœ¨è¯¦ç»†çš„æ€»ç»“å˜é‡çš„ç›¸å…³ä½¿ç”¨æ–¹æ³•ä¹‹å‰ä¼šå…ˆæè¿°ä¸€ä¸‹è¿™ä¸¤ä¸ªæ¨¡å—çš„ç”¨æ³•:<code>setupæ¨¡å—/debugæ¨¡å—</code>ã€‚</p>
<p>å½“æˆ‘ä»¬è¿è¡Œä¸€ä¸ªplaybookæ—¶è‡ªåŠ¨<code>è°ƒç”¨äº†setupæ¨¡å—ä»è€Œæ‰§è¡Œäº†&quot;[Gathering Facts]&quot;ä»»åŠ¡</code>ï¼Œé€šè¿‡è¿™ä¸ªé»˜è®¤ä»»åŠ¡æ”¶é›†è¿œç¨‹ä¸»æœºçš„ç›¸å…³ä¿¡æ¯ï¼ˆ<code>ä¾‹å¦‚è¿œç¨‹ä¸»æœºçš„IPåœ°å€ï¼Œä¸»æœºåï¼Œç³»ç»Ÿç‰ˆæœ¬ï¼Œç¡¬ä»¶é…ç½®ç­‰ä¿¡æ¯</code>ï¼‰;<br>å…¶å®è¿™äº›è¢«æ”¶é›†åˆ°çš„è¿œç¨‹ä¸»æœºä¿¡æ¯ä¼šä¿å­˜åœ¨å¯¹åº”çš„å˜é‡ä¸­ï¼Œå½“æˆ‘ä»¬è¦ä½¿ç”¨è¿™äº›ä¿¡æ¯æ—¶å°±å¯ä»¥è·å–å¯¹åº”çš„å˜é‡ï¼›</p>
<p>å…¶å®è¿™äº›è¿œç¨‹ä¸»æœºçš„å˜é‡ä¿¡æ¯ä¸ä»…ä»…èƒ½å¤Ÿç”¨äºè¾“å‡ºï¼Œæˆ‘ä»¬é€šå¸¸ä¼šè·å–åˆ°ä¿¡æ¯ä»¥å<code>å¯¹è¿™äº›ä¿¡æ¯çš„å€¼è¿›è¡Œåˆ¤æ–­</code>ï¼Œåˆ¤æ–­æ˜¯å¦ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ç„¶åå†æ‰§è¡Œä¸‹ä¸€æ­¥åŠ¨ä½œï¼Œæ¯”å¦‚å…ˆè·å–åˆ°è¿œç¨‹ä¸»æœºçš„ç³»ç»Ÿå‘è¡Œç‰ˆä¿¡æ¯ç„¶ååˆ¤æ–­å‘è¡Œç‰ˆæ˜¯centos6è¿˜æ˜¯centos7:</p>
<ul>
<li>å¦‚æœæ˜¯centos6ï¼Œæˆ‘ä»¬å°±å°†å‡†å¤‡å¥½çš„Aæ–‡ä»¶æ‹·è´åˆ°è¿œç¨‹ä¸»æœºä¸­</li>
<li>å¦‚æœæ˜¯centos7ï¼Œæˆ‘ä»¬å°±å°†å‡†å¤‡å¥½çš„Bæ–‡ä»¶æ‹·è´åˆ°è¿œç¨‹ä¸»æœºä¸­</li>
</ul>
<p>æ¼”ç¤ºæ¡ˆä¾‹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ansible</span> <span class="built_in">local</span> -m setup | more</span><br><span class="line"><span class="built_in">local</span> | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">"ansible_facts"</span>: &#123;</span><br><span class="line">        <span class="string">"ansible_all_ipv4_addresses"</span>: [</span><br><span class="line">            <span class="string">"10.10.107.222"</span>,</span><br><span class="line">            <span class="string">"192.168.1.99"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"ansible_all_ipv6_addresses"</span>: [</span><br><span class="line">            <span class="string">"fe80::9738:2d26:820f:2d50"</span>,</span><br><span class="line">            <span class="string">"fe80::dfc:592e:b4a4:9877"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"ansible_apparmor"</span>: &#123;</span><br><span class="line">            <span class="string">"status"</span>: <span class="string">"disabled"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"ansible_architecture"</span>: <span class="string">"x86_64"</span>,</span><br><span class="line">        <span class="string">"ansible_bios_date"</span>: <span class="string">"09/21/2015"</span>,</span><br><span class="line">        <span class="string">"ansible_bios_version"</span>: <span class="string">"6.00"</span>,</span><br><span class="line">        <span class="string">"ansible_cmdline"</span>: &#123;</span><br><span class="line">            <span class="string">"BOOT_IMAGE"</span>: <span class="string">"/vmlinuz-3.10.0-957.12.2.el7.x86_64"</span>,</span><br><span class="line">            <span class="string">"LANG"</span>: <span class="string">"zh_CN.UTF-8"</span>,</span><br><span class="line">            <span class="string">"crashkernel"</span>: <span class="string">"auto"</span>,</span><br><span class="line">            <span class="string">"quiet"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"rd.lvm.lv"</span>: <span class="string">"centos/swap"</span>,</span><br><span class="line">            <span class="string">"rhgb"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"ro"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"root"</span>: <span class="string">"/dev/mapper/centos-root"</span></span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œä¸Šè¿°å‘½ä»¤åè¿œç¨‹ä¸»æœºlocalçš„ç›¸å…³ä¿¡æ¯å°†ä¼šè¾“å‡ºåˆ°ansibleä¸»æœºçš„æ§åˆ¶å°ä¸Šï¼Œä¸ºäº†æ–¹ä¾¿ä½ é˜…è¯»è¿”å›çš„ä¿¡æ¯çš„æ ¼å¼æ˜¯jsonæ ¼å¼</p>
<p>ansibleå·²ç»å°†æ ¼å¼åŒ–åçš„jsonä¿¡æ¯è¿”å›åˆ°äº†æ§åˆ¶å°ä¸­æ¯”å¦‚ï¼š</p>
<ul>
<li>â€œansible_all_ipv4_addressesâ€ è¡¨ç¤ºè¿œç¨‹ä¸»æœºä¸­çš„æ‰€æœ‰ipv4åœ°å€ï¼Œä»å…¶å¯¹åº”çš„å€¼å¯ä»¥çœ‹å‡ºï¼Œlocalä¸»æœºä¸Šä¸€å…±æœ‰3ä¸ªipv4åœ°å€ã€‚</li>
<li>â€œansible_distributionâ€ è¡¨ç¤ºè¿œç¨‹ä¸»æœºçš„ç³»ç»Ÿå‘è¡Œç‰ˆï¼Œä»å…¶å¯¹åº”çš„å€¼å¯ä»¥çœ‹å‡ºlocalä¸»æœºçš„ç³»ç»Ÿå‘è¡Œç‰ˆä¸ºcentos</li>
<li>â€œansible_distribution_versionâ€ è¡¨ç¤ºè¿œç¨‹ä¸»æœºçš„ç³»ç»Ÿç‰ˆæœ¬å·ï¼Œä»å…¶å¯¹åº”çš„å€¼ä¸  â€œansible_distributionâ€ çš„å€¼å¯ä»¥çœ‹å‡ºlocalä¸»æœºçš„ç³»ç»Ÿç‰ˆæœ¬ä¸ºcentos7.4</li>
<li>â€œansible_ens35â€ è¡¨ç¤ºè¿œç¨‹ä¸»æœºens35ç½‘å¡çš„ç›¸å…³ä¿¡æ¯ï¼Œç»†å¿ƒå¦‚ä½ ä¸€å®šä¹Ÿå‘ç°äº†ï¼Œæˆ‘è¿˜æœ‰ä¸¤ä¸ªåä¸ºâ€ens33â€å’Œâ€ens34â€çš„ç½‘å¡ï¼Œåªä¸è¿‡ä¸ºäº†æ–¹ä¾¿ç¤ºä¾‹ï¼Œè¿™ä¸¤ä¸ªç½‘å¡çš„ä¿¡æ¯è¢«æˆ‘çœç•¥äº†ã€‚</li>
<li>â€œansible_memory_mbâ€ è¡¨ç¤ºè¿œç¨‹ä¸»æœºçš„å†…å­˜é…ç½®ä¿¡æ¯ã€‚</li>
</ul>
<p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å…³é”®å­—å¯¹ä¿¡æ¯è¿›è¡Œè¿‡æ»¤è¿˜èƒ½ä½¿ç”¨é€šé…ç¬¦è¿›è¡Œç›¸å¯¹æ¨¡ç³Šçš„è¿‡æ»¤:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ¯”å¦‚æˆ‘åªæ˜¯æƒ³è¦æŸ¥çœ‹è¿œç¨‹ä¸»æœºçš„å†…å­˜é…ç½®ä¿¡æ¯</span></span><br><span class="line">ansible <span class="built_in">local</span> -m setup -a <span class="string">'filter=ansible_memory_mb'</span>  <span class="comment">#é€šè¿‡setupæ¨¡å—çš„filterå‚æ•°å¯ä»¥æŒ‡å®šéœ€è¦è¿‡æ»¤çš„å…³é”®å­—</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç›¸å¯¹æ¨¡ç³Šçš„è¿‡æ»¤</span></span><br><span class="line">ansible <span class="built_in">local</span> -m setup -a <span class="string">"filter=*mb*"</span></span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°2 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190730093410.png" target="_blank" title="WeiyiGeek.setæ¨¡å—" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190730093410.png" alt="WeiyiGeek.setæ¨¡å—" title="" class=""></a>
                <p>WeiyiGeek.setæ¨¡å—</p>
            </figure></p>
<p>å…¶å®é™¤äº†è¿™äº›ä¿¡æ¯ä»¥å¤–è¿˜èƒ½å¤Ÿåœ¨è¿œç¨‹ä¸»æœºä¸­å†™å…¥ä¸€äº›è‡ªå®šä¹‰çš„ä¿¡æ¯ï¼Œè¿™äº›è‡ªå®šä¹‰ä¿¡æ¯ä¹Ÿå¯ä»¥è¢«setupæ¨¡å—æ”¶é›†åˆ°ã€‚<br><em>é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥åœ¨å“ªé‡Œå®šä¹‰è¿™äº›ä¿¡æ¯å‘¢ï¼Ÿè¯¥æ€æ ·å®šä¹‰è¿™äº›ä¿¡æ¯å‘¢ï¼Ÿ</em><br>ç­”ï¼šansible é»˜è®¤ä¼šå»ç›®æ ‡ä¸»æœºçš„ /etc/ansible/facts.d ç›®å½•ä¸‹æŸ¥æ‰¾ä¸»æœºä¸­çš„è‡ªå®šä¹‰ä¿¡æ¯ï¼Œå¹¶ä¸”è§„å®šè‡ªå®šä¹‰ä¿¡æ¯éœ€è¦å†™åœ¨ä»¥\â€.fact\â€ä¸ºåç¼€çš„æ–‡ä»¶ä¸­ï¼ŒåŒæ—¶è¿™äº›ä»¥â€.factâ€ä¸ºåç¼€çš„æ–‡ä»¶ä¸­çš„<code>å†…å®¹éœ€è¦æ˜¯INIæ ¼å¼æˆ–è€…æ˜¯jsonæ ¼å¼çš„</code>ã€‚</p>
<p>å½“setupæ”¶é›†è¿œç¨‹ä¸»æœºçš„â€local factsâ€æ—¶ï¼Œé»˜è®¤ä¼šæŸ¥æ‰¾è¿œç¨‹ä¸»æœºçš„<code>/etc/ansible/facts.d</code>ç›®å½•ï¼Œå¦‚æœä½ <code>æŠŠ&quot;local facts&quot;ä¿¡æ¯æ–‡ä»¶æ”¾åœ¨äº†å…¶ä»–è‡ªå®šä¹‰è·¯å¾„</code>ï¼Œåœ¨ä½¿ç”¨setupæ¨¡å—æ—¶ï¼Œéœ€è¦ä½¿ç”¨â€fact_pathâ€å‚æ•°æŒ‡å®šå¯¹åº”çš„è·¯å¾„ï¼›</p>
<p>é‚£ä¹ˆæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶è·¯å¾„ä¸ºlocalä¸»æœºçš„ <code>/etc/ansible/facts.d/testinfo.fact</code> åœ¨æ–‡ä»¶ä¸­å†™å…¥å¦‚ä¸‹INIæ ¼å¼çš„ä¿¡æ¯ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cat</span> testinfo.fact</span><br><span class="line"><span class="comment">#INIé£æ ¼çš„å†…å®¹æˆ‘åœ¨"[testmsg]"é…ç½®æ®µä¸­é…ç½®äº†ä¸¤æ¡è‡ªå®šä¹‰ä¿¡æ¯ï¼Œmsg1ä¸msg2ã€‚  </span></span><br><span class="line">[testmsg]</span><br><span class="line">msg1 = This is a demo1</span><br><span class="line">msg2 = This is a demo2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨jsonæ ¼å¼è¿›è¡Œé…ç½®,åªæ˜¯ä¹¦å†™æ ¼å¼ä¸åŒ /tmp/info.fact  ansible_local</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">"testmsg"</span>:&#123;</span><br><span class="line">       <span class="string">"msg1"</span>:<span class="string">"This is the first custom test message"</span>,</span><br><span class="line">       <span class="string">"msg2"</span>:<span class="string">"This is the second custom test message"</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é€šè¿‡ä¸Šè¿°æ–¹å¼åœ¨ç›®æ ‡ä¸»æœºçš„æœ¬åœ°è‡ªå®šä¹‰ä¿¡æ¯è¢«ç§°ä¸ºâ€local factsâ€ï¼Œå½“æˆ‘ä»¬è¿è¡Œsetupæ¨¡å—æ—¶ï¼Œ<code>è¿œç¨‹ä¸»æœºçš„&quot;local facts&quot;ä¿¡æ¯ä¹Ÿä¼šè¢«æ”¶é›†</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡â€ansible_localâ€å…³é”®å­—è¿‡æ»¤è¿œç¨‹ä¸»æœºçš„â€local factsâ€ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è·å–æœ¬åœ°è‡ªå®šä¹‰ä¿¡æ¯ (ä»é»˜è®¤ç›®å½•)</span></span><br><span class="line">ansible <span class="built_in">local</span> -m setup -a <span class="string">"filter=ansible_local"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å‡è®¾æˆ‘æŠŠ".fact"æ–‡ä»¶æ”¾åœ¨äº†ç›®æ ‡ä¸»æœºçš„"/tmp"ç›®å½•ä¸‹</span></span><br><span class="line">ansible <span class="built_in">local</span> -m setup -a <span class="string">"filter=ansible_local fact_path=/tmp"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="built_in">local</span> | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">"ansible_facts"</span>: &#123;</span><br><span class="line">        <span class="string">"ansible_local"</span>: &#123;</span><br><span class="line">            <span class="string">"testinfo"</span>: &#123;</span><br><span class="line">                <span class="string">"testmsg"</span>: &#123;</span><br><span class="line">                    <span class="string">"msg1"</span>: <span class="string">"This is a demo1"</span>,</span><br><span class="line">                    <span class="string">"msg2"</span>: <span class="string">"This is a demo2"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"discovered_interpreter_python"</span>: <span class="string">"/usr/bin/python"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"changed"</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">local</span> | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">"ansible_facts"</span>: &#123;</span><br><span class="line">        <span class="string">"ansible_local"</span>: &#123;</span><br><span class="line">            <span class="string">"info"</span>: &#123;</span><br><span class="line">                <span class="string">"testmsg"</span>: &#123;</span><br><span class="line">                    <span class="string">"msg1"</span>: <span class="string">"This is the first custom test message"</span>,</span><br><span class="line">                    <span class="string">"msg2"</span>: <span class="string">"This is the second custom test message"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"discovered_interpreter_python"</span>: <span class="string">"/usr/bin/python"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"changed"</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é™¤äº†ä¸Šé¢çš„setupæ¨¡å—æˆ‘ä»¬è¿˜èƒ½é‡‡ç”¨ï¼Œdebugæ¨¡å—çš„ä½œç”¨å°±æ˜¯å¸®åŠ©æˆ‘ä»¬è¿›è¡Œè°ƒè¯•å¹¶ä¸”æŠŠä¿¡æ¯è¾“å‡ºåˆ°ansibleæ§åˆ¶å°ä¸Šï¼Œä»¥ä¾¿æˆ‘ä»¬èƒ½å¤Ÿå®šä½é—®é¢˜ï¼›debugæ¨¡å—é™¤äº†èƒ½å¤Ÿä½¿ç”¨msgå‚æ•°è¾“å‡ºè‡ªå®šä¹‰çš„ä¿¡æ¯ï¼Œè¿˜èƒ½å¤Ÿé€šè¿‡debugæ¨¡å—ç›´æ¥è¾“å‡ºå˜é‡ä¿¡æ¯éœ€è¦ä½¿ç”¨varå‚æ•°</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªdebugæ¨¡å—çš„playbookå°ç¤ºä¾‹å¦‚ä¸‹ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  vars:</span></span><br><span class="line"><span class="attr">    testvar:</span> <span class="string">value</span> <span class="string">of</span> <span class="string">test</span> <span class="string">variable</span> <span class="number">1024</span>   <span class="comment">#å…³é”®1</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">touch</span> <span class="string">testfile</span></span><br><span class="line"><span class="attr">    file:</span></span><br><span class="line"><span class="attr">      path:</span> <span class="string">/tmp/testfile</span></span><br><span class="line"><span class="attr">      state:</span> <span class="string">touch</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">debug</span> <span class="string">demo</span></span><br><span class="line"><span class="attr">    debug:</span>  <span class="comment">#msgä¸­çš„å˜é‡å€¼éœ€è¦ä½¿ç”¨å¼•å·å¼•èµ·ï¼Œå› ä¸º&#123;&#123;testvar&#125;&#125;å˜é‡å‰åŒ…å«"å†’å·"ï¼Œå¦‚æœä¸ä½¿ç”¨å¼•å·ä¼šæŠ¥è¯­æ³•é”™è¯¯</span></span><br><span class="line"><span class="attr">      msg:</span> <span class="string">"this is debug info , <span class="template-variable">&#123;&#123;testvar&#125;&#125;</span> "</span> <span class="comment">#è¾“å‡ºè‡ªå®šä¹‰debugå­—ç¬¦ä¸²    #å…³é”®2</span></span><br><span class="line">      <span class="comment">#var: testvar  #é€šè¿‡debugçš„varå‚æ•°è¾“å‡ºäº†è¿™ä¸ªå˜é‡çš„å†…å®¹              #å…³é”®3 (ä¸msgä¸èƒ½åŒæ—¶ä½¿ç”¨)</span></span><br><span class="line"><span class="string">```</span> </span><br><span class="line"></span><br><span class="line"><span class="string">playè§£æï¼šæˆ‘ä»¬å…ˆåœ¨localä¸»æœºä¸Štouchäº†å¯¹åº”çš„æ–‡ä»¶,ä½¿ç”¨debugçš„msgå‚æ•°æ—¶ä¹Ÿå¯ä»¥å¼•ç”¨å˜é‡çš„å€¼å¹¶ä¸”è¾“å‡ºï¼Œç„¶ååˆ©ç”¨debugæ¨¡å—åœ¨æ§åˆ¶å°ä¸­è¾“å‡ºå˜é‡çš„åç§°ä»¥åŠå˜é‡çš„å€¼:</span></span><br><span class="line"><span class="string">```bash</span></span><br><span class="line"><span class="comment">#æ‰§è¡Œç»“æœ(1) - msg</span></span><br><span class="line"><span class="string">TASK</span> <span class="string">[debug</span> <span class="string">demo]</span></span><br><span class="line"><span class="attr">ok:</span> <span class="string">[local]</span> <span class="string">=&gt;</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "msg":</span> <span class="string">"this is debug info , value of test variable 1024 "</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰§è¡Œç»“æœ(2)- var</span></span><br><span class="line"><span class="string">TASK</span> <span class="string">[debug</span> <span class="string">demo]</span> </span><br><span class="line"><span class="attr">ok:</span> <span class="string">[local]</span> <span class="string">=&gt;</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "testvar":</span> <span class="string">"value of test variable 1024"</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>playbookåœ¨è¿è¡Œæ—¶é»˜è®¤è¿è¡Œâ€[Gathering Facts]â€ä»»åŠ¡ä¼šæ”¶é›†è¿œç¨‹ä¸»æœºçš„ç›¸å…³ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¼šä¿å­˜åœ¨å¯¹åº”çš„å˜é‡ä¸­ï¼Œæˆ‘ä»¬åœ¨playbookä¸­å¯ä»¥ä½¿ç”¨è¿™äº›å˜é‡ï¼Œä»è€Œåˆ©ç”¨è¿™äº›ä¿¡æ¯ï¼Œ<em>é‚£ä¹ˆæˆ‘ä»¬æ€æ ·åœ¨playbookè·å–åˆ°è¿™äº›å˜é‡çš„å€¼å‘¢ï¼Ÿ</em></p>
<p>åœ¨setupæ¨¡å—çš„ç¤ºä¾‹ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>&quot;ansible_memory_mb&quot;</code>å…³é”®å­—è·å–è¿œç¨‹ä¸»æœºçš„å†…å­˜ä¿¡æ¯ï¼Œå…¶å®åœ¨playbookä¸­ä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨â€ansible_memory_mbâ€å˜é‡å;<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  vars:</span></span><br><span class="line"><span class="attr">    test:</span> <span class="string">"Test: "</span>  <span class="comment">#å…³é”®ç‚¹</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">debug</span> <span class="string">demo</span></span><br><span class="line"><span class="attr">    debug:</span></span><br><span class="line"><span class="attr">      msg:</span> <span class="string">"<span class="template-variable">&#123;&#123;test&#125;&#125;</span> Remote host memory swap information: <span class="template-variable">&#123;&#123;ansible_memory_mb['swap']&#125;&#125;</span> \n, ip addrs info: <span class="template-variable">&#123;&#123;ansible_all_ipv4_addresses&#125;&#125;</span>"</span>  <span class="comment">#å…³é”®ç‚¹</span></span><br></pre></td></tr></table></figure><br>æˆ‘ä»¬è‡ªå®šä¹‰çš„ä¿¡æ¯ä¸­åŒ…å«äº†å˜é‡å†…å®¹,è¿œç¨‹ä¸»æœºçš„å†…å­˜ä¿¡æ¯/IPåœ°å€ä¿¡æ¯åŒæ—¶è¢«è¾“å‡ºäº†,æ‰§è¡Œç»“æœï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">TASK [debug demo] </span><br><span class="line">ok: [<span class="built_in">local</span>] =&gt; &#123;</span><br><span class="line">    <span class="string">"msg"</span>: <span class="string">"Test: Remote host memory swap information: &#123;u'cached': 0, u'total': 2047, u'free': 2047, u'used': 0&#125; \n, ip addrs info: [u'10.10.107.222', u'192.168.1.99']"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>å¦‚ä¸Šè¿°è¿”å›ä¿¡æ¯æ‰€ç¤ºï¼Œâ€ansible_memory_mbâ€ä¸­å…¶å®åŒ…å«äº†<code>&quot;nocache&quot;ã€&quot;real&quot;ã€ &quot;swap&quot;</code>ä¸‰ä¸ªéƒ¨åˆ†çš„ä¿¡æ¯ï¼Œå¦‚æœæˆ‘ä»¬åªæƒ³è·å¾—\â€real\â€éƒ¨åˆ†çš„ä¿¡æ¯ï¼Œåœ¨playbookä¸­å¼•ç”¨å˜é‡æ—¶å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä¸¤ç§è¯­æ³•ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³•ä¸€ç¤ºä¾‹ï¼š</span><br><span class="line">debug:</span><br><span class="line">     msg: <span class="string">"Remote host memory information : &#123;&#123;ansible_memory_mb.real&#125;&#125;"</span></span><br><span class="line">è¯­æ³•äºŒç¤ºä¾‹ï¼š</span><br><span class="line">debug:</span><br><span class="line">     msg: <span class="string">"Remote host memory information : &#123;&#123;ansible_memory_mb['real']&#125;&#125;"</span></span><br></pre></td></tr></table></figure></p>
<p><em>æ€»ç»“ï¼š</em></p>
<ul>
<li>å…¶å®setupæ¨¡å—è¿”å›çš„è¿™äº›ä¿¡æ¯éƒ½å­˜åœ¨äº†å¯¹åº”çš„å˜é‡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¼•ç”¨å˜é‡ä»è€Œä½¿ç”¨å¯¹åº”çš„ä¿¡æ¯;</li>
<li>å…¶å®debugæ¨¡å—å¸¸å¸¸ç”¨æ¥è°ƒè¯•playbook,è¾“å‡ºè‡ªå®šä¹‰å¼‚å¸¸ä»¥åŠsetupä¿¡æ¯æ”¶é›†çš„å˜é‡è¾“å‡º;</li>
</ul>
<p><br></p>
<h5 id="4-register-æ³¨å†Œå˜é‡"><a href="#4-register-æ³¨å†Œå˜é‡" class="headerlink" title="(4) register æ³¨å†Œå˜é‡"></a>(4) register æ³¨å†Œå˜é‡</h5><p>æè¿°ï¼šansibleçš„æ¨¡å—åœ¨è¿è¡Œä¹‹åå…¶å®éƒ½ä¼šè¿”å›ä¸€äº›â€è¿”å›å€¼â€ï¼Œåªæ˜¯é»˜è®¤æƒ…å†µä¸‹è¿™äº›â€è¿”å›å€¼â€å¹¶ä¸ä¼šæ˜¾ç¤ºè€Œå·²ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›è¿”å›å€¼å†™å…¥åˆ°æŸä¸ªå˜é‡ä¸­,ç„¶åé€šè¿‡å¼•ç”¨å¯¹åº”çš„å˜é‡ä»è€Œè·å–åˆ°è¿™äº›è¿”å›å€¼,<code>è¿™ç§å°†æ¨¡å—çš„è¿”å›å€¼å†™å…¥åˆ°å˜é‡ä¸­çš„æ–¹æ³•è¢«ç§°ä¸º&quot;æ³¨å†Œå˜é‡&quot;</code>;</p>
<p>è¿™äº›è¿”å›å€¼ä¸ä»…ä»…èƒ½å¤Ÿç”¨äºè¾“å‡ºé€šå¸¸æˆ‘ä»¬ä¼šåˆ©ç”¨åˆ°è¿™äº›è¿”å›å€¼ï¼Œæ¯”å¦‚é€šè¿‡æ¨¡å—çš„è¿”å›å€¼å†³å®šä¹‹åçš„ä¸€äº›åŠ¨ä½œï¼Œæ‰€ä»¥æ³¨å†Œå˜é‡åœ¨playbookä¸­è¿˜æ˜¯ä¼šè¢«ç»å¸¸ç”¨åˆ°çš„;</p>
<p>åŸºç¡€ç¤ºä¾‹ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ‰§è¡Œå‘½ä»¤è¿”å›ç»“æœåˆ©ç”¨ debug æŸ¥çœ‹</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  vars:</span></span><br><span class="line"><span class="attr">    cmd1:</span> <span class="string">whoami</span></span><br><span class="line"><span class="attr">    cmd2:</span> <span class="string">hostname</span> <span class="bullet">-I</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">execute</span> <span class="string">whoami</span></span><br><span class="line"><span class="attr">    shell:</span> <span class="string">"<span class="template-variable">&#123;&#123;cmd1&#125;&#125;</span>"</span> </span><br><span class="line"><span class="attr">    register:</span> <span class="string">who</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">execute</span> <span class="string">hostname</span></span><br><span class="line"><span class="attr">    shell:</span> <span class="string">"<span class="template-variable">&#123;&#123;cmd2&#125;&#125;</span>"</span></span><br><span class="line"><span class="attr">    register:</span> <span class="string">hostname</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">execute</span> <span class="string">echo</span></span><br><span class="line"><span class="attr">    shell:</span> <span class="string">"echo test &gt; /tmp/testshellfile"</span></span><br><span class="line"><span class="attr">    register:</span> <span class="string">echovar</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">Debug</span> <span class="string">shell</span> <span class="string">module</span> <span class="string">return</span> <span class="string">values</span></span><br><span class="line"><span class="attr">    debug:</span> </span><br><span class="line"><span class="attr">      var:</span> <span class="string">who,hostname,echovar</span>   <span class="comment">#å¯ä»¥è¾“å‡ºå¤šä¸ªå˜é‡é‡‡ç”¨","å·è¿›è¡Œåˆ†å‰²</span></span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœï¼š<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">TASK [Debug shell module return values] </span><br><span class="line">ok: [local] =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"who,hostname,echovar"</span>: <span class="string">"(</span></span><br><span class="line"><span class="string">    &#123;'stderr_lines': [],</span></span><br><span class="line"><span class="string">     u'changed': True,    #æ“ä½œæ ‡è¯†!</span></span><br><span class="line"><span class="string">     u'end': u'2019-07-30 11:31:13.821710',</span></span><br><span class="line"><span class="string">     'failed': False,     #æ‰§è¡ŒçŠ¶æ€</span></span><br><span class="line"><span class="string">     u'stdout': u'root',  #æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="string">     u'cmd': u'whoami',   #æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line"><span class="string">     u'rc': 0, </span></span><br><span class="line"><span class="string">     u'start': </span></span><br><span class="line"><span class="string">     u'2019-07-30 11:31:13.818264',</span></span><br><span class="line"><span class="string">     u'stderr': u'', </span></span><br><span class="line"><span class="string">     u'delta': u'0:00:00.003446', 'stdout_lines': [u'root']&#125;,</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     &#123;'stderr_lines': [], u'changed': True, u'end': u'2019-07-30 11:31:14.111808', 'failed': False, u'stdout': u'10.10.107.222 192.168.1.99 ', u'cmd': u'hostname -I', u'rc': 0, u'start': u'2019-07-30 11:31:14.108345', u'stderr': u'', u'delta': u'0:00:00.003463', 'stdout_lines': [u'10.10.107.222 192.168.1.99 ']&#125;, </span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">     &#123;'stderr_lines': [], u'changed': True, u'end': u'2019-07-30 11:31:14.367277', 'failed': False, u'stdout': u'', u'cmd': u'echo test &gt; /tmp/testshellfile', u'rc': 0, u'start': u'2019-07-30 11:31:14.364389', u'stderr': u'', u'delta': u'0:00:00.002888', 'stdout_lines': []&#125;)"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å‡è®¾æˆ‘åªæ˜¯æƒ³è¦è·å–åˆ°ä¸Šè¿°è¿”å›ä¿¡æ¯ä¸­cmdçš„å€¼åˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä¸¤ç§è¯­æ³•:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç¤ºä¾‹çš„è¿”å›ä¿¡æ¯ä¸ºshellæ¨¡å—çš„è¿”å›å€¼</span></span><br><span class="line"><span class="comment">#è¯­æ³•ä¸€</span></span><br><span class="line">  - name: shell module <span class="built_in">return</span> values</span><br><span class="line">    debug:</span><br><span class="line">      msg: <span class="string">"&#123;&#123;testvar.cmd&#125;&#125;"</span></span><br><span class="line"><span class="comment">#è¯­æ³•äºŒ</span></span><br><span class="line">  - name: shell module <span class="built_in">return</span> values</span><br><span class="line">    debug:</span><br><span class="line">      msg: <span class="string">"&#123;&#123;testvar['cmd']&#125;&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºå¯é‡‡ç”¨debugæ¨¡å—çš„msgè¿›è¡Œè¿‡æ»¤è°ƒç”¨è¾“å‡º,æ›´åŠ çš„ç®€æ´æ–¹ä¾¿;</span></span><br></pre></td></tr></table></figure></p>
<p><em>å‚è€ƒæ¥æºï¼š</em></p>
<ul>
<li>Ansible2.8[è¿”å›å€¼å«ä¹‰] - <a href="https://docs.ansible.com/ansible/latest/reference_appendices/common_return_values.html" target="_blank" rel="noopener">https://docs.ansible.com/ansible/latest/reference_appendices/common_return_values.html</a></li>
</ul>
<p><br></p>
<h5 id="5-prompt-æç¤ºè¾“å…¥å†™å…¥å˜é‡"><a href="#5-prompt-æç¤ºè¾“å…¥å†™å…¥å˜é‡" class="headerlink" title="(5) prompt æç¤ºè¾“å…¥å†™å…¥å˜é‡"></a>(5) prompt æç¤ºè¾“å…¥å†™å…¥å˜é‡</h5><p>æè¿°ï¼šåœ¨æŸäº›äº¤æ¢å¼æ“ä½œçš„æ—¶å€™,è„šæœ¬ä¼šæç¤ºç”¨æˆ·è¾“å…¥ä¸€äº›ä¿¡æ¯ï¼Œè„šæœ¬éœ€è¦æ ¹æ®ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯å†³å®šä¸‹ä¸€æ­¥çš„åŠ¨ä½œ</p>
<p><em>é‚£ä¹ˆåœ¨playbookä¸­è¯¥æ€æ ·å®ç°è¿™ç§äº¤äº’å‘¢ï¼Ÿ</em><br>ç­”:æˆ‘ä»¬å¯ä»¥è¿™æ ·åšæç¤ºç”¨æˆ·è¾“å…¥ä¿¡æ¯ï¼Œç„¶åå°†ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯å­˜å…¥åˆ°æŒ‡å®šçš„å˜é‡ä¸­ï¼Œå½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨è¿™äº›â€è¾“å…¥çš„ä¿¡æ¯â€æ—¶ï¼Œåªè¦å¼•ç”¨å¯¹åº”çš„å˜é‡å³å¯ã€‚</p>
<p>ç¤ºä¾‹è§£æï¼šä½¿ç”¨<code>&quot;vars_prompt&quot;</code>å…³é”®å­—åˆ›å»ºäº†ä¸¤ä¸ªå˜é‡ï¼Œä¸¤ä¸ªå˜é‡çš„åç§°åˆ†åˆ«ä¸ºâ€your_nameâ€ å’Œ â€œyour_ageâ€,å½“ç”¨æˆ·è¾“å…¥åå­—ç¬¦ä¸²å°†è¢«å­˜å…¥å˜é‡ä¹‹ä¸­;</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  vars_prompt:</span> </span><br><span class="line"><span class="attr">    - name:</span> <span class="string">"Username"</span>               <span class="comment">#å˜é‡åç§°</span></span><br><span class="line"><span class="attr">      prompt:</span> <span class="string">"What is your name"</span>   <span class="comment">#äº¤äº’å¼è¾“å…¥æç¤º</span></span><br><span class="line"><span class="attr">      private:</span> <span class="literal">no</span>                     <span class="comment">#æ˜¯å¦éšç§˜ï¼šé»˜è®¤Yes(ä¸æ˜¾ç¤ºè¾“å…¥)/no(æ˜¾ç¤ºè¾“å…¥))</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">"Password"</span></span><br><span class="line"><span class="attr">      prompt:</span> <span class="string">"What is your password"</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">"Sex"</span>                    <span class="comment">#å¤šé€‰é¡¹é€‰é¡¹</span></span><br><span class="line"><span class="attr">      prompt:</span> <span class="string">"Choose the you Sex \n</span></span><br><span class="line"><span class="string">      m: Man\n</span></span><br><span class="line"><span class="string">      w: Woman\n</span></span><br><span class="line"><span class="string">      o: other\n"</span></span><br><span class="line"><span class="attr">      private:</span> <span class="literal">no</span></span><br><span class="line"><span class="attr">      default:</span> <span class="string">o</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">"PayPass"</span>               <span class="comment">#åŠ å¯†è¾“å…¥ä»¥å“ˆå¸Œå¯†ç è¾“å‡º (å¯ä»¥ç›´æ¥åˆ›å»ºlinuxç³»ç»Ÿç”¨æˆ·å’Œè®¾ç½®å¯†ç )</span></span><br><span class="line"><span class="attr">      prompt:</span> <span class="string">"Enter Pay PassWord"</span></span><br><span class="line"><span class="attr">      private:</span> <span class="literal">no</span>                    <span class="comment">#å¯æŸ¥çœ‹è¾“å…¥</span></span><br><span class="line"><span class="attr">      unsafe:</span> <span class="literal">yes</span>                    <span class="comment">#æ”¯æŒè¾“å…¥ç‰¹æ®Šå­—ç¬¦ æ¯”å¦‚ï¼š &#123; % ç­‰ansbileå«ä¹‰ç¬¦å· - 2.8 add</span></span><br><span class="line"><span class="attr">      encrypt:</span> <span class="string">"sha512_crypt"</span>        <span class="comment">#å…³é”®ç‚¹-encryptå…³é”®å­—è¡¨ç¤ºå¯¹ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯è¿›è¡Œå“ˆå¸Œ</span></span><br><span class="line"><span class="attr">      confirm:</span> <span class="literal">yes</span>   <span class="comment">#å…³é”®ç‚¹-é€šè¿‡"confirm"å…³é”®å­—å°±èƒ½å®ç°éœ€è¦è¾“å…¥ä¸¤æ¬¡å®Œå…¨ç›¸åŒçš„å¯†ç ï¼Œæ‰èƒ½å¤Ÿè®¾ç½®æˆåŠŸ</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">   - name:</span> <span class="string">output</span> <span class="string">prompt</span> <span class="string">vars</span>   <span class="comment">#ä»»åŠ¡åç§°</span></span><br><span class="line"><span class="attr">     debug:</span></span><br><span class="line"><span class="attr">      msg:</span> <span class="string">"Username = <span class="template-variable">&#123;&#123;Username&#125;&#125;</span> , Password = <span class="template-variable">&#123;&#123;Password&#125;&#125;</span>,  Sex = <span class="template-variable">&#123;&#123;Sex&#125;&#125;</span>, Pay Password = <span class="template-variable">&#123;&#123;PayPass&#125;&#125;</span>"</span></span><br><span class="line"><span class="attr">   - name:</span> <span class="string">create</span> <span class="string">user</span>    <span class="comment">#åˆ›å»ºç”¨æˆ·</span></span><br><span class="line"><span class="attr">     user:</span></span><br><span class="line"><span class="attr">       name:</span> <span class="string">"<span class="template-variable">&#123;&#123;Username&#125;&#125;</span>"</span></span><br><span class="line"><span class="attr">       password:</span> <span class="string">"<span class="template-variable">&#123;&#123;PayPass&#125;&#125;</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æœªå®‰è£…passlibæ”¯æŒçš„ encrypt åŠ å¯†æ–¹å¼  2.7 ç‰ˆæœ¬æ–°å¢</span></span><br><span class="line"><span class="string">bcrypt</span> <span class="bullet">-</span> <span class="string">BCrypt</span></span><br><span class="line"><span class="string">md5_crypt</span> <span class="bullet">-</span> <span class="string">MD5</span> <span class="string">Crypt</span></span><br><span class="line"><span class="string">sha256_crypt</span> <span class="bullet">-</span> <span class="string">SHA-256</span> <span class="string">Crypt</span></span><br><span class="line"><span class="string">sha512_crypt</span> <span class="bullet">-</span> <span class="string">SHA-512</span> <span class="string">Crypt</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$ansible-playbook</span> <span class="string">prompt.yml</span></span><br><span class="line"><span class="string">What</span> <span class="string">is</span> <span class="string">your</span> <span class="attr">name:</span> <span class="string">Weiyegeek</span></span><br><span class="line"><span class="string">What</span> <span class="string">is</span> <span class="string">your</span> <span class="attr">password:</span></span><br><span class="line"><span class="string">Choose</span> <span class="string">the</span> <span class="string">you</span> <span class="attr">Sex:</span></span><br><span class="line"><span class="attr"> m:</span> <span class="string">Man</span></span><br><span class="line"><span class="attr"> w:</span> <span class="string">Woman</span></span><br><span class="line"><span class="attr"> o:</span> <span class="string">other</span></span><br><span class="line"> <span class="string">[o]:</span> <span class="string">m</span></span><br><span class="line"><span class="string">Enter</span> <span class="string">Pay</span> <span class="attr">PassWord:</span> <span class="string">Wei123456</span></span><br><span class="line"><span class="string">confirm</span> <span class="string">Enter</span> <span class="string">Pay</span> <span class="attr">PassWord:</span> <span class="string">Wei123456</span></span><br><span class="line"></span><br><span class="line"><span class="string">PLAY</span> <span class="string">[local]</span> </span><br><span class="line"><span class="string">TASK</span> <span class="string">[Gathering</span> <span class="string">Facts]</span></span><br><span class="line"><span class="attr">ok:</span> <span class="string">[local]</span></span><br><span class="line"></span><br><span class="line"><span class="string">TASK</span> <span class="string">[output</span> <span class="string">prompt</span> <span class="string">vars]</span> </span><br><span class="line"><span class="attr">ok:</span> <span class="string">[local]</span> <span class="string">=&gt;</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "msg":</span> <span class="string">"Username = Weiyegeek , Password = weiyegeek,  Sex = m, Pay Password = $6$WDmSQbaDomZyzbbm$MHXVXALnaZ4oKkptiFi/CYlQJWxrUD4xxHmvSjvZSKqr/4hvmaA/h/JKLIUZL.YZDQXx53EAOp.BgJLPltnxw1"</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="string">TASK</span> <span class="string">[create</span> <span class="string">user]</span> </span><br><span class="line"><span class="attr">changed:</span> <span class="string">[local]</span></span><br><span class="line"><span class="string">PLAY</span> <span class="string">RECAP</span> </span><br><span class="line"><span class="string">local</span> <span class="string">:</span> <span class="string">ok=3</span>  <span class="string">changed=1</span>  <span class="string">unreachable=0</span>  <span class="string">failed=0</span>  <span class="string">skipped=0</span>  <span class="string">rescued=0</span>  <span class="string">ignored=0</span></span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°2 href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190730144557.png" target="_blank" title="WeiyiGeek.prompt-createuser" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190730144557.png" alt="WeiyiGeek.prompt-createuser" title="" class=""></a>
                <p>WeiyiGeek.prompt-createuser</p>
            </figure>
<p><em>æ³¨æ„äº‹é¡¹ï¼š</em></p>
<ul>
<li>å½“ä½¿ç”¨â€encryptâ€å…³é”®å­—å¯¹å­—ç¬¦ä¸²è¿›è¡Œå“ˆå¸Œæ—¶ï¼Œansibleéœ€è¦ä¾èµ–Pythonçš„passlibåº“å®Œæˆå“ˆå¸Œæ“ä½œï¼Œ<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install passlib  <span class="comment"># æˆ–è€… pip install passlib</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å®‰è£…åå¯ä½¿ç”¨çš„åŠ å¯†æ–¹å¼</span></span><br><span class="line">des_crypt - DES Crypt</span><br><span class="line">bsdi_crypt - BSDi Crypt</span><br><span class="line">bigcrypt - BigCrypt</span><br><span class="line">crypt16 - Crypt16</span><br><span class="line">md5_crypt - MD5 Crypt</span><br><span class="line">bcrypt - BCrypt</span><br><span class="line">sha1_crypt - SHA<span class="number">-1</span> Crypt</span><br><span class="line">sun_md5_crypt - Sun MD5 Crypt</span><br><span class="line">sha256_crypt - SHA<span class="number">-256</span> Crypt</span><br><span class="line">sha512_crypt - SHA<span class="number">-512</span> Crypt</span><br><span class="line">apr_md5_crypt - Apacheâ€™s MD5-Crypt variant</span><br><span class="line">phpass - PHPassâ€™ Portable Hash</span><br><span class="line">pbkdf2_digest - Generic PBKDF2 Hashes</span><br><span class="line">cta_pbkdf2_sha1 - Cryptacularâ€™s PBKDF2 hash</span><br><span class="line">dlitz_pbkdf2_sha1 - Dwayne Litzenbergerâ€™s PBKDF2 hash</span><br><span class="line">scram - SCRAM Hash</span><br><span class="line">bsd_nthash - FreeBSDâ€™s MCF-compatible nthash encoding</span><br></pre></td></tr></table></figure></li>
<li>å®˜æ–¹æ–‡æ¡£[prompt]ï¼š<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_prompts.html" target="_blank" rel="noopener">https://docs.ansible.com/ansible/latest/user_guide/playbooks_prompts.html</a></li>
</ul>
<p><br></p>
<h5 id="6-â€“extra-vars-å‘½ä»¤è¡Œä¼ é€’å˜é‡"><a href="#6-â€“extra-vars-å‘½ä»¤è¡Œä¼ é€’å˜é‡" class="headerlink" title="(6) â€“extra-vars å‘½ä»¤è¡Œä¼ é€’å˜é‡"></a>(6) â€“extra-vars å‘½ä»¤è¡Œä¼ é€’å˜é‡</h5><p>æè¿°ï¼šé™¤äº†ä¸Šé¢å®šä¹‰å˜é‡çš„æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜èƒ½å¤Ÿåœ¨æ‰§è¡Œplaybookæ—¶ç›´æ¥ä¼ å…¥éœ€è¦ä½¿ç”¨çš„å˜é‡;</p>
<p>æ¯”å¦‚ä¸‹é¢å†playbookä¸­å¹¶æ²¡æœ‰å®šä¹‰å˜é‡ä½†æˆ‘ä»¬å¯ä»¥åœ¨è°ƒç”¨playbookæ—¶ç›´æ¥ä»å‘½ä»¤è¡Œä¼ å…¥å˜é‡,æœåœ¨è°ƒç”¨playbookæ—¶ä¹Ÿæ²¡æœ‰ä¼ å…¥å˜é‡åˆ™ä¼šæŠ¥é”™ï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥å…ˆåœ¨playbookä¸­å®šä¹‰å¥½å˜é‡ï¼Œç„¶ååœ¨æ‰§è¡Œplaybookæ—¶ä»¥ä¼ å…¥å˜é‡è¦†ç›–playbookä¸­çš„å˜é‡å€¼ï¼ˆå‰ææ˜¯å‘½ä»¤è¡Œä¸­çš„å˜é‡ä¸playä¸­çš„å˜é‡é‡åï¼‰ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#cat extravars.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  vars:</span></span><br><span class="line"><span class="attr">    verify:</span> <span class="string">"123456"</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">"Passing Variables On The Command Line"</span></span><br><span class="line"><span class="attr">    debug:</span></span><br><span class="line"><span class="attr">      msg:</span> <span class="string">"<span class="template-variable">&#123;&#123;ip&#125;&#125;</span> - <span class="template-variable">&#123;&#123;Port&#125;&#125;</span> - <span class="template-variable">&#123;&#123;service&#125;&#125;</span> , Verify: <span class="template-variable">&#123;&#123;verify&#125;&#125;</span>"</span>  <span class="comment">#</span></span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸‰ç§æ–¹å¼æ•ˆæœç›¸åŒ</span></span><br><span class="line">ansible-playbook extravars.yml --extra-vars <span class="string">'ip="192.168.1.1" Port="8080" service="nginx" verify="888888"'</span></span><br><span class="line">ansible-playbook extravars.yml -e <span class="string">'ip="192.168.1.1" Port="8080" service="nginx" verify="888888"'</span></span><br><span class="line">ansible-playbook extravars.yml -e <span class="string">'&#123;"ip":"192.168.1.1","Port":"8080","service":"nginx","verify":"888888"&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰§è¡Œç»“æœï¼š</span></span><br><span class="line">ok: [<span class="built_in">local</span>] =&gt; &#123;</span><br><span class="line">    <span class="string">"msg"</span>: <span class="string">"192.168.1.1 - 8080 - nginx , Verify: 888888"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>å‘½ä»¤è¡Œä¼ å…¥å˜é‡æ–‡ä»¶</strong><br>æè¿°:å‘½ä»¤è¡Œ<code>ä¸ä»…èƒ½å¤Ÿä¼ å…¥å˜é‡è¿˜èƒ½ä¼ å…¥å˜é‡æ–‡ä»¶</code>ï¼Œå˜é‡æ–‡ä»¶ä¸­çš„å˜é‡éƒ½ä¼šä¸€å¹¶è¢«ä¼ å…¥ï¼Œå˜é‡æ–‡ä»¶å¯ä»¥æ˜¯jsonæ ¼å¼çš„/YAMLæ ¼å¼çš„ï¼Œæ­¤å¤„ä½¿ç”¨YAMLæ ¼å¼çš„å˜é‡æ–‡ä»¶è¿›è¡Œç¤ºä¾‹<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat &gt; filevars.yml &lt;&lt;end</span></span><br><span class="line"><span class="attr">testvar:</span> <span class="string">testvarinfile</span></span><br><span class="line"><span class="attr">countlist:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">one</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">two</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">three</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">four</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#playbookçš„å†…å®¹å¦‚ä¸‹</span></span><br><span class="line"><span class="comment">#cat &gt; filevariable.yml &lt;&lt;END</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">"Passing Variables On The Command Line"</span></span><br><span class="line"><span class="attr">    debug:</span></span><br><span class="line"><span class="attr">      msg:</span> <span class="string">"<span class="template-variable">&#123;&#123;testvar&#125;&#125;</span> <span class="template-variable">&#123;&#123;countlist[0]&#125;&#125;</span>"</span></span><br><span class="line"><span class="string">END</span></span><br></pre></td></tr></table></figure></p>
<p><em>é‚£ä¹ˆæˆ‘ä»¬æ€æ ·ä»å‘½ä»¤è¡Œä¸­å°†å˜é‡æ–‡ä»¶ä¸­çš„å˜é‡ä¼ å…¥playbookå‘¢ï¼Ÿ</em><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä½¿ç”¨"@"ç¬¦å·åŠ ä¸Šå˜é‡æ–‡ä»¶çš„è·¯å¾„ï¼Œå³å¯åœ¨å‘½ä»¤è¡Œä¸­ä¼ å…¥å¯¹åº”çš„å˜é‡æ–‡ä»¶ï¼Œå˜é‡æ–‡ä»¶ä¸­çš„æ‰€æœ‰å˜é‡éƒ½å¯ä»¥åœ¨playbookä¸­å¼•ç”¨</span></span><br><span class="line">ansible-playbook filevariable.yml -e <span class="string">"@/root/filevars.yml"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰§è¡Œç»“æœ</span></span><br><span class="line">TASK [Passing Variables On The Command Line]</span><br><span class="line">ok: [<span class="built_in">local</span>] =&gt; &#123;</span><br><span class="line">    <span class="string">"msg"</span>: <span class="string">"testvarinfile one"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>æ€»ç»“ï¼š</strong></p>
<ul>
<li>å‘½ä»¤è¡Œä¼ å…¥çš„å˜é‡çš„ä¼˜å…ˆçº§è¦é«˜äºplaybookä¸­çš„å˜é‡ï¼Œé€šè¿‡è¿™ç§æ–¹æ³•æˆ‘ä»¬å°±èƒ½å¤Ÿæ›´åŠ çµæ´»çš„æŒ‡å®šå˜é‡çš„å€¼äº†ã€‚</li>
<li>å‘½ä»¤è¡Œä¼ å…¥jsonå­—ç¬¦ä¸²æ¥è®¾ç½®å˜é‡<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é€šè¿‡jsonæ ¼å¼ä¼ å…¥ä¸¤ä¸ªå˜é‡</span></span><br><span class="line">ansible-playbook cmdvar.yml -e <span class="string">'&#123;"testvar":"test","testvar1":"test1"&#125;'</span></span><br><span class="line">ansible-playbook cmdvar.yml -e <span class="string">'&#123;"countlist":["one","two","three","four"]&#125;'</span> <span class="comment">#ä½¿ç”¨ä¸¤ç§è¯­æ³•å¼•ç”¨å˜é‡ &#123;&#123;countlist[0]&#125;&#125; æˆ–è€… &#123;&#123;countlist.0&#125;&#125;</span></span><br></pre></td></tr></table></figure></li>
<li>å‘½ä»¤è¡Œå¯ä»¥ä¼ å…¥å•ä¸ªæˆ–è€…å¤šä¸ªå˜é‡ä¹Ÿèƒ½ä¼ å…¥å˜é‡æ–‡æœ¬æ–‡ä»¶é‡‡ç”¨-eé€‰é¡¹ç›´æ¥æå®š;</li>
</ul>
<p><br></p>
<h5 id="7-å˜é‡ä½¿ç”¨æ–¹æ³•-set-fact"><a href="#7-å˜é‡ä½¿ç”¨æ–¹æ³•-set-fact" class="headerlink" title="(7) å˜é‡ä½¿ç”¨æ–¹æ³• set_fact"></a>(7) å˜é‡ä½¿ç”¨æ–¹æ³• set_fact</h5><p>æè¿°ï¼šåœ¨æ¸…å•ä¸­é…ç½®å˜é‡ï¼Œæˆ‘ä»¬çŸ¥é“å¯ä»¥åœ¨æ¸…å•ä¸­é…ç½®éœ€è¦è¢«ç®¡ç†çš„è¿œç¨‹ä¸»æœºï¼Œä¹Ÿå¯ä»¥å°†éƒ¨åˆ†è¿œç¨‹ä¸»æœºåˆ†ä¸ºä¸€ç»„ï¼Œå…¶å®åœ¨é…ç½®æ¸…å•æ—¶è¿˜<code>å¯ä»¥ä¸ºä¸»æœºæˆ–ä¸»æœºç»„è®¾ç½®å˜é‡</code>;</p>
<p><strong>ä¸»æœºå˜é‡</strong><br>åœ¨æ¸…å•ä¸­é…ç½®è¿œç¨‹ä¸»æœºæ—¶ï¼Œå¯ä»¥åŒæ—¶ä¸ºä¸»æœºé…ç½®å¯¹åº”çš„å˜é‡ï¼Œå½“æ“ä½œè¿™ä¸ªä¸»æœºæ—¶å³å¯ç›´æ¥ä½¿ç”¨å¯¹åº”çš„å˜é‡ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/etc/ansible/hosts</span></span><br><span class="line"><span class="comment">#[ini] æ ¼å¼</span></span><br><span class="line"><span class="comment">#ç¤ºä¾‹1.åªè¦åœ¨å®šä¹‰ä¸»æœºæ—¶å°†å˜é‡åå’Œå˜é‡å€¼å†™åœ¨ä¸»æœºé…ç½®çš„åé¢å³å¯ï¼Œå¯ä»¥ä¸ºä¸€ä¸ªä¸»æœºå®šä¹‰å¤šä¸ªä¸»æœºå˜é‡ï¼Œç”¨ç©ºæ ¼éš”å¼€å³å¯</span></span><br><span class="line"><span class="built_in">local</span> ansible_host=10.1.1.70 testhostvar=test70_host_var testvar1=testvar1</span><br><span class="line"></span><br><span class="line"><span class="comment">#[yaml] æ ¼å¼</span></span><br><span class="line">all:</span><br><span class="line"> hosts:</span><br><span class="line">   test70:</span><br><span class="line">     ansible_host: 10.1.1.70</span><br><span class="line">     ansible_port: 22</span><br><span class="line">     testhostvar: test70_host_var</span><br><span class="line">     testhostvar1: test70_host_var1</span><br><span class="line">     testhostvar2:</span><br><span class="line">       thv1: demo1</span><br><span class="line">       thv2: demo2</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ansible <span class="built_in">local</span> -m shell -a <span class="string">"echo -e Testhostvar = &#123;&#123;testhostvar&#125;&#125;, \n Testhostvar1 = &#123;&#123;testhostvar1&#125;&#125; , testhostvar2.thv1 = &#123;&#123;testhostvar2['thv2']&#125;&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># local | CHANGED | rc=0 &gt;&gt;</span></span><br><span class="line"><span class="comment"># Testhostvar = testhostvar2048, n Testhostvar1 = testvar1024 , testhostvar2.thv1 = demo2</span></span><br></pre></td></tr></table></figure></p>
<p><em>æ³¨æ„ï¼š</em> ä¸»æœºå˜é‡çš„ç”Ÿæ•ˆèŒƒå›´åªé™äºå¯¹åº”çš„ä¸»æœº</p>
<p><br></p>
<p><strong>ä¸»æœºç»„å˜é‡</strong><br>åœ¨æ¸…å•ä¸­æˆ‘ä»¬èƒ½å°†å¤šä¸ªä¸»æœºåˆ†ä¸ºä¸€ç»„æ–¹ä¾¿æˆ‘ä»¬æˆæ‰¹çš„æ“ä½œè¿œç¨‹ä¸»æœºï¼ŒåŒæ ·æˆ‘ä¹Ÿå¯ä»¥å°†å˜é‡é…ç½®æ˜¯åˆ°ç»„é‡Œé¢;ä½¿ç”¨varså…³é”®å­—å¯ä»¥æŒ‡å®šç»„å˜é‡ï¼Œvarså…³é”®å­—ä½äºå¯¹åº”ç»„çš„ä¸‹ä¸€çº§<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#[ini] æ ¼å¼</span></span><br><span class="line">[testB]</span><br><span class="line">test70 ansible_host=10.1.1.70</span><br><span class="line">test71 anisble_host=10.1.1.71</span><br><span class="line"> </span><br><span class="line">[testB:vars]</span><br><span class="line">test_group_var1=<span class="string">'group var test'</span></span><br><span class="line">test_group_var2=<span class="string">'group var test2'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#[YAML] æ ¼å¼</span></span><br><span class="line">all:</span><br><span class="line"> children:</span><br><span class="line">   testB:</span><br><span class="line">     hosts:</span><br><span class="line">       test70:</span><br><span class="line">         ansible_host: 10.1.1.70</span><br><span class="line">         ansible_port: 22</span><br><span class="line">       test71:</span><br><span class="line">         ansible_host: 10.1.1.71</span><br><span class="line">         ansible_port: 22</span><br><span class="line">     vars:</span><br><span class="line">       test_group_var1: <span class="string">'group var test1'</span></span><br><span class="line">       test_group_var2: <span class="string">'group var test2'</span></span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ansible</span> ops -m shell -a <span class="string">"echo -e test_group_var1= &#123;&#123;test_group_var1&#125;&#125;, \n test_group_var2 = &#123;&#123;test_group_var2&#125;&#125;"</span></span><br><span class="line"><span class="comment"># 10.20.172.179 | CHANGED | rc=0 &gt;&gt;</span></span><br><span class="line"><span class="comment"># test_group_var1=group var test1, test_group_var2 =group var test2</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>set_factå®šä¹‰å˜é‡</strong><br>æè¿°ï¼šset_factæ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡set_factæ¨¡å—åœ¨tasksä¸­å®šä¹‰å˜é‡,å¹¶ä¸”ä¸registerçš„åŠŸèƒ½å¾ˆç›¸ä¼¼ï¼Œä¹Ÿæ˜¯å°†å€¼èµ‹å€¼ç»™å˜é‡ã€‚å®ƒæ›´åƒshellä¸­å˜é‡çš„èµ‹å€¼æ–¹å¼ï¼Œå¯ä»¥å°†æŸä¸ªå˜é‡çš„å€¼èµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡ï¼Œä¹Ÿå¯ä»¥å°†å­—ç¬¦ä¸²èµ‹å€¼ç»™å˜é‡ã€‚</p>
<p>å…¶å®é€šè¿‡set_factæ¨¡å—åˆ›å»ºçš„å˜é‡è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šæ€§ï¼Œé€šè¿‡set_factåˆ›å»ºçš„å˜é‡å°±åƒä¸»æœºä¸Šçš„factsä¿¡æ¯ä¸€æ ·<code>å¯ä»¥åœ¨ä¹‹åçš„playä¸­è¢«å¼•ç”¨</code>,è€Œç›´æ¥åœ¨playä¸­é‡‡ç”¨varsè®¾ç½®å˜é‡åªèƒ½åœ¨å½“å‰ä¸»æœº</p>
<p>åŸºç¡€ç¤ºä¾‹ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat &gt; setfact.yml&lt;&lt;end</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  vars:</span></span><br><span class="line"><span class="attr">    testvar1:</span> <span class="string">tv1</span>    <span class="comment">#å…³é”®ç‚¹-åªèƒ½åœ¨å½“å‰ä¸»æœºä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">"test shell return variable"</span></span><br><span class="line"><span class="attr">    shell:</span> <span class="string">"echo setfact module"</span></span><br><span class="line"><span class="attr">    register:</span> <span class="string">revar</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">setfact</span> <span class="string">moudle</span> <span class="string">setting</span></span><br><span class="line"><span class="attr">    set_fact:</span></span><br><span class="line"><span class="attr">      testvar2:</span> <span class="string">tv2</span>  <span class="comment">#å…³é”®ç‚¹-å¯ä»¥åœ¨éšåçš„playä¸­ä»»æ„ä¸»æœºè°ƒç”¨ä½¿ç”¨</span></span><br><span class="line"><span class="attr">      testvar3:</span> <span class="string">"<span class="template-variable">&#123;&#123;revar.cmd&#125;&#125;</span>"</span>  <span class="comment">#å…³é”®ç‚¹-å˜é‡ç»™å˜é‡èµ‹å€¼</span></span><br><span class="line"><span class="attr">      cacheable:</span> <span class="literal">yes</span>  <span class="comment">#ç¤ºä¾‹è®¾ç½®äº‹å®ï¼Œä»¥ä¾¿å®ƒä»¬å°†ä¿ç•™åœ¨äº‹å®ç¼“å­˜ä¸­</span></span><br><span class="line"><span class="attr">  - debug:</span></span><br><span class="line"><span class="attr">      msg:</span> <span class="string">"Local host : <span class="template-variable">&#123;&#123;testvar1&#125;&#125;</span> - <span class="template-variable">&#123;&#123;testvar2&#125;&#125;</span> -  <span class="template-variable">&#123;&#123;testvar3&#125;&#125;</span> - <span class="template-variable">&#123;&#123;revar.cmd&#125;&#125;</span>"</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">"other play get testvar2"</span></span><br><span class="line"><span class="attr">    debug:</span></span><br><span class="line"><span class="attr">      msg:</span> <span class="string">"<span class="template-variable">&#123;&#123;testvar2&#125;&#125;</span>"</span>  <span class="comment">#æœ‰set_factæ¨¡å—åˆ›å»ºå¯ä»¥è¢«ç¬¬äºŒä¸ªplayå¼•ç”¨</span></span><br><span class="line">  <span class="comment"># - name: "other play get testvar1"   </span></span><br><span class="line">  <span class="comment">#   debug:</span></span><br><span class="line">  <span class="comment">#     msg: "&#123;&#123;testvar1&#125;&#125;"   #ä¸èƒ½è¢«ç¬¬äºŒplayå¼•ç”¨ä¼šæŠ¥é”™(æ‰€ä»¥è¿™é‡Œæ³¨é‡Šä¸€å“ˆ)</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">"other play get testvar3"</span></span><br><span class="line"><span class="attr">    debug:</span></span><br><span class="line"><span class="attr">      msg:</span> <span class="string">"<span class="template-variable">&#123;&#123;testvar3&#125;&#125;</span>"</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">"show execute command"</span></span><br><span class="line"><span class="attr">    debug:</span></span><br><span class="line"><span class="attr">      msg:</span> <span class="string">"<span class="template-variable">&#123;&#123;revar.cmd&#125;&#125;</span>"</span>   <span class="comment">#æ³¨å†Œçš„å˜é‡ä¹Ÿèƒ½åœ¨ç¬¬äºŒä¸ªplayä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="string">end</span></span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ansible</span>-playbook setfact.yml</span><br><span class="line"><span class="comment"># TASK [debug]</span></span><br><span class="line"><span class="comment">#     "msg": "Local host : tv1 - tv2 -  echo setfact module - echo setfact module"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># TASK [other play get testvar2] </span></span><br><span class="line"><span class="comment">#     "msg": "tv2"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># TASK [other play get testvar3] </span></span><br><span class="line"><span class="comment">#     "msg": "echo setfact module"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ok: [local] </span></span><br><span class="line"><span class="comment">#     "msg": "echo setfact modu</span></span><br></pre></td></tr></table></figure></p>
<p><em>æ€»ç»“ï¼š</em></p>
<ul>
<li>shellæ¨¡å—æ³¨å†Œå˜é‡åœ¨å…¨å±€playä¸­çš†å¯ç”¨,ä½†æ˜¯ä¸æ˜¯å˜é‡è‡ªå®šä¹‰ä¿¡æ¯;</li>
<li>set_factæ¨¡å—ä¸­å»ºç«‹çš„å˜é‡æˆ–è€…å¼•ç”¨çš„å˜é‡åœ¨å…¨å±€ä¸­å³å¯ç”¨</li>
<li>è¡¥å……å‚è€ƒï¼š<a href="https://www.cnblogs.com/f-ck-need-u/p/7571974.html#1" target="_blank" rel="noopener">https://www.cnblogs.com/f-ck-need-u/p/7571974.html#1</a></li>
</ul>
<p><br></p>
<h5 id="8-å†…ç½®å˜é‡"><a href="#8-å†…ç½®å˜é‡" class="headerlink" title="(8) å†…ç½®å˜é‡"></a>(8) å†…ç½®å˜é‡</h5><p>ansibleä¸­è¿˜æœ‰ä¸€äº›å†…ç½®å˜é‡å¯ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œå†…ç½®å˜é‡çš„å˜é‡åæ˜¯è¢«ansibleä¿ç•™çš„ï¼Œå½“æˆ‘ä»¬å®šä¹‰å˜é‡æ—¶ä¸èƒ½ä½¿ç”¨è¿™äº›å˜é‡åã€‚</p>
<p><em>å†…ç½®å˜é‡ä¸€è§ˆè¡¨ï¼š</em></p>
<ul>
<li>1.ansible_version : è·å–åˆ°ansibleçš„ç‰ˆæœ¬å·</li>
<li>2.inventory_dir : è·å–åˆ°ansibleä¸»æœºä¸­æ¸…å•æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ï¼Œansibleé»˜è®¤çš„æ¸…å•æ–‡ä»¶/etc/ansible/hosts</li>
<li>3.inventory_hostname: è·å–åˆ°è¢«æ“ä½œçš„å½“å‰ä¸»æœºçš„ä¸»æœºåç§°(å¯¹åº”ä¸»æœºåœ¨æ¸…å•ä¸­é…ç½®çš„åç§°)</li>
<li>4.inventory_hostname_short : ä¸å†…ç½®å˜é‡inventory_hostnameç±»ä¼¼ä½†æ˜¯è¿™ä¸ªåç§°æ›´åŠ ç®€çŸ­ï¼›</li>
<li>5.groups : è·å–åˆ°æ¸…å•ä¸­â€æ‰€æœ‰åˆ†ç»„â€çš„â€åˆ†ç»„ä¿¡æ¯â€</li>
<li>6.group_names : è·å–åˆ°å½“å‰ä¸»æœºæ‰€åœ¨åˆ†ç»„çš„ç»„å</li>
<li>7.hostvars : å¸®åŠ©æˆ‘ä»¬åœ¨æ“ä½œå½“å‰ä¸»æœºæ—¶è·å–åˆ°å…¶ä»–ä¸»æœºä¸­çš„ä¿¡æ¯</li>
<li>8.play_hosts : è·å–åˆ°å½“å‰playæ‰€æ“ä½œçš„æ‰€æœ‰ä¸»æœºçš„ä¸»æœºååˆ—è¡¨</li>
</ul>
<p>å†…ç½®å˜é‡ä½¿ç”¨æ¡ˆä¾‹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç¤ºä¾‹1.ç›´æ¥é‡‡ç”¨ansibleå‘½ä»¤è¡Œè¾“å‡ºå†…ç½®å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----ansible_version------</span></span><br><span class="line">ansible <span class="built_in">local</span> -m debug -a <span class="string">"msg='å½“å‰Ansibleç‰ˆæœ¬å·: &#123;&#123;ansible_version&#125;&#125;'"</span></span><br><span class="line"><span class="comment"># local | SUCCESS =&gt; &#123;</span></span><br><span class="line"><span class="comment">#     "msg": "Ansible Version :  &#123;'major': 2, 'full': '2.8.1', 'string': '2.8.1', 'minor': 8, 'revision': 1&#125;"</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----inventory_dir------</span></span><br><span class="line">ansible <span class="built_in">local</span> -m debug -a <span class="string">"msg='Current Hosts Configure: &#123;&#123;inventory_dir&#125;&#125;'"</span></span><br><span class="line"><span class="comment"># local | SUCCESS =&gt; &#123;</span></span><br><span class="line"><span class="comment">#     "msg": "Current Hosts Configure: /etc/ansible"</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----inventory_hostname*------</span></span><br><span class="line"><span class="variable">$ansible</span> <span class="built_in">local</span> -m debug -a <span class="string">"msg=&#123;&#123;inventory_hostname&#125;&#125;"</span>   <span class="comment">#ä¸»æœºæ¸…å•ä¸­çš„é•¿ä¸»æœºåç§°</span></span><br><span class="line"><span class="comment"># local | SUCCESS =&gt; &#123;</span></span><br><span class="line"><span class="comment">#     "msg": "local"</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment"># local | SUCCESS =&gt; &#123;</span></span><br><span class="line"><span class="comment">#     "msg": "local"</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment">#æ— è®ºæ˜¯IPè¿˜æ˜¯åˆ«åï¼Œå¦‚æœæ¸…å•çš„ä¸»æœºåç§°ä¸­åŒ…å«"."ï¼Œinventory_hostname_shortéƒ½ä¼šå–å¾—ä¸»æœºåä¸­ç¬¬ä¸€"."ä¹‹å‰çš„å­—ç¬¦ä½œä¸ºä¸»æœºçš„ç®€çŸ­åç§°ã€‚</span></span><br><span class="line"><span class="variable">$ansible</span> testA -m debug -a <span class="string">"msg=&#123;&#123;inventory_hostname&#125;&#125;"</span> </span><br><span class="line"><span class="comment"># 10.10.107.221 | SUCCESS =&gt; &#123;</span></span><br><span class="line"><span class="comment">#     "msg": "10.10.107.221"</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="variable">$ansible</span> testA -m debug -a <span class="string">"msg=&#123;&#123;inventory_hostname_short&#125;&#125;"</span> <span class="comment">#ä¸»æœºæ¸…å•ä¸­çš„çŸ­ä¸»æœºåç§°</span></span><br><span class="line"><span class="comment"># 10.10.107.221 | SUCCESS =&gt; &#123;</span></span><br><span class="line"><span class="comment">#     "msg": "10"</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----groups*------</span></span><br><span class="line">ansible <span class="built_in">local</span> -m debug -a <span class="string">"msg=&#123;&#123;groups&#125;&#125;"</span></span><br><span class="line"><span class="comment"># local | SUCCESS =&gt; &#123;</span></span><br><span class="line"><span class="comment">#     "msg": &#123;</span></span><br><span class="line"><span class="comment">#         "all": [</span></span><br><span class="line"><span class="comment">#             "local",</span></span><br><span class="line"><span class="comment">#             "10.10.107.221",</span></span><br><span class="line"><span class="comment">#             "10.20.172.179"</span></span><br><span class="line"><span class="comment">#         ],</span></span><br><span class="line"><span class="comment">#         "ops": [</span></span><br><span class="line"><span class="comment">#             "10.10.107.221",</span></span><br><span class="line"><span class="comment">#             "10.20.172.179"</span></span><br><span class="line"><span class="comment">#         ],</span></span><br><span class="line"><span class="comment">#         "testA": [</span></span><br><span class="line"><span class="comment">#             "10.10.107.221"</span></span><br><span class="line"><span class="comment">#         ],</span></span><br><span class="line"><span class="comment">#         "testB": [</span></span><br><span class="line"><span class="comment">#             "10.20.172.179"</span></span><br><span class="line"><span class="comment">#         ],</span></span><br><span class="line"><span class="comment">#         "ungrouped": [</span></span><br><span class="line"><span class="comment">#             "local"</span></span><br><span class="line"><span class="comment">#         ]</span></span><br><span class="line"><span class="comment">#     &#125;</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line">ansible <span class="built_in">local</span> -m debug -a <span class="string">"msg=&#123;&#123;groups.testA&#125;&#125;"</span></span><br><span class="line"><span class="comment"># local | SUCCESS =&gt; &#123;</span></span><br><span class="line"><span class="comment">#     "msg": [</span></span><br><span class="line"><span class="comment">#         "10.10.107.221"</span></span><br><span class="line"><span class="comment">#     ]</span></span><br><span class="line">ansible ops -m debug -a <span class="string">"msg=&#123;&#123;groups['ungrouped']&#125;&#125;"</span></span><br><span class="line"><span class="comment"># 10.10.107.221 | SUCCESS =&gt; &#123;</span></span><br><span class="line"><span class="comment">#     "msg": [</span></span><br><span class="line"><span class="comment">#         "local"</span></span><br><span class="line"><span class="comment">#     ]</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment"># 10.20.172.179 | SUCCESS =&gt; &#123;</span></span><br><span class="line"><span class="comment">#     "msg": [</span></span><br><span class="line"><span class="comment">#         "local"</span></span><br><span class="line"><span class="comment">#     ]</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----group_names------</span></span><br><span class="line">ansible <span class="built_in">local</span> -m debug -a <span class="string">"msg=&#123;&#123;group_names&#125;&#125;"</span></span><br><span class="line"><span class="comment"># local | SUCCESS =&gt; &#123;</span></span><br><span class="line"><span class="comment">#     "msg": [</span></span><br><span class="line"><span class="comment">#         "ungrouped"</span></span><br><span class="line"><span class="comment">#     ]</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line">ansible testA -m debug -a <span class="string">"msg=&#123;&#123;group_names&#125;&#125;"</span></span><br><span class="line"><span class="comment"># 10.10.107.221 | SUCCESS =&gt; &#123;</span></span><br><span class="line"><span class="comment">#     "msg": [</span></span><br><span class="line"><span class="comment">#         "ops",</span></span><br><span class="line"><span class="comment">#         "testA"</span></span><br><span class="line"><span class="comment">#     ]</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br></pre></td></tr></table></figure></p>
<p><em>é‡ç‚¹ä»‹ç»ï¼šhostvars å˜é‡å†…ç½®</em><br>æè¿°ï¼šé€šè¿‡â€set_factâ€ç»“åˆâ€hostvarsâ€çš„æ–¹å¼ï¼Œå®ç°äº†è·¨playè·å–å…¶ä»–ä¸»æœºä¸­çš„å˜é‡ä¿¡æ¯çš„åŠŸèƒ½è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œå¹¶ä¸”é€šè¿‡gather_factså…³é”®å­—æ¥æ§åˆ¶å½“å‰playæ˜¯å¦æ”¶é›†å¯¹åº”ä¸»æœºçš„factsä¿¡æ¯[yes|no]</p>
<p>å®é™…æ¡ˆä¾‹1ï¼šhostvars ä¸ play_hostså†…ç½®å˜é‡è”åˆä½¿ç”¨<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat &gt; gatherfcats.yml &lt;&lt;end</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">"Play1 : Gather facts of local"</span></span><br><span class="line"><span class="attr">  hosts:</span> <span class="string">local,testB</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">"show play hosts"</span></span><br><span class="line"><span class="attr">    debug:</span></span><br><span class="line"><span class="attr">      msg:</span> <span class="string">"Play1 -&gt; play include hosts : <span class="template-variable">&#123;&#123;play_hosts&#125;&#125;</span>"</span>  <span class="comment">#å½“å‰playåŒ…å«çš„hosts</span></span><br><span class="line"></span><br><span class="line"><span class="attr">- name:</span> <span class="string">"Play2: Gather facts"</span></span><br><span class="line"><span class="attr">  hosts:</span> <span class="string">testA,testB</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - debug:</span> </span><br><span class="line"><span class="attr">     msg:</span> <span class="string">"Play2 -&gt; Local IP : <span class="template-variable">&#123;&#123;hostvars['local'].ansible_default_ipv4&#125;&#125;</span>"</span>  <span class="comment">#è°ƒç”¨Gatherä¸­æ”¶é›†localä¸»æœºä¸­çš„IPåœ°å€ä¿¡æ¯</span></span><br><span class="line"><span class="attr">  - debug:</span> </span><br><span class="line"><span class="attr">     msg:</span> <span class="string">"Play2 -&gt; Local interface : <span class="template-variable">&#123;&#123;hostvars['local'].ansible_default_ipv4.interface&#125;&#125;</span>"</span></span><br><span class="line"><span class="string">end</span></span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œç»“æœï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å…³é”®ç‚¹1</span></span><br><span class="line">TASK [Gathering Facts] </span><br><span class="line">ok: [10.20.172.179]</span><br><span class="line">ok: [<span class="built_in">local</span>]</span><br><span class="line"></span><br><span class="line">ok: [<span class="built_in">local</span>] </span><br><span class="line">    <span class="string">"msg"</span>: <span class="string">"Play1 -&gt; play include hosts : [u'local', u'10.20.172.179']"</span></span><br><span class="line">ok: [10.20.172.179]</span><br><span class="line">    <span class="string">"msg"</span>: <span class="string">"Play1 -&gt; play include hosts : [u'local', u'10.20.172.179']"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">TASK [Gathering Facts]</span><br><span class="line">ok: [10.20.172.179]</span><br><span class="line">ok: [10.10.107.221]</span><br><span class="line"></span><br><span class="line">ok: [10.10.107.221] =&gt; &#123;</span><br><span class="line">    <span class="string">"msg"</span>: <span class="string">"Play2 -&gt; Local IP : &#123;u'macaddress': u'00:50:56:b3:dc:b4', u'network': u'10.10.107.0', u'mtu': 1500, u'broadcast': u'10.10.107.255', u'alias': u'ens192', u'netmask': u'255.255.255.0', u'address': u'10.10.107.222', u'interface': u'ens192', u'type': u'ether', u'gateway': u'10.10.107.1'&#125;"</span></span><br><span class="line">&#125;</span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">ok: [10.20.172.179] =&gt; &#123;</span><br><span class="line">    <span class="string">"msg"</span>: <span class="string">"Play2 -&gt; Local interface : ens192"</span></span><br><span class="line">&#125;</span><br><span class="line">......</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨â€gather_factsâ€å…³é”®å­—å¯ä»¥æ§åˆ¶playæ˜¯å¦è¿›è¡ŒGathering Factsä¸»æœºçš„ä¿¡æ¯æ”¶é›†;</p>
<ul>
<li>ç¬¬ä¸€ä¸ªplayä¸­çš„â€gather_facts: noâ€è¡¨ç¤ºè®¾ç½®å½“å‰playä¸æ”¶é›†å¯¹åº”ä¸»æœºçš„ä¿¡æ¯ï¼Œæ— æ³•è·å–åˆ°localä¸»æœºä¸­çš„factsä¿¡æ¯ï¼ŒåŸå› æ˜¯localçš„factsä¿¡æ¯å¹¶æœªè¢«æ”¶é›†è¿‡ï¼Œæ‰€ä»¥è°ƒç”¨å…¶ä»–ä¸»æœºçš„factsä¿¡æ¯çš„å‰ææ˜¯å¯¹åº”ä¸»æœºçš„factsä¿¡æ¯å·²ç»è¢«æ”¶é›†è¿‡ã€‚</li>
<li>å…¶å®é™¤äº†factsä¿¡æ¯ï¼Œæˆ‘ä»¬è¿˜èƒ½å¤Ÿåˆ©ç”¨hostvarså†…ç½®å˜é‡ä»åˆ«çš„ä¸»æœºä¸­è·å–åˆ°å…¶ä»–ç±»å‹çš„ä¸€äº›å˜é‡ä¿¡æ¯ï¼Œæ¯”å¦‚å…¶ä»–ä¸»æœºçš„æ³¨å†Œå˜é‡ã€ä¸»æœºå˜é‡ã€ç»„å˜é‡ç­‰ä¿¡æ¯ï¼Œè¿˜æœ‰å°±æ˜¯æ³¨å†Œå˜é‡<code>å¹¶ä¸ç”¨åƒfactsä¿¡æ¯é‚£æ ·éœ€è¦äº‹å…ˆæ”¶é›†</code>ï¼Œå³å¯ç›´æ¥é€šè¿‡hostvarsè·¨ä¸»æœºè¢«å¼•ç”¨åˆ°ï¼›</li>
</ul>
<p>å®é™…æ¡ˆä¾‹2ï¼šhostvars ä¸ gather_fcats ä¸ set_factæ¨¡å—æ¡ˆä¾‹ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat &gt; gatherfcats1.yml &lt;&lt;end</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- name:</span> <span class="string">"Play 1 - local"</span></span><br><span class="line"><span class="attr">  hosts:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  gather_facts:</span> <span class="literal">no</span>  <span class="comment">#ç”±äºä¸è¿›è¡Œä¿¡æ¯æ”¶é›†å…¶ä»–playæ— æ³•è°ƒç”¨è¯¥ä¸»æœºçš„factsä¿¡æ¯ï¼Œæ‰§è¡Œé€Ÿåº¦æœ‰æ‰€æå‡;</span></span><br><span class="line"><span class="attr">  vars:</span></span><br><span class="line"><span class="attr">    testvar:</span> <span class="string">"é€šè¿‡varså…³é”®å­—å®šä¹‰çš„å˜é‡æ–¹æ³•æ˜¯æ— æ³•è¢«è·¨ä¸»æœºå¼•ç”¨çš„"</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">"setfact module settting"</span></span><br><span class="line"><span class="attr">    set_fact:</span>  <span class="comment">#ä½†æ˜¯å¯ä»¥é€šè¿‡set_factæ¨¡å—ä¸hostvarsæ¥è¿›è¡Œè·¨ä¸»æœºå¼•ç”¨(é‡è¦)(ä¸gather_factså…³é”®å­—æ— å…³)</span></span><br><span class="line"><span class="attr">      var1:</span> <span class="string">"gather_facts settting no"</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">"show set_fact"</span></span><br><span class="line"><span class="attr">    shell:</span> <span class="string">"echo <span class="template-variable">&#123;&#123;var1&#125;&#125;</span>"</span></span><br><span class="line"><span class="attr">    register:</span> <span class="string">shellrst</span> <span class="comment">#æ³¨å†Œå˜é‡ä¹Ÿèƒ½è¿›è¡Œhostvarsè·¨ä¸»æœºè°ƒç”¨(ä¸gather_factså…³é”®å­—æ— å…³)</span></span><br><span class="line"></span><br><span class="line"><span class="attr">- name:</span> <span class="string">"Play 2 - testA "</span></span><br><span class="line"><span class="attr">  hosts:</span> <span class="string">testA</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  gather_facts:</span> <span class="literal">no</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - debug:</span></span><br><span class="line"><span class="attr">      msg:</span> <span class="string">"Play 1 hostvars : <span class="template-variable">&#123;&#123;hostvars.local.var1&#125;&#125;</span> , Play 1 register shell command: <span class="template-variable">&#123;&#123;hostvars.local.shellrst['cmd']&#125;&#125;</span>"</span>  <span class="comment">#ä½†æ˜¯å¯ä»¥é‡‡ç”¨hostvarsæ¥è¿›è¡Œè·¨ä¸»æœºå¼•ç”¨set_factæ¨¡å—è®¾ç½®çš„å˜é‡</span></span><br><span class="line">      <span class="comment">#msg: "play 1 ä¸­çš„ &#123;hostvars['local'].ansible_default_ipv4 ä¸èƒ½è¢«è°ƒç”¨ç”±äºæ ¹æœ¬æ²¡æœ‰è¿›è¡Œgathering factsä¸»æœºä¿¡æ¯æ”¶é›†"</span></span><br><span class="line">      <span class="comment">#msg: "play 1 ä¸­çš„ testvar å˜é‡ä¸èƒ½è¢«å¼•ç”¨ &#123;&#123;testvar&#125;&#125; "</span></span><br><span class="line"><span class="string">end</span></span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">TASK [debug]</span><br><span class="line">ok: [10.10.107.221] =&gt; &#123;</span><br><span class="line">    <span class="string">"msg"</span>: <span class="string">"Play 1 hostvars : gather_facts settting no , Play 1 register shell command: echo gather_facts settting no"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="9-include-vars-æ›´æ–°å˜é‡æ–‡ä»¶"><a href="#9-include-vars-æ›´æ–°å˜é‡æ–‡ä»¶" class="headerlink" title="(9) include_vars æ›´æ–°å˜é‡æ–‡ä»¶"></a>(9) include_vars æ›´æ–°å˜é‡æ–‡ä»¶</h5><p>æè¿°ï¼šå‰é¢æˆ‘ä»¬å­¦ä¹ äº†var_filesä¹ŸçŸ¥é“äº†å®ƒçš„åº”ç”¨åœºæ™¯,ä½†æ˜¯ä½¿ç”¨var_filesæœ‰ä¸€ä¸ªç¼ºç‚¹,å°±æ˜¯å½“å˜é‡æ–‡ä»¶åŠ¨æ€çš„è¢«æ·»åŠ å˜é‡çš„æ—¶å€™,å…¶åçš„playbookå¹¶ä¸èƒ½è¯»å–å˜åŒ–å¢åŠ çš„å˜é‡å€¼;</p>
<p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä¾é <code>include_varsæ¨¡å—</code>èƒ½å¤Ÿåœ¨ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œéšæ—¶çš„å¼•å…¥å˜é‡æ–‡ä»¶ï¼Œä»¥ä¾¿åŠ¨æ€çš„è·å–åˆ°æœ€æ–°çš„å˜é‡æ–‡ä»¶å†…å®¹;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸¤ç§è¯­æ³•æ–¹å¼(æ¨¡å—å‚æ•°ä»‹ç»è¯·å‚è€ƒAnsibleæ¨¡å—ä»‹ç»)</span></span><br><span class="line">- include_vars:</span><br><span class="line">    file: /testdir/ansible/testfile</span><br><span class="line">- include_vars: <span class="string">"/testdir/ansible/testfile"</span></span><br></pre></td></tr></table></figure></p>
<p>åŸºç¡€ç¤ºä¾‹ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat &gt; include_vars_demo.yml&lt;&lt;END</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">- hosts:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">  remote_user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">  gather_facts:</span> <span class="literal">no</span></span><br><span class="line"><span class="attr">  vars_files:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">/tmp/ansible/demo1/var.yml</span></span><br><span class="line"><span class="attr">  tasks:</span></span><br><span class="line"><span class="attr">  - debug:</span></span><br><span class="line"><span class="attr">      msg:</span> <span class="string">"<span class="template-variable">&#123;&#123;test1&#125;&#125;</span> <span class="template-variable">&#123;&#123;test2&#125;&#125;</span>"</span>  <span class="comment">#ç”±äºtestvar2å·²ç»åŠ å…¥åˆ°äº†å˜é‡æ–‡ä»¶ä¸­,æ‰€æœ‰æ˜¾ç¤ºOK</span></span><br><span class="line"><span class="attr">  - lineinfile:</span></span><br><span class="line"><span class="attr">      path:</span> <span class="string">/tmp/ansible/demo1/var.yml</span> <span class="comment">#ä¿®æ”¹æ·»åŠ å˜é‡æ–‡ä»¶</span></span><br><span class="line"><span class="attr">      line:</span> <span class="string">"testvar4: add"</span></span><br><span class="line"><span class="attr">  - include_vars:</span> </span><br><span class="line"><span class="attr">      file:</span> <span class="string">/tmp/ansible/demo1/var.yml</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">trans_var</span>  <span class="comment">#å…³é”®ç‚¹å°†å˜é‡æ–‡ä»¶ä¸­å˜é‡å…¨éƒ¨èµ‹å€¼ç»™å¦å¤–trans_varå˜é‡</span></span><br><span class="line">  <span class="comment">#'include_vars'æ¨¡å—é‡æ–°åŠ è½½äº†å˜é‡æ–‡ä»¶</span></span><br><span class="line"><span class="attr">  - debug:</span></span><br><span class="line"><span class="attr">      msg:</span> <span class="string">"include_vars - <span class="template-variable">&#123;&#123;trans_var.testvar4&#125;&#125;</span>"</span>  <span class="comment"># æˆåŠŸè°ƒç”¨äº†trans_var.testvar4å˜é‡</span></span><br><span class="line"><span class="attr">  - include_vars:</span> </span><br><span class="line"><span class="attr">      dir:</span> <span class="string">/tmp/ansible/demo2/</span>   <span class="comment">#å¤¹æ‚è¿™ä¸ªæ–‡ä»¶ä¸­ä¸º.yaml / yml / json </span></span><br><span class="line"><span class="attr">      files_matching:</span> <span class="string">"^var.*"</span> <span class="comment">#åŠ è½½æŒ‡å®šç›®å½•ä¸­ä»¥\"var_\"å¼€å¤´çš„å˜é‡æ–‡ä»¶</span></span><br><span class="line"><span class="attr">      ignore_files:</span> <span class="string">["^var_.*",varintest.yaml]</span> <span class="comment">#æ˜ç¡®æŒ‡å®šéœ€è¦å¿½ç•¥çš„å˜é‡æ–‡ä»¶åç§°çš„åˆ—è¡¨</span></span><br><span class="line"><span class="attr">      extensions:</span> <span class="string">[yaml,yml,json,varfile]</span> <span class="comment">#å…è®¸çš„æ‰©å±•</span></span><br><span class="line"><span class="attr">      depth:</span> <span class="number">1</span> <span class="comment">#é€’å½’æ·±åº¦</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">var</span>  <span class="comment">#å…³é”®ç‚¹å°†å˜é‡æ–‡ä»¶ä¸­å˜é‡å…¨éƒ¨èµ‹å€¼ç»™å¦å¤–</span></span><br><span class="line"><span class="attr">    register:</span> <span class="string">returnval</span></span><br><span class="line"><span class="attr">  - debug:</span></span><br><span class="line"><span class="attr">      msg:</span> <span class="string">"<span class="template-variable">&#123;&#123;var&#125;&#125;</span> -&gt; <span class="template-variable">&#123;&#123;returnval.ansible_included_var_files&#125;&#125;</span>"</span>  <span class="comment"># è°ƒç”¨varé‡æ–°èµ‹å€¼çš„å˜é‡;</span></span><br><span class="line"><span class="string">END</span></span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#TASK [debug]</span></span><br><span class="line">ok: [<span class="built_in">local</span>] =&gt; &#123;<span class="string">"msg"</span>: <span class="string">"qixi happy"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#TASK [lineinfile]</span></span><br><span class="line">changed: [<span class="built_in">local</span>]</span><br><span class="line"><span class="comment">#TASK [include_vars] </span></span><br><span class="line">ok: [<span class="built_in">local</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#TASK [debug]</span></span><br><span class="line">ok: [<span class="built_in">local</span>] =&gt; &#123;<span class="string">"msg"</span>: <span class="string">"include_vars - add"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#TASK [include_vars] </span></span><br><span class="line">ok: [<span class="built_in">local</span>]</span><br><span class="line"><span class="comment">#TASK [debug]</span></span><br><span class="line">ok: [<span class="built_in">local</span>] =&gt; &#123; <span class="string">"msg"</span>: <span class="string">"&#123;u'test3': u'include_varDemo', u'test4': u'WeiyiGeek'&#125; -&gt; [u'/tmp/ansible/demo2/var.yml']"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#PLAY RECAP </span></span><br><span class="line"><span class="built_in">local</span>                      : ok=6    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</span><br></pre></td></tr></table></figure></p>

        </div>
        
  <hr>
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>

  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>

  <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ï¼Œè½¬ä¸ªå‘ã€‘(äººé—´äº”å¤§æƒ…)</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œè°¢è°¢ï¼ã€‚</p>

  <div>
    <img src="https://www.weiyigeek.top/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul>

  <div>
    <img src="/img/wechat-search.png" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·"  width="380" height="170">
    <img src="/img/wechat-app.png" class="img-responsive" alt="æ‰«æVisit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº"  width="385" height="170">
  </div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-03-29T05:39:06.298Z" itemprop="dateUpdated">2022-03-29 13:39:06</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/Ansible/Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°2.md" target="_blank" rel="noopener noreferrer">_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–è¿ç»´/Ansible/Ansibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°2.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2019/7-28-267.html" target="_blank" rel="external">https://blog.weiyigeek.top/2019/7-28-267.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">ğŸ‘ é’Ÿæ„ä½œè€…</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ansible/" rel="tag">Ansible</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/7-28-267.html&title=ã€ŠAnsibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°2ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/7-28-267.html&title=ã€ŠAnsibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°2ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/7-28-267.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠAnsibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°2ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/7-28-267.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/7-28-267.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/7-28-495.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">UUIDä»‹ç»ä¸ä½¿ç”¨èŒƒå›´</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/7-28-520.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·å®è·µ</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x04-variableå˜é‡"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x04 variableå˜é‡</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

  <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¿˜è¯·æ”¯æŒä¸€ä¸‹åšä¸»å“Ÿ, è°¢è°¢å„ä½çœ‹å‹â™¥!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="228" height="228" alt="æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

  
 <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->

  <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">ä¸ªäººGithub</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">ä¸ªäººGitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">ä¸ªäººçŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘+äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved. ITå”¯ä¸€æå®¢ ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/7-28-267.html&title=ã€ŠAnsibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°2ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/7-28-267.html&title=ã€ŠAnsibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°2ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/7-28-267.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠAnsibleè‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ ç¬”è®°2ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/7-28-267.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/7-28-267.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACN0lEQVR42u3aS04DMRAFQO5/6SCxYkHCe+0JYuyaVRQFj4tFq38fH/Hz+Hq+f86/+f79szOfnXPxg4GBcVvG4+Xz+pUrsISR3A0DA+McxizI5gE6CbhLf4uBgYFRBsf2GwwMDIx3B9w8rWzTUAwMDIz26NfBMXlxG4LfUotjYGDckDEbDPzN57fPNzAwMP4941E++Qn5ey+4FQYGxtaMWXrXNuCS1HClPYeBgbE3I79Wu/iVBN+VwvhpqMXAwNiOMVt0SErQtm03q1gxMDDOYeSJWl5kRkPHhWYfBgbGOYyrXty2z/KLRktjGBgYxzDa1ljSaLuqDP6FhIGBcQCjHUbmoTBvt7VLYz9MYjEwMLZmtGPFWbnb/rI4BwMDY2tGXrImqVu+ctG+Zdg7xMDA2IKRJ3D51dur5COB4WAAAwPj5oyVFv8sWLeBe1gkY2BgbMfIi9h2wSKPh7MCGAMD4xzGrK2fhMW6WVaG6ekiHAYGxl0ZySCzXaeYJX/5PwIDA+MERl6UztLBfNlipUjGwMA4gZGnZbM2XD5OSM7/ZbsNAwNjO0YygGxXH1ZWzfJWXZTVYmBgbMF4lM/KYkS7HFaUxBgYGFszZmGuXf9aGS3UI0wMDIxNGW1il1901rabpaoYGBgnMNoguxLRV5bJnp6AgYGBUTbO2sQxHyG8ZZCJgYGxKaMtWfPSN18LuyDgYmBg3IoxC3nJCsWsJdcudmBgYOzNWCkgZ4PPfO3s4nUNDAyM+zE+AQXtIuA1g5a2AAAAAElFTkSuQmCC" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 



  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 
     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>
