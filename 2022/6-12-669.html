<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Jmeter">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/2018/1-1-1.html"  >
                <i class="icon icon-lg icon-mortar-board"></i>
                å­¦ä¹ ä¹‹è·¯
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/sites"  >
                <i class="icon icon-lg icon-globe"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="/img/video-account.jpg" target="_blank" >
                <i class="icon icon-lg icon-video-camera"></i>
                è§†é¢‘å·
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                å‹æƒ…é“¾æ¥
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ</h1>
        <h5 class="subtitle">
            
                <time datetime="2022-06-12T15:36:30.000Z" itemprop="datePublished" class="page-time">
  2022-06-12
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95/">å‹åŠ›æµ‹è¯•</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95/%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7/">è¿ç»´å·¥å…·</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap" style="display: none;">
  <article id="post-ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–æµ‹è¯•/Jmeter/2.Jmeteråœ¨Kubernetesç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ-cost"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ</h1>
        <div class="post-meta">
            <time class="post-time" title="2022-06-12 23:36:30" datetime="2022-06-12T15:36:30.000Z"  itemprop="datePublished">2022-06-12</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95/">å‹åŠ›æµ‹è¯•</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95/%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7/">è¿ç»´å·¥å…·</a></li></ul></li></ul>



            

            


            
        </div>
        <span class="post-href" style="display: none;">https://mp.weixin.qq.com/s/-Gbrtno8MOfqgCdgWxKE0w|cost</span> 
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="0x00-å‰è¨€ç®€è¿°"><a href="#0x00-å‰è¨€ç®€è¿°" class="headerlink" title="0x00 å‰è¨€ç®€è¿°"></a>0x00 å‰è¨€ç®€è¿°</h2><p>æè¿°: æœ€è¿‘å…¬å¸æœ‰ä¸šåŠ¡éœ€è¦æä¸€ä¸ªè‡ªåŠ¨åŒ–çš„ jmeter åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•é¡¹ç›®, åŸºäºç°æœ‰çš„ Kubernetes ã€Jenkinsã€ Gitlab æŠ€æœ¯æ ˆç¯å¢ƒ, æœ¬ç« å®è·µäº†åœ¨ Kubernetes é›†ç¾¤ä¸­ä½¿ç”¨ helm æ­å»º jmeter åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯• Master ä¸ server ä»¥åŠ Influxdb æ—¶åºæ•°æ®åº“ å’Œ Grafana ç¯å¢ƒï¼Œåœ¨ Windows ä¸­ å®‰è£… jmeter ç¼–å†™å¸¦æœ‰çº¿ç¨‹ç»„çš„å‹åŠ›æµ‹è¯•ä»»åŠ¡ï¼Œåœ¨çº¿ç¨‹ç»„ä¸­åˆ©ç”¨å˜é‡å‚æ•°ä¼ é€’çº¿ç¨‹æ•°å’Œå¾ªç¯æ­¤å¤„ï¼Œç„¶åå†æ·»åŠ åç«¯ç›‘å¬å™¨è®¾ç½®ä¸ºinfluxdb, é’ˆå¯¹å‹åŠ›æµ‹è¯•æ•°æ®è¿›è¡Œé‡‡é›†, å¯¼å‡ºå‹åŠ›æµ‹è¯•jmxæ–‡ä»¶ï¼Œä¸Šä¼ åˆ° Gitlab åˆ›å»ºçš„ jmeter ä»“åº“ä¸­ï¼Œæ­¤å¤„æˆ‘ä»¬å·²ç»å°†<code>Jenkins + Gitlab</code>è‡ªåŠ¨åŒ–é›†æˆéƒ¨ç½²å·²ç»æ‰“é€š(å¯ä»¥å‚è€ƒä¸‹é¢æ–‡ç« è¿›è¡Œç›¸åº”çš„å­¦ä¹ é…ç½®)ï¼Œåœ¨ä¸Šä¼ åˆ° jmeter ä»£ç ä»“åº“åå°†ä¼šé€šè¿‡ webhook è¯·æ±‚ jenkins æµæ°´çº¿é¡¹ç›®ä»è€Œè§¦å‘è‡ªåŠ¨åŒ–éƒ¨ç½²æ“ä½œï¼Œç„¶åJenkinsä¼šä½¿ç”¨kubenetesæ’ä»¶åœ¨é›†ç¾¤ä¸­åˆ›å»ºä¸€ä¸ªjenkins slave Pod(æ’ä»¶çš„ä½¿ç”¨ä»¥åŠslave é•œåƒå¯ä»¥åœ¨ä¸‹é¢å®è·µä¸­è·å¾—)ï¼Œä¹‹åä¾¿ä¼šæ‰§è¡Œæµæ°´çº¿ä¸­ä¸‰ä¸ªæ­¥éª¤å³<code>ä»£ç æ‹‰å–ã€å‹åŠ›æµ‹è¯•ã€ç»“æœå±•ç¤º</code>ï¼Œå¹¶ä¸”ä¼šå°†éƒ¨ç½²æ‰§è¡Œæƒ…å†µé€šè¿‡ä¼ä¸šå¾®ä¿¡æä¾›çš„webhookå‘é€åˆ°æŒ‡å®šè¿ç»´ç¾¤ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿ç‚¹å‡»grafanaä¸­ Jmeter å±•ç¤ºæ•°æ®çš„ dashboard åœ°å€è¿›è¡ŒæŸ¥çœ‹ Jmeter ç›¸å…³å‹åŠ›æµ‹è¯•æŒ‡æ ‡æ•°æ®ç­‰ï¼Œç„¶åé’ˆå¯¹å‹åŠ›æµ‹è¯•æ•°æ®è¿›è¡Œåº”ç”¨å’Œéƒ¨ç½²ç¯å¢ƒçš„è°ƒä¼˜ã€‚</p>
<p><br/></p>
<p><strong>æŠ€æœ¯æ ˆä»‹ç»</strong><br>åŸºäºå…¬å¸ç°æœ‰Kubernetes ã€Jenkinsã€ Gitlab æŠ€æœ¯æ ˆ,å®ç°åœ¨devops  Jenkins CI/CD è‡ªåŠ¨åŒ–ç¯å¢ƒä¸­ä½¿ç”¨ jmeter-distributed é’ˆå¯¹éƒ¨ç½²çš„æ­£å¼æˆ–è€…æµ‹è¯•ç¯å¢ƒè¿›è¡Œ jmeter åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•ï¼Œå¹¶ä¸”ä½¿ç”¨InfluxDBå­˜å‚¨å‹åŠ›æµ‹è¯•æ•°æ®ï¼Œå’Œåˆ©ç”¨ Grafanaè¿›è¡Œå‹åŠ›æµ‹è¯•æ•°æ®çš„å®æ—¶å±•ç¤ºï¼Œåœ¨æµ‹è¯•ã€è¿ç»´ã€å¼€å‘å·¥ä½œå¯ä»¥å€Ÿæ­¤å‹åŠ›æµ‹è¯•æ•°æ®é’ˆå¯¹å¼€å‘åº”ç”¨ä¸æ–­ä¼˜åŒ–ï¼Œä¿è¯ä¸Šçº¿åæ‰¿è½½èƒ½åŠ›ã€‚</p>
<ul>
<li>Kubernetes :  Google åœ¨ 2014 å¹´å¼€æºäº† Kubernetes é¡¹ç›®ã€‚ Kubernetes å»ºç«‹åœ¨Google å¤§è§„æ¨¡è¿è¡Œç”Ÿäº§å·¥ä½œè´Ÿè½½åå‡ å¹´ç»éªŒï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯ç§»æ¤ã€å¯æ‰©å±•çš„å¼€æºå¹³å°,ç”¨äºç®¡ç†å®¹å™¨åŒ–çš„å·¥ä½œè´Ÿè½½å’ŒæœåŠ¡,æ–¹ä¾¿è¿›è¡Œå£°æ˜å¼é…ç½®å’Œè‡ªåŠ¨åŒ–ã€‚</li>
<li>GitLab : æ˜¯ä¸€ä¸ªç”¨äºä»“åº“ç®¡ç†ç³»ç»Ÿçš„å¼€æºé¡¹ç›®ï¼Œä½¿ç”¨Gitä½œä¸ºä»£ç ç®¡ç†å·¥å…·(ç±»ä¼¼äº Github)ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šæ­å»ºèµ·æ¥çš„WebæœåŠ¡, ä½ å¯ä»¥å°†å…¶è®¤ä¸ºæ˜¯åœ¨ä¼ä¸šä¸­ç§æœ‰åŒ–ä»£ç ä»“åº“ã€‚</li>
<li>Jenkins : ä¸€ä¸ªå¼€æºè‡ªåŠ¨åŒ–æœåŠ¡å™¨ï¼Œä½¿ä¸–ç•Œå„åœ°çš„å¼€å‘äººå‘˜èƒ½å¤Ÿå¯é åœ°æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²ä»–ä»¬çš„è½¯ä»¶ï¼Œå³ CI/CD æŒç»­é›†æˆä¸äº¤äº’ã€‚</li>
<li>Grafana : å¼€æ”¾ã€å¯ç»„åˆçš„å¯è§‚å¯Ÿæ€§å’Œæ•°æ®å¯è§†åŒ–å¹³å°ï¼Œå¯è§†åŒ–æ¥è‡ª<code>æ™®ç½—ç±³ä¿®æ–¯ï¼ˆPrometheusï¼‰ã€æ´›åŸºï¼ˆLokiï¼‰ã€Elasticsearchã€InfluxDBã€Postgres</code>ç­‰å¤šä¸ªæ¥æºçš„åº¦é‡ã€æ—¥å¿—å’Œè·Ÿè¸ªã€‚</li>
<li>Jmeter : æ˜¯ Apache ç»„ç»‡åŸºäº Java å¼€å‘çš„å‹åŠ›æµ‹è¯•å·¥å…·ï¼Œç”¨äºå¯¹è½¯ä»¶åšå‹åŠ›æµ‹è¯•ã€‚</li>
<li>InfluxDB : æ˜¯ä¸€ä¸ªå¼€æºæ—¶é—´åºåˆ—å¹³å°(æ•°æ®åº“), åŒ…æ‹¬ç”¨äºå­˜å‚¨å’ŒæŸ¥è¯¢æ•°æ®ã€åœ¨åå°å¤„ç†æ•°æ®ä»¥ç”¨äº ETL æˆ–ç›‘æ§å’Œè­¦æŠ¥ç›®çš„ã€ç”¨æˆ·ä»ªè¡¨æ¿ä»¥åŠå¯è§†åŒ–å’Œæ¢ç´¢æ•°æ®ç­‰çš„ APIã€‚</li>
</ul>
<p>å¥½çš„, åºŸè¯ä¸å¤šè¯´å®è·µæ‰æ˜¯ç‹é“ã€‚</p>
<p><strong>æœ¬ç« å®Œæ•´åŸæ–‡åœ°å€</strong>: </p>
<ul>
<li><a href="https://mp.weixin.qq.com/s/-Gbrtno8MOfqgCdgWxKE0w" target="_blank" rel="noopener">ä¼ä¸šè¿ç»´å®è·µ-å¦‚ä½•åœ¨K8Sé›†ç¾¤ç¯å¢ƒGitlab+Jenkins+Jmeter+GrafanaæŠ€æœ¯ä¸­å®ç°è‡ªåŠ¨åŒ–åˆ†å¸ƒå‹åŠ›æµ‹è¯•æ•°æ®å±•ç¤º</a></li>
<li><a href="https://mp.weixin.qq.com/s/-Gbrtno8MOfqgCdgWxKE0w" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/-Gbrtno8MOfqgCdgWxKE0w</a></li>
</ul>
<hr>
<h2 id="0x01-å®‰è£…é…ç½®"><a href="#0x01-å®‰è£…é…ç½®" class="headerlink" title="0x01 å®‰è£…é…ç½®"></a>0x01 å®‰è£…é…ç½®</h2><h3 id="1-åŸºç¡€ç¯å¢ƒ"><a href="#1-åŸºç¡€ç¯å¢ƒ" class="headerlink" title="1.åŸºç¡€ç¯å¢ƒ"></a>1.åŸºç¡€ç¯å¢ƒ</h3><p><strong>ç¯å¢ƒè¯´æ˜</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get node</span><br><span class="line">  <span class="comment"># NAME       STATUS   ROLES                  AGE    VERSION</span></span><br><span class="line">  <span class="comment"># weiyigeek-107   Ready    control-plane,master   186d   v1.23.1</span></span><br><span class="line">  <span class="comment"># weiyigeek-108   Ready    control-plane,master   185d   v1.23.1</span></span><br><span class="line">  <span class="comment"># weiyigeek-109   Ready    control-plane,master   185d   v1.23.1</span></span><br><span class="line">  <span class="comment"># weiyigeek-223   Ready    work                   185d   v1.23.1</span></span><br><span class="line">  <span class="comment"># weiyigeek-224   Ready    work                   185d   v1.23.1</span></span><br><span class="line">  <span class="comment"># weiyigeek-225   Ready    work                   186d   v1.23.1</span></span><br><span class="line">  <span class="comment"># weiyigeek-226   Ready    work                   25d    v1.23.1</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># å…¶å®ƒè¾…åŠ©è½¯ä»¶å·¥å…·</span></span><br><span class="line">Java     1.8.0_251</span><br><span class="line">Jmeter   5.4.3</span><br><span class="line">Jenkins  2.330</span><br><span class="line">InfluxDB 1.8.10</span><br><span class="line">Grafana  v9.0.2</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="åœ¨K8Sé›†ç¾¤ä¸­éƒ¨ç½²åŠ¨æ€æŒä¹…å·"><a href="#åœ¨K8Sé›†ç¾¤ä¸­éƒ¨ç½²åŠ¨æ€æŒä¹…å·" class="headerlink" title="åœ¨K8Sé›†ç¾¤ä¸­éƒ¨ç½²åŠ¨æ€æŒä¹…å·"></a>åœ¨K8Sé›†ç¾¤ä¸­éƒ¨ç½²åŠ¨æ€æŒä¹…å·</h4><p>æè¿°: æ­¤å¤„ä½¿ç”¨nfsåŠ¨æ€æŒä¹…å·ä¸»è¦æ˜¯ç”¨äºPV/PVCæ¥å­˜æ”¾Podä¸­éœ€è¦æŒä¹…åŒ–å­˜å‚¨çš„æ•°æ®ã€‚</p>
<p>å‚è€ƒé“¾æ¥: <a href="https://blog.weiyigeek.top/2022/6-7-664.html#1-%E9%9B%86%E7%BE%A4%E4%B8%AD%E5%9F%BA%E4%BA%8Enfs%E7%9A%84provisioner%E7%9A%84%E5%8A%A8%E6%80%81%E6%8C%81%E5%8D%B7%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2">https://blog.weiyigeek.top/2022/6-7-664.html#1-é›†ç¾¤ä¸­åŸºäºnfsçš„provisionerçš„åŠ¨æ€æŒå·ç¯å¢ƒéƒ¨ç½²</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) æŒ‚è½½æµ‹è¯•çš„nfså…±äº«ç›®å½•åˆ°æœ¬åœ°/storage/devä¸­</span></span><br><span class="line">sudo mkdir -vp /storage/dev</span><br><span class="line">sudo tee -a /etc/fstab &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">192.168.12.32:/k8sdevtest /storage/dev nfs defaults 0 0</span><br><span class="line">EOF</span><br><span class="line">sudo mount -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) éƒ¨ç½²nfs-subdir-external-provisioneråˆ°storageåç§°ç©ºé—´ä¸‹ã€‚</span></span><br><span class="line">kubectl create ns storage</span><br><span class="line">helm install nfs-devtest nfs-subdir-external-provisioner-dev/ --debug --namespace storage</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) æŸ¥çœ‹é›†ç¾¤ä¸­çš„åˆ›å»º storageclass nfs-devtest</span></span><br><span class="line">kubectl get storageclasses.storage.k8s.io nfs-devtest</span><br><span class="line">  <span class="comment"># NAME                    PROVISIONER                                    RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span></span><br><span class="line">  <span class="comment"># nfs-devtest (default)   cluster.local/nfs-devtest-subdir-provisioner   Delete          Immediate           true                   8m13s</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="åœ¨K8Sé›†ç¾¤ä¸­éƒ¨ç½²å‹åŠ›æµ‹è¯•æ¼”ç¤ºç«™ç‚¹"><a href="#åœ¨K8Sé›†ç¾¤ä¸­éƒ¨ç½²å‹åŠ›æµ‹è¯•æ¼”ç¤ºç«™ç‚¹" class="headerlink" title="åœ¨K8Sé›†ç¾¤ä¸­éƒ¨ç½²å‹åŠ›æµ‹è¯•æ¼”ç¤ºç«™ç‚¹"></a>åœ¨K8Sé›†ç¾¤ä¸­éƒ¨ç½²å‹åŠ›æµ‹è¯•æ¼”ç¤ºç«™ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.æ­¤å¤„ï¼Œæ‹‰å–æˆ‘ä¸»é¡µç«™ç‚¹é™æ€èµ„æºä¸ºä¾‹è¿›è¡Œå‹åŠ›æµ‹è¯•ç«™ç‚¹æ¼”ç¤º</span></span><br><span class="line">mkdir -vp /nfs/app/web &amp;&amp; git https://github.com/WeiyiGeek/WeiyiGeek.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.å‡†å¤‡ä¸€ä¸ª Nginx é…ç½®æ–‡ä»¶</span></span><br><span class="line">tee /nfs/app/web/nginx.conf &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">user  nginx;</span><br><span class="line">worker_processes  auto;</span><br><span class="line">error_log  /var/<span class="built_in">log</span>/nginx/error.log notice;</span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line">events &#123;</span><br><span class="line">  worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">  include       /etc/nginx/mime.types;</span><br><span class="line">  default_type  application/octet-stream;</span><br><span class="line">  log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line">  access_log  /var/<span class="built_in">log</span>/nginx/access.log  main;</span><br><span class="line">  sendfile        on;</span><br><span class="line">  keepalive_timeout  65;</span><br><span class="line">  gzip  on;</span><br><span class="line">  server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    listen  [::]:80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    <span class="comment">#access_log  /var/log/nginx/host.access.log  main;</span></span><br><span class="line">    location / &#123;</span><br><span class="line">      root   /usr/share/nginx/html;</span><br><span class="line">      index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">kubectl create cm nginx-conf --from-file=nginx.conf --namespace devtest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.ä½¿ç”¨StatefulSetèµ„æºæ§åˆ¶å™¨éƒ¨ç½²nginxä¸ºé™æ€èµ„æºæä¾›webè®¿é—®ã€‚</span></span><br><span class="line">tee /nfs/app/web/jmeter-test-html.yaml &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: StatefulSet</span><br><span class="line">metadata:</span><br><span class="line">  name: jmeter-test-html</span><br><span class="line">  namespace: devtest</span><br><span class="line">  labels:</span><br><span class="line">    app: web-html</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: web-html</span><br><span class="line">  serviceName: <span class="string">"jmeter-test-html"</span></span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: web-html</span><br><span class="line">    spec:</span><br><span class="line">      <span class="comment"># affinity:</span></span><br><span class="line">      <span class="comment">#   nodeAffinity:</span></span><br><span class="line">      <span class="comment">#     requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">      <span class="comment">#       nodeSelectorTerms:</span></span><br><span class="line">      <span class="comment">#       - matchExpressions:</span></span><br><span class="line">      <span class="comment">#         - key: node</span></span><br><span class="line">      <span class="comment">#           operator: In</span></span><br><span class="line">      <span class="comment">#           values:</span></span><br><span class="line">      <span class="comment">#           - work</span></span><br><span class="line">      <span class="comment">#   podAntiAffinity:</span></span><br><span class="line">      <span class="comment">#     preferredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">      <span class="comment">#     - podAffinityTerm:</span></span><br><span class="line">      <span class="comment">#         labelSelector:</span></span><br><span class="line">      <span class="comment">#           matchExpressions:</span></span><br><span class="line">      <span class="comment">#           - key: app</span></span><br><span class="line">      <span class="comment">#             operator: In</span></span><br><span class="line">      <span class="comment">#             values:</span></span><br><span class="line">      <span class="comment">#             - web-html</span></span><br><span class="line">      <span class="comment">#         topologyKey: kubernetes.io/hostname</span></span><br><span class="line">      <span class="comment">#       weight: 100</span></span><br><span class="line">      volumes:</span><br><span class="line">      - name: workdir</span><br><span class="line">        emptyDir: &#123;&#125;</span><br><span class="line">      - name: static-file</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /nfs/app/web/WeiyiGeek</span><br><span class="line">          <span class="built_in">type</span>: DirectoryOrCreate</span><br><span class="line">      - name: nginx-conf</span><br><span class="line">        configMap:</span><br><span class="line">          name: nginx-conf</span><br><span class="line">          items:</span><br><span class="line">          - key: nginx.conf</span><br><span class="line">            path: nginx.conf</span><br><span class="line">      - name: timezone</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /usr/share/zoneinfo/Asia/Shanghai</span><br><span class="line">      initContainers:</span><br><span class="line">      - name: sysctl</span><br><span class="line">        image: alpine:3.15.4</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        <span class="built_in">command</span>:</span><br><span class="line">        - sh</span><br><span class="line">        - -c</span><br><span class="line">        - |</span><br><span class="line">          mount -o remount rw /proc/sys</span><br><span class="line">          sysctl -w net.core.somaxconn=65535</span><br><span class="line">          sysctl -w net.ipv4.tcp_tw_reuse=1</span><br><span class="line">          sysctl -w net.ipv4.ip_local_port_range=<span class="string">"1024 65535"</span></span><br><span class="line">          sysctl -w fs.file-max=1048576</span><br><span class="line">          sysctl -w fs.inotify.max_user_instances=16384</span><br><span class="line">          sysctl -w fs.inotify.max_user_watches=524288</span><br><span class="line">          sysctl -w fs.inotify.max_queued_events=16384</span><br><span class="line">        securityContext:</span><br><span class="line">          privileged: <span class="literal">true</span></span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx:1.21.6</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        ports:</span><br><span class="line">        - name: http</span><br><span class="line">          protocol: TCP</span><br><span class="line">          containerPort: 80</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: static-file</span><br><span class="line">          mountPath: /usr/share/nginx/html</span><br><span class="line">        - name: nginx-conf</span><br><span class="line">          mountPath: /etc/nginx/nginx.conf</span><br><span class="line">          subPath: nginx.conf</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: jmeter-test-html</span><br><span class="line">  namespace: devtest</span><br><span class="line">spec:</span><br><span class="line">  <span class="built_in">type</span>: nodePort</span><br><span class="line">  ports:</span><br><span class="line">    - port: 80</span><br><span class="line">      targetPort: 80</span><br><span class="line">      protocol: TCP</span><br><span class="line">      nodePort: 32644</span><br><span class="line">  selector:</span><br><span class="line">    app: web-html</span><br><span class="line">EOF</span><br><span class="line">kubectl apply -f jmeter-test-html.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.éªŒè¯éƒ¨ç½²çš„nginxå‹åŠ›æµ‹è¯•ç«™ç‚¹</span></span><br><span class="line">$ kubectl get svc -n devtest jmeter-test-html</span><br><span class="line">  <span class="comment"># NAME               TYPE       CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE</span></span><br><span class="line">  <span class="comment"># jmeter-test-html   NodePort   10.103.88.2   &lt;none&gt;        80:32644/TCP   37d</span></span><br><span class="line">$ curl -s 10.103.88.2</span><br></pre></td></tr></table></figure>
<p>æ¸©é¦¨æç¤º: å¦‚æœ‰åŒé“ä¹‹äººåœ¨è¿›è¡Œå®è·µæ—¶,è¯·æ›´æ”¹ä¸Šè¿°æ–‡ä»¶ç›®å½•ä¸ºæ‚¨å®é™…å­˜æ”¾é™æ€èµ„æºä»¥åŠnginxé…ç½®çš„ç›®å½•ã€‚</p>
<p><br/></p>
<h3 id="2-ä¾èµ–ç¯å¢ƒ"><a href="#2-ä¾èµ–ç¯å¢ƒ" class="headerlink" title="2.ä¾èµ–ç¯å¢ƒ"></a>2.ä¾èµ–ç¯å¢ƒ</h3><h4 id="åœ¨-Windows-ä¸­å®‰è£…-Apache-jmeter-å·¥å…·"><a href="#åœ¨-Windows-ä¸­å®‰è£…-Apache-jmeter-å·¥å…·" class="headerlink" title="åœ¨ Windows ä¸­å®‰è£… Apache jmeter å·¥å…·"></a>åœ¨ Windows ä¸­å®‰è£… Apache jmeter å·¥å…·</h4><p>æè¿°: æ­¤å¤„é’ˆå¯¹äºWindowsä¸­å®‰è£…JAVAç¯å¢ƒä»¥åŠ Apache jmeterä¸åœ¨ç´¯è¿°, å¦‚æœä¸ä¼šå®‰è£…çš„åŒå­¦å¯ä»¥å‚è€ƒ (1.ä½¿ç”¨Apache Jmeterå¯¹åº”ç”¨å‹åŠ›æµ‹è¯•å­¦ä¹ ä¸å®è·µ)[<a href="https://blog.weiyigeek.top/2022/6-11-661.html#Windows]">https://blog.weiyigeek.top/2022/6-11-661.html#Windows]</a> è¿™ç¯‡æ–‡ç« æˆ–è€…å‚è€ƒ<code>Apache jmeter</code>çš„å®˜ç½‘ã€‚</p>
<p><br/></p>
<h4 id="ä»¥äºŒè¿›åˆ¶æ–¹å¼å®‰è£…Helméƒ¨ç½²å·¥å…·"><a href="#ä»¥äºŒè¿›åˆ¶æ–¹å¼å®‰è£…Helméƒ¨ç½²å·¥å…·" class="headerlink" title="ä»¥äºŒè¿›åˆ¶æ–¹å¼å®‰è£…Helméƒ¨ç½²å·¥å…·"></a>ä»¥äºŒè¿›åˆ¶æ–¹å¼å®‰è£…Helméƒ¨ç½²å·¥å…·</h4><p><strong>å¿«é€Ÿéƒ¨ç½²</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ARCH=$(dpkg --<span class="built_in">print</span>-architecture)</span><br><span class="line">VERSION=<span class="string">"3.8.2"</span></span><br><span class="line">wget https://get.helm.sh/helm-v<span class="variable">$&#123;VERSION&#125;</span>-linux-<span class="variable">$&#123;ARCH&#125;</span>.tar.gz -O /tmp/helm-v<span class="variable">$&#123;VERSION&#125;</span>-linux-<span class="variable">$&#123;ARCH&#125;</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> /tmp/ &amp;&amp; tar -zxf helm-v<span class="variable">$&#123;VERSION&#125;</span>-linux-<span class="variable">$&#123;ARCH&#125;</span>.tar.gz</span><br><span class="line">sudo cp linux-amd64/helm /usr/<span class="built_in">local</span>/bin/</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="ä»¥-helm-æ–¹å¼å®‰è£…-Grafana-9-x"><a href="#ä»¥-helm-æ–¹å¼å®‰è£…-Grafana-9-x" class="headerlink" title="ä»¥ helm æ–¹å¼å®‰è£… Grafana 9.x"></a>ä»¥ helm æ–¹å¼å®‰è£… Grafana 9.x</h4><p><strong>å¿«é€Ÿéƒ¨ç½²</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ  chart ä»“åº“ä¸ç´¢å¼•æ›´æ–°</span></span><br><span class="line">$ helm repo add grafana https://grafana.github.io/helm-charts</span><br><span class="line">$ helm repo update</span><br><span class="line">$ helm search repo grafana </span><br><span class="line">  <span class="comment"># grafana/grafana   6.32.3   9.0.3   The leading tool for querying and visualizing t...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æŒ‡å®š chart ç‰ˆæœ¬çš„granfaç›¸å…³éƒ¨ç½²å‚æ•°</span></span><br><span class="line">$ helm show values grafana/grafana --version 6.32.3  &gt; granfa-values.yaml  </span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æŒ‡å®š chart ç‰ˆæœ¬ä»¥åŠéƒ¨ç½²å‚æ•°</span></span><br><span class="line">$ helm install grafana grafana/grafana --version 6.32.3  --<span class="built_in">set</span> nodeSelector=<span class="string">"kubernetes\.io/hostname=node-223"</span>,service.type=NodePort,persistence.enabled=True,persistence.storageClassName=<span class="string">"persistentVolumeClaim"</span>,persistence.size=5Gi,persistence.accessModes=ReadWriteOnce -n dashboard --debug --create-namespace</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å– grafana åˆå§‹åŒ–ç™»é™†å¯†ç </span></span><br><span class="line">kubectl get secrets -n devops grafana -o yaml</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"RlJLMkR1bmlpalY2YXRMcGtuU053NmhLanRibnhZZUZRY25tV0ZtSg=="</span> | base64 -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤éƒ¨ç½²çš„grafanaåº”ç”¨</span></span><br><span class="line">$ helm delete grafana</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="0x02-Kubernetes-jmeter-InfluxDB-1-8-x-Grafana-Jenkins-è¿›è¡Œè‡ªåŠ¨åŒ–åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•åŠå…¶ç»“æœå±•ç¤º"><a href="#0x02-Kubernetes-jmeter-InfluxDB-1-8-x-Grafana-Jenkins-è¿›è¡Œè‡ªåŠ¨åŒ–åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•åŠå…¶ç»“æœå±•ç¤º" class="headerlink" title="0x02 Kubernetes + jmeter + InfluxDB 1.8.x + Grafana + Jenkins è¿›è¡Œè‡ªåŠ¨åŒ–åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•åŠå…¶ç»“æœå±•ç¤º"></a>0x02 Kubernetes + jmeter + InfluxDB 1.8.x + Grafana + Jenkins è¿›è¡Œè‡ªåŠ¨åŒ–åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•åŠå…¶ç»“æœå±•ç¤º</h2><h3 id="1-ä»¥-helm-æ–¹å¼å®‰è£…åˆ†å¸ƒå¼-jmeter-å‹åŠ›æµ‹è¯•åº”ç”¨"><a href="#1-ä»¥-helm-æ–¹å¼å®‰è£…åˆ†å¸ƒå¼-jmeter-å‹åŠ›æµ‹è¯•åº”ç”¨" class="headerlink" title="(1) ä»¥ helm æ–¹å¼å®‰è£…åˆ†å¸ƒå¼ jmeter å‹åŠ›æµ‹è¯•åº”ç”¨"></a>(1) ä»¥ helm æ–¹å¼å®‰è£…åˆ†å¸ƒå¼ jmeter å‹åŠ›æµ‹è¯•åº”ç”¨</h3><p><strong>å¿«é€Ÿéƒ¨ç½²</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ  chart ä»“åº“ä¸ç´¢å¼•æ›´æ–°</span></span><br><span class="line">$ helm repo add apphub https://apphub.aliyuncs.com/</span><br><span class="line">$ helm repo update</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢å¯ç”¨çš„ chart ä»“åº“ä¸­è½¯ä»¶ç‰ˆæœ¬</span></span><br><span class="line">$ helm search repo jmeter</span><br><span class="line">  <span class="comment"># NAME                            CHART VERSION   APP VERSION     DESCRIPTION</span></span><br><span class="line">  <span class="comment"># apphub/distributed-jmeter       1.0.1           3.3             A Distributed JMeter Helm chart</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æŒ‡å®š chart ç‰ˆæœ¬çš„ distributed-jmeter ç›¸å…³éƒ¨ç½²å‚æ•°</span></span><br><span class="line">$ helm show values apphub/distributed-jmeter --version 1.0.1 &gt; distributed-jmeter.yaml</span><br><span class="line">$ cat distributed-jmeter.yaml</span><br><span class="line"><span class="comment"># Default values for distributed-jmeter.</span></span><br><span class="line">master:</span><br><span class="line">  replicaCount: 1</span><br><span class="line">server:</span><br><span class="line">  replicaCount: 3</span><br><span class="line">image:</span><br><span class="line">  <span class="comment">## Specify an imagePullPolicy</span></span><br><span class="line">  <span class="comment">## ref: http://kubernetes.io/docs/user-guide/images/#pre-pulling-images</span></span><br><span class="line">  pullPolicy: IfNotPresent</span><br><span class="line">  <span class="comment">## The repository and image</span></span><br><span class="line">  <span class="comment">## ref: https://hub.docker.com/r/pedrocesarti/jmeter-docker/</span></span><br><span class="line">  repository: <span class="string">"pedrocesarti/jmeter-docker"</span></span><br><span class="line">  <span class="comment">## The tag for the image</span></span><br><span class="line">  <span class="comment">## ref: https://hub.docker.com/r/pedrocesarti/jmeter-docker/tags/</span></span><br><span class="line">  tag: 3.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… distributed-jmeter åº”ç”¨åˆ° devtest åç§°ç©ºé—´ä¸‹</span></span><br><span class="line">$ helm install jmeter apphub/distributed-jmeter -f distributed-jmeter.yaml --namespace devtest --create-namespace</span><br><span class="line"><span class="comment"># To get get a shell session on the master you only need to run:</span></span><br><span class="line">  $ <span class="built_in">export</span> MASTER_NAME=$(kubectl get pods -l app.kubernetes.io/component=master -o jsonpath=<span class="string">'&#123;.items[*].metadata.name&#125;'</span>  -n devtest )</span><br><span class="line">  $ kubectl -n devtest <span class="built_in">exec</span> -it <span class="variable">$MASTER_NAME</span>  -- /bin/bash</span><br><span class="line"><span class="comment"># To copy your test plans to the master pod</span></span><br><span class="line">  $ kubectl -n devtest  cp sample.jmx <span class="variable">$MASTER_NAME</span>:/jmeter</span><br><span class="line"><span class="comment"># To run your test in all servers you need first a list of all servers IPs (comma-separated) and then you can run your test:</span></span><br><span class="line">  $ <span class="built_in">export</span> SERVER_IPS=$(kubectl get pods -l app.kubernetes.io/component=server -o jsonpath=<span class="string">'&#123;.items[*].status.podIP&#125;'</span>  -n devtest | tr <span class="string">' '</span> <span class="string">','</span>)</span><br><span class="line">  $ kubectl <span class="built_in">exec</span> -it <span class="variable">$MASTER_NAME</span> -- jmeter -n -t /jmeter/sample.jmx -R <span class="variable">$SERVER_IPS</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ helm éƒ¨ç½²èµ„æº</span></span><br><span class="line">$ kubectl get deployments.apps,pod,svc -n devtest -l app.kubernetes.io/name=distributed-jmeter</span><br><span class="line">  <span class="comment"># NAME                                               READY   UP-TO-DATE   AVAILABLE   AGE</span></span><br><span class="line">  <span class="comment"># deployment.apps/jmeter-distributed-jmeter-master   1/1     1            1           117m</span></span><br><span class="line">  <span class="comment"># deployment.apps/jmeter-distributed-jmeter-server   3/3     3            3           117m</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># NAME                                                    READY   STATUS    RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># pod/jmeter-distributed-jmeter-master-5d5587ffb-8ftvk    1/1     Running   0          114m</span></span><br><span class="line">  <span class="comment"># pod/jmeter-distributed-jmeter-server-7d64577d56-9cdk5   1/1     Running   0          111m</span></span><br><span class="line">  <span class="comment"># pod/jmeter-distributed-jmeter-server-7d64577d56-bpf4q   1/1     Running   0          112m</span></span><br><span class="line">  <span class="comment"># pod/jmeter-distributed-jmeter-server-7d64577d56-sjsd2   1/1     Running   0          114m</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># NAME                                       TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)              AGE</span></span><br><span class="line">  <span class="comment"># service/jmeter-distributed-jmeter-server   ClusterIP   None         &lt;none&gt;        50000/TCP,1099/TCP   117m</span></span><br></pre></td></tr></table></figure>
<p><br/></p>
<p><strong>æ‰‹åŠ¨æµ‹è¯•éƒ¨ç½²ç¯å¢ƒ</strong><br>æ­¥éª¤ 01.å‡†å¤‡ä¸€ä¸ªç®€å•çš„ jmeter æµ‹è¯•ä»»åŠ¡ï¼Œä¾‹å¦‚ä¸‹å›¾ä¸­Apache jmeteré‡Œå®šä¹‰çš„ <code>jmeter-test.jmx</code> ä»»åŠ¡ã€‚</p>
<figure class="image-box">
                <a rel=2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ href="https://img.weiyigeek.top/2022/5/20220719093748.png" target="_blank" title="WeiyiGeek.jmeter-test.jmx" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/5/20220719093748.png" alt="WeiyiGeek.jmeter-test.jmx" title="" class=""></a>
                <p>WeiyiGeek.jmeter-test.jmx</p>
            </figure>
<p><br/></p>
<p>æ­¥éª¤ 02.å°†jmeterä¸­æµ‹è¯•ä»»åŠ¡å¯¼å‡ºåˆ°jmeter-test.jmxæ–‡ä»¶ä¸­ï¼Œå¹¶å¤åˆ¶åˆ° Master èŠ‚ç‚¹å®¹å™¨ä¸­ï¼Œç„¶åæ‰§è¡Œåˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å‘½ä»¤ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å– Master èŠ‚ç‚¹ ä»¥åŠåˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•èŠ‚ç‚¹ IP åœ°å€</span></span><br><span class="line"><span class="built_in">export</span> MASTER_NAME=$(kubectl get pods -l app.kubernetes.io/component=master -o jsonpath=<span class="string">'&#123;.items[*].metadata.name&#125;'</span>  -n devtest )</span><br><span class="line"><span class="built_in">export</span> SERVER_IPS=$(kubectl get pods -l app.kubernetes.io/component=server -o jsonpath=<span class="string">'&#123;.items[*].status.podIP&#125;'</span> -n devtest | tr <span class="string">' '</span> <span class="string">','</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰‹åŠ¨æ‹·è´ jmx å‹åŠ›æµ‹è¯•é…ç½®æ–‡ä»¶åˆ°Jmeter ä¸»èŠ‚ç‚¹ä¸­</span></span><br><span class="line">kubectl -n devtest cp ./jmeter-test.jmx  <span class="variable">$&#123;MASTER_NAME&#125;</span>:/jmeter/jmeter-test.jmx</span><br><span class="line"></span><br><span class="line"><span class="comment"># å•èŠ‚ç‚¹å‹åŠ›æµ‹è¯• æŒ‡å®š -Jgroup.threads çº¿ç¨‹æ•° ï¼Œä»¥åŠ -Jgroup.loops çº¿ç¨‹å¾ªç¯æ¬¡æ•°ã€‚</span></span><br><span class="line">kubectl -n devtest <span class="built_in">exec</span> -it <span class="variable">$MASTER_NAME</span> -- jmeter -Jgroup.threads=5 -Jgroup.loops=20 -n -t /jmeter/jmeter-test.jmx -l jmeter-test.result -R <span class="variable">$SERVER_IPS</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯• æŒ‡å®š -Ggroup.threads æ¯ä¸ªèŠ‚ç‚¹çº¿ç¨‹æ•° ï¼Œä»¥åŠ -Ggroup.loops çº¿ç¨‹å¾ªç¯æ¬¡æ•°ã€‚ï¼ˆæ­¤å¤„å‘æœ‰ç‚¹å¤§ï¼‰</span></span><br><span class="line">kubectl -n devtest <span class="built_in">exec</span> -it <span class="variable">$MASTER_NAME</span> -- jmeter -Ggroup.threads=20 -Ggroup.loops=20 -n -t /jmeter/jmeter-test.jmx -l jmeter-test.result -R <span class="variable">$SERVER_IPS</span> </span><br><span class="line">  <span class="comment"># Creating summariser &lt;summary&gt;</span></span><br><span class="line">  <span class="comment"># Created the tree successfully using /jmeter/jmeter-test.jmx</span></span><br><span class="line">  <span class="comment"># Configuring remote engine: 10.66.24.209</span></span><br><span class="line">  <span class="comment"># Configuring remote engine: 10.66.183.112</span></span><br><span class="line">  <span class="comment"># Configuring remote engine: 10.66.182.204</span></span><br><span class="line">  <span class="comment"># Starting remote engines</span></span><br><span class="line">  <span class="comment"># Starting the test @ Mon Jun 13 04:49:42 UTC 2022 (1655095782003)</span></span><br><span class="line">  <span class="comment"># Remote engines have been started</span></span><br><span class="line">  <span class="comment"># Waiting for possible Shutdown/StopTestNow/Heapdump message on port 4445</span></span><br><span class="line">  <span class="comment"># summary =   1200 in 00:00:02 =  569.0/s Avg:     4 Min:     0 Max:   685 Err:     0 (0.00%)</span></span><br><span class="line">  <span class="comment"># Tidying up remote @ Mon Jun 13 04:49:46 UTC 2022 (1655095786021)</span></span><br><span class="line">  <span class="comment"># ... end of run</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="2-ä»¥èµ„æºæ¸…å•æ–¹å¼å®‰è£…é…ç½®-InfluxDB-1-8-æ—¶åºæ•°æ®åº“"><a href="#2-ä»¥èµ„æºæ¸…å•æ–¹å¼å®‰è£…é…ç½®-InfluxDB-1-8-æ—¶åºæ•°æ®åº“" class="headerlink" title="(2) ä»¥èµ„æºæ¸…å•æ–¹å¼å®‰è£…é…ç½® InfluxDB 1.8 æ—¶åºæ•°æ®åº“"></a>(2) ä»¥èµ„æºæ¸…å•æ–¹å¼å®‰è£…é…ç½® InfluxDB 1.8 æ—¶åºæ•°æ®åº“</h3><p><strong>å¿«é€Ÿå®‰è£…</strong></p>
<p>æ­¥éª¤ 01.å‡†å¤‡influxdbä½¿ç”¨çš„é…ç½®æ–‡ä»¶å¹¶å­˜æ”¾åˆ°configMapèµ„æºæ§åˆ¶å™¨ä¸‹ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">mkdir -vp /storage/dev/webapp/database/jmeter-influxdb</span><br><span class="line">tee /storage/dev/webapp/database/jmeter-influxdb/influxdb.conf &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">[meta]</span><br><span class="line">  dir = <span class="string">"/var/lib/influxdb/meta"</span></span><br><span class="line">  retention-autocreate = <span class="literal">true</span></span><br><span class="line">  logging-enabled = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[data]</span><br><span class="line">  dir = <span class="string">"/var/lib/influxdb/data"</span></span><br><span class="line">  index-version = <span class="string">"inmem"</span></span><br><span class="line">  wal-dir = <span class="string">"/var/lib/influxdb/wal"</span></span><br><span class="line">  wal-fsync-delay = <span class="string">"0s"</span></span><br><span class="line"></span><br><span class="line">[coordinator]</span><br><span class="line">  write-timeout = <span class="string">"10s"</span></span><br><span class="line">  max-concurrent-queries = 0</span><br><span class="line">  query-timeout = <span class="string">"0s"</span></span><br><span class="line">  <span class="built_in">log</span>-queries-after = <span class="string">"0s"</span></span><br><span class="line">  max-select-point = 0</span><br><span class="line">  max-select-series = 0</span><br><span class="line">  max-select-buckets = 0</span><br><span class="line"></span><br><span class="line">[retention]</span><br><span class="line">  enabled = <span class="literal">true</span></span><br><span class="line">  check-interval = <span class="string">"30m0s"</span></span><br><span class="line"></span><br><span class="line">[monitor]</span><br><span class="line">  store-enabled = <span class="literal">true</span></span><br><span class="line">  store-database = <span class="string">"_internal"</span></span><br><span class="line">  store-interval = <span class="string">"10s"</span></span><br><span class="line"></span><br><span class="line">[subscriber]</span><br><span class="line">  enabled = <span class="literal">true</span></span><br><span class="line">  http-timeout = <span class="string">"30s"</span></span><br><span class="line">  insecure-skip-verify = <span class="literal">false</span></span><br><span class="line">  ca-certs = <span class="string">""</span></span><br><span class="line">  write-concurrency = 40</span><br><span class="line">  write-buffer-size = 1000</span><br><span class="line"></span><br><span class="line">[shard-precreation]</span><br><span class="line">  enabled = <span class="literal">true</span></span><br><span class="line">  check-interval = <span class="string">"10m0s"</span></span><br><span class="line">  advance-period = <span class="string">"30m0s"</span></span><br><span class="line"></span><br><span class="line">[http]</span><br><span class="line">  enabled = <span class="literal">true</span></span><br><span class="line">  <span class="built_in">bind</span>-address = <span class="string">":8086"</span></span><br><span class="line"></span><br><span class="line">[logging]</span><br><span class="line">  format = <span class="string">"auto"</span></span><br><span class="line">  level = <span class="string">"info"</span></span><br><span class="line">  suppress-logo = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">[[graphite]]</span><br><span class="line">  enabled = <span class="literal">true</span></span><br><span class="line">  <span class="built_in">bind</span>-address = <span class="string">":2003"</span> </span><br><span class="line">  database = <span class="string">"jmeter"</span></span><br><span class="line">  retention-policy = <span class="string">""</span></span><br><span class="line">  protocol = <span class="string">"tcp"</span></span><br><span class="line">  batch-size = 5000</span><br><span class="line">  batch-pending = 10</span><br><span class="line">  batch-timeout = <span class="string">"1s"</span></span><br><span class="line">  consistency-level = <span class="string">"one"</span></span><br><span class="line">  separator = <span class="string">"."</span></span><br><span class="line">  udp-read-buffer = 0</span><br><span class="line"></span><br><span class="line">[continuous_queries]</span><br><span class="line">  <span class="built_in">log</span>-enabled = <span class="literal">true</span></span><br><span class="line">  enabled = <span class="literal">true</span></span><br><span class="line">  query-stats-enabled = <span class="literal">false</span></span><br><span class="line">  run-interval = <span class="string">"1s"</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> /storage/dev/webapp/database/jmeter-influxdb</span><br><span class="line">$ kubectl create cm influxdb-config --from-file=influxdb.conf --namespace database</span><br><span class="line">  <span class="comment"># configmap/influxdb1-config created</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>æ­¥éª¤ 02.å‡†å¤‡ä½¿ç”¨Deploymentèµ„æºæ§åˆ¶å™¨éƒ¨ç½²jmeter-influxDB1.xç›¸å…³çš„èµ„æºæ¸…å•å¦‚ä¸‹ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">tee influxdb-Deployment.yaml &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">metadata:</span><br><span class="line">  name: jmeter-influxdb-pvc</span><br><span class="line">  namespace: database</span><br><span class="line">  labels:</span><br><span class="line">    app: jmeter-influxdb</span><br><span class="line">spec:</span><br><span class="line">  storageClassName: nfs-devtest</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteOnce</span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage: 2Gi</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: jmeter-influxdb</span><br><span class="line">  namespace: database</span><br><span class="line">  labels:</span><br><span class="line">    app: jmeter-influxdb</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - name: api</span><br><span class="line">    nodePort: 32086</span><br><span class="line">    port: 8086</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 8086</span><br><span class="line">  - name: graphite</span><br><span class="line">    nodePort: 32003</span><br><span class="line">    port: 2003</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 2003</span><br><span class="line">  selector:</span><br><span class="line">    app: jmeter-influxdb</span><br><span class="line">  sessionAffinity: None</span><br><span class="line">  <span class="built_in">type</span>: NodePort</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: jmeter-influxdb</span><br><span class="line">  namespace: database</span><br><span class="line">  labels:</span><br><span class="line">    app: jmeter-influxdb</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: jmeter-influxdb</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: jmeter-influxdb</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: influxdb:1.8.10</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        name: influxdb</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 8086</span><br><span class="line">          name: api</span><br><span class="line">          protocol: TCP</span><br><span class="line">        - containerPort: 2003</span><br><span class="line">          name: graphite</span><br><span class="line">          protocol: TCP</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - mountPath: /etc/influxdb/influxdb.conf</span><br><span class="line">          name: config</span><br><span class="line">          subPath: influxdb.conf</span><br><span class="line">        - mountPath: /var/lib/influxdb</span><br><span class="line">          name: data</span><br><span class="line">      restartPolicy: Always</span><br><span class="line">      terminationGracePeriodSeconds: 30</span><br><span class="line">      volumes:</span><br><span class="line">      - name: config</span><br><span class="line">        configMap:</span><br><span class="line">          defaultMode: 420</span><br><span class="line">          name: influxdb-config</span><br><span class="line">          items:</span><br><span class="line">          - key: influxdb.conf</span><br><span class="line">            path: influxdb.conf</span><br><span class="line">      - name: data</span><br><span class="line">        persistentVolumeClaim:</span><br><span class="line">          claimName: jmeter-influxdb-pvc</span><br><span class="line">      <span class="comment"># - name: data-local</span></span><br><span class="line">      <span class="comment">#  hostPath:</span></span><br><span class="line">      <span class="comment">#    path: /storage/database/influxdb/data</span></span><br><span class="line">      <span class="comment">#    type: DirectoryOrCreate     </span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>æ­¥éª¤ 03.ä½¿ç”¨kubectlå·¥å…·æŒ‰ç…§influxdb-Deployment.yamlèµ„æºæ¸…å•ä¸­çš„å†…å®¹è¿›è¡Œå®‰è£…éƒ¨ç½², å¹¶ä¸”æŸ¥çœ‹å…¶éƒ¨ç½²æƒ…å†µã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f influxdb-Deployment.yaml</span><br><span class="line">  <span class="comment"># persistentvolumeclaim/jmeter-influxdb-pvc created</span></span><br><span class="line">  <span class="comment"># service/jmeter-influxdb created</span></span><br><span class="line">  <span class="comment"># deployment.apps/jmeter-influxdb created</span></span><br><span class="line"></span><br><span class="line">$ kubectl get pod,svc,pvc -n database -l app=jmeter-influxdb</span><br><span class="line">  <span class="comment"># NAME                                   READY   STATUS    RESTARTS   AGE</span></span><br><span class="line">  <span class="comment"># pod/jmeter-influxdb-7867969fbd-ggt4m   1/1     Running   0          56s</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># NAME                      TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)                         AGE</span></span><br><span class="line">  <span class="comment"># service/jmeter-influxdb   NodePort   10.106.17.52   &lt;none&gt;        8086:32086/TCP,2003:32003/TCP   5m12s</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># NAME                                        STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span></span><br><span class="line">  <span class="comment"># persistentvolumeclaim/jmeter-influxdb-pvc   Bound    pvc-d260839d-86cc-4f34-976f-50563ce28084   2Gi        RWO            nfs-devtest    6m9s</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># è¡¥å……è¯´æ˜:</span></span><br><span class="line"><span class="comment"># - Pod ç«¯å£è½¬å‘</span></span><br><span class="line">kubectl port-forward --namespace database $(kubectl get pods --namespace database -l app=jmeter-influxdb -o jsonpath=<span class="string">'&#123; .items[0].metadata.name &#125;'</span>) 8086:8086</span><br><span class="line"></span><br><span class="line"><span class="comment"># - Pod Shellç»ˆç«¯</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -i -t --namespace database $(kubectl get pods --namespace database -l app=jmeter-influxdb -o jsonpath=<span class="string">'&#123;.items[0].metadata.name&#125;'</span>) /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># - Pod æ—¥å¿—æŸ¥çœ‹</span></span><br><span class="line">kubectl logs -f --namespace database $(kubectl get pods --namespace database -l app=jmeter-influxdb -o jsonpath=<span class="string">'&#123; .items[0].metadata.name &#125;'</span>)</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>æ­¥éª¤ 04.è¿›å…¥ jmeter-influxdb pod çš„ shell ç»ˆç«¯ä¸­åˆ›å»º jmeter æ‰€ä½¿ç”¨çš„ç”¨æˆ·åŠå…¶æ•°æ®åº“ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl <span class="built_in">exec</span> -i -t --namespace database $(kubectl get pods --namespace database -l app=jmeter-influxdb -o jsonpath=<span class="string">'&#123;.items[0].metadata.name&#125;'</span>) /bin/bash</span><br><span class="line"></span><br><span class="line">root@influxdb-f54d77bc6-cp46r:/<span class="comment"># influx</span></span><br><span class="line">Connected to http://localhost:8086 version 1.8.10</span><br><span class="line">InfluxDB shell version: 1.8.10</span><br><span class="line"><span class="comment"># æŸ¥çœ‹äº¤äº’å¼å¸®åŠ©</span></span><br><span class="line">&gt; <span class="built_in">help</span> </span><br><span class="line">Usage:</span><br><span class="line">  connect &lt;host:port&gt;   connects to another node specified by host:port</span><br><span class="line">  auth                  prompts <span class="keyword">for</span> username and password</span><br><span class="line">  pretty                toggles pretty <span class="built_in">print</span> <span class="keyword">for</span> the json format</span><br><span class="line">  chunked               turns on chunked responses from server</span><br><span class="line">  chunk size &lt;size&gt;     sets the size of the chunked responses.  Set to 0 to reset to the default chunked size</span><br><span class="line">  use &lt;db_name&gt;         sets current database</span><br><span class="line">  format &lt;format&gt;       specifies the format of the server responses: json, csv, or column</span><br><span class="line">  precision &lt;format&gt;    specifies the format of the timestamp: rfc3339, h, m, s, ms, u or ns</span><br><span class="line">  consistency &lt;level&gt;   sets write consistency level: any, one, quorum, or all</span><br><span class="line">  <span class="built_in">history</span>               displays <span class="built_in">command</span> <span class="built_in">history</span></span><br><span class="line">  settings              outputs the current settings <span class="keyword">for</span> the shell</span><br><span class="line">  clear                 clears settings such as database or retention policy.  run <span class="string">'clear'</span> <span class="keyword">for</span> <span class="built_in">help</span></span><br><span class="line">  <span class="built_in">exit</span>/quit/ctrl+d      quits the influx shell</span><br><span class="line"></span><br><span class="line">  show databases        show database names</span><br><span class="line">  show series           show series information</span><br><span class="line">  show measurements     show measurement information</span><br><span class="line">  show tag keys         show tag key information</span><br><span class="line">  show field keys       show field key information</span><br><span class="line"></span><br><span class="line"><span class="comment"># influx å®¢æˆ·ç«¯é»˜è®¤è®¾ç½®æŸ¥çœ‹</span></span><br><span class="line">&gt; settings</span><br><span class="line">  Setting           Value</span><br><span class="line">  --------          --------</span><br><span class="line">  URL               http://localhost:8086</span><br><span class="line">  Username</span><br><span class="line">  Database</span><br><span class="line">  RetentionPolicy</span><br><span class="line">  Pretty            <span class="literal">false</span></span><br><span class="line">  Format            column</span><br><span class="line">  Write Consistency all</span><br><span class="line">  Chunked           <span class="literal">true</span></span><br><span class="line">  Chunk Size        0</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºjmeterç”¨æˆ·åŠå…¶è®¤è¯å¯†ç ä»¥åŠåˆ›å»ºæ•°æ®åº“jmeter</span></span><br><span class="line">CREATE USER <span class="string">"jmeter"</span> WITH PASSWORD <span class="string">'weiyigeek.top'</span> WITH ALL PRIVILEGES</span><br><span class="line">CREATE DATABASE jmeter</span><br><span class="line">SHOW DATABASES</span><br><span class="line">USE jmeter</span><br><span class="line">SHOW MEASUREMENTS</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="3-åœ¨-jmeter-ä¸­æ·»åŠ -Backend-Listener-é…ç½®-influxDB-ç›¸å…³ä¿¡æ¯"><a href="#3-åœ¨-jmeter-ä¸­æ·»åŠ -Backend-Listener-é…ç½®-influxDB-ç›¸å…³ä¿¡æ¯" class="headerlink" title="(3) åœ¨ jmeter ä¸­æ·»åŠ  Backend Listener é…ç½® influxDB ç›¸å…³ä¿¡æ¯"></a>(3) åœ¨ jmeter ä¸­æ·»åŠ  Backend Listener é…ç½® influxDB ç›¸å…³ä¿¡æ¯</h3><p><strong>æ“ä½œæ­¥éª¤</strong><br>æ­¥éª¤ 01.åœ¨(ä»»åŠ¡çº¿ç¨‹ç»„âš™)å³é”®é€‰ä¸­ -&gt; Add -&gt; Listener -&gt; Backend Listener &gt; ç‚¹å‡»åå°†ä¼šæ˜¾ç¤ºæ­¥éª¤02ç•Œé¢ã€‚</p>
<figure class="image-box">
                <a rel=2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ href="https://img.weiyigeek.top/2022/5/20220719164527.png" target="_blank" title="WeiyiGeek.add Backend Listener" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/5/20220719164527.png" alt="WeiyiGeek.add Backend Listener" title="" class=""></a>
                <p>WeiyiGeek.add Backend Listener</p>
            </figure>
<p><br/></p>
<p>æ­¥éª¤ 02.åœ¨ Name å¤„è¾“å…¥ <code>jmeter-influxDB</code> åç§° , åœ¨ Backend Listener implementation ä¸­ä¸‹æ‹‰é€‰ä¸­( org.apache.jmeter.visualizers.backend.influxdb.influxdbBackendListenerClient ) , å…¶é…ç½®å¦‚ä¸‹æ‰€ç¤º:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">influxdbMetricsSender	org.apache.jmeter.visualizers.backend.influxdb.HttpMetricsSender</span><br><span class="line">influxdbUrl	http://192.168.12.107:32086/write?db=jmeter</span><br><span class="line">application	weiyigeek-index</span><br><span class="line">measurement	jmeter</span><br><span class="line">summaryOnly	<span class="literal">true</span></span><br><span class="line">samplersRegex	.*</span><br><span class="line">percentiles	50;90;95;99</span><br><span class="line">testTitle	jmeter-index</span><br><span class="line">eventTags</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ href="https://img.weiyigeek.top/2022/5/20220719165045.png" target="_blank" title="WeiyiGeek.Configure Backend Listener" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/5/20220719165045.png" alt="WeiyiGeek.Configure Backend Listener" title="" class=""></a>
                <p>WeiyiGeek.Configure Backend Listener</p>
            </figure>
<p>æ¸©é¦¨æç¤º: influxdbUrl æ­¤å¤„é‡‡ç”¨äº† nodePort æš´éœ²çš„ç«¯å£</p>
<p><br/></p>
<p>æ­¥éª¤ 03.åœ¨çº¿ç¨‹ç»„ä¸­æ·»åŠ ä¸€ä¸ªHTTP-Requestè¯·æ±‚ï¼Œå°†ä¸Šé¢æˆ‘ä»¬æ­å»ºæ¼”ç¤ºå‹åŠ›æµ‹è¯•çš„ç«™ç‚¹ä¿¡æ¯è¿›è¡Œå¡«å…¥ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Name: myblog-test</span><br><span class="line">Comments: å¤‡æ³¨å¯ä»¥è‡ªå®šä¹‰</span><br><span class="line">Protocol: http</span><br><span class="line">Server NAME or IP: 192.168.12.107</span><br><span class="line">Port Number: 32644</span><br><span class="line">HTTP Request: GET</span><br><span class="line">Path: /index.html</span><br><span class="line">Content encoding: utf-8</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ href="https://img.weiyigeek.top/2022/5/20220719170520.png" target="_blank" title="WeiyiGeek.Configure HTTP Request" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/5/20220719170520.png" alt="WeiyiGeek.Configure HTTP Request" title="" class=""></a>
                <p>WeiyiGeek.Configure HTTP Request</p>
            </figure>
<p>æ¸©é¦¨æç¤ºï¼šæ­¤å¤„å‹åŠ›æµ‹è¯•åœ°å€å®é™…å°±æ˜¯(<a href="http://192.168.12.107:32644/index.html)" target="_blank" rel="noopener">http://192.168.12.107:32644/index.html)</a>.</p>
<p><br/></p>
<p>æ­¥éª¤ 04.é…ç½®å®Œæˆåç‚¹å‡»èœå•æ ä¸­ ã€Šç»¿è‰²startã€‹ çš„æŒ‰é’®å¼€å§‹å‹åŠ›æµ‹è¯•ä»»åŠ¡ï¼Œè¯·æ±‚ 100 æ¬¡ (æ­¤å¤„ç¼ºçœ 5 çº¿ç¨‹ å¾ªç¯ 20 ), ç„¶åå¯ä»¥é€šè¿‡<code>kubectl logs -f --tail 100 -n devtest jmeter-test-html-0</code>å‘½ä»¤æŸ¥çœ‹åˆ°jmeterè¯·æ±‚è¯¥è·¯å¾„çš„è®¿é—®æ—¥å¿—ã€‚</p>
<figure class="image-box">
                <a rel=2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ href="https://img.weiyigeek.top/2022/5/20220719171650.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://img.weiyigeek.top/2022/5/20220719171650.png" alt="WeiyiGeek." title="" class=""></a>
                <p>WeiyiGeek.</p>
            </figure>
<p><br/></p>
<p>æ­¥éª¤ 05.æŸ¥çœ‹åç«¯ç›‘å¬å™¨é…ç½®influxdbæ•°æ®ä¸­é‡‡é›†åˆ°çš„æ•°æ®ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">exec</span> -i -t --namespace database $(kubectl get pods --namespace database -l app=jmeter-influxdb -o jsonpath=<span class="string">'&#123;.items[0].metadata.name&#125;'</span>) /bin/bash -- influx</span><br><span class="line"></span><br><span class="line">Connected to http://localhost:8086 version 1.8.10</span><br><span class="line">InfluxDB shell version: 1.8.10</span><br><span class="line">&gt; use jmeter</span><br><span class="line">Using database jmeter</span><br><span class="line">&gt; SHOW MEASUREMENTS</span><br><span class="line">name: measurements</span><br><span class="line">name</span><br><span class="line">----</span><br><span class="line">events</span><br><span class="line">jmeter</span><br><span class="line">&gt; select * from jmeter; <span class="comment"># æŸ¥çœ‹ jmeter è¡¨ä¸­å‹åŠ›æµ‹è¯•çš„æ•°æ®</span></span><br><span class="line">name: jmeter</span><br><span class="line">time                application     avg                count countError endedT hit max maxAT meanAT min minAT pct50.0 pct90.0 pct95.0            pct99.0            rb      sb    startedT statut transaction</span><br><span class="line">----                -----------     ---                ----- ---------- ------ --- --- ----- ------ --- ----- ------- ------- -------            -------            --      --    -------- ------ -----------</span><br><span class="line">1658221734017000000 weiyigeek-index                                     0              0     0          0                                                                         0               internal</span><br><span class="line">1658221735666000000 weiyigeek-index 2.09               100   0                 100 24               1         2       2       3.8999999999999773 23.799999999999898 1447500 16400          all    all</span><br><span class="line">1658221735667000000 weiyigeek-index                                     5              1     0          0                                                                         5               internal</span><br><span class="line"></span><br><span class="line">&gt; select * from events; <span class="comment"># æŸ¥çœ‹ jmeter å‹åŠ›æµ‹è¯•äº‹ä»¶ä¿¡æ¯</span></span><br><span class="line">name: events</span><br><span class="line">time                application     text                 title</span><br><span class="line">----                -----------     ----                 -----</span><br><span class="line">1658221734002000000 weiyigeek-index jmeter-index started ApacheJMeter</span><br><span class="line">1658221735666000000 weiyigeek-index jmeter-index ended   ApacheJMeter</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="4-åœ¨-grafana-ä¸­å±•ç¤º-jmeter-å‹åŠ›æµ‹è¯•ç›¸å…³æŒ‡æ ‡æ•°æ®ã€‚"><a href="#4-åœ¨-grafana-ä¸­å±•ç¤º-jmeter-å‹åŠ›æµ‹è¯•ç›¸å…³æŒ‡æ ‡æ•°æ®ã€‚" class="headerlink" title="(4) åœ¨ grafana ä¸­å±•ç¤º jmeter å‹åŠ›æµ‹è¯•ç›¸å…³æŒ‡æ ‡æ•°æ®ã€‚"></a>(4) åœ¨ grafana ä¸­å±•ç¤º jmeter å‹åŠ›æµ‹è¯•ç›¸å…³æŒ‡æ ‡æ•°æ®ã€‚</h3><ul>
<li>æ­¥éª¤ 01.ç™»é™†Grafanaä¹‹åéœ€è¦æ–°å¢æ•°æ®æºï¼ˆAdd your first data sourceï¼‰,æ­¤å¤„å½“ç„¶é€‰æ‹©InfluxDBæ—¶é—´åºåˆ—æ•°æ®åº“æºã€‚</li>
</ul>
<figure class="image-box">
                <a rel=2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ href="https://img.weiyigeek.top/2022/5/20220613091854.png" target="_blank" title="WeiyiGeek.æ·»åŠ  InfluxDB æ•°æ®æº" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/5/20220613091854.png" alt="WeiyiGeek.æ·»åŠ  InfluxDB æ•°æ®æº" title="" class=""></a>
                <p>WeiyiGeek.æ·»åŠ  InfluxDB æ•°æ®æº</p>
            </figure>
<p><br/></p>
<ul>
<li>æ­¥éª¤ 02.é€‰æ‹©åå°†ä¼šå‡ºç°å¦‚ä¸‹ç•Œé¢, éœ€è¦æŒ‰ç…§å®é™…æƒ…å†µè¿›è¡Œå¡«å†™, å…¶ä¸­æœ€é‡è¦çš„æ˜¯influxdbç›¸å…³è¿æ¥æ•°æ®åº“è®¤è¯ä¿¡æ¯ï¼ˆjmeterã€jmeterã€weiyigeek.topï¼‰, å¡«å†™æ— è¯¯åç‚¹å‡» <code>Save&amp;Test</code>, å¦‚æµ‹è¯•æˆåŠŸå°†ä¼šæ˜¾ç¤º<code>Data source is working</code>ã€‚</li>
</ul>
<p>æ¸©é¦¨æç¤º: æ­¤å¤„ influxdb url å¡«å…¥çš„æ˜¯ (<a href="http://jmeter-influxdb.database.svc:8086" target="_blank" rel="noopener">http://jmeter-influxdb.database.svc:8086</a>) å³æœåŠ¡åç§°åŠ SVCç«¯å£ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å¡«å†™èŠ‚ç‚¹IP+nodePortç«¯å£å³(<a href="http://192.168.12.107:32086/" target="_blank" rel="noopener">http://192.168.12.107:32086/</a>) </p>
<p><a rel=2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ href="https://img.weiyigeek.top/2022/5/20220719173933.png" target="_blank" title="WeiyiGeek.é’ˆå¯¹ InfluxDB æ•°æ®æºé…ç½®" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/5/20220719173933.png" alt="WeiyiGeek.é’ˆå¯¹ InfluxDB æ•°æ®æºé…ç½®"></a></p>
<p><br/></p>
<ul>
<li>æ­¥éª¤ 03.ç„¶åå¯ä»¥ç‚¹å‡»æ­¥éª¤02é¡µé¢ä¸Šçš„Exploreï¼Œæ‰§è¡Œå¦‚ä¸‹sqlï¼š<code>SELECT * FROM &quot;jmeter&quot; limit 3</code>è¿›è¡ŒæŸ¥è¯¢åˆ°jmeterå‹åŠ›æµ‹è¯•çš„æ•°æ®ã€‚</li>
</ul>
<figure class="image-box">
                <a rel=2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ href="https://img.weiyigeek.top/2022/5/20220719173813.png" target="_blank" title="WeiyiGeek.InfluxDB Explore" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/5/20220719173813.png" alt="WeiyiGeek.InfluxDB Explore" title="" class=""></a>
                <p>WeiyiGeek.InfluxDB Explore</p>
            </figure>
<p><br/></p>
<ul>
<li>æ­¥éª¤ 04.è®¿é—®grafanaæ¨¡æ¿å•†åŸ (<a href="https://grafana.com/grafana/dashboards/?plcmt=footer&amp;search=jmeter)" target="_blank" rel="noopener">https://grafana.com/grafana/dashboards/?plcmt=footer&amp;search=jmeter)</a>, æ‰¾å¯»æ˜¾ç¤º jmeter ç›¸åº”çš„ dashboards æ¨¡æ¿, æ­¤å¤„ä»¥æ¨¡æ¿ID 5496 ä¸ºä¾‹ (<a href="https://grafana.com/grafana/dashboards/5496)" target="_blank" rel="noopener">https://grafana.com/grafana/dashboards/5496)</a>, åœ¨ grafana ä¸­ import  è¾“å…¥è¯¥ID -&gt; ç‚¹å‡» load -&gt; éšåè®¾ç½® dashboard åç§° -&gt;  DBNAME é€‰æ‹©å‰é¢æ·»åŠ çš„ InfluxDB æ•°æ®æº -&gt; Measurement name è®¾ç½®ä¸º jmeter -&gt; åç«¯å‘é€é—´éš”æ—¶é—´è®¾ç½®ä¸º 5 å³å¯ -&gt; æœ€åç‚¹ Import  å¯¼å…¥è¯¥ Dashboard åˆ° grafana ä¸­.</li>
</ul>
<figure class="image-box">
                <a rel=2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ href="https://img.weiyigeek.top/2022/5/20220719195719.png" target="_blank" title="WeiyiGeek.Apache JMeter Dashboard using Core InfluxdbBackendListenerClient" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/5/20220719195719.png" alt="WeiyiGeek.Apache JMeter Dashboard using Core InfluxdbBackendListenerClient" title="" class=""></a>
                <p>WeiyiGeek.Apache JMeter Dashboard using Core InfluxdbBackendListenerClient</p>
            </figure>
<p><br/></p>
<ul>
<li>æ­¥éª¤ 05.å¯¼å…¥åæˆ‘ä»¬ä¾¿å¯åœ¨ Grafana é¦–é¡µä¸­æŸ¥çœ‹åˆ°è¯¥ Dashboard, æˆ‘ä»¬ç‚¹å‡»è¿›å…¥æŸ¥çœ‹è¯¥å±•æ¿æ˜¾ç¤ºçš„ Jmeter å‹åŠ›æµ‹è¯•çš„æ•°æ®ã€‚</li>
</ul>
<figure class="image-box">
                <a rel=2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ href="https://img.weiyigeek.top/2022/5/20220719201207.png" target="_blank" title="WeiyiGeek.Apache JMeter Dashboard" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/5/20220719201207.png" alt="WeiyiGeek.Apache JMeter Dashboard" title="" class=""></a>
                <p>WeiyiGeek.Apache JMeter Dashboard</p>
            </figure>
<p><br></p>
<h3 id="5-ä½¿ç”¨-kubernetes-Gitlab-Jenkins-Grafana-å®ç°è‡ªåŠ¨åŒ–åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•æ•°æ®å±•ç¤ºå®è·µ"><a href="#5-ä½¿ç”¨-kubernetes-Gitlab-Jenkins-Grafana-å®ç°è‡ªåŠ¨åŒ–åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•æ•°æ®å±•ç¤ºå®è·µ" class="headerlink" title="(5) ä½¿ç”¨ kubernetes + Gitlab + Jenkins + Grafana å®ç°è‡ªåŠ¨åŒ–åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•æ•°æ®å±•ç¤ºå®è·µ"></a>(5) ä½¿ç”¨ kubernetes + Gitlab + Jenkins + Grafana å®ç°è‡ªåŠ¨åŒ–åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•æ•°æ®å±•ç¤ºå®è·µ</h3><p><strong>å®è·µæµç¨‹:</strong><br>æ­¥éª¤ 01.é¦–å…ˆåœ¨ç§æœ‰çš„ Gitlab ä¸Šåˆ›å»ºä¸€ä¸ªJmeterï¼Œæ­¤å¤„æˆ‘å·²ç»åœ¨Gitlabä¸­åˆ›å»ºå¥½äº†jmeteré¡¹ç›®, ä½ å¯ä»¥åœ¨åˆ›å»ºåå°†å‰é¢å‡†å¤‡çš„jmeter æµ‹è¯•ä»»åŠ¡ jmeter-test.jmx æ–‡ä»¶push åˆ°ä»£ç ä»“åº“ä¸­ã€‚</p>
<figure class="image-box">
                <a rel=2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ href="https://img.weiyigeek.top/2022/5/20220720160845.png" target="_blank" title="WeiyiGeek.Jmeter ä»“åº“" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/5/20220720160845.png" alt="WeiyiGeek.Jmeter ä»“åº“" title="" class=""></a>
                <p>WeiyiGeek.Jmeter ä»“åº“</p>
            </figure>
<p>æ¸©é¦¨æç¤º: Gitlab çš„å®‰è£…æ­¤å¤„ä¸è¿›è¡Œå±•å¼€è®²è§£, å¦‚æœ‰éœ€è¦å®‰è£…å®è·µçš„ç«¥é‹å¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡æ–‡ç«  [GitLabä¼ä¸šçº§ç§æœ‰ä»£ç ä»“åº“å®‰è£…ä¸åŸºç¡€ä½¿ç”¨] (<a href="https://blog.weiyigeek.top/2019/7-22-98.html">https://blog.weiyigeek.top/2019/7-22-98.html</a>) æˆ–è€… gitlab å®˜æ–¹å®‰è£…æ–‡æ¡£ (<a href="https://about.gitlab.com/install/)ã€‚" target="_blank" rel="noopener">https://about.gitlab.com/install/)ã€‚</a></p>
<p><br/></p>
<p>æ­¥éª¤ 02.åœ¨ Jenkins ä¸­åˆ›å»ºä¸€ä¸ªåä¸º Jmeter æµæ°´çº¿çš„ä»»åŠ¡ï¼Œç„¶åå†è¿›è¡Œå¦‚ä¸‹é…ç½®:</p>
<blockquote>
<p>(1) å‹¾é€‰ GitHub é¡¹ç›® -&gt; è¾“å…¥Jmeteré¡¹ç›®åœ°å€ (<a href="http://gitlab.weiyigeek.top/devops/jmeter.git" target="_blank" rel="noopener">http://gitlab.weiyigeek.top/devops/jmeter.git</a>) </p>
</blockquote>
<blockquote>
<p>(2) åœ¨ GitLab Connection ä¸‹æ‹‰æ¡†ä¸­é€‰æ‹© Gitlab-Auth è®¤è¯çš„ç¥¨æ® (å…¶ç”Ÿæˆå¯ä»¥å‚è€ƒä¸‹é¢æ¸©é¦¨æç¤ºä¸­çš„æ–‡ç« )</p>
</blockquote>
<blockquote>
<p>(3) æ„å»ºè§¦å‘å™¨é€‰é¡¹å¡ä¸­å‹¾é€‰ <code>Enabled GitLab triggers</code>.<br>Build when a change is pushed to GitLab. GitLab webhook URL: <a href="http://192.168.12.226:30001/project/jmeter" target="_blank" rel="noopener">http://192.168.12.226:30001/project/jmeter</a></p>
</blockquote>
<p>æ¸©é¦¨æç¤º: Jenkins çš„ç›¸å…³å®‰è£…éƒ¨ç½²è¯·å‚è€ƒæˆ‘çš„åšå®¢æ–‡ç«  ã€Š<a href="https://blog.weiyigeek.top/tags/Jenkins/ã€‹">https://blog.weiyigeek.top/tags/Jenkins/ã€‹</a></p>
<p><a rel=2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ href="https://img.weiyigeek.top/2022/5/20220720170134.png" target="_blank" title="WeiyiGeek.Jenkins Jmeter Task configuration" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/5/20220720170134.png" alt="WeiyiGeek.Jenkins Jmeter Task configuration"></a></p>
<p><br/></p>
<p>æ­¥éª¤ 03.åœ¨ Jmeter é¡¹ç›®ä»“åº“ä¸­æ·»åŠ æ‹¥æœ‰Reporteræƒé™çš„è‡ªåŠ¨åŒ–CI/CDç”¨æˆ·, æ­¤å¤„æ·»åŠ çš„ @devops ç”¨æˆ·ï¼Œä¸ºäº†èƒ½è‡ªåŠ¨è§¦å‘Jenkinsè¿›è¡Œéƒ¨ç½²ä»¥åŠå‹åŠ›æµ‹è¯•ï¼Œæˆ‘ä»¬éœ€è¦å†è®¾ç½® -&gt; webhooks -&gt; æ·»åŠ  jenkins ä»»åŠ¡ url ä»¥åŠ è®¤è¯ Secret Token</p>
<blockquote>
<p>URL: <a href="http://192.168.12.226:30001/project/jmeter" target="_blank" rel="noopener">http://192.168.12.226:30001/project/jmeter</a><br>Secret Token: 11c513a49620v573d275357836cc3e1c4f</p>
</blockquote>
<p>æ¸©é¦¨æç¤º: ä¸Šè¿° Secret Token çš„åˆ›å»º ä»¥åŠGitlabç§æœ‰ä»“åº“ç”Ÿæˆé¡¹ç›®<code>API Access Token</code>å¯ä»¥å‚è€ƒæˆ‘çš„å¦‚ä¸‹ä¸¤ç¯‡æ–‡ç« ã€‚</p>
<ul>
<li><p>Jenkinsä¸Gitlab-é›†æˆé…ç½®ä¸å®è·µ <a href="https://blog.weiyigeek.top/2020/12-28-513.html#Gitlab-%E9%9B%86%E6%88%90%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%AE%9E%E8%B7%B5">https://blog.weiyigeek.top/2020/12-28-513.html#Gitlab-é›†æˆé…ç½®ä¸å®è·µ</a></p>
</li>
<li><p>Gitlab è‡ªåŠ¨è§¦å‘æ„å»ºä¹‹ Pipeline Script from SCM <a href="https://blog.weiyigeek.top/2020/12-30-523.html#2-Gitlab-%E8%87%AA%E5%8A%A8%E8%A7%A6%E5%8F%91%E6%9E%84%E5%BB%BA%E4%B9%8B-Pipeline-Script-from-SCM">https://blog.weiyigeek.top/2020/12-30-523.html#2-Gitlab-è‡ªåŠ¨è§¦å‘æ„å»ºä¹‹-Pipeline-Script-from-SCM</a></p>
</li>
</ul>
<p><a rel=2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ href="https://img.weiyigeek.top/2022/5/20220720163415.png" target="_blank" title="WeiyiGeek.devops+webhook" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/5/20220720163415.png" alt="WeiyiGeek.devops+webhook"></a></p>
<p><br/></p>
<p>æ­¥éª¤ 04.åœ¨ jenkins Jmeter ä»»åŠ¡ä¸­æµæ°´çº¿çš„è„šæœ¬å¦‚ä¸‹:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// [ Groovy å…¨å±€å˜é‡å®šä¹‰]</span></span><br><span class="line"><span class="comment">// - GITé¡¹ç›®åœ°å€</span></span><br><span class="line"><span class="comment">// def GITLAB = "http://gitlab.weiyigeek.top/devops/jmeter.git" </span></span><br><span class="line"><span class="keyword">def</span> PRJECT = <span class="string">"ssh://git@gitlab.weiyigeek.top/devops/jmeter.git"</span></span><br><span class="line"><span class="keyword">def</span> PUBKEY = <span class="string">"5e2f46d9-6725-4399-847f-dafb3f29d0ce"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// - ä¼ä¸šå¾®ä¿¡ - WebHookURL</span></span><br><span class="line"><span class="keyword">def</span> QY_WECHAT_WEBHOOK_KEY= <span class="string">"ee1165c3-56c1-4bc1-8423-ecc5ccda9278"</span></span><br><span class="line"><span class="keyword">def</span> QY_WECHAT_WEBHOOK = <span class="string">"https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=$&#123;QY_WECHAT_WEBHOOK_KEY&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// - æ­£å¼ç¯å¢ƒä¸æµ‹è¯•ç¯å¢ƒå‚æ•°é¢„è®¾</span></span><br><span class="line"><span class="keyword">def</span> ENV_TEST() &#123;</span><br><span class="line">  <span class="keyword">def</span> config = [:]</span><br><span class="line">  config.K8S_API_SERVER = <span class="string">"https://slb-vip.k8s:16443"</span></span><br><span class="line">  config.K8S_IP_SERVER = <span class="string">"192.168.12.110"</span></span><br><span class="line">  config.K8S_CREDENTIALSID = <span class="string">"8cf24244-3e26-41a9-b7fe-3eb20778c33a"</span></span><br><span class="line">  config.CI_NAME = <span class="string">"$&#123;env.JOB_NAME&#125;"</span></span><br><span class="line">  config.CI_NAMESPACE = <span class="string">"devtest"</span></span><br><span class="line">  config.CI_ENVIRONMENT = <span class="string">"test"</span></span><br><span class="line">  config.CI_COMMAND = <span class="string">'["bash"]'</span></span><br><span class="line">  config.CI_STORAGE_NAME = <span class="string">"nfs-devtest"</span></span><br><span class="line">  config.INGRESS_DOMAIN = <span class="string">"testapp.weiyigeek.top"</span></span><br><span class="line">  config.HARBOR_URL = <span class="string">"harbor.weiyigeek.top/devops"</span></span><br><span class="line">  config.HARBOR_AUTH = <span class="string">"d0ce1239-c4bf-41ed-a4c6-660ab70d9b47"</span></span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> ENV_PROD() &#123;</span><br><span class="line">  <span class="keyword">def</span> config = [:]</span><br><span class="line">  config.K8S_API_SERVER = <span class="string">"https://apiserver.cluster.weiyigeek:6443"</span></span><br><span class="line">  config.K8S_IP_SERVER = <span class="string">"192.168.12.102"</span></span><br><span class="line">  config.K8S_CREDENTIALSID = <span class="string">"k8s-cluster.weiyigeek-devops"</span></span><br><span class="line">  config.CI_NAME = <span class="string">"$&#123;env.JOB_NAME&#125;"</span></span><br><span class="line">  config.CI_NAMESPACE = <span class="string">"devtest"</span></span><br><span class="line">  config.CI_ENVIRONMENT = <span class="string">"prod"</span></span><br><span class="line">  config.CI_COMMAND = <span class="string">'["bash"]'</span></span><br><span class="line">  config.CI_STORAGE_NAME = <span class="string">"nfs-storage"</span></span><br><span class="line">  config.INGRESS_DOMAIN = <span class="string">"test.app.weiyigeek.top"</span></span><br><span class="line">  config.HARBOR_URL = <span class="string">"harbor.weiyigeek.top/devops"</span></span><br><span class="line">  config.HARBOR_AUTH = <span class="string">"d0ce1239-c4bf-41ed-a4c6-660ab70d9b47"</span></span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»»åŠ¡åç§°ã€ä»»åŠ¡å·¥ä½œç©ºé—´PODåç§°</span></span><br><span class="line"><span class="keyword">def</span> JOB_NAME = <span class="string">"$&#123;env.JOB_NAME&#125;-$&#123;env.BUILD_NUMBER&#125;"</span></span><br><span class="line"><span class="keyword">def</span> JOB_WORKSPACE = <span class="string">"$&#123;env.WORKSPACE&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰å˜é‡</span></span><br><span class="line"><span class="comment">// String JmeterNAME = null</span></span><br><span class="line"><span class="comment">// String JmeterENV = null</span></span><br><span class="line"><span class="comment">// String JmeterFILE = null</span></span><br><span class="line"><span class="comment">// Integer JmeterGthreads = null</span></span><br><span class="line"><span class="comment">// Integer JmeterGloops = null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// [ Groovy å…¨å±€å‡½æ•°å®šä¹‰]</span></span><br><span class="line"><span class="comment">// è·å–çœŸå®é¡¹ç›®è·¯å¾„æœºå™¨æ„å»ºçš„åŒ…ä¿¡æ¯å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> GET_REAL_PROJECT()&#123;</span><br><span class="line">  <span class="keyword">def</span> PROJECT = [:]</span><br><span class="line">  PROJECT.commitmsg=sh <span class="string">label:</span> <span class="string">'git_commitmsg'</span>,<span class="string">returnStdout:</span> <span class="literal">true</span>, <span class="string">script:</span> <span class="string">"""</span></span><br><span class="line"><span class="string">   git show --oneline --ignore-all-space --text | head -n 1 |tr -d '\\n'</span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line">  <span class="comment">// éªŒè¯ä¸æå–commitä¿¡æ¯ 45cd579 jmeter cloud zycx.jmx 100 1000</span></span><br><span class="line">  <span class="keyword">if</span>( PROJECT.commitmsg != <span class="literal">null</span> ) &#123;</span><br><span class="line">    <span class="keyword">def</span> arr = PROJECT.commitmsg.split(<span class="string">" "</span>) <span class="keyword">as</span> List</span><br><span class="line">    print arr</span><br><span class="line">    PROJECT.JmeterNAME = arr[<span class="number">1</span>]</span><br><span class="line">    PROJECT.JmeterENV = arr[<span class="number">2</span>]</span><br><span class="line">    PROJECT.JmeterFILE = arr[<span class="number">3</span>]</span><br><span class="line">    PROJECT.JmeterGthreads = arr[<span class="number">4</span>].toInteger()</span><br><span class="line">    PROJECT.JmeterGloops = arr[<span class="number">5</span>].toInteger()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    unstable <span class="string">'æå–git commitä¿¡æ¯å¤±è´¥'</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è·å– jmx ä»»åŠ¡æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">  PROJECT.JmeterFilePath=sh <span class="string">label:</span> <span class="string">'JmeterFilePath'</span>,<span class="string">returnStdout:</span> <span class="literal">true</span>, <span class="string">script:</span> <span class="string">"""</span></span><br><span class="line"><span class="string">    find $&#123;env.WORKSPACE&#125; -name $&#123;PROJECT.JmeterFILE&#125; | head -n 1 | tr -d '\n'</span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line">  print PROJECT.JmeterFilePath</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> PROJECT</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// [Jenkins Pipeline æµæ°´çº¿ å¼€å§‹]</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">  <span class="comment">// æµæ°´çº¿è¿è¡Œçš„ä¸»æœºç»‘å®š,æ­¤å¤„åˆ©ç”¨åŠ¨æ€çš„K8sèŠ‚ç‚¹è¿›è¡Œã€‚</span></span><br><span class="line">  agent &#123;</span><br><span class="line">    kubernetes &#123;</span><br><span class="line">      cloud <span class="string">'kubernetes'</span></span><br><span class="line">      namespace <span class="string">'devops'</span></span><br><span class="line">      inheritFrom <span class="string">'jenkins-slave'</span></span><br><span class="line">      showRawYaml <span class="string">'false'</span></span><br><span class="line">      workingDir <span class="string">'/home/jenkins/agent'</span></span><br><span class="line">      yaml <span class="string">"""\</span></span><br><span class="line"><span class="string">apiVersion:</span></span><br><span class="line"><span class="string">kind: Pod</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  labels:</span></span><br><span class="line"><span class="string">    app: 'jenkins-jnlp'</span></span><br><span class="line"><span class="string">    job: $&#123;JOB_NAME&#125;</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  serviceAccountName: 'jenkins-sa'</span></span><br><span class="line"><span class="string">  automountServiceAccountToken: false</span></span><br><span class="line"><span class="string">  securityContext:</span></span><br><span class="line"><span class="string">    runAsUser: 1000   # default UID of jenkins user in agent image</span></span><br><span class="line"><span class="string">  containers:</span></span><br><span class="line"><span class="string">  - name: 'jnlp'</span></span><br><span class="line"><span class="string">    image: 'harbor.weiyigeek.top/devops/alpine-jenkins-jnlp:v2.330'</span></span><br><span class="line"><span class="string">    imagePullPolicy: 'IfNotPresent'</span></span><br><span class="line"><span class="string">    command: ["/bin/sh"]</span></span><br><span class="line"><span class="string">    args: ["-c","/usr/local/bin/jenkins-agent.sh &amp;&amp; cat"]</span></span><br><span class="line"><span class="string">    tty: true</span></span><br><span class="line"><span class="string">    env:</span></span><br><span class="line"><span class="string">      - name: JAVA_OPTS</span></span><br><span class="line"><span class="string">        value: '-Xms512m -Xmx1g -Xss1m'</span></span><br><span class="line"><span class="string">    resources:</span></span><br><span class="line"><span class="string">      limits: &#123;&#125;</span></span><br><span class="line"><span class="string">      requests:</span></span><br><span class="line"><span class="string">        memory: '512Mi'</span></span><br><span class="line"><span class="string">        cpu: '500m'</span></span><br><span class="line"><span class="string">    volumeMounts:</span></span><br><span class="line"><span class="string">    - name: 'docker-socket'</span></span><br><span class="line"><span class="string">      mountPath: '/var/run/docker.sock'</span></span><br><span class="line"><span class="string">  volumes:</span></span><br><span class="line"><span class="string">  - name: docker-socket</span></span><br><span class="line"><span class="string">    hostPath: </span></span><br><span class="line"><span class="string">      path: /var/run/docker.sock</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å…¨å±€é€‰é¡¹é¢„å®šä¹‰è®¾å®š</span></span><br><span class="line">  options &#123;</span><br><span class="line">   gitLabConnection(<span class="string">'Private-Gitlab'</span>)</span><br><span class="line">   gitlabBuilds(<span class="string">builds:</span> [<span class="string">'ä»£ç æ‹‰å–'</span>, <span class="string">'å‹åŠ›æµ‹è¯•'</span>,<span class="string">'ç»“æœå±•ç¤º'</span>])</span><br><span class="line">   timeout(<span class="string">time:</span> <span class="number">30</span>, <span class="string">unit:</span> <span class="string">'MINUTES'</span>) </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è‡ªå®šä¹‰ç¯å¢ƒå˜é‡, é€šè¿‡ env.å˜é‡åè®¿é—® </span></span><br><span class="line">  environment &#123;</span><br><span class="line">    <span class="comment">// ä»£ç ä»“åº“åœ°å€ä¸è®¤è¯åœ°å€</span></span><br><span class="line">    GITLAB_URL = <span class="string">"$&#123;PRJECT&#125;"</span></span><br><span class="line">    GITLAB_PUB = <span class="string">"$&#123;PUBKEY&#125;"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»£ç è´¨é‡æ£€æµ‹é¡¹ç›®åç§°ä¸åé¦ˆè¶…æ—¶æ—¶é—´</span></span><br><span class="line">    SONARQUBE_PROJECTKEY = <span class="string">"$&#123;JOB_NAME&#125;"</span>;</span><br><span class="line">    SONARQUBE_TIMEOUT = <span class="string">'60'</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è‡ªå®šä¹‰é€‰æ‹©å‚æ•°ï¼Œåœ¨ sh ä¸­å¯é€šè¿‡å˜é‡åè®¿é—®ï¼Œè€Œåœ¨ script pipeline è„šæœ¬ä¸­é€šè¿‡ params.å‚æ•°åç§° è®¿é—® </span></span><br><span class="line">  parameters &#123;</span><br><span class="line">    gitParameter <span class="string">branch:</span> <span class="string">''</span>, <span class="string">branchFilter:</span> <span class="string">'origin/(.*)'</span>, <span class="string">defaultValue:</span> <span class="string">'origin/master'</span>, <span class="string">description:</span> <span class="string">'æŸ¥çœ‹æ„å»ºéƒ¨ç½²å¯ç”¨çš„Tagæˆ–Branchåç§°?'</span>, <span class="string">name:</span> <span class="string">'TagBranchName'</span>, <span class="string">quickFilterEnabled:</span> <span class="literal">false</span>, <span class="string">selectedValue:</span> <span class="string">'NONE'</span>, <span class="string">sortMode:</span> <span class="string">'DESCENDING_SMART'</span>, <span class="string">tagFilter:</span> <span class="string">'*'</span>, <span class="string">type:</span> <span class="string">'GitParameterDefinition'</span></span><br><span class="line">    string(<span class="string">name:</span> <span class="string">'RELEASE_VERSION'</span>, <span class="string">defaultValue:</span> <span class="string">"master"</span>, <span class="string">description:</span> <span class="string">'Message: è¯·é€‰æ‹©æ„å»ºéƒ¨ç½²çš„Tagæˆ–Branchåç§°?'</span>, <span class="string">trim:</span> <span class="string">'True'</span>)</span><br><span class="line">    choice(<span class="string">name:</span> <span class="string">'PREJECT_ENVIRONMENT'</span>, <span class="string">choices:</span> [<span class="string">'Test'</span>, <span class="string">'Test'</span>], <span class="string">description:</span> <span class="string">'Message: é€‰æ‹©é¡¹ç›®éƒ¨ç½²ç¯å¢ƒ?'</span>)</span><br><span class="line">    choice(<span class="string">name:</span> <span class="string">'PREJECT_OPERATION'</span>, <span class="string">choices:</span> [<span class="string">'None'</span>, <span class="string">'deploy'</span>, <span class="string">'rollback'</span>, <span class="string">'redeploy'</span>], <span class="string">description:</span> <span class="string">'Message: é€‰æ‹©é¡¹ç›®æ“ä½œæ–¹å¼?'</span>)</span><br><span class="line">    choice(<span class="string">name:</span> <span class="string">'IS_IMAGEBUILD'</span>, <span class="string">choices:</span> [<span class="string">'True'</span>,<span class="string">'False'</span>], <span class="string">description:</span> <span class="string">'Message: æ˜¯å¦è¿›è¡Œé•œåƒæ„å»ºæ“ä½œ?'</span>)</span><br><span class="line">    choice(<span class="string">name:</span> <span class="string">'IS_RELEASE'</span>, <span class="string">choices:</span> [<span class="string">'False'</span>,<span class="string">'True'</span>], <span class="string">description:</span> <span class="string">'Message: æ˜¯å¦è¿›è¡Œç¼–è¯‘æˆå“å‘å¸ƒ?'</span>)</span><br><span class="line">    choice(<span class="string">name:</span> <span class="string">'IS_SONARQUBE'</span>, <span class="string">choices:</span> [<span class="string">'False'</span>,<span class="string">'True'</span>], <span class="string">description:</span> <span class="string">'Message: æ˜¯å¦è¿›è¡Œä»£ç è´¨é‡æ£€æµ‹?'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è§¦å‘ä¸Gitlab æµæ°´çº¿åŒæ­¥æ›´æ–°</span></span><br><span class="line">  triggers &#123;</span><br><span class="line">    gitlab(<span class="string">triggerOnPush:</span> <span class="literal">true</span>, <span class="string">triggerOnMergeRequest:</span> <span class="literal">true</span>, <span class="string">branchFilterType:</span> <span class="string">'All'</span>)</span><br><span class="line">  &#125; </span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸»è¦é˜¶æ®µä»¥åŠå­é˜¶æ®µæµç¨‹</span></span><br><span class="line">  stages &#123;</span><br><span class="line">    <span class="comment">// [ é˜¶æ®µ1.é¡¹ç›®ä»£ç æ‹‰å– ]</span></span><br><span class="line">    stage (<span class="string">'ä»£ç æ‹‰å–'</span>) &#123;</span><br><span class="line">      steps &#123;</span><br><span class="line">        <span class="comment">// 1.è¶…æ—¶æ—¶é—´è®¾ç½®5åˆ†é’Ÿ</span></span><br><span class="line">        timeout(<span class="string">time:</span> <span class="number">5</span>, <span class="string">unit:</span> <span class="string">'MINUTES'</span>) &#123;</span><br><span class="line">          script &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              checkout([<span class="string">$class:</span> <span class="string">'GitSCM'</span>, <span class="string">branches:</span> [[<span class="string">name:</span> <span class="string">"$&#123;params.RELEASE_VERSION&#125;"</span>]], <span class="string">doGenerateSubmoduleConfigurations:</span> <span class="literal">false</span>, <span class="string">extensions:</span> [], <span class="string">submoduleCfg:</span> [], <span class="string">userRemoteConfigs:</span> [[<span class="string">credentialsId:</span> <span class="string">"$&#123;env.GITLAB_PUB&#125;"</span>, <span class="string">url:</span> <span class="string">"$&#123;env.GITLAB_URL&#125;"</span>]]])</span><br><span class="line">              updateGitlabCommitStatus <span class="string">name:</span> <span class="string">'ä»£ç æ‹‰å–'</span>, <span class="string">state:</span> <span class="string">'success'</span></span><br><span class="line">            &#125; <span class="keyword">catch</span>(Exception err) &#123;</span><br><span class="line">              updateGitlabCommitStatus <span class="string">name:</span> <span class="string">'ä»£ç æ‹‰å–'</span>, <span class="string">state:</span> <span class="string">'failed'</span></span><br><span class="line">              <span class="comment">// * æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ä½†è¿˜æ˜¯ä¼šè¿›è¡Œä¸‹ä¸€é˜¶æ®µæ“ä½œ</span></span><br><span class="line">              echo err.toString()    <span class="comment">/* hudson.AbortException: Couldn't find any revision to build. Verify the repository and branch configuration for this job. */</span></span><br><span class="line">              unstable <span class="string">'æ‹‰å–ä»£ç å¤±è´¥'</span></span><br><span class="line">              error <span class="string">"[-Error] : ä»£ç æ‹‰å–å¤±è´¥\n [-Msg] : $&#123;err.getMessage()&#125; "</span> <span class="comment">/* å¤±è´¥ç«‹å³åœæ­¢ */</span></span><br><span class="line">            &#125; </span><br><span class="line">        </span><br><span class="line">            <span class="comment">// 2.æ„å»ºä¿¡æ¯è¾“å‡º ï¼ˆæ³¨æ„å¿…é¡»æ”¾å…¥åˆ° script ä»£ç å—ä¸­ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> ( <span class="string">"$&#123;env.gitlabActionType&#125;"</span> != <span class="string">"null"</span> ) &#123;</span><br><span class="line">              echo <span class="string">"ä»»åŠ¡åç§°: $&#123;JOB_NAME&#125;, è‡ªåŠ¨è§¦å‘æ“ä½œ: $&#123;env.gitlabActionType&#125;, é¡¹ç›®åç§°: $&#123;env.gitlabSourceRepoName&#125;, é¡¹ç›®åœ°å€: $&#123;env.GITLAB_URL&#125;,é¡¹ç›®åˆ†æ”¯ï¼š$&#123;env.gitlabBranch&#125; - $&#123;env.gitlabSourceBranch&#125;"</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              echo <span class="string">"ä»»åŠ¡åç§°: $&#123;JOB_NAME&#125;, æ‰‹åŠ¨è§¦å‘æ“ä½œ: $&#123;params.PREJECT_OPERATION&#125;, é¡¹ç›®ç¯å¢ƒ: $&#123;env.PREJECT_ENVIRONMENT&#125;"</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.åˆ©ç”¨ GET_REAL_PROJECT å‡½æ•°è·å–é¡¹ç›®ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">            project = GET_REAL_PROJECT()</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4.éªŒè¯éƒ¨ç½²ç¯å¢ƒè¿›è¡Œé¢„è®¾é…ç½®ç¯å¢ƒå‚æ•°å€¼</span></span><br><span class="line">            <span class="keyword">if</span> ( <span class="string">"$&#123;project.JmeterENV&#125;"</span> == <span class="string">"cloud"</span> ) &#123;</span><br><span class="line">              config = ENV_TEST()</span><br><span class="line">              print <span class="string">"é¡¹ç›®ç¯å¢ƒ: $&#123;project.JmeterENV&#125;"</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              config = ENV_TEST()</span><br><span class="line">              print <span class="string">"é¡¹ç›®ç¯å¢ƒ: $&#123;project.JmeterENV&#125;"</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5.é€šè¿‡ä¼ä¸šå¾®ä¿¡è¿›è¡Œæ„å»ºé€šçŸ¥</span></span><br><span class="line">            <span class="keyword">if</span> ( <span class="string">"$&#123;env.gitlabActionType&#125;"</span> != <span class="string">"null"</span> ) &#123;</span><br><span class="line">              sh <span class="string">label:</span> <span class="string">'auto message notification'</span>, <span class="string">script:</span> <span class="string">"""\</span></span><br><span class="line"><span class="string">              curl $&#123;QY_WECHAT_WEBHOOK&#125; \</span></span><br><span class="line"><span class="string">              -H 'Content-Type: application/json' \</span></span><br><span class="line"><span class="string">              -d '&#123;</span></span><br><span class="line"><span class="string">                  "msgtype": "markdown",</span></span><br><span class="line"><span class="string">                  "markdown": &#123;</span></span><br><span class="line"><span class="string">                    "content":"Jenkins-æ¶ˆæ¯é€šçŸ¥&lt;font color=\\"info\\"&gt;ã€$&#123;JOB_NAME&#125;ã€‘&lt;/font&gt;ä»»åŠ¡å¼€å§‹, è‡ªåŠ¨è§¦å‘! \\n</span></span><br><span class="line"><span class="string">                    &gt;é¡¹ç›®ä¿¡æ¯: &lt;font color=\\"warning\\"&gt;$&#123;project.JmeterNAME&#125; - $&#123;env.gitlabBranch&#125; - $&#123;env.gitlabMergeRequestLastCommit&#125;&lt;/font&gt;</span></span><br><span class="line"><span class="string">                    &gt;æäº¤ä¿¡æ¯: &lt;font color=\\"warning\\"&gt;$&#123;project.commitmsg&#125;&lt;/font&gt;</span></span><br><span class="line"><span class="string">                    &gt;æµ‹è¯•ç¯å¢ƒ: $&#123;project.JmeterENV&#125;</span></span><br><span class="line"><span class="string">                    &gt;æµ‹è¯•ä»»åŠ¡: $&#123;project.JmeterFILE&#125;</span></span><br><span class="line"><span class="string">                    &gt;çº¿ç¨‹æ•°é‡: $&#123;project.JmeterGthreads&#125;</span></span><br><span class="line"><span class="string">                    &gt;å¾ªç¯æ¬¡æ•°: $&#123;project.JmeterGloops&#125;</span></span><br><span class="line"><span class="string">                    &gt;[æŸ¥çœ‹å½“å‰ä»»åŠ¡æµæ°´çº¿]($&#123;env.BUILD_URL&#125;)"</span></span><br><span class="line"><span class="string">                  &#125;</span></span><br><span class="line"><span class="string">              &#125;'</span></span><br><span class="line"><span class="string">              """</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              sh <span class="string">label:</span> <span class="string">'manual message notification'</span>, <span class="string">script:</span> <span class="string">"""\</span></span><br><span class="line"><span class="string">              curl $&#123;QY_WECHAT_WEBHOOK&#125; \</span></span><br><span class="line"><span class="string">              -H 'Content-Type: application/json' \</span></span><br><span class="line"><span class="string">              -d '&#123;</span></span><br><span class="line"><span class="string">                  "msgtype": "markdown",</span></span><br><span class="line"><span class="string">                  "markdown": &#123;</span></span><br><span class="line"><span class="string">                    "content":"Jenkins-æ¶ˆæ¯é€šçŸ¥&lt;font color=\\"info\\"&gt;ã€$&#123;JOB_NAME&#125;ã€‘&lt;/font&gt;ä»»åŠ¡å¼€å§‹, æ‰‹å·¥è§¦å‘! \\n</span></span><br><span class="line"><span class="string">                    &gt;é¡¹ç›®ä¿¡æ¯: &lt;font color=\\"warning\\"&gt;$&#123;project.JmeterNAME&#125; - $&#123;params.TagBranchName&#125;&lt;/font&gt;</span></span><br><span class="line"><span class="string">                    &gt;æäº¤ä¿¡æ¯: &lt;font color=\\"warning\\"&gt;$&#123;project.commitmsg&#125;&lt;/font&gt;</span></span><br><span class="line"><span class="string">                    &gt;æµ‹è¯•ç¯å¢ƒ: $&#123;project.JmeterENV&#125;</span></span><br><span class="line"><span class="string">                    &gt;æµ‹è¯•ä»»åŠ¡: $&#123;project.JmeterFILE&#125;</span></span><br><span class="line"><span class="string">                    &gt;çº¿ç¨‹æ•°é‡: $&#123;project.JmeterGthreads&#125;</span></span><br><span class="line"><span class="string">                    &gt;å¾ªç¯æ¬¡æ•°: $&#123;project.JmeterGloops&#125;</span></span><br><span class="line"><span class="string">                    &gt;[æŸ¥çœ‹å½“å‰ä»»åŠ¡æµæ°´çº¿]($&#123;env.BUILD_URL&#125;)"</span></span><br><span class="line"><span class="string">                  &#125;</span></span><br><span class="line"><span class="string">              &#125;'</span></span><br><span class="line"><span class="string">              """</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">    stage (<span class="string">"å‹åŠ›æµ‹è¯•"</span>) &#123;</span><br><span class="line">      when &#123;</span><br><span class="line">        expression &#123; <span class="keyword">return</span> params.PREJECT_OPERATION == <span class="string">"None"</span>&#125;</span><br><span class="line">      &#125;</span><br><span class="line">      steps &#123;</span><br><span class="line">        script &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="comment">// ä½¿ç”¨K8Sé›†ç¾¤ç¥¨æ®è¿›è¡Œæ“ä½œè¿œç¨‹é›†ç¾¤éƒ¨ç½²èµ„æº</span></span><br><span class="line">              withKubeConfig(<span class="string">caCertificate:</span> <span class="string">''</span>, <span class="string">clusterName:</span> <span class="string">''</span>, <span class="string">contextName:</span> <span class="string">''</span>, <span class="string">credentialsId:</span> <span class="string">"$&#123;config.K8S_CREDENTIALSID&#125;"</span>, <span class="string">namespace:</span> <span class="string">''</span>, <span class="string">serverUrl:</span> <span class="string">"$&#123;config.K8S_API_SERVER&#125;"</span>) &#123;</span><br><span class="line">                String[] K8S_API_DOMAIN;</span><br><span class="line">                K8S_API_DOMAIN = <span class="string">"$&#123;config.K8S_API_SERVER&#125;"</span>.split(<span class="string">'//'</span>);</span><br><span class="line">                K8S_API_DOMAIN = <span class="string">"$&#123;K8S_API_DOMAIN[1]&#125;"</span>.split(<span class="string">':'</span>);</span><br><span class="line">                print <span class="string">"K8S_API_DOMAIN -&gt;"</span> + K8S_API_DOMAIN[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">                <span class="comment">// é…ç½®ä¿®æ”¹/etc/hostsæ–‡ä»¶ä»¥å°†Kubernetes APIåœ°å€è¿›è¡Œç»‘å®š,å¹¶åˆ¤æ–­jmeter Server Pod çŠ¶æ€æ˜¯å¦æ­£å¸¸</span></span><br><span class="line">                res_status=sh <span class="string">label:</span><span class="string">'jmeter'</span>,<span class="string">returnStdout:</span> <span class="literal">true</span>, <span class="string">script:</span> <span class="string">""" </span></span><br><span class="line"><span class="string">                  echo "$&#123;config.K8S_IP_SERVER&#125; $&#123;K8S_API_DOMAIN[0]&#125;" | sudo tee -a /etc/hosts  &gt;&gt; /dev/null \</span></span><br><span class="line"><span class="string">                  &amp;&amp; kubectl get pod -n $&#123;config.CI_NAMESPACE&#125; -l app.kubernetes.io/instance=jmeter | grep "jmeter" | wc -l | head -n 1 |tr -d '\\n'</span></span><br><span class="line"><span class="string">                """</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// å¦‚æœä¸º0åˆ™ä»£è¡¨æ— è¯¥èµ„æºè¿›è¡Œéƒ¨ç½² </span></span><br><span class="line">                <span class="keyword">if</span> ( <span class="string">"$&#123;res_status&#125;"</span> != <span class="string">"0"</span> ) &#123;</span><br><span class="line">                  print <span class="string">"jmeter-distributed (master/server) = $&#123;res_status&#125;"</span></span><br><span class="line">                  <span class="comment">// Master èŠ‚ç‚¹åç§°</span></span><br><span class="line">                  <span class="keyword">def</span> MASTER_NAME=sh <span class="string">label:</span><span class="string">'MASTER_NAME'</span>,<span class="string">returnStdout:</span> <span class="literal">true</span>, <span class="string">script:</span> <span class="string">"""</span></span><br><span class="line"><span class="string">                    kubectl get pods -l app.kubernetes.io/component=master -o jsonpath='&#123;.items[*].metadata.name&#125;' -n $&#123;config.CI_NAMESPACE&#125; | tr -d '\\n'</span></span><br><span class="line"><span class="string">                  """</span></span><br><span class="line">                  <span class="comment">// Server èŠ‚ç‚¹IP</span></span><br><span class="line">                  <span class="keyword">def</span> SERVER_IPS=sh <span class="string">label:</span><span class="string">'SERVER_IPS'</span>,<span class="string">returnStdout:</span> <span class="literal">true</span>, <span class="string">script:</span> <span class="string">"""</span></span><br><span class="line"><span class="string">                    kubectl get pods -l app.kubernetes.io/component=server -o jsonpath='&#123;.items[*].status.podIP&#125;' -n $&#123;config.CI_NAMESPACE&#125; | tr ' ' ',' |tr -d '\\n'</span></span><br><span class="line"><span class="string">                  """</span></span><br><span class="line">                  print <span class="string">"Name: $&#123;MASTER_NAME&#125;\nServer_IPS: $&#123;SERVER_IPS&#125;"</span></span><br><span class="line">      </span><br><span class="line">                  <span class="comment">// # æ‰‹åŠ¨æ‹·è´ jmx å‹åŠ›æµ‹è¯•é…ç½®æ–‡ä»¶åˆ°Jmeter ä¸»èŠ‚ç‚¹ä¸­</span></span><br><span class="line">                  <span class="comment">// # åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯• æŒ‡å®š -Ggroup.threads æ¯ä¸ªèŠ‚ç‚¹çº¿ç¨‹æ•° ï¼Œä»¥åŠ -Ggroup.loops çº¿ç¨‹å¾ªç¯æ¬¡æ•°ã€‚ï¼ˆæ­¤å¤„å‘æœ‰ç‚¹å¤§ï¼‰</span></span><br><span class="line">                  sh <span class="string">label:</span><span class="string">'Jmeter-distributed'</span>, <span class="string">script:</span> <span class="string">"""</span></span><br><span class="line"><span class="string">                    kubectl -n $&#123;config.CI_NAMESPACE&#125; cp $&#123;project.JmeterFilePath&#125; $&#123;MASTER_NAME&#125;:/jmeter/$&#123;project.JmeterFILE&#125; &amp;&amp; \</span></span><br><span class="line"><span class="string">                    kubectl -n $&#123;config.CI_NAMESPACE&#125; exec -it $MASTER_NAME -- jmeter -Ggroup.threads=$&#123;project.JmeterGthreads&#125; -Ggroup.loops=$&#123;project.JmeterGloops&#125; -n -t /jmeter/$&#123;project.JmeterFILE&#125; -l $&#123;project.JmeterFILE&#125;.result -R $SERVER_IPS </span></span><br><span class="line"><span class="string">                  """</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  print <span class="string">"jmeter-distributed (master/server) = $&#123;res_status&#125;"</span></span><br><span class="line">                  error <span class="string">"[-Error] : jmeter-distributed åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•masterã€serverç¯å¢ƒæœªå¯åŠ¨!\n "</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              updateGitlabCommitStatus <span class="string">name:</span> <span class="string">'å‹åŠ›æµ‹è¯•'</span>, <span class="string">state:</span> <span class="string">'success'</span></span><br><span class="line">            &#125; <span class="keyword">catch</span>(Exception err) &#123;</span><br><span class="line">              echo err.toString()    <span class="comment">/* hudson.AbortException: Couldn't find any revision to build. Verify the repository and branch configuration for this job. */</span></span><br><span class="line">              unstable <span class="string">'å‹åŠ›æµ‹è¯•å¤±è´¥'</span></span><br><span class="line">              updateGitlabCommitStatus <span class="string">name:</span> <span class="string">'å‹åŠ›æµ‹è¯•'</span>, <span class="string">state:</span> <span class="string">'failed'</span></span><br><span class="line">              error <span class="string">"[-Error] : å‹åŠ›æµ‹è¯•å¤±è´¥\n [-Msg] : $&#123;err.getMessage()&#125; "</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stage(<span class="string">'ç»“æœå±•ç¤º'</span>) &#123;</span><br><span class="line">      when &#123;</span><br><span class="line">        expression &#123; <span class="keyword">return</span> params.PREJECT_OPERATION == <span class="string">"None"</span>&#125;</span><br><span class="line">      &#125;</span><br><span class="line">      steps &#123;</span><br><span class="line">        script &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              sh <span class="string">label:</span><span class="string">'grafana-jmeter-dashboard'</span>,<span class="string">script:</span><span class="string">"""</span></span><br><span class="line"><span class="string">                curl -s $&#123;QY_WECHAT_WEBHOOK&#125; \</span></span><br><span class="line"><span class="string">                -H 'Content-Type: application/json' \</span></span><br><span class="line"><span class="string">                -d '&#123;</span></span><br><span class="line"><span class="string">                    "msgtype": "markdown",</span></span><br><span class="line"><span class="string">                    "markdown": &#123;</span></span><br><span class="line"><span class="string">                      "content":"Jenkins-æ¶ˆæ¯é€šçŸ¥&lt;font color=\\"info\\"&gt;ã€$&#123;JOB_NAME&#125;ã€‘&lt;/font&gt; - $&#123;project.JmeterFILE&#125; ä»»åŠ¡å‹åŠ›æµ‹è¯•å®Œæ¯• !^_^\\n</span></span><br><span class="line"><span class="string">                      &gt;å›¾å½¢è®¿é—®åœ°å€: &lt;font color=\\"warning\\"&gt;[https://devops.weiyigeek.top/grafana/d/p6hnPpg4z/apache-jmeter-dashboard?from=now-5m&amp;to=now](https://devops.weiyigeek.top/grafana/d/p6hnPpg4z/apache-jmeter-dashboard?from=now-5m&amp;to=now)&lt;/font&gt;</span></span><br><span class="line"><span class="string">                      &gt;[æŸ¥çœ‹å½“å‰ä»»åŠ¡æµæ°´çº¿]($&#123;env.BUILD_URL&#125;)"</span></span><br><span class="line"><span class="string">                    &#125;</span></span><br><span class="line"><span class="string">                &#125;'</span></span><br><span class="line"><span class="string">              """</span></span><br><span class="line">              updateGitlabCommitStatus <span class="string">name:</span> <span class="string">'ç»“æœå±•ç¤º'</span>, <span class="string">state:</span> <span class="string">'success'</span></span><br><span class="line">          &#125; <span class="keyword">catch</span> (Exception err) &#123;</span><br><span class="line">              updateGitlabCommitStatus <span class="string">name:</span> <span class="string">'ç»“æœå±•ç¤º'</span>, <span class="string">state:</span> <span class="string">'failed'</span></span><br><span class="line">              echo err.toString()    <span class="comment">/* hudson.AbortException: Couldn't find any revision to build. Verify the repository and branch configuration for this job. */</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (12) POSTé˜¶æ®µå½“æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œåè§¦å‘è¿›è¡Œå·¥ä½œç©ºé—´çš„æ¸…ç†ä»¥åŠæ¶ˆæ¯é€šçŸ¥;</span></span><br><span class="line">  post &#123;</span><br><span class="line">    always &#123;</span><br><span class="line">      deleteDir()  <span class="comment">/* clean up our workspace */</span></span><br><span class="line">    &#125;</span><br><span class="line">    success &#123;</span><br><span class="line">      echo <span class="string">"Pipeline $&#123;env.JOB_NAME&#125; é¡¹ç›®æˆåŠŸ ^_^"</span></span><br><span class="line">      qyWechatNotification <span class="string">failNotify:</span> <span class="literal">true</span>, <span class="string">webhookUrl:</span> <span class="string">"https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=$&#123;QY_WECHAT_WEBHOOK_KEY&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">    unstable &#123;</span><br><span class="line">      echo <span class="string">"Pipeline $&#123;env.JOB_NAME&#125; é¡¹ç›®ä¸ç¨³å®š :/"</span></span><br><span class="line">      qyWechatNotification <span class="string">failNotify:</span> <span class="literal">true</span>, <span class="string">webhookUrl:</span> <span class="string">"https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=$&#123;QY_WECHAT_WEBHOOK_KEY&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">    failure &#123;</span><br><span class="line">      echo <span class="string">"Pipeline $&#123;env.JOB_NAME&#125; é¡¹ç›®å¤±è´¥ :("</span></span><br><span class="line">      qyWechatNotification <span class="string">failNotify:</span> <span class="literal">true</span>, <span class="string">webhookUrl:</span> <span class="string">"https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=$&#123;QY_WECHAT_WEBHOOK_KEY&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">    changed &#123;</span><br><span class="line">      echo <span class="string">"Pipeline $&#123;env.JOB_NAME&#125; é¡¹ç›®æ”¹å˜ .-."</span></span><br><span class="line">      qyWechatNotification <span class="string">failNotify:</span> <span class="literal">true</span>, <span class="string">webhookUrl:</span> <span class="string">"https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=$&#123;QY_WECHAT_WEBHOOK_KEY&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¸©é¦¨æç¤º: ä¸Šè¿°ä½¿ç”¨ Jenkins è‡ªå®šä¹‰ jnlp-Slave é•œåƒ <code>weiyigeek/alpine-jenkins-jnlp</code>ï¼Œå¦‚éœ€è‡ªè¡Œæ„å»ºå¯ä»¥å‚è€ƒå¦‚ä¸‹åœ°å€<a href="https://hub.docker.com/r/weiyigeek/alpine-jenkins-jnlp" target="_blank" rel="noopener">https://hub.docker.com/r/weiyigeek/alpine-jenkins-jnlp</a></p>
<p>æ¸©é¦¨æç¤º: æ­¤å¤„åœ¨ jenkins ä¸­ä½¿ç”¨ kubernetes-plugins æ’ä»¶ä»¥ä¾¿åœ¨ kubernetes Cloud é›†ç¾¤ä¸­åŠ¨æ€ç”Ÿæˆ Slave Pod ï¼Œ å‚è€ƒåœ°å€: <a href="https://blog.weiyigeek.top/2020/12-30-531.html#3-%E9%9B%86%E7%BE%A4%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BA-Agent-%E8%8A%82%E7%82%B9-Slave-%E8%8A%82%E7%82%B9">https://blog.weiyigeek.top/2020/12-30-531.html#3-é›†ç¾¤åŠ¨æ€åˆ›å»º-Agent-èŠ‚ç‚¹-Slave-èŠ‚ç‚¹</a>ã€‚</p>
<p>æ¸©é¦¨æç¤º: ä¸Šè¿° webhook æ¶ˆæ¯é€šçŸ¥æ˜¯é‡‡ç”¨äº†ä¼ä¸šå¾®ä¿¡ç¾¤æœºå™¨äºº qy-wechat-notification-plugin æ’ä»¶ <a href="https://blog.weiyigeek.top/2020/12-31-537.html#4-qy-wechat-notification-plugin">https://blog.weiyigeek.top/2020/12-31-537.html#4-qy-wechat-notification-plugin</a>ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å°†å…¶æ¢ä¸ºé˜¿é‡Œé’‰é’‰é€šçŸ¥ï¼Œä¸»è¦çœ‹ä½ ä¼ä¸šä¸­æ˜¯ä½¿ç”¨å“ªä¸€ä¸ªä½œä¸ºä½ çš„é€šçŸ¥ä½¿ç”¨ã€‚</p>
<p><br/></p>
<p>æ­¥éª¤ 05.åœ¨å‰é¢çš„ç¯å¢ƒéƒ½å‡†å¤‡å¥½çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ä¸Šä¼ jmeterä»»åŠ¡jmxæ ¼å¼çš„æ–‡ä»¶åˆ°gitlabä»“åº“ä¸­ï¼Œç„¶åé…ç½®çš„webhookå°†ä¼šè‡ªåŠ¨è§¦å‘Jenkinsä»»åŠ¡ä»è€Œè¿›è¡Œè‡ªåŠ¨åŒ–å‹åŠ›æµ‹è¯•ï¼Œæ­¤å¤„æˆ‘ä»¬å…ˆæ¥çœ‹è‡ªåŠ¨è§¦å‘ã€‚</p>
<blockquote>
<p>1.æˆ‘ä»¬éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ª jmeter å¸¦çº¿ç¨‹ç»„çš„ä»»åŠ¡ï¼Œåœ¨Thread Propertiesä¸­åˆ†åˆ«åœ¨Number of Threads ã€ Loop Count é…ç½®ä¸º <code>${__P(group.threads,50)}</code> å’Œ <code>${__P(group.loops,200)}</code></p>
</blockquote>
<blockquote>
<p>2.ç„¶ååœ¨ jmeter å¸¦çº¿ç¨‹ç»„çš„ä»»åŠ¡, å³é”®æ–°å¢ä¸€ä¸ª Backend Listner å…¶å…³é”®ç‚¹å¦‚ä¸‹æ‰€ç¤º:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># influxdbMetricsSender ä¸€èˆ¬é»˜è®¤å³å¯</span></span><br><span class="line">influxdbMetricsSender: org.apache.jmeter.visualizers.backend.influxdb.HttpMetricsSender</span><br><span class="line"><span class="comment"># å…³é”®ç‚¹: æ­å»ºçš„influxdb 1.xè¿æ¥å­—ç¬¦ä¸²</span></span><br><span class="line">influxdbUrl: http://192.168.12.107:32086/write?db=jmeter</span><br><span class="line"><span class="comment"># å…³é”®ç‚¹: åº”ç”¨åç§°åç»­åœ¨grafanaä¸­éœ€è¦æ‰‹åŠ¨é€‰æ‹©æŒ‡å®šåº”ç”¨åç§°çš„å‹åŠ›æµ‹è¯•ç»“æœ</span></span><br><span class="line">application: index</span><br><span class="line"><span class="comment"># å…³é”®ç‚¹: jmeter å‹åŠ›æµ‹è¯•æ•°æ®å­˜æ”¾çš„è¡¨åç§°</span></span><br><span class="line">measurement	jmeter</span><br><span class="line"><span class="comment"># ä»…ä»…æ”¶é›†æ‘˜è¦ä¿¡æ¯</span></span><br><span class="line">summaryOnly	<span class="literal">true</span></span><br><span class="line"><span class="comment"># é‡‡æ ·å™¨Regexæ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">samplersRegex	.*</span><br><span class="line"><span class="comment"># ç»Ÿè®¡çš„ç™¾åˆ†ä½</span></span><br><span class="line">percentiles	50;90;95;99</span><br><span class="line"><span class="comment"># æµ‹è¯•æ ‡é¢˜</span></span><br><span class="line">testTitle	title-index</span><br><span class="line"><span class="comment"># äº‹ä»¶æ ‡ç­¾</span></span><br><span class="line">eventTags	tag-index</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ href="https://img.weiyigeek.top/2022/5/20220720173210.png" target="_blank" title="WeiyiGeek.Backend Listner" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/5/20220720173210.png" alt="WeiyiGeek.Backend Listner" title="" class=""></a>
                <p>WeiyiGeek.Backend Listner</p>
            </figure>
<p><br/></p>
<p>æ­¥éª¤ 06.æ­¤å¤„æˆ‘ä½¿ç”¨ git å°† jmeter é¡¹ç›®å…‹éš†åˆ°æœ¬åœ°ä¸­, ç„¶åå°†ä¸Šé¢çš„jmeterä»»åŠ¡è¿›è¡Œå¯¼å‡ºï¼Œå¹¶ä¸”å¤åˆ¶ jmeter-test.jmx åˆ°æœ¬åœ°<code>E:\githubProject\jmeter</code> ç›®å½•ä¹‹ä¸­ï¼Œé€šè¿‡ git ä¸‰æ­¥æ³•å°†æ›´æ”¹æäº¤åˆ°Gitlabä»“åº“ä¸­ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> ssh://git@gitlab.weiyigeek.top:2222/devops/jmeter.git</span><br><span class="line"><span class="built_in">cd</span> E:\githubProject\jmeter</span><br><span class="line">copy C:\Users\WeiyiGeek\Downloads\jmeter-test.jmx E:\githubProject\jmeter</span><br><span class="line"></span><br><span class="line">$ git add .</span><br><span class="line">$ git commit -m <span class="string">"jmeter weiyigeek jmeter-test.jmx 50 100"</span></span><br><span class="line">$ git push</span><br></pre></td></tr></table></figure>
<p>æ¸©é¦¨æç¤ºï¼šæ­¤å¤„æˆ‘å·²ç»å°†sshå…¬é’¥æ·»åŠ åˆ°gitlabä¸­äº†, åç»­æ‹‰å–å’Œæ¨é€ä»£ç åˆ°ç§æœ‰ä»“åº“æ›´åŠ æ–¹ä¾¿ã€‚</p>
<p><br/></p>
<p>æ­¥éª¤ 07.åœ¨ Jenkins ä¸­å¯ä»¥æŸ¥çœ‹åˆ° <code>Started by GitLab push by WeiyiGeek</code> è‡ªåŠ¨è§¦å‘å­—æ ·, å¹¶ä¸”åœ¨ blueocean æ’ä»¶ç•Œé¢ä¸‹å¯ä»¥çœ‹åˆ°æµæ°´çº¿æ‰§è¡Œçš„æƒ…å†µã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+ kubectl -n devtest cp /home/jenkins/agent/workspace/jmeter/jmeter-test.jmx jmeter-distributed-jmeter-master-5d5587ffb-b5nf6:/jmeter/jmeter-test.jmx</span><br><span class="line">+ kubectl -n devtest <span class="built_in">exec</span> -it jmeter-distributed-jmeter-master-5d5587ffb-b5nf6 -- jmeter <span class="string">'-Ggroup.threads=50'</span> <span class="string">'-Ggroup.loops=100'</span> -n -t /jmeter/jmeter-test.jmx -l jmeter-test.jmx.result -R 10.66.24.215,10.66.24.209,10.66.0.197</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ href="https://img.weiyigeek.top/2022/5/20220721093703.png" target="_blank" title="WeiyiGeek.Jenkins pipeline & blueocean" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/5/20220721093703.png" alt="WeiyiGeek.Jenkins pipeline & blueocean" title="" class=""></a>
                <p>WeiyiGeek.Jenkins pipeline & blueocean</p>
            </figure>
<p><br/></p>
<p>æ­¥éª¤ 08.ä¸Šè¿° <code>Jenkins pipeline</code> æµæ°´çº¿æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå¯ä»¥ä»ä¼ä¸šå¾®ä¿¡ä¸­æŸ¥çœ‹åˆ° jmeter ä»»åŠ¡ç›¸å…³é€šçŸ¥</p>
<figure class="image-box">
                <a rel=2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ href="https://img.weiyigeek.top/2022/5/20220721094538.png" target="_blank" title="WeiyiGeek.qywechat notification" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/5/20220721094538.png" alt="WeiyiGeek.qywechat notification" title="" class=""></a>
                <p>WeiyiGeek.qywechat notification</p>
            </figure>
<p><br/></p>
<p>æ­¥éª¤ 09.ç‚¹å‡»ä¼ä¸šå¾®ä¿¡ä¸­å±•ç¤ºå‹åŠ›æµ‹è¯•æ•°æ®çš„ <code>Grafana dashboard</code> åœ°å€ï¼ŒæŸ¥çœ‹jmeterå‹åŠ›æµ‹è¯•çš„ç›¸å…³æ•°æ®ã€‚</p>
<figure class="image-box">
                <a rel=2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ href="https://img.weiyigeek.top/2022/5/20220721094651.png" target="_blank" title="WeiyiGeek.Grafana & jmeter" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/5/20220721094651.png" alt="WeiyiGeek.Grafana & jmeter" title="" class=""></a>
                <p>WeiyiGeek.Grafana & jmeter</p>
            </figure>
<p><br/></p>
<p>æ­¥éª¤ 10.ä¸Šè¿°æä¾›çš„Jenkinsæµæ°´çº¿ä¸­é™¤äº†é€šè¿‡Gitlabä»£ç ä»“åº“æ›´æ–°è‡ªåŠ¨è§¦å‘å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è¿›è¡Œæ‰‹åŠ¨è§¦å‘è¿›è¡Œjmeterè‡ªåŠ¨åŒ–å‹åŠ›æµ‹è¯•ï¼Œæˆ‘ä»¬åœ¨Jenkins Dashboard ä¸­ç‚¹å‡» jmeter -&gt; <code>Build With Parameters</code> -&gt; æ­¤å¤„æˆ‘åªæœ‰ä¸€ä¸ªé»˜è®¤åˆ†æ”¯æ‰€ä»¥ï¼Œå…¶å‚æ•°ç¼ºçœå³å¯(è¯·æ³¨æ„è„šæœ¬ä¸­çš„<code>ENV_TEST()</code>å‡½æ•°) -&gt; ç‚¹å‡»å¼€å§‹æ„å»º, å®Œæˆåå°†å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<figure class="image-box">
                <a rel=2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ href="https://img.weiyigeek.top/2022/5/20220721093438.png" target="_blank" title="WeiyiGeek.æ‰‹åŠ¨è§¦å‘Jmeterå‹åŠ›æµ‹è¯•" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/5/20220721093438.png" alt="WeiyiGeek.æ‰‹åŠ¨è§¦å‘Jmeterå‹åŠ›æµ‹è¯•" title="" class=""></a>
                <p>WeiyiGeek.æ‰‹åŠ¨è§¦å‘Jmeterå‹åŠ›æµ‹è¯•</p>
            </figure>
<p><br/></p>
<p>è‡³æ­¤åœ¨åœ¨Kubernetesé›†ç¾¤ä¸­è¿›è¡Œ<code>jmeter + InfluxDB + gitlab + Jenkins</code>è¿›è¡Œè‡ªåŠ¨åŒ–jmeteråˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µå®Œæ¯•!.</p>
<hr>
<h2 id="0x03-åœ¨Kubernetesé›†ç¾¤-jmeter-InfluxDB-2-x-Grafana-ä¸­è¿›è¡Œè‡ªåŠ¨åŒ–åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•åŠç»“æœå±•ç¤º"><a href="#0x03-åœ¨Kubernetesé›†ç¾¤-jmeter-InfluxDB-2-x-Grafana-ä¸­è¿›è¡Œè‡ªåŠ¨åŒ–åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•åŠç»“æœå±•ç¤º" class="headerlink" title="0x03 åœ¨Kubernetesé›†ç¾¤(jmeter + InfluxDB 2.x + Grafana)ä¸­è¿›è¡Œè‡ªåŠ¨åŒ–åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•åŠç»“æœå±•ç¤º"></a>0x03 åœ¨Kubernetesé›†ç¾¤(jmeter + InfluxDB 2.x + Grafana)ä¸­è¿›è¡Œè‡ªåŠ¨åŒ–åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•åŠç»“æœå±•ç¤º</h2><p>æè¿°: å¦‚æœè¦ä½¿ç”¨æœ€æ–° jmeter dashboard æ¨¡æ¿ï¼Œæˆ‘ä»¬éœ€è¦å°† InfluxDB ç‰ˆæœ¬åˆ‡æ¢ä¸º 2.x å¹¶ä¸”åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯• jmeter ç¨‹åºéœ€è¦è¿è¡Œåœ¨ JDK 11 ä»¥ä¸Šã€‚</p>
<p>æ¸©é¦¨æç¤º: Java SE Development Kit 11.0.15.1 (Java SE è®¢é˜…è€…å°†è‡³å°‘åœ¨ 2026 å¹´ 9 æœˆä¹‹å‰æ”¶åˆ° JDK 11 æ›´æ–°), ä¸‹è½½åœ°å€ <a href="https://www.oracle.com/java/technologies/downloads/#java11" target="_blank" rel="noopener">https://www.oracle.com/java/technologies/downloads/#java11</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">systeminfo</span><br><span class="line">  <span class="comment"># OS åç§°: Microsoft Windows 10 ä¸“ä¸šç‰ˆ</span></span><br><span class="line">  <span class="comment"># OS ç‰ˆæœ¬: 10.0.19044 æš‚ç¼º Build 19044</span></span><br><span class="line">  </span><br><span class="line">java --version</span><br><span class="line">  <span class="comment"># java 11.0.15.1 2022-04-22 LTS</span></span><br><span class="line">  <span class="comment"># Java(TM) SE Runtime Environment 18.9 (build 11.0.15.1+2-LTS-10)</span></span><br><span class="line">  <span class="comment"># Java HotSpot(TM) 64-Bit Server VM 18.9 (build 11.0.15.1+2-LTS-10, mixed mode)</span></span><br><span class="line"></span><br><span class="line">jmeter.bat </span><br><span class="line">  <span class="comment"># Debug Output: "11.0.15.1"</span></span><br></pre></td></tr></table></figure>
<p><br/></p>
<h3 id="1-ä»¥-helm-æ–¹å¼å®‰è£…InfluxDB-2-x-æ—¶åºæ•°æ®åº“"><a href="#1-ä»¥-helm-æ–¹å¼å®‰è£…InfluxDB-2-x-æ—¶åºæ•°æ®åº“" class="headerlink" title="(1) ä»¥ helm æ–¹å¼å®‰è£…InfluxDB 2.x æ—¶åºæ•°æ®åº“"></a>(1) ä»¥ helm æ–¹å¼å®‰è£…InfluxDB 2.x æ—¶åºæ•°æ®åº“</h3><p><strong>å¿«é€Ÿå®‰è£…</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - chart ä»“åº“æ·»åŠ ä¸ç´¢å¼•æ›´æ–°</span></span><br><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami </span><br><span class="line">helm repo update &amp;&amp; helm search repo influxdb</span><br><span class="line">  <span class="comment"># NAME                    CHART VERSION   APP VERSION     DESCRIPTION</span></span><br><span class="line">  <span class="comment"># bitnami/influxdb        5.3.1           2.2.0           InfluxDB(TM) is an open source time-series data</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - chart æ¨¡æ¿å‚æ•°é…ç½®</span></span><br><span class="line">helm show values bitnami/influxdb &gt; influxdb.yml</span><br><span class="line"></span><br><span class="line"><span class="comment"># - éƒ¨ç½² influxdb2 </span></span><br><span class="line">helm install jmeter-influxdb2 bitnami/influxdb -f influxdb.yml --version 5.3.1 -n devtest --debug --create-namespace</span><br><span class="line">kubectl get pod -n devtest jmeter-influxdb2-5574c9c4c9-bzx4l jmeter-</span><br><span class="line">  <span class="comment"># NAME                                READY   STATUS    RESTARTS       AGE</span></span><br><span class="line">  <span class="comment"># jmeter-influxdb2-5574c9c4c9-bzx4l   1/1     Running   5 (148m ago)   153m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - è¿›å…¥ influxdb2 Pod ç»ˆç«¯</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it -n devtest jmeter-influxdb2-5574c9c4c9-bzx4l -- bash</span><br><span class="line">I have no name!@jmeter-influxdb2-5574c9c4c9-bzx4l:/$ env | egrep <span class="string">"^INFLUXDB_"</span></span><br><span class="line">INFLUXDB_ADMIN_USER_TOKEN=9ONq6UdzvEtMRny40uUN</span><br><span class="line">INFLUXDB_ADMIN_ORG=primary</span><br><span class="line">INFLUXDB_CREATE_USER_TOKEN=no</span><br><span class="line">INFLUXDB_ADMIN_USER=admin</span><br><span class="line">INFLUXDB_HTTP_AUTH_ENABLED=<span class="literal">true</span></span><br><span class="line">INFLUXDB_ADMIN_BUCKET=primary</span><br><span class="line">INFLUXDB_ADMIN_USER_PASSWORD=fL2JnkqExH</span><br><span class="line"></span><br><span class="line"><span class="comment"># - åˆ›å»º jmeter çš„ç»„ç»‡</span></span><br><span class="line">influx org create -n jmeter -d <span class="string">"jmeter organization"</span> -t 9ONq6UdzvEtMRny40uUN</span><br><span class="line">  <span class="comment"># ID                      Name</span></span><br><span class="line">  <span class="comment"># 65386f1047a4a0ef        jmeter</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - åˆ›å»º jmeter ç»„ç»‡ä¸‹åä¸º jmeter æ¡¶</span></span><br><span class="line">influx bucket create -n jmeter -r 0 -o jmeter -t 9ONq6UdzvEtMRny40uUN</span><br><span class="line">  <span class="comment"># ID                      Name    Retention       Shard group duration    Organization ID         Schema Type</span></span><br><span class="line">  <span class="comment"># ba47a04e75fb2e05        jmeter  infinite        168h0m0s                65386f1047a4a0ef        implicit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - åˆ›å»º jmeter ç»„ç»‡ä¸‹åä¸º jmeter ç”¨æˆ·</span></span><br><span class="line">influx user create --name jmeter --password weiyigeek.top --org jmeter -t 9ONq6UdzvEtMRny40uUN</span><br><span class="line">  <span class="comment"># ID                      Name</span></span><br><span class="line">  <span class="comment"># 0982d4da8fe3b000        jmeter</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - åˆ›å»ºç”Ÿæˆ jmeter ç”¨æˆ·è®¤è¯TokenåŠå…¶æƒé™,è¯¥æƒé™åªåœ¨è‡ªå·±çš„ç»„ç»‡ä¸­æ‹¥æœ‰æƒé™ã€‚</span></span><br><span class="line">influx auth create --user jmeter --org jmeter --all-access -t 9ONq6UdzvEtMRny40uUN</span><br><span class="line">  <span class="comment"># ID                      Description     Token                                                                                  User Name        User ID                 Permissions</span></span><br><span class="line">  <span class="comment"># 0982d54a42a3b000                        eoAyDV97es2jh0oC2oF2AWiMXupn9Hswq_axKUe8TKqvk7zCcEGeoQYUGA8WJS-tC4dzPg4Qaz01uEizmniWMw==jmeter          0982d4da8fe3b000        [read:orgs/65386f1047a4a0ef/authorizations write:orgs/65386f1047a4a0ef/authorizations read:orgs/65386f1047a4a0ef/buckets write:orgs/65386f1047a4a0ef/buckets read:orgs/65386f1047a4a0ef/dashboards write:orgs/65386f1047a4a0ef/dashboards read:/orgs/65386f1047a4a0ef read:orgs/65386f1047a4a0ef/sources write:orgs/65386f1047a4a0ef/sources read:orgs/65386f1047a4a0ef/tasks write:orgs/65386f1047a4a0ef/tasks read:orgs/65386f1047a4a0ef/telegrafs write:orgs/65386f1047a4a0ef/telegrafs read:/users/0982d4da8fe3b000 write:/users/0982d4da8fe3b000 read:orgs/65386f1047a4a0ef/variables write:orgs/65386f1047a4a0ef/variables read:orgs/65386f1047a4a0ef/scrapers write:orgs/65386f1047a4a0ef/scrapers read:orgs/65386f1047a4a0ef/secrets write:orgs/65386f1047a4a0ef/secrets read:orgs/65386f1047a4a0ef/labels write:orgs/65386f1047a4a0ef/labels read:orgs/65386f1047a4a0ef/views write:orgs/65386f1047a4a0ef/views read:orgs/65386f1047a4a0ef/documents write:orgs/65386f1047a4a0ef/documents read:orgs/65386f1047a4a0ef/notificationRules write:orgs/65386f1047a4a0ef/notificationRules read:orgs/65386f1047a4a0ef/notificationEndpoints write:orgs/65386f1047a4a0ef/notificationEndpoints read:orgs/65386f1047a4a0ef/checks write:orgs/65386f1047a4a0ef/checks read:orgs/65386f1047a4a0ef/dbrp write:orgs/65386f1047a4a0ef/dbrp read:orgs/65386f1047a4a0ef/notebooks write:orgs/65386f1047a4a0ef/notebooks read:orgs/65386f1047a4a0ef/annotations write:orgs/65386f1047a4a0ef/annotations read:orgs/65386f1047a4a0ef/remotes write:orgs/65386f1047a4a0ef/remotes read:orgs/65386f1047a4a0ef/replications write:orgs/65386f1047a4a0ef/replications]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - åˆ›å»º dbrp æ˜ å°„ä»¥ä¾¿é€šè¿‡InfluxQLè¿›è¡Œæ•°æ®æŸ¥è¯¢</span></span><br><span class="line">influx v1 dbrp create --db jmeter_db --rp jmeter_rp --bucket-id ba47a04e75fb2e05 --org jmeter --default -t 9ONq6UdzvEtMRny40uUN</span><br><span class="line">  <span class="comment"># ID                      Database        Bucket ID               Retention Policy        Default Organization ID</span></span><br><span class="line">  <span class="comment"># 0982d6738223b000        jmeter_db       ba47a04e75fb2e05        jmeter_rp               true    65386f1047a4a0ef</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - æ‰‹åŠ¨è½¬å‘ influxdb æ•°æ®åº“ç«¯å£åˆ°å®¿ä¸»æœºçš„ 30086 ç«¯å£ä¸Š</span></span><br><span class="line">kubectl port-forward --namespace devtest  --address 0.0.0.0 $(kubectl get pods --namespace devtest -l app.kubernetes.io/name=influxdb -o jsonpath=<span class="string">'&#123; .items[0].metadata.name &#125;'</span>) 30086:8086</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h2 id="0x0n-é™„å½•å‚è€ƒ"><a href="#0x0n-é™„å½•å‚è€ƒ" class="headerlink" title="0x0n é™„å½•å‚è€ƒ"></a>0x0n é™„å½•å‚è€ƒ</h2><h3 id="Jmeter-Backend-Listener-ç»„ä»¶ä»‹ç»"><a href="#Jmeter-Backend-Listener-ç»„ä»¶ä»‹ç»" class="headerlink" title="Jmeter Backend Listener ç»„ä»¶ä»‹ç»"></a>Jmeter Backend Listener ç»„ä»¶ä»‹ç»</h3><ul>
<li><a href="https://jmeter.apache.org/usermanual/component_reference.html#Backend_Listener" target="_blank" rel="noopener">https://jmeter.apache.org/usermanual/component_reference.html#Backend_Listener</a></li>
<li><a href="https://jmeter.apache.org/usermanual/realtime-results.html" target="_blank" rel="noopener">https://jmeter.apache.org/usermanual/realtime-results.html</a></li>
</ul>
<p><br/></p>
<h3 id="Jmeter-æ’ä»¶å®‰è£…"><a href="#Jmeter-æ’ä»¶å®‰è£…" class="headerlink" title="Jmeter æ’ä»¶å®‰è£…"></a>Jmeter æ’ä»¶å®‰è£…</h3><p>æè¿°: å­˜æ”¾æ’ä»¶jarç›®å½•çš„ä¸º<code>D:\Tools\apache-jmeter-5.4.3\lib\ext</code>,æˆ‘ä»¬å¯ä»¥å°†jaræ–‡ä»¶å°†å…¶æ”¾åœ¨<code>/lib/ext</code>ä¸­ï¼Œé‡å¯Jmeterå°±å¯ä»¥äº†ã€‚</p>
<p>Prometheus Listener for Jmeter (ä¸ºPrometheuså¯¼å‡ºJMeteræŒ‡æ ‡), åˆ©ç”¨å®ƒå°±èƒ½å°† JMeter å˜æˆä¸€ä¸ª Data Exporter ç„¶ååœ¨ä½¿ç”¨ Prometheus è¿›è¡ŒæŠ“å–ã€‚<br>This JMeter plugin is highly configurable listener (and config element) to allow users define theyâ€™re own metrics (names, types etc.) and expose them through a Prometheus /metrics API to be scraped by a Prometheus serverã€‚</p>
<ul>
<li><p><a href="https://github.com/johrstrom/jmeter-prometheus-plugin/releases/download/0.6.0/jmeter-prometheus-plugin-0.6.0.jar" target="_blank" rel="noopener">https://github.com/johrstrom/jmeter-prometheus-plugin/releases/download/0.6.0/jmeter-prometheus-plugin-0.6.0.jar</a></p>
</li>
<li><p><a href="https://github.com/mderevyankoaqa/jmeter-influxdb2-listener-plugin/" target="_blank" rel="noopener">https://github.com/mderevyankoaqa/jmeter-influxdb2-listener-plugin/</a></p>
</li>
</ul>

        </div>
        
        <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
        
        <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½çœ‹å‹,æ¬¢è¿å…³æ³¨åšä¸»å¾®ä¿¡å…¬ä¼—å·å“Ÿ! â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘å³å¯å…³é—­ç»§ç»­æµè§ˆæ–‡ç« .<br>  <b style="color:red;"> æ¸©é¦¨æç¤º: æœªè§£é”çš„ç”¨æˆ·ä¸èƒ½ç²˜è´´å¤åˆ¶æ–‡ç« å†…å®¹å“Ÿ!</b> <br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
           

        <!-- Google å¹¿å‘Š -->
        
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
  

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2023-03-13T03:53:10.577Z" itemprop="dateUpdated">2023-03-13 11:53:10</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–æµ‹è¯•/Jmeter/2.Jmeteråœ¨Kubernetesç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ-cost.md" target="_blank" rel="noopener noreferrer">_posts/ç³»ç»Ÿè¿ç»´/è‡ªåŠ¨åŒ–æµ‹è¯•/Jmeter/2.Jmeteråœ¨Kubernetesç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µ-cost.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2022/6-12-669.html" target="_blank" rel="external">https://blog.weiyigeek.top/2022/6-12-669.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Jmeter/" rel="tag">Jmeter</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2022/6-12-669.html&title=ã€Š2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2022/6-12-669.html&title=ã€Š2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2022/6-12-669.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2022/6-12-669.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2022/6-12-669.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2022/6-15-667.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Grafanaä¹‹Lokiæ—¥å¿—èšåˆç³»ç»Ÿå…¥é—¨ä»‹ç»ä¸ä¼ä¸šå®è·µ</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2022/6-11-661.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">1.ä½¿ç”¨Apache Jmeterå¯¹åº”ç”¨å‹åŠ›æµ‹è¯•å­¦ä¹ ä¸å®è·µ</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-å‰è¨€ç®€è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å‰è¨€ç®€è¿°</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-å®‰è£…é…ç½®"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 å®‰è£…é…ç½®</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-åŸºç¡€ç¯å¢ƒ"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">1.åŸºç¡€ç¯å¢ƒ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#åœ¨K8Sé›†ç¾¤ä¸­éƒ¨ç½²åŠ¨æ€æŒä¹…å·"><span class="post-toc-number">2.1.1.</span> <span class="post-toc-text">åœ¨K8Sé›†ç¾¤ä¸­éƒ¨ç½²åŠ¨æ€æŒä¹…å·</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#åœ¨K8Sé›†ç¾¤ä¸­éƒ¨ç½²å‹åŠ›æµ‹è¯•æ¼”ç¤ºç«™ç‚¹"><span class="post-toc-number">2.1.2.</span> <span class="post-toc-text">åœ¨K8Sé›†ç¾¤ä¸­éƒ¨ç½²å‹åŠ›æµ‹è¯•æ¼”ç¤ºç«™ç‚¹</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-ä¾èµ–ç¯å¢ƒ"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">2.ä¾èµ–ç¯å¢ƒ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#åœ¨-Windows-ä¸­å®‰è£…-Apache-jmeter-å·¥å…·"><span class="post-toc-number">2.2.1.</span> <span class="post-toc-text">åœ¨ Windows ä¸­å®‰è£… Apache jmeter å·¥å…·</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ä»¥äºŒè¿›åˆ¶æ–¹å¼å®‰è£…Helméƒ¨ç½²å·¥å…·"><span class="post-toc-number">2.2.2.</span> <span class="post-toc-text">ä»¥äºŒè¿›åˆ¶æ–¹å¼å®‰è£…Helméƒ¨ç½²å·¥å…·</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ä»¥-helm-æ–¹å¼å®‰è£…-Grafana-9-x"><span class="post-toc-number">2.2.3.</span> <span class="post-toc-text">ä»¥ helm æ–¹å¼å®‰è£… Grafana 9.x</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-Kubernetes-jmeter-InfluxDB-1-8-x-Grafana-Jenkins-è¿›è¡Œè‡ªåŠ¨åŒ–åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•åŠå…¶ç»“æœå±•ç¤º"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 Kubernetes + jmeter + InfluxDB 1.8.x + Grafana + Jenkins è¿›è¡Œè‡ªåŠ¨åŒ–åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•åŠå…¶ç»“æœå±•ç¤º</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-ä»¥-helm-æ–¹å¼å®‰è£…åˆ†å¸ƒå¼-jmeter-å‹åŠ›æµ‹è¯•åº”ç”¨"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">(1) ä»¥ helm æ–¹å¼å®‰è£…åˆ†å¸ƒå¼ jmeter å‹åŠ›æµ‹è¯•åº”ç”¨</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-ä»¥èµ„æºæ¸…å•æ–¹å¼å®‰è£…é…ç½®-InfluxDB-1-8-æ—¶åºæ•°æ®åº“"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">(2) ä»¥èµ„æºæ¸…å•æ–¹å¼å®‰è£…é…ç½® InfluxDB 1.8 æ—¶åºæ•°æ®åº“</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-åœ¨-jmeter-ä¸­æ·»åŠ -Backend-Listener-é…ç½®-influxDB-ç›¸å…³ä¿¡æ¯"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">(3) åœ¨ jmeter ä¸­æ·»åŠ  Backend Listener é…ç½® influxDB ç›¸å…³ä¿¡æ¯</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-åœ¨-grafana-ä¸­å±•ç¤º-jmeter-å‹åŠ›æµ‹è¯•ç›¸å…³æŒ‡æ ‡æ•°æ®ã€‚"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">(4) åœ¨ grafana ä¸­å±•ç¤º jmeter å‹åŠ›æµ‹è¯•ç›¸å…³æŒ‡æ ‡æ•°æ®ã€‚</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-ä½¿ç”¨-kubernetes-Gitlab-Jenkins-Grafana-å®ç°è‡ªåŠ¨åŒ–åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•æ•°æ®å±•ç¤ºå®è·µ"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">(5) ä½¿ç”¨ kubernetes + Gitlab + Jenkins + Grafana å®ç°è‡ªåŠ¨åŒ–åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•æ•°æ®å±•ç¤ºå®è·µ</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x03-åœ¨Kubernetesé›†ç¾¤-jmeter-InfluxDB-2-x-Grafana-ä¸­è¿›è¡Œè‡ªåŠ¨åŒ–åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•åŠç»“æœå±•ç¤º"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 åœ¨Kubernetesé›†ç¾¤(jmeter + InfluxDB 2.x + Grafana)ä¸­è¿›è¡Œè‡ªåŠ¨åŒ–åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•åŠç»“æœå±•ç¤º</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-ä»¥-helm-æ–¹å¼å®‰è£…InfluxDB-2-x-æ—¶åºæ•°æ®åº“"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">(1) ä»¥ helm æ–¹å¼å®‰è£…InfluxDB 2.x æ—¶åºæ•°æ®åº“</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x0n-é™„å½•å‚è€ƒ"><span class="post-toc-number">5.</span> <span class="post-toc-text">0x0n é™„å½•å‚è€ƒ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Jmeter-Backend-Listener-ç»„ä»¶ä»‹ç»"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">Jmeter Backend Listener ç»„ä»¶ä»‹ç»</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Jmeter-æ’ä»¶å®‰è£…"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">Jmeter æ’ä»¶å®‰è£…</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
    <!-- 
  <div id="post-wechat" class="post-wechat" style="position:fixed;top: 360px;bottom: 500px;right: 3%;width: 190px;text-align: center; z-index: 9999">
    <p><b>å…³æ³¨ã€å…¨æ ˆå·¥ç¨‹å¸ˆä¿®ç‚¼æŒ‡å—ã€‘</b></p>
    <img src="/img/wechat-gzh.jpg" class="img-responsive" alt="weiyigeek">
    <p><b>æ¬¢è¿æ·»åŠ ã€ä½œè€…ã€‘å¾®ä¿¡</b></p>
    <img src="/img/wehat.jpg" class="img-responsive" alt="weiyigeek">
  </div>


 -->

    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="/img/share-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2023 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div>
        <div id="blog-wormhole-id" >
          <a href="https://www.foreverblog.cn/go.html" target="_blank"> 
            <img src="https://img.foreverblog.cn/wormhole_2_tp.gif" alt="åå¹´ä¹‹çº¦è™«æ´" style="height:32px;max-height:50px;display:block;margin:0 auto;" title="ç©¿æ¢­è™«æ´-éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢">
          </a>
        </div>
        <div id="cc-myssl-id" >
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>

<div id="go" class="waves-effect waves-light">
  <a href="javascript:;" id="goqrcode"> <span class="icon icon-lg icon-qrcode"></span> </a>
  <a href="javascript:;" id="gotop"> <span class="icon icon-lg icon-chevron-up"></span></a>
</div>





<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2022/6-12-669.html&title=ã€Š2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2022/6-12-669.html&title=ã€Š2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2022/6-12-669.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š2.Jmeteråœ¨Kubernetesçš„devopsç¯å¢ƒä¸­åˆ†å¸ƒå¼å‹åŠ›æµ‹è¯•å®è·µã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2022/6-12-669.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2022/6-12-669.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMElEQVR42u3aQW7DMAwFUd//0inQVYHU8nwyDmBqtArclPbzgqFEHgder9/1fuXver9+Foes444lQ4aMxzJIuDT0+rHW8c9eygVVhgwZGzDWSZYn3DWJ4/mzyZAhQwYpBPuf+euTIUOGDBKOF3zr8o7/VYYMGTL4JpaXd/zK+i637MVlyJDxQEbaGPjm5xv7GzJkyHgI49VYpLisJfT4SWTIkDGakZZ9tVzHN7S1JoEMGTJmM9KkxhuW6UY3bY4WfzdkyJDxWEYrRNj4TEtM1BiQIUPGBoxakuVNR96S5M1RGTJk7MNIA/HRik+1AeIWpgwZMkYzeIrkAP6InRaCDBkyZjNa6aw08lVrAFy8ShkyZGzJ4NvXDobcHf0MyJAhYzQjHblID8XSg7naYIcMGTJmM9JkWtvc8gTK745Cy5AhYxCDH5Otv8lTKo+PUrMMGTI2YNRIvOpMx8LiQzoZMmRswOAlGi8N04P+tFg8PTWUIUPGOEZaZfE0SlanVXCBkSFDxjgGSXPpUX5nQ8uf56j9mwwZMh7LSA/6awMT/L5pKSlDhozZDJ5SUxjfjpJUjmZGZMiQMY5R23Z2WpgkycbHdjJkyBjN4Isk2TQCJ8mQIUNGenzfqT1rJSAqUmXIkLEBgzQM0tKQR0ubDf9EkCFDhoyw0izOeoQvUYYMGTJqI2IkRfL0/YG2pQwZMgYxyCY2HSDjQ2bp92XIkLEbo9YYSFuMnTGL9FBPhgwZgxg/rcpqmC2Fw6gAAAAASUVORK5CYII=" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å”¯ä¸€æå®¢-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// ç«™ç‚¹è¿è¡Œæ—¶é—´
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + " å¤© " + RunHours + " æ—¶ " + RunMinutes + " åˆ† " + RunSeconds + " ç§’";
  document.getElementById(id).innerHTML = "ç½‘ç«™å·²åœ¨é£é›¨ä¸­å‹‰å‹‰å¼ºå¼ºè¿è¡Œäº†ã€ " + RunTime + " ã€‘";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
    
  <div id="post-wechat" class="post-wechat" style="position:fixed;top: 360px;bottom: 500px;right: 3%;width: 190px;text-align: center; z-index: 9999">
    <p><b>å…³æ³¨ã€å…¨æ ˆå·¥ç¨‹å¸ˆä¿®ç‚¼æŒ‡å—ã€‘</b></p>
    <img src="/img/wechat-gzh.jpg" class="img-responsive" alt="weiyigeek">
    <p><b>æ¬¢è¿æ·»åŠ ã€ä½œè€…ã€‘å¾®ä¿¡</b></p>
    <img src="/img/wehat.jpg" class="img-responsive" alt="weiyigeek">
  </div>



</body>
</html>