{"title":"Resin应用服务器中间件安装和使用","slug":"系统运维/Application/Web/WebApp/Resin/Resin应用服务器安装和使用","date":"2019-06-28T05:34:30.000Z","updated":"2022-03-29T05:39:06.308Z","url":"2019/6-28-127.html","path":"api/articles/2019/6-28-127.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190827210929.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190827211934.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190827213151.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190827224103.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"0x00-快速入门\"><a href=\"#0x00-快速入门\" class=\"headerlink\" title=\"0x00 快速入门\"></a>0x00 快速入门</h2><p>描述：Resin是 CAUCHO 公司(<a href=\"http://www.caucho.com/\" target=\"_blank\" rel=\"noopener\">http://www.caucho.com/</a>) 的产品，是一个非常流行的应用服务器支持 servlets 和jsp的引擎，速度非常快。<br>官网介绍:“Resin的动态扩展和集群消除了停机时间，无需重大代码更改”，从单个服务器扩展到数百万用户，没有外部依赖关系,全球数以百万计的网站在 Resin 上运行。</p>\n<p>Resin 实现功能: 负载均衡器、网络服务器 、应用服务器、分布式缓存 </p>\n<p><br/></p>\n<p>Resin 特性:</p>\n<ul>\n<li>支持HTTP/1.1的WEB服务器</li>\n<li>支持显示动态内容和静态内容(能力强解析速度快)</li>\n<li>扩展性好能和其他WEB服务器一起工作(比如Apache server和IIS等);</li>\n<li>Resin支持Servlets 2.3标准和JSP 1.2标准(用Resin来进行JSP编程是很容易)</li>\n<li>Resin支持负载平衡（Load balancing）,可以增加WEB站点的可靠性,方法是增加服务器的数量。比如一台SERVER的错误率是1%的话，那么支持负载平衡的两个Resin服务器就可以使错误率降到0.01%。</li>\n<li>跨平台性:可以在 Windows / Linux 上面安装使用</li>\n</ul>\n<p><br/></p>\n<p>Resin 应用场景:</p>\n<ul>\n<li>聚类 : Resin 的 Web 和应用程序服务器允许您将 Web 应用程序集群以实现高性能和可用性 </li>\n<li>微服务 ：在一个 30MB 的小包中，Resin 可用于 Web 应用程序的 .jar、.war 或 .ear 部署 </li>\n<li>物联网-云 ：Resin 连接任何可以发送和接收 JSON 的设备.</li>\n</ul>\n<p><br/></p>\n<p>Resin的两个版本区别:</p>\n<ul>\n<li>Resin 4.0  免费 : 普通版本独立作为web服务器性能就要差一些,可以使用 <code>apache+resin</code> 借助apache的缓存功能提高性能;</li>\n<li>Resin Pro 4.0 收费 : 强大的cache功能支持缓存和负载均衡;</li>\n</ul>\n<p>官网下载: <a href=\"https://caucho.com/products/resin/download\" target=\"_blank\" rel=\"noopener\">https://caucho.com/products/resin/download</a></p>\n<p><br></p>\n<h2 id=\"0x01-Resin安装\"><a href=\"#0x01-Resin安装\" class=\"headerlink\" title=\"0x01 Resin安装\"></a>0x01 Resin安装</h2><p>通用环境依赖说明:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Resin: 4.0.62</span><br><span class=\"line\">jDK: &gt;= 6+ (这里选择JDK8)</span><br></pre></td></tr></table></figure></p>\n<p><strong>Windows安装环境</strong><br>Step1.安装JDK8并添加到环境变量<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 运行jdk-8u181-windows64.exe进行安装即可(默认路径)</span></span><br><span class=\"line\">&gt;setx /M JAVA_HOME <span class=\"string\">\"C:\\Program Files\\Java\\jdk1.8.0_181\"</span></span><br><span class=\"line\">&gt;setx /M JAVA_HOME <span class=\"string\">\"C:\\Program Files\\Java\\jdk1.8.0_221\"</span></span><br><span class=\"line\">成功: 指定的值已得到保存。</span><br><span class=\"line\">&gt;setx /M PATH <span class=\"string\">\"%PATH%;%JAVA_HOME%\\bin;%JAVA_HOME%\\jre;\"</span></span><br><span class=\"line\">成功: 指定的值已得到保存。</span><br><span class=\"line\"><span class=\"comment\">#重新打开一个cmd.exe执行验证</span></span><br><span class=\"line\">C:\\Users\\Administrator\\Desktop&gt;java -version</span><br><span class=\"line\">java version <span class=\"string\">\"1.8.0_181\"</span></span><br><span class=\"line\">Java(TM) SE Runtime Environment (build 1.8.0_181-b13)</span><br><span class=\"line\">Java HotSpot(TM) 64-Bit Server VM (build 25.181-b13, mixed mode)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Step2.解压Resin包到项目目录中,并将其根路径加入到环境变量之中;</span></span><br><span class=\"line\">C:\\Users\\Administrator&gt;setx /M RESIN_HOME <span class=\"string\">\"C:\\resin-4.0.62\"</span></span><br><span class=\"line\">成功: 指定的值已得到保存。</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#step3.运行Resin包的安装程序 (注意需要.NET3.5支持) 根据需求选择 setup.exe 安装程序</span></span><br><span class=\"line\">运行resin.exe或者在命令中执行  run java -jar lib/resin.jar start。</span><br><span class=\"line\"><span class=\"comment\">#在下面的框框中可以重启或者停止(直接点击start/stop)</span></span><br></pre></td></tr></table></figure></p>\n<p>Step4.访问 <a href=\"http://localhost:8080/\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/</a> 页面说明安装成功</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190827210929.png\" alt=\"WeiyiGeek.验证安装成功\" title=\"\" class=\"\">\n                <p>WeiyiGeek.验证安装成功</p>\n            </figure>\n<p>Step5.点击/resin-admin 创建认证文件访问 <a href=\"http://localhost:8080/resin-admin/\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/resin-admin/</a><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#提交后的返回的信息</span></span><br><span class=\"line\">1.To add the admin user, copy and paste the following into c:\\resin-4.0.62\\conf/resin.properties: (将以下配置加入resin.propertie中)</span><br><span class=\"line\">admin_user : admin</span><br><span class=\"line\">admin_password : &#123;SSHA&#125;6c3j7qekfBfEWQL9uD6wiasV9oCz3BGG</span><br><span class=\"line\"><span class=\"comment\">#当然您也可以采用Use \"resinctl generate-password\" and copy/paste here to set the admin生成</span></span><br><span class=\"line\"></span><br><span class=\"line\">2.默认是只允许localhost访问,当您设置下面的参数后将所有机器都能访问后台页面(注意防火墙的影响) add to c:\\resin-4.0.62\\conf/resin.properties: </span><br><span class=\"line\">admin_external : <span class=\"literal\">true</span></span><br><span class=\"line\">admin_secure : <span class=\"literal\">true</span></span><br><span class=\"line\">Or modify directly c:\\resin-4.0.62\\conf\\resin.xml: </span><br><span class=\"line\">&lt;resin:<span class=\"built_in\">set</span> var=<span class=\"string\">\"resin_admin_external\"</span> value=<span class=\"string\">\"true\"</span>/&gt;</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190827211934.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p>Step6.设置好之后便可以进行登录(采用外网机器登录)<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190827213151.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p>Step7.简单的介绍一哈war部署<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#方式1把war文件放进resin目录中的webapps下，然后resin自动解压，这样虽然可以但是可能会遇到很多问题，就比如运行的时候找不到js文件了，报404，又或者找不到配置的文件或者action。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#方式2：在resin目录中的conf中的resin.conf，这个文件是resin自带的,打开这个文件，拉到底下找到&lt;web-app&gt;这个标签，然后把原本的&lt;web-app id=\"/\" root-directory=\"\"&gt;注释掉，添加下面一句</span></span><br><span class=\"line\">&lt;web-app id=<span class=\"string\">\"/\"</span> document-directory=<span class=\"string\">\"D:\\test\\**\"</span> archive-path=<span class=\"string\">\"D:\\test\\**.war\"</span>/&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#方式3：通过resin-admin后台进行部署(注意需要开启ssl)</span></span><br><span class=\"line\">Actions can only be performed on a <span class=\"built_in\">local</span> server and over a secure connection (SSL).<span class=\"string\">\" Try https://192.168.17.129:8443/resin-admin/index.php?q=deploy&amp;s=0</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">访问网站：https://192.168.17.129:8443/Demo-1.1.0/</span></span><br><span class=\"line\"><span class=\"string\">Hello World!WeiyiGeek</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/1/20190827224103.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p><em>注意事项：</em></p>\n<ul>\n<li>启动的时候检查默认的8080端口是否被占用;</li>\n</ul>\n<h2 id=\"0x02-Resin配置文件\"><a href=\"#0x02-Resin配置文件\" class=\"headerlink\" title=\"0x02 Resin配置文件\"></a>0x02 Resin配置文件</h2><p>resin-4.0.x 配置文件结构:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">配置属性 :  --conf/resin.properties</span><br><span class=\"line\">配置文件 :  --conf/resin.xml</span><br><span class=\"line\">openSSL密钥 :   --conf/keys/</span><br><span class=\"line\"></span><br><span class=\"line\">许可信息文件 : --conf/licenses/</span><br><span class=\"line\">部署服务器路径 : --webapps/  </span><br><span class=\"line\">resin日志文件 :  --logs/</span><br></pre></td></tr></table></figure></p>\n<p>配置文件conf/resin.properties说明:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># resin.properties - 配置变量值</span></span><br><span class=\"line\"><span class=\"comment\"># See resin.xml, cluster-default.xml, and health.xml for full configuration.</span></span><br><span class=\"line\"><span class=\"comment\"># Any variable defined by $&#123;...&#125; can be set as a property in this file.</span></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"comment\"># Individual server overrides can be specified by prepending the server.id.</span></span><br><span class=\"line\"><span class=\"comment\"># 日志记录等级</span></span><br><span class=\"line\"><span class=\"comment\"># log_level : info</span></span><br><span class=\"line\"><span class=\"comment\"># app-0.log_level : finest</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># 与Resin XML配置类似，修改此文件将触发重启。</span></span><br><span class=\"line\"><span class=\"comment\"># General log level (modify resin.xml for more granular log level adjustments)</span></span><br><span class=\"line\"><span class=\"comment\"># log_level     : finer</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启用详细的浏览器错误报告(业务上线时候不建议)</span></span><br><span class=\"line\">dev_mode      : <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># resin多久检查一次更新的文件。</span></span><br><span class=\"line\"><span class=\"comment\"># dependency_check_interval : 5m</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable /resin-doc Resin documentation</span></span><br><span class=\"line\">resin_doc      : <span class=\"literal\">true</span></span><br><span class=\"line\">resin_doc_host :</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># List Triad server ip-addresses:hmux-port for each tier, space separated </span></span><br><span class=\"line\"><span class=\"comment\">#应用服务设置</span></span><br><span class=\"line\"><span class=\"comment\"># App tier Triad servers must be listed to enable web-tier to </span></span><br><span class=\"line\"><span class=\"comment\"># app-tier load-balancing</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># web-tier Triad servers: web-0 web-1 web-2</span></span><br><span class=\"line\"><span class=\"comment\"># web_servers      : 127.0.0.1:6810</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># app-tier Triad servers: app-0 app-1 app-2</span></span><br><span class=\"line\">app_servers      : 127.0.0.1:6800</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 允许弹性节点加入集群(支持云模式)</span></span><br><span class=\"line\"><span class=\"comment\"># elastic_cloud_enable : true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 弹性节点应该连接的集群——每个节点都将连接一个三元组服务器</span></span><br><span class=\"line\"><span class=\"comment\"># Use a separate resin.properties file for each cluster</span></span><br><span class=\"line\">home_cluster : app</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 用于弹性服务器在home_cluster中加入集群</span></span><br><span class=\"line\"><span class=\"comment\"># elastic_server : true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 为每个服务器创建一个不同的webapps/目录，用于垂直扩展</span></span><br><span class=\"line\"><span class=\"comment\"># elastic_webapp : true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 用于具有动态IP地址的云服务器，其中服务器启动后为服务器分配DNS名称。resin会重试开始。</span></span><br><span class=\"line\"><span class=\"comment\"># elastic_dns : true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#指定配置文件中的——server</span></span><br><span class=\"line\"><span class=\"comment\"># home_server : app-0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Set HTTP and HTTPS bind address</span></span><br><span class=\"line\"><span class=\"comment\"># http_address  : *</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Set HTTP and HTTPS ports.</span></span><br><span class=\"line\"><span class=\"comment\">#   http       - default for all clusters and servers</span></span><br><span class=\"line\"><span class=\"comment\">#   app.http   - default for all servers in cluster 'app'</span></span><br><span class=\"line\"><span class=\"comment\">#   app-0.http - for server 'app-0' only </span></span><br><span class=\"line\"><span class=\"comment\"># http          : 8080</span></span><br><span class=\"line\"></span><br><span class=\"line\">app.http          : 8080</span><br><span class=\"line\"><span class=\"comment\"># app.https         : 8443</span></span><br><span class=\"line\"></span><br><span class=\"line\">web.http          : 8080</span><br><span class=\"line\"><span class=\"comment\"># web.https         : 8443</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 为了安全起见，Resin可以在绑定到端口80后切换到非root用户</span></span><br><span class=\"line\">setuid_user   : </span><br><span class=\"line\">setuid_group  : </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Arg直接传递到JVM</span></span><br><span class=\"line\"><span class=\"comment\"># jvm_args  : -Xmx2048m -XX:MaxPermSize=256m</span></span><br><span class=\"line\"><span class=\"comment\"># jvm_mode    : -server</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 这个类路径比默认类路径具有优先级，就像您希望使用Hibernate的JPA这样的第三方库时一样</span></span><br><span class=\"line\"><span class=\"comment\"># jvm_classpath :</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 本地url供看门狗检查，以确保服务器已启动，空间分隔</span></span><br><span class=\"line\"><span class=\"comment\"># http_ping_urls : http://127.0.0.1/test.jsp</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 为端口控制活动线程的数量</span></span><br><span class=\"line\">port_thread_max   : 256</span><br><span class=\"line\">accept_thread_max : 32</span><br><span class=\"line\">accept_thread_min : 4</span><br><span class=\"line\"><span class=\"comment\"># keepalive_max   : 512</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable JNI TCP speed optimizations</span></span><br><span class=\"line\">tcp_cork : <span class=\"literal\">true</span></span><br><span class=\"line\">sendfile : <span class=\"literal\">true</span></span><br><span class=\"line\">keepalive_select_enable : <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># OpenSSL证书配置密钥通常存储在resin配置目录中。</span></span><br><span class=\"line\"><span class=\"comment\"># openssl_file : keys/test.crt</span></span><br><span class=\"line\"><span class=\"comment\"># openssl_key : keys/test.key</span></span><br><span class=\"line\"><span class=\"comment\"># openssl_chain_file : keys/test.ca</span></span><br><span class=\"line\"><span class=\"comment\"># openssl_password : changeme</span></span><br><span class=\"line\"><span class=\"comment\"># openssl_protocol : -sslv2 -sslv3</span></span><br><span class=\"line\"><span class=\"comment\"># openssl_cipher_suite :</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># JSSE证书配置密钥通常存储在resin配置目录中。</span></span><br><span class=\"line\"><span class=\"comment\"># jsse_keystore_type : jks</span></span><br><span class=\"line\"><span class=\"comment\"># jsse_keystore_file : /etc/resin/keys/server.keystore</span></span><br><span class=\"line\"><span class=\"comment\"># jsse_keystore_password : changeme</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># In absence of a signed certificate, Resin will fallback to using a </span></span><br><span class=\"line\"><span class=\"comment\"># self-signed development certificate if HTTPS is enabled</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启用代理缓存——用于缓存内存中的静态内容</span></span><br><span class=\"line\">proxy_cache_enable : <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Sets the proxy cache memory size</span></span><br><span class=\"line\"><span class=\"comment\"># proxy_cache_size : 256m</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启用集群持久会话(用于故障转移)</span></span><br><span class=\"line\">session_store : <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># disable the quercus *.php mapping when using Apache for PHP</span></span><br><span class=\"line\"><span class=\"comment\"># quercus_disable : true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用数字后缀命名的web应用程序，例如foo-10.0。战争和可以浏览</span></span><br><span class=\"line\"><span class=\"comment\"># # / foo。当web应用程序的新版本被部署时，Resin会继续</span></span><br><span class=\"line\"><span class=\"comment\"># 将活动会话请求路由到以前的web应用程序版本</span></span><br><span class=\"line\"><span class=\"comment\"># #新会话将转到新版本，因此用户不会意识到</span></span><br><span class=\"line\"><span class=\"comment\"># #应用程序升级。</span></span><br><span class=\"line\"><span class=\"comment\"># webapp_multiversion_routing : true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Set the email address to receive weekly and restart PDF reports</span></span><br><span class=\"line\"><span class=\"comment\"># email : admin@example.com</span></span><br><span class=\"line\">pdf_summary : <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启用远程管理(对于远程CLI和EC2 ext: triad discovery)</span></span><br><span class=\"line\"><span class=\"comment\"># remote_admin_enable : true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable /resin-admin web administration console</span></span><br><span class=\"line\">web_admin_enable : <span class=\"literal\">true</span></span><br><span class=\"line\">web_admin_host   :</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#允许访问/树脂管理从非本地网络ip地址</span></span><br><span class=\"line\"><span class=\"comment\"># web_admin_external : true</span></span><br><span class=\"line\"><span class=\"comment\"># 要求HTTPS访问/树脂管理</span></span><br><span class=\"line\"><span class=\"comment\"># web_admin_ssl : true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启用Resin REST Admin</span></span><br><span class=\"line\"><span class=\"comment\"># rest_admin_enable : true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># REST管理需要SSL</span></span><br><span class=\"line\"><span class=\"comment\"># rest_admin_ssl : true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 健康检查禁用</span></span><br><span class=\"line\"><span class=\"comment\"># health_disable   : true</span></span><br><span class=\"line\"><span class=\"comment\"># health_log_level : off</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 访问/树脂管理和远程CLI是密码限制。</span></span><br><span class=\"line\"><span class=\"comment\"># Use \"resinctl generate-password\" and copy/paste here to set the admin</span></span><br><span class=\"line\"><span class=\"comment\"># admin_user : admin</span></span><br><span class=\"line\"><span class=\"comment\"># admin_password : &#123;SSHA&#125;xxxxxxxx</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 允许读取EC2用户数据作为树脂属性</span></span><br><span class=\"line\"><span class=\"comment\"># properties_import_url : http://169.254.169.254/latest/user-data</span></span><br></pre></td></tr></table></figure></p>\n<p>常规配置配置文件 conf/resin.xml:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!--- Resin 4.0 configuration file.--&gt;</span><br><span class=\"line\">&lt;resin xmlns=<span class=\"string\">\"http://caucho.com/ns/resin\"</span></span><br><span class=\"line\">       xmlns:resin=<span class=\"string\">\"urn:java:com.caucho.resin\"</span>&gt;</span><br><span class=\"line\">  &lt;!-- property-based Resin configuration --&gt;</span><br><span class=\"line\">  &lt;resin:properties path=<span class=\"string\">\"<span class=\"variable\">$&#123;__DIR__&#125;</span>/resin.properties\"</span> optional=<span class=\"string\">\"true\"</span>/&gt;</span><br><span class=\"line\">  &lt;resin:<span class=\"keyword\">if</span> <span class=\"built_in\">test</span>=<span class=\"string\">\"<span class=\"variable\">$&#123;properties_import_url&#125;</span>\"</span>&gt;</span><br><span class=\"line\">     &lt;resin:properties path=<span class=\"string\">\"<span class=\"variable\">$&#123;properties_import_url&#125;</span>\"</span> optional=<span class=\"string\">\"true\"</span> recover=<span class=\"string\">\"true\"</span>/&gt;</span><br><span class=\"line\">  &lt;/resin:<span class=\"keyword\">if</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;!-- JDK日志API的日志配置 --&gt;</span><br><span class=\"line\">  &lt;<span class=\"built_in\">log</span>-handler name=<span class=\"string\">\"\"</span> level=<span class=\"string\">\"all\"</span> path=<span class=\"string\">\"stdout:\"</span></span><br><span class=\"line\">               timestamp=<span class=\"string\">\"[%y-%m-%d %H:%M:%S.%s]\"</span></span><br><span class=\"line\">               format=<span class=\"string\">\" &#123;<span class=\"variable\">$&#123;thread&#125;</span>&#125; <span class=\"variable\">$&#123;log.message&#125;</span>\"</span>/&gt;</span><br><span class=\"line\">               </span><br><span class=\"line\">  &lt;!-- </span><br><span class=\"line\">     - Alternative pseudo-TTCC <span class=\"built_in\">log</span> format</span><br><span class=\"line\">     - &lt;<span class=\"built_in\">log</span>-handler name=<span class=\"string\">\"\"</span> level=<span class=\"string\">\"all\"</span> path=<span class=\"string\">\"stdout:\"</span></span><br><span class=\"line\">     -           timestamp=<span class=\"string\">\"%y-%m-%d %H:%M:%S.%s\"</span></span><br><span class=\"line\">     -           format=<span class=\"string\">\" [<span class=\"variable\">$&#123;thread&#125;</span>] <span class=\"variable\">$&#123;log.level&#125;</span> <span class=\"variable\">$&#123;log.shortName&#125;</span> - <span class=\"variable\">$&#123;log.message&#125;</span>\"</span>/&gt;</span><br><span class=\"line\">    --&gt;</span><br><span class=\"line\">   </span><br><span class=\"line\">  &lt;!--</span><br><span class=\"line\">     - level=<span class=\"string\">'info'</span> <span class=\"keyword\">for</span> production</span><br><span class=\"line\">     - <span class=\"string\">'fine'</span> or <span class=\"string\">'finer'</span> <span class=\"keyword\">for</span> development and troubleshooting</span><br><span class=\"line\">     - 日志信息级别：info生产环境 fine和finer适合开发环境和调试环境</span><br><span class=\"line\">    --&gt;</span><br><span class=\"line\">  &lt;logger name=<span class=\"string\">\"\"</span> level=<span class=\"string\">\"<span class=\"variable\">$&#123;log_level?:'info'&#125;</span>\"</span>/&gt;</span><br><span class=\"line\">  &lt;logger name=<span class=\"string\">\"com.caucho.java\"</span> level=<span class=\"string\">\"config\"</span>/&gt;</span><br><span class=\"line\">  &lt;logger name=<span class=\"string\">\"com.caucho.loader\"</span> level=<span class=\"string\">\"config\"</span>/&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;!--</span><br><span class=\"line\">     - Default configuration applied to all clusters, including</span><br><span class=\"line\">     - HTTP, HTTPS, and /resin-admin configuration.</span><br><span class=\"line\">    --&gt;</span><br><span class=\"line\">  &lt;resin:import path=<span class=\"string\">\"<span class=\"variable\">$&#123;__DIR__&#125;</span>/cluster-default.xml\"</span>/&gt;</span><br><span class=\"line\">  </span><br><span class=\"line\">  &lt;!--</span><br><span class=\"line\">     - health configuration</span><br><span class=\"line\">    --&gt;</span><br><span class=\"line\">  &lt;resin:import path=<span class=\"string\">\"<span class=\"variable\">$&#123;__DIR__&#125;</span>/health.xml\"</span>/&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\">  &lt;!--</span><br><span class=\"line\">     - Remote management requires at least one enabled admin user.</span><br><span class=\"line\">    --&gt;</span><br><span class=\"line\">  &lt;resin:AdminAuthenticator&gt;</span><br><span class=\"line\">    &lt;user name=<span class=\"string\">\"<span class=\"variable\">$&#123;admin_user&#125;</span>\"</span> password=<span class=\"string\">\"<span class=\"variable\">$&#123;admin_password&#125;</span>\"</span>/&gt;</span><br><span class=\"line\">    </span><br><span class=\"line\">    &lt;resin:import path=<span class=\"string\">\"<span class=\"variable\">$&#123;__DIR__&#125;</span>/admin-users.xml\"</span> optional=<span class=\"string\">\"true\"</span>/&gt;</span><br><span class=\"line\">  &lt;/resin:AdminAuthenticator&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;!---对于集群系统，请在cluster_system_key中创建密码--&gt;</span><br><span class=\"line\">  &lt;cluster-system-key&gt;<span class=\"variable\">$&#123;cluster_system_key&#125;</span>&lt;/cluster-system-key&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;!--</span><br><span class=\"line\">     - 环境依赖检查时间生产系统设置长点，600s 10分钟(不用修改文件后手动重启)</span><br><span class=\"line\">     - 检测会非常耗时搞resin优化的话，那么就把它设置的长一些,生产环境中干脆设置为-1禁止自动检测变更;</span><br><span class=\"line\">    --&gt;</span><br><span class=\"line\">  &lt;dependency-check-interval&gt;<span class=\"variable\">$&#123;dependency_check_interval?:'2s'&#125;</span>&lt;/dependency-check-interval&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;!-- 属性动态集群连接 --&gt;</span><br><span class=\"line\">  &lt;home-cluster&gt;<span class=\"variable\">$&#123;home_cluster&#125;</span>&lt;/home-cluster&gt;</span><br><span class=\"line\">  &lt;home-server&gt;<span class=\"variable\">$&#123;home_server&#125;</span>&lt;/home-server&gt;</span><br><span class=\"line\">  &lt;elastic-server&gt;<span class=\"variable\">$&#123;elastic_server&#125;</span>&lt;/elastic-server&gt;</span><br><span class=\"line\">  &lt;elastic-dns&gt;<span class=\"variable\">$&#123;elastic_dns&#125;</span>&lt;/elastic-dns&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;!--- JSSE default properties--&gt;</span><br><span class=\"line\">  &lt;system-property</span><br><span class=\"line\">    jdk.tls.ephemeralDHKeySize=<span class=\"string\">\"2048\"</span></span><br><span class=\"line\">    jdk.tls.rejectClientInitiatedRenegotiation=<span class=\"string\">\"true\"</span></span><br><span class=\"line\">    sun.security.ssl.allowUnsafeRenegotiation=<span class=\"string\">\"false\"</span></span><br><span class=\"line\">    sun.security.ssl.allowLegacyHelloMessages=<span class=\"string\">\"false\"</span>/&gt;</span><br><span class=\"line\">     </span><br><span class=\"line\">  &lt;!--- 配置主应用程序集群。负载均衡配置也将有一个web集群。--&gt;</span><br><span class=\"line\">  &lt;cluster id=<span class=\"string\">\"app\"</span>&gt;</span><br><span class=\"line\">    &lt;!-- define the servers <span class=\"keyword\">in</span> the cluster --&gt;</span><br><span class=\"line\">    &lt;server-multi id-prefix=<span class=\"string\">\"app-\"</span> address-list=<span class=\"string\">\"<span class=\"variable\">$&#123;app_servers&#125;</span>\"</span> port=<span class=\"string\">\"6800\"</span>/&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;host-default&gt;</span><br><span class=\"line\">      &lt;!-- 为.war扩展创建webapps目录 --&gt;</span><br><span class=\"line\">      &lt;web-app-deploy path=<span class=\"string\">\"webapps\"</span></span><br><span class=\"line\">                      expand-preserve-fileset=<span class=\"string\">\"WEB-INF/work/**\"</span></span><br><span class=\"line\">                      multiversion-routing=<span class=\"string\">\"<span class=\"variable\">$&#123;webapp_multiversion_routing&#125;</span>\"</span></span><br><span class=\"line\">                      path-suffix=<span class=\"string\">\"<span class=\"variable\">$&#123;elastic_webapp?resin.id:''&#125;</span>\"</span>/&gt;</span><br><span class=\"line\">    &lt;/host-default&gt;</span><br><span class=\"line\">&lt;!-- </span><br><span class=\"line\">Sets the default character encoding to utf-8 &lt;character-encoding&gt;utf-8&lt;/character-encoding&gt; (默认字符集为 utf-8 )</span><br><span class=\"line\"> --&gt;</span><br><span class=\"line\">    &lt;!-- 在hosts/foo.example.com/webapps中自动部署虚拟主机 --&gt;</span><br><span class=\"line\">    &lt;host-deploy path=<span class=\"string\">\"hosts\"</span>&gt;</span><br><span class=\"line\">      &lt;host-default&gt;</span><br><span class=\"line\">        &lt;resin:import path=<span class=\"string\">\"host.xml\"</span> optional=<span class=\"string\">\"true\"</span>/&gt;</span><br><span class=\"line\">      &lt;/host-default&gt;</span><br><span class=\"line\">    &lt;/host-deploy&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;!-- 默认主机，匹配任何主机名 --&gt;</span><br><span class=\"line\">    &lt;host id=<span class=\"string\">\"\"</span> root-directory=<span class=\"string\">\".\"</span>&gt;</span><br><span class=\"line\">      &lt;!--- web应用程序可以在resin.xml中重写/扩展 可以解压war--&gt;</span><br><span class=\"line\">      &lt;web-app id=<span class=\"string\">\"/\"</span> root-directory=<span class=\"string\">\"webapps/ROOT\"</span>/&gt;</span><br><span class=\"line\">    &lt;/host&gt;</span><br><span class=\"line\">      </span><br><span class=\"line\">    &lt;resin:<span class=\"keyword\">if</span> <span class=\"built_in\">test</span>=<span class=\"string\">\"<span class=\"variable\">$&#123;resin_doc&#125;</span>\"</span>&gt;</span><br><span class=\"line\">      &lt;host id=<span class=\"string\">\"<span class=\"variable\">$&#123;resin_doc_host&#125;</span>\"</span> root-directory=<span class=\"string\">\"<span class=\"variable\">$&#123;resin_doc_host&#125;</span>\"</span>&gt;</span><br><span class=\"line\">        &lt;web-app id=<span class=\"string\">\"/resin-doc\"</span> root-directory=<span class=\"string\">\"<span class=\"variable\">$&#123;resin.root&#125;</span>/doc/resin-doc\"</span>/&gt;</span><br><span class=\"line\">      &lt;/host&gt;</span><br><span class=\"line\">    &lt;/resin:<span class=\"keyword\">if</span>&gt;</span><br><span class=\"line\">  &lt;/cluster&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  &lt;cluster id=<span class=\"string\">\"web\"</span>&gt;</span><br><span class=\"line\">    &lt;!-- 定义集群中的服务器 --&gt;</span><br><span class=\"line\">    &lt;server-multi id-prefix=<span class=\"string\">\"web-\"</span> address-list=<span class=\"string\">\"<span class=\"variable\">$&#123;web_servers&#125;</span>\"</span> port=<span class=\"string\">\"6810\"</span>/&gt;</span><br><span class=\"line\">    &lt;host id=<span class=\"string\">\"\"</span> root-directory=<span class=\"string\">\"web\"</span>&gt;</span><br><span class=\"line\">      &lt;web-app id=<span class=\"string\">\"\"</span>&gt;</span><br><span class=\"line\">        &lt;resin:LoadBalance regexp=<span class=\"string\">\"\"</span> cluster=<span class=\"string\">\"app\"</span>/&gt;</span><br><span class=\"line\">      &lt;/web-app&gt;</span><br><span class=\"line\">    &lt;/host&gt;</span><br><span class=\"line\">  &lt;/cluster&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/resin&gt;</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h2 id=\"0x03-Resin应用\"><a href=\"#0x03-Resin应用\" class=\"headerlink\" title=\"0x03 Resin应用\"></a>0x03 Resin应用</h2><p>描述:Resion主要应用就是部署和发布我们的JSP应用;</p>\n<p><strong>Resin发布应用</strong><br>Resin发布应用其实和Tomcat几乎一模一样有两种方式:</p>\n<ul>\n<li>Resin目录发布</li>\n<li>War发布</li>\n</ul>\n<p><strong>Resin3.x日志级别</strong><br>描述:java.util.logging.Level中的日志级别对应<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Level. ALL 指示应该记录所有消息。</span><br><span class=\"line\">static Level\tLevel. CONFIG 是用于静态配置消息的消息级别。</span><br><span class=\"line\">static Level\tLevel. FINE  是提供跟踪信息的消息级别。</span><br><span class=\"line\">static Level\tLevel. FINER 指示一条相当详细的跟踪消息。</span><br><span class=\"line\">static Level\tLevel. FINEST 指示一条最详细的跟踪消息。</span><br><span class=\"line\">static Level\tLevel. INFO 是报告消息的消息级别。</span><br><span class=\"line\">static Level\tLevel. OFF 是一个可用于关闭日志记录的特殊级别。</span><br><span class=\"line\">static Level\tLevel. SEVERE 是指示严重失败的消息级别。</span><br><span class=\"line\">static Level\tLevel. WARNING 是指示潜在问题的消息级别。</span><br></pre></td></tr></table></figure></p>\n<hr>\n\n<h2 id=\"0x04-Security\"><a href=\"#0x04-Security\" class=\"headerlink\" title=\"0x04 Security\"></a>0x04 Security</h2><p>描述:对于Resin服务进行安全配置加固;</p>\n<p><strong>Resin 4.x版本</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1.外部主机不能访问配置登录(实际生产环境中建议不要让外网访问后台)</span></span><br><span class=\"line\">vim /conf/resin.properties</span><br><span class=\"line\"><span class=\"comment\">#admin_external : true</span></span><br><span class=\"line\"><span class=\"comment\">#admin_secure : true</span></span><br><span class=\"line\"><span class=\"comment\">#或者</span></span><br><span class=\"line\">vim /conf/resin.xml</span><br><span class=\"line\">&lt;!-- &lt;resin:<span class=\"built_in\">set</span> var=<span class=\"string\">\"resin_admin_external\"</span> value=<span class=\"string\">\"true\"</span>/&gt; --&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.应为不同的用户分配不同的resin帐户，不允许不同用户间共享resint帐户(删除无关的用户)</span></span><br><span class=\"line\"><span class=\"comment\">#应要求 resin 管理帐户口令长度至少 8 位，且为数字、字母和特殊符号</span></span><br><span class=\"line\"><span class=\"comment\">#口令格式如：It#1s@te5t！、Test$6y&amp;y0u等</span></span><br><span class=\"line\"><span class=\"comment\">#方式1.将管理员口令粘贴到/resin-pro-4.0.36/conf/resin.properties，覆盖原来的口令 </span></span><br><span class=\"line\"><span class=\"comment\">#方式2.</span></span><br><span class=\"line\">cat /resin/resin-pro-4.0.48/conf/admin-users.xml</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3.禁用管理控制台/停止/限定resin-doc和resin-admin</span></span><br><span class=\"line\"><span class=\"comment\">#禁止非本地用户访问</span></span><br><span class=\"line\">resin_doc: <span class=\"literal\">false</span>  <span class=\"comment\">#false 表示禁用 </span></span><br><span class=\"line\">resin_doc_host：127.0.0.1</span><br><span class=\"line\"><span class=\"comment\">#禁用管理控制台</span></span><br><span class=\"line\">web_admin_enable : <span class=\"literal\">false</span> </span><br><span class=\"line\">web_admin_host : <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\">#删除默认页面</span></span><br><span class=\"line\">%resin%/webapps/ROOT/index.jsp</span><br><span class=\"line\">%resin%/doc/resin-doc</span><br><span class=\"line\">%resin%/doc/resin-admin</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4.Resin应用执行权限(低权限用户运行)</span></span><br><span class=\"line\">/usr/sbin/groupadd resin</span><br><span class=\"line\">/usr/sbin/useradd -g resin resin -s /sbin/nologin</span><br><span class=\"line\"><span class=\"comment\">#%resin%/conf/resin.properties 修改 resin 配置文件中的配置项，确保 setuid_user 和 setuid_group 的值不为 root 修改如下字段：</span></span><br><span class=\"line\">setuid_user : resin</span><br><span class=\"line\">setuid_group :resin</span><br><span class=\"line\"><span class=\"comment\">#注： resin 为 非 root 权限用户，Windows下面执行采用resin用户即可</span></span><br><span class=\"line\">runas /user:resin <span class=\"string\">\"cmd.exe cmd/k F:\\resin11\\httpd.exe \"</span>-Xms512M<span class=\"string\">\" \"</span>-Xmx1024M<span class=\"string\">\" \"</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#5.更改Resin默认端口 resin.properties ;</span></span><br><span class=\"line\">app.http  : 8080 </span><br><span class=\"line\">web.http  : 8080</span><br><span class=\"line\"><span class=\"comment\"># 适用于 HTTPS 站点的参数</span></span><br><span class=\"line\"><span class=\"comment\"># app.https    : 8443</span></span><br><span class=\"line\"><span class=\"comment\"># web.https    : 8443</span></span><br><span class=\"line\"><span class=\"comment\"># openssl_file : keys/test.crt</span></span><br><span class=\"line\"><span class=\"comment\"># openssl_key  : keys/test.key</span></span><br><span class=\"line\"><span class=\"comment\"># openssl_password : changeme</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#6.隐藏版本信息</span></span><br><span class=\"line\">Resin的版本信息被写死在了代码之中，无法通过配置文件来进行控制，修改方法如下：</span><br><span class=\"line\"></span><br><span class=\"line\">第一步：找到下列文件,将所有文件解压缩到一个目录中（例如：xxx）。</span><br><span class=\"line\">%RESIN_HOME%/lib/resin.jar</span><br><span class=\"line\">%RESIN_HOME%/lib/pro.jar（适用于Pro版本）</span><br><span class=\"line\"></span><br><span class=\"line\">第二步：找到下列文件：</span><br><span class=\"line\">xxx/com/caucho/Version.class</span><br><span class=\"line\">xxx/com/caucho/ProVersion.class(适用于Pro版本) </span><br><span class=\"line\"></span><br><span class=\"line\">用JD-GUI反编译版本上述文件，得到Version.java或ProVersion.java(适用于Pro版本)</span><br><span class=\"line\">注意：如果导出文件内容为空，可直接从JD-GUI中复制出代码创建这个文件</span><br><span class=\"line\"></span><br><span class=\"line\">第三步：根据需要修改Version.java/ProVersion.java文件中的VERSION、FULL_VERSION和VERSION_DATA参数的值（建议直接删除小版本号）,修改完成后用下面的命令重新编译为class文件</span><br><span class=\"line\">javac Version.java</span><br><span class=\"line\">javac ProVersion.java（适用于Pro版本）</span><br><span class=\"line\"></span><br><span class=\"line\">第四步：然后重新打包</span><br><span class=\"line\">将编译得到的class文件复制到原位置覆盖就文件，然后使用下面的命令重新打包：</span><br><span class=\"line\"></span><br><span class=\"line\">jar cfm resin.jar xxx/META-INF/MANIFEST.MF -C xxx/ .</span><br><span class=\"line\">jar cfm pro.jar xxx/META-INF/MANIFEST.MF -C xxx/ . （适用于Pro版本）</span><br><span class=\"line\"></span><br><span class=\"line\">第五步：停止Resin，用新生成的jar文件覆盖原文件（建议在覆盖前先备份原文件）后重启Resin。 </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#7.1 方式1管理目录安全应通过限制 ip 对管理目录的访问</span></span><br><span class=\"line\">进入目录 %resin% / doc / resin-doc / WEB-INF</span><br><span class=\"line\">使用命令“ vi resin-web.xml ”修改如下字段：</span><br><span class=\"line\">&lt;resin:<span class=\"keyword\">if</span> <span class=\"built_in\">test</span>=<span class=\"string\">\"<span class=\"variable\">$&#123;! resin_admin_external&#125;</span>\"</span>&gt;</span><br><span class=\"line\"> &lt;resin:IfNetwork&gt;</span><br><span class=\"line\"> &lt;value&gt;127.0.0.1&lt;/value&gt;</span><br><span class=\"line\"> &lt;value&gt;192.168.0.0/16&lt;/value&gt;</span><br><span class=\"line\"> &lt;value&gt;[::1]&lt;/value&gt;</span><br><span class=\"line\"> &lt;/resin:IfNetwork&gt;</span><br><span class=\"line\">&lt;/resin:<span class=\"keyword\">if</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#7.2 方式2为resin-admin设置白名单，webapps设置黑名单,然后新建立一个resin.properties中加一个参数用来放允许访问的ip：</span></span><br><span class=\"line\"><span class=\"comment\">#比如 `web_admin_allow_host: 10.10.10.10 10.10.10.11 10.10.10.12`</span></span><br><span class=\"line\">&lt;cluster id=<span class=\"string\">\"app\"</span>&gt;</span><br><span class=\"line\">&lt;!-- 只允许指定ip访问resin-admin --&gt;</span><br><span class=\"line\">    &lt;host id=<span class=\"string\">\"<span class=\"variable\">$&#123;web_admin_host&#125;</span>\"</span> root-directory=<span class=\"string\">\"<span class=\"variable\">$&#123;web_admin_host&#125;</span>\"</span>&gt;</span><br><span class=\"line\">      &lt;web-app id=<span class=\"string\">\"/resin-admin\"</span> root-directory=<span class=\"string\">\"<span class=\"variable\">$&#123;resin.root&#125;</span>/doc/admin\"</span>&gt;</span><br><span class=\"line\">          &lt;resin:Allow url-pattern=<span class=\"string\">\"/admin/*\"</span>&gt;</span><br><span class=\"line\">              &lt;resin:IfNetwork value=<span class=\"string\">\"<span class=\"variable\">$&#123;web_admin_allow_host&#125;</span>\"</span>/&gt;</span><br><span class=\"line\">          &lt;/resin:Allow&gt;</span><br><span class=\"line\">      &lt;/web-app&gt;</span><br><span class=\"line\">    &lt;/host&gt;</span><br><span class=\"line\">&lt;/cluster&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#8.应开启日志记录</span></span><br><span class=\"line\"><span class=\"comment\">#cat  %resin% /conf/resin.xml 配置文件确保 level 值不为 Off</span></span><br><span class=\"line\">&lt;<span class=\"built_in\">log</span>-handler name=<span class=\"string\">\"\"</span> level=<span class=\"string\">\"all\"</span> path=<span class=\"string\">\"stdout:\"</span> timestamp=<span class=\"string\">\"[%y-%m-%d %H:%M:%S.%s]\"</span></span><br><span class=\"line\">format=<span class=\"string\">\" &#123;<span class=\"variable\">$&#123;thread&#125;</span>&#125; <span class=\"variable\">$&#123;log.message&#125;</span>\"</span>/&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 9.应关闭开发模式</span></span><br><span class=\"line\">vi %resin%/conf/resin.properties将resin.properties配置文件中的</span><br><span class=\"line\">dev_mode: <span class=\"literal\">true</span> <span class=\"comment\">#注释掉</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 10.Resin 4.X SSL证书配置的两种方式，注意SSL证书格式JKS（Java Keystroe）文件是我们后面用来部署JSSE模式下所需要的文件。</span></span><br><span class=\"line\"><span class=\"comment\"># - Openssl 方式 - 因为Openssl模式下的速度更快，而且Openssl对TLS的支持更好，安全性高</span></span><br><span class=\"line\">&lt;http port=<span class=\"string\">\"443\"</span>&gt;</span><br><span class=\"line\">  &lt;openssl&gt;</span><br><span class=\"line\">    <span class=\"comment\"># 服务器证书文件/私钥文件/以及私钥密码</span></span><br><span class=\"line\">    &lt;certificate-file&gt;keys/server.cer&lt;/certificate-file&gt;</span><br><span class=\"line\">    &lt;certificate-key-file&gt;keys/server.key&lt;/certificate-key-file&gt;</span><br><span class=\"line\">    &lt;password&gt;my-password&lt;/password&gt;</span><br><span class=\"line\">    <span class=\"comment\"># 中间证书文件</span></span><br><span class=\"line\">    &lt;certificate-chain-file&gt;keys/chain.cer&lt;/certificate-chain-file&gt;</span><br><span class=\"line\">    <span class=\"comment\"># 加密套件设定</span></span><br><span class=\"line\">    &lt;cipher-suite&gt;ALL:!ADH:+HIGH:+MEDIUM:!NULL:!DH:!RC4:!DES &lt;/cipher-suite&gt;</span><br><span class=\"line\">    <span class=\"comment\"># SSL协议版本</span></span><br><span class=\"line\">    &lt;protocol&gt;tlsv1 tls1.1 tls1.2&lt;/protocol&gt;</span><br><span class=\"line\">  &lt;/openssl&gt;</span><br><span class=\"line\">&lt;/http&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - JSSE 方式 - 使用简单、速度较慢、且支持的最新TLS版本没有Openssl全。</span></span><br><span class=\"line\">&lt;http port=<span class=\"string\">\"443\"</span>&gt;</span><br><span class=\"line\">  &lt;jsse-ssl&gt;</span><br><span class=\"line\">    <span class=\"comment\"># 设定Keystore文件的类型 </span></span><br><span class=\"line\">    &lt;key-store-type&gt;jks&lt;/key-store-type&gt;</span><br><span class=\"line\">    &lt;key-store-file&gt;keys/server.keystore&lt;/key-store-file&gt;</span><br><span class=\"line\">    &lt;password&gt;changeit&lt;/password&gt;</span><br><span class=\"line\">    <span class=\"comment\"># 支持的SSL协议版本</span></span><br><span class=\"line\">    &lt;protocol&gt;-sslv3&lt;/protocol&gt;</span><br><span class=\"line\">    <span class=\"comment\"># 启用客户端验证</span></span><br><span class=\"line\">    &lt;verify-client&gt;required&lt;/verify-client&gt;</span><br><span class=\"line\">  &lt;/jsse-ssl&gt;</span><br><span class=\"line\">&lt;/http&gt;</span><br></pre></td></tr></table></figure></p>\n<p>Tips : 证书SSL相关工具地址(<a href=\"https://www.myssl.cn/tools/merge-jks-cert.html\" target=\"_blank\" rel=\"noopener\">https://www.myssl.cn/tools/merge-jks-cert.html</a>)<br><br></p>\n<p><strong>Resin 3.x 版本</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1.隐藏Resin响应头中的Server头</span></span><br><span class=\"line\"><span class=\"comment\">#resin.conf增加&lt;server-header&gt;节点</span></span><br><span class=\"line\">&lt;cluster id=<span class=\"string\">\"app-tier\"</span>&gt;</span><br><span class=\"line\">  &lt;!-- sets the content root <span class=\"keyword\">for</span> the cluster, relative to server.root --&gt;</span><br><span class=\"line\">    &lt;root-directory&gt;.&lt;/root-directory&gt;</span><br><span class=\"line\"> &lt;server-header&gt;Foo/1.0&lt;/server-header&gt;</span><br><span class=\"line\">&lt;server-default&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.Resin可以配置3种error-page：</span></span><br><span class=\"line\"><span class=\"comment\">#404错误也就是文件找不到错误页；Exception违例页；不能连接java引擎页</span></span><br><span class=\"line\">&lt;web-app id=<span class=\"string\">'/app1'</span>&gt;</span><br><span class=\"line\"> &lt;error-page error-code=<span class=\"string\">'404'</span> location=<span class=\"string\">'/file_not_found.jsp'</span>/&gt;</span><br><span class=\"line\">&lt;/web-app&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">#Exception 违例页</span></span><br><span class=\"line\">&lt;web-app id=<span class=\"string\">'/foo'</span>&gt;</span><br><span class=\"line\">  &lt;error-page exception-type=<span class=\"string\">'java.lang.NullPointerException'</span> location=<span class=\"string\">'/nullpointer.jsp'</span>/&gt;</span><br><span class=\"line\">&lt;/web-app&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">#不能连接到srun Servlet引擎错误页,该页设置和应用无关，属于服务器的设置。</span></span><br><span class=\"line\">&lt;http-server&gt;</span><br><span class=\"line\">　&lt;error-page exception-type=<span class=\"string\">'connection'</span> location=<span class=\"string\">'/missing_file.html'</span>/&gt;</span><br><span class=\"line\">&lt;/http-server&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3.生产环境日志设置</span></span><br><span class=\"line\">&lt;!-- -JDK日志接口的配置. 日志信息的级别：<span class=\"string\">'info'</span> 生产环境 <span class=\"string\">'fine'</span> 开发环境 <span class=\"string\">'finer'</span> 调试环境 --&gt;</span><br><span class=\"line\">&lt;<span class=\"built_in\">log</span> name=<span class=\"string\">\"\"</span> level=<span class=\"string\">\"fine\"</span> path=<span class=\"string\">\"stdout:\"</span> timestamp=<span class=\"string\">\"[%H:%M:%S.%s] \"</span>/&gt;</span><br><span class=\"line\">&lt;logger name=<span class=\"string\">\"com.caucho\"</span> level=<span class=\"string\">\"info\"</span>/&gt;</span><br><span class=\"line\">&lt;logger name=<span class=\"string\">\"com.caucho.java\"</span> level=<span class=\"string\">\"config\"</span>/&gt;</span><br><span class=\"line\">&lt;logger name=<span class=\"string\">\"com.caucho.loader\"</span> level=<span class=\"string\">\"config\"</span>/&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4.注释将关闭Administration application /resin-admin</span></span><br><span class=\"line\">&lt;web-app id=<span class=\"string\">\"/resin-admin\"</span> root-directory=<span class=\"string\">\"<span class=\"variable\">$&#123;resin.home&#125;</span>/php/admin\"</span>&gt;</span><br><span class=\"line\">    &lt;character-encoding&gt;utf8&lt;/character-encoding&gt;</span><br><span class=\"line\">    &lt;prologue&gt;</span><br><span class=\"line\">    &lt;resin:<span class=\"built_in\">set</span> var=<span class=\"string\">\"resin_admin_external\"</span> value=<span class=\"string\">\"false\"</span>/&gt;</span><br><span class=\"line\">    &lt;resin:<span class=\"built_in\">set</span> var=<span class=\"string\">\"resin_admin_insecure\"</span> value=<span class=\"string\">\"true\"</span>/&gt;</span><br><span class=\"line\">    &lt;/prologue&gt;</span><br><span class=\"line\">&lt;/web-app&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#5.Resin SSL 安全证书配置</span></span><br><span class=\"line\">&lt;!--</span><br><span class=\"line\">  - SSL port configuration:</span><br><span class=\"line\">  -</span><br><span class=\"line\">  - &lt;http address=<span class=\"string\">\"*\"</span> port=<span class=\"string\">\"8443\"</span>&gt;</span><br><span class=\"line\">  -   &lt;openssl&gt;</span><br><span class=\"line\">  -     &lt;certificate-file&gt;keys/gryffindor.crt&lt;/certificate-file&gt;</span><br><span class=\"line\">  -     &lt;certificate-key-file&gt;keys/gryffindor.key&lt;/certificate-key-file&gt;</span><br><span class=\"line\">  -     &lt;password&gt;test123&lt;/password&gt;</span><br><span class=\"line\">  -   &lt;/openssl&gt;</span><br><span class=\"line\">  - &lt;/http&gt;</span><br><span class=\"line\">--&gt;</span><br><span class=\"line\">&lt;http address=<span class=\"string\">\"*\"</span> port=<span class=\"string\">\"443\"</span>&gt;</span><br><span class=\"line\">&lt;jsse-ssl&gt;</span><br><span class=\"line\">    &lt;key-store-type&gt;jks&lt;/key-store-type&gt;</span><br><span class=\"line\">    &lt;key-store-file&gt;keys/6391687_resin.weiyigeek.top.jks&lt;/key-store-file&gt;</span><br><span class=\"line\">    &lt;password&gt;2DaGz&lt;/password&gt;</span><br><span class=\"line\">&lt;/jsse-ssl&gt;</span><br><span class=\"line\">&lt;/http&gt;</span><br></pre></td></tr></table></figure></p>\n<hr>\n\n<h2 id=\"0x05-Help-附录补充\"><a href=\"#0x05-Help-附录补充\" class=\"headerlink\" title=\"0x05 Help | 附录补充\"></a>0x05 Help | 附录补充</h2><h3 id=\"1-Resin-日志记录之format配置详解\"><a href=\"#1-Resin-日志记录之format配置详解\" class=\"headerlink\" title=\"(1) Resin 日志记录之format配置详解\"></a>(1) Resin 日志记录之format配置详解</h3><p>描述:访问日志格式变量遵循Apache的变量，且默认access.log的日志格式为<code>&quot;%h %l %u %t \\&quot;%r\\&quot; %&gt;s %b \\&quot;%{Referer}i\\&quot; \\&quot;%{User-Agent}i\\&quot;&quot;</code>;</p>\n<p>参数解释:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%b \tresult content length</span><br><span class=\"line\">%D \ttime taken to complete the request <span class=\"keyword\">in</span> microseconds (since 3.0.16)</span><br><span class=\"line\">%h \tremote IP addr</span><br><span class=\"line\">%&#123;xxx&#125;i \trequest header xxx</span><br><span class=\"line\">%&#123;xxx&#125;o \tresponse header xxx</span><br><span class=\"line\">%&#123;xxx&#125;c \tcookie value xxx</span><br><span class=\"line\">%n \trequest attribute</span><br><span class=\"line\">%r \trequest URL</span><br><span class=\"line\">%s \tstatus code</span><br><span class=\"line\">%&#123;xxx&#125;t \trequest date with optional time format string.</span><br><span class=\"line\">%T \ttime taken to complete the request <span class=\"keyword\">in</span> seconds</span><br><span class=\"line\">%u \tremote user</span><br><span class=\"line\">%U \trequest URI</span><br><span class=\"line\">%v \tname of the virtual host serving the request</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p><strong>时间戳格式字符串</strong>：<br>日志标记时间戳是一种格式的字符串，可含有取代有时间和日期值百分比代码。<br>参数解释：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%a \tday of week (short)</span><br><span class=\"line\">%A \tday of week (verbose)</span><br><span class=\"line\">%b \tday of month (short)</span><br><span class=\"line\">%B \tday of month (verbose)</span><br><span class=\"line\">%c \tJava locale date</span><br><span class=\"line\">%d \tday of month (two-digit)</span><br><span class=\"line\">%H \t24-hour (two-digit)</span><br><span class=\"line\">%I \t12-hour (two-digit)</span><br><span class=\"line\">%j \tday of year (three-digit)</span><br><span class=\"line\">%m \tmonth (two-digit)</span><br><span class=\"line\">%M \tminutes</span><br><span class=\"line\">%p \tam/pm</span><br><span class=\"line\">%S \tseconds</span><br><span class=\"line\">%s \tmilliseconds</span><br><span class=\"line\">%W \tweek <span class=\"keyword\">in</span> year (three-digit)</span><br><span class=\"line\">%w \tday of week (one-digit)</span><br><span class=\"line\">%y \tyear (two-digit)</span><br><span class=\"line\">%Y \tyear (four-digit)</span><br><span class=\"line\">%Z \ttime zone (name)</span><br><span class=\"line\">%z \ttime zone (+/-0800)</span><br></pre></td></tr></table></figure></p>\n<p><strong>基础实例:</strong><br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">resin</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://caucho.com/ns/resin\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">log-handler</span> <span class=\"attr\">name</span>=<span class=\"string\">''</span> <span class=\"attr\">path</span>=<span class=\"string\">'stderr:'</span> <span class=\"attr\">timestamp</span>=<span class=\"string\">\"[%H:%M:%S.%s]\"</span>/&gt;</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">resin</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 设置resin打循环日志，保留15天的日志 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">log</span> <span class=\"attr\">name</span>=<span class=\"string\">\"\"</span> <span class=\"attr\">level</span>=<span class=\"string\">\"info\"</span> <span class=\"attr\">path</span>=<span class=\"string\">\"../log/jvm-default.log\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">timestamp</span>=<span class=\"string\">\"[%H:%M:%S.%s] &#123;%&#123;thread&#125;&#125; \"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">rollover-period</span>=<span class=\"string\">\"1d\"</span> <span class=\"attr\">rollover-count</span>=<span class=\"string\">\"15\"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"SystemOperation","path":"api/categories/SystemOperation.json"}],"tags":[{"name":"Resin服务","path":"api/tags/Resin服务.json"}]}