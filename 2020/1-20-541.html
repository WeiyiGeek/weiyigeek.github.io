<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ ä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡æ­å»ºä¸å®‰å…¨é…ç½®å®è·µ|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Bind">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/2018/1-1-1.html"  >
                <i class="icon icon-lg icon-mortar-board"></i>
                å­¦ä¹ ä¹‹è·¯
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/sites"  >
                <i class="icon icon-lg icon-globe"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="/img/video-account.jpg" target="_blank" >
                <i class="icon icon-lg icon-video-camera"></i>
                è§†é¢‘å·
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                å‹æƒ…é“¾æ¥
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>ä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡æ­å»ºä¸å®‰å…¨é…ç½®å®è·µ</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">ä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡æ­å»ºä¸å®‰å…¨é…ç½®å®è·µ</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-01-20T07:37:27.000Z" itemprop="datePublished" class="page-time">
  2020-01-20
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DNS/">DNS</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DNS/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/">åŸŸåè§£æ</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap" style="display: none;">
  <article id="post-ç³»ç»Ÿè¿ç»´/Application/DNS/DNSä¸»ä»æœåŠ¡ä¹‹ä¼ä¸šå†…éƒ¨æ­å»ºä¸å®‰å…¨é…ç½®å®è·µ"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">ä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡æ­å»ºä¸å®‰å…¨é…ç½®å®è·µ</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-01-20 15:37:27" datetime="2020-01-20T07:37:27.000Z"  itemprop="datePublished">2020-01-20</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DNS/">DNS</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/DNS/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/">åŸŸåè§£æ</a></li></ul></li></ul>



            

            


            
        </div>
        <span class="post-href" style="display: none;">https://mp.weixin.qq.com/s/0EOyR4uEVe7T_4HbSxqK9w|cost</span> 
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="0x00-å®è·µæ¡ˆä¾‹"><a href="#0x00-å®è·µæ¡ˆä¾‹" class="headerlink" title="0x00 å®è·µæ¡ˆä¾‹"></a>0x00 å®è·µæ¡ˆä¾‹</h2><h3 id="1-ä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡æ­å»ºé…ç½®"><a href="#1-ä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡æ­å»ºé…ç½®" class="headerlink" title="1) ä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡æ­å»ºé…ç½®"></a>1) ä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡æ­å»ºé…ç½®</h3><p><strong>å®éªŒç›®æ ‡:</strong> å†…éƒ¨DNSä¸»ä»æ­å»ºä»¥åŠDNSæœåŠ¡å™¨å®‰å…¨é…ç½®;</p>
<p><strong>ç¯å¢ƒå‡†å¤‡:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸»æœº</span></span><br><span class="line">master - ns1 - 192.168.12.254 <span class="comment"># ä¸»DNSæœåŠ¡å™¨	</span></span><br><span class="line">slave - ns2 - 192.168.10.254  <span class="comment"># å¤‡DSNæœåŠ¡å™¨	</span></span><br><span class="line">slave - ns3 - 192.168.4.254   <span class="comment"># å¤‡DSNæœåŠ¡å™¨	</span></span><br><span class="line">any <span class="comment"># å®¢æˆ·æœºå™¨1	</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># OS ç¯å¢ƒ</span></span><br><span class="line">Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-67-generic x86_64)</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>å®è·µæµç¨‹:</strong></p>
<ul>
<li>Step 1.åŸºç¡€ç¯å¢ƒè®¾ç½®<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) é˜²ç«å¢™è®¾ç½®(åé¢æ²¡æœ‰ç‰¹æ®Šæ³¨æ˜çš„å³ä¸ºä¸‰å°ä¸»æœºéƒ½è¦æ‰§è¡Œ)</span></span><br><span class="line">systemctl status ufw</span><br><span class="line"><span class="comment"># â— ufw.service - Uncomplicated firewall</span></span><br><span class="line"><span class="comment">#      Loaded: loaded (/lib/systemd/system/ufw.service; enabled; vendor preset: enabled)</span></span><br><span class="line"><span class="comment">#      Active: active (exited) since Thu 2021-02-04 14:13:09 CST; 1 months 15 days ago</span></span><br><span class="line">sudo ufw allow 53</span><br><span class="line">  <span class="comment"># Rules updated</span></span><br><span class="line">  <span class="comment"># Rules updated (v6)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) å®‰è£… Bind9</span></span><br><span class="line">apt install bind9 -y</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Master-ä¸»DNSé…ç½®"><a href="#Master-ä¸»DNSé…ç½®" class="headerlink" title="Master-ä¸»DNSé…ç½®"></a>Master-ä¸»DNSé…ç½®</h4><ul>
<li>Step 2.Bindä¹‹MasterèŠ‚ç‚¹é…ç½®<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (2) Master DNS Server é…ç½®æ–‡ä»¶åœ¨master - ns1æœºå™¨ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span></span><br><span class="line">mkdir -vp /var/cache/<span class="built_in">bind</span>/master/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Options</span></span><br><span class="line">sudo tee /etc/<span class="built_in">bind</span>/named.conf.options &lt;&lt;<span class="string">'END'</span></span><br><span class="line"><span class="comment"># ACL - è®¿é—®æ§åˆ¶</span></span><br><span class="line">acl <span class="string">"trusted"</span> &#123;</span><br><span class="line">  localhost;       <span class="comment"># ns1 - can be set to localhost</span></span><br><span class="line">  192.168.12.254;  <span class="comment"># ns1</span></span><br><span class="line">  192.168.10.254;  <span class="comment"># ns2</span></span><br><span class="line">  192.168.4.254;   <span class="comment"># ns3</span></span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">acl <span class="string">"innerhost"</span> &#123;</span><br><span class="line">  10.0.0.0/8;</span><br><span class="line">  172.16.0.0/12;</span><br><span class="line">  192.168.0.0/16;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€‰é¡¹ - å…¨å±€é…ç½®</span></span><br><span class="line">options &#123;</span><br><span class="line">    directory <span class="string">"/var/cache/bind"</span>;</span><br><span class="line">    listen-on port 53 &#123; any; &#125;;</span><br><span class="line">    <span class="comment"># listen-on-v6 port 53 &#123; any; &#125;;</span></span><br><span class="line">    dnssec-validation no;</span><br><span class="line">    auth-nxdomain no;      <span class="comment"># æ˜¯å¦åšä¸ºæƒå¨æœåŠ¡å™¨å›ç­”åŸŸä¸å­˜åœ¨ conform to RFC1035</span></span><br><span class="line">    allow-query &#123; any; &#125;;</span><br><span class="line">    allow-query-cache &#123; any; &#125;;</span><br><span class="line">    dump-file       <span class="string">"/var/cache/bind/cache_dump.db"</span>;</span><br><span class="line">    statistics-file <span class="string">"/var/cache/bind/named_stats.txt"</span>;</span><br><span class="line">    memstatistics-file <span class="string">"/var/cache/bind/named_mem_stats.txt"</span>;</span><br><span class="line">    <span class="comment"># recursion yes;   </span></span><br><span class="line">    forwarders &#123;</span><br><span class="line">      223.6.6.6;       <span class="comment"># é˜¿é‡Œäº‘ dns</span></span><br><span class="line">      223.5.5.5;       <span class="comment"># é˜¿é‡Œäº‘ secondary dns</span></span><br><span class="line">      114.114.114.114; <span class="comment"># ç™¾åº¦ dns</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥å¿— - æŸ¥è¯¢è®°å½•10ä¸ªæ–‡ä»¶æ¯ä¸ªæ–‡ä»¶20MB</span></span><br><span class="line">logging &#123;</span><br><span class="line">  channel query_log &#123;</span><br><span class="line">    file <span class="string">"dns-query.log"</span> versions 10 size 20m;</span><br><span class="line">    severity info;</span><br><span class="line">    <span class="built_in">print</span>-time yes;</span><br><span class="line">    <span class="built_in">print</span>-category yes;</span><br><span class="line">  &#125;;</span><br><span class="line">  category queries &#123;</span><br><span class="line">    query_log;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒºåŸŸæ–‡ä»¶</span></span><br><span class="line">sudo tee /etc/<span class="built_in">bind</span>/named.conf.local &lt;&lt;<span class="string">'END'</span></span><br><span class="line">zone <span class="string">"."</span> &#123;</span><br><span class="line">  <span class="built_in">type</span> hint;</span><br><span class="line">  file <span class="string">"/usr/share/dns/root.hints"</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">"weiyigeek.cn"</span> &#123;</span><br><span class="line">    <span class="built_in">type</span> master;</span><br><span class="line">    file <span class="string">"master/db.weiyigeek.cn"</span>;</span><br><span class="line">    notify yes; </span><br><span class="line">    also-notify &#123; trusted; &#125;;    <span class="comment"># ä» DNS</span></span><br><span class="line">    allow-transfer &#123; trusted; &#125;;    <span class="comment"># ns2 / ns3 private IP address - secondary</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">"weiyigeek.top"</span> &#123;</span><br><span class="line">    <span class="built_in">type</span> master;</span><br><span class="line">    file <span class="string">"master/db.weiyigeek.top"</span>;</span><br><span class="line">    notify yes; </span><br><span class="line">    allow-transfer &#123; trusted; &#125;;    <span class="comment"># ns2 / ns3  private IP address - secondary</span></span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">zone <span class="string">"168.192.in-addr.arpa"</span> &#123;</span><br><span class="line">    <span class="built_in">type</span> master;</span><br><span class="line">    file <span class="string">"master/db.168.192"</span>;</span><br><span class="line">    notify yes; </span><br><span class="line">    allow-transfer &#123; trusted; &#125;;    <span class="comment"># ns2 / ns3  private IP address - secondary</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">"12.168.192.in-addr.arpa"</span> &#123;</span><br><span class="line">    <span class="built_in">type</span> master;</span><br><span class="line">    file <span class="string">"master/db.12.168.192"</span>;</span><br><span class="line">    notify yes;</span><br><span class="line">    allow-transfer &#123; trusted; &#125;;    <span class="comment"># ns2 / ns3  private IP address - secondary</span></span><br><span class="line">&#125;;</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†…éƒ¨åŸŸåæ­£å‘è§£æä¸åå‘è§£æ</span></span><br><span class="line">tee /var/cache/<span class="built_in">bind</span>/master/db.weiyigeek.top &lt;&lt;<span class="string">'END'</span></span><br><span class="line">; BIND data file <span class="keyword">for</span> <span class="built_in">local</span> loopback interface</span><br><span class="line"><span class="variable">$TTL</span> 86400</span><br><span class="line">@       IN      SOA     ns1.weiyigeek.top. admin.weiyigeek.top. (</span><br><span class="line">                      202103021         ; Serial</span><br><span class="line">                          50400         ; Refresh</span><br><span class="line">                          86400         ; Retry</span><br><span class="line">                         604800         ; Expire</span><br><span class="line">                          86400 )       ; Negative Cache TTL</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">; name servers - NS records</span><br><span class="line">@ IN NS ns1.weiyigeek.top.</span><br><span class="line">@ IN NS ns2.weiyigeek.top.</span><br><span class="line">@ IN NS ns3.weiyigeek.top.</span><br><span class="line">@ IN A 192.168.12.18</span><br><span class="line"></span><br><span class="line">; name servers - A records</span><br><span class="line">ns1.weiyigeek.top. IN A 192.168.12.254</span><br><span class="line">ns2.weiyigeek.top. IN A 192.168.10.254</span><br><span class="line">ns3.weiyigeek.top. IN A 192.168.4.254</span><br><span class="line"></span><br><span class="line">; 192.168.12.0/24 - A records</span><br><span class="line">; CNAME</span><br><span class="line">mail.weiyigeek.top. IN CNAME exmail.qq.com.</span><br><span class="line"></span><br><span class="line">; Resolve-A</span><br><span class="line">www.weiyigeek.top. IN A 192.168.12.18</span><br><span class="line">vcsa.weiyigeek.top. IN A 192.168.12.251</span><br><span class="line">gitlab.weiyigeek.top. IN A 192.168.12.61</span><br><span class="line">maven.weiyigeek.top. IN A 192.168.12.61</span><br><span class="line">harbor.weiyigeek.top. IN A 192.168.12.108</span><br><span class="line">sonar.weiyigeek.top. IN A 192.168.12.109</span><br><span class="line">wiki.weiyigeek.top. IN A 10.10.107.202</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line">tee /var/cache/<span class="built_in">bind</span>/master/db.12.168.192 &lt;&lt;<span class="string">'END'</span></span><br><span class="line">; BIND reverse data file <span class="keyword">for</span> <span class="built_in">local</span> loopback interface</span><br><span class="line">;</span><br><span class="line"><span class="variable">$TTL</span> 86400</span><br><span class="line">@  IN  SOA  weiyigeek.top. admin.weiyigeek.top. (</span><br><span class="line">                      202103022         ; Serial</span><br><span class="line">                          50400         ; Refresh</span><br><span class="line">                          86400         ; Retry</span><br><span class="line">                         604800         ; Expire</span><br><span class="line">                          86400 )       ; Negative Cache TTL</span><br><span class="line">;</span><br><span class="line"> </span><br><span class="line">; name servers</span><br><span class="line">@ IN  NS ns1.weiyigeek.top.</span><br><span class="line">@ IN  NS ns2.weiyigeek.top.</span><br><span class="line"> </span><br><span class="line">; PTR Records</span><br><span class="line">254 IN PTR ns1.weiyigeek.top.      </span><br><span class="line">18 IN PTR www.weiyigeek.top.</span><br><span class="line">13 IN PTR s.weiyigeek.top.</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tee /var/cache/<span class="built_in">bind</span>/master/db.weiyigeek.cn &lt;&lt;<span class="string">'END'</span></span><br><span class="line">; BIND data file <span class="keyword">for</span> <span class="built_in">local</span> loopback interface</span><br><span class="line"><span class="variable">$TTL</span> 86400</span><br><span class="line">@       IN      SOA     ns1.weiyigeek.cn. admin.weiyigeek.cn. (</span><br><span class="line">                          3             ; Serial</span><br><span class="line">                          50400         ; Refresh</span><br><span class="line">                          86400         ; Retry</span><br><span class="line">                         604800         ; Expire</span><br><span class="line">                          86400 )       ; Negative Cache TTL</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">; name servers - NS records</span><br><span class="line">@ IN NS ns1.weiyigeek.cn.</span><br><span class="line">@ IN NS ns2.weiyigeek.cn.</span><br><span class="line">@ IN NS ns3.weiyigeek.cn.</span><br><span class="line">@ IN A 192.168.10.47</span><br><span class="line">view IN NS view</span><br><span class="line"></span><br><span class="line">; name servers - A records</span><br><span class="line">ns1.weiyigeek.cn. IN A 192.168.12.254</span><br><span class="line">ns2.weiyigeek.cn. IN A 192.168.10.254</span><br><span class="line">ns3.weiyigeek.cn. IN A 192.168.4.254</span><br><span class="line"></span><br><span class="line">; 192.168.10.0/24 - A records</span><br><span class="line">; CNAME</span><br><span class="line"></span><br><span class="line">; Resolve-A</span><br><span class="line">www.weiyigeek.cn. IN A 192.168.10.47</span><br><span class="line">mail.weiyigeek.cn. IN A 192.168.10.49</span><br><span class="line">rtx.weiyigeek.cn. IN A 192.168.4.96</span><br><span class="line">pwd.weiyigeek.cn. IN A 192.168.10.55</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tee /var/cache/<span class="built_in">bind</span>/master/db.168.192 &lt;&lt;<span class="string">'END'</span></span><br><span class="line">; BIND reverse data file <span class="keyword">for</span> <span class="built_in">local</span> loopback interface</span><br><span class="line">;</span><br><span class="line"><span class="variable">$TTL</span> 86400</span><br><span class="line">@       IN      SOA     weiyigeek.cn. admin.weiyigeek.cn. (</span><br><span class="line">                              4         ; Serial</span><br><span class="line">                          50400         ; Refresh</span><br><span class="line">                          86400         ; Retry</span><br><span class="line">                         604800         ; Expire</span><br><span class="line">                          86400 )       ; Negative Cache TTL</span><br><span class="line">;</span><br><span class="line"> </span><br><span class="line">; name servers</span><br><span class="line">@ IN  NS ns1.weiyigeek.cn.</span><br><span class="line">@ IN  NS ns2.weiyigeek.cn.</span><br><span class="line">@ IN  NS ns3.weiyigeek.cn.</span><br><span class="line"></span><br><span class="line">; PTR Records</span><br><span class="line">254.10 IN PTR ns2.weiyigeek.cn.</span><br><span class="line">254.4 IN PTR ns3.weiyigeek.cn.</span><br><span class="line">47.10 IN PTR www.weiyigeek.cn.</span><br><span class="line">96.4 IN PTR oa.weiyigeek.cn.</span><br><span class="line">96.4 IN PTR rtx.weiyigeek.cn.</span><br><span class="line">END</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h4 id="Slave-ä»DNSé…ç½®"><a href="#Slave-ä»DNSé…ç½®" class="headerlink" title="Slave-ä»DNSé…ç½®"></a>Slave-ä»DNSé…ç½®</h4><p>æè¿°: æ­¤å¤„é…ç½®<code>192.168.4.254</code> ä»¥åŠ <code>192.168.10.254</code>ä¸¤å°åŒ—æœºå™¨ä¸Šè¿›è¡Œæ“ä½œ;</p>
<ul>
<li>Step 4.Slaveä»ä¸»æœºç›¸å…³Bindé…ç½®<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) åˆ›å»º slave å­˜æ”¾åŒæ­¥çš„ zone æ–‡ä»¶</span></span><br><span class="line">sudo mkdir -vp /var/cache/<span class="built_in">bind</span>/slave/</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) åˆ é™¤ include "/etc/bind/named.conf.default-zones" çš„ä¸€è¡Œæˆ‘å·²ç»å°† zone "." å¼•å…¥åˆ° named.conf.local æ–‡ä»¶ä¹‹ä¸­;</span></span><br><span class="line">sudo sed -i <span class="string">'/named.conf.default-zones/d'</span> /etc/<span class="built_in">bind</span>/named.conf</span><br><span class="line">cat /etc/<span class="built_in">bind</span>/named.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) Options å‚æ•°é…ç½®</span></span><br><span class="line">sudo tee /etc/<span class="built_in">bind</span>/named.conf.options &lt;&lt;<span class="string">'END'</span></span><br><span class="line"><span class="comment"># ACL - è®¿é—®æ§åˆ¶</span></span><br><span class="line">acl <span class="string">"trusted"</span> &#123;</span><br><span class="line">  localhost;       <span class="comment"># ns1 - can be set to localhost</span></span><br><span class="line">  192.168.12.254;  <span class="comment"># ns1</span></span><br><span class="line">  192.168.10.254;  <span class="comment"># ns2</span></span><br><span class="line">  192.168.4.254;   <span class="comment"># ns3</span></span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">acl <span class="string">"innerhost"</span> &#123;</span><br><span class="line">  10.0.0.0/8;</span><br><span class="line">  172.16.0.0/12;</span><br><span class="line">  192.168.0.0/16;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€‰é¡¹ - å…¨å±€é…ç½®</span></span><br><span class="line">options &#123;</span><br><span class="line">    directory <span class="string">"/var/cache/bind"</span>;</span><br><span class="line">    listen-on port 53 &#123; any; &#125;;</span><br><span class="line">    <span class="comment"># listen-on-v6 port 53 &#123; any; &#125;;</span></span><br><span class="line">    dnssec-validation no;</span><br><span class="line">    <span class="comment"># æ˜¯å¦åšä¸ºæƒå¨æœåŠ¡å™¨å›ç­”åŸŸä¸å­˜åœ¨ conform to RFC1035</span></span><br><span class="line">    auth-nxdomain no;  </span><br><span class="line">    allow-query &#123; any; &#125;;</span><br><span class="line">    allow-query-cache &#123; any; &#125;;</span><br><span class="line">    <span class="comment"># recursion yes;   </span></span><br><span class="line">    forwarders &#123;</span><br><span class="line">      223.6.6.6;       <span class="comment"># é˜¿é‡Œäº‘ dns</span></span><br><span class="line">      223.5.5.5;       <span class="comment"># é˜¿é‡Œäº‘ secondary dns</span></span><br><span class="line">      114.114.114.114; <span class="comment"># ç™¾åº¦ dns</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥å¿— - æŸ¥è¯¢è®°å½•10ä¸ªæ–‡ä»¶æ¯ä¸ªæ–‡ä»¶20MB</span></span><br><span class="line">logging &#123;</span><br><span class="line">  channel query_log &#123;</span><br><span class="line">    file <span class="string">"dns-query.log"</span> versions 10 size 20m;</span><br><span class="line">    severity info;</span><br><span class="line">    <span class="built_in">print</span>-time yes;</span><br><span class="line">    <span class="built_in">print</span>-category yes;</span><br><span class="line">  &#125;;</span><br><span class="line">  category queries &#123;</span><br><span class="line">    query_log;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒºåŸŸæ–‡ä»¶ï¼šå®šä¹‰ä¸ä¸»DNSæœåŠ¡å™¨ä¸Šçš„ä¸»åŒºåŸŸå¯¹åº”çš„ä»å±åŒºåŸŸã€‚ è¯·æ³¨æ„ç±»å‹æ˜¯â€œslaveâ€ï¼Œæ–‡ä»¶ä¸åŒ…å«è·¯å¾„ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªmastersæŒ‡ä»¤åº”è¯¥è®¾ç½®ä¸ºä¸»DNSæœåŠ¡å™¨çš„ä¸“ç”¨IPåœ°å€</span></span><br><span class="line"></span><br><span class="line">sudo tee /etc/<span class="built_in">bind</span>/named.conf.local &lt;&lt;<span class="string">'END'</span></span><br><span class="line">zone <span class="string">"."</span> &#123;</span><br><span class="line">  <span class="built_in">type</span> hint;</span><br><span class="line">  file <span class="string">"/usr/share/dns/root.hints"</span>;</span><br><span class="line">&#125;;</span><br><span class="line">zone <span class="string">"weiyigeek.cn"</span> &#123;</span><br><span class="line">  <span class="built_in">type</span> slave;</span><br><span class="line">  file <span class="string">"slave/db.weiyigeek.cn"</span>;</span><br><span class="line">  masters &#123; 192.168.12.254; &#125;;    <span class="comment"># Master DNS private IP address </span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">"weiyigeek.top"</span> &#123;</span><br><span class="line">  <span class="built_in">type</span> slave;</span><br><span class="line">  file <span class="string">"slave/db.weiyigeek.top"</span>;</span><br><span class="line">  masters&#123;  192.168.12.254; &#125;;    <span class="comment"># Master DNS private IP address - secondary</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">"168.192.in-addr.arpa"</span> &#123;</span><br><span class="line">  <span class="built_in">type</span> slave;</span><br><span class="line">  file <span class="string">"slave/db.168.192"</span>;</span><br><span class="line">  masters &#123; 192.168.12.254; &#125;;    <span class="comment"># Master DNS private IP address - secondary</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">"12.168.192.in-addr.arpa"</span> &#123;</span><br><span class="line">  <span class="built_in">type</span> slave;</span><br><span class="line">  file <span class="string">"slave/db.12.168.192"</span>;</span><br><span class="line">  masters &#123;  192.168.12.254; &#125;;    <span class="comment"># Master DNS private IP address - secondary</span></span><br><span class="line">&#125;;</span><br><span class="line">END</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h4 id="ä¸»ä»é…ç½®éªŒè¯å¯ç”¨"><a href="#ä¸»ä»é…ç½®éªŒè¯å¯ç”¨" class="headerlink" title="ä¸»ä»é…ç½®éªŒè¯å¯ç”¨"></a>ä¸»ä»é…ç½®éªŒè¯å¯ç”¨</h4><ul>
<li>Step 4.Master / SlaveèŠ‚ç‚¹é…ç½®éªŒè¯<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1) åŒºåŸŸé…ç½®ï¼ˆä¸»ã€å¤‡ï¼‰</span></span><br><span class="line">$ named-checkconf -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2) å†…éƒ¨è§£æzoneé…ç½®</span></span><br><span class="line"><span class="keyword">for</span> zone <span class="keyword">in</span> $(ls /var/cache/<span class="built_in">bind</span>/master/);<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"# <span class="variable">$&#123;zone&#125;</span> ---------------------------"</span></span><br><span class="line">  named-checkzone <span class="variable">$&#123;zone&#125;</span> /var/cache/<span class="built_in">bind</span>/master/<span class="variable">$&#123;zone&#125;</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">"\n"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç»“æœ</span></span><br><span class="line"><span class="comment"># db.12.168.192 ---------------------------</span></span><br><span class="line">zone db.12.168.192/IN: loaded serial 202103022</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># db.168.192 ---------------------------</span></span><br><span class="line">zone db.168.192/IN: loaded serial 4</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<ul>
<li><p>Step 5.bindç›¸å…³é…ç½®æ–‡ä»¶æ‰€å±è€…ä¸æ‰€å±ç»„åˆ†é…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R bind:bind &#x2F;var&#x2F;cache&#x2F;bind&#x2F; &#x2F;etc&#x2F;bind&#x2F;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Step 6.é‡å¯namedæœåŠ¡ä»¥åŠæŸ¥çœ‹æœåŠ¡çš„å¯åŠ¨çŠ¶æ€</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1) å¯åŠ¨ä¸»dns</span></span><br><span class="line">systemctl restart named &amp;&amp; systemctl status named</span><br><span class="line">  <span class="comment"># â— named.service - BIND Domain Name Server</span></span><br><span class="line">  <span class="comment">#     Loaded: loaded (/lib/systemd/system/named.service; enabled; vendor preset: enabled)</span></span><br><span class="line">  <span class="comment">#     Active: active (running) since Mon 2021-03-22 14:53:55 CST; 24s ago</span></span><br><span class="line">  <span class="comment">#       Docs: man:named(8)</span></span><br><span class="line">  <span class="comment">#   Main PID: 70775 (named)</span></span><br><span class="line">  <span class="comment">#       Tasks: 26 (limit: 9448)</span></span><br><span class="line">  <span class="comment">#     Memory: 50.4M</span></span><br><span class="line">  <span class="comment">#     CGroup: /system.slice/named.service</span></span><br><span class="line">  <span class="comment">#             â””â”€70775 /usr/sbin/named -f -u bind</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Mar 22 14:53:55 dns-server named[70775]: zone 12.168.192.in-addr.arpa/IN: loaded serial 202103022</span></span><br><span class="line">  <span class="comment"># Mar 22 14:53:55 dns-server named[70775]: zone 168.192.in-addr.arpa/IN: loaded serial 4</span></span><br><span class="line">  <span class="comment"># Mar 22 14:53:55 dns-server named[70775]: zone weiyigeek.top/IN: loaded serial 202103021</span></span><br><span class="line">  <span class="comment"># Mar 22 14:53:55 dns-server named[70775]: zone weiyigeek.cn/IN: loaded serial 3</span></span><br><span class="line">  <span class="comment"># Mar 22 14:53:55 dns-server named[70775]: all zones loaded</span></span><br><span class="line">  <span class="comment"># Mar 22 14:53:55 dns-server named[70775]: running</span></span><br><span class="line">  <span class="comment"># Mar 22 14:53:55 dns-server named[70775]: zone weiyigeek.top/IN: sending notifies (serial 202103021)</span></span><br><span class="line">  <span class="comment"># Mar 22 14:53:55 dns-server named[70775]: zone weiyigeek.cn/IN: sending notifies (serial 3)</span></span><br><span class="line">  <span class="comment"># Mar 22 14:53:55 dns-server named[70775]: zone 12.168.192.in-addr.arpa/IN: sending notifies (serial 202103022)</span></span><br><span class="line">  <span class="comment"># Mar 22 14:53:55 dns-server named[70775]: zone 168.192.in-addr.arpa/IN: sending notifies (serial 4)</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># 2) å¯åŠ¨å¤‡dnsï¼šæ­¤æ—¶å¤‡dnsè‡ªåŠ¨åŒæ­¥ä¸»DNSçš„å†…å®¹ã€‚</span></span><br><span class="line">systemctl restart named &amp;&amp; systemctl status named</span><br><span class="line">  <span class="comment"># named.service - BIND Domain Name Server</span></span><br><span class="line">  <span class="comment">#    Loaded: loaded (/lib/systemd/system/named.service; enabled; vendor preset: enabled)</span></span><br><span class="line">  <span class="comment">#    Active: active (running) since Mon 2021-03-22 18:54:10 CST; 10ms ago</span></span><br><span class="line">  <span class="comment">#      Docs: man:named(8)</span></span><br><span class="line">  <span class="comment">#  Main PID: 46903 (named)</span></span><br><span class="line">  <span class="comment">#     Tasks: 1 (limit: 9448)</span></span><br><span class="line">  <span class="comment">#    Memory: 588.0K</span></span><br><span class="line">  <span class="comment">#    CGroup: /system.slice/named.service</span></span><br><span class="line">  <span class="comment">#            â””â”€46903 /usr/sbin/named -f -u bind</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Mar 22 18:54:10 dns-server named[46903]: command channel listening on ::1#953</span></span><br><span class="line">  <span class="comment"># Mar 22 18:54:10 dns-server named[46903]: managed-keys-zone: loaded serial 43</span></span><br><span class="line">  <span class="comment"># Mar 22 18:54:10 dns-server named[46903]: all zones loaded</span></span><br><span class="line">  <span class="comment"># Mar 22 18:54:10 dns-server named[46903]: running</span></span><br><span class="line">  <span class="comment"># Mar 22 18:54:10 dns-server named[46903]: zone weiyigeek.cn/IN: Transfer started.  # åŒæ­¥ä¼ è¾“å¼€å§‹æ ‡å‡†</span></span><br><span class="line">  <span class="comment"># Mar 22 18:54:10 dns-server named[46903]: transfer of 'weiyigeek.cn/IN' from 192.168.12.254#53: connected using 192.168.4.254#37107</span></span><br><span class="line">  <span class="comment"># Mar 22 18:54:10 dns-server named[46903]: zone weiyigeek.cn/IN: transferred serial 3</span></span><br><span class="line">  <span class="comment"># Mar 22 18:54:10 dns-server named[46903]: transfer of 'weiyigeek.cn/IN' from 192.168.12.254#53: Transfer status: success   # åŒæ­¥ä¼ è¾“æˆåŠŸæ ‡å‡†</span></span><br><span class="line">  <span class="comment"># Mar 22 18:54:10 dns-server named[46903]: transfer of 'weiyigeek.cn/IN' from 192.168.12.254#53: Transfer completed: 1 messages, 41 records, 865 bytes, 0.001 secs (865000 bytes/sec)</span></span><br><span class="line">  <span class="comment"># Mar 22 18:54:10 dns-server named[46903]: zone weiyigeek.cn/IN: sending notifies (serial 3)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¹¶ä¸”ä¼šè‡ªåŠ¨åœ¨å®šä¹‰çš„å·¥ä½œç›®å½•å†…ç”Ÿæˆæ•°æ®æ–‡ä»¶ã€‚</span></span><br><span class="line">/var/cache/<span class="built_in">bind</span>$ ls slave/*</span><br><span class="line">  slave/db.12.168.192  slave/db.168.192  slave/db.weiyigeek.cn  slave/db.weiyigeek.top</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h4 id="ä¸»ä»æœåŠ¡å·¥ä½œæµ‹è¯•"><a href="#ä¸»ä»æœåŠ¡å·¥ä½œæµ‹è¯•" class="headerlink" title="ä¸»ä»æœåŠ¡å·¥ä½œæµ‹è¯•"></a>ä¸»ä»æœåŠ¡å·¥ä½œæµ‹è¯•</h4><ul>
<li>Step 7.éªŒè¯æµ‹è¯•æ­å»ºçš„DNSä¸»ä»æœåŠ¡å™¨;<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) æµ‹è¯• weiyigeek.cn ä¸ weiyigeek.top çš„ NS è®°å½•</span></span><br><span class="line">C:\Users\WeiyiGeek&gt;nslookup -qt=ns weiyigeek.cn 192.168.12.254</span><br><span class="line">æœåŠ¡å™¨:  ns1.weiyigeek.top</span><br><span class="line">Address:  192.168.12.254</span><br><span class="line"></span><br><span class="line">weiyigeek.cn        nameserver = ns1.weiyigeek.cn</span><br><span class="line">weiyigeek.cn        nameserver = ns3.weiyigeek.cn</span><br><span class="line">weiyigeek.cn        nameserver = ns2.weiyigeek.cn</span><br><span class="line">ns1.weiyigeek.cn    internet address = 192.168.12.254</span><br><span class="line">ns2.weiyigeek.cn    internet address = 192.168.10.254</span><br><span class="line">ns3.weiyigeek.cn    internet address = 192.168.4.254</span><br><span class="line"></span><br><span class="line">C:\Users\WeiyiGeek&gt;nslookup -qt=ns weiyigeek.top 192.168.12.254</span><br><span class="line">æœåŠ¡å™¨:  ns1.weiyigeek.top</span><br><span class="line">Address:  192.168.12.254</span><br><span class="line"></span><br><span class="line">weiyigeek.top     nameserver = ns3.weiyigeek.top</span><br><span class="line">weiyigeek.top     nameserver = ns1.weiyigeek.top</span><br><span class="line">weiyigeek.top     nameserver = ns2.weiyigeek.top</span><br><span class="line">ns1.weiyigeek.top internet address = 192.168.12.254</span><br><span class="line">ns2.weiyigeek.top internet address = 192.168.10.254</span><br><span class="line">ns3.weiyigeek.top internet address = 192.168.4.254</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æ­£å‘å’Œåå‘è§£æéªŒè¯</span></span><br><span class="line">~$ dig www.weiyigeek.cn @192.168.12.254 | grep <span class="string">"www.weiyigeek.cn"</span></span><br><span class="line">  <span class="comment"># ; DiG 9.16.1-Ubuntu www.weiyigeek.cn @192.168.12.254</span></span><br><span class="line">  <span class="comment">#   ;www.weiyigeek.cn.                  IN      A</span></span><br><span class="line">  <span class="comment">#   www.weiyigeek.cn.           86400   IN      A    192.168.10.47</span></span><br><span class="line"></span><br><span class="line">~$ dig www.weiyigeek.top @192.168.4.254 | grep <span class="string">"www.weiyigeek.top"</span></span><br><span class="line">  <span class="comment"># ; DiG 9.16.1-Ubuntu www.weiyigeek.top @192.168.4.254</span></span><br><span class="line">  <span class="comment">#   ;www.weiyigeek.top.               IN      A</span></span><br><span class="line">  <span class="comment">#   www.weiyigeek.top.        86400   IN      A    192.168.12.18</span></span><br><span class="line"></span><br><span class="line">~$ dig -x 192.168.10.47 @192.168.4.254 | grep <span class="string">"47.10.168.192"</span></span><br><span class="line">  <span class="comment"># ;47.10.168.192.in-addr.arpa.    IN      PTR</span></span><br><span class="line">  <span class="comment"># 47.10.168.192.in-addr.arpa. 86400 IN    PTR     www.weiyigeek.cn.</span></span><br><span class="line"></span><br><span class="line">dig -x 192.168.12.18 @192.168.4.254 | grep <span class="string">"18.12.168.192"</span></span><br><span class="line">  <span class="comment"># ;18.12.168.192.in-addr.arpa.    IN      PTR</span></span><br><span class="line">  <span class="comment"># 18.12.168.192.in-addr.arpa. 86400 IN    PTR     www.weiyigeek.top.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) è§£æå¤–ç½‘åœ°å€æµ‹è¯•(é»˜è®¤Aè®°å½•)</span></span><br><span class="line">$ dig baidu.com @192.168.12.254</span><br><span class="line">  <span class="comment"># ;; QUESTION SECTION:</span></span><br><span class="line">  <span class="comment"># ;baidu.com.                     IN      A</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ;; ANSWER SECTION:</span></span><br><span class="line">  <span class="comment"># baidu.com.              67      IN      A       39.156.69.79</span></span><br><span class="line">  <span class="comment"># baidu.com.              67      IN      A       220.181.38.148</span></span><br><span class="line"></span><br><span class="line">$ dig qq.com @192.168.4.254</span><br><span class="line">  <span class="comment"># ;; QUESTION SECTION:</span></span><br><span class="line">  <span class="comment"># ;qq.com.                                IN      A</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ;; ANSWER SECTION:</span></span><br><span class="line">  <span class="comment"># qq.com.                 379     IN      A       61.129.7.47</span></span><br><span class="line">  <span class="comment"># qq.com.                 379     IN      A       183.3.226.35</span></span><br><span class="line">  <span class="comment"># qq.com.                 379     IN      A       123.151.137.18</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) æŒ‡å®šè®°å½•æŸ¥è¯¢</span></span><br><span class="line">dig -t MX qq.com @192.168.12.254</span><br><span class="line">  <span class="comment"># ;; QUESTION SECTION:</span></span><br><span class="line">  <span class="comment"># ;qq.com.                                IN      MX</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ;; ANSWER SECTION:</span></span><br><span class="line">  <span class="comment"># qq.com.                 3554    IN      MX      10 mx3.qq.com.</span></span><br><span class="line">  <span class="comment"># qq.com.                 3554    IN      MX      30 mx1.qq.com.</span></span><br><span class="line">  <span class="comment"># qq.com.                 3554    IN      MX      20 mx2.qq.com.</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h4 id="ä¸»ä»åŒæ­¥è®°å½•æµ‹è¯•"><a href="#ä¸»ä»åŒæ­¥è®°å½•æµ‹è¯•" class="headerlink" title="ä¸»ä»åŒæ­¥è®°å½•æµ‹è¯•"></a>ä¸»ä»åŒæ­¥è®°å½•æµ‹è¯•</h4><ul>
<li>Step 8.åœ¨DNSä¸»ä»æœåŠ¡å™¨ä¸­ä¿®æ”¹å¢åŠ å¦‚ä¸‹è®°å½•;</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1) æ·»åŠ ä¸€æ¡æ­£å‘è§£æ</span></span><br><span class="line">/var/cache/<span class="built_in">bind</span>/master<span class="comment"># cat db.weiyigeek.top</span></span><br><span class="line">202103022         ; Serial   <span class="comment"># æ·»åŠ ä¿®æ”¹è®°å½•åï¼Œåºå·æ¯æ¬¡å¿…é¡»ä¿®æ”¹è¿­ä»£æ›´æ–°+1</span></span><br><span class="line">sync.weiyigeek.top. IN A 192.168.12.110</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2) æ·»åŠ ä¸€æ¡åå‘è§£æ</span></span><br><span class="line">/var/cache/<span class="built_in">bind</span>/master<span class="comment"># cat db.12.168.192</span></span><br><span class="line">202103023         ; Serial <span class="comment"># æ·»åŠ ä¿®æ”¹è®°å½•åï¼Œåºå·æ¯æ¬¡å¿…é¡»ä¿®æ”¹è¿­ä»£æ›´æ–°+1</span></span><br><span class="line">110 IN PTR sync.weiyigeek.top.</span><br></pre></td></tr></table></figure>
<ul>
<li>Step 9.è¿›è¡ŒåŸŸåè§£æä¿®æ”¹åŒæ­¥<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0) é‡‡ç”¨åç§°æœåŠ¡å™¨æ§ä»¶å®ç”¨ç¨‹åºè¿›è¡Œé‡è½½</span></span><br><span class="line">/var/cache/<span class="built_in">bind</span>/master<span class="comment"># rndc reload</span></span><br><span class="line">server reload successful</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1) æ—¥å¿—è¾“å‡ºï¼ˆå¯ä»¥çœ‹è§åŒæ­¥æˆåŠŸï¼‰</span></span><br><span class="line">Mar 23 10:03:56 dns-server named[71110]: configuring <span class="built_in">command</span> channel from <span class="string">'/etc/bind/rndc.key'</span></span><br><span class="line">Mar 23 10:03:56 dns-server named[71110]: configuring <span class="built_in">command</span> channel from <span class="string">'/etc/bind/rndc.key'</span></span><br><span class="line">Mar 23 10:03:56 dns-server named[71110]: reloading configuration succeeded  <span class="comment"># é‡è½½é…ç½®</span></span><br><span class="line">Mar 23 10:03:56 dns-server named[71110]: reloading zones succeeded          <span class="comment"># é‡è½½æˆåŠŸ</span></span><br><span class="line">Mar 23 10:03:56 dns-server named[71110]: zone 12.168.192.in-addr.arpa/IN: loaded serial 202103023</span><br><span class="line">Mar 23 10:03:56 dns-server named[71110]: zone 12.168.192.in-addr.arpa/IN: sending notifies (serial 202103023)</span><br><span class="line">Mar 23 10:03:56 dns-server named[71110]: all zones loaded</span><br><span class="line">Mar 23 10:03:56 dns-server named[71110]: running</span><br><span class="line">Mar 23 10:03:56 dns-server named[71110]: zone weiyigeek.top/IN: loaded serial 202103022</span><br><span class="line">Mar 23 10:03:56 dns-server named[71110]: zone weiyigeek.top/IN: sending notifies (serial 202103022)</span><br><span class="line">Mar 23 10:03:57 dns-server named[71110]: client @0x7f5f08017de0 192.168.4.254<span class="comment">#39951 (weiyigeek.top): transfer of 'weiyigeek.top/IN': AXFR-style IXFR started (serial 202103022)  # ä»åŒºåŸŸåŒºåŸŸåŒæ­¥</span></span><br><span class="line">Mar 23 10:03:57 dns-server named[71110]: client @0x7f5f08017de0 192.168.4.254<span class="comment">#39951 (weiyigeek.top): transfer of 'weiyigeek.top/IN': AXFR-style IXFR ended: 1 messages, 27 records, 614 bytes, 0.001 secs (614000 bytes/sec)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3) éªŒè¯ä»ä¸»æœºè§£æ(å¯ä»¥çœ‹è§å·²ç»æˆåŠŸåŒæ­¥)</span></span><br><span class="line"><span class="comment"># æ­£å‘è§£æ</span></span><br><span class="line">~$ dig sync.weiyigeek.top @192.168.4.254</span><br><span class="line">  <span class="comment"># ;; QUESTION SECTION:</span></span><br><span class="line">  <span class="comment"># ;sync.weiyigeek.top.              IN      A</span></span><br><span class="line">  <span class="comment"># ;; ANSWER SECTION:</span></span><br><span class="line">  <span class="comment"># sync.weiyigeek.top.       86400   IN      A       192.168.12.110</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åå‘è§£æ</span></span><br><span class="line">$ host  192.168.12.110 192.168.4.254</span><br><span class="line">  <span class="comment"># Using domain server:</span></span><br><span class="line">  <span class="comment"># Name: 192.168.4.254</span></span><br><span class="line">  <span class="comment"># Address: 192.168.4.254#53</span></span><br><span class="line">  <span class="comment"># Aliases:</span></span><br><span class="line">  <span class="comment"># 110.12.168.192.in-addr.arpa domain name pointer sync.weiyigeek.top.</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h4 id="ä¸»ä»åŒæ­¥æ—¥å¿—æŸ¥çœ‹"><a href="#ä¸»ä»åŒæ­¥æ—¥å¿—æŸ¥çœ‹" class="headerlink" title="ä¸»ä»åŒæ­¥æ—¥å¿—æŸ¥çœ‹"></a>ä¸»ä»åŒæ­¥æ—¥å¿—æŸ¥çœ‹</h4><ul>
<li>Step 10.ä¸»æœº Bind ä¹‹ Named æœåŠ¡ä¿¡æ¯æ—¥å¿—æŸ¥è¯¢ä»¥åŠè®°å½•æ–‡ä»¶æŸ¥è¯¢<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) Named æœåŠ¡ä¿¡æ¯æ—¥å¿—æŸ¥è¯¢</span></span><br><span class="line">$ journalctl /usr/sbin/named -f -n 30</span><br><span class="line">  <span class="comment"># Mar 22 20:31:13 dns-server named[71110]: resolver priming query complete</span></span><br><span class="line">  <span class="comment"># Mar 22 22:02:49 dns-server named[71110]: timed out resolving 'bouncer-bouncer-elb.prod.mozaws.net/A/IN': 114.114.114.114#53</span></span><br><span class="line">  <span class="comment"># Mar 22 22:02:53 dns-server named[71110]: timed out resolving 'dn6m9t4qll5h.cloudfront.net/A/IN': 114.114.114.114#53</span></span><br><span class="line">  <span class="comment"># Mar 22 22:02:55 dns-server named[71110]: timed out resolving 'dn6m9t4qll5h.cloudfront.net/AAAA/IN': 114.114.114.114#53</span></span><br><span class="line">  <span class="comment"># Mar 23 00:14:02 dns-server named[71110]: timed out resolving 'sh.wagbridge.aliyun.aliyun.com/A/IN': 114.114.114.114#53</span></span><br><span class="line">  <span class="comment"># Mar 23 08:38:38 dns-server named[71110]: timed out resolving 'com.baidu.in-addr.arpa/PTR/IN': 114.114.114.114#53</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) å®¢æˆ·ç«¯æŸ¥è¯¢æœåŠ¡æ—¥å¿—</span></span><br><span class="line">~$ tail -f /var/cache/<span class="built_in">bind</span>/dns-query.log</span><br><span class="line">23-Mar-2021 14:05:18.038 queries: client @0x7f5f1401a560 10.20.172.103<span class="comment">#50867 (api2.firefoxchina.cn.wswebpic.com): query: api2.firefoxchina.cn.wswebpic.com IN A + (192.168.12.254)</span></span><br><span class="line">23-Mar-2021 14:05:18.038 queries: client @0x7f5f0c000cd0 10.20.172.103<span class="comment">#59303 (api2.firefoxchina.cn.wswebpic.com): query: api2.firefoxchina.cn.wswebpic.com IN AAAA + (192.168.12.254)</span></span><br><span class="line">23-Mar-2021 14:05:25.162 queries: client @0x7f5f1401a560 10.20.172.103<span class="comment">#58775 (hm.baidu.com): query: hm.baidu.com IN A + (192.168.12.254)</span></span><br><span class="line">23-Mar-2021 14:05:25.206 queries: client @0x7f5f140288a0 10.20.172.103<span class="comment">#58775 (hm.baidu.com): query: hm.baidu.com IN A + (192.168.12.254)</span></span><br><span class="line">23-Mar-2021 14:05:34.522 queries: client @0x7f5f1401a560 192.168.12.107<span class="comment">#48054 (changelogs.ubuntu.com.weiyigeek.top): query: changelogs.ubuntu.com IN A + (192.168.12.254)</span></span><br><span class="line">23-Mar-2021 14:05:34.522 queries: client @0x7f5f140288a0 192.168.12.107<span class="comment">#48054 (changelogs.ubuntu.com.weiyigeek.top): query: changelogs.ubuntu.com IN AAAA + (192.168.12.254)</span></span><br><span class="line">23-Mar-2021 14:05:34.522 queries: client @0x7f5f18036ab0 192.168.12.107<span class="comment">#41833 (changelogs.ubuntu.com.weiyigeek.cn): query: changelogs.ubuntu.com IN A + (192.168.12.254)</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h3 id="2-ä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡å®‰å…¨é…ç½®"><a href="#2-ä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡å®‰å…¨é…ç½®" class="headerlink" title="2) ä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡å®‰å…¨é…ç½®"></a>2) ä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡å®‰å…¨é…ç½®</h3><p>æè¿°: åœ¨å‰ä¸€ç« æˆ‘ä»¬è®²è§£DNSä¸»ä»çš„åŸºæœ¬é…ç½®ä»¥åŠè®¿é—®é™åˆ¶ï¼Œä½†æ˜¯å¯¹äºåœ¨ä¼ä¸šä¸­å®é™…è¿è¡Œæˆ‘ä»¬éœ€è¦è€ƒè™‘åˆ°æ–¹æ–¹é¢é¢çš„é—®é¢˜ï¼Œä¾‹å¦‚ä¼ªé€ MACåœ°å€ä»¥åŠIPåœ°å€ï¼Œæ­¤æ—¶å®ƒå°±å¯ä»¥é€šè¿‡åŒºåŸŸä¼ è¾“è·å–å†…éƒ¨åŸŸåçš„å¯¹åº”æœåŠ¡å™¨åœ°å€ï¼Œä¸ºäº†é˜²æ­¢æ­¤ç§å®‰å…¨é—®é¢˜çš„å‘ç”Ÿæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ <code>TSIG (Transaction SIGnatures)</code> è¿›è¡Œäº‹åŠ¡ç­¾ååŠ å¯†zoneåŒæ­¥ä¿¡æ¯æˆ–è€…é‡‡ç”¨ DNSSEC æ‰©å±•å¯¹DNS ä¿¡æ¯çš„åŠ å¯†è®¤è¯ã€‚</p>
<p><br/></p>
<p><strong>Q: ä»€ä¹ˆæ˜¯TSIG (Transaction SIGnatures)?</strong></p>
<blockquote>
<p>ç­”: TSIGï¼ˆäº¤æ˜“ç½‘æ ¼ï¼‰æ˜¯ä¸€ç§èº«ä»½éªŒè¯DNSæ¶ˆæ¯çš„æœºåˆ¶ï¼Œæœ€åˆåœ¨RFC 2845ä¸­æŒ‡å®š<br>ä½œç”¨: å®ƒå…è®¸ä½¿ç”¨å…±äº«çš„ç§˜å¯†åŠ å¯†åœ°ç­¾å DNS æ¶ˆæ¯ã€‚TSIG å¯ç”¨äºä»»ä½• DNS äº‹åŠ¡ï¼Œ</p>
</blockquote>
<p><br/></p>
<p><strong>Tips : TSIG çš„åº”ç”¨åœºæ™¯è¯´æ˜</strong></p>
<blockquote>
<p>ä¾‹å¦‚ï¼Œå½“åŸºäº IP çš„è®¿é—®æ§åˆ¶ä¸è¶³æˆ–éœ€è¦è¢«è¦†ç›–æ—¶ï¼Œå°†æŸäº›æœåŠ¡å™¨åŠŸèƒ½ï¼ˆä¾‹å¦‚é€’å½’æŸ¥è¯¢ï¼‰çš„è®¿é—®é™åˆ¶ç»™æˆæƒå®¢æˆ·ç«¯ï¼Œæˆ–åœ¨å¯¹æœåŠ¡å™¨å®Œæ•´æ€§è‡³å…³é‡è¦æ—¶ç¡®ä¿æ¶ˆæ¯çš„çœŸå®æ€§<br>ä¾‹å¦‚ï¼ŒåŠ¨æ€ UPDATE æ¶ˆæ¯æˆ–ä»ä¸»æœåŠ¡å™¨ä¼ è¾“åˆ°æ¬¡è¦æœåŠ¡å™¨çš„åŒºåŸŸä¼ è¾“ã€‚</p>
</blockquote>
<p><br/></p>
<p><strong>Tips : è¡¥å……ä»‹ç»AXFRä¸IXFRä»‹ç»</strong></p>
<ul>
<li>AXFR (å…¨é‡åŒºåŸŸçš„æ•°æ®ä¼ è¾“)  : <a href="https://tools.ietf.org/html/rfc5936.html" target="_blank" rel="noopener">RFC 5936</a> - E. Lewis and A. Hoenes, Ed. DNS Zone Transfer Protocol (AXFR). June 2010. è¯¥æ ‡å‡†æŒ‡çš„æ˜¯åŸŸåç³»ç»Ÿåè®®å†…çš„ç»´æŠ¤åŒºåŸŸçš„æƒå¨åç§°æœåŠ¡å™¨ä¹‹é—´çš„ä¸€è‡´æ€§;</li>
<li>IXFR (å¢é‡åŒºåŸŸçš„æ•°æ®ä¼ è¾“) : <a href="https://tools.ietf.org/html/rfc1995.html" target="_blank" rel="noopener">RFC 1995</a> - E. M. Ohta and RTokyo Institute of Technology August 1996 - å¢é‡åŒºåŸŸä¼ è¾“(IXFR)åè®®æ˜¯è¾…åŠ©æœåŠ¡å™¨åªä¼ è¾“æ›´æ”¹çš„æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œè€Œä¸å¿…ä¼ è¾“æ•´ä¸ªåŒºåŸŸ</li>
</ul>
<p><br/></p>
<h4 id="1-åˆ›å»º-TSIG-å¯†é’¥çš„è¿‡ç¨‹"><a href="#1-åˆ›å»º-TSIG-å¯†é’¥çš„è¿‡ç¨‹" class="headerlink" title="1.åˆ›å»º TSIG å¯†é’¥çš„è¿‡ç¨‹"></a>1.åˆ›å»º TSIG å¯†é’¥çš„è¿‡ç¨‹</h4><ul>
<li><p>Step 1.TSIG å¯†é’¥ç”Ÿæˆå…³é”®æ˜¯tsig-key : <code>hmac-md5, hmac-sha1, hmac-sha224, hmac-sha256, hmac-sha384, and hmac-sha512. The default is hmac-sha256</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Tips:ä»»ä½•æœ‰æ•ˆçš„DNSåç§°å­—ç¬¦ä¸²éƒ½å¯ä»¥ç”¨ä½œå¯†é’¥åã€‚</span></span><br><span class="line">$ tsig-keygen -a hmac-sha256 dns-server-keygen. &gt; dns-sync-keygen.key</span><br><span class="line">$ chown -R <span class="built_in">bind</span>:<span class="built_in">bind</span> dns-sync-keygen.key</span><br></pre></td></tr></table></figure>
</li>
<li><p>Step 2.å°†ä¸‹è¿°æœåŠ¡å™¨ä¹‹é—´å…±äº«çš„å¯†é’¥ï¼Œå†…å®¹æ·»åŠ åˆ°æ¯ä¸ªæœåŠ¡å™¨çš„ named.conf æ–‡ä»¶ä¸­;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Tips: æŸ¥çœ‹ç”Ÿæˆçš„ç­¾åå®‰å…¨æ–‡æœ¬ä¿¡æ¯</span></span><br><span class="line">$ more dns-sync-keygen.key</span><br><span class="line">key <span class="string">"dns-server-keygen."</span> &#123;</span><br><span class="line">    algorithm hmac-sha256;</span><br><span class="line">    secret <span class="string">"04Zy1z+VSu1FlHMMFte8SVJ+RlUbR4qK/GgletRso="</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾‹å¦‚: æ–¹å¼1åœ¨named.confä¸­è®¾ç½®åœ¨å¼€å¤´ä¹‹ä¸­</span></span><br><span class="line"><span class="comment"># ä¾‹å¦‚: æ–¹å¼2åœ¨named.confä¸­ä½¿ç”¨includeæŒ‡ä»¤åŒ…å«ï¼›</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Step 3.æŒ‡ç¤ºæœåŠ¡å™¨ä½¿ç”¨å¯†é’¥å’ŒTSIG-Basedè®¿é—®æ§åˆ¶(<code>å¦‚allow-query, allow-transfer, and allow-update</code>)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å¯†é’¥ä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨æŒ‡ä»¤ä¸­æŒ‡å®šã€‚</span></span><br><span class="line"><span class="comment"># å¦‚æœhost2çš„IPåœ°å€ä¸º10.1.2.3ï¼Œåœ¨host1ä¸Šæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œå°†å¯¼è‡´ä»host1åˆ°host2çš„æ‰€æœ‰è¯·æ±‚ï¼ŒåŒ…æ‹¬æ­£å¸¸çš„DNSæŸ¥è¯¢ï¼Œéƒ½å°†ä½¿ç”¨host1-host2ç­¾å</span></span><br><span class="line">server 10.1.2.3 &#123;</span><br><span class="line">  keys &#123; host1-host2. ;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.TSIGé”®å¯ä»¥åœ¨ACLå®šä¹‰å’ŒACLæŒ‡ä»¤(å¦‚allow-query, allow-transfer, and allow-update)ä¸­æŒ‡å®šã€‚</span></span><br><span class="line"><span class="comment"># ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨TSIGé”®çš„allow-updateæŒ‡ä»¤çš„ä¾‹å­: åªæœ‰å½“æ›´æ–°è¯·æ±‚æ¥è‡ª localnet ä¸­çš„æŸä¸ªåœ°å€ï¼Œå¹¶ä¸”ä½¿ç”¨host1-host2 è¿›è¡Œç­¾åæ—¶ï¼ŒåŠ¨æ€æ›´æ–°æ‰èƒ½æˆåŠŸã€‚</span></span><br><span class="line">allow-update &#123; !&#123; !localnets; any; &#125;; key host1-host2. ;&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h4 id="2-Master-DNS-æœºå™¨é…ç½®"><a href="#2-Master-DNS-æœºå™¨é…ç½®" class="headerlink" title="2.Master DNS æœºå™¨é…ç½®"></a>2.Master DNS æœºå™¨é…ç½®</h4><ul>
<li>Step 4.æŒ‰ç…§å‰é¢ç¬¬ä¸€ç« çš„é…ç½®åŸºç¡€ä¸Šè¿›è¡Œï¼Œå¦‚ä¸‹ç¤ºä¾‹<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (0) å°† dns-sync-keygen.key æ–‡ä»¶åˆ†åˆ«ä¸Šä¼ åˆ°ä¸¤å°SlaveæœåŠ¡å™¨ä¹‹ä¸­;</span></span><br><span class="line">scp dns-sync-keygen.key root@192.168.4.254:/etc/<span class="built_in">bind</span>/</span><br><span class="line">scp dns-sync-keygen.key root@192.168.10.254:/etc/<span class="built_in">bind</span>/</span><br><span class="line"></span><br><span class="line"><span class="comment"># (1) ä¿®æ”¹ åœ¨ (Master /slave) DNS ä¸»æœºé…ç½® named.conf å¼•å…¥ä¸Šé¢åˆ›å»ºçš„ tsig Keys</span></span><br><span class="line">$ vim named.conf</span><br><span class="line">include <span class="string">"/etc/bind/dns-sync-keygen.key"</span>;</span><br><span class="line">include <span class="string">"/etc/bind/named.conf.options"</span>;</span><br><span class="line">include <span class="string">"/etc/bind/named.conf.local"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) åœ¨ /etc/bind/named.conf.options é…ç½®ä¸­æ·»åŠ ä»æœåŠ¡å™¨çš„å¯†é’¥è®¤è¯</span></span><br><span class="line">server 192.168.10.254 &#123;</span><br><span class="line">  keys &#123; <span class="string">"dns-server-keygen."</span>; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">server 192.168.4.254 &#123;</span><br><span class="line">  keys &#123; <span class="string">"dns-server-keygen."</span>; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) Master DNS ä¸»æœº named.conf.local åŸŸä¼ è¾“</span></span><br><span class="line">$ /etc/<span class="built_in">bind</span>/named.conf.local</span><br><span class="line">zone <span class="string">"weiyigeek.cn"</span> &#123;</span><br><span class="line">    <span class="built_in">type</span> master;</span><br><span class="line">    file <span class="string">"master/db.weiyigeek.cn"</span>;</span><br><span class="line">    notify yes;</span><br><span class="line">    allow-transfer &#123; trusted; key dns-server-keygen. ; &#125;;    <span class="comment"># ns2 / ns3 private IP address - secondary</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">"weiyigeek.top"</span> &#123;</span><br><span class="line">    <span class="built_in">type</span> master;</span><br><span class="line">    file <span class="string">"master/db.weiyigeek.top"</span>;</span><br><span class="line">    notify yes;</span><br><span class="line">    allow-transfer &#123; trusted;  key dns-server-keygen. ; &#125;;    <span class="comment"># ns2 / ns3  private IP address - secondary</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">"168.192.in-addr.arpa"</span> &#123;</span><br><span class="line">    <span class="built_in">type</span> master;</span><br><span class="line">    file <span class="string">"master/db.168.192"</span>;</span><br><span class="line">    notify yes;</span><br><span class="line">    allow-transfer &#123; trusted;  key dns-server-keygen. ; &#125;;    <span class="comment"># ns2 / ns3  private IP address - secondary</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">"12.168.192.in-addr.arpa"</span> &#123;</span><br><span class="line">    <span class="built_in">type</span> master;</span><br><span class="line">    file <span class="string">"master/db.12.168.192"</span>;</span><br><span class="line">    notify yes;</span><br><span class="line">    allow-transfer &#123; trusted;  key dns-server-keygen. ; &#125;;    <span class="comment"># ns2 / ns3  private IP address - secondary</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h4 id="3-Slave-DNS-æœºå™¨é…ç½®"><a href="#3-Slave-DNS-æœºå™¨é…ç½®" class="headerlink" title="3.Slave DNS æœºå™¨é…ç½®"></a>3.Slave DNS æœºå™¨é…ç½®</h4><ul>
<li>Step 5.Slave ä»DNSæœåŠ¡åŸºç¡€é…ç½®ï¼Œå¦‚æœæ­¤æ—¶slaveæœåŠ¡å™¨æ²¡æœ‰é…ç½®keyåˆ™ä¸»ä»ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (3) ä¿®æ”¹ä¸¤å°slaveæœåŠ¡å™¨named.conf.conf.optionså’Œdns-sync-keygen.keyæƒé™ä»¥åŠæ‰€å±è€…ä¿®æ”¹</span></span><br><span class="line">$ vim named.conf.conf.options <span class="comment"># ä¸å»ºè®®æ­¤ç§æ–¹å¼</span></span><br><span class="line">....</span><br><span class="line">key <span class="string">"dns-server-keygen."</span> &#123;</span><br><span class="line">  algorithm hmac-sha256;</span><br><span class="line">  secret <span class="string">"04Zy1z+VSu2X1FlHMMFte8SVJ+RlUbR4qK/GgletRso="</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">server 192.168.4.254 &#123;</span><br><span class="line">  keys &#123; <span class="string">"dns-server-keygen."</span>; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">....</span><br><span class="line">chown -R <span class="built_in">bind</span>:<span class="built_in">bind</span> /etc/<span class="built_in">bind</span>/dns-sync-keygen.key</span><br></pre></td></tr></table></figure>
<p>Tips : å¦‚æœæ­¤æ—¶ Slave æœåŠ¡å™¨ æ²¡æœ‰è®¾ç½® TSIG å¯†é’¥åˆ° named.conf é…ç½®æ–‡ä»¶ä¸­, åˆ™å‡ºç°ä»¥ä¸‹é”™è¯¯ <code>client @0x7f6008000cd0 192.168.12.254#59492: request has   invalid signature: TSIG dns-server-keygen: tsig verify failure (BADKEY)</code></p>
<figure class="image-box">
                <a rel=ä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡æ­å»ºä¸å®‰å…¨é…ç½®å®è·µ href="https://img.weiyigeek.top/2021/1/20210324140133.png" target="_blank" title="WeiyiGeek.Slave-Noconfig-TSIG" data-fancybox="images"><img src="https://img.weiyigeek.top/2021/1/20210324140133.png" alt="WeiyiGeek.Slave-Noconfig-TSIG" title="" class=""></a>
                <p>WeiyiGeek.Slave-Noconfig-TSIG</p>
            </figure>
<p><br></p>
<h4 id="4-TSIGå¯†é’¥å·¥ä½œéªŒè¯"><a href="#4-TSIGå¯†é’¥å·¥ä½œéªŒè¯" class="headerlink" title="4.TSIGå¯†é’¥å·¥ä½œéªŒè¯"></a>4.TSIGå¯†é’¥å·¥ä½œéªŒè¯</h4><p><strong>Tips : DNSå®¢æˆ·ç«¯å·¥å…·æ ¡éªŒTSIGäº‹ç‰©ç­¾å:</strong></p>
<ul>
<li>nsupdate - dynamic DNS update utility supports TSIG via the -k, -l, and -y command-line options, or via the key command when running interactively.</li>
<li>dig - DNS lookup utility supports TSIG via the -k and -y command-line options.</li>
</ul>
<ul>
<li>Step 5.æµ‹è¯•TSIGå¯†é’¥å·¥ä½œæƒ…å†µ<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ä½¿ç”¨å‘½ä»¤ rndc tsig-list åˆ—å‡ºæœåŠ¡å™¨å·²çŸ¥çš„TSIGå¯†é’¥(ä¸»ä»)ã€‚</span></span><br><span class="line">root@dns-server:~$ rndc tsig-list</span><br><span class="line">view <span class="string">"_default"</span>; <span class="built_in">type</span> <span class="string">"static"</span>; key <span class="string">"dns-server-keygen"</span>;</span><br><span class="line">view <span class="string">"_default"</span>; <span class="built_in">type</span> <span class="string">"static"</span>; key <span class="string">"local-ddns"</span>;</span><br><span class="line">view <span class="string">"_bind"</span>; <span class="built_in">type</span> <span class="string">"static"</span>; key <span class="string">"dns-server-keygen"</span>;</span><br><span class="line">view <span class="string">"_bind"</span>; <span class="built_in">type</span> <span class="string">"static"</span>; key <span class="string">"local-ddns"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.åœ¨Masterä¸­ä¿®æ”¹ä¸€æ¡è®°å½•å¹¶ä¿®æ”¹Serialåºåˆ—å·;</span></span><br><span class="line">vi /var/cache/<span class="built_in">bind</span>/master/db.weiyigeek.top</span><br><span class="line">202103027         ; Serial</span><br><span class="line">...</span><br><span class="line">sync.weiyigeek.top. IN A 192.168.12.212</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.åœ¨Masterä¸»æœºä¸­é‡æ–°åŠ è½½zoneå¹¶åŒæ­¥åˆ°ä»Slaveä¸»æœºä¹‹ä¸­</span></span><br><span class="line">root@dns-server:/etc/<span class="built_in">bind</span><span class="comment"># rndc reload</span></span><br><span class="line">server reload successful</span><br><span class="line"></span><br><span class="line">root@dns-serverï¼š/etc/<span class="built_in">bind</span><span class="comment"># journalctl /usr/sbin/named -f</span></span><br><span class="line">  <span class="comment"># -- Logs begin at Wed 2019-09-04 17:30:00 CST. --</span></span><br><span class="line">  <span class="comment"># Mar 24 14:11:41 dns-server named[146141]: configuring command channel from '/etc/bind/rndc.key'</span></span><br><span class="line">  <span class="comment"># Mar 24 14:11:41 dns-server named[146141]: configuring command channel from '/etc/bind/rndc.key'</span></span><br><span class="line">  <span class="comment"># Mar 24 14:11:41 dns-server named[146141]: reloading configuration succeeded</span></span><br><span class="line">  <span class="comment"># Mar 24 14:11:41 dns-server named[146141]: reloading zones succeeded</span></span><br><span class="line">  <span class="comment"># Mar 24 14:11:41 dns-server named[146141]: zone weiyigeek.top/IN: loaded serial 202103027</span></span><br><span class="line">  <span class="comment"># Mar 24 14:11:41 dns-server named[146141]: zone weiyigeek.top/IN: sending notifies (serial 202103027)</span></span><br><span class="line">  <span class="comment"># Mar 24 14:11:41 dns-server named[146141]: all zones loaded</span></span><br><span class="line">  <span class="comment"># Mar 24 14:11:41 dns-server named[146141]: running</span></span><br><span class="line">  <span class="comment"># Mar 24 14:11:42 dns-server named[146141]: client @0x7fac2804b930 192.168.4.254#35827 (weiyigeek.top): transfer of 'weiyigeek.top/IN': AXFR-style IXFR started (serial 202103027) # åŒæ­¥å¼€å§‹</span></span><br><span class="line">  <span class="comment"># Mar 24 14:11:42 dns-server named[146141]: client @0x7fac2804b930 192.168.4.254#35827 (weiyigeek.top): transfer of 'weiyigeek.top/IN': AXFR-style IXFR ended: 1 messages, 27 records, 614 bytes, 0.001 secs (614000 bytes/sec)  # åŒæ­¥è®°å½•è¯¦ç»†æƒ…å†µ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.ä»ä¸»æœºçš„æ—¥å¿—æŸ¥çœ‹</span></span><br><span class="line">weiyigeek@dns-slave-ns3:~$ journalctl /usr/sbin/named  -f -n 30</span><br><span class="line">  Mar 24 14:11:42 dns-slave-ns3 named[114382]: client @0x7fcce8000cd0 192.168.12.254<span class="comment">#33530/key dns-server-keygen: received notify for zone 'weiyigeek.top': TSIG 'dns-server-keygen'  # å¯ä»¥çœ‹è§å·²ç»ä½¿ç”¨äº†å‰ç­¾å</span></span><br><span class="line">  Mar 24 14:11:42 dns-slave-ns3 named[114382]: zone weiyigeek.top/IN: notify from 192.168.12.254<span class="comment">#33530: serial 202103027</span></span><br><span class="line">  Mar 24 14:11:42 dns-slave-ns3 named[114382]: zone weiyigeek.top/IN: Transfer started.   <span class="comment"># ä¼ è¾“å¼€å§‹</span></span><br><span class="line">  Mar 24 14:11:42 dns-slave-ns3 named[114382]: transfer of <span class="string">'weiyigeek.top/IN'</span> from 192.168.12.254<span class="comment">#53: connected using 192.168.4.254#35827</span></span><br><span class="line">  Mar 24 14:11:42 dns-slave-ns3 named[114382]: zone weiyigeek.top/IN: transferred serial 202103027  </span><br><span class="line">  Mar 24 14:11:42 dns-slave-ns3 named[114382]: transfer of <span class="string">'weiyigeek.top/IN'</span> from 192.168.12.254<span class="comment">#53: Transfer status: success # ä¼ è¾“æˆåŠŸ</span></span><br><span class="line">  Mar 24 14:11:42 dns-slave-ns3 named[114382]: transfer of <span class="string">'weiyigeek.top/IN'</span> from 192.168.12.254<span class="comment">#53: Transfer completed: 1 messages, 27 records, 614 bytes, 0.001 secs (614000 bytes/sec)  # è®°å½•åŒæ­¥è¯¦ç»†</span></span><br><span class="line">  Mar 24 14:11:42 dns-slave-ns3 named[114382]: zone weiyigeek.top/IN: sending notifies (serial 202103027)  <span class="comment"># å‘é€åŒæ­¥çŠ¶æ€</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>Step 6.æµ‹è¯•Slaveä¸»æœºçš„è§£ææƒ…å†µ(å¯ä»¥çœ‹è§å·²ç»åŒæ­¥æˆåŠŸ)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\WeiyiGeek&gt;nslookup -qt=a sync.weiyigeek.top 192.168.4.254</span><br><span class="line">æœåŠ¡å™¨:  ns3.weiyigeek.cn</span><br><span class="line">Address:  192.168.4.254</span><br><span class="line"></span><br><span class="line">åç§°:    sync.weiyigeek.top</span><br><span class="line">Address:  192.168.12.212</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Tips : å½“ä»»ä½•æœåŠ¡å™¨å‘é€ç”± TSIG ç­¾åçš„ DNS è¯·æ±‚æ—¶ï¼Œå®ƒå¸Œæœ›ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ç­¾ç½²å“åº”ã€‚å¦‚æœæœªç­¾ç½²å›å¤ï¼Œæˆ–è€…ç­¾åæ— æ•ˆï¼Œåˆ™æ‹’ç»å›å¤ã€‚</p>
<p><br/></p>
<p><strong>Tips : å¤„ç† TSIG ç­¾åçš„æ¶ˆæ¯å¯èƒ½ä¼šå¯¼è‡´å‡ ä¸ªé”™è¯¯</strong></p>
<ul>
<li>æè¿°: åœ¨ä¸Šè¿°æ‰€æœ‰æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨è¿”å› NOTAUTH å“åº”ä»£ç ï¼ˆæœªç»è¿‡èº«ä»½éªŒè¯ï¼‰ã€‚</li>
<li>å¦‚æœäº†è§£ TSIG çš„æœåŠ¡å™¨æ”¶åˆ°ç”±æœªçŸ¥å¯†é’¥ç­¾åçš„æ¶ˆæ¯ï¼Œåˆ™å“åº”å°†æœªç­¾åï¼ŒTSIG å°†æ‰©å±•é”™è¯¯ä»£ç è®¾ç½®ä¸º BADKEYã€‚</li>
<li>å¦‚æœäº†è§£ TSIG çš„æœåŠ¡å™¨æ”¶åˆ°æ¥è‡ªå·²çŸ¥å¯†é’¥ä½†ç­¾åæ— æ•ˆçš„æ¶ˆæ¯ï¼Œåˆ™å“åº”å°†æœªç­¾åï¼ŒTSIG å°†æ‰©å±•é”™è¯¯ä»£ç è®¾ç½®ä¸º BADSIGã€‚</li>
<li>å¦‚æœäº†è§£ TSIG çš„æœåŠ¡å™¨æ”¶åˆ°è¶…å‡ºå…è®¸èŒƒå›´çš„æ—¶é—´çš„é‚®ä»¶ï¼Œåˆ™å°†ç­¾ç½²å“åº”ï¼Œä½† TSIG å°†é”™è¯¯ä»£ç è®¾ç½®ä¸º BADTIMEï¼Œå¹¶å°†è°ƒæ•´æ—¶é—´å€¼ï¼Œä»¥ä¾¿æˆåŠŸéªŒè¯å“åº”ã€‚</li>
</ul>
<hr>
<h2 id="0x01-ç« å¤–æ‰©å±•"><a href="#0x01-ç« å¤–æ‰©å±•" class="headerlink" title="0x01 ç« å¤–æ‰©å±•"></a>0x01 ç« å¤–æ‰©å±•</h2><h3 id="0-OSç³»ç»Ÿä¸Šçš„DNSè§£æå™¨"><a href="#0-OSç³»ç»Ÿä¸Šçš„DNSè§£æå™¨" class="headerlink" title="0) OSç³»ç»Ÿä¸Šçš„DNSè§£æå™¨"></a>0) OSç³»ç»Ÿä¸Šçš„DNSè§£æå™¨</h3><p>æè¿°: åº”ç”¨ç¨‹åºå®é™…ä¸Šéƒ½æ˜¯è°ƒç”¨çš„æ“ä½œç³»ç»Ÿçš„ <code>DNS Resolver</code> è¿›è¡ŒåŸŸåè§£æçš„ã€‚åœ¨ Linux ä¸­ DNS Resolver ç”± <code>glibc/musl</code> æä¾›å…¶é…ç½®æ–‡ä»¶ä¸º <code>/etc/resolv.conf</code>ã€‚</p>
<p>Tips : æ¯”å¦‚ Python çš„ DNS è§£æï¼Œå°±æ¥è‡ªäºæ ‡å‡†åº“çš„ socket åŒ…ï¼Œè¿™ä¸ªåŒ…åªæ˜¯å¯¹åº•å±‚ c è¯­è¨€åº“çš„ä¸€ä¸ªç®€å•å°è£…ã€‚</p>
<p>æ“ä½œç³»ç»Ÿè§£æåŸŸåçš„ä¸‰ç§æ–¹å¼:</p>
<ul>
<li>1.hosts æ–‡ä»¶</li>
<li>2.HTTPDNS </li>
<li>3.é»˜è®¤ DNS æœåŠ¡å™¨</li>
</ul>
<p><strong>hosts æ–‡ä»¶</strong><br>æè¿°: æ“ä½œç³»ç»Ÿä¸­è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šæ–‡ä»¶Linux ä¸­çš„ <code>/etc/hosts</code> å’Œ Windows ä¸­çš„ <code>C:\Windows\System32\drivers\etc\hosts</code> å­˜æ”¾ç€ç”¨æˆ·è‡ªå®šä¹‰çš„åŸŸå(æˆ–ä¸»æœºå)ä¸IPåœ°å€å¯¹äºå…³ç³»ã€‚å…¶ä¼˜å…ˆçº§æœ€é«˜ç³»ç»Ÿä¸­çš„ DNS resolver ä¼šé¦–å…ˆæŸ¥çœ‹è¿™ä¸ª hosts æ–‡ä»¶ä¸­æœ‰æ²¡æœ‰è¯¥åŸŸåçš„è®°å½•ï¼Œå¦‚æœæœ‰å°±ç›´æ¥è¿”å›äº†ã€‚æ²¡æ‰¾åˆ°æ‰ä¼šå»æŸ¥æ‰¾æœ¬åœ° DNS ç¼“å­˜ã€åˆ«çš„ DNS æœåŠ¡å™¨ã€‚</p>
<p>Tips : åªæœ‰éƒ¨åˆ†ä¸“é—¨ç”¨äºç½‘ç»œè¯Šæ–­çš„åº”ç”¨ç¨‹åºï¼ˆe.g. digï¼‰ä¸ä¼šä¾èµ– OS çš„ DNS è§£æå™¨ï¼Œå› æ­¤è¿™ä¸ª hosts ä¼šå¤±æ•ˆã€‚hosts å¯¹äºç»å¤§éƒ¨åˆ†ç¨‹åºéƒ½æœ‰æ•ˆã€‚</p>
<p>Tips : ç§»åŠ¨è®¾å¤‡ä¸Š hosts å¯èƒ½ä¼šå¤±æ•ˆï¼Œéƒ¨åˆ† app ä¼šç»•è¿‡ç³»ç»Ÿï¼Œä½¿ç”¨æ–°å…´çš„ HTTPDNS åè®®è¿›è¡Œ DNS è§£æã€‚</p>
<p><br></p>
<p><strong>HTTPDNS</strong><br>æè¿°: ç”±äºä¼ ç»Ÿçš„ DNS åè®®å› ä¸ºä½¿ç”¨äº†æ˜æ–‡çš„ UDP åè®®ï¼Œå¾ˆå®¹æ˜“è¢«åŠ«æŒã€‚é¡ºåº”ç§»åŠ¨äº’è”ç½‘çš„å…´èµ·ï¼Œç›®å‰ä¸€ç§æ–°å‹çš„ DNS åè®®â€”â€”HTTPDNS åº”ç”¨è¶Šæ¥è¶Šå¹¿æ³›ï¼Œå›½å†…çš„é˜¿é‡Œäº‘è…¾è®¯äº‘éƒ½æä¾›äº†è¿™é¡¹åŠŸèƒ½ã€‚</p>
<p>Tips : HTTPDNS é€šè¿‡ HTTP åè®®ç›´æ¥å‘æƒå¨ DNS æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œç»•è¿‡äº†ä¸€å †ä¸­é—´çš„ DNS é€’å½’è§£æå™¨ã€‚<br>Tips : HTTPDNS åè®®éœ€è¦ç¨‹åºè‡ªå·±å¼•å…¥ SDKï¼Œæˆ–è€…ç›´æ¥è¯·æ±‚ HTTP APIã€‚</p>
<p>ä½¿ç”¨HTTPDNSçš„å¥½å¤„ï¼š</p>
<ul>
<li>æƒå¨ DNS æœåŠ¡å™¨èƒ½ç›´æ¥è·å–åˆ°å®¢æˆ·ç«¯çš„çœŸå® IPï¼ˆè€Œä¸æ˜¯æŸä¸ªä¸­é—´ DNS é€’å½’è§£æå™¨çš„ IPï¼‰ï¼Œèƒ½å®ç°å°±è¿‘è°ƒåº¦(æœ‰ç‚¹ç±»ä¼¼äºCDNçš„æ„Ÿè§‰)ã€‚</li>
<li>å› ä¸ºæ˜¯ç›´æ¥ä¸æƒå¨ DNS æœåŠ¡å™¨è¿æ¥ï¼Œé¿å…äº† DNS ç¼“å­˜æ±¡æŸ“çš„é—®é¢˜ã€‚</li>
</ul>
<p><br></p>
<p><strong>é»˜è®¤ DNS æœåŠ¡å™¨</strong><br>æè¿°: æ“ä½œç³»ç»Ÿçš„ DNS è§£æå™¨é€šå¸¸ä¼šå…è®¸æˆ‘ä»¬é…ç½®<code>1-3ä¸ªä¸Šæ¸¸ NameServers</code>ï¼ŒDNS æŸ¥è¯¢ä¼šæŒ‰é…ç½®ä¸­çš„é¡ºåºé€‰ç”¨ DNS æœåŠ¡å™¨ã€‚<br>æ¯”å¦‚ Linux å°±æ˜¯é€šè¿‡ /etc/resolv.conf é…ç½® DNS æœåŠ¡å™¨çš„ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/resolv.conf </span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">nameserver 8.8.4.4</span><br><span class="line">search lan  <span class="comment"># DNS æœç´¢åŸŸ</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Q: ä»€ä¹ˆæ˜¯DNSæœç´¢åŸŸ?</strong></p>
<blockquote>
<p>ç­”: è®²åˆ° DNS æœç´¢åŸŸéœ€è¦å¤ä¹ ä¸€å“ˆå…¨é™å®šåŸŸåï¼ˆFull Qulified Domain Name, FQDNï¼‰ï¼Œå³ä¸€ä¸ªåŸŸåçš„å®Œæ•´åç§°ï¼Œ<code>www.baidu.com</code></p>
</blockquote>
<ul>
<li>1) <code>www.baidu.com.</code>: æœ«å°¾çš„ . è¡¨ç¤ºæ ¹åŸŸï¼Œè¯´æ˜ <a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a> æ˜¯ä¸€ä¸ª FQDNï¼Œå› æ­¤ä¸ä¼šä½¿ç”¨æœç´¢åŸŸï¼</li>
<li>2) <code>www.baidu.com</code>: æœ«å°¾æ²¡ .ï¼Œä½†æ˜¯åŸŸååŒ…å«ä¸æ­¢ä¸€ä¸ª .ã€‚é¦–å…ˆå½“ä½œ FQDN è¿›è¡ŒæŸ¥è¯¢æ²¡æŸ¥æ‰¾å†æŒ‰é¡ºåºåœ¨å„æœç´¢åŸŸä¸­æŸ¥è¯¢ã€‚<ul>
<li>/etc/resolv.conf çš„ options å‚æ•°ä¸­ï¼Œå¯ä»¥æŒ‡å®šåŸŸåä¸­åŒ…å«<code>.</code>çš„ä¸´ç•Œä¸ªæ•°ï¼Œé»˜è®¤æ˜¯ 1.</li>
</ul>
</li>
<li>3) local: ä¸åŒ…å« .ï¼Œè¢«å½“ä½œ host åç§°é FQDNã€‚é¦–å…ˆåœ¨ /etc/hosts ä¸­æŸ¥æ‰¾ï¼Œæ²¡æ‰¾åˆ°çš„è¯å†æŒ‰é¡ºåºåœ¨å„æœç´¢åŸŸä¸­æŸ¥æ‰¾ã€‚</li>
</ul>
<p>å°±å¦‚ä¸Šé¢è¯´ä¾‹ä¸¾çš„ï¼Œåœ¨æ²¡æœ‰ DNS æœç´¢åŸŸ è¿™ä¸ªä¸œè¥¿çš„æ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬è®¿é—®ä»»ä½•åŸŸåï¼Œéƒ½å¿…é¡»è¾“å…¥ä¸€ä¸ªå…¨é™å®šåŸŸå FQDNã€‚<br>æœ‰äº†æœç´¢åŸŸæˆ‘ä»¬å°±å¯ä»¥ç¨å¾®å·ç‚¹æ‡’ï¼Œçœç•¥æ‰åŸŸåçš„ä¸€éƒ¨åˆ†åç¼€ï¼Œè®© DNS Resolver è‡ªå·±å»åœ¨å„æœç´¢åŸŸä¸­æœç´¢ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0) è·å–k8sçš„kube-dns</span></span><br><span class="line">~$ kubectl get svc -n kube-system</span><br><span class="line">NAME       TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)                  AGE</span><br><span class="line">kube-dns   ClusterIP   10.96.0.10   &lt;none&gt;        53/UDP,53/TCP,9153/TCP   68d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1) ä¾‹å¦‚ æˆ‘ä»¬è®¾ç½® /etc/resolv.conf å¦‚ä¸‹</span></span><br><span class="line"><span class="comment"># nameserver 192.168.12.254</span></span><br><span class="line"><span class="comment"># search weiyigeek.top weiyigeek.cn</span></span><br><span class="line">nameserver 10.96.0.10</span><br><span class="line">search default.svc.cluster.local svc.cluster.local cluster.local</span><br><span class="line"><span class="comment"># ndots:5 æ˜¯æŒ‡å°‘äº 5 ä¸ª dots çš„åŸŸåï¼Œéƒ½é¦–å…ˆå½“ä½œé FQDN çœ‹å¾…ä¼˜å…ˆåœ¨æœç´¢åŸŸé‡Œé¢æŸ¥æ‰¾;</span></span><br><span class="line">options ndots:5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2) è¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„åŸŸåæŸ¥çœ‹å°è¯•è¿‡ç¨‹</span></span><br><span class="line">~$ host -v weiyigeek</span><br><span class="line">  <span class="comment"># Trying "weiyigeek.default.svc.cluster.local"</span></span><br><span class="line">  <span class="comment"># Trying "weiyigeek.svc.cluster.local"</span></span><br><span class="line">  <span class="comment"># Trying "weiyigeek.cluster.local"</span></span><br><span class="line">  <span class="comment"># Trying "weiyigeek"</span></span><br><span class="line">  <span class="comment"># Host weiyigeek not found: 3(NXDOMAIN)</span></span><br><span class="line">  <span class="comment"># Received 102 bytes from 10.96.0.10#53 in 47 ms</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3) è¾“å…¥ä¸€ä¸ªé›†ç¾¤ä¸­å­˜åœ¨åŸŸåå®ƒå°†ä¼šåœ¨æœç´¢åŸŸä¸­è¿›è¡Œè§£æè¯·æ±‚(A / AAAA / MX)è®°å½•</span></span><br><span class="line">~$ kubectl get svc</span><br><span class="line">  <span class="comment"># NAME                             TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE</span></span><br><span class="line">  <span class="comment"># weiyigeek                 NodePort    10.107.122.223   &lt;none&gt;        8080:30089/TCP      15d</span></span><br><span class="line"></span><br><span class="line">~$ host -d -v weiyigeek</span><br><span class="line">Trying <span class="string">"weiyigeek.default.svc.cluster.local"</span>  <span class="comment"># æè¿°:ä¸€æ¥å°±æ‰¾åˆ°è¯¥FQDNè§£æçš„IPåœ°å€</span></span><br><span class="line">  <span class="comment"># ;; -&gt;&gt;HEADE opcode: QUERY, status: NOERROR, id: 7138</span></span><br><span class="line">  <span class="comment"># ;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span></span><br><span class="line">  <span class="comment"># ;; QUESTION SECTION:  # è¯¢é—®</span></span><br><span class="line">  <span class="comment"># ;weiyigeek.default.svc.cluster.local. IN A    # A è®°å½•</span></span><br><span class="line">  <span class="comment"># ;; ANSWER SECTION:    # å›ç­”</span></span><br><span class="line">  <span class="comment"># weiyigeek.default.svc.cluster.local. 30 IN A 10.107.122.223</span></span><br><span class="line">  <span class="comment"># Received 118 bytes from 10.96.0.10#53 in 3 ms</span></span><br><span class="line"></span><br><span class="line">Trying <span class="string">"weiyigeek.default.svc.cluster.local"</span></span><br><span class="line">  <span class="comment"># ;; -&gt;&gt;HEADER opcode: QUERY, status: NOERROR, id: 32192</span></span><br><span class="line">  <span class="comment"># ;; flags: qr aa rd; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 0</span></span><br><span class="line">  <span class="comment"># ;; QUESTION SECTION:</span></span><br><span class="line">  <span class="comment"># ;weiyigeek.default.svc.cluster.local. IN AAAA  # AAAA è®°å½•</span></span><br><span class="line">  <span class="comment"># ;; AUTHORITY SECTION:</span></span><br><span class="line">  <span class="comment"># cluster.local.          30      IN      SOA     ns.dns.cluster.local. hostmaster.cluster.local. 1616058438 7200 1800 86400 30</span></span><br><span class="line">  <span class="comment"># Received 153 bytes from 10.96.0.10#53 in 0 ms</span></span><br><span class="line"></span><br><span class="line">Trying <span class="string">"weiyigeek.default.svc.cluster.local"</span></span><br><span class="line">  <span class="comment"># ;; -&gt;&gt;HEADER opcode: QUERY, status: NOERROR, id: 11848</span></span><br><span class="line">  <span class="comment"># ;; flags: qr aa rd; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 0</span></span><br><span class="line">  <span class="comment"># ;; QUESTION SECTION:</span></span><br><span class="line">  <span class="comment"># ;weiyigeek.default.svc.cluster.local. IN MX  # MX è®°å½•</span></span><br><span class="line">  <span class="comment"># ;; AUTHORITY SECTION:</span></span><br><span class="line">  <span class="comment"># cluster.local.          30      IN      SOA     ns.dns.cluster.local. hostmaster.cluster.local. 1616058426 7200 1800 86400 30</span></span><br><span class="line">  <span class="comment"># Received 153 bytes from 10.96.0.10#53 in 0 ms</span></span><br></pre></td></tr></table></figure></p>
<p>Tips : åœ¨é å‰çš„ DNS æœåŠ¡å™¨æ²¡æœ‰å“åº”ï¼ˆtimeoutï¼‰æ—¶ï¼Œæ‰ä¼šä½¿ç”¨åç»­çš„ DNS æœåŠ¡å™¨ï¼æ‰€ä»¥æŒ‡å®šçš„æœåŠ¡å™¨ä¸­çš„ DNS è®°å½•æœ€å¥½å®Œå…¨ä¸€è‡´ï¼ï¼ï¼ä¸è¦æŠŠç¬¬ä¸€ä¸ªé…å†…ç½‘ DNSï¼Œç¬¬äºŒä¸ªé…å¤–ç½‘ï¼ï¼ï¼</p>
<p><br></p>
<h3 id="1-DNSç¼“å­˜æ¸…ç†"><a href="#1-DNSç¼“å­˜æ¸…ç†" class="headerlink" title="1) DNSç¼“å­˜æ¸…ç†"></a>1) DNSç¼“å­˜æ¸…ç†</h3><p><strong>Q: ä»€ä¹ˆæ˜¯dnsç¼“å­˜?</strong></p>
<blockquote>
<p>ç­”: æ¯å½“æˆ‘ä»¬å°è¯•è®¿é—®å¸¦æœ‰ç½‘ç«™æ—¶éƒ½ä¼šæ‰§è¡ŒDNSåç§°è§£ææŸ¥è¯¢æ¥è§£æå…¶IPåœ°å€ã€‚ æ“ä½œç³»ç»Ÿç¼“å­˜æ­¤æ•°æ®ï¼Œä»¥é¿å…æ¯æ¬¡éƒ½ä¸åç§°æœåŠ¡å™¨è”ç³»ã€‚</p>
</blockquote>
<p><strong>Q: ä¸ºä»€ä¹ˆè¦æ¸…é™¤DNSç¼“å­˜ï¼Ÿ (Why to Clear DNS Cache?)</strong></p>
<blockquote>
<p>ç­”: å¸¸å¸¸ä¼šå‡ºç°ä»¥ä¸‹åœºæ™¯ä¾‹å¦‚ç½‘ç«™çš„IPåœ°å€åœ¨ç§»è‡³å¦ä¸€å°æœåŠ¡å™¨æ—¶ä¼šæ›´æ”¹æˆ–è€…ç®¡ç†å‘˜æ›´æ”¹äº†DNSè§£æè®°å½•ï¼ˆ<code>å—ç”Ÿå­˜æ—¶é—´(TTL)ç®¡æ§</code>ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹å¦‚æœæˆ‘ä»¬ç‚¹å‡»äº†ç¼“å­˜çš„IPåœ°å€ï¼Œåˆ™è¯¥ç½‘ç«™å°†æ— æ³•æ­£å¸¸è¿è¡Œã€‚<br>DNSæ¡ç›®å…·æœ‰ä¸ä¹‹å…³è”çš„â€ç”Ÿå­˜æ—¶é—´(TTL)â€å€¼ï¼Œè¯¥å€¼å‘Šè¯‰æ“ä½œç³»ç»Ÿåç§°è§£ææœåŠ¡ä½•æ—¶ä½¿DNSç¼“å­˜æ— æ•ˆã€‚<br>å¦‚æœæ‚¨æƒ³åœ¨TTLè¿‡æœŸä¹‹å‰è”ç³»åˆ°æ–°çš„IPåœ°å€ï¼Œåˆ™å”¯ä¸€çš„è§£å†³æ–¹æ¡ˆæ˜¯<code>åˆ·æ–°DNSç¼“å­˜</code>ã€‚</p>
</blockquote>
<p><strong>Q: å¦‚ä½•åœ¨Ubuntu/Windowsä¸Šæ¸…é™¤DNSç¼“å­˜ï¼Ÿ</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ubuntu</span></span><br><span class="line"><span class="comment"># Tips: --flush-caches é€‰é¡¹ä»…ä»…åªæ˜¯æ¸…é™¤DNSç¼“å­˜</span></span><br><span class="line">sudo systemd-resolve --flush-caches</span><br><span class="line"><span class="comment"># Tips: é‡æ–°å¯åŠ¨systemdè§£æçš„æœåŠ¡å¯ä»¥æ¸…é™¤æ‰€æœ‰DNSç¼“å­˜ç»Ÿè®¡ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># sudo systemctl restart systemd-resolved</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Windows</span></span><br><span class="line">ipconfig /flushdns</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="2-DNSæœåŠ¡æµ‹è¯•å·¥å…·"><a href="#2-DNSæœåŠ¡æµ‹è¯•å·¥å…·" class="headerlink" title="2) DNSæœåŠ¡æµ‹è¯•å·¥å…·"></a>2) DNSæœåŠ¡æµ‹è¯•å·¥å…·</h3><p>æè¿°: åœ¨windowsæˆ–è€…Linuxå¸¸ç”¨çš„DNSæœåŠ¡å™¨è§£ææµ‹è¯•é‡‡ç”¨ä»¥ä¸‹è½¯ä»¶è¿›è¡Œï¼›</p>
<h4 id="nslookup-å‘½ä»¤"><a href="#nslookup-å‘½ä»¤" class="headerlink" title="nslookup å‘½ä»¤"></a>nslookup å‘½ä»¤</h4><p>æè¿°: æ”¯æŒå¤šå¹³å°ã€åº”ç”¨å¹¿æ³›, å…¶ä¼˜ç‚¹ä½¿ç”¨ç®€å•ã€å¼‚åŠ¨;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) ä½¿ç”¨ç¤ºä¾‹ -t type</span></span><br><span class="line"><span class="comment"># This option specifies the query type. The type argument can be any recognized query type: CNAME, NS, SOA, TXT, DNSKEY, AXFR, etc.</span></span><br><span class="line">nslookup -qt=SOA/A/CNAME/MX/NS/TXT www.weiyigeek.top  <span class="comment"># -qt typeæŒ‡å®šDNSè§£æç±»å‹</span></span><br><span class="line">C:\Users\WeiyiGeek&gt;nslookup -qt=a weiyigeek.top 192.168.12.254</span><br><span class="line">æœåŠ¡å™¨:  ns1.weiyigeek.top</span><br><span class="line">Address:  192.168.12.254</span><br><span class="line"></span><br><span class="line">éæƒå¨åº”ç­”:</span><br><span class="line">åç§°:    weiyigeek.top</span><br><span class="line">Addresses:  172.67.189.218</span><br><span class="line">          104.21.10.9</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) äº¤äº’å¼</span></span><br><span class="line">nslookup  </span><br><span class="line">&gt; server 172.16.102.14 </span><br><span class="line">&gt; <span class="built_in">set</span> q=a                       //è®¾ç½®DNSè§£æç±»å‹</span><br><span class="line">&gt; www.weiyigeek.top</span><br><span class="line"></span><br><span class="line">&gt; <span class="built_in">set</span> q=ns</span><br><span class="line">&gt; www.weiyigeek.top</span><br><span class="line">æœåŠ¡å™¨:  UnKnown</span><br><span class="line">Address:  192.168.2.1</span><br><span class="line">weiyigeek.top</span><br><span class="line">  primary name server = ns3.dnsv3.com</span><br><span class="line">  responsible mail addr = enterprise1dnsadmin.dnspod.com</span><br><span class="line">  serial  = 1500274720</span><br><span class="line">  refresh = 3600 (1 hour)</span><br><span class="line">  retry   = 180 (3 mins)</span><br><span class="line">  expire  = 1209600 (14 days)</span><br><span class="line">  default TTL = 180 (3 mins)</span><br></pre></td></tr></table></figure></p>
<p><strong>Linux å¹³å°</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.Aè®°å½•æŸ¥è¯¢</span></span><br><span class="line">$  nslookup -query=A service-headless.default.svc.cluster.local.</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="dig-å‘½ä»¤"><a href="#dig-å‘½ä»¤" class="headerlink" title="dig å‘½ä»¤"></a>dig å‘½ä»¤</h4><p>æè¿°: ä¸»è¦è¿è¡Œåœ¨Linuxå¹³å°ä¸Š, å…¶ä¼˜ç‚¹æ¯”è¾ƒä¸“ä¸š;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) é»˜è®¤æŸ¥è¯¢Aè®°å½•</span></span><br><span class="line">dig www.baidu.com @172.16.102.14</span><br><span class="line">  <span class="comment"># ; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; www.baidu.com @192.168.4.254</span></span><br><span class="line">  <span class="comment"># ;; Got answer:</span></span><br><span class="line">  <span class="comment"># ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 20227</span></span><br><span class="line">  <span class="comment"># ;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 1</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ;; OPT PSEUDOSECTION:</span></span><br><span class="line">  <span class="comment"># ; EDNS: version: 0, flags:; udp: 4096</span></span><br><span class="line">  <span class="comment"># ; COOKIE: fdbde72c243a04c60100000060587950b128dc5a23826a27 (good)</span></span><br><span class="line">  <span class="comment"># ;; QUESTION SECTION:</span></span><br><span class="line">  <span class="comment"># ;www.baidu.com.                 IN      A</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ;; ANSWER SECTION:</span></span><br><span class="line">  <span class="comment"># www.baidu.com.          99      IN      CNAME   www.a.shifen.com.</span></span><br><span class="line">  <span class="comment"># www.a.shifen.com.       98      IN      A       14.215.177.39</span></span><br><span class="line">  <span class="comment"># www.a.shifen.com.       98      IN      A       14.215.177.38</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ;; Query time: 19 msec</span></span><br><span class="line">  <span class="comment"># ;; SERVER: 192.168.4.254#53(192.168.4.254)</span></span><br><span class="line">  <span class="comment"># ;; WHEN: Mon Mar 22 19:02:40 CST 2021</span></span><br><span class="line">  <span class="comment"># ;; MSG SIZE  rcvd: 132</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) -t NSè§£æç±»å‹ </span></span><br><span class="line">dig -t ns www.baidu.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) -x ipåæŸ¥åŸŸå     </span></span><br><span class="line">dig -x 192.168.12.13 @192.168.12.254    </span><br><span class="line">  <span class="comment"># ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 56847</span></span><br><span class="line">  <span class="comment"># ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ;; OPT PSEUDOSECTION:</span></span><br><span class="line">  <span class="comment"># ; EDNS: version: 0, flags:; udp: 4096</span></span><br><span class="line">  <span class="comment"># ; COOKIE: a78353f6f0787a7d010000006058799c1af1ea827274eb9f (good)</span></span><br><span class="line">  <span class="comment"># ;; QUESTION SECTION:</span></span><br><span class="line">  <span class="comment"># ;13.12.168.192.in-addr.arpa.    IN      PTR</span></span><br><span class="line">  <span class="comment"># ;; ANSWER SECTION:</span></span><br><span class="line">  <span class="comment"># 13.12.168.192.in-addr.arpa. 86400 IN    PTR     s.weiyigeek.top.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (4) å¤ç°æ­£å‘æŸ¥è¯¢çš„æµç¨‹</span></span><br><span class="line">dig +trace baidu.com  </span><br><span class="line"><span class="comment"># å…ˆåœ¨æ ¹åŸŸä¸­æŸ¥æ‰¾ </span></span><br><span class="line">.                       503232  IN      NS      g.root-servers.net.</span><br><span class="line">....</span><br><span class="line">.                       503232  IN      NS      i.root-servers.net.</span><br><span class="line">.                       518317  IN      RRSIG   NS 8 0 518400 20210403170000 20210321160000 42351 . ... XoGqZA==</span><br><span class="line">;; Received 1137 bytes from 192.168.12.254<span class="comment">#53(192.168.12.254) in 0 ms</span></span><br><span class="line"><span class="comment"># å…¶æ¬¡åœ¨é¡¶çº§åŸŸ</span></span><br><span class="line">com.                    172800  IN      NS      a.gtld-servers.net.</span><br><span class="line">....</span><br><span class="line">com.                    172800  IN      NS      l.gtld-servers.net.</span><br><span class="line">com.                    86400   IN      DS      30909 8 2 E2D3C916F6DEEAC73294E8268FB5885044A833FC5459588F4A9184CF C41A5766</span><br><span class="line">com.                    86400   IN      RRSIG   DS 8 1 86400 20210403170000 20210321160000 42351 ....</span><br><span class="line">;; Received 1169 bytes from 199.7.83.42<span class="comment">#53(l.root-servers.net) in 27 ms</span></span><br><span class="line"><span class="comment"># åœ¨æ¬¡çº§åŸŸnsè·å¾—ç™¾åº¦çš„Aè®°å½•</span></span><br><span class="line">baidu.com.              172800  IN      NS      ns2.baidu.com.</span><br><span class="line">baidu.com.              172800  IN      NS      ns3.baidu.com.</span><br><span class="line">baidu.com.              172800  IN      NS      ns4.baidu.com.</span><br><span class="line">baidu.com.              172800  IN      NS      ns1.baidu.com.</span><br><span class="line">baidu.com.              172800  IN      NS      ns7.baidu.com.</span><br><span class="line">CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN NSEC3 1 1 0 - CK0Q1GIN43N1ARRC9OSM6QPQR81H5M9A NS SOA RRSIG DNSKEY NSEC3PARAM</span><br><span class="line">CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN RRSIG NSEC3 8 2 86400 20210329044039 20210322033039 58540 com.</span><br><span class="line">HPVUSBDNI26UDNIV6R0SV14GC3KGR4JP.com. 86400 IN NSEC3 1 1 0 - HPVVN3Q5E5GOQP2QFE2LEM4SVB9C0SJ6 NS DS RRSIG</span><br><span class="line">HPVUSBDNI26UDNIV6R0SV14GC3KGR4JP.com. 86400 IN RRSIG NSEC3 8 2 86400 20210329061254 20210322050254 58540 </span><br><span class="line">;; Received 757 bytes from 192.54.112.30<span class="comment">#53(h.gtld-servers.net) in 215 ms</span></span><br><span class="line"><span class="comment"># è·å¾—Aè®°å½•</span></span><br><span class="line">baidu.com.              600     IN      A       220.181.38.148</span><br><span class="line">baidu.com.              600     IN      A       39.156.69.79</span><br><span class="line">baidu.com.              86400   IN      NS      ns7.baidu.com.</span><br><span class="line">baidu.com.              86400   IN      NS      ns2.baidu.com.</span><br><span class="line">baidu.com.              86400   IN      NS      ns4.baidu.com.</span><br><span class="line">baidu.com.              86400   IN      NS      ns3.baidu.com.</span><br><span class="line">baidu.com.              86400   IN      NS      dns.baidu.com.</span><br><span class="line">;; Received 240 bytes from 14.215.178.80<span class="comment">#53(ns4.baidu.com) in 35 ms</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (5) å¤ç°åå‘æŸ¥è¯¢çš„æµç¨‹(æ­¤å¤„ä»¥ç™¾åº¦é‚®ç®±ä¸ºä¾‹)</span></span><br><span class="line">ping mx21.baidu.com                      <span class="comment"># è·å¾—åœ°å€</span></span><br><span class="line">~$ dig -x 220.181.3.85  @192.168.4.254</span><br><span class="line">~$ dig -t ptr 85.3.181.220.in-addr.arpa.  @192.168.4.254</span><br><span class="line"></span><br><span class="line">  <span class="comment"># ;; QUESTION SECTION:</span></span><br><span class="line">  <span class="comment"># ;85.3.181.220.in-addr.arpa.     IN      PTR</span></span><br><span class="line">  <span class="comment"># ;; ANSWER SECTION:</span></span><br><span class="line">  <span class="comment"># 85.3.181.220.in-addr.arpa. 3600 IN      PTR     mx21.baidu.com.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (6) ç›´æ¥è¾“å‡ºä¸€ä¸ªåŸŸåè§£æåœ°å€</span></span><br><span class="line">dig +short blog.weiyigeek.top</span><br><span class="line">  <span class="comment"># 172.67.189.218</span></span><br><span class="line">dig +short www.weiyigeek.top</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(dig +short www.weiyigeek.top);<span class="keyword">do</span> <span class="built_in">echo</span> IP:<span class="variable">$&#123;i&#125;</span>;<span class="keyword">done</span></span><br><span class="line">  <span class="comment"># IP:104.21.10.9</span></span><br><span class="line">  <span class="comment"># IP:172.67.189.218</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="host-å‘½ä»¤"><a href="#host-å‘½ä»¤" class="headerlink" title="host å‘½ä»¤"></a>host å‘½ä»¤</h4><p>æè¿°: ä½¿ç”¨è¾ƒå¤š, ç®€å•ã€æ˜äº†ï¼Œå®ƒåŸºæœ¬å°±æ˜¯ dig çš„å¼±åŒ–ç‰ˆï¼›<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) -t typeæŒ‡å®šDNSè§£æç±»å‹</span></span><br><span class="line">host -t SOA www.weiyigeek.top  </span><br><span class="line">host -t NS www.weiyigeek.top</span><br><span class="line">host -t CNAME www.weiyigeek.top</span><br><span class="line">host -t A www.weiyigeek.top</span><br><span class="line">host -t MX www.weiyigeek.top</span><br><span class="line">host -t TXT www.weiyigeek.top</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) ä¸è¿‡ host æœ‰ä¸ªæœ‰ç‚¹å°±æ˜¯èƒ½æ‰“å°å‡ºå®ƒæµ‹è¯•è¿‡çš„æ‰€æœ‰ FQDN (æ­¤å¤„ä¹Ÿèƒ½ä½“ç°æœç´¢åŸŸ)</span></span><br><span class="line">host -a weiyigeek.cn</span><br><span class="line">  <span class="comment"># Trying "weiyigeek.cn"</span></span><br><span class="line">  <span class="comment"># ;; - opcode: QUERY, status: NOERROR, id: 25817</span></span><br><span class="line">  <span class="comment"># ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 5, AUTHORITY: 0, ADDITIONAL: 3</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ;; QUESTION SECTION:</span></span><br><span class="line">  <span class="comment"># ;weiyigeek.cn.                      IN      ANY</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ;; ANSWER SECTION:</span></span><br><span class="line">  <span class="comment"># weiyigeek.cn.               86400   IN      SOA     ns1.weiyigeek.cn. admin.weiyigeek.cn. 3 50400 86400 604800 86400</span></span><br><span class="line">  <span class="comment"># weiyigeek.cn.               86400   IN      NS      ns1.weiyigeek.cn.</span></span><br><span class="line">  <span class="comment"># weiyigeek.cn.               86400   IN      NS      ns2.weiyigeek.cn.</span></span><br><span class="line">  <span class="comment"># weiyigeek.cn.               86400   IN      NS      ns3.weiyigeek.cn.</span></span><br><span class="line">  <span class="comment"># weiyigeek.cn.               86400   IN      A       192.168.10.47</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ;; ADDITIONAL SECTION:</span></span><br><span class="line">  <span class="comment"># ns1.weiyigeek.cn.           86400   IN      A       192.168.12.254</span></span><br><span class="line">  <span class="comment"># ns2.weiyigeek.cn.           86400   IN      A       192.168.10.254</span></span><br><span class="line">  <span class="comment"># ns3.weiyigeek.cn.           86400   IN      A       192.168.4.254</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) -v è¯·æ±‚è¯¦ç»†æµç¨‹ (è®¾ç½®æœç´¢åŸŸæ—¶å¯ä»¥çœ‹åˆ° A/AAAA/MX è¯·æ±‚)</span></span><br><span class="line">~$ host -v oa</span><br><span class="line">Trying <span class="string">"oa.weiyigeek.top"</span></span><br><span class="line">Trying <span class="string">"oa.weiyigeek.cn"</span></span><br><span class="line">  <span class="comment"># ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 64579</span></span><br><span class="line">  <span class="comment"># ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span></span><br><span class="line">  <span class="comment"># .....</span></span><br><span class="line">  <span class="comment"># ;; QUESTION SECTION:</span></span><br><span class="line">  <span class="comment"># ;oa.weiyigeek.cn.                   IN      A</span></span><br><span class="line">  <span class="comment"># ;; ANSWER SECTION:</span></span><br><span class="line">  <span class="comment"># oa.weiyigeek.cn.            604800  IN      A       192.168.100.96</span></span><br><span class="line">  <span class="comment"># .....</span></span><br><span class="line">  <span class="comment"># ;; QUESTION SECTION:</span></span><br><span class="line">  <span class="comment"># ;oa.weiyigeek.cn.                   IN      AAAA</span></span><br><span class="line">  <span class="comment"># ;; AUTHORITY SECTION:</span></span><br><span class="line">  <span class="comment"># weiyigeek.cn.               604800  IN      SOA     ns1.weiyigeek.cn. admin.weiyigeek.cn. 3 600 86400 2419200 604800</span></span><br><span class="line">  <span class="comment"># .....</span></span><br><span class="line">  <span class="comment"># ;; QUESTION SECTION:</span></span><br><span class="line">  <span class="comment"># ;oa.weiyigeek.cn.                   IN      MX</span></span><br><span class="line">  <span class="comment"># ;; AUTHORITY SECTION:</span></span><br><span class="line">  <span class="comment"># weiyigeek.cn.               604800  IN      SOA     ns1.weiyigeek.cn. admin.weiyigeek.cn. 3 600 86400 2419200 604800</span></span><br><span class="line">  <span class="comment"># Received 75 bytes from 192.168.12.254#53 in 0 ms</span></span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=ä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡æ­å»ºä¸å®‰å…¨é…ç½®å®è·µ href="https://img.weiyigeek.top/2020/2/20201126224430.png" target="_blank" title="WeiyiGeek.DNSæ­£å‘è§£æå®¢æˆ·ç«¯å·¥å…·" data-fancybox="images"><img src="https://img.weiyigeek.top/2020/2/20201126224430.png" alt="WeiyiGeek.DNSæ­£å‘è§£æå®¢æˆ·ç«¯å·¥å…·" title="" class=""></a>
                <p>WeiyiGeek.DNSæ­£å‘è§£æå®¢æˆ·ç«¯å·¥å…·</p>
            </figure>
<p><br/></p>
<h4 id="whois-å‘½ä»¤"><a href="#whois-å‘½ä»¤" class="headerlink" title="whois å‘½ä»¤"></a>whois å‘½ä»¤</h4><p>æè¿°: whoisç›®å½•æœåŠ¡çš„å®¢æˆ·ç«¯<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SYNOPSIS</span></span><br><span class="line">whois [ &#123; -h | --host &#125; HOST ] [ &#123; -p | --port &#125; PORT ] [ -abBcdGHIKlLmMrRx ] [ -g SOURCE:FIRST-LAST ] [ -i ATTR[,ATTR]... ] [ -s SOURCE[,SOURCE]... ] [ -T TYPE[,TYPE]... ] [ --verbose ] OBJECT</span><br><span class="line">whois -q KEYWORD</span><br><span class="line">whois -t TYPE</span><br><span class="line">whois -v TYPE</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‚æ•°:</span></span><br><span class="line">-h HOST, --host=HOST  <span class="comment"># Connect to HOST.</span></span><br><span class="line">-p PORT, --port=PORT  <span class="comment"># Connect to PORT.</span></span><br><span class="line">-H  <span class="comment"># Do not display the legal disclaimers that some registries like to show you.</span></span><br><span class="line">-I  <span class="comment"># First query whois.iana.org and then follow its referral to the whois server authoritative for that request. This works for IP addresses, AS numbers and domains.  BEWARE: this implies that the IANA server will reâ€ceive your complete query.</span></span><br><span class="line">--verbose Be verbose.</span><br><span class="line"></span><br><span class="line">Other options are flags understood by whois.ripe.net and some other RIPE-like servers:</span><br><span class="line">-a      Also search all the mirrored databases.</span><br><span class="line">-b      Return brief IP address ranges with abuse contact.</span><br><span class="line">-B      Disable objects filtering. (Show the e-mail addresses.)</span><br><span class="line">-c      Return the smallest IP address range with a reference to an irt object.</span><br><span class="line">-d      Return the reverse DNS delegation object too.</span><br><span class="line">-g SOURCE:FIRST-LAST <span class="comment"># Search updates from SOURCE database between FIRST and LAST update serial number. It is useful to obtain Near Real Time Mirroring stream.</span></span><br><span class="line">-G      <span class="comment">#Disable grouping of associated objects.</span></span><br><span class="line">-i ATTR[,ATTR]...    <span class="comment"># Inverse-search objects having associated attributes.  ATTR is the attribute name, while the positional OBJECT argument is the attribute value.</span></span><br><span class="line">-K      Return  primary  key  attributes  only.  An exception is the members attribute of <span class="built_in">set</span> objects, <span class="built_in">which</span> is always returned. Another exception are all attributes of the objects organisation, person and role, that are never returned.</span><br><span class="line">-l      Return the one level less specific object.</span><br><span class="line">-L      Return all levels of less specific objects.</span><br><span class="line">-m      Return all one level more specific objects.</span><br><span class="line">-M      Return all levels of more specific objects.</span><br><span class="line"></span><br><span class="line">--<span class="built_in">help</span>  Display online <span class="built_in">help</span>.</span><br><span class="line">--version Display the program version.</span><br></pre></td></tr></table></figure></p>
<p>åŸºç¡€å®ä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1) åŸŸåæä¾›å•†ä¿¡æ¯æŸ¥è¯¢(ç°åœ¨åŸºæœ¬éƒ½æ˜¯)</span></span><br><span class="line">~$ whois weiyigeek.top</span><br><span class="line">  Domain Name: weiyigeek.top</span><br><span class="line">  Registry Domain ID: D20200225G10001G_34088337-top</span><br><span class="line">  Registrar WHOIS Server: whois.dnspod.cn</span><br><span class="line">  Registrar URL: https://www.dnspod.cn</span><br><span class="line">  Updated Date: 2020-04-25T06:49:26Z</span><br><span class="line">  Creation Date: 2020-02-25T03:50:39Z</span><br><span class="line">  Registry Expiry Date: 2030-02-25T03:50:39Z</span><br><span class="line">  Registrar: DNSPod, Inc.</span><br><span class="line">  Registrar IANA ID: 1697</span><br><span class="line">  Registrar Abuse Contact Email: abuse@dnspod.com</span><br><span class="line">  Registrar Abuse Contact Phone: +86.95716</span><br><span class="line">  Domain Status: clientTransferProhibited https://icann.org/epp<span class="comment">#clientTransferProhibited</span></span><br><span class="line">  Registry Registrant ID: REDACTED FOR PRIVACY</span><br><span class="line">  Registrant Name: REDACTED FOR PRIVACY</span><br><span class="line">  Registrant Organization: weiyigeek</span><br><span class="line">  Registrant Street:  REDACTED FOR PRIVACY</span><br><span class="line">  Registrant City: REDACTED FOR PRIVACY</span><br><span class="line">  Registrant State/Province: chong qing shi</span><br><span class="line">  Registrant Postal Code: REDACTED FOR PRIVACY</span><br><span class="line">  Registrant Country: CN</span><br><span class="line">  Registrant Phone: REDACTED FOR PRIVACY</span><br><span class="line">  Registrant Phone Ext: REDACTED FOR PRIVACY</span><br><span class="line">  Registrant Fax: REDACTED FOR PRIVACY</span><br><span class="line">  Registrant Fax Ext: REDACTED FOR PRIVACY</span><br></pre></td></tr></table></figure></p>
<p>Tips : dig å·¥å…·æœªæ¥å¯èƒ½ä¼šè¢« drill å–ä»£ã€‚</p>
<p><br></p>
<h4 id="shell-è„šæœ¬å·¥å…·"><a href="#shell-è„šæœ¬å·¥å…·" class="headerlink" title="shell è„šæœ¬å·¥å…·"></a>shell è„šæœ¬å·¥å…·</h4><p><strong>Named é…ç½®æµ‹è¯•:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">tee /tmp/dns-test.sh &lt;&lt;<span class="string">'END'</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 1) åŒºåŸŸé…ç½®ï¼ˆä¸»ã€å¤‡ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$0</span> /var/cache/bind"</span></span><br><span class="line">  zonedir=<span class="string">"/var/cache/bind"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  zonedir=<span class="variable">$1</span>  <span class="comment"># /var/cache/bind/master</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">named-checkconf -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2) å†…éƒ¨è§£æzoneé…ç½®</span></span><br><span class="line"><span class="keyword">for</span> zone <span class="keyword">in</span> $(ls <span class="variable">$&#123;zonedir&#125;</span>);<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"# <span class="variable">$&#123;zone&#125;</span> ---------------------------"</span></span><br><span class="line">  named-checkzone <span class="variable">$&#123;zone&#125;</span> <span class="variable">$&#123;zonedir&#125;</span>/<span class="variable">$&#123;zone&#125;</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">"\n"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">END</span><br><span class="line"></span><br><span class="line">chmod +x /tmp/dns-test.sh </span><br><span class="line">bash /tmp/dns-test.sh /var/cache/<span class="built_in">bind</span>/master</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="0x02-å…¥å‘å‡ºå‘"><a href="#0x02-å…¥å‘å‡ºå‘" class="headerlink" title="0x02 å…¥å‘å‡ºå‘"></a>0x02 å…¥å‘å‡ºå‘</h2><h3 id="é—®é¢˜1-validating-com-DS-no-valid-signature-found"><a href="#é—®é¢˜1-validating-com-DS-no-valid-signature-found" class="headerlink" title="é—®é¢˜1.validating com/DS: no valid signature found"></a>é—®é¢˜1.validating com/DS: no valid signature found</h3><p>é—®é¢˜æè¿°: ä¹‹å‰ä¸€ç›´ç”¨çš„windowsç‰ˆæœ¬çš„bind9æœåŠ¡å™¨ã€‚é…ç½®æ–‡ä»¶ç¨å¾®æ”¹åŠ¨ä¸€ä¸‹è·¯å¾„ç›´æ¥æ‹¿æ¥ç”¨ã€‚å¯ä»¥è¿è¡Œä½†æ˜¯æ€»æ˜¯æç¤ºé”™è¯¯<code>validating com/DS: no valid signature found</code>ã€‚</p>
<p>æè¿°: é€šè¿‡å‚è€ƒå®˜ç½‘çš„è¯´æ˜å‘ç°å¯ä»¥ç”±äºæ—¶åŒºæˆ–è€…dnssecå¯†é’¥ä¸æ­£ç¡®ä»¥åŠä¸å­˜åœ¨å¯¼è‡´å¯¼è‡´<code>no valid signature found</code>é”™è¯¯ã€‚</p>
<p>è§£å†³åŠæ³•: ä¿®æ”¹bind9çš„optionsé…ç½®å¦‚ä¸‹å³å¯ä½¿ç”¨ï¼Œå¦‚æœè¦ä½¿ç”¨dnssecéœ€è¦ç”ŸæˆGenerating Keys(<a href="https://bind9.readthedocs.io/en/v9_16_13/advanced.html#dnssec" target="_blank" rel="noopener">å¸®åŠ©åœ°å€</a>)ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;dnssec-enable yes;</span><br><span class="line">dnssec-validation no;</span><br><span class="line">&#x2F;&#x2F;dnssec-lookaside auto;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="é—®é¢˜2-client-0x7f418c000cd0-10-20-172-106-54935-xxx-com-query-cache-â€˜xxx-com-A-INâ€™-denied"><a href="#é—®é¢˜2-client-0x7f418c000cd0-10-20-172-106-54935-xxx-com-query-cache-â€˜xxx-com-A-INâ€™-denied" class="headerlink" title="é—®é¢˜2.client @0x7f418c000cd0 10.20.172.106#54935 (xxx.com): query (cache) â€˜xxx.com/A/INâ€™ denied"></a>é—®é¢˜2.client @0x7f418c000cd0 10.20.172.106#54935 (xxx.com): query (cache) â€˜xxx.com/A/INâ€™ denied</h3><p>é”™è¯¯ä¿¡æ¯:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Mar 22 14:54:32 dns-server named[70775]: client @0x7f418c000cd0 10.20.172.106<span class="comment">#54935 (edge.microsoft.com): query (cache) 'edge.microsoft.com/A/IN' denied</span></span><br><span class="line">Mar 22 14:54:32 dns-server named[70775]: client @0x7f418c000cd0 10.20.172.106<span class="comment">#54935 (edge.microsoft.com): query failed (REFUSED) for edge.microsoft.com/IN/A at query.c:5425</span></span><br><span class="line">Mar 22 14:55:09 dns-server named[70775]: client @0x7f4174013dd0 10.20.172.106<span class="comment">#59712 (edge.activity.windows.com): query (cache) 'edge.activity.windows.com/A/IN' denied</span></span><br><span class="line">Mar 22 14:55:09 dns-server named[70775]: client @0x7f4174013dd0 10.20.172.106<span class="comment">#59712 (edge.activity.windows.com): query failed (REFUSED) for edge.activity.windows.com/IN/A at query.c:5425</span></span><br></pre></td></tr></table></figure><br>é”™è¯¯åŸå› : ä»å­—é¢æ„æ€æ¥çœ‹å°±æ˜¯ClientæŸ¥è¯¢æ— æƒé™<br>è§£å†³åŠæ³•: åœ¨named.confä¸­æ·»åŠ <code>allow-query { any; };</code>é…ç½®ã€‚</p>
<hr>
<h2 id="0x03-å‚è€ƒæ¥æº"><a href="#0x03-å‚è€ƒæ¥æº" class="headerlink" title="0x03 å‚è€ƒæ¥æº"></a>0x03 å‚è€ƒæ¥æº</h2><ul>
<li><a href="https://bind9.readthedocs.io/" target="_blank" rel="noopener">BIND 9 Administrator Reference Manual</a></li>
<li><a href="https://note.mc256.com/2014/03/bind%E6%8A%A5%E9%94%99named-client-query-cache-ain-denied.html" target="_blank" rel="noopener">named-client-query-cache-ain-denied</a></li>
</ul>

        </div>
        
        <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
        
        <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½çœ‹å‹,æ¬¢è¿å…³æ³¨åšä¸»å¾®ä¿¡å…¬ä¼—å·å“Ÿ! â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘å³å¯å…³é—­ç»§ç»­æµè§ˆæ–‡ç« .<br>  <b style="color:red;"> æ¸©é¦¨æç¤º: æœªè§£é”çš„ç”¨æˆ·ä¸èƒ½ç²˜è´´å¤åˆ¶æ–‡ç« å†…å®¹å“Ÿ!</b> <br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
           

        <!-- Google å¹¿å‘Š -->
        
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
  

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2023-03-13T03:54:26.789Z" itemprop="dateUpdated">2023-03-13 11:54:26</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç³»ç»Ÿè¿ç»´/Application/DNS/DNSä¸»ä»æœåŠ¡ä¹‹ä¼ä¸šå†…éƒ¨æ­å»ºä¸å®‰å…¨é…ç½®å®è·µ.md" target="_blank" rel="noopener noreferrer">_posts/ç³»ç»Ÿè¿ç»´/Application/DNS/DNSä¸»ä»æœåŠ¡ä¹‹ä¼ä¸šå†…éƒ¨æ­å»ºä¸å®‰å…¨é…ç½®å®è·µ.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2020/1-20-541.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/1-20-541.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Bind/" rel="tag">Bind</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/1-20-541.html&title=ã€Šä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡æ­å»ºä¸å®‰å…¨é…ç½®å®è·µã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/1-20-541.html&title=ã€Šä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡æ­å»ºä¸å®‰å…¨é…ç½®å®è·µã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/1-20-541.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Šä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡æ­å»ºä¸å®‰å…¨é…ç½®å®è·µã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/1-20-541.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/1-20-541.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/1-22-45.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">MySQLæ•°æ®åº“ç¼–ç¨‹åŸºç¡€å…¥é—¨3</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/1-18-197.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">CentOS8.xç³»ç»Ÿé…ç½®è®°å½•</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-å®è·µæ¡ˆä¾‹"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å®è·µæ¡ˆä¾‹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-ä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡æ­å»ºé…ç½®"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">1) ä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡æ­å»ºé…ç½®</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Master-ä¸»DNSé…ç½®"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">Master-ä¸»DNSé…ç½®</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Slave-ä»DNSé…ç½®"><span class="post-toc-number">1.1.2.</span> <span class="post-toc-text">Slave-ä»DNSé…ç½®</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ä¸»ä»é…ç½®éªŒè¯å¯ç”¨"><span class="post-toc-number">1.1.3.</span> <span class="post-toc-text">ä¸»ä»é…ç½®éªŒè¯å¯ç”¨</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ä¸»ä»æœåŠ¡å·¥ä½œæµ‹è¯•"><span class="post-toc-number">1.1.4.</span> <span class="post-toc-text">ä¸»ä»æœåŠ¡å·¥ä½œæµ‹è¯•</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ä¸»ä»åŒæ­¥è®°å½•æµ‹è¯•"><span class="post-toc-number">1.1.5.</span> <span class="post-toc-text">ä¸»ä»åŒæ­¥è®°å½•æµ‹è¯•</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ä¸»ä»åŒæ­¥æ—¥å¿—æŸ¥çœ‹"><span class="post-toc-number">1.1.6.</span> <span class="post-toc-text">ä¸»ä»åŒæ­¥æ—¥å¿—æŸ¥çœ‹</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-ä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡å®‰å…¨é…ç½®"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">2) ä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡å®‰å…¨é…ç½®</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-åˆ›å»º-TSIG-å¯†é’¥çš„è¿‡ç¨‹"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">1.åˆ›å»º TSIG å¯†é’¥çš„è¿‡ç¨‹</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-Master-DNS-æœºå™¨é…ç½®"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">2.Master DNS æœºå™¨é…ç½®</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-Slave-DNS-æœºå™¨é…ç½®"><span class="post-toc-number">1.2.3.</span> <span class="post-toc-text">3.Slave DNS æœºå™¨é…ç½®</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-TSIGå¯†é’¥å·¥ä½œéªŒè¯"><span class="post-toc-number">1.2.4.</span> <span class="post-toc-text">4.TSIGå¯†é’¥å·¥ä½œéªŒè¯</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-ç« å¤–æ‰©å±•"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 ç« å¤–æ‰©å±•</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#0-OSç³»ç»Ÿä¸Šçš„DNSè§£æå™¨"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">0) OSç³»ç»Ÿä¸Šçš„DNSè§£æå™¨</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-DNSç¼“å­˜æ¸…ç†"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">1) DNSç¼“å­˜æ¸…ç†</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-DNSæœåŠ¡æµ‹è¯•å·¥å…·"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">2) DNSæœåŠ¡æµ‹è¯•å·¥å…·</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#nslookup-å‘½ä»¤"><span class="post-toc-number">2.3.1.</span> <span class="post-toc-text">nslookup å‘½ä»¤</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#dig-å‘½ä»¤"><span class="post-toc-number">2.3.2.</span> <span class="post-toc-text">dig å‘½ä»¤</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#host-å‘½ä»¤"><span class="post-toc-number">2.3.3.</span> <span class="post-toc-text">host å‘½ä»¤</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#whois-å‘½ä»¤"><span class="post-toc-number">2.3.4.</span> <span class="post-toc-text">whois å‘½ä»¤</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#shell-è„šæœ¬å·¥å…·"><span class="post-toc-number">2.3.5.</span> <span class="post-toc-text">shell è„šæœ¬å·¥å…·</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-å…¥å‘å‡ºå‘"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 å…¥å‘å‡ºå‘</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#é—®é¢˜1-validating-com-DS-no-valid-signature-found"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">é—®é¢˜1.validating com&#x2F;DS: no valid signature found</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#é—®é¢˜2-client-0x7f418c000cd0-10-20-172-106-54935-xxx-com-query-cache-â€˜xxx-com-A-INâ€™-denied"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">é—®é¢˜2.client @0x7f418c000cd0 10.20.172.106#54935 (xxx.com): query (cache) â€˜xxx.com&#x2F;A&#x2F;INâ€™ denied</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x03-å‚è€ƒæ¥æº"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 å‚è€ƒæ¥æº</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
    <!-- 
  <div id="post-wechat" class="post-wechat" style="position:fixed;top: 360px;bottom: 500px;right: 3%;width: 190px;text-align: center; z-index: 9999">
    <p><b>å…³æ³¨ã€å…¨æ ˆå·¥ç¨‹å¸ˆä¿®ç‚¼æŒ‡å—ã€‘</b></p>
    <img src="/img/wechat-gzh.jpg" class="img-responsive" alt="weiyigeek">
    <p><b>æ¬¢è¿æ·»åŠ ã€ä½œè€…ã€‘å¾®ä¿¡</b></p>
    <img src="/img/wehat.jpg" class="img-responsive" alt="weiyigeek">
  </div>


 -->

    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="/img/share-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2023 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div>
        <div id="blog-wormhole-id" >
          <a href="https://www.foreverblog.cn/go.html" target="_blank"> 
            <img src="https://img.foreverblog.cn/wormhole_2_tp.gif" alt="åå¹´ä¹‹çº¦è™«æ´" style="height:32px;max-height:50px;display:block;margin:0 auto;" title="ç©¿æ¢­è™«æ´-éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢">
          </a>
        </div>
        <div id="cc-myssl-id" >
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>

<div id="go" class="waves-effect waves-light">
  <a href="javascript:;" id="goqrcode"> <span class="icon icon-lg icon-qrcode"></span> </a>
  <a href="javascript:;" id="gotop"> <span class="icon icon-lg icon-chevron-up"></span></a>
</div>





<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/1-20-541.html&title=ã€Šä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡æ­å»ºä¸å®‰å…¨é…ç½®å®è·µã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/1-20-541.html&title=ã€Šä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡æ­å»ºä¸å®‰å…¨é…ç½®å®è·µã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/1-20-541.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Šä¼ä¸šå†…éƒ¨DNSä¸»ä»æœåŠ¡æ­å»ºä¸å®‰å…¨é…ç½®å®è·µã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/1-20-541.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/1-20-541.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJklEQVR42u3awWorMQwF0Pz/T6fwVq+UpPfKk0KU41UYwniOF0KWdLvF6/5v/Xzy//r5/NF7knV7xcLAwHhbRvK6/EOfIx+9IdnrFyoGBsYHMJ4H2TzgPiflMTP/NgwMDIwkETz/nR8fBgYGRvK6NmVMks7kmDAwMDDyzWaFufyAXn4Xx8DAeENG2xj4y98v7G9gYGC8CeN+sF7RWxx+CQYGxmpGm/bNYl1+oZ01CTAwMHYz2ovr7BLb/qdGYmBgfACjDb7JBifhuG1aYGBg7Ga0F8i8lD8bnmjbEg8vsRgYGOsYeRhNAvS1bYC62IeBgbGakYw75OFvlmLOWggYGBi7GUXKdekoxixkR1VDDAyM1Yw87cuDafI7uSr/wsPAwFjNuLa5mA9YnIT1IsPFwMBYwbiqfNa2NpPgWwRZDAyM1YyTgHvesDx/joGB8QmMdswiTxPzXdpjisptGBgYSxlJySwf28qD8ixZfFg1xMDAWMdoxyzysJsH8Vmr4OG3YWBgLGW0AbRtBrQX1NmXYGBgfAJj9orhlsER1GU4DAyM1Yz8Qtsmi236eMHMCAYGxjrGvVzJ9rOBjHbw4tsTDAyM1YyTIYxZYW5GwsDAwJiV72ekWQpYX18xMDCWMtpK+/kgxa1c0S0cAwMD46BhkCeRw8PCwMDAOC6utWW4C+7ZGBgY6xh5M6AdpJg1A+oaIQYGxmrGSWPgPEHMPy6aGcHAwNjG+ALWKUupHAWscQAAAABJRU5ErkJggg==" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å”¯ä¸€æå®¢-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// ç«™ç‚¹è¿è¡Œæ—¶é—´
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + " å¤© " + RunHours + " æ—¶ " + RunMinutes + " åˆ† " + RunSeconds + " ç§’";
  document.getElementById(id).innerHTML = "ç½‘ç«™å·²åœ¨é£é›¨ä¸­å‹‰å‹‰å¼ºå¼ºè¿è¡Œäº†ã€ " + RunTime + " ã€‘";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
    
  <div id="post-wechat" class="post-wechat" style="position:fixed;top: 360px;bottom: 500px;right: 3%;width: 190px;text-align: center; z-index: 9999">
    <p><b>å…³æ³¨ã€å…¨æ ˆå·¥ç¨‹å¸ˆä¿®ç‚¼æŒ‡å—ã€‘</b></p>
    <img src="/img/wechat-gzh.jpg" class="img-responsive" alt="weiyigeek">
    <p><b>æ¬¢è¿æ·»åŠ ã€ä½œè€…ã€‘å¾®ä¿¡</b></p>
    <img src="/img/wehat.jpg" class="img-responsive" alt="weiyigeek">
  </div>



</body>
</html>