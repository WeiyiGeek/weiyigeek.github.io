<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ K3sä¹‹å¿«é€Ÿæ­å»ºç²¾ç®€ç‰ˆæœ¬K8Sé›†ç¾¤ç¯å¢ƒ|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="K3S">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/2018/1-1-1.html"  >
                <i class="icon icon-lg icon-mortar-board"></i>
                å­¦ä¹ ä¹‹è·¯
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>K3sä¹‹å¿«é€Ÿæ­å»ºç²¾ç®€ç‰ˆæœ¬K8Sé›†ç¾¤ç¯å¢ƒ</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">K3sä¹‹å¿«é€Ÿæ­å»ºç²¾ç®€ç‰ˆæœ¬K8Sé›†ç¾¤ç¯å¢ƒ</h1>
        <h5 class="subtitle">
            
                <time datetime="2022-05-22T06:36:30.000Z" itemprop="datePublished" class="page-time">
  2022-05-22
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
  <article id="post-è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Rancher/K3sä¹‹å¿«é€Ÿæ­å»ºç²¾ç®€ç‰ˆæœ¬K8Sé›†ç¾¤ç¯å¢ƒ"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">K3sä¹‹å¿«é€Ÿæ­å»ºç²¾ç®€ç‰ˆæœ¬K8Sé›†ç¾¤ç¯å¢ƒ</h1>
        <div class="post-meta">
            <time class="post-time" title="2022-05-22 14:36:30" datetime="2022-05-22T06:36:30.000Z"  itemprop="datePublished">2022-05-22</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[toc]</p>
<a id="more"></a>
<h2 id="0x00-å‰è¨€ç®€è¿°"><a href="#0x00-å‰è¨€ç®€è¿°" class="headerlink" title="0x00 å‰è¨€ç®€è¿°"></a>0x00 å‰è¨€ç®€è¿°</h2><p><strong>Q: ä»€ä¹ˆæ˜¯ K3S?</strong></p>
<blockquote>
<p>æè¿°: å®ƒæ˜¯ä¸€ä¸ªè½»é‡çº§K8S(Lightweight Kubernetes)åŒæ—¶å®ƒä¹Ÿæ˜¯ä¸€ä¸ªäº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼š(CNCF)æ²™ç›’é¡¹ç›®, ä¸ºç‰©è”ç½‘å’Œè¾¹ç¼˜è®¡ç®—æ„å»ºçš„ç»è¿‡è®¤è¯çš„ Kubernetes å‘è¡Œç‰ˆ, å‡å°‘äº†kubernetesäº‘ä¾›åº”å•†ç›¸å…³æ’ä»¶æ‰€ä»¥å…¶æ›´åŠ ç²¾ç®€, éƒ¨ç½²ä¹Ÿæ›´åŠ ç®€å•ã€‚ </p>
</blockquote>
<p><br></p>
<p><strong>ä¸ºä»€ä¹ˆå« K3s?</strong><br>æˆ‘ä»¬å¸Œæœ›å®‰è£…çš„ Kubernetes åœ¨å†…å­˜å ç”¨æ–¹é¢åªæ˜¯ä¸€åŠçš„å¤§å°ï¼Œä¸” Kubernetes æ˜¯ä¸€ä¸ª10ä¸ªå­—æ¯çš„å•è¯ç®€å†™ä¸º K8sã€‚æ‰€ä»¥ï¼Œæœ‰ Kubernetes ä¸€åŠå¤§çš„ä¸œè¥¿å°±æ˜¯ä¸€ä¸ª 5 ä¸ªå­—æ¯çš„å•è¯ï¼Œç®€å†™ä¸º K3s <code>(å…¶æ²¡æœ‰å…¨ç§°ï¼Œä¹Ÿæ²¡æœ‰å®˜æ–¹çš„å‘éŸ³)</code>ã€‚</p>
<p><br></p>
<p><strong>Q: ä¸ºä»€ä¹ˆä½¿ç”¨ K3S?</strong></p>
<blockquote>
<p>1) ç®€åŒ–å’Œå®‰å…¨ : K3s <code>å•ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å°äº50MBï¼Œå¯å‡å°‘å®‰è£…ã€è¿è¡Œå’Œè‡ªåŠ¨æ›´æ–°ç”Ÿäº§ Kubernetes é›†ç¾¤</code>æ‰€éœ€çš„ä¾èµ–å…³ç³»å’Œæ­¥éª¤ã€‚<br>2) è¾¹ç¼˜çš„å®Œç¾é€‰æ‹©: é«˜åº¦å¯ç”¨ã€ç»è¿‡è®¤è¯çš„ Kubernetes å‘è¡Œç‰ˆï¼Œä¸“ä¸ºæ— äººå€¼å®ˆã€èµ„æºå—é™çš„è¿œç¨‹ä½ç½®æˆ–<code>IoT è®¾å¤‡</code>å†…éƒ¨çš„ç”Ÿäº§å·¥ä½œè´Ÿè½½è€Œè®¾è®¡ã€‚<br>3) æ”¯æŒARMä¼˜åŒ– : K3S æä¾›äº† ARM64 å’Œ ARMv7 éƒ½æ”¯æŒäºŒè¿›åˆ¶æ–‡ä»¶å’Œå¤šæ¶æ„æ˜ åƒ, æ‰€ä»¥å¯ä»¥è¿è¡Œåœ¨<code>åµŒå…¥å¼è®¾å¤‡</code>ä¹‹ä¸­ã€‚<br>4) èµ„æºå ç”¨æ›´å°‘: ä¸ä»…èƒ½å¤Ÿ<code>ç¼©çŸ­å¯åŠ¨é›†ç¾¤</code>çš„æ—¶é—´ï¼Œè¿˜èƒ½å¤Ÿ<code>å‡å°‘é›†ç¾¤éœ€è¦æ¶ˆè€—çš„èµ„æº</code>ã€‚<br>5) å­˜å‚¨æœºåˆ¶ : ä½¿ç”¨åŸºäº <code>sqlite3</code>çš„è½»é‡çº§å­˜å‚¨åç«¯ä½œä¸ºé»˜è®¤å­˜å‚¨ï¼Œä½†åŒæ—¶æ”¯æŒä½¿ç”¨ <code>etcd3ã€MySQL å’Œ PostgreSQL</code> ä½œä¸ºå­˜å‚¨æœºåˆ¶ã€‚<br>6) å†…ç½®å¢å¼ºåŠŸèƒ½ : æ·»åŠ äº†ç®€å•ä½†åŠŸèƒ½å¼ºå¤§çš„<code>batteries-included</code>åŠŸèƒ½ï¼Œä¾‹å¦‚ <code>æœ¬åœ°å­˜å‚¨æä¾›ç¨‹åºï¼ŒæœåŠ¡è´Ÿè½½å‡è¡¡å™¨ï¼ŒHelm controller å’Œ Traefik Ingress controller</code>, æ‰€æœ‰ <code>Kubernetes control-plane</code> ç»„ä»¶çš„æ“ä½œéƒ½å°è£…åœ¨å•ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å’Œè¿›ç¨‹ä¸­ï¼Œä½¿ K3s å…·æœ‰è‡ªåŠ¨åŒ–å’Œç®¡ç†åŒ…æ‹¬è¯ä¹¦åˆ†å‘åœ¨å†…çš„å¤æ‚é›†ç¾¤æ“ä½œçš„èƒ½åŠ›ã€‚<br>7) æ›´å°‘çš„ä¾èµ– : æœ€å¤§ç¨‹åº¦å‡è½»äº†å¤–éƒ¨ä¾èµ–æ€§ï¼ŒK3s ä»…éœ€è¦ kernel å’Œ cgroup æŒ‚è½½ã€‚</p>
</blockquote>
<p><br></p>
<p><strong>K3S å·¥ä½œåŸç†</strong></p>
<blockquote>
<p>æè¿°: K3S å®ƒç”± Server ä¸ Agent ä¸¤å¤§èŠ‚ç‚¹ç»„æˆï¼Œå…¶ä¸­K3s server æ˜¯è¿è¡Œk3s serverå‘½ä»¤çš„æœºå™¨ï¼ˆè£¸æœºæˆ–è™šæ‹Ÿæœºï¼‰ï¼Œè€Œ K3s worker èŠ‚ç‚¹æ˜¯è¿è¡Œk3s agentå‘½ä»¤çš„æœºå™¨ã€‚</p>
</blockquote>
<figure class="image-box">
                <a rel=K3sä¹‹å¿«é€Ÿæ­å»ºç²¾ç®€ç‰ˆæœ¬K8Sé›†ç¾¤ç¯å¢ƒ href="https://img.weiyigeek.top/2022/10/20221030161233.png" target="_blank" title="WeiyiGeek.K3Så·¥ä½œåŸç†å›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/10/20221030161233.png" alt="WeiyiGeek.K3Så·¥ä½œåŸç†å›¾" title="" class=""></a>
                <p>WeiyiGeek.K3Så·¥ä½œåŸç†å›¾</p>
            </figure>
<p><br></p>
<p><strong>K3S æ¶æ„å›¾</strong></p>
<p>æœ‰å•èŠ‚ç‚¹ã€é«˜å¯ç”¨ç­‰å¤šç§æ¶æ„æ–¹å¼ï¼Œä½ å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©æ¶æ„æ–¹å¼ã€‚</p>
<ul>
<li>å•èŠ‚ç‚¹æ¶æ„ï¼šæœ‰ä¸€ä¸ªå†…åµŒ SQLite æ•°æ®åº“çš„å•èŠ‚ç‚¹ K3s serverï¼Œåœ¨æ­¤ç§é…ç½®ä¸­æ¯ä¸ª agent èŠ‚ç‚¹éƒ½æ³¨å†Œåˆ°åŒä¸€ä¸ª server èŠ‚ç‚¹ã€‚</li>
<li>é«˜å¯ç”¨æ¶æ„: å¤šä¸ªK3s ServerèŠ‚ç‚¹ä¸º Kubernetes API æä¾›æœåŠ¡å¹¶è¿è¡Œå…¶ä»– control-plane æœåŠ¡ï¼Œå¹¶éœ€æŒ‚è½½ä¸€ä¸ªexternal databaseå¤–éƒ¨æ•°æ®åº“ä½œä¸ºæ•°æ®å­˜å‚¨çš„åª’ä»‹ã€‚</li>
</ul>
<figure class="image-box">
                <a rel=K3sä¹‹å¿«é€Ÿæ­å»ºç²¾ç®€ç‰ˆæœ¬K8Sé›†ç¾¤ç¯å¢ƒ href="https://img.weiyigeek.top/2022/10/20221030160739.png" target="_blank" title="WeiyiGeek.K3Sæ¶æ„å›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/10/20221030160739.png" alt="WeiyiGeek.K3Sæ¶æ„å›¾" title="" class=""></a>
                <p>WeiyiGeek.K3Sæ¶æ„å›¾</p>
            </figure>
<p><br></p>
<p><strong>K3S Agent èŠ‚ç‚¹</strong><br>Agent èŠ‚ç‚¹ ç”¨k3s agentè¿›ç¨‹å‘èµ·çš„ websocket è¿æ¥æ³¨å†Œï¼Œè¿æ¥ç”±ä½œä¸ºä»£ç†è¿›ç¨‹ä¸€éƒ¨åˆ†è¿è¡Œçš„å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å™¨ç»´æŠ¤ã€‚</p>
<p>Agent å°†ä½¿ç”¨èŠ‚ç‚¹é›†ç¾¤ secret ä»¥åŠéšæœºç”Ÿæˆçš„èŠ‚ç‚¹å¯†ç å‘ k3s server æ³¨å†Œ, å¯†ç å­˜å‚¨åœ¨ <code>/etc/rancher/node/password</code> è·¯å¾„ä¸‹, K3s server å°†æŠŠå„ä¸ªèŠ‚ç‚¹çš„å¯†ç å­˜å‚¨ä¸º Kubernetes secretsï¼Œéšåçš„ä»»ä½•å°è¯•éƒ½å¿…é¡»ä½¿ç”¨ç›¸åŒçš„å¯†ç ,èŠ‚ç‚¹å¯†ç ç§˜å¯†å­˜å‚¨åœ¨kube-systemå‘½åç©ºé—´ä¸­ï¼Œåç§°ä½¿ç”¨æ¨¡æ¿<code>&lt;host&gt;.node-password.k3s</code></p>
<p>æ¸©é¦¨æç¤º:</p>
<ul>
<li>åœ¨ K3s v1.20.2 ä¹‹å‰ï¼ŒK3s server å°†å¯†ç å­˜å‚¨åœ¨ <code>/var/lib/rancher/k3s/server/cred/node-passwd</code> çš„ç£ç›˜ä¸Šã€‚</li>
<li>å¦‚æœæ‚¨åˆ é™¤äº† agent çš„/etc/rancher/node ç›®å½•ï¼Œåˆ™éœ€è¦ä¸ºè¯¥ agent é‡æ–°åˆ›å»ºå¯†ç æ–‡ä»¶ï¼Œæˆ–è€…ä» server ä¸­åˆ é™¤è¯¥æ¡ç›®ã€‚</li>
<li>é€šè¿‡ä½¿ç”¨ <code>--with-node-id</code> æ ‡å¿—å¯åŠ¨ K3s server æˆ– agentï¼Œå¯ä»¥å°†å”¯ä¸€çš„èŠ‚ç‚¹ ID é™„åŠ åˆ°ä¸»æœºåä¸­ã€‚</li>
</ul>
<p><br></p>
<p><strong>K3s åº”ç”¨åœºæ™¯</strong><br>æè¿°ï¼š ç”±äºè¿è¡Œ K3s æ‰€éœ€çš„èµ„æºç›¸å¯¹è¾ƒå°‘ï¼Œæ‰€ä»¥ K3s ä¹Ÿé€‚ç”¨äºå¼€å‘å’Œæµ‹è¯•åœºæ™¯ï¼Œä»¥åŠ<code>è¾¹ç¼˜è®¡ç®—-Edgeã€ç‰©è”ç½‘-IoTã€CIã€ARMã€åµŒå…¥ K8s</code>ç­‰åœºæ™¯ä¸­ï¼<br>ç»¼ä¸Šæ‰€è¿°ï¼Œä½¿ç”¨ K3s ä¸ä»…èƒ½å¤Ÿç¼©çŸ­å¯åŠ¨é›†ç¾¤çš„æ—¶é—´ï¼Œè¿˜èƒ½å¤Ÿå‡å°‘é›†ç¾¤éœ€è¦æ¶ˆè€—çš„èµ„æºã€‚</p>
<hr>
<h2 id="0x01-å®‰è£…å®è·µ"><a href="#0x01-å®‰è£…å®è·µ" class="headerlink" title="0x01 å®‰è£…å®è·µ"></a>0x01 å®‰è£…å®è·µ</h2><h3 id="1-ç¯å¢ƒè¦æ±‚"><a href="#1-ç¯å¢ƒè¦æ±‚" class="headerlink" title="1.ç¯å¢ƒè¦æ±‚"></a>1.ç¯å¢ƒè¦æ±‚</h3><p>æè¿°: æ— è®ºæ‚¨æ˜¯å°† K3s é›†ç¾¤é…ç½®ä¸ºåœ¨ Docker è¿˜æ˜¯ Kubernetes è®¾ç½®ä¸­è¿è¡Œï¼Œè¿è¡Œ K3 çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åº”æ»¡è¶³ä»¥ä¸‹æœ€ä½è¦æ±‚ã€‚</p>
<p><strong>æµ‹è¯•ç¯å¢ƒ</strong></p>
<ul>
<li>ç¡¬ä»¶: å†…å­˜æœ€å°‘512MBï¼ˆå»ºè®®è‡³å°‘1GBï¼‰, CPU æœ€å°‘ä¸€ä¸ª, ç£ç›˜æœ€å¥½ä½¿ç”¨SSDã€‚</li>
<li>è½¯ä»¶: é€‰æ‹©å¸¸ç”¨çš„æ“ä½œç³»ç»Ÿä¾‹å¦‚<code>Ubuntuã€Debianã€CentOS</code>ç­‰, ä½†æ˜¯é’ˆå¯¹æŸäº›æ“ä½œç³»ç»Ÿæœ‰ç‰¹å®šè¦æ±‚ä¾‹å¦‚ <code>Red Hat/CentOS</code>ã€<code>Alpine Linux</code>å’Œ<code>Raspbian Buster</code>.</li>
<li>å…ˆå†³æ¡ä»¶ï¼š<ul>
<li>èŠ‚ç‚¹ä¸èƒ½å…·æœ‰ç›¸åŒçš„ä¸»æœºå</li>
<li>é˜²ç«å¢™éœ€è¦å¯¹k3s Server çš„ 6443ç«¯å£ æ”¾è¡Œï¼Œå› ä¸º K3sæœåŠ¡å™¨éœ€è¦ç«¯å£ 6443 æ‰èƒ½è¢«æ‰€æœ‰èŠ‚ç‚¹è®¿é—®ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ç”Ÿäº§ç¯å¢ƒ</strong><br>å¯¹äºç”Ÿäº§ç¯å¢ƒä¸­çš„å¤–éƒ¨æ•°æ®åº“ï¼Œå»ºè®®ä½¿ç”¨ä»¥ä¸‹æ•°æ®åº“<code>MySQL ï¼ˆå¸¸ç”¨ï¼‰/ PostgreSQL / etcd</code>ï¼Œå¹¶ä¸”ç¡¬ä»¶è¦æ±‚å–å†³äº K3s é›†ç¾¤çš„å¤§å°ä»¥ä¸‹æ˜¯é«˜å¯ç”¨æ€§K3sæœåŠ¡å™¨ä¸­èŠ‚ç‚¹çš„æœ€ä½CPUå’Œå†…å­˜è¦æ±‚ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">DEPLOYMENT SIZE</th>
<th style="text-align:left">NODES</th>
<th style="text-align:left">VCPUS</th>
<th style="text-align:left">RAM</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Small</td>
<td style="text-align:left">Up to 10</td>
<td style="text-align:left">2</td>
<td style="text-align:left">4 GB</td>
</tr>
<tr>
<td style="text-align:left">Medium</td>
<td style="text-align:left">Up to 100</td>
<td style="text-align:left">4</td>
<td style="text-align:left">8 GB</td>
</tr>
<tr>
<td style="text-align:left">Large</td>
<td style="text-align:left">Up to 250</td>
<td style="text-align:left">8</td>
<td style="text-align:left">16 GB</td>
</tr>
<tr>
<td style="text-align:left">X-Large</td>
<td style="text-align:left">Up to 500</td>
<td style="text-align:left">16</td>
<td style="text-align:left">32 GB</td>
</tr>
<tr>
<td style="text-align:left">XX-Large</td>
<td style="text-align:left">500+</td>
<td style="text-align:left">32</td>
<td style="text-align:left">64 GB</td>
</tr>
</tbody>
</table>
<p><br></p>
<p><strong>K3s è½¯ä»¶åŒ…éœ€è¦çš„ä¾èµ–é¡¹åŒ…æ‹¬</strong></p>
<ul>
<li>containerd</li>
<li>Flannel</li>
<li>CoreDNS</li>
<li>CNI</li>
<li>ä¸»æœºå®ç”¨ç¨‹åºï¼ˆiptablesã€socat ç­‰ï¼‰</li>
<li>Ingress controllerï¼ˆTraefikï¼‰</li>
<li>åµŒå…¥å¼æœåŠ¡è´Ÿè½½å‡è¡¡å™¨ï¼ˆservice load balancerï¼‰</li>
<li>åµŒå…¥å¼ç½‘ç»œç­–ç•¥æ§åˆ¶å™¨ï¼ˆnetwork policy controllerï¼‰</li>
</ul>
<p><br></p>
<p><strong>æœåŠ¡ç«¯å£</strong></p>
<p>K3sæœåŠ¡å™¨èŠ‚ç‚¹çš„å…¥ç«™è§„åˆ™(Inbound Rules for K3s Server Nodes)</p>
<table>
<thead>
<tr>
<th style="text-align:left">PROTOCOL</th>
<th style="text-align:left">PORT</th>
<th style="text-align:left">SOURCE</th>
<th style="text-align:left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">TCP</td>
<td style="text-align:left">6443</td>
<td style="text-align:left">K3s agent nodes</td>
<td style="text-align:left">Kubernetes API Server</td>
</tr>
<tr>
<td style="text-align:left">UDP</td>
<td style="text-align:left">8472</td>
<td style="text-align:left">K3s server and agent nodes</td>
<td style="text-align:left">Required only for Flannel VXLAN</td>
</tr>
<tr>
<td style="text-align:left">UDP</td>
<td style="text-align:left">51820</td>
<td style="text-align:left">K3s server and agent nodes</td>
<td style="text-align:left">Required only for Flannel Wireguard backend</td>
</tr>
<tr>
<td style="text-align:left">UDP</td>
<td style="text-align:left">51821</td>
<td style="text-align:left">K3s server and agent nodes</td>
<td style="text-align:left">Required only for Flannel Wireguard backend with IPv6</td>
</tr>
<tr>
<td style="text-align:left">TCP</td>
<td style="text-align:left">10250</td>
<td style="text-align:left">K3s server and agent nodes</td>
<td style="text-align:left">Kubelet metrics</td>
</tr>
<tr>
<td style="text-align:left">TCP</td>
<td style="text-align:left">2379-2380</td>
<td style="text-align:left">K3s server nodes</td>
<td style="text-align:left">Required only for HA with embedded etcd</td>
</tr>
</tbody>
</table>
<p>å½“å‰ã€2022å¹´6æœˆ14æ—¥ 22:04:49ã€‘èŠ‚ç‚¹æœ€æ–°ç‰ˆæœ¬ä¸º v1.24.1+k3s1 (<a href="https://github.com/k3s-io/k3s/releases/tag/v1.24.1+k3s1" target="_blank" rel="noopener">https://github.com/k3s-io/k3s/releases/tag/v1.24.1+k3s1</a>)</p>
<p><br/></p>
<h3 id="2-è„šæœ¬åœ¨çº¿å®‰è£…"><a href="#2-è„šæœ¬åœ¨çº¿å®‰è£…" class="headerlink" title="2.è„šæœ¬åœ¨çº¿å®‰è£…"></a>2.è„šæœ¬åœ¨çº¿å®‰è£…</h3><p>æè¿°ï¼šk3så®˜æ–¹æä¾›çš„ä¸€é”®å®‰è£…è„šæœ¬ä»…éœ€30ç§’å³å¯å¯åŠ¨k3sï¼Œä½†æ˜¯å›½å†…ç”¨æˆ·ä½¿ç”¨å®˜æ–¹é“¾æ¥ä¸‹è½½å®‰è£…å·¨æ…¢æ— æ¯”ï¼Œå¥½åœ¨æä¾›äº†å›½å†…å¿«é€Ÿå®‰è£…æ–¹æ³•è„šæœ¬ã€‚</p>
<p><strong>ç¯å¢ƒå˜é‡</strong><br>ä½¿ç”¨æ­¤æ–¹æ³•å®‰è£… K3s æ—¶ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹ç¯å¢ƒå˜é‡æ¥é…ç½®å®‰è£…é€‰é¡¹ï¼ˆé‡ç‚¹ï¼‰ï¼š</p>
<ul>
<li>INSTALL_K3S_SKIP_DOWNLOAD ï¼šå¦‚æœè®¾ç½®ä¸º â€œtrue â€œå°†ä¸ä¼šä¸‹è½½ K3s çš„å“ˆå¸Œå€¼æˆ–äºŒè¿›åˆ¶ã€‚</li>
<li>INSTALL_K3S_SYMLINK ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœè·¯å¾„ä¸­ä¸å­˜åœ¨å‘½ä»¤ï¼Œå°†ä¸º kubectlã€crictl å’Œ ctr äºŒè¿›åˆ¶æ–‡ä»¶åˆ›å»ºç¬¦å·é“¾æ¥ã€‚å¦‚æœè®¾ç½®ä¸ºâ€™skipâ€™å°†ä¸ä¼šåˆ›å»ºç¬¦å·é“¾æ¥ï¼Œè€Œâ€™forceâ€™å°†è¦†ç›–ã€‚</li>
<li>INSTALL_K3S_SKIP_ENABLE ï¼šå¦‚æœè®¾ç½®ä¸º â€œtrueâ€ï¼Œå°†ä¸å¯ç”¨æˆ–å¯åŠ¨ K3s æœåŠ¡ã€‚</li>
<li>INSTALL_K3S_SKIP_START ï¼šå¦‚æœè®¾ç½®ä¸º â€œtrue â€œå°†ä¸ä¼šå¯åŠ¨ K3s æœåŠ¡ã€‚</li>
<li>INSTALL_K3S_VERSION ï¼šä» Github ä¸‹è½½ K3s çš„ç‰ˆæœ¬ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œå°†å°è¯•ä»â€stableâ€é¢‘é“ä¸‹è½½ã€‚</li>
<li>INSTALL_K3S_BIN_DIR ï¼šå®‰è£… K3s äºŒè¿›åˆ¶æ–‡ä»¶ã€é“¾æ¥å’Œå¸è½½è„šæœ¬çš„ç›®å½•ï¼Œæˆ–è€…ä½¿ç”¨/usr/local/binä½œä¸ºé»˜è®¤ç›®å½•ã€‚</li>
<li>INSTALL_K3S_BIN_DIR_READ_ONLY ï¼šå¦‚æœè®¾ç½®ä¸º true å°†ä¸ä¼šæŠŠæ–‡ä»¶å†™å…¥INSTALL_K3S_BIN_DIRï¼Œå¼ºåˆ¶è®¾ç½®INSTALL_K3S_SKIP_DOWNLOAD=trueã€‚</li>
<li>INSTALL_K3S_SYSTEMD_DIR ï¼šå®‰è£… systemd æœåŠ¡å’Œç¯å¢ƒæ–‡ä»¶çš„ç›®å½•ï¼Œæˆ–è€…ä½¿ç”¨/etc/systemd/systemä½œä¸ºé»˜è®¤ç›®å½•ã€‚</li>
<li>INSTALL_K3S_EXEC ï¼šå¸¦æœ‰æ ‡å¿—çš„å‘½ä»¤ï¼Œç”¨äºåœ¨æœåŠ¡ä¸­å¯åŠ¨ K3sã€‚å¦‚æœæœªæŒ‡å®šå‘½ä»¤ï¼Œå¹¶ä¸”è®¾ç½®äº†K3S_URLï¼Œå®ƒå°†é»˜è®¤ä¸ºâ€œagentâ€ã€‚å¦‚æœæœªè®¾ç½®K3S_URLï¼Œå®ƒå°†é»˜è®¤ä¸ºâ€œserverâ€ã€‚è¦è·å¾—å¸®åŠ©ï¼Œè¯·å‚è€ƒæ­¤ç¤ºä¾‹ã€‚</li>
<li>INSTALL_K3S_NAME ï¼šè¦åˆ›å»ºçš„ systemd æœåŠ¡åç§°ï¼Œå¦‚æœä»¥æœåŠ¡å™¨æ–¹å¼è¿è¡Œ k3sï¼Œåˆ™é»˜è®¤ä¸ºâ€™k3sâ€™ï¼›å¦‚æœä»¥ agent æ–¹å¼è¿è¡Œ k3sï¼Œåˆ™é»˜è®¤ä¸ºâ€™k3s-agentâ€™ã€‚å¦‚æœæŒ‡å®šäº†æœåŠ¡åï¼Œåˆ™æœåŠ¡åå°†ä»¥â€™k3s-â€˜ä¸ºå‰ç¼€ã€‚</li>
<li>INSTALL_K3S_TYPE ï¼šè¦åˆ›å»ºçš„ systemd æœåŠ¡ç±»å‹ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œå°†é»˜è®¤ä½¿ç”¨ K3s exec å‘½ä»¤ã€‚</li>
<li>INSTALL_K3S_SELINUX_WARN ï¼šå¦‚æœè®¾ç½®ä¸º trueï¼Œåˆ™åœ¨æ²¡æœ‰æ‰¾åˆ° k3s-selinux ç­–ç•¥çš„æƒ…å†µä¸‹å°†ç»§ç»­ã€‚</li>
<li>INSTALL_K3S_SKIP_SELINUX_RPM ï¼šå¦‚æœè®¾ç½®ä¸º â€œtrue â€œå°†è·³è¿‡ k3s RPM çš„è‡ªåŠ¨å®‰è£…ã€‚</li>
<li>INSTALL_K3S_CHANNEL_URL ï¼šç”¨äºè·å– K3s ä¸‹è½½ç½‘å€çš„é¢‘é“ URLã€‚é»˜è®¤ä¸º <a href="https://update.k3s.io/v1-release/channels" target="_blank" rel="noopener">https://update.k3s.io/v1-release/channels</a> ã€‚</li>
<li>INSTALL_K3S_CHANNEL ï¼šç”¨äºè·å– K3s ä¸‹è½½ URL çš„é€šé“ã€‚é»˜è®¤å€¼ä¸º â€œstableâ€ã€‚é€‰é¡¹åŒ…æ‹¬ï¼šstable, latest, testingã€‚</li>
<li>K3S_CONFIG_FILE ï¼šæŒ‡å®šé…ç½®æ–‡ä»¶çš„ä½ç½®ã€‚é»˜è®¤ç›®å½•ä¸º/etc/rancher/k3s/config.yamlã€‚</li>
<li>K3S_TOKEN    ï¼šç”¨äºå°† server æˆ– agent åŠ å…¥é›†ç¾¤çš„å…±äº« secretã€‚</li>
<li>K3S_TOKEN_FILE ï¼šæŒ‡å®š cluster-secret,token çš„æ–‡ä»¶ç›®å½•ã€‚</li>
<li>INSTALL_K3S_MIRROR: ä½¿ç”¨å›½å†…é•œåƒæºè¿›è¡Œå®‰è£…</li>
</ul>
<p><strong>æ“ä½œæ­¥éª¤</strong></p>
<p>æ­¥éª¤01.å›½å†…ä½¿ç”¨å®‰è£…è„šæœ¬å¿«é€Ÿå®‰è£…å•èŠ‚ç‚¹å®ä¾‹çš„k3sç¯å¢ƒã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0.æ­¤å¤„ç¯å¢ƒä¸ºUbuntu 22.04 ä¸Šè¿›è¡Œå®è·µå®‰è£…</span></span><br><span class="line">uname -a</span><br><span class="line">  <span class="comment"># Linux Ubuntu-Security 5.15.0-48-generic #54-Ubuntu SMP Fri Aug 26 13:26:29 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.ä½¿ç”¨https://get.k3s.io æä¾›çš„å®‰è£…è„šæœ¬åœ¨åŸºäº systemd å’Œ openrc çš„ç³»ç»Ÿä¸Šå®‰è£… K3s ä½œä¸ºæœåŠ¡ã€‚</span></span><br><span class="line"><span class="comment"># Check for Ready node, takes maybe 30 seconds</span></span><br><span class="line">curl -sfL https://get.k3s.io | INSTALL_K3S_CHANNEL=latest sh -</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.å›½å†…ç”¨æˆ·ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•åŠ é€Ÿå®‰è£…ï¼š</span></span><br><span class="line">curl -sfL https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn INSTALL_K3S_CHANNEL=latest K3S_TOKEN=k3s.weiyigeek.top sh -s - \</span><br><span class="line">     --system-default-registry <span class="string">"registry.cn-hangzhou.aliyuncs.com"</span></span><br><span class="line"><span class="comment"># ç¦»çº¿å®‰è£…ï¼šINSTALL_K3S_MIRROR=cn INSTALL_K3S_CHANNEL=latest K3S_TOKEN=k3s.weiyigeek.top ./k3s-install.sh --system-default-registry "registry.cn-hangzhou.aliyuncs.com"</span></span><br><span class="line"><span class="comment"># æ‰§è¡Œç»“æœ: </span></span><br><span class="line">  <span class="comment"># [INFO]  Finding release for channel latest</span></span><br><span class="line">  <span class="comment"># [INFO]  Using v1.25.3+k3s1 as release</span></span><br><span class="line">  <span class="comment"># [INFO]  Downloading hash rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/v1.25.3-k3s1/sha256sum-amd64.txt</span></span><br><span class="line">  <span class="comment"># [INFO]  Downloading binary rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/v1.25.3-k3s1/k3s</span></span><br><span class="line">  <span class="comment"># [INFO]  Verifying binary download</span></span><br><span class="line">  <span class="comment"># [INFO]  Installing k3s to /usr/local/bin/k3s</span></span><br><span class="line">  <span class="comment"># [INFO]  Skipping installation of SELinux RPM</span></span><br><span class="line">  <span class="comment"># [INFO]  Creating /usr/local/bin/kubectl symlink to k3s</span></span><br><span class="line">  <span class="comment"># [INFO]  Creating /usr/local/bin/crictl symlink to k3s</span></span><br><span class="line">  <span class="comment"># [INFO]  Creating /usr/local/bin/ctr symlink to k3s</span></span><br><span class="line">  <span class="comment"># [INFO]  Creating killall script /usr/local/bin/k3s-killall.sh</span></span><br><span class="line">  <span class="comment"># [INFO]  Creating uninstall script /usr/local/bin/k3s-uninstall.sh</span></span><br><span class="line">  <span class="comment"># [INFO]  env: Creating environment file /etc/systemd/system/k3s.service.env</span></span><br><span class="line">  <span class="comment"># [INFO]  systemd: Creating service file /etc/systemd/system/k3s.service</span></span><br><span class="line">  <span class="comment"># [INFO]  systemd: Enabling k3s unit</span></span><br><span class="line">  <span class="comment"># Created symlink /etc/systemd/system/multi-user.target.wants/k3s.service â†’ /etc/systemd/system/k3s.service.</span></span><br><span class="line">  <span class="comment"># [INFO]  systemd: Starting k3s  # è¡¨ç¤ºå®‰è£…å’Œk3sæœåŠ¡å¯åŠ¨æˆåŠŸ</span></span><br><span class="line"></span><br><span class="line">$ ls /usr/<span class="built_in">local</span>/bin</span><br><span class="line">crictl  ctr  k3s  k3s-killall.sh  k3s-uninstall.sh</span><br></pre></td></tr></table></figure>
<p><br/></p>
<p>æ­¥éª¤ 02.æŸ¥çœ‹k3sæœåŠ¡å®‰è£…ç¯å¢ƒéªŒè¯ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.æŸ¥çœ‹k3sæœåŠ¡çŠ¶æ€</span></span><br><span class="line">systemctl status -l k3s.service</span><br><span class="line">â— k3s.service - Lightweight Kubernetes</span><br><span class="line">     Loaded: loaded (/etc/systemd/system/k3s.service; enabled; vendor preset: enabled)</span><br><span class="line">     Active: active (running) since Sun 2022-10-30 14:27:16 CST; 3min 55s ago</span><br><span class="line">       Docs: https://k3s.io</span><br><span class="line">    Process: 84116 ExecStartPre=/bin/sh -xc ! /usr/bin/systemctl is-enabled --quiet nm-cloud-setup.service (code=exited, status=0/SUCCESS)</span><br><span class="line">    Process: 84118 ExecStartPre=/sbin/modprobe br_netfilter (code=exited, status=0/SUCCESS)</span><br><span class="line">    Process: 84122 ExecStartPre=/sbin/modprobe overlay (code=exited, status=0/SUCCESS)</span><br><span class="line">   Main PID: 84123 (k3s-server)</span><br><span class="line">      Tasks: 116</span><br><span class="line">     Memory: 1.2G</span><br><span class="line">        CPU: 40.024s</span><br><span class="line">     CGroup: /system.slice/k3s.service</span><br><span class="line">             â”œâ”€84123 <span class="string">"/usr/local/bin/k3s server"</span></span><br><span class="line">             â”œâ”€84169 containerd -c /var/lib/rancher/k3s/agent/etc/containerd/config.toml -a /run/k3s/containerd/containerd.sock --state /run/k3s/containerd --root /var/lib/rancher/k3s/agent/containerd</span><br><span class="line">             .......</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æŸ¥çœ‹ k3s èŠ‚ç‚¹ç›¸å…³</span></span><br><span class="line">k3s kubectl get node --show-labels -o wide</span><br><span class="line">  <span class="comment"># NAME              STATUS   ROLES                  AGE     VERSION        INTERNAL-IP     EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION      CONTAINER-RUNTIME         LABELS</span></span><br><span class="line">  <span class="comment"># ubuntu-security   Ready    control-plane,master   2m17s   v1.25.3+k3s1   10.10.107.201   &lt;none&gt;        Ubuntu 22.04.1 LTS   5.15.0-48-generic   containerd://1.6.8-k3s1   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/instance-type=k3s,beta.kubernetes.io/os=linux,egress.k3s.io/cluster=true,kubernetes.io/arch=amd64,kubernetes.io/hostname=ubuntu-security,kubernetes.io/os=linux,node-role.kubernetes.io/control-plane=true,node-role.kubernetes.io/master=true,node.kubernetes.io/instance-type=k3s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æŸ¥çœ‹ k3s é›†ç¾¤é…ç½®æ–‡ä»¶</span></span><br><span class="line">k3s kubectl cluster-info</span><br><span class="line">  <span class="comment"># Kubernetes control plane is running at https://127.0.0.1:6443</span></span><br><span class="line">  <span class="comment"># CoreDNS is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span></span><br><span class="line">  <span class="comment"># Metrics-server is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/https:metrics-server:https/proxy</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>æ­¥éª¤ 03.åœ¨ å°è¯•åœ¨ k3s ç¯å¢ƒä¸­å¿«é€Ÿåˆ›å»º hello world Pod å®¹å™¨, æ­¤å¤„ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨kubectlå‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®åˆ«åæˆ–è€…ç›´æ¥ä¸‹è½½kubernetesæœ€æ–°çš„äºŒè¿›åˆ¶å®¢æˆ·ç«¯æ–‡ä»¶(kubectl) ï¼Œä¸‹è½½åœ°å€ã€ <a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.26.md" target="_blank" rel="noopener">https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.26.md</a> ã€‘ã€‚</p>
<figure class="image-box">
                <a rel=K3sä¹‹å¿«é€Ÿæ­å»ºç²¾ç®€ç‰ˆæœ¬K8Sé›†ç¾¤ç¯å¢ƒ href="https://img.weiyigeek.top/2022/10/20221230142308.png" target="_blank" title="WeiyiGeek.è½½kubernetesæœ€æ–°çš„äºŒè¿›åˆ¶å®¢æˆ·ç«¯æ–‡ä»¶ä¸‹è½½å›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/10/20221230142308.png" alt="WeiyiGeek.è½½kubernetesæœ€æ–°çš„äºŒè¿›åˆ¶å®¢æˆ·ç«¯æ–‡ä»¶ä¸‹è½½å›¾" title="" class=""></a>
                <p>WeiyiGeek.è½½kubernetesæœ€æ–°çš„äºŒè¿›åˆ¶å®¢æˆ·ç«¯æ–‡ä»¶ä¸‹è½½å›¾</p>
            </figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0.è®¿é—®k8sé¡¹ç›®Releaseé¦–é¡µ,ç„¶åå¯ä»¥æŸ¥çœ‹åˆ°æœ€æ–°ç‰ˆæœ¬ä»¥åŠæ ‡æ³¨å‡ºæ¥çš„"CHANGELOG"ï¼Œç‚¹å‡» Client Binaryã€‚</span></span><br><span class="line"><span class="comment"># https://github.com/kubernetes/kubernetes/releases</span></span><br><span class="line"><span class="comment"># Downloads for v1.26.0</span></span><br><span class="line"><span class="comment">#     Source Code</span></span><br><span class="line"><span class="comment">#     Client Binaries</span></span><br><span class="line"><span class="comment">#     Server Binaries </span></span><br><span class="line"><span class="comment">#     Node Binaries</span></span><br><span class="line"><span class="comment">#     Container Images</span></span><br><span class="line"></span><br><span class="line">wget https://dl.k8s.io/v1.26.0/kubernetes-client-linux-amd64.tar.gz &amp;&amp;  tar -zxvf kubernetes-client-linux-amd64.tar.gz</span><br><span class="line">cp kubernetes/client/bin/kubectl /usr/<span class="built_in">local</span>/bin/kubectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªåŠ¨è¡¥é½</span></span><br><span class="line">apt install -y bash-completion &amp;&amp; <span class="built_in">source</span> /usr/share/bash-completion/bash_completion</span><br><span class="line"><span class="built_in">source</span> &lt;(kubectl completion bash)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"source &lt;(kubectl completion bash)"</span> &gt;&gt; ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.è®¾ç½® kubeconfig æ–‡ä»¶è·¯å¾„ç”¨äºå¯¹ Kubernetes é›†ç¾¤çš„è®¿é—®ã€‚</span></span><br><span class="line"><span class="built_in">export</span> KUBECONFIG=/etc/rancher/k3s/k3s.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æŸ¥çœ‹è¿è¡Œæ­£å¸¸åçš„kube-systemåç§°ç©ºé—´ä¸‹çš„podä¿¡æ¯ã€‚</span></span><br><span class="line">$ k3s kubectl get node --show-labels</span><br><span class="line">  NAME        STATUS   ROLES                  AGE   VERSION        LABELS</span><br><span class="line">  master-01   Ready    control-plane,master   65s   v1.25.3+k3s1   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/instance-type=k3s,beta.kubernetes.io/os=linux,egress.k3s.io/cluster=<span class="literal">true</span>,kubernetes.io/arch=amd64,kubernetes.io/hostname=master-01,kubernetes.io/os=linux,node-role.kubernetes.io/control-plane=<span class="literal">true</span>,node-role.kubernetes.io/master=<span class="literal">true</span>,node.kubernetes.io/instance-type=k3s</span><br><span class="line"></span><br><span class="line">$ kubectl get pod -A</span><br><span class="line">  NAMESPACE     NAME                                      READY   STATUS      RESTARTS   AGE</span><br><span class="line">  kube-system   coredns-64858695d9-87272                  1/1     Running     0          88s</span><br><span class="line">  kube-system   <span class="built_in">local</span>-path-provisioner-858c864885-kcgzp   1/1     Running     0          88s</span><br><span class="line">  kube-system   helm-install-traefik-crd-qnkdm            0/1     Completed   0          88s</span><br><span class="line">  kube-system   metrics-server-5d7f9fc86-8jhqk            1/1     Running     0          88s</span><br><span class="line">  kube-system   svclb-traefik-4e10ea70-9s2nf              2/2     Running     0          61s</span><br><span class="line">  kube-system   helm-install-traefik-qjdss                0/1     Completed   1          88s</span><br><span class="line">  kube-system   traefik-b4bf7b498-fkbb5                   1/1     Running     0          61s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.Pod åˆ›å»ºæµ‹è¯•ä¸è¿è¡ŒæŸ¥çœ‹</span></span><br><span class="line">kubectl run hello-k3s --image=alpine:latest --image-pull-policy=IfNotPresent --restart=Never --env=<span class="string">"project=k3s"</span> --labels=<span class="string">"app=helloworld"</span>  --<span class="built_in">command</span> -- <span class="built_in">echo</span> <span class="string">"hello world! K3s !"</span></span><br><span class="line">kubectl get pod --show-labels -o wide</span><br><span class="line">  <span class="comment"># NAME        READY   STATUS      RESTARTS   AGE   IP           NODE              NOMINATED NODE   READINESS GATES   LABELS</span></span><br><span class="line">  <span class="comment"># hello-k3s   0/1     Completed   0          29s   10.42.0.17   ubuntu-security   &lt;none&gt;           &lt;none&gt;            app=helloworld</span></span><br><span class="line"></span><br><span class="line">kubectl logs -f hello-k3s</span><br><span class="line">  <span class="comment"># hello world! K3s !</span></span><br></pre></td></tr></table></figure>
<p><a rel=K3sä¹‹å¿«é€Ÿæ­å»ºç²¾ç®€ç‰ˆæœ¬K8Sé›†ç¾¤ç¯å¢ƒ href="https://img.weiyigeek.top/2022/10/20221030150916.png" target="_blank" title="WeiyiGeek.k3så®‰è£…å®Œæˆåé»˜è®¤èµ„æºå›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2022/10/20221030150916.png" alt="WeiyiGeek.k3så®‰è£…å®Œæˆåé»˜è®¤èµ„æºå›¾"></a></p>
<p><br/></p>
<p>æ­¥éª¤ 04.ä¸€æ¡å‘½ä»¤å°†å…¶ä»–å·¥ä½œèŠ‚ç‚¹åŠ å…¥åˆ°k3sé›†ç¾¤ç®¡ç†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server-ip=10.10.107.201</span><br><span class="line">k3s-token=k3s.weiyigeek.top</span><br><span class="line">curl -sfL http://rancher-mirror.cnrancher.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn K3S_URL=https://<span class="variable">$&#123;server-ip&#125;</span>:6443 K3S_TOKEN=<span class="variable">$&#123;k3s-token&#125;</span> sh -</span><br></pre></td></tr></table></figure>
<p><br/></p>
<p>æ­¥éª¤ 05. å¸è½½ K3s å¦‚æœæ‚¨ä½¿ç”¨å®‰è£…è„šæœ¬å®‰è£…äº† K3sï¼Œé‚£ä¹ˆåœ¨å®‰è£…è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå¸è½½ K3s çš„è„šæœ¬ã€‚<br>å¸è½½ K3s ä¼šåˆ é™¤é›†ç¾¤æ•°æ®å’Œæ‰€æœ‰è„šæœ¬, è¦ä½¿ç”¨ä¸åŒçš„å®‰è£…é€‰é¡¹é‡æ–°å¯åŠ¨é›†ç¾¤ï¼Œè¯·ä½¿ç”¨ä¸åŒçš„æ ‡å¿—é‡æ–°è¿è¡Œå®‰è£…è„šæœ¬ã€‚</p>
<ul>
<li>è¦ä» server èŠ‚ç‚¹å¸è½½ K3sï¼Œè¯·è¿è¡Œï¼š<code>/usr/local/bin/k3s-uninstall.sh</code></li>
<li>è¦ä» agent èŠ‚ç‚¹å¸è½½ K3sï¼Œè¯·è¿è¡Œï¼š<code>/usr/local/bin/k3s-agent-uninstall.sh</code></li>
</ul>
<p><br/></p>
<p><strong>è¡¥å……è¯´æ˜</strong>: </p>
<p>1.é™¤æ­¤ä¹‹å¤–æˆ‘ä»¬è¿˜å¯ä»¥ä¸ºK3Så‘½ä»¤è¡Œè®¾ç½®åˆ«åï¼Œä¾‹å¦‚ï¼Œä¸´æ—¶ç”Ÿæ•ˆ<code>alias k=&#39;k3s kubectl&#39;</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">k get ns</span><br><span class="line">k get pod -A</span><br></pre></td></tr></table></figure></p>
<p>2.K3s é…ç½®ç›®å½•åŠæ–‡ä»¶è·¯å¾„è¯´æ˜ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># k3s ç›¸å…³é…ç½®</span></span><br><span class="line">$ tree /etc/rancher</span><br><span class="line">/etc/rancher</span><br><span class="line">â”œâ”€â”€ k3s</span><br><span class="line">â”‚Â Â  â””â”€â”€ k3s.yaml  <span class="comment"># kubeconfig</span></span><br><span class="line">â””â”€â”€ node</span><br><span class="line">    â””â”€â”€ password  <span class="comment"># éšæœºç”Ÿæˆçš„èŠ‚ç‚¹å¯†ç å‘ k3s server æ³¨å†Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># k3s èŠ‚ç‚¹æ•°æ®ä¿¡æ¯</span></span><br><span class="line">$ ls /var/lib/rancher/k3s/</span><br><span class="line">agent  data  server</span><br><span class="line"></span><br><span class="line"><span class="comment"># kubelet æœåŠ¡è¿è¡Œé…ç½®ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">$ ls /var/lib/kubelet</span><br><span class="line">cpu_manager_state  device-plugins  memory_manager_state  plugins  plugins_registry  pod-resources  pods</span><br></pre></td></tr></table></figure></p>
<p>3.è‡ªåŠ¨éƒ¨ç½²çš„æ¸…å•, ä½äºç›®å½•è·¯å¾„ <code>/var/lib/rancher/k3s/server/manifests</code> çš„æ¸…å•åœ¨æ„å»ºæ—¶è¢«æ†ç»‘åˆ° K3s äºŒè¿›åˆ¶æ–‡ä»¶ä¸­, å°†ç”± `rancher/helm-controller åœ¨è¿è¡Œæ—¶å®‰è£…ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls /var/lib/rancher/k3s/server/manifests</span><br><span class="line">ccm.yaml  coredns.yaml  <span class="built_in">local</span>-storage.yaml  metrics-server  rolebindings.yaml  traefik.yaml</span><br></pre></td></tr></table></figure></p>
<p>4.k3sé»˜è®¤ä½¿ç”¨ containerd ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶, åœ¨ goroutine ä¸­ä»¥ å­è¿›ç¨‹ æ–¹å¼ å¯åŠ¨ containerdã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep <span class="string">"k3s server"</span> | grep -v <span class="string">"grep"</span></span><br><span class="line">root     1209470  3.2 12.0 1267032 484888 ?      Ssl  15:47   1:21 /usr/<span class="built_in">local</span>/bin/k3s server</span><br><span class="line"></span><br><span class="line">ps -A -ostat,pid,ppid,cmd | grep 1209470 | grep -v <span class="string">"grep"</span></span><br><span class="line">Ssl  1209470       1 /usr/<span class="built_in">local</span>/bin/k3s server</span><br><span class="line">Sl   1209529 1209470 containerd -c /var/lib/rancher/k3s/agent/etc/containerd/config.toml -a /run/k3s/containerd/containerd.sock --state /run/k3s/containerd --root /var/lib/rancher/k3s/agent/containerd</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="3-è„šæœ¬ç¦»çº¿å®‰è£…"><a href="#3-è„šæœ¬ç¦»çº¿å®‰è£…" class="headerlink" title="3.è„šæœ¬ç¦»çº¿å®‰è£…"></a>3.è„šæœ¬ç¦»çº¿å®‰è£…</h3><p>ä½ å¯ä»¥ä½¿ç”¨ä¸¤ç§ä¸åŒçš„æ–¹æ³•åœ¨ç¦»çº¿ç¯å¢ƒä¸­å®‰è£… K3sï¼Œç¦»çº¿ç¯å¢ƒæ˜¯ä¸ç›´æ¥è¿æ¥åˆ° Internet çš„ä»»ä½•ç¯å¢ƒï¼Œä½ å¯ä»¥éƒ¨ç½²ä¸€ä¸ªç§æœ‰é•œåƒä»“åº“ï¼Œæˆ–è€…ä½ å¯ä»¥æ‰‹åŠ¨éƒ¨ç½²é•œåƒï¼Œæ¯”å¦‚ç”¨äºå°å‹é›†ç¾¤ã€‚</p>
<p>é€šå¸¸ç¦»çº¿å®‰è£…çš„ä¸¤å¤§æ­¥éª¤, æ­¥éª¤1<code>éƒ¨ç½²é•œåƒ</code>, æ­¥éª¤2<code>å®‰è£… K3s</code></p>
<p><strong>éƒ¨ç½²ç§æœ‰é•œåƒä»“åº“</strong></p>
<ul>
<li>Harborå®‰è£…ä¸é…ç½®: </li>
<li>K3S ç§æœ‰é•œåƒä»“åº“é…ç½®: </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mirrors:</span><br><span class="line">  docker.io:</span><br><span class="line">    endpoint:</span><br><span class="line">      - <span class="string">"https://harbor.weiyigeek.top"</span></span><br><span class="line">    rewrite:</span><br><span class="line">      <span class="string">"^rancher/(.*)"</span>: <span class="string">"mirrorproject/rancher-images/<span class="variable">$1</span>"</span></span><br><span class="line">configs:</span><br><span class="line">  <span class="string">"harbor.weiyigeek.top"</span>:</span><br><span class="line">    auth:</span><br><span class="line">      username: xxxxxx <span class="comment"># è¿™æ˜¯ç§æœ‰é•œåƒä»“åº“çš„ç”¨æˆ·å</span></span><br><span class="line">      password: xxxxxx <span class="comment"># è¿™æ˜¯ç§æœ‰é•œåƒä»“åº“çš„å¯†ç </span></span><br><span class="line">    tls:</span><br><span class="line">      cert_file: <span class="comment"># é•œåƒä»“åº“ä¸­ä½¿ç”¨çš„certæ–‡ä»¶çš„è·¯å¾„ã€‚</span></span><br><span class="line">      key_file:  <span class="comment"># é•œåƒä»“åº“ä¸­ä½¿ç”¨çš„keyæ–‡ä»¶çš„è·¯å¾„ã€‚</span></span><br><span class="line">      ca_file:   <span class="comment"># é•œåƒä»“åº“ä¸­ä½¿ç”¨çš„caæ–‡ä»¶çš„è·¯å¾„ã€‚</span></span><br></pre></td></tr></table></figure>
<p>ä¾‹å¦‚ï¼Œä»¥ä¸‹é…ç½®å°†é€æ˜åœ°ä» <code>harbor.weiyigeek.top/mirrorproject/rancher-images/coredns-coredns:1.6.3</code> æ‹‰å–é•œåƒ <code>docker.io/rancher/coredns-coredns:1.6.3</code>, é•œåƒä»å°†ä»¥åŸå§‹åç§°å­˜å‚¨ï¼Œæ‰€ä»¥ <code>crictl image ls</code> å°†æ˜¾ç¤º <code>docker.io/rancher/coredns-coredns:1.6.3</code> åœ¨èŠ‚ç‚¹ä¸Šæ˜¯å¯ç”¨çš„ï¼Œå³ä½¿é•œåƒæ˜¯ä»¥ä¸åŒçš„åå­—ä»é•œåƒä»“åº“ä¸­æ‹‰å–çš„ã€‚</p>
<p><br/></p>
<p><strong>å®‰è£…å®è·µ</strong></p>
<p>æè¿°: ä¸€åˆ‡å¼€æºï¼Œç«‹å³ä½“éªŒï¼ŒK3S äºŒè¿›åˆ¶é¡¹ç›®åœ°å€ [ <a href="https://github.com/k3s-io/k3s/releases/" target="_blank" rel="noopener">https://github.com/k3s-io/k3s/releases/</a> ], å¦‚æœæ˜¯æˆ‘ä»¬æ‰‹åŠ¨è¿›è¡ŒäºŒè¿›åˆ¶ç¯å¢ƒå®‰è£…ï¼Œå°±å¯èƒ½ç¨å¾®éº»çƒ¦ä¸€ç‚¹äº†ã€‚</p>
<p>æ­¥éª¤ 00.åˆå§‹åŒ–é…ç½®èŠ‚ç‚¹ç›¸å…³é…ç½®ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®ä¸»æœºåç§°, æ³¨æ„å„ä¸ªèŠ‚ç‚¹åç§°éœ€ä¸ä¸€è‡´ã€‚</span></span><br><span class="line">hostnamectl hostname master-01</span><br><span class="line">vim /etc/hostname</span><br></pre></td></tr></table></figure></p>
<p>æ­¥éª¤ 01.æ‹‰å–æŒ‡å®šç‰ˆæœ¬çš„k3säºŒè¿›åˆ¶æ–‡ä»¶åˆ°æœ¬åœ° <code>/usr/local/bin/</code> ç›®å½•ä¹‹ä¸­ä»¥åŠè·å–ä½ æ‰€è¿è¡Œçš„ K3s ç‰ˆæœ¬çš„é•œåƒ tar æ–‡ä»¶ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.K3s äºŒè¿›åˆ¶æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">K3S_VERSION=v1.26.0</span><br><span class="line">wget -c --show-progress https://github.com/k3s-io/k3s/releases/download/<span class="variable">$&#123;K3S_VERSION&#125;</span>+k3s1/k3s -O /usr/<span class="built_in">local</span>/bin/k3s</span><br><span class="line">chmod +x /usr/<span class="built_in">local</span>/bin/k3s</span><br><span class="line">k3s --version</span><br><span class="line">  <span class="comment"># k3s version v1.26.0+k3s1 (f2585c16)</span></span><br><span class="line">  <span class="comment"># go version go1.19.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½å¯¹åº” K3s ç‰ˆæœ¬çš„é•œåƒ tar æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•, å¹¶ç¡®ä¿æ‹¥æœ‰å¯æ‰§è¡Œæƒé™ã€‚å®Œæˆåï¼Œç°åœ¨å¯ä»¥è½¬åˆ°ä¸‹é¢çš„å®‰è£… K3séƒ¨åˆ†</span></span><br><span class="line">sudo mkdir -p /var/lib/rancher/k3s/agent/images/</span><br><span class="line">sudo cp k3s-airgap-images-amd64.tar.gz /var/lib/rancher/k3s/agent/images/</span><br></pre></td></tr></table></figure></p>
<p>æ­¥éª¤ 03.ä¸‹è½½ K3s å®‰è£…è„šæœ¬ï¼š<a href="https://get.k3s.io" target="_blank" rel="noopener">https://get.k3s.io</a>, å°†å®‰è£…è„šæœ¬æ”¾åœ¨æ¯ä¸ªç¦»çº¿èŠ‚ç‚¹çš„ä»»æ„åœ°æ–¹ï¼Œå¹¶å‘½åä¸º install.shã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å½“ä½¿ç”¨ INSTALL_K3S_SKIP_DOWNLOAD ç¯å¢ƒå˜é‡è¿è¡Œ K3s è„šæœ¬æ—¶ï¼ŒK3s å°†ä½¿ç”¨æœ¬åœ°çš„è„šæœ¬å’ŒäºŒè¿›åˆ¶ã€‚</span></span><br><span class="line"><span class="comment"># Server èŠ‚ç‚¹</span></span><br><span class="line">INSTALL_K3S_SKIP_DOWNLOAD=<span class="literal">true</span> ./install.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># Agent èŠ‚ç‚¹ INSTALL_K3S_MIRROR=cn</span></span><br><span class="line"><span class="comment"># å°† myserver æ›¿æ¢ä¸º server çš„ IP æˆ–æœ‰æ•ˆçš„ DNS</span></span><br><span class="line"><span class="comment"># å°† mynodetoken æ›¿æ¢ server èŠ‚ç‚¹çš„ token</span></span><br><span class="line"><span class="comment"># token é€šå¸¸åœ¨/var/lib/rancher/k3s/server/node-token</span></span><br><span class="line">INSTALL_K3S_SKIP_DOWNLOAD=<span class="literal">true</span> K3S_URL=https://myserver:6443 K3S_TOKEN=mynodetoken ./install.sh</span><br></pre></td></tr></table></figure>
<p>æ­¥éª¤ 04.é«˜å¯ç”¨å®‰è£…éœ€è¦è°ƒæ•´å®‰è£…å‘½ä»¤ï¼Œä»¥ä¾¿æŒ‡å®š <code>INSTALL_K3S_SKIP_DOWNLOAD=true</code>å¹¶åœ¨æœ¬åœ°è¿è¡Œå®‰è£…è„šæœ¬, æ‚¨è¿˜å°†åˆ©ç”¨INSTALL_K3S_EXEC=â€™argsâ€™ä¸º k3s æä¾›å…¶ä»–å‚æ•°ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSTALL_K3S_SKIP_DOWNLOAD=<span class="literal">true</span> INSTALL_K3S_EXEC=<span class="string">'server'</span> K3S_DATASTORE_ENDPOINT=<span class="string">'mysql://username:password@tcp(hostname:3306)/database-name'</span> ./install.sh</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="4-å‡çº§å®‰è£…"><a href="#4-å‡çº§å®‰è£…" class="headerlink" title="4.å‡çº§å®‰è£…"></a>4.å‡çº§å®‰è£…</h3><p>K3s æ”¯æŒæ‰‹åŠ¨ä¸è‡ªåŠ¨å‡çº§ï¼Œä¸‹é¢ç®€å•çš„å¯¹å‡çº§æµç¨‹è¿›è¡Œè¯´æ˜ã€‚</p>
<p><strong>è„šæœ¬ç¦»çº¿å‡çº§æµç¨‹:</strong></p>
<ol>
<li>ä» <code>K3s GitHub Release</code> é¡µé¢ä¸‹è½½è¦å‡çº§åˆ°çš„ K3s ç‰ˆæœ¬, å°† tar æ–‡ä»¶æ”¾åœ¨æ¯ä¸ªèŠ‚ç‚¹çš„ <code>/var/lib/rancher/k3s/agent/images/</code> ç›®å½•ä¸‹, åˆ é™¤æ—§çš„ tar æ–‡ä»¶ã€‚</li>
<li>å¤åˆ¶å¹¶æ›¿æ¢æ¯ä¸ªèŠ‚ç‚¹ä¸Š/usr/local/binä¸­çš„æ—§ K3s äºŒè¿›åˆ¶æ–‡ä»¶, å¤åˆ¶ <code>https://get.k3s.io</code> çš„å®‰è£…è„šæœ¬ï¼ˆå› ä¸ºå®ƒå¯èƒ½åœ¨ä¸Šæ¬¡å‘å¸ƒåå‘ç”Ÿäº†å˜åŒ–ï¼‰å†æ¬¡è¿è¡Œè„šæœ¬ã€‚</li>
<li>é‡å¯ K3s æœåŠ¡ã€‚</li>
</ol>
<p><br/></p>
<p><strong>è‡ªåŠ¨å‡çº§åŠŸèƒ½</strong><br>æè¿°: ä» v1.17.4+k3s1 å¼€å§‹ï¼ŒK3s æ”¯æŒè‡ªåŠ¨å‡çº§, è¦åœ¨ç¦»çº¿ç¯å¢ƒä¸­å¯ç”¨æ­¤åŠŸèƒ½ï¼Œæ‚¨å¿…é¡»ç¡®ä¿æ‰€éœ€é•œåƒåœ¨æ‚¨çš„ç§æœ‰é•œåƒä»“åº“ä¸­å¯ç”¨, ä½†æ˜¯åœ¨å®é™…æƒ…å†µä¸­å¹¶ä¸å»ºè®®å¼€å¯å“Ÿã€‚</p>
<ol>
<li><p>ä½ å°†éœ€è¦ä¸ä½ æ‰“ç®—å‡çº§åˆ°çš„ K3s ç‰ˆæœ¬ç›¸å¯¹åº”çš„ rancher/k3s-upgrade ç‰ˆæœ¬, æ³¨æ„ï¼Œé•œåƒæ ‡ç­¾å°† K3s ç‰ˆæœ¬ä¸­çš„+æ›¿æ¢ä¸º-ï¼Œå› ä¸º Docker é•œåƒä¸æ”¯æŒ+ã€‚</p>
</li>
<li><p>ä½ è¿˜éœ€è¦åœ¨ä½ è¦éƒ¨ç½²çš„ <code>system-upgrad-controller manifestYAML</code> ä¸­æŒ‡å®šçš„ <code>system-upgrad-controller</code> å’Œ <code>kubectl</code> çš„ç‰ˆæœ¬ã€‚<br>åœ¨è¿™é‡Œæ£€æŸ¥ system-upgrad-controller çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶ä¸‹è½½ system-upgrad-controller.yaml æ¥ç¡®å®šä½ éœ€è¦æ¨é€åˆ°ç§æœ‰é•œåƒä»“åº“çš„ç‰ˆæœ¬ã€‚<br>ä¾‹å¦‚ï¼Œåœ¨system-upgrade-controllerçš„ v0.4.0 ç‰ˆæœ¬ä¸­ï¼Œåœ¨ manifest YAML ä¸­æŒ‡å®šäº†è¿™äº›é•œåƒï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rancher/system-upgrade-controller:v0.4.0</span><br><span class="line">rancher/kubectl:v0.17.0</span><br></pre></td></tr></table></figure>
</li>
<li><p>å°†å¿…è¦çš„ <code>rancher/k3s-upgradeã€rancher/system-upgrade-controller</code> å’Œ <code>rancher/kubectl</code> é•œåƒæ·»åŠ åˆ°æ‚¨çš„ç§æœ‰é•œåƒä»“åº“ä¸­ä»¥å ï¼Œå°±å¯ä»¥æŒ‰ç…§K3s è‡ªåŠ¨å‡çº§æŒ‡å—è¿›è¡Œæ“ä½œã€‚</p>
</li>
</ol>
<p>å‚è€ƒåœ°å€: <a href="https://docs.rancher.cn/docs/k3s/upgrades/automated/_index" target="_blank" rel="noopener">https://docs.rancher.cn/docs/k3s/upgrades/automated/_index</a></p>
<hr>
<h2 id="0x02-é…ç½®æ–‡ä»¶"><a href="#0x02-é…ç½®æ–‡ä»¶" class="headerlink" title="0x02 é…ç½®æ–‡ä»¶"></a>0x02 é…ç½®æ–‡ä»¶</h2><p><strong>K3s é…ç½®æ–‡ä»¶</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mkdir -vp /etc/rancher/&#123;k3s,node&#125;</span><br><span class="line">tee /etc/rancher/k3s/config.yaml &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">node-name: master-01</span><br><span class="line"><span class="built_in">bind</span>-address: 0.0.0.0</span><br><span class="line">https-listen-port: 6443</span><br><span class="line">cluster-cidr: 10.42.0.0/16</span><br><span class="line">service-cidr: 10.43.0.0/16</span><br><span class="line">cluster-domain: cluster.local</span><br><span class="line">token: k3s.weiyigeek.top</span><br><span class="line">agent-token: agent.weiyigeek.top</span><br><span class="line">pause-image: registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.6</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p><br/></p>
<p><strong>k3s é…ç½®æœåŠ¡å˜é‡</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tee /etc/systemd/system/k3s.service.env &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">INSTALL_K3S_MIRROR=cn</span><br><span class="line">INSTALL_K3S_CHANNEL=latest</span><br><span class="line">K3S_TOKEN=<span class="string">'k3s.weiyigeek.top'</span></span><br><span class="line">K3S_AGENT_TOKEN=<span class="string">'agent.weiyigeek.top'</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p><strong>K3S systemd æœåŠ¡</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">tee /etc/systemd/system/k3s.service &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Lightweight Kubernetes</span><br><span class="line">Documentation=https://k3s.io</span><br><span class="line">Wants=network-online.target</span><br><span class="line">After=network-online.target</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">EnvironmentFile=-/etc/default/%N</span><br><span class="line">EnvironmentFile=-/etc/sysconfig/%N</span><br><span class="line">EnvironmentFile=-/etc/systemd/system/k3s.service.env</span><br><span class="line">KillMode=process</span><br><span class="line">Delegate=yes</span><br><span class="line"><span class="comment"># Having non-zero Limit*s causes performance problems due to accounting overhead</span></span><br><span class="line"><span class="comment"># in the kernel. We recommend using cgroups to do container-local accounting.</span></span><br><span class="line">LimitNOFILE=1048576</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line">TasksMax=infinity</span><br><span class="line">TimeoutStartSec=0</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=5s</span><br><span class="line">ExecStartPre=/bin/sh -xc <span class="string">'! /usr/bin/systemctl is-enabled --quiet nm-cloud-setup.service'</span></span><br><span class="line">ExecStartPre=-/sbin/modprobe br_netfilter</span><br><span class="line">ExecStartPre=-/sbin/modprobe overlay</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/bin/k3s server --system-default-registry registry.cn-hangzhou.aliyuncs.com</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ `systemctl` å‘½ä»¤å¯åŠ¨ `k3s server` æœåŠ¡</span></span><br><span class="line"><span class="comment"># Kubeconfig is written to /etc/rancher/k3s/k3s.yaml</span></span><br><span class="line">$ systemctl daemon-reload &amp;&amp; systemctl restart k3s.service</span><br><span class="line">$ systemctl status -l k3s.service</span><br><span class="line">$ journalctl -xeu k3s.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># On a different node run the below. NODE_TOKEN comes from /var/lib/rancher/k3s/server/node-token</span></span><br><span class="line">$ cat /var/lib/rancher/k3s/server/node-token</span><br><span class="line">K10d3c367aa2703bccaed90f0b1cf14c1091adb3fc554805c35f2300b0b8c269868::server:k3s.weiyigeek.top</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><strong>å®‰è£…ç¯å¢ƒéªŒè¯åŠé…ç½®æ–‡ä»¶æ£€æµ‹</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">k3s check-config</span><br></pre></td></tr></table></figure>
<p><br/></p>
<h4 id="Worker-èŠ‚ç‚¹"><a href="#Worker-èŠ‚ç‚¹" class="headerlink" title="Worker èŠ‚ç‚¹"></a>Worker èŠ‚ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo k3s server &amp;</span><br><span class="line">sudo k3s kubectl get node</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># On a different node run the below. NODE_TOKEN comes from /var/lib/rancher/k3s/server/node-token</span></span><br><span class="line"><span class="comment"># on your server</span></span><br><span class="line">sudo k3s agent --server https://myserver:6443 --token <span class="variable">$&#123;NODE_TOKEN&#125;</span></span><br><span class="line"></span><br><span class="line">rm -rf /var/lib/kubelet /var/lib/rancher</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="0x03-é—®é¢˜è§£å†³"><a href="#0x03-é—®é¢˜è§£å†³" class="headerlink" title="0x03 é—®é¢˜è§£å†³"></a>0x03 é—®é¢˜è§£å†³</h2><h3 id="å®‰è£…é—®é¢˜"><a href="#å®‰è£…é—®é¢˜" class="headerlink" title="å®‰è£…é—®é¢˜"></a>å®‰è£…é—®é¢˜</h3><p>é—®é¢˜1.å¦‚æœä»å›½å†…ç¯å¢ƒå®‰è£… K3s å¯èƒ½ä¼šé‡åˆ°å®‰è£…é€Ÿåº¦ç‰¹åˆ«ç¼“æ…¢æˆ–è€… time out çš„æƒ…å†µï¼Œä»ä»¥ä¸Šçš„å®‰è£…è¿‡ç¨‹å¯ä»¥åˆ†æå‡ºä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š</p>
<ul>
<li>K3s çš„å®‰è£…è„šæœ¬ å­˜å‚¨åœ¨å›½å¤–çš„æœåŠ¡å™¨ï¼Œä»å›½å†…ç¯å¢ƒè®¿é—®å¯èƒ½å‡ºç°æ— æ³•è®¿é—®çš„æƒ…å†µã€‚</li>
<li>K3s é»˜è®¤å®‰è£… stable ç‰ˆæœ¬ï¼Œstable å¯¹åº”çš„å…·ä½“ K3s ç‰ˆæœ¬æ˜¯é€šè¿‡ <a href="https://update.k3s.io/v1-release/channels" target="_blank" rel="noopener">https://update.k3s.io/v1-release/channels</a> è§£ææ¥çš„ï¼Œè€Œè¿™ä¸ªåœ°å€ä¹Ÿæ˜¯è¿è¡Œåœ¨ä¸€ä¸ªå›½å¤–çš„æœåŠ¡å™¨ä¸Šã€‚</li>
<li>å½“é€šè¿‡ channel è§£æå‡ºå¯¹åº” K3s çš„ç‰ˆæœ¬ä¸ºï¼šv1.25.3+k3s1ï¼Œæ­¤æ—¶éœ€è¦åˆ° github ä¸Šæ‹‰å–å¯¹åº”çš„ K3s äºŒè¿›åˆ¶æ–‡ä»¶ã€‚è™½ç„¶è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ‰å‡ åå…†ï¼Œä½†å›½å†…ç¯å¢ƒè®¿é—® github ç»å¸¸ä¼šå‡ºç°æ— æ³•è®¿é—®çš„æƒ…å†µã€‚</li>
</ul>
<p>å¦å¤–ï¼Œè¦å®Œæ•´è¿è¡Œ K3sï¼Œè¿˜ä¾èµ–ä¸€äº›ç³»ç»Ÿçš„æœåŠ¡ï¼Œè¿™äº›ç³»ç»ŸæœåŠ¡(ä¾‹å¦‚ï¼šcorednsã€traefik)éƒ½æ˜¯ä»¥å®¹å™¨çš„æ–¹å¼è¿è¡Œï¼›è€Œè¿™äº›ç³»ç»ŸæœåŠ¡ä¾èµ–çš„ç³»ç»Ÿé•œåƒé»˜è®¤æ˜¯ä» DockerHub å»æ‹‰å–ã€‚åŒæ ·ä»å›½å†…è®¿é—®å¶å°”ä¼šå‡ºç°æ— æ³•è®¿é—®æˆ–æ‹‰å–é•œåƒç¼“æ…¢çš„æƒ…å†µã€‚</p>
<p>ä»¥ä¸Šï¼Œå°±æ˜¯åœ¨å›½å†…ç¯å¢ƒä½¿ç”¨ K3s çš„ä¸€äº›ç—›ç‚¹ã€‚</p>
<p>è§£å†³åŠæ³•: <code>å‚è€ƒ 0x01 å®‰è£…å®è·µ -&gt; è„šæœ¬åœ¨çº¿å®‰è£…</code> ã€‚ </p>
<h3 id="ä½¿ç”¨é—®é¢˜"><a href="#ä½¿ç”¨é—®é¢˜" class="headerlink" title="ä½¿ç”¨é—®é¢˜"></a>ä½¿ç”¨é—®é¢˜</h3><p>é—®é¢˜1.ä½¿ç”¨kubectlæŸ¥çœ‹èŠ‚ç‚¹æ—¶æŠ¥<code>open /etc/rancher/k3s/k3s.yaml: permission denied</code>æƒé™é”™è¯¯é—®é¢˜ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl get node</span><br><span class="line">WARN[0000] Unable to <span class="built_in">read</span> /etc/rancher/k3s/k3s.yaml, please start server with --write-kubeconfig-mode to modify kube config permissions</span><br><span class="line">error: error loading config file <span class="string">"/etc/rancher/k3s/k3s.yaml"</span>: open /etc/rancher/k3s/k3s.yaml: permission denied</span><br></pre></td></tr></table></figure><br>è§£å†³åŠæ³•: <code>chmod 644 /etc/rancher/k3s/k3s.yaml</code></p>
<p>é—®é¢˜2.ä½¿ç”¨k3så‘½ä»¤ä»¥åŠkubectlå‘½ä»¤æ—¶æŠ¥ <code>the server is currently unable to handle the request</code> é”™è¯¯é—®é¢˜ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E1230 15:37:26.981461 1207736 memcache.go:255] couldn<span class="string">'t get resource list for metrics.k8s.io/v1beta1: the server is currently unable to handle the request</span></span><br></pre></td></tr></table></figure><br>è§£å†³åŠæ³•: è¯·æ£€æŸ¥ kube-system åç§°ç©ºé—´ä¸‹çš„ <code>metrics-server-5d7f9fc86-8jhqk</code> Pod æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œè‹¥æ²¡æœ‰è¯·æ’æŸ¥é”™è¯¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod -n kube-system metrics-server-5d7f9fc86-8jhqk</span><br><span class="line">NAME                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">metrics-server-5d7f9fc86-8jhqk   1/1     Running   0          110m</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="0x0n-å‚è€ƒæ¥æº"><a href="#0x0n-å‚è€ƒæ¥æº" class="headerlink" title="0x0n å‚è€ƒæ¥æº"></a>0x0n å‚è€ƒæ¥æº</h2><p>å®˜æ–¹åœ°å€: <a href="https://k3s.io/" target="_blank" rel="noopener">https://k3s.io/</a> &amp;&amp; <a href="https://www.rancher.cn/k3s/" target="_blank" rel="noopener">https://www.rancher.cn/k3s/</a><br>å®˜æ–¹æ–‡æ¡£: <a href="https://rancher.com/docs/k3s/latest/en/" target="_blank" rel="noopener">https://rancher.com/docs/k3s/latest/en/</a><br>é¡¹ç›®åœ°å€: <a href="https://github.com/rancher/k3s/releases/latest" target="_blank" rel="noopener">https://github.com/rancher/k3s/releases/latest</a> &amp;&amp; <a href="https://github.com/k3s-io/k3s/" target="_blank" rel="noopener">https://github.com/k3s-io/k3s/</a></p>

        </div>
        <!-- Google å¹¿å‘Š -->
        
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
  

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2023-01-03T13:04:11.376Z" itemprop="dateUpdated">2023-01-03 21:04:11</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Rancher/K3sä¹‹å¿«é€Ÿæ­å»ºç²¾ç®€ç‰ˆæœ¬K8Sé›†ç¾¤ç¯å¢ƒ.md" target="_blank" rel="noopener noreferrer">_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Rancher/K3sä¹‹å¿«é€Ÿæ­å»ºç²¾ç®€ç‰ˆæœ¬K8Sé›†ç¾¤ç¯å¢ƒ.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2022/5-22-672.html" target="_blank" rel="external">https://blog.weiyigeek.top/2022/5-22-672.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/K3S/" rel="tag">K3S</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2022/5-22-672.html&title=ã€ŠK3sä¹‹å¿«é€Ÿæ­å»ºç²¾ç®€ç‰ˆæœ¬K8Sé›†ç¾¤ç¯å¢ƒã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2022/5-22-672.html&title=ã€ŠK3sä¹‹å¿«é€Ÿæ­å»ºç²¾ç®€ç‰ˆæœ¬K8Sé›†ç¾¤ç¯å¢ƒã€‹ â€” WeiyiGeek Blog&source=[toc]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2022/5-22-672.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠK3sä¹‹å¿«é€Ÿæ­å»ºç²¾ç®€ç‰ˆæœ¬K8Sé›†ç¾¤ç¯å¢ƒã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2022/5-22-672.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2022/5-22-672.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2022/5-30-692.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">1.è®¡ç®—æœºç§‘å­¦å¯¼è®ºä¹‹åŸºç¡€ç»ªè®ºå­¦ä¹ ç¬”è®°</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2022/5-8-658.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">ä½¿ç”¨EasyOCRåº“è¿›è¡ŒOCRæ–‡å­—è¯†åˆ«ä»‹ç»ä¸å®è·µ</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-å‰è¨€ç®€è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å‰è¨€ç®€è¿°</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-å®‰è£…å®è·µ"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 å®‰è£…å®è·µ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-ç¯å¢ƒè¦æ±‚"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">1.ç¯å¢ƒè¦æ±‚</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-è„šæœ¬åœ¨çº¿å®‰è£…"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">2.è„šæœ¬åœ¨çº¿å®‰è£…</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-è„šæœ¬ç¦»çº¿å®‰è£…"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">3.è„šæœ¬ç¦»çº¿å®‰è£…</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-å‡çº§å®‰è£…"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">4.å‡çº§å®‰è£…</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-é…ç½®æ–‡ä»¶"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 é…ç½®æ–‡ä»¶</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Worker-èŠ‚ç‚¹"><span class="post-toc-number">3.0.1.</span> <span class="post-toc-text">Worker èŠ‚ç‚¹</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x03-é—®é¢˜è§£å†³"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 é—®é¢˜è§£å†³</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#å®‰è£…é—®é¢˜"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">å®‰è£…é—®é¢˜</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ä½¿ç”¨é—®é¢˜"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">ä½¿ç”¨é—®é¢˜</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x0n-å‚è€ƒæ¥æº"><span class="post-toc-number">5.</span> <span class="post-toc-text">0x0n å‚è€ƒæ¥æº</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    


    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      

    <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
    
      <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½çœ‹å‹,æ¬¢è¿å…³æ³¨åšä¸»å¾®ä¿¡å…¬ä¼—å·å“Ÿ! â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘å³å¯å…³é—­ç»§ç»­æµè§ˆæ–‡ç« .<br>  <b style="color:red;"> æ¸©é¦¨æç¤º: æœªè§£é”çš„ç”¨æˆ·ä¸èƒ½ç²˜è´´å¤åˆ¶æ–‡ç« å†…å®¹å“Ÿ!</b> <br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
        
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/search-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2023 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>

<div id="go" class="waves-effect waves-light">
  <a href="javascript:;" id="goqrcode"> <span class="icon icon-lg icon-qrcode"></span> </a>
  <a href="javascript:;" id="gotop"> <span class="icon icon-lg icon-chevron-up"></span></a>
</div>





<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2022/5-22-672.html&title=ã€ŠK3sä¹‹å¿«é€Ÿæ­å»ºç²¾ç®€ç‰ˆæœ¬K8Sé›†ç¾¤ç¯å¢ƒã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2022/5-22-672.html&title=ã€ŠK3sä¹‹å¿«é€Ÿæ­å»ºç²¾ç®€ç‰ˆæœ¬K8Sé›†ç¾¤ç¯å¢ƒã€‹ â€” WeiyiGeek Blog&source=[toc]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2022/5-22-672.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠK3sä¹‹å¿«é€Ÿæ­å»ºç²¾ç®€ç‰ˆæœ¬K8Sé›†ç¾¤ç¯å¢ƒã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2022/5-22-672.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2022/5-22-672.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACLUlEQVR42u3a0YobMQwF0Pz/T6fQp5bdndxrTUpjHz8FEyY+ExCSpccjXs/f6+vOn+vr/k/PSdbjHQsDA+NjGcnj2kdfH+v6+T+9lBdUDAyMAxjXQTYJoAkpx+dnw8DAwLg+ShKgk89rrw8DAwMjSdeSwJoknW1KioGBcSYj/7E2mbveuf6Vt9TiGBgYH8hoGwP/8vMb+xsYGBgfwngOVpJcrgX0+iQYGBhbM9qL+8lBk5J1rUmAgYGxN6MtXPOGZZ5otoMa35wEAwNja8Za+7AtdycpZtEYwMDAOICxFnbbxsBaAC2KZwwMjGMY7YDFXS2ESXmMgYFxAiMvXK+Db1vutqMVo/8EAwPjAxl5epfvt4F1MliGgYFxMuOuYJp8vqEYxsDA2JrRhtScnb+O+UgHBgbGmYx5qpfs58VwzcbAwNiIkQfNtVbBnLqYCGJgYGzKaIe38kRtbSysGL/AwMA4gNG2JJNMs73oHzVHMTAwtmbk7YG1NmQ+PNG2Cl78JxgYGJsy5oG1HaFor+GKSzcMDIxNGcnVWzJgMfn+JJXEwMDYm7E2bNFi7iqMb54ZwcDA+O8Zz3K1F2Ht6Fg+ePHXDgYGxtaMfCXHTQLxGgkDAwOjvb6/q0mZp4BRAYyBgXEAox2YmDQA6nif8DAwMDDKkYhiSCJORl+cGQMDA2NcprbXcDe3LTEwMLZgTMLoWtc0D+JRQomBgbE1o20MrO1MxizqmREMDIx9GL8ALjgD8dlQElkAAAAASUVORK5CYII=" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// ç«™ç‚¹è¿è¡Œæ—¶é—´
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + "å¤©" + RunHours + "æ—¶" + RunMinutes + "åˆ†" + RunSeconds + "ç§’";
  document.getElementById(id).innerHTML = "ç½‘ç«™å·²åœ¨é£é›¨ä¸­å‹‰å‹‰å¼ºå¼ºè¿è¡Œäº†ã€" + RunTime + "ã€‘";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
</body>
</html>