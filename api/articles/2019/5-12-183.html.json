{"title":"Centos7-Firewall防火墙基础讲解","slug":"系统运维/Linux/常用命令/防火墙类命令/Firewall防火墙基础讲解","date":"2019-05-12T11:35:30.000Z","updated":"2023-01-31T02:29:09.175Z","url":"2019/5-12-183.html","path":"api/articles/2019/5-12-183.html.json","covers":["https://img.weiyigeek.top/2019/20190513165235.png","https://img.weiyigeek.top/2019/20190513203422.png","https://img.weiyigeek.top/2019/20190513202303.png","https://img.weiyigeek.top/2019/20190513202506.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-Firewall-快速入门\"><a href=\"#0x00-Firewall-快速入门\" class=\"headerlink\" title=\"0x00 Firewall 快速入门\"></a>0x00 Firewall 快速入门</h4><p><strong>(1)firewalld简介：</strong><br>它是Linux上新用的防火墙软件它跟iptables防火墙是差不多的工具但比其更好使用与设置;</p>\n<p>firewalld是centos7的一大特性，最大的好处有两个：支持动态更新，不用重启服务；第二个就是加入了防火墙的“zone”概念。<br>,也提供了支持网络/防火墙区域(zone)定义网络链接以及接口安全等级的动态防火墙管理工具;<br>在CentOS7.0中默认使用firewall代替了iptables service,使得软防火墙操作更加便利人性化，Firewalld有图形界面和字符命令界面;</p>\n<p>firewalld 特点特性：</p>\n<ul>\n<li>D-BUS 接口提供防火墙状态的信息，使防火墙的启用、停用或查询设置成为可能。 </li>\n<li>它支持 IPv4, IPv6 防火墙设置以及以太网桥接,并且拥有运行时配置和永久配置选项</li>\n<li>区域：网络或者防火墙区域定义了连接的可信程度(加入了防火墙的“zone”区域概念)</li>\n<li>服务：服务可以是一系列本读端口、目的以及附加信息，也可以是服务启动时自动增加的防火墙助手模块;</li>\n<li>ICMP 类型: Internet 控制报文协议 (ICMP) 被用以交换报文和互联网协议 (IP) 的错误报文</li>\n<li>直接接口: 主要用于服务或者应用程序增加特定的防火墙规则,即支持允许服务或者应用程序直接添加防火墙规则的接口(<code>都是临时生效</code>)</li>\n<li>运行时配置：运行时配置并非永久有效, 支持动态更新重启服务直接reload规则就行</li>\n<li>永久配置：永久配置存储在配置文件种，每次机器重启或者服务重启、重新加载时将自动恢复。 </li>\n</ul>\n<p><br></p>\n<p><em>firewalld跟iptables比起来至少有两大好处：</em></p>\n<ul>\n<li>firewalld可以动态修改单条规则，而不需要像iptables那样，在修改了规则后必须得全部刷新才可以生效。</li>\n<li>firewalld在使用上要比iptables人性化很多，即使不明白“<code>五张表五条链</code>”而且对TCP/IP协议也不理解也可以实现大部分功能。</li>\n</ul>\n<p>Tips：<code>firewalld自身并不具备防火墙的功能</code>，而是和iptables一样需要通过内核的netfilter来实现，即firewalld和 iptables一样都是作用于维护规则，而真正使用规则干活的是内核的netfilter，<code>只不过firewalld和iptables的结构以及使用方法不一样罢了</code>。</p>\n<p><br/></p>\n<p><em>Q:什么是区域？</em><br>网络区域定义了网络连接的可信等级。这是一个一对多的关系意味着一次连接可以仅仅是一个区域的一部分，而一个区域可以用于很多连接。 </p>\n<p><em>Q:哪个区域可用?</em><br>由firewalld 提供的区域按照从不信任到信任的顺序排序。 </p>\n<ul>\n<li>丢弃(drop): 任何流入网络的包都被丢弃，不作出任何响应。只允许流出的网络连接。</li>\n<li>阻塞(block): 任何进入的网络连接都被拒绝，并返回 IPv4的icmp-host-prohibited报文或者IPv6的icmp6-adm-prohibited报文。只允许由该系统初始化的网络连接。</li>\n<li>公开(public): 用以可以公开的部分。你认为网络中其他的计算机不可信并且可能伤害你的计算机。只允许选中的连接接入。</li>\n<li>外部(externel): 用在路由器等启用伪装的外部网络。你认为网络中其他的计算机不可信并且可能伤害你的计算机。只允许选中的连接接入。</li>\n<li>隔离区(DMZ): 用以允许隔离区（dmz）中的电脑有限地被外界网络访问。只接受被选中的连接。</li>\n<li>工作(work): 用在工作网络。你信任网络中的大多数计算机不会影响你的计算机。只接受被选中的连接。</li>\n<li>家庭(home): 用在家庭网络。你信任网络中的大多数计算机不会影响你的计算机。只接受被选中的连接。</li>\n<li>内部（internal）: 用在内部网络。你信任网络中的大多数计算机不会影响你的计算机。只接受被选中的连接。</li>\n<li>受信任的(trusted): 允许所有网络连接。 </li>\n</ul>\n<p><strong>由 NetworkManager 控制的网络连接</strong><br>描述:防火墙不能够通过 NetworkManager 显示的名称来配置网络连接，只能配置网络接口;<br>如果在配置文件中没有配置区域，接口将配置到 firewalld 的默认区域。如果网络连接使用了不止一个接口，所有的接口都会应用到 fiwewalld。接口名称的改变也将由 NetworkManager 控制并应用到firewalld。 </p>\n<p>为了简此网络连接将被用作与区域的关系。 </p>\n<ul>\n<li>当接口断开NM也告诉Firewall从区域中删除该接口;</li>\n<li>当firewalld 启动后将通知NM把网络连接增加到区域</li>\n</ul>\n<p><br></p>\n<p><em>注意事项：</em></p>\n<ul>\n<li>虽然Centos7 继续保留了iptables命令但不能使用,除非手动删除firewall再安装iptables否则不能继续使用以前的iptables配置方法</li>\n<li>firewall daemon 无法解析由 iptables 和 ebtables 命令行工具添加的防火墙规则</li>\n<li>静态防火墙(system-config-firewall/lokkit)与 “守护进程” 不能同时使用</li>\n</ul>\n<p>参考文档：<a href=\"https://fedoraproject.org/wiki/FirewallD/zh-cn\" target=\"_blank\" rel=\"noopener\">https://fedoraproject.org/wiki/FirewallD/zh-cn</a><br>官方文档：<a href=\"https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html#sec-Introduction_to_firewalld\" target=\"_blank\" rel=\"noopener\">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Security_Guide/sec-Using_Firewalls.html#sec-Introduction_to_firewalld</a></p>\n<p><br></p>\n<p><strong>(2) firewall安装与启动</strong><br>默认环境：CentOS Linux release 7.6.1810 (Core)<br>字符界面管理工具:firewall-cmd<br>图形界面管理工具:firewall-config<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install firewalld firewall-config bash-completion -y <span class=\"comment\"># bash-completion使用tab键补全命令提示</span></span><br><span class=\"line\">systemctl start firewalld.service       <span class=\"comment\">#启动firewall </span></span><br><span class=\"line\">systemctl stop firewalld.service        <span class=\"comment\">#停止firewall</span></span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> firewalld.service      <span class=\"comment\">#允许firewall开机启动</span></span><br><span class=\"line\">systemctl <span class=\"built_in\">disable</span> firewalld.service     <span class=\"comment\">#禁止firewall开机启动</span></span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 命令格式</span></span><br><span class=\"line\">firewall-cmd [选项 ... ]</span><br><span class=\"line\"></span><br><span class=\"line\">通用选项</span><br><span class=\"line\">-h, --<span class=\"built_in\">help</span>    <span class=\"comment\"># 显示帮助信息；</span></span><br><span class=\"line\">-V, --version <span class=\"comment\"># 显示版本信息. （这个选项不能与其他选项组合）；</span></span><br><span class=\"line\">-q, --quiet   <span class=\"comment\"># 不打印状态消息；</span></span><br><span class=\"line\"></span><br><span class=\"line\">状态选项</span><br><span class=\"line\">--state                <span class=\"comment\"># 显示firewalld的状态；</span></span><br><span class=\"line\">--reload               <span class=\"comment\"># 不中断服务的重新加载；</span></span><br><span class=\"line\">--complete-reload      <span class=\"comment\"># 中断所有连接的重新加载；</span></span><br><span class=\"line\">--runtime-to-permanent <span class=\"comment\"># 将当前防火墙的规则永久保存；</span></span><br><span class=\"line\">--check-config         <span class=\"comment\"># 检查配置正确性；</span></span><br><span class=\"line\"></span><br><span class=\"line\">日志选项</span><br><span class=\"line\">--get-log-denied         <span class=\"comment\"># 获取记录被拒绝的日志；</span></span><br><span class=\"line\">--<span class=\"built_in\">set</span>-log-denied=&lt;value&gt; <span class=\"comment\"># 设置记录被拒绝的日志，只能为 'all','unicast','broadcast','multicast','off' 其中的一个；</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安装验证</span></span><br><span class=\"line\">firewall-cmd --version  <span class=\"comment\">#查看版本、帮助</span></span><br><span class=\"line\">firewall-cmd --<span class=\"built_in\">help</span>     </span><br><span class=\"line\">firewall-cmd --state    <span class=\"comment\">#查看状态</span></span><br><span class=\"line\">running</span><br></pre></td></tr></table></figure>\n<p><br></p>\n<p><em>Firewall配置文件以及目录：</em><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/lib/firewalld/ <span class=\"comment\">#系统配置,尽量不要修改</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/lib/firewalld/services  </span><br><span class=\"line\"><span class=\"comment\">#该目录中存放的是定义好的网络服务和端口参数，只用于参考不能修改。这个目录中只定义了一部分通用网络服务。</span></span><br><span class=\"line\"><span class=\"comment\">#在该目录中没有定义的网络服务，也不必再增加相关xml定义，后续通过管理命令可以直接增加。</span></span><br><span class=\"line\"></span><br><span class=\"line\">/etc/firewalld/ <span class=\"comment\">#用户配置地址</span></span><br><span class=\"line\">/etc/firewalld/zones/ <span class=\"comment\">#此处为配置生效后保存的配置文件，一般建议修改前先备份。</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#存储在此的系统或者用户配置文件可以是系统管理员通过配置接口定制的，也可以是手动定制的。这些文件将重载默认配置文件。 </span></span><br><span class=\"line\"><span class=\"comment\">#从/usr/bin/firewalld上面目录中将需要使用的服务的xml文件拷至这个目录中，如果端口有变化则可以修改文件中的数值。</span></span><br><span class=\"line\"><span class=\"variable\">$cp</span> /usr/lib/firewalld/services/ssh.xml /etc/firewalld/services/</span><br><span class=\"line\">&lt;?xml version=<span class=\"string\">\"1.0\"</span> encoding=<span class=\"string\">\"utf-8\"</span>?&gt; </span><br><span class=\"line\">&lt;service&gt; </span><br><span class=\"line\">  &lt;short&gt;SSH&lt;/short&gt; </span><br><span class=\"line\">  &lt;description&gt;Secure Shell (SSH) is a protocol <span class=\"keyword\">for</span> logging into and executing commands on remote machines. It provides secure encrypted communications. If you plan on accessing your machine remotely via SSH over a firewalled interface, <span class=\"built_in\">enable</span> this option. You need the openssh-server package installed <span class=\"keyword\">for</span> this option to be useful.&lt;/description&gt; </span><br><span class=\"line\">  &lt;port protocol=<span class=\"string\">\"tcp\"</span> port=<span class=\"string\">\"22\"</span>/&gt; </span><br><span class=\"line\">&lt;/service&gt;</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>(3) firewall-cmd 命令</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#因为 firewalld 动态管理规则集，所以它不会破坏现有的连接和会话。</span></span><br><span class=\"line\">firewall-cmd --reload   <span class=\"comment\">#在不改变状态的条件下重新加载防火墙</span></span><br><span class=\"line\"><span class=\"comment\">#如果使用 --complete-reload ，状态信息将会丢失。这个选项应当仅用于处理防火墙问题时，例如，状态信息和防火墙规则都正常，但是不能建立任何连接的情况。 </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#获取支持的区域列表</span></span><br><span class=\"line\"><span class=\"variable\">$firewall</span>-cmd --get-zones</span><br><span class=\"line\">block dmz drop external home internal public trusted work</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#获取所有支持的服务</span></span><br><span class=\"line\"><span class=\"variable\">$firewall</span>-cmd --get-services</span><br><span class=\"line\"><span class=\"comment\">#列举区域中启用的服务</span></span><br><span class=\"line\">firewall-cmd [ --zone=&lt;zone&gt; ] --list-services</span><br><span class=\"line\">firewall-cmd --list-service</span><br><span class=\"line\">ssh dhcpv6-client</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#获取所有支持的ICMP类型</span></span><br><span class=\"line\"><span class=\"variable\">$firewall</span>-cmd --get-icmptypes</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#默认显示public区域</span></span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --list-all  <span class=\"comment\">#被用于默认不指定zone默认为public</span></span><br><span class=\"line\">firewall-cmd --list-all-zones  <span class=\"comment\">#列出全部启用的区域的特性</span></span><br><span class=\"line\"><span class=\"comment\">#流入默认区域中配置的接口的新访问请求将被置入新的默认区域。当前活动的连接将不受影响。 </span></span><br><span class=\"line\"><span class=\"comment\">#查看与设置默认zone</span></span><br><span class=\"line\">firewall-cmd --get-default-zone  <span class=\"comment\">#获取默认区域名称</span></span><br><span class=\"line\">firewall-cmd --<span class=\"built_in\">set</span>-default-zone=&lt;zone&gt;  <span class=\"comment\"># 设置默认区域</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#获取活动的区域(zone与接口)</span></span><br><span class=\"line\">firewall-cmd --get-active-zones</span><br><span class=\"line\">firewall-cmd --get-zone-of-interface=&lt;interface&gt;  <span class=\"comment\">#根据接口获取区域</span></span><br><span class=\"line\">firewall-cmd --get-zone-of-interface=ens192</span><br><span class=\"line\">public</span><br><span class=\"line\"><span class=\"comment\">#查询区域中是否包含某接口</span></span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --query-interface=&lt;interface&gt;  <span class=\"comment\">#返回接口是否存在于该区域。没有输出。</span></span><br><span class=\"line\">firewall-cmd --query-interface=ens192</span><br><span class=\"line\">yes</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#将接口增加到区域</span></span><br><span class=\"line\"><span class=\"comment\">#如果接口不属于区域接口将被增加到区域。</span></span><br><span class=\"line\"><span class=\"comment\">#如果区域被省略了将使用默认区域接口在重新加载后将重新应用。</span></span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --add-interface=&lt;interface&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#修改接口所属区域</span></span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --change-interface=&lt;interface&gt;</span><br><span class=\"line\"><span class=\"comment\">#这个选项与 --add-interface 选项相似，但是当接口已经存在于另一个区域的时候，该接口将被添加到新的区域。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#从区域中删除一个接口</span></span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --remove-interface=&lt;interface&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#启用应急模式阻断所有网络连接，以防出现紧急状况</span></span><br><span class=\"line\">firewall-cmd --panic-on <span class=\"comment\">#在 0.3.0 之前的 FirewallD版本中, panic 选项是 --enable-panic 与 --disable-panic.</span></span><br><span class=\"line\">firewall-cmd --panic-off <span class=\"comment\">#禁用应急模式 </span></span><br><span class=\"line\">firewall-cmd --query-panic <span class=\"comment\">#查询应急模式</span></span><br><span class=\"line\"></span><br><span class=\"line\">firewall-cmd --permanent [运行时区域] <span class=\"comment\">#将永久生效</span></span><br></pre></td></tr></table></figure><br><br></p>\n<p><strong>(4)处理运行时区域</strong><br>注意：运行时模式下对区域进行的修改不是永久有效的,重新加载或者重启后修改将失效。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#启用区域中的一种服务</span></span><br><span class=\"line\"><span class=\"comment\">#如果未指定区域将使用默认区域。</span></span><br><span class=\"line\"><span class=\"comment\">#如果设定了超时时间，服务将只启用特定秒数。</span></span><br><span class=\"line\"><span class=\"comment\">#如果服务已经活跃，将不会有任何警告信息。 </span></span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --add-service=&lt;service&gt; [--timeout=&lt;seconds&gt;]</span><br><span class=\"line\">firewall-cmd --zone=home --add-service=ipp-client --timeout=60 <span class=\"comment\">#使区域中的 ipp-client 服务生效60秒:</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#禁用区域中的某种服务</span></span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --remove-service=&lt;service&gt;</span><br><span class=\"line\">firewall-cmd --zone=home --remove-service=http</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#查询区域中是否启用了特定服务</span></span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --query-service=&lt;service&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#启用区域端口和协议组合</span></span><br><span class=\"line\"><span class=\"comment\">#此举将启用端口和协议的组合。端口可以是一个单独的端口 &lt;port&gt; 或者是一个端口范围 &lt;port&gt;-&lt;port&gt; 。协议可以是 tcp 或 udp。 </span></span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --add-port=&lt;port&gt;[-&lt;port&gt;]/&lt;protocol&gt; [--timeout=&lt;seconds&gt;]</span><br><span class=\"line\"><span class=\"comment\">#禁用端口和协议组合</span></span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --remove-port=&lt;port&gt;[-&lt;port&gt;]/&lt;protocol&gt;</span><br><span class=\"line\"><span class=\"comment\">#查询区域中是否启用了端口和协议组合</span></span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --query-port=&lt;port&gt;[-&lt;port&gt;]/&lt;protocol&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#启用区域中的 IP 伪装功能</span></span><br><span class=\"line\"><span class=\"comment\">#私有网络的地址将被隐藏并映射到一个公有IP是地址转换的一种形式，常用于路由。由于内核的限制，伪装功能仅可用于IPv4</span></span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --add-masquerade</span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --remove-masquerade <span class=\"comment\"># 禁用区域中的 IP 伪装</span></span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --query-masquerade <span class=\"comment\">#查询区域的伪装状态</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#启用区域的 ICMP 阻塞功能</span></span><br><span class=\"line\"><span class=\"comment\">#此举将启用选中的 Internet 控制报文协议 （ICMP） 报文进行阻塞。 ICMP 报文可以是请求信息或者创建的应答报文，以及错误应答。</span></span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --add-icmp-block=&lt;icmptype&gt; <span class=\"comment\">#[echo-request和echo-reply]</span></span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --remove-icmp-block=&lt;icmptype&gt; <span class=\"comment\">#禁止区域的 ICMP 阻塞功能</span></span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --query-icmp-block=&lt;icmptype&gt;  <span class=\"comment\">#查询区域的 ICMP 阻塞功能</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#在区域中启用端口转发或映射</span></span><br><span class=\"line\"><span class=\"comment\">#端口可以映射到另一台主机的同一端口，也可以是同一主机或另一主机的不同端口。端口号可以是一个单独的端口 &lt;port&gt; 或者是端口范围 &lt;port&gt;-&lt;port&gt; 。协议可以为 tcp 或udp 。目标端口可以是端口号 &lt;port&gt; 或者是端口范围 &lt;port&gt;-&lt;port&gt; 。目标地址可以是 IPv4 地址。受内核限制，端口转发功能仅可用于IPv4。</span></span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --add-forward-port=port=&lt;port&gt;[-&lt;port&gt;]:proto=&lt;protocol&gt; &#123; :toport=&lt;port&gt;[-&lt;port&gt;] | :toaddr=&lt;address&gt; | :toport=&lt;port&gt;[-&lt;port&gt;]:toaddr=&lt;address&gt; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#禁止区域的端口转发或者端口映射</span></span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --remove-forward-port=port=&lt;port&gt;[-&lt;port&gt;]:proto=&lt;protocol&gt; &#123; :toport=&lt;port&gt;[-&lt;port&gt;] | :toaddr=&lt;address&gt; | :toport=&lt;port&gt;[-&lt;port&gt;]:toaddr=&lt;address&gt; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#查询区域的端口转发或者端口映射</span></span><br><span class=\"line\">firewall-cmd [--zone=&lt;zone&gt;] --query-forward-port=port=&lt;port&gt;[-&lt;port&gt;]:proto=&lt;protocol&gt; &#123; :toport=&lt;port&gt;[-&lt;port&gt;] | :toaddr=&lt;address&gt; | :toport=&lt;port&gt;[-&lt;port&gt;]:toaddr=&lt;address&gt; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#例: 将区域 home 的 ssh 转发到 127.0.0.2 使其能进行连接 </span></span><br><span class=\"line\">firewall-cmd --zone=home --add-forward-port=port=22:proto=tcp:toaddr=127.0.0.2</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>(5)直接选项</strong><br>直接选项主要用于使服务和应用程序能够增加规则,规则不会被保存在重新加载或者重启之后必须再次提交。<br>传递的参数 &lt; args &gt; 与 iptables, ip6tables 以及 ebtables 一致。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#将命令传递给防火墙。</span></span><br><span class=\"line\">firewall-cmd --direct --passthrough &#123; ipv4 | ipv6 | eb &#125; &lt;args&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 为表 &lt;table&gt; 增加一个新链 &lt;chain&gt; 。</span></span><br><span class=\"line\">firewall-cmd --direct --add-chain &#123; ipv4 | ipv6 | eb &#125; &lt;table&gt; &lt;chain&gt;</span><br><span class=\"line\">--remove-chain  <span class=\"comment\">#从表 &lt;table&gt; 中删除链 &lt;chain&gt; 。 参数同上</span></span><br><span class=\"line\">--query-chain   <span class=\"comment\">#查询 &lt;chain&gt; 链是否存在与表 &lt;table&gt;. 如果是，返回0,否则返回1. 参数同上</span></span><br><span class=\"line\"><span class=\"comment\">#获取用空格分隔的表 &lt;table&gt; 中链的列表。</span></span><br><span class=\"line\">firewall-cmd --direct --get-chains &#123; ipv4 | ipv6 | eb &#125; &lt;table&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#为表 &lt;table&gt; 增加一条参数为 &lt;args&gt; 的链 &lt;chain&gt; ，优先级设定为 &lt;priority&gt;。</span></span><br><span class=\"line\">firewall-cmd --direct --add-rule &#123; ipv4 | ipv6 | eb &#125; &lt;table&gt; &lt;chain&gt; &lt;priority&gt; &lt;args&gt;</span><br><span class=\"line\"><span class=\"comment\">#从表 &lt;table&gt; 中删除带参数 &lt;args&gt; 的链 &lt;chain&gt;。</span></span><br><span class=\"line\">firewall-cmd --direct --remove-rule &#123; ipv4 | ipv6 | eb &#125; &lt;table&gt; &lt;chain&gt; &lt;args&gt;</span><br><span class=\"line\">firewall-cmd --direct --query-rule &#123; ipv4 | ipv6 | eb &#125; &lt;table&gt; &lt;chain&gt; &lt;args&gt; <span class=\"comment\">#查询 带参数 &lt;args&gt; 的链 &lt;chain&gt; 是否存在表 &lt;table&gt; 中</span></span><br><span class=\"line\"><span class=\"comment\">#获取表 &lt;table&gt; 中所有增加到链 &lt;chain&gt; 的规则，并用换行分隔。</span></span><br><span class=\"line\">firewall-cmd --direct --get-rules &#123; ipv4 | ipv6 | eb &#125; &lt;table&gt; &lt;chain&gt;</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>(6)命令行配置富规则</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#查看富规则</span></span><br><span class=\"line\">firewall-cmd --list-rich-rules</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#创建富规则</span></span><br><span class=\"line\">firewall-cmd --add-rich-rule <span class=\"string\">'rule family=ipv4 source address=源地址  service name=服务名称  log prefix=\"fpt\" level=info  accept'</span> --permannet</span><br></pre></td></tr></table></figure></p>\n<hr>\n<h4 id=\"0x01-Firewall实例\"><a href=\"#0x01-Firewall实例\" class=\"headerlink\" title=\"0x01 Firewall实例\"></a>0x01 Firewall实例</h4><p>1.ICMP禁Ping机器与启动ping通信：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#禁ping 方法规则</span></span><br><span class=\"line\">firewall-cmd --permanent --add-rich-rule=<span class=\"string\">'rule protocol value=icmp drop'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#查看是否有此规则</span></span><br><span class=\"line\">firewall-cmd --query-rich-rule=<span class=\"string\">'rule protocol value='</span>icmp<span class=\"string\">' drop'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#开启pin(临时生效) - 删除方法</span></span><br><span class=\"line\">firewall-cmd --remove-rich-rule=<span class=\"string\">'rule protocol value=icmp drop'</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190513165235.png\" alt=\"WeiyiGeek.禁ping\" title=\"\" class=\"\">\n                <p>WeiyiGeek.禁ping</p>\n            </figure></p>\n<p><br></p>\n<p>2.对于服务的开发与停止在 FirewallD 的服务名称暂时开放ftp或者ssh服务<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-service=ftp --permanent     <span class=\"comment\"># 永久开放 ftp 服务</span></span><br><span class=\"line\">firewall-cmd --remove-service=ftp --permanent  <span class=\"comment\"># 永久关闭服务</span></span><br><span class=\"line\">firewall-cmd --zone=public --remove-service=ssh --permanent  <span class=\"comment\">#从public区域中移除服务</span></span><br><span class=\"line\">firewall-cmd --zone=public --add-service=ssh --permanent</span><br><span class=\"line\">firewall-cmd --reload     <span class=\"comment\">#最后生效配置（必须执行）：</span></span><br><span class=\"line\">firewall-cmd --query-service ftp <span class=\"comment\"># 查询服务的启用状态</span></span><br><span class=\"line\">no </span><br><span class=\"line\">firewall-cmd --zone=public --query-service=ssh <span class=\"comment\">#查询是不是开放成功:</span></span><br><span class=\"line\">yes</span><br><span class=\"line\"><span class=\"comment\">#删除ssh服务允许通过firewalld防火墙(由于我正在使用远程ssh所以不关闭对ssh流量的通过)</span></span><br><span class=\"line\">firewall-cmd --zone=public --remove-service=ssh --permanent</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190513203422.png\" alt=\"WeiyiGeek.开放服务\" title=\"\" class=\"\">\n                <p>WeiyiGeek.开放服务</p>\n            </figure></p>\n<p><br></p>\n<p>3.查看所有开放端口服务配置信息(默认public区域),查看public区域中所有打开的端口：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$firewall</span>-cmd --zone=public --list-all</span><br><span class=\"line\"><span class=\"variable\">$firewall</span>-cmd --zone=public --list-ports</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190513202303.png\" alt=\"WeiyiGeek.区域信息查看\" title=\"\" class=\"\">\n                <p>WeiyiGeek.区域信息查看</p>\n            </figure></p>\n<p><br></p>\n<p>4.添加接口到区域和设置更改区域的接口<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$firewall</span>-cmd --get-active-zones 查看区域信息(公共接口): </span><br><span class=\"line\"><span class=\"variable\">$firewall</span>-cmd --get-zone-of-interface=eth0  <span class=\"comment\">#查看指定接口的所属区域：</span></span><br><span class=\"line\"><span class=\"variable\">$firewall</span>-cmd --zone=public --add-interface=eth0 <span class=\"comment\">#永久生效再加上 --permanent 然后reload防火墙</span></span><br><span class=\"line\"><span class=\"variable\">$firewall</span>-cmd --zone=internal --change-zone=p3p1 <span class=\"comment\">#所属的zone为internal区域,临时修改接口为p3p1</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/20190513202506.png\" alt=\"WeiyiGeek.区域接口\" title=\"\" class=\"\">\n                <p>WeiyiGeek.区域接口</p>\n            </figure></p>\n<p><br></p>\n<p>5.查询包拒绝状态,以及更新防火墙规则(及重新加载配置,不用重启服务:)<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#如果是远程的机器执行上面的规则会立刻断开网络连接,必须紧记不能随便执行。如果你只是虚拟机或者物理机器登陆就可以执行来调试。</span></span><br><span class=\"line\">firewall-cmd --query-panic</span><br><span class=\"line\"><span class=\"comment\">#拒绝所有包：</span></span><br><span class=\"line\">firewall-cmd --panic-on</span><br><span class=\"line\"><span class=\"comment\">#取消拒绝状态：</span></span><br><span class=\"line\">firewall-cmd --panic-off</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#下面更新防火墙参数两者的区别就是第一个无需断开连接就是firewalld特性之一动态添加规则，第二个需要断开连接类似重启服务</span></span><br><span class=\"line\">firewall-cmd --reload <span class=\"comment\">#动态添加规则</span></span><br><span class=\"line\">firewall-cmd --complete-reload  <span class=\"comment\">#会重启服务</span></span><br><span class=\"line\">service firewalld restart</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<ol start=\"6\">\n<li>指定开放端口和协议并关闭<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-port=80/tcp --permanent <span class=\"comment\">#永久生效没有permanent参数重启后失效</span></span><br><span class=\"line\">firewall-cmd --reload <span class=\"comment\">#重新载入配置生效</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#查看是否添加成功</span></span><br><span class=\"line\">firewall-cmd --zone=public --query-port=80/tcp  <span class=\"comment\">#查看指定的端口的开放情况</span></span><br><span class=\"line\"><span class=\"variable\">$firewall</span>-cmd --zone=public --list-ports         <span class=\"comment\">#查看全部开放端口</span></span><br><span class=\"line\">80/tcp</span><br><span class=\"line\">firewall-cmd --zone=public --remove-port=80/tcp --permanent <span class=\"comment\">#移除允许的端口,删除80端口TCP流量通过许可</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#也能添加一个范围的端口</span></span><br><span class=\"line\">firewall-cmd --zone=public --add-port=4990-4999/udp   <span class=\"comment\">#添加4990-4999 udp端口</span></span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p><br></p>\n<ol start=\"7\">\n<li>流量转发：端口转发可以将指定地址访问指定的端口时，将流量转发至指定地址的指定端口，转发的目的如果不指定 ip 的话就默认为本机；<code>如果指定了 ip 却没指定端口，则默认使用来源端口</code>。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># vi/etc/sysctl.conf 把net.ipv4.ip_forward=0改成net.ipv4.ip_forward=1</span></span><br><span class=\"line\">sed -i <span class=\"string\">'/net.ipv4.ip_forward/ s/\\(.*= \\).*/\\11/'</span> /etc/sysctl.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (1) 将同一台服务器上80端口的流量转发至8080</span></span><br><span class=\"line\">firewall-cmd --add-forward-port=port=80:proto=tcp:toport=8080</span><br><span class=\"line\"><span class=\"comment\">#如果要将端口转发到另外一台服务器上,在需要的区域中激活 masquerade</span></span><br><span class=\"line\">firewall-cmd --zone=public --add-masquerade</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2) 例子中是将本地的80端口的流量转发到IP地址为:10.0.10.15 的远程服务器上的8080端口。</span></span><br><span class=\"line\">firewall-cmd --zone=public --add-forward-port=port=80:proto=tcp:toport=8080:toaddr=10.0.10.15</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (3) </span></span><br><span class=\"line\">firewall-cmd --add-forward-port=port=80:proto=tcp:toport=8080   <span class=\"comment\"># 将80端口的流量转发至8080</span></span><br><span class=\"line\">firewall-cmd --add-forward-port=port=80:proto=tcp:toaddr=192.168.0.1 <span class=\"comment\"># 将80端口的流量转发至192.168.0.1</span></span><br><span class=\"line\">firewall-cmd --add-forward-port=port=80:proto=tcp:toaddr=192.168.0.1:toport=8080 <span class=\"comment\"># 将80端口的流量转发至192.168.0.1的8080端口</span></span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>如果配置好端口转发之后不能用，可以检查下面两个问题：</p>\n<ul>\n<li>比如我将 80 端口转发至 8080 端口，首先检查本地的 80 端口和目标的 8080 端口是否开放监听了</li>\n<li>其次检查是否允许伪装 IP，没允许的话要开启伪装 IP</li>\n</ul>\n<p>补充说明:</p>\n<ul>\n<li>当我们想把某个端口隐藏起来的时候，就可以在防火墙上阻止那个端口访问，然后再开一个不规则的端口，之后配置防火墙的端口转发，将流量转发过去。</li>\n<li>端口转发还可以做流量分发，一个防火墙拖着好多台运行着不同服务的机器，然后用防火墙将不同端口的流量转发至不同机器。</li>\n</ul>\n<p><br></p>\n<ol start=\"8\">\n<li>伪装IP<br>防火墙可以实现伪装IP的功能，下面的端口转发就会用到这个功能。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --query-masquerade    <span class=\"comment\"># 检查是否允许伪装IP </span></span><br><span class=\"line\">firewall-cmd --add-masquerade      <span class=\"comment\"># 允许防火墙伪装IP </span></span><br><span class=\"line\">firewall-cmd --remove-masquerade   <span class=\"comment\"># 禁止防火墙伪装IP</span></span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p><br></p>\n<ol start=\"9\">\n<li>rich-rule的规则的定义<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#添加拒绝某个IP访问ssh端口。</span></span><br><span class=\"line\">firewall-cmd --add-rich-rule <span class=\"string\">\"rule family=ipv4 source address=10.0.10.1 service name='ssh' reject\"</span></span><br><span class=\"line\"><span class=\"comment\"># rule :规则</span></span><br><span class=\"line\"><span class=\"comment\"># family:ipv4 指定ipv4的地址</span></span><br><span class=\"line\"><span class=\"comment\"># source address=10.0.10.1 要拒绝的IP，可以是IP或者是IP段</span></span><br><span class=\"line\"><span class=\"comment\"># service name=’ssh’指定的是ssh服务</span></span><br><span class=\"line\"><span class=\"comment\"># drop :就是此条规则的执行方法是丢弃</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#我更喜欢直接丢弃：</span></span><br><span class=\"line\">firewall-cmd --add-rich-rule <span class=\"string\">\"rule family=ipv4 source address=10.0.10.1 service name='ssh' drop\"</span></span><br><span class=\"line\">firewall-cmd --add-rich-rule=<span class=\"string\">'rule family=ipv4 source address=10.0.10.1 port port=22 protocol=tcp reject'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#表示允许来自此IP允许通过防火墙</span></span><br><span class=\"line\">firewall-cmd --add-rich-rule=<span class=\"string\">'rule family=\"ipv4\" source address=\"10.0.10.1\" accept'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#允许一个IP(10.0.10.1)仅能通过指定端口(8080-8090)访问到目标(10.0.10.13)： </span></span><br><span class=\"line\">firewall-cmd --add-rich-rule=<span class=\"string\">'rule family=\"ipv4\" source address=\"10.0.10.1\" destination address=\"10.0.10.13/32\" port port=\"8080-8090\" protocol=\"tcp\" accept'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#移除规则相对麻烦些</span></span><br><span class=\"line\">firewall-cmd --remove-rich-rule=<span class=\"string\">'rule family=\"ipv4\" source address=\"10.0.10.1\" destination address=\"10.0.10.13/32\" port port=\"80\" protocol=\"tcp\" accept'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#允许管理员在172.31.1.2主机通过ssh远程管理内网的192.168.31.83主机（所用端口为23456)</span></span><br><span class=\"line\">firewall-cmd --add-rich-rule <span class=\"string\">'rule family=ipv4 source address=172.31.1.2 forward-port port=23456 protocol=tcp  to-port=10211  to-addr=192.168.31.83'</span> --permanent  --zone=external</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p><br></p>\n<ol start=\"10\">\n<li>直接模式<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># FirewallD包括一种直接模式，使用它可以完成一些工作，例如打开TCP协议的9999端口</span></span><br><span class=\"line\">firewall-cmd --direct --add-rule ipv4 filter INPUT 0 -p tcp --dport 9000 -j ACCEPT</span><br><span class=\"line\">firewall-cmd --reload</span><br></pre></td></tr></table></figure></li>\n</ol>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Linux命令","path":"api/categories/Linux命令.json"}],"tags":[{"name":"firewall","path":"api/tags/firewall.json"},{"name":"Linux防火墙","path":"api/tags/Linux防火墙.json"}]}