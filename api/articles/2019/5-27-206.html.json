{"title":"Linux磁盘管理之LVM快速入门配置","slug":"系统运维/Linux/运维实践/磁盘存储/Linux磁盘管理之LVM快速入门","date":"2019-05-27T05:34:30.000Z","updated":"2022-03-29T05:39:06.305Z","url":"2019/5-27-206.html","path":"api/articles/2019/5-27-206.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190526112547.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190526113943.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190526135734.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-LVM快速入门\"><a href=\"#0x00-LVM快速入门\" class=\"headerlink\" title=\"0x00 LVM快速入门\"></a>0x00 LVM快速入门</h4><p>描述：LVM——Logical Volume Manager就是动态卷管理在Linux2.4内核以上实现的磁盘管理技术，它可以将多个硬盘和硬盘分区做成一个逻辑卷，并把这个逻辑卷作为一个整体来统一管理，动态对分区进行扩缩空间大小，安全快捷方便管理。</p>\n<p><em>LVM的工作原理：</em> 通过将底层的物理硬盘抽象的封装起来，然后以逻辑卷的方式呈现给上层应用;</p>\n<ul>\n<li>在传统的磁盘管理机制中，我们的上层应用是直接访问文件系统，从而对底层的物理硬盘进行读取，</li>\n<li>在LVM中，其通过对底层的硬盘进行封装，当我们对底层的物理硬盘进行操作时，其不再是针对于分区进行操作，而是通过一个叫做逻辑卷的东西来对其进行底层的磁盘管理操作</li>\n</ul>\n<p>LVM的特点:可以对磁盘进行动态管理。因为逻辑卷的大小是可以动态调整的，而且不会丢失现有的数据,我们如果新增加了硬盘，其也不会改变现有上层的逻辑卷 ,作为一个动态磁盘管理机制,逻辑卷技术大大提高了磁盘管理的灵活性</p>\n<p>基本概念:</p>\n<ul>\n<li>1、 物理卷—–PV（Physical Volume）<ul>\n<li>物理卷在逻辑卷管理中处于最底层，它可以是实际物理硬盘上的分区，也可以是整个物理硬盘。</li>\n</ul>\n</li>\n<li><p>2、 卷组——–VG（Volumne Group）</p>\n<ul>\n<li>卷组建立在物理卷之上，一个卷组中至少要包括一个物理卷，在卷组建立之后可动态添加物理卷到卷组中。一个逻辑卷管理系统工程中可以只有一个卷组，也可以拥有多个卷组。</li>\n</ul>\n</li>\n<li><p>3、 逻辑卷—–LV（Logical Volume）</p>\n</li>\n<li><p>逻辑卷建立在卷组之上，卷组中的未分配空间可以用于建立新的逻辑卷，逻辑卷建立后可以动态地扩展和缩小空间。系统中的多个逻辑卷要以属于同一个卷组，也可以属于不同的多个卷组。</p>\n</li>\n<li><p>4、 物理区域–PE（Physical Extent）</p>\n<ul>\n<li>物理区域是物理卷中可用于分配的最小存储单元，物理区域的大小可根据实际情况在建立物理卷时指定。物理区域大小一旦确定将不能更改，同一卷组中的所有物理卷的物理区域大小需要一致。</li>\n</ul>\n</li>\n<li><p>5、 逻辑区域―LE（Logical Extent）</p>\n<ul>\n<li>逻辑区域是逻辑卷中可用于分配的最小存储单元，逻辑区域的大小取决于逻辑卷所在卷组中的物理区域的大小。</li>\n</ul>\n</li>\n<li><p>6、 卷组描述区域—–（Volume Group Descriptor Area）</p>\n<ul>\n<li>卷组描述区域存在于每个物理卷中，用于描述物理卷本身、物理卷所属卷组、卷组中的逻辑卷及逻辑卷中物理区域的分配等所有信息，卷组描述区域是在使用pvcreate建立物理卷时建立的。</li>\n</ul>\n</li>\n</ul>\n<hr>\n<p>用途：LVM就是Linux下专门针对我们数据的不断的扩大，在原有动态磁盘的基础上动态的调整磁盘的大小，LVM动态卷管理，一张图片让你深入了解lvm的使用。<br><em>四个概念：</em></p>\n<ul>\n<li>②PV(Physical Volume) 物理卷: 处于LVM最底层,可以是物理硬盘或者分区。</li>\n<li>①PE(Physical Extend) 物理拓展: PV中可以用于分配的最小存储单元，可以在创建PV的时候制定（默认为4MB*n）</li>\n<li>③VG(Volume Group) 卷组 : 建立在PV之上，可以含有一个到多个PV</li>\n<li>④LV(Logical Volume) 逻辑卷: 建立在VG之上，相当于原来分区的概念,不过大小可以动态改变</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190526112547.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure>\n<p><br><br>LVM的优点:</p>\n<ul>\n<li>在系统运行状态下动态扩展文件系统的大小</li>\n<li>文件系统可以跨多个磁盘,因此文件系统大小不会受物理磁盘的限制</li>\n<li>可以增加新的磁盘到LVM的存储池中</li>\n<li>可以以镜像的方式冗余重要的数据到多个物理磁盘</li>\n<li>可以方便的导出整个卷组到另外一台机器</li>\n</ul>\n<p><br><br>LVM的缺点:</p>\n<ul>\n<li>①.在从卷组中移除一个磁盘的时候必须使用reducevg命令（这个命令要求root权限，并且不允许在快照卷组中使用）。</li>\n<li>②.当卷组中的一个磁盘损坏时，整个卷组都会受到影响。</li>\n<li>③.因为加入了额外的操作，存贮性能受到影响。</li>\n</ul>\n<p>工作原理：</p>\n<ul>\n<li>(1)物理磁盘被格式化为PV，空间被划分为一个个的PE</li>\n<li>(2)不同的PV加入到同一个VG中，不同PV的PE全部进入到了VG的PE池内</li>\n<li>(3)LV基于PE创建，大小为PE的整数倍，组成LV的PE可能来自不同的物理磁盘</li>\n<li>(4)LV现在就直接可以格式化后挂载使用了</li>\n<li>(5)LV的扩充缩减实际上就是增加或减少组成该LV的PE数量，其过程不会丢失原始数据</li>\n</ul>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190526113943.png\" alt=\"WeiyiGeek.原理图\" title=\"\" class=\"\">\n                <p>WeiyiGeek.原理图</p>\n            </figure>\n<hr/>\n\n<h4 id=\"0x01-LVM操作\"><a href=\"#0x01-LVM操作\" class=\"headerlink\" title=\"0x01 LVM操作\"></a>0x01 LVM操作</h4><p>LVM常用操作命令一览：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1) 查看物理卷/卷组/逻辑卷</span><br><span class=\"line\">pvs / pvdisplay   <span class=\"comment\">#查看物理卷</span></span><br><span class=\"line\">pes / pedisplay   <span class=\"comment\">#查看pe的大小(pes==pescan)</span></span><br><span class=\"line\">vgs / vgdisplay   <span class=\"comment\">#查看卷组</span></span><br><span class=\"line\">lvs / lvdisplay   <span class=\"comment\">#查看逻辑卷</span></span><br><span class=\"line\">fdisk -l   <span class=\"comment\">#查看磁盘分区</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">2) 创建pv/vg/lv</span><br><span class=\"line\">pvcreate 设备路径               创建物理卷</span><br><span class=\"line\">vgcreate 名字 pv路径            创建卷组</span><br><span class=\"line\">lvcreate -n 名字 -L 大小 vg名   创建逻辑卷</span><br><span class=\"line\">格式化：mkfs.ext4 lv完整路径               格式化逻辑卷（mkfs.文件系统格式或-t 文件系统格式）</span><br><span class=\"line\">挂载：mount  lv完整路径  挂载点             挂载使用（可以使用/etc/fstab或autofs）</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">3) 逻辑卷删除：</span><br><span class=\"line\">    1.卸载：umount </span><br><span class=\"line\">    2.删lv：lvremove lv完整路径 </span><br><span class=\"line\">    3.删vg：vgremove vg名 </span><br><span class=\"line\">    4.删PV：pvremove 设备完整路径 去硬盘</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">4) 逻辑卷扩展：</span><br><span class=\"line\">    1.扩展pv：相当于创建pv </span><br><span class=\"line\">    2.扩展vg： vgextend vg名 新增pv路径 </span><br><span class=\"line\">    3.扩展lv： lvextend -L +扩展量 lv完整名  -r <span class=\"comment\">#加-r不用刷新系统</span></span><br><span class=\"line\">    4.刷新文件系统：resize2fs lv完整路径 </span><br><span class=\"line\">    注意：灵活运用，看实际情况，注意顺序 （支持在线操作）</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">5) 逻辑卷的缩小：  <span class=\"comment\">#减小需谨慎，文件系统的减小后大小一定要和lv卷最终大小相等</span></span><br><span class=\"line\">    1.首先进行卸载 umount 检查文件系统：e2fsck -f lv完整路径</span><br><span class=\"line\">    2.减少文件系统：resize2fs lv完整路径 减少到的大小</span><br><span class=\"line\">    3.减少lv卷大小：lvreduce -L -减少量的大小 lv的完整路径</span><br><span class=\"line\">    4.挂载使用</span><br></pre></td></tr></table></figure>\n<hr/>\n\n<h4 id=\"0x02-LVM实战\"><a href=\"#0x02-LVM实战\" class=\"headerlink\" title=\"0x02 LVM实战\"></a>0x02 LVM实战</h4><p>测试环境：CentOS release 6.10 (Final) 2.6.32-754.12.1.el6.i686<br>使用VirtualBOX来模拟我添加了一块1G的磁盘;<br><strong>1) LVS创建</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1.添加的磁盘状态</span></span><br><span class=\"line\"><span class=\"variable\">$fdisk</span> -l /dev/sdb</span><br><span class=\"line\"></span><br><span class=\"line\">Disk /dev/sdb: 1073 MB, 1073741824 bytes</span><br><span class=\"line\">255 heads, 63 sectors/track, 130 cylinders</span><br><span class=\"line\">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class=\"line\">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class=\"line\">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class=\"line\">Disk identifier: 0x00000000</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.在上面创建了两个分区sdb1和sdb2各500M。</span></span><br><span class=\"line\"><span class=\"variable\">$fdisk</span> /dev/sdb</span><br><span class=\"line\">Command (m <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>): u</span><br><span class=\"line\">Changing display/entry units to sectors</span><br><span class=\"line\"></span><br><span class=\"line\">Command (m <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>): m </span><br><span class=\"line\">Command (m <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>): u</span><br><span class=\"line\"><span class=\"comment\">#建立两个主分区：p 分别500MB</span></span><br><span class=\"line\"></span><br><span class=\"line\">Command (m <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>): p</span><br><span class=\"line\">Disk identifier: 0x91982288</span><br><span class=\"line\">   Device Boot      Start         End      Blocks   Id  System</span><br><span class=\"line\">/dev/sdb1            2048     1026047      512000   83  Linux</span><br><span class=\"line\">/dev/sdb2         1026048     2050047      512000   83  Linux</span><br><span class=\"line\"></span><br><span class=\"line\">Command (m <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>): w  <span class=\"comment\">#写入操作</span></span><br><span class=\"line\">The partition table has been altered!</span><br><span class=\"line\">Calling ioctl() to re-read partition table.</span><br><span class=\"line\">Syncing disks.</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3.用pvcreate命令在新建的分区上创建PV</span></span><br><span class=\"line\"><span class=\"variable\">$pvcreate</span> /dev/sdb1 /dev/sdb2</span><br><span class=\"line\">    Physical volume <span class=\"string\">\"/dev/sdb1\"</span> successfully created</span><br><span class=\"line\">    Physical volume <span class=\"string\">\"/dev/sdb2\"</span> successfully created</span><br><span class=\"line\"><span class=\"comment\">#(创建完后我们可以用pvs查看或者pvdisplay查看详细信息)</span></span><br><span class=\"line\"><span class=\"variable\">$pvs</span></span><br><span class=\"line\">  PV         VG           Fmt  Attr(注意属性) PSize   PFree</span><br><span class=\"line\">  /dev/sda2  vg_weiyigeek lvm2 a--u  19.51g      0</span><br><span class=\"line\">  /dev/sdb1               lvm2 ---- 500.00m 500.00m</span><br><span class=\"line\">  /dev/sdb2               lvm2 ---- 500.00m 500.00m</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$pvdisplay</span></span><br><span class=\"line\">  --- Physical volume ---</span><br><span class=\"line\">  PV Name               /dev/sda2</span><br><span class=\"line\">  VG Name               vg_weiyigeek</span><br><span class=\"line\">  PV Size               19.51 GiB / not usable 3.00 MiB</span><br><span class=\"line\">  Allocatable           yes (but full)</span><br><span class=\"line\">  PE Size               4.00 MiB</span><br><span class=\"line\">  Total PE              4994</span><br><span class=\"line\">  Free PE               0</span><br><span class=\"line\">  Allocated PE          4994</span><br><span class=\"line\">  PV UUID               svdPF0-R72a-NU6n-qrZV-jUwP-cOEz-b9OXnm</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">\"/dev/sdb1\"</span> is a new physical volume of <span class=\"string\">\"500.00 MiB\"</span></span><br><span class=\"line\">  --- NEW Physical volume ---</span><br><span class=\"line\">  PV Name               /dev/sdb1</span><br><span class=\"line\">  VG Name              <span class=\"comment\">#VG那一栏是所属的VG组，因为我们还没有划分VG组，所以这一栏也是空。</span></span><br><span class=\"line\">  PV Size               500.00 MiB</span><br><span class=\"line\">  Allocatable           NO</span><br><span class=\"line\">  PE Size               0</span><br><span class=\"line\">  Total PE              0</span><br><span class=\"line\">  Free PE               0</span><br><span class=\"line\">  Allocated PE          0</span><br><span class=\"line\">  PV UUID               M5biUE-eaM1-8U6X-gOpd-31iW-cgNC-m1sIG1</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#4. 使用vgcreate命令创建一个VG组，并将我们创建的两个PV加入VG组</span></span><br><span class=\"line\"><span class=\"variable\">$vgcreate</span> vgdemo1 /dev/sdb1 /dev/sdb2</span><br><span class=\"line\">  Volume group <span class=\"string\">\"vgdemo1\"</span> successfully created</span><br><span class=\"line\"><span class=\"comment\">#(用vgs和vgdisplay命令查看卷组信息及详细信息)</span></span><br><span class=\"line\"><span class=\"variable\">$vgs</span></span><br><span class=\"line\">  VG           <span class=\"comment\">#PV #LV #SN Attr   VSize   VFree</span></span><br><span class=\"line\">  vg_weiyigeek   1   2   0 wz--n-  19.51g      0</span><br><span class=\"line\">  vgdemo1        2   0   0 wz--n- 992.00m 992.00m  <span class=\"comment\">#建立的VG组，可以看到他的大小</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$vgdisplay</span> vgdemo1</span><br><span class=\"line\">  --- Volume group ---</span><br><span class=\"line\">  VG Name               vgdemo1</span><br><span class=\"line\">  System ID</span><br><span class=\"line\">  Format                lvm2</span><br><span class=\"line\">  Metadata Areas        2</span><br><span class=\"line\">  Metadata Sequence No  1</span><br><span class=\"line\">  VG Access             <span class=\"built_in\">read</span>/write</span><br><span class=\"line\">  VG Status             resizable</span><br><span class=\"line\">  MAX LV                0</span><br><span class=\"line\">  Cur LV                0</span><br><span class=\"line\">  Open LV               0</span><br><span class=\"line\">  Max PV                0</span><br><span class=\"line\">  Cur PV                2</span><br><span class=\"line\">  Act PV                2</span><br><span class=\"line\">  VG Size               992.00 MiB  <span class=\"comment\">#关键点：后面的LV分配大小不能藏此大小</span></span><br><span class=\"line\">  PE Size               4.00 MiB  <span class=\"comment\">#PE是卷组的最小储存单位默认是4MB，创建的时候我们也可以用-s参数来修改,</span></span><br><span class=\"line\">                                <span class=\"comment\">#一旦卷组创建成功是没法再去修改PE大小的。</span></span><br><span class=\"line\">  Total PE              248</span><br><span class=\"line\">  Alloc PE / Size       0 / 0</span><br><span class=\"line\">  Free  PE / Size       248 / 992.00 MiB</span><br><span class=\"line\">  VG UUID               AdWgG1-DkWu-3OrA-skAW-ad3i-n2V9-pTHYWF</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#5. 使用lvcreate命令从VG中创建一个逻辑卷</span></span><br><span class=\"line\"><span class=\"variable\">$lvcreate</span> -L 200M -n lv_disk1 vgdemo1</span><br><span class=\"line\">  Logical volume <span class=\"string\">\"lv_disk1\"</span> created.</span><br><span class=\"line\"><span class=\"comment\">#-L参数后跟的是你要设定的逻辑卷大小，这个大小必须是你设定的PE值的整数倍，常用(弊端就是有可能用不完vg里面的空间)</span></span><br><span class=\"line\"><span class=\"comment\">#-l参数后跟的是数量,那划分的逻辑卷大小就为 4xn 你划分的数量MiB。-l 127 个PE弊端是需要计算，比如一个PE 4M 127x4M=508M 但是不会出现用不完vg的空间的情况</span></span><br><span class=\"line\"><span class=\"comment\">#-n参数后跟逻辑卷名字，是对创建的卷组命名，最后跟的是卷组名。</span></span><br><span class=\"line\"><span class=\"comment\">#（逻辑卷的查看命令也是lvs和lvsdisplay）</span></span><br><span class=\"line\"><span class=\"variable\">$lvs</span></span><br><span class=\"line\">  LV       VG           Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class=\"line\">  lv_root  vg_weiyigeek -wi-ao----  17.54g</span><br><span class=\"line\">  lv_swap  vg_weiyigeek -wi-ao----   1.97g</span><br><span class=\"line\">  lv_disk1 vgdemo1      -wi<span class=\"_\">-a</span>----- 200.00m</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$lvdisplay</span> vgdemo1 <span class=\"comment\">#lvdisplay后跟卷组是查看这个卷组的详细信息，只输入lvdisplay是显示所有逻辑卷的详细信息</span></span><br><span class=\"line\">  --- Logical volume ---</span><br><span class=\"line\">  LV Path                /dev/vgdemo1/lv_disk1</span><br><span class=\"line\">  LV Name                lv_disk1</span><br><span class=\"line\">  VG Name                vgdemo1</span><br><span class=\"line\">  LV UUID                ohx66h-l1kU-qnTR-bZQH-eWb5-tVhS-3B03Rq</span><br><span class=\"line\">  LV Write Access        <span class=\"built_in\">read</span>/write</span><br><span class=\"line\">  LV Creation host, time Master-data2, 2019-05-26 13:05:28 +0800</span><br><span class=\"line\">  LV Status              available</span><br><span class=\"line\">  <span class=\"comment\"># open                 0</span></span><br><span class=\"line\">  LV Size                200.00 MiB</span><br><span class=\"line\">  Current LE             50</span><br><span class=\"line\">  Segments               1</span><br><span class=\"line\">  Allocation             inherit</span><br><span class=\"line\">  Read ahead sectors     auto</span><br><span class=\"line\">  - currently <span class=\"built_in\">set</span> to     256</span><br><span class=\"line\">  Block device           253:2</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#6.使用mkfs命令对创建的卷组进行格式化并挂载</span></span><br><span class=\"line\"><span class=\"variable\">$mkfs</span>.ext4 /dev/vgdemo1/lv_disk1</span><br><span class=\"line\">mke2fs 1.41.12 (17-May-2010)</span><br><span class=\"line\"><span class=\"comment\">#Linux下的文件系统需要被挂载后才能使用,建立一个空目录进行挂载</span></span><br><span class=\"line\"><span class=\"variable\">$mkdir</span> /lvsdisk</span><br><span class=\"line\"><span class=\"comment\">#进行挂载，如果要想实现开机自动挂载可以写在fstab表里</span></span><br><span class=\"line\"><span class=\"variable\">$mount</span> /dev/vgdemo1/lv_disk1 /lvsdisk/</span><br><span class=\"line\"><span class=\"variable\">$df</span> -h</span><br><span class=\"line\">Filesystem                   Size  Used Avail Use% Mounted on</span><br><span class=\"line\">/dev/mapper/vgdemo1-lv_disk1 190M  1.6M  179M   1% /lvsdisk</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>2) LV的扩容与缩小</strong><br>LVM的强大之处不只是它可以扩容压缩，更重要的是它可以支持在线扩容，但我们首先要保证VG中有足够的空闲空间。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1.使用lvextend命令来对逻辑卷进行扩容</span></span><br><span class=\"line\"><span class=\"variable\">$vgs</span></span><br><span class=\"line\">VG           PV LV SN Attr   VSize   VFree</span><br><span class=\"line\">vg_weiyigeek   1   2   0 wz--n-  19.51g      0</span><br><span class=\"line\">vgdemo1        2   1   0 wz--n- 992.00m 792.00m  <span class=\"comment\">#必须要用可用的空间</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$lvextend</span> -L +100M /dev/vgdemo1/lv_disk1   <span class=\"comment\">#扩展lvs动态卷的大小 +100M是增加100M空间</span></span><br><span class=\"line\">Size of logical volume vgdemo1/lv_disk1 changed from 200.00 MiB (50 extents) to 300.00 MiB (75 extents).</span><br><span class=\"line\">  Logical volume lv_disk1 successfully resized.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.lvs卷扫描查看分配后的大小</span></span><br><span class=\"line\"><span class=\"variable\">$lvscan</span></span><br><span class=\"line\">  ACTIVE            <span class=\"string\">'/dev/vgdemo1/lv_disk1'</span> [300.00 MiB] inherit</span><br><span class=\"line\">  ACTIVE            <span class=\"string\">'/dev/vg_weiyigeek/lv_root'</span> [17.54 GiB] inherit</span><br><span class=\"line\">  ACTIVE            <span class=\"string\">'/dev/vg_weiyigeek/lv_swap'</span> [1.97 GiB] inherit</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3.但这个时候我们用df-h命令查看一下发现挂载的文件系统并没有增大，这就需要我们使用resize2fs命令手动同步一下文件系统</span></span><br><span class=\"line\"><span class=\"comment\">#lvextend -L +100M /dev/vgdemo1/lv_disk1 -r #加上-r参数就此步可用忽略</span></span><br><span class=\"line\"><span class=\"variable\">$resize2fs</span> -f /dev/vgdemo1/lv_disk1</span><br><span class=\"line\">resize2fs 1.41.12 (17-May-2010)</span><br><span class=\"line\">Resizing the filesystem on /dev/vgdemo1/lv_disk1 to 307200 (1k) blocks.</span><br><span class=\"line\">The filesystem on /dev/vgdemo1/lv_disk1 is now 307200 blocks long.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$df</span> -h /lvsdisk  <span class=\"comment\">#挂载完成并查看空间大小</span></span><br><span class=\"line\">Filesystem            Size  Used Avail Use% Mounted on</span><br><span class=\"line\">/dev/mapper/vgdemo1-lv_disk1</span><br><span class=\"line\">                      287M  2.1M  270M   1% /lvsdisk</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">############## LVS缩小 ##############</span></span><br><span class=\"line\"><span class=\"comment\">#我们要先缩小文件系统，再去缩小逻辑卷</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#逻辑卷扩容可以在线操作但是缩减必须是离线执行，需要先卸载已挂载的逻辑卷。</span></span><br><span class=\"line\"><span class=\"variable\">$umount</span> /lvsdisk  <span class=\"comment\">#取消挂载</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#缩小文件系统前我们要先对文件系统做个扫描检测，如果我们直接使用resize2fs系统会提示让你先对文件系统进行检测，</span></span><br><span class=\"line\"><span class=\"comment\">#这是为了保护缩减文件系统时不对数据损害。</span></span><br><span class=\"line\"><span class=\"variable\">$e2fsck</span> -f /dev/vgdemo1/lv_disk1</span><br><span class=\"line\">e2fsck 1.41.12 (17-May-2010)</span><br><span class=\"line\">Pass 1: Checking inodes, blocks, and sizes</span><br><span class=\"line\">Pass 2: Checking directory structure</span><br><span class=\"line\">Pass 3: Checking directory connectivity</span><br><span class=\"line\">Pass 4: Checking reference counts</span><br><span class=\"line\">Pass 5: Checking group summary information</span><br><span class=\"line\">/dev/vgdemo1/lv_disk1: 11/14112 files (9.1% non-contiguous), 6921/53248 blocks</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#设置减小后的动态卷大小</span></span><br><span class=\"line\"><span class=\"variable\">$resize2fs</span> /dev/vgdemo1/lv_disk1 200</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$lvreduce</span> -L 200M /dev/vgdemo1/lv_disk1 -r  <span class=\"comment\">#将lv_disk1卷组缩小200MB （非常注意缩小后的空间必须是可以整除4的）与下面的参数无关了</span></span><br><span class=\"line\"><span class=\"variable\">$lvscan</span></span><br><span class=\"line\">  ACTIVE            <span class=\"string\">'/dev/vgdemo1/lv_disk1'</span> [52.00 MiB] inherit</span><br><span class=\"line\"><span class=\"variable\">$mount</span> /dev/vgdemo1/lv_disk1 /lvsdisk/  <span class=\"comment\">#分区挂载</span></span><br><span class=\"line\"><span class=\"variable\">$df</span> -h   <span class=\"comment\">#查看缩小后的空间大小</span></span><br><span class=\"line\">/dev/mapper/vgdemo1-lv_disk1</span><br><span class=\"line\">                       47M  1.1M   43M   3% /lvsdisk</span><br></pre></td></tr></table></figure><br><em>注意：</em></p>\n<ul>\n<li>文件系统大小和逻辑卷大小一定要保持一致才行。</li>\n<li>如果逻辑卷大于文件系统，由于部分区域未格式化成文件系统会造成空间的浪费。</li>\n</ul>\n<p><br></p>\n<p><strong>3)VG卷组的扩容与缩小</strong><br>添加一块新的硬盘,通常我们是需要重启机器的;<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190526135734.png\" alt=\"WeiyiGeek.disk\" title=\"\" class=\"\">\n                <p>WeiyiGeek.disk</p>\n            </figure><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1.使用命令让系统重新扫描SCSI总线来添加设备，因为添加的是SCSI磁盘，所以扫描的是SCSI总线</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"- - -\"</span> &gt; /sys/class/scsi_host/host0/scan </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.查看磁盘以及分区使用状态</span></span><br><span class=\"line\"><span class=\"variable\">$lsblk</span></span><br><span class=\"line\">NAME                            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class=\"line\">sr0                              11:0    1 1024M  0 rom</span><br><span class=\"line\">sda                               8:0    0   20G  0 disk</span><br><span class=\"line\">├─sda1                            8:1    0  500M  0 part /boot</span><br><span class=\"line\">└─sda2                            8:2    0 19.5G  0 part</span><br><span class=\"line\">  ├─vg_weiyigeek-lv_root (dm-0) 253:0    0 17.6G  0 lvm  /</span><br><span class=\"line\">  └─vg_weiyigeek-lv_swap (dm-1) 253:1    0    2G  0 lvm  [SWAP]</span><br><span class=\"line\">sdb                               8:16   0    1G  0 disk</span><br><span class=\"line\">├─sdb1                            8:17   0  500M  0 part</span><br><span class=\"line\">│ └─vgdemo1-lv_disk1 (dm-2)     253:2    0   52M  0 lvm  /lvsdisk</span><br><span class=\"line\">└─sdb2                            8:18   0  500M  0 part</span><br><span class=\"line\">sdc                               8:32   0    1G  0 disk  <span class=\"comment\">#我们新添加的磁盘</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#3.首先将要添加的硬盘格式化为PV，再将新的PV添加到指定的卷组中去</span></span><br><span class=\"line\"><span class=\"variable\">$pvcreate</span> /dev/sdc</span><br><span class=\"line\">  Physical volume <span class=\"string\">\"/dev/sdc\"</span> successfully created</span><br><span class=\"line\"><span class=\"variable\">$vgextend</span> vgdemo1 /dev/sdc   <span class=\"comment\">#将新建立PV扩展到vgdemo1中</span></span><br><span class=\"line\">  Volume group <span class=\"string\">\"vgdemo1\"</span> successfully extended</span><br><span class=\"line\"><span class=\"variable\">$vgs</span> </span><br><span class=\"line\">  VG           <span class=\"comment\">#PV #LV #SN Attr   VSize  VFree</span></span><br><span class=\"line\">  vg_weiyigeek   1   2   0 wz--n- 19.51g    0</span><br><span class=\"line\">  vgdemo1        3   1   0 wz--n-  1.96g 1.91g  <span class=\"comment\">#扩展pV后的卷大小</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##########  缩小卷组的缩减 ##########</span></span><br><span class=\"line\"><span class=\"variable\">$vgreduce</span> vgdemo1 /dev/sdc  <span class=\"comment\">#用vgreduce去缩小VG卷组的大小</span></span><br><span class=\"line\">  Removed <span class=\"string\">\"/dev/sdc\"</span> from volume group <span class=\"string\">\"vgdemo1\"</span></span><br><span class=\"line\"><span class=\"comment\">#缩小VG卷组也就是把一个PV从卷组中移除，但我们要先肯定PV中没有数据，不然就会造成数据的丢失</span></span><br><span class=\"line\"><span class=\"comment\">#然后使用pvremove命令移除PV，这样就让分区又重新变成了普通分区。</span></span><br><span class=\"line\"><span class=\"variable\">$pvremove</span> /dev/sdc</span><br><span class=\"line\">  Labels on physical volume <span class=\"string\">\"/dev/sdc\"</span> successfully wiped</span><br></pre></td></tr></table></figure></p>\n<hr>\n<h4 id=\"0x03-实际实践\"><a href=\"#0x03-实际实践\" class=\"headerlink\" title=\"0x03 实际实践\"></a>0x03 实际实践</h4><h5 id=\"0-LVM应用之逻辑卷创建与挂载-基础\"><a href=\"#0-LVM应用之逻辑卷创建与挂载-基础\" class=\"headerlink\" title=\"(0) .LVM应用之逻辑卷创建与挂载(基础)\"></a>(0) .LVM应用之逻辑卷创建与挂载(基础)</h5><p><strong>操作步骤</strong>:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1) 初始化为物理卷：</span></span><br><span class=\"line\">$ pvcreate /dev/vdb1</span><br><span class=\"line\">  Physical volume <span class=\"string\">\"/dev/vdb1\"</span> successfully created</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2) 创建卷组：</span></span><br><span class=\"line\">$ vgcreate -s 16M datastore /dev/vdb1</span><br><span class=\"line\">  Volume group <span class=\"string\">\"datastore\"</span> successfully created</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3) 创建逻辑卷：</span></span><br><span class=\"line\">$ lvcreate -L 10G datastore -n web_data</span><br><span class=\"line\">  Logical volume <span class=\"string\">\"web_data\"</span> created.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4) 格式化为XFS格式：</span></span><br><span class=\"line\">mkfs.xfs /dev/datastore/web_data </span><br><span class=\"line\">  <span class=\"comment\"># meta-data=/dev/datastore/web_data isize=256    agcount=4, agsize=655360 blks</span></span><br><span class=\"line\">  <span class=\"comment\">#         =                       sectsz=512   attr=2, projid32bit=1</span></span><br><span class=\"line\">  <span class=\"comment\">#         =                       crc=0        finobt=0</span></span><br><span class=\"line\">  <span class=\"comment\"># data     =                       bsize=4096   blocks=2621440, imaxpct=25</span></span><br><span class=\"line\">  <span class=\"comment\">#         =                       sunit=0      swidth=0 blks</span></span><br><span class=\"line\">  <span class=\"comment\"># naming   =version 2              bsize=4096   ascii-ci=0 ftype=0</span></span><br><span class=\"line\">  <span class=\"comment\"># log      =internal log           bsize=4096   blocks=2560, version=2</span></span><br><span class=\"line\">  <span class=\"comment\">#         =                       sectsz=512   sunit=0 blks, lazy-count=1</span></span><br><span class=\"line\">  <span class=\"comment\"># realtime =none                   extsz=4096   blocks=0, rtextents=0</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5) 查看UUID：</span></span><br><span class=\"line\">$ blkid |grep web</span><br><span class=\"line\">/dev/mapper/datastore-web_data: UUID=<span class=\"string\">\"7a6e09bf-8fe7-4f66-86f6-5cdd82ffb380\"</span> TYPE=<span class=\"string\">\"xfs\"</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 6) 方式1.自动挂载</span></span><br><span class=\"line\">$ vim /etc/fstab </span><br><span class=\"line\"><span class=\"comment\"># /etc/fstab</span></span><br><span class=\"line\"><span class=\"comment\"># Created by anaconda on Thu Sep 22 17:50:17 2016</span></span><br><span class=\"line\"><span class=\"comment\"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class=\"line\"><span class=\"comment\"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class=\"line\"><span class=\"comment\"># 方式1</span></span><br><span class=\"line\">/dev/mapper/centos-root /                       xfs     defaults        0 0</span><br><span class=\"line\">UUID=41f7a291-c7de-4694-a5ee-1e6313ff9f44 /boot                   xfs     defaults        0 0</span><br><span class=\"line\">/dev/mapper/centos-swap swap                    swap    defaults        0 0</span><br><span class=\"line\">UUID=7a6e09bf-8fe7-4f66-86f6-5cdd82ffb380 /data/web_data xfs defaults 0 0 </span><br><span class=\"line\"><span class=\"comment\"># 方式2</span></span><br><span class=\"line\"><span class=\"comment\"># / was on /dev/ubuntu-vg/lv-0 during curtin installation</span></span><br><span class=\"line\">/dev/disk/by-id/dm-uuid-LVM-cwiz8LJ0JAPp64DmkjU71YpKu235eWQv7GwryDiVe7e1Hvfg8yzYcFs53sWsHfFi / ext4 defaults 0 0</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 6) 方式2.手动创建挂载目录并挂载</span></span><br><span class=\"line\">[root@b ~]<span class=\"comment\"># mkdir -p /data/web_data</span></span><br><span class=\"line\">[root@b ~]<span class=\"comment\"># mount /dev/mapper/datastore-web_data /data/web_data/</span></span><br><span class=\"line\">[root@b ~]<span class=\"comment\"># mount | grep web</span></span><br><span class=\"line\">/dev/mapper/datastore-web_data on /data/web_data <span class=\"built_in\">type</span> xfs (rw,relatime,attr2,inode64,noquota)</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h5 id=\"1-LVM应用之扩容根分区与挂载磁盘\"><a href=\"#1-LVM应用之扩容根分区与挂载磁盘\" class=\"headerlink\" title=\"1.LVM应用之扩容根分区与挂载磁盘\"></a>1.LVM应用之扩容根分区与挂载磁盘</h5><p>描述: 由于系统安装的时候一共分了50G系统经过一段时间后发现磁盘资源不足，此时需要通过LVM进行对centos-root进行扩容;</p>\n<p>环境准备: 在ESXI主机中找到指定的虚拟机，添加一块磁盘为150G即系统后面识别的<code>/dev/sdb</code></p>\n<p>基础流程:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.查看系统当前磁盘情况</span></span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># lsblk</span></span><br><span class=\"line\">NAME            MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class=\"line\">sdb               8:16   0   150G  0 disk</span><br><span class=\"line\">sr0              11:0    1  1024M  0 rom</span><br><span class=\"line\">sda               8:0    0    50G  0 disk</span><br><span class=\"line\">├─sda2            8:2    0    49G  0 part</span><br><span class=\"line\">│ ├─centos-swap 253:1    0   3.9G  0 lvm</span><br><span class=\"line\">│ └─centos-root 253:0    0  45.1G  0 lvm  /</span><br><span class=\"line\">└─sda1            8:1    0     1G  0 part /boot</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.进行磁盘分区将分成两个主分区一个50G和一个100G</span></span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># fdisk /dev/sdb</span></span><br><span class=\"line\">欢迎使用 fdisk (util-linux 2.23.2)。</span><br><span class=\"line\">更改将停留在内存中，直到您决定将更改写入磁盘。</span><br><span class=\"line\">使用写入命令前请三思。</span><br><span class=\"line\">命令(输入 m 获取帮助)：n</span><br><span class=\"line\">Partition <span class=\"built_in\">type</span>:</span><br><span class=\"line\">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class=\"line\">   e   extended</span><br><span class=\"line\">Select (default p): p</span><br><span class=\"line\">...  <span class=\"comment\">#默认即可</span></span><br><span class=\"line\">Last 扇区, +扇区 or +size&#123;K,M,G&#125; (2048-314572799，默认为 314572799)：+50G</span><br><span class=\"line\">分区 1 已设置为 Linux 类型，大小设为 50 GiB</span><br><span class=\"line\">命令(输入 m 获取帮助)：n</span><br><span class=\"line\">Partition <span class=\"built_in\">type</span>:</span><br><span class=\"line\">   p   primary (1 primary, 0 extended, 3 free)</span><br><span class=\"line\">   e   extended</span><br><span class=\"line\">Select (default p): p</span><br><span class=\"line\">...  <span class=\"comment\">#默认即可</span></span><br><span class=\"line\">Last 扇区, +扇区 or +size&#123;K,M,G&#125; (104859648-314572799，默认为 314572799)：</span><br><span class=\"line\">将使用默认值 314572799</span><br><span class=\"line\">分区 2 已设置为 Linux 类型，大小设为 100 GiB</span><br><span class=\"line\">命令(输入 m 获取帮助)：w  <span class=\"comment\"># 写入到磁盘中</span></span><br><span class=\"line\">The partition table has been altered!</span><br><span class=\"line\">Calling ioctl() to re-read partition table.</span><br><span class=\"line\">正在同步磁盘。</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.查看分区信息</span></span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># fdisk -l</span></span><br><span class=\"line\">磁盘 /dev/sda：53.7 GB, 53687091200 字节，104857600 个扇区</span><br><span class=\"line\">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class=\"line\">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class=\"line\">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class=\"line\">磁盘标签类型：dos</span><br><span class=\"line\">磁盘标识符：0x000e9e57</span><br><span class=\"line\">   设备 Boot      Start         End      Blocks   Id  System</span><br><span class=\"line\">/dev/sda1   *        2048     2099199     1048576   83  Linux</span><br><span class=\"line\">/dev/sda2         2099200   104857599    51379200   8e  Linux LVM</span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># lsblk | grep \"sdb\"</span></span><br><span class=\"line\">NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class=\"line\">sdb               8:16   0  150G  0 disk</span><br><span class=\"line\">├─sdb2            8:18   0  100G  0 part</span><br><span class=\"line\">└─sdb1            8:17   0   50G  0 part</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.查看系统中pv设备</span></span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># pvscan</span></span><br><span class=\"line\">  PV /dev/sda2   VG centos          lvm2 [&lt;49.00 GiB / 4.00 MiB free]</span><br><span class=\"line\">  Total: 1 [&lt;49.00 GiB] / <span class=\"keyword\">in</span> use: 1 [&lt;49.00 GiB] / <span class=\"keyword\">in</span> no VG: 0 [0   ]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5.创建一个物理卷PV并且查看PV卷</span></span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># pvcreate /dev/sdb1</span></span><br><span class=\"line\">  Physical volume <span class=\"string\">\"/dev/sdb1\"</span> successfully created.</span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># pvs</span></span><br><span class=\"line\">  PV         VG     Fmt  Attr PSize   PFree</span><br><span class=\"line\">  /dev/sda2  centos lvm2 a--  &lt;49.00g  4.00m</span><br><span class=\"line\">  /dev/sdb1         lvm2 ---   50.00g 50.00g</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 6.将创建的PV卷加入到已存在的centos VG卷之中</span></span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># vgextend centos /dev/sdb1</span></span><br><span class=\"line\">  Volume group <span class=\"string\">\"centos\"</span> successfully extended</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 7.查看PV卷已经分配给Centos VG然后也可以通过vgs查看</span></span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># pvs</span></span><br><span class=\"line\">  PV         VG     Fmt  Attr PSize   PFree</span><br><span class=\"line\">  /dev/sda2  centos lvm2 a--  &lt;49.00g   4.00m</span><br><span class=\"line\">  /dev/sdb1  centos lvm2 a--  &lt;50.00g &lt;50.00g</span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># vgs</span></span><br><span class=\"line\">  VG     <span class=\"comment\">#PV #LV #SN Attr   VSize  VFree</span></span><br><span class=\"line\">  centos   2   2   0 wz--n- 98.99g 50.00g</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 8.进行lv卷扩容50G采用lvscan命令查看扩容前后的比对;</span></span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># lvscan</span></span><br><span class=\"line\">  ACTIVE            <span class=\"string\">'/dev/centos/swap'</span> [&lt;3.88 GiB] inherit</span><br><span class=\"line\">  ACTIVE            <span class=\"string\">'/dev/centos/root'</span> [&lt;45.12 GiB] inherit</span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># lvextend -L +50G /dev/centos/root</span></span><br><span class=\"line\">  Size of logical volume centos/root changed from &lt;45.12 GiB (11550 extents) to &lt;95.12 GiB (24350 extents).</span><br><span class=\"line\">  Logical volume centos/root successfully resized.</span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># lvscan</span></span><br><span class=\"line\">  ACTIVE            <span class=\"string\">'/dev/centos/swap'</span> [&lt;3.88 GiB] inherit</span><br><span class=\"line\">  ACTIVE            <span class=\"string\">'/dev/centos/root'</span> [&lt;95.12 GiB] inherit</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 9.此时您会发现lv其大小已经发生改变但是采用 df -h / 其大小并没有增加</span></span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># lsblk</span></span><br><span class=\"line\">NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class=\"line\">sdb               8:16   0  150G  0 disk</span><br><span class=\"line\">├─sdb2            8:18   0  100G  0 part</span><br><span class=\"line\">└─sdb1            8:17   0   50G  0 part</span><br><span class=\"line\">  └─centos-root 253:0    0 95.1G  0 lvm  /</span><br><span class=\"line\">sda               8:0    0   50G  0 disk</span><br><span class=\"line\">├─sda2            8:2    0   49G  0 part</span><br><span class=\"line\">│ ├─centos-swap 253:1    0  3.9G  0 lvm</span><br><span class=\"line\">│ └─centos-root 253:0    0 95.1G  0 lvm  /</span><br><span class=\"line\">└─sda1            8:1    0    1G  0 part /boot</span><br><span class=\"line\"></span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># df -h</span></span><br><span class=\"line\">文件系统                 容量  已用  可用 已用% 挂载点</span><br><span class=\"line\">/dev/mapper/centos-root   46G  2.4G   43G    6% /</span><br><span class=\"line\"></span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># fdisk -l</span></span><br><span class=\"line\">磁盘 /dev/sda：53.7 GB, 53687091200 字节，104857600 个扇区</span><br><span class=\"line\">...</span><br><span class=\"line\">磁盘 /dev/sdb：161.1 GB, 161061273600 字节，314572800 个扇区</span><br><span class=\"line\">...</span><br><span class=\"line\">磁盘 /dev/mapper/centos-root：102.1 GB, 102131302400 字节，199475200 个扇区 <span class=\"comment\">#此处也显示扩容到100G</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 10.然后要解决上面df -h命令查看一下发现根挂载的文件系统并没有增大上，此时采用下面的命令进行更新同步文件系统</span></span><br><span class=\"line\"><span class=\"comment\"># 非常注意不同系统以及分区类型处理方式不同</span></span><br><span class=\"line\">$ df -Th</span><br><span class=\"line\"><span class=\"comment\"># Filesystem              Type      Size  Used Avail Use% Mounted on</span></span><br><span class=\"line\"><span class=\"comment\"># /dev/mapper/centos-root xfs        96G  6.8G   89G   8% /</span></span><br><span class=\"line\"><span class=\"comment\"># /dev/mapper/ubuntu--vg-ubuntu--lv ext4      4.2G  3.7G  269M  94% /</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># CentOS</span></span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># xfs_growfs /dev/mapper/centos-root</span></span><br><span class=\"line\">meta-data=/dev/mapper/centos-root isize=512    agcount=4, agsize=2956800 blks</span><br><span class=\"line\">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class=\"line\">         =                       crc=1        finobt=0 spinodes=0</span><br><span class=\"line\">data     =                       bsize=4096   blocks=11827200, imaxpct=25</span><br><span class=\"line\">         =                       sunit=0      swidth=0 blks</span><br><span class=\"line\">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class=\"line\"><span class=\"built_in\">log</span>      =internal               bsize=4096   blocks=5775, version=2</span><br><span class=\"line\">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class=\"line\">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br><span class=\"line\"><span class=\"comment\"># ubuntu / general</span></span><br><span class=\"line\"><span class=\"comment\"># resize2fs -p -F  /dev/mapper/ubuntu--vg-ubuntu--lv</span></span><br><span class=\"line\"><span class=\"comment\"># resize2fs 1.45.5 (07-Jan-2020)</span></span><br><span class=\"line\"><span class=\"comment\"># Filesystem at /dev/mapper/ubuntu--vg-ubuntu--lv is mounted on /; on-line resizing required</span></span><br><span class=\"line\"><span class=\"comment\"># old_desc_blocks = 1, new_desc_blocks = 10</span></span><br><span class=\"line\"><span class=\"comment\"># The filesystem on /dev/mapper/ubuntu--vg-ubuntu--lv is now 19398656 (4k) blocks long.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - CentOS</span></span><br><span class=\"line\">[root@CentOS ~]<span class=\"comment\"># df -h  </span></span><br><span class=\"line\">文件系统                 容量  已用  可用 已用% 挂载点</span><br><span class=\"line\">/dev/mapper/centos-root   96G  2.4G   93G    3% /  <span class=\"comment\"># 文件系统也显示成功扩容</span></span><br><span class=\"line\"><span class=\"comment\"># - Ubuntu</span></span><br><span class=\"line\"><span class=\"comment\"># [root@Ubuntu ~]$ df -hT</span></span><br><span class=\"line\"><span class=\"comment\"># Filesystem                        Type      Size  Used Avail Use% Mounted on</span></span><br><span class=\"line\"><span class=\"comment\"># udev                              devtmpfs  1.9G     0  1.9G   0% /dev</span></span><br><span class=\"line\"><span class=\"comment\"># tmpfs                             tmpfs     394M  1.2M  393M   1% /run</span></span><br><span class=\"line\"><span class=\"comment\"># /dev/mapper/ubuntu--vg-ubuntu--lv ext4       73G  3.7G   67G   6% /</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 11.将磁盘的另外一个分区挂载到/data目录</span></span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># mkfs.xfs /dev/sdb2 #推荐采用XFS格式的分区</span></span><br><span class=\"line\">meta-data=/dev/sdb2              isize=512    agcount=4, agsize=6553536 blks</span><br><span class=\"line\">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class=\"line\">         =                       crc=1        finobt=0, sparse=0</span><br><span class=\"line\">data     =                       bsize=4096   blocks=26214144, imaxpct=25</span><br><span class=\"line\">         =                       sunit=0      swidth=0 blks</span><br><span class=\"line\">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class=\"line\"><span class=\"built_in\">log</span>      =internal <span class=\"built_in\">log</span>           bsize=4096   blocks=12799, version=2</span><br><span class=\"line\">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class=\"line\">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># mkdir /data/</span></span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># mkfs.ext4 /dev/sdb2</span></span><br><span class=\"line\"><span class=\"comment\"># mke2fs 1.42.9 (28-Dec-2013)</span></span><br><span class=\"line\"><span class=\"comment\"># 文件系统标签=</span></span><br><span class=\"line\"><span class=\"comment\"># OS type: Linux</span></span><br><span class=\"line\"><span class=\"comment\"># 块大小=4096 (log=2)</span></span><br><span class=\"line\"><span class=\"comment\"># 分块大小=4096 (log=2)</span></span><br><span class=\"line\"><span class=\"comment\"># Stride=0 blocks, Stripe width=0 blocks</span></span><br><span class=\"line\"><span class=\"comment\"># 6553600 inodes, 26214144 blocks</span></span><br><span class=\"line\"><span class=\"comment\"># 1310707 blocks (5.00%) reserved for the super user</span></span><br><span class=\"line\"><span class=\"comment\"># 第一个数据块=0</span></span><br><span class=\"line\"><span class=\"comment\"># Maximum filesystem blocks=2174746624</span></span><br><span class=\"line\"><span class=\"comment\"># 800 block groups</span></span><br><span class=\"line\"><span class=\"comment\"># 32768 blocks per group, 32768 fragments per group</span></span><br><span class=\"line\"><span class=\"comment\"># 8192 inodes per group</span></span><br><span class=\"line\"><span class=\"comment\"># Superblock backups stored on blocks:</span></span><br><span class=\"line\"><span class=\"comment\">#         32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,</span></span><br><span class=\"line\"><span class=\"comment\">#         4096000, 7962624, 11239424, 20480000, 23887872</span></span><br><span class=\"line\"><span class=\"comment\"># Allocating group tables: 完成</span></span><br><span class=\"line\"><span class=\"comment\"># 正在写入inode表: 完成</span></span><br><span class=\"line\"><span class=\"comment\"># Creating journal (32768 blocks): 完成</span></span><br><span class=\"line\"><span class=\"comment\"># Writing superblocks and filesystem accounting information: 完成</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 12.将格式后的磁盘分区进行挂载到/data目录下，并写入/etc/fstab中永久生效</span></span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># mount /dev/sdb2 /data</span></span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># echo \"/dev/sdb2 /data xfs defaults 0 0\" &gt;&gt; /etc/fstab</span></span><br><span class=\"line\">[root@WeiyiGeek ~]<span class=\"comment\"># mount -l|grep \"/dev/sdb2\"</span></span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<hr>\n<h4 id=\"0x04-入坑解决\"><a href=\"#0x04-入坑解决\" class=\"headerlink\" title=\"0x04 入坑解决\"></a>0x04 入坑解决</h4><p>PS：我们实际生产操作中很少用到逻辑卷的缩减，因为缩减很容易就会造成数据损坏，这是得不偿失的，所以我们不推荐对逻辑卷进行缩减。</p>\n<h5 id=\"问题1：执行lvreduce缩小指定lv卷大小错误-尽量不要进行缩小\"><a href=\"#问题1：执行lvreduce缩小指定lv卷大小错误-尽量不要进行缩小\" class=\"headerlink\" title=\"问题1：执行lvreduce缩小指定lv卷大小错误(尽量不要进行缩小)\"></a>问题1：执行lvreduce缩小指定lv卷大小错误(尽量不要进行缩小)</h5><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$lvreduce</span> -L 52M /dev/vgdemo1/lv_disk1 -r</span><br><span class=\"line\">fsck from util-linux-ng 2.17.2</span><br><span class=\"line\">/dev/mapper/vgdemo1-lv_disk1: The filesystem size (according to the superblock) is 307200 blocks</span><br><span class=\"line\">The physical size of the device is 258048 blocks</span><br><span class=\"line\">Either the superblock or the partition table is likely to be corrupt!</span><br><span class=\"line\">/dev/mapper/vgdemo1-lv_disk1: UNEXPECTED INCONSISTENCY; RUN fsck MANUALLY.</span><br><span class=\"line\">        (i.e., without -a or -p options)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#原因：由于减小的lv卷区大小不能整除4导致</span></span><br><span class=\"line\"><span class=\"comment\">#解决办法：</span></span><br><span class=\"line\">mkfs.ext4 /dev/vgdemo1/lv_disk1  <span class=\"comment\">#格式化分区后重新设置大小lv卷大小可以被四整除</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"问题2-Ubuntu-LVM扩容后df-h显示未更新\"><a href=\"#问题2-Ubuntu-LVM扩容后df-h显示未更新\" class=\"headerlink\" title=\"问题2.Ubuntu LVM扩容后df -h显示未更新\"></a>问题2.Ubuntu LVM扩容后df -h显示未更新</h5><p>问题原因:由于文件系统(df -h 所看见的)未及时更新导致,所以更新一哈就可以;<br>解决办法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$resize2fs</span> -p -F  /dev/mapper/ubuntu--vg-ubuntu--lv</span><br><span class=\"line\">resize2fs 1.45.5 (07-Jan-2020)</span><br><span class=\"line\">Filesystem at /dev/mapper/ubuntu--vg-ubuntu--lv is mounted on /; on-line resizing required</span><br><span class=\"line\">old_desc_blocks = 1, new_desc_blocks = 25</span><br><span class=\"line\">The filesystem on /dev/mapper/ubuntu--vg-ubuntu--lv is now 52164608 (4k) blocks long.</span><br><span class=\"line\"></span><br><span class=\"line\">root@ubuntu:~<span class=\"comment\"># df -h</span></span><br><span class=\"line\">Filesystem                         Size  Used Avail Use% Mounted on</span><br><span class=\"line\">udev                               1.9G     0  1.9G   0% /dev</span><br><span class=\"line\">tmpfs                              394M  1.2M  393M   1% /run</span><br><span class=\"line\">/dev/mapper/ubuntu--vg-ubuntu--lv  196G  3.5G  185G   2% /  <span class=\"comment\"># 已更新</span></span><br><span class=\"line\">tmpfs                              2.0G     0  2.0G   0% /dev/shm</span><br><span class=\"line\">tmpfs                              5.0M     0  5.0M   0% /run/lock</span><br><span class=\"line\">tmpfs                              2.0G     0  2.0G   0% /sys/fs/cgroup</span><br></pre></td></tr></table></figure></p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Disk","path":"api/categories/Disk.json"}],"tags":[{"name":"LVM","path":"api/tags/LVM.json"}]}