<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 2.ElasticStackåˆ†å¸ƒå¼æ•°æ®é‡‡é›†æœç´¢å¼•æ“é›†ç¾¤æ­å»ºé…ç½®|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Elastic">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>2.ElasticStackåˆ†å¸ƒå¼æ•°æ®é‡‡é›†æœç´¢å¼•æ“é›†ç¾¤æ­å»ºé…ç½®</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">2.ElasticStackåˆ†å¸ƒå¼æ•°æ®é‡‡é›†æœç´¢å¼•æ“é›†ç¾¤æ­å»ºé…ç½®</h1>
        <h5 class="subtitle">
            
                <time datetime="2021-08-02T01:34:30.000Z" itemprop="datePublished" class="page-time">
  2021-08-02
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E6%97%A5%E5%BF%97%E5%AE%A1%E8%AE%A1/">æ—¥å¿—å®¡è®¡</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E6%97%A5%E5%BF%97%E5%AE%A1%E8%AE%A1/%E5%AE%89%E5%85%A8%E5%BB%BA%E8%AE%BE/">å®‰å…¨å»ºè®¾</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
  <article id="post-ç½‘å®‰é˜²å¾¡/å®‰å…¨å»ºè®¾/æ—¥å¿—å®¡è®¡/ElasticStack/2.ElasticStackåˆ†å¸ƒå¼æ•°æ®é‡‡é›†æœç´¢å¼•æ“é›†ç¾¤æ­å»ºé…ç½®"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">2.ElasticStackåˆ†å¸ƒå¼æ•°æ®é‡‡é›†æœç´¢å¼•æ“é›†ç¾¤æ­å»ºé…ç½®</h1>
        <div class="post-meta">
            <time class="post-time" title="2021-08-02 09:34:30" datetime="2021-08-02T01:34:30.000Z"  itemprop="datePublished">2021-08-02</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E6%97%A5%E5%BF%97%E5%AE%A1%E8%AE%A1/">æ—¥å¿—å®¡è®¡</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E6%97%A5%E5%BF%97%E5%AE%A1%E8%AE%A1/%E5%AE%89%E5%85%A8%E5%BB%BA%E8%AE%BE/">å®‰å…¨å»ºè®¾</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="0x01-ESé›†ç¾¤æ­å»ºå®è·µ"><a href="#0x01-ESé›†ç¾¤æ­å»ºå®è·µ" class="headerlink" title="0x01 ESé›†ç¾¤æ­å»ºå®è·µ"></a>0x01 ESé›†ç¾¤æ­å»ºå®è·µ</h2><h3 id="1-å®¿ä¸»æœºå®‰è£…"><a href="#1-å®¿ä¸»æœºå®‰è£…" class="headerlink" title="1.å®¿ä¸»æœºå®‰è£…"></a>1.å®¿ä¸»æœºå®‰è£…</h3><h4 id="1-1-èŠ‚ç‚¹ç¯å¢ƒ"><a href="#1-1-èŠ‚ç‚¹ç¯å¢ƒ" class="headerlink" title="(1.1) èŠ‚ç‚¹ç¯å¢ƒ"></a>(1.1) èŠ‚ç‚¹ç¯å¢ƒ</h4><p>æè¿°: æ­¤å¤„ç³»ç»Ÿçš„ç¯å¢ƒè®¾ç½®è¯·å‚è€ƒä¸Šä¸€ç« çš„<code>é‡è¦ç³»ç»Ÿé…ç½®</code>ç« èŠ‚ã€‚</p>
<p><strong>æ“ä½œç¯å¢ƒè¯´æ˜:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">elk1 Master 2C 4G - Ubuntu 20.04.2 LTS  5.4.0-86-generic  </span><br><span class="line">elk2 Slave  2C 2G - Ubuntu 20.04.2 LTS  5.4.0-86-generic </span><br><span class="line">elk3 Slave  2C 2G - Ubuntu 20.04.2 LTS  5.4.0-86-generic</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>èŠ‚ç‚¹ä¿¡æ¯ï¼š</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Role</th>
<th>IP</th>
<th>HTTP PORT</th>
<th>Cluster TCP PORT</th>
</tr>
</thead>
<tbody>
<tr>
<td>es01</td>
<td>MASTER</td>
<td>10.10.107.225</td>
<td>9200</td>
<td>9300</td>
</tr>
<tr>
<td>es02</td>
<td>SLAVE</td>
<td>10.10.107.226</td>
<td>9200</td>
<td>9300</td>
</tr>
<tr>
<td>es03</td>
<td>SLAVE</td>
<td>10.10.107.227</td>
<td>9200</td>
<td>9300</td>
</tr>
</tbody>
</table>
<p><br></p>
<p><strong>åŸºç¡€ç¯å¢ƒè®¾ç½®</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç³»ç»Ÿå¯åŠ¨é…ç½®</span></span><br><span class="line"><span class="keyword">if</span> [[ $(grep -c <span class="string">"ulimit"</span> /etc/profile) -ne 2 ]];<span class="keyword">then</span></span><br><span class="line">tee -a /etc/profile &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">swapoff -a</span><br><span class="line"><span class="built_in">ulimit</span> -HSn 65535</span><br><span class="line"><span class="comment">#ulimit -HSu 65535</span></span><br><span class="line">EOF</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># ç³»ç»Ÿèµ„æºé™åˆ¶é…ç½®</span></span><br><span class="line"><span class="keyword">if</span> [[ $(grep -E -c <span class="string">"^elk"</span> /etc/security/limits.conf) -eq 0 ]];<span class="keyword">then</span></span><br><span class="line">tee -a /etc/security/limits.conf &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line"><span class="comment"># åœ¨å¯åŠ¨ Elasticsearch ä¹‹å‰å°† memlock è®¾ç½®ä¸ºæ— é™åˆ¶</span></span><br><span class="line">elk soft memlock unlimited</span><br><span class="line">elk hard memlock unlimited</span><br><span class="line"><span class="comment"># æ–‡ä»¶æè¿°ç¬¦æ•°é‡ä¸çº¿ç¨‹æ•°</span></span><br><span class="line">elk soft nofile 65535</span><br><span class="line">elk hard nofile 65535</span><br><span class="line">elk soft nproc 65535</span><br><span class="line">elk hard nproc 65535</span><br><span class="line">EOF</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># ç³»ç»Ÿå†…æ ¸å‚æ•°é…ç½®&amp;ç”Ÿæ•ˆè®¾ç½®</span></span><br><span class="line">tee -a /etc/sysctl.conf &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line"><span class="comment"># ç¦ç”¨ swap</span></span><br><span class="line">vm.swappiness=1</span><br><span class="line"><span class="comment"># ç¡®ä¿è¶³å¤Ÿçš„è™šæ‹Ÿå†…å­˜ </span></span><br><span class="line">vm.max_map_count=262144</span><br><span class="line"><span class="comment"># TCPé‡ä¼ è¶…æ—¶æ¬¡æ•°</span></span><br><span class="line">net.ipv4.tcp_retries2=5</span><br><span class="line">EOF</span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç³»ç»Ÿä¸»æœºåç§°è§£æé…ç½®</span></span><br><span class="line">tee -a /etc/hosts &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">10.10.107.225 es01</span><br><span class="line">10.10.107.226 es02</span><br><span class="line">10.10.107.227 es03</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h4 id="1-2-å®è·µæµç¨‹"><a href="#1-2-å®è·µæµç¨‹" class="headerlink" title="(1.2) å®è·µæµç¨‹"></a>(1.2) å®è·µæµç¨‹</h4><ul>
<li>Step 1.ä¸‰å°ä¸»æœºåˆ†åˆ«è¿›è¡ŒES Linux Tar å®‰è£…åŒ…ä¸‹è½½è§£å‹åˆ°/usr/local/ç›®å½•ä¸­ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ES_VERSION=<span class="string">"7.15.0"</span></span><br><span class="line"><span class="built_in">export</span> ES_DIR=<span class="string">"/usr/local/elasticsearch-<span class="variable">$&#123;ES_VERSION&#125;</span>"</span></span><br><span class="line">wget -L https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-<span class="variable">$&#123;ES_VERSION&#125;</span>-linux-x86_64.tar.gz</span><br><span class="line">wget -L https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-<span class="variable">$&#123;ES_VERSION&#125;</span>-linux-x86_64.tar.gz.sha512</span><br><span class="line">shasum -a 512 -c elasticsearch-<span class="variable">$&#123;ES_VERSION&#125;</span>-linux-x86_64.tar.gz.sha512 </span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">  sudo tar -xzf elasticsearch-<span class="variable">$&#123;ES_VERSION&#125;</span>-linux-x86_64.tar.gz -C /usr/<span class="built_in">local</span></span><br><span class="line">  <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elasticsearch-<span class="variable">$&#123;ES_VERSION&#125;</span>/</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">"\e[31m[*] check shasum elasticsearch-<span class="variable">$&#123;ES_VERSION&#125;</span>-linux-x86_64.tar.gz failed! \e[0m"</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>Step 2.ç¯å¢ƒå˜é‡è®¾ç½®(ES/JAVA)ä»¥åŠESè¿è¡Œè´¦æˆ·åˆ›å»º<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ES_HOME / JAVA çš„ç¯å¢ƒå˜é‡é…ç½®</span></span><br><span class="line"><span class="keyword">if</span> [[ $(grep -c <span class="string">"ES_HOME"</span> /etc/profile) -eq 0 ]];<span class="keyword">then</span></span><br><span class="line">tee -a /etc/profile &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">ES_VERSION=<span class="string">"7.15.0"</span></span><br><span class="line">ES_HOME=<span class="string">"/usr/local/elasticsearch-<span class="variable">$&#123;ES_VERSION&#125;</span>"</span></span><br><span class="line">ES_JAVA_HOME=<span class="string">"<span class="variable">$&#123;ES_HOME&#125;</span>/jdk"</span></span><br><span class="line">PATH=<span class="variable">$&#123;ES_JAVA_HOME&#125;</span>/bin:<span class="variable">$&#123;ES_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> ES_VERSION ES_HOME ES_JAVA_HOME PATH</span><br><span class="line">EOF</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">"\e[31[*] melasticsearch environment failed! \e[0m"</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">  <span class="comment"># /usr/usr/local/elasticsearch-7.15.0/jdk/bin:/usr/usr/local/elasticsearch-7.15.0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ›å»ºè¿è¡Œ elasticsearch ç”¨æˆ·ä¸æƒé™è®¾ç½®</span></span><br><span class="line">groupadd elk &amp;&amp; useradd -s /bin/bash -U elk -g elk</span><br><span class="line">chown -R elk:elk <span class="variable">$&#123;ES_HOME&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>Step 3.åˆ›å»º ES é›†ç¾¤çš„PKCS#12è¯ä¹¦å’Œå®‰å…¨é…ç½®ï¼Œé€šè¿‡æŸ¥çœ‹å®˜ç½‘è¯ä¹¦çš„åˆ›å»º(ï¼ˆ<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.15/certutil.html)æ–¹å¼åˆ†ä¸ºä¸¤ç§ï¼šä¸€æ˜¯é€šè¿‡" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/7.15/certutil.html)æ–¹å¼åˆ†ä¸ºä¸¤ç§ï¼šä¸€æ˜¯é€šè¿‡</a> elasticsearch-certutil å‘½ä»¤é€ä¸€åˆ›å»ºè¯ä¹¦ï¼ŒäºŒæ˜¯ä½¿ç”¨ elasticsearch-certutil çš„ Silent Mode åˆ›å»ºã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.åœ¨instances.ymlä¸­è®°å½•é›†ç¾¤çš„èŠ‚ç‚¹åç§°å’ŒIPå®ä¾‹ä¿¡æ¯</span></span><br><span class="line">cat &gt; <span class="variable">$&#123;ES_HOME&#125;</span>/instances.yml&lt;&lt;EOF</span><br><span class="line">instances:</span><br><span class="line">  - name: <span class="string">"es01"</span> </span><br><span class="line">    ip: </span><br><span class="line">      - <span class="string">"10.10.107.225"</span></span><br><span class="line">  - name: <span class="string">"es02"</span></span><br><span class="line">    ip:</span><br><span class="line">      - <span class="string">"10.10.107.226"</span></span><br><span class="line">  - name: <span class="string">"es03"</span></span><br><span class="line">    ip:</span><br><span class="line">      - <span class="string">"10.10.107.227"</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æ­¤å¤„ä½¿ç”¨é™é»˜æ¨¡å¼(Silent Mode)ä¸€é”®åˆ›å»º</span></span><br><span class="line">bin/elasticsearch-certutil cert --silent --<span class="keyword">in</span> instances.yml --out ./config/cert.zip --pass testpassword</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.è¿›å…¥configç›®å½•å¹¶è§£å‹è¯ä¹¦æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elasticsearch-7.15.0/config &amp;&amp; unzip cert.zip</span><br><span class="line">Archive:  cert.zip</span><br><span class="line">   creating: es01/</span><br><span class="line">  inflating: es01/es01.p12</span><br><span class="line">   creating: es02/</span><br><span class="line">  inflating: es02/es02.p12</span><br><span class="line">   creating: es03/</span><br><span class="line">  inflating: es03/es03.p12</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.å°†æ­¤å¤„zipåˆ†åˆ«æ‹·è´åˆ°ES02/ES03æœºå™¨çš„/usr/usr/local/elasticsearch-7.15.0/configç›®å½•ä¸‹ã€‚</span></span><br><span class="line">scp -P 20211 cert.zip weiyigeek@10.10.107.226:/tmp</span><br><span class="line">scp -P 20211 cert.zip weiyigeek@10.10.107.227:/tmp</span><br><span class="line">unzip /tmp/cert.zip -d <span class="variable">$&#123;ES_HOME&#125;</span>/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.æ‰€æœ‰èŠ‚ç‚¹å­˜å…¥ PKCS#12 ç§˜é’¥çš„å¯†ç ,æ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œ</span></span><br><span class="line"><span class="comment"># ç”Ÿæˆ keystore æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$&#123;ES_HOME&#125;</span> &amp;&amp; ./bin/elasticsearch-keystore create</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹é¢ä¸¤ä¸ªå‘½ä»¤ï¼Œå‡éœ€è¦ è¾“å…¥ åœ¨ ç”Ÿæˆ PKCS#12 ç§˜é’¥ æ—¶çš„å¯†ç (testpassword)</span></span><br><span class="line">./bin/elasticsearch-keystore add xpack.security.transport.ssl.keystore.secure_password</span><br><span class="line">./bin/elasticsearch-keystore add xpack.security.transport.ssl.truststore.secure_password</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.æŸ¥çœ‹æ·»åŠ çš„å¯†é’¥</span></span><br><span class="line">./bin/elasticsearch-keystore list</span><br><span class="line">  <span class="comment"># keystore.seed</span></span><br><span class="line">  <span class="comment"># xpack.security.transport.ssl.keystore.secure_password</span></span><br><span class="line">  <span class="comment"># xpack.security.transport.ssl.truststore.secure_password</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.elastic è®¤è¯ä¹‹é…ç½®å†…ç½®ç”¨æˆ·çš„å¯†ç (é›†ç¾¤å¯åŠ¨åå°†ä¼šè‡ªåŠ¨åŒæ­¥)</span></span><br><span class="line"><span class="variable">$&#123;ES_HOME&#125;</span>/bin/elasticsearch-setup-passwords interactive</span><br><span class="line">  <span class="comment"># Enter password for [elastic]: weiyi123456</span></span><br><span class="line">  <span class="comment"># Reenter password for [elastic]: weiyi123456</span></span><br><span class="line"> ....</span><br><span class="line">  <span class="comment"># Enter password for [remote_monitoring_user]:</span></span><br><span class="line">  <span class="comment"># Reenter password for [remote_monitoring_user]:</span></span><br><span class="line">  <span class="comment"># Changed password for user [apm_system]</span></span><br><span class="line">  <span class="comment"># Changed password for user [kibana_system] weiyigeek</span></span><br><span class="line">  <span class="comment"># Changed password for user [kibana]        weiyigeek</span></span><br><span class="line">  <span class="comment"># Changed password for user [logstash_system]</span></span><br><span class="line">  <span class="comment"># Changed password for user [beats_system]</span></span><br><span class="line">  <span class="comment"># Changed password for user [remote_monitoring_user]</span></span><br><span class="line">  <span class="comment"># Changed password for user [elastic]</span></span><br><span class="line"><span class="comment"># ä¸Šé¢è¿‡ç¨‹ä¸­æˆ‘ä»¬éœ€è¦è®¾ç½®å¤šä¸ªé»˜è®¤ç”¨æˆ·çš„ä¿¡æ¯ï¼Œæ¯ä¸ªå†…ç½®ç”¨æˆ·è´Ÿè´£ä¸åŒçš„å†…å®¹ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.å¦‚æœä½ ä¸æƒ³ä½¿ç”¨ä¸Šé¢å†…ç½®çš„ç”¨æˆ·ï¼Œæ‚¨ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå·±æŒ‡å®šçš„ç”¨æˆ·åç§°</span></span><br><span class="line"><span class="variable">$&#123;ES_HOME&#125;</span>/bin/elasticsearch-users useradd weiyigeek -p password -r superuser</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>Step 4.é…ç½®ä¸‰å°ä¸»æœºä¸­ESçš„systemdæ¥ç®¡ç†å®ƒã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0.åˆ›å»ºSystemctlåœ¨è¿›è¡ŒESå¯åŠ¨æ—¶çš„ç¯å¢ƒå˜é‡ï¼Œæ­¤ç§æ–¹æ³•å¯ä»¥è§£æå˜é‡</span></span><br><span class="line">cat &lt;&lt; EOF &gt; <span class="variable">$&#123;ES_HOME&#125;</span>/es.env </span><br><span class="line">ES_HOME=<span class="variable">$&#123;ES_HOME&#125;</span></span><br><span class="line">ES_PATH_CONF=<span class="variable">$&#123;ES_HOME&#125;</span>/config/</span><br><span class="line">PID_DIR=/var/run</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.é‡‡ç”¨ systemd è¿›è¡ŒESæœåŠ¡ç®¡ç†çš„serviceæ–‡ä»¶åˆ›å»ºã€‚</span></span><br><span class="line">sudo tee /usr/lib/systemd/system/elasticsearch.service &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Elasticsearch Services Manager</span><br><span class="line">Documentation=http://www.elastic.co</span><br><span class="line">Wants=network-online.target</span><br><span class="line">After=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=elk</span><br><span class="line">Group=elk</span><br><span class="line">RuntimeDirectory=elk</span><br><span class="line">EnvironmentFile=-/usr/<span class="built_in">local</span>/elasticsearch-7.15.0/es.env</span><br><span class="line">WorkingDirectory=/usr/<span class="built_in">local</span>/elasticsearch-7.15.0/</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/elasticsearch-7.15.0/bin/elasticsearch -p /usr/<span class="built_in">local</span>/elasticsearch-7.15.0/elasticsearch.pid --quiet</span><br><span class="line"></span><br><span class="line"><span class="comment"># StandardOutputé…ç½®ä¸ºé”™è¯¯é‡å®šå‘åˆ°journalctlï¼Œå¦‚æœæ‚¨è¿˜æƒ³å¯ç”¨journalctlè®°å½•æ—¥å¿—æ—¶åªéœ€ä»ExecStartä¸­åˆ é™¤quieté€‰é¡¹å³å¯ã€‚</span></span><br><span class="line">StandardOutput=journal</span><br><span class="line">StandardError=inherit</span><br><span class="line"></span><br><span class="line"><span class="comment"># Specifies the maximum file descriptor number that can be opened by this process</span></span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"></span><br><span class="line"><span class="comment"># Specifies the maximum number of processes</span></span><br><span class="line">LimitNPROC=4096</span><br><span class="line"></span><br><span class="line"><span class="comment"># Specifies the maximum size of virtual memory</span></span><br><span class="line">LimitAS=infinity</span><br><span class="line"></span><br><span class="line"><span class="comment"># Specifies the maximum file size</span></span><br><span class="line">LimitFSIZE=infinity</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable timeout logic and wait until process is stopped</span></span><br><span class="line">TimeoutStopSec=0</span><br><span class="line"></span><br><span class="line"><span class="comment"># SIGTERM signal is used to stop the Java process</span></span><br><span class="line">KillSignal=SIGTERM</span><br><span class="line"></span><br><span class="line"><span class="comment"># Send the signal only to the JVM rather than its control group</span></span><br><span class="line">KillMode=process</span><br><span class="line"></span><br><span class="line"><span class="comment"># Java process is never killed</span></span><br><span class="line">SendSIGKILL=no</span><br><span class="line"></span><br><span class="line"><span class="comment"># When a JVM receives a SIGTERM signal it exits with code 143</span></span><br><span class="line">SuccessExitStatus=143</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.é‡è½½ systemd åå°å®ˆæŠ¤è¿›ç¨‹</span></span><br><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<ul>
<li>Step 5.ESé›†ç¾¤é…ç½®æ–‡ä»¶ï¼ˆä¸‰å°æœºå™¨ï¼‰<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ï¼ˆ1ï¼‰Master - es01</span></span><br><span class="line"><span class="string">tee</span> <span class="string">$&#123;ES_HOME&#125;/config/elasticsearch.yml</span> <span class="string">&lt;&lt;'EOF'</span></span><br><span class="line"><span class="comment">#------- é›†ç¾¤Cluster -------</span></span><br><span class="line"><span class="comment">#- é›†ç¾¤åç§°</span></span><br><span class="line"><span class="string">cluster.name:</span> <span class="string">es-cluster</span></span><br><span class="line"><span class="comment">#- é›†ç¾¤åˆå§‹åŒ–æ—¶æŒ‡å®šçš„MasterèŠ‚ç‚¹ã€‚</span></span><br><span class="line"><span class="string">cluster.initial_master_nodes:</span> <span class="string">["es01"]</span></span><br><span class="line"><span class="comment">#- é›†ç¾¤èŠ‚ç‚¹åˆ—è¡¨</span></span><br><span class="line"><span class="string">discovery.seed_hosts:</span> <span class="string">["10.10.107.225","10.10.107.226","10.10.107.227"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#------- èŠ‚ç‚¹Node -------</span></span><br><span class="line"><span class="string">node.name:</span> <span class="string">es01</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------ç½‘ç»œNetwork -------</span></span><br><span class="line"><span class="comment"># ç›‘å¬æ¥å£</span></span><br><span class="line"><span class="string">network.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="comment"># ESçš„HTTPæœåŠ¡ç«¯å£</span></span><br><span class="line"><span class="string">http.port:</span> <span class="number">9200</span></span><br><span class="line"><span class="comment"># ESçš„TCPæœåŠ¡ç«¯å£(é›†ç¾¤ä½¿ç”¨)</span></span><br><span class="line"><span class="string">transport.tcp.port:</span> <span class="number">9300</span></span><br><span class="line"><span class="comment"># ESçš„TCPæœåŠ¡ç«¯å£(å‹ç¼©ä¼ è¾“)</span></span><br><span class="line"><span class="string">transport.tcp.compress:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------æ•°æ®ä¸æ—¥å¿—å­˜å‚¨ç›®å½•--------</span></span><br><span class="line"><span class="string">path.data:</span> <span class="string">/usr/local/elasticsearch-7.15.0/data</span></span><br><span class="line"><span class="string">path.logs:</span> <span class="string">/usr/local/elasticsearch-7.15.0/logs</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------æ€§èƒ½Perfece--------</span></span><br><span class="line"><span class="comment"># ARM CPU æ‰å¼€å¯ï¼Œè¯•å°†è¿›ç¨‹åœ°å€ç©ºé—´é”å®šåˆ° RAM ä¸­ä»¥é˜²æ­¢ä»»ä½• Elasticsearch å †å†…å­˜è¢«æ¢å‡ºï¼Œä½†ä¸ºäº†æ€§èƒ½æˆ‘ä»¬éœ€è¦å°†å…¶å…³é—­ã€‚</span></span><br><span class="line"><span class="comment">#bootstrap.memory_lock: fasle</span></span><br><span class="line"><span class="comment">#bootstrap.system_call_filter: false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------æ’ä»¶è·¨åŸŸé…ç½®--------</span></span><br><span class="line"><span class="string">http.cors.enabled:</span> <span class="literal">true</span> </span><br><span class="line"><span class="string">http.cors.allow-origin:</span> <span class="string">"*"</span></span><br><span class="line"><span class="string">http.cors.allow-headers:</span> <span class="string">Authorization,X-Requested-With,Content-Type,Content-Length</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#--------è¯ä¹¦å®‰å…¨é…ç½®----------</span></span><br><span class="line"><span class="string">xpack.security.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="string">xpack.security.transport.ssl.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="string">xpack.security.transport.ssl.keystore.path:</span> <span class="string">es01/es01.p12</span></span><br><span class="line"><span class="string">xpack.security.transport.ssl.truststore.path:</span> <span class="string">es01/es01.p12</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) node - es02</span></span><br><span class="line"><span class="string">sed</span> <span class="bullet">-i</span> <span class="bullet">-e</span> <span class="string">'s#es01#es02#g'</span> <span class="bullet">-e</span> <span class="string">'s#"es02"#"es01"#g'</span> <span class="string">$&#123;ES_HOME&#125;/config/elasticsearch.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) node - es03</span></span><br><span class="line"><span class="string">sed</span> <span class="bullet">-i</span> <span class="bullet">-e</span> <span class="string">'s#es01#es03#g'</span> <span class="bullet">-e</span> <span class="string">'s#"es03"#"es01"#g'</span> <span class="string">$&#123;ES_HOME&#125;/config/elasticsearch.yml</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<ul>
<li>Step 6.å¯åŠ¨ESå‰çš„æœ€åä¸€æ¬¡é…ç½®ï¼Œç„¶åä¾æ¬¡å¯åŠ¨elasticæœåŠ¡<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.æ ¹æ®èŠ‚ç‚¹æœºå™¨çš„é…ç½®è®¾ç½®å…¶jvmå‚æ•°ã€‚ï¼ˆéå¸¸æ³¨æ„ç³»ç»Ÿå†…å­˜ä¸€å®šè¦å¤§äºè®¾ç½®ï¼‰</span></span><br><span class="line"><span class="comment"># JVM heap size é»˜è®¤ä¸º4Gï¼Œå…¶ä¸­æœ€å¤§å€¼å’Œæœ€å°å€¼å¿…é¡»ä¸€è‡´ã€‚</span></span><br><span class="line"><span class="comment"># sed -i -e 's|## -Xms4g|-Xms4g|g' -e  's|## -Xmx4g|-Xmx4g|g' $&#123;ES_HOME&#125;/config/jvm.options</span></span><br><span class="line"><span class="comment"># sed -i -e 's@## -Xmx4g@-Xmx2g@g' -e "s@## -Xms4g@-Xms2g@g" $&#123;ES_HOME&#125;/config/jvm.options</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.å†æ¬¡å¯¹ $&#123;ES_HOME&#125; ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ç›®å½•è¿›è¡Œæˆæƒï¼Œé˜²æ­¢elkç”¨æˆ·æ²¡æœ‰è®¿é—®æƒé™ã€‚</span></span><br><span class="line">chown -R elk:elk <span class="variable">$&#123;ES_HOME&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.å¯åŠ¨å¹¶æŸ¥çœ‹ESæœåŠ¡</span></span><br><span class="line">systemctl start elasticsearch.service</span><br><span class="line">systemctl status elasticsearch.service</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=2.ElasticStackåˆ†å¸ƒå¼æ•°æ®é‡‡é›†æœç´¢å¼•æ“é›†ç¾¤æ­å»ºé…ç½® href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211006095342.png" target="_blank" title="WeiyiGeek.ES_CLUSTER_START" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211006095342.png" alt="WeiyiGeek.ES_CLUSTER_START" title="" class=""></a>
                <p>WeiyiGeek.ES_CLUSTER_START</p>
            </figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>Step 7.éªŒè¯ESé›†ç¾¤æœåŠ¡æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.è®¿é—®ä¸‰å°ä¸»æœºçš„ESæœåŠ¡ï¼Œé‡‡ç”¨-ué€‰æ‹©æŒ‡å®šå‰é¢æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„ç”¨æˆ·ã€‚</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;225..227&#125;;<span class="keyword">do</span></span><br><span class="line">  curl -u weiyigeek:password 10.10.107.<span class="variable">$&#123;i&#125;</span>:9200</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">  <span class="comment"># &#123;</span></span><br><span class="line">  <span class="comment">#   "name" : "es01",</span></span><br><span class="line">  <span class="comment">#   "cluster_name" : "es-cluster",</span></span><br><span class="line">  <span class="comment">#   "cluster_uuid" : "f4MbDAeMReOH7XeGHr5irA",</span></span><br><span class="line">  <span class="comment">#   "version" : &#123;</span></span><br><span class="line">  <span class="comment">#     "number" : "7.15.0",</span></span><br><span class="line">  <span class="comment">#     "build_flavor" : "default",</span></span><br><span class="line">  <span class="comment">#     "build_type" : "tar",</span></span><br><span class="line">  <span class="comment">#     "build_hash" : "79d65f6e357953a5b3cbcc5e2c7c21073d89aa29",</span></span><br><span class="line">  <span class="comment">#     "build_date" : "2021-09-16T03:05:29.143308416Z",</span></span><br><span class="line">  <span class="comment">#     "build_snapshot" : false,</span></span><br><span class="line">  <span class="comment">#     "lucene_version" : "8.9.0",</span></span><br><span class="line">  <span class="comment">#     "minimum_wire_compatibility_version" : "6.8.0",</span></span><br><span class="line">  <span class="comment">#     "minimum_index_compatibility_version" : "6.0.0-beta1"</span></span><br><span class="line">  <span class="comment">#   &#125;,</span></span><br><span class="line">  <span class="comment">#   "tagline" : "You Know, for Search"</span></span><br><span class="line">  <span class="comment"># &#125;</span></span><br><span class="line">  <span class="comment"># &#123;</span></span><br><span class="line">  <span class="comment">#   "name" : "es02",</span></span><br><span class="line">  <span class="comment">#   "cluster_name" : "es-cluster",</span></span><br><span class="line">  <span class="comment">#   "cluster_uuid" : "f4MbDAeMReOH7XeGHr5irA",</span></span><br><span class="line">  <span class="comment">#   "version" : &#123;</span></span><br><span class="line">  <span class="comment">#     "number" : "7.15.0",</span></span><br><span class="line">  <span class="comment">#     "build_flavor" : "default",</span></span><br><span class="line">  <span class="comment">#     "build_type" : "tar",</span></span><br><span class="line">  <span class="comment">#     "build_hash" : "79d65f6e357953a5b3cbcc5e2c7c21073d89aa29",</span></span><br><span class="line">  <span class="comment">#     "build_date" : "2021-09-16T03:05:29.143308416Z",</span></span><br><span class="line">  <span class="comment">#     "build_snapshot" : false,</span></span><br><span class="line">  <span class="comment">#     "lucene_version" : "8.9.0",</span></span><br><span class="line">  <span class="comment">#     "minimum_wire_compatibility_version" : "6.8.0",</span></span><br><span class="line">  <span class="comment">#     "minimum_index_compatibility_version" : "6.0.0-beta1"</span></span><br><span class="line">  <span class="comment">#   &#125;,</span></span><br><span class="line">  <span class="comment">#   "tagline" : "You Know, for Search"</span></span><br><span class="line">  <span class="comment"># &#125;</span></span><br><span class="line">  <span class="comment"># &#123;</span></span><br><span class="line">  <span class="comment">#   "name" : "es03",</span></span><br><span class="line">  <span class="comment">#   "cluster_name" : "es-cluster",</span></span><br><span class="line">  <span class="comment">#   "cluster_uuid" : "f4MbDAeMReOH7XeGHr5irA",</span></span><br><span class="line">  <span class="comment">#   "version" : &#123;</span></span><br><span class="line">  <span class="comment">#     "number" : "7.15.0",</span></span><br><span class="line">  <span class="comment">#     "build_flavor" : "default",</span></span><br><span class="line">  <span class="comment">#     "build_type" : "tar",</span></span><br><span class="line">  <span class="comment">#     "build_hash" : "79d65f6e357953a5b3cbcc5e2c7c21073d89aa29",</span></span><br><span class="line">  <span class="comment">#     "build_date" : "2021-09-16T03:05:29.143308416Z",</span></span><br><span class="line">  <span class="comment">#     "build_snapshot" : false,</span></span><br><span class="line">  <span class="comment">#     "lucene_version" : "8.9.0",</span></span><br><span class="line">  <span class="comment">#     "minimum_wire_compatibility_version" : "6.8.0",</span></span><br><span class="line">  <span class="comment">#     "minimum_index_compatibility_version" : "6.0.0-beta1"</span></span><br><span class="line">  <span class="comment">#   &#125;,</span></span><br><span class="line">  <span class="comment">#   "tagline" : "You Know, for Search"</span></span><br><span class="line">  <span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æŸ¥ESé›†ç¾¤è§’è‰²ä¸èŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">$ curl -u weiyigeek:password 10.10.107.226:9200/_cat/nodes?v</span><br><span class="line">  <span class="comment"># ip            heap.percent ram.percent cpu load_1m load_5m load_15m node.role   master name</span></span><br><span class="line">  <span class="comment"># 10.10.107.226           17          93   1    0.00    0.03     0.04 cdfhilmrstw -      es02</span></span><br><span class="line">  <span class="comment"># 10.10.107.227           14          95   0    0.00    0.04     0.02 cdfhilmrstw -      es03</span></span><br><span class="line">  <span class="comment"># 10.10.107.225           23          97   0    0.00    0.02     0.01 cdfhilmrstw *      es01</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<ul>
<li>Step 8.ESé›†ç¾¤é«˜å¯ç”¨éªŒè¯<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.æ­¤æ—¶æˆ‘ä»¬æŠŠ10.10.107.225èŠ‚ç‚¹æœåŠ¡å…³é—­</span></span><br><span class="line">systemctl stop elasticsearch.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.å†æ¬¡è¯·æ±‚èŠ‚ç‚¹æŸ¥çœ‹ï¼Œå‘ç°es02å·²ä»slaveå˜ä¸ºäº†master</span></span><br><span class="line">curl -u weiyigeek:password 10.10.107.226:9200/_cat/nodes?v</span><br><span class="line">  <span class="comment"># ip            heap.percent ram.percent cpu load_1m load_5m load_15m node.role   master name</span></span><br><span class="line">  <span class="comment"># 10.10.107.227           47          96   0    0.00    0.00     0.00 cdfhilmrstw -      es03</span></span><br><span class="line">  <span class="comment"># 10.10.107.226           53          93   0    0.11    0.04     0.01 cdfhilmrstw *      es02</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.å½“æŠŠ10.10.107.225èŠ‚ç‚¹çš„ESæœåŠ¡é‡å¯åï¼Œå®ƒä¼šè‡ªåŠ¨åŠ å…¥åˆ°é›†ç¾¤ä¹‹ä¸­ï¼Œå…¶è§’è‰²å˜ä¸ºslaveã€‚</span></span><br><span class="line">curl -u weiyigeek:password 10.10.107.226:9200/_cat/nodes?v</span><br><span class="line">  <span class="comment"># ip            heap.percent ram.percent cpu load_1m load_5m load_15m node.role   master name</span></span><br><span class="line">  <span class="comment"># 10.10.107.226           36          94   1    0.02    0.03     0.00 cdfhilmrstw *      es02</span></span><br><span class="line">  <span class="comment"># 10.10.107.227           34          96   0    0.01    0.02     0.00 cdfhilmrstw -      es03</span></span><br><span class="line">  <span class="comment"># 10.10.107.225           18          95   9    0.34    0.10     0.04 cdfhilmrstw -      es01</span></span><br></pre></td></tr></table></figure>
<br/></li>
</ul>
<h3 id="2-docker-compose-å®‰è£…"><a href="#2-docker-compose-å®‰è£…" class="headerlink" title="2.docker-compose å®‰è£…"></a>2.docker-compose å®‰è£…</h3><p>æè¿°: è¦åœ¨ Docker ä¸­å¯åŠ¨å¹¶è¿è¡Œä¸‰èŠ‚ç‚¹ Elasticsearch é›†ç¾¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Docker Composeï¼š</p>
<p>docker-compose.yml<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'2.2'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  es01:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">docker.elastic.co/elasticsearch/elasticsearch:7.5.2</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">es01</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">node.name=es01</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">cluster.name=es-docker-cluster</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">discovery.seed_hosts=es02,es03</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">cluster.initial_master_nodes=es01,es02,es03</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">bootstrap.memory_lock=true</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span></span><br><span class="line"><span class="attr">    ulimits:</span></span><br><span class="line"><span class="attr">      memlock:</span></span><br><span class="line"><span class="attr">        soft:</span> <span class="bullet">-1</span></span><br><span class="line"><span class="attr">        hard:</span> <span class="bullet">-1</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="attr">      - data01:</span><span class="string">/usr/share/elasticsearch/data</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="number">9200</span><span class="string">:9200</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">elastic</span></span><br><span class="line"><span class="attr">  es02:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">docker.elastic.co/elasticsearch/elasticsearch:7.5.2</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">es02</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">node.name=es02</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">cluster.name=es-docker-cluster</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">discovery.seed_hosts=es01,es03</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">cluster.initial_master_nodes=es01,es02,es03</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">bootstrap.memory_lock=true</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span></span><br><span class="line"><span class="attr">    ulimits:</span></span><br><span class="line"><span class="attr">      memlock:</span></span><br><span class="line"><span class="attr">        soft:</span> <span class="bullet">-1</span></span><br><span class="line"><span class="attr">        hard:</span> <span class="bullet">-1</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="attr">      - data02:</span><span class="string">/usr/share/elasticsearch/data</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">elastic</span></span><br><span class="line"><span class="attr">  es03:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">docker.elastic.co/elasticsearch/elasticsearch:7.5.2</span></span><br><span class="line"><span class="attr">    container_name:</span> <span class="string">es03</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">node.name=es03</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">cluster.name=es-docker-cluster</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">discovery.seed_hosts=es01,es02</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">cluster.initial_master_nodes=es01,es02,es03</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">bootstrap.memory_lock=true</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span></span><br><span class="line"><span class="attr">    ulimits:</span></span><br><span class="line"><span class="attr">      memlock:</span></span><br><span class="line"><span class="attr">        soft:</span> <span class="bullet">-1</span></span><br><span class="line"><span class="attr">        hard:</span> <span class="bullet">-1</span></span><br><span class="line"><span class="attr">    volumes:</span></span><br><span class="line"><span class="attr">      - data03:</span><span class="string">/usr/share/elasticsearch/data</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">elastic</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line"><span class="attr">  data01:</span></span><br><span class="line"><span class="attr">    driver:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">  data02:</span></span><br><span class="line"><span class="attr">    driver:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">  data03:</span></span><br><span class="line"><span class="attr">    driver:</span> <span class="string">local</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line"><span class="attr">  elastic:</span></span><br><span class="line"><span class="attr">    driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œéƒ¨ç½²å‘½ä»¤<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d .</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="4-K8S-å®‰è£…"><a href="#4-K8S-å®‰è£…" class="headerlink" title="4.K8S å®‰è£…"></a>4.K8S å®‰è£…</h3><p>æ­¤å¤„ä½¿ç”¨å®˜æ–¹ç¤ºä¾‹ Elasticsearch StatefulSet å°†ä½¿ç”¨ EmptyDir å·æ¥å­˜å‚¨æ•°æ®,å½“ pod ç»ˆæ­¢æ—¶EmptyDir å°†è¢«æ“¦é™¤ï¼Œå¦‚æœæƒ³è¦æ•°æ®æŒä¹…åŒ–å¯å°†å­˜å‚¨æ›´æ”¹ä¸ºæ°¸ä¹…å·å£°æ˜ã€‚</p>
<p>è®¿é—®redhat ä»“åº“æŸ¥çœ‹ elasticsearch å¯ç”¨ç‰ˆæœ¬(<a href="https://quay.io/repository/fluentd_elasticsearch/elasticsearch?tab=tags" target="_blank" rel="noopener">https://quay.io/repository/fluentd_elasticsearch/elasticsearch?tab=tags</a>)</p>
<p>æ¸©é¦¨æç¤º: å»ºè®®æå‰æ‹‰å– <code>quay.io/fluentd_elasticsearch/elasticsearch:v7.16.2</code> é•œåƒåˆ°ç§æœ‰ä»“åº“ä¹‹ä¸­ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ­¤å¤„åˆ©ç”¨skopeoé•œåƒæ¬è¿å·¥å·¥å…·, ä¸çŸ¥é“å¦‚ä½•å®‰è£…ä½¿ç”¨çš„è¯·å‚è€ƒï¼Œæˆ‘çš„å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼ˆSkopeoå¦‚ä½•ä¼˜é›…çš„åšä¸€ä¸ªé•œåƒæ¬è¿å·¥ï¼‰</span></span><br><span class="line">skopeo copy --insecure-policy --src-tls-verify=<span class="literal">false</span> --dest-tls-verify=<span class="literal">false</span> --dest-authfile /root/.docker/config.json docker://quay.io/fluentd_elasticsearch/elasticsearch:v7.16.2 docker://harbor.cloud/weiyigeek/elasticsearch:v7.16.2</span><br></pre></td></tr></table></figure></p>
<p>å®‰è£…ESé›†ç¾¤çš„çš„é…ç½®æ¸…å•yamlæ–‡ä»¶ã€‚<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">tee</span> <span class="string">es-statefulset.yml</span> <span class="string">&lt;&lt;'EOF'</span></span><br><span class="line"><span class="comment"># RBAC authn and authz</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">elasticsearch-logging</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    k8s-app:</span> <span class="string">elasticsearch-logging</span></span><br><span class="line">    <span class="string">addonmanager.kubernetes.io/mode:</span> <span class="string">Reconcile</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">elasticsearch-logging</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    k8s-app:</span> <span class="string">elasticsearch-logging</span></span><br><span class="line">    <span class="string">addonmanager.kubernetes.io/mode:</span> <span class="string">Reconcile</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="attr">  - apiGroups:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">""</span></span><br><span class="line"><span class="attr">    resources:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"services"</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"namespaces"</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"endpoints"</span></span><br><span class="line"><span class="attr">    verbs:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"get"</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">elasticsearch-logging</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    k8s-app:</span> <span class="string">elasticsearch-logging</span></span><br><span class="line">    <span class="string">addonmanager.kubernetes.io/mode:</span> <span class="string">Reconcile</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="attr">  - kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">elasticsearch-logging</span></span><br><span class="line"><span class="attr">    namespace:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">    apiGroup:</span> <span class="string">""</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line"><span class="attr">  kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">elasticsearch-logging</span></span><br><span class="line"><span class="attr">  apiGroup:</span> <span class="string">""</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Elasticsearch deployment itself</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">elasticsearch-logging</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    k8s-app:</span> <span class="string">elasticsearch-logging</span></span><br><span class="line"><span class="attr">    version:</span> <span class="string">v7.16.2</span></span><br><span class="line">    <span class="string">addonmanager.kubernetes.io/mode:</span> <span class="string">Reconcile</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  serviceName:</span> <span class="string">elasticsearch-logging</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      k8s-app:</span> <span class="string">elasticsearch-logging</span></span><br><span class="line"><span class="attr">      version:</span> <span class="string">v7.16.2</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        k8s-app:</span> <span class="string">elasticsearch-logging</span></span><br><span class="line"><span class="attr">        version:</span> <span class="string">v7.16.2</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      serviceAccountName:</span> <span class="string">elasticsearch-logging</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">        - image:</span> <span class="string">quay.io/fluentd_elasticsearch/elasticsearch:v7.16.2</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">elasticsearch-logging</span></span><br><span class="line"><span class="attr">          imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line"><span class="attr">          resources:</span></span><br><span class="line">            <span class="comment"># need more cpu upon initialization, therefore burstable class</span></span><br><span class="line"><span class="attr">            limits:</span></span><br><span class="line"><span class="attr">              cpu:</span> <span class="number">1000</span><span class="string">m</span></span><br><span class="line"><span class="attr">              memory:</span> <span class="number">3</span><span class="string">Gi</span></span><br><span class="line"><span class="attr">            requests:</span></span><br><span class="line"><span class="attr">              cpu:</span> <span class="number">100</span><span class="string">m</span></span><br><span class="line"><span class="attr">              memory:</span> <span class="number">3</span><span class="string">Gi</span></span><br><span class="line"><span class="attr">          ports:</span></span><br><span class="line"><span class="attr">            - containerPort:</span> <span class="number">9200</span></span><br><span class="line"><span class="attr">              name:</span> <span class="string">db</span></span><br><span class="line"><span class="attr">              protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">            - containerPort:</span> <span class="number">9300</span></span><br><span class="line"><span class="attr">              name:</span> <span class="string">transport</span></span><br><span class="line"><span class="attr">              protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">          livenessProbe:</span></span><br><span class="line"><span class="attr">            tcpSocket:</span></span><br><span class="line"><span class="attr">              port:</span> <span class="string">transport</span></span><br><span class="line"><span class="attr">            initialDelaySeconds:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">            timeoutSeconds:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">          readinessProbe:</span></span><br><span class="line"><span class="attr">            tcpSocket:</span></span><br><span class="line"><span class="attr">              port:</span> <span class="string">transport</span></span><br><span class="line"><span class="attr">            initialDelaySeconds:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">            timeoutSeconds:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">          volumeMounts:</span></span><br><span class="line"><span class="attr">            - name:</span> <span class="string">elasticsearch-logging</span></span><br><span class="line"><span class="attr">              mountPath:</span> <span class="string">/data</span></span><br><span class="line"><span class="attr">          env:</span></span><br><span class="line"><span class="attr">            - name:</span> <span class="string">"NAMESPACE"</span></span><br><span class="line"><span class="attr">              valueFrom:</span></span><br><span class="line"><span class="attr">                fieldRef:</span></span><br><span class="line"><span class="attr">                  fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line"><span class="attr">            - name:</span> <span class="string">"MINIMUM_MASTER_NODES"</span></span><br><span class="line"><span class="attr">              value:</span> <span class="string">"1"</span></span><br><span class="line"><span class="attr">      volumes:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">elasticsearch-logging</span></span><br><span class="line"><span class="attr">          emptyDir:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">      <span class="comment"># Elasticsearch requires vm.max_map_count to be at least 262144.</span></span><br><span class="line">      <span class="comment"># If your OS already sets up this number to a higher value, feel free</span></span><br><span class="line">      <span class="comment"># to remove this init container.</span></span><br><span class="line"><span class="attr">      initContainers:</span></span><br><span class="line"><span class="attr">        - image:</span> <span class="attr">alpine:3.15</span></span><br><span class="line"><span class="attr">          command:</span> <span class="string">["/sbin/sysctl",</span> <span class="string">"-w"</span><span class="string">,</span> <span class="string">"vm.max_map_count=262144"</span><span class="string">]</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">elasticsearch-logging-init</span></span><br><span class="line"><span class="attr">          securityContext:</span></span><br><span class="line"><span class="attr">            privileged:</span> <span class="literal">true</span> </span><br><span class="line">  <span class="comment"># volumeClaimTemplates:</span></span><br><span class="line">  <span class="comment"># - apiVersion: v1</span></span><br><span class="line">  <span class="comment">#   kind: PersistentVolumeClaim</span></span><br><span class="line">  <span class="comment">#   metadata:</span></span><br><span class="line">  <span class="comment">#     name: elasticsearch-logging</span></span><br><span class="line">  <span class="comment">#   spec:</span></span><br><span class="line">  <span class="comment">#     accessModes:</span></span><br><span class="line">  <span class="comment">#     - ReadWriteOnce</span></span><br><span class="line">  <span class="comment">#     resources:</span></span><br><span class="line">  <span class="comment">#       requests:</span></span><br><span class="line">  <span class="comment">#         storage: 5Gi</span></span><br><span class="line">  <span class="comment">#     storageClassName: managed-nfs-storage</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="4-Helm-å®‰è£…"><a href="#4-Helm-å®‰è£…" class="headerlink" title="4.Helm å®‰è£…"></a>4.Helm å®‰è£…</h3><p>å®˜æ–¹é¡¹ç›®åœ°å€: <a href="https://github.com/elastic/helm-charts" target="_blank" rel="noopener">https://github.com/elastic/helm-charts</a></p>
<p><strong>å®‰è£…æµç¨‹</strong></p>
<ul>
<li><p>Step 1.å®‰è£…ç¯å¢ƒä»¥åŠChartså‡†å¤‡;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) æ·»åŠ  elastic ä»“åº“</span></span><br><span class="line">~/K8s/Day11$ helm repo add elastic https://helm.elastic.co</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) æ‹‰å– elasticsearch / Filebeat / Kibana ç­‰ Chart åˆ°æœ¬åœ°å¹¶è§£å‹</span></span><br><span class="line">~/K8s/Day11$ helm fetch elastic/elasticsearch --untar</span><br><span class="line">~/K8s/Day11$ helm fetch elastic/filebeat --untar</span><br><span class="line">~/K8s/Day11$ helm fetch elastic/kibana --untar</span><br><span class="line">~/K8s/Day11$ tree -d 1 .</span><br><span class="line">  <span class="comment"># â”œâ”€â”€ elasticsearch</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”œâ”€â”€ examples</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”œâ”€â”€ config</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ test</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”œâ”€â”€ default</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ test</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”œâ”€â”€ docker-for-mac</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”œâ”€â”€ kubernetes-kind</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”œâ”€â”€ microk8s</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”œâ”€â”€ migration</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”œâ”€â”€ minikube</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”œâ”€â”€ multi</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ test</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”œâ”€â”€ openshift</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ test</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”œâ”€â”€ oss</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ test</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”œâ”€â”€ security</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ test</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â””â”€â”€ upgrade</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â      â””â”€â”€ test</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â””â”€â”€ templates</span></span><br><span class="line">  <span class="comment"># â”‚Â Â      â””â”€â”€ test</span></span><br><span class="line">  <span class="comment"># â”œâ”€â”€ filebeat</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”œâ”€â”€ examples</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”œâ”€â”€ default</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ test</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”œâ”€â”€ oss</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ test</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”œâ”€â”€ security</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ test</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â  â””â”€â”€ upgrade</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â”‚Â Â      â””â”€â”€ test</span></span><br><span class="line">  <span class="comment"># â”‚Â Â  â””â”€â”€ templates</span></span><br><span class="line">  <span class="comment"># â””â”€â”€ kibana</span></span><br><span class="line">  <span class="comment">#     â”œâ”€â”€ examples</span></span><br><span class="line">  <span class="comment">#     â”‚Â Â  â”œâ”€â”€ default</span></span><br><span class="line">  <span class="comment">#     â”‚Â Â  â”‚Â Â  â””â”€â”€ test</span></span><br><span class="line">  <span class="comment">#     â”‚Â Â  â”œâ”€â”€ openshift</span></span><br><span class="line">  <span class="comment">#     â”‚Â Â  â”‚Â Â  â””â”€â”€ test</span></span><br><span class="line">  <span class="comment">#     â”‚Â Â  â”œâ”€â”€ oss</span></span><br><span class="line">  <span class="comment">#     â”‚Â Â  â”‚Â Â  â””â”€â”€ test</span></span><br><span class="line">  <span class="comment">#     â”‚Â Â  â”œâ”€â”€ security</span></span><br><span class="line">  <span class="comment">#     â”‚Â Â  â”‚Â Â  â””â”€â”€ test</span></span><br><span class="line">  <span class="comment">#     â”‚Â Â  â””â”€â”€ upgrade</span></span><br><span class="line">  <span class="comment">#     â”‚Â Â      â””â”€â”€ test</span></span><br><span class="line">  <span class="comment">#     â””â”€â”€ templates</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 47 directories</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Step 2.åç§°ç©ºé—´åˆ›å»º(æš‚ä¸ä½¿ç”¨)ä»¥åŠelasticsearchçš„å®‰è£…éƒ¨ç½²</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) åç§°ç©ºé—´çš„åˆ›å»º ä»¥åŠå­˜å‚¨å·è®¿é—®æ¨¡å¼ä¸º ReadWriteOnce - efk-pv</span></span><br><span class="line">~/K8s/Day11/elasticsearch$ kubectl create namespace <span class="built_in">log</span>-efk</span><br><span class="line"><span class="comment"># PS : æ­¤å¤„éœ€è¦ä¾èµ–äºStorageNameåŠ¨æ€å­˜å‚¨å·ï¼Œæ‰€ä»¥æ‚¨éœ€è¦æå‰è¿›è¡Œé…ç½®;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) ç”±äºæµ‹è¯•ç¯å¢ƒèµ„æºæœ‰é™æˆ‘ä»¬å°†Chartsä¸­Valueså…³äºå‰¯æœ¬æ•°ä»¥åŠæœ€å°masterèŠ‚ç‚¹éƒ½è¯¥æˆ(3MasterèŠ‚ç‚¹~20Gå†…å­˜)</span></span><br><span class="line">~/K8s/Day11/elasticsearch$ vim values.yaml</span><br><span class="line"><span class="comment"># ä¿®æ”¹ç‚¹</span></span><br><span class="line">replicas: 1</span><br><span class="line">minimumMasterNodes: 1</span><br><span class="line"><span class="comment"># PS: ç”Ÿäº§ç¯å¢ƒä¸­æ¨èä¿®æ”¹values.yamlæ–‡ä»¶ä¸­pvä¸ºstorageClassåŠ¨æ€åˆ†é…</span></span><br><span class="line">volumeClaimTemplate:</span><br><span class="line">  accessModes: [ <span class="string">"ReadWriteOnce"</span> ]</span><br><span class="line">  storageClassName: <span class="string">"managed-nfs-storage"</span>   <span class="comment"># éå¸¸é‡è¦ å®ƒæ˜¯ä¸ StorageClass èµ„æºå™¨ç»‘å®šçš„åç§°è¦ä¸€è‡´</span></span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage: 20Gi</span><br><span class="line"><span class="comment"># PS :å¼€å¯æŒä¹…åŒ–</span></span><br><span class="line">persistence:     </span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">  labels:</span><br><span class="line">    enabled: <span class="literal">true</span>   <span class="comment"># ä¸ºæœ‰çŠ¶æ€é›†çš„volumeClaimTemplateæ·»åŠ é»˜è®¤æ ‡ç­¾ ( å‘ )</span></span><br><span class="line">  annotations: &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) å°†elasticsearchè¿›è¡Œå®‰è£…éƒ¨ç½² (-n log-efk) ä¸èƒ½æ­£å¸¸éƒ¨ç½² (å‘)</span></span><br><span class="line">~/K8s/Day11/elasticsearch$ helm install elasticsearch . </span><br><span class="line">  <span class="comment"># NAME: elasticsearch</span></span><br><span class="line">  <span class="comment"># LAST DEPLOYED: Wed Dec  9 09:52:35 2020</span></span><br><span class="line">  <span class="comment"># NAMESPACE: log-efk</span></span><br><span class="line">  <span class="comment"># STATUS: deployed</span></span><br><span class="line">  <span class="comment"># REVISION: 1</span></span><br><span class="line">  <span class="comment"># NOTES:</span></span><br><span class="line">  <span class="comment"># 1. Watch all cluster members come up.</span></span><br><span class="line">  <span class="comment">#   $ kubectl get pods-l app=elasticsearch-master -w</span></span><br><span class="line">  <span class="comment"># 2. Test cluster health using Helm test.</span></span><br><span class="line">  <span class="comment">#   $ helm test elasticsearch</span></span><br><span class="line"><span class="comment"># * Install it:</span></span><br><span class="line"><span class="comment">#   - with Helm 3: `helm install elasticsearch --version &lt;version&gt; elastic/elasticsearch`</span></span><br><span class="line"><span class="comment">#   - with Helm 2 (deprecated): `helm install --name elasticsearch --version &lt;version&gt; elastic/elasticsearch`</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Step 3.æŸ¥çœ‹StatefulSeteèµ„æºæ§åˆ¶å™¨åˆ›å»ºçš„elasticsearchä»¥åŠPVCå·çš„ç»‘å®šå’ŒSVC;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># StatefulSet</span></span><br><span class="line">~/K8s/Day11/elasticsearch$ kubectl get sts -o wide</span><br><span class="line">  <span class="comment"># NAME                   READY   AGE     CONTAINERS      IMAGES</span></span><br><span class="line">  <span class="comment"># elasticsearch-master   1/1     2m57s   elasticsearch   docker.elastic.co/elasticsearch/elasticsearch:7.10.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pod</span></span><br><span class="line">~/K8s/Day11/elasticsearch$ kubectl get pod -o wide --show-labels | grep <span class="string">"elasticsearch"</span></span><br><span class="line">  <span class="comment"># elasticsearch-master-0   1/1     Running   0     3m30s   10.244.1.180   k8s-node-4 app=elasticsearch-master,chart=elasticsearch,controller-revision-hash=elasticsearch-master-76c48b9f74,release=elasticsearch,statefulset.kubernetes.io/pod-name=elasticsearch-master-0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Svc</span></span><br><span class="line">~/K8s/Day11/elasticsearch$ kubectl get svc -o wide</span><br><span class="line">  <span class="comment"># NAME                            TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE     SELECTOR</span></span><br><span class="line">  <span class="comment"># elasticsearch-master            ClusterIP   10.104.178.144   &lt;none&gt;        9200/TCP,9300/TCP   9m49s   app=elasticsearch-master,chart=elasticsearch,release=elasticsearch</span></span><br><span class="line">  <span class="comment"># elasticsearch-master-headless   ClusterIP   None             &lt;none&gt;        9200/TCP,9300/TCP   9m49s   app=elasticsearch-master</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># StorageClass åŠ¨æ€å­˜å‚¨å·æŸ¥çœ‹</span></span><br><span class="line">~/K8s/Day11/elasticsearch$ kubectl get storageclass,pv,pvc</span><br><span class="line">  <span class="comment"># NAME                                                        PROVISIONER      RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span></span><br><span class="line">  <span class="comment"># storageclass.storage.k8s.io/managed-nfs-storage (default)   fuseim.pri/ifs   Delete          Immediate           false                  25h</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                                 STORAGECLASS          REASON   AGE</span></span><br><span class="line">  <span class="comment"># persistentvolume/pvc-8a991669-60c0-48c6-9879-5b4fa9d481c3   20Gi       RWO            Delete           Bound    default/elasticsearch-master-elasticsearch-master-0   managed-nfs-storage            2m6s</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># NAME                                                                STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS          AGE</span></span><br><span class="line">  <span class="comment"># persistentvolumeclaim/elasticsearch-master-elasticsearch-master-0   Bound    pvc-8a991669-60c0-48c6-9879-5b4fa9d481c3   20Gi       RWO            managed-nfs-storage   2m6s</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Step 4.Helmå®‰è£…filebeatæŸ¥çœ‹å¹¶éªŒè¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim filebeat/value.yaml</span></span><br><span class="line"><span class="comment"># Root directory where Filebeat will write data to in order to persist registry data across pod restarts (file position and other metadata).</span></span><br><span class="line"><span class="comment"># é»˜è®¤è¯»å–çš„æ˜¯èŠ‚ç‚¹/var/libä¸‹çš„æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">hostPathRoot: /var/lib</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… filbeat</span></span><br><span class="line">~/K8s/Day11/filebeat$ helm install filbeat .</span><br><span class="line">  <span class="comment"># NAME: filbeat</span></span><br><span class="line">  <span class="comment"># LAST DEPLOYED: Thu Dec 10 17:09:53 2020</span></span><br><span class="line">  <span class="comment"># NAMESPACE: default</span></span><br><span class="line">  <span class="comment"># STATUS: deployed</span></span><br><span class="line">  <span class="comment"># REVISION: 1</span></span><br><span class="line">  <span class="comment"># TEST SUITE: None</span></span><br><span class="line">  <span class="comment"># NOTES:</span></span><br><span class="line">  <span class="comment"># 1. Watch all containers come up.</span></span><br><span class="line">  <span class="comment"># $ kubectl get pods --namespace=default -l app=filbeat-filebeat -w</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹çŠ¶æ€ï¼Œå› ä¸ºæ˜¯DaemonSetç±»å‹æ‰€ä»¥æ¯å°nodeéƒ½ä¼šè£…ä¸€ä¸ªã€‚</span></span><br><span class="line">~/K8s/Day11/filebeat$ kubectl get pods --namespace=default -l app=filbeat-filebeat -o wide</span><br><span class="line">  <span class="comment"># NAME                     READY   STATUS    RESTARTS   AGE     IP             NODE       </span></span><br><span class="line">  <span class="comment"># filbeat-filebeat-2dr52   1/1     Running   0          4h39m   10.244.2.78    k8s-node-5   </span></span><br><span class="line">  <span class="comment"># filbeat-filebeat-mgj5r   1/1     Running   0          58m     10.244.0.190   master  </span></span><br><span class="line">  <span class="comment"># filbeat-filebeat-qm7wt   1/1     Running   0          4h39m   10.244.1.181   k8s-node-4</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Step 5.Helm å®‰è£… kibana ä»¥åŠéªŒè¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">vim kibana/values.yaml</span><br><span class="line"><span class="comment"># ä¿®æ”¹values.yamlæ–‡ä»¶ä¸­serviceä¸ºnodePortç±»å‹</span></span><br><span class="line">service:</span><br><span class="line">  <span class="built_in">type</span>: NodePort   <span class="comment"># ä¿®æ”¹ç‚¹</span></span><br><span class="line">  loadBalancerIP: <span class="string">""</span></span><br><span class="line">  port: 5601</span><br><span class="line">  nodePort: 30002</span><br><span class="line">  labels: &#123;&#125;       <span class="comment"># ä¿®æ”¹ç‚¹</span></span><br><span class="line">  annotations: &#123;&#125;</span><br><span class="line">    <span class="comment"># cloud.google.com/load-balancer-type: "Internal"</span></span><br><span class="line">    <span class="comment"># service.beta.kubernetes.io/aws-load-balancer-internal: 0.0.0.0/0</span></span><br><span class="line">    <span class="comment"># service.beta.kubernetes.io/azure-load-balancer-internal: "true"</span></span><br><span class="line">    <span class="comment"># service.beta.kubernetes.io/openstack-internal-load-balancer: "true"</span></span><br><span class="line">    <span class="comment"># service.beta.kubernetes.io/cce-load-balancer-internal-vpc: "true"</span></span><br><span class="line">  loadBalancerSourceRanges: []</span><br><span class="line">    <span class="comment"># 0.0.0.0/0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… Kibana</span></span><br><span class="line">~/K8s/Day11/kibana$ helm install kibana .</span><br><span class="line">  <span class="comment"># NAME: kibana</span></span><br><span class="line">  <span class="comment"># LAST DEPLOYED: Thu Dec 10 20:16:13 2020</span></span><br><span class="line">  <span class="comment"># NAMESPACE: default</span></span><br><span class="line">  <span class="comment"># STATUS: deployed</span></span><br><span class="line">  <span class="comment"># REVISION: 1</span></span><br><span class="line">  <span class="comment"># TEST SUITE: None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ deployment å’Œ Pod</span></span><br><span class="line">~/K8s/Day11/filebeat$ kubectl get deploy,pod -o wide -l app=kibana</span><br><span class="line">  <span class="comment"># NAME                            READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES                                   SELECTOR</span></span><br><span class="line">  <span class="comment"># deployment.apps/kibana-kibana   1/1     1            1           52m   kibana       docker.elastic.co/kibana/kibana:7.10.0   app=kibana,release=kibana</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># NAME                                 READY   STATUS    RESTARTS   AGE   IP             NODE         </span></span><br><span class="line">  <span class="comment"># pod/kibana-kibana-86d4cc75f7-gbmjt   1/1     Running   0          28m   10.244.0.192   master</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ svc</span></span><br><span class="line">~/K8s/Day11/filebeat$ kubectl get svc -l app=kibana</span><br><span class="line">  <span class="comment"># NAME            TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE</span></span><br><span class="line">  <span class="comment"># kibana-kibana   NodePort   10.110.225.148   &lt;none&gt;        5601:30002/TCP   54m</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Step 6.åˆ©ç”¨ Helm æŸ¥çœ‹å®‰è£…çš„ EFK RELEASEï¼Œè®¿é—® kibana URL å¹¶åˆ›å»ºç´¢å¼•: <a href="http://10.10.107.202:30002/app/management/kibana/indexPatterns" target="_blank" rel="noopener">http://10.10.107.202:30002/app/management/kibana/indexPatterns</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">~/K8s/Day11/filebeat$ helm ls</span><br><span class="line">  <span class="comment"># NAME            NAMESPACE       REVISION        UPDATED                                 STATUS          CHART                   APP VERSION</span></span><br><span class="line">  <span class="comment"># elasticsearch   default         1               2020-12-10 16:51:42.74817589 +0800 CST  deployed        elasticsearch-7.10.0    7.10.0</span></span><br><span class="line">  <span class="comment"># filbeat         default         1               2020-12-10 17:09:53.872762268 +0800 CST deployed        filebeat-7.10.0         7.10.0</span></span><br><span class="line">  <span class="comment"># kibana          default         1               2020-12-10 21:01:17.44414926 +0800 CST  deployed        kibana-7.10.0           7.10.0</span></span><br><span class="line">``` </span><br><span class="line">Process : Stack Management &gt; Index patterns -&gt; Create  `åˆ›å»ºç´¢å¼•` -&gt; Next Step -&gt; Time field `æŒ‰ç…§æ—¶é—´è¿›è¡Œåˆ†ç‰‡`</span><br><span class="line"></span><br><span class="line">![WeiyiGeek.ç´¢å¼•åˆ›å»º](https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201210221822.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- Step 7.Elasticsearch çš„ Kibana çš„ç®€å•ä½¿ç”¨;</span><br><span class="line">ä¾‹å¦‚: æŒ‰ç…§NodeèŠ‚ç‚¹æŸ¥è¯¢`kubernetes.node.name : <span class="string">"k8s-node-4"</span> or kubernetes.pod.name : <span class="string">"nfs-client-provisioner-58b5dc958d-5fwl9"</span> `</span><br><span class="line">![WeiyiGeek.KibanaæŸ¥è¯¢æ—¥å¿—](https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201210222216.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;br/&gt;</span><br><span class="line"></span><br><span class="line">**å…¥å‘&amp;å‡ºå‘**</span><br><span class="line">- é—®é¢˜1.Helméƒ¨ç½²kibanaæ— æ³•æ­£å¸¸Runæ˜¾ç¤º`Readiness probe failed: Error: Got HTTP code 503 but expected a 200` (è¯¥é—®é¢˜æŠŠæˆ‘å¿ƒæ€æå¾—ç‚¸è£‚)</span><br><span class="line">é”™è¯¯ä¿¡æ¯: å­¦ä¹ æ’é”™ä¹Ÿæ˜¯ä¸€ç§å­¦ä¹ ;</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line"><span class="comment"># Pod æè¿°ä¿¡æ¯</span></span><br><span class="line">~/K8s/Day11/kibana$ kubectl describe pod kibana-kibana-86d4cc75f7-n7kxr</span><br><span class="line">  <span class="comment"># Normal   Started    3m43s                kubelet            Started container kibana</span></span><br><span class="line">  <span class="comment"># Warning  Unhealthy  0s (x22 over 3m30s)  kubelet            Readiness probe failed: Error: Got HTTP code 503 but expected a 200</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pod æ—¥å¿—ä¿¡æ¯ (å…³é”®ç‚¹) å‘ç° resource_already_exists_exception</span></span><br><span class="line">~/K8s/Day11/kibana$ kubectl logs kibana-kibana-86d4cc75f7-n7kxr</span><br><span class="line">  <span class="comment"># &#123;"type":"log","@timestamp":"2020-12-10T13:01:32Z","tags":["error","elasticsearch","data"],"pid":7,"message":"[resource_already_exists_exception]: index [.kibana_task_manager_1/WikBnfj8QjCVtpuit2NxwA] already exists"&#125;</span></span><br><span class="line">  <span class="comment"># &#123;"type":"log","@timestamp":"2020-12-10T13:01:32Z","tags":["warning","savedobjects-service"],"pid":7,"message":"Unable to connect to Elasticsearch. Error: resource_already_exists_exception"&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>é—®é¢˜åŸå› : ç”±äºåœ¨elasticsearchä¸­å·²ç»å­˜åœ¨è¯¥<code>.kibana_task_manager_1/WikBnfj8QjCVtpuit2NxwA</code>ç´¢å¼•å¯¼è‡´é”™è¯¯,ä¸èƒ½æ­£å¸¸å¯åŠ¨;</p>
<p>è§£å†³æ–¹æ³•: åœ¨  elasticsearch ä¸­ åˆ é™¤ Kibana æ‰€æœ‰çš„Index;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~/K8s/Day11/kibana$ curl <span class="string">"http://10.104.178.144:9200/_cat/indices/*?v&amp;s=index"</span></span><br><span class="line">  <span class="comment"># health status index                             uuid                   pri rep docs.count docs.deleted store.size pri.store.size</span></span><br><span class="line">  <span class="comment"># green  open   .kibana_1                         HiroxArKS3CO_j_cmiJXNg   1   0          0            0       208b           208b</span></span><br><span class="line">  <span class="comment"># green  open   .kibana_task_manager_1            WikBnfj8QjCVtpuit2NxwA   1   0          0            0       208b           208b</span></span><br><span class="line">  <span class="comment"># yellow open   filebeat-7.10.0-2020.12.10-000001 Vz2L-FXgQSKMuYMrBMum3w   1   1     238934            0     42.1mb         42.1mb</span></span><br><span class="line">~/K8s/Day11/kibana$ curl -XDELETE http://10.104.178.144:9200/.kibana*</span><br><span class="line">  <span class="comment"># &#123;"acknowledged":true&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°æ„å»ºPodä¸€åˆ‡æ­£å¸¸</span></span><br><span class="line">~/K8s/Day11/kibana$ kubectl delete pod kibana-kibana-86d4cc75f7-n7kxr</span><br><span class="line">pod <span class="string">"kibana-kibana-86d4cc75f7-n7kxr"</span> deleted</span><br><span class="line">&#123;<span class="string">"type"</span>:<span class="string">"response"</span>,<span class="string">"@timestamp"</span>:<span class="string">"2020-12-10T13:26:19Z"</span>,<span class="string">"tags"</span>:[],<span class="string">"pid"</span>:6,<span class="string">"method"</span>:<span class="string">"get"</span>,<span class="string">"statusCode"</span>:200,<span class="string">"req"</span>:&#123;<span class="string">"url"</span>:<span class="string">"/app/kibana"</span>,<span class="string">"method"</span>:<span class="string">"get"</span>,<span class="string">"headers"</span>:&#123;<span class="string">"host"</span>:<span class="string">"localhost:5601"</span>,<span class="string">"user-agent"</span>:<span class="string">"curl/7.61.1"</span>,<span class="string">"accept"</span>:<span class="string">"*/*"</span>&#125;,<span class="string">"remoteAddress"</span>:<span class="string">"127.0.0.1"</span>,<span class="string">"userAgent"</span>:<span class="string">"curl/7.61.1"</span>&#125;,<span class="string">"res"</span>:&#123;<span class="string">"statusCode"</span>:200,<span class="string">"responseTime"</span>:19,<span class="string">"contentLength"</span>:9&#125;,<span class="string">"message"</span>:<span class="string">"GET /app/kibana 200 19ms - 9.0B"</span>&#125;</span><br></pre></td></tr></table></figure><br>å‚è€ƒåœ°å€: <a href="https://discuss.elastic.co/t/unable-to-connect-to-elasticsearch-error-resource-already-exists-exception-after-upgrade-elk/249998" target="_blank" rel="noopener">https://discuss.elastic.co/t/unable-to-connect-to-elasticsearch-error-resource-already-exists-exception-after-upgrade-elk/249998</a></p>
<p><br/></p>
<h2 id="0x02-ESé›†ç¾¤è¿æ¥å®è·µ"><a href="#0x02-ESé›†ç¾¤è¿æ¥å®è·µ" class="headerlink" title="0x02 ESé›†ç¾¤è¿æ¥å®è·µ"></a>0x02 ESé›†ç¾¤è¿æ¥å®è·µ</h2><h3 id="1-Elasticsearch-Head-è¿æ¥é›†ç¾¤"><a href="#1-Elasticsearch-Head-è¿æ¥é›†ç¾¤" class="headerlink" title="1.Elasticsearch-Head è¿æ¥é›†ç¾¤"></a>1.Elasticsearch-Head è¿æ¥é›†ç¾¤</h3><p>æè¿°:åŒæ ·æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>elasticsearch-head-master</code>è¿æ¥åˆ°æˆ‘ä»¬è¿›è¡Œäº†å®‰å…¨é…ç½®çš„ESé›†ç¾¤ä¹‹ä¸­ï¼Œä¾¿äºæˆ‘ä»¬å¯¹æ•°æ®çš„è¿›è¡ŒæŸ¥è¯¢å’Œç®¡ç†ã€‚</p>
<p>ä½¿ç”¨æµè§ˆå™¨è®¿é—®elasticsearch-headæ’ä»¶å¦‚URLä¸ºï¼Œ<a href="http://10.10.107.225:9100/?auth_user=weiyigeek&amp;auth_password=password" target="_blank" rel="noopener">http://10.10.107.225:9100/?auth_user=weiyigeek&amp;auth_password=password</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.é‡‡ç”¨headæ’ä»¶è¿›è¡ŒæŸ¥è¯¢é›†ç¾¤ç›‘æ§çŠ¶æ€</span></span><br><span class="line">http://10.10.107.225:9200/_cluster/health</span><br><span class="line">  <span class="comment"># &#123;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#   "cluster_name": "es-cluster", é›†ç¾¤åç§°</span></span><br><span class="line">  <span class="comment">#   "status": "green",  ç›‘æ§çŠ¶æ€</span></span><br><span class="line">  <span class="comment">#   "timed_out": false,</span></span><br><span class="line">  <span class="comment">#   "number_of_nodes": 3, èŠ‚ç‚¹æ•°é‡</span></span><br><span class="line">  <span class="comment">#   "number_of_data_nodes": 3, æ•°æ®èŠ‚ç‚¹çš„æ•°é‡</span></span><br><span class="line">  <span class="comment">#   "active_primary_shards": 3, æ´»åŠ¨çš„ä¸»åˆ†ç‰‡æ•°</span></span><br><span class="line">  <span class="comment">#   "active_shards": 6,  æ´»åŠ¨çš„ä»åˆ†ç‰‡æ•°</span></span><br><span class="line">  <span class="comment">#   "relocating_shards": 0, é‡æ–°å®šä½_ç¢ç‰‡</span></span><br><span class="line">  <span class="comment">#   "initializing_shards": 0, åˆå§‹åŒ–åˆ†ç‰‡æ•°</span></span><br><span class="line">  <span class="comment">#   "unassigned_shards": 0,  æœªåˆ†é…çš„åˆ†ç‰‡æ•°</span></span><br><span class="line">  <span class="comment">#   "delayed_unassigned_shards": 0, å»¶è¿Ÿæœªåˆ†é…çš„åˆ†ç‰‡æ•°</span></span><br><span class="line">  <span class="comment">#   "number_of_pending_tasks": 0, æœªå†³ä»»åŠ¡çš„æ•°é‡</span></span><br><span class="line">  <span class="comment">#   "number_of_in_flight_fetch": 0, è¿ç§»å–ä»¶ä¸­çš„å–ä»¶æ•°é‡</span></span><br><span class="line">  <span class="comment">#   "task_max_waiting_in_queue_millis": 0,é˜Ÿåˆ—ä»»åŠ¡æœ€å¤§ç­‰å¾…å€¼</span></span><br><span class="line">  <span class="comment">#   "active_shards_percent_as_number": 100 æ´»åŠ¨åˆ†ç‰‡ç™¾åˆ†æ¯”</span></span><br><span class="line">  <span class="comment"># &#125;</span></span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=2.ElasticStackåˆ†å¸ƒå¼æ•°æ®é‡‡é›†æœç´¢å¼•æ“é›†ç¾¤æ­å»ºé…ç½® href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211006104506.png" target="_blank" title="WeiyiGeek.elasticsearch-head" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211006104506.png" alt="WeiyiGeek.elasticsearch-head" title="" class=""></a>
                <p>WeiyiGeek.elasticsearch-head</p>
            </figure>
<p><br></p>
<h3 id="2-Kibana-è¿æ¥é›†ç¾¤"><a href="#2-Kibana-è¿æ¥é›†ç¾¤" class="headerlink" title="2.Kibana è¿æ¥é›†ç¾¤"></a>2.Kibana è¿æ¥é›†ç¾¤</h3><p>æè¿°: é€šå¸¸æˆ‘ä»¬ä½¿ç”¨Kibana è¿æ¥åˆ°ESé›†ç¾¤ï¼Œå¯¹å…¶ä¸­é‡‡é›†çš„æŒ‡å®šæ•°æ®è¿›è¡Œå±•ç¤ºåŒ–ã€‚</p>
<p>æ­¤å¤„æˆ‘ä»¬éœ€è¦å¯¹Kibanaè¿›è¡Œç®€å•çš„è®¤è¯é…ç½®,é‡‡ç”¨æˆ‘ä»¬å‰é¢è®¾ç½®çš„å†…ç½®ä¸“ç”¨ç”¨æˆ·kibana_systemè¿›è¡Œè¿æ¥ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.Kibana é…ç½®</span></span><br><span class="line">elk@elk1:/usr/<span class="built_in">local</span>/kibana-7.15.0/config$ grep -E -v <span class="string">"^#|^$"</span> kibana.yml</span><br><span class="line">server.port: 5601</span><br><span class="line">server.host: <span class="string">"0.0.0.0"</span></span><br><span class="line">server.name: <span class="string">"ES-kibana"</span></span><br><span class="line">elasticsearch.hosts: [<span class="string">"http://10.10.107.225:9200"</span>]</span><br><span class="line">kibana.index: <span class="string">".kibana"</span></span><br><span class="line">elasticsearch.username: <span class="string">"kibana_system"</span></span><br><span class="line">elasticsearch.password: <span class="string">"weiyigeek"</span></span><br><span class="line">elasticsearch.pingTimeout: 1500</span><br><span class="line">i18n.locale: <span class="string">"zh-CN"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.Kibana å¯åŠ¨</span></span><br><span class="line">sudo tee /usr/lib/systemd/system/kibana.service &lt;&lt;<span class="string">'EOF'</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=kibana <span class="keyword">in</span> ElasticStack</span><br><span class="line">Documentation=https://elastic.co</span><br><span class="line">After=network.target</span><br><span class="line">Wants=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">User=elk</span><br><span class="line">Group=elk</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line">LimitNPROC=65536</span><br><span class="line">LimitMEMLOCK=infinity</span><br><span class="line">WorkingDirectory=/usr/<span class="built_in">local</span>/kibana-7.15.0/</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/kibana-7.15.0/bin/kibana</span><br><span class="line">ExecReload=/bin/<span class="built_in">kill</span> -HUP <span class="variable">$MAINPID</span></span><br><span class="line">KillMode=process</span><br><span class="line">Restart=no</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart kibana.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.Kibana çŠ¶æ€æŸ¥çœ‹&amp;ç™»é™†Kibanaè¿›è¡ŒæŸ¥è¯¢éªŒè¯ã€‚</span></span><br><span class="line">systemctl status kibana.service</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=2.ElasticStackåˆ†å¸ƒå¼æ•°æ®é‡‡é›†æœç´¢å¼•æ“é›†ç¾¤æ­å»ºé…ç½® href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211006111043.png" target="_blank" title="WeiyiGeek.Kibana" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/5/20211006111043.png" alt="WeiyiGeek.Kibana" title="" class=""></a>
                <p>WeiyiGeek.Kibana</p>
            </figure>
<hr>
<h2 id="0x01-é…ç½®æ–‡ä»¶è§£æ"><a href="#0x01-é…ç½®æ–‡ä»¶è§£æ" class="headerlink" title="0x01 é…ç½®æ–‡ä»¶è§£æ"></a>0x01 é…ç½®æ–‡ä»¶è§£æ</h2><h3 id="kibana-yml"><a href="#kibana-yml" class="headerlink" title="kibana.yml"></a>kibana.yml</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - æœåŠ¡ç›‘æ§åœ°å€ä¸æœåŠ¡åç§°</span></span><br><span class="line"><span class="string">server.host:</span> <span class="string">"0.0.0.0"</span></span><br><span class="line"><span class="string">server.name:</span> <span class="string">"kibana01"</span></span><br><span class="line"><span class="comment"># - é…ç½®kibanaå¯ç”¨SSL</span></span><br><span class="line"><span class="string">server.ssl.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="string">server.ssl.certificate:</span> <span class="string">$&#123;CERTS_DIR_KIBANA&#125;/kibana01/kibana01.crt</span></span><br><span class="line"><span class="string">server.ssl.key:</span> <span class="string">$&#123;CERTS_DIR_KIBANA&#125;/kibana01/kibana01.key</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># - ç»‘å®šesä¸»æœºåœ°å€,æ³¨æ„é…ç½®sslè®¤è¯åæ­¤å¤„éœ€ç”¨httpsè¯·æ±‚</span></span><br><span class="line"><span class="string">elasticsearch.hosts:</span> <span class="string">["https://elasticsearch:9200"]</span></span><br><span class="line"><span class="comment"># - esä¸»æœºåœ°å€è®¤è¯è´¦å·å¯†ç è®¾ç½®</span></span><br><span class="line"><span class="string">elasticsearch.username:</span> <span class="string">"elastic"</span></span><br><span class="line"><span class="string">elasticsearch.password:</span> <span class="string">"123456"</span></span><br><span class="line"><span class="comment"># - esé…ç½®äº†sslè®¤è¯åéœ€æŒ‡å®šè¯ä¹¦è·¯å¾„ï¼Œæ­¤å¤„æŒ‡å®šç”¨äº Elasticsearch å®ä¾‹çš„ PEM è¯ä¹¦æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="string">elasticsearch.ssl.certificateAuthorities:</span> <span class="string">["$&#123;CERTS_DIR_KIBANA&#125;/ca/ca.crt"]</span></span><br></pre></td></tr></table></figure>
<h3 id="ES-å¸¸ç”¨é…ç½®"><a href="#ES-å¸¸ç”¨é…ç½®" class="headerlink" title="ES å¸¸ç”¨é…ç½®"></a>ES å¸¸ç”¨é…ç½®</h3><p>é—®é¢˜1.è®¾ç½®-Xmsä¸-Xmxçš„å†…å­˜æ¯”ç³»ç»Ÿå¯ç”¨å†…å­˜å¤§<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Oct 06 09:46:01 elk2 elasticsearch[366853]: OpenJDK 64-Bit Server VM warning: INFO: os::commit_memory(0x0000000080000000, 2147483648, 0) failed; error=<span class="string">'Not enough space'</span> (errno=12)</span><br><span class="line">Oct 06 09:46:01 elk2 elasticsearch[366853]:         at org.elasticsearch.tools.launchers.JvmOption.flagsFinal(JvmOption.java:119)</span><br><span class="line">Oct 06 09:46:01 elk2 elasticsearch[366853]:         at org.elasticsearch.tools.launchers.JvmOption.findFinalOptions(JvmOption.java:81)</span><br><span class="line">Oct 06 09:46:01 elk2 elasticsearch[366853]:         at org.elasticsearch.tools.launchers.JvmErgonomics.choose(JvmErgonomics.java:38)</span><br><span class="line">Oct 06 09:46:01 elk2 elasticsearch[366853]:         at org.elasticsearch.tools.launchers.JvmOptionsParser.jvmOptions(JvmOptionsParser.java:135)</span><br><span class="line">Oct 06 09:46:01 elk2 elasticsearch[366853]:         at org.elasticsearch.tools.launchers.JvmOptionsParser.main(JvmOptionsParser.java:86)</span><br><span class="line">Oct 06 09:46:01 elk2 systemd[1]: elasticsearch.service: Main process exited, code=exited, status=1/FAILURE</span><br><span class="line">Oct 06 09:46:01 elk2 systemd[1]: elasticsearch.service: Failed with result <span class="string">'exit-code'</span>.</span><br></pre></td></tr></table></figure></p>
<p>é—®é¢˜2<a href="http://10.10.107.225:9100/?auth_user=weiyigeek&amp;auth_password=password" target="_blank" rel="noopener">http://10.10.107.225:9100/?auth_user=weiyigeek&amp;auth_password=password</a><br>å·²æ‹¦æˆªè·¨æºè¯·æ±‚ï¼šåŒæºç­–ç•¥ç¦æ­¢è¯»å–ä½äº <a href="http://10.10.107.225:9200/_all" target="_blank" rel="noopener">http://10.10.107.225:9200/_all</a> çš„è¿œç¨‹èµ„æºã€‚ï¼ˆåŸå› ï¼šCORS é¢„æ£€å“åº”çš„ â€˜Access-Control-Allow-Headersâ€™ï¼Œä¸å…è®¸ä½¿ç”¨å¤´ â€˜authorizationâ€™ï¼‰ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ mlockall ç”¨äº  Linux/Unix ç³»ç»Ÿï¼Œæˆ– è™šæ‹Ÿé” ç”¨äº Windows ï¼Œå°</span></span><br></pre></td></tr></table></figure>
<p>Elasticsearchå®‰å…¨ç­–ç•¥-å¼€å¯å¯†ç è´¦å·è®¿é—®</p>
<p><a href="https://blog.csdn.net/qq330983778/article/details/103537252" target="_blank" rel="noopener">https://blog.csdn.net/qq330983778/article/details/103537252</a></p>
<p>curl -L -O <a href="https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.13.1-amd64.deb" target="_blank" rel="noopener">https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.13.1-amd64.deb</a><br>sudo dpkg -i filebeat-7.13.1-amd64.deb</p>
<p>Windows äº‹ä»¶æ—¥å¿—</p>
<p>ä» Windows äº‹ä»¶æ—¥å¿—æå–æ—¥å¿—ã€‚<br> 1.ä»ä¸‹è½½é¡µé¢ä¸‹è½½ Winlogbeat Windows zip æ–‡ä»¶ã€‚ 2.å°†è¯¥ zip æ–‡ä»¶çš„å†…å®¹è§£å‹ç¼©åˆ° C:\Program Filesã€‚ 3.å°† winlogbeat-7.13.1-windows ç›®å½•é‡å‘½åä¸º Winlogbeatã€‚ 4.ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ PowerShell æç¤ºç¬¦ (å³é”®å•å‡» PowerShell å›¾æ ‡ï¼Œç„¶åé€‰æ‹©ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ) ã€‚å¦‚æœè¿è¡Œçš„æ˜¯ Windows XPï¼Œåˆ™å¯èƒ½éœ€è¦ä¸‹è½½å¹¶å®‰è£… PowerShellã€‚ 5.ä» PowerShell æç¤ºç¬¦å¤„ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥å°† Winlogbeat å®‰è£…ä¸º Windows æœåŠ¡ã€‚</p>
<p><a href="http://192.168.12.111:5601/app/home#/tutorial/windowsEventLogs" target="_blank" rel="noopener">http://192.168.12.111:5601/app/home#/tutorial/windowsEventLogs</a></p>
<p>version: â€˜3.2â€™<br>services:<br>  es01:<br>    image: docker.elastic.co/elasticsearch/elasticsearch:7.13.1<br>    container_name: elastic-single<br>    environment:</p>
<pre><code>  - node.name=elastic-single
  - discovery.type=single-node
  - &quot;ES_JAVA_OPTS=-Xms1024m -Xmx1024m&quot;
ulimits:
  memlock:
    soft: -1
    hard: -1
volumes:
  - data01:/usr/share/elasticsearch/data
ports:
  - 9200:9200
networks:
  - elastic
</code></pre><p>network:<br>  elastic<br><code>`</code></p>
<p>å›åˆ°é¡¶éƒ¨<br>ä¸€ã€filebeatæ˜¯ä»€ä¹ˆ<br>1.1ã€filebeatå’Œbeatsçš„å…³ç³»</p>
<p>ã€€ã€€é¦–å…ˆfilebeatæ˜¯Beatsä¸­çš„ä¸€å‘˜ã€‚<br>ã€€ã€€Beatsåœ¨æ˜¯ä¸€ä¸ªè½»é‡çº§æ—¥å¿—é‡‡é›†å™¨ï¼Œå…¶å®Beatså®¶æ—æœ‰6ä¸ªæˆå‘˜ï¼Œæ—©æœŸçš„ELKæ¶æ„ä¸­ä½¿ç”¨Logstashæ”¶é›†ã€è§£ææ—¥å¿—ï¼Œä½†æ˜¯Logstashå¯¹å†…å­˜ã€cpuã€ioç­‰èµ„æºæ¶ˆè€—æ¯”è¾ƒé«˜ã€‚ç›¸æ¯”Logstashï¼ŒBeatsæ‰€å ç³»ç»Ÿçš„CPUå’Œå†…å­˜å‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚<br>ç›®å‰BeatsåŒ…å«å…­ç§å·¥å…·ï¼š</p>
<pre><code>Packetbeatï¼šç½‘ç»œæ•°æ®ï¼ˆæ”¶é›†ç½‘ç»œæµé‡æ•°æ®ï¼‰
Metricbeatï¼šæŒ‡æ ‡ï¼ˆæ”¶é›†ç³»ç»Ÿã€è¿›ç¨‹å’Œæ–‡ä»¶ç³»ç»Ÿçº§åˆ«çš„CPUå’Œå†…å­˜ä½¿ç”¨æƒ…å†µç­‰æ•°æ®ï¼‰
Filebeatï¼šæ—¥å¿—æ–‡ä»¶ï¼ˆæ”¶é›†æ–‡ä»¶æ•°æ®ï¼‰
Winlogbeatï¼šwindowsäº‹ä»¶æ—¥å¿—ï¼ˆæ”¶é›†Windowsäº‹ä»¶æ—¥å¿—æ•°æ®ï¼‰
Auditbeatï¼šå®¡è®¡æ•°æ®ï¼ˆæ”¶é›†å®¡è®¡æ—¥å¿—ï¼‰
Heartbeatï¼šè¿è¡Œæ—¶é—´ç›‘æ§ï¼ˆæ”¶é›†ç³»ç»Ÿè¿è¡Œæ—¶çš„æ•°æ®ï¼‰
</code></pre><p>1.2ã€filebeatæ˜¯ä»€ä¹ˆ</p>
<p>ã€€ã€€Filebeatæ˜¯ç”¨äºè½¬å‘å’Œé›†ä¸­æ—¥å¿—æ•°æ®çš„è½»é‡çº§ä¼ é€å·¥å…·ã€‚Filebeatç›‘è§†æ‚¨æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶æˆ–ä½ç½®ï¼Œæ”¶é›†æ—¥å¿—äº‹ä»¶ï¼Œå¹¶å°†å®ƒä»¬è½¬å‘åˆ°Elasticsearchæˆ– Logstashè¿›è¡Œç´¢å¼•ã€‚</p>
<p>ã€€ã€€Filebeatçš„å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼šå¯åŠ¨Filebeatæ—¶ï¼Œå®ƒå°†å¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å…¥ï¼Œè¿™äº›è¾“å…¥å°†åœ¨ä¸ºæ—¥å¿—æ•°æ®æŒ‡å®šçš„ä½ç½®ä¸­æŸ¥æ‰¾ã€‚å¯¹äºFilebeatæ‰€æ‰¾åˆ°çš„æ¯ä¸ªæ—¥å¿—ï¼ŒFilebeatéƒ½ä¼šå¯åŠ¨æ”¶é›†å™¨ã€‚æ¯ä¸ªæ”¶é›†å™¨éƒ½è¯»å–å•ä¸ªæ—¥å¿—ä»¥è·å–æ–°å†…å®¹ï¼Œå¹¶å°†æ–°æ—¥å¿—æ•°æ®å‘é€åˆ°libbeatï¼Œlibbeatå°†èšé›†äº‹ä»¶ï¼Œå¹¶å°†èšé›†çš„æ•°æ®å‘é€åˆ°ä¸ºFilebeaté…ç½®çš„è¾“å‡ºã€‚</p>
<pre><code>å·¥ä½œçš„æµç¨‹å›¾å¦‚ä¸‹ï¼š
</code></pre><p>1.3ã€filebeatå’Œlogstashçš„å…³ç³»</p>
<p>ã€€ã€€å› ä¸ºlogstashæ˜¯jvmè·‘çš„ï¼Œèµ„æºæ¶ˆè€—æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥åæ¥ä½œè€…åˆç”¨golangå†™äº†ä¸€ä¸ªåŠŸèƒ½è¾ƒå°‘ä½†æ˜¯èµ„æºæ¶ˆè€—ä¹Ÿå°çš„è½»é‡çº§çš„logstash-forwarderã€‚ä¸è¿‡ä½œè€…åªæ˜¯ä¸€ä¸ªäººï¼ŒåŠ å…¥<a href="http://elastic.coå…¬å¸ä»¥åï¼Œå› ä¸ºeså…¬å¸æœ¬èº«è¿˜æ”¶è´­äº†å¦ä¸€ä¸ªå¼€æºé¡¹ç›®packetbeatï¼Œè€Œè¿™ä¸ªé¡¹ç›®ä¸“é—¨å°±æ˜¯ç”¨golangçš„ï¼Œæœ‰æ•´ä¸ªå›¢é˜Ÿï¼Œæ‰€ä»¥eså…¬å¸å¹²è„†æŠŠlogstash-forwarderçš„å¼€å‘å·¥ä½œä¹Ÿåˆå¹¶åˆ°åŒä¸€ä¸ªgolangå›¢é˜Ÿæ¥æï¼Œäºæ˜¯æ–°çš„é¡¹ç›®å°±å«filebeatäº†ã€‚" target="_blank" rel="noopener">http://elastic.coå…¬å¸ä»¥åï¼Œå› ä¸ºeså…¬å¸æœ¬èº«è¿˜æ”¶è´­äº†å¦ä¸€ä¸ªå¼€æºé¡¹ç›®packetbeatï¼Œè€Œè¿™ä¸ªé¡¹ç›®ä¸“é—¨å°±æ˜¯ç”¨golangçš„ï¼Œæœ‰æ•´ä¸ªå›¢é˜Ÿï¼Œæ‰€ä»¥eså…¬å¸å¹²è„†æŠŠlogstash-forwarderçš„å¼€å‘å·¥ä½œä¹Ÿåˆå¹¶åˆ°åŒä¸€ä¸ªgolangå›¢é˜Ÿæ¥æï¼Œäºæ˜¯æ–°çš„é¡¹ç›®å°±å«filebeatäº†ã€‚</a></p>
<p>å›åˆ°é¡¶éƒ¨<br>äºŒã€filebeatåŸç†æ˜¯ä»€ä¹ˆ<br>2.1ã€filebeatçš„æ„æˆ</p>
<p>ã€€ã€€filebeatç»“æ„ï¼šç”±ä¸¤ä¸ªç»„ä»¶æ„æˆï¼Œåˆ†åˆ«æ˜¯inputsï¼ˆè¾“å…¥ï¼‰å’Œharvestersï¼ˆæ”¶é›†å™¨ï¼‰ï¼Œè¿™äº›ç»„ä»¶ä¸€èµ·å·¥ä½œæ¥è·Ÿè¸ªæ–‡ä»¶å¹¶å°†äº‹ä»¶æ•°æ®å‘é€åˆ°æ‚¨æŒ‡å®šçš„è¾“å‡ºï¼Œharvesterè´Ÿè´£è¯»å–å•ä¸ªæ–‡ä»¶çš„å†…å®¹ã€‚harvesteré€è¡Œè¯»å–æ¯ä¸ªæ–‡ä»¶ï¼Œå¹¶å°†å†…å®¹å‘é€åˆ°è¾“å‡ºã€‚ä¸ºæ¯ä¸ªæ–‡ä»¶å¯åŠ¨ä¸€ä¸ªharvesterã€‚harvesterè´Ÿè´£æ‰“å¼€å’Œå…³é—­æ–‡ä»¶ï¼Œè¿™æ„å‘³ç€æ–‡ä»¶æè¿°ç¬¦åœ¨harvesterè¿è¡Œæ—¶ä¿æŒæ‰“å¼€çŠ¶æ€ã€‚å¦‚æœåœ¨æ”¶é›†æ–‡ä»¶æ—¶åˆ é™¤æˆ–é‡å‘½åæ–‡ä»¶ï¼ŒFilebeatå°†ç»§ç»­è¯»å–è¯¥æ–‡ä»¶ã€‚è¿™æ ·åšçš„å‰¯ä½œç”¨æ˜¯ï¼Œç£ç›˜ä¸Šçš„ç©ºé—´ä¸€ç›´ä¿ç•™åˆ°harvesterå…³é—­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒFilebeatä¿æŒæ–‡ä»¶æ‰“å¼€ï¼Œç›´åˆ°è¾¾åˆ°close_inactive</p>
<p>å…³é—­harvesterå¯ä»¥ä¼šäº§ç”Ÿçš„ç»“æœï¼š</p>
<pre><code>æ–‡ä»¶å¤„ç†ç¨‹åºå…³é—­ï¼Œå¦‚æœharvesterä»åœ¨è¯»å–æ–‡ä»¶æ—¶è¢«åˆ é™¤ï¼Œåˆ™é‡Šæ”¾åº•å±‚èµ„æºã€‚
åªæœ‰åœ¨scan_frequencyç»“æŸä¹‹åï¼Œæ‰ä¼šå†æ¬¡å¯åŠ¨æ–‡ä»¶çš„æ”¶é›†ã€‚
å¦‚æœè¯¥æ–‡ä»¶åœ¨harvesterå…³é—­æ—¶è¢«ç§»åŠ¨æˆ–åˆ é™¤ï¼Œè¯¥æ–‡ä»¶çš„æ”¶é›†å°†ä¸ä¼šç»§ç»­
</code></pre><p>ã€€ã€€ä¸€ä¸ªinputè´Ÿè´£ç®¡ç†harvesterså’Œå¯»æ‰¾æ‰€æœ‰æ¥æºè¯»å–ã€‚å¦‚æœinputç±»å‹æ˜¯logï¼Œåˆ™inputå°†æŸ¥æ‰¾é©±åŠ¨å™¨ä¸Šä¸å®šä¹‰çš„è·¯å¾„åŒ¹é…çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¹¶ä¸ºæ¯ä¸ªæ–‡ä»¶å¯åŠ¨ä¸€ä¸ªharvesterã€‚æ¯ä¸ªinputåœ¨å®ƒè‡ªå·±çš„Goè¿›ç¨‹ä¸­è¿è¡Œï¼ŒFilebeatå½“å‰æ”¯æŒå¤šç§è¾“å…¥ç±»å‹ã€‚æ¯ä¸ªè¾“å…¥ç±»å‹å¯ä»¥å®šä¹‰å¤šæ¬¡ã€‚æ—¥å¿—è¾“å…¥æ£€æŸ¥æ¯ä¸ªæ–‡ä»¶ï¼Œä»¥æŸ¥çœ‹æ˜¯å¦éœ€è¦å¯åŠ¨harvesterã€æ˜¯å¦å·²ç»åœ¨è¿è¡Œharvesteræˆ–æ˜¯å¦å¯ä»¥å¿½ç•¥è¯¥æ–‡ä»¶<br>2.2ã€filebeatå¦‚ä½•ä¿å­˜æ–‡ä»¶çš„çŠ¶æ€</p>
<p>ã€€ã€€Filebeatä¿ç•™æ¯ä¸ªæ–‡ä»¶çš„çŠ¶æ€ï¼Œå¹¶ç»å¸¸å°†çŠ¶æ€åˆ·æ–°åˆ°ç£ç›˜ä¸­çš„æ³¨å†Œè¡¨æ–‡ä»¶ä¸­ã€‚è¯¥çŠ¶æ€ç”¨äºè®°ä½harvesterè¯»å–çš„æœ€åä¸€ä¸ªåç§»é‡ï¼Œå¹¶ç¡®ä¿å‘é€æ‰€æœ‰æ—¥å¿—è¡Œã€‚å¦‚æœæ— æ³•è®¿é—®è¾“å‡ºï¼ˆå¦‚Elasticsearchæˆ–Logstashï¼‰ï¼ŒFilebeatå°†è·Ÿè¸ªæœ€åå‘é€çš„è¡Œï¼Œå¹¶åœ¨è¾“å‡ºå†æ¬¡å¯ç”¨æ—¶ç»§ç»­è¯»å–æ–‡ä»¶ã€‚å½“Filebeatè¿è¡Œæ—¶ï¼Œæ¯ä¸ªè¾“å…¥çš„çŠ¶æ€ä¿¡æ¯ä¹Ÿä¿å­˜åœ¨å†…å­˜ä¸­ã€‚å½“Filebeaté‡æ–°å¯åŠ¨æ—¶ï¼Œæ¥è‡ªæ³¨å†Œè¡¨æ–‡ä»¶çš„æ•°æ®ç”¨äºé‡å»ºçŠ¶æ€ï¼ŒFilebeatåœ¨æœ€åä¸€ä¸ªå·²çŸ¥ä½ç½®ç»§ç»­æ¯ä¸ªharvesterã€‚å¯¹äºæ¯ä¸ªè¾“å…¥ï¼ŒFilebeatéƒ½ä¼šä¿ç•™å®ƒæ‰¾åˆ°çš„æ¯ä¸ªæ–‡ä»¶çš„çŠ¶æ€ã€‚ç”±äºæ–‡ä»¶å¯ä»¥é‡å‘½åæˆ–ç§»åŠ¨ï¼Œæ–‡ä»¶åå’Œè·¯å¾„ä¸è¶³ä»¥æ ‡è¯†æ–‡ä»¶ã€‚å¯¹äºæ¯ä¸ªæ–‡ä»¶ï¼ŒFilebeatå­˜å‚¨å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œä»¥æ£€æµ‹æ–‡ä»¶æ˜¯å¦ä»¥å‰è¢«æ•è·ã€‚<br>2.3ã€filebeatä½•å¦‚ä¿è¯è‡³å°‘ä¸€æ¬¡æ•°æ®æ¶ˆè´¹</p>
<p>ã€€ã€€Filebeatä¿è¯äº‹ä»¶å°†è‡³å°‘ä¼ é€’åˆ°é…ç½®çš„è¾“å‡ºä¸€æ¬¡ï¼Œå¹¶ä¸”ä¸ä¼šä¸¢å¤±æ•°æ®ã€‚æ˜¯å› ä¸ºå®ƒå°†æ¯ä¸ªäº‹ä»¶çš„ä¼ é€’çŠ¶æ€å­˜å‚¨åœ¨æ³¨å†Œè¡¨æ–‡ä»¶ä¸­ã€‚åœ¨å·²å®šä¹‰çš„è¾“å‡ºè¢«é˜»æ­¢ä¸”æœªç¡®è®¤æ‰€æœ‰äº‹ä»¶çš„æƒ…å†µä¸‹ï¼ŒFilebeatå°†ç»§ç»­å°è¯•å‘é€äº‹ä»¶ï¼Œç›´åˆ°è¾“å‡ºç¡®è®¤å·²æ¥æ”¶åˆ°äº‹ä»¶ä¸ºæ­¢ã€‚å¦‚æœFilebeatåœ¨å‘é€äº‹ä»¶çš„è¿‡ç¨‹ä¸­å…³é—­ï¼Œå®ƒä¸ä¼šç­‰å¾…è¾“å‡ºç¡®è®¤æ‰€æœ‰äº‹ä»¶åå†å…³é—­ã€‚å½“Filebeaté‡æ–°å¯åŠ¨æ—¶ï¼Œå°†å†æ¬¡å°†Filebeatå…³é—­å‰æœªç¡®è®¤çš„æ‰€æœ‰äº‹ä»¶å‘é€åˆ°è¾“å‡ºã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æ¯ä¸ªäº‹ä»¶è‡³å°‘å‘é€ä¸€æ¬¡ï¼Œä½†æœ€ç»ˆå¯èƒ½ä¼šæœ‰é‡å¤çš„äº‹ä»¶å‘é€åˆ°è¾“å‡ºã€‚é€šè¿‡è®¾ç½®shutdown_timeouté€‰é¡¹ï¼Œå¯ä»¥å°†Filebeaté…ç½®ä¸ºåœ¨å…³æœºå‰ç­‰å¾…ç‰¹å®šæ—¶é—´</p>
<p>æ—¥å¿—ä¸»è¦åŒ…æ‹¬ç³»ç»Ÿæ—¥å¿—ã€åº”ç”¨ç¨‹åºæ—¥å¿—å’Œå®‰å…¨æ—¥å¿—ã€‚ç³»ç»Ÿè¿ç»´å’Œå¼€å‘å¯ä»¥é€šè¿‡æ—¥å¿—äº†è§£æœåŠ¡å™¨è½¯ç¡¬ä»¶ä¿¡æ¯ã€æ£€æŸ¥é…ç½®è¿‡ç¨‹ä¸­çš„é”™è¯¯åŠé”™è¯¯å‘ç”Ÿçš„åŸå› ã€‚ç»å¸¸åˆ†ææ—¥å¿—å¯ä»¥äº†è§£æœåŠ¡å™¨çš„è´Ÿè·ï¼Œæ€§èƒ½å®‰å…¨ï¼Œä»è€ŒåŠæ—¶é‡‡å–æªæ–½çº æ­£é”™è¯¯ã€‚</p>
<p>Beats æ˜¯æ•°æ®é‡‡é›†çš„å¾—åŠ›å·¥å…·ã€‚å°† Beats å’Œæ‚¨çš„å®¹å™¨ä¸€èµ·ç½®äºæœåŠ¡å™¨ä¸Šï¼Œæˆ–è€…å°† Beats ä½œä¸ºå‡½æ•°åŠ ä»¥éƒ¨ç½²ï¼Œç„¶åä¾¿å¯åœ¨ Elastisearch ä¸­é›†ä¸­å¤„ç†æ•°æ®ã€‚å¦‚æœéœ€è¦æ›´åŠ å¼ºå¤§çš„å¤„ç†æ€§èƒ½ï¼ŒBeats è¿˜èƒ½å°†æ•°æ®è¾“é€åˆ° Logstash è¿›è¡Œè½¬æ¢å’Œè§£æã€‚</p>
<p>Elasticsearch é€šå¸¸ä¸ Kibana ä¸€èµ·éƒ¨ç½²ï¼ŒKibana æ˜¯ Elasticsearch çš„ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æ•°æ®å¯è§†åŒ– Dashboardï¼ŒKibana å…è®¸ä½ é€šè¿‡ web ç•Œé¢æ¥æµè§ˆ Elasticsearch æ—¥å¿—æ•°æ®ã€‚</p>
<p>EFK æ¶æ„å›¾ï¼š</p>
<figure class="image-box">
                <a rel=2.ElasticStackåˆ†å¸ƒå¼æ•°æ®é‡‡é›†æœç´¢å¼•æ“é›†ç¾¤æ­å»ºé…ç½® href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201209091315.png" target="_blank" title="WeiyiGeek.ELKæ¶æ„" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201209091315.png" alt="WeiyiGeek.ELKæ¶æ„" title="" class=""></a>
                <p>WeiyiGeek.ELKæ¶æ„</p>
            </figure>
<p>EFK(Elasticsearch+Filebeat+Kibana)æ”¶é›†å®¹å™¨æ—¥å¿— </p>
<p><a href="https://blog.csdn.net/qq_25934401/article/details/83345144" target="_blank" rel="noopener">https://blog.csdn.net/qq_25934401/article/details/83345144</a><br><a href="https://www.cnblogs.com/zsql/p/13137833.html" target="_blank" rel="noopener">https://www.cnblogs.com/zsql/p/13137833.html</a></p>
<p>ã€æ‘˜è¦ã€‘ ELKåœ¨è¿ç»´ç›‘æ§é¢†åŸŸä½¿ç”¨éå¸¸å¹¿æ³›ï¼Œæ—¥å¿—é‡‡é›†é€šå¸¸ä¾é Logstashï¼Œä½†æ˜¯é€šå¸¸æ¥è®²Logstashæ¶æ„æ¯”è¾ƒé‡è½½ï¼Œä¸€ä¸ªå®‰è£…åŒ…ç”±å‡ ç™¾MBï¼Œç›¸æ¯”ä¹‹ä¸‹Elasticè¿˜æä¾›å¦ä¸€ç§æ›´è½»é‡çš„é‡‡é›†å·¥å…·Beatsã€‚Beats å¹³å°é›†åˆäº†å¤šç§å•ä¸€ç”¨é€”æ•°æ®é‡‡é›†å™¨ã€‚è¿™äº›é‡‡é›†å™¨å®‰è£…åå¯ç”¨ä½œè½»é‡å‹ä»£ç†ï¼Œä»æˆç™¾ä¸Šåƒæˆ–æˆåƒä¸Šä¸‡å°æœºå™¨å‘ Logstash æˆ– Elasticsearch å‘é€æ•°æ®ã€‚</p>
<p>ELKåœ¨è¿ç»´ç›‘æ§é¢†åŸŸä½¿ç”¨éå¸¸å¹¿æ³›ï¼Œæ—¥å¿—é‡‡é›†é€šå¸¸ä¾é Logstashï¼Œä½†æ˜¯é€šå¸¸æ¥è®²Logstashæ¶æ„æ¯”è¾ƒé‡è½½ï¼Œä¸€ä¸ªå®‰è£…åŒ…ç”±å‡ ç™¾MBï¼Œç›¸æ¯”ä¹‹ä¸‹Elasticè¿˜æä¾›å¦ä¸€ç§æ›´è½»é‡çš„é‡‡é›†å·¥å…·Beatsã€‚Beats å¹³å°é›†åˆäº†å¤šç§å•ä¸€ç”¨é€”æ•°æ®é‡‡é›†å™¨ã€‚è¿™äº›é‡‡é›†å™¨å®‰è£…åå¯ç”¨ä½œè½»é‡å‹ä»£ç†ï¼Œä»æˆç™¾ä¸Šåƒæˆ–æˆåƒä¸Šä¸‡å°æœºå™¨å‘ Logstash æˆ– Elasticsearch å‘é€æ•°æ®ã€‚æœ¬æ–‡ç®€è¦ä»‹ç»ä¸€ä¸‹ä½¿ç”¨Winlogbeatæ”¶é›†Windowsæ—¥å¿—ï¼Œå¹¶ç”¨ES + Kibanaæ£€ç´¢çš„é…ç½®æ–¹æ³•ã€‚</p>
<pre><code>elfk çš„æ­å»º
filebeat è¯»å–å¤šæ—¥å¿—ï¼Œå¹¶æ‰“ä¸Šä¸åŒçš„ tag æ¥è¿›è¡ŒåŒºåˆ†
logstash è¿‡æ»¤æ—¥å¿—ï¼Œåˆ›å»ºä¸åŒçš„åŠ¨æ€ç´¢å¼•ï¼Œé‚®ä»¶æŠ¥è­¦ç­‰
elasticsearch çš„ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œç´¢å¼•çš„åˆ é™¤ï¼ŒåŠæˆ‘é‡è§çš„é—®é¢˜
kibana çš„ç®€å•ä½¿ç”¨ï¼ŒåŒ…æ‹¬æŸ¥è¯¢ã€åˆ›å»ºå¯è§†å›¾ã€ä¸€äº›ç®€å•çš„è®¾ç½®
</code></pre><p>â€‹å½“ç„¶äº†ï¼Œelfk çš„æ°´å¤ªæ·±ï¼Œç ”ç©¶äº†å°†è¿‘ä¸€ä¸ªæœˆä¹Ÿå°±æ˜¯ç®€å•çš„å…¥é—¨ï¼Œè¿˜æœ‰æ›´å¤šçš„è®¾ç½®ä½†å…¥é—¨è¶³ä»¥ã€‚å½“ç„¶äº†ï¼Œè¦æ˜¯æ„Ÿè§‰å†™çš„è¿˜å‡‘åˆï¼Œå¾®ä¿¡æœç´¢ è‹¦é€¼å°ç å†œ å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ã€‚</p>

        </div>
        <!-- Google å¹¿å‘Š -->
        
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
  

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-03-29T05:39:02.682Z" itemprop="dateUpdated">2022-03-29 13:39:02</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç½‘å®‰é˜²å¾¡/å®‰å…¨å»ºè®¾/æ—¥å¿—å®¡è®¡/ElasticStack/2.ElasticStackåˆ†å¸ƒå¼æ•°æ®é‡‡é›†æœç´¢å¼•æ“é›†ç¾¤æ­å»ºé…ç½®.md" target="_blank" rel="noopener noreferrer">_posts/ç½‘å®‰é˜²å¾¡/å®‰å…¨å»ºè®¾/æ—¥å¿—å®¡è®¡/ElasticStack/2.ElasticStackåˆ†å¸ƒå¼æ•°æ®é‡‡é›†æœç´¢å¼•æ“é›†ç¾¤æ­å»ºé…ç½®.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2021/8-2-613.html" target="_blank" rel="external">https://blog.weiyigeek.top/2021/8-2-613.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Elastic/" rel="tag">Elastic</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2021/8-2-613.html&title=ã€Š2.ElasticStackåˆ†å¸ƒå¼æ•°æ®é‡‡é›†æœç´¢å¼•æ“é›†ç¾¤æ­å»ºé…ç½®ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2021/8-2-613.html&title=ã€Š2.ElasticStackåˆ†å¸ƒå¼æ•°æ®é‡‡é›†æœç´¢å¼•æ“é›†ç¾¤æ­å»ºé…ç½®ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2021/8-2-613.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š2.ElasticStackåˆ†å¸ƒå¼æ•°æ®é‡‡é›†æœç´¢å¼•æ“é›†ç¾¤æ­å»ºé…ç½®ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2021/8-2-613.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2021/8-2-613.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2021/8-3-651.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">ElasticStackæ—¥å¿—é‡‡é›†ç›‘æ§æ­å»ºå®è·µæ¡ˆä¾‹</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2021/8-2-614.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">3.ElasticSearchåˆ†å¸ƒå¼æ•°æ®åˆ†æå¼•æ“åŸºç¡€æ¦‚å¿µä¸ä½¿ç”¨</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-ESé›†ç¾¤æ­å»ºå®è·µ"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x01 ESé›†ç¾¤æ­å»ºå®è·µ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-å®¿ä¸»æœºå®‰è£…"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">1.å®¿ä¸»æœºå®‰è£…</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-1-èŠ‚ç‚¹ç¯å¢ƒ"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">(1.1) èŠ‚ç‚¹ç¯å¢ƒ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-2-å®è·µæµç¨‹"><span class="post-toc-number">1.1.2.</span> <span class="post-toc-text">(1.2) å®è·µæµç¨‹</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-docker-compose-å®‰è£…"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">2.docker-compose å®‰è£…</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-K8S-å®‰è£…"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">4.K8S å®‰è£…</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-Helm-å®‰è£…"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">4.Helm å®‰è£…</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-ESé›†ç¾¤è¿æ¥å®è·µ"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x02 ESé›†ç¾¤è¿æ¥å®è·µ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-Elasticsearch-Head-è¿æ¥é›†ç¾¤"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">1.Elasticsearch-Head è¿æ¥é›†ç¾¤</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-Kibana-è¿æ¥é›†ç¾¤"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">2.Kibana è¿æ¥é›†ç¾¤</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-é…ç½®æ–‡ä»¶è§£æ"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x01 é…ç½®æ–‡ä»¶è§£æ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#kibana-yml"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">kibana.yml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ES-å¸¸ç”¨é…ç½®"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">ES å¸¸ç”¨é…ç½®</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    


    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      

    <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
    
      <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
        
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/search-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2021/8-2-613.html&title=ã€Š2.ElasticStackåˆ†å¸ƒå¼æ•°æ®é‡‡é›†æœç´¢å¼•æ“é›†ç¾¤æ­å»ºé…ç½®ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2021/8-2-613.html&title=ã€Š2.ElasticStackåˆ†å¸ƒå¼æ•°æ®é‡‡é›†æœç´¢å¼•æ“é›†ç¾¤æ­å»ºé…ç½®ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2021/8-2-613.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š2.ElasticStackåˆ†å¸ƒå¼æ•°æ®é‡‡é›†æœç´¢å¼•æ“é›†ç¾¤æ­å»ºé…ç½®ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2021/8-2-613.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2021/8-2-613.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACL0lEQVR42u3a0W6DMAwF0P7/T7PXThPhOl4rYU6eEKIhh0lebOf1isfxNv7eeb9/9vzZnNVftQYGBsZtGcdyrJ9JZl5/iOQ6ejsGBsYDGMkiEtLZdQ5bz3B6HwMDA2O5jVuH4H6YxsDAwOgz8nBZ/RUGBgZGNYnNq17VYPrVXBwDA+OGjOrivnn9kf4GBgbGrRhHcfTbnEnLs7wqDAyM0Yw8wCWtzXxrmJTnqp8MAwNjKqM6abVM1jkcVriDgYHxAMZesvqJVkH1GMevgIuBgTGUcbFn3DpU0SnoJ6EWAwPjaYz10vv5cf9OEtYxMDBmM6rHI/rBdO+ZqJyHgYExmlGdqEpNllIOr8lfBgMDYyij9ehWUzNfblRuw8DAGMfoJLF7yWd1mxiBMTAwHsDYS1n7YTf/b3DxRgwMjNGMTrDrl9s6ITj6oBgYGCMYe8cjqsW1TsuzHFgxMDDGMTrT7QXHfInlbSIGBsZoRrIdTBLavSNfeRLbOjmCgYFxc0b++jUvL9h1im6n78LAwHgAo1O+z4toyRKTbeVFIxMDA2M0I+8nVAtzyaZwL63FwMCYzTiKo1qqqx7OSILsxd4WAwNjHGOvP5gHzWoynKfHrZ4tBgbGDRnVJeZtxWr4rrY8MTAwnsZItmv51i0/MNE5hIGBgYHxX03Kajuh2sjEwMDA2MuJq23OPED/QwsTAwPjtowkif10ha9zjAMDA2M2I08d91qP1UXsBWsMDIyhjB9ppgPxg88gMQAAAABJRU5ErkJggg==" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>