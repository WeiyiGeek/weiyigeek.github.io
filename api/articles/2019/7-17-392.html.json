{"title":"安全之配置不当信息泄露","slug":"网安大类/OWASPTOP/安全之配置不当信息泄露","date":"2019-07-17T05:36:30.000Z","updated":"2022-03-30T05:02:09.821Z","url":"2019/7-17-392.html","path":"api/articles/2019/7-17-392.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190717093326.png"],"content":"<p><b style=\"color:red\">注意：本文分享给安全从业人员、网站开发人员以及运维人员在日常工作防范恶意攻击,请勿恶意使用下面介绍技术进行非法攻击操作。。</b></p>\n<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"0x00-前言\"><a href=\"#0x00-前言\" class=\"headerlink\" title=\"0x00 前言\"></a>0x00 前言</h4><p>信息泄露涉及范围广泛，破坏之大，给业内各企业带来不少担忧与苦恼。</p>\n<p><em>配置不当的分类：</em></p>\n<ul>\n<li>（1）WEBserver本身：之前发生的nginx等解析漏洞webserver的目录遍历等。</li>\n<li>（2）网络协议相关：snmp弱community、dns域传送、ssh等。</li>\n<li>（3）应用服务相关：压缩文件，备份文件，其他如日志history、phpinfo等，zabbix，jenkins、phpmyadmin、hadoop等。</li>\n<li>（4）系统服务相关：之前暴露的openssl心脏滴血，破壳等。</li>\n<li>（5）人员安全意识：在部署项目的时候 svn，git 信息泄露可导致代码泄露。</li>\n</ul>\n<hr>\n\n<h4 id=\"0x01-配置不当的防范\"><a href=\"#0x01-配置不当的防范\" class=\"headerlink\" title=\"0x01 配置不当的防范\"></a>0x01 配置不当的防范</h4><p>（1）业务上线前进行安全基线检查 （统一安全配置基线，即最低安全红线，根据安全配置基线产生公司默认配置模板，所有预上线阶段全部默认使用配置模板，当模板满足不了需求时，可以根据配置模板进行相应更改，但是上线之前需要通过安全基线工具）。<br>（2）对线上业务进行定时检查（培训+监控，辅助扫描）。<br>（3）对攻击行为进行监控，一般这样做之后会杜绝大部分的配置不当问题， 其他信息泄露问题主要是采用自检或者src白帽子提交的漏洞来发现，发现之后走修复流程不会分层做。</p>\n<p>补充Tips：主机Agent在被监控应用所在的主机上面，<code>安装小的Agent软件即代理软件</code>，通过它实现对数据的采集和管理</p>\n<hr>\n\n<h4 id=\"0x03-实用案例\"><a href=\"#0x03-实用案例\" class=\"headerlink\" title=\"0x03 实用案例\"></a>0x03 实用案例</h4><p><strong>TRACE方法信息泄露</strong><br>漏洞名称：检测到目标服务器启用了TRACE方法<br>详细描述 ：TRACE方法是HTTP（超文本传输）协议定义的一种协议调试方法，该方法使得服务器原样返回任何客户端请求的内容。 </p>\n<p>启用TRACE方法存在如下风险： </p>\n<ul>\n<li>1、恶意攻击者可以通过TRACE方法返回的信息了解到网站前端的某些信息，如缓存服务器等，从而为进一步的攻击提供便利。 </li>\n<li>2、恶意攻击者可以通过TRACE方法进行XSS攻击。 </li>\n<li>3、即使网站对关键页面启用了HttpOnly头标记和禁止脚本读取cookie信息，但是通过TRACE 方法恶意攻击者还是可以绕过这个限制读取到cookie信息。</li>\n</ul>\n<p>解决办法：<br>1、2.0.55以上的Apache服务器，在httpd.conf的尾部添加：TraceEnable off。<br>2、如果使用的是Apache： - 确认rewrite模块激活（httpd.conf，下面一行前面没有#）： LoadModule rewrite_module modules/mod_rewrite.so - 在各虚拟主机的配置  文件里添加如下语句：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RewriteEngine On </span><br><span class=\"line\">RewriteCond %&#123;REQUEST_METHOD&#125; ^TRACE </span><br><span class=\"line\">RewriteRule .* - [F]</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>.git /.svn 泄露源代码信息</strong><br>漏洞名称：.git / .svn 配置不当导致源代码泄露<br>如果.git文件夹暴露在外网服务器上，攻击者可以通过.git下载所有的代码，当前前提是目录可被遍历，如果能遍历可以简单的获取到源代码。<br>Google语法查找：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">\".git\"</span> intitle:<span class=\"string\">\"Index of\"</span></span><br></pre></td></tr></table></figure><br>Wget命令下载镜像查看<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget --mirror --include-directories=/.git http://10.10.17.222/<span class=\"built_in\">test</span>/.git/</span><br><span class=\"line\">wget --no-check-certificate --mirror --include-directories=/.git https://wvvdey-8080-ooqzry.dev.ide.live/.git</span><br><span class=\"line\"><span class=\"comment\">#ubuntu@WeiyiGeek:~/10.10.17.222/test/.git$ index.html #克隆镜像到本地</span></span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190717093326.png\" alt=\"WeiyiGeek.下载get的config\" title=\"\" class=\"\">\n                <p>WeiyiGeek.下载get的config</p>\n            </figure></p>\n<p>在svn1.6之前的版本，通过访问.svn/.entries，可以下载到svn里的代码，在svn1.7之后的版本通过访问.svn/wc.db ，存在一个SQLite数据库文件里面<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget --mirror --include-directories=/.svn http://xxx.com/.svn</span><br><span class=\"line\">auxiliary/scanner/http/svn_scanner       <span class=\"comment\">#&lt;1.6</span></span><br><span class=\"line\">auxiliary/scanner/http/svn_wcdb_scanner  <span class=\"comment\">#&gt;1.7</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#如果采用sqlite3查看数据库  sqlite3.exe .svn/wc.db \"select * from work _queue\"</span></span><br><span class=\"line\">python gitsvnScan.py http://ricewater.cn/</span><br><span class=\"line\">python gitsvnScan.py http://ftp.yx56.cn/codebase/imgs</span><br><span class=\"line\">[!] .svn/entries写入成功</span><br><span class=\"line\">[!] .svn/wc.db 写入成功</span><br></pre></td></tr></table></figure></p>\n<p>利用代码下载：<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @File : gitsvnScan.py</span></span><br><span class=\"line\"><span class=\"comment\"># @CreateTime : 2019/7/17 9:40</span></span><br><span class=\"line\"><span class=\"comment\"># @Author : WeiyiGeek</span></span><br><span class=\"line\"><span class=\"comment\"># @Function : git与svn信息泄露扫描</span></span><br><span class=\"line\"><span class=\"comment\"># @Software: PyCharm</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">git</span><span class=\"params\">(url)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        g = requests.get(url+<span class=\"string\">'config'</span>, timeout=<span class=\"number\">5</span>)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        print(<span class=\"string\">\"[*] 请求失败\"</span>+str(e))</span><br><span class=\"line\">    <span class=\"keyword\">with</span> open(<span class=\"string\">'gitconfig.txt'</span>,<span class=\"string\">'w'</span>) <span class=\"keyword\">as</span> config:</span><br><span class=\"line\">        config.writelines(g.text)</span><br><span class=\"line\">        print(<span class=\"string\">\"[!] .git/config写入成功\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">svn</span><span class=\"params\">(url)</span>:</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        s = requests.get(url+<span class=\"string\">'entries'</span>, timeout=<span class=\"number\">5</span>)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        print(<span class=\"string\">\"[*] 请求失败\"</span>+str(e))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s.status_code == <span class=\"number\">200</span>):</span><br><span class=\"line\">        <span class=\"keyword\">with</span> open(<span class=\"string\">'svnentries.txt'</span>,<span class=\"string\">'w'</span>) <span class=\"keyword\">as</span> config:</span><br><span class=\"line\">            config.writelines(s.text)</span><br><span class=\"line\">            print(<span class=\"string\">\"[!] .svn/entries写入成功\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        s = requests.get(url + <span class=\"string\">'wc.db'</span>, timeout=<span class=\"number\">5</span>)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        print(<span class=\"string\">\"[*] 请求失败\"</span> + str(e))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s.status_code == <span class=\"number\">200</span>):</span><br><span class=\"line\">        <span class=\"keyword\">with</span> open(<span class=\"string\">'wc.db'</span>, <span class=\"string\">'wb'</span>) <span class=\"keyword\">as</span> config:</span><br><span class=\"line\">            config.write(s.content)</span><br><span class=\"line\">            print(<span class=\"string\">\"[!] .svn/wc.db 写入成功\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">main</span><span class=\"params\">(url)</span>:</span></span><br><span class=\"line\">    gitPath = url+<span class=\"string\">'/.git/'</span></span><br><span class=\"line\">    svnPath = url+<span class=\"string\">'/.svn/'</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        g = requests.get(gitPath, timeout=<span class=\"number\">5</span>)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        print(<span class=\"string\">\"[*] 请求失败\"</span>+str(e))</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (g.status_code == <span class=\"number\">200</span>):</span><br><span class=\"line\">        git(gitPath)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        s = requests.get(svnPath, timeout=<span class=\"number\">5</span>)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        print(<span class=\"string\">\"[*] 请求失败\"</span> + str(e))</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s.status_code == <span class=\"number\">200</span>):</span><br><span class=\"line\">        svn(svnPath)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        print(<span class=\"string\">\"URL:\"</span>, g.url, <span class=\"string\">\" status_code:\"</span>, g.status_code)</span><br><span class=\"line\">        print(<span class=\"string\">\"URL:\"</span>, s.url, <span class=\"string\">\" status_code:\"</span>, s.status_code)</span><br><span class=\"line\">        print(<span class=\"string\">\"[*] 该站点不存在/.git或者/.svn信息泄露\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    <span class=\"keyword\">if</span> len(sys.argv) &lt;= <span class=\"number\">1</span>:</span><br><span class=\"line\">        print(<span class=\"string\">\"usage: gitsvnScan.py http://url.com\"</span>)</span><br><span class=\"line\">        sys.exit(<span class=\"number\">1</span>)</span><br><span class=\"line\">    main(str(sys.argv[<span class=\"number\">1</span>]))</span><br></pre></td></tr></table></figure></p>\n<p><br><br><strong>github 信息泄露</strong><br>GitHub 的私有仓库是需要花钱才能使用，大部分程序员使用的公共仓库，这就意味着任何人都能查看到你上传的文件，如果文件里包含敏感信息，那么将会造成以下安全隐患：</p>\n<p>(1).如果是公司各种应用服务的登陆凭证，黑客可以轻而易举的进入内部人员访问区域，并获取到内部才能获得的信息。<br>(2).如果是公司的 web 项目代码，黑客可以通过代码审计，更容易的挖掘出漏洞来攻击公司网络。<br>(3).如果是公司的核心技术代码，可能会被商业竞争对手盗去，对公司造成经济上的损失。<br>还有就是有些公司直接使用开源项目的代码进行部署，没有对项目代码进行安全审核，如果该开源项目中包含了攻击者的恶意代码，也将会对公司造成安全隐患。</p>\n<p><em>GitHub给开发者来方便的同时存在哪些安全隐患问题：</em></p>\n<ul>\n<li>①账号密码泄露(公司邮箱、联系人通讯录、办公vpn等)</li>\n<li>②核心算法泄露(系统、软件被破解)</li>\n<li>③API_KEY泄露(利用接口进行攻击等)</li>\n<li>④服务器key、配置泄露(危害服务器安全)</li>\n<li>⑤源码泄露(代码被审计,可能被人搞0day)</li>\n</ul>\n","comments":true,"excerpt":"注意：本文分享给安全从业人员、网站开发人员以及运维人员在日常工作防范恶意攻击,请勿恶意使用下面介绍技术进行非法攻击操作。。[TOC]","categories":[{"name":"渗透总结","path":"api/categories/渗透总结.json"}],"tags":[{"name":"信息泄露","path":"api/tags/信息泄露.json"}]}