{"title":"Linux与Windows服务器操作系统安全防御实践指南","slug":"网安防御/Linux与Windows服务器操作系统安全防御实践指南","date":"2020-10-13T06:36:30.000Z","updated":"2022-04-11T05:13:06.923Z","url":"2020/10-13-585.html","path":"api/articles/2020/10-13-585.html.json","covers":["https://img.shields.io/github/stars/weiyigeek/SecOpsDev?style=social","https://p4.ssl.qhimg.com/t0120bb1143284a3de4.png","https://p4.ssl.qhimg.com/t019b69458141e2b861.png","https://p5.ssl.qhimg.com/t0167ef3f8ecdc04adf.png","https://p2.ssl.qhimg.com/t01106e2d42a7678af2.png","https://p1.ssl.qhimg.com/t01d60ed94b22067e47.png","https://p4.ssl.qhimg.com/t01cc7b57e64e28297b.png","https://p1.ssl.qhimg.com/t0127ed9bebd38fb2c6.png","https://p1.ssl.qhimg.com/t017be4088d023d01ff.png","https://github.com/WeiyiGeek/SecOpsDev/network","https://p0.ssl.qhimg.com/t0114314dc35eeaf325.png","https://github.com/WeiyiGeek/SecOpsDev/network"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"0x00-前言简述\"><a href=\"#0x00-前言简述\" class=\"headerlink\" title=\"0x00 前言简述\"></a>0x00 前言简述</h2><p>最近单位在做等保测评，由本人从事安全运维方面的工作（PS:曾经做过等保等方面的安全服务），所以自然而然的与信安的测评人员一起对接相关业务系统的检查，在做主机系统测评检查时发现了系统中某些配置不符合等保要求，需要对不满足要求的主机做进一步整改，好在我们众多的系统基本都是运行在虚拟机上搭建的kubernetes集群中，这样一来就可以尽可能减少加固系统给应用带来的影响，我们可以一台一台加固更新。</p>\n<p>在这样环境的驱动下不得不将通宵熬夜，我准备好了枸杞和保温杯，当然也把测试环境也准备了一套，并将以前写的安全加固脚本进行重新整理，根据当前业务服务器系统版本进行更新和测试。（我还年轻，我还可加班！）</p>\n<p>我们企业内部主要有<code>WindowsServer2019</code>、<code>CentOS7</code>、以及<code>Ubuntu20.04</code>三类操作系统，可以看出操作系统版本都还是比较新的，所以在下面的安全配置核查脚本以及安全加固脚本主要针对上述的三个版本的操作系统。</p>\n<p>Linux 系统中采用Shell脚本、WiindowsServer系统中采用的是PowerShell脚本进行编写, <code>注意脚本会有一定更新建议通过下面的项目地址获取最新的脚本</code>。</p>\n<p>Github 项目地址: <a href=\"https://github.com/WeiyiGeek/SecOpsDev/blob/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F\" target=\"_blank\" rel=\"noopener\">https://github.com/WeiyiGeek/SecOpsDev/blob/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F</a> </p>\n<p><img src=\"https://img.shields.io/github/stars/weiyigeek/SecOpsDev?style=social\" alt=\"GitHub Repo stars\">  <a href=\"https://github.com/WeiyiGeek/SecOpsDev/network\" target=\"_blank\" rel=\"noopener\"><img src=\"https://img.shields.io/github/forks/WeiyiGeek/SecOpsDev?style=social\" alt=\"GitHub forks\"></a> ，欢迎大家 Star 与 Fork 。</p>\n<p>原文链接: 完整的Windows与Linux服务器系统安全加固实践和基线检测脚本（等保2.0）( <a href=\"https://mp.weixin.qq.com/s/CDGzTzrAk9vJtbH4BisSlw\" target=\"_blank\" rel=\"noopener\">https://mp.weixin.qq.com/s/CDGzTzrAk9vJtbH4BisSlw</a> )</p>\n<p><br></p>\n<p><strong>WindowsSever 2019 安全配置策略基线配置核查效果图</strong></p>\n<figure class=\"image-box\">\n                <img src=\"https://p4.ssl.qhimg.com/t0120bb1143284a3de4.png\" alt=\"系统基础信息\" title=\"\" class=\"\">\n                <p>系统基础信息</p>\n            </figure>\n<figure class=\"image-box\">\n                <img src=\"https://p4.ssl.qhimg.com/t019b69458141e2b861.png\" alt=\"等保主机测评项\" title=\"\" class=\"\">\n                <p>等保主机测评项</p>\n            </figure>\n<figure class=\"image-box\">\n                <img src=\"https://p5.ssl.qhimg.com/t0167ef3f8ecdc04adf.png\" alt=\"系统补丁信息\" title=\"\" class=\"\">\n                <p>系统补丁信息</p>\n            </figure>\n<figure class=\"image-box\">\n                <img src=\"https://p2.ssl.qhimg.com/t01106e2d42a7678af2.png\" alt=\"系统补丁信息\" title=\"\" class=\"\">\n                <p>系统补丁信息</p>\n            </figure>\n<p><br></p>\n<p><strong>WindowsSever2019 主机测评项安全加固效果图</strong></p>\n<figure class=\"image-box\">\n                <img src=\"https://p1.ssl.qhimg.com/t01d60ed94b22067e47.png\" alt=\"等保主机测评项\" title=\"\" class=\"\">\n                <p>等保主机测评项</p>\n            </figure>\n<figure class=\"image-box\">\n                <img src=\"https://p4.ssl.qhimg.com/t01cc7b57e64e28297b.png\" alt=\"等保主机测评项\" title=\"\" class=\"\">\n                <p>等保主机测评项</p>\n            </figure>\n<figure class=\"image-box\">\n                <img src=\"https://p1.ssl.qhimg.com/t0127ed9bebd38fb2c6.png\" alt=\"主机测评加固\" title=\"\" class=\"\">\n                <p>主机测评加固</p>\n            </figure>\n<p><br></p>\n<p><strong>温馨提示:</strong> 下面脚本有点长，需要有一定的耐心哟。</p>\n<hr>\n<h2 id=\"0x01-WindowServer2019-配置核查与安全加固\"><a href=\"#0x01-WindowServer2019-配置核查与安全加固\" class=\"headerlink\" title=\"0x01 WindowServer2019 配置核查与安全加固\"></a>0x01 WindowServer2019 配置核查与安全加固</h2><p>Windows 加固项目地址: <a href=\"https://github.com/WeiyiGeek/SecOpsDev/tree/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Windows\" target=\"_blank\" rel=\"noopener\">https://github.com/WeiyiGeek/SecOpsDev/tree/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Windows</a></p>\n<p><strong>Windows Server 安全配置策略基线加固项</strong></p>\n<ul>\n<li>系统账号策略 </li>\n<li>系统事件审核策略</li>\n<li>系统组策略安全选项策略</li>\n<li>注册表相关安全策略</li>\n<li>防火墙服务相关安全策略</li>\n<li>针对于系统暂无办法通过注册表以及组策略配置的安全加固项</li>\n<li>从微软安全中心拉取服务器安全补丁列表信息与本地已打补丁做比较</li>\n</ul>\n<p>废话不多，上才艺（脚本 ）</p>\n<p><strong>Windows Server 安全配置策略基线检测脚本</strong><br>Link: <a href=\"https://github.com/WeiyiGeek/SecOpsDev/blob/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Windows/WindowsSecurityBaseLine.ps1\" target=\"_blank\" rel=\"noopener\">https://github.com/WeiyiGeek/SecOpsDev/blob/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Windows/WindowsSecurityBaseLine.ps1</a><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br><span class=\"line\">695</span><br><span class=\"line\">696</span><br><span class=\"line\">697</span><br><span class=\"line\">698</span><br><span class=\"line\">699</span><br><span class=\"line\">700</span><br><span class=\"line\">701</span><br><span class=\"line\">702</span><br><span class=\"line\">703</span><br><span class=\"line\">704</span><br><span class=\"line\">705</span><br><span class=\"line\">706</span><br><span class=\"line\">707</span><br><span class=\"line\">708</span><br><span class=\"line\">709</span><br><span class=\"line\">710</span><br><span class=\"line\">711</span><br><span class=\"line\">712</span><br><span class=\"line\">713</span><br><span class=\"line\">714</span><br><span class=\"line\">715</span><br><span class=\"line\">716</span><br><span class=\"line\">717</span><br><span class=\"line\">718</span><br><span class=\"line\">719</span><br><span class=\"line\">720</span><br><span class=\"line\">721</span><br><span class=\"line\">722</span><br><span class=\"line\">723</span><br><span class=\"line\">724</span><br><span class=\"line\">725</span><br><span class=\"line\">726</span><br><span class=\"line\">727</span><br><span class=\"line\">728</span><br><span class=\"line\">729</span><br><span class=\"line\">730</span><br><span class=\"line\">731</span><br><span class=\"line\">732</span><br><span class=\"line\">733</span><br><span class=\"line\">734</span><br><span class=\"line\">735</span><br><span class=\"line\">736</span><br><span class=\"line\">737</span><br><span class=\"line\">738</span><br><span class=\"line\">739</span><br><span class=\"line\">740</span><br><span class=\"line\">741</span><br><span class=\"line\">742</span><br><span class=\"line\">743</span><br><span class=\"line\">744</span><br><span class=\"line\">745</span><br><span class=\"line\">746</span><br><span class=\"line\">747</span><br><span class=\"line\">748</span><br><span class=\"line\">749</span><br><span class=\"line\">750</span><br><span class=\"line\">751</span><br><span class=\"line\">752</span><br><span class=\"line\">753</span><br><span class=\"line\">754</span><br><span class=\"line\">755</span><br><span class=\"line\">756</span><br><span class=\"line\">757</span><br><span class=\"line\">758</span><br><span class=\"line\">759</span><br><span class=\"line\">760</span><br><span class=\"line\">761</span><br><span class=\"line\">762</span><br><span class=\"line\">763</span><br><span class=\"line\">764</span><br><span class=\"line\">765</span><br><span class=\"line\">766</span><br><span class=\"line\">767</span><br><span class=\"line\">768</span><br><span class=\"line\">769</span><br><span class=\"line\">770</span><br><span class=\"line\">771</span><br><span class=\"line\">772</span><br><span class=\"line\">773</span><br><span class=\"line\">774</span><br><span class=\"line\">775</span><br><span class=\"line\">776</span><br><span class=\"line\">777</span><br><span class=\"line\">778</span><br><span class=\"line\">779</span><br><span class=\"line\">780</span><br><span class=\"line\">781</span><br><span class=\"line\">782</span><br><span class=\"line\">783</span><br><span class=\"line\">784</span><br><span class=\"line\">785</span><br><span class=\"line\">786</span><br><span class=\"line\">787</span><br><span class=\"line\">788</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#######################################################</span></span><br><span class=\"line\"><span class=\"comment\"># @Author: WeiyiGeek</span></span><br><span class=\"line\"><span class=\"comment\"># @Description:  Windows Server 安全配置策略基线检测脚本</span></span><br><span class=\"line\"><span class=\"comment\"># @Create Time:  2019年5月6日 11:04:42</span></span><br><span class=\"line\"><span class=\"comment\"># @Last Modified time: 2021-11-15 11:06:31</span></span><br><span class=\"line\"><span class=\"comment\"># @E-mail: master@weiyigeek.top</span></span><br><span class=\"line\"><span class=\"comment\"># @Blog: https://www.weiyigeek.top</span></span><br><span class=\"line\"><span class=\"comment\"># @wechat: WeiyiGeeker</span></span><br><span class=\"line\"><span class=\"comment\"># @Github: https://github.com/WeiyiGeek/SecOpsDev/tree/master/OS-操作系统/Windows/</span></span><br><span class=\"line\"><span class=\"comment\"># @Version: 1.8</span></span><br><span class=\"line\"><span class=\"comment\"># @Runtime: Server 2019 / Windows 10</span></span><br><span class=\"line\"><span class=\"comment\">#######################################################</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;#</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.SYNOPSIS</span></span></span><br><span class=\"line\"><span class=\"comment\">Windows Server 安全配置策略基线检测脚本 （脚本将会在Github上持续更新）</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\">Windows Server 操作系统配置策略核查 (符合等保3级的关键检查项)</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.EXAMPLE</span></span></span><br><span class=\"line\"><span class=\"comment\">WindowsSecurityBaseLine.ps1 -Executor WeiyiGeek -MsrcUpdate False</span></span><br><span class=\"line\"><span class=\"comment\">- Executor : 脚本执行者</span></span><br><span class=\"line\"><span class=\"comment\">- MsrcUpdate : 是否在线拉取微软安全中心的服务器安全补丁列表信息(建议一台主机拉取好之后将WSUSList.json和WSUSListId.json拷贝到当前脚本同级目录下)</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.NOTES</span></span></span><br><span class=\"line\"><span class=\"comment\">注意:不同的版本操作系统以下某些关键项可能会不存在会有一些警告(需要大家提交issue，共同完成)。</span></span><br><span class=\"line\"><span class=\"comment\">#&gt;</span></span><br><span class=\"line\">[Cmdletbinding()]</span><br><span class=\"line\"><span class=\"keyword\">param</span>(</span><br><span class=\"line\">  [Parameter(Mandatory=<span class=\"literal\">$true</span>)][String]<span class=\"variable\">$Executor</span>,</span><br><span class=\"line\">  [Boolean]<span class=\"variable\">$MsrcUpdate</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># * 文件输出默认为UTF-8格式</span></span><br><span class=\"line\"><span class=\"variable\">$PSDefaultParameterValues</span>[<span class=\"string\">'Out-File:Encoding'</span>] = <span class=\"string\">'utf8'</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">################################################################################################################################</span></span><br><span class=\"line\"><span class=\"comment\"># **********************#</span></span><br><span class=\"line\"><span class=\"comment\"># * 全局公用工具依赖函数  *  </span></span><br><span class=\"line\"><span class=\"comment\"># **********************#</span></span><br><span class=\"line\"><span class=\"keyword\">Function</span> F_IsCurrentUserAdmin</span><br><span class=\"line\">&#123; </span><br><span class=\"line\"><span class=\"comment\">&lt;#</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.SYNOPSIS</span></span></span><br><span class=\"line\"><span class=\"comment\">F_IsCurrentUserAdmin 函数：全局公用工具依赖。</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\">判断当前运行的powershell终端是否管理员执行,返回值 true 或者 false</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.EXAMPLE</span></span></span><br><span class=\"line\"><span class=\"comment\">F_IsCurrentUserAdmin</span></span><br><span class=\"line\"><span class=\"comment\">#&gt;</span></span><br><span class=\"line\">  <span class=\"variable\">$user</span> = [Security.Principal.WindowsIdentity]::GetCurrent(); </span><br><span class=\"line\">  (<span class=\"built_in\">New-Object</span> Security.Principal.WindowsPrincipal <span class=\"variable\">$user</span>).IsInRole([Security.Principal.WindowsBuiltinRole]::Administrator) </span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> F_Logging &#123;</span><br><span class=\"line\"><span class=\"comment\">&lt;#</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.SYNOPSIS</span></span></span><br><span class=\"line\"><span class=\"comment\">F_Logging 日志输出函数</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\">用于输出脚本执行结果并按照不同的日志等级输出显示到客户终端上。</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.EXAMPLE</span></span></span><br><span class=\"line\"><span class=\"comment\">F_Logging -Level [Info|Warning|Error] -Msg \"测试输出字符串\"</span></span><br><span class=\"line\"><span class=\"comment\">#&gt;</span></span><br><span class=\"line\">  <span class=\"keyword\">param</span> (</span><br><span class=\"line\">    [Parameter(Mandatory=<span class=\"literal\">$true</span>)]<span class=\"variable\">$Msg</span>,</span><br><span class=\"line\">    [ValidateSet(<span class=\"string\">\"Info\"</span>,<span class=\"string\">\"Warning\"</span>,<span class=\"string\">\"Error\"</span>)]<span class=\"variable\">$Level</span></span><br><span class=\"line\">  )</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (<span class=\"variable\">$Level</span>) &#123;</span><br><span class=\"line\">    Info &#123; </span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"[INFO] $&#123;Msg&#125;\"</span> -ForegroundColor Green;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Warning &#123;</span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"[WARN] $&#123;Msg&#125;\"</span> -ForegroundColor Yellow;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Error &#123; </span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"[ERROR] $&#123;Msg&#125;\"</span> -ForegroundColor Red;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Default &#123;</span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"[*] F_Logging 日志 Level 等级错误`n Useage： F_Logging -Level [Info|Warning|Error] -Msg '测试输出字符串'\"</span> -ForegroundColor Red;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> F_Tools &#123;</span><br><span class=\"line\"><span class=\"comment\">&lt;#</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.SYNOPSIS</span></span></span><br><span class=\"line\"><span class=\"comment\">F_Tools 检测对比函数</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\">验证判断传入的字段是否与安全加固字段一致</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.EXAMPLE</span></span></span><br><span class=\"line\"><span class=\"comment\">F_Tools -Key \"ItemDemo\" -Value \"2\" -Operator \"eq\" -DefaultValue \"1\"  -Msg \"对比ItemDemo字段值与预设值\"</span></span><br><span class=\"line\"><span class=\"comment\">#&gt;</span></span><br><span class=\"line\">  <span class=\"keyword\">param</span> (</span><br><span class=\"line\">    [Parameter(Mandatory=<span class=\"literal\">$true</span>)][String]<span class=\"variable\">$Key</span>,</span><br><span class=\"line\">    [Parameter(Mandatory=<span class=\"literal\">$true</span>)]<span class=\"variable\">$Value</span>,</span><br><span class=\"line\">    [Parameter(Mandatory=<span class=\"literal\">$true</span>)]<span class=\"variable\">$DefaultValue</span>,</span><br><span class=\"line\">    [String]<span class=\"variable\">$Msg</span>,</span><br><span class=\"line\">    [String]<span class=\"variable\">$Operator</span></span><br><span class=\"line\">  )</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( <span class=\"variable\">$Operator</span> <span class=\"nomarkup\">-eq</span>  <span class=\"string\">\"eq\"</span> ) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"variable\">$Value</span> <span class=\"nomarkup\">-eq</span> <span class=\"variable\">$DefaultValue</span> ) &#123;</span><br><span class=\"line\">      <span class=\"variable\">$Result</span> = @&#123;<span class=\"string\">\"$(<span class=\"variable\">$Key</span>)\"</span>=<span class=\"string\">\"[合格项]|$(<span class=\"variable\">$Value</span>)|$(<span class=\"variable\">$DefaultValue</span>)|$(<span class=\"variable\">$Msg</span>)-【符合】等级保护标准.\"</span>&#125;</span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"$(<span class=\"variable\">$Key</span>)\"</span>=<span class=\"string\">\" [合格项]|$(<span class=\"variable\">$Value</span>)|$(<span class=\"variable\">$DefaultValue</span>)|$(<span class=\"variable\">$Msg</span>)-【符合】等级保护标准.\"</span> -ForegroundColor White</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"variable\">$Result</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"variable\">$Result</span> = @&#123;<span class=\"string\">\"$(<span class=\"variable\">$Key</span>)\"</span>=<span class=\"string\">\"[异常项]|$(<span class=\"variable\">$Value</span>)|$(<span class=\"variable\">$DefaultValue</span>)|$(<span class=\"variable\">$Msg</span>)-【不符合】等级保护标准.\"</span>&#125;</span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"$(<span class=\"variable\">$Key</span>)\"</span>=<span class=\"string\">\" [异常项]|$(<span class=\"variable\">$Value</span>)|$(<span class=\"variable\">$DefaultValue</span>)|$(<span class=\"variable\">$Msg</span>)-【不符合】等级保护标准.\"</span> -ForegroundColor red</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"variable\">$Result</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125; <span class=\"keyword\">elseif</span> (<span class=\"variable\">$Operator</span> <span class=\"nomarkup\">-eq</span>  <span class=\"string\">\"ne\"</span> ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"variable\">$Value</span> <span class=\"nomarkup\">-ne</span> <span class=\"variable\">$DefaultValue</span> ) &#123;</span><br><span class=\"line\">      <span class=\"variable\">$Result</span> = @&#123;<span class=\"string\">\"$(<span class=\"variable\">$Key</span>)\"</span>=<span class=\"string\">\"[合格项]|$(<span class=\"variable\">$Value</span>)|$(<span class=\"variable\">$DefaultValue</span>)|$(<span class=\"variable\">$Msg</span>)-【符合】等级保护标准.\"</span>&#125;</span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"$(<span class=\"variable\">$Key</span>)\"</span>=<span class=\"string\">\" [合格项]|$(<span class=\"variable\">$Value</span>)|$(<span class=\"variable\">$DefaultValue</span>)|$(<span class=\"variable\">$Msg</span>)-【符合】等级保护标准.\"</span> -ForegroundColor White</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"variable\">$Result</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"variable\">$Result</span> = @&#123;<span class=\"string\">\"$(<span class=\"variable\">$Key</span>)\"</span>=<span class=\"string\">\"[异常项]|$(<span class=\"variable\">$Value</span>)|$(<span class=\"variable\">$DefaultValue</span>)|$(<span class=\"variable\">$Msg</span>)-【不符合】等级保护标准.\"</span>&#125;</span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"$(<span class=\"variable\">$Key</span>)\"</span>=<span class=\"string\">\" [异常项]|$(<span class=\"variable\">$Value</span>)|$(<span class=\"variable\">$DefaultValue</span>)|$(<span class=\"variable\">$Msg</span>)-【不符合】等级保护标准.\"</span> -ForegroundColor red</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"variable\">$Result</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125; <span class=\"keyword\">elseif</span> (<span class=\"variable\">$Operator</span> <span class=\"nomarkup\">-eq</span>  <span class=\"string\">\"le\"</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"variable\">$Value</span> <span class=\"nomarkup\">-le</span> <span class=\"variable\">$DefaultValue</span> ) &#123;</span><br><span class=\"line\">      <span class=\"variable\">$Result</span> = @&#123;<span class=\"string\">\"$(<span class=\"variable\">$Key</span>)\"</span>=<span class=\"string\">\"[合格项]|$(<span class=\"variable\">$Value</span>)|$(<span class=\"variable\">$DefaultValue</span>)|$(<span class=\"variable\">$Msg</span>)-【符合】等级保护标准.\"</span>&#125;</span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"$(<span class=\"variable\">$Key</span>)\"</span>=<span class=\"string\">\" [合格项]|$(<span class=\"variable\">$Value</span>)|$(<span class=\"variable\">$DefaultValue</span>)|$(<span class=\"variable\">$Msg</span>)-【符合】等级保护标准.\"</span> -ForegroundColor White</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"variable\">$Result</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"variable\">$Result</span> = @&#123;<span class=\"string\">\"$(<span class=\"variable\">$Key</span>)\"</span>=<span class=\"string\">\"[异常项]|$(<span class=\"variable\">$Value</span>)|$(<span class=\"variable\">$DefaultValue</span>)|$(<span class=\"variable\">$Msg</span>)-【不符合】等级保护标准.\"</span>&#125;</span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"$(<span class=\"variable\">$Key</span>)\"</span>=<span class=\"string\">\" [异常项]|$(<span class=\"variable\">$Value</span>)|$(<span class=\"variable\">$DefaultValue</span>)|$(<span class=\"variable\">$Msg</span>)-【不符合】等级保护标准.\"</span> -ForegroundColor red</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"variable\">$Result</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125; <span class=\"keyword\">elseif</span> (<span class=\"variable\">$Operator</span> <span class=\"nomarkup\">-eq</span> <span class=\"string\">\"ge\"</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"variable\">$Value</span> <span class=\"nomarkup\">-ge</span> <span class=\"variable\">$DefaultValue</span> ) &#123;</span><br><span class=\"line\">      <span class=\"variable\">$Result</span> =  @&#123;<span class=\"string\">\"$(<span class=\"variable\">$Key</span>)\"</span>=<span class=\"string\">\"[合格项]|$(<span class=\"variable\">$Value</span>)|$(<span class=\"variable\">$DefaultValue</span>)|$(<span class=\"variable\">$Msg</span>)-【符合】等级保护标准.\"</span>&#125;</span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"$(<span class=\"variable\">$Key</span>)\"</span>=<span class=\"string\">\" [合格项]|$(<span class=\"variable\">$Value</span>)|$(<span class=\"variable\">$DefaultValue</span>)|$(<span class=\"variable\">$Msg</span>)-【符合】等级保护标准.\"</span> -ForegroundColor White</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"variable\">$Result</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"variable\">$Result</span> = @&#123;<span class=\"string\">\"$(<span class=\"variable\">$Key</span>)\"</span>=<span class=\"string\">\"[异常项]|$(<span class=\"variable\">$Value</span>)|$(<span class=\"variable\">$DefaultValue</span>)|$(<span class=\"variable\">$Msg</span>)-【不符合】等级保护标准.\"</span>&#125;</span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"$(<span class=\"variable\">$Key</span>)\"</span>=<span class=\"string\">\" [异常项]|$(<span class=\"variable\">$Value</span>)|$(<span class=\"variable\">$DefaultValue</span>)|$(<span class=\"variable\">$Msg</span>)-【不符合】等级保护标准.\"</span> -ForegroundColor red</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"variable\">$Result</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> F_GetRegPropertyValue &#123;</span><br><span class=\"line\">  <span class=\"keyword\">param</span> (</span><br><span class=\"line\">    [Parameter(Mandatory=<span class=\"literal\">$true</span>)][String]<span class=\"variable\">$Key</span>,</span><br><span class=\"line\">    [Parameter(Mandatory=<span class=\"literal\">$true</span>)][String]<span class=\"variable\">$Name</span>,</span><br><span class=\"line\">    [Parameter(Mandatory=<span class=\"literal\">$true</span>)][String]<span class=\"variable\">$Operator</span>,</span><br><span class=\"line\">    [Parameter(Mandatory=<span class=\"literal\">$true</span>)]<span class=\"variable\">$DefaultValue</span>,</span><br><span class=\"line\">    [Parameter(Mandatory=<span class=\"literal\">$true</span>)][String]<span class=\"variable\">$Msg</span></span><br><span class=\"line\">  )</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$Value</span> = Get-ItemPropertyValue -Path <span class=\"string\">\"Registry::<span class=\"variable\">$Key</span>\"</span> -ErrorAction Ignore -WarningAction Ignore -Name <span class=\"variable\">$Name</span></span><br><span class=\"line\">    <span class=\"variable\">$Result</span> = F_Tools -Key <span class=\"string\">\"Registry::$(<span class=\"variable\">$Name</span>)\"</span> -Value <span class=\"variable\">$Value</span> -Operator <span class=\"variable\">$Operator</span> -DefaultValue <span class=\"variable\">$DefaultValue</span>  -Msg <span class=\"variable\">$Msg</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable\">$Result</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> &#123;</span><br><span class=\"line\">   <span class=\"variable\">$Result</span> = @&#123;<span class=\"string\">\"Registry::$(<span class=\"variable\">$Name</span>)\"</span>=<span class=\"string\">\"[异常项]|$(<span class=\"variable\">$Key</span>)中$(<span class=\"variable\">$Name</span>)不存在该项|$(<span class=\"variable\">$DefaultValue</span>)|$(<span class=\"variable\">$Msg</span>)\"</span>&#125;</span><br><span class=\"line\">   <span class=\"built_in\">Write-Host</span> <span class=\"variable\">$Result</span>.Values -ForegroundColor Red</span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"variable\">$Result</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">Function</span> F_UrlRequest &#123;</span><br><span class=\"line\">  <span class=\"keyword\">param</span> (</span><br><span class=\"line\">    [Parameter(Mandatory=<span class=\"literal\">$true</span>)][String]<span class=\"variable\">$Msrc_api</span></span><br><span class=\"line\">  )</span><br><span class=\"line\">  <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"[-] $(<span class=\"variable\">$Msrc_api</span>)\"</span> -ForegroundColor Gray</span><br><span class=\"line\">  <span class=\"variable\">$Response</span>=<span class=\"built_in\">Invoke-WebRequest</span> -Uri <span class=\"string\">\"$(<span class=\"variable\">$Msrc_api</span>)\"</span></span><br><span class=\"line\">  <span class=\"keyword\">Return</span> <span class=\"built_in\">ConvertFrom-Json</span> -InputObject <span class=\"variable\">$Response</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">################################################################################################################################</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># * 操作系统基础信息记录函数 * #</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># - 系统信息记录函数 - #</span></span><br><span class=\"line\"><span class=\"variable\">$SysInfo</span> = @&#123;&#125;</span><br><span class=\"line\"><span class=\"comment\"># - Get-Computer 命令使用 </span></span><br><span class=\"line\"><span class=\"comment\"># Tips ：在 Server 2019 以及 Windows 10 以下系统无该命令</span></span><br><span class=\"line\"><span class=\"comment\"># $Item = 'WindowsProductName','WindowsEditionId','WindowsInstallationType','WindowsCurrentVersion','WindowsVersion','WindowsProductId','BiosManufacturer','BiosFirmwareType','BiosName','BiosVersion','BiosBIOSVersion','BiosSeralNumber','CsBootupState','OsBootDevice','BiosReleaseDate','CsName','CsAdminPasswordStatus','CsManufacturer','CsModel','OsName','OsType','OsProductType','OsServerLevel','OsArchitecture','CsSystemType','OsOperatingSystemSKU','OsVersion','OsBuildNumber','OsSerialNumber','OsInstallDate','OsSystemDevice','OsSystemDirectory','OsCountryCode','OsCodeSet','OsLocaleID','OsCurrentTimeZone','TimeZone','OsLanguage','OsLocalDateTime','OsLastBootUpTime','CsProcessors','OsBuildType','CsNumberOfProcessors','CsNumberOfLogicalProcessors','OsMaxNumberOfProcesses','OsTotalVisibleMemorySize','OsFreePhysicalMemory','OsTotalVirtualMemorySize','OsFreeVirtualMemory','OsInUseVirtualMemory','OsMaxProcessMemorySize','CsNetworkAdapters','OsHotFixes'</span></span><br><span class=\"line\"><span class=\"comment\"># - Systeminfo 命令使用(通用-推荐)</span></span><br><span class=\"line\"><span class=\"variable\">$Item</span> = <span class=\"string\">'Hostname'</span>,<span class=\"string\">'OSName'</span>,<span class=\"string\">'OSVersion'</span>,<span class=\"string\">'OSManufacturer'</span>,<span class=\"string\">'OSConfiguration'</span>,<span class=\"string\">'OS Build Type'</span>,<span class=\"string\">'RegisteredOwner'</span>,<span class=\"string\">'RegisteredOrganization'</span>,<span class=\"string\">'Product ID'</span>,<span class=\"string\">'Original Install Date'</span>,<span class=\"string\">'System Boot Time'</span>,<span class=\"string\">'System Manufacturer'</span>,<span class=\"string\">'System Model'</span>,<span class=\"string\">'System Type'</span>,<span class=\"string\">'Processor(s)'</span>,<span class=\"string\">'BIOS Version'</span>,<span class=\"string\">'Windows Directory'</span>,<span class=\"string\">'System Directory'</span>,<span class=\"string\">'Boot Device'</span>,<span class=\"string\">'System Locale'</span>,<span class=\"string\">'Input Locale'</span>,<span class=\"string\">'Time Zone'</span>,<span class=\"string\">'Total Physical Memory'</span>,<span class=\"string\">'Available Physical Memory'</span>,<span class=\"string\">'Virtual Memory: Max Size'</span>,<span class=\"string\">'Virtual Memory: Available'</span>,<span class=\"string\">'Virtual Memory: In Use'</span>,<span class=\"string\">'Page File Location(s)'</span>,<span class=\"string\">'Domain'</span>,<span class=\"string\">'Logon Server'</span>,<span class=\"string\">'Hotfix(s)'</span>,<span class=\"string\">'Network Card(s)'</span></span><br><span class=\"line\"><span class=\"keyword\">Function</span> F_SysInfo &#123;</span><br><span class=\"line\">  <span class=\"comment\"># - 当前系统及计算机相关信息 (Primary)</span></span><br><span class=\"line\">  <span class=\"comment\"># Server 2019 以及 Windows 10 适用</span></span><br><span class=\"line\">  <span class=\"comment\"># $Computer = Get-ComputerInfo</span></span><br><span class=\"line\">  <span class=\"variable\">$Computer</span> = systeminfo.exe /FO CSV /S <span class=\"variable\">$env:COMPUTERNAME</span> |<span class=\"built_in\">Select-Object</span> -Skip <span class=\"number\">1</span> | <span class=\"built_in\">ConvertFrom-CSV</span> -Header <span class=\"variable\">$Item</span></span><br><span class=\"line\">  <span class=\"keyword\">foreach</span>( <span class=\"variable\">$key</span> <span class=\"keyword\">in</span> <span class=\"variable\">$Item</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$SysInfo</span> += @&#123;<span class=\"string\">\"$(<span class=\"variable\">$key</span>)\"</span>=<span class=\"variable\">$Computer</span>.<span class=\"variable\">$key</span>&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\"># - 通用设置针对采用`systeminfo.exe`命令方式</span></span><br><span class=\"line\">  <span class=\"variable\">$SysInfo</span> += @&#123;<span class=\"string\">\"WindowsProductName\"</span>=<span class=\"string\">\"$(<span class=\"variable\">$SysInfo</span>.OSName)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"variable\">$SysInfo</span>.OsVersion=(<span class=\"variable\">$Sysinfo</span>.OSVersion -split <span class=\"string\">\" \"</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\">  <span class=\"variable\">$SysInfo</span> += @&#123;<span class=\"string\">\"CsSystemType\"</span>=(<span class=\"variable\">$Sysinfo</span>.<span class=\"string\">\"System Type\"</span> -split <span class=\"string\">\" \"</span>)[<span class=\"number\">0</span>]&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># - 当前系统 PowerShell 版本信息以及是否为虚拟机</span></span><br><span class=\"line\">  <span class=\"variable\">$SysInfo</span> += @&#123;<span class=\"string\">\"PSVersion\"</span>=<span class=\"variable\">$PSVersionTable</span>.PSEdition+<span class=\"string\">\"-\"</span>+<span class=\"variable\">$PSVersionTable</span>.PSVersion&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># - 验证当前计算机产品及其版本 (Primary)</span></span><br><span class=\"line\">  <span class=\"variable\">$Flag</span> = <span class=\"variable\">$SysInfo</span>.WindowsProductName <span class=\"nomarkup\">-match</span>  <span class=\"string\">\"Windows 8.1|Windows 10|Server 2008|Server 2012|Server 2016|Server 2019\"</span></span><br><span class=\"line\">  <span class=\"variable\">$ProductName</span> = <span class=\"string\">\"$(<span class=\"variable\">$Matches</span>.Values)\"</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( <span class=\"variable\">$ProductName</span>.Contains(<span class=\"string\">\"Windows\"</span>)) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$SysInfo</span> += @&#123;<span class=\"string\">\"ProductType\"</span>=<span class=\"string\">\"Client\"</span>&#125;</span><br><span class=\"line\">    <span class=\"variable\">$SysInfo</span> += @&#123;<span class=\"string\">\"ProductName\"</span>=<span class=\"variable\">$ProductName</span>&#125;</span><br><span class=\"line\">    <span class=\"variable\">$SysInfo</span> += @&#123;<span class=\"string\">\"WindowsVersion\"</span>=Get-ItemPropertyValue -Path <span class=\"string\">'Registry::HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion'</span> -Name ReleaseId&#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$SysInfo</span> += @&#123;<span class=\"string\">\"ProductType\"</span>=<span class=\"string\">\"Server\"</span>&#125;</span><br><span class=\"line\">    <span class=\"variable\">$SysInfo</span> += @&#123;<span class=\"string\">\"ProductName\"</span>=<span class=\"variable\">$ProductName</span>&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># - 验证当前计算机产品是是物理机还是虚拟机 (Primary)</span></span><br><span class=\"line\">  <span class=\"variable\">$ComputerType</span> = <span class=\"built_in\">get-wmiobject</span> win32_computersystem</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"variable\">$ComputerType</span>.Manufacturer <span class=\"nomarkup\">-match</span> <span class=\"string\">\"VMware\"</span>)&#123;</span><br><span class=\"line\">    <span class=\"variable\">$SysInfo</span> += @&#123;<span class=\"string\">\"ComputerType\"</span>=<span class=\"string\">\"虚拟机 - $(<span class=\"variable\">$ComputerType</span>.Model)\"</span>&#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$SysInfo</span> += @&#123;<span class=\"string\">\"ComputerType\"</span>=<span class=\"string\">\"物理机 - $(<span class=\"variable\">$ComputerType</span>.Model)\"</span>&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\"># # - 当前计算机温度值信息记录 （WINDOWSERVER2019支持）</span></span><br><span class=\"line\">  <span class=\"comment\"># Get-CimInstance -Namespace ROOT/WMI -Class MSAcpi_ThermalZoneTemperature | % &#123; </span></span><br><span class=\"line\">  <span class=\"comment\">#   $currentTempKelvin = $_.CurrentTemperature / 10 </span></span><br><span class=\"line\">  <span class=\"comment\">#   $currentTempCelsius = $currentTempKelvin - 273.15 </span></span><br><span class=\"line\">  <span class=\"comment\">#   $currentTempFahrenheit = (9/5) * $currentTempCelsius + 32 </span></span><br><span class=\"line\">  <span class=\"comment\">#   $Temperature += \"InstanceName: \" + $_.InstanceName+ \" ==&gt;&gt; \" +  $currentTempCelsius.ToString() + \" 摄氏度(C);  \" + $currentTempFahrenheit.ToString() + \" 华氏度(F) ; \" + $currentTempKelvin + \"开氏度(K) `n\" </span></span><br><span class=\"line\">  <span class=\"comment\"># &#125;</span></span><br><span class=\"line\">  <span class=\"comment\"># $SysInfo += @&#123;\"Temperature\"=$Temperature&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable\">$SysInfo</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># * - 计算机Mac及IP地址信息函数 * #</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#  * 系统网络及适配器信息变量 * #</span></span><br><span class=\"line\"><span class=\"variable\">$SysNetAdapter</span> = @&#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> F_SysNetAdapter &#123;</span><br><span class=\"line\">  <span class=\"comment\"># - 计算机Mac及IP地址信息</span></span><br><span class=\"line\">  <span class=\"variable\">$Adapter</span> = Get-NetAdapter | <span class=\"built_in\">Sort-Object</span> -Property LinkSpeed</span><br><span class=\"line\">  <span class=\"keyword\">foreach</span> ( <span class=\"variable\">$Item</span> <span class=\"keyword\">in</span> <span class=\"variable\">$Adapter</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$IPAddress</span> = (Get-NetIPAddress -AddressFamily IPv4 -InterfaceIndex <span class=\"variable\">$Item</span>.ifIndex).IPAddress</span><br><span class=\"line\">    <span class=\"variable\">$SysNetAdapter</span> += @&#123;<span class=\"string\">\"$(<span class=\"variable\">$Item</span>.MacAddress)\"</span>=<span class=\"string\">\"$(<span class=\"variable\">$Item</span>.Status) | $(<span class=\"variable\">$Item</span>.Name) | $(<span class=\"variable\">$IPAddress</span>) | $(<span class=\"variable\">$Item</span>.LinkSpeed) | $(<span class=\"variable\">$Item</span>.InterfaceDescription)\"</span>&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable\">$SysNetAdapter</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># * - 计算机系统磁盘与空间剩余查询函数 * #</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># - 系统磁盘与空间剩余信息 - #</span></span><br><span class=\"line\"><span class=\"variable\">$SysDisk</span> = @&#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> F_SysDisk &#123;</span><br><span class=\"line\">  <span class=\"comment\"># - 计算机磁盘信息</span></span><br><span class=\"line\">  <span class=\"variable\">$Disk</span> = Get-Disk</span><br><span class=\"line\">  <span class=\"keyword\">foreach</span> ( <span class=\"variable\">$Item</span> <span class=\"keyword\">in</span> <span class=\"variable\">$Disk</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$SysDisk</span> += @&#123;<span class=\"string\">\"$(<span class=\"variable\">$Item</span>.SerialNumber)\"</span>=<span class=\"string\">\"$(<span class=\"variable\">$Item</span>.Number) | $(<span class=\"variable\">$Item</span>.FriendlyName) | $(<span class=\"variable\">$Item</span>.HealthStatus)| $(<span class=\"variable\">$Item</span>.Size / [math]::Pow(1024,3)) GB | $(<span class=\"variable\">$Item</span>.PartitionStyle) |$(<span class=\"variable\">$Item</span>.OperationalStatus)\"</span>&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"variable\">$Drive</span> = <span class=\"built_in\">Get-PSDrive</span> -PSProvider FileSystem | <span class=\"built_in\">Sort-Object</span> -Property Name</span><br><span class=\"line\">  <span class=\"variable\">$Drive</span> | % &#123;</span><br><span class=\"line\">    <span class=\"variable\">$Free</span> = [Math]::Round( <span class=\"variable\">$_</span>.Free / [math]::pow(<span class=\"number\">1024</span>,<span class=\"number\">3</span>),<span class=\"number\">2</span> )</span><br><span class=\"line\">    <span class=\"variable\">$Used</span> = [Math]::Round( <span class=\"variable\">$_</span>.Used / [math]::pow(<span class=\"number\">1024</span>,<span class=\"number\">3</span>),<span class=\"number\">2</span> )</span><br><span class=\"line\">    <span class=\"variable\">$Total</span> = [Math]::Ceiling(<span class=\"variable\">$Free</span> + <span class=\"variable\">$Used</span>)</span><br><span class=\"line\">    <span class=\"variable\">$SysDisk</span> += @&#123;<span class=\"string\">\"FileSystem::$(<span class=\"variable\">$_</span>.Name)\"</span>=<span class=\"string\">\"$(<span class=\"variable\">$_</span>.Name) | Free: $(<span class=\"variable\">$Free</span>) GB | Used: $(<span class=\"variable\">$Used</span>) GB | Total: $(<span class=\"variable\">$Total</span>) GB\"</span>&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable\">$SysDisk</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># * 系统账号检查函数  * #</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># - 系统账户信息变量 - # </span></span><br><span class=\"line\"><span class=\"variable\">$SysAccount</span> = @&#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">Function</span> F_SysAccount &#123;</span><br><span class=\"line\">  <span class=\"comment\"># - 账户检查</span></span><br><span class=\"line\">  <span class=\"variable\">$Account</span> = <span class=\"built_in\">Get-WmiObject</span> -Class Win32_UserAccount | <span class=\"built_in\">Select-Object</span> Name,AccountType,Caption,SID</span><br><span class=\"line\">  <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"* 当前系统存在的 $(<span class=\"variable\">$Account</span>.Length) 名账户 : $(<span class=\"variable\">$Account</span>.Name)\"</span> -ForegroundColor Green</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"variable\">$Acount</span>.Length <span class=\"nomarkup\">-ge</span> <span class=\"number\">4</span> -and (<span class=\"variable\">$Account</span>.sid  | <span class=\"built_in\">Select-String</span> -Pattern <span class=\"string\">\"^((?!(-500|-501|-503|-504)).)*$\"</span>)) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$Result</span> = @&#123;<span class=\"string\">\"SysAccount\"</span>=<span class=\"string\">\"[异常项]-系统中存在其他账号请检查: $(<span class=\"variable\">$Account</span>.Name)\"</span>&#125;</span><br><span class=\"line\">    <span class=\"variable\">$SysAccount</span> += <span class=\"variable\">$Result</span></span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"variable\">$Result</span> = @&#123;<span class=\"string\">\"SysAccount\"</span>=<span class=\"string\">\"[合格项]-系统中无多余其他账号\"</span>;&#125;</span><br><span class=\"line\">    <span class=\"variable\">$SysAccount</span> += <span class=\"variable\">$Result</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable\">$SysAccount</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># * 系统账号策略配置核查函数  * #</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># - 系统账号策略 - #</span></span><br><span class=\"line\"><span class=\"variable\">$SysAccountPolicy</span> = @&#123;</span><br><span class=\"line\">  <span class=\"comment\"># + 密码最短留存期</span></span><br><span class=\"line\">  <span class=\"string\">\"MinimumPasswordAge\"</span> = @&#123;operator=<span class=\"string\">\"le\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"密码最短留存期\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 密码最长留存期</span></span><br><span class=\"line\">  <span class=\"string\">\"MaximumPasswordAge\"</span> = @&#123;operator=<span class=\"string\">\"le\"</span>;value=<span class=\"number\">90</span>;msg=<span class=\"string\">\"密码最长留存期\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 密码长度最小值</span></span><br><span class=\"line\">  <span class=\"string\">\"MinimumPasswordLength\"</span> = @&#123;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">14</span>;msg=<span class=\"string\">\"密码长度最小值\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 密码必须符合复杂性要求</span></span><br><span class=\"line\">  <span class=\"string\">\"PasswordComplexity\"</span> = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"密码必须符合复杂性要求策略\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 强制密码历史 N个记住的密码</span></span><br><span class=\"line\">  <span class=\"string\">\"PasswordHistorySize\"</span> = @&#123;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">3</span>;msg=<span class=\"string\">\"强制密码历史个记住的密码\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 账户登录失败锁定阈值N次数</span></span><br><span class=\"line\">  <span class=\"string\">\"LockoutBadCount\"</span> = @&#123;operator=<span class=\"string\">\"le\"</span>;value=<span class=\"number\">6</span>;msg=<span class=\"string\">\"账户登录失败锁定阈值次数\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 账户锁定时间(分钟)</span></span><br><span class=\"line\">  <span class=\"string\">\"ResetLockoutCount\"</span> = @&#123;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">15</span>;msg=<span class=\"string\">\"账户锁定时间(分钟)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 复位账户锁定计数器时间(分钟)</span></span><br><span class=\"line\">  <span class=\"string\">\"LockoutDuration\"</span> = @&#123;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">15</span>;msg=<span class=\"string\">\"复位账户锁定计数器时间(分钟)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 下次登录必须更改密码</span></span><br><span class=\"line\">  <span class=\"string\">\"RequireLogonToChangePassword\"</span> = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">0</span>;msg=<span class=\"string\">\"下次登录必须更改密码\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 强制过期</span></span><br><span class=\"line\">  <span class=\"string\">\"ForceLogoffWhenHourExpire\"</span> = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">0</span>;msg=<span class=\"string\">\"强制过期\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 当前管理账号登陆名称</span></span><br><span class=\"line\">  <span class=\"string\">\"NewAdministratorName\"</span> = @&#123;operator=<span class=\"string\">\"ne\"</span>;value=<span class=\"string\">'\"Administrator\"'</span>;msg=<span class=\"string\">\"当前系统默认管理账号登陆名称策略\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 当前来宾用户登陆名称</span></span><br><span class=\"line\">  <span class=\"string\">\"NewGuestName\"</span> = @&#123;operator=<span class=\"string\">\"ne\"</span>;value=<span class=\"string\">'\"Guest\"'</span>;msg=<span class=\"string\">\"当前系统默认来宾用户登陆名称策略\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 管理员是否被启用</span></span><br><span class=\"line\">  <span class=\"string\">\"EnableAdminAccount\"</span> = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"管理员账户停用与启用策略\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 来宾用户是否启用</span></span><br><span class=\"line\">  <span class=\"string\">\"EnableGuestAccount\"</span> = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">0</span>;msg=<span class=\"string\">\"来宾账户停用与启用策略\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 指示是否使用可逆加密来存储密码一般禁用(除非应用程序要求超过保护密码信息的需要)</span></span><br><span class=\"line\">  <span class=\"string\">\"ClearTextPassword\"</span> = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">0</span>;msg=<span class=\"string\">\"指示是否使用可逆加密来存储密码 (除非应用程序要求超过保护密码信息的需要)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 启用时此设置允许匿名用户查询本地LSA策略(0关闭)</span></span><br><span class=\"line\">  <span class=\"string\">\"LSAAnonymousNameLookup\"</span> = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">0</span>;msg=<span class=\"string\">\"启用时此设置允许匿名用户查询本地LSA策略 (0关闭)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 检查结果存放的空数组</span></span><br><span class=\"line\">  <span class=\"string\">\"CheckResults\"</span> = @()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"keyword\">Function</span> F_SysAccountPolicy &#123;</span><br><span class=\"line\">  <span class=\"variable\">$Count</span> = <span class=\"variable\">$Config</span>.Count</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"variable\">$i</span>=<span class=\"number\">0</span>;<span class=\"variable\">$i</span> <span class=\"nomarkup\">-lt</span> <span class=\"variable\">$Count</span>; <span class=\"variable\">$i</span>++)&#123;</span><br><span class=\"line\">    <span class=\"variable\">$Line</span> = <span class=\"variable\">$Config</span>[<span class=\"variable\">$i</span>] -split <span class=\"string\">\" = \"</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$SysAccountPolicy</span>.ContainsKey(<span class=\"string\">\"$(<span class=\"variable\">$Line</span>[0])\"</span>)) &#123;</span><br><span class=\"line\">      <span class=\"variable\">$Result</span> = F_Tools -Key <span class=\"string\">\"SysAccountPolicy::$(<span class=\"variable\">$Line</span>[0])\"</span> -Value <span class=\"variable\">$Line</span>[<span class=\"number\">1</span>] -Operator <span class=\"variable\">$SysAccountPolicy</span>[<span class=\"string\">\"$(<span class=\"variable\">$Line</span>[0])\"</span>].Operator -DefaultValue <span class=\"variable\">$SysAccountPolicy</span>[<span class=\"string\">\"$(<span class=\"variable\">$Line</span>[0])\"</span>].Value  -Msg <span class=\"string\">\"系统账号策略配置-$(<span class=\"variable\">$SysAccountPolicy</span>[\"</span>$(<span class=\"variable\">$Line</span>[<span class=\"number\">0</span>])<span class=\"string\">\"].Msg)\"</span></span><br><span class=\"line\">      <span class=\"variable\">$SysAccountPolicy</span>[<span class=\"string\">'CheckResults'</span>] += <span class=\"variable\">$Result</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"variable\">$Line</span>[<span class=\"number\">0</span>] <span class=\"nomarkup\">-eq</span> <span class=\"string\">\"[Event Audit]\"</span> ) &#123; <span class=\"keyword\">break</span>;&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable\">$SysAccountPolicy</span>[<span class=\"string\">'CheckResults'</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># * 系统事件审核策略配置核查函数  * #</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># - 系统事件审核策略 - #</span></span><br><span class=\"line\"><span class=\"variable\">$SysEventAuditPolicy</span>  = @&#123;</span><br><span class=\"line\">  <span class=\"comment\"># + 审核系统事件(0) [成功(1)、失败(2)] (3)</span></span><br><span class=\"line\">  AuditSystemEvents = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">3</span>;msg=<span class=\"string\">\"审核系统事件\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 审核登录事件 成功、失败</span></span><br><span class=\"line\">  AuditLogonEvents = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">3</span>;msg=<span class=\"string\">\"审核登录事件\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 审核对象访问 成功、失败</span></span><br><span class=\"line\">  AuditObjectAccess = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">3</span>;msg=<span class=\"string\">\"审核对象访问\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 审核特权使用 失败</span></span><br><span class=\"line\">  AuditPrivilegeUse = @&#123;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">2</span>;msg=<span class=\"string\">\"审核特权使用\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 审核策略更改 成功、失败</span></span><br><span class=\"line\">  AuditPolicyChange = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">3</span>;msg=<span class=\"string\">\"审核策略更改\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 审核账户管理 成功、失败</span></span><br><span class=\"line\">  AuditAccountManage = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">3</span>;msg=<span class=\"string\">\"审核账户管理\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 审核过程追踪 失败</span></span><br><span class=\"line\">  AuditProcessTracking = @&#123;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">2</span>;msg=<span class=\"string\">\"审核过程追踪\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 审核目录服务访问 失败</span></span><br><span class=\"line\">  AuditDSAccess = @&#123;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">2</span>;msg=<span class=\"string\">\"审核目录服务访问\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 审核账户登录事件 成功、失败</span></span><br><span class=\"line\">  AuditAccountLogon = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">3</span>;msg=<span class=\"string\">\"审核账户登录事件\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 检查结果存放的空数组</span></span><br><span class=\"line\">  CheckResults = @()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> F_SysEventAuditPolicy &#123;</span><br><span class=\"line\">  <span class=\"variable\">$Count</span> = <span class=\"variable\">$Config</span>.Count</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"variable\">$i</span>=<span class=\"number\">0</span>;<span class=\"variable\">$i</span> <span class=\"nomarkup\">-lt</span> <span class=\"variable\">$Count</span>; <span class=\"variable\">$i</span>++)&#123;</span><br><span class=\"line\">    <span class=\"variable\">$Line</span> = <span class=\"variable\">$Config</span>[<span class=\"variable\">$i</span>] -split <span class=\"string\">\" = \"</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"variable\">$Line</span>[<span class=\"number\">0</span>] <span class=\"nomarkup\">-eq</span> <span class=\"string\">\"[Registry Values]\"</span> ) &#123; <span class=\"keyword\">break</span>;&#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$SysEventAuditPolicy</span>.ContainsKey(<span class=\"string\">\"$(<span class=\"variable\">$Line</span>[0])\"</span>)) &#123;</span><br><span class=\"line\">      <span class=\"variable\">$Result</span> = F_Tools -Key <span class=\"string\">\"SysEventAuditPolicy::$(<span class=\"variable\">$Line</span>[0])\"</span> -Value <span class=\"variable\">$Line</span>[<span class=\"number\">1</span>] -Operator <span class=\"variable\">$SysEventAuditPolicy</span>[<span class=\"string\">\"$(<span class=\"variable\">$Line</span>[0])\"</span>].Operator -DefaultValue <span class=\"variable\">$SysEventAuditPolicy</span>[<span class=\"string\">\"$(<span class=\"variable\">$Line</span>[0])\"</span>].Value  -Msg <span class=\"string\">\"系统账号策略配置-$(<span class=\"variable\">$SysEventAuditPolicy</span>[\"</span>$(<span class=\"variable\">$Line</span>[<span class=\"number\">0</span>])<span class=\"string\">\"].Msg)\"</span></span><br><span class=\"line\">      <span class=\"variable\">$SysEventAuditPolicy</span>[<span class=\"string\">'CheckResults'</span>] += <span class=\"variable\">$Result</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable\">$SysEventAuditPolicy</span>[<span class=\"string\">'CheckResults'</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># * 操作系统用户权限管理策略检查  * #</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># - 组策略用户权限管理策略 - #</span></span><br><span class=\"line\"><span class=\"variable\">$SysUserPrivilegePolicy</span> = @&#123;</span><br><span class=\"line\"><span class=\"comment\"># + 操作系统本地关机策略安全</span></span><br><span class=\"line\">SeShutdownPrivilege = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">'*S-1-5-32-544'</span>;msg=<span class=\"string\">\"操作系统本地关机策略\"</span>&#125;</span><br><span class=\"line\"><span class=\"comment\"># + 操作系统远程关机策略安全</span></span><br><span class=\"line\">SeRemoteShutdownPrivilege = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">'*S-1-5-32-544'</span>;msg=<span class=\"string\">\"操作系统远程关机策略\"</span>&#125;</span><br><span class=\"line\"><span class=\"comment\"># + 取得文件或其他对象的所有权限策略</span></span><br><span class=\"line\">SeProfileSingleProcessPrivilege = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">'*S-1-5-32-544'</span>;msg=<span class=\"string\">\"取得文件或其他对象的所有权限策略\"</span>&#125;</span><br><span class=\"line\"><span class=\"comment\"># + 从网络访问此计算机策略</span></span><br><span class=\"line\">SeNetworkLogonRight = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">'*S-1-5-32-544,*S-1-5-32-545,*S-1-5-32-551'</span>;msg=<span class=\"string\">\"从网络访问此计算机策略\"</span>&#125;</span><br><span class=\"line\">CheckResults = @()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">Function</span> F_SysUserPrivilegePolicy &#123;</span><br><span class=\"line\">  <span class=\"comment\"># - 策略组用户权限配置</span></span><br><span class=\"line\">  <span class=\"variable\">$Hash</span> = <span class=\"variable\">$SysUserPrivilegePolicy</span>.Clone()  <span class=\"comment\"># 巨坑之处</span></span><br><span class=\"line\">  <span class=\"keyword\">foreach</span> ( <span class=\"variable\">$Name</span> <span class=\"keyword\">in</span> <span class=\"variable\">$Hash</span>.keys) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"variable\">$Name</span>.Equals(<span class=\"string\">\"CheckResults\"</span>))&#123; <span class=\"keyword\">continue</span>; &#125;</span><br><span class=\"line\">    <span class=\"variable\">$Line</span> = (<span class=\"variable\">$Config</span> | <span class=\"built_in\">Select-String</span> <span class=\"variable\">$Name</span>.toString()) -split <span class=\"string\">\" = \"</span></span><br><span class=\"line\">    <span class=\"variable\">$Result</span> = F_Tools -Key <span class=\"string\">\"SysUserPrivilegePolicy::$(<span class=\"variable\">$Line</span>[0])\"</span> -Value <span class=\"variable\">$Line</span>[<span class=\"number\">1</span>] -Operator <span class=\"variable\">$SysUserPrivilegePolicy</span>[<span class=\"string\">\"$(<span class=\"variable\">$Line</span>[0])\"</span>].Operator -DefaultValue <span class=\"variable\">$SysUserPrivilegePolicy</span>[<span class=\"string\">\"$(<span class=\"variable\">$Line</span>[0])\"</span>].Value  -Msg <span class=\"string\">\"策略组用户权限配置-$(<span class=\"variable\">$SysUserPrivilegePolicy</span>[\"</span>$(<span class=\"variable\">$Line</span>[<span class=\"number\">0</span>])<span class=\"string\">\"].Msg)\"</span></span><br><span class=\"line\">    <span class=\"variable\">$SysUserPrivilegePolicy</span>[<span class=\"string\">'CheckResults'</span>] += <span class=\"variable\">$Result</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable\">$SysUserPrivilegePolicy</span>[<span class=\"string\">'CheckResults'</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># * 操作系统策略组安全选项权限配置检查 * #</span></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"comment\"># - 组策略安全选项策略 - #</span></span><br><span class=\"line\"><span class=\"variable\">$SysSecurityOptionPolicy</span> = @&#123;</span><br><span class=\"line\">  <span class=\"comment\"># - 帐户:使用空密码的本地帐户只允许进行控制台登录(启用),注意此设置不影响使用域帐户的登录。(0禁用|1启用)</span></span><br><span class=\"line\">  LimitBlankPasswordUse = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\System\\CurrentControlSet\\Control\\Lsa\\LimitBlankPasswordUse=4,1\"</span>;msg=<span class=\"string\">\"帐户-使用空密码的本地帐户只允许进行控制台登录(启用)\"</span>&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\"># - 交互式登录: 不显示上次登录用户名值(启用)</span></span><br><span class=\"line\">  DontDisplayLastUserName = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\DontDisplayLastUserName=4,1\"</span>;msg=<span class=\"string\">\"交互式登录-不显示上次登录用户名值(启用)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># - 交互式登录: 登录时不显示用户名</span></span><br><span class=\"line\">  DontDisplayUserName = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\DontDisplayUserName=4,1\"</span>;msg=<span class=\"string\">\"交互式登录: 登录时不显示用户名\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># - 交互式登录: 锁定会话时显示用户信息(不显示任何信息)</span></span><br><span class=\"line\">  DontDisplayLockedUserId = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\DontDisplayLockedUserId=4,3\"</span>;msg=<span class=\"string\">\"交互式登录: 锁定会话时显示用户信息(不显示任何信息)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># - 交互式登录: 无需按 CTRL+ALT+DEL(禁用)</span></span><br><span class=\"line\">  DisableCAD = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\DisableCAD=4,0\"</span>;msg=<span class=\"string\">\"交互式登录-无需按CTRL+ALT+DEL值(禁用)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># - 交互式登录：计算机不活动限制值为600秒或更少</span></span><br><span class=\"line\">  InactivityTimeoutSecs = @&#123;operator=<span class=\"string\">\"le\"</span>;value=<span class=\"string\">\"MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\InactivityTimeoutSecs=4,600\"</span>;msg=<span class=\"string\">\"交互式登录-计算机不活动限制值为600秒或更少\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># - 交互式登录: 计算机帐户阈值此策略设置确定可导致计算机重启的失败登录尝试次数</span></span><br><span class=\"line\">  MaxDevicePasswordFailedAttempts = @&#123;operator=<span class=\"string\">\"le\"</span>;value=<span class=\"string\">\"MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\MaxDevicePasswordFailedAttempts=4,10\"</span>;msg=<span class=\"string\">\"交互式登录: 此策略设置确定可导致计算机重启的失败登录尝试次数\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># - 交互式登录: 试图登录的用户的消息标题</span></span><br><span class=\"line\">  LegalNoticeCaption = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">'MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\LegalNoticeCaption=1,\"安全登陆\"'</span>;msg=<span class=\"string\">\"交互式登录: 试图登录的用户的消息标题\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># - 交互式登录: 试图登录的用户的消息文本</span></span><br><span class=\"line\">  LegalNoticeText = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">'MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\LegalNoticeText=7,请谨慎的操作服务器中数据,您所有操作将被记录审计'</span>;msg=<span class=\"string\">\"交互式登录: 试图登录的用户的消息文本\"</span>&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\"># - Microsoft网络客户端: 将未加密的密码发送到第三方 SMB 服务器(禁用)</span></span><br><span class=\"line\">  EnablePlainTextPassword = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\System\\CurrentControlSet\\Services\\LanmanWorkstation\\Parameters\\EnablePlainTextPassword=4,0\"</span>;msg=<span class=\"string\">\"Microsoft网络客户端-将未加密的密码发送到第三方 SMB 服务器(禁用)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># - Microsoft网络服务器：暂停会话前所需的空闲时间数量值为15分钟或更少但不为0</span></span><br><span class=\"line\">  AutoDisconnect = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\System\\CurrentControlSet\\Services\\LanManServer\\Parameters\\AutoDisconnect=4,15\"</span>;msg=<span class=\"string\">\"Microsoft网络服务器-暂停会话前所需的空闲时间数量值为15分钟\"</span>&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\"># - 网络安全: 再下一次改变密码时不存储LAN管理器哈希值(启用)</span></span><br><span class=\"line\">  NoLMHash = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\System\\CurrentControlSet\\Control\\Lsa\\NoLMHash=4,1\"</span>;msg=<span class=\"string\">\"网络安全-在下一次改变密码时不存储LAN管理器哈希值(启用)\"</span>&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\"># - 网络访问: 不允许SAM账户的匿名枚举值为(启用)</span></span><br><span class=\"line\">  RestrictAnonymousSAM = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\System\\CurrentControlSet\\Control\\Lsa\\RestrictAnonymousSAM=4,1\"</span>;msg=<span class=\"string\">\"网络访问-不允许SAM账户的匿名枚举值为(启用)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># - 网络访问:不允许SAM账户和共享的匿名枚举值为(启用)</span></span><br><span class=\"line\">  RestrictAnonymous = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\System\\CurrentControlSet\\Control\\Lsa\\RestrictAnonymous=4,1\"</span>;msg=<span class=\"string\">\"网络访问-不允许SAM账户和共享的匿名枚举值为(启用)\"</span>&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\"># - 关机:设置确定是否可以在无需登录 Windows 的情况下关闭计算机(禁用)</span></span><br><span class=\"line\">  ClearPageFileAtShutdown = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\System\\CurrentControlSet\\Control\\Session Manager\\Memory Management\\ClearPageFileAtShutdown=4,0\"</span>;msg=<span class=\"string\">\"关机-设置确定是否可以在无需登录 Windows 的情况下关闭计算机(禁用)\"</span>&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"string\">\"CheckResults\"</span> = @()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">Function</span> F_SysSecurityOptionPolicy &#123;</span><br><span class=\"line\">  <span class=\"variable\">$Hash</span> = <span class=\"variable\">$SysSecurityOptionPolicy</span>.Clone()  <span class=\"comment\"># 巨坑之处</span></span><br><span class=\"line\">  <span class=\"keyword\">foreach</span> ( <span class=\"variable\">$Name</span> <span class=\"keyword\">in</span> <span class=\"variable\">$Hash</span>.keys) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"variable\">$Name</span>.Equals(<span class=\"string\">\"CheckResults\"</span>))&#123; <span class=\"keyword\">continue</span>; &#125;</span><br><span class=\"line\">    <span class=\"variable\">$Flag</span> = <span class=\"variable\">$Config</span> | <span class=\"built_in\">Select-String</span> <span class=\"variable\">$Name</span>.toString() </span><br><span class=\"line\">    <span class=\"variable\">$Value</span> = <span class=\"variable\">$SysSecurityOptionPolicy</span>[<span class=\"string\">\"$(<span class=\"variable\">$Name</span>)\"</span>].Value -split <span class=\"string\">\",\"</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"variable\">$Flag</span> ) &#123;</span><br><span class=\"line\">      <span class=\"variable\">$Line</span> = <span class=\"variable\">$Flag</span> -split <span class=\"string\">\",\"</span></span><br><span class=\"line\">      <span class=\"variable\">$Result</span> = F_Tools -Key <span class=\"string\">\"SysSecurityOptionPolicy::$(<span class=\"variable\">$Name</span>)\"</span> -Value <span class=\"variable\">$Line</span>[<span class=\"number\">1</span>] -Operator <span class=\"variable\">$SysSecurityOptionPolicy</span>[<span class=\"string\">\"$(<span class=\"variable\">$Name</span>)\"</span>].Operator -DefaultValue <span class=\"variable\">$Value</span>[<span class=\"number\">1</span>] -Msg <span class=\"string\">\"策略组安全选项配置-$(<span class=\"variable\">$SysSecurityOptionPolicy</span>[\"</span>$(<span class=\"variable\">$Name</span>)<span class=\"string\">\"].Msg)\"</span></span><br><span class=\"line\">      <span class=\"variable\">$SysSecurityOptionPolicy</span>[<span class=\"string\">'CheckResults'</span>] += <span class=\"variable\">$Result</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"variable\">$Result</span> = @&#123;<span class=\"string\">\"SysSecurityOptionPolicy::$(<span class=\"variable\">$Name</span>)\"</span>=<span class=\"string\">\"[异常项]|未配置|$(<span class=\"variable\">$Value</span>[1])|策略组安全选项配置-$(<span class=\"variable\">$SysSecurityOptionPolicy</span>[\"</span>$(<span class=\"variable\">$Name</span>)<span class=\"string\">\"].Msg)-【不符合】等级保护标准.\"</span>&#125;</span><br><span class=\"line\">      <span class=\"variable\">$SysSecurityOptionPolicy</span>[<span class=\"string\">'CheckResults'</span>] += <span class=\"variable\">$Result</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable\">$SysSecurityOptionPolicy</span>[<span class=\"string\">'CheckResults'</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># * 操作系统注册表相关配置检查函数  * #</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># - 注册表相关安全策略  -</span></span><br><span class=\"line\"><span class=\"variable\">$SysRegistryPolicy</span> = @&#123;</span><br><span class=\"line\"><span class=\"comment\"># + 屏幕自动保护程序</span></span><br><span class=\"line\">ScreenSaveActive = @&#123;regname=<span class=\"string\">\"HKEY_CURRENT_USER\\Control Panel\\Desktop\"</span>;name=<span class=\"string\">\"ScreenSaveActive\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"系统基配核查-屏幕自动保护程序策略\"</span>&#125;</span><br><span class=\"line\"><span class=\"comment\"># + 屏幕恢复时使用密码保护</span></span><br><span class=\"line\">ScreenSaverIsSecure = @&#123;regname=<span class=\"string\">\"HKEY_CURRENT_USER\\Control Panel\\Desktop\"</span>;name=<span class=\"string\">\"ScreenSaverIsSecure\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"系统基配核查-屏幕恢复时使用密码保护策略\"</span>&#125;</span><br><span class=\"line\"><span class=\"comment\"># + 屏幕保护程序启动时间</span></span><br><span class=\"line\">ScreenSaveTimeOut = @&#123;regname=<span class=\"string\">\"HKEY_CURRENT_USER\\Control Panel\\Desktop\"</span>;name=<span class=\"string\">\"ScreenSaveTimeOut\"</span>;operator=<span class=\"string\">\"le\"</span>;value=<span class=\"number\">600</span>;msg=<span class=\"string\">\"系统基配核查-屏幕保护程序启动时间策略\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># + 禁止全部驱动器自动播放</span></span><br><span class=\"line\">DisableAutoplay  = @&#123;regname=<span class=\"string\">\"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\"</span>;name=<span class=\"string\">\"DisableAutoplay\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"禁止全部驱动器自动播放\"</span>&#125;</span><br><span class=\"line\">NoDriveTypeAutoRun = @&#123;regname=<span class=\"string\">\"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\"</span>;name=<span class=\"string\">\"NoDriveTypeAutoRun\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">255</span>;msg=<span class=\"string\">\"禁止全部驱动器自动播放\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 检查关闭默认共享盘</span></span><br><span class=\"line\">restrictanonymous = @&#123;regname=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\"</span>;name=<span class=\"string\">\"restrictanonymous\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"系统网络基配核查-关闭默认共享盘策略\"</span>&#125;</span><br><span class=\"line\">restrictanonymoussam = @&#123;regname=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\"</span>;name=<span class=\"string\">\"restrictanonymoussam\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"不允许SAM账户的匿名枚举值为(启用)\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 禁用磁盘共享(SMB)</span></span><br><span class=\"line\">AutoShareWks = @&#123;regname=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\lanmanserver\\parameters\"</span>;name=<span class=\"string\">\"AutoShareWks\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">0</span>;msg=<span class=\"string\">\"关闭禁用默认共享策略-Server2012\"</span>&#125;</span><br><span class=\"line\">AutoShareServer = @&#123;regname=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\lanmanserver\\parameters\"</span>;name=<span class=\"string\">\"AutoShareServer\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">0</span>;msg=<span class=\"string\">\"关闭禁用默认共享策略-Server2012\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 系统、应用、安全、PS日志查看器大小设置(此处设置默认的两倍配置-建议一定通过日志采集平台采集系统日志比如ELK)</span></span><br><span class=\"line\">EventlogSystemMaxSize = @&#123;regname=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Eventlog\\System\"</span>;name=<span class=\"string\">\"MaxSize\"</span>;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">41943040</span>;msg=<span class=\"string\">\"系统基日志配核查-系统日志查看器大小设置策略\"</span>&#125;</span><br><span class=\"line\">EventlogApplicationMaxSize = @&#123;regname=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Eventlog\\Application\"</span>;name=<span class=\"string\">\"MaxSize\"</span>;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">41943040</span>;msg=<span class=\"string\">\"系统日志基配核查-应用日志查看器大小设置策略\"</span>&#125;</span><br><span class=\"line\">EventlogSecurityMaxSize = @&#123;regname=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Eventlog\\Security\"</span>;name=<span class=\"string\">\"MaxSize\"</span>;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">41943040</span>;msg=<span class=\"string\">\"系统日志基配核查-安全日志查看器大小设置策略\"</span>&#125;</span><br><span class=\"line\">EventlogPSMaxSize = @&#123;regname=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Eventlog\\Windows PowerShell\"</span>;name=<span class=\"string\">\"MaxSize\"</span>;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">31457280</span>;msg=<span class=\"string\">\"系统日志基配核查-PS日志查看器大小设置策略\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 防火墙相关操作设置（开启、协议、服务）</span></span><br><span class=\"line\">DomainEnableFirewall  = @&#123;regname=<span class=\"string\">'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\DomainProfile'</span>;name=<span class=\"string\">'EnableFirewall'</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"开启域网络防火墙\"</span>&#125;</span><br><span class=\"line\">StandardEnableFirewall = @&#123;regname=<span class=\"string\">'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\SharedAccess\\Parameters\\FirewallPolicy\\StandardProfile'</span>;name=<span class=\"string\">'EnableFirewall'</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"开启专用网络防火墙\"</span>&#125;</span><br><span class=\"line\">PPEnableFirewall = @&#123;regname=<span class=\"string\">'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\SharedAccess\\Parameters\\FirewallPolicy\\PublicProfile'</span>;name=<span class=\"string\">'EnableFirewall'</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"开启公用网络防火墙\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 结果存储</span></span><br><span class=\"line\">CheckResults=@()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">Function</span> F_SysRegistryPolicy &#123; </span><br><span class=\"line\">  <span class=\"variable\">$Registry</span>=  <span class=\"variable\">$SysRegistryPolicy</span>.Clone()</span><br><span class=\"line\">  <span class=\"keyword\">foreach</span> ( <span class=\"variable\">$item</span> <span class=\"keyword\">in</span> <span class=\"variable\">$Registry</span>.keys) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"variable\">$item</span> <span class=\"nomarkup\">-eq</span> <span class=\"string\">\"CheckResults\"</span> )&#123; <span class=\"keyword\">continue</span>;&#125;</span><br><span class=\"line\">    <span class=\"variable\">$Result</span> = F_GetRegPropertyValue -Key <span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$item</span>.regname -Name <span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$item</span>.name -Operator <span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$item</span>.operator -DefaultValue <span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$item</span>.value -Msg <span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$item</span>.msg</span><br><span class=\"line\">    <span class=\"variable\">$SysRegistryPolicy</span>[<span class=\"string\">'CheckResults'</span>] += <span class=\"variable\">$Result</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable\">$SysRegistryPolicy</span>[<span class=\"string\">'CheckResults'</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># * 操作系统服务及运行程序检查函数  * #</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"variable\">$SysProcessServicePolicy</span> = @&#123;<span class=\"string\">\"CheckResults\"</span>=@()&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> F_SysProcessServicePolicy &#123;</span><br><span class=\"line\">  <span class=\"comment\"># + 检测系统及用户开机启动项</span></span><br><span class=\"line\">  <span class=\"variable\">$SysAutoStart</span> = <span class=\"built_in\">Get-Item</span> -Path <span class=\"string\">'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run'</span></span><br><span class=\"line\">  <span class=\"variable\">$SysAutoStart</span>.GetValueNames() | % &#123; </span><br><span class=\"line\">    <span class=\"variable\">$res</span> += <span class=\"string\">\"$(<span class=\"variable\">$_</span>)#$(<span class=\"variable\">$SysAutoStart</span>.GetValue(<span class=\"variable\">$_</span>)) \"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"variable\">$Result</span> = @&#123;<span class=\"string\">\"SysProcessServicePolicy::SysAutoStart\"</span>=<span class=\"variable\">$res</span>&#125;</span><br><span class=\"line\">  <span class=\"variable\">$SysProcessServicePolicy</span>[<span class=\"string\">'CheckResults'</span>] += <span class=\"variable\">$Result</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable\">$UserAutoStart</span> = <span class=\"built_in\">Get-Item</span> -Path <span class=\"string\">'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Run'</span></span><br><span class=\"line\">  <span class=\"variable\">$UserAutoStart</span>.GetValueNames() | % &#123; </span><br><span class=\"line\">    <span class=\"variable\">$res</span> += <span class=\"string\">\"$(<span class=\"variable\">$_</span>)#$(<span class=\"variable\">$SysAutoStart</span>.GetValue(<span class=\"variable\">$_</span>)) \"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"variable\">$Result</span> = @&#123;<span class=\"string\">\"SysProcessServicePolicy::UserAutoStart\"</span>=<span class=\"variable\">$res</span>&#125;</span><br><span class=\"line\">  <span class=\"variable\">$SysProcessServicePolicy</span>[<span class=\"string\">'CheckResults'</span>] += <span class=\"variable\">$Result</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># + 否启用远程桌面服务</span></span><br><span class=\"line\">  <span class=\"variable\">$RDPStatus</span> = (<span class=\"built_in\">Get-Service</span> -Name <span class=\"string\">\"TermService\"</span>).Status</span><br><span class=\"line\">  <span class=\"comment\"># if ($RDP -eq \"0\" -and $RDPStatus -eq \"Running\" ) &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">#   $Result = @&#123;\"SysProcessServicePolicy::RDPStatus\"=\"当前系统【已启用】远程桌面服务.\"&#125;</span></span><br><span class=\"line\">  <span class=\"comment\"># &#125; else &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">#   $Result = @&#123;\"SysProcessServicePolicy::RDPStatus\"=\"当前系统【未启用】远程桌面服务.\"&#125;</span></span><br><span class=\"line\">  <span class=\"comment\"># &#125;</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"variable\">$RDPStatus</span> <span class=\"nomarkup\">-eq</span> <span class=\"string\">\"Running\"</span> ) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$Result</span> = F_GetRegPropertyValue -Key <span class=\"string\">'HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\\Terminal Server'</span> -Name <span class=\"string\">'fDenyTSConnections'</span> -Operator <span class=\"string\">\"eq\"</span> -DefaultValue <span class=\"number\">0</span> -Msg <span class=\"string\">\"是否将远程桌面服务禁用\"</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$Result</span> = @&#123;<span class=\"string\">\"SysProcessServicePolicy::RDPStatus\"</span>=<span class=\"string\">\"当前系统【未启用】远程桌面服务.\"</span>&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"variable\">$SysProcessServicePolicy</span>[<span class=\"string\">'CheckResults'</span>] += <span class=\"variable\">$Result</span></span><br><span class=\"line\">  <span class=\"comment\"># - 否启用NTP服务来同步时钟</span></span><br><span class=\"line\">  <span class=\"comment\"># $NTP = F_GetReg -Key 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\NtpServer' -Name 'Enabled'</span></span><br><span class=\"line\">  <span class=\"comment\"># if ( $NTP -eq \"1\") &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">#   $Result = @&#123;\"SysProcessServicePolicy::NtpServerEnabled\"=\"[合格项]|$NTP|1|系统基础配置核查-启用NTP服务同步时钟策略-【符合】等级保护标准.\"&#125;</span></span><br><span class=\"line\">  <span class=\"comment\"># &#125; else &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">#   $Result = @&#123;\"SysProcessServicePolicy::NtpServerEnabled\"=\"[异常项]|$NTP|1|系统基础配置核查-启用NTP服务同步时钟策略-【不符合】等级保护标准.\"&#125;</span></span><br><span class=\"line\">  <span class=\"comment\"># &#125;</span></span><br><span class=\"line\">  <span class=\"variable\">$Result</span> = F_GetRegPropertyValue -Key <span class=\"string\">'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\NtpServer'</span> -Name <span class=\"string\">'Enabled'</span> -Operator <span class=\"string\">\"eq\"</span> -DefaultValue <span class=\"number\">1</span> -Msg <span class=\"string\">\"是否启用NTP服务同步时钟策略\"</span></span><br><span class=\"line\">  <span class=\"variable\">$SysProcessServicePolicy</span>[<span class=\"string\">'CheckResults'</span>] += <span class=\"variable\">$Result</span></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># - 是否修改默认的远程桌面端口</span></span><br><span class=\"line\">  <span class=\"variable\">$RDP1</span> = <span class=\"built_in\">Get-Item</span> <span class=\"string\">'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\\'</span> | % &#123;<span class=\"variable\">$_</span>.GetValue(<span class=\"string\">\"PortNumber\"</span>)&#125;</span><br><span class=\"line\">  <span class=\"variable\">$RDP2</span> = <span class=\"built_in\">Get-Item</span> <span class=\"string\">'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\Wds\\rdpwd\\Tds\\tcp\\'</span> | % &#123;<span class=\"variable\">$_</span>.GetValue(<span class=\"string\">\"PortNumber\"</span>)&#125; </span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( <span class=\"variable\">$RDP1</span> <span class=\"nomarkup\">-eq</span> <span class=\"variable\">$RDP2</span> -and <span class=\"variable\">$RDP2</span> <span class=\"nomarkup\">-ne</span> <span class=\"string\">\"3389\"</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$Result</span> = @&#123;<span class=\"string\">\"SysProcessServicePolicy::RDPPort\"</span>=<span class=\"string\">\"[合格项]|<span class=\"variable\">$RDP1</span>|除3389以外的端口|系统基础配置核查-默认的远程桌面端口已修改-【符合】等级保护标准.\"</span>&#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$Result</span> = @&#123;<span class=\"string\">\"SysProcessServicePolicy::RDPPort\"</span>=<span class=\"string\">\"[异常项]|<span class=\"variable\">$RDP1</span>|除3389以外的端口|系统基础配置核查-默认的远程桌面端口未修改-【不符合】等级保护标准.\"</span>&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"variable\">$SysProcessServicePolicy</span>[<span class=\"string\">'CheckResults'</span>] += <span class=\"variable\">$Result</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># * 操作系统安全检测函数 * </span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># * 微软Windows服务器安全补丁列表信息 * #</span></span><br><span class=\"line\"><span class=\"variable\">$Msrc_api</span> = <span class=\"string\">\"https://api.msrc.microsoft.com/sug/v2.0/zh-CN/affectedProduct?%24orderBy=releaseDate+desc&amp;%24filter=productFamilyId+in+%28%27100000010%27%29+and+severityId+in+%28%27100000000%27%2C%27100000001%27%29+and+%28releaseDate+gt+2020-01-14T00%3A00%3A00%2B08%3A00%29+and+%28releaseDate+lt+2021-05-22T23%3A59%3A59%2B08%3A00%29\"</span></span><br><span class=\"line\"><span class=\"variable\">$SysWSUSList</span> = @&#123;&#125;</span><br><span class=\"line\"><span class=\"variable\">$SysWSUSListId</span> = @()</span><br><span class=\"line\"><span class=\"variable\">$AvailableWSUSList</span> = @&#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> F_SysSecurityPolicy &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># - 系统补丁验证</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( <span class=\"variable\">$MsrcUpdate</span> -or ! (<span class=\"built_in\">Test-Path</span> -Path .\\WSUSList.json) ) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$MSRC_JSON</span> = F_UrlRequest -Msrc_api <span class=\"variable\">$Msrc_api</span></span><br><span class=\"line\">    <span class=\"variable\">$MSRC_JSON</span>.value | % &#123; </span><br><span class=\"line\">      <span class=\"variable\">$id</span> = <span class=\"variable\">$_</span>.id;</span><br><span class=\"line\">      <span class=\"variable\">$product</span> = <span class=\"variable\">$_</span>.product;</span><br><span class=\"line\">      <span class=\"variable\">$articleName</span> = <span class=\"variable\">$_</span>.kbArticles.articleName | <span class=\"built_in\">Get-Unique</span>;</span><br><span class=\"line\">      <span class=\"variable\">$fixedBuildNumber</span> = <span class=\"variable\">$_</span>.kbArticles.fixedBuildNumber | <span class=\"built_in\">Get-Unique</span>;</span><br><span class=\"line\">      <span class=\"variable\">$severity</span> = <span class=\"variable\">$_</span>.severity;</span><br><span class=\"line\">      <span class=\"variable\">$impact</span> = <span class=\"variable\">$_</span>.impact;</span><br><span class=\"line\">      <span class=\"variable\">$baseScore</span> = <span class=\"variable\">$_</span>.baseScore;</span><br><span class=\"line\">      <span class=\"variable\">$cveNumber</span> = <span class=\"variable\">$_</span>.cveNumber | <span class=\"built_in\">Get-Unique</span>;</span><br><span class=\"line\">      <span class=\"variable\">$releaseDate</span> = <span class=\"variable\">$_</span>.releaseDate</span><br><span class=\"line\">      <span class=\"variable\">$SysWSUSList</span> += @&#123;<span class=\"string\">\"$(<span class=\"variable\">$id</span>)\"</span>=@&#123;<span class=\"string\">\"product\"</span>=<span class=\"variable\">$product</span>;<span class=\"string\">\"articleName\"</span>=<span class=\"variable\">$articleName</span>;<span class=\"string\">\"fixedBuildNumber\"</span>=<span class=\"variable\">$fixedBuildNumber</span>;<span class=\"string\">\"severity\"</span>=<span class=\"variable\">$severity</span>;<span class=\"string\">\"impact\"</span>=<span class=\"variable\">$impact</span>;<span class=\"string\">\"baseScore\"</span>=<span class=\"variable\">$baseScore</span>;<span class=\"string\">\"cveNumber\"</span>=<span class=\"variable\">$cveNumber</span>;<span class=\"string\">\"releaseDate\"</span>=<span class=\"variable\">$releaseDate</span>&#125;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"variable\">$MSRC_JSON</span>.<span class=\"string\">'@odata.nextLink'</span>.length) &#123;</span><br><span class=\"line\">      <span class=\"variable\">$MSRC_JSON</span> = F_UrlRequest -Msrc_api <span class=\"variable\">$MSRC_JSON</span>.<span class=\"string\">'@odata.nextLink'</span></span><br><span class=\"line\">      <span class=\"variable\">$MSRC_JSON</span>.value | % &#123; </span><br><span class=\"line\">        <span class=\"variable\">$id</span> = <span class=\"variable\">$_</span>.id;</span><br><span class=\"line\">        <span class=\"variable\">$product</span> = <span class=\"variable\">$_</span>.product;</span><br><span class=\"line\">        <span class=\"variable\">$articleName</span> = <span class=\"variable\">$_</span>.kbArticles.articleName | <span class=\"built_in\">Get-Unique</span>;</span><br><span class=\"line\">        <span class=\"variable\">$fixedBuildNumber</span> = <span class=\"variable\">$_</span>.kbArticles.fixedBuildNumber | <span class=\"built_in\">Get-Unique</span>;</span><br><span class=\"line\">        <span class=\"variable\">$severity</span> = <span class=\"variable\">$_</span>.severity;</span><br><span class=\"line\">        <span class=\"variable\">$impact</span> = <span class=\"variable\">$_</span>.impact;</span><br><span class=\"line\">        <span class=\"variable\">$baseScore</span> = <span class=\"variable\">$_</span>.baseScore;</span><br><span class=\"line\">        <span class=\"variable\">$cveNumber</span> = <span class=\"variable\">$_</span>.cveNumber | <span class=\"built_in\">Get-Unique</span>;</span><br><span class=\"line\">        <span class=\"variable\">$releaseDate</span> = <span class=\"variable\">$_</span>.releaseDate</span><br><span class=\"line\">        <span class=\"variable\">$SysWSUSList</span> += @&#123;<span class=\"string\">\"$(<span class=\"variable\">$id</span>)\"</span>=@&#123;<span class=\"string\">\"product\"</span>=<span class=\"variable\">$product</span>;<span class=\"string\">\"articleName\"</span>=<span class=\"variable\">$articleName</span>;<span class=\"string\">\"fixedBuildNumber\"</span>=<span class=\"variable\">$fixedBuildNumber</span>;<span class=\"string\">\"severity\"</span>=<span class=\"variable\">$severity</span>;<span class=\"string\">\"impact\"</span>=<span class=\"variable\">$impact</span>;<span class=\"string\">\"baseScore\"</span>=<span class=\"variable\">$baseScore</span>;<span class=\"string\">\"cveNumber\"</span>=<span class=\"variable\">$cveNumber</span>;<span class=\"string\">\"releaseDate\"</span>=<span class=\"variable\">$releaseDate</span> &#125;&#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"[-] 已从 Microsoft 安全响应中心获取更新 $(<span class=\"variable\">$MSRC_JSON</span>.'@odata.count') 条补丁信息!\"</span> -ForegroundColor Green</span><br><span class=\"line\">    <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"[-] 正在将获取的更新 $(<span class=\"variable\">$MSRC_JSON</span>.'@odata.count') 条补丁信息写入到本地 WSUSList.json 文件之中!\"</span> -ForegroundColor Green</span><br><span class=\"line\">    <span class=\"variable\">$SysWSUSList</span> | <span class=\"built_in\">ConvertTo-Json</span> | <span class=\"built_in\">Out-File</span> WSUSList.json -Encoding utf8</span><br><span class=\"line\">    <span class=\"variable\">$SysWSUSListId</span> = <span class=\"variable\">$SysWSUSList</span>.keys</span><br><span class=\"line\">    <span class=\"variable\">$SysWSUSList</span>.keys | <span class=\"built_in\">ConvertTo-Json</span> | <span class=\"built_in\">Out-File</span> WSUSListId.json -Encoding utf8</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\"># 从本地读取JSON文件存储的补丁信息。</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">Test-Path</span> -Path .\\WSUSList.json) &#123;</span><br><span class=\"line\">      <span class=\"variable\">$SysWSUSList</span> = <span class=\"built_in\">Get-Content</span> -Raw -Encoding UTF8 .\\WSUSList.json | <span class=\"built_in\">ConvertFrom-Json</span></span><br><span class=\"line\">      <span class=\"variable\">$SysWSUSListId</span>  = <span class=\"built_in\">Get-Content</span> -Raw -Encoding UTF8 .\\WSUSListId.json | <span class=\"built_in\">ConvertFrom-Json</span></span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"[-] 已从本地 WSUSList.json 文件获得 $(<span class=\"variable\">$SysWSUSListId</span>.count) 条补丁信息!\"</span> -ForegroundColor Green</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"[-] 本地未能找到存放补丁信息的 WSUSList.json 文件! 请采用 -Update True 标记从Microsoft 安全响应中心获取更新\"</span> -ForegroundColor Red</span><br><span class=\"line\">      <span class=\"keyword\">break</span></span><br><span class=\"line\">      <span class=\"keyword\">exit</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">  <span class=\"comment\"># 获取当前系统版本可用的补丁列表</span></span><br><span class=\"line\">  <span class=\"variable\">$AvailableWSUSListId</span> = @() </span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"variable\">$SysInfo</span>.ProductType <span class=\"nomarkup\">-eq</span> <span class=\"string\">\"Client\"</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"[-] Desktop Client\"</span> -ForegroundColor Gray</span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> (<span class=\"variable\">$KeyName</span> <span class=\"keyword\">in</span> <span class=\"variable\">$SysWSUSListId</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>((<span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$KeyName</span>\"</span>.product <span class=\"nomarkup\">-match</span> <span class=\"variable\">$SysInfo</span>.ProductName) -and (<span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$KeyName</span>\"</span>.product <span class=\"nomarkup\">-match</span> <span class=\"variable\">$SysInfo</span>.WindowsVersion) -and (<span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$KeyName</span>\"</span>.product <span class=\"nomarkup\">-match</span> (<span class=\"variable\">$SysInfo</span>.CsSystemType -split <span class=\"string\">\" \"</span>)[<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((<span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$KeyName</span>\"</span>.fixedBuildNumber <span class=\"nomarkup\">-match</span> <span class=\"variable\">$SysInfo</span>.OsVersion) -or (<span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$KeyName</span>\"</span>.fixedBuildNumber.length <span class=\"nomarkup\">-eq</span> <span class=\"number\">0</span> )) &#123;</span><br><span class=\"line\">          <span class=\"variable\">$AvailableWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$KeyName</span>\"</span> = <span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$KeyName</span>\"</span></span><br><span class=\"line\">          <span class=\"variable\">$AvailableWSUSListId</span> += <span class=\"string\">\"<span class=\"variable\">$KeyName</span>\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"[-] Windows Server\"</span> -ForegroundColor Gray</span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> (<span class=\"variable\">$KeyName</span> <span class=\"keyword\">in</span> <span class=\"variable\">$SysWSUSListId</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>((<span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$KeyName</span>\"</span>.product <span class=\"nomarkup\">-match</span> <span class=\"variable\">$SysInfo</span>.ProductName) -and (<span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$KeyName</span>\"</span>.product <span class=\"nomarkup\">-match</span> <span class=\"variable\">$SysInfo</span>.ProductName)) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$AvailableWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$KeyName</span>\"</span> = <span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$KeyName</span>\"</span></span><br><span class=\"line\">        <span class=\"variable\">$AvailableWSUSListId</span> += <span class=\"string\">\"<span class=\"variable\">$KeyName</span>\"</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">Write-Host</span> <span class=\"variable\">$SysInfo</span>.ProductName <span class=\"variable\">$SysInfo</span>.WindowsVersion (<span class=\"variable\">$SysInfo</span>.CsSystemType -split <span class=\"string\">\" \"</span>)[<span class=\"number\">0</span>] <span class=\"variable\">$SysInfo</span>.OsVersion</span><br><span class=\"line\">  <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"[-] 已从梳理出适用于当前 $(<span class=\"variable\">$SysInfo</span>.ProductType) 系统版本的 $(<span class=\"variable\">$AvailableWSUSList</span>.count) 条补丁信息!`n\"</span> -ForegroundColor Green</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 已安装的补丁</span></span><br><span class=\"line\">  <span class=\"variable\">$InstallWSUSList</span> = @&#123;&#125;</span><br><span class=\"line\">  <span class=\"variable\">$msg</span> = @()</span><br><span class=\"line\">  <span class=\"keyword\">foreach</span> (<span class=\"variable\">$id</span> <span class=\"keyword\">in</span> <span class=\"variable\">$AvailableWSUSListId</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>( <span class=\"variable\">$SysInfo</span>.<span class=\"string\">'Hotfix(s)'</span> <span class=\"nomarkup\">-match</span> <span class=\"variable\">$AvailableWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$id</span>\"</span>.articleName ) &#123;</span><br><span class=\"line\">      <span class=\"variable\">$InstallWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$id</span>\"</span> = <span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$id</span>\"</span></span><br><span class=\"line\">      <span class=\"variable\">$msg</span> += <span class=\"string\">\"[+]\"</span> + <span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$id</span>\"</span>.product + <span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$id</span>\"</span>.fixedBuildNumber + <span class=\"string\">\" \"</span> +  <span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$id</span>\"</span>.articleName + <span class=\"string\">\"(\"</span> + <span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$id</span>\"</span>.cveNumber   + <span class=\"string\">\")\"</span> + <span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$id</span>\"</span>.severity  + <span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$id</span>\"</span>.baseScore + <span class=\"string\">\"`n\"</span></span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"[-] $(<span class=\"variable\">$SysInfo</span>.'Hotfix(s)') ，共 $(<span class=\"variable\">$AvailableWSUSList</span>.count) 条漏洞补丁信息!`n$(<span class=\"variable\">$msg</span>)\"</span> -ForegroundColor Green</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 未安装的补丁</span></span><br><span class=\"line\">  <span class=\"variable\">$NotInstallWSUSList</span> = @&#123;&#125;</span><br><span class=\"line\">  <span class=\"variable\">$msg</span> = @()</span><br><span class=\"line\">  <span class=\"keyword\">foreach</span> (<span class=\"variable\">$id</span> <span class=\"keyword\">in</span> <span class=\"variable\">$AvailableWSUSListId</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"nomarkup\">-not</span>(<span class=\"variable\">$InstallWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$id</span>\"</span>)) &#123;</span><br><span class=\"line\">     <span class=\"variable\">$NotInstallWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$id</span>\"</span> = <span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$id</span>\"</span></span><br><span class=\"line\">     <span class=\"variable\">$msg</span> += <span class=\"string\">\"[+]\"</span> + <span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$id</span>\"</span>.product + <span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$id</span>\"</span>.fixedBuildNumber + <span class=\"string\">\" \"</span> + <span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$id</span>\"</span>.articleName + <span class=\"string\">\"(\"</span> + <span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$id</span>\"</span>.cveNumber + <span class=\"string\">\")\"</span> + <span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$id</span>\"</span>.severity + <span class=\"variable\">$SysWSUSList</span>.<span class=\"string\">\"<span class=\"variable\">$id</span>\"</span>.baseScore + <span class=\"string\">\"`n\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"[-] 未安装 $(<span class=\"variable\">$NotInstallWSUSList</span>.count) 条漏洞补丁信息，共 $(<span class=\"variable\">$AvailableWSUSList</span>.count) 条漏洞补丁信息!`n$(<span class=\"variable\">$msg</span>)\"</span> -ForegroundColor red</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># * 杂类检测函数 * </span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"variable\">$OtherCheck</span> = @&#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">function</span> F_OtherCheckPolicy &#123;</span><br><span class=\"line\">  <span class=\"comment\"># - 当前系统已安装的软件</span></span><br><span class=\"line\">  <span class=\"variable\">$Product</span> = <span class=\"built_in\">Get-WmiObject</span> -Class Win32_Product | <span class=\"built_in\">Select-Object</span> -Property Name,Version,IdentifyingNumber | <span class=\"built_in\">Sort-Object</span> Name | <span class=\"built_in\">Out-String</span></span><br><span class=\"line\">  <span class=\"variable\">$OtherCheck</span> += @&#123;<span class=\"string\">\"Product\"</span>=<span class=\"string\">\"$(<span class=\"variable\">$Product</span>)\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># - 当前系统最近访问文件或者目录</span></span><br><span class=\"line\">  <span class=\"variable\">$Recent</span> = (<span class=\"built_in\">Get-ChildItem</span> ~\\AppData\\Roaming\\Microsoft\\Windows\\Recent).Name</span><br><span class=\"line\">  <span class=\"variable\">$OtherCheck</span> += @&#123;<span class=\"string\">\"Recent\"</span>=<span class=\"string\">\"$(<span class=\"variable\">$Recent</span>)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable\">$OtherCheck</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> Main() &#123;</span><br><span class=\"line\"><span class=\"comment\">&lt;#</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.SYNOPSIS</span></span></span><br><span class=\"line\"><span class=\"comment\">main 函数程序执行入口</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\">调用上述编写的相关检测脚本</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.EXAMPLE</span></span></span><br><span class=\"line\"><span class=\"comment\">main</span></span><br><span class=\"line\"><span class=\"comment\">#&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$ScanStartTime</span> = <span class=\"built_in\">Get-date</span> -Format <span class=\"string\">'yyyy-M-d H:m:s'</span></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"#################################################################################\"</span></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"- @Desc: Windows Server 安全配置策略基线检测脚本  [将会在Github上持续更新-star]\"</span></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"- @Author: WeiyiGeek\"</span></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"- @Blog: https://www.weiyigeek.top\"</span></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"- @Github: https://github.com/WeiyiGeek/SecOpsDev/tree/master/OS-操作系统/Windows\"</span></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"#################################################################################`n\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"[*] Windows Server 安全配置策略基线检测脚本已启动.\"</span></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"[*] 脚本执行: $(<span class=\"variable\">$Executor</span>), 是否在线拉取微软安全中心的服务器安全补丁列表信息: $(<span class=\"variable\">$MsrcUpdate</span>)`n\"</span></span><br><span class=\"line\"><span class=\"comment\"># 1.判断当前运行的powershell终端是否管理员执行</span></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"[-] 正在检测当前运行的PowerShell终端是否管理员权限...`n\"</span></span><br><span class=\"line\"><span class=\"variable\">$flag</span> = F_IsCurrentUserAdmin</span><br><span class=\"line\"><span class=\"keyword\">if</span> (!(<span class=\"variable\">$flag</span>)) &#123;</span><br><span class=\"line\">  F_Logging -Level Error -Msg <span class=\"string\">\"[*] 脚本执行发生错误,请使用管理员权限运行该脚本..例如: Start-Process powershell -Verb runAs....\"</span></span><br><span class=\"line\">  F_Logging -Level Warning -Msg <span class=\"string\">\"[*] 正在退出执行该脚本......\"</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"[*] PowerShell 管理员权限检查通过...`n\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.当前系统策略配置文件导出 (注意必须系统管理员权限运行) </span></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"[-] 正在导出当前系统策略配置文件 config.cfg......`n\"</span></span><br><span class=\"line\">secedit /export /cfg config.cfg /quiet</span><br><span class=\"line\"><span class=\"built_in\">start-sleep</span> <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> ( <span class=\"nomarkup\">-not</span>(<span class=\"built_in\">Test-Path</span> -Path config.cfg)) &#123;</span><br><span class=\"line\">  F_Logging -Level Error -Msg <span class=\"string\">\"[*] 当前系统策略配置文件 config.cfg 不存在,请检查......`n\"</span></span><br><span class=\"line\">  F_Logging -Level Warning -Msg <span class=\"string\">\"[*] 正在退出执行该脚本......\"</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123; </span><br><span class=\"line\">  <span class=\"built_in\">Copy-Item</span> -Path config.cfg -Destination config.cfg.bak -Force</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable\">$Config</span> = <span class=\"built_in\">Get-Content</span> -path config.cfg</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.系统相关信息以及系统安全组策略检测</span></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"[-] 当前系统信息一览\"</span></span><br><span class=\"line\"><span class=\"variable\">$SysInfo</span> = F_SysInfo</span><br><span class=\"line\"><span class=\"variable\">$SysInfo</span></span><br><span class=\"line\"></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"[-] 当前系统网络信息一览\"</span></span><br><span class=\"line\"><span class=\"variable\">$SysNetAdapter</span> = F_SysNetAdapter</span><br><span class=\"line\"><span class=\"variable\">$SysNetAdapter</span></span><br><span class=\"line\"></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"[-] 当前系统磁盘信息一览\"</span></span><br><span class=\"line\"><span class=\"variable\">$SysDisk</span> = F_SysDisk</span><br><span class=\"line\"><span class=\"variable\">$SysDisk</span></span><br><span class=\"line\"></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"[-] 当前系统账户信息一览\"</span></span><br><span class=\"line\"><span class=\"variable\">$SysAccount</span> = F_SysAccount</span><br><span class=\"line\"><span class=\"variable\">$SysAccount</span></span><br><span class=\"line\"></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"[-] 当前系统安全策略信息一览\"</span></span><br><span class=\"line\"><span class=\"variable\">$SysAccountPolicy</span>.CheckResults = F_SysAccountPolicy</span><br><span class=\"line\"><span class=\"variable\">$SysEventAuditPolicy</span>.CheckResults = F_SysEventAuditPolicy</span><br><span class=\"line\"><span class=\"variable\">$SysUserPrivilegePolicy</span>.CheckResults = F_SysUserPrivilegePolicy</span><br><span class=\"line\"><span class=\"variable\">$SysSecurityOptionPolicy</span>.CheckResults = F_SysSecurityOptionPolicy</span><br><span class=\"line\"><span class=\"variable\">$SysRegistryPolicy</span>.CheckResults = F_SysRegistryPolicy</span><br><span class=\"line\"><span class=\"variable\">$SysProcessServicePolicy</span>.CheckResults = F_SysProcessServicePolicy</span><br><span class=\"line\"></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"[-] 当前系统杂类信息一览\"</span></span><br><span class=\"line\"><span class=\"variable\">$OtherCheck</span> = F_OtherCheckPolicy</span><br><span class=\"line\"><span class=\"variable\">$OtherCheck</span>.Values</span><br><span class=\"line\"></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"[-] 当前系统安全补丁情况信息一览\"</span></span><br><span class=\"line\">F_SysSecurityPolicy</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.程序执行完毕</span></span><br><span class=\"line\"><span class=\"variable\">$ScanEndTime</span> = <span class=\"built_in\">Get-date</span> -Format <span class=\"string\">'yyyy-M-d H:m:s'</span></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"- Windows Server 安全配置策略基线检测脚本已执行完毕......`n开始时间：$&#123;ScanStartTime&#125;`n完成时间: $&#123;ScanEndTime&#125;\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Main</span><br></pre></td></tr></table></figure></p>\n<hr>\n<p><strong>Windows Server 安全配置策略基线加固脚本</strong><br>Link: <a href=\"https://github.com/WeiyiGeek/SecOpsDev/blob/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Windows/WindowsSecurityReinforce.ps1\" target=\"_blank\" rel=\"noopener\">https://github.com/WeiyiGeek/SecOpsDev/blob/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Windows/WindowsSecurityReinforce.ps1</a><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## ----------------------------------------- ##</span></span><br><span class=\"line\"><span class=\"comment\"># @Author: WeiyiGeek</span></span><br><span class=\"line\"><span class=\"comment\"># @Description:  Windows Server 安全配置策略基线加固脚本</span></span><br><span class=\"line\"><span class=\"comment\"># @Create Time:  2019年5月6日 11:04:42</span></span><br><span class=\"line\"><span class=\"comment\"># @Last Modified time: 2021年11月17日 16:02:36</span></span><br><span class=\"line\"><span class=\"comment\"># @E-mail: master@weiyigeek.top</span></span><br><span class=\"line\"><span class=\"comment\"># @Blog: https://www.weiyigeek.top</span></span><br><span class=\"line\"><span class=\"comment\"># @wechat: WeiyiGeeker</span></span><br><span class=\"line\"><span class=\"comment\"># @Github: https://github.com/WeiyiGeek/SecOpsDev/tree/master/OS-操作系统/Windows/</span></span><br><span class=\"line\"><span class=\"comment\"># @Version: 1.9</span></span><br><span class=\"line\"><span class=\"comment\"># @Runtime: Server 2019 / Windows 10</span></span><br><span class=\"line\"><span class=\"comment\">## ----------------------------------------- ##</span></span><br><span class=\"line\"><span class=\"comment\"># 脚本主要功能说明:</span></span><br><span class=\"line\"><span class=\"comment\"># (1) Windows 系统安全策略相关基础配置</span></span><br><span class=\"line\"><span class=\"comment\"># (2) Windows 默认共享关闭、屏保、超时时间以及WSUS补丁更新。</span></span><br><span class=\"line\"><span class=\"comment\"># (3) Windows 等保主机测评项安全加固配置</span></span><br><span class=\"line\"><span class=\"comment\">## ----------------------------------------- ##</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># * 文件输出默认为UTF-8格式</span></span><br><span class=\"line\"><span class=\"comment\"># $PSDefaultParameterValues['Out-File:Encoding'] = 'utf8'</span></span><br><span class=\"line\"><span class=\"variable\">$WUSUServer</span>=<span class=\"string\">\"http://wusu.weiyigeek.top\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;#</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.SYNOPSIS</span></span></span><br><span class=\"line\"><span class=\"comment\">Windows Server 安全配置策略基线加固脚本 （脚本将会在Github上持续更新）</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\">Windows Server 操作系统配置策略 (符合等保3级的关键检查项)</span></span><br><span class=\"line\"><span class=\"comment\">- 系统账号策略 </span></span><br><span class=\"line\"><span class=\"comment\">- 系统事件审核策略</span></span><br><span class=\"line\"><span class=\"comment\">- 系统组策略安全选项策略</span></span><br><span class=\"line\"><span class=\"comment\">- 注册表相关安全策略</span></span><br><span class=\"line\"><span class=\"comment\">- 防火墙服务相关安全策略</span></span><br><span class=\"line\"><span class=\"comment\">- 针对于系统暂无办法通过注册表以及组策略配置的安全加固项</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.EXAMPLE</span></span></span><br><span class=\"line\"><span class=\"comment\">WindowsSecurityReinforce.ps1</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.NOTES</span></span></span><br><span class=\"line\"><span class=\"comment\">注意:不同的版本操作系统以下某些关键项可能会不存在会有一些警告(需要大家提交issue，共同完成)。</span></span><br><span class=\"line\"><span class=\"comment\">#&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 系统账号策略 - #</span></span><br><span class=\"line\"><span class=\"variable\">$SysAccountPolicy</span> = @&#123;</span><br><span class=\"line\">  <span class=\"comment\"># + 密码最短留存期</span></span><br><span class=\"line\">  <span class=\"string\">\"MinimumPasswordAge\"</span> = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"密码最短留存期\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 密码最长留存期</span></span><br><span class=\"line\">  <span class=\"string\">\"MaximumPasswordAge\"</span> = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">90</span>;msg=<span class=\"string\">\"密码最长留存期\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 密码长度最小值</span></span><br><span class=\"line\">  <span class=\"string\">\"MinimumPasswordLength\"</span> = @&#123;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">14</span>;msg=<span class=\"string\">\"密码长度最小值\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 密码必须符合复杂性要求</span></span><br><span class=\"line\">  <span class=\"string\">\"PasswordComplexity\"</span> = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"开启密码符合复杂性要求策略\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 强制密码历史 N个记住的密码</span></span><br><span class=\"line\">  <span class=\"string\">\"PasswordHistorySize\"</span> = @&#123;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">3</span>;msg=<span class=\"string\">\"强制密码历史N个记住的密码\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 账户登录失败锁定阈值N次数</span></span><br><span class=\"line\">  <span class=\"string\">\"LockoutBadCount\"</span> = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">6</span>;msg=<span class=\"string\">\"账户登录失败锁定阈值次数\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 账户锁定时间(分钟)</span></span><br><span class=\"line\">  <span class=\"string\">\"ResetLockoutCount\"</span> = @&#123;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">15</span>;msg=<span class=\"string\">\"账户锁定时间(分钟)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 复位账户锁定计数器时间(分钟)</span></span><br><span class=\"line\">  <span class=\"string\">\"LockoutDuration\"</span> = @&#123;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">15</span>;msg=<span class=\"string\">\"复位账户锁定计数器时间(分钟)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 下次登录必须更改密码</span></span><br><span class=\"line\">  <span class=\"string\">\"RequireLogonToChangePassword\"</span> = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">0</span>;msg=<span class=\"string\">\"下次登录必须更改密码\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 强制过期</span></span><br><span class=\"line\">  <span class=\"string\">\"ForceLogoffWhenHourExpire\"</span> = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"强制过期\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 当前管理账号登陆名称</span></span><br><span class=\"line\">  <span class=\"string\">\"NewAdministratorName\"</span> = @&#123;operator=<span class=\"string\">\"ne\"</span>;value=<span class=\"string\">'\"Admin\"'</span>;msg=<span class=\"string\">\"更改当前系统管理账号登陆名称为Admin策略\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 当前来宾用户登陆名称</span></span><br><span class=\"line\">  <span class=\"string\">\"NewGuestName\"</span> = @&#123;operator=<span class=\"string\">\"ne\"</span>;value=<span class=\"string\">'\"Guester\"'</span>;msg=<span class=\"string\">\"更改当前系统来宾用户登陆名称为Guester策略\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 管理员是否被启用</span></span><br><span class=\"line\">  <span class=\"string\">\"EnableAdminAccount\"</span> = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"管理员账户停用与启用策略\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 来宾用户是否启用</span></span><br><span class=\"line\">  <span class=\"string\">\"EnableGuestAccount\"</span> = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">0</span>;msg=<span class=\"string\">\"来宾账户停用与启用策略\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 指示是否使用可逆加密来存储密码一般禁用(除非应用程序要求超过保护密码信息的需要)</span></span><br><span class=\"line\">  <span class=\"string\">\"ClearTextPassword\"</span> = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">0</span>;msg=<span class=\"string\">\"指示是否使用可逆加密来存储密码 (除非应用程序要求超过保护密码信息的需要)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 启用时此设置允许匿名用户查询本地LSA策略(0关闭)</span></span><br><span class=\"line\">  <span class=\"string\">\"LSAAnonymousNameLookup\"</span> = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">0</span>;msg=<span class=\"string\">\"启用时此设置允许匿名用户查询本地LSA策略 (0关闭)\"</span>&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 系统事件审核策略 - #</span></span><br><span class=\"line\"><span class=\"variable\">$SysEventAuditPolicy</span>  = @&#123;</span><br><span class=\"line\">  <span class=\"comment\"># + 审核系统事件(0) [成功(1)、失败(2)] (3)</span></span><br><span class=\"line\">  AuditSystemEvents = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">3</span>;msg=<span class=\"string\">\"审核系统事件\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 审核登录事件 成功、失败</span></span><br><span class=\"line\">  AuditLogonEvents = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">3</span>;msg=<span class=\"string\">\"审核登录事件\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 审核对象访问 成功、失败</span></span><br><span class=\"line\">  AuditObjectAccess = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">3</span>;msg=<span class=\"string\">\"审核对象访问\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 审核特权使用 失败</span></span><br><span class=\"line\">  AuditPrivilegeUse = @&#123;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">2</span>;msg=<span class=\"string\">\"审核特权使用\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 审核策略更改 成功、失败</span></span><br><span class=\"line\">  AuditPolicyChange = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">3</span>;msg=<span class=\"string\">\"审核策略更改\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 审核账户管理 成功、失败</span></span><br><span class=\"line\">  AuditAccountManage = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">3</span>;msg=<span class=\"string\">\"审核账户管理\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 审核过程追踪 失败</span></span><br><span class=\"line\">  AuditProcessTracking = @&#123;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">2</span>;msg=<span class=\"string\">\"审核过程追踪\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 审核目录服务访问 失败</span></span><br><span class=\"line\">  AuditDSAccess = @&#123;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">2</span>;msg=<span class=\"string\">\"审核目录服务访问\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 审核账户登录事件 成功、失败</span></span><br><span class=\"line\">  AuditAccountLogon = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">3</span>;msg=<span class=\"string\">\"审核账户登录事件\"</span>&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 系统组策略安全选项策略 - #</span></span><br><span class=\"line\"><span class=\"variable\">$SysSecurityOptionPolicy</span> = @&#123;</span><br><span class=\"line\">  <span class=\"comment\"># - 帐户:使用空密码的本地帐户只允许进行控制台登录(启用),注意此设置不影响使用域帐户的登录。(0禁用|1启用)</span></span><br><span class=\"line\">  LimitBlankPasswordUse = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\System\\CurrentControlSet\\Control\\Lsa\\LimitBlankPasswordUse=4,1\"</span>;msg=<span class=\"string\">\"帐户-使用空密码的本地帐户只允许进行控制台登录(启用)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># - 交互式登录: 不显示上次登录用户名值(启用)</span></span><br><span class=\"line\">  DontDisplayLastUserName = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\DontDisplayLastUserName=4,1\"</span>;msg=<span class=\"string\">\"交互式登录-不显示上次登录用户名值(启用)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># - 交互式登录: 登录时不显示用户名</span></span><br><span class=\"line\">  DontDisplayUserName = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\DontDisplayUserName=4,1\"</span>;msg=<span class=\"string\">\"交互式登录: 登录时不显示用户名\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># - 交互式登录: 锁定会话时显示用户信息(不显示任何信息)</span></span><br><span class=\"line\">  DontDisplayLockedUserId = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\DontDisplayLockedUserId=4,3\"</span>;msg=<span class=\"string\">\"交互式登录: 锁定会话时显示用户信息(不显示任何信息)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># - 交互式登录: 无需按 CTRL+ALT+DEL(禁用)</span></span><br><span class=\"line\">  DisableCAD = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\DisableCAD=4,0\"</span>;msg=<span class=\"string\">\"交互式登录-无需按CTRL+ALT+DEL值(禁用)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># - 交互式登录：计算机不活动限制值为600秒或更少</span></span><br><span class=\"line\">  InactivityTimeoutSecs = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\InactivityTimeoutSecs=4,600\"</span>;msg=<span class=\"string\">\"交互式登录-计算机不活动限制值为600秒或更少\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># - 交互式登录: 计算机帐户阈值此策略设置确定可导致计算机重启的失败登录尝试次数</span></span><br><span class=\"line\">  MaxDevicePasswordFailedAttempts = @&#123;operator=<span class=\"string\">\"le\"</span>;value=<span class=\"string\">\"MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\MaxDevicePasswordFailedAttempts=4,10\"</span>;msg=<span class=\"string\">\"交互式登录: 此策略设置确定可导致计算机重启的失败登录尝试次数\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># - 交互式登录: 试图登录的用户的消息标题</span></span><br><span class=\"line\">  LegalNoticeCaption = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">'MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\LegalNoticeCaption=1,\"安全登陆\"'</span>;msg=<span class=\"string\">\"交互式登录: 试图登录的用户的消息标题\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># - 交互式登录: 试图登录的用户的消息文本</span></span><br><span class=\"line\">  LegalNoticeText = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">'MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\LegalNoticeText=7,请谨慎的操作服务器中数据,您所有操作将被记录审计'</span>;msg=<span class=\"string\">\"交互式登录: 试图登录的用户的消息文本\"</span>&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\"># - Microsoft网络客户端: 将未加密的密码发送到第三方 SMB 服务器(禁用)</span></span><br><span class=\"line\">  EnablePlainTextPassword = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\System\\CurrentControlSet\\Services\\LanmanWorkstation\\Parameters\\EnablePlainTextPassword=4,0\"</span>;msg=<span class=\"string\">\"Microsoft网络客户端-将未加密的密码发送到第三方 SMB 服务器(禁用)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># - Microsoft网络服务器：暂停会话前所需的空闲时间数量值为15分钟或更少但不为0</span></span><br><span class=\"line\">  AutoDisconnect = @&#123;operator=<span class=\"string\">\"15\"</span>;value=<span class=\"string\">\"MACHINE\\System\\CurrentControlSet\\Services\\LanManServer\\Parameters\\AutoDisconnect=4,15\"</span>;msg=<span class=\"string\">\"Microsoft网络服务器-暂停会话前所需的空闲时间数量值为15分钟\"</span>&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\"># - 网络安全: 再下一次改变密码时不存储LAN管理器哈希值(启用)</span></span><br><span class=\"line\">  NoLMHash = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\System\\CurrentControlSet\\Control\\Lsa\\NoLMHash=4,1\"</span>;msg=<span class=\"string\">\"网络安全-在下一次改变密码时不存储LAN管理器哈希值(启用)\"</span>&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\"># - 网络访问: 不允许SAM账户的匿名枚举值为(启用)</span></span><br><span class=\"line\">  RestrictAnonymousSAM = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\System\\CurrentControlSet\\Control\\Lsa\\RestrictAnonymousSAM=4,1\"</span>;msg=<span class=\"string\">\"网络访问-不允许SAM账户的匿名枚举值为(启用)\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># - 网络访问:不允许SAM账户和共享的匿名枚举值为(启用)</span></span><br><span class=\"line\">  RestrictAnonymous = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\System\\CurrentControlSet\\Control\\Lsa\\RestrictAnonymous=4,1\"</span>;msg=<span class=\"string\">\"网络访问-不允许SAM账户和共享的匿名枚举值为(启用)\"</span>&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\"># - 关机:设置确定是否可以在无需登录 Windows 的情况下关闭计算机(禁用)</span></span><br><span class=\"line\">  ClearPageFileAtShutdown = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">\"MACHINE\\System\\CurrentControlSet\\Control\\Session Manager\\Memory Management\\ClearPageFileAtShutdown=4,0\"</span>;msg=<span class=\"string\">\"关机-设置确定是否可以在无需登录 Windows 的情况下关闭计算机(禁用)\"</span>&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 操作系统组策略用户权限管理策略 - #</span></span><br><span class=\"line\"><span class=\"variable\">$SysUserPrivilegePolicy</span> = @&#123;</span><br><span class=\"line\">  <span class=\"comment\"># + 操作系统本地关机策略安全</span></span><br><span class=\"line\">  SeShutdownPrivilege = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">'*S-1-5-32-544'</span>;msg=<span class=\"string\">\"操作系统本地关机策略\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 操作系统远程关机策略安全</span></span><br><span class=\"line\">  SeRemoteShutdownPrivilege = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">'*S-1-5-32-544'</span>;msg=<span class=\"string\">\"操作系统远程关机策略\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 取得文件或其他对象的所有权限策略</span></span><br><span class=\"line\">  SeProfileSingleProcessPrivilege = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">'*S-1-5-32-544'</span>;msg=<span class=\"string\">\"取得文件或其他对象的所有权限策略\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 从网络访问此计算机策略</span></span><br><span class=\"line\">  SeNetworkLogonRight = @&#123;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"string\">'*S-1-5-32-544,*S-1-5-32-545,*S-1-5-32-551'</span>;msg=<span class=\"string\">\"从网络访问此计算机策略\"</span>&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># - 注册表相关安全策略  -</span></span><br><span class=\"line\"><span class=\"variable\">$SysRegistryPolicy</span> = @&#123;</span><br><span class=\"line\">  <span class=\"comment\"># + 屏幕自动保护程序</span></span><br><span class=\"line\">  ScreenSaveActive = @&#123;reg=<span class=\"string\">\"HKEY_CURRENT_USER\\Control Panel\\Desktop\"</span>;name=<span class=\"string\">\"ScreenSaveActive\"</span>;regtype=<span class=\"string\">\"String\"</span>;value=<span class=\"number\">1</span>;operator=<span class=\"string\">\"eq\"</span>;msg=<span class=\"string\">\"开启屏幕自动保护程序策略\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 屏幕恢复时使用密码保护</span></span><br><span class=\"line\">  ScreenSaverIsSecure = @&#123;reg=<span class=\"string\">\"HKEY_CURRENT_USER\\Control Panel\\Desktop\"</span>;name=<span class=\"string\">\"ScreenSaverIsSecure\"</span>;regtype=<span class=\"string\">\"String\"</span>;value=<span class=\"number\">1</span>;operator=<span class=\"string\">\"eq\"</span>;msg=<span class=\"string\">\"开启屏幕恢复时使用密码保护策略\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># + 屏幕保护程序启动时间</span></span><br><span class=\"line\">  ScreenSaveTimeOut = @&#123;reg=<span class=\"string\">\"HKEY_CURRENT_USER\\Control Panel\\Desktop\"</span>;name=<span class=\"string\">\"ScreenSaveTimeOut\"</span>;regtype=<span class=\"string\">\"String\"</span>;value=<span class=\"number\">600</span>;operator=<span class=\"string\">\"le\"</span>;msg=<span class=\"string\">\"开启屏幕保护程序启动时间策略\"</span>&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\"># + 禁止全部驱动器自动播放</span></span><br><span class=\"line\">  DisableAutoplay  = @&#123;reg=<span class=\"string\">\"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\"</span>;name=<span class=\"string\">\"DisableAutoplay\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"禁止全部驱动器自动播放\"</span>&#125;</span><br><span class=\"line\">  NoDriveTypeAutoRun = @&#123;reg=<span class=\"string\">\"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\"</span>;name=<span class=\"string\">\"NoDriveTypeAutoRun\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">255</span>;msg=<span class=\"string\">\"禁止全部驱动器自动播放\"</span>&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\"># + 限制IPC共享(禁止SAM帐户和共享的匿名枚举)</span></span><br><span class=\"line\">  restrictanonymous = @&#123;reg=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\"</span>;name=<span class=\"string\">\"restrictanonymous\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"不允许SAM账户和共享的匿名枚举值为(启用)\"</span>&#125;</span><br><span class=\"line\">  restrictanonymoussam = @&#123;reg=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\"</span>;name=<span class=\"string\">\"restrictanonymoussam\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"不允许SAM账户的匿名枚举值为(启用)\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># + 禁用磁盘共享(SMB服务)</span></span><br><span class=\"line\">  SMBDeviceEnabled = @&#123;reg=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\NetBT\\Parameters\"</span>;name=<span class=\"string\">\"SMBDeviceEnabled\"</span>;regtype=<span class=\"string\">\"QWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">0</span>;msg=<span class=\"string\">\"关闭禁用SMB共享服务\"</span>&#125;</span><br><span class=\"line\">  AutoShareWks = @&#123;reg=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\lanmanserver\\parameters\"</span>;name=<span class=\"string\">\"AutoShareWks\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">0</span>;msg=<span class=\"string\">\"关闭禁用默认共享策略-Server2012\"</span>&#125;</span><br><span class=\"line\">  AutoShareServer = @&#123;reg=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\lanmanserver\\parameters\"</span>;name=<span class=\"string\">\"AutoShareServer\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">0</span>;msg=<span class=\"string\">\"关闭禁用默认共享策略-Server2012\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># + 系统、应用、安全、PS日志查看器大小(单位字节)设置(此处设置默认的两倍配置-建议一定通过日志采集平台采集系统日志比如ELK)</span></span><br><span class=\"line\">  EventlogSystemMaxSize = @&#123;reg=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Eventlog\\System\"</span>;name=<span class=\"string\">\"MaxSize\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">41943040</span>;msg=<span class=\"string\">\"系统基日志配核查-系统日志查看器大小设置策略\"</span>&#125;</span><br><span class=\"line\">  EventlogApplicationMaxSize = @&#123;reg=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Eventlog\\Application\"</span>;name=<span class=\"string\">\"MaxSize\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">41943040</span>;msg=<span class=\"string\">\"系统日志基配核查-应用日志查看器大小设置策略\"</span>&#125;</span><br><span class=\"line\">  EventlogSecurityMaxSize = @&#123;reg=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Eventlog\\Security\"</span>;name=<span class=\"string\">\"MaxSize\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">41943040</span>;msg=<span class=\"string\">\"系统日志基配核查-安全日志查看器大小设置策略\"</span>&#125;</span><br><span class=\"line\">  EventlogPSMaxSize = @&#123;reg=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Eventlog\\Windows PowerShell\"</span>;name=<span class=\"string\">\"MaxSize\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"ge\"</span>;value=<span class=\"number\">31457280</span>;msg=<span class=\"string\">\"系统日志基配核查-PS日志查看器大小设置策略\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># + 远程桌面开启与关闭</span></span><br><span class=\"line\">  fDenyTSConnections = @&#123;reg=<span class=\"string\">'HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\\Terminal Server'</span>;name=<span class=\"string\">'fDenyTSConnections'</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">0</span>;msg=<span class=\"string\">\"是否禁用远程桌面服务-1则为禁用\"</span>&#125;</span><br><span class=\"line\">  UserAuthentication = @&#123;reg=<span class=\"string\">'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp'</span>;name=<span class=\"string\">'UserAuthentication '</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"只允许运行带网络级身份验证的远程桌面的计算机连接\"</span>&#125;</span><br><span class=\"line\">  RDPTcpPortNumber = @&#123;reg=<span class=\"string\">'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp'</span>;name=<span class=\"string\">'PortNumber'</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">39393</span>;msg=<span class=\"string\">\"远程桌面服务端口RDP-Tcp非3389\"</span>&#125;</span><br><span class=\"line\">  TDSTcpPortNumber = @&#123;reg=<span class=\"string\">'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\Wds\\rdpwd\\Tds\\tcp'</span>;name=<span class=\"string\">'PortNumber'</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">39393</span>;msg=<span class=\"string\">\"远程桌面服务端口TDS-Tcp非3389\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># + 防火墙相关操作设置（开启、协议、服务）</span></span><br><span class=\"line\">  DomainEnableFirewall  = @&#123;reg=<span class=\"string\">'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\DomainProfile'</span>;name=<span class=\"string\">'EnableFirewall'</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"开启域网络防火墙\"</span>&#125;</span><br><span class=\"line\">  StandardEnableFirewall = @&#123;reg=<span class=\"string\">'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\SharedAccess\\Parameters\\FirewallPolicy\\StandardProfile'</span>;name=<span class=\"string\">'EnableFirewall'</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"开启专用网络防火墙\"</span>&#125;</span><br><span class=\"line\">  PPEnableFirewall = @&#123;reg=<span class=\"string\">'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\SharedAccess\\Parameters\\FirewallPolicy\\PublicProfile'</span>;name=<span class=\"string\">'EnableFirewall'</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"开启公用网络防火墙\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># + 源路由欺骗保护</span></span><br><span class=\"line\">  DisableIPSourceRouting = @&#123;reg=<span class=\"string\">'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\Tcpip\\Parameters'</span>;name=<span class=\"string\">'DisableIPSourceRouting'</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">2</span>;msg=<span class=\"string\">\"源路由欺骗保护\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># + 碎片攻击保护</span></span><br><span class=\"line\">  EnablePMTUDiscovery = @&#123;reg=<span class=\"string\">'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\Tcpip\\Parameters'</span>;name=<span class=\"string\">'EnablePMTUDiscovery'</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"碎片攻击保护\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 【TCP/IP 协议栈的调整可能会引起某些功能的受限，管理员应该在进行充分了解和测试的前提下进行此项工作】</span></span><br><span class=\"line\">  <span class=\"comment\"># + 防SYN洪水攻击: </span></span><br><span class=\"line\">  <span class=\"comment\"># SynAttackProtect = @&#123;reg='HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters';name='EnablePMTUDiscovery';regtype=\"DWord\";operator=\"eq\";value=1;msg=\"设置防syn洪水攻击\"&#125;</span></span><br><span class=\"line\">  <span class=\"comment\"># TcpMaxHalfOpen = @&#123;reg='HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters';name='TcpMaxHalfOpen';regtype=\"DWord\";operator=\"eq\";value=500;msg=\"允许的最大半开连接数\"&#125;</span></span><br><span class=\"line\">  <span class=\"comment\"># TcpMaxHalfOpenRetried = @&#123;reg='HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters';name='TcpMaxHalfOpenRetried';regtype=\"DWord\";operator=\"eq\";value=400;msg=\"处于至少已发送一次重传的 SYN_RCVD 状态中的TCP连接数\"&#125;</span></span><br><span class=\"line\">  <span class=\"comment\"># + 防止DDOS攻击保护 </span></span><br><span class=\"line\">  <span class=\"comment\"># EnableICMPRedirect = @&#123;reg='HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\Tcpip\\Parameters';name='EnableICMPRedirect';regtype=\"DWord\";operator=\"eq\";value=0;msg=\"防止DDOS攻击保护,不启用 ICMP 重定向\"&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># + 启用并正确配置WSUS（自定义WSUS地址）启用 (一般中大企业都会有自己的WSUS补丁服务器)，你需要将下述http://wsus.weiyigeek.top改为企业中自建的地址</span></span><br><span class=\"line\">  <span class=\"comment\"># 启用策略组“配置自动更新”</span></span><br><span class=\"line\">  AUOptions = @&#123;reg=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\"</span>;name=<span class=\"string\">\"AUOptions\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">3</span>;msg=<span class=\"string\">\"自动下载并计划安装(4)-建议设置3自动下载并通知安装\"</span>&#125;</span><br><span class=\"line\">  AutomaticMaintenanceEnabled = @&#123;reg=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\"</span>;name=<span class=\"string\">\"AutomaticMaintenanceEnabled\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"启用自动维护\"</span>&#125;</span><br><span class=\"line\">  NoAutoUpdate = @&#123;reg=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\"</span>;name=<span class=\"string\">\"NoAutoUpdate\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">0</span>;msg=<span class=\"string\">\"关闭无自动更新设置\"</span>&#125;</span><br><span class=\"line\">  ScheduledInstallDay = @&#123;reg=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\"</span>;name=<span class=\"string\">\"ScheduledInstallDay\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">7</span>;msg=<span class=\"string\">\"计划安装日期为每周六\"</span>&#125;</span><br><span class=\"line\">  ScheduledInstallTime = @&#123;reg=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\"</span>;name=<span class=\"string\">\"ScheduledInstallTime\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"计划安装时间为凌晨1点\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># 启用策略组（指定Intranet Microsoft更新服务位置）</span></span><br><span class=\"line\">  UseWUServer = @&#123;reg=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU\"</span>;name=<span class=\"string\">\"UseWUServer\"</span>;regtype=<span class=\"string\">\"DWord\"</span>;operator=<span class=\"string\">\"eq\"</span>;value=<span class=\"number\">1</span>;msg=<span class=\"string\">\"指定Intranet Microsoft更新服务补丁服务器\"</span>&#125;</span><br><span class=\"line\">  WUServer = @&#123;reg=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\"</span>;name=<span class=\"string\">\"WUServer\"</span>;regtype=<span class=\"string\">\"String\"</span>;value=<span class=\"string\">\"<span class=\"variable\">$WUSUServer</span>\"</span>;operator=<span class=\"string\">\"eq\"</span>;msg=<span class=\"string\">\"设置检测更新的intranet更新服务\"</span>&#125;</span><br><span class=\"line\">  WUStatusServer = @&#123;reg=<span class=\"string\">\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\"</span>;name=<span class=\"string\">\"WUStatusServer\"</span>;regtype=<span class=\"string\">\"String\"</span>;value=<span class=\"string\">\"<span class=\"variable\">$WUSUServer</span>\"</span>;operator=<span class=\"string\">\"eq\"</span>;msg=<span class=\"string\">\"设置Intranet统计服务器\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># UpdateServiceUrlAlternate = @&#123;reg=\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\";name=\"UpdateServiceUrlAlternate\";regtype=\"String\";value=\"http://wsus.weiyigeek.top\";operator=\"eq\";msg=\"设置备用下载服务器\"&#125;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">################################################################################################################################</span></span><br><span class=\"line\"><span class=\"comment\"># **********************#</span></span><br><span class=\"line\"><span class=\"comment\"># * 全局公用工具依赖函数  *  </span></span><br><span class=\"line\"><span class=\"comment\"># **********************#</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> F_Logging &#123;</span><br><span class=\"line\"><span class=\"comment\">&lt;#</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.SYNOPSIS</span></span></span><br><span class=\"line\"><span class=\"comment\">F_Logging 函数全局工具</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\">用于输出脚本执行结果并按照不同的日志等级输出显示到客户终端上。</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.EXAMPLE</span></span></span><br><span class=\"line\"><span class=\"comment\">F_Logging -Level [Info|Warning|Error] -Msg \"测试输出字符串\"</span></span><br><span class=\"line\"><span class=\"comment\">#&gt;</span></span><br><span class=\"line\">  <span class=\"keyword\">param</span> (</span><br><span class=\"line\">    [Parameter(Mandatory=<span class=\"literal\">$true</span>)]<span class=\"variable\">$Msg</span>,</span><br><span class=\"line\">    [ValidateSet(<span class=\"string\">\"Info\"</span>,<span class=\"string\">\"Warning\"</span>,<span class=\"string\">\"Error\"</span>)]<span class=\"variable\">$Level</span></span><br><span class=\"line\">  )</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (<span class=\"variable\">$Level</span>) &#123;</span><br><span class=\"line\">    Info &#123; </span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"[INFO] $&#123;Msg&#125;\"</span> -ForegroundColor Green;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Warning &#123;</span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"[WARN] $&#123;Msg&#125;\"</span> -ForegroundColor Yellow;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Error &#123; </span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"[ERROR] $&#123;Msg&#125;\"</span> -ForegroundColor Red;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Default &#123;</span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"[*] F_Logging 日志 Level 等级错误`n Useage： F_Logging -Level [Info|Warning|Error] -Msg '测试输出字符串'\"</span> -ForegroundColor Red;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">Function</span> F_IsCurrentUserAdmin</span><br><span class=\"line\">&#123; </span><br><span class=\"line\"><span class=\"comment\">&lt;#</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.SYNOPSIS</span></span></span><br><span class=\"line\"><span class=\"comment\">F_IsCurrentUserAdmin 函数：全局公用工具依赖。</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\">判断当前运行的powershell终端是否管理员执行,返回值 true 或者 false</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.EXAMPLE</span></span></span><br><span class=\"line\"><span class=\"comment\">F_IsCurrentUserAdmin</span></span><br><span class=\"line\"><span class=\"comment\">#&gt;</span></span><br><span class=\"line\">  <span class=\"variable\">$user</span> = [Security.Principal.WindowsIdentity]::GetCurrent(); </span><br><span class=\"line\">  (<span class=\"built_in\">New-Object</span> Security.Principal.WindowsPrincipal <span class=\"variable\">$user</span>).IsInRole([Security.Principal.WindowsBuiltinRole]::Administrator) </span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> F_Detection &#123;</span><br><span class=\"line\"><span class=\"comment\">&lt;#</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.SYNOPSIS</span></span></span><br><span class=\"line\"><span class=\"comment\">F_Detection 函数: 全局公用工具依赖。</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\">函数用于检测 config.cfg 关键项是否匹配并返回相应的结果，返回值 1 或者 0。</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.EXAMPLE</span></span></span><br><span class=\"line\"><span class=\"comment\">F_Detection -Value $Value -Operator $Operator -DefaultValue $DefaultValue</span></span><br><span class=\"line\"><span class=\"comment\">#&gt;</span></span><br><span class=\"line\">  <span class=\"keyword\">param</span> (</span><br><span class=\"line\">    [Parameter(Mandatory=<span class=\"literal\">$true</span>)]<span class=\"variable\">$Value</span>,</span><br><span class=\"line\">    [Parameter(Mandatory=<span class=\"literal\">$true</span>)]<span class=\"variable\">$Operator</span>,</span><br><span class=\"line\">    [Parameter(Mandatory=<span class=\"literal\">$true</span>)]<span class=\"variable\">$DefaultValue</span>  </span><br><span class=\"line\">  )</span><br><span class=\"line\">  <span class=\"keyword\">if</span> ( <span class=\"variable\">$Operator</span> <span class=\"nomarkup\">-eq</span> <span class=\"string\">\"eq\"</span> ) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"variable\">$Value</span> <span class=\"nomarkup\">-eq</span> <span class=\"string\">\"<span class=\"variable\">$DefaultValue</span>\"</span> ) &#123;<span class=\"keyword\">return</span> <span class=\"number\">1</span>;&#125; <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> <span class=\"number\">0</span>;&#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">elseif</span> (<span class=\"variable\">$Operator</span> <span class=\"nomarkup\">-eq</span>  <span class=\"string\">\"ne\"</span> ) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"variable\">$Value</span> <span class=\"nomarkup\">-ne</span> <span class=\"variable\">$DefaultValue</span> ) &#123;<span class=\"keyword\">return</span> <span class=\"number\">1</span>;&#125; <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> <span class=\"number\">0</span>;&#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">elseif</span> (<span class=\"variable\">$Operator</span> <span class=\"nomarkup\">-eq</span>  <span class=\"string\">\"le\"</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"variable\">$Value</span> <span class=\"nomarkup\">-le</span> <span class=\"variable\">$DefaultValue</span> ) &#123;<span class=\"keyword\">return</span> <span class=\"number\">1</span>;&#125; <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> <span class=\"number\">0</span>;&#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">elseif</span> (<span class=\"variable\">$Operator</span> <span class=\"nomarkup\">-eq</span> <span class=\"string\">\"ge\"</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"variable\">$Value</span> <span class=\"nomarkup\">-ge</span> <span class=\"variable\">$DefaultValue</span> ) &#123;<span class=\"keyword\">return</span> <span class=\"number\">1</span>;&#125; <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> <span class=\"number\">0</span>;&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> F_GetRegPropertyValue &#123;</span><br><span class=\"line\"><span class=\"comment\">&lt;#</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.SYNOPSIS</span></span></span><br><span class=\"line\"><span class=\"comment\">F_GetRegPropertyValue 函数: 全局公用工具依赖函数。</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\">函数用于获取指定键与值并与预定义的进行对比，正常返回结果为1或者0，如果键不存在则返回NotExist。</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.EXAMPLE</span></span></span><br><span class=\"line\"><span class=\"comment\">An example</span></span><br><span class=\"line\"><span class=\"comment\">#&gt;</span></span><br><span class=\"line\">  <span class=\"keyword\">param</span> (</span><br><span class=\"line\">    [Parameter(Mandatory=<span class=\"literal\">$true</span>)][String]<span class=\"variable\">$Key</span>,</span><br><span class=\"line\">    [Parameter(Mandatory=<span class=\"literal\">$true</span>)][String]<span class=\"variable\">$Name</span>,</span><br><span class=\"line\">    [Parameter(Mandatory=<span class=\"literal\">$true</span>)][String]<span class=\"variable\">$Operator</span>,</span><br><span class=\"line\">    [Parameter(Mandatory=<span class=\"literal\">$true</span>)]<span class=\"variable\">$DefaultValue</span></span><br><span class=\"line\">  )</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$Value</span> = Get-ItemPropertyValue -Path <span class=\"string\">\"Registry::<span class=\"variable\">$Key</span>\"</span> -Name <span class=\"variable\">$Name</span> -ErrorAction Ignore -WarningAction Ignore </span><br><span class=\"line\">    <span class=\"variable\">$Result</span> = F_Detection -Value <span class=\"variable\">$Value</span> -Operator <span class=\"variable\">$Operator</span> -DefaultValue <span class=\"variable\">$DefaultValue</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable\">$Result</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> &#123;</span><br><span class=\"line\">    F_Logging -Level Warning -Msg <span class=\"string\">\"[*] <span class=\"variable\">$Key</span> - <span class=\"variable\">$Name</span> - NotExist\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">'NotExist'</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> F_SeceditReinforce() &#123;</span><br><span class=\"line\"><span class=\"comment\">&lt;#</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.SYNOPSIS</span></span></span><br><span class=\"line\"><span class=\"comment\">F_SeceditReinforce 函数：实现系统策略组配置项对比和修改。</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\">针对 config.cfg 安全配置项进行检测并修改，主要涉及系统账号策略设置、系统事件审核策略设置、系统组策略安全选项配置、操作系统组用户权限管理策略配置</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.EXAMPLE</span></span></span><br><span class=\"line\"><span class=\"comment\">F_SeceditReinforce</span></span><br><span class=\"line\"><span class=\"comment\">#&gt;</span></span><br><span class=\"line\">  <span class=\"comment\"># - 系统账号策略设置</span></span><br><span class=\"line\">  <span class=\"variable\">$Hash</span> = <span class=\"variable\">$SysAccountPolicy</span>.Clone()</span><br><span class=\"line\">  <span class=\"keyword\">foreach</span> ( <span class=\"variable\">$Name</span> <span class=\"keyword\">in</span> <span class=\"variable\">$Hash</span>.keys ) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$Flag</span> = <span class=\"variable\">$Config</span> | <span class=\"built_in\">Select-String</span> -AllMatches -Pattern <span class=\"string\">\"^$(<span class=\"variable\">$Name</span>.toString())\"</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$Flag</span>) &#123;</span><br><span class=\"line\">      F_Logging -Level Info -Msg <span class=\"string\">\"[*] Update - <span class=\"variable\">$Name</span>\"</span></span><br><span class=\"line\">      <span class=\"variable\">$Line</span> = <span class=\"variable\">$Flag</span> -split <span class=\"string\">\" = \"</span></span><br><span class=\"line\">      <span class=\"variable\">$Result</span> = F_Detection -Value <span class=\"variable\">$Line</span>[<span class=\"number\">1</span>] -Operator <span class=\"variable\">$SysAccountPolicy</span>[<span class=\"string\">\"$(<span class=\"variable\">$Line</span>[0])\"</span>].operator -DefaultValue <span class=\"variable\">$SysAccountPolicy</span>[<span class=\"string\">\"$(<span class=\"variable\">$Line</span>[0])\"</span>].value</span><br><span class=\"line\">      <span class=\"variable\">$NewLine</span> = <span class=\"variable\">$Line</span>[<span class=\"number\">0</span>] + <span class=\"string\">\" = \"</span> + <span class=\"variable\">$SysAccountPolicy</span>[<span class=\"string\">\"$(<span class=\"variable\">$Line</span>[0])\"</span>].value</span><br><span class=\"line\">      <span class=\"comment\"># - 在不匹配时进行关键项替换配置</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( <span class=\"nomarkup\">-not</span>(<span class=\"variable\">$Result</span>) -or <span class=\"variable\">$Line</span>[<span class=\"number\">0</span>] <span class=\"nomarkup\">-eq</span> <span class=\"string\">\"NewGuestName\"</span> -or <span class=\"variable\">$Line</span>[<span class=\"number\">0</span>] <span class=\"nomarkup\">-eq</span> <span class=\"string\">\"NewAdministratorName\"</span> ) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">write-host</span> <span class=\"string\">\"    <span class=\"variable\">$Flag</span> --&gt;&gt; <span class=\"variable\">$NewLine</span>\"</span></span><br><span class=\"line\">        <span class=\"comment\"># 此处采用正则进行匹配系统账号策略相关项,防止后续</span></span><br><span class=\"line\">        <span class=\"variable\">$SecConfig</span> = <span class=\"variable\">$SecConfig</span> <span class=\"nomarkup\">-replace</span> <span class=\"string\">\"<span class=\"variable\">$Flag</span>\"</span>, <span class=\"string\">\"<span class=\"variable\">$NewLine</span>\"</span> </span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      F_Logging -Level Info -Msg <span class=\"string\">\"[+] Insert - <span class=\"variable\">$Name</span>\"</span></span><br><span class=\"line\">      <span class=\"variable\">$NewLine</span> = <span class=\"variable\">$Name</span> + <span class=\"string\">\" = \"</span> + <span class=\"variable\">$SysAccountPolicy</span>[<span class=\"string\">\"<span class=\"variable\">$Name</span>\"</span>].value</span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"    <span class=\"variable\">$NewLine</span> \"</span></span><br><span class=\"line\">      <span class=\"comment\"># - 在不存在该配置项时进行插入</span></span><br><span class=\"line\">      <span class=\"variable\">$SecConfig</span> = <span class=\"variable\">$SecConfig</span> <span class=\"nomarkup\">-replace</span> <span class=\"string\">\"\\[System Access\\]\"</span>, <span class=\"string\">\"[System Access]`n<span class=\"variable\">$NewLine</span>\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># - 系统事件审核策略设置</span></span><br><span class=\"line\">  <span class=\"variable\">$Hash</span> = <span class=\"variable\">$SysEventAuditPolicy</span>.Clone()</span><br><span class=\"line\">  <span class=\"keyword\">foreach</span> ( <span class=\"variable\">$Name</span> <span class=\"keyword\">in</span> <span class=\"variable\">$Hash</span>.keys ) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$Flag</span> = <span class=\"variable\">$Config</span> | <span class=\"built_in\">Select-String</span> <span class=\"variable\">$Name</span>.toString()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$Flag</span>) &#123;</span><br><span class=\"line\">      F_Logging -Level Info -Msg <span class=\"string\">\"[*] Update - <span class=\"variable\">$Name</span>\"</span></span><br><span class=\"line\">      <span class=\"variable\">$Line</span> = <span class=\"variable\">$Flag</span> -split <span class=\"string\">\" = \"</span></span><br><span class=\"line\">      <span class=\"variable\">$Result</span> = F_Detection -Value <span class=\"variable\">$Line</span>[<span class=\"number\">1</span>] -Operator <span class=\"variable\">$SysEventAuditPolicy</span>[<span class=\"string\">\"$(<span class=\"variable\">$Line</span>[0])\"</span>].operator -DefaultValue <span class=\"variable\">$SysEventAuditPolicy</span>[<span class=\"string\">\"$(<span class=\"variable\">$Line</span>[0])\"</span>].value</span><br><span class=\"line\">      <span class=\"variable\">$NewLine</span> = <span class=\"variable\">$Line</span>[<span class=\"number\">0</span>] + <span class=\"string\">\" = \"</span> + <span class=\"variable\">$SysEventAuditPolicy</span>[<span class=\"string\">\"$(<span class=\"variable\">$Line</span>[0])\"</span>].value</span><br><span class=\"line\">      <span class=\"comment\"># - 在不匹配时进行关键项替换配置</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"nomarkup\">-not</span>(<span class=\"variable\">$Result</span>)) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$SecConfig</span> = <span class=\"variable\">$SecConfig</span> <span class=\"nomarkup\">-replace</span> <span class=\"string\">\"<span class=\"variable\">$Flag</span>\"</span>, <span class=\"string\">\"<span class=\"variable\">$NewLine</span>\"</span> </span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      F_Logging -Level Info -Msg <span class=\"string\">\"[+] Insert - <span class=\"variable\">$Name</span>\"</span></span><br><span class=\"line\">      <span class=\"variable\">$NewLine</span> = <span class=\"variable\">$Name</span> + <span class=\"string\">\" = \"</span> + <span class=\"variable\">$SysEventAuditPolicy</span>[<span class=\"string\">\"<span class=\"variable\">$Name</span>\"</span>].value</span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"  <span class=\"variable\">$NewLine</span>\"</span></span><br><span class=\"line\">      <span class=\"comment\"># - 在不存在该配置项时进行插入</span></span><br><span class=\"line\">      <span class=\"variable\">$SecConfig</span> = <span class=\"variable\">$SecConfig</span> <span class=\"nomarkup\">-replace</span> <span class=\"string\">\"\\[Event Audit\\]\"</span>, <span class=\"string\">\"[Event Audit] `n<span class=\"variable\">$NewLine</span>\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># - 系统组策略安全选项配置 - #</span></span><br><span class=\"line\">  <span class=\"variable\">$Hash</span> = <span class=\"variable\">$SysSecurityOptionPolicy</span>.Clone()</span><br><span class=\"line\">  <span class=\"keyword\">foreach</span> ( <span class=\"variable\">$Name</span> <span class=\"keyword\">in</span> <span class=\"variable\">$Hash</span>.keys ) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$Flag</span> = <span class=\"variable\">$Config</span> | <span class=\"built_in\">Select-String</span> <span class=\"variable\">$Name</span>.toString()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$Flag</span>) &#123;</span><br><span class=\"line\">      F_Logging -Level Info -Msg <span class=\"string\">\"[*] Update - <span class=\"variable\">$Name</span>\"</span></span><br><span class=\"line\">      <span class=\"comment\"># 源字符串</span></span><br><span class=\"line\">      <span class=\"variable\">$Line</span> = <span class=\"variable\">$Flag</span> -split <span class=\"string\">\"=\"</span></span><br><span class=\"line\">      <span class=\"comment\"># 目标字符串</span></span><br><span class=\"line\">      <span class=\"variable\">$Value</span> = <span class=\"variable\">$SysSecurityOptionPolicy</span>[<span class=\"string\">\"$(<span class=\"variable\">$Name</span>)\"</span>].value -split <span class=\"string\">\"=\"</span></span><br><span class=\"line\">      <span class=\"variable\">$Result</span> = F_Detection -Value <span class=\"variable\">$Line</span>[<span class=\"number\">1</span>] -Operator <span class=\"variable\">$SysSecurityOptionPolicy</span>[<span class=\"string\">\"$(<span class=\"variable\">$Name</span>)\"</span>].operator -DefaultValue <span class=\"variable\">$Value</span>[<span class=\"number\">1</span>] </span><br><span class=\"line\">      <span class=\"variable\">$NewLine</span> = <span class=\"variable\">$Line</span>[<span class=\"number\">0</span>] + <span class=\"string\">\"=\"</span> + <span class=\"variable\">$Value</span>[<span class=\"number\">1</span>]</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"nomarkup\">-not</span>(<span class=\"variable\">$Result</span>)) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$SecConfig</span> = <span class=\"variable\">$SecConfig</span> <span class=\"nomarkup\">-Replace</span> ([Regex]::Escape(<span class=\"string\">\"<span class=\"variable\">$Flag</span>\"</span>)),<span class=\"string\">\"<span class=\"variable\">$NewLine</span>\"</span> </span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      F_Logging -Level Info -Msg <span class=\"string\">\"[+] Insert - <span class=\"variable\">$Name</span>\"</span></span><br><span class=\"line\">      <span class=\"variable\">$NewLine</span> = <span class=\"variable\">$SysSecurityOptionPolicy</span>[<span class=\"string\">\"<span class=\"variable\">$Name</span>\"</span>].value</span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"   <span class=\"variable\">$NewLine</span>\"</span></span><br><span class=\"line\">      <span class=\"comment\"># 不采用正则匹配原字符串(值得学习)</span></span><br><span class=\"line\">      <span class=\"variable\">$SecConfig</span> = <span class=\"variable\">$SecConfig</span> <span class=\"nomarkup\">-Replace</span> ([Regex]::Escape(<span class=\"string\">\"[Registry Values]\"</span>)),<span class=\"string\">\"[Registry Values]`n<span class=\"variable\">$NewLine</span>\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># - 操作系统组用户权限管理策略配置</span></span><br><span class=\"line\">  <span class=\"variable\">$Hash</span> = <span class=\"variable\">$SysUserPrivilegePolicy</span>.Clone()</span><br><span class=\"line\">  <span class=\"keyword\">foreach</span> ( <span class=\"variable\">$Name</span> <span class=\"keyword\">in</span> <span class=\"variable\">$Hash</span>.keys ) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$Flag</span> = <span class=\"variable\">$Config</span> | <span class=\"built_in\">Select-String</span> <span class=\"variable\">$Name</span>.toString()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$Flag</span>) &#123;</span><br><span class=\"line\">      F_Logging -Level Info -Msg <span class=\"string\">\"[*] Update - <span class=\"variable\">$Name</span>\"</span></span><br><span class=\"line\">      <span class=\"variable\">$Line</span> = <span class=\"variable\">$Flag</span> -split <span class=\"string\">\" = \"</span></span><br><span class=\"line\">      <span class=\"variable\">$Result</span> = F_Detection -Value <span class=\"variable\">$Line</span>[<span class=\"number\">1</span>] -Operator <span class=\"variable\">$SysUserPrivilegePolicy</span>[<span class=\"string\">\"$(<span class=\"variable\">$Line</span>[0])\"</span>].operator -DefaultValue <span class=\"variable\">$SysUserPrivilegePolicy</span>[<span class=\"string\">\"$(<span class=\"variable\">$Line</span>[0])\"</span>].value</span><br><span class=\"line\">      <span class=\"variable\">$NewLine</span> = <span class=\"variable\">$Line</span>[<span class=\"number\">0</span>] + <span class=\"string\">\" = \"</span> + <span class=\"variable\">$SysUserPrivilegePolicy</span>[<span class=\"string\">\"$(<span class=\"variable\">$Line</span>[0])\"</span>].value</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"nomarkup\">-not</span>(<span class=\"variable\">$Result</span>)) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$SecConfig</span> = <span class=\"variable\">$SecConfig</span> <span class=\"nomarkup\">-Replace</span> ([Regex]::Escape(<span class=\"string\">\"<span class=\"variable\">$Flag</span>\"</span>)), <span class=\"string\">\"<span class=\"variable\">$NewLine</span>\"</span> </span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      F_Logging -Level Info -Msg <span class=\"string\">\"[+] Insert - <span class=\"variable\">$Name</span>\"</span></span><br><span class=\"line\">      <span class=\"variable\">$NewLine</span> = <span class=\"variable\">$Name</span> + <span class=\"string\">\" = \"</span> + <span class=\"variable\">$SysUserPrivilegePolicy</span>[<span class=\"string\">\"<span class=\"variable\">$Name</span>\"</span>].value</span><br><span class=\"line\">      <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"    <span class=\"variable\">$NewLine</span>\"</span></span><br><span class=\"line\">      <span class=\"variable\">$SecConfig</span> = <span class=\"variable\">$SecConfig</span> <span class=\"nomarkup\">-Replace</span> ([Regex]::Escape(<span class=\"string\">\"[Privilege Rights]\"</span>)),<span class=\"string\">\"[Privilege Rights]`n<span class=\"variable\">$NewLine</span>\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">   <span class=\"comment\"># 将生成的本地安全组策略配置输到`secconfig.cfg`,【坑】非常注意文件编码格式为UTF16-LE,此时需要添加-Encoding参数并指定为string</span></span><br><span class=\"line\">   <span class=\"variable\">$SecConfig</span> | <span class=\"built_in\">Out-File</span> secconfig.cfg -Encoding string</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> F_SysRegistryReinforce()  &#123;</span><br><span class=\"line\"><span class=\"comment\">&lt;#</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.SYNOPSIS</span></span></span><br><span class=\"line\"><span class=\"comment\">F_SysRegistryReinforce 函数针对于注册表中系统相关配置。</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\">针对操作系统注册表安全配置项与SysRegistryPolicy哈希表的键值进行检测与设置。</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.EXAMPLE</span></span></span><br><span class=\"line\"><span class=\"comment\">F_SysRegistryReinforce </span></span><br><span class=\"line\"><span class=\"comment\">#&gt;</span></span><br><span class=\"line\">  <span class=\"comment\"># - 满足等级保护相关基础配置</span></span><br><span class=\"line\">  <span class=\"variable\">$Hash</span> = <span class=\"variable\">$SysRegistryPolicy</span>.Clone()</span><br><span class=\"line\">  <span class=\"keyword\">foreach</span> ( <span class=\"variable\">$Name</span> <span class=\"keyword\">in</span> <span class=\"variable\">$Hash</span>.keys ) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$Result</span> = F_GetRegPropertyValue -Key <span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$Name</span>.reg -Name <span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$Name</span>.name -Operator <span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$Name</span>.operator -DefaultValue <span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$Name</span>.value</span><br><span class=\"line\">    F_Logging -Level Info -Msg <span class=\"string\">\"Get-ItemProperty -Path Registry::$(<span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$Name</span>.reg)\"</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"variable\">$Result</span> <span class=\"nomarkup\">-eq</span> <span class=\"string\">'NotExist'</span> )&#123;</span><br><span class=\"line\">      <span class=\"comment\"># - 判断注册表项是否存在不存在则创建</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"nomarkup\">-not</span>(<span class=\"built_in\">Test-Path</span> -Path <span class=\"string\">\"Registry::$(<span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$Name</span>.reg)\"</span>))&#123;</span><br><span class=\"line\">        F_Logging -Level Info -Msg <span class=\"string\">\"正在创建 $(<span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$Name</span>.reg) 注册表项......\"</span></span><br><span class=\"line\">        <span class=\"built_in\">New-Item</span> -Path <span class=\"string\">\"registry::$(<span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$Name</span>.reg)\"</span> -Force</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\"># - 可能的枚举值包括\"String、ExpandString、Binary、DWord、MultiString、QWord、Unknown\"</span></span><br><span class=\"line\">      <span class=\"built_in\">New-ItemProperty</span> -Path <span class=\"string\">\"Registry::$(<span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$Name</span>.reg)\"</span> -Name <span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$Name</span>.name -PropertyType <span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$Name</span>.regtype -Value <span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$Name</span>.value</span><br><span class=\"line\">    &#125; <span class=\"keyword\">elseif</span> ( <span class=\"variable\">$Result</span> <span class=\"nomarkup\">-eq</span> <span class=\"number\">0</span> ) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">Set-ItemProperty</span> -Path <span class=\"string\">\"Registry::$(<span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$Name</span>.reg)\"</span> -Name <span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$Name</span>.name -Value <span class=\"variable\">$SysRegistryPolicy</span>.<span class=\"variable\">$Name</span>.value</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> F_ServiceManager() &#123;</span><br><span class=\"line\"><span class=\"comment\">&lt;#</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.SYNOPSIS</span></span></span><br><span class=\"line\"><span class=\"comment\">F_ServiceManager 函数：针对于系统中相关服务管理操作</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\">主要对系统中某些服务进行停止禁用</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.EXAMPLE</span></span></span><br><span class=\"line\"><span class=\"comment\">F_ServiceManager -Name server -Operator restart -StartType Automatic</span></span><br><span class=\"line\"><span class=\"comment\">#&gt;</span></span><br><span class=\"line\">  <span class=\"keyword\">param</span> (</span><br><span class=\"line\">    [Parameter(Mandatory=<span class=\"literal\">$true</span>)]<span class=\"variable\">$Name</span>,</span><br><span class=\"line\">    [ValidateSet(<span class=\"string\">\"Start\"</span>,<span class=\"string\">\"Stop\"</span>,<span class=\"string\">\"Restart\"</span>)]<span class=\"variable\">$Operator</span>,</span><br><span class=\"line\">    [ValidateSet(<span class=\"string\">\"Automatic\"</span>,<span class=\"string\">\"Manual\"</span>,<span class=\"string\">\"Disabled\"</span>,<span class=\"string\">\"Boot\"</span>,<span class=\"string\">\"System\"</span>)]<span class=\"variable\">$StartType</span></span><br><span class=\"line\">  )</span><br><span class=\"line\">  <span class=\"comment\"># - 验证服务是否存在</span></span><br><span class=\"line\">  F_Logging -Level Info -Msg <span class=\"string\">\"正在对 <span class=\"variable\">$Name</span> 服务进行操作管理.......\"</span></span><br><span class=\"line\">  <span class=\"variable\">$ServiceStatus</span> = (<span class=\"built_in\">Get-Service</span> <span class=\"variable\">$Name</span> -ErrorAction SilentlyContinue).Status</span><br><span class=\"line\">  <span class=\"keyword\">if</span>( <span class=\"nomarkup\">-not</span>(<span class=\"variable\">$ServiceStatus</span>.Length) ) &#123;</span><br><span class=\"line\">    F_Logging -Level Error -Msg <span class=\"string\">\"<span class=\"variable\">$Name</span> Service is not exsit with current system!!!!!!\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># - 根据$Operator操作服务启动、停止、重启</span></span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (<span class=\"variable\">$Operator</span>) &#123;</span><br><span class=\"line\">    Start &#123; </span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( <span class=\"string\">\"<span class=\"variable\">$ServiceStatus</span>\"</span> <span class=\"nomarkup\">-eq</span> <span class=\"string\">\"Stopped\"</span> ) &#123;</span><br><span class=\"line\">        F_Logging -Level Info -Msg <span class=\"string\">\"正在启动 <span class=\"variable\">$Name</span> 服务\"</span>;<span class=\"built_in\">Start-Service</span> -Name <span class=\"variable\">$Name</span> -Force</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Stop &#123; </span><br><span class=\"line\">      <span class=\"keyword\">if</span> ( <span class=\"string\">\"<span class=\"variable\">$ServiceStatus</span>\"</span> <span class=\"nomarkup\">-eq</span> <span class=\"string\">\"Running\"</span> ) &#123;</span><br><span class=\"line\">        F_Logging -Level Warning -Msg <span class=\"string\">\"正在停止 <span class=\"variable\">$Name</span> 服务\"</span>;<span class=\"built_in\">Stop-Service</span> -Name <span class=\"variable\">$Name</span> -Force</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Restart &#123;</span><br><span class=\"line\">      F_Logging -Level Warning -Msg <span class=\"string\">\"正在重启 <span class=\"variable\">$Name</span> 服务\"</span>;<span class=\"built_in\">Restart-Service</span> -Name <span class=\"variable\">$Name</span> -Force</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Default &#123; F_Logging -Level Info -Msg <span class=\"string\">\"未对 <span class=\"variable\">$Name</span> 服务做任何操作!\"</span> &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># - 根据$StartType设置服务启动类型</span></span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (<span class=\"variable\">$StartType</span>) &#123;</span><br><span class=\"line\">    Automatic &#123; <span class=\"built_in\">Set-Service</span> -Name <span class=\"variable\">$Name</span> -StartupType Automatic&#125;</span><br><span class=\"line\">    Manual &#123; <span class=\"built_in\">Set-Service</span> -Name <span class=\"variable\">$Name</span> -StartupType Manual &#125;</span><br><span class=\"line\">    Disabled &#123; <span class=\"built_in\">Set-Service</span> -Name <span class=\"variable\">$Name</span> -StartupType Disabled&#125;</span><br><span class=\"line\">    Boot &#123; <span class=\"built_in\">Set-Service</span> -Name <span class=\"variable\">$Name</span> -StartupType Boot&#125;</span><br><span class=\"line\">    System &#123;<span class=\"built_in\">Set-Service</span> -Name <span class=\"variable\">$Name</span> -StartupType System &#125;</span><br><span class=\"line\">    Default &#123;F_Logging -Level Info -Msg <span class=\"string\">\"未对 <span class=\"variable\">$Name</span> 服务做任何自启配置操作!\"</span>&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">Function</span> F_ExtentionReinforce() &#123;</span><br><span class=\"line\"><span class=\"comment\">&lt;#</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.SYNOPSIS</span></span></span><br><span class=\"line\"><span class=\"comment\">F_ExtentionReinforce 函数：针对于系统暂无办法通过注册表以及组策略配置的将在此处执行。</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\">执行系统加固的相关命令，其中保护PowerShell或者cmd相关命令</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.EXAMPLE</span></span></span><br><span class=\"line\"><span class=\"comment\">F_ExtentionReinforce </span></span><br><span class=\"line\"><span class=\"comment\">#&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># [+] 禁用135、139端口(暂无查询到利用命令进行关闭，后续有知道的小伙伴 Issue 哟)</span></span><br><span class=\"line\">  <span class=\"comment\"># 135 -&gt; dcomcnfg -&gt; 组件服务 -&gt; 我的电脑 -&gt; 属性 -&gt; &#123;默认属性，取消启动分布式COM;默认协议，删除面向连接的TCP/IP&#125;</span></span><br><span class=\"line\">  <span class=\"comment\"># HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Ole\\EnableDCOM的值改为“N”</span></span><br><span class=\"line\">  <span class=\"comment\"># HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Rpc\\ClientProtocols 中删除“ncacn_ip_tcp”</span></span><br><span class=\"line\">  <span class=\"comment\"># 139 -&gt; 网络连接 -&gt; 以太网属性 -&gt; TCP/IPV4属性 -&gt; 高级 -&gt; Wins -&gt; &#123;取消启用LMHOSTS、禁用TCP/IP上的NETBIOS&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># [+] 禁用共享服务以及删除当前主机中所有共享,即关闭监听445端口</span></span><br><span class=\"line\">  F_ServiceManager -Name Spooler -Operator Stop -StartType Disabled             <span class=\"comment\"># Print Spooler: 该服务在后台执行打印作业并处理与打印机的交互。</span></span><br><span class=\"line\">  F_ServiceManager -Name LanmanWorkstation -Operator Stop -StartType Disabled   <span class=\"comment\"># Workstation: 使用 SMB 协议创建并维护客户端网络与远程服务器之间的连接。</span></span><br><span class=\"line\">  F_ServiceManager -Name LanmanServer -Operator Stop -StartType Disabled        <span class=\"comment\"># Server: 支持此计算机通过网络的文件、打印、和命名管道共享。</span></span><br><span class=\"line\">  (gwmi -class win32_share).delete()                                            <span class=\"comment\"># 其它方式 (Get-WmiObject -class win32_share).delete()</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># [+] 禁用网络发现服务 Function Discovery Resource Publication ,即关闭监听5357端口</span></span><br><span class=\"line\">  F_ServiceManager -Name FDResPub -Operator Stop -StartType Disabled</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># [+] 禁用Windows远程管理(WinRM)服务 Windows Remote Management (WS-Management) ,即关闭监听5985端口 （注意在安装某些软件时需要启动该服务）</span></span><br><span class=\"line\">  F_ServiceManager -Name WinRM -Operator Stop -StartType Manual</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># [+] 启用操作系统时间同步</span></span><br><span class=\"line\">  F_ServiceManager -Name w32tm -Operator Start -StartType Automatic             <span class=\"comment\"># Windows Time 维护在网络上的所有客户端和服务器的时间和日期同步</span></span><br><span class=\"line\">  w32tm /config /syncfromflags:MANUAL /manualpeerlist:<span class=\"string\">\"192.168.12.254,0x08 192.168.10.254,0x08\"</span> /update</span><br><span class=\"line\">  w32tm /resync /rediscover</span><br><span class=\"line\">  w32tm /query /peers</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># [+] 启用&amp;关闭windows防火墙</span></span><br><span class=\"line\">  <span class=\"comment\"># 关闭防火墙netsh advfirewall set allprofiles state off</span></span><br><span class=\"line\">  netsh advfirewall set allprofiles state on</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># [+] 系统服务防火墙相关规则设置</span></span><br><span class=\"line\">  <span class=\"comment\"># 启用、或者禁用文件和打印机共享(回显请求 - ICMPv4-In) 根据需求而定</span></span><br><span class=\"line\">  <span class=\"comment\"># Enable-NetFirewallRule -Name FPS-ICMP4-ERQ-In</span></span><br><span class=\"line\">  Disable-NetFirewallRule  -Name FPS-ICMP4-ERQ-In</span><br><span class=\"line\">  Get-NetFirewallRule -Name <span class=\"string\">\"CustomSecurity-Remote-Desktop-Port\"</span> -ErrorAction SilentlyContinue</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"nomarkup\">-not</span>($?)) &#123;</span><br><span class=\"line\">    <span class=\"comment\"># 允许其它主机访问 Remote-Desktop-Port 的39393端口。</span></span><br><span class=\"line\">    New-NetFirewallRule -Name <span class=\"string\">\"CustomSecurity-Remote-Desktop-Port\"</span> -DisplayName <span class=\"string\">\"CustomSecurity-Remote-Desktop-Port\"</span> -Description <span class=\"string\">\"CustomSecurity-Remote-Desktop-Port\"</span> -Direction Inbound -LocalPort <span class=\"number\">39393</span> -Protocol TCP -Action Allow -Enabled True</span><br><span class=\"line\">    New-NetFirewallRule -Name <span class=\"string\">\"CustomSecurity-Port\"</span> -DisplayName <span class=\"string\">\"CustomSecurity-Port\"</span> -Description <span class=\"string\">\"CustomSecurity-135-137-138-139-Port\"</span> -Direction Inbound -LocalPort <span class=\"number\">135</span>,<span class=\"number\">137</span>,<span class=\"number\">138</span>,<span class=\"number\">139</span> -Protocol TCP -Action Block -Enabled True</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Function F_SensitiveFile() &#123;</span></span><br><span class=\"line\"><span class=\"comment\"># &lt;#</span></span><br><span class=\"line\"><span class=\"comment\"># <span class=\"doctag\">.SYNOPSIS</span></span></span><br><span class=\"line\"><span class=\"comment\"># F_SensitiveFile 函数：针对于系统中相关服务的敏感文件检测。（后续扩充）</span></span><br><span class=\"line\"><span class=\"comment\"># <span class=\"doctag\">.DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\"># 针对 config.cfg 安全配置项进行检测并修改</span></span><br><span class=\"line\"><span class=\"comment\"># <span class=\"doctag\">.EXAMPLE</span></span></span><br><span class=\"line\"><span class=\"comment\"># F_SensitiveFile </span></span><br><span class=\"line\"><span class=\"comment\"># #&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#   $SensitiveFile = @(\"%systemroot%\\system32\\inetsrv\\iisadmpwd\")</span></span><br><span class=\"line\"><span class=\"comment\">#   if (Test-Path -Path $SensitiveFile[$i]) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#     # 1.删除具有任何文件扩展名的文件</span></span><br><span class=\"line\"><span class=\"comment\">#     Remove-Item C:\\Test\\*.* # == Del C:\\Test\\*.*</span></span><br><span class=\"line\"><span class=\"comment\">#     Remove-Item -Path C:\\Test\\file.txt -Force </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#     # 2.删除特殊条件的文件或者目录</span></span><br><span class=\"line\"><span class=\"comment\">#     Remove-Item -Path C:\\temp\\DeleteMe -Recurse # 递归删除子文件夹中的文件</span></span><br><span class=\"line\"><span class=\"comment\">#     &#125;</span></span><br><span class=\"line\"><span class=\"comment\"># &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> Main &#123;</span><br><span class=\"line\"><span class=\"comment\">&lt;#</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.SYNOPSIS</span></span></span><br><span class=\"line\"><span class=\"comment\">main 函数程序执行入口</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.DESCRIPTION</span></span></span><br><span class=\"line\"><span class=\"comment\">调用上述编写的相关检测加固函数</span></span><br><span class=\"line\"><span class=\"comment\"><span class=\"doctag\">.EXAMPLE</span></span></span><br><span class=\"line\"><span class=\"comment\">main</span></span><br><span class=\"line\"><span class=\"comment\">#&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"#################################################################################\"</span></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"- @Desc: Windows Server 安全配置策略基线加固脚本 [将会在Github上持续更新-star]\"</span></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"- @Author: WeiyiGeek\"</span></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"- @Blog: https://www.weiyigeek.top\"</span></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"- @Github: https://github.com/WeiyiGeek/SecOpsDev/tree/master/OS-操作系统/Windows\"</span></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"#################################################################################`n\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$StartTime</span> = <span class=\"built_in\">Get-date</span> -Format <span class=\"string\">'yyyy-M-d H:m:s'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 1.当前系统策略配置文件导出 (注意必须系统管理员权限运行) </span></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"- 正在检测当前运行的PowerShell终端是否管理员权限...`n\"</span></span><br><span class=\"line\"><span class=\"variable\">$flag</span> = F_IsCurrentUserAdmin</span><br><span class=\"line\"><span class=\"keyword\">if</span> (!(<span class=\"variable\">$flag</span>)) &#123;</span><br><span class=\"line\">  F_Logging -Level Error -Msg <span class=\"string\">\"- 脚本执行发生错误,请使用管理员权限运行该脚本..例如: Start-Process powershell -Verb runAs....`n\"</span></span><br><span class=\"line\">  F_Logging -Level Warning -Msg <span class=\"string\">\"- 正在退出执行该脚本......`n\"</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.导出当前系统策略配置文件后验证文件是否存在以及原始配置文件备份。</span></span><br><span class=\"line\">secedit /export /cfg config.cfg /quiet</span><br><span class=\"line\"><span class=\"built_in\">start-sleep</span> <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> ( <span class=\"nomarkup\">-not</span>(<span class=\"built_in\">Test-Path</span> -Path config.cfg) ) &#123;</span><br><span class=\"line\">  F_Logging -Level Error -Msg <span class=\"string\">\"- 当前系统策略配置文件 config.cfg 不存在,请检查......\"</span></span><br><span class=\"line\">  F_Logging -Level Warning -Msg <span class=\"string\">\"- 正在退出执行该脚本......\"</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123; </span><br><span class=\"line\">  <span class=\"built_in\">Copy-Item</span> -Path config.cfg -Destination config.cfg.bak -Force</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable\">$Config</span> = <span class=\"built_in\">Get-Content</span> -path config.cfg</span><br><span class=\"line\"><span class=\"variable\">$SecConfig</span> = <span class=\"variable\">$Config</span>.Clone()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 6.系统扩展相关配置安全加固 (防止防火墙设置不生效)</span></span><br><span class=\"line\">F_ExtentionReinforce</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.进行系统策略配置安全加固</span></span><br><span class=\"line\">F_SeceditReinforce</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.当系统策略配置安全加固完成后将生成的secconfig.cfg导入进系统策略中。</span></span><br><span class=\"line\">secedit /configure /db secconfig.sdb /cfg secconfig.cfg</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5.进行系统注册表相关配置安全加固</span></span><br><span class=\"line\">F_SysRegistryReinforce</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 7.程序执行完毕</span></span><br><span class=\"line\"><span class=\"variable\">$EndTime</span> = <span class=\"built_in\">Get-date</span> -Format <span class=\"string\">'yyyy-M-d H:m:s'</span></span><br><span class=\"line\">F_Logging -Level Info -Msg <span class=\"string\">\"- 该操作系统安全加固已完毕......`n开始时间：$&#123;StartTime&#125;`n完成时间: $&#123;EndTime&#125;\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Main</span><br></pre></td></tr></table></figure></p>\n<p>至此，Windows 安全基线配置核查和安全加固脚本分享完毕。</p>\n<p><strong>文章来源:</strong><br>原创首发平台地址: <a href=\"https://www.anquanke.com/post/id/259603\" target=\"_blank\" rel=\"noopener\">https://www.anquanke.com/post/id/259603</a><br>博客地址: Linux与Windows服务器操作系统安全防御实践指南 ( <a href=\"https://blog.weiyigeek.top/2020/10-13-585.html\">https://blog.weiyigeek.top/2020/10-13-585.html</a> )</p>\n<hr>\n<h2 id=\"0x02-CentOS7-系统初始化安全加固\"><a href=\"#0x02-CentOS7-系统初始化安全加固\" class=\"headerlink\" title=\"0x02 CentOS7 系统初始化安全加固\"></a>0x02 CentOS7 系统初始化安全加固</h2><p>描述: 适用于企业内部 CentOS7 系列服务器操作系统初始化、系统安全加固脚本，内容包含了，网络初始化设置，软件更新源替换以及内核版本升级 ,时间时区初始化设置 系统安全加固(符合等保三级主机测评项) 安全运维设置 、系统内核参数优化、 常用软件安装等 一系列的操作直接开箱即用, 将跑过该脚本的机器可以克隆成为作为线上生产环境的基线模板。</p>\n<p>原文链接: 完整的Windows与Linux服务器系统安全加固实践和基线检测脚本（等保2.0）( <a href=\"https://mp.weixin.qq.com/s/CDGzTzrAk9vJtbH4BisSlw\" target=\"_blank\" rel=\"noopener\">https://mp.weixin.qq.com/s/CDGzTzrAk9vJtbH4BisSlw</a> )</p>\n<p><strong>CentOS7 安全加固效果</strong><br><figure class=\"image-box\">\n                <img src=\"https://p1.ssl.qhimg.com/t017be4088d023d01ff.png\" alt=\"CentOS7 安全加固效果\" title=\"\" class=\"\">\n                <p>CentOS7 安全加固效果</p>\n            </figure></p>\n<p>项目地址: <a href=\"https://github.com/WeiyiGeek/SecOpsDev/tree/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/CentOS\" target=\"_blank\" rel=\"noopener\">https://github.com/WeiyiGeek/SecOpsDev/tree/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/CentOS</a> </p>\n<p>【<figure class=\"image-box\">\n                <img src=\"https://github.com/WeiyiGeek/SecOpsDev/network\" alt=\"GitHub Repo stars](https://img.shields.io/github/stars/weiyigeek/SecOpsDev?style=social)  [![GitHub forks](https://img.shields.io/github/forks/WeiyiGeek/SecOpsDev?style=social)\" title=\"\" class=\"\">\n                <p>GitHub Repo stars](https://img.shields.io/github/stars/weiyigeek/SecOpsDev?style=social)  [![GitHub forks](https://img.shields.io/github/forks/WeiyiGeek/SecOpsDev?style=social)</p>\n            </figure> 】，欢迎大家 Star 与 Fork 。</p>\n<p><br></p>\n<p><strong>CentOS7 TLS Security Initiate</strong><br>Link: <a href=\"https://github.com/WeiyiGeek/SecOpsDev/blob/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/CentOS/7/CentOS7-InitializeSecurity.sh\" target=\"_blank\" rel=\"noopener\">https://github.com/WeiyiGeek/SecOpsDev/blob/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/CentOS/7/CentOS7-InitializeSecurity.sh</a></p>\n<p>温馨提示: 使用脚本时请按照你的需求调用相应函数即可。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br><span class=\"line\">695</span><br><span class=\"line\">696</span><br><span class=\"line\">697</span><br><span class=\"line\">698</span><br><span class=\"line\">699</span><br><span class=\"line\">700</span><br><span class=\"line\">701</span><br><span class=\"line\">702</span><br><span class=\"line\">703</span><br><span class=\"line\">704</span><br><span class=\"line\">705</span><br><span class=\"line\">706</span><br><span class=\"line\">707</span><br><span class=\"line\">708</span><br><span class=\"line\">709</span><br><span class=\"line\">710</span><br><span class=\"line\">711</span><br><span class=\"line\">712</span><br><span class=\"line\">713</span><br><span class=\"line\">714</span><br><span class=\"line\">715</span><br><span class=\"line\">716</span><br><span class=\"line\">717</span><br><span class=\"line\">718</span><br><span class=\"line\">719</span><br><span class=\"line\">720</span><br><span class=\"line\">721</span><br><span class=\"line\">722</span><br><span class=\"line\">723</span><br><span class=\"line\">724</span><br><span class=\"line\">725</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># @Author: WeiyiGeek</span></span><br><span class=\"line\"><span class=\"comment\"># @Description: CentOS7 TLS Security Initiate</span></span><br><span class=\"line\"><span class=\"comment\"># @Create Time:  2019年5月6日 11:04:42</span></span><br><span class=\"line\"><span class=\"comment\"># @Last Modified time: 2021-11-15 11:06:31</span></span><br><span class=\"line\"><span class=\"comment\"># @E-mail: master@weiyigeek.top</span></span><br><span class=\"line\"><span class=\"comment\"># @Blog: https://www.weiyigeek.top</span></span><br><span class=\"line\"><span class=\"comment\"># @wechat: WeiyiGeeker</span></span><br><span class=\"line\"><span class=\"comment\"># @Github: https://github.com/WeiyiGeek/SecOpsDev/tree/master/OS-操作系统/Linux/</span></span><br><span class=\"line\"><span class=\"comment\"># @Version: 3.3</span></span><br><span class=\"line\"><span class=\"comment\">## ----------------------------------------- ##</span></span><br><span class=\"line\"><span class=\"comment\"># 脚本主要功能说明:</span></span><br><span class=\"line\"><span class=\"comment\"># (1) CentOS7系统初始化操作包括IP地址设置、基础软件包更新以及安装加固。</span></span><br><span class=\"line\"><span class=\"comment\"># (2) CentOS7系统容器以及JDK相关环境安装。</span></span><br><span class=\"line\"><span class=\"comment\"># (3) CentOS7系统中异常错误日志解决。</span></span><br><span class=\"line\"><span class=\"comment\"># (4) CentOS7系统中常规服务安装配置，加入数据备份目录。</span></span><br><span class=\"line\"><span class=\"comment\"># (4) CentOS7脚本错误解决和优化</span></span><br><span class=\"line\"><span class=\"comment\">## ----------------------------------------- ##</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 系统全局变量定义</span></span><br><span class=\"line\"><span class=\"comment\"># [系统配置]</span></span><br><span class=\"line\">HOSTNAME=CentOS-Security-Template</span><br><span class=\"line\">EXECTIME=$(date +%Y%m%d-%m%S)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># [网络配置]</span></span><br><span class=\"line\">IPADDR=192.168.1.2</span><br><span class=\"line\">NETMASK=225.255.255.0</span><br><span class=\"line\">GATEWAY=192.168.1.1</span><br><span class=\"line\">DNSIP=(<span class=\"string\">\"223.5.5.5\"</span> <span class=\"string\">\"223.6.6.6\"</span>)</span><br><span class=\"line\">SSHPORT=20211</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># [用户设置]</span></span><br><span class=\"line\">DefaultUser=<span class=\"string\">\"WeiyiGeek\"</span>  <span class=\"comment\"># 系统创建的用户名称非root用户</span></span><br><span class=\"line\">ROOTPASS=WeiyiGeek       <span class=\"comment\"># 密码建议12位以上且包含数字、大小写字母以及特殊字符。</span></span><br><span class=\"line\">APPPASS=WeiyiGeek</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># [SNMP配置]</span></span><br><span class=\"line\">SNMP_user=WeiyiGeek</span><br><span class=\"line\">SNMP_group=testgroup</span><br><span class=\"line\">SNMP_view=testview</span><br><span class=\"line\">SNMP_password=dont_use_public</span><br><span class=\"line\">SNMP_ip=127.0.0.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># [配置备份目录]</span></span><br><span class=\"line\">BACKUPDIR=/var/<span class=\"built_in\">log</span>/.backups</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -d <span class=\"variable\">$&#123;BACKUPDIR&#125;</span> ];<span class=\"keyword\">then</span>  mkdir -vp <span class=\"variable\">$&#123;BACKUPDIR&#125;</span>; <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># [配置记录目录]</span></span><br><span class=\"line\">HISDIR=/var/<span class=\"built_in\">log</span>/.<span class=\"built_in\">history</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -d <span class=\"variable\">$&#123;HISDIR&#125;</span> ];<span class=\"keyword\">then</span>  mkdir -vp <span class=\"variable\">$&#123;HISDIR&#125;</span>; <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: err 、info 、warning</span></span><br><span class=\"line\"><span class=\"comment\">## 用途：全局Log信息打印函数</span></span><br><span class=\"line\"><span class=\"comment\">## 参数: $@</span></span><br><span class=\"line\"><span class=\"built_in\">log</span>::<span class=\"function\"><span class=\"title\">err</span></span>() &#123;</span><br><span class=\"line\">  <span class=\"built_in\">printf</span> <span class=\"string\">\"[<span class=\"variable\">$(date +'%Y-%m-%dT%H:%M:%S')</span>]: \\033[31mERROR: <span class=\"variable\">$@</span> \\033[0m\\n\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">log</span>::<span class=\"function\"><span class=\"title\">info</span></span>() &#123;</span><br><span class=\"line\">  <span class=\"built_in\">printf</span> <span class=\"string\">\"[<span class=\"variable\">$(date +'%Y-%m-%dT%H:%M:%S')</span>]: \\033[32mINFO: <span class=\"variable\">$@</span> \\033[0m\\n\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">log</span>::<span class=\"function\"><span class=\"title\">warning</span></span>() &#123;</span><br><span class=\"line\">  <span class=\"built_in\">printf</span> <span class=\"string\">\"[<span class=\"variable\">$(date +'%Y-%m-%dT%H:%M:%S')</span>]: \\033[33mWARNING: <span class=\"variable\">$@</span> \\033[0m\\n\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: os::Network</span></span><br><span class=\"line\"><span class=\"comment\">## 用途: 操作系统网络配置相关脚本包括(IP地址修改)</span></span><br><span class=\"line\"><span class=\"comment\">## 参数: 无</span></span><br><span class=\"line\">os::<span class=\"function\"><span class=\"title\">Network</span></span>()&#123;</span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 操作系统网络配置相关脚本,开始执行.....\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\"># (1) 静态网络IP地址设置</span></span><br><span class=\"line\">tee /opt/network.sh &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\">IPADDR=<span class=\"string\">\"<span class=\"variable\">$&#123;1&#125;</span>\"</span></span><br><span class=\"line\">NETMASK=<span class=\"string\">\"<span class=\"variable\">$&#123;2&#125;</span>\"</span></span><br><span class=\"line\">GATEWAY=<span class=\"string\">\"<span class=\"variable\">$&#123;3&#125;</span>\"</span></span><br><span class=\"line\">DEVNAME=<span class=\"string\">\"ifcfg-ens192\"</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">\"<span class=\"variable\">$&#123;4&#125;</span>\"</span> != <span class=\"string\">\"\"</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">  DEVNAME=<span class=\"string\">\"ifcfg-<span class=\"variable\">$&#123;4&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [[ <span class=\"variable\">$#</span> -lt 3 ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m[*] Usage: <span class=\"variable\">$0</span> IP-Address MASK Gateway \\e[0m\"</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\e[32m[*] Usage: <span class=\"variable\">$0</span> 192.168.1.99 255.255.255.0 192.168.1.1 \\e[0m\"</span></span><br><span class=\"line\">  <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\">NET_FILE=<span class=\"string\">\"/etc/sysconfig/network-scripts/<span class=\"variable\">$&#123;DEVNAME&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [[ ! -f <span class=\"variable\">$&#123;NET_FILE&#125;</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::err <span class=\"string\">\"[*] Not Found <span class=\"variable\">$&#123;NET_FILE&#125;</span> File\"</span></span><br><span class=\"line\">  <span class=\"built_in\">exit</span> 2</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\">cp <span class=\"variable\">$&#123;NET_FILE&#125;</span>&#123;,.bak&#125;</span><br><span class=\"line\">sed -i -e <span class=\"string\">'s/^ONBOOT=.*$/ONBOOT=\"yes\"/'</span> -e <span class=\"string\">'s/^BOOTPROTO=.*$/BOOTPROTO=\"static\"/'</span> <span class=\"variable\">$&#123;NET_FILE&#125;</span></span><br><span class=\"line\">grep -q <span class=\"string\">\"^IPADDR=.*$\"</span> <span class=\"variable\">$&#123;NET_FILE&#125;</span> &amp;&amp;  sed -i <span class=\"string\">\"s/^IPADDR=.*$/IPADDR=\\\"<span class=\"variable\">$&#123;IPADDR&#125;</span>\\\"/\"</span> <span class=\"variable\">$&#123;NET_FILE&#125;</span> || <span class=\"built_in\">echo</span> <span class=\"string\">\"IPADDR=\\\"<span class=\"variable\">$&#123;IPADDR&#125;</span>\\\"\"</span> &gt;&gt; <span class=\"variable\">$&#123;NET_FILE&#125;</span></span><br><span class=\"line\">grep -q <span class=\"string\">\"^NETMASK=.*$\"</span> <span class=\"variable\">$&#123;NET_FILE&#125;</span> &amp;&amp;  sed -i <span class=\"string\">\"s/^NETMASK=.*$/NETMASK=\\\"<span class=\"variable\">$&#123;NETMASK&#125;</span>\\\"/\"</span> <span class=\"variable\">$&#123;NET_FILE&#125;</span> || <span class=\"built_in\">echo</span> <span class=\"string\">\"NETMASK=\\\"<span class=\"variable\">$&#123;NETMASK&#125;</span>\\\"\"</span> &gt;&gt; <span class=\"variable\">$&#123;NET_FILE&#125;</span></span><br><span class=\"line\">grep -q <span class=\"string\">\"^GATEWAY=.*$\"</span> <span class=\"variable\">$&#123;NET_FILE&#125;</span> &amp;&amp;  sed -i <span class=\"string\">\"s/^GATEWAY=.*$/IPADDR=\\\"<span class=\"variable\">$&#123;GATEWAY&#125;</span>\\\"/\"</span> <span class=\"variable\">$&#123;NET_FILE&#125;</span> || <span class=\"built_in\">echo</span> <span class=\"string\">\"GATEWAY=\\\"<span class=\"variable\">$&#123;GATEWAY&#125;</span>\\\"\"</span> &gt;&gt; <span class=\"variable\">$&#123;NET_FILE&#125;</span></span><br><span class=\"line\">EOF</span><br><span class=\"line\">chmod +x /opt/network.sh</span><br><span class=\"line\">/opt/network.sh <span class=\"variable\">$&#123;IPADDR&#125;</span> <span class=\"variable\">$&#123;NETMASK&#125;</span> <span class=\"variable\">$&#123;GATEWAY&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2) 系统主机名与本地解析设置</span></span><br><span class=\"line\">sudo hostnamectl <span class=\"built_in\">set</span>-hostname <span class=\"variable\">$&#123;HOSTNAME&#125;</span> </span><br><span class=\"line\"><span class=\"comment\"># sed -i \"s/127.0.1.1\\s.\\w.*$/127.0.1.1 $&#123;NAME&#125;/g\" /etc/hosts</span></span><br><span class=\"line\">cp -a /etc/hosts  <span class=\"variable\">$&#123;BACKUPDIR&#125;</span>/hosts.bak</span><br><span class=\"line\">grep -q <span class=\"string\">\"^\\$(hostname -I)\\s.\\w.*$\"</span> /etc/hosts &amp;&amp; sed -i <span class=\"string\">\"s/\\$(hostname -I)\\s.\\w.*$/<span class=\"variable\">$&#123;IPADDR&#125;</span> <span class=\"variable\">$&#123;HOSTNAME&#125;</span>\"</span> /etc/hosts || <span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$&#123;IPADDR&#125;</span> <span class=\"variable\">$&#123;HOSTNAME&#125;</span>\"</span> &gt;&gt; /etc/hosts</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (3) 系统DNS域名解析服务设置</span></span><br><span class=\"line\">cp -a /etc/resolv.conf  <span class=\"variable\">$&#123;BACKUPDIR&#125;</span>/resolv.conf.bak</span><br><span class=\"line\"><span class=\"keyword\">for</span> dns <span class=\"keyword\">in</span>  <span class=\"variable\">$&#123;DNSIP[@]&#125;</span>;<span class=\"keyword\">do</span> <span class=\"built_in\">echo</span> <span class=\"string\">\"nameserver <span class=\"variable\">$&#123;dns&#125;</span>\"</span> &gt;&gt; /etc/resolv.conf;<span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">log</span>::info <span class=\"string\">\"[*] network configure modifiy successful! restarting Network.........\"</span></span><br><span class=\"line\">service network restart &amp;&amp; ip addr</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: os::Software</span></span><br><span class=\"line\"><span class=\"comment\">## 用途: 操作系统软件包管理及更新源配置相关脚本</span></span><br><span class=\"line\"><span class=\"comment\">## 参数: 无</span></span><br><span class=\"line\">os::<span class=\"function\"><span class=\"title\">Software</span></span> () &#123;</span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 操作系统软件包管理及更新源配置相关脚本,开始执行.....\"</span></span><br><span class=\"line\">  cp -a /etc/yum.repos.d/CentOS-Base.repo <span class=\"variable\">$&#123;BACKUPDIR&#125;</span>/CentOS-Base.repo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (1) CentOS 软件仓库镜像源配置&amp;&amp;初始化更新</span></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[*] CentOS 软件仓库镜像源配置&amp;&amp;初始化更新 \"</span></span><br><span class=\"line\">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class=\"line\">curl -o /etc/yum.repos.d/CentOS-epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class=\"line\">sed -i <span class=\"string\">\"s#mirrors.cloud.aliyuncs.com#mirrors.aliyun.com#g\"</span> /etc/yum.repos.d/CentOS-Base.repo</span><br><span class=\"line\">rpm --import http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class=\"line\">yum clean all &amp;&amp; yum makecache</span><br><span class=\"line\">yum --exclude=kernel* update -y &amp;&amp; yum upgrade -y &amp;&amp;  yum -y install epel*</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2) CentOS 操作系统内核升级(可选)</span></span><br><span class=\"line\">  cp -a /etc/grub2.cfg <span class=\"variable\">$&#123;BACKUPDIR&#125;</span>/grub2.cfg.kernelupdate.bak</span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[*] CentOS 操作系统内核升级(可选) \"</span></span><br><span class=\"line\">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br><span class=\"line\">yum -y install https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm</span><br><span class=\"line\">yum --disablerepo=<span class=\"string\">\"*\"</span> --enablerepo=elrepo-kernel repolist</span><br><span class=\"line\">yum --disablerepo=<span class=\"string\">\"*\"</span> --enablerepo=elrepo-kernel list kernel*</span><br><span class=\"line\"><span class=\"comment\"># 内核安装，服务器里我们选择长期lt版本，安全稳定是我们最大的需求，除非有特殊的需求内核版本需求;</span></span><br><span class=\"line\">yum update -y --enablerepo=elrepo-kernel </span><br><span class=\"line\"><span class=\"comment\"># 内核版本介绍, lt:longterm 的缩写长期维护版, ml:mainline 的缩写最新主线版本;</span></span><br><span class=\"line\">yum install -y --enablerepo=elrepo-kernel --skip-broken kernel<span class=\"_\">-lt</span> kernel<span class=\"_\">-lt</span>-devel kernel<span class=\"_\">-lt</span>-tools</span><br><span class=\"line\"><span class=\"comment\"># yum -y --enablerepo=elrepo-kernel --skip-broken install kernel-ml.x86_64 kernel-ml-devel.x86_64 kernel-ml-tools.x86_64</span></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::warning <span class=\"string\">\"[*] 当前 CentOS 操作系统可切换的内核内核版本\"</span></span><br><span class=\"line\">awk -F \\<span class=\"string\">' '</span><span class=\"variable\">$1</span>==<span class=\"string\">\"menuentry \"</span> &#123;<span class=\"built_in\">print</span> i++ <span class=\"string\">\" : \"</span> <span class=\"variable\">$2</span>&#125;<span class=\"string\">' /etc/grub2.cfg</span></span><br><span class=\"line\"><span class=\"string\">sudo grub2-set-default 0</span></span><br><span class=\"line\"><span class=\"string\">#传统引导</span></span><br><span class=\"line\"><span class=\"string\"># grub2-mkconfig -o /boot/grub2/grub.cfg</span></span><br><span class=\"line\"><span class=\"string\"># grubby --default-kernel</span></span><br><span class=\"line\"><span class=\"string\">reboot</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># (3) 安装常用的运维软件</span></span><br><span class=\"line\"><span class=\"string\"># 编译软件</span></span><br><span class=\"line\"><span class=\"string\">yum install -y gcc gcc-c++ g++ make jq libpam-cracklib openssl-devel bzip2-devel</span></span><br><span class=\"line\"><span class=\"string\"># 常规软件</span></span><br><span class=\"line\"><span class=\"string\">yum install -y nano vim git unzip wget ntpdate dos2unix net-tools</span></span><br><span class=\"line\"><span class=\"string\">yum install -y tree htop ncdu nload sysstat psmisc bash-completion fail2ban nfs-utils chrony</span></span><br><span class=\"line\"><span class=\"string\"># 清空缓存和已下载安装的软件包</span></span><br><span class=\"line\"><span class=\"string\">yum clean all</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">  log::info \"[*] Software configure modifiy successful!Please Happy use.........\"</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">## 名称: os::TimedataZone</span></span><br><span class=\"line\"><span class=\"string\">## 用途: 操作系统系统时间时区配置相关脚本</span></span><br><span class=\"line\"><span class=\"string\">## 参数: 无</span></span><br><span class=\"line\"><span class=\"string\">os::TimedataZone() &#123;</span></span><br><span class=\"line\"><span class=\"string\">  log::info \"[*] 操作系统系统时间时区配置相关脚本,开始执行.....\"</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># (1) 时区设置东8区</span></span><br><span class=\"line\"><span class=\"string\">log::info \"[*] 时区设置前的时间: $(date -R) \"</span></span><br><span class=\"line\"><span class=\"string\">timedatectl</span></span><br><span class=\"line\"><span class=\"string\">cp -a /etc/localtime $&#123;BACKUPDIR&#125;/localtime.bak</span></span><br><span class=\"line\"><span class=\"string\">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># (2) 时间同步软件安装</span></span><br><span class=\"line\"><span class=\"string\">grep -q \"192.168.12.254\" /etc/chrony.conf || sudo tee -a /etc/chrony.conf &lt;&lt;'</span>EOF<span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\">pool 192.168.12.254 iburst maxsources 1</span></span><br><span class=\"line\"><span class=\"string\">pool 192.168.10.254 iburst maxsources 1</span></span><br><span class=\"line\"><span class=\"string\">pool 192.168.4.254 iburst maxsources 1</span></span><br><span class=\"line\"><span class=\"string\">pool ntp.aliyun.com iburst maxsources 4</span></span><br><span class=\"line\"><span class=\"string\">keyfile /etc/chrony.keys</span></span><br><span class=\"line\"><span class=\"string\">driftfile /var/lib/chrony/chrony.drift</span></span><br><span class=\"line\"><span class=\"string\">logdir /var/log/chrony</span></span><br><span class=\"line\"><span class=\"string\">maxupdateskew 100.0</span></span><br><span class=\"line\"><span class=\"string\">rtcsync</span></span><br><span class=\"line\"><span class=\"string\">makestep 1.0 3</span></span><br><span class=\"line\"><span class=\"string\">#stratumweight 0.05</span></span><br><span class=\"line\"><span class=\"string\">#noclientlog</span></span><br><span class=\"line\"><span class=\"string\">#logchange 0.5</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">systemctl enable chronyd &amp;&amp; systemctl restart chronyd &amp;&amp; systemctl status chronyd -l</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># 将当前的 UTC 时间写入硬件时钟 (硬件时间默认为UTC)</span></span><br><span class=\"line\"><span class=\"string\">sudo timedatectl set-local-rtc 0</span></span><br><span class=\"line\"><span class=\"string\"># 启用NTP时间同步：</span></span><br><span class=\"line\"><span class=\"string\">timedatectl set-ntp yes</span></span><br><span class=\"line\"><span class=\"string\"># 时间服务器连接查看</span></span><br><span class=\"line\"><span class=\"string\">chronyc tracking</span></span><br><span class=\"line\"><span class=\"string\"># 手动校准-强制更新时间</span></span><br><span class=\"line\"><span class=\"string\"># chronyc -a makestep</span></span><br><span class=\"line\"><span class=\"string\"># 硬件时钟(系统时钟同步硬件时钟 )</span></span><br><span class=\"line\"><span class=\"string\">hwclock --systohc </span></span><br><span class=\"line\"><span class=\"string\"># 备用方案: 采用 ntpdate 进行时间同步 ntpdate 192.168.10.254</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># (3) 重启依赖于系统时间的服务</span></span><br><span class=\"line\"><span class=\"string\">sudo systemctl restart rsyslog.service crond.service</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">log::info \"[*] Tie confmigure modifiy successful! restarting chronyd rsyslog.service crond.service.........\"</span></span><br><span class=\"line\"><span class=\"string\">timedatectl</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">## 名称: os::Security</span></span><br><span class=\"line\"><span class=\"string\">## 用途: 操作系统安全加固配置脚本(符合等保要求-三级要求)</span></span><br><span class=\"line\"><span class=\"string\">## 参数: 无</span></span><br><span class=\"line\"><span class=\"string\">os::Security () &#123;</span></span><br><span class=\"line\"><span class=\"string\">  log::info \"[-] 操作系统安全加固配置(符合等保要求-三级要求)\"</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># (0) 系统用户及其终端核查配置</span></span><br><span class=\"line\"><span class=\"string\">  log::info \"[-] 锁定或者删除多余的系统账户以及创建低权限用户\"</span></span><br><span class=\"line\"><span class=\"string\">  # cat /etc/passwd | cut -d \":\" -f 1 | tr '</span>\\n<span class=\"string\">' '</span> <span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\">defaultuser=(root bin daemon adm lp sync shutdown halt mail operator games ftp nobody systemd-network dbus polkitd sshd postfix chrony ntp rpc rpcuser nfsnobody)</span></span><br><span class=\"line\"><span class=\"string\">for i in $(cat /etc/passwd | cut -d \":\" -f 1,7);do</span></span><br><span class=\"line\"><span class=\"string\">  flag=0; name=$&#123;i%%:*&#125;; terminal=$&#123;i##*:&#125;</span></span><br><span class=\"line\"><span class=\"string\">  if [[ \"$&#123;terminal&#125;\" == \"/bin/bash\" || \"$&#123;terminal&#125;\" == \"/bin/sh\" ]];then</span></span><br><span class=\"line\"><span class=\"string\">    log::warning \"$&#123;i&#125; 用户，shell终端为 /bin/bash 或者 /bin/sh\"</span></span><br><span class=\"line\"><span class=\"string\">  fi</span></span><br><span class=\"line\"><span class=\"string\">  for j in $&#123;defaultuser[@]&#125;;do</span></span><br><span class=\"line\"><span class=\"string\">    if [[ \"$&#123;name&#125;\" == \"$&#123;j&#125;\" ]];then</span></span><br><span class=\"line\"><span class=\"string\">      flag=1</span></span><br><span class=\"line\"><span class=\"string\">      break;</span></span><br><span class=\"line\"><span class=\"string\">    fi</span></span><br><span class=\"line\"><span class=\"string\">  done</span></span><br><span class=\"line\"><span class=\"string\">  if [[ $flag -eq 0 ]];then</span></span><br><span class=\"line\"><span class=\"string\">    log::warning \"$&#123;i&#125; 非默认用户\"</span></span><br><span class=\"line\"><span class=\"string\">  fi</span></span><br><span class=\"line\"><span class=\"string\">done</span></span><br><span class=\"line\"><span class=\"string\">cp -a /etc/shadow $&#123;BACKUPDIR&#125;/shadow-$&#123;EXECTIME&#125;.bak</span></span><br><span class=\"line\"><span class=\"string\">passwd -l adm&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l daemon&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l bin&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l sys&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l lp&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l uucp&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l nuucp&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l smmsplp&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l mail&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l operator&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l games&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l gopher&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l ftp&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l nobody&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l nobody4&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l noaccess&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l listen&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l webservd&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l rpm&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l dbus&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l avahi&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l mailnull&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l nscd&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l vcsa&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l rpc&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l rpcuser&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l nfs&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l sshd&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l pcap&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l ntp&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l haldaemon&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l distcache&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l webalizer&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l squid&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l xfs&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l gdm&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l sabayon&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l named&amp;&gt;/dev/null 2&amp;&gt;/dev/null</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># (2) 用户密码设置和口令策略设置</span></span><br><span class=\"line\"><span class=\"string\">log::info \"[-]  配置满足策略的root管理员密码 \"</span></span><br><span class=\"line\"><span class=\"string\">echo \"root:$&#123;ROOTPASS&#125;\" | chpasswd</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">log::info \"[-] 配置满足策略的app普通用户密码(根据需求配置)\"</span></span><br><span class=\"line\"><span class=\"string\">groupadd application</span></span><br><span class=\"line\"><span class=\"string\">useradd -m -s /bin/bash -c \"application primary user\" -g application app </span></span><br><span class=\"line\"><span class=\"string\">echo \"root:$&#123;APPPASS&#125;\" | chpasswd</span></span><br><span class=\"line\"><span class=\"string\"> </span></span><br><span class=\"line\"><span class=\"string\">log::info \"[-] 强制用户在下次登录时更改密码 \"</span></span><br><span class=\"line\"><span class=\"string\">chage -d 0 -m 0 -M 90 -W 15 root &amp;&amp; passwd --expire root  </span></span><br><span class=\"line\"><span class=\"string\">chage -d 0 -m 0 -M 90 -W 15 app &amp;&amp; passwd --expire app</span></span><br><span class=\"line\"><span class=\"string\">chage -d 0 -m 0 -M 90 -W 15 $&#123;DefaultUser&#125; &amp;&amp; passwd --expire $&#123;DefaultUser&#125; </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">log::info \"[-] 用户口令复杂性策略设置 (密码过期周期0~90、到期前15天提示、密码长度至少15、复杂度设置至少有一个大小写、数字、特殊字符、密码三次不能一样、尝试次数为三次)\"</span></span><br><span class=\"line\"><span class=\"string\"># 相关修改文件备份</span></span><br><span class=\"line\"><span class=\"string\">cp /etc/login.defs $&#123;BACKUPDIR&#125;/login.defs.bak;</span></span><br><span class=\"line\"><span class=\"string\">cp /etc/pam.d/password-auth $&#123;BACKUPDIR&#125;/password-auth.bak</span></span><br><span class=\"line\"><span class=\"string\">cp /etc/pam.d/system-auth $&#123;BACKUPDIR&#125;/system-auth.bak</span></span><br><span class=\"line\"><span class=\"string\">egrep -q \"^\\s*PASS_MIN_DAYS\\s+\\S*(\\s*#.*)?\\s*$\" /etc/login.defs &amp;&amp; sed -ri \"s/^(\\s*)PASS_MIN_DAYS\\s+\\S*(\\s*#.*)?\\s*$/\\PASS_MIN_DAYS  0/\" /etc/login.defs || echo \"PASS_MIN_DAYS  0\" &gt;&gt; /etc/login.defs</span></span><br><span class=\"line\"><span class=\"string\">egrep -q \"^\\s*PASS_MAX_DAYS\\s+\\S*(\\s*#.*)?\\s*$\" /etc/login.defs &amp;&amp; sed -ri \"s/^(\\s*)PASS_MAX_DAYS\\s+\\S*(\\s*#.*)?\\s*$/\\PASS_MAX_DAYS  90/\" /etc/login.defs || echo \"PASS_MAX_DAYS  90\" &gt;&gt; /etc/login.defs</span></span><br><span class=\"line\"><span class=\"string\">egrep -q \"^\\s*PASS_WARN_AGE\\s+\\S*(\\s*#.*)?\\s*$\" /etc/login.defs &amp;&amp; sed -ri \"s/^(\\s*)PASS_WARN_AGE\\s+\\S*(\\s*#.*)?\\s*$/\\PASS_WARN_AGE  15/\" /etc/login.defs || echo \"PASS_WARN_AGE  15\" &gt;&gt; /etc/login.defs</span></span><br><span class=\"line\"><span class=\"string\">egrep -q \"^\\s*PASS_MIN_LEN\\s+\\S*(\\s*#.*)?\\s*$\" /etc/login.defs &amp;&amp; sed -ri \"s/^(\\s*)PASS_MIN_LEN\\s+\\S*(\\s*#.*)?\\s*$/\\PASS_MIN_LEN  15/\" /etc/login.defs || echo \"PASS_MIN_LEN  15\" &gt;&gt; /etc/login.defs</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">egrep -q \"^password\\s.+pam_pwquality.so\\s+\\w+.*$\" /etc/pam.d/password-auth &amp;&amp; sed -ri '</span>/^password\\s.+pam_pwquality.so/&#123;s/pam_pwquality.so\\s+\\w+.*$/pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type=  minlen=15 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1 difok=1 enforce_for_root/g;&#125;<span class=\"string\">' /etc/pam.d/password-auth</span></span><br><span class=\"line\"><span class=\"string\">egrep -q \"^password\\s.+pam_unix.so\\s+\\w+.*$\" /etc/pam.d/password-auth &amp;&amp; sed -ri '</span>/^password\\s.+pam_unix.so/&#123;s/pam_unix.so\\s+\\w+.*$/pam_unix.so sha512 shadow nullok try_first_pass use_authtok remember=3/g;&#125;<span class=\"string\">' /etc/pam.d/password-auth</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">egrep -q \"^password\\s.+pam_pwquality.so\\s+\\w+.*$\" /etc/pam.d/system-auth &amp;&amp; sed -ri '</span>/^password\\s.+pam_pwquality.so/&#123;s/pam_pwquality.so\\s+\\w+.*$/pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type=  minlen=15 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1 difok=1 enforce_for_root/g;&#125;<span class=\"string\">' /etc/pam.d/system-auth</span></span><br><span class=\"line\"><span class=\"string\">egrep -q \"^password\\s.+pam_unix.so\\s+\\w+.*$\" /etc/pam.d/system-auth &amp;&amp; sed -ri '</span>/^password\\s.+pam_unix.so/&#123;s/pam_unix.so\\s+\\w+.*$/pam_unix.so sha512 shadow nullok try_first_pass use_authtok remember=3/g;&#125;<span class=\"string\">' /etc/pam.d/system-auth</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">log::info \"[-] 存储用户密码的文件，其内容经过sha512加密，所以非常注意其权限\"</span></span><br><span class=\"line\"><span class=\"string\"># 解决首次登录配置密码时提示\"passwd: Authentication token manipulation error\"</span></span><br><span class=\"line\"><span class=\"string\">touch /etc/security/opasswd &amp;&amp; chown root:root /etc/security/opasswd &amp;&amp; chmod 600 /etc/security/opasswd </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># (3) 设置用户sudo权限以及重要目录和文件的新建默认权限</span></span><br><span class=\"line\"><span class=\"string\">log::info \"[-] 用户sudo权限以及重要目录和文件的新建默认权限设置\"</span></span><br><span class=\"line\"><span class=\"string\">cp /etc/sudoers $&#123;BACKUPDIR&#125;/sudoers.bak</span></span><br><span class=\"line\"><span class=\"string\"># 如CentOS安装时您创建的用户 WeiyiGeek 防止直接通过 sudo passwd 修改root密码(此时必须要求输入WeiyiGeek密码后才可修改root密码)</span></span><br><span class=\"line\"><span class=\"string\"># Tips: Sudo允许授权用户权限以另一个用户（通常是root用户）的身份运行程序, </span></span><br><span class=\"line\"><span class=\"string\"># DefaultUser=\"weiyigeek\"</span></span><br><span class=\"line\"><span class=\"string\">sed -i \"/# Allows members of the/i $&#123;DefaultUser&#125; ALL=(ALL) PASSWD:ALL\" /etc/sudoers</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># 此参数需要根据业务来定，否则在使用时候会出现某些权限不足导致程序安装报错</span></span><br><span class=\"line\"><span class=\"string\">log::info \"[-] 配置用户 umask 为022 \"</span></span><br><span class=\"line\"><span class=\"string\">cp -a /etc/profile $&#123;BACKUPDIR&#125;/profile</span></span><br><span class=\"line\"><span class=\"string\">egrep -q \"^\\s*umask\\s+\\w+.*$\" /etc/profile &amp;&amp; sed -ri \"s/^\\s*umask\\s+\\w+.*$/umask 022/\" /etc/profile || echo \"umask 022\" &gt;&gt; /etc/profile </span></span><br><span class=\"line\"><span class=\"string\"># log::info \"[-] 设置用户目录创建默认权限, (初始为077比较严格)在未设置umask为027则默认为077\"</span></span><br><span class=\"line\"><span class=\"string\"># egrep -q \"^\\s*umask\\s+\\w+.*$\" /etc/csh.login &amp;&amp; sed -ri \"s/^\\s*umask\\s+\\w+.*$/umask 022/\" /etc/csh.login || echo \"umask 022\" &gt;&gt; /etc/csh.login</span></span><br><span class=\"line\"><span class=\"string\"># egrep -q \"^\\s*umask\\s+\\w+.*$\" /etc/csh.cshrc &amp;&amp; sed -ri \"s/^\\s*umask\\s+\\w+.*$/umask 022/\" /etc/csh.cshrc || echo \"umask 022\" &gt;&gt; /etc/csh.cshrc</span></span><br><span class=\"line\"><span class=\"string\"># egrep -q \"^\\s*(umask|UMASK)\\s+\\w+.*$\" /etc/login.defs &amp;&amp; sed -ri \"s/^\\s*(umask|UMASK)\\s+\\w+.*$/UMASK 027/\" /etc/login.defs || echo \"UMASK 027\" &gt;&gt; /etc/login.defs</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">log::info \"[-] 设置或恢复重要目录和文件的权限(设置日志文件非全局可写)\"</span></span><br><span class=\"line\"><span class=\"string\">chmod 600 ~/.ssh/authorized_keys;</span></span><br><span class=\"line\"><span class=\"string\">chmod 755 /etc;</span></span><br><span class=\"line\"><span class=\"string\">chmod 755 /etc/passwd; </span></span><br><span class=\"line\"><span class=\"string\">chmod 755 /etc/shadow; </span></span><br><span class=\"line\"><span class=\"string\">chmod 755 /etc/security; </span></span><br><span class=\"line\"><span class=\"string\">chmod 644 /etc/group; </span></span><br><span class=\"line\"><span class=\"string\">chmod 644 /etc/services; </span></span><br><span class=\"line\"><span class=\"string\">chmod 750 /etc/rc*.d;</span></span><br><span class=\"line\"><span class=\"string\">chmod 755 /var/log/messages;</span></span><br><span class=\"line\"><span class=\"string\">chmod 775 /var/log/spooler;</span></span><br><span class=\"line\"><span class=\"string\">chmod 775 /var/log/cron;</span></span><br><span class=\"line\"><span class=\"string\">chmod 775 /var/log/secure;</span></span><br><span class=\"line\"><span class=\"string\">chmod 775 /var/log/maillog;</span></span><br><span class=\"line\"><span class=\"string\">chmod 775 /var/log/mail&amp;&gt;/dev/null 2&amp;&gt;/dev/null; </span></span><br><span class=\"line\"><span class=\"string\">chmod 775 /var/log/localmessages&amp;&gt;/dev/null 2&amp;&gt;/dev/null</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">log::info \"[-] 删除潜在威胁文件 \"</span></span><br><span class=\"line\"><span class=\"string\">find / -maxdepth 3 -name hosts.equiv | xargs rm -rf</span></span><br><span class=\"line\"><span class=\"string\">find / -maxdepth 3 -name .netrc | xargs rm -rf</span></span><br><span class=\"line\"><span class=\"string\">find / -maxdepth 3 -name .rhosts | xargs rm -rf</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># (4) SSHD 服务安全加固设置以及网络登陆Banner设置</span></span><br><span class=\"line\"><span class=\"string\">log::info \"[-] sshd 服务安全加固设置\"</span></span><br><span class=\"line\"><span class=\"string\">cp /etc/ssh/sshd_config $&#123;BACKUPDIR&#125;/sshd_config.bak</span></span><br><span class=\"line\"><span class=\"string\"># 严格模式</span></span><br><span class=\"line\"><span class=\"string\">sudo egrep -q \"^\\s*StrictModes\\s+.+$\" /etc/ssh/sshd_config &amp;&amp; sed -ri \"s/^(#)?\\s*StrictModes\\s+.+$/StrictModes yes/\" /etc/ssh/sshd_config || echo \"StrictModes yes\" &gt;&gt; /etc/ssh/sshd_config</span></span><br><span class=\"line\"><span class=\"string\"># 默认的监听端口更改</span></span><br><span class=\"line\"><span class=\"string\">if [ -e $&#123;SSHPORT&#125; ];then export SSHPORT=20211;fi</span></span><br><span class=\"line\"><span class=\"string\">sudo egrep -q \"^\\s*Port\\s+.+$\" /etc/ssh/sshd_config &amp;&amp; sed -ri \"s/^(#)?\\s*Port\\s+.+$/Port $&#123;SSHPORT&#125;/\" /etc/ssh/sshd_config || echo \"Port $&#123;SSHPORT&#125;\" &gt;&gt; /etc/ssh/sshd_config</span></span><br><span class=\"line\"><span class=\"string\"># 禁用X11转发以及端口转发</span></span><br><span class=\"line\"><span class=\"string\">sudo egrep -q \"^\\s*X11Forwarding\\s+.+$\" /etc/ssh/sshd_config &amp;&amp; sed -ri \"s/^(#)?\\s*X11Forwarding\\s+.+$/X11Forwarding no/\" /etc/ssh/sshd_config || echo \"X11Forwarding no\" &gt;&gt; /etc/ssh/sshd_config</span></span><br><span class=\"line\"><span class=\"string\">sudo egrep -q \"^\\s*X11UseLocalhost\\s+.+$\" /etc/ssh/sshd_config &amp;&amp; sed -ri \"s/^(#)?\\s*X11UseLocalhost\\s+.+$/X11UseLocalhost yes/\" /etc/ssh/sshd_config || echo \"X11UseLocalhost yes\" &gt;&gt; /etc/ssh/sshd_config</span></span><br><span class=\"line\"><span class=\"string\">sudo egrep -q \"^\\s*AllowTcpForwarding\\s+.+$\" /etc/ssh/sshd_config &amp;&amp; sed -ri \"s/^(#)?\\s*AllowTcpForwarding\\s+.+$/AllowTcpForwarding no/\" /etc/ssh/sshd_config || echo \"AllowTcpForwarding no\" &gt;&gt; /etc/ssh/sshd_config</span></span><br><span class=\"line\"><span class=\"string\">sudo egrep -q \"^\\s*AllowAgentForwarding\\s+.+$\" /etc/ssh/sshd_config &amp;&amp; sed -ri \"s/^(#)?\\s*AllowAgentForwarding\\s+.+$/AllowAgentForwarding no/\" /etc/ssh/sshd_config || echo \"AllowAgentForwarding no\" &gt;&gt; /etc/ssh/sshd_config</span></span><br><span class=\"line\"><span class=\"string\"># 关闭禁用用户的 .rhosts 文件  ~/.ssh/.rhosts 来做为认证: 缺省IgnoreRhosts yes </span></span><br><span class=\"line\"><span class=\"string\">egrep -q \"^(#)?\\s*IgnoreRhosts\\s+.+$\" /etc/ssh/sshd_config &amp;&amp; sed -ri \"s/^(#)?\\s*IgnoreRhosts\\s+.+$/IgnoreRhosts yes/\" /etc/ssh/sshd_config || echo \"IgnoreRhosts yes\" &gt;&gt; /etc/ssh/sshd_config</span></span><br><span class=\"line\"><span class=\"string\"># 禁止root远程登录（推荐配置-根据需求配置）</span></span><br><span class=\"line\"><span class=\"string\">egrep -q \"^\\s*PermitRootLogin\\s+.+$\" /etc/ssh/sshd_config &amp;&amp; sed -ri \"s/^\\s*PermitRootLogin\\s+.+$/PermitRootLogin no/\" /etc/ssh/sshd_config || echo \"PermitRootLogin no\" &gt;&gt; /etc/ssh/sshd_config</span></span><br><span class=\"line\"><span class=\"string\"># 登陆前后欢迎提示设置</span></span><br><span class=\"line\"><span class=\"string\">egrep -q \"^\\s*(banner|Banner)\\s+\\W+.*$\" /etc/ssh/sshd_config &amp;&amp; sed -ri \"s/^\\s*(banner|Banner)\\s+\\W+.*$/Banner \\/etc\\/issue/\" /etc/ssh/sshd_config || \\</span></span><br><span class=\"line\"><span class=\"string\">echo \"Banner /etc/issue\" &gt;&gt; /etc/ssh/sshd_config</span></span><br><span class=\"line\"><span class=\"string\">log::info \"[-] 远程SSH登录前后提示警告Banner设置\"</span></span><br><span class=\"line\"><span class=\"string\"># SSH登录前后提示警告Banner设置</span></span><br><span class=\"line\"><span class=\"string\">sudo tee /etc/issue &lt;&lt;'</span>EOF<span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\">****************** [ 安全登陆 (Security Login) ] *****************</span></span><br><span class=\"line\"><span class=\"string\">Authorized only. All activity will be monitored and reported.By Security Center.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\"># SSH登录后提示Banner</span></span><br><span class=\"line\"><span class=\"string\"># 艺术字B格: http://www.network-science.de/ascii/</span></span><br><span class=\"line\"><span class=\"string\">sudo tee /etc/motd &lt;&lt;'</span>EOF<span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">################## [ 安全运维 (Security Operation) ] ####################</span></span><br><span class=\"line\"><span class=\"string\">            __          __  _       _  _____           _    </span></span><br><span class=\"line\"><span class=\"string\">            \\ \\        / / (_)     (_)/ ____|         | |   </span></span><br><span class=\"line\"><span class=\"string\">            \\ \\  /\\  / /__ _ _   _ _| |  __  ___  ___| | __</span></span><br><span class=\"line\"><span class=\"string\">              \\ \\/  \\/ / _ \\ | | | | | | |_ |/ _ \\/ _ \\ |/ /</span></span><br><span class=\"line\"><span class=\"string\">              \\  /\\  /  __/ | |_| | | |__| |  __/  __/   &lt; </span></span><br><span class=\"line\"><span class=\"string\">                \\/  \\/ \\___|_|\\__, |_|\\_____|\\___|\\___|_|\\_\\</span></span><br><span class=\"line\"><span class=\"string\">                              __/ |                        </span></span><br><span class=\"line\"><span class=\"string\">                              |___/              </span></span><br><span class=\"line\"><span class=\"string\">                                                    </span></span><br><span class=\"line\"><span class=\"string\">Login success. Please execute the commands and operation data after carefully.By WeiyiGeek</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># (5) 用户远程登录失败次数与终端超时设置 </span></span><br><span class=\"line\"><span class=\"string\">log::info \"[-] 用户远程连续登录失败10次锁定帐号5分钟包括root账号\"</span></span><br><span class=\"line\"><span class=\"string\">cp /etc/pam.d/sshd $&#123;BACKUPDIR&#125;/sshd.bak</span></span><br><span class=\"line\"><span class=\"string\">cp /etc/pam.d/login $&#123;BACKUPDIR&#125;/login.bak</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># 远程登陆</span></span><br><span class=\"line\"><span class=\"string\">sed -ri \"/^\\s*auth\\s+required\\s+pam_tally2.so\\s+.+(\\s*#.*)?\\s*$/d\" /etc/pam.d/sshd </span></span><br><span class=\"line\"><span class=\"string\">sed -ri '</span>2a auth required pam_tally2.so deny=10 unlock_time=300 even_deny_root root_unlock_time=300<span class=\"string\">' /etc/pam.d/sshd </span></span><br><span class=\"line\"><span class=\"string\"># 宿主机控制台登陆(可选)</span></span><br><span class=\"line\"><span class=\"string\"># sed -ri \"/^\\s*auth\\s+required\\s+pam_tally2.so\\s+.+(\\s*#.*)?\\s*$/d\" /etc/pam.d/login</span></span><br><span class=\"line\"><span class=\"string\"># sed -ri '</span>2a auth required pam_tally2.so deny=10 unlock_time=300 even_deny_root root_unlock_time=300<span class=\"string\">' /etc/pam.d/login</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">log::info \"[-] 设置登录超时时间为10分钟 \"</span></span><br><span class=\"line\"><span class=\"string\">egrep -q \"^\\s*(export|)\\s*TMOUT\\S\\w+.*$\" /etc/profile &amp;&amp; sed -ri \"s/^\\s*(export|)\\s*TMOUT.\\S\\w+.*$/export TMOUT=600\\nreadonly TMOUT/\" /etc/profile || echo -e \"export TMOUT=600\\nreadonly TMOUT\" &gt;&gt; /etc/profile</span></span><br><span class=\"line\"><span class=\"string\">egrep -q \"^\\s*.*ClientAliveInterval\\s\\w+.*$\" /etc/ssh/sshd_config &amp;&amp; sed -ri \"s/^\\s*.*ClientAliveInterval\\s\\w+.*$/ClientAliveInterval 600/\" /etc/ssh/sshd_config || echo \"ClientAliveInterval 600\" &gt;&gt; /etc/ssh/sshd_config</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># (6) 切换用户日志记录和切换命令更改名称为SU</span></span><br><span class=\"line\"><span class=\"string\">log::info \"[-] 切换用户日志记录和切换命令更改名称为SU \"</span></span><br><span class=\"line\"><span class=\"string\">cp -a /etc/rsyslog.conf  $&#123;BACKUPDIR&#125;/rsyslog.conf-$&#123;EXECTIME&#125;.bak</span></span><br><span class=\"line\"><span class=\"string\">egrep -q \"^\\s*authpriv\\.\\*\\s+.+$\" /etc/rsyslog.conf &amp;&amp; sed -ri \"s/^\\s*authpriv\\.\\*\\s+.+$/authpriv.*  \\/var\\/log\\/secure/\" /etc/rsyslog.conf || echo \"authpriv.*  /var/log/secure\" &gt;&gt; /etc/rsyslog.conf</span></span><br><span class=\"line\"><span class=\"string\">egrep -q \"^(\\s*)SULOG_FILE\\s+\\S*(\\s*#.*)?\\s*$\" /etc/login.defs &amp;&amp; sed -ri \"s/^(\\s*)SULOG_FILE\\s+\\S*(\\s*#.*)?\\s*$/\\SULOG_FILE  \\/var\\/log\\/.history\\/sulog/\" /etc/login.defs || echo \"SULOG_FILE  /var/log/.history/sulog\" &gt;&gt; /etc/login.defs</span></span><br><span class=\"line\"><span class=\"string\">egrep -q \"^\\s*SU_NAME\\s+\\S*(\\s*#.*)?\\s*$\" /etc/login.defs &amp;&amp; sed -ri \"s/^(\\s*)SU_NAME\\s+\\S*(\\s*#.*)?\\s*$/\\SU_NAME  SU/\" /etc/login.defs || echo \"SU_NAME  SU\" &gt;&gt; /etc/login.defs</span></span><br><span class=\"line\"><span class=\"string\">mkdir -vp /usr/local/bin</span></span><br><span class=\"line\"><span class=\"string\">cp /usr/bin/su $&#123;BACKUPDIR&#125;/su.bak</span></span><br><span class=\"line\"><span class=\"string\">mv /usr/bin/su /usr/bin/SU</span></span><br><span class=\"line\"><span class=\"string\">chmod 777 /var/log/.history </span></span><br><span class=\"line\"><span class=\"string\">chattr -R +a /var/log/.history </span></span><br><span class=\"line\"><span class=\"string\">chattr +a /var/log/.backups </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># (7) 用户终端执行的历史命令记录</span></span><br><span class=\"line\"><span class=\"string\">log::info \"[-] 用户终端执行的历史命令记录 \"</span></span><br><span class=\"line\"><span class=\"string\">egrep -q \"^HISTSIZE\\W\\w+.*$\" /etc/profile &amp;&amp; sed -ri \"s/^HISTSIZE\\W\\w+.*$/HISTSIZE=101/\" /etc/profile || echo \"HISTSIZE=101\" &gt;&gt; /etc/profile</span></span><br><span class=\"line\"><span class=\"string\">sudo tee /etc/profile.d/history-record.sh &lt;&lt;'</span>EOF<span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\"># 历史命令执行记录文件路径</span></span><br><span class=\"line\"><span class=\"string\">LOGTIME=$(date +%Y%m%d-%H-%M-%S)</span></span><br><span class=\"line\"><span class=\"string\">export HISTFILE=\"/var/log/.history/$&#123;USER&#125;.$&#123;LOGTIME&#125;.history\"</span></span><br><span class=\"line\"><span class=\"string\">if [ ! -f $&#123;HISTFILE&#125; ];then</span></span><br><span class=\"line\"><span class=\"string\">  touch $&#123;HISTFILE&#125;</span></span><br><span class=\"line\"><span class=\"string\">fi</span></span><br><span class=\"line\"><span class=\"string\">chmod 600 /var/log/.history/$&#123;USER&#125;.$&#123;LOGTIME&#125;.history</span></span><br><span class=\"line\"><span class=\"string\"># 历史命令执行文件大小记录设置</span></span><br><span class=\"line\"><span class=\"string\">HISTFILESIZE=128</span></span><br><span class=\"line\"><span class=\"string\">HISTTIMEFORMAT=\"%F_%T $(whoami)#$(who -u am i 2&gt;/dev/null| awk '</span>&#123;<span class=\"built_in\">print</span> <span class=\"variable\">$NF</span>&#125;<span class=\"string\">'|sed -e '</span>s/[()]//g<span class=\"string\">'):\"</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># (8) GRUB 安全设置</span></span><br><span class=\"line\"><span class=\"string\">  log::info \"[-] 系统 GRUB 安全设置(防止物理接触从grub菜单中修改密码) \"</span></span><br><span class=\"line\"><span class=\"string\"># Grub 关键文件备份</span></span><br><span class=\"line\"><span class=\"string\">cp -a /etc/grub.d/00_header $&#123;BACKUPDIR&#125;/'</span>00_header<span class=\"string\">'$&#123;EXECTIME&#125;.bak</span></span><br><span class=\"line\"><span class=\"string\">cp -a /etc/grub.d/10_linux $&#123;BACKUPDIR&#125;/'</span>10_linux<span class=\"string\">'$&#123;EXECTIME&#125;.bak</span></span><br><span class=\"line\"><span class=\"string\"># 设置Grub菜单界面显示时间</span></span><br><span class=\"line\"><span class=\"string\">sed -i -e '</span>s|<span class=\"built_in\">set</span> timeout_style=<span class=\"variable\">$&#123;style&#125;</span>|<span class=\"comment\">#set timeout_style=$&#123;style&#125;|g' -e 's|set timeout=$&#123;timeout&#125;|set timeout=3|g' /etc/grub.d/00_header</span></span><br><span class=\"line\"><span class=\"comment\"># sed -i -e 's|GRUB_TIMEOUT_STYLE=hidden|#GRUB_TIMEOUT_STYLE=hidden|g' -e 's|GRUB_TIMEOUT=0|GRUB_TIMEOUT=3|g' /etc/default/grub</span></span><br><span class=\"line\"><span class=\"comment\"># grub 用户认证密码创建</span></span><br><span class=\"line\">sudo grub2-mkpasswd-pbkdf2</span><br><span class=\"line\"><span class=\"comment\"># 输入口令：</span></span><br><span class=\"line\"><span class=\"comment\"># Reeter password:n</span></span><br><span class=\"line\">PBKDF2 <span class=\"built_in\">hash</span> of your password is grub.pbkdf2.sha512.10000.A4A6B06EFAB660C11DD8EBC3BE73C5AB5D763ED937060477DB533B3E7D60F1DE66C3AC12DA795B46762AB8C4A1911B69B94FFCD88FB4499938150405DCB116F8.35D290F5B8D2677AEE5E8BAB4DB133206D417F99A26B14EAB8D0A5379DCD3632F40037388C9D2CA3001E0D6A8B74837549970EEEAEC3420CE38E2236DE1A8565</span><br><span class=\"line\"><span class=\"comment\"># 设置认证用户以及上面生成的password_pbkdf2认证密钥</span></span><br><span class=\"line\">tee -a /etc/grub.d/00_header &lt;&lt;<span class=\"string\">'END'</span></span><br><span class=\"line\">cat &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\"><span class=\"comment\"># GRUB Authentication</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> superusers=<span class=\"string\">\"grub\"</span></span><br><span class=\"line\">password_pbkdf2 grub grub.pbkdf2.sha512.10000.A4A6B06EFAB660C11DD8EBC3BE73C5AB5D763ED937060477DB533B3E7D60F1DE66C3AC12DA795B46762AB8C4A1911B69B94FFCD88FB4499938150405DCB116F8.35D290F5B8D2677AEE5E8BAB4DB133206D417F99A26B14EAB8D0A5379DCD3632F40037388C9D2CA3001E0D6A8B74837549970EEEAEC3420CE38E2236DE1A8565</span><br><span class=\"line\">EOF</span><br><span class=\"line\">END</span><br><span class=\"line\"><span class=\"comment\"># 设置进入正式系统不需要认证如进入单用户模式进行重置账号密码时需要进行认证。 （高敏感数据库系统不建议下述操作）</span></span><br><span class=\"line\"><span class=\"comment\"># 在 135 加入 -unrestricted ，例如, 此处与Ubuntu不同的是不加--user=grub</span></span><br><span class=\"line\"><span class=\"comment\"># 133 echo \"menuentry $(echo \"$title\" | grub_quote)' $&#123;CLASS&#125; \\$menuentry_id_option 'gnulinux-$version-$type-    $boot_device_id' &#123;\" | sed \"s/^/$submenu_indentation/\"</span></span><br><span class=\"line\"><span class=\"comment\"># 134   else</span></span><br><span class=\"line\"><span class=\"comment\"># 135 echo \"menuentry --unrestricted '$(echo \"$os\" | grub_quote)' $&#123;CLASS&#125; \\$menuentry_id_option 'gnulinux-simple-$boot_devic    e_id' &#123;\" | sed \"s/^/$submenu_indentation/\"</span></span><br><span class=\"line\">sed -i <span class=\"string\">'/echo \"$title\" | grub_quote/ &#123; s/menuentry /menuentry /;&#125;'</span> /etc/grub.d/10_linux</span><br><span class=\"line\">sed -i <span class=\"string\">'/echo \"$os\" | grub_quote/ &#123; s/menuentry /menuentry --unrestricted /;&#125;'</span> /etc/grub.d/10_linux</span><br><span class=\"line\"><span class=\"comment\"># CentOS 方式更新GRUB从而生成boot启动文件</span></span><br><span class=\"line\">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (9) 记录安全事件日志</span></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 记录安全事件日志\"</span></span><br><span class=\"line\">touch /var/<span class=\"built_in\">log</span>/.<span class=\"built_in\">history</span>/adm&amp;&gt;/dev/null; chmod 755 /var/<span class=\"built_in\">log</span>/.<span class=\"built_in\">history</span>/adm</span><br><span class=\"line\">semanage fcontext -a -t security_t <span class=\"string\">'/var/log/.history/adm'</span></span><br><span class=\"line\">restorecon -v <span class=\"string\">'/var/log/.history/adm'</span>&amp;&gt;/dev/null</span><br><span class=\"line\">egrep -q <span class=\"string\">\"^\\s*\\*\\.err;kern.debug;daemon.notice\\s+.+$\"</span> /etc/rsyslog.conf &amp;&amp; sed -ri <span class=\"string\">\"s/^\\s*\\*\\.err;kern.debug;daemon.notice\\s+.+$/*.err;kern.debug;daemon.notice  \\/var\\/log\\/.history\\/adm/\"</span> /etc/rsyslog.conf || <span class=\"built_in\">echo</span> <span class=\"string\">\"*.err;kern.debug;daemon.notice  /var/log/.history/adm\"</span> &gt;&gt; /etc/rsyslog.conf</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (10) 配置自动屏幕锁定（适用于具备图形界面的设备）, 非图形界面不需要执行</span></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 对于有图形界面的系统配置10分钟屏幕锁定\"</span></span><br><span class=\"line\"><span class=\"comment\"># gconftool-2 --direct \\</span></span><br><span class=\"line\"><span class=\"comment\"># --config-source xml:readwrite:/etc/gconf/gconf.xml.mandatory \\</span></span><br><span class=\"line\"><span class=\"comment\"># --type bool \\</span></span><br><span class=\"line\"><span class=\"comment\"># --set /apps/gnome-screensaver/idle_activation_enabled true \\</span></span><br><span class=\"line\"><span class=\"comment\"># --set /apps/gnome-screensaver/lock_enabled true \\</span></span><br><span class=\"line\"><span class=\"comment\"># --type int \\</span></span><br><span class=\"line\"><span class=\"comment\"># --set /apps/gnome-screensaver/idle_delay 10 \\</span></span><br><span class=\"line\"><span class=\"comment\"># --type string \\</span></span><br><span class=\"line\"><span class=\"comment\"># --set /apps/gnome-screensaver/mode blank-only</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (10) 关闭CentOS服务器中 SELINUX 以及防火墙端口放行</span></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] SELINUX 禁用以及系统防火墙规则设置 \"</span></span><br><span class=\"line\">sed -i <span class=\"string\">\"s/SELINUX=enforcing/SELINUX=disabled/g\"</span> /etc/selinux/config </span><br><span class=\"line\">semanage port -m -t ssh_port_t -p tcp 20211 <span class=\"comment\"># 添加sshd服务20211端口到SELinux</span></span><br><span class=\"line\">firewall-cmd --zone=public --add-port=20211/tcp --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-port=161/udp --permanent</span><br><span class=\"line\">firewall-cmd --reload</span><br><span class=\"line\">systemctl restart sshd</span><br><span class=\"line\">reboot</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: os::Operation </span></span><br><span class=\"line\"><span class=\"comment\">## 用途: 操作系统安全运维设置相关脚本</span></span><br><span class=\"line\"><span class=\"comment\">## 参数: 无</span></span><br><span class=\"line\">os::<span class=\"function\"><span class=\"title\">Operation</span></span> () &#123;</span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 操作系统安全运维设置相关脚本\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (0) 禁用ctrl+alt+del组合键对系统重启 (必须要配置,我曾入过坑)</span></span><br><span class=\"line\"> <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 禁用控制台ctrl+alt+del组合键重启\"</span></span><br><span class=\"line\">mv /usr/lib/systemd/system/ctrl-alt-del.target <span class=\"variable\">$&#123;BACKUPDIR&#125;</span>/ctrl-alt-del.target-<span class=\"variable\">$&#123;EXECTIME&#125;</span>.bak</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (1) 设置文件删除回收站别名</span></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 设置文件删除回收站别名(防止误删文件) \"</span></span><br><span class=\"line\">sudo tee -a  /etc/profile.d/alias.sh &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\"><span class=\"comment\"># User specific aliases and functions</span></span><br><span class=\"line\"><span class=\"comment\"># 删除回收站</span></span><br><span class=\"line\"><span class=\"comment\"># find ~/.trash -delete</span></span><br><span class=\"line\"><span class=\"comment\"># 删除空目录</span></span><br><span class=\"line\"><span class=\"comment\"># find ~/.trash -type d -delete</span></span><br><span class=\"line\"><span class=\"built_in\">alias</span> rm=<span class=\"string\">\"sh /usr/local/bin/remove.sh\"</span></span><br><span class=\"line\">EOF</span><br><span class=\"line\">sudo tee /usr/<span class=\"built_in\">local</span>/bin/remove.sh &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"><span class=\"comment\"># 定义回收站文件夹目录.trash</span></span><br><span class=\"line\">trash=<span class=\"string\">\"/.trash\"</span></span><br><span class=\"line\">deltime=$(date +%Y%m%d-%H-%M-%S)</span><br><span class=\"line\">TRASH_DIR=<span class=\"string\">\"<span class=\"variable\">$&#123;HOME&#125;</span><span class=\"variable\">$&#123;trash&#125;</span>/<span class=\"variable\">$&#123;deltime&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"comment\"># 建立回收站目录当不存在的时候</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -e <span class=\"variable\">$&#123;TRASH_DIR&#125;</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">   mkdir -p <span class=\"variable\">$&#123;TRASH_DIR&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> $*;<span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ <span class=\"string\">\"<span class=\"variable\">$i</span>\"</span> = <span class=\"string\">\"-rf\"</span> ];<span class=\"keyword\">then</span> <span class=\"built_in\">continue</span>;<span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"comment\"># 防止误操作</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ <span class=\"string\">\"<span class=\"variable\">$i</span>\"</span> = <span class=\"string\">\"/\"</span> ];<span class=\"keyword\">then</span> <span class=\"built_in\">echo</span> <span class=\"string\">'# Danger delete command, Not delete / directory!'</span>;<span class=\"built_in\">exit</span> -1;<span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"comment\">#定义秒时间戳</span></span><br><span class=\"line\">  STAMP=$(date +%s)</span><br><span class=\"line\">  <span class=\"comment\">#得到文件名称(非文件夹)，参考man basename</span></span><br><span class=\"line\">  fileName=$(basename <span class=\"variable\">$i</span>)</span><br><span class=\"line\">  <span class=\"comment\">#将输入的参数，对应文件mv至.trash目录，文件后缀，为当前的时间戳</span></span><br><span class=\"line\">  mv <span class=\"variable\">$i</span> <span class=\"variable\">$&#123;TRASH_DIR&#125;</span>/<span class=\"variable\">$&#123;fileName&#125;</span>.<span class=\"variable\">$&#123;STAMP&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\">EOF</span><br><span class=\"line\">sudo chmod +775 /usr/<span class=\"built_in\">local</span>/bin/remove.sh /etc/profile.d/alias.sh /etc/profile.d/<span class=\"built_in\">history</span>-record.sh</span><br><span class=\"line\">sudo chmod a+x /usr/<span class=\"built_in\">local</span>/bin/remove.sh /etc/profile.d/alias.sh /etc/profile.d/<span class=\"built_in\">history</span>-record.sh</span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile.d/alias.sh  /etc/profile.d/<span class=\"built_in\">history</span>-record.sh</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: os::DisableService</span></span><br><span class=\"line\"><span class=\"comment\">## 用途: 禁用与设置操作系统中某些服务(需要根据实际环境进行)</span></span><br><span class=\"line\"><span class=\"comment\">## 参数: 无</span></span><br><span class=\"line\">os::<span class=\"function\"><span class=\"title\">DisableService</span></span> () &#123;</span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 禁用操作系统中某些服务(需要根据实际环境进行配置)\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 配置禁用telnet服务\"</span></span><br><span class=\"line\">cp /etc/services <span class=\"variable\">$&#123;BACKUPDIR&#125;</span>/<span class=\"string\">'services-'</span><span class=\"variable\">$&#123;EXECTIME&#125;</span>.bak</span><br><span class=\"line\">egrep -q <span class=\"string\">\"^\\s*telnet\\s+\\d*.+$\"</span> /etc/services &amp;&amp; sed -ri <span class=\"string\">\"/^\\s*telnet\\s+\\d*.+$/s/^/# /\"</span> /etc/services</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 禁止匿名与root用户用户登录FTP\"</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -f /etc/vsftpd/vsftpd.conf ];<span class=\"keyword\">then</span></span><br><span class=\"line\">cp /etc/vsftpd/vsftpd.conf /etc/vsftpd/<span class=\"string\">'vsftpd.conf-'</span>`date +%Y%m%d`.bak</span><br><span class=\"line\">systemctl list-unit-files|grep vsftpd &gt; /dev/null &amp;&amp; sed -ri <span class=\"string\">\"/^\\s*anonymous_enable\\s*\\W+.+$/s/^/#/\"</span> /etc/vsftpd/vsftpd.conf &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">\"anonymous_enable=NO\"</span> &gt;&gt; /etc/vsftpd/vsftpd.conf</span><br><span class=\"line\">systemctl list-unit-files|grep vsftpd &gt; /dev/null &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">\"root\"</span> &gt;&gt; /etc/vsftpd/ftpusers</span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 限制FTP用户上传的文件所具有的权限\"</span></span><br><span class=\"line\">systemctl list-unit-files|grep vsftpd &gt; /dev/null &amp;&amp; sed -ri <span class=\"string\">\"/^\\s*write_enable\\s*\\W+.+$/s/^/#/\"</span> /etc/vsftpd/vsftpd.conf &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">\"write_enable=NO\"</span> &gt;&gt; /etc/vsftpd/vsftpd.conf</span><br><span class=\"line\">systemctl list-unit-files|grep vsftpd &gt; /dev/null &amp;&amp; sed -ri <span class=\"string\">\"/^\\s*ls_recurse_enable\\s*\\W+.+$/s/^/#/\"</span> /etc/vsftpd/vsftpd.conf &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">\"ls_recurse_enable=NO\"</span> &gt;&gt; /etc/vsftpd/vsftpd.conf</span><br><span class=\"line\">systemctl list-unit-files|grep vsftpd &gt; /dev/null &amp;&amp; sed -ri <span class=\"string\">\"/^\\s*anon_umask\\s*\\W+.+$/s/^/#/\"</span> /etc/vsftpd/vsftpd.conf &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">\"anon_umask=077\"</span> &gt;&gt; /etc/vsftpd/vsftpd.conf</span><br><span class=\"line\">systemctl list-unit-files|grep vsftpd &gt; /dev/null &amp;&amp; sed -ri <span class=\"string\">\"/^\\s*local_umask\\s*\\W+.+$/s/^/#/\"</span> /etc/vsftpd/vsftpd.conf &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">\"local_umask=022\"</span> &gt;&gt; /etc/vsftpd/vsftpd.conf</span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 限制FTP用户登录后能访问的目录\"</span></span><br><span class=\"line\">systemctl list-unit-files|grep vsftpd &gt; /dev/null &amp;&amp; sed -ri <span class=\"string\">\"/^\\s*chroot_local_user\\s*\\W+.+$/s/^/#/\"</span> /etc/vsftpd/vsftpd.conf &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">\"chroot_local_user=NO\"</span> &gt;&gt; /etc/vsftpd/vsftpd.conf</span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] FTP Banner 设置\"</span></span><br><span class=\"line\">systemctl list-unit-files|grep vsftpd &gt; /dev/null &amp;&amp; sed -ri <span class=\"string\">\"/^\\s*ftpd_banner\\s*\\W+.+$/s/^/#/\"</span> /etc/vsftpd/vsftpd.conf &amp;&amp; <span class=\"built_in\">echo</span> <span class=\"string\">\"ftpd_banner='Authorized only. All activity will be monitored and reported.'\"</span> &gt;&gt; /etc/vsftpd/vsftpd.conf</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 限制不必要的服务 (根据实际环境配置)\"</span></span><br><span class=\"line\"><span class=\"comment\"># systemctl disable rsh&amp;&gt;/dev/null 2&amp;&gt;/dev/null;systemctl disable talk&amp;&gt;/dev/null 2&amp;&gt;/dev/null;systemctl disable telnet&amp;&gt;/dev/null 2&amp;&gt;/dev/null;systemctl disable tftp&amp;&gt;/dev/null 2&amp;&gt;/dev/null;systemctl disable rsync&amp;&gt;/dev/null 2&amp;&gt;/dev/null;systemctl disable xinetd&amp;&gt;/dev/null 2&amp;&gt;/dev/null;systemctl disable nfs&amp;&gt;/dev/null 2&amp;&gt;/dev/null;systemctl disable nfslock&amp;&gt;/dev/null 2&amp;&gt;/dev/null</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 配置SNMP默认团体字\"</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -f /etc/snmp/snmpd.conf ];<span class=\"keyword\">then</span></span><br><span class=\"line\">cp /etc/snmp/snmpd.conf <span class=\"variable\">$&#123;BACKUPDIR&#125;</span>/<span class=\"string\">'snmpd.conf-'</span><span class=\"variable\">$&#123;EXECTIME&#125;</span>.bak</span><br><span class=\"line\">cat &gt; /etc/snmp/snmpd.conf &lt;&lt;EOF</span><br><span class=\"line\">com2sec <span class=\"variable\">$SNMP_user</span>  default    <span class=\"variable\">$SNMP_password</span>   </span><br><span class=\"line\">group   <span class=\"variable\">$SNMP_group</span>         v1           <span class=\"variable\">$SNMP_user</span></span><br><span class=\"line\">group   <span class=\"variable\">$SNMP_group</span>         v2c          <span class=\"variable\">$SNMP_user</span></span><br><span class=\"line\">view    systemview      included        .1                      80</span><br><span class=\"line\">view    systemview      included        .1.3.6.1.2.1.1</span><br><span class=\"line\">view    systemview      included        .1.3.6.1.2.1.25.1.1</span><br><span class=\"line\">view    <span class=\"variable\">$SNMP_view</span>        included        .1.3.6.1.4.1.2021.80</span><br><span class=\"line\">access  <span class=\"variable\">$SNMP_group</span>         <span class=\"string\">\"\"</span>      any       noauth    exact  systemview none none</span><br><span class=\"line\">access  <span class=\"variable\">$SNMP_group</span>         <span class=\"string\">\"\"</span>      any       noauth    exact  <span class=\"variable\">$SNMP_view</span>   none none</span><br><span class=\"line\">dontLogTCPWrappersConnects yes</span><br><span class=\"line\">trapcommunity <span class=\"variable\">$SNMP_password</span></span><br><span class=\"line\">authtrapenable 1</span><br><span class=\"line\">trap2sink <span class=\"variable\">$SNMP_ip</span></span><br><span class=\"line\">agentSecName <span class=\"variable\">$SNMP_user</span></span><br><span class=\"line\">rouser <span class=\"variable\">$SNMP_user</span></span><br><span class=\"line\">defaultMonitors yes</span><br><span class=\"line\">linkUpDownNotifications yes</span><br><span class=\"line\">EOF</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: os::optimizationn</span></span><br><span class=\"line\"><span class=\"comment\">## 用途: 操作系统优化设置(内核参数)</span></span><br><span class=\"line\"><span class=\"comment\">## 参数: 无</span></span><br><span class=\"line\">os::<span class=\"function\"><span class=\"title\">Optimizationn</span></span> () &#123;</span><br><span class=\"line\"><span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 正在进行操作系统内核参数优化设置.......\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (1) 系统内核参数的配置(/etc/sysctl.conf)</span></span><br><span class=\"line\"><span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 系统内核参数的配置/etc/sysctl.conf\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># /etc/sysctl.d/99-kubernetes-cri.conf</span></span><br><span class=\"line\">egrep -q <span class=\"string\">\"^(#)?net.ipv4.ip_forward.*\"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class=\"string\">\"s|^(#)?net.ipv4.ip_forward.*|net.ipv4.ip_forward = 1|g\"</span>  /etc/sysctl.conf || <span class=\"built_in\">echo</span> <span class=\"string\">\"net.ipv4.ip_forward = 1\"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class=\"line\"><span class=\"comment\"># egrep -q \"^(#)?net.bridge.bridge-nf-call-ip6tables.*\" /etc/sysctl.conf &amp;&amp; sed -ri \"s|^(#)?net.bridge.bridge-nf-call-ip6tables.*|net.bridge.bridge-nf-call-ip6tables = 1|g\" /etc/sysctl.conf || echo \"net.bridge.bridge-nf-call-ip6tables = 1\" &gt;&gt; /etc/sysctl.conf </span></span><br><span class=\"line\"><span class=\"comment\"># egrep -q \"^(#)?net.bridge.bridge-nf-call-iptables.*\" /etc/sysctl.conf &amp;&amp; sed -ri \"s|^(#)?net.bridge.bridge-nf-call-iptables.*|net.bridge.bridge-nf-call-iptables = 1|g\" /etc/sysctl.conf || echo \"net.bridge.bridge-nf-call-iptables = 1\" &gt;&gt; /etc/sysctl.conf</span></span><br><span class=\"line\">egrep -q <span class=\"string\">\"^(#)?net.ipv6.conf.all.disable_ipv6.*\"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class=\"string\">\"s|^(#)?net.ipv6.conf.all.disable_ipv6.*|net.ipv6.conf.all.disable_ipv6 = 1|g\"</span> /etc/sysctl.conf || <span class=\"built_in\">echo</span> <span class=\"string\">\"net.ipv6.conf.all.disable_ipv6 = 1\"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class=\"line\">egrep -q <span class=\"string\">\"^(#)?net.ipv6.conf.default.disable_ipv6.*\"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class=\"string\">\"s|^(#)?net.ipv6.conf.default.disable_ipv6.*|net.ipv6.conf.default.disable_ipv6 = 1|g\"</span> /etc/sysctl.conf || <span class=\"built_in\">echo</span> <span class=\"string\">\"net.ipv6.conf.default.disable_ipv6 = 1\"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class=\"line\">egrep -q <span class=\"string\">\"^(#)?net.ipv6.conf.lo.disable_ipv6.*\"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class=\"string\">\"s|^(#)?net.ipv6.conf.lo.disable_ipv6.*|net.ipv6.conf.lo.disable_ipv6 = 1|g\"</span> /etc/sysctl.conf || <span class=\"built_in\">echo</span> <span class=\"string\">\"net.ipv6.conf.lo.disable_ipv6 = 1\"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class=\"line\">egrep -q <span class=\"string\">\"^(#)?net.ipv6.conf.all.forwarding.*\"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class=\"string\">\"s|^(#)?net.ipv6.conf.all.forwarding.*|net.ipv6.conf.all.forwarding = 1|g\"</span> /etc/sysctl.conf || <span class=\"built_in\">echo</span> <span class=\"string\">\"net.ipv6.conf.all.forwarding = 1\"</span>  &gt;&gt; /etc/sysctl.conf</span><br><span class=\"line\">egrep -q <span class=\"string\">\"^(#)?vm.max_map_count.*\"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class=\"string\">\"s|^(#)?vm.max_map_count.*|vm.max_map_count = 262144|g\"</span> /etc/sysctl.conf || <span class=\"built_in\">echo</span> <span class=\"string\">\"vm.max_map_count = 262144\"</span>  &gt;&gt; /etc/sysctl.conf</span><br><span class=\"line\"></span><br><span class=\"line\">tee -a /etc/sysctl.conf &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\"><span class=\"comment\"># 调整提升服务器负载能力之外,还能够防御小流量的Dos、CC和SYN攻击</span></span><br><span class=\"line\">net.ipv4.tcp_syncookies = 1</span><br><span class=\"line\">net.ipv4.tcp_tw_reuse = 1</span><br><span class=\"line\"><span class=\"comment\"># net.ipv4.tcp_tw_recycle = 1</span></span><br><span class=\"line\">net.ipv4.tcp_fin_timeout = 60</span><br><span class=\"line\">net.ipv4.tcp_synack_retries = 1</span><br><span class=\"line\">net.ipv4.tcp_syn_retries = 1</span><br><span class=\"line\">net.ipv4.tcp_fastopen = 3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 优化TCP的可使用端口范围及提升服务器并发能力(注意一般流量小的服务器上没必要设置如下参数)</span></span><br><span class=\"line\">net.ipv4.tcp_keepalive_time = 1200</span><br><span class=\"line\">net.ipv4.tcp_max_syn_backlog = 8192</span><br><span class=\"line\">net.ipv4.tcp_max_tw_buckets = 5000</span><br><span class=\"line\">net.ipv4.ip_local_port_range = 1024 65535</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 优化核套接字TCP的缓存区</span></span><br><span class=\"line\">net.core.netdev_max_backlog = 8192</span><br><span class=\"line\">net.core.somaxconn = 8192</span><br><span class=\"line\">net.core.rmem_max = 12582912</span><br><span class=\"line\">net.core.rmem_default = 6291456</span><br><span class=\"line\">net.core.wmem_max = 12582912</span><br><span class=\"line\">net.core.wmem_default = 6291456</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2) Linux 系统的最大进程数和最大文件打开数限制</span></span><br><span class=\"line\"><span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] Linux 系统的最大进程数和最大文件打开数限制 \"</span></span><br><span class=\"line\">egrep -q <span class=\"string\">\"^\\s*ulimit -HSn\\s+\\w+.*$\"</span> /etc/profile &amp;&amp; sed -ri <span class=\"string\">\"s/^\\s*ulimit -HSn\\s+\\w+.*$/ulimit -HSn 65535/\"</span> /etc/profile || <span class=\"built_in\">echo</span> <span class=\"string\">\"ulimit -HSn 65535\"</span> &gt;&gt; /etc/profile</span><br><span class=\"line\">egrep -q <span class=\"string\">\"^\\s*ulimit -HSu\\s+\\w+.*$\"</span> /etc/profile &amp;&amp; sed -ri <span class=\"string\">\"s/^\\s*ulimit -HSu\\s+\\w+.*$/ulimit -HSu 65535/\"</span> /etc/profile || <span class=\"built_in\">echo</span> <span class=\"string\">\"ulimit -HSu 65535\"</span> &gt;&gt; /etc/profile</span><br><span class=\"line\">sed -i <span class=\"string\">\"/# End/i *  soft  nofile  65535\"</span> /etc/security/limits.conf</span><br><span class=\"line\">sed -i <span class=\"string\">\"/# End/i *  hard  nofile  65535\"</span> /etc/security/limits.conf</span><br><span class=\"line\">sed -i <span class=\"string\">\"/# End/i *  soft  nproc   65535\"</span> /etc/security/limits.conf</span><br><span class=\"line\">sed -i <span class=\"string\">\"/# End/i *  hard  nproc   65535\"</span> /etc/security/limits.conf</span><br><span class=\"line\">sysctl -p</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 需重启生效</span></span><br><span class=\"line\">reboot</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: os::Swap</span></span><br><span class=\"line\"><span class=\"comment\">## 用途: Liunx 系统创建SWAP交换分区(默认2G)</span></span><br><span class=\"line\"><span class=\"comment\">## 参数: $1(几G)</span></span><br><span class=\"line\">os::<span class=\"function\"><span class=\"title\">Swap</span></span> () &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ -e <span class=\"variable\">$1</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    sudo dd <span class=\"keyword\">if</span>=/dev/zero of=/swapfile bs=1024 count=2097152   <span class=\"comment\"># 2G Swap 分区 1024 * 1024 , centos 以 1000 为标准</span></span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    number=$(<span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$&#123;1&#125;</span>*1024*1024\"</span>|bc)</span><br><span class=\"line\">    sudo dd <span class=\"keyword\">if</span>=/dev/zero of=/swapfile bs=1024 count=<span class=\"variable\">$&#123;number&#125;</span>   <span class=\"comment\"># 2G Swap 分区 1024 * 1024 , centos 以 1000 为标准</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">  sudo mkswap /swapfile &amp;&amp; sudo swapon /swapfile</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ $(grep -c <span class=\"string\">\"/swapfile\"</span> /etc/fstab) -eq 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">sudo tee -a /etc/fstab &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\">/swapfile swap swap default 0 0</span><br><span class=\"line\">EOF</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\">sudo swapon --show &amp;&amp; sudo free -h</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: software::Java</span></span><br><span class=\"line\"><span class=\"comment\">## 用途: java 环境安装与设置 </span></span><br><span class=\"line\"><span class=\"comment\">## 参数: 无</span></span><br><span class=\"line\">software::<span class=\"function\"><span class=\"title\">Java</span></span> () &#123;</span><br><span class=\"line\">  <span class=\"comment\"># 基础变量</span></span><br><span class=\"line\">  JAVA_FILE=<span class=\"string\">\"/root/Downloads/jdk-8u211-linux-x64.tar.gz\"</span></span><br><span class=\"line\">  JAVA_SRC=<span class=\"string\">\"/usr/local/\"</span></span><br><span class=\"line\">  JAVA_DIR=<span class=\"string\">\"/usr/local/jdk\"</span></span><br><span class=\"line\">  <span class=\"comment\"># 环境配置</span></span><br><span class=\"line\">  sudo tar -zxvf <span class=\"variable\">$&#123;JAVA_FILE&#125;</span> -C <span class=\"variable\">$&#123;JAVA_SRC&#125;</span></span><br><span class=\"line\">  sudo rm -rf /usr/<span class=\"built_in\">local</span>/jdk </span><br><span class=\"line\">  JAVA_SRC=$(ls /usr/<span class=\"built_in\">local</span>/ | grep <span class=\"string\">\"jdk\"</span>)</span><br><span class=\"line\">  sudo ln -s <span class=\"variable\">$&#123;JAVA_SRC&#125;</span> <span class=\"variable\">$&#123;JAVA_DIR&#125;</span></span><br><span class=\"line\">  <span class=\"built_in\">export</span> PATH=<span class=\"variable\">$&#123;JAVA_DIR&#125;</span>/bin:<span class=\"variable\">$&#123;PATH&#125;</span></span><br><span class=\"line\">  sudo cp /etc/profile /etc/profile.$(date +%Y%m%d-%H%M%S).bak</span><br><span class=\"line\">  sudo tee -a /etc/profile &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> JAVA_HOME=/usr/<span class=\"built_in\">local</span>/jdk</span><br><span class=\"line\"><span class=\"built_in\">export</span> JRE_HOME=/usr/<span class=\"built_in\">local</span>/jdk/jre</span><br><span class=\"line\"><span class=\"built_in\">export</span> CLASSPATH=.:<span class=\"variable\">$JAVA_HOME</span>/lib/dt.jar:<span class=\"variable\">$JAVA_HOME</span>/lib/tools.jar</span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$JAVA_HOME</span>/bin:<span class=\"variable\">$PATH</span></span><br><span class=\"line\">EOF</span><br><span class=\"line\">  java -version</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: disk::Lvsmanager</span></span><br><span class=\"line\"><span class=\"comment\">## 用途: CentOS7 操作系统磁盘 LVS 逻辑卷添加与配置(扩容流程)</span></span><br><span class=\"line\"><span class=\"comment\">## 参数: 无</span></span><br><span class=\"line\">disk::<span class=\"function\"><span class=\"title\">lvsmanager</span></span> () &#123;</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"\\n分区信息:\"</span></span><br><span class=\"line\">  sudo df -Th</span><br><span class=\"line\">  sudo lsblk</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n 磁盘信息：\"</span></span><br><span class=\"line\">  sudo fdisk -l</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n PV物理卷查看：\"</span></span><br><span class=\"line\">  sudo pvscan</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n vgs虚拟卷查看：\"</span></span><br><span class=\"line\">  sudo vgs</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n lvscan逻辑卷扫描:\"</span></span><br><span class=\"line\">  sudo lvscan</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n 分区扩展\"</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"CentOS \\n lvextend -L +24G /dev/centos/root\"</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"lsblk\"</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">\"Centos \\n # xfs_growfs /dev/mapper/centos-root\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安全加固过程临时文件清理为基线镜像做准备</span></span><br><span class=\"line\"><span class=\"built_in\">unalias</span> rm</span><br><span class=\"line\">find ~/.trash/* -delete</span><br><span class=\"line\">find /home/ -<span class=\"built_in\">type</span> d -name .trash -<span class=\"built_in\">exec</span> find &#123;&#125; -delete \\;</span><br><span class=\"line\">find /var/<span class=\"built_in\">log</span> -name <span class=\"string\">\"*.gz\"</span> -delete</span><br><span class=\"line\">find /var/<span class=\"built_in\">log</span> -name <span class=\"string\">\"*log.*\"</span> -delete</span><br><span class=\"line\">find /var/<span class=\"built_in\">log</span> -name <span class=\"string\">\"vmware-*.*.log\"</span> -delete</span><br><span class=\"line\">find /var/<span class=\"built_in\">log</span> -name <span class=\"string\">\"*.log\"</span> -<span class=\"built_in\">exec</span> truncate -s 0 &#123;&#125; \\;</span><br><span class=\"line\">find /var/<span class=\"built_in\">log</span> -name <span class=\"string\">\"system@*\"</span> -delete</span><br><span class=\"line\">find /var/<span class=\"built_in\">log</span> -name <span class=\"string\">\"user-1000@*\"</span> -delete</span><br><span class=\"line\">find /tmp/* -delete</span><br></pre></td></tr></table></figure>\n<p>至此 CentOS7 安全加固脚本完毕。</p>\n<p>原文地址: Linux与Windows服务器操作系统安全防御实践指南 ( <a href=\"https://blog.weiyigeek.top/2020/10-13-585.html\">https://blog.weiyigeek.top/2020/10-13-585.html</a> )</p>\n<hr>\n<h2 id=\"0x03-Ubuntu-20-04-系统初始化安全加固\"><a href=\"#0x03-Ubuntu-20-04-系统初始化安全加固\" class=\"headerlink\" title=\"0x03 Ubuntu 20.04 系统初始化安全加固\"></a>0x03 Ubuntu 20.04 系统初始化安全加固</h2><p>描述: 适用于企业内部 Ubuntu 系列服务器操作系统初始化、系统安全加固脚本，内容包含了，网络初始化设置，软件更新源替换以及内核版本升级 ,时间时区初始化设置 系统安全加固(等保三级操作系统主机检查项) 安全运维设置 系统内核参数 常用软件安装等 一系列的操作直接开箱即用, 将跑过该脚本的机器可以克隆成为作为线上生产环境的基线模板。</p>\n<p>原文链接: 完整的Windows与Linux服务器系统安全加固实践和基线检测脚本（等保2.0）( <a href=\"https://mp.weixin.qq.com/s/CDGzTzrAk9vJtbH4BisSlw\" target=\"_blank\" rel=\"noopener\">https://mp.weixin.qq.com/s/CDGzTzrAk9vJtbH4BisSlw</a> )</p>\n<p><strong>脚本适用说明:</strong><br>Ubuntu 20.04 (已测试)<br>Ubuntu 18.04 (部分适用)</p>\n<p><strong>Ubuntu 安全加固效果</strong><br><figure class=\"image-box\">\n                <img src=\"https://p0.ssl.qhimg.com/t0114314dc35eeaf325.png\" alt=\"Ubuntu 安全加固效果\" title=\"\" class=\"\">\n                <p>Ubuntu 安全加固效果</p>\n            </figure></p>\n<p>项目地址: <a href=\"https://github.com/WeiyiGeek/SecOpsDev/tree/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Ubuntu\" target=\"_blank\" rel=\"noopener\">https://github.com/WeiyiGeek/SecOpsDev/tree/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Ubuntu</a></p>\n<p>【<figure class=\"image-box\">\n                <img src=\"https://github.com/WeiyiGeek/SecOpsDev/network\" alt=\"GitHub Repo stars](https://img.shields.io/github/stars/weiyigeek/SecOpsDev?style=social)  [![GitHub forks](https://img.shields.io/github/forks/WeiyiGeek/SecOpsDev?style=social)\" title=\"\" class=\"\">\n                <p>GitHub Repo stars](https://img.shields.io/github/stars/weiyigeek/SecOpsDev?style=social)  [![GitHub forks](https://img.shields.io/github/forks/WeiyiGeek/SecOpsDev?style=social)</p>\n            </figure> 】，欢迎大家 Star 与 Fork 。</p>\n<p><br></p>\n<p><strong>Ubuntu TLS Security Initiate</strong><br>Link: <a href=\"https://github.com/WeiyiGeek/SecOpsDev/blob/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Ubuntu/Ubuntu-InitializeSecurity.sh\" target=\"_blank\" rel=\"noopener\">https://github.com/WeiyiGeek/SecOpsDev/blob/master/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Ubuntu/Ubuntu-InitializeSecurity.sh</a></p>\n<p>温馨提示: 使用脚本时请按照你的需求调用相应函数即可，默认未调用任何函数。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># @Author: WeiyiGeek</span></span><br><span class=\"line\"><span class=\"comment\"># @Description: Ubuntu TLS Security Initiate</span></span><br><span class=\"line\"><span class=\"comment\"># @Create Time:  2019年9月1日 16:43:33</span></span><br><span class=\"line\"><span class=\"comment\"># @Last Modified time: 2021-11-15 11:06:31</span></span><br><span class=\"line\"><span class=\"comment\"># @E-mail: master@weiyigeek.top</span></span><br><span class=\"line\"><span class=\"comment\"># @Blog: https://www.weiyigeek.top</span></span><br><span class=\"line\"><span class=\"comment\"># @wechat: WeiyiGeeker</span></span><br><span class=\"line\"><span class=\"comment\"># @Github: https://github.com/WeiyiGeek/SecOpsDev/tree/master/OS-操作系统/Linux/</span></span><br><span class=\"line\"><span class=\"comment\"># @Version: 3.3</span></span><br><span class=\"line\"><span class=\"comment\">#-------------------------------------------------#</span></span><br><span class=\"line\"><span class=\"comment\"># 脚本主要功能说明:</span></span><br><span class=\"line\"><span class=\"comment\"># (1) Ubuntu 系统初始化操作包括IP地址设置、基础软件包更新以及安装加固。</span></span><br><span class=\"line\"><span class=\"comment\"># (2) Ubuntu 系统容器以及JDK相关环境安装。</span></span><br><span class=\"line\"><span class=\"comment\"># (3) Ubuntu 系统中异常错误日志解决。</span></span><br><span class=\"line\"><span class=\"comment\"># (4) Ubuntu 系统常规服务安装配置，加入数据备份目录。</span></span><br><span class=\"line\"><span class=\"comment\"># (5) Ubuntu 脚本错误优化、添加禁用cloud-init</span></span><br><span class=\"line\"><span class=\"comment\">#-------------------------------------------------#</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 系统全局变量定义</span></span><br><span class=\"line\">HOSTNAME=Ubuntu-Security-Template</span><br><span class=\"line\">IP=192.168.1.2</span><br><span class=\"line\">GATEWAY=192.168.1.1</span><br><span class=\"line\">DNSIP=(<span class=\"string\">\"223.5.5.5\"</span> <span class=\"string\">\"223.6.6.6\"</span>)</span><br><span class=\"line\">SSHPORT=20211</span><br><span class=\"line\">DefaultUser=<span class=\"string\">\"WeiyiGeek\"</span>  <span class=\"comment\"># 系统创建的用户名称非root用户</span></span><br><span class=\"line\">ROOTPASS=WeiyiGeek       <span class=\"comment\"># 密码建议12位以上且包含数字、大小写字母以及特殊字符。</span></span><br><span class=\"line\">APPPASS=WeiyiGeek</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: err 、info 、warning</span></span><br><span class=\"line\"><span class=\"comment\">## 用途：全局Log信息打印函数</span></span><br><span class=\"line\"><span class=\"comment\">## 参数: $@</span></span><br><span class=\"line\"><span class=\"built_in\">log</span>::<span class=\"function\"><span class=\"title\">err</span></span>() &#123;</span><br><span class=\"line\">  <span class=\"built_in\">printf</span> <span class=\"string\">\"[<span class=\"variable\">$(date +'%Y-%m-%dT%H:%M:%S')</span>]: \\033[31mERROR: <span class=\"variable\">$@</span> \\033[0m\\n\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">log</span>::<span class=\"function\"><span class=\"title\">info</span></span>() &#123;</span><br><span class=\"line\">  <span class=\"built_in\">printf</span> <span class=\"string\">\"[<span class=\"variable\">$(date +'%Y-%m-%dT%H:%M:%S')</span>]: \\033[32mINFO: <span class=\"variable\">$@</span> \\033[0m\\n\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">log</span>::<span class=\"function\"><span class=\"title\">warning</span></span>() &#123;</span><br><span class=\"line\">  <span class=\"built_in\">printf</span> <span class=\"string\">\"[<span class=\"variable\">$(date +'%Y-%m-%dT%H:%M:%S')</span>]: \\033[33mWARNING: <span class=\"variable\">$@</span> \\033[0m\\n\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: os::Network</span></span><br><span class=\"line\"><span class=\"comment\">## 用途: 网络配置相关操作脚本包括(IP地址修改)</span></span><br><span class=\"line\"><span class=\"comment\">## 参数: 无</span></span><br><span class=\"line\">os::<span class=\"function\"><span class=\"title\">Network</span></span> () &#123;</span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 操作系统网络配置相关脚本,开始执行.....\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (1) IP地址与主机名称设置</span></span><br><span class=\"line\">sudo cp /etc/netplan/00-installer-config.yaml&#123;,.bak&#125;</span><br><span class=\"line\">mkdir /opt/init/</span><br><span class=\"line\">sudo tee /opt/init/network.sh &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\">CURRENT_IP=$(hostname -I | cut -f 1 -d <span class=\"string\">\" \"</span>)</span><br><span class=\"line\">GATEWAY=$(hostname -I | cut -f 1,2,3 -d <span class=\"string\">\".\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">if</span> [[ <span class=\"variable\">$#</span> -lt 3 ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"Usage: <span class=\"variable\">$0</span> IP Gateway Hostname\"</span></span><br><span class=\"line\">  <span class=\"built_in\">exit</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"IP:<span class=\"variable\">$&#123;1&#125;</span> # GATEWAY:<span class=\"variable\">$&#123;2&#125;</span> # HOSTNAME:<span class=\"variable\">$&#123;3&#125;</span>\"</span></span><br><span class=\"line\">sudo sed -i <span class=\"string\">\"s#<span class=\"variable\">$&#123;CURRENT_IP&#125;</span>#<span class=\"variable\">$&#123;1&#125;</span>#g\"</span> /etc/netplan/00-installer-config.yaml</span><br><span class=\"line\">sudo sed -i <span class=\"string\">\"s#<span class=\"variable\">$&#123;GATEWAY&#125;</span>.1#<span class=\"variable\">$&#123;2&#125;</span>#g\"</span> /etc/netplan/00-installer-config.yaml</span><br><span class=\"line\">sudo hostnamectl <span class=\"built_in\">set</span>-hostname <span class=\"variable\">$&#123;3&#125;</span> </span><br><span class=\"line\">sudo netplan apply</span><br><span class=\"line\">EOF</span><br><span class=\"line\">sudo chmod +x /opt/init/network.sh</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2) 本地主机名解析设置</span></span><br><span class=\"line\">sed -i <span class=\"string\">\"s/127.0.1.1\\s.\\w.*$/127.0.1.1 <span class=\"variable\">$&#123;HOSTNAME&#125;</span>/g\"</span> /etc/hosts</span><br><span class=\"line\">grep -q <span class=\"string\">\"^\\$(hostname -I)\\s.\\w.*$\"</span> /etc/hosts &amp;&amp; sed -i <span class=\"string\">\"s/\\$(hostname -I)\\s.\\w.*$/<span class=\"variable\">$&#123;IPADDR&#125;</span> <span class=\"variable\">$&#123;HOSTNAME&#125;</span>\"</span> /etc/hosts || <span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$&#123;IPADDR&#125;</span> <span class=\"variable\">$&#123;HOSTNAME&#125;</span>\"</span> &gt;&gt; /etc/hosts</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (3) 系统DNS域名解析服务设置</span></span><br><span class=\"line\">cp -a /etc/resolv.conf&#123;,.bak&#125;</span><br><span class=\"line\"><span class=\"keyword\">for</span> dns <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;DNSIP[@]&#125;</span>;<span class=\"keyword\">do</span> <span class=\"built_in\">echo</span> <span class=\"string\">\"nameserver <span class=\"variable\">$&#123;dns&#125;</span>\"</span> &gt;&gt; /etc/resolv.conf;<span class=\"keyword\">done</span></span><br><span class=\"line\"></span><br><span class=\"line\">sudo /opt/init/network.sh <span class=\"variable\">$&#123;IP&#125;</span> <span class=\"variable\">$&#123;GATEWAY&#125;</span> <span class=\"variable\">$&#123;HOSTNAME&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">log</span>::info <span class=\"string\">\"[*] network configure modifiy successful! restarting Network.........\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: os::Software</span></span><br><span class=\"line\"><span class=\"comment\">## 用途: 操作系统软件包管理及更新源配置</span></span><br><span class=\"line\"><span class=\"comment\">## 参数: 无</span></span><br><span class=\"line\">os::<span class=\"function\"><span class=\"title\">Software</span></span> () &#123;</span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 操作系统软件包管理及更新源配置相关脚本,开始执行.....\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (1) 卸载多余软件，例如 snap 软件及其服务</span></span><br><span class=\"line\">sudo systemctl stop snapd snapd.socket <span class=\"comment\">#停止snapd相关的进程服务</span></span><br><span class=\"line\">sudo apt autoremove --purge -y snapd</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo rm -rf ~/snap /snap /var/snap /var/lib/snapd /var/cache/snapd /run/snapd</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2) 软件源设置与系统更新</span></span><br><span class=\"line\">sudo cp /etc/apt/sources.list&#123;,.bak&#125;</span><br><span class=\"line\">sudo tee /etc/apt/sources.list &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\"><span class=\"comment\">#阿里云Mirrors - Ubuntu</span></span><br><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (3) 内核版本升级以及常规软件安装</span></span><br><span class=\"line\">sudo apt autoclean &amp;&amp; sudo apt update &amp;&amp; sudo apt upgrade -y</span><br><span class=\"line\">sudo apt install -y nano vim git unzip wget ntpdate dos2unix net-tools tree htop ncdu nload sysstat psmisc bash-completion fail2ban  gcc g++ make jq nfs-common rpcbind libpam-cracklib</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (4) 代理方式进行更新</span></span><br><span class=\"line\"><span class=\"comment\"># sudo apt autoclean &amp;&amp; sudo apt -o Acquire::http::proxy=\"http://proxy.weiyigeek.top/\" update &amp;&amp; sudo apt -o Acquire::http::proxy=\"http://proxy.weiyigeek.top\" upgrade -y</span></span><br><span class=\"line\"><span class=\"comment\"># sudo apt install -o Acquire::http::proxy=\"http://proxy.weiyigeek.top/\" -y nano vim git unzip wget ntpdate dos2unix net-tools tree htop ncdu nload sysstat psmisc bash-completion fail2ban</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: os::TimedataZone</span></span><br><span class=\"line\"><span class=\"comment\">## 用途: 操作系统时间与时区同步配置</span></span><br><span class=\"line\"><span class=\"comment\">## 参数: 无</span></span><br><span class=\"line\">os::<span class=\"function\"><span class=\"title\">TimedataZone</span></span> () &#123;</span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[*] 操作系统系统时间时区配置相关脚本,开始执行.....\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (1) 时间同步服务端容器(可选也可以用外部ntp服务器) : docker run -d --rm --cap-add SYS_TIME -e ALLOW_CIDR=0.0.0.0/0 -p 123:123/udp geoffh1977/chrony</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"同步前的时间: <span class=\"variable\">$(date -R)</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方式1.Chrony 客户端配置</span></span><br><span class=\"line\">apt install -y chrony</span><br><span class=\"line\">grep -q <span class=\"string\">\"192.168.12.254\"</span> /etc/chrony/chrony.conf || sudo tee -a /etc/chrony/chrony.conf &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\">pool 192.168.10.254 iburst maxsources 1</span><br><span class=\"line\">pool 192.168.12.254 iburst maxsources 1</span><br><span class=\"line\">pool 192.168.4.254 iburst maxsources 1</span><br><span class=\"line\">pool ntp.aliyun.com iburst maxsources 4</span><br><span class=\"line\">keyfile /etc/chrony/chrony.keys</span><br><span class=\"line\">driftfile /var/lib/chrony/chrony.drift</span><br><span class=\"line\">logdir /var/<span class=\"built_in\">log</span>/chrony</span><br><span class=\"line\">maxupdateskew 100.0</span><br><span class=\"line\">rtcsync</span><br><span class=\"line\"><span class=\"comment\"># 允许跳跃式校时 如果在前 3 次校时中时间差大于 1.0s</span></span><br><span class=\"line\">makestep 1 3</span><br><span class=\"line\">EOF</span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> chrony &amp;&amp; systemctl restart chrony &amp;&amp; systemctl status chrony -l</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方式2</span></span><br><span class=\"line\"><span class=\"comment\"># sudo ntpdate 192.168.10.254 || sudo ntpdate 192.168.12.215 || sudo ntpdate ntp1.aliyun.com</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方式3</span></span><br><span class=\"line\"><span class=\"comment\"># echo 'NTP=192.168.10.254 192.168.4.254' &gt;&gt; /etc/systemd/timesyncd.conf</span></span><br><span class=\"line\"><span class=\"comment\"># echo 'FallbackNTP=ntp.aliyun.com' &gt;&gt; /etc/systemd/timesyncd.conf</span></span><br><span class=\"line\"><span class=\"comment\"># systemctl restart systemd-timesyncd.service</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2) 时区与地区设置: </span></span><br><span class=\"line\">sudo cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class=\"line\">sudo timedatectl <span class=\"built_in\">set</span>-timezone Asia/Shanghai</span><br><span class=\"line\"><span class=\"comment\"># sudo dpkg-reconfigure tzdata  # 修改确认</span></span><br><span class=\"line\"><span class=\"comment\"># sudo bash -c \"echo 'Asia/Shanghai' &gt; /etc/timezone\" # 与上一条命令一样</span></span><br><span class=\"line\"><span class=\"comment\"># 将当前的 UTC 时间写入硬件时钟 (硬件时间默认为UTC)</span></span><br><span class=\"line\">sudo timedatectl <span class=\"built_in\">set</span>-local-rtc 0</span><br><span class=\"line\"><span class=\"comment\"># 启用NTP时间同步：</span></span><br><span class=\"line\">sudo timedatectl <span class=\"built_in\">set</span>-ntp yes</span><br><span class=\"line\"><span class=\"comment\"># 校准时间服务器-时间同步(推荐使用chronyc进行平滑同步)</span></span><br><span class=\"line\">sudo chronyc tracking</span><br><span class=\"line\"><span class=\"comment\"># 手动校准-强制更新时间</span></span><br><span class=\"line\"><span class=\"comment\"># chronyc -a makestep</span></span><br><span class=\"line\"><span class=\"comment\"># 系统时钟同步硬件时钟</span></span><br><span class=\"line\"><span class=\"comment\"># sudo hwclock --systohc</span></span><br><span class=\"line\">sudo hwclock -w</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (3) 重启依赖于系统时间的服务</span></span><br><span class=\"line\">sudo systemctl restart rsyslog.service cron.service</span><br><span class=\"line\"><span class=\"built_in\">log</span>::info <span class=\"string\">\"[*] Tie confmigure modifiy successful! restarting chronyd rsyslog.service crond.service.........\"</span></span><br><span class=\"line\">timedatectl</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: os::Security</span></span><br><span class=\"line\"><span class=\"comment\">## 用途: 操作系统安全加固配置脚本(符合等保要求-三级要求)</span></span><br><span class=\"line\"><span class=\"comment\">## 参数: 无</span></span><br><span class=\"line\">os::<span class=\"function\"><span class=\"title\">Security</span></span> () &#123;</span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"正在进行-&gt;操作系统安全加固(符合等保要求-三级要求)配置\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (0) 系统用户核查配置</span></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 锁定或者删除多余的系统账户以及创建低权限用户\"</span></span><br><span class=\"line\">userdel -r lxd</span><br><span class=\"line\">groupdel lxd</span><br><span class=\"line\">defaultuser=(root daemon bin sys games man lp mail news uucp proxy www-data backup list irc gnats nobody systemd-network systemd-resolve systemd-timesync messagebus syslog _apt tss uuidd tcpdump landscape pollinate usbmux sshd systemd-coredump _chrony)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> $(cat /etc/passwd | cut -d <span class=\"string\">\":\"</span> -f 1,7);<span class=\"keyword\">do</span></span><br><span class=\"line\">  flag=0; name=<span class=\"variable\">$&#123;i%%:*&#125;</span>; terminal=<span class=\"variable\">$&#123;i##*:&#125;</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [[ <span class=\"string\">\"<span class=\"variable\">$&#123;terminal&#125;</span>\"</span> == <span class=\"string\">\"/bin/bash\"</span> || <span class=\"string\">\"<span class=\"variable\">$&#123;terminal&#125;</span>\"</span> == <span class=\"string\">\"/bin/sh\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">log</span>::warning <span class=\"string\">\"<span class=\"variable\">$&#123;i&#125;</span> 用户，shell终端为 /bin/bash 或者 /bin/sh\"</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"variable\">$&#123;defaultuser[@]&#125;</span>;<span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ <span class=\"string\">\"<span class=\"variable\">$&#123;name&#125;</span>\"</span> == <span class=\"string\">\"<span class=\"variable\">$&#123;j&#125;</span>\"</span> ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">      flag=1</span><br><span class=\"line\">      <span class=\"built_in\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"keyword\">done</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [[ <span class=\"variable\">$flag</span> -eq 0 ]];<span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">log</span>::warning <span class=\"string\">\"<span class=\"variable\">$&#123;i&#125;</span> 非默认用户\"</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\">cp /etc/shadow /etc/shadow-`date +%Y%m%d`.bak</span><br><span class=\"line\">passwd -l adm&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l daemon&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l bin&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l sys&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l lp&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l uucp&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l nuucp&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l smmsplp&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l mail&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l operator&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l games&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l gopher&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l ftp&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l nobody&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l nobody4&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l noaccess&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l listen&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l webservd&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l rpm&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l dbus&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l avahi&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l mailnull&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l nscd&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l vcsa&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l rpc&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l rpcuser&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l nfs&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l sshd&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l pcap&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l ntp&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l haldaemon&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l distcache&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l webalizer&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l squid&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l xfs&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l gdm&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l sabayon&amp;&gt;/dev/null 2&amp;&gt;/dev/null; passwd -l named&amp;&gt;/dev/null 2&amp;&gt;/dev/null</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2) 用户密码设置和口令策略设置</span></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-]  配置满足策略的root管理员密码 \"</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span>  <span class=\"variable\">$&#123;ROOTPASS&#125;</span> | passwd --stdin root</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 配置满足策略的app普通用户密码(根据需求配置)\"</span></span><br><span class=\"line\">groupadd application</span><br><span class=\"line\">useradd -m -s /bin/bash -c <span class=\"string\">\"application primary user\"</span> -g application app </span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;APPPASS&#125;</span> | passwd --stdin app</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 强制用户在下次登录时更改密码 \"</span></span><br><span class=\"line\">chage -d 0 -m 0 -M 90 -W 15 root &amp;&amp; passwd --expire root </span><br><span class=\"line\">chage -d 0 -m 0 -M 90 -W 15 <span class=\"variable\">$&#123;DefaultUser&#125;</span> &amp;&amp; passwd --expire <span class=\"variable\">$&#123;DefaultUser&#125;</span> </span><br><span class=\"line\">chage -d 0 -m 0 -M 90 -W 15 app &amp;&amp; passwd --expire app</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 用户口令复杂性策略设置 (密码过期周期0~90、到期前15天提示、密码长度至少15、复杂度设置至少有一个大小写、数字、特殊字符、密码三次不能一样、尝试次数为三次)\"</span></span><br><span class=\"line\">egrep -q <span class=\"string\">\"^\\s*PASS_MIN_DAYS\\s+\\S*(\\s*#.*)?\\s*$\"</span> /etc/login.defs &amp;&amp; sed -ri <span class=\"string\">\"s/^(\\s*)PASS_MIN_DAYS\\s+\\S*(\\s*#.*)?\\s*$/\\PASS_MIN_DAYS  0/\"</span> /etc/login.defs || <span class=\"built_in\">echo</span> <span class=\"string\">\"PASS_MIN_DAYS  0\"</span> &gt;&gt; /etc/login.defs</span><br><span class=\"line\">egrep -q <span class=\"string\">\"^\\s*PASS_MAX_DAYS\\s+\\S*(\\s*#.*)?\\s*$\"</span> /etc/login.defs &amp;&amp; sed -ri <span class=\"string\">\"s/^(\\s*)PASS_MAX_DAYS\\s+\\S*(\\s*#.*)?\\s*$/\\PASS_MAX_DAYS  90/\"</span> /etc/login.defs || <span class=\"built_in\">echo</span> <span class=\"string\">\"PASS_MAX_DAYS  90\"</span> &gt;&gt; /etc/login.defs</span><br><span class=\"line\">egrep -q <span class=\"string\">\"^\\s*PASS_WARN_AGE\\s+\\S*(\\s*#.*)?\\s*$\"</span> /etc/login.defs &amp;&amp; sed -ri <span class=\"string\">\"s/^(\\s*)PASS_WARN_AGE\\s+\\S*(\\s*#.*)?\\s*$/\\PASS_WARN_AGE  15/\"</span> /etc/login.defs || <span class=\"built_in\">echo</span> <span class=\"string\">\"PASS_WARN_AGE  15\"</span> &gt;&gt; /etc/login.defs</span><br><span class=\"line\">egrep -q <span class=\"string\">\"^\\s*PASS_MIN_LEN\\s+\\S*(\\s*#.*)?\\s*$\"</span> /etc/login.defs &amp;&amp; sed -ri <span class=\"string\">\"s/^(\\s*)PASS_MIN_LEN\\s+\\S*(\\s*#.*)?\\s*$/\\PASS_MIN_LEN  15/\"</span> /etc/login.defs || <span class=\"built_in\">echo</span> <span class=\"string\">\"PASS_MIN_LEN  15\"</span> &gt;&gt; /etc/login.defs</span><br><span class=\"line\"></span><br><span class=\"line\">egrep -q <span class=\"string\">\"^password\\s.+pam_cracklib.so\\s+\\w+.*$\"</span> /etc/pam.d/common-password &amp;&amp; sed -ri <span class=\"string\">'/^password\\s.+pam_cracklib.so/&#123;s/pam_cracklib.so\\s+\\w+.*$/pam_cracklib.so retry=3 minlen=15 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1 difok=1/g;&#125;'</span> /etc/pam.d/common-password</span><br><span class=\"line\">egrep -q <span class=\"string\">\"^password\\s.+pam_unix.so\\s+\\w+.*$\"</span> /etc/pam.d/common-password &amp;&amp; sed -ri <span class=\"string\">'/^password\\s.+pam_unix.so/&#123;s/pam_unix.so\\s+\\w+.*$/pam_unix.so obscure use_authtok try_first_pass sha512 remember=3/g;&#125;'</span> /etc/pam.d/common-password</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 存储用户密码的文件，其内容经过sha512加密，所以非常注意其权限\"</span></span><br><span class=\"line\">touch /etc/security/opasswd &amp;&amp; chown root:root /etc/security/opasswd &amp;&amp; chmod 600 /etc/security/opasswd </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (3) 用户sudo权限以及重要目录和文件的权限设置</span></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 用户sudo权限以及重要目录和文件的新建默认权限设置\"</span></span><br><span class=\"line\"><span class=\"comment\"># 如uBuntu安装时您创建的用户 WeiyiGeek 防止直接通过 sudo passwd 修改root密码(此时必须要求输入WeiyiGeek密码后才可修改root密码)</span></span><br><span class=\"line\"><span class=\"comment\"># Tips: Sudo允许授权用户权限以另一个用户（通常是root用户）的身份运行程序, </span></span><br><span class=\"line\"><span class=\"comment\"># DefaultUser=\"weiyigeek\"</span></span><br><span class=\"line\">sed -i <span class=\"string\">\"/# Members of the admin/i <span class=\"variable\">$&#123;DefaultUser&#125;</span> ALL=(ALL) PASSWD:ALL\"</span> /etc/sudoers</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 配置用户 umask 为022 \"</span></span><br><span class=\"line\">egrep -q <span class=\"string\">\"^\\s*umask\\s+\\w+.*$\"</span> /etc/profile &amp;&amp; sed -ri <span class=\"string\">\"s/^\\s*umask\\s+\\w+.*$/umask 022/\"</span> /etc/profile || <span class=\"built_in\">echo</span> <span class=\"string\">\"umask 022\"</span> &gt;&gt; /etc/profile</span><br><span class=\"line\">egrep -q <span class=\"string\">\"^\\s*umask\\s+\\w+.*$\"</span> /etc/bash.bashrc &amp;&amp; sed -ri <span class=\"string\">\"s/^\\s*umask\\s+\\w+.*$/umask 022/\"</span> /etc/bashrc || <span class=\"built_in\">echo</span> <span class=\"string\">\"umask 022\"</span> &gt;&gt; /etc/bash.bashrc</span><br><span class=\"line\"><span class=\"comment\"># log::info \"[-] 设置用户目录创建默认权限, (初始为077比较严格)，在设置 umask 为022 及 777 - 022 \"</span></span><br><span class=\"line\"><span class=\"comment\"># egrep -q \"^\\s*(umask|UMASK)\\s+\\w+.*$\" /etc/login.defs &amp;&amp; sed -ri \"s/^\\s*(umask|UMASK)\\s+\\w+.*$/UMASK 022/\" /etc/login.defs || echo \"UMASK 022\" &gt;&gt; /etc/login.defs</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 设置或恢复重要目录和文件的权限\"</span></span><br><span class=\"line\">chmod 755 /etc; </span><br><span class=\"line\">chmod 777 /tmp; </span><br><span class=\"line\">chmod 700 /etc/inetd.conf&amp;&gt;/dev/null 2&amp;&gt;/dev/null; </span><br><span class=\"line\">chmod 755 /etc/passwd; </span><br><span class=\"line\">chmod 755 /etc/shadow; </span><br><span class=\"line\">chmod 644 /etc/group; </span><br><span class=\"line\">chmod 755 /etc/security; </span><br><span class=\"line\">chmod 644 /etc/services; </span><br><span class=\"line\">chmod 750 /etc/rc*.d</span><br><span class=\"line\">chmod 600 ~/.ssh/authorized_keys</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 删除潜在威胁文件 \"</span></span><br><span class=\"line\">find / -maxdepth 3 -name hosts.equiv | xargs rm -rf</span><br><span class=\"line\">find / -maxdepth 3 -name .netrc | xargs rm -rf</span><br><span class=\"line\">find / -maxdepth 3 -name .rhosts | xargs rm -rf</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (4) SSHD 服务安全加固设置</span></span><br><span class=\"line\"><span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] sshd 服务安全加固设置\"</span></span><br><span class=\"line\"><span class=\"comment\"># 严格模式</span></span><br><span class=\"line\">sudo egrep -q <span class=\"string\">\"^\\s*StrictModes\\s+.+$\"</span> /etc/ssh/sshd_config &amp;&amp; sed -ri <span class=\"string\">\"s/^(#)?\\s*StrictModes\\s+.+$/StrictModes yes/\"</span> /etc/ssh/sshd_config || <span class=\"built_in\">echo</span> <span class=\"string\">\"StrictModes yes\"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class=\"line\"><span class=\"comment\"># 监听端口更改</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -e <span class=\"variable\">$&#123;SSHPORT&#125;</span> ];<span class=\"keyword\">then</span> <span class=\"built_in\">export</span> SSHPORT=20211;<span class=\"keyword\">fi</span></span><br><span class=\"line\">sudo egrep -q <span class=\"string\">\"^\\s*Port\\s+.+$\"</span> /etc/ssh/sshd_config &amp;&amp; sed -ri <span class=\"string\">\"s/^(#)?\\s*Port\\s+.+$/Port <span class=\"variable\">$&#123;SSHPORT&#125;</span>/\"</span> /etc/ssh/sshd_config || <span class=\"built_in\">echo</span> <span class=\"string\">\"Port <span class=\"variable\">$&#123;SSHPORT&#125;</span>\"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class=\"line\"><span class=\"comment\"># 禁用X11转发以及端口转发</span></span><br><span class=\"line\">sudo egrep -q <span class=\"string\">\"^\\s*X11Forwarding\\s+.+$\"</span> /etc/ssh/sshd_config &amp;&amp; sed -ri <span class=\"string\">\"s/^(#)?\\s*X11Forwarding\\s+.+$/X11Forwarding no/\"</span> /etc/ssh/sshd_config || <span class=\"built_in\">echo</span> <span class=\"string\">\"X11Forwarding no\"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class=\"line\">sudo egrep -q <span class=\"string\">\"^\\s*X11UseLocalhost\\s+.+$\"</span> /etc/ssh/sshd_config &amp;&amp; sed -ri <span class=\"string\">\"s/^(#)?\\s*X11UseLocalhost\\s+.+$/X11UseLocalhost yes/\"</span> /etc/ssh/sshd_config || <span class=\"built_in\">echo</span> <span class=\"string\">\"X11UseLocalhost yes\"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class=\"line\">sudo egrep -q <span class=\"string\">\"^\\s*AllowTcpForwarding\\s+.+$\"</span> /etc/ssh/sshd_config &amp;&amp; sed -ri <span class=\"string\">\"s/^(#)?\\s*AllowTcpForwarding\\s+.+$/AllowTcpForwarding no/\"</span> /etc/ssh/sshd_config || <span class=\"built_in\">echo</span> <span class=\"string\">\"AllowTcpForwarding no\"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class=\"line\">sudo egrep -q <span class=\"string\">\"^\\s*AllowAgentForwarding\\s+.+$\"</span> /etc/ssh/sshd_config &amp;&amp; sed -ri <span class=\"string\">\"s/^(#)?\\s*AllowAgentForwarding\\s+.+$/AllowAgentForwarding no/\"</span> /etc/ssh/sshd_config || <span class=\"built_in\">echo</span> <span class=\"string\">\"AllowAgentForwarding no\"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class=\"line\"><span class=\"comment\"># 关闭禁用用户的 .rhosts 文件  ~/.ssh/.rhosts 来做为认证: 缺省IgnoreRhosts yes </span></span><br><span class=\"line\">egrep -q <span class=\"string\">\"^(#)?\\s*IgnoreRhosts\\s+.+$\"</span> /etc/ssh/sshd_config &amp;&amp; sed -ri <span class=\"string\">\"s/^(#)?\\s*IgnoreRhosts\\s+.+$/IgnoreRhosts yes/\"</span> /etc/ssh/sshd_config || <span class=\"built_in\">echo</span> <span class=\"string\">\"IgnoreRhosts yes\"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class=\"line\"><span class=\"comment\"># 禁止root远程登录（推荐配置-根据需求配置）</span></span><br><span class=\"line\">egrep -q <span class=\"string\">\"^\\s*PermitRootLogin\\s+.+$\"</span> /etc/ssh/sshd_config &amp;&amp; sed -ri <span class=\"string\">\"s/^\\s*PermitRootLogin\\s+.+$/PermitRootLogin no/\"</span> /etc/ssh/sshd_config || <span class=\"built_in\">echo</span> <span class=\"string\">\"PermitRootLogin no\"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class=\"line\"><span class=\"comment\"># 登陆前后欢迎提示设置</span></span><br><span class=\"line\">egrep -q <span class=\"string\">\"^\\s*(banner|Banner)\\s+\\W+.*$\"</span> /etc/ssh/sshd_config &amp;&amp; sed -ri <span class=\"string\">\"s/^\\s*(banner|Banner)\\s+\\W+.*$/Banner \\/etc\\/issue/\"</span> /etc/ssh/sshd_config || \\</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"Banner /etc/issue\"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class=\"line\"><span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 远程SSH登录前后提示警告Banner设置\"</span></span><br><span class=\"line\"><span class=\"comment\"># SSH登录前警告Banner</span></span><br><span class=\"line\">sudo tee /etc/issue &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\">****************** [ 安全登陆 (Security Login) ] *****************</span><br><span class=\"line\">Authorized only. All activity will be monitored and reported.By Security Center.</span><br><span class=\"line\">EOF</span><br><span class=\"line\"><span class=\"comment\"># SSH登录后提示Banner</span></span><br><span class=\"line\">sed -i <span class=\"string\">'/^fi/a\\\\n\\necho \"\\\\e[1;37;41;5m################## 安全运维 (Security Operation) ####################\\\\e[0m\"\\necho \"\\\\e[32mLogin success. Please execute the commands and operation data carefully.By WeiyiGeek.\\\\e[0m\"'</span> /etc/update-motd.d/00-header</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (5) 用户远程登录失败次数与终端超时设置 </span></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 用户远程连续登录失败10次锁定帐号5分钟包括root账号\"</span></span><br><span class=\"line\">sed -ri <span class=\"string\">\"/^\\s*auth\\s+required\\s+pam_tally2.so\\s+.+(\\s*#.*)?\\s*$/d\"</span> /etc/pam.d/sshd </span><br><span class=\"line\">sed -ri <span class=\"string\">'2a auth required pam_tally2.so deny=10 unlock_time=300 even_deny_root root_unlock_time=300'</span> /etc/pam.d/sshd </span><br><span class=\"line\"><span class=\"comment\"># 宿主机控制台登陆(可选)</span></span><br><span class=\"line\"><span class=\"comment\"># sed -ri \"/^\\s*auth\\s+required\\s+pam_tally2.so\\s+.+(\\s*#.*)?\\s*$/d\" /etc/pam.d/login</span></span><br><span class=\"line\"><span class=\"comment\"># sed -ri '2a auth required pam_tally2.so deny=5 unlock_time=300 even_deny_root root_unlock_time=300' /etc/pam.d/login</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 设置登录超时时间为10分钟 \"</span></span><br><span class=\"line\">egrep -q <span class=\"string\">\"^\\s*(export|)\\s*TMOUT\\S\\w+.*$\"</span> /etc/profile &amp;&amp; sed -ri <span class=\"string\">\"s/^\\s*(export|)\\s*TMOUT.\\S\\w+.*$/export TMOUT=600\\nreadonly TMOUT/\"</span> /etc/profile || <span class=\"built_in\">echo</span> -e <span class=\"string\">\"export TMOUT=600\\nreadonly TMOUT\"</span> &gt;&gt; /etc/profile</span><br><span class=\"line\">egrep -q <span class=\"string\">\"^\\s*.*ClientAliveInterval\\s\\w+.*$\"</span> /etc/ssh/sshd_config &amp;&amp; sed -ri <span class=\"string\">\"s/^\\s*.*ClientAliveInterval\\s\\w+.*$/ClientAliveInterval 600/\"</span> /etc/ssh/sshd_config || <span class=\"built_in\">echo</span> <span class=\"string\">\"ClientAliveInterval 600\"</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (5) 切换用户日志记录或者切换命令更改(可选)</span></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 切换用户日志记录和切换命令更改名称为SU \"</span></span><br><span class=\"line\">egrep -q <span class=\"string\">\"^(\\s*)SULOG_FILE\\s+\\S*(\\s*#.*)?\\s*$\"</span> /etc/login.defs &amp;&amp; sed -ri <span class=\"string\">\"s/^(\\s*)SULOG_FILE\\s+\\S*(\\s*#.*)?\\s*$/\\SULOG_FILE  \\/var\\/log\\/.history\\/sulog/\"</span> /etc/login.defs || <span class=\"built_in\">echo</span> <span class=\"string\">\"SULOG_FILE  /var/log/.history/sulog\"</span> &gt;&gt; /etc/login.defs</span><br><span class=\"line\">egrep -q <span class=\"string\">\"^\\s*SU_NAME\\s+\\S*(\\s*#.*)?\\s*$\"</span> /etc/login.defs &amp;&amp; sed -ri <span class=\"string\">\"s/^(\\s*)SU_NAME\\s+\\S*(\\s*#.*)?\\s*$/\\SU_NAME  SU/\"</span> /etc/login.defs || <span class=\"built_in\">echo</span> <span class=\"string\">\"SU_NAME  SU\"</span> &gt;&gt; /etc/login.defs</span><br><span class=\"line\">mkdir -vp /usr/<span class=\"built_in\">local</span>/bin /var/<span class=\"built_in\">log</span>/.backups /var/<span class=\"built_in\">log</span>/.<span class=\"built_in\">history</span> /var/<span class=\"built_in\">log</span>/.<span class=\"built_in\">history</span>/sulog</span><br><span class=\"line\">cp /usr/bin/su /var/<span class=\"built_in\">log</span>/.backups/su.bak</span><br><span class=\"line\">mv /usr/bin/su /usr/bin/SU</span><br><span class=\"line\"><span class=\"comment\"># 只能写入不能删除其目标目录中的文件</span></span><br><span class=\"line\"><span class=\"comment\"># chmod -R 1777 /var/log/.history</span></span><br><span class=\"line\">chattr -R +a /var/<span class=\"built_in\">log</span>/.<span class=\"built_in\">history</span> </span><br><span class=\"line\">chattr +a /var/<span class=\"built_in\">log</span>/.backups</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (6) 用户终端执行的历史命令记录</span></span><br><span class=\"line\"><span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 用户终端执行的历史命令记录 \"</span></span><br><span class=\"line\">egrep -q <span class=\"string\">\"^HISTSIZE\\W\\w+.*$\"</span> /etc/profile &amp;&amp; sed -ri <span class=\"string\">\"s/^HISTSIZE\\W\\w+.*$/HISTSIZE=101/\"</span> /etc/profile || <span class=\"built_in\">echo</span> <span class=\"string\">\"HISTSIZE=101\"</span> &gt;&gt; /etc/profile</span><br><span class=\"line\"><span class=\"comment\"># 方式1</span></span><br><span class=\"line\">sudo tee /etc/profile.d/<span class=\"built_in\">history</span>-record.sh &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\"><span class=\"comment\"># 历史命令执行记录文件路径</span></span><br><span class=\"line\">LOGTIME=$(date +%Y%m%d-%H-%M-%S)</span><br><span class=\"line\"><span class=\"built_in\">export</span> HISTFILE=<span class=\"string\">\"/var/log/.history/<span class=\"variable\">$&#123;USER&#125;</span>.<span class=\"variable\">$&#123;LOGTIME&#125;</span>.history\"</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -f <span class=\"variable\">$&#123;HISTFILE&#125;</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">  touch <span class=\"variable\">$&#123;HISTFILE&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\">chmod 600 /var/<span class=\"built_in\">log</span>/.<span class=\"built_in\">history</span>/<span class=\"variable\">$&#123;USER&#125;</span>.<span class=\"variable\">$&#123;LOGTIME&#125;</span>.<span class=\"built_in\">history</span></span><br><span class=\"line\"><span class=\"comment\"># 历史命令执行文件大小记录设置</span></span><br><span class=\"line\">HISTFILESIZE=128</span><br><span class=\"line\">HISTTIMEFORMAT=<span class=\"string\">\"%F_%T <span class=\"variable\">$(whoami)</span>#<span class=\"variable\">$(who -u am i 2&gt;/dev/null| awk '&#123;print $NF&#125;'|sed -e 's/[()</span>]//g'):\"</span></span><br><span class=\"line\">EOF</span><br><span class=\"line\"><span class=\"comment\"># 方式2.未能成功(如后续有小伙伴成功了欢迎留言分享)</span></span><br><span class=\"line\"><span class=\"comment\"># sudo tee /usr/local/bin/history.sh &lt;&lt;'EOF'</span></span><br><span class=\"line\"><span class=\"comment\"># #!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># logfiletime=$(date +%Y%m%d-%H-%M-%S)</span></span><br><span class=\"line\"><span class=\"comment\"># # unalias \"history\"</span></span><br><span class=\"line\"><span class=\"comment\"># if [ $# -eq 0 ];then history;fi</span></span><br><span class=\"line\"><span class=\"comment\"># for i in $*;do</span></span><br><span class=\"line\"><span class=\"comment\">#   if [ \"$i\" = \"-c\" ];then </span></span><br><span class=\"line\"><span class=\"comment\">#     mv ~/.bash_history &gt; /var/log/.history/$&#123;logfiletime&#125;.history</span></span><br><span class=\"line\"><span class=\"comment\">#     history -c</span></span><br><span class=\"line\"><span class=\"comment\">#     continue;</span></span><br><span class=\"line\"><span class=\"comment\">#   fi</span></span><br><span class=\"line\"><span class=\"comment\"># done</span></span><br><span class=\"line\"><span class=\"comment\"># alias history=\"source /usr/local/bin/history.sh\"</span></span><br><span class=\"line\"><span class=\"comment\"># EOF</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (7) GRUB 安全设置 （需要手动设置请按照需求设置）</span></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 系统 GRUB 安全设置(防止物理接触从grub菜单中修改密码) \"</span></span><br><span class=\"line\"><span class=\"comment\"># Grub 关键文件备份</span></span><br><span class=\"line\">cp -a /etc/grub.d/00_header /var/<span class=\"built_in\">log</span>/.backups </span><br><span class=\"line\">cp -a /etc/grub.d/10_linux /var/<span class=\"built_in\">log</span>/.backups </span><br><span class=\"line\"><span class=\"comment\"># 设置Grub菜单界面显示时间</span></span><br><span class=\"line\">sed -i -e <span class=\"string\">'s|GRUB_TIMEOUT_STYLE=hidden|#GRUB_TIMEOUT_STYLE=hidden|g'</span> -e <span class=\"string\">'s|GRUB_TIMEOUT=0|GRUB_TIMEOUT=3|g'</span> /etc/default/grub</span><br><span class=\"line\">sed -i -e <span class=\"string\">'s|set timeout_style=$&#123;style&#125;|#set timeout_style=$&#123;style&#125;|g'</span> -e <span class=\"string\">'s|set timeout=$&#123;timeout&#125;|set timeout=3|g'</span> /etc/grub.d/00_header</span><br><span class=\"line\"><span class=\"comment\"># 创建认证密码 (此处密码: WeiyiGeek)</span></span><br><span class=\"line\">sudo grub-mkpasswd-pbkdf2</span><br><span class=\"line\"><span class=\"comment\"># Enter password:</span></span><br><span class=\"line\"><span class=\"comment\"># Reenter password:</span></span><br><span class=\"line\"><span class=\"comment\"># PBKDF2 hash of your password is grub.pbkdf2.sha512.10000.21AC9CEF61B96972BF6F918D2037EFBEB8280001045ED32DFDDCC260591CC6BC8957CF25A6755904A7053E97940A9E4CD5C1EF833C1651C1BCF09D899BED4C7C.9691521F5BB34CD8AEFCED85F4B830A86EC93B61A31885BCBE3FEE927D54EFDEE69FA8B51DBC00FCBDB618D4082BC22B2B6BA4161C7E6B990C4E5CFC9E9748D7</span></span><br><span class=\"line\"><span class=\"comment\"># 设置认证用户以及password_pbkdf2认证</span></span><br><span class=\"line\">tee -a /etc/grub.d/00_header &lt;&lt;<span class=\"string\">'END'</span></span><br><span class=\"line\">cat &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\"><span class=\"comment\"># GRUB Authentication</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> superusers=<span class=\"string\">\"grub\"</span></span><br><span class=\"line\">password_pbkdf2 grub grub.pbkdf2.sha512.10000.21AC9CEF61B96972BF6F918D2037EFBEB8280001045ED32DFDDCC260591CC6BC8957CF25A6755904A7053E97940A9E4CD5C1EF833C1651C1BCF09D899BED4C7C.9691521F5BB34CD8AEFCED85F4B830A86EC93B61A31885BCBE3FEE927D54EFDEE69FA8B51DBC00FCBDB618D4082BC22B2B6BA4161C7E6B990C4E5CFC9E9748D7</span><br><span class=\"line\">EOF</span><br><span class=\"line\">END</span><br><span class=\"line\"><span class=\"comment\"># 设置进入正式系统不需要认证如进入单用户模式进行重置账号密码时需要进行认证。 （高敏感数据库系统不建议下述操作）</span></span><br><span class=\"line\"><span class=\"comment\"># 在191和193 分别加入--user=grub 和 --unrestricted</span></span><br><span class=\"line\"><span class=\"comment\"># 191       echo \"menuentry --user=grub '$(echo \"$title\" | grub_quote)' $&#123;CLASS&#125; \\$menuentry_id_option 'gnulinux-$version-$type-$boot_device_id' &#123;\" | sed \"s/^/$submenu_indentation/\"  # 如果按e进行menu菜单则需要用grub进行认证</span></span><br><span class=\"line\"><span class=\"comment\"># 192   else</span></span><br><span class=\"line\"><span class=\"comment\"># 193       echo \"menuentry --unrestricted '$(echo \"$os\" | grub_quote)' $&#123;CLASS&#125; \\$menuentry_id_option 'gnulinux-simple-$boot_device_id' &#123;\" | sed \"s/^/$submenu_indentation/\"          # 正常进入系统则不认证</span></span><br><span class=\"line\"></span><br><span class=\"line\">sed -i <span class=\"string\">'/echo \"$title\" | grub_quote/ &#123; s/menuentry /menuentry --user=grub /;&#125;'</span> /etc/grub.d/10_linux</span><br><span class=\"line\">sed -i <span class=\"string\">'/echo \"$os\" | grub_quote/ &#123; s/menuentry /menuentry --unrestricted /;&#125;'</span> /etc/grub.d/10_linux</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Ubuntu 方式更新GRUB从而生成boot启动文件。</span></span><br><span class=\"line\">update-grub</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (8) 操作系统防火墙启用以及策略设置</span></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 系统防火墙启用以及规则设置 \"</span></span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> ufw.service &amp;&amp; systemctl start ufw.service &amp;&amp; ufw <span class=\"built_in\">enable</span></span><br><span class=\"line\">sudo ufw allow proto tcp to any port 20211</span><br><span class=\"line\"><span class=\"comment\"># 重启修改配置相关服务</span></span><br><span class=\"line\">systemctl restart sshd</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: os::Operation </span></span><br><span class=\"line\"><span class=\"comment\">## 用途: 操作系统安全运维设置</span></span><br><span class=\"line\"><span class=\"comment\">## 参数: 无</span></span><br><span class=\"line\">os::<span class=\"function\"><span class=\"title\">Operation</span></span> () &#123;</span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 操作系统安全运维设置相关脚本\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (0) 禁用ctrl+alt+del组合键对系统重启 (必须要配置,我曾入过坑)</span></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 禁用控制台ctrl+alt+del组合键重启\"</span></span><br><span class=\"line\">mv /usr/lib/systemd/system/ctrl-alt-del.target /var/<span class=\"built_in\">log</span>/.backups/ctrl-alt-del.target-$(date +%Y%m%d).bak</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (1) 设置文件删除回收站别名</span></span><br><span class=\"line\">  <span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 设置文件删除回收站别名(防止误删文件) \"</span></span><br><span class=\"line\">sudo tee /etc/profile.d/alias.sh &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\"><span class=\"comment\"># User specific aliases and functions</span></span><br><span class=\"line\"><span class=\"comment\"># 删除回收站</span></span><br><span class=\"line\"><span class=\"comment\"># find ~/.trash -delete</span></span><br><span class=\"line\"><span class=\"comment\"># 删除空目录</span></span><br><span class=\"line\"><span class=\"comment\"># find ~/.trash -type d -delete</span></span><br><span class=\"line\"><span class=\"built_in\">alias</span> rm=<span class=\"string\">\"sh /usr/local/bin/remove.sh\"</span></span><br><span class=\"line\">EOF</span><br><span class=\"line\">sudo tee /usr/<span class=\"built_in\">local</span>/bin/remove.sh &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"><span class=\"comment\"># 定义回收站文件夹目录.trash</span></span><br><span class=\"line\">trash=<span class=\"string\">\"/.trash\"</span></span><br><span class=\"line\">deltime=$(date +%Y%m%d-%H-%M-%S)</span><br><span class=\"line\">TRASH_DIR=<span class=\"string\">\"<span class=\"variable\">$&#123;HOME&#125;</span><span class=\"variable\">$&#123;trash&#125;</span>/<span class=\"variable\">$&#123;deltime&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"comment\"># 建立回收站目录当不存在的时候</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ ! -e <span class=\"variable\">$&#123;TRASH_DIR&#125;</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">   mkdir -p <span class=\"variable\">$&#123;TRASH_DIR&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> $*;<span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ <span class=\"string\">\"<span class=\"variable\">$i</span>\"</span> = <span class=\"string\">\"-rf\"</span> ];<span class=\"keyword\">then</span> <span class=\"built_in\">continue</span>;<span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"comment\"># 防止误操作</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ <span class=\"string\">\"<span class=\"variable\">$i</span>\"</span> = <span class=\"string\">\"/\"</span> ];<span class=\"keyword\">then</span> <span class=\"built_in\">echo</span> <span class=\"string\">'# Danger delete command, Not delete / directory!'</span>;<span class=\"built_in\">exit</span> -1;<span class=\"keyword\">fi</span></span><br><span class=\"line\">  <span class=\"comment\">#定义秒时间戳</span></span><br><span class=\"line\">  STAMP=$(date +%s)</span><br><span class=\"line\">  <span class=\"comment\">#得到文件名称(非文件夹)，参考man basename</span></span><br><span class=\"line\">  fileName=$(basename <span class=\"variable\">$i</span>)</span><br><span class=\"line\">  <span class=\"comment\">#将输入的参数，对应文件mv至.trash目录，文件后缀，为当前的时间戳</span></span><br><span class=\"line\">  mv <span class=\"variable\">$i</span> <span class=\"variable\">$&#123;TRASH_DIR&#125;</span>/<span class=\"variable\">$&#123;fileName&#125;</span>.<span class=\"variable\">$&#123;STAMP&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\">EOF</span><br><span class=\"line\">sudo chmod +775 /usr/<span class=\"built_in\">local</span>/bin/remove.sh /etc/profile.d/alias.sh /etc/profile.d/<span class=\"built_in\">history</span>-record.sh</span><br><span class=\"line\">sudo chmod a+x /usr/<span class=\"built_in\">local</span>/bin/remove.sh /etc/profile.d/alias.sh /etc/profile.d/<span class=\"built_in\">history</span>-record.sh</span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile.d/alias.sh  /etc/profile.d/<span class=\"built_in\">history</span>-record.sh</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2) 解决普通定时任务无法后台定时执行</span></span><br><span class=\"line\"><span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 解决普通定时任务无法后台定时执行 \"</span></span><br><span class=\"line\">linenumber=`expr $(egrep -n <span class=\"string\">\"pam_unix.so\\s$\"</span> /etc/pam.d/common-session-noninteractive | cut -f 1 -d <span class=\"string\">\":\"</span>) - 2`</span><br><span class=\"line\">sudo sed -ri <span class=\"string\">\"<span class=\"variable\">$&#123;linenumber&#125;</span>a session [success=1 default=ignore] pam_succeed_if.so service in cron quiet use_uid\"</span> /etc/pam.d/common-session-noninteractive</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (3) 解决 ubuntu20.04 multipath add missing path 错误</span></span><br><span class=\"line\"><span class=\"comment\"># 添加以下内容,sda视本地环境做调整</span></span><br><span class=\"line\">tee -a /etc/multipath.conf &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\">blacklist &#123;</span><br><span class=\"line\">  devnode <span class=\"string\">\"^sda\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\"><span class=\"comment\"># 重启multipath-tools服务</span></span><br><span class=\"line\">sudo service multipath-tools restart</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (4) 禁用 Ubuntu 中的 cloud-init</span></span><br><span class=\"line\"><span class=\"comment\"># 在 /etc/cloud 目录下创建 cloud-init.disabled 文件,注意重启后生效</span></span><br><span class=\"line\">sudo touch /etc/cloud/cloud-init.disabled</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: os::optimizationn</span></span><br><span class=\"line\"><span class=\"comment\">## 用途: 操作系统优化设置(内核参数)</span></span><br><span class=\"line\"><span class=\"comment\">## 参数: 无</span></span><br><span class=\"line\">os::<span class=\"function\"><span class=\"title\">optimizationn</span></span> () &#123;</span><br><span class=\"line\"><span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 正在进行操作系统内核参数优化设置.......\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (1) 系统内核参数的配置(/etc/sysctl.conf)</span></span><br><span class=\"line\"><span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] 系统内核参数的配置/etc/sysctl.conf\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># /etc/sysctl.d/99-kubernetes-cri.conf</span></span><br><span class=\"line\">egrep -q <span class=\"string\">\"^(#)?net.ipv4.ip_forward.*\"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class=\"string\">\"s|^(#)?net.ipv4.ip_forward.*|net.ipv4.ip_forward = 1|g\"</span>  /etc/sysctl.conf || <span class=\"built_in\">echo</span> <span class=\"string\">\"net.ipv4.ip_forward = 1\"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class=\"line\"><span class=\"comment\"># egrep -q \"^(#)?net.bridge.bridge-nf-call-ip6tables.*\" /etc/sysctl.conf &amp;&amp; sed -ri \"s|^(#)?net.bridge.bridge-nf-call-ip6tables.*|net.bridge.bridge-nf-call-ip6tables = 1|g\" /etc/sysctl.conf || echo \"net.bridge.bridge-nf-call-ip6tables = 1\" &gt;&gt; /etc/sysctl.conf </span></span><br><span class=\"line\"><span class=\"comment\"># egrep -q \"^(#)?net.bridge.bridge-nf-call-iptables.*\" /etc/sysctl.conf &amp;&amp; sed -ri \"s|^(#)?net.bridge.bridge-nf-call-iptables.*|net.bridge.bridge-nf-call-iptables = 1|g\" /etc/sysctl.conf || echo \"net.bridge.bridge-nf-call-iptables = 1\" &gt;&gt; /etc/sysctl.conf</span></span><br><span class=\"line\">egrep -q <span class=\"string\">\"^(#)?net.ipv6.conf.all.disable_ipv6.*\"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class=\"string\">\"s|^(#)?net.ipv6.conf.all.disable_ipv6.*|net.ipv6.conf.all.disable_ipv6 = 1|g\"</span> /etc/sysctl.conf || <span class=\"built_in\">echo</span> <span class=\"string\">\"net.ipv6.conf.all.disable_ipv6 = 1\"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class=\"line\">egrep -q <span class=\"string\">\"^(#)?net.ipv6.conf.default.disable_ipv6.*\"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class=\"string\">\"s|^(#)?net.ipv6.conf.default.disable_ipv6.*|net.ipv6.conf.default.disable_ipv6 = 1|g\"</span> /etc/sysctl.conf || <span class=\"built_in\">echo</span> <span class=\"string\">\"net.ipv6.conf.default.disable_ipv6 = 1\"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class=\"line\">egrep -q <span class=\"string\">\"^(#)?net.ipv6.conf.lo.disable_ipv6.*\"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class=\"string\">\"s|^(#)?net.ipv6.conf.lo.disable_ipv6.*|net.ipv6.conf.lo.disable_ipv6 = 1|g\"</span> /etc/sysctl.conf || <span class=\"built_in\">echo</span> <span class=\"string\">\"net.ipv6.conf.lo.disable_ipv6 = 1\"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class=\"line\">egrep -q <span class=\"string\">\"^(#)?net.ipv6.conf.all.forwarding.*\"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class=\"string\">\"s|^(#)?net.ipv6.conf.all.forwarding.*|net.ipv6.conf.all.forwarding = 1|g\"</span> /etc/sysctl.conf || <span class=\"built_in\">echo</span> <span class=\"string\">\"net.ipv6.conf.all.forwarding = 1\"</span>  &gt;&gt; /etc/sysctl.conf</span><br><span class=\"line\">egrep -q <span class=\"string\">\"^(#)?vm.max_map_count.*\"</span> /etc/sysctl.conf &amp;&amp; sed -ri <span class=\"string\">\"s|^(#)?vm.max_map_count.*|vm.max_map_count = 262144|g\"</span> /etc/sysctl.conf || <span class=\"built_in\">echo</span> <span class=\"string\">\"vm.max_map_count = 262144\"</span>  &gt;&gt; /etc/sysctl.conf</span><br><span class=\"line\"></span><br><span class=\"line\">tee -a /etc/sysctl.conf &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\"><span class=\"comment\"># 调整提升服务器负载能力之外,还能够防御小流量的Dos、CC和SYN攻击</span></span><br><span class=\"line\">net.ipv4.tcp_syncookies = 1</span><br><span class=\"line\">net.ipv4.tcp_tw_reuse = 1</span><br><span class=\"line\"><span class=\"comment\"># net.ipv4.tcp_tw_recycle = 1</span></span><br><span class=\"line\">net.ipv4.tcp_fin_timeout = 60</span><br><span class=\"line\">net.ipv4.tcp_synack_retries = 1</span><br><span class=\"line\">net.ipv4.tcp_syn_retries = 1</span><br><span class=\"line\">net.ipv4.tcp_fastopen = 3</span><br><span class=\"line\"><span class=\"comment\"># 优化TCP的可使用端口范围及提升服务器并发能力(注意一般流量小的服务器上没必要设置如下参数)</span></span><br><span class=\"line\">net.ipv4.tcp_keepalive_time = 1200</span><br><span class=\"line\">net.ipv4.tcp_max_syn_backlog = 8192</span><br><span class=\"line\">net.ipv4.tcp_max_tw_buckets = 5000</span><br><span class=\"line\">net.ipv4.ip_local_port_range = 1024 65535</span><br><span class=\"line\"><span class=\"comment\"># 优化核套接字TCP的缓存区</span></span><br><span class=\"line\">net.core.netdev_max_backlog = 8192</span><br><span class=\"line\">net.core.somaxconn = 8192</span><br><span class=\"line\">net.core.rmem_max = 12582912</span><br><span class=\"line\">net.core.rmem_default = 6291456</span><br><span class=\"line\">net.core.wmem_max = 12582912</span><br><span class=\"line\">net.core.wmem_default = 6291456</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2) Linux 系统的最大进程数和最大文件打开数限制</span></span><br><span class=\"line\"><span class=\"built_in\">log</span>::info <span class=\"string\">\"[-] Linux 系统的最大进程数和最大文件打开数限制\"</span></span><br><span class=\"line\">egrep -q <span class=\"string\">\"^\\s*ulimit -HSn\\s+\\w+.*$\"</span> /etc/profile &amp;&amp; sed -ri <span class=\"string\">\"s/^\\s*ulimit -HSn\\s+\\w+.*$/ulimit -HSn 65535/\"</span> /etc/profile || <span class=\"built_in\">echo</span> <span class=\"string\">\"ulimit -HSn 65535\"</span> &gt;&gt; /etc/profile</span><br><span class=\"line\">egrep -q <span class=\"string\">\"^\\s*ulimit -HSu\\s+\\w+.*$\"</span> /etc/profile &amp;&amp; sed -ri <span class=\"string\">\"s/^\\s*ulimit -HSu\\s+\\w+.*$/ulimit -HSu 65535/\"</span> /etc/profile || <span class=\"built_in\">echo</span> <span class=\"string\">\"ulimit -HSu 65535\"</span> &gt;&gt; /etc/profile</span><br><span class=\"line\"></span><br><span class=\"line\">tee -a /etc/security/limits.conf &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\"><span class=\"comment\"># ulimit -HSn 65535</span></span><br><span class=\"line\"><span class=\"comment\"># ulimit -HSu 65535</span></span><br><span class=\"line\">*  soft  nofile  65535</span><br><span class=\"line\">*  hard  nofile  65535</span><br><span class=\"line\">*  soft  nproc   65535</span><br><span class=\"line\">*  hard  nproc   65535</span><br><span class=\"line\"><span class=\"comment\"># End of file</span></span><br><span class=\"line\">EOF</span><br><span class=\"line\"><span class=\"comment\"># sed -i \"/# End/i *  soft  nproc   65535\" /etc/security/limits.conf</span></span><br><span class=\"line\"><span class=\"comment\"># sed -i \"/# End/i *  hard  nproc   65535\" /etc/security/limits.conf</span></span><br><span class=\"line\">sysctl -p</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 需重启生效</span></span><br><span class=\"line\">reboot</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: system::swap</span></span><br><span class=\"line\"><span class=\"comment\">## 用途: Liunx 系统创建SWAP交换分区(默认2G)</span></span><br><span class=\"line\"><span class=\"comment\">## 参数: $1(几G)</span></span><br><span class=\"line\">system::<span class=\"function\"><span class=\"title\">swap</span></span> () &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ -e <span class=\"variable\">$1</span> ];<span class=\"keyword\">then</span></span><br><span class=\"line\">    sudo dd <span class=\"keyword\">if</span>=/dev/zero of=/swapfile bs=1024 count=2097152   <span class=\"comment\"># 2G Swap 分区 1024 * 1024 , centos 以 1000 为标准</span></span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    number=$(<span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$&#123;1&#125;</span>*1024*1024\"</span>|bc)</span><br><span class=\"line\">    sudo dd <span class=\"keyword\">if</span>=/dev/zero of=/swapfile bs=1024 count=<span class=\"variable\">$&#123;number&#125;</span>   <span class=\"comment\"># 2G Swap 分区 1024 * 1024 , centos 以 1000 为标准</span></span><br><span class=\"line\">  <span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">  sudo mkswap /swapfile &amp;&amp; sudo swapon /swapfile</span><br><span class=\"line\">  <span class=\"keyword\">if</span> [ $(grep -c <span class=\"string\">\"/swapfile\"</span> /etc/fstab) -eq 0 ];<span class=\"keyword\">then</span></span><br><span class=\"line\">sudo tee -a /etc/fstab &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\">/swapfile swap swap default 0 0</span><br><span class=\"line\">EOF</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\">sudo swapon --show &amp;&amp; sudo free -h</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: software::Java</span></span><br><span class=\"line\"><span class=\"comment\">## 用途: java 环境安装配置</span></span><br><span class=\"line\"><span class=\"comment\">## 参数: 无</span></span><br><span class=\"line\">software::<span class=\"function\"><span class=\"title\">Java</span></span> () &#123;</span><br><span class=\"line\">  <span class=\"comment\"># 基础变量</span></span><br><span class=\"line\">  JAVA_FILE=<span class=\"string\">\"/root/Downloads/jdk-8u211-linux-x64.tar.gz\"</span></span><br><span class=\"line\">  JAVA_SRC=<span class=\"string\">\"/usr/local/\"</span></span><br><span class=\"line\">  JAVA_DIR=<span class=\"string\">\"/usr/local/jdk\"</span></span><br><span class=\"line\">  <span class=\"comment\"># 环境配置</span></span><br><span class=\"line\">  sudo tar -zxvf <span class=\"variable\">$&#123;JAVA_FILE&#125;</span> -C <span class=\"variable\">$&#123;JAVA_SRC&#125;</span></span><br><span class=\"line\">  sudo rm -rf /usr/<span class=\"built_in\">local</span>/jdk </span><br><span class=\"line\">  JAVA_SRC=$(ls /usr/<span class=\"built_in\">local</span>/ | grep <span class=\"string\">\"jdk\"</span>)</span><br><span class=\"line\">  sudo ln -s <span class=\"variable\">$&#123;JAVA_SRC&#125;</span> <span class=\"variable\">$&#123;JAVA_DIR&#125;</span></span><br><span class=\"line\">  <span class=\"built_in\">export</span> PATH=<span class=\"variable\">$&#123;JAVA_DIR&#125;</span>/bin:<span class=\"variable\">$&#123;PATH&#125;</span></span><br><span class=\"line\">  sudo cp /etc/profile /etc/profile.$(date +%Y%m%d-%H%M%S).bak</span><br><span class=\"line\">  sudo tee -a /etc/profile &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> JAVA_HOME=/usr/<span class=\"built_in\">local</span>/jdk</span><br><span class=\"line\"><span class=\"built_in\">export</span> JRE_HOME=/usr/<span class=\"built_in\">local</span>/jdk/jre</span><br><span class=\"line\"><span class=\"built_in\">export</span> CLASSPATH=.:<span class=\"variable\">$JAVA_HOME</span>/lib/dt.jar:<span class=\"variable\">$JAVA_HOME</span>/lib/tools.jar</span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$JAVA_HOME</span>/bin:<span class=\"variable\">$PATH</span></span><br><span class=\"line\">EOF</span><br><span class=\"line\">  java -version</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: software::docker</span></span><br><span class=\"line\"><span class=\"comment\">## 用途: 软件安装之Docker安装</span></span><br><span class=\"line\"><span class=\"comment\">## 参数: 无</span></span><br><span class=\"line\"><span class=\"comment\"># 帮助: https://docs.docker.com/engine/install/ubuntu/</span></span><br><span class=\"line\"><span class=\"comment\"># Ubuntu Focal 20.04 (LTS)</span></span><br><span class=\"line\"><span class=\"comment\"># Ubuntu Bionic 18.04 (LTS)</span></span><br><span class=\"line\"><span class=\"comment\"># Ubuntu Xenial 16.04 (LTS)</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">InstallDocker</span></span>()&#123;</span><br><span class=\"line\">  <span class=\"comment\"># 1.卸载旧版本 </span></span><br><span class=\"line\">  sudo apt-get remove docker docker-engine docker.io containerd runc</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\"># 2.更新apt包索引并安装包以允许apt在HTTPS上使用存储库</span></span><br><span class=\"line\">  sudo apt-get install -y \\</span><br><span class=\"line\">    apt-transport-https \\</span><br><span class=\"line\">    ca-certificates \\</span><br><span class=\"line\">    curl \\</span><br><span class=\"line\">    gnupg-agent \\</span><br><span class=\"line\">    software-properties-common</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 3.添加Docker官方GPG密钥 # -fsSL</span></span><br><span class=\"line\">  sudo curl  https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 4.通过搜索指纹的最后8个字符进行密钥验证</span></span><br><span class=\"line\">  sudo apt-key fingerprint 0EBFCD88</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 5.设置稳定存储库</span></span><br><span class=\"line\">  sudo add-apt-repository \\</span><br><span class=\"line\">   <span class=\"string\">\"deb [arch=amd64] https://download.docker.com/linux/ubuntu \\</span></span><br><span class=\"line\"><span class=\"string\">   <span class=\"variable\">$(lsb_release -cs)</span> \\</span></span><br><span class=\"line\"><span class=\"string\">   stable\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 6.Install Docker Engine 默认最新版本</span></span><br><span class=\"line\">  sudo apt-get update &amp;&amp; sudo apt-get install -y docker-ce=5:20.10.7~3-0~ubuntu-focal docker-ce-cli=5:20.10.7~3-0~ubuntu-focal containerd.io docker-compose</span><br><span class=\"line\">  <span class=\"comment\"># - 强制IPv4</span></span><br><span class=\"line\">  <span class=\"comment\"># sudo apt-get -o Acquire::ForceIPv4=true  install -y docker-ce=5:19.03.15~3-0~ubuntu-focal docker-ce-cli=5:19.03.15~3-0~ubuntu-focal containerd.io docker-compose</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 7.安装特定版本的Docker引擎，请在repo中列出可用的版本</span></span><br><span class=\"line\">  apt-cache madison docker-ce</span><br><span class=\"line\">  <span class=\"comment\"># docker-ce | 5:20.10.6~3-0~ubuntu-focal| https://download.docker.com/linux/ubuntu focal/stable amd64 Packages</span></span><br><span class=\"line\">  <span class=\"comment\"># docker-ce | 5:19.03.15~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu  xenial/stable amd64 Packages</span></span><br><span class=\"line\">  <span class=\"comment\"># 使用第二列中的版本字符串安装特定的版本，例如:5:18.09.1~3-0~ubuntu-xenial。</span></span><br><span class=\"line\">  <span class=\"comment\"># $sudo apt-get install docker-ce=&lt;VERSION_STRING&gt; docker-ce-cli=&lt;VERSION_STRING&gt; containerd.io</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#8.将当前用户加入docker用户组然后重新登陆当前用户使得低权限用户</span></span><br><span class=\"line\">  sudo gpasswd -a <span class=\"variable\">$&#123;USER&#125;</span> docker</span><br><span class=\"line\">  <span class=\"comment\"># sudo gpasswd -a weiyigeek docker</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">#9.加速器建立</span></span><br><span class=\"line\">  mkdir -vp /etc/docker/</span><br><span class=\"line\">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class=\"string\">'EOF'</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"registry-mirrors\"</span>: [<span class=\"string\">\"https://xlx9erfu.mirror.aliyuncs.com\"</span>],</span><br><span class=\"line\">  <span class=\"string\">\"exec-opts\"</span>: [<span class=\"string\">\"native.cgroupdriver=systemd\"</span>],</span><br><span class=\"line\">  <span class=\"string\">\"storage-driver\"</span>: <span class=\"string\">\"overlay2\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"log-driver\"</span>: <span class=\"string\">\"json-file\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"log-level\"</span>: <span class=\"string\">\"warn\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"log-opts\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"max-size\"</span>: <span class=\"string\">\"100m\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"max-file\"</span>: <span class=\"string\">\"10\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">\"live-restore\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"string\">\"dns\"</span>: [<span class=\"string\">\"192.168.10.254\"</span>,<span class=\"string\">\"223.6.6.6\"</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\">  <span class=\"comment\"># \"data-root\":\"/monitor/container\",</span></span><br><span class=\"line\">  <span class=\"comment\"># \"insecure-registries\": [\"harbor.weiyigeek.top\"]</span></span><br><span class=\"line\">  <span class=\"comment\"># 9.自启与启动</span></span><br><span class=\"line\">  sudo systemctl daemon-reload</span><br><span class=\"line\">  sudo systemctl <span class=\"built_in\">enable</span> docker </span><br><span class=\"line\">  sudo systemctl restart docker</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 10.退出登陆生效</span></span><br><span class=\"line\">  <span class=\"built_in\">exit</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 名称: disk::Lvsmanager</span></span><br><span class=\"line\"><span class=\"comment\">## 用途: uBuntu操作系统磁盘 LVS 逻辑卷添加与配置(扩容流程)</span></span><br><span class=\"line\"><span class=\"comment\">## 参数: 无</span></span><br><span class=\"line\">disk::<span class=\"function\"><span class=\"title\">Lvsmanager</span></span> () &#123;</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"\\n分区信息:\"</span></span><br><span class=\"line\">  sudo df -Th</span><br><span class=\"line\">  sudo lsblk</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n 磁盘信息：\"</span></span><br><span class=\"line\">  sudo fdisk -l</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n PV物理卷查看：\"</span></span><br><span class=\"line\">  sudo pvscan</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n vgs虚拟卷查看：\"</span></span><br><span class=\"line\">  sudo vgs</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n lvscan逻辑卷扫描:\"</span></span><br><span class=\"line\">  sudo lvscan</span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">\"\\n 分区扩展\"</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"Ubuntu \\n lvextend -L +74G /dev/ubuntu-vg/ubuntu-lv\"</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"lsblk\"</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> -e <span class=\"string\">\"ubuntu general \\n # resize2fs -p -F /dev/mapper/ubuntu--vg-ubuntu--lv\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安全加固过程临时文件清理为基线镜像做准备</span></span><br><span class=\"line\"><span class=\"built_in\">unalias</span> rm</span><br><span class=\"line\">find ~/.trash/* -delete</span><br><span class=\"line\">find /home/ -<span class=\"built_in\">type</span> d -name .trash -<span class=\"built_in\">exec</span> find &#123;&#125; -delete \\;</span><br><span class=\"line\">find /var/<span class=\"built_in\">log</span> -name <span class=\"string\">\"*.gz\"</span> -delete</span><br><span class=\"line\">find /var/<span class=\"built_in\">log</span> -name <span class=\"string\">\"*log.*\"</span> -delete</span><br><span class=\"line\">find /var/<span class=\"built_in\">log</span> -name <span class=\"string\">\"vmware-*.*.log\"</span> -delete</span><br><span class=\"line\">find /var/<span class=\"built_in\">log</span> -name <span class=\"string\">\"*.log-*\"</span> -delete</span><br><span class=\"line\">find /var/<span class=\"built_in\">log</span> -name <span class=\"string\">\"*.log\"</span> -<span class=\"built_in\">exec</span> truncate -s 0 &#123;&#125; \\;</span><br><span class=\"line\">find /tmp/* -delete</span><br></pre></td></tr></table></figure>\n<p>至此 Ubuntu 安全加固脚本完毕。</p>\n<p>原文地址: Linux与Windows服务器操作系统安全防御实践指南 ( <a href=\"https://blog.weiyigeek.top/2020/10-13-585.html\">https://blog.weiyigeek.top/2020/10-13-585.html</a> )</p>\n<hr>\n<h2 id=\"0x04-补充说明\"><a href=\"#0x04-补充说明\" class=\"headerlink\" title=\"0x04 补充说明\"></a>0x04 补充说明</h2><p>第一次投稿给安全客，心里还是有点小激动的，在投稿时让我想起曾经深夜挖洞的过往，不知不觉已过几年了，颇多的感慨，仰望众多大佬的脚步前行，勿忘初心、不骄不躁。</p>\n<p>后续我将针对 数据库应用软件以及中间件方面的等保测评项进行搜寻整理，编写安全加固配脚本供大家使用，争取再搞一个系列。</p>\n<p>文章中脚本如有错误，欢迎各位大佬指正。</p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Linux","path":"api/categories/Linux.json"},{"name":"Security","path":"api/categories/Security.json"}],"tags":[{"name":"安全配置","path":"api/tags/安全配置.json"}]}