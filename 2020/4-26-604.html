<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 2.Goè¯­è¨€ç¼–ç¨‹å­¦ä¹ è¯¾åå®è·µ|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="Go">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/2018/1-1-1.html"  >
                <i class="icon icon-lg icon-mortar-board"></i>
                å­¦ä¹ ä¹‹è·¯
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>2.Goè¯­è¨€ç¼–ç¨‹å­¦ä¹ è¯¾åå®è·µ</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">2.Goè¯­è¨€ç¼–ç¨‹å­¦ä¹ è¯¾åå®è·µ</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-04-26T03:16:58.000Z" itemprop="datePublished" class="page-time">
  2020-04-26
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/">Development</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/Programming/">Programming</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
  <article id="post-ç¼–ç¨‹ä¸–ç•Œ/Go/Example/2.Goè¯­è¨€ç¼–ç¨‹å­¦ä¹ è¯¾åå®è·µ"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">2.Goè¯­è¨€ç¼–ç¨‹å­¦ä¹ è¯¾åå®è·µ</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-04-26 11:16:58" datetime="2020-04-26T03:16:58.000Z"  itemprop="datePublished">2020-04-26</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/">Development</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Development/Programming/">Programming</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="0x01-åå°„ç« èŠ‚"><a href="#0x01-åå°„ç« èŠ‚" class="headerlink" title="0x01 åå°„ç« èŠ‚"></a>0x01 åå°„ç« èŠ‚</h2><p><strong>ç¤ºä¾‹1.åˆ©ç”¨reflectåå°„å®ç°ä¸€ä¸ªinié…ç½®æ–‡ä»¶çš„è¯»å– (ini æ–‡ä»¶è§£æå™¨)ã€‚</strong></p>
<p>é¦–å…ˆéœ€è¦å‡†å¤‡ä¸€ä¸ª <code>config.ini</code> é…ç½®æ–‡ä»¶:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">; mysqlDatabaeConfig</span><br><span class="line">[mysql]</span><br><span class="line">address&#x3D;192.168.1.20</span><br><span class="line">port&#x3D;3306</span><br><span class="line">username&#x3D;root</span><br><span class="line">password&#x3D;mysql</span><br><span class="line"></span><br><span class="line"># redusDatabaeConfig</span><br><span class="line">[redis]</span><br><span class="line">host&#x3D;192.168.1.21</span><br><span class="line">port&#x3D;6379</span><br><span class="line">password&#x3D;redis</span><br><span class="line">database&#x3D;0</span><br><span class="line">test&#x3D;false</span><br></pre></td></tr></table></figure></p>
<p>å…¶æ¬¡æ˜¯main.goåˆ©ç”¨åå°„æ–¹æ³•è¯»å–èµ‹äºˆç»“æ„ä½“å¯¹è±¡ä¹‹ä¸­<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"errors"</span></span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"io/ioutil"</span></span><br><span class="line">  <span class="string">"os"</span></span><br><span class="line">  <span class="string">"reflect"</span></span><br><span class="line">  <span class="string">"strconv"</span></span><br><span class="line">  <span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// mysql æ•°æ®åº“é…ç½®ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> mysqlConfig <span class="keyword">struct</span> &#123;</span><br><span class="line">  Address  <span class="keyword">string</span> <span class="string">`ini:"address"`</span></span><br><span class="line">  Port     <span class="keyword">int</span>    <span class="string">`ini:"port"`</span></span><br><span class="line">  Username <span class="keyword">string</span> <span class="string">`ini:"username"`</span></span><br><span class="line">  Password <span class="keyword">string</span> <span class="string">`ini:"password"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// redis æ•°æ®åº“é…ç½®ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> redisConfig <span class="keyword">struct</span> &#123;</span><br><span class="line">  Host     <span class="keyword">string</span> <span class="string">`ini:"host"`</span></span><br><span class="line">  Port     <span class="keyword">int</span>    <span class="string">`ini:"port"`</span></span><br><span class="line">  Password <span class="keyword">string</span> <span class="string">`ini:"password"`</span></span><br><span class="line">  Database <span class="keyword">string</span> <span class="string">`ini:"database"`</span></span><br><span class="line">  Test     <span class="keyword">bool</span>   <span class="string">`ini:"test"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æ„ä½“åµŒå¥—</span></span><br><span class="line"><span class="keyword">type</span> Config <span class="keyword">struct</span> &#123;</span><br><span class="line">  mysqlConfig <span class="string">`ini:"mysql"`</span></span><br><span class="line">  redisConfig <span class="string">`ini:"redis"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadFileConfig</span><span class="params">(data <span class="keyword">interface</span>&#123;&#125;, configfile <span class="keyword">string</span>)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">  <span class="comment">// (1) å‚æ•°æ ¡éªŒ</span></span><br><span class="line">  t := reflect.TypeOf(data)</span><br><span class="line">  fmt.Println(<span class="string">"å‚æ•°æ ¡éªŒ:"</span>, t, t.Kind(), t.Elem().Kind())</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¼ é€’çš„dataå‚æ•°å¿…é¡»æ˜¯æŒ‡é’ˆç±»å‹(å› ä¸ºéœ€è¦åœ¨å‡½æ•°ä¸­å¯¹å…¶èµ‹å€¼)</span></span><br><span class="line">  <span class="keyword">if</span> t.Kind() != reflect.Ptr &#123;</span><br><span class="line">    <span class="comment">// err = fmt.Errorf("[Error] ä¼ é€’çš„dataå‚æ•°å¿…é¡»æ˜¯æŒ‡é’ˆç±»å‹") //  ä¸èƒ½ä»¥æ ‡ç‚¹ç¬¦å·ç»“å°¾ä»¥åŠè¾“å…¥å¤§å†™å­—ç¬¦å¼€å¤´</span></span><br><span class="line">    err = errors.New(<span class="string">"data Param should be a [pointer] type"</span>) <span class="comment">//  ä¸èƒ½ä»¥æ ‡ç‚¹ç¬¦å·ç»“å°¾ä»¥åŠè¾“å…¥å¤§å†™å­—ç¬¦å¼€å¤´</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ä¼ é€’æ¥dataå‚æ•°è¿˜å¿…é¡»æ˜¯ç»“æ„ä½“ç±»å‹çš„æŒ‡é’ˆ(å› ä¸ºé…ç½®æ–‡ä»¶ä¸­å„ç§é”®å€¼å¯¹éœ€è¦èµ‹äºˆç»™ç»“æ„ä½“å­—æ®µ)</span></span><br><span class="line">  <span class="keyword">if</span> t.Elem().Kind() != reflect.Struct &#123;</span><br><span class="line">    err = errors.New(<span class="string">"data Param should be a [struct pointer] type"</span>) <span class="comment">//  ä¸èƒ½ä»¥æ ‡ç‚¹ç¬¦å·ç»“å°¾ä»¥åŠè¾“å…¥å¤§å†™å­—ç¬¦å¼€å¤´</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (2) è¯»æ–‡ä»¶å¾—åˆ°å­—èŠ‚ç±»å‹çš„æ•°æ®</span></span><br><span class="line">  ini, err := ioutil.ReadFile(configfile)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å°†æ–‡ä»¶å†…å®¹è½¬æ¢ä¸ºå­—ç¬¦ä¸²,å¹¶æŒ‰ç…§æ¯è¡ŒæŒ‡å®šå­—ç¬¦ä¸²è¿›è¡Œåˆ‡å‰²(Linux: '\n', WIN: '\r\n')</span></span><br><span class="line">  lineSlice := strings.Split(<span class="keyword">string</span>(ini), <span class="string">"\n"</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¯»å–æ¯è¡Œæ•°æ®å¹¶ä¸”æå–å¯¹äºæ•°æ®åˆ°ä¼ é€’çš„å¯¹è±¡ä¹‹ä¸­</span></span><br><span class="line">  <span class="keyword">var</span> structName <span class="keyword">string</span></span><br><span class="line">  <span class="keyword">for</span> index, line := <span class="keyword">range</span> lineSlice &#123;</span><br><span class="line">    <span class="comment">// å–æ¶ˆé…ç½®ä¸­çš„ç©ºæ ¼</span></span><br><span class="line">    line = strings.TrimSpace(line)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨é‡Šåˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> strings.HasPrefix(line, <span class="string">";"</span>) || strings.HasPrefix(line, <span class="string">"#"</span>) &#123;</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç©ºè¡Œåˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(line) == <span class="number">0</span> &#123;</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// èŠ‚[section]åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> strings.HasPrefix(line, <span class="string">"["</span>) &#123;</span><br><span class="line">      <span class="comment">// åˆ¤æ–­å°¾</span></span><br><span class="line">      <span class="keyword">if</span> !strings.HasSuffix(line, <span class="string">"]"</span>) &#123;</span><br><span class="line">        err = fmt.Errorf(<span class="string">"configini Line:%d Syntax Error"</span>, index+<span class="number">1</span>) <span class="comment">// ä¸èƒ½ä»¥æ ‡ç‚¹ç¬¦å·ç»“å°¾ä»¥åŠè¾“å…¥å¤§å†™å­—ç¬¦å¼€å¤´</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// è¿‡æ»¤[]ä¸­åŒ…å«çš„ç©ºæ ¼ï¼Œå¦‚æœé•¿åº¦ä¸º0åˆ™è¡¨ç¤ºæ ¼å¼é”™è¯¯ï¼Œå¦åˆ™æ‹¿åˆ°èŠ‚å†…å®¹</span></span><br><span class="line">      sectionName := strings.TrimSpace(line[<span class="number">1</span> : <span class="built_in">len</span>(line)<span class="number">-1</span>])</span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">len</span>(sectionName) == <span class="number">0</span> &#123;</span><br><span class="line">        err = fmt.Errorf(<span class="string">"configini Line:%d Syntax Error"</span>, index+<span class="number">1</span>) <span class="comment">// ä¸èƒ½ä»¥æ ‡ç‚¹ç¬¦å·ç»“å°¾ä»¥åŠè¾“å…¥å¤§å†™å­—ç¬¦å¼€å¤´</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ ¹æ®[]ä¸­åŒ…å«çš„å­—ç¬¦ä¸²å…¶dataå‚æ•°æ ¹æ®åå°„æ‰¾å¯¹åº”ç»“æ„ä½“</span></span><br><span class="line">      <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; t.Elem().NumField(); i++ &#123; <span class="comment">// t.Elem() æ‹¿å–æŒ‡é’ˆä¸­çš„å…ƒç´ </span></span><br><span class="line">        field := t.Elem().Field(i)</span><br><span class="line">        <span class="keyword">if</span> sectionName == field.Tag.Get(<span class="string">"ini"</span>) &#123;</span><br><span class="line">          <span class="comment">// è®°å½•å¯¹åº”çš„åµŒå¥—ç»“æ„ä½“çš„å­—æ®µåç§°</span></span><br><span class="line">          structName = field.Name</span><br><span class="line">          fmt.Printf(<span class="string">"[+] æ‰¾åˆ°%så¯¹åº”çš„åµŒå¥—ç»“æ„ä½“: %s\n"</span>, sectionName, structName)</span><br><span class="line">          <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœä¸æ˜¯ä»¥ [  å¼€å¤´çš„è¡Œæ„å‘³æ˜¯å°†å€¼å¯¹ï¼Œé…ç½®æ–‡ä»¶ Key=value åˆ¤æ–­ä¸èµ‹å€¼ç»™æˆ‘ä»¬å®šä¹‰çš„ç»“æ„ä½“</span></span><br><span class="line">      <span class="comment">// æ ¼å¼åˆ¤æ–­</span></span><br><span class="line">      <span class="keyword">if</span> !strings.Contains(line, <span class="string">"="</span>) || strings.HasPrefix(line, <span class="string">"="</span>) &#123;</span><br><span class="line">        err = fmt.Errorf(<span class="string">"configini Line:%d Syntax Error"</span>, index+<span class="number">1</span>) <span class="comment">// ä¸èƒ½ä»¥æ ‡ç‚¹ç¬¦å·ç»“å°¾ä»¥åŠè¾“å…¥å¤§å†™å­—ç¬¦å¼€å¤´</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å–å‡ºiniä¸­æ¯ä¸€è¡Œçš„æ•°æ®key=value</span></span><br><span class="line">      equalIndex := strings.Index(line, <span class="string">"="</span>)</span><br><span class="line">      key := strings.TrimSpace(line[:equalIndex])</span><br><span class="line">      value := strings.TrimSpace(line[equalIndex+<span class="number">1</span>:])</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ ¹æ® structName åç§°å»dataåŒ¿åæŠŠå¯¹åº”åµŒå¥—çš„ç»“æ„ä½“ä¿¡æ¯å–å‡º</span></span><br><span class="line">      v := reflect.ValueOf(data)                 <span class="comment">// åå°„å–å€¼</span></span><br><span class="line">      sValue := v.Elem().FieldByName(structName) <span class="comment">// åµŒå¥—ç»“æ„ä½“å€¼ä¿¡æ¯</span></span><br><span class="line">      sType := sValue.Type()                     <span class="comment">// åµŒå¥—ç»“æ„ä½“ç±»å‹ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> sValue.Kind() != reflect.Struct &#123;</span><br><span class="line">        err = fmt.Errorf(<span class="string">"[-] data ä¸­ %s å­—æ®µåº”è¯¥æ˜¯ä¸€ä¸ªç»“æ„ä½“"</span>, structName) <span class="comment">// ä¸èƒ½ä»¥æ ‡ç‚¹ç¬¦å·ç»“å°¾ä»¥åŠè¾“å…¥å¤§å†™å­—ç¬¦å¼€å¤´</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// éå†åµŒå¥—ç»“æ„ä½“ä¸­æ¯ä¸€ä¸ªå­—æ®µï¼Œåˆ¤æ–­Tagæ˜¯å¦ç­‰äºKeyã€‚</span></span><br><span class="line">      <span class="keyword">var</span> fieldName <span class="keyword">string</span></span><br><span class="line">      <span class="keyword">var</span> fieldType reflect.StructField</span><br><span class="line">      <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; sValue.NumField(); i++ &#123;</span><br><span class="line">        field := sType.Field(i) <span class="comment">// åå°„ç±»å‹ä¿¡æ¯ä¸­å­˜å‚¨äº†åµŒå¥—ç»“æ„ä½“ä¸­çš„Tagä¿¡æ¯</span></span><br><span class="line">        fieldType = field       <span class="comment">// åå°„ç±»å‹ä¿¡æ¯ä¸­å­˜å‚¨äº†åµŒå¥—ç»“æ„ä½“ä¸­çš„filedä¿¡æ¯ä»¥ä¾›åç»­å€¼ç±»å‹åˆ¤æ–­ä½¿ç”¨</span></span><br><span class="line">        <span class="keyword">if</span> field.Tag.Get(<span class="string">"ini"</span>) == key &#123;</span><br><span class="line">          <span class="comment">// æ‰¾åˆ°ç»“æ„ä½“ä¸­å¯¹åº”çš„å­—æ®µ</span></span><br><span class="line">          fieldName = field.Name</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœå­—æ®µåç§°ä¸å­˜åœ¨åµŒå¥—ç»“æ„ä½“ä¸­åˆ™è·³è¿‡</span></span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">len</span>(fieldName) == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœkeyç­‰äºtagå°±ç»™è¯¥å­—æ®µèµ‹å€¼</span></span><br><span class="line">      fieldObj := sValue.FieldByName(fieldName)</span><br><span class="line">      fmt.Println(fieldName, fieldType.Type.Kind())</span><br><span class="line">      <span class="comment">// å°†è¯»å–å¯¹åº”çš„å­—ç¬¦ä¸²è½¬ä¸ºç»“æ„ä½“å­—æ®µä¸­å¯¹åº”çš„å€¼çš„ç±»å‹ï¼Œå¹¶å°†å…¶èµ‹äºˆã€‚</span></span><br><span class="line">      <span class="keyword">switch</span> fieldType.Type.Kind() &#123;</span><br><span class="line">      <span class="keyword">case</span> reflect.String:</span><br><span class="line">        fieldObj.SetString(value) <span class="comment">// æ³¨æ„ç‚¹</span></span><br><span class="line">      <span class="keyword">case</span> reflect.Int, reflect.Int8, reflect.Int16, reflect.Int32, reflect.Int64:</span><br><span class="line">        <span class="keyword">var</span> valueInt <span class="keyword">int64</span>                              <span class="comment">// æ³¨æ„ç‚¹</span></span><br><span class="line">        valueInt, err = strconv.ParseInt(value, <span class="number">10</span>, <span class="number">64</span>) <span class="comment">// ç±»å‹è½¬æ¢</span></span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">          fmt.Printf(<span class="string">"configini Line:%d value type error,msg: %s"</span>, index+<span class="number">1</span>, err)</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        fieldObj.SetInt(valueInt)</span><br><span class="line">      <span class="keyword">case</span> reflect.Float32, reflect.Float64:</span><br><span class="line">        <span class="keyword">var</span> valueFloat <span class="keyword">float64</span>                          <span class="comment">// æ³¨æ„ç‚¹</span></span><br><span class="line">        valueFloat, err = strconv.ParseFloat(value, <span class="number">64</span>) <span class="comment">// ç±»å‹è½¬æ¢</span></span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">          fmt.Printf(<span class="string">"configini Line:%d value type error,msg: %s"</span>, index+<span class="number">1</span>, err)</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        fieldObj.SetFloat(valueFloat)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> reflect.Bool:</span><br><span class="line">        <span class="keyword">var</span> valueBool <span class="keyword">bool</span>                        <span class="comment">// æ³¨æ„ç‚¹</span></span><br><span class="line">        valueBool, err = strconv.ParseBool(value) <span class="comment">// ç±»å‹è½¬æ¢</span></span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">          fmt.Printf(<span class="string">"configini Line:%d value type error,msg: %s"</span>, index+<span class="number">1</span>, err)</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        fieldObj.SetBool(valueBool)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> cfg Config</span><br><span class="line">  err := loadFileConfig(&amp;cfg, <span class="string">"./config.ini"</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"[Error] Load File Config Failed"</span>)</span><br><span class="line">    os.Exit(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Printf(<span class="string">"åµŒå¥—ç»“æ„ä½“å¯¹è±¡å€¼: %v \n"</span>, cfg)</span><br><span class="line">  fmt.Printf(<span class="string">"åµŒå¥—ç»“æ„ä½“å¯¹è±¡ç±»å‹ä¸å€¼: %#v \n"</span>, cfg)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">å‚æ•°æ ¡éªŒ *main.Config ptr struct</span><br><span class="line">[+] æ‰¾åˆ°mysqlå¯¹åº”çš„åµŒå¥—ç»“æ„ä½“: mysqlConfig</span><br><span class="line">Address string</span><br><span class="line">Port int</span><br><span class="line">Username string</span><br><span class="line">Password string</span><br><span class="line">[+] æ‰¾åˆ°rediså¯¹åº”çš„åµŒå¥—ç»“æ„ä½“: redisConfig</span><br><span class="line">Host string</span><br><span class="line">Port int</span><br><span class="line">Password string</span><br><span class="line">Database string</span><br><span class="line">Test bool</span><br><span class="line">åµŒå¥—ç»“æ„ä½“å¯¹è±¡å€¼: &#123;&#123;192.168.1.20 3306 root mysql&#125; &#123;192.168.1.21 6379 redis 0 <span class="literal">false</span>&#125;&#125; </span><br><span class="line">åµŒå¥—ç»“æ„ä½“å¯¹è±¡ç±»å‹ä¸å€¼: main.Config&#123;mysqlConfig:main.mysqlConfig&#123;Address:<span class="string">"192.168.1.20"</span>, Port:3306, Username:<span class="string">"root"</span>, Password:<span class="string">"mysql"</span>&#125;, redisConfig:main.redisConfig&#123;Host:<span class="string">"192.168.1.21"</span>, Port:6379, Password:<span class="string">"redis"</span>, Database:<span class="string">"0"</span>, Test:<span class="literal">false</span>&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="0x02-Goroutine-ç« èŠ‚"><a href="#0x02-Goroutine-ç« èŠ‚" class="headerlink" title="0x02 Goroutine ç« èŠ‚"></a>0x02 Goroutine ç« èŠ‚</h2><p><strong>ä½œä¸š1.ä½¿ç”¨goroutineå’Œchannelå®ç°ä¸€ä¸ªè®¡ç®—int64éšæœºæ•°å„ä½æ•°å’Œçš„ç¨‹åºã€‚</strong><br>è¦æ±‚:</p>
<ul>
<li>å¼€å¯ä¸€ä¸ªgoroutineå¾ªç¯ç”Ÿæˆint64ç±»å‹çš„éšæœºæ•°ï¼Œå‘é€åˆ°jobChan</li>
<li>å¼€å¯24ä¸ªgoroutineä»jobChanä¸­å–å‡ºéšæœºæ•°è®¡ç®—å„ä½æ•°çš„å’Œï¼Œå°†ç»“æœå‘é€åˆ°resultChan</li>
<li>ä¸»goroutineä»resultChanå–å‡ºç»“æœå¹¶æ‰“å°åˆ°ç»ˆç«¯è¾“å‡º</li>
</ul>
<p>ç¤ºä¾‹æ¼”ç¤º:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"math/rand"</span></span><br><span class="line">  <span class="string">"sync"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æ„ä½“å£°æ˜</span></span><br><span class="line"><span class="keyword">type</span> job <span class="keyword">struct</span> &#123;</span><br><span class="line">  value <span class="keyword">int64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> result <span class="keyword">struct</span> &#123;</span><br><span class="line">  job *job <span class="comment">// ç»“æ„ä½“åµŒå¥—</span></span><br><span class="line">  sum <span class="keyword">int64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¹¶å‘ç­‰å¾…ç»„å£°æ˜</span></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–goroutine</span></span><br><span class="line"><span class="keyword">var</span> jobChan = <span class="built_in">make</span>(<span class="keyword">chan</span> *job, <span class="number">100</span>)</span><br><span class="line"><span class="keyword">var</span> resultChan = <span class="built_in">make</span>(<span class="keyword">chan</span> *result, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‚æ•°gé€šé“åªå†™</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">generate</span><span class="params">(g <span class="keyword">chan</span>&lt;- *job)</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> wg.Done()</span><br><span class="line">  <span class="comment">// å¾ªç¯ç”Ÿæˆint64éšæœºæ•°</span></span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    i := rand.Int63()</span><br><span class="line">    <span class="comment">// å®ä¾‹åŒ–</span></span><br><span class="line">    newJob := &amp;job&#123;</span><br><span class="line">      value: i,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†å®ä¾‹åŒ–çš„å¯¹è±¡å­˜å…¥é€šé“ä¸­</span></span><br><span class="line">    g &lt;- newJob</span><br><span class="line">    time.Sleep(time.Millisecond * <span class="number">500</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‚æ•°ré€šé“iåªå†™ï¼Œå‚æ•°gé€šé“åªè¯»</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">numberSum</span><span class="params">(r <span class="keyword">chan</span>&lt;- *result, g &lt;-<span class="keyword">chan</span> *job)</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> wg.Done()</span><br><span class="line">  <span class="comment">// å¾ªç¯å–å¾—numberçš„æ¯ä¸ªæ•°å­—å¹¶ç´¯ç§¯å…¶å’Œ,å°†ç»“æœå‘é€åˆ°é€šé“rä¸­</span></span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    <span class="comment">// æ³¨æ„ç‚¹,æ­¤å¤„å°†gé€šé“å€¼èµ‹äºˆç»™job</span></span><br><span class="line">    job := &lt;-g</span><br><span class="line">    sum := <span class="keyword">int64</span>(<span class="number">0</span>)</span><br><span class="line">    number := job.value</span><br><span class="line">    <span class="comment">// æ³¨æ„ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> number &gt; <span class="number">0</span> &#123;</span><br><span class="line">      sum += number % <span class="number">10</span> <span class="comment">// å–ä½™</span></span><br><span class="line">      number /= <span class="number">10</span>       <span class="comment">// å–å•†ï¼ˆæ•´ï¼‰</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ³¨æ„ç‚¹,å‚æ•° g ä¼ å…¥çš„jobç±»å‹çš„é€šé“</span></span><br><span class="line">    newResult := &amp;result&#123;</span><br><span class="line">      job: job,</span><br><span class="line">      sum: sum,</span><br><span class="line">    &#125;</span><br><span class="line">    r &lt;- newResult</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤goroutineå°†ä¼šæŒç»­ä¸æ–­çš„ç”Ÿäº§éšæœºæ•°ï¼Œä»¥åŠå–å‡ºéšæœºæ•°è®¡ç®—å„ä½æ•°çš„å’Œã€‚(å°†ä¼šä¸€ç›´æ‰§è¡Œï¼Œå› ä¸ºä¸€ç›´åœ¨å–è€Œå¦å¤–ä¸€è¾¹ä¸€ç›´åœ¨å–)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1.å¼€å¯ä¸€ä¸ªgoroutineå¾ªç¯ç”Ÿæˆint64ç±»å‹çš„éšæœºæ•°ï¼Œå‘é€åˆ°jobChan</span></span><br><span class="line">  wg.Add(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">go</span> generate(jobChan)</span><br><span class="line">  <span class="comment">// 2.å¼€å¯24ä¸ªgoroutineä»jobChanä¸­å–å‡ºéšæœºæ•°è®¡ç®—å„ä½æ•°çš„å’Œï¼Œå°†ç»“æœå‘é€åˆ°resultChan</span></span><br><span class="line">  wg.Add(<span class="number">24</span>)</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">24</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">go</span> numberSum(resultChan, jobChan)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 3.ä¸»goroutineä»resultChanå–å‡ºç»“æœå¹¶æ‰“å°åˆ°ç»ˆç«¯è¾“å‡º</span></span><br><span class="line">  <span class="keyword">for</span> res := <span class="keyword">range</span> resultChan &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"number = %d, sum = %d\n"</span>, res.job.value, res.sum)</span><br><span class="line">  &#125;</span><br><span class="line">  wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ‰§è¡Œç»“æœ:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">number = <span class="number">5577006791947779410</span>, sum = <span class="number">95</span></span><br><span class="line">number = <span class="number">8674665223082153551</span>, sum = <span class="number">79</span></span><br><span class="line">number = <span class="number">6129484611666145821</span>, sum = <span class="number">81</span></span><br><span class="line">number = <span class="number">4037200794235010051</span>, sum = <span class="number">53</span></span><br><span class="line">number = <span class="number">3916589616287113937</span>, sum = <span class="number">95</span></span><br><span class="line">number = <span class="number">6334824724549167320</span>, sum = <span class="number">80</span></span><br><span class="line">number = <span class="number">605394647632969758</span>, sum = <span class="number">99</span></span><br><span class="line">number = <span class="number">1443635317331776148</span>, sum = <span class="number">77</span></span><br><span class="line">number = <span class="number">894385949183117216</span>, sum = <span class="number">89</span></span><br><span class="line">number = <span class="number">2775422040480279449</span>, sum = <span class="number">80</span></span><br><span class="line">number = <span class="number">4751997750760398084</span>, sum = <span class="number">99</span></span><br><span class="line">number = <span class="number">7504504064263669287</span>, sum = <span class="number">84</span></span><br><span class="line">number = <span class="number">1976235410884491574</span>, sum = <span class="number">88</span></span><br><span class="line">number = <span class="number">3510942875414458836</span>, sum = <span class="number">87</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="0x03-Socket-ç½‘ç»œç¼–ç¨‹ç« èŠ‚"><a href="#0x03-Socket-ç½‘ç»œç¼–ç¨‹ç« èŠ‚" class="headerlink" title="0x03 Socket ç½‘ç»œç¼–ç¨‹ç« èŠ‚"></a>0x03 Socket ç½‘ç»œç¼–ç¨‹ç« èŠ‚</h2><p><strong>ç¤ºä¾‹1.åˆ©ç”¨Goå®ç°ä¸€ä¸ªç®€å•çš„èŠå¤©ç¤ºä¾‹ç¨‹åº</strong><br>æè¿°: æœ¬å®è·µæ¡ˆä¾‹ç»“åˆå’±ä»¬å‰é¢æ‰€å­¦çš„çŸ¥è¯†,å®ç°ä¸€ä¸ªç®€å•çš„èŠå¤©ç¤ºä¾‹ç¨‹åº,å®ƒå¯ä»¥åœ¨å‡ ä¸ªç”¨æˆ·ä¹‹é—´ç›¸äº’å¹¿æ’­æ–‡æœ¬æ¶ˆæ¯ã€‚</p>
<p>æœåŠ¡ç«¯ç¨‹åº: åŒ…å«4 ä¸ª goroutineï¼Œåˆ†åˆ«æ˜¯ä¸€ä¸ª<code>ä¸» goroutine</code> å’Œ<code>å¹¿æ’­ï¼ˆbroadcasterï¼‰goroutine</code>ï¼Œæ¯ä¸€ä¸ªè¿æ¥é‡Œé¢åˆåŒ…å«ä¸€ä¸ª<code>è¿æ¥å¤„ç†ï¼ˆhandleConnï¼‰goroutine</code> å’Œ ä¸€ä¸ª<code>å®¢æˆ·å†™å…¥ï¼ˆclientwriterï¼‰goroutine</code>ã€‚</p>
<ul>
<li>ä¸» ï¼ˆMain å‡½æ•°ï¼‰ goroutine çš„å·¥ä½œæ˜¯ç›‘å¬ç«¯å£ï¼Œæ¥å—è¿æ¥å®¢æˆ·ç«¯çš„ç½‘ç»œè¿æ¥ï¼Œå¯¹æ¯ä¸€ä¸ªè¿æ¥ï¼Œå®ƒå°†åˆ›å»ºä¸€ä¸ªæ–°çš„ handleConn goroutineã€‚</li>
<li><p>å¹¿æ’­ï¼ˆbroadcaster å‡½æ•°ï¼‰goroutine çš„å·¥ä½œä¸»è¦æ˜¯è´Ÿè´£å¹¿æ’­æ‰€æœ‰ç”¨æˆ·å‘é€çš„æ¶ˆæ¯ï¼Œä½¿ç”¨selectå¯¹ä¸‰ç§ä¸åŒçš„æ¶ˆæ¯è¿›è¡Œå“åº”ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># select å¼€å¯ä¸€ä¸ªå¤šè·¯å¤ç”¨çš„ä½œç”¨</span></span><br><span class="line">* æ¯å½“æœ‰å¹¿æ’­æ¶ˆæ¯ä» messages å‘é€è¿›æ¥ï¼Œéƒ½ä¼šå¾ªç¯ cliens å¯¹é‡Œé¢çš„æ¯ä¸ª channel å‘æ¶ˆæ¯ã€‚</span><br><span class="line">* æ¯å½“æœ‰æ¶ˆæ¯ä» entering é‡Œé¢å‘é€è¿‡æ¥ï¼Œå°±ç”Ÿæˆä¸€ä¸ªæ–°çš„ key - valueï¼Œç›¸å½“äºç»™ clients é‡Œé¢å¢åŠ ä¸€ä¸ªæ–°çš„ clientã€‚</span><br><span class="line">* æ¯å½“æœ‰æ¶ˆæ¯ä» leaving é‡Œé¢å‘é€è¿‡æ¥ï¼Œå°±åˆ æ‰è¿™ä¸ª key - value å¯¹ï¼Œå¹¶å…³é—­å¯¹åº”çš„ channelã€‚</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿æ¥å¤„ç†ï¼ˆhandleConn å‡½æ•°ï¼‰goroutine : ä¸»è¦å·¥ä½œä¼šä¸ºæ¯ä¸ªè¿‡æ¥å¤„ç†çš„ conn éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„ channelï¼Œå¼€å¯ä¸€ä¸ªæ–°çš„ goroutine å»æŠŠå‘é€ç»™è¿™ä¸ª channel çš„æ¶ˆæ¯å†™è¿› connã€‚<br>å®ƒåˆ›å»ºä¸€ä¸ªå¯¹å¤–å‘é€æ¶ˆæ¯çš„æ–°é€šé“ï¼Œç„¶åé€šè¿‡ entering é€šé“é€šçŸ¥å¹¿æ’­è€…æ–°å®¢æˆ·åˆ°æ¥ï¼Œæ¥ç€å®ƒè¯»å–å®¢æˆ·å‘æ¥çš„æ¯ä¸€è¡Œæ–‡æœ¬ï¼Œé€šè¿‡å…¨å±€æ¥æ”¶æ¶ˆæ¯é€šé“å°†æ¯ä¸€è¡Œå‘é€ç»™å¹¿æ’­è€…ï¼Œå‘é€æ—¶åœ¨æ¯æ¡æ¶ˆæ¯å‰é¢åŠ ä¸Šå‘é€è€… ID ä½œä¸ºå‰ç¼€ã€‚ä¸€æ—¦ä»å®¢æˆ·ç«¯è¯»å–å®Œæ¯•æ¶ˆæ¯ï¼ŒhandleConn é€šè¿‡ leaving é€šé“é€šçŸ¥å®¢æˆ·ç¦»å¼€ï¼Œç„¶åå…³é—­è¿æ¥ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¯¥å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹å¯ä»¥ç®€å•æ€»ç»“ä¸ºå¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</span></span><br><span class="line">* è·å–è¿æ¥è¿‡æ¥çš„ ip åœ°å€å’Œç«¯å£å·ï¼›</span><br><span class="line">* æŠŠæ¬¢è¿ä¿¡æ¯å†™è¿› channel è¿”å›ç»™å®¢æˆ·ç«¯ï¼›</span><br><span class="line">* ç”Ÿæˆä¸€æ¡å¹¿æ’­æ¶ˆæ¯å†™è¿› messages é‡Œï¼›</span><br><span class="line">* æŠŠè¿™ä¸ª channel åŠ å…¥åˆ°å®¢æˆ·ç«¯é›†åˆï¼Œä¹Ÿå°±æ˜¯ entering &lt;- chï¼›</span><br><span class="line">* ç›‘å¬å®¢æˆ·ç«¯å¾€ conn é‡Œå†™çš„æ•°æ®ï¼Œæ¯æ‰«æåˆ°ä¸€æ¡å°±å°†è¿™æ¡æ¶ˆæ¯å‘é€åˆ°å¹¿æ’­ channel ä¸­ï¼›</span><br><span class="line">* å¦‚æœå…³é—­äº†å®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆæŠŠé˜Ÿåˆ—ç¦»å¼€å†™å…¥ leaving äº¤ç»™å¹¿æ’­å‡½æ•°å»åˆ é™¤è¿™ä¸ªå®¢æˆ·ç«¯å¹¶å…³é—­è¿™ä¸ªå®¢æˆ·ç«¯ï¼›</span><br><span class="line">* å¹¿æ’­é€šçŸ¥å…¶ä»–å®¢æˆ·ç«¯è¯¥å®¢æˆ·ç«¯å·²å…³é—­ï¼›</span><br><span class="line">* æœ€åå…³é—­è¿™ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ Conn.Close()ã€‚</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®¢æˆ·å†™å…¥ï¼ˆclientwriter å‡½æ•°ï¼‰goroutine : ä¸»è¦å·¥ä½œæ˜¯å°†ä¼ å…¥çš„ché€šé“è¿›è¡Œéå†å¹¶å°†å…¶ä¸­å­˜å‚¨çš„ä¿¡æ¯ä¼ è¾“åˆ°connèµ„æºå¯¹è±¡ä¸­ã€‚</p>
</li>
</ul>
<p><br></p>
<p>å®¢æˆ·ç«¯ç¨‹åº: ä¸»è¦åŒ…å«ä¸€ä¸ªå¹¶å‘åŒ¿åå‡½æ•°ï¼Œç”¨äºæ¥æ”¶æœåŠ¡ç«¯å‘é€çš„ä¿¡æ¯æ‰“å°åˆ°æœ¬åœ°ç»ˆç«¯ä¸­ã€‚</p>
<p><br/></p>
<p>æœåŠ¡ç«¯å®Œæ•´ä»£ç :<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server ç«¯æ˜¯ä¸€ä¸ªæ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„ä¿¡æ¯å¹¶å°†ä¿¡æ¯è¿›è¡Œå¹¿æ’­.</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"bufio"</span></span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"log"</span></span><br><span class="line">  <span class="string">"net"</span></span><br><span class="line">  <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// (1) å£°æ˜å¯¹å¤–å‘é€æ¶ˆæ¯çš„å…¨å±€é€šé“å­—ç¬¦ä¸²ç±»å‹.</span></span><br><span class="line"><span class="keyword">type</span> client <span class="keyword">chan</span>&lt;- <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// (2) å£°æ˜å®¢æˆ·ç«¯çŠ¶æ€ä»¥åŠå‘é€çš„ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">  entering = <span class="built_in">make</span>(<span class="keyword">chan</span> client)</span><br><span class="line">  leaving  = <span class="built_in">make</span>(<span class="keyword">chan</span> client)</span><br><span class="line">  messages = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>) <span class="comment">// æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// (4) å¹¶å‘broadcasterå¹¿æ’­å™¨,å¾ªç¯ç›‘å¬é€šé“ä¸­æ˜¯å¦æœ‰å†…å®¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">broadcaster</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// å®ƒä½¿ç”¨å±€éƒ¨å˜é‡ clients æ¥è®°å½•å½“å‰è¿æ¥çš„å®¢æˆ·é›†åˆï¼Œæ¯ä¸ªå®¢æˆ·å”¯ä¸€è¢«è®°å½•çš„ä¿¡æ¯æ˜¯å…¶å¯¹å¤–å‘é€æ¶ˆæ¯é€šé“çš„ ID.</span></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–å£°æ˜,ä½¿ç”¨ä¸€ä¸ªå­—å…¸æ¥ä¿å­˜ç”¨æˆ· clientsï¼Œå­—å…¸çš„ key æ˜¯å„è¿æ¥ç”³æ˜çš„å•å‘å¹¶å‘é˜Ÿåˆ—ã€‚</span></span><br><span class="line">  clients := <span class="built_in">make</span>(<span class="keyword">map</span>[client]<span class="keyword">bool</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¾ªç¯æ‰§è¡Œ&amp;å¼€å¯ä¸€ä¸ªå¤šè·¯å¤ç”¨</span></span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="comment">// æ¯å½“æœ‰å¹¿æ’­æ¶ˆæ¯ä» messages å‘é€è¿›æ¥ï¼Œéƒ½ä¼šå¾ªç¯ cliens å¯¹é‡Œé¢çš„æ¯ä¸ª channel å‘æ¶ˆæ¯ã€‚</span></span><br><span class="line">    <span class="keyword">case</span> msg := &lt;-messages:</span><br><span class="line">      <span class="comment">// æŠŠæ‰€æœ‰æ¥æ”¶åˆ°çš„æ¶ˆæ¯å¹¿æ’­ç»™æ‰€æœ‰å®¢æˆ·ç«¯</span></span><br><span class="line">      <span class="keyword">for</span> cli := <span class="keyword">range</span> clients &#123;</span><br><span class="line">        cli &lt;- msg <span class="comment">// å‘é€æ¶ˆæ¯é€šé“</span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="comment">// æ¯å½“æœ‰æ¶ˆæ¯ä» entering é‡Œé¢å‘é€è¿‡æ¥ï¼Œå°±ç”Ÿæˆä¸€ä¸ªæ–°çš„ key - valueï¼Œç›¸å½“äºç»™ clients é‡Œé¢å¢åŠ ä¸€ä¸ªæ–°çš„ clientã€‚</span></span><br><span class="line">    <span class="keyword">case</span> cli := &lt;-entering:</span><br><span class="line">      clients[cli] = <span class="literal">true</span> <span class="comment">// è¡¨é¢å®¢æˆ·ç«¯ä¸Šçº¿</span></span><br><span class="line">    <span class="comment">// æ¯å½“æœ‰æ¶ˆæ¯ä» leaving é‡Œé¢å‘é€è¿‡æ¥ï¼Œå°±åˆ æ‰è¿™ä¸ª key - value å¯¹ï¼Œå¹¶å…³é—­å¯¹åº”çš„ channelã€‚</span></span><br><span class="line">    <span class="keyword">case</span> cli := &lt;-leaving:</span><br><span class="line">      <span class="built_in">delete</span>(clients, cli) <span class="comment">// è¡¨é¢å®¢æˆ·ç«¯ç¦»çº¿,å¹¶åˆ é™¤å¯¹åº”çš„è¿æ¥çš„ clients,cli</span></span><br><span class="line">      <span class="built_in">close</span>(cli)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (5) å¹¶å‘ handleConn å‡½æ•°åˆ›å»ºä¸€ä¸ªå¯¹å¤–å‘é€æ¶ˆæ¯çš„æ–°é€šé“,</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleConn</span><span class="params">(conn net.Conn)</span></span> &#123;</span><br><span class="line">  <span class="comment">// å¯¹å¤–å‘é€å®¢æˆ·æ¶ˆæ¯çš„é€šé“</span></span><br><span class="line">  ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>)</span><br><span class="line">  <span class="keyword">go</span> clientWriter(conn, ch)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è·å–å®¢æˆ·ç«¯;è¿æ¥è¿‡æ¥çš„ç½‘ç»œåœ°å€å’Œç«¯å£ä¿¡æ¯</span></span><br><span class="line">  who := conn.RemoteAddr().String()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å‘é€šé“ä¼ å…¥å®¢æˆ·ç«¯ä¿¡æ¯</span></span><br><span class="line">  ch &lt;- <span class="string">"æ¬¢è¿ "</span> + who</span><br><span class="line">  messages &lt;- who + <span class="string">" ä¸Šçº¿"</span></span><br><span class="line">  entering &lt;- ch</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¯»å–å®¢æˆ·ç«¯ä¼ å…¥çš„ä¿¡æ¯å¹¶ä¼ å…¥messagesé€šé“(åˆ©ç”¨å…¶è¿›è¡Œå¹¿æ’­ç»™å…¶ä»–å®¢æˆ·ç«¯)</span></span><br><span class="line">  input := bufio.NewScanner(conn)</span><br><span class="line">  <span class="keyword">for</span> input.Scan() &#123;</span><br><span class="line">    messages &lt;- who + <span class="string">": "</span> + input.Text()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸€æ—¦ä»å®¢æˆ·ç«¯è¯»å–å®Œæ¯•æ¶ˆæ¯ï¼ŒhandleConn é€šè¿‡ leaving é€šé“é€šçŸ¥å®¢æˆ·ç¦»å¼€ï¼Œç„¶åå…³é—­è¿æ¥ã€‚</span></span><br><span class="line">  <span class="comment">// æ³¨æ„ï¼šå¿½ç•¥ input.Err() ä¸­å¯èƒ½çš„é”™è¯¯</span></span><br><span class="line">  leaving &lt;- ch</span><br><span class="line">  messages &lt;- who + <span class="string">" ä¸‹çº¿"</span></span><br><span class="line">  conn.Close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (6) clientWriter å®ç°å‘å®¢æˆ·ç«¯å‘ç”Ÿé€šé“ä¸­çš„ä¿¡æ¯.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">clientWriter</span><span class="params">(conn net.Conn, ch &lt;-<span class="keyword">chan</span> <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> msg := <span class="keyword">range</span> ch &#123;</span><br><span class="line">    fmt.Fprintln(conn, msg) <span class="comment">// æ³¨æ„ï¼šå¿½ç•¥ç½‘ç»œå±‚é¢çš„é”™è¯¯</span></span><br><span class="line">    fmt.Printf(<span class="string">"[info] %v - Send -&gt; Client %v\n"</span>, time.Now().Format(<span class="string">"2006-01-02 15:04:06"</span>), msg)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (3) å…¥å£å‡½æ•°,ä¸»è¦è·å¾— listener å¯¹è±¡ï¼Œç„¶åä¸åœçš„è·å–é“¾æ¥ä¸Šæ¥çš„ conn å¯¹è±¡ï¼Œæœ€åæŠŠè¿™äº›å¯¹è±¡ä¸¢ç»™å¤„ç†é“¾æ¥å‡½æ•°å»è¿›è¡Œå¤„ç†ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 3.1 TCP server ç«¯ç›‘æ§</span></span><br><span class="line">  listener, err := net.Listen(<span class="string">"tcp"</span>, <span class="string">"127.0.0.1:30000"</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatal(err) <span class="comment">// è¾“å‡ºä¸¥é‡çš„é”™è¯¯å¹¶æ—¥å¿—é€€å‡ºç¨‹åº</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Server %v Listen Start....\n"</span>, listener.Addr().String())</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.2 broadcasterå‡½æ•°.è´Ÿè´£å¹¿æ’­æ‰€æœ‰ç”¨æˆ·å‘é€çš„æ¶ˆæ¯ã€‚</span></span><br><span class="line">  <span class="keyword">go</span> broadcaster()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.3 å¾ªç¯æ¥æ”¶å®¢æˆ·ç«¯æ¥å…¥è¯·æ±‚</span></span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    conn, err := listener.Accept()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Print(err)</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.4 æ¯ä¸ªå®¢æˆ·è‡ªå·±çš„ goroutine</span></span><br><span class="line">    <span class="keyword">go</span> handleConn(conn)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>å®¢æˆ·ç«¯æ‰§è¡Œç¨‹åº:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client æ˜¯ä¸€ä¸ªç®€å•çš„TCPæœåŠ¡å™¨è¯»/å†™å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"io"</span></span><br><span class="line">  <span class="string">"log"</span></span><br><span class="line">  <span class="string">"net"</span></span><br><span class="line">  <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1.è¿æ¥åˆ°æœåŠ¡ç«¯</span></span><br><span class="line">  conn, err := net.Dial(<span class="string">"tcp"</span>, <span class="string">"127.0.0.1:30000"</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatal(err)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.å£°æ˜åˆå§‹åŒ–ä¸€ä¸ªåŒ¿åç»“æ„ä½“é€šé“(å€¼å¾—å­¦ä¹ )</span></span><br><span class="line">  done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3.åˆ©ç”¨goroutineæ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> wcount <span class="keyword">int64</span></span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼šå¿½ç•¥é”™è¯¯,io.Copy éå¸¸å€¼çš„å­¦ä¹ .</span></span><br><span class="line">    <span class="keyword">if</span> wcount, err = io.Copy(os.Stdout, conn); err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"CONN OUT os.Stdout Error!"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">"å†™å…¥çš„é•¿åº¦: "</span>, wcount)</span><br><span class="line">    log.Println(<span class="string">"Done"</span>)</span><br><span class="line">    done &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125; <span class="comment">// å‘ä¸»Goroutineå‘å‡ºä¿¡å· (å€¼çš„å­¦ä¹ ,å¦‚æœä¸å‘mainå‡½æ•°ä¾¿ä¸ä¼šåœæ­¢,æ­¤æ—¶ç»ˆç«¯äº¦ä¸ä¼šè¢«é˜»å¡)</span></span><br><span class="line">  &#125;()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4.å°†ç»ˆç«¯è¾“å…¥ä¼ é€’ç»™connèµ„æºå¯¹è±¡ç»™æœåŠ¡å™¨</span></span><br><span class="line">  fmt.Println(<span class="string">"è¯·è¾“å…¥ä¿¡æ¯:"</span>)</span><br><span class="line">  mustCopy(conn, os.Stdin)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 5.å…³é—­connèµ„æº</span></span><br><span class="line">  <span class="keyword">defer</span> conn.Close()</span><br><span class="line"></span><br><span class="line">  &lt;-done <span class="comment">// ç­‰å¾…åå°goroutineå®Œæˆ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mustCopy</span><span class="params">(dst io.Writer, src io.Reader)</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> _, err := io.Copy(dst, src); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatal(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸‹å›¾ä¸­å±•ç¤ºäº†åœ¨åŒä¸€å°è®¡ç®—æœºä¸Šè¿è¡Œçš„ä¸€ä¸ªæœåŠ¡ç«¯å’Œä¸‰ä¸ªå®¢æˆ·ç«¯çš„æ‰§è¡Œç»“æœï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ†åˆ«ç¼–è¯‘æ‰§è¡ŒServer.goä¸Client</span></span><br><span class="line">Server $ go build &amp;&amp; ./Server</span><br><span class="line">Client $ go build &amp;&amp; ./Client</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=2.Goè¯­è¨€ç¼–ç¨‹å­¦ä¹ è¯¾åå®è·µ href="https://img.weiyigeek.top/2021/5/20211121144442.png" target="_blank" title="WeiyiGeek.goroutine&Socketç½‘ç»œç¼–ç¨‹å®ä¾‹" data-fancybox="images"><img src="https://img.weiyigeek.top/2021/5/20211121144442.png" alt="WeiyiGeek.goroutine&Socketç½‘ç»œç¼–ç¨‹å®ä¾‹" title="" class=""></a>
                <p>WeiyiGeek.goroutine&Socketç½‘ç»œç¼–ç¨‹å®ä¾‹</p>
            </figure></p>
<hr>
<h2 id="0x04-Unit-å•å…ƒæµ‹è¯•ç« èŠ‚"><a href="#0x04-Unit-å•å…ƒæµ‹è¯•ç« èŠ‚" class="headerlink" title="0x04 Unit å•å…ƒæµ‹è¯•ç« èŠ‚"></a>0x04 Unit å•å…ƒæµ‹è¯•ç« èŠ‚</h2><p><strong>ä½œä¸š1.é’ˆå¯¹èµ°æ¢¯å­ç®—æ³•ä¼˜åŒ–ååŸºå‡†æµ‹è¯•ã€‚</strong><br>å½“æœ‰å¦‚ä¸‹é˜¶æ¢¯å¯¹åº”çš„èµ°æ³•å¦‚ä¸‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 =&gt; 1  <span class="comment"># 1</span></span><br><span class="line">2 =&gt; 2  <span class="comment"># [(1,1) 2]</span></span><br><span class="line">3 =&gt; 3  <span class="comment"># [(1,1,1) (1,2) (2,1)]</span></span><br><span class="line">4 =&gt; 5  <span class="comment"># f(4) = 2f(4-2) + f(4-3) </span></span><br><span class="line">4 =&gt; 5  <span class="comment"># f(5) = 2f(5-2) + f(5-3)  # ä¼˜åŒ–ç‚¹ï¼Œå‡å°‘é€’å½’çš„æ¬¡æ•°ã€‚</span></span><br></pre></td></tr></table></figure></p>
<p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Main æ‰§è¡Œæ—¶çš„æ–‡ä»¶åç§°ï¼Œweiyigeek.top/studygo/Day08/07perfomance/testdemo/stepdemotest.go</span></span><br><span class="line"><span class="comment">// å•å…ƒæµ‹è¯•æ‰§è¡Œçš„é—®é¢˜ï¼Œweiyigeek.top/studygo/Day08/07perfomance/testdemo/stepdemo_test.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"os"</span></span><br><span class="line">  <span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ†åˆ«è®°å½• calcStep(n-1)ï¼ŒcalcStep(n-2)ï¼Œä»¥åŠç¨‹åºæ‰§è¡Œæ¬¡æ•°</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">  x, y, c <span class="keyword">uint</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// # stepladder å¸¸è§„æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calcStep</span><span class="params">(step <span class="keyword">uint</span>)</span> <span class="title">uint</span></span> &#123;</span><br><span class="line">  c += <span class="number">1</span></span><br><span class="line">  <span class="keyword">if</span> step &lt;= <span class="number">0</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"[ERR] - Input Step (%d) Must Greater than 0 "</span>, step)</span><br><span class="line">    os.Exit(<span class="number">-1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">switch</span> step &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">  <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span></span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="keyword">return</span> calcStep(step<span class="number">-1</span>) + calcStep(step<span class="number">-2</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// stepladder ä¼˜åŒ–åæ–¹æ³•ï¼Œå‡å°‘é€’å½’æ¬¡æ•°</span></span><br><span class="line"><span class="comment">// å…³ç³»: f(4) = 2(f2) + f(1)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">optimizationcalcStep</span><span class="params">(step <span class="keyword">uint</span>)</span> <span class="title">uint</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> step &lt;= <span class="number">3</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> calcStep(step)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    x = calcStep(step - <span class="number">2</span>)</span><br><span class="line">    y = calcStep(step - <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>*x + y</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// # å•å…ƒæµ‹è¯•</span></span><br><span class="line"><span class="comment">// æ³¨æ„Teståæ¥çš„å‡½æ•°åç§°é¦–å­—æ¯å¤§å†™(Goå¼€å‘è§„èŒƒ)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestStepladder</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">  <span class="comment">// å¸¸è§„æ–¹æ³•</span></span><br><span class="line">  got := calcStep(<span class="number">16</span>)</span><br><span class="line">  want := <span class="keyword">uint</span>(<span class="number">1597</span>)</span><br><span class="line">  <span class="keyword">if</span> !(got == want) &#123;</span><br><span class="line">    <span class="comment">// æµ‹è¯•ç”¨ä¾‹å¤±è´¥æé†’</span></span><br><span class="line">    t.Errorf(<span class="string">"Want: %v But Got:%v \n"</span>, want, got)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestStepladderOpti</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">  <span class="comment">// ä¼˜åŒ–å</span></span><br><span class="line">  got := optimizationcalcStep(<span class="number">16</span>)</span><br><span class="line">  want := <span class="keyword">uint</span>(<span class="number">1597</span>)</span><br><span class="line">  <span class="keyword">if</span> !(got == want) &#123;</span><br><span class="line">    <span class="comment">// æµ‹è¯•ç”¨ä¾‹å¤±è´¥æé†’</span></span><br><span class="line">    t.Errorf(<span class="string">"Want: %v But Got:%v \n"</span>, want, got)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// # åŸºå‡†æµ‹è¯•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">benchmarkstepladder</span><span class="params">(b *testing.B, step <span class="keyword">uint</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">    calcStep(step)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">benchmarkstepladderOpti</span><span class="params">(b *testing.B, step <span class="keyword">uint</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">    optimizationcalcStep(step)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFib1</span><span class="params">(b *testing.B)</span></span>    &#123; benchmarkstepladder(b, <span class="number">16</span>) &#125;     <span class="comment">// å¸¸è§„ 16 æ­¥é˜¶æ¢¯æœ‰å¤šæ•°ç§èµ°æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFibOpt1</span><span class="params">(b *testing.B)</span></span> &#123; benchmarkstepladderOpti(b, <span class="number">16</span>) &#125; <span class="comment">// ä¼˜åŒ–å</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFib2</span><span class="params">(b *testing.B)</span></span>    &#123; benchmarkstepladder(b, <span class="number">25</span>) &#125;     <span class="comment">// å¸¸è§„ 25 æ­¥é˜¶æ¢¯æœ‰å¤šæ•°ç§èµ°æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkFibOpt2</span><span class="params">(b *testing.B)</span></span> &#123; benchmarkstepladderOpti(b, <span class="number">25</span>) &#125; <span class="comment">// ä¼˜åŒ–å</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// # ç¤ºä¾‹å‡½æ•°</span></span><br><span class="line"><span class="comment">// Example_stepladder å¸¸è§„æ–¹æ³•çš„ç¤ºä¾‹å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Example_stepladder</span><span class="params">()</span></span> &#123;</span><br><span class="line">  got := calcStep(<span class="number">16</span>)</span><br><span class="line">  fmt.Println(got)</span><br><span class="line">  <span class="comment">// output:</span></span><br><span class="line">  <span class="comment">// 1597</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Example_stepladderOpti ä¼˜åŒ–åæ–¹æ³•çš„ç¤ºä¾‹å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Example_stepladderOpti</span><span class="params">()</span></span> &#123;</span><br><span class="line">  got := optimizationcalcStep(<span class="number">16</span>)</span><br><span class="line">  fmt.Println(got)</span><br><span class="line">  <span class="comment">// output:</span></span><br><span class="line">  <span class="comment">// 1597</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// èµ°æ¢¯å­è®¡ç®—ä¼˜åŒ–å‡½æ•°</span></span><br><span class="line">  ret := <span class="function"><span class="keyword">func</span><span class="params">(num <span class="keyword">uint</span>)</span> <span class="title">uint</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> num &lt;= <span class="number">3</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> calcStep(num)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      x = calcStep(num - <span class="number">2</span>) <span class="comment">// å‡å°‘é€’å½’æ¬¡æ•°</span></span><br><span class="line">      y = calcStep(num - <span class="number">3</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="number">2</span>*x + y</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;(<span class="number">16</span>)</span><br><span class="line">  fmt.Printf(<span class="string">"ä¼˜åŒ–èµ°æ¢¯å­æ–¹æ³•. 16æ­¥é˜¶æ¢¯çš„èµ°æ³• = %dï¼Œæ‰§è¡Œæ¬¡æ•°: %d\n"</span>, ret, c)</span><br><span class="line">  c = <span class="number">0</span></span><br><span class="line">  fmt.Printf(<span class="string">"å¸¸è§„èµ°æ¢¯å­æ–¹æ³•. 16æ­¥é˜¶æ¢¯çš„èµ°æ³• = %d, æ‰§è¡Œæ¬¡æ•°: %d\n"</span>, calcStep(<span class="number">16</span>), c)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œç»“æœ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) æ‰§è¡Œ Main çœ‹æ‰§è¡Œç›¸åŒçš„å€¼çš„æ–æ³¢é‚£å¥‘æ•°åˆ—å¯¹åº”å€¼ï¼Œæ‰§è¡Œçš„æ¬¡æ•°ã€(æ³¨æ„æ­¤æ—¶æ–‡ä»¶å: stepdemotest.go)</span></span><br><span class="line">âœ  testdemo go run .</span><br><span class="line">ä¼˜åŒ–èµ°æ¢¯å­æ–¹æ³•. 16æ­¥é˜¶æ¢¯çš„èµ°æ³• = 1597ï¼Œæ‰§è¡Œæ¬¡æ•°: 752    <span class="comment"># å¯ä»¥çœ‹åˆ°æ‰§è¡Œçš„æ¬¡æ•°ï¼Œå¤§å¤§å‡å°‘ï¼Œæ­¤æ•°å€¼ä¼šéšç€</span></span><br><span class="line">å¸¸è§„èµ°æ¢¯å­æ–¹æ³•. 16æ­¥é˜¶æ¢¯çš„èµ°æ³• = 1597, æ‰§è¡Œæ¬¡æ•°: 1219</span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) å•å…ƒæµ‹è¯• &amp; ç¤ºä¾‹æµ‹è¯•(æ³¨æ„æ­¤æ—¶æ–‡ä»¶å: stepdemo_test.go)</span></span><br><span class="line">âœ  testdemo go <span class="built_in">test</span> -v</span><br><span class="line">=== RUN   TestStepladder</span><br><span class="line">--- PASS: TestStepladder (0.00s)</span><br><span class="line">=== RUN   TestStepladderOpti</span><br><span class="line">--- PASS: TestStepladderOpti (0.00s)  <span class="comment"># å•å…ƒæµ‹è¯• é€šè¿‡</span></span><br><span class="line">=== RUN   Example_stepladder</span><br><span class="line">--- PASS: Example_stepladder (0.00s)  <span class="comment"># ç¤ºä¾‹æµ‹è¯• é€šè¿‡</span></span><br><span class="line">=== RUN   Example_stepladderOpti</span><br><span class="line">--- PASS: Example_stepladderOpti (0.00s)</span><br><span class="line">PASS</span><br><span class="line">ok      weiyigeek.top/studygo/Day08/07perfomance/testdemo       0.002s</span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) å¸¸è§„ä¸ä¼˜åŒ–åèµ°é˜¶æ¢¯æ¯”è¾ƒã€‚(æ³¨æ„æ­¤æ—¶æ–‡ä»¶å: stepdemotest.go)</span></span><br><span class="line">âœ  testdemo go <span class="built_in">test</span> -v -bench=. -benchmem --run=none</span><br><span class="line">goos: linux</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: weiyigeek.top/studygo/Day08/07perfomance/testdemo</span><br><span class="line">cpu: Intel(R) Core(TM) i5-3570 CPU @ 3.40GHz</span><br><span class="line">BenchmarkFib1</span><br><span class="line">BenchmarkFib1-4           333187              3145 ns/op               0 B/op          0 allocs/op</span><br><span class="line">BenchmarkFibOpt1</span><br><span class="line">BenchmarkFibOpt1-4        632816              1860 ns/op               0 B/op          0 allocs/op   </span><br><span class="line">BenchmarkFib2</span><br><span class="line">BenchmarkFib2-4             4388            231205 ns/op               0 B/op          0 allocs/op</span><br><span class="line">BenchmarkFibOpt2</span><br><span class="line">BenchmarkFibOpt2-4          8421            141581 ns/op               0 B/op          0 allocs/op</span><br><span class="line">PASS</span><br><span class="line">ok      weiyigeek.top/studygo/Day08/07perfomance/testdemo       6.360s</span><br></pre></td></tr></table></figure></p>
<p>Tips: ç”¨è¿‡ä¸Šé¢çš„æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°åŒæ ·çš„é˜¶æ¢¯æ•°ï¼Œä¼˜åŒ–åæ‰§è¡Œçš„æ¬¡æ•°ä»¥åŠå¹³å‡æ‰§è¡Œè€—æ—¶éƒ½ä¼˜äºå¸¸è§„æ–¹å¼ã€‚</p>
<p><br></p>
<h2 id="0x05-Benchmark-æµ‹è¯•ç« èŠ‚"><a href="#0x05-Benchmark-æµ‹è¯•ç« èŠ‚" class="headerlink" title="0x05 Benchmark æµ‹è¯•ç« èŠ‚"></a>0x05 Benchmark æµ‹è¯•ç« èŠ‚</h2><p><strong>ä½œä¸š1.ä½¿ç”¨ginæ¡†æ¶ç¼–å†™ä¸€ä¸ªæ¥å£ï¼Œä½¿ç”¨go-wrkè¿›è¡Œå‹æµ‹ï¼Œä½¿ç”¨æ€§èƒ½è°ƒä¼˜å·¥å…·é‡‡é›†æ•°æ®ç»˜åˆ¶å‡ºè°ƒç”¨å›¾å’Œç«ç„°å›¾ã€‚</strong></p>

        </div>
        <!-- Google å¹¿å‘Š -->
        
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
  

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2023-01-31T02:29:10.673Z" itemprop="dateUpdated">2023-01-31 10:29:10</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/ç¼–ç¨‹ä¸–ç•Œ/Go/Example/2.Goè¯­è¨€ç¼–ç¨‹å­¦ä¹ è¯¾åå®è·µ.md" target="_blank" rel="noopener noreferrer">_posts/ç¼–ç¨‹ä¸–ç•Œ/Go/Example/2.Goè¯­è¨€ç¼–ç¨‹å­¦ä¹ è¯¾åå®è·µ.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2020/4-26-604.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/4-26-604.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Go/" rel="tag">Go</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/4-26-604.html&title=ã€Š2.Goè¯­è¨€ç¼–ç¨‹å­¦ä¹ è¯¾åå®è·µã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/4-26-604.html&title=ã€Š2.Goè¯­è¨€ç¼–ç¨‹å­¦ä¹ è¯¾åå®è·µã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/4-26-604.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š2.Goè¯­è¨€ç¼–ç¨‹å­¦ä¹ è¯¾åå®è·µã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/4-26-604.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/4-26-604.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/4-26-605.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">1.Goè¯­è¨€é¡¹ç›®æ€§èƒ½è°ƒä¼˜å®è·µ</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/4-25-469.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">2-Kuberneteså…¥é—¨ä¹‹CentOSå®‰è£…éƒ¨ç½²é›†ç¾¤</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-åå°„ç« èŠ‚"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x01 åå°„ç« èŠ‚</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-Goroutine-ç« èŠ‚"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x02 Goroutine ç« èŠ‚</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x03-Socket-ç½‘ç»œç¼–ç¨‹ç« èŠ‚"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x03 Socket ç½‘ç»œç¼–ç¨‹ç« èŠ‚</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x04-Unit-å•å…ƒæµ‹è¯•ç« èŠ‚"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x04 Unit å•å…ƒæµ‹è¯•ç« èŠ‚</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x05-Benchmark-æµ‹è¯•ç« èŠ‚"><span class="post-toc-number">5.</span> <span class="post-toc-text">0x05 Benchmark æµ‹è¯•ç« èŠ‚</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    


    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      

    <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
    
      <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½çœ‹å‹,æ¬¢è¿å…³æ³¨åšä¸»å¾®ä¿¡å…¬ä¼—å·å“Ÿ! â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘å³å¯å…³é—­ç»§ç»­æµè§ˆæ–‡ç« .<br>  <b style="color:red;"> æ¸©é¦¨æç¤º: æœªè§£é”çš„ç”¨æˆ·ä¸èƒ½ç²˜è´´å¤åˆ¶æ–‡ç« å†…å®¹å“Ÿ!</b> <br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
        
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="/img/share-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2023 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>

<div id="go" class="waves-effect waves-light">
  <a href="javascript:;" id="goqrcode"> <span class="icon icon-lg icon-qrcode"></span> </a>
  <a href="javascript:;" id="gotop"> <span class="icon icon-lg icon-chevron-up"></span></a>
</div>





<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/4-26-604.html&title=ã€Š2.Goè¯­è¨€ç¼–ç¨‹å­¦ä¹ è¯¾åå®è·µã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/4-26-604.html&title=ã€Š2.Goè¯­è¨€ç¼–ç¨‹å­¦ä¹ è¯¾åå®è·µã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/4-26-604.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š2.Goè¯­è¨€ç¼–ç¨‹å­¦ä¹ è¯¾åå®è·µã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/4-26-604.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/4-26-604.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACNElEQVR42u3awW6EMAxF0fn/n6ZSV5Vo4D4bqmJuViiTgZwsrDjO54Pb9t32zz979mP2/at3rt5zcZMhQ8ZjGdthW33yeLoEVluOJVWGDBkvYJAge9zDA3T6XfRfGTJkyMDPtR4ZMmTIuCPgHo8hVD5ehgwZMvir01S2k+7emIvLkCHjgYxOYeDu5z+qb8iQIeMfM7awXVV6TEPzyaxkyJAxmkEOvGqf76e4/HhOhgwZsxnptHh47YyJe2TIkPF6Rj+w8mM7ksQuN4UyZMgYzeBbt35qessBnwwZMkYzrioP8ACdXuyoXRqTIUPGJAZJUzuXUPl70jnIkCHjPYx0WulRPk9H0yVDGbkMGTJGMO64ZpGWJHn/8j0yZMh4AaN2HJ8WA/hX4kAvQ4aMFzD6xcjOtpIf8AWVWBkyZAxi1AqQVxUj+8vxy0xkyJAxjsEP33lwrI3kzyclTBkyZIxm8GSydj0CRf3axQ4ZMmSMZqShMAXUNn9p+UGGDBmzGfyKQ21VasWGVniVIUPGUEbnsIynnaS0wEP2shIrQ4aMcYxgULjVS3+tlRlyqwwZMp7H2MKWXqHg6StZpuWvMmTIGM3oXJjgsDSA1oK4DBkyZjNIkK2FSBIuayG1mMTKkCHj4QweZPkhGi8J1II+StJlyJDxMgYvcKYbRx7uT04NZciQISP8FwmytQVqbQ1lyJDxWEa64asVKftXypbbShkyZIxmdAoDtVSWb/suvq4hQ4aM5zG+AJrN+gj7pUDTAAAAAElFTkSuQmCC" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// ç«™ç‚¹è¿è¡Œæ—¶é—´
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + "å¤©" + RunHours + "æ—¶" + RunMinutes + "åˆ†" + RunSeconds + "ç§’";
  document.getElementById(id).innerHTML = "ç½‘ç«™å·²åœ¨é£é›¨ä¸­å‹‰å‹‰å¼ºå¼ºè¿è¡Œäº†ã€" + RunTime + "ã€‘";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
</body>
</html>