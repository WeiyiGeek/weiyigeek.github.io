{"title":"MySQL关系型数据库环境快速搭建部署","slug":"系统运维/快速部署/MySQL","date":"2022-03-24T02:30:30.000Z","updated":"2022-10-13T02:52:45.655Z","url":"2022/3-24-687.html","path":"api/articles/2022/3-24-687.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220928102511.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220928134020.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220928142610.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220929110806.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"1-Docker-快速部署-MySQL-数据库服务器\"><a href=\"#1-Docker-快速部署-MySQL-数据库服务器\" class=\"headerlink\" title=\"1.Docker 快速部署 MySQL 数据库服务器\"></a>1.Docker 快速部署 MySQL 数据库服务器</h2><p>MySQL 是一种广泛使用的开源关系数据库管理系统 (RDBMS)，其久经考验的性能、可靠性和易用性，MySQL 已成为基于 Web 的应用程序的领先数据库选择。</p>\n<p>MySQL 帮助文档：<a href=\"https://docs.oracle.com/en-us/iaas/mysql-database/doc/getting-started.html\" target=\"_blank\" rel=\"noopener\">https://docs.oracle.com/en-us/iaas/mysql-database/doc/getting-started.html</a><br>镜像仓库地址：<a href=\"https://hub.docker.com/_/mysql\" target=\"_blank\" rel=\"noopener\">https://hub.docker.com/_/mysql</a><br>镜像问题：<a href=\"https://github.com/docker-library/mysql/issues\" target=\"_blank\" rel=\"noopener\">https://github.com/docker-library/mysql/issues</a></p>\n<p>温馨提示：此处实践环境是使用Docker,若你没有安装Docker环境或者不了解的Docker容器的朋友，可以参考博主学习【Docker的系列笔记】汇总，关注 WeiyiGeek 公众号回复【<code>Docker容器学习之路汇总</code>】即可获得学习资料：<br><a href=\"https://www.weiyigeek.top/wechat.html?key=Kubernetes学习之路汇总\" target=\"_blank\" rel=\"noopener\">https://www.weiyigeek.top/wechat.html?key=Kubernetes学习之路汇总</a></p>\n<p><br/></p>\n<h3 id=\"命令方式\"><a href=\"#命令方式\" class=\"headerlink\" title=\"命令方式\"></a>命令方式</h3><p>步骤 01.快速部署脚本命令。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 准备数据持久化目录</span></span><br><span class=\"line\">mkdir -vp /app/data</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 准备mysql8.x仓库镜像</span></span><br><span class=\"line\">docker pull mysql:8.0.30</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 准备root密码不采用环境变量直接显示密码</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"weiyigeek.top\"</span> &gt; /app/my-secret-pw</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 一条命令创建运行mysql数据库容器</span></span><br><span class=\"line\">docker run -d --name mysql8.0 --restart=always \\</span><br><span class=\"line\">-v <span class=\"string\">\"/app/data\"</span>:/var/lib/mysql \\</span><br><span class=\"line\">-v <span class=\"string\">\"/app/my-secret-pw\"</span>:/app/my-secret-pw \\</span><br><span class=\"line\">-e MYSQL_ROOT_PASSWORD_FILE=/app/my-secret-pw \\</span><br><span class=\"line\">-e MYSQL_DATABASE=app \\</span><br><span class=\"line\">-e MYSQL_USER=weiyigeek \\</span><br><span class=\"line\">-e MYSQL_PASSWORD=password \\</span><br><span class=\"line\">-p 3306:3306 \\</span><br><span class=\"line\">mysql:8.0.30 \\</span><br><span class=\"line\">--default-authentication-plugin=mysql_native_password</span><br><span class=\"line\"><span class=\"comment\"># 144e883af1a99901913a986d540382c8aefe3e5bd96730ad76a019b2567159bb</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 可以为 mysqld 使用特定的 UID/GID , 例如此处的 1000 用户。</span></span><br><span class=\"line\">--user 1000:1000 </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 可以为 mysqld 指定命令行参数。</span></span><br><span class=\"line\">--character-set-server=utf8mb4 </span><br><span class=\"line\">--collation-server=utf8mb4_unicode_ci</span><br></pre></td></tr></table></figure>\n<p><br/></p>\n<p>步骤 02.查看验证在Docker中的部署情况。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 容器</span></span><br><span class=\"line\">$ docker ps</span><br><span class=\"line\">CONTAINER ID   IMAGE          COMMAND                  CREATED              STATUS              PORTS                               NAMES</span><br><span class=\"line\">05c5a0e23e39   mysql:8.0.30   <span class=\"string\">\"docker-entrypoint.s…\"</span>   About a minute ago   Up About a minute   0.0.0.0:3306-&gt;3306/tcp, 33060/tcp   mysql8.0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 日志</span></span><br><span class=\"line\">$ docker logs mysql8.0</span><br><span class=\"line\">2022-09-27 14:19:03+00:00 [Note] [Entrypoint]: Entrypoint script <span class=\"keyword\">for</span> MySQL Server 8.0.30-1.el8 started.</span><br><span class=\"line\">2022-09-27 14:19:03+00:00 [Note] [Entrypoint]: Switching to dedicated user <span class=\"string\">'mysql'</span></span><br><span class=\"line\">2022-09-27 14:19:03+00:00 [Note] [Entrypoint]: Entrypoint script <span class=\"keyword\">for</span> MySQL Server 8.0.30-1.el8 started.</span><br><span class=\"line\">2022-09-27 14:19:03+00:00 [Note] [Entrypoint]: Initializing database files</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 连接测试</span></span><br><span class=\"line\">$ docker <span class=\"built_in\">exec</span> -it mysql8.0 sh -c <span class=\"string\">'mysql -u root -p\"weiyigeek.top\"'</span></span><br><span class=\"line\">mysql: [Warning] Using a password on the <span class=\"built_in\">command</span> line interface can be insecure.</span><br><span class=\"line\">mysql&gt; select @@version;</span><br><span class=\"line\">+-----------+</span><br><span class=\"line\">| @@version |</span><br><span class=\"line\">+-----------+</span><br><span class=\"line\">| 8.0.30    |</span><br><span class=\"line\">+-----------+</span><br><span class=\"line\">1 row <span class=\"keyword\">in</span> <span class=\"built_in\">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>\n<p><br/></p>\n<p>步骤 03.部署 Adminer 进行管理连接 MySQL 数据库, Adminer 是一个类似于 phpMyAdmin 的 MySQL 管理客户端。<br>Adminer 可用于连接 <code>MySQL, PostgreSQL, SQLite, MSSQL, Oracle, Firebird, SimpleDB, Elasticsearch and MongoDB</code> 等数据库。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull adminer:latest</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Standalone</span></span><br><span class=\"line\">docker run -d --restart unless-stopped --name db_adminer -p 8080:8080 adminer:latest</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># FastCGI</span></span><br><span class=\"line\">docker run -d --name db_admine_fastcgi --link some_database:db -p 9000:9000 adminer:fastcgi</span><br></pre></td></tr></table></figure>\n<p>随后使用浏览器访问宿主机的8080端口进行连接:</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220928102511.png\" alt=\"WeiyiGeek.db_adminer\" title=\"\" class=\"\">\n                <p>WeiyiGeek.db_adminer</p>\n            </figure>\n<p>温馨提示：MySQL的默认配置可以在 <code>/etc/mysql/my.cnf</code>，或可以自定义配置文件<code>/etc/mysql/conf.d/my.cnf</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tee my.cnf &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\"><span class=\"comment\"># 执行用户</span></span><br><span class=\"line\">user=mysql</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 开放监听服务端口</span></span><br><span class=\"line\">port=3306</span><br><span class=\"line\"><span class=\"built_in\">bind</span>-address=*</span><br><span class=\"line\">socket=/var/run/mysqld/mysqld.sock</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 数据目录</span></span><br><span class=\"line\">datadir=/var/lib/mysql</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 进程 pid 文件</span></span><br><span class=\"line\">pid-file=/var/run/mysqld/mysqld.pid</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 插件默认路径</span></span><br><span class=\"line\">plugin-dir=/usr/lib64/mysql/plugin/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 安全文件路径</span></span><br><span class=\"line\">secure-file-priv=/var/lib/mysql-files</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启用日志与路径设置</span></span><br><span class=\"line\">general-log=on</span><br><span class=\"line\">general-log-file=/var/lib/mysql/mysql8x.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 服务器字符集设置</span></span><br><span class=\"line\">character-set-server=utf8mb4 </span><br><span class=\"line\">collation-server=utf8mb4_unicode_ci</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 数据库容灾binlog启用配置</span></span><br><span class=\"line\"><span class=\"built_in\">log</span>-bin=binlog</span><br><span class=\"line\"><span class=\"built_in\">log</span>-bin-index=binlog.index</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 认证密码策略, 默认 aching_sha2_password , 针对于old链接认证方式为 mysql_native_password</span></span><br><span class=\"line\">default-authentication-plugin=mysql_native_password</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 跳过某些操作</span></span><br><span class=\"line\">skip-host-cache</span><br><span class=\"line\">skip-name-resolve</span><br><span class=\"line\"></span><br><span class=\"line\">[client]</span><br><span class=\"line\">socket=/var/run/mysqld/mysqld.sock</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n<p>温馨提示：如果您想查看 <code>mysqld</code> 可用选项的完整列表，只需运行</p>\n<blockquote>\n<p>$ docker run -it –rm mysql:8.0.30 –verbose –help</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># my.cnf 可用配置</span></span><br><span class=\"line\">Variables (--variable-name=value)</span><br><span class=\"line\">and boolean options &#123;FALSE|TRUE&#125;                             Value (after reading options)</span><br><span class=\"line\">------------------------------------------------------------ -------------</span><br><span class=\"line\">abort-slave-event-count                                      0</span><br><span class=\"line\">activate-all-roles-on-login                                  FALSE</span><br><span class=\"line\">admin-address                                                (No default value)</span><br><span class=\"line\">admin-port                                                   33062</span><br><span class=\"line\">admin-ssl                                                    TRUE</span><br><span class=\"line\">admin-ssl-ca                                                 (No default value)</span><br><span class=\"line\">admin-ssl-capath                                             (No default value)</span><br><span class=\"line\">admin-ssl-cert                                               (No default value)</span><br><span class=\"line\">admin-ssl-cipher                                             (No default value)</span><br><span class=\"line\">admin-ssl-crl                                                (No default value)</span><br><span class=\"line\">admin-ssl-crlpath                                            (No default value)</span><br><span class=\"line\">admin-ssl-key                                                (No default value)</span><br><span class=\"line\">admin-tls-ciphersuites                                       (No default value)</span><br><span class=\"line\">admin-tls-version                                            TLSv1.2,TLSv1.3</span><br><span class=\"line\">allow-suspicious-udfs                                        FALSE</span><br><span class=\"line\">archive                                                      ON</span><br><span class=\"line\">authentication-policy                                        *,,</span><br><span class=\"line\">auto-generate-certs                                          TRUE</span><br><span class=\"line\">auto-increment-increment                                     1</span><br><span class=\"line\">auto-increment-offset                                        1</span><br><span class=\"line\">autocommit                                                   TRUE</span><br><span class=\"line\">automatic-sp-privileges                                      TRUE</span><br><span class=\"line\">avoid-temporal-upgrade                                       FALSE</span><br><span class=\"line\">back-log                                                     151</span><br><span class=\"line\">basedir                                                      /usr/</span><br><span class=\"line\">big-tables                                                   FALSE</span><br><span class=\"line\"><span class=\"built_in\">bind</span>-address                                                 *</span><br><span class=\"line\">binlog-cache-size                                            32768</span><br><span class=\"line\">binlog-checksum                                              CRC32</span><br><span class=\"line\">binlog-direct-non-transactional-updates                      FALSE</span><br><span class=\"line\">binlog-encryption                                            FALSE</span><br><span class=\"line\">binlog-error-action                                          ABORT_SERVER</span><br><span class=\"line\">binlog-expire-logs-auto-purge                                TRUE</span><br><span class=\"line\">binlog-expire-logs-seconds                                   2592000</span><br><span class=\"line\">binlog-format                                                ROW</span><br><span class=\"line\">binlog-group-commit-sync-delay                               0</span><br><span class=\"line\">binlog-group-commit-sync-no-delay-count                      0</span><br><span class=\"line\">binlog-gtid-simple-recovery                                  TRUE</span><br><span class=\"line\">binlog-max-flush-queue-time                                  0</span><br><span class=\"line\">binlog-order-commits                                         TRUE</span><br><span class=\"line\">binlog-rotate-encryption-master-key-at-startup               FALSE</span><br><span class=\"line\">binlog-row-event-max-size                                    8192</span><br><span class=\"line\">binlog-row-image                                             FULL</span><br><span class=\"line\">binlog-row-metadata                                          MINIMAL</span><br><span class=\"line\">binlog-row-value-options</span><br><span class=\"line\">binlog-rows-query-log-events                                 FALSE</span><br><span class=\"line\">binlog-stmt-cache-size                                       32768</span><br><span class=\"line\">binlog-transaction-compression                               FALSE</span><br><span class=\"line\">binlog-transaction-compression-level-zstd                    3</span><br><span class=\"line\">binlog-transaction-dependency-history-size                   25000</span><br><span class=\"line\">binlog-transaction-dependency-tracking                       COMMIT_ORDER</span><br><span class=\"line\">blackhole                                                    ON</span><br><span class=\"line\">block-encryption-mode                                        aes-128-ecb</span><br><span class=\"line\">bulk-insert-buffer-size                                      8388608</span><br><span class=\"line\">caching-sha2-password-auto-generate-rsa-keys                 TRUE</span><br><span class=\"line\">caching-sha2-password-digest-rounds                          5000</span><br><span class=\"line\">caching-sha2-password-private-key-path                       private_key.pem</span><br><span class=\"line\">caching-sha2-password-public-key-path                        public_key.pem</span><br><span class=\"line\">character-set-client-handshake                               TRUE</span><br><span class=\"line\">character-set-filesystem                                     binary</span><br><span class=\"line\">character-set-server                                         utf8mb4</span><br><span class=\"line\">character-sets-dir                                           /usr/share/mysql-8.0/charsets/</span><br><span class=\"line\">check-proxy-users                                            FALSE</span><br><span class=\"line\">chroot                                                       (No default value)</span><br><span class=\"line\">collation-server                                             utf8mb4_0900_ai_ci</span><br><span class=\"line\">completion-type                                              NO_CHAIN</span><br><span class=\"line\">concurrent-insert                                            AUTO</span><br><span class=\"line\">connect-timeout                                              10</span><br><span class=\"line\">connection-memory-chunk-size                                 8912</span><br><span class=\"line\">connection-memory-limit                                      18446744073709551615</span><br><span class=\"line\">console                                                      FALSE</span><br><span class=\"line\">create-admin-listener-thread                                 FALSE</span><br><span class=\"line\">cte-max-recursion-depth                                      1000</span><br><span class=\"line\">daemonize                                                    FALSE</span><br><span class=\"line\">datadir                                                      /var/lib/mysql/</span><br><span class=\"line\">default-authentication-plugin                                caching_sha2_password</span><br><span class=\"line\">default-password-lifetime                                    0</span><br><span class=\"line\">default-storage-engine                                       InnoDB</span><br><span class=\"line\">default-table-encryption                                     FALSE</span><br><span class=\"line\">default-time-zone                                            (No default value)</span><br><span class=\"line\">default-tmp-storage-engine                                   InnoDB</span><br><span class=\"line\">default-week-format                                          0</span><br><span class=\"line\">delay-key-write                                              ON</span><br><span class=\"line\">delayed-insert-limit                                         100</span><br><span class=\"line\">delayed-insert-timeout                                       300</span><br><span class=\"line\">delayed-queue-size                                           1000</span><br><span class=\"line\">disabled-storage-engines</span><br><span class=\"line\">disconnect-on-expired-password                               TRUE</span><br><span class=\"line\">disconnect-slave-event-count                                 0</span><br><span class=\"line\">div-precision-increment                                      4</span><br><span class=\"line\">end-markers-in-json                                          FALSE</span><br><span class=\"line\">enforce-gtid-consistency                                     FALSE</span><br><span class=\"line\">eq-range-index-dive-limit                                    200</span><br><span class=\"line\">event-scheduler                                              ON</span><br><span class=\"line\">expire-logs-days                                             0</span><br><span class=\"line\">explicit-defaults-for-timestamp                              TRUE</span><br><span class=\"line\">external-locking                                             FALSE</span><br><span class=\"line\">federated                                                    OFF</span><br><span class=\"line\">flush                                                        FALSE</span><br><span class=\"line\">flush-time                                                   0</span><br><span class=\"line\">ft-boolean-syntax                                            + -&gt;&lt;()~*:<span class=\"string\">\"\"</span>&amp;|</span><br><span class=\"line\">ft-max-word-len                                              84</span><br><span class=\"line\">ft-min-word-len                                              4</span><br><span class=\"line\">ft-query-expansion-limit                                     20</span><br><span class=\"line\">ft-stopword-file                                             (No default value)</span><br><span class=\"line\">gdb                                                          FALSE</span><br><span class=\"line\">general-log                                                  FALSE</span><br><span class=\"line\">general-log-file                                             /var/lib/mysql/a29706ab34c6.log</span><br><span class=\"line\">generated-random-password-length                             20</span><br><span class=\"line\">global-connection-memory-limit                               18446744073709551615</span><br><span class=\"line\">global-connection-memory-tracking                            FALSE</span><br><span class=\"line\">group-concat-max-len                                         1024</span><br><span class=\"line\">group-replication-consistency                                EVENTUAL</span><br><span class=\"line\">gtid-executed-compression-period                             0</span><br><span class=\"line\">gtid-mode                                                    OFF</span><br><span class=\"line\"><span class=\"built_in\">help</span>                                                         TRUE</span><br><span class=\"line\">histogram-generation-max-mem-size                            20000000</span><br><span class=\"line\">host-cache-size                                              279</span><br><span class=\"line\">information-schema-stats-expiry                              86400</span><br><span class=\"line\">init-connect</span><br><span class=\"line\">init-file                                                    (No default value)</span><br><span class=\"line\">init-replica</span><br><span class=\"line\">init-slave</span><br><span class=\"line\">initialize                                                   FALSE</span><br><span class=\"line\">initialize-insecure                                          FALSE</span><br><span class=\"line\">innodb-adaptive-flushing                                     TRUE</span><br><span class=\"line\">innodb-adaptive-flushing-lwm                                 10</span><br><span class=\"line\">innodb-adaptive-hash-index                                   TRUE</span><br><span class=\"line\">innodb-adaptive-hash-index-parts                             8</span><br><span class=\"line\">innodb-adaptive-max-sleep-delay                              150000</span><br><span class=\"line\">innodb-api-bk-commit-interval                                5</span><br><span class=\"line\">innodb-api-disable-rowlock                                   FALSE</span><br><span class=\"line\">innodb-api-enable-binlog                                     FALSE</span><br><span class=\"line\">innodb-api-enable-mdl                                        FALSE</span><br><span class=\"line\">innodb-api-trx-level                                         0</span><br><span class=\"line\">innodb-autoextend-increment                                  64</span><br><span class=\"line\">innodb-autoinc-lock-mode                                     2</span><br><span class=\"line\">innodb-buffer-pool-chunk-size                                134217728</span><br><span class=\"line\">innodb-buffer-pool-dump-at-shutdown                          TRUE</span><br><span class=\"line\">innodb-buffer-pool-dump-now                                  FALSE</span><br><span class=\"line\">innodb-buffer-pool-dump-pct                                  25</span><br><span class=\"line\">innodb-buffer-pool-filename                                  ib_buffer_pool</span><br><span class=\"line\">innodb-buffer-pool-in-core-file                              TRUE</span><br><span class=\"line\">innodb-buffer-pool-instances                                 0</span><br><span class=\"line\">innodb-buffer-pool-load-abort                                FALSE</span><br><span class=\"line\">innodb-buffer-pool-load-at-startup                           TRUE</span><br><span class=\"line\">innodb-buffer-pool-load-now                                  FALSE</span><br><span class=\"line\">innodb-buffer-pool-size                                      134217728</span><br><span class=\"line\">innodb-change-buffer-max-size                                25</span><br><span class=\"line\">innodb-change-buffering                                      all</span><br><span class=\"line\">innodb-checksum-algorithm                                    crc32</span><br><span class=\"line\">innodb-cmp-per-index-enabled                                 FALSE</span><br><span class=\"line\">innodb-commit-concurrency                                    0</span><br><span class=\"line\">innodb-compression-failure-threshold-pct                     5</span><br><span class=\"line\">innodb-compression-level                                     6</span><br><span class=\"line\">innodb-compression-pad-pct-max                               50</span><br><span class=\"line\">innodb-concurrency-tickets                                   5000</span><br><span class=\"line\">innodb-data-file-path                                        ibdata1:12M:autoextend</span><br><span class=\"line\">innodb-data-home-dir                                         (No default value)</span><br><span class=\"line\">innodb-ddl-buffer-size                                       1048576</span><br><span class=\"line\">innodb-ddl-threads                                           4</span><br><span class=\"line\">innodb-deadlock-detect                                       TRUE</span><br><span class=\"line\">innodb-dedicated-server                                      FALSE</span><br><span class=\"line\">innodb-default-row-format                                    dynamic</span><br><span class=\"line\">innodb-directories                                           (No default value)</span><br><span class=\"line\">innodb-disable-sort-file-cache                               FALSE</span><br><span class=\"line\">innodb-doublewrite                                           ON</span><br><span class=\"line\">innodb-doublewrite-batch-size                                0</span><br><span class=\"line\">innodb-doublewrite-dir                                       (No default value)</span><br><span class=\"line\">innodb-doublewrite-files                                     0</span><br><span class=\"line\">innodb-doublewrite-pages                                     0</span><br><span class=\"line\">innodb-extend-and-initialize                                 TRUE</span><br><span class=\"line\">innodb-fast-shutdown                                         1</span><br><span class=\"line\">innodb-file-per-table                                        TRUE</span><br><span class=\"line\">innodb-fill-factor                                           100</span><br><span class=\"line\">innodb-flush-log-at-timeout                                  1</span><br><span class=\"line\">innodb-flush-log-at-trx-commit                               1</span><br><span class=\"line\">innodb-flush-method                                          fsync</span><br><span class=\"line\">innodb-flush-neighbors                                       0</span><br><span class=\"line\">innodb-flush-sync                                            TRUE</span><br><span class=\"line\">innodb-flushing-avg-loops                                    30</span><br><span class=\"line\">innodb-force-load-corrupted                                  FALSE</span><br><span class=\"line\">innodb-force-recovery                                        0</span><br><span class=\"line\">innodb-fsync-threshold                                       0</span><br><span class=\"line\">innodb-ft-aux-table                                          (No default value)</span><br><span class=\"line\">innodb-ft-cache-size                                         8000000</span><br><span class=\"line\">innodb-ft-enable-diag-print                                  FALSE</span><br><span class=\"line\">innodb-ft-enable-stopword                                    TRUE</span><br><span class=\"line\">innodb-ft-max-token-size                                     84</span><br><span class=\"line\">innodb-ft-min-token-size                                     3</span><br><span class=\"line\">innodb-ft-num-word-optimize                                  2000</span><br><span class=\"line\">innodb-ft-result-cache-limit                                 2000000000</span><br><span class=\"line\">innodb-ft-server-stopword-table                              (No default value)</span><br><span class=\"line\">innodb-ft-sort-pll-degree                                    2</span><br><span class=\"line\">innodb-ft-total-cache-size                                   640000000</span><br><span class=\"line\">innodb-ft-user-stopword-table                                (No default value)</span><br><span class=\"line\">innodb-idle-flush-pct                                        100</span><br><span class=\"line\">innodb-io-capacity                                           200</span><br><span class=\"line\">innodb-io-capacity-max                                       4294967295</span><br><span class=\"line\">innodb-lock-wait-timeout                                     50</span><br><span class=\"line\">innodb-log-buffer-size                                       16777216</span><br><span class=\"line\">innodb-log-checksums                                         TRUE</span><br><span class=\"line\">innodb-log-compressed-pages                                  TRUE</span><br><span class=\"line\">innodb-log-file-size                                         50331648</span><br><span class=\"line\">innodb-log-files-in-group                                    2</span><br><span class=\"line\">innodb-log-group-home-dir                                    (No default value)</span><br><span class=\"line\">innodb-log-spin-cpu-abs-lwm                                  80</span><br><span class=\"line\">innodb-log-spin-cpu-pct-hwm                                  50</span><br><span class=\"line\">innodb-log-wait-for-flush-spin-hwm                           400</span><br><span class=\"line\">innodb-log-write-ahead-size                                  8192</span><br><span class=\"line\">innodb-log-writer-threads                                    TRUE</span><br><span class=\"line\">innodb-lru-scan-depth                                        1024</span><br><span class=\"line\">innodb-max-dirty-pages-pct                                   90</span><br><span class=\"line\">innodb-max-dirty-pages-pct-lwm                               10</span><br><span class=\"line\">innodb-max-purge-lag                                         0</span><br><span class=\"line\">innodb-max-purge-lag-delay                                   0</span><br><span class=\"line\">innodb-max-undo-log-size                                     1073741824</span><br><span class=\"line\">innodb-monitor-disable                                       (No default value)</span><br><span class=\"line\">innodb-monitor-enable                                        (No default value)</span><br><span class=\"line\">innodb-monitor-reset                                         (No default value)</span><br><span class=\"line\">innodb-monitor-reset-all                                     (No default value)</span><br><span class=\"line\">innodb-old-blocks-pct                                        37</span><br><span class=\"line\">innodb-old-blocks-time                                       1000</span><br><span class=\"line\">innodb-online-alter-log-max-size                             134217728</span><br><span class=\"line\">innodb-open-files                                            0</span><br><span class=\"line\">innodb-optimize-fulltext-only                                FALSE</span><br><span class=\"line\">innodb-page-cleaners                                         4</span><br><span class=\"line\">innodb-page-size                                             16384</span><br><span class=\"line\">innodb-parallel-read-threads                                 4</span><br><span class=\"line\">innodb-print-all-deadlocks                                   FALSE</span><br><span class=\"line\">innodb-print-ddl-logs                                        FALSE</span><br><span class=\"line\">innodb-purge-batch-size                                      300</span><br><span class=\"line\">innodb-purge-rseg-truncate-frequency                         128</span><br><span class=\"line\">innodb-purge-threads                                         4</span><br><span class=\"line\">innodb-random-read-ahead                                     FALSE</span><br><span class=\"line\">innodb-read-ahead-threshold                                  56</span><br><span class=\"line\">innodb-read-io-threads                                       4</span><br><span class=\"line\">innodb-read-only                                             FALSE</span><br><span class=\"line\">innodb-redo-log-archive-dirs                                 (No default value)</span><br><span class=\"line\">innodb-redo-log-capacity                                     104857600</span><br><span class=\"line\">innodb-redo-log-encrypt                                      FALSE</span><br><span class=\"line\">innodb-replication-delay                                     0</span><br><span class=\"line\">innodb-rollback-on-timeout                                   FALSE</span><br><span class=\"line\">innodb-rollback-segments                                     128</span><br><span class=\"line\">innodb-segment-reserve-factor                                12.5</span><br><span class=\"line\">innodb-sort-buffer-size                                      1048576</span><br><span class=\"line\">innodb-spin-wait-delay                                       6</span><br><span class=\"line\">innodb-spin-wait-pause-multiplier                            50</span><br><span class=\"line\">innodb-stats-auto-recalc                                     TRUE</span><br><span class=\"line\">innodb-stats-include-delete-marked                           FALSE</span><br><span class=\"line\">innodb-stats-method                                          nulls_equal</span><br><span class=\"line\">innodb-stats-on-metadata                                     FALSE</span><br><span class=\"line\">innodb-stats-persistent                                      TRUE</span><br><span class=\"line\">innodb-stats-persistent-sample-pages                         20</span><br><span class=\"line\">innodb-stats-transient-sample-pages                          8</span><br><span class=\"line\">innodb-status-file                                           FALSE</span><br><span class=\"line\">innodb-status-output                                         FALSE</span><br><span class=\"line\">innodb-status-output-locks                                   FALSE</span><br><span class=\"line\">innodb-strict-mode                                           TRUE</span><br><span class=\"line\">innodb-sync-array-size                                       1</span><br><span class=\"line\">innodb-sync-spin-loops                                       30</span><br><span class=\"line\">innodb-table-locks                                           TRUE</span><br><span class=\"line\">innodb-temp-data-file-path                                   ibtmp1:12M:autoextend</span><br><span class=\"line\">innodb-temp-tablespaces-dir                                  (No default value)</span><br><span class=\"line\">innodb-thread-concurrency                                    0</span><br><span class=\"line\">innodb-thread-sleep-delay                                    10000</span><br><span class=\"line\">innodb-tmpdir                                                (No default value)</span><br><span class=\"line\">innodb-undo-directory                                        (No default value)</span><br><span class=\"line\">innodb-undo-log-encrypt                                      FALSE</span><br><span class=\"line\">innodb-undo-log-truncate                                     TRUE</span><br><span class=\"line\">innodb-undo-tablespaces                                      2</span><br><span class=\"line\">innodb-use-fdatasync                                         FALSE</span><br><span class=\"line\">innodb-use-native-aio                                        TRUE</span><br><span class=\"line\">innodb-validate-tablespace-paths                             TRUE</span><br><span class=\"line\">innodb-write-io-threads                                      4</span><br><span class=\"line\">interactive-timeout                                          28800</span><br><span class=\"line\">internal-tmp-mem-storage-engine                              TempTable</span><br><span class=\"line\">join-buffer-size                                             262144</span><br><span class=\"line\">keep-files-on-create                                         FALSE</span><br><span class=\"line\">key-buffer-size                                              8388608</span><br><span class=\"line\">key-cache-age-threshold                                      300</span><br><span class=\"line\">key-cache-block-size                                         1024</span><br><span class=\"line\">key-cache-division-limit                                     100</span><br><span class=\"line\">keyring-migration-destination                                (No default value)</span><br><span class=\"line\">keyring-migration-host                                       (No default value)</span><br><span class=\"line\">keyring-migration-port                                       0</span><br><span class=\"line\">keyring-migration-socket                                     (No default value)</span><br><span class=\"line\">keyring-migration-source                                     (No default value)</span><br><span class=\"line\">keyring-migration-to-component                               FALSE</span><br><span class=\"line\">keyring-migration-user                                       (No default value)</span><br><span class=\"line\">language                                                     /usr/share/mysql-8.0/</span><br><span class=\"line\">large-pages                                                  FALSE</span><br><span class=\"line\">lc-messages                                                  en_US</span><br><span class=\"line\">lc-messages-dir                                              /usr/share/mysql-8.0/</span><br><span class=\"line\">lc-time-names                                                en_US</span><br><span class=\"line\"><span class=\"built_in\">local</span>-infile                                                 FALSE</span><br><span class=\"line\">lock-wait-timeout                                            31536000</span><br><span class=\"line\"><span class=\"built_in\">log</span>-bin                                                      binlog</span><br><span class=\"line\"><span class=\"built_in\">log</span>-bin-index                                                binlog.index</span><br><span class=\"line\"><span class=\"built_in\">log</span>-bin-trust-function-creators                              FALSE</span><br><span class=\"line\"><span class=\"built_in\">log</span>-bin-use-v1-row-events                                    FALSE</span><br><span class=\"line\"><span class=\"built_in\">log</span>-error                                                    stderr</span><br><span class=\"line\"><span class=\"built_in\">log</span>-error-services                                           log_filter_internal; log_sink_internal</span><br><span class=\"line\"><span class=\"built_in\">log</span>-error-suppression-list</span><br><span class=\"line\"><span class=\"built_in\">log</span>-error-verbosity                                          1</span><br><span class=\"line\"><span class=\"built_in\">log</span>-isam                                                     myisam.log</span><br><span class=\"line\"><span class=\"built_in\">log</span>-output                                                   FILE</span><br><span class=\"line\"><span class=\"built_in\">log</span>-queries-not-using-indexes                                FALSE</span><br><span class=\"line\"><span class=\"built_in\">log</span>-raw                                                      FALSE</span><br><span class=\"line\"><span class=\"built_in\">log</span>-replica-updates                                          TRUE</span><br><span class=\"line\"><span class=\"built_in\">log</span>-short-format                                             FALSE</span><br><span class=\"line\"><span class=\"built_in\">log</span>-slave-updates                                            TRUE</span><br><span class=\"line\"><span class=\"built_in\">log</span>-slow-admin-statements                                    FALSE</span><br><span class=\"line\"><span class=\"built_in\">log</span>-slow-extra                                               FALSE</span><br><span class=\"line\"><span class=\"built_in\">log</span>-slow-replica-statements                                  FALSE</span><br><span class=\"line\"><span class=\"built_in\">log</span>-slow-slave-statements                                    FALSE</span><br><span class=\"line\"><span class=\"built_in\">log</span>-statements-unsafe-for-binlog                             TRUE</span><br><span class=\"line\"><span class=\"built_in\">log</span>-tc                                                       tc.log</span><br><span class=\"line\"><span class=\"built_in\">log</span>-tc-size                                                  24576</span><br><span class=\"line\"><span class=\"built_in\">log</span>-throttle-queries-not-using-indexes                       0</span><br><span class=\"line\"><span class=\"built_in\">log</span>-timestamps                                               UTC</span><br><span class=\"line\">long-query-time                                              10</span><br><span class=\"line\">low-priority-updates                                         FALSE</span><br><span class=\"line\">lower-case-table-names                                       0</span><br><span class=\"line\">mandatory-roles</span><br><span class=\"line\">master-info-file                                             master.info</span><br><span class=\"line\">master-info-repository                                       TABLE</span><br><span class=\"line\">master-retry-count                                           86400</span><br><span class=\"line\">master-verify-checksum                                       FALSE</span><br><span class=\"line\">max-allowed-packet                                           67108864</span><br><span class=\"line\">max-binlog-cache-size                                        18446744073709547520</span><br><span class=\"line\">max-binlog-dump-events                                       0</span><br><span class=\"line\">max-binlog-size                                              1073741824</span><br><span class=\"line\">max-binlog-stmt-cache-size                                   18446744073709547520</span><br><span class=\"line\">max-connect-errors                                           100</span><br><span class=\"line\">max-connections                                              151</span><br><span class=\"line\">max-delayed-threads                                          20</span><br><span class=\"line\">max-digest-length                                            1024</span><br><span class=\"line\">max-error-count                                              1024</span><br><span class=\"line\">max-execution-time                                           0</span><br><span class=\"line\">max-heap-table-size                                          16777216</span><br><span class=\"line\">max-join-size                                                18446744073709551615</span><br><span class=\"line\">max-length-for-sort-data                                     4096</span><br><span class=\"line\">max-points-in-geometry                                       65536</span><br><span class=\"line\">max-prepared-stmt-count                                      16382</span><br><span class=\"line\">max-relay-log-size                                           0</span><br><span class=\"line\">max-seeks-for-key                                            18446744073709551615</span><br><span class=\"line\">max-sort-length                                              1024</span><br><span class=\"line\">max-sp-recursion-depth                                       0</span><br><span class=\"line\">max-user-connections                                         0</span><br><span class=\"line\">max-write-lock-count                                         18446744073709551615</span><br><span class=\"line\">memlock                                                      FALSE</span><br><span class=\"line\">min-examined-row-limit                                       0</span><br><span class=\"line\">myisam-block-size                                            1024</span><br><span class=\"line\">myisam-data-pointer-size                                     6</span><br><span class=\"line\">myisam-max-sort-file-size                                    9223372036853727232</span><br><span class=\"line\">myisam-mmap-size                                             18446744073709551615</span><br><span class=\"line\">myisam-recover-options                                       OFF</span><br><span class=\"line\">myisam-sort-buffer-size                                      8388608</span><br><span class=\"line\">myisam-stats-method                                          nulls_unequal</span><br><span class=\"line\">myisam-use-mmap                                              FALSE</span><br><span class=\"line\">mysql-native-password-proxy-users                            FALSE</span><br><span class=\"line\">mysqlx                                                       ON</span><br><span class=\"line\">mysqlx-bind-address                                          *</span><br><span class=\"line\">mysqlx-cache-cleaner                                         ON</span><br><span class=\"line\">mysqlx-compression-algorithms                                DEFLATE_STREAM,LZ4_MESSAGE,ZSTD_STREAM</span><br><span class=\"line\">mysqlx-connect-timeout                                       30</span><br><span class=\"line\">mysqlx-deflate-default-compression-level                     3</span><br><span class=\"line\">mysqlx-deflate-max-client-compression-level                  5</span><br><span class=\"line\">mysqlx-document-id-unique-prefix                             0</span><br><span class=\"line\">mysqlx-enable-hello-notice                                   TRUE</span><br><span class=\"line\">mysqlx-idle-worker-thread-timeout                            60</span><br><span class=\"line\">mysqlx-interactive-timeout                                   28800</span><br><span class=\"line\">mysqlx-lz4-default-compression-level                         2</span><br><span class=\"line\">mysqlx-lz4-max-client-compression-level                      8</span><br><span class=\"line\">mysqlx-max-allowed-packet                                    67108864</span><br><span class=\"line\">mysqlx-max-connections                                       100</span><br><span class=\"line\">mysqlx-min-worker-threads                                    2</span><br><span class=\"line\">mysqlx-port                                                  33060</span><br><span class=\"line\">mysqlx-port-open-timeout                                     0</span><br><span class=\"line\">mysqlx-read-timeout                                          30</span><br><span class=\"line\">mysqlx-socket                                                (No default value)</span><br><span class=\"line\">mysqlx-ssl-ca                                                (No default value)</span><br><span class=\"line\">mysqlx-ssl-capath                                            (No default value)</span><br><span class=\"line\">mysqlx-ssl-cert                                              (No default value)</span><br><span class=\"line\">mysqlx-ssl-cipher                                            (No default value)</span><br><span class=\"line\">mysqlx-ssl-crl                                               (No default value)</span><br><span class=\"line\">mysqlx-ssl-crlpath                                           (No default value)</span><br><span class=\"line\">mysqlx-ssl-key                                               (No default value)</span><br><span class=\"line\">mysqlx-wait-timeout                                          28800</span><br><span class=\"line\">mysqlx-write-timeout                                         60</span><br><span class=\"line\">mysqlx-zstd-default-compression-level                        3</span><br><span class=\"line\">mysqlx-zstd-max-client-compression-level                     11</span><br><span class=\"line\">net-buffer-length                                            16384</span><br><span class=\"line\">net-read-timeout                                             30</span><br><span class=\"line\">net-retry-count                                              10</span><br><span class=\"line\">net-write-timeout                                            60</span><br><span class=\"line\">new                                                          FALSE</span><br><span class=\"line\">ngram                                                        ON</span><br><span class=\"line\">ngram-token-size                                             2</span><br><span class=\"line\">no-dd-upgrade                                                FALSE</span><br><span class=\"line\">offline-mode                                                 FALSE</span><br><span class=\"line\">old                                                          FALSE</span><br><span class=\"line\">old-alter-table                                              FALSE</span><br><span class=\"line\">old-style-user-limits                                        FALSE</span><br><span class=\"line\">open-files-limit                                             1048576</span><br><span class=\"line\">optimizer-max-subgraph-pairs                                 100000</span><br><span class=\"line\">optimizer-prune-level                                        1</span><br><span class=\"line\">optimizer-search-depth                                       62</span><br><span class=\"line\">optimizer-switch                                             index_merge=on,index_merge_union=on,index_merge_sort_union=on,index_merge_intersection=on,engine_condition_pushdown=on,index_condition_pushdown=on,mrr=on,mrr_cost_based=on,block_nested_loop=on,batched_key_access=off,materialization=on,semijoin=on,loosescan=on,firstmatch=on,duplicateweedout=on,subquery_materialization_cost_based=on,use_index_extensions=on,condition_fanout_filter=on,derived_merge=on,use_invisible_indexes=off,skip_scan=on,hash_join=on,subquery_to_derived=off,prefer_ordering_index=on,hypergraph_optimizer=off,derived_condition_pushdown=on</span><br><span class=\"line\">optimizer-trace</span><br><span class=\"line\">optimizer-trace-features                                     greedy_search=on,range_optimizer=on,dynamic_range=on,repeated_subselect=on</span><br><span class=\"line\">optimizer-trace-limit                                        1</span><br><span class=\"line\">optimizer-trace-max-mem-size                                 1048576</span><br><span class=\"line\">optimizer-trace-offset                                       -1</span><br><span class=\"line\">parser-max-mem-size                                          18446744073709551615</span><br><span class=\"line\">partial-revokes                                              FALSE</span><br><span class=\"line\">password-history                                             0</span><br><span class=\"line\">password-require-current                                     FALSE</span><br><span class=\"line\">password-reuse-interval                                      0</span><br><span class=\"line\">performance-schema                                           TRUE</span><br><span class=\"line\">performance-schema-accounts-size                             -1</span><br><span class=\"line\">performance-schema-consumer-events-stages-current            FALSE</span><br><span class=\"line\">performance-schema-consumer-events-stages-history            FALSE</span><br><span class=\"line\">performance-schema-consumer-events-stages-history-long       FALSE</span><br><span class=\"line\">performance-schema-consumer-events-statements-cpu            FALSE</span><br><span class=\"line\">performance-schema-consumer-events-statements-current        TRUE</span><br><span class=\"line\">performance-schema-consumer-events-statements-history        TRUE</span><br><span class=\"line\">performance-schema-consumer-events-statements-history-long   FALSE</span><br><span class=\"line\">performance-schema-consumer-events-transactions-current      TRUE</span><br><span class=\"line\">performance-schema-consumer-events-transactions-history      TRUE</span><br><span class=\"line\">performance-schema-consumer-events-transactions-history-long FALSE</span><br><span class=\"line\">performance-schema-consumer-events-waits-current             FALSE</span><br><span class=\"line\">performance-schema-consumer-events-waits-history             FALSE</span><br><span class=\"line\">performance-schema-consumer-events-waits-history-long        FALSE</span><br><span class=\"line\">performance-schema-consumer-global-instrumentation           TRUE</span><br><span class=\"line\">performance-schema-consumer-statements-digest                TRUE</span><br><span class=\"line\">performance-schema-consumer-thread-instrumentation           TRUE</span><br><span class=\"line\">performance-schema-digests-size                              -1</span><br><span class=\"line\">performance-schema-error-size                                5153</span><br><span class=\"line\">performance-schema-events-stages-history-long-size           -1</span><br><span class=\"line\">performance-schema-events-stages-history-size                -1</span><br><span class=\"line\">performance-schema-events-statements-history-long-size       -1</span><br><span class=\"line\">performance-schema-events-statements-history-size            -1</span><br><span class=\"line\">performance-schema-events-transactions-history-long-size     -1</span><br><span class=\"line\">performance-schema-events-transactions-history-size          -1</span><br><span class=\"line\">performance-schema-events-waits-history-long-size            -1</span><br><span class=\"line\">performance-schema-events-waits-history-size                 -1</span><br><span class=\"line\">performance-schema-hosts-size                                -1</span><br><span class=\"line\">performance-schema-instrument</span><br><span class=\"line\">performance-schema-max-cond-classes                          150</span><br><span class=\"line\">performance-schema-max-cond-instances                        -1</span><br><span class=\"line\">performance-schema-max-digest-length                         1024</span><br><span class=\"line\">performance-schema-max-digest-sample-age                     60</span><br><span class=\"line\">performance-schema-max-file-classes                          80</span><br><span class=\"line\">performance-schema-max-file-handles                          32768</span><br><span class=\"line\">performance-schema-max-file-instances                        -1</span><br><span class=\"line\">performance-schema-max-index-stat                            -1</span><br><span class=\"line\">performance-schema-max-memory-classes                        450</span><br><span class=\"line\">performance-schema-max-metadata-locks                        -1</span><br><span class=\"line\">performance-schema-max-mutex-classes                         350</span><br><span class=\"line\">performance-schema-max-mutex-instances                       -1</span><br><span class=\"line\">performance-schema-max-prepared-statements-instances         -1</span><br><span class=\"line\">performance-schema-max-program-instances                     -1</span><br><span class=\"line\">performance-schema-max-rwlock-classes                        60</span><br><span class=\"line\">performance-schema-max-rwlock-instances                      -1</span><br><span class=\"line\">performance-schema-max-socket-classes                        10</span><br><span class=\"line\">performance-schema-max-socket-instances                      -1</span><br><span class=\"line\">performance-schema-max-sql-text-length                       1024</span><br><span class=\"line\">performance-schema-max-stage-classes                         175</span><br><span class=\"line\">performance-schema-max-statement-classes                     219</span><br><span class=\"line\">performance-schema-max-statement-stack                       10</span><br><span class=\"line\">performance-schema-max-table-handles                         -1</span><br><span class=\"line\">performance-schema-max-table-instances                       -1</span><br><span class=\"line\">performance-schema-max-table-lock-stat                       -1</span><br><span class=\"line\">performance-schema-max-thread-classes                        100</span><br><span class=\"line\">performance-schema-max-thread-instances                      -1</span><br><span class=\"line\">performance-schema-session-connect-attrs-size                -1</span><br><span class=\"line\">performance-schema-setup-actors-size                         -1</span><br><span class=\"line\">performance-schema-setup-objects-size                        -1</span><br><span class=\"line\">performance-schema-show-processlist                          FALSE</span><br><span class=\"line\">performance-schema-users-size                                -1</span><br><span class=\"line\">persist-only-admin-x509-subject</span><br><span class=\"line\">persist-sensitive-variables-in-plaintext                     TRUE</span><br><span class=\"line\">persisted-globals-load                                       TRUE</span><br><span class=\"line\">pid-file                                                     /var/run/mysqld/mysqld.pid</span><br><span class=\"line\">plugin-dir                                                   /usr/lib64/mysql/plugin/</span><br><span class=\"line\">port                                                         3306</span><br><span class=\"line\">port-open-timeout                                            0</span><br><span class=\"line\">preload-buffer-size                                          32768</span><br><span class=\"line\"><span class=\"built_in\">print</span>-identified-with-as-hex                                 FALSE</span><br><span class=\"line\">profiling-history-size                                       15</span><br><span class=\"line\">protocol-compression-algorithms                              zlib,zstd,uncompressed</span><br><span class=\"line\">query-alloc-block-size                                       8192</span><br><span class=\"line\">query-prealloc-size                                          8192</span><br><span class=\"line\">range-alloc-block-size                                       4096</span><br><span class=\"line\">range-optimizer-max-mem-size                                 8388608</span><br><span class=\"line\"><span class=\"built_in\">read</span>-buffer-size                                             131072</span><br><span class=\"line\"><span class=\"built_in\">read</span>-only                                                    FALSE</span><br><span class=\"line\"><span class=\"built_in\">read</span>-rnd-buffer-size                                         262144</span><br><span class=\"line\">regexp-stack-limit                                           8000000</span><br><span class=\"line\">regexp-time-limit                                            32</span><br><span class=\"line\">relay-log                                                    a29706ab34c6-relay-bin</span><br><span class=\"line\">relay-log-index                                              a29706ab34c6-relay-bin.index</span><br><span class=\"line\">relay-log-info-file                                          relay-log.info</span><br><span class=\"line\">relay-log-info-repository                                    TABLE</span><br><span class=\"line\">relay-log-purge                                              TRUE</span><br><span class=\"line\">relay-log-recovery                                           FALSE</span><br><span class=\"line\">relay-log-space-limit                                        0</span><br><span class=\"line\">replica-allow-batching                                       TRUE</span><br><span class=\"line\">replica-checkpoint-group                                     512</span><br><span class=\"line\">replica-checkpoint-period                                    300</span><br><span class=\"line\">replica-compressed-protocol                                  FALSE</span><br><span class=\"line\">replica-exec-mode                                            STRICT</span><br><span class=\"line\">replica-load-tmpdir                                          /tmp</span><br><span class=\"line\">replica-max-allowed-packet                                   1073741824</span><br><span class=\"line\">replica-net-timeout                                          60</span><br><span class=\"line\">replica-parallel-type                                        LOGICAL_CLOCK</span><br><span class=\"line\">replica-parallel-workers                                     4</span><br><span class=\"line\">replica-pending-jobs-size-max                                134217728</span><br><span class=\"line\">replica-preserve-commit-order                                TRUE</span><br><span class=\"line\">replica-skip-errors                                          (No default value)</span><br><span class=\"line\">replica-sql-verify-checksum                                  TRUE</span><br><span class=\"line\">replica-transaction-retries                                  10</span><br><span class=\"line\">replica-type-conversions</span><br><span class=\"line\">replicate-same-server-id                                     FALSE</span><br><span class=\"line\">replication-optimize-for-static-plugin-config                FALSE</span><br><span class=\"line\">replication-sender-observe-commit-only                       FALSE</span><br><span class=\"line\">report-host                                                  (No default value)</span><br><span class=\"line\">report-password                                              (No default value)</span><br><span class=\"line\">report-port                                                  0</span><br><span class=\"line\">report-user                                                  (No default value)</span><br><span class=\"line\">require-secure-transport                                     FALSE</span><br><span class=\"line\">rpl-read-size                                                8192</span><br><span class=\"line\">rpl-stop-replica-timeout                                     31536000</span><br><span class=\"line\">rpl-stop-slave-timeout                                       31536000</span><br><span class=\"line\">safe-user-create                                             FALSE</span><br><span class=\"line\">schema-definition-cache                                      256</span><br><span class=\"line\">secondary-engine-cost-threshold                              100000</span><br><span class=\"line\">secure-file-priv                                             /var/lib/mysql-files</span><br><span class=\"line\">select-into-buffer-size                                      131072</span><br><span class=\"line\">select-into-disk-sync                                        FALSE</span><br><span class=\"line\">select-into-disk-sync-delay                                  0</span><br><span class=\"line\">server-id                                                    1</span><br><span class=\"line\">server-id-bits                                               32</span><br><span class=\"line\">session-track-gtids                                          OFF</span><br><span class=\"line\">session-track-schema                                         TRUE</span><br><span class=\"line\">session-track-state-change                                   FALSE</span><br><span class=\"line\">session-track-system-variables                               time_zone,autocommit,character_set_client,character_set_results,character_set_connection</span><br><span class=\"line\">session-track-transaction-info                               OFF</span><br><span class=\"line\">sha256-password-auto-generate-rsa-keys                       TRUE</span><br><span class=\"line\">sha256-password-private-key-path                             private_key.pem</span><br><span class=\"line\">sha256-password-proxy-users                                  FALSE</span><br><span class=\"line\">sha256-password-public-key-path                              public_key.pem</span><br><span class=\"line\">show-create-table-verbosity                                  FALSE</span><br><span class=\"line\">show-gipk-in-create-table-and-information-schema             TRUE</span><br><span class=\"line\">show-old-temporals                                           FALSE</span><br><span class=\"line\">show-replica-auth-info                                       FALSE</span><br><span class=\"line\">show-slave-auth-info                                         FALSE</span><br><span class=\"line\">skip-grant-tables                                            FALSE</span><br><span class=\"line\">skip-name-resolve                                            TRUE</span><br><span class=\"line\">skip-networking                                              FALSE</span><br><span class=\"line\">skip-replica-start                                           FALSE</span><br><span class=\"line\">skip-show-database                                           FALSE</span><br><span class=\"line\">skip-slave-start                                             FALSE</span><br><span class=\"line\">slave-allow-batching                                         TRUE</span><br><span class=\"line\">slave-checkpoint-group                                       512</span><br><span class=\"line\">slave-checkpoint-period                                      300</span><br><span class=\"line\">slave-compressed-protocol                                    FALSE</span><br><span class=\"line\">slave-exec-mode                                              STRICT</span><br><span class=\"line\">slave-load-tmpdir                                            /tmp</span><br><span class=\"line\">slave-max-allowed-packet                                     1073741824</span><br><span class=\"line\">slave-net-timeout                                            60</span><br><span class=\"line\">slave-parallel-type                                          LOGICAL_CLOCK</span><br><span class=\"line\">slave-parallel-workers                                       4</span><br><span class=\"line\">slave-pending-jobs-size-max                                  134217728</span><br><span class=\"line\">slave-preserve-commit-order                                  TRUE</span><br><span class=\"line\">slave-rows-search-algorithms                                 INDEX_SCAN,HASH_SCAN</span><br><span class=\"line\">slave-skip-errors                                            (No default value)</span><br><span class=\"line\">slave-sql-verify-checksum                                    TRUE</span><br><span class=\"line\">slave-transaction-retries                                    10</span><br><span class=\"line\">slave-type-conversions</span><br><span class=\"line\">slow-launch-time                                             2</span><br><span class=\"line\">slow-query-log                                               FALSE</span><br><span class=\"line\">slow-query-log-file                                          /var/lib/mysql/a29706ab34c6-slow.log</span><br><span class=\"line\">socket                                                       /var/run/mysqld/mysqld.sock</span><br><span class=\"line\">sort-buffer-size                                             262144</span><br><span class=\"line\"><span class=\"built_in\">source</span>-verify-checksum                                       FALSE</span><br><span class=\"line\">sporadic-binlog-dump-fail                                    FALSE</span><br><span class=\"line\">sql-generate-invisible-primary-key                           FALSE</span><br><span class=\"line\">sql-mode                                                     ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION</span><br><span class=\"line\">sql-require-primary-key                                      FALSE</span><br><span class=\"line\">ssl                                                          TRUE</span><br><span class=\"line\">ssl-ca                                                       (No default value)</span><br><span class=\"line\">ssl-capath                                                   (No default value)</span><br><span class=\"line\">ssl-cert                                                     (No default value)</span><br><span class=\"line\">ssl-cipher                                                   (No default value)</span><br><span class=\"line\">ssl-crl                                                      (No default value)</span><br><span class=\"line\">ssl-crlpath                                                  (No default value)</span><br><span class=\"line\">ssl-fips-mode                                                OFF</span><br><span class=\"line\">ssl-key                                                      (No default value)</span><br><span class=\"line\">ssl-session-cache-mode                                       TRUE</span><br><span class=\"line\">ssl-session-cache-timeout                                    300</span><br><span class=\"line\">stored-program-cache                                         256</span><br><span class=\"line\">stored-program-definition-cache                              256</span><br><span class=\"line\">super-large-pages                                            FALSE</span><br><span class=\"line\">super-read-only                                              FALSE</span><br><span class=\"line\">symbolic-links                                               FALSE</span><br><span class=\"line\">sync-binlog                                                  1</span><br><span class=\"line\">sync-master-info                                             10000</span><br><span class=\"line\">sync-relay-log                                               10000</span><br><span class=\"line\">sync-relay-log-info                                          10000</span><br><span class=\"line\">sync-source-info                                             10000</span><br><span class=\"line\">sysdate-is-now                                               FALSE</span><br><span class=\"line\">table-definition-cache                                       2000</span><br><span class=\"line\">table-encryption-privilege-check                             FALSE</span><br><span class=\"line\">table-open-cache                                             4000</span><br><span class=\"line\">table-open-cache-instances                                   16</span><br><span class=\"line\">tablespace-definition-cache                                  256</span><br><span class=\"line\">tc-heuristic-recover                                         OFF</span><br><span class=\"line\">temptable-max-mmap                                           1073741824</span><br><span class=\"line\">temptable-max-ram                                            1073741824</span><br><span class=\"line\">temptable-use-mmap                                           TRUE</span><br><span class=\"line\">terminology-use-previous                                     NONE</span><br><span class=\"line\">thread-cache-size                                            9</span><br><span class=\"line\">thread-handling                                              one-thread-per-connection</span><br><span class=\"line\">thread-stack                                                 1048576</span><br><span class=\"line\">tls-ciphersuites                                             (No default value)</span><br><span class=\"line\">tls-version                                                  TLSv1.2,TLSv1.3</span><br><span class=\"line\">tmp-table-size                                               16777216</span><br><span class=\"line\">tmpdir                                                       /tmp</span><br><span class=\"line\">transaction-alloc-block-size                                 8192</span><br><span class=\"line\">transaction-isolation                                        REPEATABLE-READ</span><br><span class=\"line\">transaction-prealloc-size                                    4096</span><br><span class=\"line\">transaction-read-only                                        FALSE</span><br><span class=\"line\">transaction-write-set-extraction                             XXHASH64</span><br><span class=\"line\">updatable-views-with-limit                                   YES</span><br><span class=\"line\">upgrade                                                      AUTO</span><br><span class=\"line\">validate-config                                              FALSE</span><br><span class=\"line\">validate-user-plugins                                        TRUE</span><br><span class=\"line\">verbose                                                      TRUE</span><br><span class=\"line\"><span class=\"built_in\">wait</span>-timeout                                                 28800</span><br><span class=\"line\">windowing-use-high-precision                                 TRUE</span><br><span class=\"line\">xa-detach-on-prepare                                         TRUE</span><br></pre></td></tr></table></figure>\n<p><br/></p>\n<p><strong>默认支持环境变量</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MYSQL_DATABASE=数据库名称</span><br><span class=\"line\">MYSQL_USER=应用用户</span><br><span class=\"line\">MYSQL_PASSWORD=应用账号密码</span><br><span class=\"line\">MYSQL_ROOT_PASSWORD=ROOT账户密码</span><br><span class=\"line\">MYSQL_RANDOM_ROOT_PASSWORD=yes <span class=\"comment\"># 允许为为 root 用户生成一个随机初始密码并将其打印到stdout</span></span><br><span class=\"line\">MYSQL_ALLOW_EMPTY_PASSWORD=yes <span class=\"comment\"># 以允许使用根用户的空白密码启动容器,非常不建议在实践环境中使用该变量</span></span><br><span class=\"line\"><span class=\"comment\"># MYSQL_ONETIME_PASSWORD   # 通常不适用,此功能仅在 MySQL 5.6+ 上受支持。 在 MySQL 5.5 上使用此选项将在初始化期间引发适当的错误。 </span></span><br><span class=\"line\"><span class=\"comment\"># MYSQL_INITDB_SKIP_TZINFO # 默认情况下,入口点脚本会自动加载所需的时区数据 CONVERT_TZ()功能。 如果不需要，任何非空值都会禁用时区加载。</span></span><br></pre></td></tr></table></figure>\n<p>温馨提示: 为了替代环境变量传递敏感信息 , 我们可在 <code>MYSQL_ROOT_PASSWORD_FILE=/run/secrets/mysql-root</code>, 可在如下变量中添加 <code>_FILE=</code> 目前仅支持 ,<code>MYSQL_ROOT_PASSWORD, MYSQL_ROOT_HOST, MYSQL_DATABASE, MYSQL_USER 和 MYSQL_PASSWORD</code> 。 </p>\n<p><br/></p>\n<p><strong>数据库备份、恢复</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 备份</span></span><br><span class=\"line\">$ docker <span class=\"built_in\">exec</span> mysql8.0 sh -c <span class=\"string\">'exec mysqldump --all-databases -uroot -p\"$MYSQL_ROOT_PASSWORD\"'</span> &gt; /some/path/on/your/host/all-databases.sql</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 恢复</span></span><br><span class=\"line\">$ docker <span class=\"built_in\">exec</span> -i mysql8.0 sh -c <span class=\"string\">'exec mysql -uroot -p\"$MYSQL_ROOT_PASSWORD\"'</span> &lt; /some/path/on/your/host/all-databases.sql</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h3 id=\"配置清单\"><a href=\"#配置清单\" class=\"headerlink\" title=\"配置清单\"></a>配置清单</h3><p>描述：我们可以使用类似于配置清单文件，使用 docker 的 stack 子命令或者 docker-compose 名来部署 <code>stack.yml</code>。</p>\n<p>步骤 01.准备 mysql.yaml 部署清单</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">'3.1'</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\"><span class=\"attr\">  db:</span></span><br><span class=\"line\"><span class=\"attr\">    image:</span> <span class=\"attr\">mysql:8.0.30</span></span><br><span class=\"line\"><span class=\"attr\">    container_name:</span> <span class=\"string\">mysql8.x</span></span><br><span class=\"line\">    <span class=\"comment\"># <span class=\"doctag\">NOTE:</span> use of \"mysql_native_password\" is not recommended: https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password</span></span><br><span class=\"line\">    <span class=\"comment\"># (this is just an example, not intended to be a production configuration)</span></span><br><span class=\"line\"><span class=\"attr\">    command:</span> <span class=\"bullet\">--default-authentication-plugin=mysql_native_password</span></span><br><span class=\"line\"><span class=\"attr\">    restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\"><span class=\"attr\">    environment:</span></span><br><span class=\"line\">      <span class=\"comment\"># MYSQL_ROOT_PASSWORD: example</span></span><br><span class=\"line\"><span class=\"attr\">      MYSQL_ROOT_PASSWORD_FILE:</span> <span class=\"string\">/app/my-secret-pw</span></span><br><span class=\"line\"><span class=\"attr\">      MYSQL_DATABASE:</span> <span class=\"string\">app</span></span><br><span class=\"line\"><span class=\"attr\">      MYSQL_USER:</span> <span class=\"string\">weiyigeek</span></span><br><span class=\"line\"><span class=\"attr\">      MYSQL_PASSWORD:</span> <span class=\"string\">password</span></span><br><span class=\"line\"><span class=\"attr\">    volumes:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">\"/app/data:/var/lib/mysql\"</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">\"/app/my-secret-pw:/app/my-secret-pw\"</span></span><br><span class=\"line\"><span class=\"attr\">    ports:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"number\">3306</span><span class=\"string\">:3306</span></span><br><span class=\"line\">  <span class=\"comment\"># 部署adminer 进行图形化管理 mysql 数据库</span></span><br><span class=\"line\"><span class=\"attr\">  adminer:</span></span><br><span class=\"line\"><span class=\"attr\">    image:</span> <span class=\"string\">adminer</span></span><br><span class=\"line\"><span class=\"attr\">    restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\"><span class=\"attr\">    ports:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"number\">8080</span><span class=\"string\">:8080</span></span><br></pre></td></tr></table></figure>\n<p><br/></p>\n<p>步骤 02.准备本地持久化数据库以及root认证密码</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -vp /app/data</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"weiyigeek.top\"</span> &gt; /app/my-secret-pw</span><br></pre></td></tr></table></figure>\n<p><br/></p>\n<p>步骤 03.使用docker或者docker-compose进行部署</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker stack deploy -c mysql.yml mysql </span><br><span class=\"line\">docker-compose -f mysql.yml up</span><br></pre></td></tr></table></figure>\n<hr>\n<h2 id=\"2-Kubernetes-快速部署-MySQL-数据库服务器\"><a href=\"#2-Kubernetes-快速部署-MySQL-数据库服务器\" class=\"headerlink\" title=\"2.Kubernetes 快速部署 MySQL 数据库服务器\"></a>2.Kubernetes 快速部署 MySQL 数据库服务器</h2><p>当前，许多企业开始构建自己的容器化架构，而 mysql 部署在 k8s 上的优势主要有以下几点：</p>\n<ul>\n<li>资源隔离</li>\n<li>动态弹性扩缩容</li>\n<li>环境一致性</li>\n<li>运维方便</li>\n</ul>\n<p>温馨提示：此处实践环境是使用Kubernetes集群,若你没有安装Kubernetes集群环境或者不了解的Kubernetes容器的朋友，可以参考博主学习【Kubernetes的系列笔记】汇总，关注 WeiyiGeek 公众号回复【<code>Kubernetes学习之路汇总</code>】即可获得学习资料：<br><a href=\"https://www.weiyigeek.top/wechat.html?key=Kubernetes学习之路汇总\" target=\"_blank\" rel=\"noopener\">https://www.weiyigeek.top/wechat.html?key=Kubernetes学习之路汇总</a><br><br/></p>\n<h3 id=\"单实例模式\"><a href=\"#单实例模式\" class=\"headerlink\" title=\"单实例模式\"></a>单实例模式</h3><p>步骤 01.准备mysql部署资源清单，此处使用StatefulSet与Service资源清单。</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">tee</span> <span class=\"string\">K8s-Standalone-MySQL.yaml</span> <span class=\"string\">&lt;&lt;'EOF'</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">&#123;APP_NAME&#125;</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">&#123;NAMESPACE&#125;</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">&#123;APP_NAME&#125;</span></span><br><span class=\"line\"><span class=\"attr\">    type:</span> <span class=\"string\">standalone</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  type:</span> <span class=\"string\">NodePort</span></span><br><span class=\"line\"><span class=\"attr\">  ports:</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">server</span></span><br><span class=\"line\"><span class=\"attr\">    port:</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">    protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\"><span class=\"attr\">    targetPort:</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">    nodePort:</span> <span class=\"string\">&#123;NODEPORT&#125;</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">&#123;APP_NAME&#125;</span></span><br><span class=\"line\"><span class=\"attr\">    type:</span> <span class=\"string\">standalone</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StatefulSet</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\"><span class=\"attr\">  name:</span> <span class=\"string\">&#123;APP_NAME&#125;</span></span><br><span class=\"line\"><span class=\"attr\">  namespace:</span> <span class=\"string\">&#123;NAMESPACE&#125;</span></span><br><span class=\"line\"><span class=\"attr\">  labels:</span></span><br><span class=\"line\"><span class=\"attr\">    app:</span> <span class=\"string\">&#123;APP_NAME&#125;</span></span><br><span class=\"line\"><span class=\"attr\">    type:</span> <span class=\"string\">standalone</span></span><br><span class=\"line\"><span class=\"attr\">  annotations:</span></span><br><span class=\"line\"><span class=\"attr\">    version:</span> <span class=\"string\">&#123;APP_VERSION&#125;</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\"><span class=\"attr\">  replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">  selector:</span></span><br><span class=\"line\"><span class=\"attr\">    matchLabels:</span></span><br><span class=\"line\"><span class=\"attr\">      app:</span> <span class=\"string\">&#123;APP_NAME&#125;</span></span><br><span class=\"line\"><span class=\"attr\">      type:</span> <span class=\"string\">standalone</span></span><br><span class=\"line\"><span class=\"attr\">  serviceName:</span> <span class=\"string\">&#123;APP_NAME&#125;</span></span><br><span class=\"line\"><span class=\"attr\">  template:</span></span><br><span class=\"line\"><span class=\"attr\">    metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        app:</span> <span class=\"string\">&#123;APP_NAME&#125;</span></span><br><span class=\"line\"><span class=\"attr\">        type:</span> <span class=\"string\">standalone</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\">      <span class=\"comment\"># 运行节点标签选择</span></span><br><span class=\"line\">      <span class=\"comment\"># nodeSelector:</span></span><br><span class=\"line\">      <span class=\"comment\">#   app: database</span></span><br><span class=\"line\"><span class=\"attr\">      containers:</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">&#123;APP_NAME&#125;</span></span><br><span class=\"line\"><span class=\"attr\">        image:</span> <span class=\"attr\">mysql:&#123;APP_VERSION&#125;</span></span><br><span class=\"line\"><span class=\"attr\">        imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\"><span class=\"attr\">        ports:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">server</span></span><br><span class=\"line\"><span class=\"attr\">          containerPort:</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"attr\">        env:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">MYSQL_ROOT_PASSWORD</span></span><br><span class=\"line\"><span class=\"attr\">          value:</span> <span class=\"string\">\"&#123;MYSQL_ROOT_PASSWORD&#125;\"</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">MYSQL_DATABASE</span></span><br><span class=\"line\"><span class=\"attr\">          value:</span> <span class=\"string\">\"&#123;MYSQL_DATABASE&#125;\"</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">MYSQL_USER</span></span><br><span class=\"line\"><span class=\"attr\">          value:</span> <span class=\"string\">\"&#123;MYSQL_USER&#125;\"</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">MYSQL_PASSWORD</span></span><br><span class=\"line\"><span class=\"attr\">          value:</span> <span class=\"string\">\"&#123;MYSQL_PASSWORD&#125;\"</span></span><br><span class=\"line\"><span class=\"attr\">        volumeMounts:</span></span><br><span class=\"line\"><span class=\"attr\">        - name:</span> <span class=\"string\">data</span></span><br><span class=\"line\"><span class=\"attr\">          mountPath:</span> <span class=\"string\">/var/lib/mysql</span></span><br><span class=\"line\">      <span class=\"comment\">#  - name: mysql-conf</span></span><br><span class=\"line\">      <span class=\"comment\">#    mountPath: /etc/mysql/my.cnf</span></span><br><span class=\"line\">      <span class=\"comment\">#    subPath: my.cnf</span></span><br><span class=\"line\">      <span class=\"comment\">#  - name: log</span></span><br><span class=\"line\">      <span class=\"comment\">#    mountPath: /var/log/mysqld.log</span></span><br><span class=\"line\"><span class=\"attr\">        resources:</span></span><br><span class=\"line\"><span class=\"attr\">          limits:</span></span><br><span class=\"line\"><span class=\"attr\">            memory:</span> <span class=\"string\">\"4Gi\"</span></span><br><span class=\"line\"><span class=\"attr\">            cpu:</span> <span class=\"string\">\"2\"</span></span><br><span class=\"line\"><span class=\"attr\">          requests:</span></span><br><span class=\"line\"><span class=\"attr\">            memory:</span> <span class=\"string\">\"512Mi\"</span></span><br><span class=\"line\"><span class=\"attr\">            cpu:</span> <span class=\"string\">\"1\"</span></span><br><span class=\"line\"><span class=\"attr\">      volumes:</span></span><br><span class=\"line\">      <span class=\"comment\"># 方式1,持久化 hostPath</span></span><br><span class=\"line\"><span class=\"attr\">      - name:</span> <span class=\"string\">mysql-persistent-storage</span></span><br><span class=\"line\"><span class=\"attr\">        hostPath:</span></span><br><span class=\"line\"><span class=\"attr\">          path:</span> <span class=\"string\">&#123;HOSTPATH&#125;</span></span><br><span class=\"line\"><span class=\"attr\">          type:</span> <span class=\"string\">DirectoryOrCreate</span></span><br><span class=\"line\">      <span class=\"comment\"># - name: mysql-conf</span></span><br><span class=\"line\">      <span class=\"comment\">#   configMap:</span></span><br><span class=\"line\">      <span class=\"comment\">#     name: mysql-conf</span></span><br><span class=\"line\">      <span class=\"comment\">#     items:</span></span><br><span class=\"line\">      <span class=\"comment\">#     - key: my.cnf</span></span><br><span class=\"line\">      <span class=\"comment\">#       path: my.cnf</span></span><br><span class=\"line\">   <span class=\"comment\"># 方式2,持久化nfs存储卷</span></span><br><span class=\"line\"><span class=\"attr\">  volumeClaimTemplates:</span></span><br><span class=\"line\"><span class=\"attr\">  - metadata:</span></span><br><span class=\"line\"><span class=\"attr\">      name:</span> <span class=\"string\">data</span></span><br><span class=\"line\"><span class=\"attr\">      labels:</span></span><br><span class=\"line\"><span class=\"attr\">        app:</span> <span class=\"string\">&#123;APP_NAME&#125;</span></span><br><span class=\"line\"><span class=\"attr\">        type:</span> <span class=\"string\">standalone</span></span><br><span class=\"line\"><span class=\"attr\">    spec:</span></span><br><span class=\"line\"><span class=\"attr\">      accessModes:</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">ReadWriteOnce</span></span><br><span class=\"line\"><span class=\"attr\">      storageClassName:</span> <span class=\"string\">&#123;storageClassName&#125;</span></span><br><span class=\"line\"><span class=\"attr\">      resources:</span></span><br><span class=\"line\"><span class=\"attr\">        requests:</span></span><br><span class=\"line\"><span class=\"attr\">          storage:</span> <span class=\"number\">5</span><span class=\"string\">Gi</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br></pre></td></tr></table></figure>\n<p><br/></p>\n<p>步骤 02.准备持久化目录与替换部署清单关键字。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 注意,通常此目录为挂到各k8s节点上的nfs服务存储</span></span><br><span class=\"line\">mkdir -vp /app/data</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 替换关键配置</span></span><br><span class=\"line\">sed -i -e <span class=\"string\">\"s#&#123;APP_NAME&#125;#mysql-weiyigeek#g\"</span> -e <span class=\"string\">\"s#&#123;NAMESPACE&#125;#database#g\"</span> -e <span class=\"string\">\"s#&#123;NODEPORT&#125;#31001#g\"</span>  -e <span class=\"string\">\"s#&#123;APP_VERSION&#125;#8.0.30#g\"</span> \\</span><br><span class=\"line\">-e <span class=\"string\">\"s#&#123;MYSQL_ROOT_PASSWORD&#125;#weiyigeek.top#g\"</span>  -e <span class=\"string\">\"s#&#123;MYSQL_DATABASE&#125;#app#g\"</span> -e <span class=\"string\">\"s#&#123;MYSQL_USER&#125;#weiyigeek#g\"</span>  -e <span class=\"string\">\"s#&#123;MYSQL_PASSWORD&#125;#password#g\"</span> \\</span><br><span class=\"line\">-e <span class=\"string\">\"s#&#123;HOSTPATH&#125;#/app/data#g\"</span> -e <span class=\"string\">\"s#&#123;storageClassName&#125;#nfs-dev#g\"</span> \\</span><br><span class=\"line\">K8s-Standalone-MySQL.yaml</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 例如，可以将 my.cnf 使用 configmap 控制器进行存储，此外我采用镜像缺省的没有使用如下方式。</span></span><br><span class=\"line\">kubectl create configmap mysql-conf --from-file=my.cnf --namespace database</span><br></pre></td></tr></table></figure>\n<p><br></p>\n<p>步骤 03.在K8S中执行部署mysql的命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 名词空间</span></span><br><span class=\"line\">kubectl create namespace database</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 部署mysql资源清单</span></span><br><span class=\"line\">kubectl apply -f K8s-Standalone-MySQL.yaml</span><br><span class=\"line\">  <span class=\"comment\"># service/mysql-weiyigeek created</span></span><br><span class=\"line\">  <span class=\"comment\"># statefulset.apps/mysql-weiyigeek created</span></span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\"># 查看部署情况</span></span><br><span class=\"line\">kubectl get sts,svc,pod -n database</span><br><span class=\"line\">  <span class=\"comment\"># NAME                         READY   AGE</span></span><br><span class=\"line\">  <span class=\"comment\"># statefulset.apps/mysql-weiyigeek   1/1     77s</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\"># NAME                TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE</span></span><br><span class=\"line\">  <span class=\"comment\"># service/mysql-weiyigeek   NodePort   10.108.74.113    &lt;none&gt;        3306:31001/TCP   77s</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\"># NAME              READY   STATUS    RESTARTS   AGE</span></span><br><span class=\"line\">  <span class=\"comment\"># pod/mysql-weiyigeek-0   1/1     Running   0          77s</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 日志查看</span></span><br><span class=\"line\">kubectl logs -f --tail 50 -n database pod/mysql-weiyigeek-0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 持久化数据查看</span></span><br><span class=\"line\">kubectl get pvc -n database</span><br><span class=\"line\">  <span class=\"comment\"># NAME               STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span></span><br><span class=\"line\">  <span class=\"comment\"># data-mysql-weiyigeek-0   Bound    pvc-37390e64-9401-4b66-8b4f-216d91e2a7fd   5Gi        RWO            nfs-dev        4m55s</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /storage/dev/pvc/<span class=\"built_in\">local</span>/database-data-mysql-weiyigeek-0-pvc-37390e64-9401-4b66-8b4f-216d91e2a7fd</span><br><span class=\"line\">ls </span><br><span class=\"line\">  <span class=\"comment\"># app             binlog.000002   ca.pem           '#ib_16384_0.dblwr'   ibdata1        '#innodb_temp'   mysql.sock           public_key.pem    sys</span></span><br><span class=\"line\">  <span class=\"comment\"># auto.cnf        binlog.index    client-cert.pem  '#ib_16384_1.dblwr'   ibtmp1          mysql           performance_schema   server-cert.pem   undo_001</span></span><br><span class=\"line\">  <span class=\"comment\"># binlog.000001   ca-key.pem      client-key.pem    ib_buffer_pool      '#innodb_redo'   mysql.ibd       private_key.pem      server-key.pem    undo_002</span></span><br></pre></td></tr></table></figure>\n<p><br></p>\n<p>步骤 04.使用 adminer 连接 k8s 部署的 MySQL 数据库，验证其服务。</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220928134020.png\" alt=\"WeiyiGeek.adminer-connect-k8s-deploy-mysql8.x\" title=\"\" class=\"\">\n                <p>WeiyiGeek.adminer-connect-k8s-deploy-mysql8.x</p>\n            </figure>\n<p><br/></p>\n<h3 id=\"主从同步模式\"><a href=\"#主从同步模式\" class=\"headerlink\" title=\"主从同步模式\"></a>主从同步模式</h3><p>此节，我们实践在K8S集群中搭建一个 MySQL 主从数据库，主（可读、可写），从只读，如下是MySQL主从原理图以及MySQL主从模式在K8S集群中的部署架构。</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220928142610.png\" alt=\"WeiyiGeek.MySQL主从原理图以及MySQL主从模式在K8S集群中的部署架构图\" title=\"\" class=\"\">\n                <p>WeiyiGeek.MySQL主从原理图以及MySQL主从模式在K8S集群中的部署架构图</p>\n            </figure>\n<p>步骤 01.添加 helm 源并在源中下载 mysql 部署清单到本地，此处我的helm版本为v3.9.0。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 温馨提示：master节点上需要安装 helm 然后进行拉取部署的相关资源部署清单图表</span></span><br><span class=\"line\">helm3 repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class=\"line\">helm3 search repo bitnami/mysql -l</span><br><span class=\"line\">  <span class=\"comment\"># NAME            CHART VERSION   APP VERSION     DESCRIPTION</span></span><br><span class=\"line\">  <span class=\"comment\"># bitnami/mysql   9.3.4           8.0.30          MySQL is a fast, reliable, scalable, and easy t....</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 拉取到本地以及其部署清单图表</span></span><br><span class=\"line\">$ helm3 pull bitnami/mysql  --version 9.3.4 --untar</span><br><span class=\"line\">$ ls mysql/</span><br><span class=\"line\">Chart.lock  charts  Chart.yaml  README.md  templates  values.schema.json  values.yaml</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p>步骤 02.修改该 Chart 图表 values.yaml 文件，已下逻辑出主要修改点。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim mysql/values.yaml</span><br><span class=\"line\">....</span><br><span class=\"line\"><span class=\"comment\"># 修改1.使用内部仓库镜像地址（后续会将其同步到内部harbor中此处先更改）</span></span><br><span class=\"line\">image:</span><br><span class=\"line\">  registry: harbor.weiyigeek.top</span><br><span class=\"line\">  repository: library/mysql</span><br><span class=\"line\">  tag: 8.0.30-debian-11-r15</span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"comment\"># 修改2.MySQL部署模式 (`standalone` or `replication`)此处为主从复制。</span></span><br><span class=\"line\">architecture: replication</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 修改3.数据库认证账号（root、普通用户、replication用户）相关密码以及创建的数据库设置，密码留空则会自动生成</span></span><br><span class=\"line\">auth:</span><br><span class=\"line\">  rootPassword: <span class=\"string\">\"\"</span></span><br><span class=\"line\">  createDatabase: <span class=\"literal\">true</span></span><br><span class=\"line\">  database: <span class=\"string\">\"app\"</span></span><br><span class=\"line\">  username: <span class=\"string\">\"app\"</span></span><br><span class=\"line\">  password: <span class=\"string\">\"\"</span></span><br><span class=\"line\">  replicationUser: replicator</span><br><span class=\"line\">  replicationPassword: <span class=\"string\">\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 修改4.MySQL Primary 服务相关参数配置</span></span><br><span class=\"line\">primary:</span><br><span class=\"line\">  name: primary</span><br><span class=\"line\">  <span class=\"comment\"># 资源限制 : 此处 1000m 表示使用1个CPU的资源，内存最大4G。</span></span><br><span class=\"line\">  resources:</span><br><span class=\"line\">    limits:</span><br><span class=\"line\">      cpu: 1000m   </span><br><span class=\"line\">      memory: 4Gi</span><br><span class=\"line\">  <span class=\"comment\"># 修改5.主资源持久化配置，此处我已经搭建了动态逻辑卷。</span></span><br><span class=\"line\">  persistence:</span><br><span class=\"line\">    enabled: <span class=\"literal\">true</span></span><br><span class=\"line\">    storageClass: <span class=\"string\">\"nfs-local\"</span></span><br><span class=\"line\">    accessModes:</span><br><span class=\"line\">      - ReadWriteOnce</span><br><span class=\"line\">    size: 10Gi</span><br><span class=\"line\">  <span class=\"comment\"># 修改6.主服务持久化配置,注意此处与secondary服务节点配置不同</span></span><br><span class=\"line\">  service:</span><br><span class=\"line\">    <span class=\"built_in\">type</span>: NodePort</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      mysql: 3306</span><br><span class=\"line\">    nodePorts:</span><br><span class=\"line\">      mysql: <span class=\"string\">\"31006\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 修改7.MySQL Secondary 服务相关参数配置</span></span><br><span class=\"line\">secondary:</span><br><span class=\"line\">  name: secondary</span><br><span class=\"line\">  replicaCount: 2</span><br><span class=\"line\">  resources:</span><br><span class=\"line\">  limits:</span><br><span class=\"line\">    cpu: 1000m</span><br><span class=\"line\">    memory: 2048Mi</span><br><span class=\"line\">  <span class=\"comment\"># 修改6.从(节点)资源持久化配置，此处我已经搭建了动态逻辑卷。</span></span><br><span class=\"line\">  persistence:</span><br><span class=\"line\">    enabled: <span class=\"literal\">true</span></span><br><span class=\"line\">    storageClass: <span class=\"string\">\"nfs-local\"</span></span><br><span class=\"line\">    accessModes:</span><br><span class=\"line\">      - ReadWriteOnce</span><br><span class=\"line\">    size: 10Gi</span><br><span class=\"line\">  <span class=\"comment\"># 修改8.从(节点)持久化配置,注意此处与primary服务节点配置不同</span></span><br><span class=\"line\">  service:</span><br><span class=\"line\">    <span class=\"built_in\">type</span>: NodePort</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      mysql: 3306</span><br><span class=\"line\">    nodePorts:</span><br><span class=\"line\">      mysql: <span class=\"string\">\"31008\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 修改点9.启用 Promethues 的 mysqld-exporter</span></span><br><span class=\"line\">metrics:</span><br><span class=\"line\">  enabled: <span class=\"literal\">true</span></span><br><span class=\"line\">  image:</span><br><span class=\"line\">    registry: harbor.weiyigeek.top</span><br><span class=\"line\">    repository: library/mysqld-exporter</span><br><span class=\"line\">    tag: 0.14.0-debian-11-r33</span><br></pre></td></tr></table></figure>\n<p><br/></p>\n<p>步骤 03.为了加快拉取速度，此处将镜像拉取上传到内部harbor中<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull bitnami/mysqld-exporter:0.14.0-debian-11-r33</span><br><span class=\"line\">docker tag bitnami/mysqld-exporter:0.14.0-debian-11-r33 harbor.weiyigeek.top/library/mysqld-exporter:0.14.0-debian-11-r33</span><br><span class=\"line\">docker push harbor.weiyigeek.top/library/mysqld-exporter:0.14.0-debian-11-r33</span><br><span class=\"line\"></span><br><span class=\"line\">docker pull bitnami/mysql:8.0.30-debian-11-r15</span><br><span class=\"line\">docker tag bitnami/mysql:8.0.30-debian-11-r15 harbor.weiyigeek.top/library/mysql:8.0.30-debian-11-r15</span><br><span class=\"line\">docker push harbor.weiyigeek.top/library/mysql:8.0.30-debian-11-r15</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p>步骤 04.使用helm3安装我们修改后的MySQL主从图表,以及显示安装情况<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ helm3 install mysql ./mysql --namespace database --create-namespace</span><br><span class=\"line\">  <span class=\"comment\"># NAME: mysql</span></span><br><span class=\"line\">  <span class=\"comment\"># LAST DEPLOYED: Wed Sep 28 16:33:23 2022</span></span><br><span class=\"line\">  <span class=\"comment\"># NAMESPACE: database</span></span><br><span class=\"line\">  <span class=\"comment\"># STATUS: deployed</span></span><br><span class=\"line\">  <span class=\"comment\"># REVISION: 1</span></span><br><span class=\"line\">  <span class=\"comment\"># TEST SUITE: None</span></span><br><span class=\"line\">  <span class=\"comment\"># NOTES:</span></span><br><span class=\"line\">  <span class=\"comment\"># CHART NAME: mysql</span></span><br><span class=\"line\">  <span class=\"comment\"># CHART VERSION: 9.3.4</span></span><br><span class=\"line\">  <span class=\"comment\"># APP VERSION: 8.0.30</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ helm3 list -n database</span><br><span class=\"line\">  <span class=\"comment\"># NAME    NAMESPACE       REVISION        UPDATED                                 STATUS          CHART           APP VERSION</span></span><br><span class=\"line\">  <span class=\"comment\"># mysql   database        1               2022-09-28 16:33:23.01465975 +0800 CST  deployed        mysql-9.3.4     8.0.30</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get sts,pod -n database -l app.kubernetes.io/name=mysql</span><br><span class=\"line\">  <span class=\"comment\"># NAME                               READY   AGE</span></span><br><span class=\"line\">  <span class=\"comment\"># statefulset.apps/mysql-primary     1/1     2m37s</span></span><br><span class=\"line\">  <span class=\"comment\"># statefulset.apps/mysql-secondary   2/2     2m37s</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\"># NAME                    READY   STATUS    RESTARTS   AGE</span></span><br><span class=\"line\">  <span class=\"comment\"># pod/mysql-primary-0     2/2     Running   0          2m37s</span></span><br><span class=\"line\">  <span class=\"comment\"># pod/mysql-secondary-0   2/2     Running   0          2m37s</span></span><br><span class=\"line\">  <span class=\"comment\"># pod/mysql-secondary-1   2/2     Running   0          95s</span></span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p>步骤 05.获取自动生成的MySQL root、app以及replication用户密码<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> -n <span class=\"string\">\"MYSQL_ROOT_PASSWORD=\"</span>;kubectl get secret --namespace database mysql -o jsonpath=<span class=\"string\">\"&#123;.data.mysql-root-password&#125;\"</span> | base64 -d;<span class=\"built_in\">echo</span></span><br><span class=\"line\"><span class=\"comment\"># MYSQL_ROOT_PASSWORD=oX7112Avng</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n <span class=\"string\">\"MYSQL_PASSWORD=\"</span>;kubectl get secret --namespace database mysql -o jsonpath=<span class=\"string\">\"&#123;.data.mysql-password&#125;\"</span> | base64 -d;<span class=\"built_in\">echo</span></span><br><span class=\"line\"><span class=\"comment\"># MYSQL_PASSWORD=pdtsixSpV28</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -n <span class=\"string\">\"MYSQL_REPLICATION_PASSWORD=\"</span>;kubectl get secret --namespace database mysql -o jsonpath=<span class=\"string\">\"&#123;.data.mysql-replication-password&#125;\"</span> | base64 -d;<span class=\"built_in\">echo</span></span><br><span class=\"line\"><span class=\"comment\"># MYSQL_REPLICATION_PASSWORD=FJRspMupePE</span></span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p>步骤 06.使用 Adminer 连接到主服务中进行读写，然后验证从节点的是否正确可读。</p>\n<p>主节点服务中创建表并插入数据<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- To connect to primary service (read/write):</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"keyword\">replication</span> (</span><br><span class=\"line\">  <span class=\"keyword\">id</span> <span class=\"built_in\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>  PRIMARY <span class=\"keyword\">KEY</span> AUTO_INCREMENT,</span><br><span class=\"line\">  <span class=\"keyword\">name</span> <span class=\"built_in\">VARCHAR</span>(<span class=\"number\">255</span>)  <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</span><br><span class=\"line\">  <span class=\"keyword\">INDEX</span> name_in (<span class=\"keyword\">name</span>)</span><br><span class=\"line\">);</span><br><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> app.replication(<span class=\"keyword\">name</span>) <span class=\"keyword\">VALUES</span>(<span class=\"string\">'WeiyiGeek'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 创建数据库、用户、并将创建的数据库所有权赋予给创建用户</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">DATABASE</span> dev;</span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">USER</span> <span class=\"string\">'dev'</span>@<span class=\"string\">'%'</span> <span class=\"keyword\">IDENTIFIED</span> <span class=\"keyword\">BY</span> <span class=\"string\">'dev.weiyigeek.top'</span>;  </span><br><span class=\"line\"><span class=\"keyword\">GRANT</span> <span class=\"keyword\">ALL</span> <span class=\"keyword\">ON</span> dev.* <span class=\"keyword\">TO</span> <span class=\"string\">'dev'</span>@<span class=\"string\">\"%\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">FLUSH</span> <span class=\"keyword\">PRIVILEGES</span>;</span><br></pre></td></tr></table></figure></p>\n<p>从节点查询插入的数据<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- To connect to secondary service (read):</span></span><br><span class=\"line\">kubectl run mysql-client <span class=\"comment\">--rm --tty -i --restart='Never' --image  harbor.weiyigeek.top/library/mysql:8.0.30-debian-11-r15 --namespace database --env MYSQL_ROOT_PASSWORD=oX7xxIovng --command -- bash</span></span><br><span class=\"line\"><span class=\"comment\">--# mysql -h mysql-primary.database.svc -u app -p\"$MYSQL_PASSWORD\"</span></span><br><span class=\"line\">mysql -h mysql-secondary.database.svc -u app -p\"$MYSQL_PASSWORD\"</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2022/5/20220929110806.png\" alt=\"WeiyiGeek.主从验证实践图\" title=\"\" class=\"\">\n                <p>WeiyiGeek.主从验证实践图</p>\n            </figure>\n<p><br/></p>\n<p>步骤 07.查看<code>exporter</code>监控数据, 此处就不演示在Grafana在集群中MySQL资源监控, 如果想卸载安装的<code>MySQL</code>主从。<br>基于 mysqld-exporter 的 Grafana 模板 ：<a href=\"https://grafana.com/grafana/dashboards/7362\" target=\"_blank\" rel=\"noopener\">https://grafana.com/grafana/dashboards/7362</a><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 通过命令查看采集数据.</span></span><br><span class=\"line\">kubectl get --raw http://10.66.35.76:9104/metrics</span><br><span class=\"line\">kubectl get --raw http://10.66.53.95:9104/metrics</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 通过helm3卸载安装的mysql主从.</span></span><br><span class=\"line\">helm3 uninstall mysql --namespace database</span><br><span class=\"line\"><span class=\"comment\"># kubectl delete pod -n database `kubectl get pod -n database | awk 'NR&gt;1&#123;print $1&#125;'` --force</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除创建的名称空间, 注意删除名词空间时, 若有其他资源请谨慎执行如下命令。</span></span><br><span class=\"line\">kubectl patch ns database -p <span class=\"string\">'&#123;\"metadata\":&#123;\"finalizers\":null&#125;&#125;'</span></span><br><span class=\"line\">kubectl delete ns database --force</span><br></pre></td></tr></table></figure></p>\n<p>至此，在容器化环境中安装MySQL主从实践完毕。</p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"部署运维","path":"api/categories/部署运维.json"},{"name":"环境快速搭建","path":"api/categories/环境快速搭建.json"}],"tags":[{"name":"MySQL","path":"api/tags/MySQL.json"}]}