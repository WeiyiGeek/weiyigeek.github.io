<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ MYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="MYSQL">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
        
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/2018/1-1-1.html"  >
                <i class="icon icon-lg icon-mortar-board"></i>
                å­¦ä¹ ä¹‹è·¯
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>MYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">MYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-06-01T12:34:33.000Z" itemprop="datePublished" class="page-time">
  2019-06-01
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Database/">Database</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Database/DBA/">DBA</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Database/DBA/%E8%BF%90%E7%BB%B4/">è¿ç»´</a></li></ul></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap" style="display: none;">
  <article id="post-æ•°æ®å­˜å‚¨/Database-è¿ç»´/MySQL/è¿ç»´å®æˆ˜/MYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">MYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-06-01 20:34:33" datetime="2019-06-01T12:34:33.000Z"  itemprop="datePublished">2019-06-01</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Database/">Database</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Database/DBA/">DBA</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Database/DBA/%E8%BF%90%E7%BB%B4/">è¿ç»´</a></li></ul></li></ul></li></ul>



            

            


            
        </div>
        <span class="post-href" style="display: none;">|</span>
        <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
        
          <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½çœ‹å‹,æ¬¢è¿å…³æ³¨åšä¸»å¾®ä¿¡å…¬ä¼—å·å“Ÿ! â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘å³å¯å…³é—­ç»§ç»­æµè§ˆæ–‡ç« .<br>  <b style="color:red;"> æ¸©é¦¨æç¤º: æœªè§£é”çš„ç”¨æˆ·ä¸èƒ½ç²˜è´´å¤åˆ¶æ–‡ç« å†…å®¹å“Ÿ!</b> <br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
            
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h4 id="0x00-åˆ©ç”¨PHPå®ç°è¯»å†™åˆ†ç¦»"><a href="#0x00-åˆ©ç”¨PHPå®ç°è¯»å†™åˆ†ç¦»" class="headerlink" title="0x00 åˆ©ç”¨PHPå®ç°è¯»å†™åˆ†ç¦»"></a>0x00 åˆ©ç”¨PHPå®ç°è¯»å†™åˆ†ç¦»</h4><p>æè¿°ï¼šåœ¨åšPHPè¯»å†™åˆ†ç¦»å‰éœ€è¦æ‹¿åˆ°è¿ç»´éƒ¨é—¨ç»™å¥½çš„è¯»å†™æ•°æ®åº“çš„è¿æ¥åœ°å€,æå‰å®šä¹‰å¥½æ•°æ®åº“çš„æ“ä½œç±»ç¨‹åº,ç„¶åç¼–å†™å¼€å‘æ–‡æ¡£è®©æ‰€æœ‰çš„å¼€å‘åŒæ—¶éƒ½ç»Ÿä¸€è°ƒç”¨è¿™ä¸ªç±»æ¥æ‰§è¡ŒSQLè¯­å¥;</p>
<p>ç›®å‰è¦å®ç°mysqlçš„ä¸»ä»è¯»å†™åˆ†ç¦»ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ¡ˆï¼š</p>
<ul>
<li>æ–¹æ³•1ï¼šé€šè¿‡ç¨‹åºå®ç°ç¨‹åºåˆ¤æ–­SQLè¯­å¥(DQL-æ•°æ®æŸ¥è¯¢è¯­è¨€/DML-æ•°æ®æ“ä½œè¯­è¨€)æ¯”è¾ƒå¤æ‚ï¼Œå¦‚æœæ·»åŠ ä»æœåŠ¡å™¨è¦æ›´æ”¹å¤šå°æœåŠ¡å™¨çš„ä»£ç ã€‚</li>
<li>æ–¹æ³•2ï¼šè‡ªå·±å¼€å‘æ¥å£å®ç°é€šè¿‡è‡ªå†™ç±»è°ƒç”¨å®ç°(ä¼ å…¥å‚æ•°çš„æ–¹æ³•)ï¼Œè¿™ç§æ–¹æ¡ˆé—¨æ§›é«˜ï¼Œå¼€å‘æˆæœ¬é«˜ï¼Œä¸æ˜¯ä¸€èˆ¬çš„å°å…¬å¸èƒ½æ‰¿æ‹…å¾—èµ·ã€‚</li>
<li>æ–¹æ³•3ï¼šé€šè¿‡mysql-proxyæ¥å®ç°ï¼Œç”±äºmysql-proxyçš„ä¸»ä»è¯»å†™åˆ†ç¦»æ˜¯é€šè¿‡luaè„šæœ¬æ¥å®ç°ï¼Œç›®å‰luaçš„è„šæœ¬çš„å¼€å‘è·Ÿä¸ä¸ŠèŠ‚å¥ï¼Œè€Œå†™æ²¡æœ‰å®Œç¾çš„ç°æˆçš„è„šæœ¬ï¼Œå› æ­¤å¯¼è‡´ç”¨äºç”Ÿäº§ç¯å¢ƒçš„è¯é£é™©æ¯”è¾ƒå¤§ï¼Œæ®ç½‘ä¸Šå¾ˆå¤šäººè¯´mysql-proxyçš„æ€§èƒ½ä¸é«˜ã€‚</li>
<li>æ–¹æ³•4ï¼šä¸€äº›è¯»å†™åˆ†ç¦»çš„è½¯ä»¶æ¯”å¦‚amoeba</li>
</ul>
<p><a rel=MYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹ href="https://img.weiyigeek.top/2019/20190601124539.png" target="_blank" title="WeiyiGeek.æ‰§è¡Œæµç¨‹" data-fancybox="images"><img src="https://img.weiyigeek.top/2019/20190601124539.png" alt="WeiyiGeek.æ‰§è¡Œæµç¨‹"></a></p>
<p><em>æ–¹æ³•ä¼˜ç¼ºç‚¹</em>ï¼š</p>
<ul>
<li>æ–¹æ³•1ï¼š<ul>
<li>ä¼˜ç‚¹ï¼šå¼€å‘äººå‘˜æ— éœ€è‡ªè¡ŒåŒºåˆ†æ˜¯è¯»åº“è¿˜æ˜¯å†™åº“,ç¨‹åºæ ¹æ®SQLè¯­å¥è¿›è¡Œè‡ªåŠ¨é‰´åˆ«,ä»è€ŒåŒºåˆ†è¿æ¥;</li>
<li>ç¼ºç‚¹ï¼šéœ€è¦è¿›è¡ŒSQLè¯­å¥çš„å­—ç¬¦æˆªå–,å½±å“æ•ˆç‡;</li>
</ul>
</li>
<li>æ–¹æ³•2ï¼š<ul>
<li>ä¼˜ç‚¹ï¼šæ•ˆç‡é«˜,æ— éœ€æˆªå–å¤šä½™çš„å­—ç¬¦ä¸²è¿›è¡Œåˆ¤æ–­;</li>
<li>ç¼ºç‚¹ï¼šå¼€å‘äººå‘˜åœ¨å¼€å‘çš„æ—¶å€™å®¹æ˜“æŠŠè¯»åº“å½“ä½œå†™åº“æ¥æ“ä½œ,ç”±äºä¼ å…¥ç±»æ˜¯trueè¿˜æ˜¯false;</li>
</ul>
</li>
</ul>
<p>æ–¹æ³•1ï¼šä¼ªä»£ç <br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é¦–å…ˆå®šä¹‰è¯»åº“å’Œå†™åº“ï¼ˆè¿æ¥æ•°æ®åº“çš„è´¦æˆ·å¯†ç IPè¿™é‡Œä¸å®šä¹‰ï¼‰</span></span><br><span class="line">define(<span class="string">'IDATABASE'</span>,<span class="string">'INSERTDB'</span>); </span><br><span class="line">define(<span class="string">'SDATABASE'</span>,<span class="string">'SELECTDB'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç±»æ–¹æ³•</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">@ ä½œç”¨ï¼šæˆªå–SQLè¯­å¥çš„å­—ç¬¦ï¼Œä»è€Œåˆ¤æ–­è¿›è¡Œè¯»å†™åˆ†ç¦»</span></span><br><span class="line"><span class="comment">@ å‚æ•°ï¼šä¼ å…¥æ‰§è¡Œçš„SQLè¯­å¥</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">execute</span><span class="params">($sql)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $check_sql = strtolower(trim($sql)); <span class="comment">//å»æ‰ç©ºæ ¼é”®å­—ç¬¦ä¸²è½¬å˜ä¸ºç©ºæ ¼</span></span><br><span class="line">    <span class="keyword">if</span>(substr($check_sql,<span class="number">0</span>,<span class="number">6</span>)==<span class="string">'select'</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;getAll($sql); <span class="comment">//è¯»åº“</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;exec($sql);  <span class="comment">//å†™åº“</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ–¹æ³•2ï¼šä¼ªä»£ç <br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç±»ConnectMysql</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">@ åˆ©ç”¨å®ä¾‹åŒ–ç±»ä¼ å…¥çš„å‚æ•°è¿›è¡Œåˆ¤æ–­æ˜¯è¯»åº“è¿˜æ˜¯å†™åº“</span></span><br><span class="line"><span class="comment">@ __constructæ„é€ æ–¹æ³•ï¼šä¼ å…¥flagåˆ¤æ–­falseä¸ºè¯»,trueä¸ºå†™</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConnectMysql</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $flag = <span class="string">'false'</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($flag)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;flag=$flag;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;flag == <span class="string">'false'</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;DBselect();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;DBwrite();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr/>

<h4 id="0x01-amoebaæ¶æ„å®ç°è¯»å†™åˆ†ç¦»"><a href="#0x01-amoebaæ¶æ„å®ç°è¯»å†™åˆ†ç¦»" class="headerlink" title="0x01 amoebaæ¶æ„å®ç°è¯»å†™åˆ†ç¦»"></a>0x01 amoebaæ¶æ„å®ç°è¯»å†™åˆ†ç¦»</h4><h5 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1.ç®€ä»‹"></a>1.ç®€ä»‹</h5><p>Amoeba[è‹± /É™â€™miËbÉ™/]æ˜¯ä¸€ä¸ªä»¥MySQLä¸ºåº•å±‚æ•°æ®å­˜å‚¨ï¼Œå¹¶å¯¹åº”ç”¨æä¾›MySQLåè®®æ¥å£çš„proxy,Amoebaç›¸å½“äºä¸€ä¸ªSQLè¯·æ±‚çš„è·¯ç”±å™¨(è¿›è¡Œè½¬å‘è¯·æ±‚)ï¼Œå®ƒé›†ä¸­åœ°å“åº”åº”ç”¨çš„è¯·æ±‚ï¼Œä¾æ®ç”¨æˆ·äº‹å…ˆè®¾ç½®çš„è§„åˆ™ï¼Œå°†SQLè¯·æ±‚å‘é€åˆ°ç‰¹å®šçš„æ•°æ®åº“ä¸Šæ‰§è¡Œ,å¹¶ä¸”éœ€è¦ç»“åˆä½¿ç”¨MySQLçš„ Replicationç­‰æœºåˆ¶æ¥å®ç°å‰¯æœ¬åŒæ­¥ç­‰åŠŸèƒ½,åŸºäºæ­¤å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡ã€è¯»å†™åˆ†ç¦»ã€é«˜å¯ç”¨æ€§ç­‰éœ€æ±‚ï¼Œ</p>
<figure class="image-box">
                <a rel=MYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹ href="https://img.weiyigeek.top/2019/20190601134837.png" target="_blank" title="WeiyiGeek.amoebaæ‰§è¡Œæµç¨‹" data-fancybox="images"><img src="https://img.weiyigeek.top/2019/20190601134837.png" alt="WeiyiGeek.amoebaæ‰§è¡Œæµç¨‹" title="" class=""></a>
                <p>WeiyiGeek.amoebaæ‰§è¡Œæµç¨‹</p>
            </figure>
<p><em>Amoebaä½“ç³»æ¶æ„ï¼š</em><br><figure class="image-box">
                <a rel=MYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹ href="https://img.weiyigeek.top/2019/20190601134747.png" target="_blank" title="WeiyiGeek.amoebaæ¶æ„å›¾" data-fancybox="images"><img src="https://img.weiyigeek.top/2019/20190601134747.png" alt="WeiyiGeek.amoebaæ¶æ„å›¾" title="" class=""></a>
                <p>WeiyiGeek.amoebaæ¶æ„å›¾</p>
            </figure></p>
<p><em>ä¸ºä»€ä¹ˆè¦ç”¨Amoeba?</em><br>ç­”ï¼šåˆ©ç”¨é˜¿é‡Œå·´å·´çš„å¼€æºé¡¹ç›®Amoebaæ¥å®ç°ï¼Œå…·æœ‰è´Ÿè½½å‡è¡¡ã€é«˜å¯ç”¨æ€§ã€sqlè¿‡æ»¤ã€è¯»å†™åˆ†ç¦»ã€å¯è·¯ç”±ç›¸å…³çš„queryåˆ°ç›®æ ‡æ•°æ®åº“ï¼Œå¹¶ä¸”å®‰è£…é…ç½®éå¸¸ç®€å•</p>
<h5 id="2-ç¯å¢ƒéœ€æ±‚"><a href="#2-ç¯å¢ƒéœ€æ±‚" class="headerlink" title="2.ç¯å¢ƒéœ€æ±‚"></a>2.ç¯å¢ƒéœ€æ±‚</h5><p>å®‰è£…ç¯å¢ƒï¼š</p>
<ul>
<li>CentOS Linux release 7.6.1810 (Core)</li>
<li>JDK : Java SE Development Kit 8u211</li>
<li>MySQL : 8.0.16</li>
</ul>
<p>TIPS: #Amoebaæ¡†æ¶æ˜¯å±…äºJDK1.5å¼€å‘çš„ï¼Œé‡‡ç”¨äº†JDK1.5çš„ç‰¹æ€§ï¼Œæ‰€ä»¥è¿˜éœ€è¦å®‰è£…javaç¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨javaSE1.5ä»¥ä¸Šçš„JDKç‰ˆæœ¬</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>ç³»ç»ŸIP</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>MYSQL</td>
<td>192.168.1.100</td>
<td>å•æœºå¤šå®ä¾‹åŒ–3306/3307</td>
</tr>
<tr>
<td>Amoeba</td>
<td>192.168.1.101</td>
<td>Amoebaä¸»æœºå’ŒphpMyadminä¸»æœº</td>
</tr>
</tbody>
</table>
<p><strong>ç¯å¢ƒå®‰è£…</strong><br>Step1. MySQLå®‰è£…ä»¥åŠä¸»ä»å¤åˆ¶æ­å»º,è¿™é‡Œçœ‹å‰é¢çš„ä¸»ä»å¤šå®ä¾‹é…ç½®æ–‡ç« å³å¯;<br><figure class="image-box">
                <a rel=MYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹ href="https://img.weiyigeek.top/2019/20190601192019.png" target="_blank" title="WeiyiGeek.MYSQL8.0" data-fancybox="images"><img src="https://img.weiyigeek.top/2019/20190601192019.png" alt="WeiyiGeek.MYSQL8.0" title="" class=""></a>
                <p>WeiyiGeek.MYSQL8.0</p>
            </figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è§£å‹äºŒè¿›åˆ¶åŒ…</span></span><br><span class="line">xz -d mysql-8.0.16-linux-glibc2.12-x86_64.tar.xz </span><br><span class="line">tar xf mysql-8.0.16-linux-glibc2.12-x86_64.tar</span><br><span class="line"></span><br><span class="line"><span class="comment">#å»ºç«‹mysqlæ•°æ®åº“ç”¨æˆ·</span></span><br><span class="line">useradd mysq</span><br><span class="line"></span><br><span class="line"><span class="comment">#å»ºç«‹è½¯è¿æ¥</span></span><br><span class="line">ln -s /opt/mysql8/bin/* /usr/<span class="built_in">local</span>/bin/</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¤šå®ä¾‹ç›®å½•</span></span><br><span class="line">mkdir -vp /data/&#123;&#123;3307,3306&#125;/&#123;data,tmp,binlog,innodb_ts,innodb_log,undo&#125;,backup,scripts&#125;</span><br><span class="line">mkdir: å·²åˆ›å»ºç›®å½• <span class="string">"/data"</span></span><br><span class="line">mkdir: å·²åˆ›å»ºç›®å½• <span class="string">"/data/3307"</span></span><br><span class="line">mkdir: å·²åˆ›å»ºç›®å½• <span class="string">"/data/3307/data"</span></span><br><span class="line">mkdir: å·²åˆ›å»ºç›®å½• <span class="string">"/data/3307/tmp"</span></span><br><span class="line">mkdir: å·²åˆ›å»ºç›®å½• <span class="string">"/data/3307/binlog"</span></span><br><span class="line">mkdir: å·²åˆ›å»ºç›®å½• <span class="string">"/data/3307/innodb_ts"</span></span><br><span class="line"><span class="comment">#éå¸¸é‡è¦</span></span><br><span class="line">chown -R mysql:mysql /data</span><br><span class="line">chown -R mysql:mysql /opt/mysql8</span><br><span class="line"></span><br><span class="line"><span class="comment">#8.xå¤šå®ä¾‹ my.cnfé…ç½®</span></span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8   <span class="comment"># è®¾ç½®mysqlå®¢æˆ·ç«¯é»˜è®¤å­—ç¬¦é›†</span></span><br><span class="line">port = 3306</span><br><span class="line">socket = /data/3306/mysql.sock</span><br><span class="line"></span><br><span class="line"><span class="comment"># The MySQL server</span></span><br><span class="line">[mysqld]</span><br><span class="line">port = 3306</span><br><span class="line">mysqlx_port = 33060</span><br><span class="line">user = mysql</span><br><span class="line">server-id = 3306</span><br><span class="line">socket = /data/3306/mysql.sock</span><br><span class="line">mysqlx_socket=/data/3306/mysqlx.sock</span><br><span class="line">pid-file = /data/3306/mysql.pid</span><br><span class="line">basedir = /opt/mysql8/</span><br><span class="line">datadir = /data/3306/data</span><br><span class="line">tmpdir = /data/3306/tmp <span class="comment">#éå¿…é¡»</span></span><br><span class="line"><span class="built_in">log</span>-bin = /data/3306/binlog/mysql-bin  <span class="comment">#ä»åº“å»ºè®®å…³é—­log-bin</span></span><br><span class="line"><span class="built_in">log</span>-error = /data/3306/mysqlerror.log</span><br><span class="line">explicit_defaults_for_timestamp</span><br><span class="line">character-set-server=utf8  <span class="comment">#æœåŠ¡ç«¯é»˜è®¤å­—ç¬¦é›†</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆå§‹åŒ–å®ä¾‹ä¸å¯åŠ¨æ•°æ®åº“ï¼š</span></span><br><span class="line">mysqld --defaults-file=/data/3307/my.cnf --initialize --user=mysql --basedir=/opt/mysql8</span><br><span class="line">mysqld --defaults-file=/data/3306/my.cnf --initialize --user=mysql --basedir=/opt/mysql8</span><br><span class="line">mysqld_safe --defaults-file=/data/3306/my.cnf --user=mysql&amp;</span><br><span class="line">mysqld_safe --defaults-file=/data/3307/my.cnf --user=mysql&amp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#è´¦æˆ·å¯†ç åœ¨mysqlerror.log</span></span><br><span class="line">3306ï¼šroot@localhost: W=!_hK2qjlFl</span><br><span class="line">3307ï¼šroot@localhost: l7OuDBq_2zQj</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç«¯å£å¯åŠ¨éªŒè¯</span></span><br><span class="line">netstat -tlnp | grep <span class="string">"mysql"</span></span><br><span class="line">tcp6       0      0 :::3306                 :::*                    LISTEN      10402/mysqld</span><br><span class="line">tcp6       0      0 :::3307                 :::*                    LISTEN      10102/mysqld</span><br><span class="line">tcp6       0      0 :::33070                :::*                    LISTEN      10102/mysqld</span><br><span class="line">tcp6       0      0 :::33060                :::*                    LISTEN      10402/mysqld</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; ALTER USER USER() IDENTIFIED BY <span class="string">'/weiye!@#888'</span>;</span><br><span class="line">Query OK, 0 rows affected (0.20 sec)</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">##mysql 8.0 ä¸»ä»è´¦æˆ·</span></span><br><span class="line">CREATE USER <span class="string">'rep'</span>@<span class="string">'%'</span> IDENTIFIED WITH mysql_native_password BY <span class="string">'System123@'</span>; </span><br><span class="line">GRANT REPLICATION SLAVE ON *.* TO <span class="string">'rep'</span>@<span class="string">'%'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#è·å–ä¸»èŠ‚ç‚¹å½“å‰binary logæ–‡ä»¶åå’Œä½ç½®ï¼ˆpositionï¼‰- ä¸å†å¯¼å…¥ä»¥å‰çš„åº“</span></span><br><span class="line">MASTER&gt; SHOW MASTER STATUS;</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| mysql-bin.000002 |     1659 |              |                  |                   |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.09 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨ä»ï¼ˆSlaveï¼‰èŠ‚ç‚¹ä¸Šè®¾ç½®ä¸»èŠ‚ç‚¹å‚æ•° å¹¶å¯åŠ¨ä¸»ä»ï¼ˆä¸ç”¨å¯¼å…¥ä»¥å‰çš„åº“ï¼‰</span></span><br><span class="line">CHANGE MASTER TO MASTER_HOST=<span class="string">'192.168.1.100'</span>,</span><br><span class="line">MASTER_USER=<span class="string">'rep'</span>,</span><br><span class="line">MASTER_PASSWORD=<span class="string">'System123@'</span>,</span><br><span class="line">MASTER_LOG_FILE=<span class="string">'mysql-bin.000002'</span>,</span><br><span class="line">MASTER_LOG_POS=1659;</span><br><span class="line"><span class="comment">#å¼€å¯ä»åº“</span></span><br><span class="line">start slave;</span><br><span class="line"><span class="comment">#ä¸»ä»å¼€å¯æˆåŠŸ</span></span><br><span class="line">mysql&gt; show slave status\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master to send event</span><br><span class="line">                  Master_Host: 192.168.1.100</span><br><span class="line">                  Master_User: rep</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000002</span><br><span class="line">          Read_Master_Log_Pos: 1659</span><br><span class="line">               Relay_Log_File: mysql-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 322</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000002</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=MYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹ href="https://img.weiyigeek.top/2019/20190601212228.png" target="_blank" title="WeiyiGeek.æˆåŠŸç™»é™†" data-fancybox="images"><img src="https://img.weiyigeek.top/2019/20190601212228.png" alt="WeiyiGeek.æˆåŠŸç™»é™†" title="" class=""></a>
                <p>WeiyiGeek.æˆåŠŸç™»é™†</p>
            </figure>
<p>Step2. åœ¨Amoebaæœºå™¨ä¸Šå®‰è£…JDKåŠé…ç½®ç¯å¢ƒï¼š(CENTOS7å®‰è£…jdk)<br>ä¸‹è½½åœ°å€ï¼š<a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a></p>
<figure class="image-box">
                <a rel=MYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹ href="https://img.weiyigeek.top/2019/20190601191541.png" target="_blank" title="WeiyiGeek.JDK64ä½" data-fancybox="images"><img src="https://img.weiyigeek.top/2019/20190601191541.png" alt="WeiyiGeek.JDK64ä½" title="" class=""></a>
                <p>WeiyiGeek.JDK64ä½</p>
            </figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.ä¸‹è½½Linux x64	185.96 MB  	jdk-8u211-linux-x64.tar.gz ä¸Šä¼ åˆ°optç›®å½•å¹¶è§£å‹</span></span><br><span class="line"><span class="variable">$tar</span> -zxf jdk-8u211-linux-x64.tar.gz</span><br><span class="line"><span class="variable">$ls</span></span><br><span class="line">jdk1.8.0_211  jdk-8u211-linux-x64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.æ·»åŠ javaçš„ç¯å¢ƒå˜é‡(éå¸¸é‡è¦)å¹¶åˆ·æ–°ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="variable">$vi</span> /etc/profile </span><br><span class="line"></span><br><span class="line"><span class="comment">#Java Env</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/opt/jdk1.8.0_211</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ›´æ–°ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="variable">$source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.æŸ¥çœ‹JDKç‰ˆæœ¬(å¦‚æœä¸å­˜åœ¨æ‰§è¡Œæƒé™å°±æ·»åŠ )</span></span><br><span class="line">java -version</span><br><span class="line">java version <span class="string">"1.8.0_211"</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_211-b12)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.211-b12, mixed mode)</span><br></pre></td></tr></table></figure>
<p>Step3. å®‰è£…amoebaè½¯ä»¶(å·²ç»åœæ­¢å¼€å‘äº†-2013å¹´ç‰ˆæœ¬3.0.5)<br>ä¸‹è½½åœ°å€ï¼š<a href="https://datapacket.dl.sourceforge.net/project/amoeba/Amoeba%20for%20mysql/2.2.x/amoeba-mysql-binary-2.2.0.tar.gz" target="_blank" rel="noopener">https://datapacket.dl.sourceforge.net/project/amoeba/Amoeba%20for%20mysql/2.2.x/amoeba-mysql-binary-2.2.0.tar.gz</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$tar</span> -zxf amoeba-mysql-binary-2.2.0.tar.gz &amp;&amp; ll</span><br><span class="line">-rw-r--r--. 1 root root 3161433 6æœˆ   2 01:00 amoeba-mysql-binary-2.2.0.tar.gz</span><br><span class="line">drwxr-xr-x. 2 root root      63 6æœˆ   2 01:00 benchmark</span><br><span class="line">drwxr-xr-x. 2 root root     131 2æœˆ  29 2012 bin</span><br><span class="line">-rw-r--r--. 1 root root    3976 8æœˆ  29 2012 changelogs.txt</span><br><span class="line">drwxr-xr-x. 2 root root     243 6æœˆ   2 01:00 conf</span><br><span class="line">drwxr-xr-x. 3 root root    4096 6æœˆ   2 01:00 lib</span><br><span class="line">-rw-r--r--. 1 root root   34520 8æœˆ  29 2012 LICENSE.txt</span><br><span class="line">-rw-r--r--. 1 root root    2031 8æœˆ  29 2012 README.html</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="3-å®é™…æ¡ˆä¾‹"><a href="#3-å®é™…æ¡ˆä¾‹" class="headerlink" title="3.å®é™…æ¡ˆä¾‹"></a>3.å®é™…æ¡ˆä¾‹</h5><p>Step0. åˆ†åˆ«åœ¨ä¸»ä»åº“åˆ›å»ºmysqlproxyç”¨æˆ·<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER <span class="string">'mysqlproxy'</span>@<span class="string">'%'</span> IDENTIFIED WITH mysql_native_password BY <span class="string">'System123@'</span>; <span class="comment">#æ³¨æ„åŠ å¯†æ–¹å¼,ä¸åŠ é»˜è®¤æ˜¯ Authentication plugin 'caching_sha2_password</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸»åº“ï¼ˆæ’å…¥æµ‹è¯•æ•°æ®ï¼‰</span></span><br><span class="line">GRANT INSERT ON demo.* TO <span class="string">'mysqlproxy'</span>@<span class="string">'%'</span> ;</span><br><span class="line">mysql&gt; insert into demo.user value (1,<span class="string">'weiyigekk'</span>),(2,<span class="string">'k9s'</span>),(3,<span class="string">'docker'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä»åº“(æ‰§è¡Œ)</span></span><br><span class="line">GRANT select ON demo.* TO <span class="string">'mysqlproxy'</span>@<span class="string">'%'</span>;</span><br></pre></td></tr></table></figure></p>
<p>Step1. ä¿®æ”¹é…ç½®æ–‡ä»¶ dbServer.xml æ–‡ä»¶åœ¨ amoeba/conf/ç›®å½•ä¸‹<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ•°æ®åº“è¿æ¥é…ç½®çš„å…¬å…±éƒ¨åˆ† --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dbServer</span> <span class="attr">name</span>=<span class="string">"abstractServer"</span> <span class="attr">abstractive</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">factoryConfig</span> <span class="attr">class</span>=<span class="string">"com.meidusa.amoeba.mysql.net.MysqlServerConnectionFactory"</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"manager"</span>&gt;</span>$&#123;defaultManager&#125;<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sendBufferSize"</span>&gt;</span>64<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"receiveBufferSize"</span>&gt;</span>128<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                       <span class="comment">&lt;!-- mysql port ç«¯å£å· --&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"port"</span>&gt;</span>3306<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                       <span class="comment">&lt;!-- mysql schema amoeba è®¿é—®ä¸»ä»æ•°æ®åº“çœŸå®åº“--&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"schema"</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                       <span class="comment">&lt;!-- mysql user ä¸»ä»æ•°æ®åº“åˆ†é…ç»™Amoebaè®¿é—®æ•°æ®çš„ç”¨æˆ·å --&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span>&gt;</span>mysqlproxy<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                       <span class="comment">&lt;!--  mysql password ä¸»ä»æ•°æ®åº“åˆ†é…ç»™Amoebaè®¿é—®æ•°æ®çš„å¯†ç --&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span>System123@<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">               <span class="tag">&lt;/<span class="name">factoryConfig</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">poolConfig</span> <span class="attr">class</span>=<span class="string">"com.meidusa.amoeba.net.poolable.PoolableObjectPool"</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxActive"</span>&gt;</span>500<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdle"</span>&gt;</span>500<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minIdle"</span>&gt;</span>10<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minEvictableIdleTimeMillis"</span>&gt;</span>600000<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"timeBetweenEvictionRunsMillis"</span>&gt;</span>600000<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnBorrow"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testWhileIdle"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">poolConfig</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dbServer</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- Master çš„ç‹¬ç«‹éƒ¨åˆ†ï¼Œä¹Ÿå°±åªæœ‰ IP äº†è¿™é‡Œ å†™äº†ä¸»æœºå ç”±äºæˆ‘æ˜¯å•æœºå¤šå®ä¾‹æ‰€æœ‰å¡«å†™ä¸€æ ·çš„IP --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dbServer</span> <span class="attr">name</span>=<span class="string">"master"</span>  <span class="attr">parent</span>=<span class="string">"abstractServer"</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">factoryConfig</span>&gt;</span></span><br><span class="line">                       <span class="comment">&lt;!-- mysql ip --&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"ipAddress"</span>&gt;</span>192.168.1.100<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">factoryConfig</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dbServer</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- Slave çš„ç‹¬ç«‹éƒ¨åˆ†ï¼Œä¹Ÿå°±åªæœ‰ IP äº†è¿™é‡Œ å†™äº†ä¸»æœºå ,å¦‚æœæœ‰å¤šä¸ªSlaveæœåŠ¡å™¨ï¼Œå¯ä»¥é…ç½®å¤šä¸ªdbServer --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dbServer</span> <span class="attr">name</span>=<span class="string">"slave"</span>  <span class="attr">parent</span>=<span class="string">"abstractServer"</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">factoryConfig</span>&gt;</span></span><br><span class="line">                       <span class="comment">&lt;!-- mysql ip --&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"ipAddress"</span>&gt;</span>192.168.1.100<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">factoryConfig</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dbServer</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!-- æ•°æ®åº“æ± ï¼Œè™šæ‹ŸæœåŠ¡å™¨ï¼Œå®ç°è¯»å–çš„è´Ÿè½½å‡è¡¡ï¼Œå¦‚æœæœ‰å¤šä¸ªSlaveï¼Œåˆ™&lt;property name="poolNames"&gt;slave1,slave2&lt;/property&gt;ç”¨é€—å·éš”å¼€ --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dbServer</span> <span class="attr">name</span>=<span class="string">"slaves"</span> <span class="attr">virtual</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">poolConfig</span> <span class="attr">class</span>=<span class="string">"com.meidusa.amoeba.server.MultipleServerPool"</span>&gt;</span></span><br><span class="line">                       <span class="comment">&lt;!-- Load balancing strategy: 1=ROUNDROBIN , 2=WEIGHTBASED , 3=HA--&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"loadbalance"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                       <span class="comment">&lt;!-- Separated by commas,such as: server1,server2,server1 --&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"poolNames"</span>&gt;</span>slave<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">poolConfig</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dbServer</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Step2. ä¿®æ”¹amoeba.xmlæ–‡ä»¶ï¼Œè®¾ç½®è¯»å†™åˆ†ç¦»<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">proxy</span>&gt;</span></span><br><span class="line"></span><br><span class="line">               <span class="comment">&lt;!-- service class must implements com.meidusa.amoeba.service.Service --&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">service</span> <span class="attr">name</span>=<span class="string">"Amoeba for Mysql"</span> <span class="attr">class</span>=<span class="string">"com.meidusa.amoeba.net.ServerableConnectionManager"</span>&gt;</span></span><br><span class="line">                       <span class="comment">&lt;!-- Amoeba ç«¯å£å· ï¼Œå®¢æˆ·ç«¯client é“¾æ¥amoebaç«¯å£å·ï¼Œä¸èƒ½å’Œä¸»ä»æ•°æ®åº“ å†²çª--&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"port"</span>&gt;</span>8066<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                       <span class="comment">&lt;!-- bind ipAddress --&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"ipAddress"</span>&gt;</span>192.168.1.100<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       </span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"manager"</span>&gt;</span>$&#123;clientConnectioneManager&#125;<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span>&gt;</span></span><br><span class="line">                               <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.meidusa.amoeba.mysql.net.MysqlClientConnectionFactory"</span>&gt;</span></span><br><span class="line">                                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sendBufferSize"</span>&gt;</span>128<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"receiveBufferSize"</span>&gt;</span>64<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                               <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"authenticator"</span>&gt;</span></span><br><span class="line">                               <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.meidusa.amoeba.mysql.server.MysqlClientAuthenticator"</span>&gt;</span></span><br><span class="line">                                       <span class="comment">&lt;!-- Amoeba è´¦å· ï¼Œå®¢æˆ·ç«¯client é“¾æ¥amoebaç«¯ è´¦å·--&gt;</span></span><br><span class="line">                                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                                       <span class="comment">&lt;!-- Amoeba è´¦å· ï¼Œå®¢æˆ·ç«¯client é“¾æ¥amoebaç«¯ å¯†ç --&gt;</span></span><br><span class="line">                                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"filter"</span>&gt;</span></span><br><span class="line">                                               <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.meidusa.amoeba.server.IPAccessController"</span>&gt;</span></span><br><span class="line">                                                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"ipFile"</span>&gt;</span>$&#123;amoeba.home&#125;/conf/access_list.conf<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                                               <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">                                       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                               <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">               <span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br><span class="line"></span><br><span class="line">               <span class="comment">&lt;!-- server class must implements com.meidusa.amoeba.service.Service --&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">service</span> <span class="attr">name</span>=<span class="string">"Amoeba Monitor Server"</span> <span class="attr">class</span>=<span class="string">"com.meidusa.amoeba.monitor.MonitorServer"</span>&gt;</span></span><br><span class="line">                       <span class="comment">&lt;!-- port --&gt;</span></span><br><span class="line">                       <span class="comment">&lt;!--  default value: random number</span></span><br><span class="line"><span class="comment">                       &lt;property name="port"&gt;9066&lt;/property&gt;</span></span><br><span class="line"><span class="comment">                       --&gt;</span></span><br><span class="line">                       <span class="comment">&lt;!-- bind ipAddress --&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"ipAddress"</span>&gt;</span>192.168.1.100<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"daemon"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"manager"</span>&gt;</span>$&#123;clientConnectioneManager&#125;<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connectionFactory"</span>&gt;</span></span><br><span class="line">                               <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.meidusa.amoeba.monitor.net.MonitorClientConnectionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">               <span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br><span class="line"></span><br><span class="line">               <span class="tag">&lt;<span class="name">runtime</span> <span class="attr">class</span>=<span class="string">"com.meidusa.amoeba.mysql.context.MysqlRuntimeContext"</span>&gt;</span></span><br><span class="line">                       <span class="comment">&lt;!-- proxy server net IO Read thread size --&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"readThreadPoolSize"</span>&gt;</span>20<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                       <span class="comment">&lt;!-- proxy server client process thread size --&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"clientSideThreadPoolSize"</span>&gt;</span>30<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                       <span class="comment">&lt;!-- mysql server data packet process thread size --&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"serverSideThreadPoolSize"</span>&gt;</span>30<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                       <span class="comment">&lt;!-- per connection cache prepared statement size  --&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"statementCacheSize"</span>&gt;</span>500<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                       <span class="comment">&lt;!-- query timeout( default: 60 second , TimeUnit:second) --&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"queryTimeout"</span>&gt;</span>60<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">runtime</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;/<span class="name">proxy</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">               Each ConnectionManager will start as thread</span></span><br><span class="line"><span class="comment">               manager responsible for the Connection IO read , Death Detection</span></span><br><span class="line"><span class="comment">       --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">connectionManagerList</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">connectionManager</span> <span class="attr">name</span>=<span class="string">"clientConnectioneManager"</span> <span class="attr">class</span>=<span class="string">"com.meidusa.amoeba.net.MultiConnectionManagerWrapper"</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"subManagerClassName"</span>&gt;</span>com.meidusa.amoeba.net.ConnectionManager<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                       <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                         default value is avaliable Processors</span></span><br><span class="line"><span class="comment">                       &lt;property name="processors"&gt;5&lt;/property&gt;</span></span><br><span class="line"><span class="comment">                        --&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">connectionManager</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">connectionManager</span> <span class="attr">name</span>=<span class="string">"defaultManager"</span> <span class="attr">class</span>=<span class="string">"com.meidusa.amoeba.net.MultiConnectionManagerWrapper"</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"subManagerClassName"</span>&gt;</span>com.meidusa.amoeba.net.AuthingableConnectionManager<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                       <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                         default value is avaliable Processors</span></span><br><span class="line"><span class="comment">                       &lt;property name="processors"&gt;5&lt;/property&gt;</span></span><br><span class="line"><span class="comment">                        --&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">connectionManager</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">connectionManagerList</span>&gt;</span></span><br><span class="line"></span><br><span class="line">               <span class="comment">&lt;!-- default using file loader --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dbServerLoader</span> <span class="attr">class</span>=<span class="string">"com.meidusa.amoeba.context.DBServerConfigFileLoader"</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configFile"</span>&gt;</span>$&#123;amoeba.home&#125;/conf/dbServers.xml<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dbServerLoader</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">queryRouter</span> <span class="attr">class</span>=<span class="string">"com.meidusa.amoeba.mysql.parser.MysqlQueryRouter"</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"ruleLoader"</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.meidusa.amoeba.route.TableRuleFileLoader"</span>&gt;</span></span><br><span class="line">                               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"ruleFile"</span>&gt;</span>$&#123;amoeba.home&#125;/conf/rule.xml<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"functionFile"</span>&gt;</span>$&#123;amoeba.home&#125;/conf/ruleFunctionMap.xml<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlFunctionFile"</span>&gt;</span>$&#123;amoeba.home&#125;/conf/functionMap.xml<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"LRUMapSize"</span>&gt;</span>1500<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">               <span class="comment">&lt;!-- é»˜è®¤æ•°æ®åº“ï¼Œä¸»æ•°æ®åº“ --&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultPool"</span>&gt;</span>master<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!-- å†™æ•°æ®åº“ / è¯»æ•°æ®åº“ï¼ŒdbServer.xml ä¸­é…ç½®çš„ è™šæ‹Ÿæ•°æ®åº“ï¼Œæ•°æ®åº“æ±  --&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"writePool"</span>&gt;</span>master<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"readPool"</span>&gt;</span>slaves<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"needParse"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">queryRouter</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Step3. å¯åŠ¨amoebaå¯åŠ¨å¤±è´¥äº†ï¼ŒåŸå›  Amoeba å¯åŠ¨ æŒ‡å®šçš„å †æ ˆå¤§å°å¤ªå°,æŒ‡å®šè‡³å°‘228kï¼›<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">./amoeba</span><br><span class="line">The stack size specified is too small, Specify at least 228k</span><br><span class="line">Error: Could not create the Java Virtual Machine.</span><br><span class="line">Error: A fatal exception has occurred. Program will <span class="built_in">exit</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">#è§£å†³åŠæ³• ï¼š</span></span><br><span class="line">æ‰“å¼€bin/amoebaï¼ŒDEFAULT_OPTS=â€-server -Xms256m -Xmx256m -Xss128kâ€æ”¹æˆï¼šDEFAULT_OPTS=<span class="string">"-server -Xms512m -Xmx512m -Xmn100m -Xss1204k"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å†æ¬¡å¯åŠ¨</span></span><br><span class="line">./amoeba start</span><br><span class="line">log4j:WARN log4j config load completed from file:/opt/amoeba/conf/log4j.xml</span><br><span class="line">2019-06-02 01:08:48,521 INFO  context.MysqlRuntimeContext - Amoeba <span class="keyword">for</span> Mysql current versoin=5.1.45-mysql-amoeba-proxy-2.2.0</span><br><span class="line">log4j:WARN ip access config load completed from file:/opt/amoeba/conf/access_list.conf</span><br><span class="line">2019-06-02 01:08:49,517 INFO  net.ServerableConnectionManager - Amoeba <span class="keyword">for</span> Mysql listening on /192.168.1.101:8066.</span><br><span class="line">2019-06-02 01:08:49,522 INFO  net.ServerableConnectionManager - Amoeba Monitor Server listening on /192.168.1.101:39401.</span><br></pre></td></tr></table></figure></p>
<p>Step 4.è¯»å†™åˆ†ç¦»æµ‹è¯•<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åœ¨amoebaæœºå™¨ä¸Šæ‰§è¡Œ (æ³¨æ„amoebaå®¢æˆ·ç«¯ç«¯å£-åœ¨ä¸Šé¢çš„é…ç½®æ–‡ä»¶é‡Œé¢)</span></span><br><span class="line">mysql -h 192.168.1.101 -P8066 -uroot -proot</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 1186796719</span><br><span class="line">Server version: 5.1.45-mysql-amoeba-proxy-2.2.0  <span class="comment">#æ³¨æ„è§‚å¯Ÿè¿™é‡Œä¸ä¸€æ ·</span></span><br><span class="line"></span><br><span class="line">mysql&gt; insert into demo.user value(5,<span class="string">'zhangwei'</span>);</span><br><span class="line">Query OK, 1 row affected (0.10 sec)</span><br><span class="line"></span><br><span class="line">ä¸»ä»mysql&gt; select * from user;</span><br><span class="line">+----+-----------+</span><br><span class="line">| id | name      |</span><br><span class="line">+----+-----------+</span><br><span class="line">|  1 | weiyigekk |</span><br><span class="line">|  2 | k9s       |</span><br><span class="line">|  3 | docker    |</span><br><span class="line">|  5 | zhangwei  |</span><br><span class="line">+----+-----------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸‹é¢å…³é—­slave</span></span><br><span class="line">mysql&gt; stop slave;</span><br><span class="line">mysql&gt; insert into demo.user value(4,<span class="string">'this is slave insert'</span>);</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡‡ç”¨amoebaè¿›è¡Œè¯»å–</span></span><br><span class="line">MySQL [(none)]&gt; select * from demo.user;</span><br><span class="line">+----+----------------------+</span><br><span class="line">| id | name                 |</span><br><span class="line">+----+----------------------+</span><br><span class="line">|  1 | weiyigekk            |</span><br><span class="line">|  2 | k9s                  |</span><br><span class="line">|  3 | docker               |</span><br><span class="line">|  5 | zhangwei             |</span><br><span class="line">|  4 | this is slave insert |</span><br><span class="line">+----+----------------------+</span><br></pre></td></tr></table></figure><br><figure class="image-box">
                <a rel=MYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹ href="https://img.weiyigeek.top/2019/20190602012918.png" target="_blank" title="WeiyiGeek.mysql" data-fancybox="images"><img src="https://img.weiyigeek.top/2019/20190602012918.png" alt="WeiyiGeek.mysql" title="" class=""></a>
                <p>WeiyiGeek.mysql</p>
            </figure></p>
<hr/>

<h4 id="0x02-mysql-proxyå®ç°è¯»å†™åˆ†ç¦»"><a href="#0x02-mysql-proxyå®ç°è¯»å†™åˆ†ç¦»" class="headerlink" title="0x02 mysql-proxyå®ç°è¯»å†™åˆ†ç¦»"></a>0x02 mysql-proxyå®ç°è¯»å†™åˆ†ç¦»</h4><h5 id="1-ç®€ä»‹-1"><a href="#1-ç®€ä»‹-1" class="headerlink" title="1. ç®€ä»‹"></a>1. ç®€ä»‹</h5><p>å‰è¨€ï¼šåœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ç”±å•å°Mysqlä½œä¸ºç‹¬ç«‹çš„æ•°æ®åº“æ˜¯å®Œå…¨ä¸èƒ½æ»¡è¶³å®é™…éœ€æ±‚çš„æ— è®ºæ˜¯åœ¨å®‰å…¨æ€§ï¼Œé«˜å¯ç”¨æ€§ä»¥åŠé«˜å¹¶å‘ç­‰å„ä¸ªæ–¹é¢;<br>å¸¸å¸¸åœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸­é€šè¿‡ä¸»ä»å¤åˆ¶ï¼ˆMaster-Slaveï¼‰çš„æ–¹å¼æ¥åŒæ­¥æ•°æ®ï¼Œå†é€šè¿‡è¯»å†™åˆ†ç¦»ï¼ˆMySQL-Proxyï¼‰æ¥æå‡æ•°æ®åº“çš„å¹¶å‘è´Ÿè½½èƒ½åŠ›,å¸¸ä½¿ç”¨è¿™æ ·çš„æ–¹æ¡ˆæ¥è¿›è¡Œéƒ¨ç½²ä¸å®æ–½çš„ã€‚</p>
<p>MySQL-proxy æ˜¯é€šè¿‡ç½‘ç»œåˆ©ç”¨MySQLçš„ç½‘ç»œåè®®,å¹¶ä¸”æä¾›ä¸€ä¸ªæˆ–å¤šä¸ªMySQLæœåŠ¡å™¨ä¸ä¸€ä¸ªæˆ–å¤šä¸ªMySQLå®¢æˆ·ç«¯ç›¸äº’æ²Ÿé€šçš„ç¨‹åº,åˆå› ä¸ºMySQL-Proxyä½¿ç”¨MySQLç½‘ç»œåè®®,æ‰€ä»¥å®ƒå…¼å®¹ä»»ä½•MySQLå®¢æˆ·ç«¯å¹¶ä¸”æ— éœ€ä¿®æ”¹,å…¶åŠŸèƒ½ï¼š</p>
<ul>
<li>MySQL-Proxy å¯ä»¥åœ¨æŸ¥è¯¢é˜Ÿåˆ—å‘é€åˆ°æœåŠ¡å™¨ä¹‹å‰æ’å…¥ä¸€äº›æŸ¥è¯¢è¯·æ±‚</li>
<li>MySQL-Proxy å¯ä»¥åœ¨æœåŠ¡å™¨åº”ç­”ä¸­å°†å¯¹åº”çš„åº”ç­”åˆ é™¤</li>
<li>ç®¡ç†å‘˜å¯ä»¥å¯¹æ¯ä¸ªæŸ¥è¯¢è¿›è¡Œè·Ÿè¸ªå¹¶è·å–æŠ¥å‘Š,å¦‚ç›‘æ§å…¶æ‰§è¡Œæ—¶é—´æˆ–å…¶ä»–è°ƒè¯•ä¿¡æ¯,å¹¶åˆ†åˆ«è®°å½•,åŒæ—¶è¿˜èƒ½é™æ­£ç¡®åº”ç­”è¿”è¿˜ç»™å®¢æˆ·ç«¯ï¼š</li>
</ul>
<p>MySQL-Proxyçš„è¯»å†™åˆ†ç¦»ä¸»è¦æ˜¯é€šè¿‡luaè„šæœ¬å®ç°çš„å› æ­¤éœ€è¦å®‰è£…lua(åé¢ä¼šè¿›è¡Œç›¸åº”å®‰è£…çš„ä»‹ç»),å¹¶ä¸”ä»è®¾å®šä¸Šå°†luaåˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li>ä¸€ç±»è´Ÿè´£ç®¡ç†æ¨¡å—çš„æ§åˆ¶,å¯¹åº”å‚æ•°admin-lua-script</li>
<li>å¦ä¸€ç±»è´Ÿè´£ä»£ç†æ¨¡å—æ§åˆ¶,å¯¹åº”å‚æ•°proxy-lua-script<br>ä¸¤ç±»è„šæœ¬çš„ç¼–ç è§„åˆ™å®Œå…¨ç›¸åŒ,åªæ˜¯å¯¹åº”åŠŸèƒ½æœ‰å·®å¼‚,ç®¡ç†æ¨¡å—ä¾§é‡ä¸ä»£ç†æœåŠ¡å™¨ç›¸å…³çŠ¶æ€çš„æ§åˆ¶,ä»£ç†æ¨¡å—åˆ™ä¾§é‡äºå®¢æˆ·ç«¯çš„CRUDæ“ä½œ;</li>
</ul>
<p>TIPS: è²Œä¼¼åªæœ‰alphaç‰ˆæœ¬,å¯èƒ½ä¸ç¨³å®šä¸å»ºè®®åœ¨å®é™…ç¯å¢ƒä¸­ä½¿ç”¨;</p>
<hr>

<h5 id="2-å®‰è£…ç¯å¢ƒ"><a href="#2-å®‰è£…ç¯å¢ƒ" class="headerlink" title="2. å®‰è£…ç¯å¢ƒ"></a>2. å®‰è£…ç¯å¢ƒ</h5><p><em>ç¯å¢ƒå‡†å¤‡</em>ï¼š</p>
<ul>
<li>ç³»ç»Ÿï¼š</li>
<li>luaç‰ˆæœ¬: <a href="http://www.lua.org/ftp/lua-5.3.5.tar.gz" target="_blank" rel="noopener">http://www.lua.org/ftp/lua-5.3.5.tar.gz</a></li>
<li>mysql-proxyç‰ˆæœ¬ï¼š0.8.5 </li>
</ul>
<p><a rel=MYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹ href="https://img.weiyigeek.top/2019/20190602183824.png" target="_blank" title="WeiyiGeek." data-fancybox="images"><img src="https://img.weiyigeek.top/2019/20190602183824.png" alt="WeiyiGeek."></a></p>
<p><em>åœºæ™¯æè¿°ï¼š</em></p>
<ul>
<li>192.168.1.100:3306/3307ï¼šæ•°æ®åº“Masterä¸»æœåŠ¡å™¨/Slaveä»æœåŠ¡å™¨</li>
<li>192.168.1.101:4040/4041ï¼šMySQL-Proxyè°ƒåº¦æœåŠ¡å™¨ï¼ˆå®¢æˆ·ç«¯/ç®¡ç†ç«¯ï¼‰ </li>
</ul>
<p><a rel=MYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹ href="https://img.weiyigeek.top/2019/20190602180508.png" target="_blank" title="WeiyiGeek.åœºæ™¯æ¥æ”¶" data-fancybox="images"><img src="https://img.weiyigeek.top/2019/20190602180508.png" alt="WeiyiGeek.åœºæ™¯æ¥æ”¶"></a></p>
<p><strong>ç¯å¢ƒå®‰è£…ï¼š</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1. MySQL-Proxyä¸Šå®‰è£…æ‰€éœ€è½¯ä»¶åŒ…</span></span><br><span class="line">yum install -y gcc* gcc-c++* autoconf* automake* zlib* libxml* ncurses-devel* libmcrypt* libtool* flex* pkgconfig* libevent* glib* readline-devel*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#2. ç¼–è¯‘å®‰è£…LUA</span></span><br><span class="line"><span class="comment">#ä»http://www.lua.org/download.htmlä¸‹è½½æºç åŒ…å¹¶å®‰è£…</span></span><br><span class="line">wget http://www.lua.org/ftp/lua-5.3.5.tar.gz -O /opt/</span><br><span class="line">tar -zxf lua-5.3.5.tar.gz &amp;&amp; <span class="built_in">cd</span> lua-5.3.5</span><br><span class="line">make linux &amp;&amp; make install  <span class="comment">#æ³¨æ„å‘ç”Ÿé”™è¯¯çš„å…ˆæ‰§è¡Œmake clean ç¼–è¯‘è¿‡ç¨‹ä¸­é—ç•™çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment"># make[1]: è¿›å…¥ç›®å½•â€œ/opt/lua-5.3.5/srcâ€</span></span><br><span class="line"><span class="comment"># make all SYSCFLAGS="-DLUA_USE_LINUX" SYSLIBS="-Wl,-E -ldl -lreadline"</span></span><br><span class="line"><span class="comment"># make[2]: è¿›å…¥ç›®å½•â€œ/opt/lua-5.3.5/srcâ€</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#3. ä¸‹è½½mysql-proxyçš„äºŒè¿›åˆ¶åŒ…è§£å‹å¹¶å¤åˆ¶</span></span><br><span class="line">wget https://downloads.mysql.com/archives/get/file/mysql-proxy-0.8.5-linux-glibc2.3-x86-64bit.tar.gz</span><br><span class="line">tar -zxf mysql-proxy-0.8.5-linux-glibc2.3-x86-64bit.tar.gz</span><br><span class="line">mv mysql-proxy-0.8.5-linux-glibc2.3-x86-64bit/ mysql-proxy/</span><br><span class="line"><span class="built_in">cd</span> mysql-proxy</span><br><span class="line">mkdir lua logs  <span class="comment">#åˆ›å»ºè„šæœ¬å­˜æ”¾ç›®å½•/ä¸æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">cp share/doc/mysql-proxy/rw-splitting.lua ./lua/</span><br><span class="line">cp share/doc/mysql-proxy/admin-sql.lua ./lua/</span><br></pre></td></tr></table></figure><br><br/><br>Step 3. é…ç½®ä¿®æ”¹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.åˆ›å»ºé…ç½®æ–‡ä»¶</span></span><br><span class="line">vi /etc/mysql-proxy.cnf   <span class="comment">#åˆ›å»ºé…ç½®æ–‡ä»¶</span></span><br><span class="line">[mysql-proxy]</span><br><span class="line">user=root </span><br><span class="line"><span class="comment">#è¿è¡Œmysql-proxyç”¨æˆ·</span></span><br><span class="line">admin-username=admin </span><br><span class="line"><span class="comment">#ä¸»ä»mysqlå…±æœ‰çš„ç”¨æˆ·</span></span><br><span class="line">admin-password=admin</span><br><span class="line"><span class="comment">#ç”¨æˆ·çš„å¯†ç </span></span><br><span class="line">proxy-address=192.168.1.101:4040</span><br><span class="line"><span class="comment">#mysql-proxyè¿è¡Œipå’Œç«¯å£ï¼Œä¸åŠ ç«¯å£ï¼Œé»˜è®¤4040 ip:port</span></span><br><span class="line">proxy-read-only-backend-addresses=192.168.1.100:3307</span><br><span class="line"><span class="comment">#æŒ‡å®šåç«¯ä»slaveè¯»å–æ•°æ® ip:port ï¼ˆç®€å†™  -rï¼‰</span></span><br><span class="line">proxy-backend-addresses=192.168.1.100:3306 </span><br><span class="line"><span class="comment">#æŒ‡å®šåç«¯ä¸»masterå†™å…¥æ•°æ® ï¼ˆç®€å†™  -bï¼‰</span></span><br><span class="line">proxy-lua-script=/opt/mysql-proxy/lua/rw-splitting.lua</span><br><span class="line"><span class="comment">#æŒ‡å®šè¯»å†™åˆ†ç¦»é…ç½®æ–‡ä»¶ä½ç½®</span></span><br><span class="line">admin-lua-script=/opt/mysql-proxy/lua/admin-sql.lua</span><br><span class="line"><span class="comment">#æŒ‡å®šç®¡ç†è„šæœ¬</span></span><br><span class="line"><span class="built_in">log</span>-file=/opt/mysql-proxy/logs/mysql-proxy.log </span><br><span class="line"><span class="comment">#æ—¥å¿—ä½ç½®</span></span><br><span class="line"><span class="built_in">log</span>-level=info</span><br><span class="line"><span class="comment">#å®šä¹‰logæ—¥å¿—çº§åˆ«ï¼Œç”±é«˜åˆ°ä½åˆ†åˆ«æœ‰(error|warning|info|message|debug)</span></span><br><span class="line">pid-file=/opt/mysql-proxy/mysql-proxy.pid</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.ä¿®æ”¹è¯»å†™åˆ†ç¦»è„šæœ¬//ä¿®æ”¹é»˜è®¤è¿æ¥ï¼Œè¿›è¡Œå¿«é€Ÿæµ‹è¯•ï¼Œä¸ä¿®æ”¹çš„è¯è¦è¾¾åˆ°è¿æ¥æ•°ä¸º4æ—¶æ‰å¯ç”¨è¯»å†™åˆ†ç¦»</span></span><br><span class="line"><span class="variable">$vi</span> /opt/mysql-proxy/lua/rw-splitting.lua </span><br><span class="line"><span class="keyword">if</span> not proxy.global.config.rwsplit <span class="keyword">then</span></span><br><span class="line">        proxy.global.config.rwsplit = &#123;</span><br><span class="line">                min_idle_connections = 1, <span class="comment">##é»˜è®¤è¶…è¿‡4ä¸ªè¿æ¥æ•°æ—¶ï¼Œæ‰å¼€å§‹è¯»å†™åˆ†ç¦»æ”¹ä¸º1</span></span><br><span class="line">                max_idle_connections = 1, <span class="comment">#é»˜è®¤ä¸º8</span></span><br><span class="line">                is_debug = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.æ‰‹åŠ¨å¯ç”¨å¹¶ä¸”éªŒè¯æ˜¯å¦å¯ç”¨</span></span><br><span class="line">chmod 600 /etc/mysql-proxy.cnf </span><br><span class="line">/opt/mysql-proxy/bin/mysql-proxy --defaults-file=/etc/mysql-proxy.cnf</span><br><span class="line"><span class="comment">#æ”¯æŒçš„é€‰é¡¹</span></span><br><span class="line"><span class="comment"># --daemon \ //å®šä¹‰ä»¥å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼å¯åŠ¨</span></span><br><span class="line"><span class="comment"># --keepalive \ //ä½¿è¿›ç¨‹åœ¨å¼‚å¸¸å…³é—­åèƒ½å¤Ÿè‡ªåŠ¨æ¢å¤</span></span><br><span class="line"><span class="comment"># --pid-file=$PROXY_PID \ //å®šä¹‰mysql-proxy PIDæ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment"># --user=mysql \ //ä»¥mysqlç”¨æˆ·èº«ä»½å¯åŠ¨æœåŠ¡</span></span><br><span class="line"><span class="comment"># --log-level=warning \ //å®šä¹‰logæ—¥å¿—çº§åˆ«ï¼Œç”±é«˜åˆ°ä½åˆ†åˆ«æœ‰(error|warning|info|message|debug)</span></span><br><span class="line"><span class="comment"># --log-file=/opt/mysql-proxy/log/mysql-proxy.log //å®šä¹‰logæ—¥å¿—æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"></span><br><span class="line">netstat -tupln | grep 4040 <span class="comment">#å·²ç»å¯åŠ¨</span></span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        0      0 192.168.1.101:4040      0.0.0.0:*               LISTEN      10767/mysql-proxy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">killall -9 mysql-proxy <span class="comment">#å…³é—­mysql-proxyä½¿ç”¨</span></span><br></pre></td></tr></table></figure></p>
<p><br/><br>4.æˆ–è€…åˆ›å»ºmysql-proxyæœåŠ¡ç®¡ç†è„šæœ¬<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">$vi &#x2F;etc&#x2F;init.d&#x2F;mysql-proxy</span><br><span class="line">#!&#x2F;bin&#x2F;sh</span><br><span class="line"># mysql-proxy This script starts and stops the mysql-proxy daemon</span><br><span class="line"># chkconfig: - 78 30</span><br><span class="line"># processname: mysql-proxy</span><br><span class="line"># description: mysql-proxy is a proxy daemon to mysql</span><br><span class="line"># Source function library.</span><br><span class="line">. &#x2F;etc&#x2F;rc.d&#x2F;init.d&#x2F;functions</span><br><span class="line"></span><br><span class="line">#å®šä¹‰mysql-proxyæœåŠ¡äºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„ </span><br><span class="line">PROXY_PATH&#x3D;&#x2F;opt&#x2F;mysql-proxy&#x2F;bin</span><br><span class="line">prog&#x3D;&quot;mysql-proxy&quot;</span><br><span class="line"></span><br><span class="line"># Source networking configuration.</span><br><span class="line">. &#x2F;etc&#x2F;sysconfig&#x2F;network</span><br><span class="line"># Check that networking is up.</span><br><span class="line">#[ $&#123;NETWORKING&#125; &#x3D;&#x3D; &quot;no&quot; ] &amp;&amp; exit 0</span><br><span class="line"></span><br><span class="line">#è®¾ç½®é»˜è®¤mysql-proxyé€‰é¡¹(ä¹Ÿå¯ä»¥é‡‡ç”¨é…ç½®æ–‡ä»¶çš„å½¢å¼ -bä¸ºmater -r æŒ‡å®šslave) </span><br><span class="line">PROXY_OPTIONS&#x3D;&quot;--log-level&#x3D;info \</span><br><span class="line">--plugins&#x3D;proxy -b 192.168.1.100:3306 -r 192.168.1.100:3307 \</span><br><span class="line">--proxy-lua-script&#x3D;&#x2F;opt&#x2F;mysql-proxy&#x2F;lua&#x2F;rw-splitting.lua \</span><br><span class="line">--plugins&#x3D;admin \</span><br><span class="line">--admin-username&#x3D;admin \</span><br><span class="line">--admin-password&#x3D;admin \</span><br><span class="line">--admin-lua-script&#x3D;&#x2F;opt&#x2F;mysql-proxy&#x2F;lib&#x2F;mysql-proxy&#x2F;lua&#x2F;admin.lua&quot;</span><br><span class="line"></span><br><span class="line">#pidæ–‡ä»¶è·¯å¾„</span><br><span class="line">PROXY_PID&#x3D;&#x2F;opt&#x2F;mysql-proxy&#x2F;mysql-proxy.pid</span><br><span class="line"></span><br><span class="line"># Source mysql-proxy configuration.</span><br><span class="line">if [ -f &#x2F;etc&#x2F;sysconfig&#x2F;mysql-proxy ]; then</span><br><span class="line">        . &#x2F;etc&#x2F;sysconfig&#x2F;mysql-proxy</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">PATH&#x3D;$PATH:&#x2F;usr&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;bin:$PROXY_PATH</span><br><span class="line"># By default it&#39;s all good</span><br><span class="line">RETVAL&#x3D;0</span><br><span class="line"></span><br><span class="line"># See how we were called.</span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">  start)</span><br><span class="line">        # Start daemon.</span><br><span class="line">        echo -n $&quot;Starting $prog: &quot;</span><br><span class="line">        $NICELEVEL $PROXY_PATH&#x2F;mysql-proxy $PROXY_OPTIONS --daemon --pid-file&#x3D;$PROXY_PID --user&#x3D;mysql</span><br><span class="line">        RETVAL&#x3D;$?</span><br><span class="line">        echo</span><br><span class="line">        if [ $RETVAL &#x3D; 0 ]; then</span><br><span class="line">                touch &#x2F;var&#x2F;lock&#x2F;subsys&#x2F;mysql-proxy</span><br><span class="line">        fi</span><br><span class="line">       ;;</span><br><span class="line"></span><br><span class="line">  stop)</span><br><span class="line">        # Stop daemons.</span><br><span class="line">        echo -n $&quot;Stopping $prog: &quot;</span><br><span class="line">        killproc $prog</span><br><span class="line">        RETVAL&#x3D;$?</span><br><span class="line">        echo</span><br><span class="line">        if [ $RETVAL &#x3D; 0 ]; then</span><br><span class="line">                rm -f &#x2F;var&#x2F;lock&#x2F;subsys&#x2F;mysql-proxy</span><br><span class="line">                rm -f $PROXY_PID</span><br><span class="line"></span><br><span class="line">        fi</span><br><span class="line">       ;;</span><br><span class="line">  restart)</span><br><span class="line">        $0 stop</span><br><span class="line">        sleep 3</span><br><span class="line">        $0 start</span><br><span class="line">       ;;</span><br><span class="line"></span><br><span class="line">  condrestart)</span><br><span class="line">       [ -e &#x2F;var&#x2F;lock&#x2F;subsys&#x2F;mysql-proxy ] &amp;&amp; $0 restart</span><br><span class="line">      ;;</span><br><span class="line"></span><br><span class="line">  status)</span><br><span class="line">        status mysql-proxy</span><br><span class="line">        RETVAL&#x3D;$?</span><br><span class="line">       ;;</span><br><span class="line">  *)</span><br><span class="line"></span><br><span class="line">        echo &quot;Usage: $0 &#123;start|stop|restart|status|condrestart&#125;&quot;</span><br><span class="line">        RETVAL&#x3D;1</span><br><span class="line">       ;;</span><br><span class="line">esac</span><br><span class="line">exit $RETVAL</span><br></pre></td></tr></table></figure><br><br></p>
<h5 id="3-æ“ä½œå®ä¾‹"><a href="#3-æ“ä½œå®ä¾‹" class="headerlink" title="3. æ“ä½œå®ä¾‹"></a>3. æ“ä½œå®ä¾‹</h5><p>mysql-proxyè¯»å†™åˆ†ç¦»çš„æµç¨‹æ­¥éª¤ï¼š<br>å½“åœ¨mysql-proxyæ’å…¥æ•°æ®æ—¶å†™å…¥åˆ°äº†masterä¸Š,æŸ¥è¯¢æ•°æ®æ˜¯ä»slaveä¸ŠæŸ¥çœ‹æ’å…¥ä¸»åº“æ•°æ®,åœæ­¢ä¸»ä»åå½“åœ¨slaveä¸Šæ’å…¥æ•°æ®ï¼Œåœ¨mysql-proxyä¸Šå¯ä»¥çœ‹åˆ°,åˆ™è¯´æ˜è¯»æ˜¯ä»slaveä¸Šï¼Œå†™æ˜¯åœ¨masterä¸Šã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.å¯åŠ¨nysql-proxyå’Œèµ‹å€¼æƒé™</span></span><br><span class="line">chmod 755 /etc/init.d/mysql-proxy</span><br><span class="line">chmod 600 /etc/mysql-proxy.cnf</span><br><span class="line">/etc/init.d/mysql-proxy start</span><br><span class="line">/etc/init.d/mysql-proxy status</span><br><span class="line"><span class="comment"># â— mysql-proxy.service - SYSV: mysql-proxy is a proxy daemon to mysql</span></span><br><span class="line"><span class="comment">#    Loaded: loaded (/etc/rc.d/init.d/mysql-proxy; bad; vendor preset: disabled)</span></span><br><span class="line"><span class="comment">#    Active: active (running) since æ—¥ 2019-06-02 21:29:00 CST; 2s ago</span></span><br><span class="line"></span><br><span class="line">netstat -tlnp</span><br><span class="line"><span class="comment"># Active Internet connections (only servers)</span></span><br><span class="line"><span class="comment"># Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span></span><br><span class="line"><span class="comment"># tcp        0      0 0.0.0.0:4040            0.0.0.0:*               LISTEN      12741/mysql-proxy</span></span><br><span class="line"><span class="comment"># tcp        0      0 0.0.0.0:4041            0.0.0.0:*               LISTEN      12741/mysql-proxy</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.ç™»å½•ä¸»åº“å»ºç«‹ä¸€ä¸ªtestç”¨æˆ·ä»æ•°æ®åº“ä¸­æš‚æ—¶å…³é—­ä¸»ä»å¤åˆ¶çš„åŠŸèƒ½</span></span><br><span class="line">%         | <span class="built_in">test</span>             | mysql_native_password |  <span class="comment">#æ³¨æ„è®¤è¯æ’ä»¶</span></span><br><span class="line">mysql&gt; grant select on *.* to <span class="string">'test'</span>@<span class="string">'%'</span>;  <span class="comment">#ä»åº“åœ¨åœæ­¢ä¸»ä»å‰æ‰§è¡Œ</span></span><br><span class="line">mysql&gt; stop slave;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">mysql&gt;flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#3. ç™»å½•mysql-porxyç®¡ç†æ®µä¸»ä»æŸ¥çœ‹çŠ¶æ€ï¼ˆä¸/opt/mysql-proxy/lua/rw-splitting.lua é…ç½®æ–‡ä»¶æœ‰å…³ï¼‰</span></span><br><span class="line">MySQL [(none)]&gt; SELECT * FROM <span class="built_in">help</span>;</span><br><span class="line">+------------------------+------------------------------------+</span><br><span class="line">| <span class="built_in">command</span>                | description                        |</span><br><span class="line">+------------------------+------------------------------------+</span><br><span class="line">| SELECT * FROM <span class="built_in">help</span>     | shows this <span class="built_in">help</span>                    |</span><br><span class="line">| SELECT * FROM backends | lists the backends and their state |</span><br><span class="line">+------------------------+------------------------------------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; SELECT * FROM backends;  <span class="comment">#æœ‰å¯èƒ½éœ€è¦ç™»å½•æœ‰å¤šä¸ªç»ˆç«¯æ‰èƒ½è§¦å‘ä»åº“up</span></span><br><span class="line">+-------------+--------------------+-------+------+------+-------------------+</span><br><span class="line">| backend_ndx | address            | state | <span class="built_in">type</span> | uuid | connected_clients |</span><br><span class="line">+-------------+--------------------+-------+------+------+-------------------+</span><br><span class="line">|           1 | 192.168.1.100:3306 | up    | rw   | NULL |                 1 |</span><br><span class="line">|           2 | 192.168.1.100:3307 | up    | ro   | NULL |                 1 |</span><br><span class="line">+-------------+--------------------+-------+------+------+-------------------+</span><br><span class="line"><span class="comment"># upï¼šè¡¨ç¤ºè¯»å†™åˆ†ç¦»ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="comment"># unKnownï¼šè¿˜æ²¡ç”Ÿæ•ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#4.è¿æ¥è¿æ¥MySQL-Proxyå¹¶ä¸”æ’å…¥æ•°æ®åˆ°ä¸»åº“ï¼ˆæ³¨æ„è¿™é‡Œæ˜¯æ•°æ®åº“çš„è´¦å·å¯†ç ï¼‰</span></span><br><span class="line"><span class="variable">$mysql</span> -h 192.168.1.101 -P 4040 -utest -pweiye!@<span class="comment">#888</span></span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 22</span><br><span class="line">Server version: 8.0.16 MySQL Community Server - GPL</span><br><span class="line"></span><br><span class="line"><span class="variable">$MySQL</span> [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| demo               |</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| phpmyadmin         |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">6 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.12 sec)</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; use demo</span><br><span class="line">MySQL [demo]&gt; insert into user value (10,<span class="string">'mysql-proxy-insert'</span>);</span><br><span class="line">Query OK, 1 row affected (0.12 sec)</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=MYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹ href="https://img.weiyigeek.top/2019/20190602213619.png" target="_blank" title="WeiyiGeek.mysql-proxy-write" data-fancybox="images"><img src="https://img.weiyigeek.top/2019/20190602213619.png" alt="WeiyiGeek.mysql-proxy-write" title="" class=""></a>
                <p>WeiyiGeek.mysql-proxy-write</p>
            </figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#4.ç™»å½•ä¸»åº“æŸ¥çœ‹ä»MySQL-proxyæ’å…¥åˆ°çš„æ•°æ®,å†ç™»å½•ä»åº“æ’å…¥ä¸€æ¡æ•°æ®,ç„¶ååœ¨MySQL-proxyä¸­æŸ¥çœ‹</span></span><br><span class="line">mysql&gt; insert into user value (11,<span class="string">'SLAVE INSERT - MYSQL-PROXY-READ'</span>);</span><br><span class="line">Query OK, 1 row affected (0.09 sec)</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=MYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹ href="https://img.weiyigeek.top/2019/20190602221810.png" target="_blank" title="WeiyiGeek.mysql-proxy-read" data-fancybox="images"><img src="https://img.weiyigeek.top/2019/20190602221810.png" alt="WeiyiGeek.mysql-proxy-read" title="" class=""></a>
                <p>WeiyiGeek.mysql-proxy-read</p>
            </figure>
<p><br/></p>
<h5 id="4-å…¥å‘"><a href="#4-å…¥å‘" class="headerlink" title="4. å…¥å‘"></a>4. å…¥å‘</h5><p><strong>é—®é¢˜1ï¼šç¼–è¯‘luaæ—¶å€™å‡ºç° lua.c:82:31: è‡´å‘½é”™è¯¯ï¼šreadline/readline.hï¼šæ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;readline/readline.h&gt;</span></span><br><span class="line">è§£å†³ï¼šå®‰è£…</span><br><span class="line">yum install libtermcap-devel ncurses-devel libevent-devel readline-devel</span><br></pre></td></tr></table></figure><br><br><br><strong>é—®é¢˜2ï¼šç™»å½•mysql-proxyç®¡ç†æ®µæŸ¥çœ‹åˆ°ä»åº“çŠ¶æ€ä¸ºunkownï¼Ÿ</strong><br>åŸå› ï¼šç”±äºæ²¡æœ‰è¾¾åˆ°è¯»å†™åˆ†ç¦»è¿æ¥æ•°é™åˆ¶;<br>è§£å†³æ–¹æ³•ï¼šå¤šç™»å½•å‡ ä¸ªmysql-proxyç»ˆç«¯è¿›è¡ŒæŸ¥è¯¢å’Œæ’å…¥å³å¯å°†çŠ¶æ€è½¬å˜æˆä¸ºup;</p>

        </div>
        
        <!-- Google å¹¿å‘Š -->
          

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2023-01-31T02:29:07.993Z" itemprop="dateUpdated">2023-01-31 10:29:07</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/æ•°æ®å­˜å‚¨/Database-è¿ç»´/MySQL/è¿ç»´å®æˆ˜/MYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹.md" target="_blank" rel="noopener noreferrer">_posts/æ•°æ®å­˜å‚¨/Database-è¿ç»´/MySQL/è¿ç»´å®æˆ˜/MYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2019/6-1-88.html" target="_blank" rel="external">https://blog.weiyigeek.top/2019/6-1-88.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MYSQL/" rel="tag">MYSQL</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/6-1-88.html&title=ã€ŠMYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/6-1-88.html&title=ã€ŠMYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/6-1-88.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠMYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/6-1-88.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/6-1-88.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/6-3-76.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">VNCè¿œç¨‹è¿æ¥æœåŠ¡å®‰è£…ä¸é…ç½®</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/6-1-119.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">è¿ç»´ä¹‹LAMPç¯å¢ƒå®‰è£…ä¸é…ç½®</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x00-åˆ©ç”¨PHPå®ç°è¯»å†™åˆ†ç¦»"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 åˆ©ç”¨PHPå®ç°è¯»å†™åˆ†ç¦»</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x01-amoebaæ¶æ„å®ç°è¯»å†™åˆ†ç¦»"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 amoebaæ¶æ„å®ç°è¯»å†™åˆ†ç¦»</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#0x02-mysql-proxyå®ç°è¯»å†™åˆ†ç¦»"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 mysql-proxyå®ç°è¯»å†™åˆ†ç¦»</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    

    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="/img/share-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2023 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>

<div id="go" class="waves-effect waves-light">
  <a href="javascript:;" id="goqrcode"> <span class="icon icon-lg icon-qrcode"></span> </a>
  <a href="javascript:;" id="gotop"> <span class="icon icon-lg icon-chevron-up"></span></a>
</div>





<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2019/6-1-88.html&title=ã€ŠMYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2019/6-1-88.html&title=ã€ŠMYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹ã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2019/6-1-88.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠMYSQLæ•°æ®åº“è¯»å†™åˆ†ç¦»å®ä¾‹ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2019/6-1-88.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2019/6-1-88.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACH0lEQVR42u3aO27EMAwFwL3/pZ02TbzviXYAy6MqWPjDccGIFD+feB3x+uv69i2fOxYGBsZjGW1Yv385D2JyVx4bBgbGexh/ZbDza84TZfT6mPQlZgwMDIzTa9o0naRgDAwMjAnjPL2uFajnHwIDAwMjL2LX2nBrpBtrcQwMjAcy8q77//99y/kGBgbGoxhHuSbU/Al1VBgYGFsz8gSXNM7yoPOtYfEEDAyMFzCS0jFpkM0xa79gYGDszVgrHfNAk8PLhBRtNzEwMLZj5E38yfhFC6uPMDEwMF7AaF+/9sq2cC0+KwYGxssY8+ZXMpx68UgrBgbG1oy1nVXbepsfBtyyQcTAwHgIo21y5SXufQefX9ptGBgYL2BMNohtKTtJstGYBQYGxkaM/JV5C2x+b/ERMTAwtmaMat+lhl1SAE/AGBgYezOOYK013aIvF7ftPu0jMDAwHs5Iwp0kzfngV7RNxMDA2JrRJtBrDzjbUbBocgQDA2NrRnvbeTJtU3l+fTQzgoGBsTUjaai111xVvhY9QgwMjE0Z+QBEG9bi6UQbJwYGxqaMo1xtiZsPfp1vFr/8Y8DAwNiaMU92k/GIdjhjnrIxMDCey1hreF1712SrioGB8R7GWhsub5MVAZXlMQYGBkbOmODXRjcwMDAwJiNceaJsj0i/FLEYGBhbM5JytC04J+m1PgTFwMDYmpGXju0vVxW9lx1kYmBgPI/xA4qRvCp4SEz9AAAAAElFTkSuQmCC" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  





<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// ç«™ç‚¹è¿è¡Œæ—¶é—´
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + "å¤©" + RunHours + "æ—¶" + RunMinutes + "åˆ†" + RunSeconds + "ç§’";
  document.getElementById(id).innerHTML = "ç½‘ç«™å·²åœ¨é£é›¨ä¸­å‹‰å‹‰å¼ºå¼ºè¿è¡Œäº†ã€" + RunTime + "ã€‘";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
</body>
</html>