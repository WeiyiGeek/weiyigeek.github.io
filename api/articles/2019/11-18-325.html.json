{"title":"2.PS编程入门基础语法","slug":"编程世界/Powershell/Program/2.PS编程入门基础语法","date":"2019-11-18T12:56:50.000Z","updated":"2023-01-31T02:29:10.671Z","url":"2019/11-18-325.html","path":"api/articles/2019/11-18-325.html.json","covers":["https://img.weiyigeek.top/2021/1/20210418134530.png","https://img.weiyigeek.top/2021/1/20210418142143.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h2 id=\"0x05-流-Flow-控制\"><a href=\"#0x05-流-Flow-控制\" class=\"headerlink\" title=\"0x05 流(Flow)控制\"></a>0x05 流(Flow)控制</h2><p>描述: 当你从编写 PowerShell 单行命令转为编写脚本时，实际复杂程度没有想象的那么高。脚本只是在 PowerShell 控制台中以交互方式运行的相同或类似命令，只不过它们保存为 .PS1 文件;</p>\n<h3 id=\"0-条件判断\"><a href=\"#0-条件判断\" class=\"headerlink\" title=\"0.条件判断\"></a>0.条件判断</h3><h4 id=\"Where-Object-语句\"><a href=\"#Where-Object-语句\" class=\"headerlink\" title=\"Where-Object 语句\"></a>Where-Object 语句</h4><p>描述: Where-Object会对集合逐个过滤，将符合条件的结果保留, 别名是 <code>?</code>  与 <code>Where</code>。</p>\n<p>基础示例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.根据notepad进程名过滤所有记事本进程。</span></span><br><span class=\"line\">Get-Process | Where-Object &#123;<span class=\"variable\">$_</span>.Name -eq <span class=\"string\">\"notepad\"</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># Handles  NPM(K)    PM(K)      WS(K) VM(M)   CPU(s)     Id ProcessName</span></span><br><span class=\"line\">  <span class=\"comment\"># -------  ------    -----      ----- -----   ------     -- -----------</span></span><br><span class=\"line\">  <span class=\"comment\">#     158       7     8800      37264   114    18.41   6204 notepad</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.根据company过滤所有产品发布者以”Microsoft”打头的进程：</span></span><br><span class=\"line\">Get-Process | Where-Object &#123;<span class=\"variable\">$_</span>.company -like <span class=\"string\">'*Microsoft*'</span> &#125; | select Name,Description,Company</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.因为Where-Object的使用概率比较高，所以有一个很形象的别名 ？ 可以使用：</span></span><br><span class=\"line\">Get-Service | ? &#123;<span class=\"variable\">$_</span>.Name -like <span class=\"string\">\"B*\"</span>&#125;</span><br><span class=\"line\">Get-Service | <span class=\"built_in\">where</span> &#123;<span class=\"variable\">$_</span>.Name -like <span class=\"string\">\"B*\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.输出可以被2整除的值(满足则输出), 或者两者同时满足</span></span><br><span class=\"line\">1..10 | ? &#123; <span class=\"variable\">$_</span> % 2 -eq 0 &#125;</span><br><span class=\"line\">  <span class=\"comment\"># 2</span></span><br><span class=\"line\">  <span class=\"comment\"># 4</span></span><br><span class=\"line\">  <span class=\"comment\"># 6</span></span><br><span class=\"line\">  <span class=\"comment\"># 8</span></span><br><span class=\"line\">  <span class=\"comment\"># 10</span></span><br><span class=\"line\">1..10 | <span class=\"built_in\">where</span> &#123; <span class=\"variable\">$_</span> % 2 -eq 0 -and <span class=\"variable\">$_</span> % 4 -eq 0 &#125;</span><br><span class=\"line\">  <span class=\"comment\"># 4</span></span><br><span class=\"line\">  <span class=\"comment\"># 8</span></span><br></pre></td></tr></table></figure></p>\n<p>Tips : 通过<code>Get-Alias -Definition Where-Object</code>利用cmdlet查看其别名</p>\n<p><br></p>\n<h4 id=\"IF-语句\"><a href=\"#IF-语句\" class=\"headerlink\" title=\"IF 语句\"></a>IF 语句</h4><p><strong>if…else 与 if…elseif…else 语句</strong></p>\n<p>基础示例:<br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.单条件判断</span></span><br><span class=\"line\"><span class=\"variable\">$week</span>=(<span class=\"built_in\">Get-Date</span>).DayOfWeek</span><br><span class=\"line\"><span class=\"keyword\">if</span> ( <span class=\"variable\">$week</span> <span class=\"nomarkup\">-eq</span> <span class=\"string\">'Thursday'</span> ) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">Write-Output</span> <span class=\"string\">\"今天是星期四(Thur),当前时间:\"</span></span><br><span class=\"line\">  <span class=\"built_in\">Get-Date</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">Write-Output</span> <span class=\"string\">\"今天不是星期四\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.多条件判断</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> ( <span class=\"variable\">$week</span> <span class=\"nomarkup\">-eq</span> <span class=\"string\">'Monday'</span> ) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">Write-Output</span> <span class=\"string\">\"unhappy,今天是星期1\"</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">elseif</span> ( <span class=\"variable\">$week</span> <span class=\"nomarkup\">-eq</span> <span class=\"string\">'Thesday'</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">Write-Output</span> <span class=\"string\">\"unhappy,今天是星期2\"</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">elseif</span> ( <span class=\"variable\">$week</span> <span class=\"nomarkup\">-eq</span> <span class=\"string\">'Wednesday'</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">Write-Output</span> <span class=\"string\">\"unhappy,今天是星期3\"</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">elseif</span> ( <span class=\"variable\">$week</span> <span class=\"nomarkup\">-eq</span> <span class=\"string\">'Thursday'</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">Write-Output</span> <span class=\"string\">\"unhappy,今天是星期4\"</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">elseif</span> ( <span class=\"variable\">$week</span> <span class=\"nomarkup\">-eq</span> <span class=\"string\">'Friday'</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">Write-Output</span> <span class=\"string\">\"unhappy,今天是星期5\"</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">elseif</span> ( <span class=\"variable\">$week</span> <span class=\"nomarkup\">-eq</span> <span class=\"string\">'Saturday'</span>) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">Write-Output</span> <span class=\"string\">\"Happy,今天是星期6\"</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">Write-Output</span> <span class=\"string\">\"Happy,今天是星期天\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h4 id=\"Switch-判断语句\"><a href=\"#Switch-判断语句\" class=\"headerlink\" title=\"Switch 判断语句\"></a>Switch 判断语句</h4><p><strong>基础示例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 方式1.满足条件输出</span></span><br><span class=\"line\"><span class=\"variable\">$value</span>=6</span><br><span class=\"line\">switch(<span class=\"variable\">$value</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  1 &#123;<span class=\"string\">\"I come from Beijing\"</span>&#125;</span><br><span class=\"line\">  2 &#123;<span class=\"string\">\"I come from Shanghai\"</span>&#125;</span><br><span class=\"line\">  3 &#123;<span class=\"string\">\"I come from Tianjin\"</span>&#125;</span><br><span class=\"line\">  6 &#123;<span class=\"string\">\"I come from Chongqing\"</span>&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  <span class=\"comment\"># I come from Chongqing</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方式2.测试取值范围</span></span><br><span class=\"line\"><span class=\"comment\"># 自定义将条件放在花括号中，必须保证条件表达式的返回值为布尔类型”$True”或”$False”</span></span><br><span class=\"line\"><span class=\"variable\">$value</span>=18</span><br><span class=\"line\">switch(<span class=\"variable\">$value</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &#123;<span class=\"variable\">$_</span> -lt 10&#125; &#123;<span class=\"string\">\"小于10\"</span>&#125;</span><br><span class=\"line\">  10  &#123;<span class=\"string\">\"等于10\"</span>&#125;</span><br><span class=\"line\">  &#123;<span class=\"variable\">$_</span>  -gt 10&#125; &#123;<span class=\"string\">\"大于10\"</span>&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  <span class=\"comment\">#输出</span></span><br><span class=\"line\">  <span class=\"comment\">#大于10</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方式3.没有匹配条件时,我们需要使用Default关键字</span></span><br><span class=\"line\"><span class=\"variable\">$value</span>=-7</span><br><span class=\"line\"><span class=\"comment\"># 使用 Switch 测试取值范围</span></span><br><span class=\"line\">switch(<span class=\"variable\">$value</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &#123;(<span class=\"variable\">$_</span> -lt 10) -and ( <span class=\"variable\">$_</span> -gt 0) &#125;  &#123;<span class=\"string\">\"小于10\"</span>&#125;</span><br><span class=\"line\">    10  &#123;<span class=\"string\">\"等于10\"</span>&#125;</span><br><span class=\"line\">    &#123;<span class=\"variable\">$_</span>  -gt 10&#125; &#123;<span class=\"string\">\"大于10\"</span>&#125;</span><br><span class=\"line\">    Default &#123;<span class=\"string\">\"没有匹配条件\"</span>&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  <span class=\"comment\"># 没有匹配条件</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 如果case中有多个条件匹配，那么每个匹配的条件都会进行处理，所以我们需要使用Break关键字</span></span><br><span class=\"line\"><span class=\"variable\">$value</span>=99</span><br><span class=\"line\">switch(<span class=\"variable\">$value</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &#123;<span class=\"variable\">$_</span> -lt 5 &#125;   &#123; <span class=\"string\">\"小于5\"</span>; <span class=\"built_in\">break</span>&#125;</span><br><span class=\"line\">  &#123;<span class=\"variable\">$_</span> -gt 0 &#125;   &#123; <span class=\"string\">\"大于0\"</span>; <span class=\"built_in\">break</span>&#125;</span><br><span class=\"line\">  &#123;<span class=\"variable\">$_</span> -lt 100&#125;  &#123; <span class=\"string\">\"小于100\"</span>; <span class=\"built_in\">break</span>&#125;</span><br><span class=\"line\">  Default &#123;<span class=\"string\">\"没有匹配条件\"</span>&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  <span class=\"comment\"># 大于0</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方式4.比较字符串(大小写敏感/通配符/正则匹配)</span></span><br><span class=\"line\"><span class=\"comment\"># 即大小写敏感比较字符串</span></span><br><span class=\"line\"><span class=\"variable\">$domain</span>=<span class=\"string\">\"Www.weiyigeek.top\"</span></span><br><span class=\"line\">switch -<span class=\"keyword\">case</span> (<span class=\"variable\">$domain</span>) </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"Www.weiyigeek.top\"</span> &#123;<span class=\"string\">\"Ok 1\"</span>&#125;</span><br><span class=\"line\">  <span class=\"string\">\"www.weiyiGeek.com\"</span> &#123;<span class=\"string\">\"Ok 2\"</span> &#125;</span><br><span class=\"line\">  <span class=\"string\">\"WWW.weiyiGeegk.COM\"</span> &#123;<span class=\"string\">\"Ok 3\"</span>&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#使用通配符</span></span><br><span class=\"line\"><span class=\"variable\">$domain</span>=<span class=\"string\">\"www.mossfly.com\"</span></span><br><span class=\"line\">switch -wildcard(<span class=\"variable\">$domain</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"*\"</span>     &#123;<span class=\"string\">\"匹配'*'\"</span>&#125;</span><br><span class=\"line\">  <span class=\"string\">\"*.com\"</span> &#123;<span class=\"string\">\"匹配*.top\"</span> &#125;</span><br><span class=\"line\">  <span class=\"string\">\"*.*.*\"</span> &#123;<span class=\"string\">\"匹配*.*.*\"</span>&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$mail</span>=<span class=\"string\">\"master@weiyigeek.top\"</span></span><br><span class=\"line\"><span class=\"comment\">#使用通配符</span></span><br><span class=\"line\">switch -regex (<span class=\"variable\">$mail</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"^master\"</span>     &#123;<span class=\"string\">\"master\"</span>&#125;</span><br><span class=\"line\">  <span class=\"string\">\"top$\"</span>     &#123;<span class=\"string\">\"top结尾\"</span> &#125;</span><br><span class=\"line\">  <span class=\"string\">\"d&#123;1,3&#125;.d&#123;1,3&#125;.d&#123;1,3&#125;.d&#123;1,3&#125;\"</span> &#123;<span class=\"string\">\"IP地址\"</span>&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">  <span class=\"comment\">#www打头</span></span><br><span class=\"line\">  <span class=\"comment\">#com结尾</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方式5.Switch支持对集合所有元素进行匹配,例如使用 Switch语句演示打印水仙花数(即该数得每个数的三次方只和=该数)</span></span><br><span class=\"line\"><span class=\"variable\">$value</span>=100..999</span><br><span class=\"line\">switch(<span class=\"variable\">$value</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    [Math]::Pow(<span class=\"variable\">$_</span>%10,3) + [Math]::Pow( [Math]::Truncate(<span class=\"variable\">$_</span>%100/10) ,3) + [Math]::Pow( [Math]::Truncate(<span class=\"variable\">$_</span>/100) , 3) -eq <span class=\"variable\">$_</span></span><br><span class=\"line\">  &#125; &#123;<span class=\"variable\">$_</span>&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">#153</span></span><br><span class=\"line\"><span class=\"comment\">#370</span></span><br><span class=\"line\"><span class=\"comment\">#371</span></span><br><span class=\"line\"><span class=\"comment\">#407</span></span><br></pre></td></tr></table></figure></p>\n<hr>\n<h3 id=\"1-循环执行\"><a href=\"#1-循环执行\" class=\"headerlink\" title=\"1.循环执行\"></a>1.循环执行</h3><p>描述: PowerShell 优势是确定了如何为某个项执行某些操作后，就可以很容易地为数百个项执行相同的任务。 只需使用 PowerShell 中多种不同类型的循环之一循环访问这些项即可。</p>\n<h4 id=\"ForEach-Object-语句\"><a href=\"#ForEach-Object-语句\" class=\"headerlink\" title=\"ForEach-Object 语句\"></a>ForEach-Object 语句</h4><p>描述: ForEach-Object 是用于循环访问管道中的项的 cmdlet，例如使用 PowerShell 单行命令然后通过管道流式处理对象。其实是ForEach-Object可以接受三个脚本块用于管道的流模式处理，分别代表<code>begin，process和end</code>。</p>\n<p><strong>基础示例:</strong><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 方式1.采用 ForEach-Object 循环处理</span></span><br><span class=\"line\">WeiyiGeek&gt; <span class=\"number\">1</span>..<span class=\"number\">10</span> | <span class=\"built_in\">ForEach-Object</span> &#123; <span class=\"built_in\">Write-Host</span> -NoNewline <span class=\"string\">\"当前 <span class=\"variable\">$_</span> 次序 -&gt;\"</span>; <span class=\"variable\">$_</span> * <span class=\"number\">10</span>&#125;</span><br><span class=\"line\">当前 <span class=\"number\">1</span> 次序 -&gt;<span class=\"number\">10</span></span><br><span class=\"line\">当前 <span class=\"number\">2</span> 次序 -&gt;<span class=\"number\">20</span></span><br><span class=\"line\">当前 <span class=\"number\">3</span> 次序 -&gt;<span class=\"number\">30</span></span><br><span class=\"line\">当前 <span class=\"number\">4</span> 次序 -&gt;<span class=\"number\">40</span></span><br><span class=\"line\">当前 <span class=\"number\">5</span> 次序 -&gt;<span class=\"number\">50</span></span><br><span class=\"line\">当前 <span class=\"number\">6</span> 次序 -&gt;<span class=\"number\">60</span></span><br><span class=\"line\">当前 <span class=\"number\">7</span> 次序 -&gt;<span class=\"number\">70</span></span><br><span class=\"line\">当前 <span class=\"number\">8</span> 次序 -&gt;<span class=\"number\">80</span></span><br><span class=\"line\">当前 <span class=\"number\">9</span> 次序 -&gt;<span class=\"number\">90</span></span><br><span class=\"line\">当前 <span class=\"number\">10</span> 次序 -&gt;<span class=\"number\">100</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方式2.在下面的情形中，如果我想通过管道将两个字符串按值传递到 Get-Command 以便与 Module 参数一起使用，则需要使用 ForEach-Object cmdlet。</span></span><br><span class=\"line\"><span class=\"string\">'ActiveDirectory'</span>, <span class=\"string\">'SQLServer'</span>  |</span><br><span class=\"line\">   <span class=\"built_in\">ForEach-Object</span> &#123;<span class=\"built_in\">Get-Command</span> -Module <span class=\"variable\">$_</span>&#125; |</span><br><span class=\"line\">     <span class=\"built_in\">Group-Object</span> -Property ModuleName -NoElement |</span><br><span class=\"line\">         <span class=\"built_in\">Sort-Object</span> -Property Count -Descending</span><br><span class=\"line\"><span class=\"comment\"># Count Name</span></span><br><span class=\"line\"><span class=\"comment\"># ----- ----</span></span><br><span class=\"line\"><span class=\"comment\">#   147 ActiveDirectory</span></span><br><span class=\"line\"><span class=\"comment\">#    82 SqlServer</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">'Get-ComputerInfo'</span>, <span class=\"string\">'Test-Path'</span>  |</span><br><span class=\"line\">  <span class=\"built_in\">ForEach-Object</span> &#123;<span class=\"built_in\">Get-Command</span> -Name <span class=\"variable\">$_</span>&#125; |</span><br><span class=\"line\">    <span class=\"built_in\">Group-Object</span> -Property ModuleName -NoElement |</span><br><span class=\"line\">      <span class=\"built_in\">Sort-Object</span> -Property Count -Descending</span><br><span class=\"line\"><span class=\"comment\"># Count Name</span></span><br><span class=\"line\"><span class=\"comment\"># ----- ----</span></span><br><span class=\"line\"><span class=\"comment\">#     2 Microsoft.PowerShell.M...</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方式3.采用 % 以及别名进行使用处理</span></span><br><span class=\"line\"><span class=\"number\">1</span>..<span class=\"number\">5</span> | % &#123; <span class=\"built_in\">Write-Host</span> -NoNewline <span class=\"string\">\"第&#123;<span class=\"variable\">$_</span>&#125;次时间:\"</span>; <span class=\"built_in\">Get-Date</span>;<span class=\"built_in\">Start-Sleep</span> <span class=\"number\">1</span> &#125;</span><br><span class=\"line\">  <span class=\"comment\"># 第&#123;1&#125;次时间:</span></span><br><span class=\"line\">  <span class=\"comment\"># 2021年4月1日 16:58:55</span></span><br><span class=\"line\">  <span class=\"comment\"># 第&#123;2&#125;次时间:2021年4月1日 16:58:56</span></span><br><span class=\"line\">  <span class=\"comment\"># 第&#123;3&#125;次时间:2021年4月1日 16:58:57</span></span><br><span class=\"line\">  <span class=\"comment\"># 第&#123;4&#125;次时间:2021年4月1日 16:58:58</span></span><br><span class=\"line\">  <span class=\"comment\"># 第&#123;5&#125;次时间:2021年4月1日 16:58:59</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方式4.采用 foreach 别名进行使用处理</span></span><br><span class=\"line\"><span class=\"keyword\">foreach</span> ( <span class=\"variable\">$a</span> <span class=\"keyword\">in</span> <span class=\"number\">1</span>..<span class=\"number\">3</span>) &#123; <span class=\"keyword\">foreach</span> ( <span class=\"variable\">$b</span> <span class=\"keyword\">in</span> <span class=\"number\">1</span>..<span class=\"number\">3</span>) &#123; <span class=\"built_in\">Write-Host</span> -NoNewline <span class=\"string\">\"<span class=\"variable\">$a</span> + <span class=\"variable\">$b</span> = \"</span>; <span class=\"variable\">$a</span> + <span class=\"variable\">$B</span> &#125; &#125;</span><br><span class=\"line\">  <span class=\"comment\"># 1 + 1 = 2</span></span><br><span class=\"line\">  <span class=\"comment\"># 1 + 2 = 3</span></span><br><span class=\"line\">  <span class=\"comment\"># 1 + 3 = 4</span></span><br><span class=\"line\">  <span class=\"comment\"># 2 + 1 = 3</span></span><br><span class=\"line\">  <span class=\"comment\"># 2 + 2 = 4</span></span><br><span class=\"line\">  <span class=\"comment\"># 2 + 3 = 5</span></span><br><span class=\"line\">  <span class=\"comment\"># 3 + 1 = 4</span></span><br><span class=\"line\">  <span class=\"comment\"># 3 + 2 = 5</span></span><br><span class=\"line\">  <span class=\"comment\"># 3 + 3 = 6</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">foreach</span> (<span class=\"variable\">$Computer</span> <span class=\"keyword\">in</span> <span class=\"string\">'DC01'</span>, <span class=\"string\">'WEB01'</span>) &#123;</span><br><span class=\"line\">  Get-ADComputer -Identity <span class=\"variable\">$Computer</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方式5.逐个处理所有管道结果(个性化- 值得学习类似于print %s 占位符)</span></span><br><span class=\"line\">ls | <span class=\"built_in\">ForEach-Object</span> &#123;<span class=\"string\">\"文件名：&#123;0&#125; 文件大小&#123;1&#125;KB: \"</span> -f <span class=\"variable\">$_</span>.Name,(<span class=\"variable\">$_</span>.length/<span class=\"number\">1</span>kb).tostring()&#125;</span><br><span class=\"line\">文件名：a.html 文件大小<span class=\"number\">65.99609375</span>KB:</span><br><span class=\"line\">文件名：a.txt 文件大小<span class=\"number\">25.765625</span>KB:</span><br><span class=\"line\">文件名：alias 文件大小<span class=\"number\">11.77734375</span>KB:</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h4 id=\"For-语句\"><a href=\"#For-语句\" class=\"headerlink\" title=\"For 语句\"></a>For 语句</h4><p>描述: 当指定的条件为 true 时，for 循环会进行循环访问，在PS中应该使用较少。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># (1) 在前面的示例中，循环从数字 1 开始循环访问 4 次，并在计数器变量 $i 小于 5 时继续循环访问。 </span></span><br><span class=\"line\"><span class=\"comment\"># 休眠时间共计 10 秒。</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"variable\">$i</span> = 1; <span class=\"variable\">$i</span> -lt 5; <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">  Write-Output <span class=\"string\">\"Sleeping for <span class=\"variable\">$i</span> seconds\"</span></span><br><span class=\"line\">  Start-Sleep -Seconds <span class=\"variable\">$i</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h4 id=\"Do-语句\"><a href=\"#Do-语句\" class=\"headerlink\" title=\"Do 语句\"></a>Do 语句</h4><p>描述: PowerShell 中有两个不同的 do 循环。 </p>\n<ul>\n<li>指定的条件为 false 时, Do Until 运行。</li>\n<li>指定的条件为 True 时, Do While 运行</li>\n</ul>\n<figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># (1) 数字游戏，在你猜测的值等于 Get-Random cmdlet 生成的相同数字时游戏结束。</span></span><br><span class=\"line\"><span class=\"variable\">$number</span> = <span class=\"built_in\">Get-Random</span> -Minimum <span class=\"number\">1</span> -Maximum <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">  <span class=\"variable\">$guess</span> = <span class=\"built_in\">Read-Host</span> -Prompt <span class=\"string\">\"What's your guess?\"</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"variable\">$guess</span> <span class=\"nomarkup\">-lt</span> <span class=\"variable\">$number</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Write-Output</span> <span class=\"string\">'Too low!'</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">elseif</span> (<span class=\"variable\">$guess</span> <span class=\"nomarkup\">-gt</span> <span class=\"variable\">$number</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Write-Output</span> <span class=\"string\">'Too high!'</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">until</span> (<span class=\"variable\">$guess</span> <span class=\"nomarkup\">-eq</span> <span class=\"variable\">$number</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2) 只通过将测试条件反转为不等于，使用 Do While 循环可实现相同的结果。</span></span><br><span class=\"line\"><span class=\"variable\">$number</span> = <span class=\"built_in\">Get-Random</span> -Minimum <span class=\"number\">1</span> -Maximum <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">  <span class=\"variable\">$guess</span> = <span class=\"built_in\">Read-Host</span> -Prompt <span class=\"string\">\"What's your guess?\"</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"variable\">$guess</span> <span class=\"nomarkup\">-lt</span> <span class=\"variable\">$number</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Write-Output</span> <span class=\"string\">'Too low!'</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">elseif</span> (<span class=\"variable\">$guess</span> <span class=\"nomarkup\">-gt</span> <span class=\"variable\">$number</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Write-Output</span> <span class=\"string\">'Too high!'</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">while</span> (<span class=\"variable\">$guess</span> <span class=\"nomarkup\">-ne</span> <span class=\"variable\">$number</span>)</span><br></pre></td></tr></table></figure>\n<p>Tips ： Do 循环始终运行至少一次，因为将在循环结束时计算条件的结果。</p>\n<p><br></p>\n<h4 id=\"While-语句\"><a href=\"#While-语句\" class=\"headerlink\" title=\"While 语句\"></a>While 语句</h4><p>描述: 与 Do While 循环类似，只要指定的条件为 true，While 循环就会运行。 但差别在于 While 循环会在运行任何代码之前，计算循环顶部条件的结果, 如果条件计算结果为 false，它就不会运行代码块中的内容。 </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.使用案例</span></span><br><span class=\"line\"><span class=\"variable\">$week</span> = (Get-Date).DayOfWeek</span><br><span class=\"line\"><span class=\"keyword\">while</span> ( <span class=\"variable\">$week</span> -eq <span class=\"string\">'Thursday'</span>) &#123;</span><br><span class=\"line\">  Write-Output <span class=\"string\">\"今天是星期三将在此基础上加1天: \"</span> </span><br><span class=\"line\">  <span class=\"variable\">$date</span> = (Get-Date).AddDays(1)</span><br><span class=\"line\">  <span class=\"built_in\">break</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Write-Output <span class=\"variable\">$date</span></span><br><span class=\"line\">  <span class=\"comment\"># 今天是星期三将在此基础上加1天:</span></span><br><span class=\"line\">  <span class=\"comment\"># 2021年4月2日 17:23:49</span></span><br></pre></td></tr></table></figure>\n<p>Tips : 从 PowerShell 版本 3.0 开始，可以使用 $PSItem 而不是 $<em>。 但我发现，大多数经验丰富的 PowerShell 用户仍更喜欢使用 $</em>，因为它向后兼容，需要输入的内容更少。</p>\n<p>Tips : 使用 foreach 关键字时，必须先将所有项存储在内存中，然后才能循环访问这些项，如果不知道要处理的项数，此操作可能会很困难。</p>\n<p><br></p>\n<h4 id=\"Switch-循环语句\"><a href=\"#Switch-循环语句\" class=\"headerlink\" title=\"Switch  循环语句\"></a>Switch  循环语句</h4><p>描述: Switch 本是多路分支的关键字，但是在Powershell中由于Switch支持集合，所以也可以使用它进行循环处理。</p>\n<p>基础示例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.使用Switch循环</span></span><br><span class=\"line\">Switch (10..1)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  Default &#123; <span class=\"string\">\" n = <span class=\"variable\">$_</span>\"</span> &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">#  n = 10</span></span><br><span class=\"line\"><span class=\"comment\">#  n = 9</span></span><br><span class=\"line\"><span class=\"comment\">#  n = 8</span></span><br><span class=\"line\"><span class=\"comment\">#  n = 7</span></span><br><span class=\"line\"><span class=\"comment\">#  n = 6</span></span><br><span class=\"line\"><span class=\"comment\">#  n = 5</span></span><br><span class=\"line\"><span class=\"comment\">#  n = 4</span></span><br><span class=\"line\"><span class=\"comment\">#  n = 3</span></span><br><span class=\"line\"><span class=\"comment\">#  n = 2</span></span><br><span class=\"line\"><span class=\"comment\">#  n = 1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.有时对集合的处理，在循环中还须条件判断，使用Switch循环可以一部到位例如奇数和偶数</span></span><br><span class=\"line\"><span class=\"variable\">$nums</span> = 10..7</span><br><span class=\"line\">Switch (<span class=\"variable\">$nums</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &#123;(<span class=\"variable\">$_</span> % 2) -eq 0&#125; &#123;<span class=\"string\">\"<span class=\"variable\">$_</span> 偶数\"</span>&#125;</span><br><span class=\"line\">  &#123;(<span class=\"variable\">$_</span> % 2) -ne 0&#125; &#123;<span class=\"string\">\"<span class=\"variable\">$_</span> 奇数\"</span>&#125;</span><br><span class=\"line\">&#125; </span><br><span class=\"line\"><span class=\"comment\"># 10 偶数</span></span><br><span class=\"line\"><span class=\"comment\"># 9 奇数</span></span><br><span class=\"line\"><span class=\"comment\"># 8 偶数</span></span><br><span class=\"line\"><span class=\"comment\"># 7 奇数</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"2-终止操作\"><a href=\"#2-终止操作\" class=\"headerlink\" title=\"2.终止操作\"></a>2.终止操作</h3><p>描述: 如何在循环中当满足某些条件时跳出循环, 我们可以采用以下关键字 <code>Break、Continue 和 Return</code>。</p>\n<ul>\n<li>1) <strong>Break</strong> 旨在中断循环。它通常与 switch 语句一起使用。</li>\n<li>2) <strong>Continue</strong> 旨在跳到循环的下一次迭代。它通常与 while 语句一起使用。</li>\n<li>3) <strong>Return</strong> 旨在退出现有作用域。</li>\n</ul>\n<p>基础案例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.示例中所示的 break 语句导致循环在第一次迭代时退出。</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"variable\">$i</span> = 1; <span class=\"variable\">$i</span> -lt 5; <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">  Write-Output <span class=\"string\">\"Sleeping for <span class=\"variable\">$i</span> seconds\"</span></span><br><span class=\"line\">  Start-Sleep -Seconds <span class=\"variable\">$i</span></span><br><span class=\"line\">  <span class=\"built_in\">break</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.示例中，将输出数字 1、2、4 和 5。 它跳过数字 3，并继续执行循环的下一次迭代。与 break 类似 continue 将中断除当前迭代以外的循环。 </span></span><br><span class=\"line\"><span class=\"comment\"># Execution 将继续进行下一次迭代，而不是中断循环并停止。（此处 $i 默认为0）</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> (<span class=\"variable\">$i</span> -lt 5) &#123;</span><br><span class=\"line\">  <span class=\"variable\">$i</span> += 1</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"variable\">$i</span> -eq 3) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">continue</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  Write-Output <span class=\"variable\">$i</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.示例中，return 输出第一个结果，然后退出循环</span></span><br><span class=\"line\"><span class=\"variable\">$number</span> = 1..10</span><br><span class=\"line\">foreach (<span class=\"variable\">$n</span> <span class=\"keyword\">in</span> <span class=\"variable\">$number</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"variable\">$n</span> -ge 4) &#123;</span><br><span class=\"line\">    Return <span class=\"variable\">$n</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<hr>\n<h2 id=\"0x06-PS数组和哈希表\"><a href=\"#0x06-PS数组和哈希表\" class=\"headerlink\" title=\"0x06 PS数组和哈希表\"></a>0x06 PS数组和哈希表</h2><p>描述: 我们理解的数组是存储同一类型的数据集合，而Powershel中可以设置为多种数据格式。PS会将命令执行后的结果文本按每一行作为元素存为数组，在命令的返回值不止一个结果时，PS也会自动把结果存储为数组。</p>\n<p><strong>PS 中数组的特征:</strong></p>\n<ul>\n<li>1.数组的多态性: PS中数组像变量一样如果数组中元素的类型为弱类型，默认可以存储不同类型的值。</li>\n<li>2.数组的有序性: PS数组在内存中是顺序存储的，所以数组的大小必须是确定的方便分配存储空间。</li>\n<li>3.数组的引用性: 使用默认的的赋值运算符在两个变量之间赋值只是复制了一个引用两个变量共享同一份数据，则改变一个另一个也会相应的改变;</li>\n</ul>\n<p><br></p>\n<h3 id=\"常规数组\"><a href=\"#常规数组\" class=\"headerlink\" title=\"常规数组\"></a>常规数组</h3><p>描述: 前面我们说明Powershell会把命令执行返回文本按每一行作为元素存为数组</p>\n<p>基础示例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 0.判断一个变量是否为数组</span></span><br><span class=\"line\"><span class=\"string\">\"WeiyiGeek\"</span> -is [array]  <span class=\"comment\"># 它是一个字符串类型</span></span><br><span class=\"line\">False</span><br><span class=\"line\"><span class=\"string\">\"WeiyiGeek\"</span>.toCharArray() -is [array]</span><br><span class=\"line\">True</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 1.PS将命令执行后返回的结果存入到数组之中</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$IP</span>=IPCONFIG</span><br><span class=\"line\"><span class=\"comment\"># 判断一个变量是否为数组</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$IP</span> -is [array] </span><br><span class=\"line\">True</span><br><span class=\"line\"></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$IP</span>.getType()</span><br><span class=\"line\"><span class=\"comment\"># IsPublic IsSerial Name     BaseType</span></span><br><span class=\"line\"><span class=\"comment\"># -------- -------- ----     --------</span></span><br><span class=\"line\"><span class=\"comment\"># True     True     Object[] System.Array</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 看数组的元素个数用$array.Count属性</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$IP</span>.Count </span><br><span class=\"line\">32 </span><br><span class=\"line\"><span class=\"comment\"># 访问第x个元素，使用$array[x-1]，因为数组是以0开始索引的。</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$IP</span>[4]</span><br><span class=\"line\"><span class=\"comment\"># 以太网适配器 以太网:</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$IP</span>[8]</span><br><span class=\"line\"><span class=\"comment\"># IPv4 地址 . . . . . . . . . . . . : 10.0.0.19</span></span><br></pre></td></tr></table></figure></p>\n<p><em>思考为什么不愿把IPconfig返回的结果称为对象?</em><br>答：因为它不是真正Cmdlet命令，真正的Powershell命令返回的数组元素可不止一个字符串，它是一个内容丰富的对象。</p>\n<p><br></p>\n<p><strong>1.数组创建</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS &gt; <span class=\"variable\">$array</span>=@()        <span class=\"comment\">#使用@()创建一个空数组</span></span><br><span class=\"line\"><span class=\"variable\">$a</span>=,<span class=\"string\">\"WeiyiGeek\"</span>        <span class=\"comment\">#创建1个元素的数组</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$array</span>=1,2,3,4,5  <span class=\"comment\">#常规定义数组</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$array</span>=1..5       <span class=\"comment\">#连续的数字数组(推荐方式)</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$array</span>=1,1.2,<span class=\"string\">\"String\"</span>  <span class=\"comment\">#多种数据类型融合的数组</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$array</span> -is [array]  <span class=\"comment\"># 元素是否为数组 True</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$array</span>.Count        <span class=\"comment\"># 元素个数 3</span></span><br><span class=\"line\">PS C:\\Users\\WeiyiGeek&gt; <span class=\"variable\">$array</span> = @(1,<span class=\"string\">'hello'</span>)</span><br><span class=\"line\">PS C:\\Users\\WeiyiGeek&gt; <span class=\"variable\">$array</span></span><br><span class=\"line\">  <span class=\"comment\"># 1</span></span><br><span class=\"line\">  <span class=\"comment\"># hello</span></span><br><span class=\"line\">PS C:\\Users\\WeiyiGeek&gt; <span class=\"variable\">$array</span>.GetType()</span><br><span class=\"line\">  <span class=\"comment\"># IsPublic IsSerial Name                                     BaseType</span></span><br><span class=\"line\">  <span class=\"comment\"># -------- -------- ----                                     --------</span></span><br><span class=\"line\">  <span class=\"comment\"># True     True     Object[]                                 System.Array</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># [突发奇想]给数组添加数组会进行字符串拼接</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$arr</span>=1..3</span><br><span class=\"line\">PS &gt; <span class=\"variable\">$arr</span>+=5..8 </span><br><span class=\"line\">PS &gt; <span class=\"variable\">$arr</span></span><br><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 所以给数组增加元素其实相当于创建一个新的数组，只不过之后会把原来的副本删除。在当前数组追加元素可以使用“+=”操作符。</span></span><br><span class=\"line\">PS C:Powershell&gt; <span class=\"variable\">$books</span>=<span class=\"string\">\"元素1\"</span>,<span class=\"string\">\"元素2\"</span>,<span class=\"string\">\"元素3\"</span></span><br><span class=\"line\">PS C:Powershell&gt; <span class=\"variable\">$books</span>+=<span class=\"string\">\"元素4\"</span></span><br><span class=\"line\">PS C:Powershell&gt; <span class=\"variable\">$books</span></span><br><span class=\"line\">元素1</span><br><span class=\"line\">元素2</span><br><span class=\"line\">元素3</span><br><span class=\"line\">元素4</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 数组之间可以直接追加元素或者删除元素</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$arr</span> = 1..3</span><br><span class=\"line\">PS &gt; <span class=\"variable\">$arr</span> = <span class=\"variable\">$arr</span>[1..2] + 4..6  </span><br><span class=\"line\">PS &gt; <span class=\"variable\">$arr</span></span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td></tr></table></figure></p>\n<p>Tips : 命令返回的数据是数组类型，数组的每一个元素存放的是一个<code>System.IO.DirectoryInfo</code>对象。</p>\n<p><br></p>\n<p><strong>2.数组访问</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS &gt; <span class=\"variable\">$arr</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$arr</span>[0]    <span class=\"comment\"># 元素都是从0下标开始索引的</span></span><br><span class=\"line\">1</span><br><span class=\"line\"></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$arr</span>[(<span class=\"variable\">$arr</span>.Count-1)]  <span class=\"comment\"># 方式1.输出最后一个元素</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$arr</span>[-1] <span class=\"comment\"># 方式2</span></span><br><span class=\"line\">8</span><br><span class=\"line\"></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$arr</span>[0,1,3,5]   <span class=\"comment\"># 一次输出多个元素 （值得学习）</span></span><br><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">5</span><br><span class=\"line\">7</span><br><span class=\"line\"></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$arr</span>[(<span class=\"variable\">$arr</span>.Count)..0]  <span class=\"comment\"># 将数组逆序输出 （值得学习）</span></span><br><span class=\"line\">8</span><br><span class=\"line\">7</span><br><span class=\"line\">6</span><br><span class=\"line\">5</span><br><span class=\"line\">3</span><br><span class=\"line\">2</span><br><span class=\"line\">1</span><br></pre></td></tr></table></figure><br><br></p>\n<p><strong>3.复制数组</strong><br>描述:复制数组最好使用Clone()方法，除非有特殊需求。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS &gt; <span class=\"variable\">$arr</span>=1..3</span><br><span class=\"line\">PS &gt; <span class=\"variable\">$arr1</span>=<span class=\"variable\">$arr</span></span><br><span class=\"line\"><span class=\"comment\"># 1.两个变量指向同一个地址的数组(表示是相同的)</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$arr1</span>.Equals(<span class=\"variable\">$arr</span>)  </span><br><span class=\"line\">True</span><br><span class=\"line\"><span class=\"comment\"># 2.一个新的数组不是两个变量指向同一个数组</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$arr2</span>=<span class=\"variable\">$arr</span>.Clone()  </span><br><span class=\"line\">PS &gt; <span class=\"variable\">$arr2</span>.Equals(<span class=\"variable\">$arr</span>)   <span class=\"comment\">#这里是为False</span></span><br><span class=\"line\">False</span><br><span class=\"line\">PS &gt; <span class=\"variable\">$arr2</span>[0]=1024</span><br><span class=\"line\">PS &gt; <span class=\"variable\">$arr2</span></span><br><span class=\"line\">1024</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"数组类型\"><a href=\"#数组类型\" class=\"headerlink\" title=\"数组类型\"></a>数组类型</h3><p>描述:数组一般具有多态性，如果你不指定元素的具体类型，解释器会<code>自动选择合适的类型存储每个元素</code>。</p>\n<ul>\n<li>如果要统一限制所有元素的类型，可是使用类型名和一对方括号作为数组变量的类型。</li>\n<li>每当赋值时会自动类型检查, 如果目标数据类型不能转换成功，就会抛出一个异常。</li>\n</ul>\n<p>基础示例:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 示例1</span></span><br><span class=\"line\">PS &gt; [int[]] <span class=\"variable\">$num</span> = @()</span><br><span class=\"line\">PS &gt; <span class=\"variable\">$num</span> += 1024</span><br><span class=\"line\">PS &gt; <span class=\"variable\">$num</span> += 3.1415926  <span class=\"comment\">#这里由于强制类型的作用(会直接忽略小数点后的数字)</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$num</span> += 999</span><br><span class=\"line\">PS &gt; <span class=\"variable\">$num</span></span><br><span class=\"line\">1024</span><br><span class=\"line\">3</span><br><span class=\"line\">999</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 示例2</span></span><br><span class=\"line\">[string[]] <span class=\"variable\">$str</span> = @()</span><br><span class=\"line\"><span class=\"variable\">$str</span> += <span class=\"string\">\"Name\"</span></span><br><span class=\"line\"><span class=\"variable\">$str</span> += <span class=\"string\">\"is\"</span></span><br><span class=\"line\"><span class=\"variable\">$str</span> += <span class=\"string\">\"WeiyiGeek\"</span></span><br><span class=\"line\"><span class=\"variable\">$str</span> += 1024      <span class=\"comment\"># 这里由于强制类型的作用(会将1024转换为字符串而非整形)</span></span><br><span class=\"line\"><span class=\"variable\">$str</span>.GetType().fullname</span><br><span class=\"line\">System.String[]</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"哈希表-Hash\"><a href=\"#哈希表-Hash\" class=\"headerlink\" title=\"哈希表(Hash)\"></a>哈希表(Hash)</h3><p>描述：哈希表存放的是键值对<code>(Key-Value)</code>，在哈希表中不再仅仅限制使用数字寻址，可以<code>使用任意类型的数据类型寻址</code>。</p>\n<p>Tips: 在创建哈希表时就使用数组，因为创建数组和哈希表的的元素关键字不冲突<code>一个是逗号，一个是分号</code>。</p>\n<p><strong>基础实例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.使用@&#123;&#125;创建哈希表</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$hash</span>=@&#123; Name=<span class=\"string\">\"WeiyiGeek\"</span>;Age=<span class=\"string\">\"15\"</span> &#125;  <span class=\"comment\">#创建一个HASH表示</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$hash</span>[<span class=\"string\">'Name'</span>]  <span class=\"comment\">#使用哈希表的键访问对应的值</span></span><br><span class=\"line\">WeiyiGeek</span><br><span class=\"line\">PS &gt; <span class=\"variable\">$hash</span>.Keys  <span class=\"comment\">#HASH表的所有键</span></span><br><span class=\"line\">Age</span><br><span class=\"line\">Name</span><br><span class=\"line\">PS &gt; <span class=\"variable\">$hash</span>.Values <span class=\"comment\">#HASH表的所有值</span></span><br><span class=\"line\">15</span><br><span class=\"line\">WeiyiGeek</span><br><span class=\"line\">PS &gt; <span class=\"variable\">$hash</span>.Count <span class=\"comment\">#HASH表的键值对数量</span></span><br><span class=\"line\">2</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.在哈希表中存储数组</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$hash</span>=@&#123; Name=<span class=\"string\">\"WeiyiGeek\"</span>;Age=<span class=\"string\">\"15\"</span>; Books=<span class=\"string\">\"C\"</span>,<span class=\"string\">\"C++\"</span>,<span class=\"string\">\"PYTHON\"</span>&#125; </span><br><span class=\"line\">PS &gt; <span class=\"variable\">$hash</span>.Sex=<span class=\"string\">\"Woman\"</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$hash</span></span><br><span class=\"line\"><span class=\"comment\"># Name                           Value</span></span><br><span class=\"line\"><span class=\"comment\"># ----                           -----</span></span><br><span class=\"line\"><span class=\"comment\"># Books                          &#123;C, C++, PYTHON&#125;</span></span><br><span class=\"line\"><span class=\"comment\"># Name                           WeiyiGeek</span></span><br><span class=\"line\"><span class=\"comment\"># Age                            15</span></span><br><span class=\"line\"><span class=\"comment\"># Sex                            Woman</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.在哈希表中存储数组哈希表值的更新和删除</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$hash</span>.Name=<span class=\"string\">\"weiyi\"</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$hash</span>.remove(<span class=\"string\">\"Books\"</span>)</span><br><span class=\"line\">PS &gt; <span class=\"variable\">$hash</span></span><br><span class=\"line\"><span class=\"comment\"># Name                           Value</span></span><br><span class=\"line\"><span class=\"comment\"># ----                           -----</span></span><br><span class=\"line\"><span class=\"comment\"># Name                           weiyi</span></span><br><span class=\"line\"><span class=\"comment\"># Age                            15</span></span><br><span class=\"line\"><span class=\"comment\"># Sex                            Woman</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.使用哈希表格式化输出</span></span><br><span class=\"line\"><span class=\"comment\"># PS许多命令的输出结果都是以表格的形式，当然可以使用Format-Table自定义表格格式，例如：</span></span><br><span class=\"line\">PS C:Powershell&gt; Dir | Format-Table FullName,Mode <span class=\"comment\">#命令只能限制表格输出那些列，隐藏那些列,但是对于列的宽度，列标题无能为力</span></span><br><span class=\"line\">  <span class=\"comment\"># FullName               Mode</span></span><br><span class=\"line\">  <span class=\"comment\"># --------               ----</span></span><br><span class=\"line\">  <span class=\"comment\"># C:PowershellABC        d----</span></span><br><span class=\"line\">  <span class=\"comment\"># C:Powershellmyscript   d----</span></span><br><span class=\"line\">  <span class=\"comment\"># C:Powershella.html     d----</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 表格的每一个列包含四个属性,我们可以采用哈希表来修改属性以自定输出格式。</span></span><br><span class=\"line\"><span class=\"comment\"># * Expression:绑定的表达式</span></span><br><span class=\"line\"><span class=\"comment\"># * Width:列宽度</span></span><br><span class=\"line\"><span class=\"comment\"># * Label:列标题</span></span><br><span class=\"line\"><span class=\"comment\"># * Alignment:列的对齐方式</span></span><br><span class=\"line\">PS &gt; <span class=\"variable\">$column1</span> = @&#123;expression=<span class=\"string\">\"Name\"</span>; width=30;label=<span class=\"string\">\"filename\"</span>; alignment=<span class=\"string\">\"left\"</span>&#125;</span><br><span class=\"line\">PS &gt; <span class=\"variable\">$column2</span> = @&#123;expression=<span class=\"string\">\"LastWriteTime\"</span>; width=40;label=<span class=\"string\">\"last modification\"</span>; alignment=<span class=\"string\">\"right\"</span>&#125;  </span><br><span class=\"line\">PS &gt; ls | Format-Table <span class=\"variable\">$column1</span>, <span class=\"variable\">$column2</span></span><br><span class=\"line\"><span class=\"comment\"># filename          last modification</span></span><br><span class=\"line\"><span class=\"comment\"># --------          -----------------</span></span><br><span class=\"line\"><span class=\"comment\"># .android          2019/7/26 8:45:03</span></span><br><span class=\"line\"><span class=\"comment\"># .config           2019/8/19 17:27:45</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5.哈希表迭代集群注意事项当直接将Hash赋值给变量时两个指向的是同一个Hash对象。( 巨坑之处 - 注意区别)</span></span><br><span class=\"line\"><span class=\"variable\">$SysPrivilege</span> = @&#123;</span><br><span class=\"line\">  name = <span class=\"string\">\"weiyigeek\"</span></span><br><span class=\"line\">  result = @()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable\">$demo1</span> = <span class=\"variable\">$SysPrivilege</span></span><br><span class=\"line\"><span class=\"variable\">$Hash</span> = <span class=\"variable\">$SysPrivilege</span>.Clone()  <span class=\"comment\"># 采用 Clone() 将该Hash复制到另外一个变量之中它将是独立的不受$SysPrivilege增加与减少的影响</span></span><br><span class=\"line\"><span class=\"variable\">$SysPrivilege</span>.age=18</span><br><span class=\"line\"><span class=\"variable\">$demo1</span>  <span class=\"comment\"># 实际是 == $SysPrivilege 两者指向同一个对象</span></span><br><span class=\"line\">  <span class=\"comment\"># Name                           Value</span></span><br><span class=\"line\">  <span class=\"comment\"># ----                           -----</span></span><br><span class=\"line\">  <span class=\"comment\"># result                         &#123;&#125;</span></span><br><span class=\"line\">  <span class=\"comment\"># name                           weiyigeek</span></span><br><span class=\"line\">  <span class=\"comment\"># age                            18</span></span><br><span class=\"line\"><span class=\"variable\">$Hash</span></span><br><span class=\"line\">  <span class=\"comment\"># Name                           Value</span></span><br><span class=\"line\">  <span class=\"comment\"># ----                           -----</span></span><br><span class=\"line\">  <span class=\"comment\"># result                         &#123;&#125;</span></span><br><span class=\"line\">  <span class=\"comment\"># name                           weiyigeek</span></span><br></pre></td></tr></table></figure></p>\n<p>补充说明: 在Hash键值对的与文件中的某一行字符进行验证是否匹配时采用<code>.Equals()</code>时返回为False，一定要注意文件中是否带有<code>\\&quot;\\&quot;</code>在进行匹配时也必须带上其”单引号字符进行匹配,坑呀(一下午就荒废在这里了)<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$TestString</span> = @&#123;value=<span class=\"string\">'WeiyiGeek'</span>;&#125;</span><br><span class=\"line\"><span class=\"string\">\"WeiyiGeek\"</span>.Equals(<span class=\"string\">\"<span class=\"variable\">$($TestString.value)</span>\"</span>) <span class=\"comment\"># True</span></span><br><span class=\"line\"><span class=\"string\">\"WeiyiGeek\"</span>.Equals(<span class=\"variable\">$TestString</span>.value)      <span class=\"comment\"># True</span></span><br><span class=\"line\"><span class=\"string\">\"WeiyiGeek\"</span>.Equals(<span class=\"variable\">$TestString</span>.value.ToString()) <span class=\"comment\"># True</span></span><br><span class=\"line\"><span class=\"string\">\"WeiyiGeek\"</span> -eq <span class=\"string\">\"<span class=\"variable\">$($TestString.value)</span>\"</span> <span class=\"comment\"># True</span></span><br><span class=\"line\"><span class=\"string\">\"WeiyiGeek\"</span> -eq <span class=\"string\">\"<span class=\"variable\">$TestString</span>.value\"</span>    <span class=\"comment\"># False</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 前者从文件中读取后者从Hash键值对中获得</span></span><br><span class=\"line\"><span class=\"variable\">$TestString</span> = @&#123;value=<span class=\"string\">'\"WeiyiGeek_admin\"'</span>;value1=<span class=\"string\">'\"Guest\"'</span>&#125;</span><br><span class=\"line\"><span class=\"string\">\"WeiyiGeek_admin\"</span> Administrator</span><br><span class=\"line\">IsPublic IsSerial Name                                     BaseType                                                   </span><br><span class=\"line\">-------- -------- ----                                     --------                                                   </span><br><span class=\"line\">True     True     String                                   System.Object                                              </span><br><span class=\"line\">True     True     String                                   System.Object                                              </span><br><span class=\"line\"><span class=\"string\">\"Guest\"</span> Guest</span><br><span class=\"line\">True     True     String                                   System.Object                                              </span><br><span class=\"line\">True     True     String                                   System.Object</span><br></pre></td></tr></table></figure></p>\n<hr>\n<h2 id=\"0x07-函数-Function\"><a href=\"#0x07-函数-Function\" class=\"headerlink\" title=\"0x07 函数(Function)\"></a>0x07 函数(Function)</h2><p>描述: 函数就是将大大小小的命令组合成一个集合里面进行执行，有利于提高代码复用以及简练代码量;</p>\n<p><strong>函数三原则:</strong></p>\n<ul>\n<li>简短：函数名简短，并且显而易见。</li>\n<li>聚合：函数可以完成多个操作。</li>\n<li>封装和扩展：将一批Powershell语句进行封装，实现全新的功能需求。</li>\n</ul>\n<p><br/></p>\n<h3 id=\"函数结构\"><a href=\"#函数结构\" class=\"headerlink\" title=\"函数结构\"></a>函数结构</h3><p>描述: 由三部分组成：函数名，参数，函数体<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Function 函数名称 (args[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  code; <span class=\"comment\"># 函数体</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h3 id=\"函数定义\"><a href=\"#函数定义\" class=\"headerlink\" title=\"函数定义\"></a>函数定义</h3><p>描述: 主要针对函数的创建、调用、更新和删除。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># (1) 使用函数作为别名函数的创建</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> Test-conn &#123;</span><br><span class=\"line\">  Test-Connection -Count 2 -ComputerName <span class=\"variable\">$args</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Set-Alias tc <span class=\"built_in\">test</span>-conn</span><br><span class=\"line\">PS C:\\PS&gt; tc localhost</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2) 函数调用</span></span><br><span class=\"line\">Function getHostName &#123;</span><br><span class=\"line\">  Write-Host -NoNewline <span class=\"string\">\"当前机器名称: \"</span> </span><br><span class=\"line\">  HOSTNAME.EXE</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">getHostName</span><br><span class=\"line\"><span class=\"comment\"># 当前机器名称: WeiyiGeek</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (3) 函数更新</span></span><br><span class=\"line\"><span class=\"variable\">$function</span>:getHostName  <span class=\"comment\"># 直接输出函数体，所以我们可以通过先将函数定义导出到ps文件，然后在进行编辑更更新</span></span><br><span class=\"line\">  <span class=\"comment\"># Write-Host -NoNewline \"当前机器名称: \"</span></span><br><span class=\"line\">  <span class=\"comment\"># HOSTNAME.EXE</span></span><br><span class=\"line\"><span class=\"variable\">$function</span>:getHostName | Out-File getHostName.ps1</span><br><span class=\"line\">PS C:\\Users\\WeiyiGeek&gt; .\\getHostName.ps1</span><br><span class=\"line\">当前机器名称: WeiyiGeek</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (4) 删除函数</span></span><br><span class=\"line\"><span class=\"comment\"># Tips: 控制台定义的函数只会在当前会话生效，一旦控制台退出会自动消失，在不关闭控制台的条件下删除一个已经定义好的函数可是使用del命令的方法：</span></span><br><span class=\"line\">Remove-Item <span class=\"keyword\">function</span>:getHostName  <span class=\"comment\"># 或者 del function:getHostName</span></span><br></pre></td></tr></table></figure><br><br/></p>\n<h3 id=\"函数参数\"><a href=\"#函数参数\" class=\"headerlink\" title=\"函数参数\"></a>函数参数</h3><p>描述: PS 函数可以接受参数并对参数进行处理,函数的参数有3个特性：</p>\n<ul>\n<li>1.任意参数：内部变量 <code>$args</code> 接受函数调用时接受的参数,它是一个数组类型。</li>\n<li>2.命名参数：函数的每一个参数可以分配一个名称，在调用时通过名称指定对应的参数。</li>\n<li>3.预定义参数：函数在定义参数时可以指定默认值，如果调用时没有专门指定参数的值，就会保持默认值。</li>\n</ul>\n<h4 id=\"1-万能参数\"><a href=\"#1-万能参数\" class=\"headerlink\" title=\"(1) 万能参数\"></a>(1) 万能参数</h4><p>描述 : $args 变量是万能参数它可以识别任意个参数，在PS编程开发中非常有用。</p>\n<p><strong>基础示例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.万能参数使用演示</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> say-Hello</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"variable\">$args</span>.Count -eq 0)&#123;</span><br><span class=\"line\">    <span class=\"string\">\"No argument!\"</span></span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\"># 包含在字符串中可以使用$()包含并解析变量。</span></span><br><span class=\"line\">    <span class=\"variable\">$args</span> | foreach &#123;<span class=\"string\">\"Hello,<span class=\"variable\">$($_)</span>\"</span>&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># 无参数调用时：</span></span><br><span class=\"line\">PS C:\\Users\\WeiyiGeek&gt; say-Hello</span><br><span class=\"line\">  No argument!</span><br><span class=\"line\"><span class=\"comment\"># 一个参数调用：</span></span><br><span class=\"line\">PS C:\\Users\\WeiyiGeek&gt; say-Hello WeiyiGeek</span><br><span class=\"line\">  Hello,WeiyiGeek</span><br><span class=\"line\"><span class=\"comment\"># 多个参数调用时：</span></span><br><span class=\"line\">PS C:\\Users\\WeiyiGeek&gt; say-Hello WeiyiGeek Computer</span><br><span class=\"line\">  Hello,WeiyiGeek</span><br><span class=\"line\">  Hello,Computer</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.任意参数求和</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> Add &#123;</span><br><span class=\"line\">  <span class=\"variable\">$sum</span>=0</span><br><span class=\"line\">  <span class=\"variable\">$args</span> | foreach &#123; <span class=\"variable\">$sum</span> += <span class=\"variable\">$_</span> &#125;</span><br><span class=\"line\">  <span class=\"variable\">$sum</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">PS C:\\Users\\WeiyiGeek&gt; Add 1 2 3 4 5 </span><br><span class=\"line\">15</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h4 id=\"2-参数名称设置\"><a href=\"#2-参数名称设置\" class=\"headerlink\" title=\"(2) 参数名称设置\"></a>(2) 参数名称设置</h4><p>描述: 我们可以设置指定名称的传入参数的名称并进行调用, 它可以有两种形式进行调用一是通过顺序传入、二是通过指定参数名称；</p>\n<p>注意: 传入参数我们可以对其设置强弱类型的参数, 由于函数的参数解释器比较傲慢，它对你提供的参数的信息完全不关心。它只会粗略地将参数进行分割，并且最大限度的进行自动类型转换。在实际编程过程中我们常常需要限定用户输入类型(防止搞破坏)</p>\n<p><strong>基础示例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.使用弱类型参数</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> StringContact(<span class=\"variable\">$str1</span>,<span class=\"variable\">$str2</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"built_in\">return</span> <span class=\"variable\">$str1</span>+<span class=\"variable\">$str2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">StringContact Weiyi Geek</span><br><span class=\"line\">StringContact -str1 Weiyi -str2 Geek</span><br><span class=\"line\">  <span class=\"comment\"># WeiyiGeek</span></span><br><span class=\"line\">  <span class=\"comment\"># WeiyiGeek</span></span><br><span class=\"line\">StringContact 16 50</span><br><span class=\"line\">  <span class=\"comment\"># 66</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.使用强类型参数(整型、浮点型、日期类型)</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> subtract([int]<span class=\"variable\">$value1</span>,[int]<span class=\"variable\">$value2</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"built_in\">return</span> <span class=\"variable\">$value1</span>-<span class=\"variable\">$value2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">subtract 3 5</span><br><span class=\"line\">  <span class=\"comment\"># -2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> subtract([double]<span class=\"variable\">$value1</span>,[double]<span class=\"variable\">$value2</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"built_in\">return</span> <span class=\"variable\">$value1</span>-<span class=\"variable\">$value2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">subtract 8.8 7.9</span><br><span class=\"line\">  <span class=\"comment\"># 0.9</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 函数的参数解释器会自动尝试将字符串转换成日期类型，如果转换失败就是抛出异常。</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> DayOfWeek([datetime]<span class=\"variable\">$date</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"built_in\">return</span>  <span class=\"variable\">$date</span>.DayOfWeek</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">DayofWeek <span class=\"string\">'1927-8-1'</span></span><br><span class=\"line\">  <span class=\"comment\"># Monday</span></span><br><span class=\"line\">DayofWeek 2008-8-1</span><br><span class=\"line\">  <span class=\"comment\"># Friday</span></span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h4 id=\"3-参数定义默认值\"><a href=\"#3-参数定义默认值\" class=\"headerlink\" title=\"(3) 参数定义默认值\"></a>(3) 参数定义默认值</h4><p>描述: 我们可以对传入的参数设置默认的值,当且仅当没有传入参数时。</p>\n<p><strong>基础示例：</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> defaultStringContact(<span class=\"variable\">$str1</span>=<span class=\"string\">\"WeiyiGeek\"</span>,<span class=\"variable\">$str2</span>=<span class=\"string\">\"-Computer\"</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"built_in\">return</span> <span class=\"variable\">$str1</span>+<span class=\"variable\">$str2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">PS C:\\Users\\WeiyiGeek&gt; defaultStringContact Good Luck</span><br><span class=\"line\">  <span class=\"comment\"># GoodLuck</span></span><br><span class=\"line\">PS C:\\Users\\WeiyiGeek&gt; defaultStringContact</span><br><span class=\"line\">  <span class=\"comment\"># WeiyiGeek-Computer</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h4 id=\"4-Switch-参数\"><a href=\"#4-Switch-参数\" class=\"headerlink\" title=\"(4) Switch 参数\"></a>(4) Switch 参数</h4><p>描述: Powershell 函数最简单的参数类型为布尔类型，除了使用Bool类型，也可以使用Switch关键字。</p>\n<p><strong>基础示例:</strong><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 主要功能是逆转字符串但是可以通过 $try 参数进行控制，如果没有指定$try的值默认值为$false;</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> tryReverse( [switch]<span class=\"variable\">$try</span> , [string]<span class=\"variable\">$source</span> )</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  [string]<span class=\"variable\">$target</span>=<span class=\"string\">\"\"</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"variable\">$try</span>)</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>( [int]<span class=\"variable\">$i</span> = <span class=\"variable\">$source</span>.length -<span class=\"number\">1</span>; <span class=\"variable\">$i</span> <span class=\"nomarkup\">-ge</span> <span class=\"number\">0</span> ;<span class=\"variable\">$i</span>--)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"variable\">$target</span> += <span class=\"variable\">$source</span>[<span class=\"variable\">$i</span>]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable\">$target</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable\">$source</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">tryReverse -source www.weiyigeek.top</span><br><span class=\"line\">  <span class=\"comment\"># www.weiyigeek.top</span></span><br><span class=\"line\">tryReverse -try <span class=\"literal\">$true</span> -source www.weiyigeek.top</span><br><span class=\"line\">  <span class=\"comment\"># pot.keegiyiew.www</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"函数返值\"><a href=\"#函数返值\" class=\"headerlink\" title=\"函数返值\"></a>函数返值</h3><p>描述: PS 它的函数可以有多个返回值, 如果你直接调用函数，返回值会在控制台输出,当然我们通常是将结果存储在一个变量中进一步处理。</p>\n<p><strong>基础示例:</strong><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.例如求某值的平方返回一个值</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> Square([double]<span class=\"variable\">$num</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"variable\">$num</span>*<span class=\"variable\">$num</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.例如计算1gb是多少MB/KB/B返回多个值</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> gbMeasure(<span class=\"variable\">$amount</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"comment\"># 注意引用变量的方式</span></span><br><span class=\"line\">  <span class=\"string\">\"<span class=\"variable\">$amount</span> GB=$(<span class=\"variable\">$amount</span>) GB\"</span></span><br><span class=\"line\">  <span class=\"string\">\"<span class=\"variable\">$amount</span> GB=$(<span class=\"variable\">$amount</span>*1gb/1mb) MB\"</span></span><br><span class=\"line\">  <span class=\"string\">\"<span class=\"variable\">$amount</span> GB=$(<span class=\"variable\">$amount</span>*1gb/1kb) KB\"</span></span><br><span class=\"line\">  <span class=\"string\">\"<span class=\"variable\">$amount</span> GB=$(<span class=\"variable\">$amount</span>*1gb) B\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">#函数返回4个值</span></span><br><span class=\"line\">gbMeasure <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"comment\"># 1 GB=1 GB</span></span><br><span class=\"line\">  <span class=\"comment\"># 1 GB=1024 MB</span></span><br><span class=\"line\">  <span class=\"comment\"># 1 GB=1048576 KB</span></span><br><span class=\"line\">  <span class=\"comment\"># 1 GB=1073741824 B</span></span><br><span class=\"line\"><span class=\"comment\">#将所有的返回值存储在一个变量(自动存储在数组)中</span></span><br><span class=\"line\"><span class=\"variable\">$result</span>=gbMeasure <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"variable\">$result</span>  <span class=\"comment\"># 输出结果同上</span></span><br><span class=\"line\"><span class=\"comment\">#通过索引访问每个返回值</span></span><br><span class=\"line\"><span class=\"variable\">$result</span>=gbMeasure <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"variable\">$result</span>[<span class=\"number\">3</span>]</span><br><span class=\"line\">  <span class=\"comment\"># 1 GB=1073741824 B</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.一个函数返回了一个值还是多个值是可以验证的(值得学习)。</span></span><br><span class=\"line\"><span class=\"keyword\">Function</span> lottery([int]<span class=\"variable\">$number</span>=<span class=\"number\">1</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"variable\">$rand</span> = <span class=\"built_in\">New-Object</span> system.random</span><br><span class=\"line\">  <span class=\"keyword\">For</span> (<span class=\"variable\">$i</span>=<span class=\"number\">1</span>; <span class=\"variable\">$i</span> <span class=\"nomarkup\">-le</span> <span class=\"variable\">$number</span>; <span class=\"variable\">$i</span>++) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$rand</span>.next(<span class=\"number\">1</span>,<span class=\"number\">50</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># 参数为空时，返回值不是数组:</span></span><br><span class=\"line\"><span class=\"variable\">$result</span> = lottery</span><br><span class=\"line\"><span class=\"variable\">$result</span> -is [array]</span><br><span class=\"line\">  <span class=\"comment\"># False</span></span><br><span class=\"line\"><span class=\"comment\"># 如果指定多个随机数是，返回值是数组类型:</span></span><br><span class=\"line\"><span class=\"variable\">$result</span> = lottery <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"variable\">$result</span> -is [array]</span><br><span class=\"line\">  <span class=\"comment\"># True</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.函数默认会将函数中的所有输出作为函数的返回值返回，但在实际情况中可能会将不必要的输出误以为返回值，此时我们可以使用Write-Host或者Write-Debug命令只输出特定的步骤中的内容，而不作为返回值。</span></span><br><span class=\"line\"><span class=\"keyword\">Function</span> Test()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"built_in\">Write-Host</span> <span class=\"string\">\"Try to calculate.\"</span></span><br><span class=\"line\">  <span class=\"string\">\"3.1415926\"</span></span><br><span class=\"line\">  <span class=\"built_in\">Write-Debug</span> <span class=\"string\">\"Done.\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># 测试返回值</span></span><br><span class=\"line\"><span class=\"variable\">$value</span></span><br><span class=\"line\">  <span class=\"comment\"># 3.1415926</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在变量值中保存返回值，在控制台输出注释行，注意Debug调试信息只会在调试模式下被输出</span></span><br><span class=\"line\"><span class=\"variable\">$DebugPreference</span>=<span class=\"string\">\"Continue\"</span></span><br><span class=\"line\"><span class=\"variable\">$value</span>=Test</span><br><span class=\"line\">  <span class=\"comment\"># Try to calculate.</span></span><br><span class=\"line\">  <span class=\"comment\"># 调试: Done.</span></span><br></pre></td></tr></table></figure></p>\n<p>Tips: 如果一个函数返回一个值像其它编程语言一样，这个值包括她的类型信息会直接返回<br>Tips: 如果遇到多个返回值，Powershell会将所有的返回值自动构造成一个Object数组。可以通过索引访问数组。</p>\n<p>Tips: 使用Write-Debug有两个优势，首先调试信息会自动高亮显示，便于分析。其次这些调试信息只会在调试模式开启时输出，控制起来更加方便。当然最重要的是这些临时信息无论什么时候也不会混淆在返回值。</p>\n<p>Tips: 如果你想通过显示调试信息调试函数可以开启调试模式, 如果关闭调试模式，这些调试信息自然不会输出。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 开启调试模式</span></span><br><span class=\"line\"><span class=\"variable\">$DebugPreference</span>=<span class=\"string\">\"Continue\"</span></span><br><span class=\"line\"><span class=\"comment\"># 关闭调试模式</span></span><br><span class=\"line\"><span class=\"variable\">$DebugPreference</span>=<span class=\"string\">\"SilentlyContinue\"</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"函数支持\"><a href=\"#函数支持\" class=\"headerlink\" title=\"函数支持\"></a>函数支持</h3><p>描述: Powershell已经提供了许多用户能够使用的预定义函数, 我们可以通过Function:进行查看有哪些预定义函数。</p>\n<p>Powershell中的这些预定义的函数可以做很多重要的工作，例如我们常常使用的命令其实都是PS的预定义函数。</p>\n<ul>\n<li>X: 调用Set-Location定位到指定的驱动器根目录</li>\n<li>prompt 返回提示文本</li>\n<li>Clear-Host 清除屏幕的缓存</li>\n<li>help,man 查看命令的帮助文档</li>\n<li>mkdir,md 通过new-Item创建子目录</li>\n<li>more 分屏输出管道结果</li>\n<li>TabExpansion Tab键的自动完成提示</li>\n</ul>\n<p><br/></p>\n<p><strong>基础示例:</strong><br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.预定义函数查看</span></span><br><span class=\"line\">&gt; dir <span class=\"keyword\">function</span>: | ft -AutoSize</span><br><span class=\"line\">  <span class=\"comment\"># CommandType Name                                   Version Source</span></span><br><span class=\"line\">  <span class=\"comment\"># ----------- ----                                   ------- ------</span></span><br><span class=\"line\">  <span class=\"comment\"># Function    A:</span></span><br><span class=\"line\">  <span class=\"comment\"># Function    Add-InitiatorIdToMaskingSet            2.0.0.0 Storage</span></span><br><span class=\"line\">  ...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.查看预定义函数定义</span></span><br><span class=\"line\"><span class=\"variable\">$Function:A:</span></span><br><span class=\"line\">  <span class=\"comment\"># Set-Location $MyInvocation.MyCommand.Name</span></span><br><span class=\"line\"><span class=\"variable\">$Function:psEdit</span></span><br><span class=\"line\">  <span class=\"comment\"># param([Parameter(Mandatory=$true)]$filenames)</span></span><br><span class=\"line\">  <span class=\"comment\"># foreach ($filename in $filenames)</span></span><br><span class=\"line\">  <span class=\"comment\"># &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">#   dir $filename | where &#123;!$_.PSIsContainer&#125; | %&#123;</span></span><br><span class=\"line\">  <span class=\"comment\">#     $psISE.CurrentPowerShellTab.Files.Add($_.FullName) &gt; $null</span></span><br><span class=\"line\">  <span class=\"comment\">#   &#125;</span></span><br><span class=\"line\">  <span class=\"comment\"># &#125;</span></span><br><span class=\"line\"><span class=\"comment\"># 如果一个函数名中包含了特殊字符就应当把它放在花括号中</span></span><br><span class=\"line\">$&#123;<span class=\"keyword\">function</span>:<span class=\"built_in\">Clear-Host</span>&#125;</span><br><span class=\"line\">  <span class=\"comment\"># $RawUI = $Host.UI.RawUI</span></span><br><span class=\"line\">  <span class=\"comment\"># $RawUI.CursorPosition = @&#123;X=0;Y=0&#125;</span></span><br><span class=\"line\">  <span class=\"comment\"># $RawUI.SetBufferContents(</span></span><br><span class=\"line\">  <span class=\"comment\">#     @&#123;Top = -1; Bottom = -1; Right = -1; Left = -1&#125;,</span></span><br><span class=\"line\">  <span class=\"comment\">#     @&#123;Character = ' '; ForegroundColor = $rawui.ForegroundColor; BackgroundColor = $rawui.BackgroundColor&#125;)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.看当前Powershell环境中定义了多少个函数</span></span><br><span class=\"line\">(dir <span class=\"keyword\">function</span>:).count</span><br><span class=\"line\"><span class=\"number\">201</span></span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p><strong>自定义终端字符串</strong><br>描述: 我们可以通过覆盖<code>prompt</code>函数来重写命令行显示，简单示例1如下:<br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.下面的函数会首先设置窗口标题，然后设置命令输入显示字符串行</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> prompt</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"comment\"># 使用 $Host.UI.Rawui 环境变量</span></span><br><span class=\"line\">  <span class=\"variable\">$host</span>.ui.rawui.WindowTitle = <span class=\"string\">\"Line: \"</span> + <span class=\"variable\">$host</span>.UI.RawUI.CursorPosition.Y + <span class=\"string\">\" \"</span> + <span class=\"variable\">$env:USERNAME</span> + <span class=\"string\">\" \"</span> + <span class=\"variable\">$Host</span>.Name + <span class=\"string\">\" \"</span> + <span class=\"variable\">$Host</span>.Version</span><br><span class=\"line\">  <span class=\"comment\"># 记住当前光标的位置 ,以及当前窗口的宽度</span></span><br><span class=\"line\">  <span class=\"variable\">$curPos</span> = <span class=\"variable\">$host</span>.ui.rawui.CursorPosition</span><br><span class=\"line\">  <span class=\"variable\">$widthPos</span> = <span class=\"variable\">$host</span>.ui.rawui.WindowSize.Width</span><br><span class=\"line\">  <span class=\"variable\">$newPos</span> = <span class=\"variable\">$curPos</span></span><br><span class=\"line\">  <span class=\"comment\"># 然后在横坐标上增加$widthPos - 28个占位符，然后重置光标的位置至当前位置，</span></span><br><span class=\"line\">  <span class=\"variable\">$newPos</span>.X+=( <span class=\"variable\">$widthPos</span> - <span class=\"number\">24</span> )</span><br><span class=\"line\">  <span class=\"variable\">$host</span>.ui.rawui.CursorPosition = <span class=\"variable\">$newPos</span></span><br><span class=\"line\">  <span class=\"built_in\">Write-Host</span> (<span class=\"string\">\"&#123;0:D&#125; &#123;0:T&#125;\"</span> -f (<span class=\"built_in\">Get-Date</span>)) -foregroundcolor Yellow</span><br><span class=\"line\">  <span class=\"comment\"># 最后通过prompt函数回复光标的原始位置。****</span></span><br><span class=\"line\">  <span class=\"variable\">$host</span>.ui.rawui.CursorPosition = <span class=\"variable\">$curPos</span></span><br><span class=\"line\">  <span class=\"built_in\">Write-Host</span> (<span class=\"string\">\"[\"</span>+$(whoami) + <span class=\"string\">\"] - PS \"</span> + $(<span class=\"built_in\">get-location</span>) +<span class=\"string\">\"&gt;\"</span>) -nonewline -foregroundcolor Green</span><br><span class=\"line\"><span class=\"string\">\" \"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 补充说明: POWERSHELL 控制台标题修改以及函数封装`$host.ui.RawUI.WindowTitle=\"自定义标题\"` 非常值得学习默认是没有Title的命令</span></span><br><span class=\"line\">title web</span><br><span class=\"line\"><span class=\"comment\"># title: The term 'title' is not recognized as a name of a cmdlet, function, script file, or executable program.</span></span><br><span class=\"line\"><span class=\"comment\"># Check the spelling of the name, or if a path was included, verify that the path is correct and try again.</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建用户自定义的ps1文件并进行创建</span></span><br><span class=\"line\"><span class=\"built_in\">New-Item</span> -path <span class=\"variable\">$profile</span> -type file -force</span><br><span class=\"line\">code <span class=\"variable\">$profile</span> </span><br><span class=\"line\"><span class=\"comment\"># 在打开的profile文件里面保存如下代码</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> Set-WindowTitle &#123;</span><br><span class=\"line\">  <span class=\"variable\">$host</span>.UI.RawUI.WindowTitle = [string]::Join(<span class=\"string\">\" \"</span>, <span class=\"variable\">$args</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">Set-Alias</span> -name <span class=\"string\">\"title\"</span> -value Set-WindowTitle</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 运行显示结果</span></span><br><span class=\"line\">[weiyigeek\\weiyigeek] - PS C:\\Users\\WeiyiGeek&gt; whoami                                           <span class=\"number\">2021</span>年<span class=\"number\">4</span>月<span class=\"number\">18</span>日 <span class=\"number\">13</span>:<span class=\"number\">44</span>:<span class=\"number\">50</span></span><br><span class=\"line\">weiyigeek\\weiyigeek</span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2021/1/20210418134530.png\" alt=\"WeiyiGeek.命令行标题及命令行显示设置\" title=\"\" class=\"\">\n                <p>WeiyiGeek.命令行标题及命令行显示设置</p>\n            </figure>\n<p><br></p>\n<p>简单示例2: 使用WindowsPrincipal 辨别当前用户是否使用了管理员权限，<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 采用.net对象的方式进行获取</span></span><br><span class=\"line\"><span class=\"variable\">$CurrentUser</span> = [System.Security.Principal.WindowsIdentity]::GetCurrent()</span><br><span class=\"line\"><span class=\"variable\">$principal</span> = new-object System.Security.principal.windowsprincipal(<span class=\"variable\">$CurrentUser</span>)</span><br><span class=\"line\"><span class=\"variable\">$global</span>:Admin = <span class=\"variable\">$principal</span>.IsInRole( [System.Security.Principal.WindowsBuiltInRole]::Administrator)</span><br><span class=\"line\">Function prompt</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\"># 输出标准的提示信息:</span></span><br><span class=\"line\">    Write-Host (<span class=\"string\">\"PS \"</span> + $(get-location)) -nonewline</span><br><span class=\"line\">    <span class=\"comment\"># The rest depends on whether you have admin rights or not:</span></span><br><span class=\"line\">    If (<span class=\"variable\">$admin</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"variable\">$oldtitle</span> = <span class=\"variable\">$host</span>.ui.rawui.WindowTitle</span><br><span class=\"line\">        <span class=\"comment\"># 将\"Administrator: \" 显示在标题栏</span></span><br><span class=\"line\">        If (!<span class=\"variable\">$oldtitle</span>.StartsWith(<span class=\"string\">\"Administrator: \"</span>))</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"variable\">$host</span>.ui.rawui.WindowTitle =<span class=\"string\">\"Administrator: \"</span> + <span class=\"variable\">$oldtitle</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">#  Prompt结尾显示红色的尖括号</span></span><br><span class=\"line\">        Write-Host <span class=\"string\">\"&gt;\"</span> -nonewline -foregroundcolor Red</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     Else</span><br><span class=\"line\">     &#123;</span><br><span class=\"line\">        Write-Host <span class=\"string\">\"&gt;\"</span> -nonewline</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">     <span class=\"built_in\">return</span> <span class=\"string\">\" \"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\"># 运行显示结果</span></span><br><span class=\"line\">没有管理员权限时，标题栏文本：Windows Powershell</span><br><span class=\"line\">有管理员权限时，标题栏文本: Administrator ：管理员 : Windows Powershell</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h4 id=\"管道函数\"><a href=\"#管道函数\" class=\"headerlink\" title=\"管道函数\"></a>管道函数</h4><p>描述: 一个函数能够访问和进一步处理另外一条命令的结果，就是我们前面所讲的管道。</p>\n<p>Tips: 这里在补充一哈管道的两种模式，一种是顺序处理模式，一种是流处理模式</p>\n<ul>\n<li>(1) 低效率的顺序模式:<code>$input</code> 默认情况下你的函数不是真正支持管道，只能对前一个命令执行后的结果处理，即前一个命令执行的结果通过被自动保存在<code>$input变量(数组)</code>中，它可以包含许多元素，一个元素，甚至一个元素都没有，这取决于具体的环境。</li>\n</ul>\n<p><strong>基础示例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.简单的顺序模式</span></span><br><span class=\"line\">Function output &#123; <span class=\"variable\">$input</span> &#125;</span><br><span class=\"line\">PS &gt; 1,2,3 | output</span><br><span class=\"line\">PS &gt; dir | output</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.函数将会对管道的结果，做进一步处理例如标记指定目录中的特点格式的文件，并高亮标记后缀名为png的文件名为红色。</span></span><br><span class=\"line\">Function funPipeline</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"comment\"># 保存控制台当前的前景色</span></span><br><span class=\"line\">  <span class=\"variable\">$oldcolor</span> = <span class=\"variable\">$host</span>.ui.rawui.ForegroundColor</span><br><span class=\"line\">  <span class=\"comment\"># 通过循环逐条检查管道的结果</span></span><br><span class=\"line\">  Foreach (<span class=\"variable\">$element</span> <span class=\"keyword\">in</span> <span class=\"variable\">$input</span>)</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">      write-Host <span class=\"variable\">$element</span>.name</span><br><span class=\"line\">      <span class=\"comment\"># 如果后缀名为.png,设置为前景色为红色</span></span><br><span class=\"line\">      If (<span class=\"variable\">$element</span>.name.toLower().endsWith(<span class=\"string\">\".png\"</span>))</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"comment\"># 可用颜色: Black, DarkBlue, DarkGreen, DarkCyan, DarkRed, DarkMagenta, DarkYellow, Gray, DarkGray, Blue, Green, Cyan, Red, Magenta, Yellow, White</span></span><br><span class=\"line\">        <span class=\"variable\">$host</span>.ui.Rawui.ForegroundColor = <span class=\"string\">\"red\"</span></span><br><span class=\"line\">      &#125;Else&#123;</span><br><span class=\"line\">        <span class=\"comment\"># 否则恢复默认的前景色</span></span><br><span class=\"line\">        <span class=\"variable\">$host</span>.ui.Rawui.ForegroundColor = <span class=\"variable\">$oldcolor</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\"># 输出数组元素</span></span><br><span class=\"line\">      <span class=\"variable\">$element</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\"># 最后，重置控制台的前景色:</span></span><br><span class=\"line\">  <span class=\"variable\">$host</span>.ui.Rawui.ForegroundColor = <span class=\"variable\">$oldcolor</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 执行命令</span></span><br><span class=\"line\">[weiyigeek\\weiyigeek] - PS C:\\Users\\WeiyiGeek\\Pictures&gt; ls | funPipeline                        2021年4月18日 14:17:47</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2021/1/20210418142143.png\" alt=\"WeiyiGeek.管道函数的处理\" title=\"\" class=\"\">\n                <p>WeiyiGeek.管道函数的处理</p>\n            </figure></p>\n<ul>\n<li>(2) 高效率的流模式(过滤器): 针对之前funPipeline函数，你只需要<code>替换”function” 关键字 为 “filter”</code>，它就会开始流模式处理，这样你再也不用过分的担心忍受程序的无休止的响应和崩溃的危险。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.你也可以递归处理全盘目录，甚至处理极其庞大的数据。对于过滤器filters来说$input 一直都是一个独立的元素，所以在过滤器中$input一点用也没有的道理</span></span><br><span class=\"line\">filter filPipeline</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"comment\"># 保存控制台当前的前景色</span></span><br><span class=\"line\">  <span class=\"variable\">$oldcolor</span> = <span class=\"variable\">$host</span>.ui.rawui.ForegroundColor</span><br><span class=\"line\">  <span class=\"comment\"># 如果后缀名为.png,设置为前景色为红色</span></span><br><span class=\"line\">  <span class=\"comment\"># 当前的管道元素保存在 $_ 变量中</span></span><br><span class=\"line\">  If (<span class=\"variable\">$_</span>.name.toLower().endsWith(<span class=\"string\">\".png\"</span>))&#123;</span><br><span class=\"line\">    <span class=\"variable\">$host</span>.ui.Rawui.ForegroundColor = <span class=\"string\">\"Darkred\"</span></span><br><span class=\"line\">  &#125;Else&#123;</span><br><span class=\"line\">    <span class=\"comment\"># 否则恢复默认的前景色</span></span><br><span class=\"line\">    <span class=\"variable\">$host</span>.ui.Rawui.ForegroundColor = <span class=\"variable\">$oldcolor</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\"># 输出当前元素</span></span><br><span class=\"line\">  <span class=\"variable\">$_</span></span><br><span class=\"line\">  <span class=\"comment\"># 最后，重置控制台的前景色:</span></span><br><span class=\"line\">  <span class=\"variable\">$host</span>.ui.Rawui.ForegroundColor = <span class=\"variable\">$oldcolor</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Dir . -recurse | filPipeline</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br/></p>\n<p><strong>Q: 如何开发真正的管道函数</strong></p>\n<blockquote>\n<p>答: 如果一个函数内部使用了管道可以定义三个基础的代码块实现函数：第一步完成函数的初始化(<code>Begin</code>)，完成函数执行的预备步骤;第二步处理递归调用所得的结果(<code>Process</code>), 最后进行收尾工作(<code>End</code>);</p>\n</blockquote>\n<p>基础示例:<br><figure class=\"highlight powershell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">Function</span> filterPipeline</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"keyword\">begin</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\"># 记录控制台的背景色</span></span><br><span class=\"line\">    <span class=\"variable\">$oldcolor</span> = <span class=\"variable\">$host</span>.ui.rawui.ForegroundColor</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">process</span> </span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\"># 当前管道的元素 $_ 重点</span></span><br><span class=\"line\">    <span class=\"comment\"># 如果后缀名为 \".exe\",</span></span><br><span class=\"line\">    <span class=\"comment\"># 改变背景色为红色:</span></span><br><span class=\"line\">    <span class=\"keyword\">If</span> (<span class=\"variable\">$_</span>.name.toLower().endsWith(<span class=\"string\">\".exe\"</span>))</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"variable\">$host</span>.ui.Rawui.ForegroundColor = <span class=\"string\">\"red\"</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">Else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\"># 否则, 使用正常的背景色:</span></span><br><span class=\"line\">      <span class=\"variable\">$host</span>.ui.Rawui.ForegroundColor = <span class=\"variable\">$oldcolor</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\"># 输出当前的背景色</span></span><br><span class=\"line\">    <span class=\"variable\">$_</span></span><br><span class=\"line\">  &#125; </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">end</span> </span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\"># 最后,恢复控制台的背景色:</span></span><br><span class=\"line\">    <span class=\"variable\">$host</span>.ui.Rawui.ForegroundColor = <span class=\"variable\">$oldcolor</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 效果执行</span></span><br><span class=\"line\">ls C:\\WINDOWS\\System32\\ | filterPipeline</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p>Tips : 管道的低效率顺序模式在处理大容量数据时很容易出现问题，其结果是巨大的内存占用和进程等待。<br>Tips : 如果你的函数支持高效率的流模式，在处理管道结果时仅占用很小的内存。<br>Tips : 过滤器在函数中属于高级应用 (特殊的函数)，因为它可以立即处理管道结果的每一个元素, 但是过滤器必须每次重复执行预定义命令的结果。</p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"Development","path":"api/categories/Development.json"}],"tags":[{"name":"Powershell","path":"api/tags/Powershell.json"}]}