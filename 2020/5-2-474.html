<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ n2-kubernetesæ“ä½œå‘½ä»¤è¯¦ç»†ä¸€è§ˆ|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="k8s">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/2018/1-1-1.html"  >
                <i class="icon icon-lg icon-mortar-board"></i>
                å­¦ä¹ ä¹‹è·¯
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/sites"  >
                <i class="icon icon-lg icon-globe"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="/img/share-wechat.jpg" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="/img/video-account.jpg" target="_blank" >
                <i class="icon icon-lg icon-video-camera"></i>
                è§†é¢‘å·
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                å‹æƒ…é“¾æ¥
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>n2-kubernetesæ“ä½œå‘½ä»¤è¯¦ç»†ä¸€è§ˆ</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">n2-kubernetesæ“ä½œå‘½ä»¤è¯¦ç»†ä¸€è§ˆ</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-05-02T09:37:47.000Z" itemprop="datePublished" class="page-time">
  2020-05-02
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap" style="display: none;">
  <article id="post-è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/n2-kubernetesæ“ä½œå‘½ä»¤è¯¦ç»†ä¸€è§ˆ"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">n2-kubernetesæ“ä½œå‘½ä»¤è¯¦ç»†ä¸€è§ˆ</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-05-02 17:37:47" datetime="2020-05-02T09:37:47.000Z"  itemprop="datePublished">2020-05-02</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>



            

            


            
        </div>
        <span class="post-href" style="display: none;">|</span> 
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<a id="more"></a>
<h2 id="0x00-å‰è¨€ç®€è¿°"><a href="#0x00-å‰è¨€ç®€è¿°" class="headerlink" title="0x00 å‰è¨€ç®€è¿°"></a>0x00 å‰è¨€ç®€è¿°</h2><p>æè¿°: å­¦ä¹  Kubernetes æœ€é‡è¦çš„æ˜¯å…¶åŸºç¡€çš„ç†è®ºæ¦‚å¿µä»¥åŠå®è·µæ“ä½œ, è€Œå®é™…æ“ä½œåˆå¿…ä¸å¯å°‘çš„æ˜¯k8sç›¸å…³çš„å‘½ä»¤ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿è‡ªå·±ä»¥åŠè¯»è€…çš„æŸ¥é˜…ï¼Œå°†è‡ªå·±åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­æ‰€é‡çš„å‘½ä»¤è¿›è¡Œä¸€ä¸ªç®€å•çš„è®°å½•ï¼›</p>
<h2 id="0x01-Kubeadm-å‘½ä»¤-ç”¨æ¥åˆå§‹åŒ–é›†ç¾¤çš„æŒ‡ä»¤"><a href="#0x01-Kubeadm-å‘½ä»¤-ç”¨æ¥åˆå§‹åŒ–é›†ç¾¤çš„æŒ‡ä»¤" class="headerlink" title="0x01 Kubeadm å‘½ä»¤ - ç”¨æ¥åˆå§‹åŒ–é›†ç¾¤çš„æŒ‡ä»¤"></a>0x01 Kubeadm å‘½ä»¤ - ç”¨æ¥åˆå§‹åŒ–é›†ç¾¤çš„æŒ‡ä»¤</h2><p>æè¿°:è¯¥å‘½ä»¤æ˜¯å®‰è£…K8såçš„åŸºç¡€å‘½ä»¤å¯ä»¥è¿›è¡ŒK8sä¸»æˆ–è€…ä»èŠ‚ç‚¹çš„åˆå§‹åŒ–ï¼Œä»¥åŠèŠ‚ç‚¹åŠ å…¥ç®¡ç†;</p>
<h3 id="init-åˆå§‹åŒ–é…ç½®ç›¸å…³"><a href="#init-åˆå§‹åŒ–é…ç½®ç›¸å…³" class="headerlink" title="init - åˆå§‹åŒ–é…ç½®ç›¸å…³"></a>init - åˆå§‹åŒ–é…ç½®ç›¸å…³</h3><p>æè¿°:è¯¥å‘½ä»¤ç”¨æˆ·åˆå§‹åŒ–èŠ‚ç‚¹è®¾ç½®masterèŠ‚ç‚¹çš„æ§åˆ¶é¢æ¿ä»¥åŠç½‘ç»œç›¸å…³çš„è®¾ç½®;</p>
<p><strong>å‘½ä»¤å‚æ•°</strong></p>
<ul>
<li>phase : è¯¥å­å‘½ä»¤åˆ†é˜¶æ®µåˆ›å»ºæ§åˆ¶å¹³é¢èŠ‚ç‚¹ã€‚</li>
</ul>
<p>å‚æ•°è¯´æ˜:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">--apiserver-advertise-address string ï¼š API æœåŠ¡å™¨æ‰€å…¬å¸ƒçš„å…¶æ­£åœ¨ç›‘å¬çš„ IP åœ°å€ã€‚</span><br><span class="line">--apiserver-bind-port int32 ï¼š API æœåŠ¡å™¨ç»‘å®šçš„ç«¯å£, é»˜è®¤å€¼ï¼š6443</span><br><span class="line">--apiserver-cert-extra-sans stringSlice : ç”¨äº API Server æœåŠ¡è¯ä¹¦çš„å¯é€‰é™„åŠ ä¸»é¢˜å¤‡ç”¨åç§°ï¼ˆSANï¼‰,å¯ä»¥æ˜¯ IP åœ°å€å’Œ DNS åç§°ã€‚</span><br><span class="line">--certificate-key string ï¼šç”¨äºåŠ å¯† kubeadm-certs Secret ä¸­çš„æ§åˆ¶å¹³é¢è¯ä¹¦çš„å¯†é’¥ã€‚</span><br><span class="line"></span><br><span class="line">--control-plane-endpoint string ï¼š ä¸ºæ§åˆ¶å¹³é¢æŒ‡å®šä¸€ä¸ªç¨³å®šçš„ IP åœ°å€æˆ– DNS åç§°ã€‚</span><br><span class="line">--image-repository string ï¼šé€‰æ‹©ç”¨äºæ‹‰å–æ§åˆ¶å¹³é¢é•œåƒçš„å®¹å™¨ä»“åº“ï¼Œé»˜è®¤å€¼ï¼š<span class="string">"k8s.gcr.io"</span>, å›½å†…ä¸€èˆ¬è¦è®¾ç½®é•œåƒæºã€‚</span><br><span class="line">--kubernetes-version string ï¼šä¸ºæ§åˆ¶å¹³é¢é€‰æ‹©ä¸€ä¸ªç‰¹å®šçš„ Kubernetes ç‰ˆæœ¬ï¼Œé»˜è®¤å€¼ï¼š<span class="string">"stable-1"</span>ã€‚</span><br><span class="line">--cri-socket string ï¼šæŒ‡å®šè¦è¿æ¥çš„ CRI å¥—æ¥å­—çš„è·¯å¾„ã€‚</span><br><span class="line"></span><br><span class="line">--node-name string : æŒ‡å®šèŠ‚ç‚¹çš„åç§°ã€‚</span><br><span class="line"></span><br><span class="line">--pod-network-cidr string : æŒ‡æ˜ pod ç½‘ç»œå¯ä»¥ä½¿ç”¨çš„ IP åœ°å€æ®µ,å¦‚æœè®¾ç½®äº†è¿™ä¸ªå‚æ•°ï¼Œæ§åˆ¶å¹³é¢å°†ä¼šä¸ºæ¯ä¸€ä¸ªèŠ‚ç‚¹è‡ªåŠ¨åˆ†é… CIDRsã€‚(flannel-10.244.0.0/16)</span><br><span class="line">--service-cidr string : ä¸ºæœåŠ¡çš„è™šæ‹Ÿ IP åœ°å€å¦å¤–æŒ‡å®š IP åœ°å€æ®µ, é»˜è®¤å€¼ï¼š<span class="string">"10.96.0.0/12"</span></span><br><span class="line">--service-dns-domain string ï¼šä¸ºæœåŠ¡å¦å¤–æŒ‡å®šåŸŸåï¼Œé»˜è®¤å€¼ï¼š<span class="string">"cluster.local"</span></span><br><span class="line"></span><br><span class="line">--token string ï¼šç”¨äºå»ºç«‹æ§åˆ¶å¹³é¢èŠ‚ç‚¹ä¸å·¥ä½œèŠ‚ç‚¹é—´çš„åŒå‘é€šä¿¡,æ ¼å¼ä¸º`[a-z0-9]&#123;6&#125;\.[a-z0-9]&#123;16&#125;`-ç¤ºä¾‹`abcdef.0123456789abcdef`</span><br><span class="line">--token-ttl duration ï¼šä»¤ç‰Œè¢«è‡ªåŠ¨åˆ é™¤ä¹‹å‰çš„æŒç»­æ—¶é—´ï¼ˆä¾‹å¦‚1sã€2mã€3hï¼‰ï¼Œå¦‚æœè®¾ç½®ä¸º <span class="string">'0'</span>ï¼Œåˆ™ä»¤ç‰Œå°†æ°¸ä¸è¿‡æœŸ</span><br><span class="line">--upload-certs : å°†æ§åˆ¶å¹³é¢è¯ä¹¦ä¸Šä¼ åˆ° kubeadm-certs Secretã€‚</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>ç®€å•ç¤ºä¾‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹1.MasterèŠ‚ç‚¹åˆå§‹åŒ–é‡‡ç”¨æŒ‡å®šyamlé…ç½®æ–‡ä»¶è¿›è¡Œåˆå§‹åŒ–å‚æ•°çš„ä¼ å…¥ï¼Œä¸‹è¿°é…ç½®æ¸…å•å¯ç”± kubeadm config print init-defaults ç”Ÿæˆ</span></span><br><span class="line">cat &lt;&lt;EOF &gt; ./kubeadm-config.yaml</span><br><span class="line">apiVersion: kubeadm.k8s.io/v1beta2</span><br><span class="line">kind: ClusterConfiguration</span><br><span class="line">kubernetesVersion: v<span class="variable">$&#123;K8SVERSION&#125;</span></span><br><span class="line">imageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers</span><br><span class="line">controlPlaneEndpoint: <span class="string">"<span class="variable">$&#123;APISERVER_NAME&#125;</span>:6443"</span></span><br><span class="line">networking:</span><br><span class="line">  serviceSubnet: <span class="string">"10.99.0.0/16"</span></span><br><span class="line">  podSubnet: <span class="string">"<span class="variable">$&#123;POD_SUBNET&#125;</span>"</span></span><br><span class="line">  dnsDomain: <span class="string">"cluster.local"</span></span><br><span class="line">EOF</span><br><span class="line"><span class="comment"># æ‰§è¡Œå®Œæˆä¼šæ˜¾ç¤ºé›†ç¾¤masterèŠ‚ç‚¹åŠ å…¥ä»¥åŠNodeèŠ‚ç‚¹åŠ å…¥çš„å‘½ä»¤è¡Œ(æœ‰æ•ˆæœŸ24ä¸ªå°æ—¶)</span></span><br><span class="line">kubeadm init --config=kubeadm-config.yaml --upload-certs</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2.MasterèŠ‚ç‚¹åˆå§‹å¯ä»¥ç›´æ¥é‡‡ç”¨å‚æ•°è¿›è¡ŒæŒ‡å®š</span></span><br><span class="line">kubeadm init --apiserver-advertise-address=0.0.0.0 \               </span><br><span class="line">--apiserver-cert-extra-sans=127.0.0.1 \</span><br><span class="line">--image-repository=registry.aliyuncs.com/google_containers  \</span><br><span class="line">--ignore-preflight-errors=all \</span><br><span class="line">--kubernetes-version=v1.23.5  \</span><br><span class="line">--service-cidr=10.96.0.0/16  \</span><br><span class="line">--pod-network-cidr=10.244.0.0/16 \</span><br><span class="line">--token-ttl=24h0m0s \</span><br><span class="line">--control-plane-endpoint=192.168.2.175 \</span><br><span class="line">--upload-certs </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹3.è·å¾—åŠ å…¥æ§åˆ¶å¹³å°çš„è¯ä¹¦ (ä½¿ç”¨æ­¤å‘½ä»¤è°ƒç”¨initå·¥ä½œæµçš„å•ä¸ªé˜¶æ®µå¹¶ä¸”ä¸Šä¼ è¯ä¹¦åˆ°kubeadm-certs)</span></span><br><span class="line">sudo kubeadm init phase upload-certs --upload-certs</span><br><span class="line">sudo kubeadm init phase control-plane all --config=configfile.yaml</span><br><span class="line">sudo kubeadm init phase etcd <span class="built_in">local</span> --config=configfile.yaml</span><br><span class="line"><span class="comment"># ä½ ç°åœ¨å¯ä»¥ä¿®æ”¹æ§åˆ¶å¹³é¢å’Œ etcd æ¸…å•æ–‡ä»¶</span></span><br><span class="line">sudo kubeadm init --skip-phases=control-plane,etcd --config=configfile.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹4.ä»¥ä¸‹é˜¶æ®µå‘½ä»¤å¯ç”¨äºè¯ä¹¦åˆ°æœŸåé‡æ–°ä¸Šä¼ è¯ä¹¦</span></span><br><span class="line"><span class="comment"># å¦‚æœæœªå°†å‚æ•° --certificate-key ä¼ é€’ç»™ kubeadm init å’Œ kubeadm init phase upload-certsï¼Œ åˆ™ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ–°å¯†é’¥ã€‚</span></span><br><span class="line">kubeadm init phase upload-certs --upload-certs --certificate-key=SOME_VALUE --config=SOME_YAML_FILE</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="token-ç”Ÿæˆè®¤è¯ç›¸å…³ä¿¡æ¯"><a href="#token-ç”Ÿæˆè®¤è¯ç›¸å…³ä¿¡æ¯" class="headerlink" title="token - ç”Ÿæˆè®¤è¯ç›¸å…³ä¿¡æ¯"></a>token - ç”Ÿæˆè®¤è¯ç›¸å…³ä¿¡æ¯</h3><p><strong>å‘½ä»¤å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Available Commands:</span></span><br><span class="line">create      åˆ›å»ºæœåŠ¡å™¨ä¸Šçš„å¼•å¯¼ä»¤ç‰Œ</span><br><span class="line">delete      åˆ é™¤æœåŠ¡å™¨ä¸Šçš„å¼•å¯¼ä»¤ç‰Œ</span><br><span class="line">generate    ç”Ÿæˆå¹¶æ‰“å°å¼•å¯¼ä»¤ç‰Œï¼Œä½†ä¸è¦åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºå®ƒ</span><br><span class="line">list        åˆ—å‡ºæœåŠ¡å™¨ä¸Šçš„å¼•å¯¼ä»¤ç‰Œ</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸¸ç”¨å­å‘½ä»¤</span></span><br><span class="line">--dry-run : æ˜¯å¦å¯ç”¨å¹²è¿è¡Œæ¨¡å¼(æ¨¡æ‹Ÿ)</span><br><span class="line">--<span class="built_in">print</span>-join-command ï¼šcreate - æ‰“å°èŠ‚ç‚¹åŠ å…¥å‘½ä»¤</span><br></pre></td></tr></table></figure></p>
<p><strong>åŸºç¡€å®ä¾‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹1.èŠ‚ç‚¹åˆå§‹åŒ–å‘½ä»¤è¡Œç”Ÿæˆ(æœ‰æ•ˆæœŸä¸¤ä¸ªå°æ—¶ï¼Œtokenæœ‰æ•ˆæœŸ24h)</span></span><br><span class="line">kubeadm token create --<span class="built_in">print</span>-join-command</span><br><span class="line">kubeadm token create $(kubeadm token generate) --<span class="built_in">print</span>-join-command --ttl=0 <span class="comment">#æ–¹å¼2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2.æŸ¥çœ‹ç”Ÿæˆçš„tokenæœ‰æ•ˆæœŸï¼ˆé€šå¸¸24Hï¼‰</span></span><br><span class="line">kubeadm token list</span><br><span class="line">  <span class="comment"># TOKEN                   TTL  EXPIRES                     USAGES                   DESCRIPTION    EXTRA GROUPS</span></span><br><span class="line">  <span class="comment"># 2af75y.5fio8knxu9e2ygvz 23h  2020-06-25T09:28:19+08:00   authentication,signing   &lt;none&gt;         system:bootstrappers:kubeadm:default-node-token</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹3.ç”Ÿæˆä¸€ä¸ªä»¤ç‰Œ</span></span><br><span class="line">kubeadm token generate</span><br><span class="line">  <span class="comment"># w9tc5q.keah29ljmqonx00n</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="config-åŸºç¡€ç¯å¢ƒä¾èµ–é…ç½®"><a href="#config-åŸºç¡€ç¯å¢ƒä¾èµ–é…ç½®" class="headerlink" title="config - åŸºç¡€ç¯å¢ƒä¾èµ–é…ç½®"></a>config - åŸºç¡€ç¯å¢ƒä¾èµ–é…ç½®</h3><p>æè¿°: è¯¥å‘½ä»¤å¯ä»¥æ˜¾ç¤ºæˆ–è€…æ‰“å°é›†ç¾¤åˆå§‹åŒ–ç›¸å…³é…ç½®ä¿¡æ¯, å…¶æ¬¡å¯ä»¥è¿›è¡Œç‰ˆæœ¬è¿ç§»ï¼Œæœ€åç”¨äºåˆ—ä¸¾å¹¶æ‹‰å– kubeadm æ‰€éœ€çš„é•œåƒã€‚</p>
<p><strong>å‘½ä»¤å‚æ•°:</strong></p>
<ul>
<li>images [list|pull] : æŸ¥çœ‹å’Œæ‹‰å–kubeadmåˆå§‹åŒ–æ‰€éœ€é•œåƒã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³é”®å‚æ•°</span></span><br><span class="line">--config string : kubeadm é…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚</span><br><span class="line">--image-repository string : é€‰æ‹©è¦ä»ä¸­æ‹‰å–æ§åˆ¶å¹³é¢é•œåƒçš„å®¹å™¨ä»“åº“</span><br><span class="line">--kubernetes-version string : é€‰æ‹©ä¸€ä¸ªç‰¹å®šçš„ Kubernetes ç‰ˆæœ¬</span><br><span class="line">-o, --experimental-output string  é»˜è®¤å€¼ï¼š<span class="string">"text"</span>, å¯é€‰ text|json|yaml|go-template|go-template-file|template|templatefile|jsonpath|jsonpath-as-json|jsonpath-file</span><br><span class="line"><span class="comment"># pull </span></span><br><span class="line">--cri-socket string : è¦è¿æ¥çš„ CRI å¥—æ¥å­—çš„è·¯å¾„, ä»…å½“å®‰è£…äº†å¤šä¸ªCRIæˆ–å…·æœ‰éæ ‡å‡†CRIæ’æ§½æ—¶ï¼Œæ‰ä½¿ç”¨æ­¤é€‰é¡¹.</span><br></pre></td></tr></table></figure>
<ul>
<li>print : æ‰“å°é›†ç¾¤Masteråˆå§‹åŒ–æˆ–è€…NodeèŠ‚ç‚¹åŠ å…¥æ‰€æä¾›çš„é…ç½®ä¿¡æ¯ã€‚</li>
<li>migrate : å…è®¸å°†æœ¬åœ°æ—§ç‰ˆæœ¬çš„é…ç½®å¯¹è±¡è½¬æ¢ä¸ºæœ€æ–°æ”¯æŒçš„ç‰ˆæœ¬ï¼Œè€Œæ— éœ€å˜æ›´é›†ç¾¤ä¸­çš„ä»»ä½•å†…å®¹ã€‚</li>
</ul>
<p><br></p>
<p><strong>åŸºç¡€å®ä¾‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹1.æŒ‡å®škubernetesç‰ˆæœ¬æŸ¥çœ‹ä¾èµ–é•œåƒï¼Œå¹¶æŒ‡å®šä»“åº“æº;</span></span><br><span class="line">kubeadm config images list --image-repository mirrorgcrio  --kubernetes-version=1.18.3</span><br><span class="line"><span class="comment"># mirrorgcrio/kube-apiserver:v1.18.3</span></span><br><span class="line">.....</span><br><span class="line"><span class="comment"># mirrorgcrio/coredns:1.6.7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2.æ‹‰å–æŒ‡å®šç‰ˆæœ¬ä»¥åŠé•œåƒä»“åº“(ç”±äºå›½å†…ç¯å¢ƒæ— æ³•è®¿é—® k8s.gcr.ioï¼Œæ­¤å¤„æœ€æ–°æ¨èè®¾ç½®ä¸ºé˜¿é‡Œäº‘é•œåƒ )</span></span><br><span class="line">kubeadm config images pull --image-repository  registry.cn-hangzhou.aliyuncs.com/google_containers --kubernetes-version=1.23.5</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(kubeadm config images list --kubernetes-version=1.23.5 --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers -v 5);<span class="keyword">do</span></span><br><span class="line">  ctr -n k8s.io images pull <span class="variable">$&#123;i&#125;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹3.é›†ç¾¤åˆå§‹åŒ–é…ç½®ä¿¡æ¯æŸ¥çœ‹</span></span><br><span class="line">kubeadm config view </span><br><span class="line">$ kubectl get cm -o yaml -n kube-system kubeadm-config <span class="comment"># å®˜æ–¹å»ºè®®</span></span><br><span class="line"><span class="comment"># Command "view" is deprecated, This command is deprecated and will be removed in a future release, please use 'kubectl get cm -o yaml -n kube-system kubeadm-config' to get the kubeadm config directly.</span></span><br><span class="line"><span class="comment"># apiServer:</span></span><br><span class="line"><span class="comment">#   extraArgs:</span></span><br><span class="line"><span class="comment">#     authorization-mode: Node,RBAC</span></span><br><span class="line"><span class="comment">#   timeoutForControlPlane: 4m0s</span></span><br><span class="line"><span class="comment"># apiVersion: kubeadm.k8s.io/v1beta2</span></span><br><span class="line"><span class="comment"># certificatesDir: /etc/kubernetes/pki</span></span><br><span class="line"><span class="comment"># clusterName: kubernetes</span></span><br><span class="line"><span class="comment"># controlPlaneEndpoint: weiyigeek.k8s:6443</span></span><br><span class="line"><span class="comment"># controllerManager: &#123;&#125;</span></span><br><span class="line"><span class="comment"># dns:</span></span><br><span class="line"><span class="comment">#   type: CoreDNS</span></span><br><span class="line"><span class="comment"># etcd:</span></span><br><span class="line"><span class="comment">#   local:</span></span><br><span class="line"><span class="comment">#     dataDir: /var/lib/etcd</span></span><br><span class="line"><span class="comment"># imageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers</span></span><br><span class="line"><span class="comment"># kind: ClusterConfiguration</span></span><br><span class="line"><span class="comment"># kubernetesVersion: v1.19.3</span></span><br><span class="line"><span class="comment"># networking:</span></span><br><span class="line"><span class="comment">#   dnsDomain: cluster.local</span></span><br><span class="line"><span class="comment">#   podSubnet: 10.244.0.0/16</span></span><br><span class="line"><span class="comment">#   serviceSubnet: 10.96.0.0/12</span></span><br><span class="line"><span class="comment"># scheduler: &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹4.æ‰“å°ç”¨äº 'kubeadm init' çš„é»˜è®¤ init é…ç½®å¯¹è±¡èµ„æºæ¸…å•ï¼ˆå³é›†ç¾¤MasterèŠ‚ç‚¹åˆå§‹åŒ–æ¸…å•ï¼‰</span></span><br><span class="line">kubeadm config <span class="built_in">print</span> init-defaults</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹5.æ‰“å°ç”¨äº 'kubeadm join' çš„é»˜è®¤ join é…ç½®å¯¹è±¡ã€‚ï¼ˆå³é›†ç¾¤NodeèŠ‚ç‚¹åˆå§‹åŒ–æ¸…å•ï¼‰</span></span><br><span class="line">kubeadm config <span class="built_in">print</span> join-defaults</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹6.å°†æœ¬åœ°æ—§ç‰ˆæœ¬çš„é…ç½®å¯¹è±¡è½¬æ¢ä¸ºæœ€æ–°æ”¯æŒçš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚v1.23.1ç‰ˆæœ¬å˜æˆå½“å‰æœ€æ–°çš„v1.23.5ç‰ˆæœ¬</span></span><br><span class="line">$ kubeadm config migrate --new-config è¾“å‡ºæ–°é…ç½®æ–‡ä»¶ --old-config è¯»å–æ—§åˆå§‹åŒ–é…ç½®æ–‡ä»¶(å¿…é¡»)</span><br><span class="line">$ kubeadm config migrate --old-config=kubeadm-config-init.yml</span><br><span class="line">apiVersion: kubeadm.k8s.io/v1beta3</span><br><span class="line">bootstrapTokens:</span><br><span class="line">- groups:</span><br><span class="line">  - system:bootstrappers:kubeadm:default-node-token</span><br><span class="line">  token: abcdef.0123456789abcdef</span><br><span class="line">  ttl: 24h0m0s</span><br><span class="line">  usages:</span><br><span class="line">  - signing</span><br><span class="line">  - authentication</span><br><span class="line">kind: InitConfiguration</span><br><span class="line">localAPIEndpoint:</span><br><span class="line">  advertiseAddress: 10.10.107.225</span><br><span class="line">  bindPort: 6443</span><br><span class="line">nodeRegistration:</span><br><span class="line">  criSocket: /run/containerd/containerd.sock</span><br><span class="line">  imagePullPolicy: IfNotPresent</span><br><span class="line">  name: node</span><br><span class="line">  taints:</span><br><span class="line">  - effect: NoSchedule</span><br><span class="line">    key: node-role.kubernetes.io/master</span><br><span class="line">---</span><br><span class="line">apiServer:</span><br><span class="line">  timeoutForControlPlane: 4m0s</span><br><span class="line">apiVersion: kubeadm.k8s.io/v1beta3</span><br><span class="line">certificatesDir: /etc/kubernetes/pki</span><br><span class="line">clusterName: kubernetes</span><br><span class="line">controllerManager: &#123;&#125;</span><br><span class="line">dns: &#123;&#125;</span><br><span class="line">etcd:</span><br><span class="line">  <span class="built_in">local</span>:</span><br><span class="line">    dataDir: /var/lib/etcd</span><br><span class="line">imageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers</span><br><span class="line">kind: ClusterConfiguration</span><br><span class="line">kubernetesVersion: v1.23.5</span><br><span class="line">networking:</span><br><span class="line">  dnsDomain: cluster.local</span><br><span class="line">  serviceSubnet: 10.96.0.0/12</span><br><span class="line">scheduler: &#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="join-é›†ç¾¤æˆ–è€…èŠ‚ç‚¹åŠ å…¥åˆå§‹åŒ–"><a href="#join-é›†ç¾¤æˆ–è€…èŠ‚ç‚¹åŠ å…¥åˆå§‹åŒ–" class="headerlink" title="join - é›†ç¾¤æˆ–è€…èŠ‚ç‚¹åŠ å…¥åˆå§‹åŒ–"></a>join - é›†ç¾¤æˆ–è€…èŠ‚ç‚¹åŠ å…¥åˆå§‹åŒ–</h3><p><strong>å‘½ä»¤å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--control-plane : æ§åˆ¶é¢æ¿åœ°å€</span><br><span class="line">--certificate-key : è¯ä¹¦å¯†é’¥</span><br><span class="line">--discovery-token-ca-cert-hash : CAè¯ä¹¦SHA256å“ˆå¸Œå€¼</span><br><span class="line">--token : bootstrap è®¤è¯ token</span><br><span class="line">--cri-socket string : CRIå¥—æ¥å­—çš„è·¯å¾„, å½“ç³»ç»Ÿä¸­å­˜åœ¨éæ ‡å‡†æˆ–è€…å¤šä¸ªCRIå¥—æ¥å­—æ—¶ä½¿ç”¨è¯¥é€‰é¡¹ã€‚</span><br><span class="line">--config string ï¼škubeadm é…ç½®æ–‡ä»¶çš„è·¯å¾„</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>åŸºç¡€ä½¿ç”¨:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹1.Masterä¸»èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤æ§åˆ¶å¹³é¢</span></span><br><span class="line">kubeadm join apiserver.test:6443 --token hzlzrr.uwuegx4locpu36oc \</span><br><span class="line">  --discovery-token-ca-cert-hash sha256:4cbe428cb3503277be9fbcf3a99de82a97397a624dd94d4270c4eed1b861f951 \</span><br><span class="line">  --control-plane --certificate-key 28b178f04afae3770aa92add0206650b2359dd61424f127a6d44142dd15a280d</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2.Nodeå·¥ä½œèŠ‚ç‚¹çš„åŠ å…¥åˆ°é›†ç¾¤æ§åˆ¶å¹³é¢ , å¹¶æŒ‡å®šCRIçš„å¥—æ¥å­—ä¸º /run/containerd/containerd.sockã€‚</span></span><br><span class="line">kubeadm join apiserver.test:6443 --token hzlzrr.uwuegx4locpu36oc \</span><br><span class="line">  --discovery-token-ca-cert-hash sha256:4cbe428cb3503277be9fbcf3a99de82a97397a624dd94d4270c4eed1b861f951 \</span><br><span class="line">  --cri-socket /run/containerd/containerd.sock</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹3.ä½¿ç”¨ kubeadm é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®åŠ å…¥çš„èŠ‚ç‚¹ä¿¡æ¯ã€‚</span></span><br><span class="line">kubeadm join --config node.yaml</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="reset-èŠ‚ç‚¹é‡ç½®æ“ä½œ"><a href="#reset-èŠ‚ç‚¹é‡ç½®æ“ä½œ" class="headerlink" title="reset - èŠ‚ç‚¹é‡ç½®æ“ä½œ"></a>reset - èŠ‚ç‚¹é‡ç½®æ“ä½œ</h3><p>åŸºç¡€å®ä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡ç½®WorkersèŠ‚ç‚¹æ“ä½œ</span></span><br><span class="line">kubeadm reset -f</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="upgrade-èŠ‚ç‚¹æ›´æ–°æ“ä½œ"><a href="#upgrade-èŠ‚ç‚¹æ›´æ–°æ“ä½œ" class="headerlink" title="upgrade - èŠ‚ç‚¹æ›´æ–°æ“ä½œ"></a>upgrade - èŠ‚ç‚¹æ›´æ–°æ“ä½œ</h3><p>æè¿°: ä½¿ç”¨æ­¤å‘½ä»¤å°†é›†ç¾¤é¡ºåˆ©å‡çº§åˆ°æ–°ç‰ˆæœ¬</p>
<p><strong>åŸºç¡€è¯­æ³•:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage:</span></span><br><span class="line">  kubeadm upgrade [flags]</span><br><span class="line">  kubeadm upgrade [<span class="built_in">command</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Commands:</span></span><br><span class="line">applyï¼šå°†Kubernetesé›†ç¾¤å‡çº§åˆ°æŒ‡å®šçš„ç‰ˆæœ¬</span><br><span class="line">diffï¼šæ˜¾ç¤ºå°†åº”ç”¨äºç°æœ‰é™æ€podæ¸…å•çš„å·®å¼‚ã€‚å¦è¯·å‚è§ï¼š `kubeadm upgrade apply --dry-run`</span><br><span class="line">nodeï¼šç¾¤é›†ä¸­èŠ‚ç‚¹çš„å‡çº§å‘½ä»¤</span><br><span class="line">planï¼šæ£€æŸ¥å¯å‡çº§åˆ°çš„ç‰ˆæœ¬ï¼Œå¹¶éªŒè¯å½“å‰é›†ç¾¤æ˜¯å¦å¯å‡çº§ã€‚è¦è·³è¿‡internetæ£€æŸ¥ï¼Œè¯·ä¼ å…¥å¯é€‰çš„[version]å‚æ•°</span><br><span class="line"></span><br><span class="line"><span class="comment"># Flags:</span></span><br><span class="line">--add-dir-header           If <span class="literal">true</span>, adds the file directory to the header of the <span class="built_in">log</span> messages</span><br><span class="line">--<span class="built_in">log</span>-file string          If non-empty, use this <span class="built_in">log</span> file</span><br><span class="line">--<span class="built_in">log</span>-file-max-size uint   Defines the maximum size a <span class="built_in">log</span> file can grow to. Unit is megabytes. If the value is 0, the maximum file size is unlimited. (default 1800)</span><br><span class="line">--rootfs string            [EXPERIMENTAL] The path to the <span class="string">'real'</span> host root filesystem.</span><br><span class="line">--skip-headers             If <span class="literal">true</span>, avoid header prefixes <span class="keyword">in</span> the <span class="built_in">log</span> messages</span><br><span class="line">--skip-log-headers         If <span class="literal">true</span>, avoid headers when opening <span class="built_in">log</span> files</span><br><span class="line">-v, --v Level              number <span class="keyword">for</span> the <span class="built_in">log</span> level verbosity</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>åŸºç¡€ç¤ºä¾‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0.æŸ¥çœ‹æ£€æŸ¥å¯å‡çº§åˆ°çš„ç‰ˆæœ¬</span></span><br><span class="line">kubeadm upgrade plan</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.æ›´æ–°é›†ç¾¤ä¸ºæŒ‡å®šç‰ˆæœ¬v1.18.5</span></span><br><span class="line">kubeadm upgrade apply v1.18.5 --config kubeadm-config.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ä¸è¦æ›´æ”¹ä»»ä½•çŠ¶æ€ï¼Œåªè¾“å‡ºå°†è¦æ‰§è¡Œçš„æ“ä½œã€‚</span></span><br><span class="line">kubeadm upgrade node --dry-run</span><br><span class="line">  <span class="comment"># apiVersion: v1</span></span><br><span class="line">  <span class="comment"># data:</span></span><br><span class="line">  <span class="comment">#   ClusterConfiguration: |</span></span><br><span class="line">  <span class="comment">#     apiServer:</span></span><br><span class="line">  <span class="comment">#       certSANs:</span></span><br><span class="line">  <span class="comment">#       - 192.168.12.226</span></span><br><span class="line">  <span class="comment">#       extraArgs:</span></span><br><span class="line">  <span class="comment">#         authorization-mode: Node,RBAC</span></span><br><span class="line">  <span class="comment"># .....................................</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="0x02-Kubelet-å‘½ä»¤-åœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šç”¨æ¥å¯åŠ¨-pod-å’Œå®¹å™¨ç­‰ã€‚"><a href="#0x02-Kubelet-å‘½ä»¤-åœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šç”¨æ¥å¯åŠ¨-pod-å’Œå®¹å™¨ç­‰ã€‚" class="headerlink" title="0x02 Kubelet å‘½ä»¤ - åœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šç”¨æ¥å¯åŠ¨ pod å’Œå®¹å™¨ç­‰ã€‚"></a>0x02 Kubelet å‘½ä»¤ - åœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šç”¨æ¥å¯åŠ¨ pod å’Œå®¹å™¨ç­‰ã€‚</h2><hr>
<h2 id="0x03-Kubectl-å‘½ä»¤-ç”¨æ¥ä¸é›†ç¾¤é€šä¿¡çš„å‘½ä»¤è¡Œå·¥å…·"><a href="#0x03-Kubectl-å‘½ä»¤-ç”¨æ¥ä¸é›†ç¾¤é€šä¿¡çš„å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="0x03 Kubectl å‘½ä»¤ - ç”¨æ¥ä¸é›†ç¾¤é€šä¿¡çš„å‘½ä»¤è¡Œå·¥å…·"></a>0x03 Kubectl å‘½ä»¤ - ç”¨æ¥ä¸é›†ç¾¤é€šä¿¡çš„å‘½ä»¤è¡Œå·¥å…·</h2><p>æè¿°:è¯¥å‘½ä»¤å®é™…ä¸Šæ˜¯æ“ä½œ Kubernetes å¯¹è±¡ï¼ˆåˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤ï¼‰çš„æ–¹æ³•;<br><a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands</a></p>
<p>Kubectl è‡ªåŠ¨è¡¥å…¨:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è‡ªåŠ¨è¡¥å…¨</span></span><br><span class="line"><span class="built_in">source</span> &lt;(kubectl completion bash) <span class="comment"># åœ¨ bash ä¸­è®¾ç½®å½“å‰ shell çš„è‡ªåŠ¨è¡¥å…¨ï¼Œè¦å…ˆå®‰è£… bash-completion åŒ…</span></span><br><span class="line"><span class="comment"># åœ¨æ‚¨çš„ bash shell ä¸­æ°¸ä¹…çš„æ·»åŠ è‡ªåŠ¨è¡¥å…¨</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"source &lt;(kubectl completion bash)"</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="comment"># åœ¨æ‚¨çš„ zsh shell ä¸­æ°¸ä¹…çš„æ·»åŠ è‡ªåŠ¨è¡¥å…¨</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"if [ <span class="variable">$commands</span>[kubectl] ]; then source &lt;(kubectl completion zsh); fi"</span> &gt;&gt; ~/.zshrc</span><br><span class="line"></span><br><span class="line"><span class="comment">#åŠ å…¥åˆ°å¯åŠ¨é…ç½®æ–‡ä»¶ä¸­ä¸º kubectl ä½¿ç”¨ä¸€ä¸ªé€Ÿè®°åˆ«åè¯¥åˆ«åä¹Ÿå¯ä»¥ä¸ completion ä¸€èµ·ä½¿ç”¨;</span></span><br><span class="line">cat &gt;&gt;  ~/.bashrc &lt;&lt;<span class="string">'END'</span></span><br><span class="line"><span class="built_in">alias</span> k=kubectl</span><br><span class="line">complete -F __start_kubectl k</span><br><span class="line">END</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨æ¡ˆä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master-01 ~]$ k get cs</span><br><span class="line">NAME                 STATUS    MESSAGE             ERROR</span><br><span class="line">scheduler            Healthy   ok</span><br><span class="line">controller-manager   Healthy   ok</span><br><span class="line">etcd-2               Healthy   &#123;<span class="string">"health"</span>:<span class="string">"true"</span>&#125;</span><br><span class="line">etcd-1               Healthy   &#123;<span class="string">"health"</span>:<span class="string">"true"</span>&#125;</span><br><span class="line">etcd-0               Healthy   &#123;<span class="string">"health"</span>:<span class="string">"true"</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="api-versions-å½“å‰å¯ç”¨é›†ç¾¤æ”¯æŒçš„ç‰ˆæœ¬"><a href="#api-versions-å½“å‰å¯ç”¨é›†ç¾¤æ”¯æŒçš„ç‰ˆæœ¬" class="headerlink" title="api-versions - å½“å‰å¯ç”¨é›†ç¾¤æ”¯æŒçš„ç‰ˆæœ¬"></a>api-versions - å½“å‰å¯ç”¨é›†ç¾¤æ”¯æŒçš„ç‰ˆæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl api-versions</span><br><span class="line"><span class="comment"># admissionregistration.k8s.io/v1</span></span><br><span class="line"><span class="comment"># admissionregistration.k8s.io/v1beta1</span></span><br><span class="line"><span class="comment"># apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="comment"># apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="comment"># apiregistration.k8s.io/v1</span></span><br><span class="line"><span class="comment"># apiregistration.k8s.io/v1beta1</span></span><br><span class="line"><span class="comment"># apps/v1</span></span><br><span class="line"><span class="comment"># authentication.k8s.io/v1</span></span><br><span class="line"><span class="comment"># authentication.k8s.io/v1beta1</span></span><br><span class="line"><span class="comment"># authorization.k8s.io/v1</span></span><br><span class="line"><span class="comment"># authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="comment"># autoscaling/v1</span></span><br><span class="line"><span class="comment"># autoscaling/v2beta1</span></span><br><span class="line"><span class="comment"># autoscaling/v2beta2</span></span><br><span class="line"><span class="comment"># batch/v1</span></span><br><span class="line"><span class="comment"># batch/v1beta1</span></span><br><span class="line"><span class="comment"># certificates.k8s.io/v1beta1</span></span><br><span class="line"><span class="comment"># coordination.k8s.io/v1</span></span><br><span class="line"><span class="comment"># coordination.k8s.io/v1beta1</span></span><br><span class="line"><span class="comment"># crd.projectcalico.org/v1</span></span><br><span class="line"><span class="comment"># discovery.k8s.io/v1beta1</span></span><br><span class="line"><span class="comment"># events.k8s.io/v1beta1</span></span><br><span class="line"><span class="comment"># extensions/v1beta1</span></span><br><span class="line"><span class="comment"># networking.k8s.io/v1</span></span><br><span class="line"><span class="comment"># networking.k8s.io/v1beta1</span></span><br><span class="line"><span class="comment"># node.k8s.io/v1beta1</span></span><br><span class="line"><span class="comment"># policy/v1beta1</span></span><br><span class="line"><span class="comment"># rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="comment"># rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="comment"># scheduling.k8s.io/v1</span></span><br><span class="line"><span class="comment"># scheduling.k8s.io/v1beta1</span></span><br><span class="line"><span class="comment"># storage.k8s.io/v1</span></span><br><span class="line"><span class="comment"># storage.k8s.io/v1beta1</span></span><br><span class="line"><span class="comment"># v1</span></span><br></pre></td></tr></table></figure>
<h3 id="api-resources-è·å¾—æ”¯æŒèµ„æºçš„å®Œæ•´åˆ—è¡¨"><a href="#api-resources-è·å¾—æ”¯æŒèµ„æºçš„å®Œæ•´åˆ—è¡¨" class="headerlink" title="api-resources - è·å¾—æ”¯æŒèµ„æºçš„å®Œæ•´åˆ—è¡¨"></a>api-resources - è·å¾—æ”¯æŒèµ„æºçš„å®Œæ•´åˆ—è¡¨</h3><p>æè¿°:åœ¨å¿…é¡»æŒ‡å®šè¦æè¿°çš„èµ„æºç±»å‹çš„æ—¶å€™ä½¿ç”¨ï¼Œæ³¨æ„å¯ä»¥çœ‹å‡ºèµ„æºå¯¹è±¡æ˜¯å¦æ”¯æŒåç§°ç©ºé—´ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">kubectl api-resources</span><br><span class="line">NAME                              SHORTNAMES   APIGROUP                       NAMESPACED   KIND</span><br><span class="line">bindings                                                                      <span class="literal">true</span>         Binding</span><br><span class="line">componentstatuses                 cs                                          <span class="literal">false</span>        ComponentStatus</span><br><span class="line">configmaps                        cm                                          <span class="literal">true</span>         ConfigMap</span><br><span class="line">endpoints                         ep                                          <span class="literal">true</span>         Endpoints</span><br><span class="line">events                            ev                                          <span class="literal">true</span>         Event</span><br><span class="line">limitranges                       limits                                      <span class="literal">true</span>         LimitRange</span><br><span class="line">namespaces                        ns                                          <span class="literal">false</span>        Namespace</span><br><span class="line">nodes                             no                                          <span class="literal">false</span>        Node</span><br><span class="line">persistentvolumeclaims            pvc                                         <span class="literal">true</span>         PersistentVolumeClaim</span><br><span class="line">persistentvolumes                 pv                                          <span class="literal">false</span>        PersistentVolume</span><br><span class="line">pods                              po                                          <span class="literal">true</span>         Pod</span><br><span class="line">podtemplates                                                                  <span class="literal">true</span>         PodTemplate</span><br><span class="line">replicationcontrollers            rc                                          <span class="literal">true</span>         ReplicationController</span><br><span class="line">resourcequotas                    quota                                       <span class="literal">true</span>         ResourceQuota</span><br><span class="line">secrets                                                                       <span class="literal">true</span>         Secret</span><br><span class="line">serviceaccounts                   sa                                          <span class="literal">true</span>         ServiceAccount</span><br><span class="line">services                          svc                                         <span class="literal">true</span>         Service</span><br><span class="line">mutatingwebhookconfigurations                  admissionregistration.k8s.io   <span class="literal">false</span>        MutatingWebhookConfiguration</span><br><span class="line">validatingwebhookconfigurations                admissionregistration.k8s.io   <span class="literal">false</span>        ValidatingWebhookConfiguration</span><br><span class="line">customresourcedefinitions         crd,crds     apiextensions.k8s.io           <span class="literal">false</span>        CustomResourceDefinition</span><br><span class="line">apiservices                                    apiregistration.k8s.io         <span class="literal">false</span>        APIService</span><br><span class="line">controllerrevisions                            apps                           <span class="literal">true</span>         ControllerRevision</span><br><span class="line">daemonsets                        ds           apps                           <span class="literal">true</span>         DaemonSet</span><br><span class="line">deployments                       deploy       apps                           <span class="literal">true</span>         Deployment</span><br><span class="line">replicasets                       rs           apps                           <span class="literal">true</span>         ReplicaSet</span><br><span class="line">statefulsets                      sts          apps                           <span class="literal">true</span>         StatefulSet</span><br><span class="line">tokenreviews                                   authentication.k8s.io          <span class="literal">false</span>        TokenReview</span><br><span class="line">localsubjectaccessreviews                      authorization.k8s.io           <span class="literal">true</span>         LocalSubjectAccessReview</span><br><span class="line">selfsubjectaccessreviews                       authorization.k8s.io           <span class="literal">false</span>        SelfSubjectAccessReview</span><br><span class="line">selfsubjectrulesreviews                        authorization.k8s.io           <span class="literal">false</span>        SelfSubjectRulesReview</span><br><span class="line">subjectaccessreviews                           authorization.k8s.io           <span class="literal">false</span>        SubjectAccessReview</span><br><span class="line">horizontalpodautoscalers          hpa          autoscaling                    <span class="literal">true</span>         HorizontalPodAutoscaler</span><br><span class="line">cronjobs                          cj           batch                          <span class="literal">true</span>         CronJob</span><br><span class="line"><span class="built_in">jobs</span>                                           batch                          <span class="literal">true</span>         Job</span><br><span class="line">certificatesigningrequests        csr          certificates.k8s.io            <span class="literal">false</span>        CertificateSigningRequest</span><br><span class="line">leases                                         coordination.k8s.io            <span class="literal">true</span>         Lease</span><br><span class="line">bgpconfigurations                              crd.projectcalico.org          <span class="literal">false</span>        BGPConfiguration</span><br><span class="line">bgppeers                                       crd.projectcalico.org          <span class="literal">false</span>        BGPPeer</span><br><span class="line">blockaffinities                                crd.projectcalico.org          <span class="literal">false</span>        BlockAffinity</span><br><span class="line">clusterinformations                            crd.projectcalico.org          <span class="literal">false</span>        ClusterInformation</span><br><span class="line">felixconfigurations                            crd.projectcalico.org          <span class="literal">false</span>        FelixConfiguration</span><br><span class="line">globalnetworkpolicies                          crd.projectcalico.org          <span class="literal">false</span>        GlobalNetworkPolicy</span><br><span class="line">globalnetworksets                              crd.projectcalico.org          <span class="literal">false</span>        GlobalNetworkSet</span><br><span class="line">hostendpoints                                  crd.projectcalico.org          <span class="literal">false</span>        HostEndpoint</span><br><span class="line">ipamblocks                                     crd.projectcalico.org          <span class="literal">false</span>        IPAMBlock</span><br><span class="line">ipamconfigs                                    crd.projectcalico.org          <span class="literal">false</span>        IPAMConfig</span><br><span class="line">ipamhandles                                    crd.projectcalico.org          <span class="literal">false</span>        IPAMHandle</span><br><span class="line">ippools                                        crd.projectcalico.org          <span class="literal">false</span>        IPPool</span><br><span class="line">networkpolicies                                crd.projectcalico.org          <span class="literal">true</span>         NetworkPolicy</span><br><span class="line">networksets                                    crd.projectcalico.org          <span class="literal">true</span>         NetworkSet</span><br><span class="line">endpointslices                                 discovery.k8s.io               <span class="literal">true</span>         EndpointSlice</span><br><span class="line">events                            ev           events.k8s.io                  <span class="literal">true</span>         Event</span><br><span class="line">ingresses                         ing          extensions                     <span class="literal">true</span>         Ingress</span><br><span class="line">ingressclasses                                 networking.k8s.io              <span class="literal">false</span>        IngressClass</span><br><span class="line">ingresses                         ing          networking.k8s.io              <span class="literal">true</span>         Ingress</span><br><span class="line">networkpolicies                   netpol       networking.k8s.io              <span class="literal">true</span>         NetworkPolicy</span><br><span class="line">runtimeclasses                                 node.k8s.io                    <span class="literal">false</span>        RuntimeClass</span><br><span class="line">poddisruptionbudgets              pdb          policy                         <span class="literal">true</span>         PodDisruptionBudget</span><br><span class="line">podsecuritypolicies               psp          policy                         <span class="literal">false</span>        PodSecurityPolicy</span><br><span class="line">clusterrolebindings                            rbac.authorization.k8s.io      <span class="literal">false</span>        ClusterRoleBinding</span><br><span class="line">clusterroles                                   rbac.authorization.k8s.io      <span class="literal">false</span>        ClusterRole</span><br><span class="line">rolebindings                                   rbac.authorization.k8s.io      <span class="literal">true</span>         RoleBinding</span><br><span class="line">roles                                          rbac.authorization.k8s.io      <span class="literal">true</span>         Role</span><br><span class="line">priorityclasses                   pc           scheduling.k8s.io              <span class="literal">false</span>        PriorityClass</span><br><span class="line">csidrivers                                     storage.k8s.io                 <span class="literal">false</span>        CSIDriver</span><br><span class="line">csinodes                                       storage.k8s.io                 <span class="literal">false</span>        CSINode</span><br><span class="line">storageclasses                    sc           storage.k8s.io                 <span class="literal">false</span>        StorageClass</span><br><span class="line">volumeattachments                              storage.k8s.io                 <span class="literal">false</span>        VolumeAttachment</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="apply-å½“èµ„æºæ¸…å•é‡æ–°ä¿®æ”¹åé‡‡ç”¨æ­¤å‘½ä»¤é‡æ–°åº”ç”¨"><a href="#apply-å½“èµ„æºæ¸…å•é‡æ–°ä¿®æ”¹åé‡‡ç”¨æ­¤å‘½ä»¤é‡æ–°åº”ç”¨" class="headerlink" title="apply - å½“èµ„æºæ¸…å•é‡æ–°ä¿®æ”¹åé‡‡ç”¨æ­¤å‘½ä»¤é‡æ–°åº”ç”¨"></a>apply - å½“èµ„æºæ¸…å•é‡æ–°ä¿®æ”¹åé‡‡ç”¨æ­¤å‘½ä»¤é‡æ–°åº”ç”¨</h3><p><strong>åŸºç¡€ç¤ºä¾‹</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ä½¿ç”¨ kube apply å‘½ä»¤å¯ä»¥åˆ›å»ºè¯¥ .yaml æ–‡ä»¶ä¸­çš„ Deployment å¯¹è±¡</span></span><br><span class="line">kubectl apply -f deployment.yaml</span><br><span class="line">kubectl apply -f https://weiyigeek.top/k8s/deployment.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æ‰§è¡Œdeployment/servicesæ“ä½œçš„éƒ¨ç½²å‘½ä»¤</span></span><br><span class="line">kubectl apply -f nginx-deployment.yaml</span><br><span class="line">kubectl apply -f redis-master-service.yaml</span><br><span class="line">  <span class="comment"># deployment.apps/nginx-deployment created</span></span><br><span class="line">  <span class="comment"># service/redis-master-service created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æ›´æ–°k8s ConfigMapæˆ–Secretè€Œä¸åˆ é™¤ç°æœ‰çš„ï¼ˆå€¼å¾—å­¦ä¹ ï¼‰</span></span><br><span class="line">kubectl -n default create secret tls weiyigeek.top --cert=2023.weiyigeek.top.pem --key=2023.weiyigeek.top.key -o yaml --dry-run=client Â | kubectl apply -f -</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="attach-è¿›å…¥podå®¹å™¨ä¸­è¿›è¡Œäº¤äº’å¼è¿è¡Œ"><a href="#attach-è¿›å…¥podå®¹å™¨ä¸­è¿›è¡Œäº¤äº’å¼è¿è¡Œ" class="headerlink" title="attach - è¿›å…¥podå®¹å™¨ä¸­è¿›è¡Œäº¤äº’å¼è¿è¡Œ"></a>attach - è¿›å…¥podå®¹å™¨ä¸­è¿›è¡Œäº¤äº’å¼è¿è¡Œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹1.åœ¨podè¿è¡Œæ—¶ä½¿ç”¨å‘½ä»¤ä»¥ä¸‹å‘½ä»¤ç»§ç»­åœ¨Podå­å®¹å™¨ä¸­è¿›è¡Œäº¤äº’å¼è¿è¡Œ</span></span><br><span class="line">~$ kubectl attach load-generator -c load-generator -i -t</span><br><span class="line">If you don<span class="string">'t see a command prompt, try pressing enter.</span></span><br><span class="line"><span class="string">/ #</span></span><br></pre></td></tr></table></figure>
<p><br/></p>
<h3 id="cluster-info-K8s-é›†ç¾¤ä¿¡æ¯"><a href="#cluster-info-K8s-é›†ç¾¤ä¿¡æ¯" class="headerlink" title="cluster-info - K8s é›†ç¾¤ä¿¡æ¯"></a>cluster-info - K8s é›†ç¾¤ä¿¡æ¯</h3><p>ç¤ºä¾‹1.é›†ç¾¤ç›¸å…³ä¿¡æ¯åŒ…æ‹¬ API-Server åœ°å€ ä»¥åŠ KubeDNS ç›¸å…³ä¿¡æ¯<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~$  kubectl cluster-info</span><br><span class="line"><span class="comment"># Kubernetes master is running at https://weiyigeek-lb-vip.k8s:16443</span></span><br><span class="line"><span class="comment"># KubeDNS is running at https://weiyigeek-lb-vip.k8s:16443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span></span><br></pre></td></tr></table></figure></p>
<h3 id="config-é›†ç¾¤ä¸Šä¸‹æ–‡ä»¥åŠç”¨æˆ·é…ç½®"><a href="#config-é›†ç¾¤ä¸Šä¸‹æ–‡ä»¥åŠç”¨æˆ·é…ç½®" class="headerlink" title="config - é›†ç¾¤ä¸Šä¸‹æ–‡ä»¥åŠç”¨æˆ·é…ç½®"></a>config - é›†ç¾¤ä¸Šä¸‹æ–‡ä»¥åŠç”¨æˆ·é…ç½®</h3><p>å¸¸è§„ç¤ºä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®å¤–éƒ¨é›†ç¾¤ &amp;&amp; åˆ é™¤å¤–éƒ¨é›†ç¾¤</span></span><br><span class="line">kubectl config <span class="built_in">set</span>-cluster k8s-cluster- --server=https://slb-vip.k8s:16443 --certificate-authority=/etc/kubernetes/pki/ca.crt  --embed-certs=<span class="literal">true</span></span><br><span class="line">  <span class="comment"># Cluster "k8s-cluster" set.</span></span><br><span class="line">kubectl config delete-cluster k8s-cluster</span><br><span class="line">  <span class="comment"># deleted cluster k8s-cluster from /root/.kube/config</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ä¸Šä¸‹æ–‡ &amp;&amp; åˆ é™¤ä¸Šä¸‹æ–‡</span></span><br><span class="line">kubectl config <span class="built_in">set</span>-context devops-ctx --cluster=k8s-cluster --user=devopsuser --namespace=devops</span><br><span class="line">  <span class="comment"># Context "devops-ctx " created.</span></span><br><span class="line">kubectl config delete-context devops-ctx</span><br><span class="line">  <span class="comment"># deleted context devops-ctx from /root/.kube/config</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ç”¨æˆ· &amp;&amp; åˆ é™¤ç”¨æˆ·</span></span><br><span class="line">kubectl config <span class="built_in">set</span>-credentials devopsuser --client-key=/etc/kubernetes/pki/user/devopsuser-key.pem --client-certificate=/etc/kubernetes/pki/user/devopsuser-key.pem --user=devopsuser --embed-certs=<span class="literal">true</span></span><br><span class="line">  <span class="comment"># User "devopsuser" set.</span></span><br><span class="line">kubectl config delete-user devopsuser</span><br><span class="line">  <span class="comment"># deleted user devopsuser from /root/.kube/config</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å…¨å±€ä¸Šä¸‹æ–‡</span></span><br><span class="line">kubectl config get-contexts</span><br><span class="line"><span class="comment"># è·å–å½“å‰ä¸Šä¸‹æ–‡</span></span><br><span class="line">kubectl config current-context</span><br><span class="line"><span class="comment"># åˆ‡æ¢æŒ‡å®šä¸Šä¸‹æ–‡</span></span><br><span class="line">kubectl config use-context devops-ctx</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="cp-å¤åˆ¶Podä¸­çš„æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ä¹‹ä¸­"><a href="#cp-å¤åˆ¶Podä¸­çš„æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ä¹‹ä¸­" class="headerlink" title="cp - å¤åˆ¶Podä¸­çš„æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ä¹‹ä¸­"></a>cp - å¤åˆ¶Podä¸­çš„æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ä¹‹ä¸­</h3><p>ç¤ºä¾‹1.ä»Podä¸­å¤åˆ¶æ–‡ä»¶åˆ°æœ¬åœ°<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl cp weiyigeek/users-0:/usr/<span class="built_in">local</span>/tomcat/logs /tmp/logs/</span><br><span class="line">kubectl cp devops/<span class="built_in">test</span>-28-1vw8p-vlr29-fxvqs:/home/jenkins/.ssh /tmp</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="create-æ ¹æ®èµ„æºæ¸…å•åˆ›å»ºå¯¹åº”çš„Pod"><a href="#create-æ ¹æ®èµ„æºæ¸…å•åˆ›å»ºå¯¹åº”çš„Pod" class="headerlink" title="create - æ ¹æ®èµ„æºæ¸…å•åˆ›å»ºå¯¹åº”çš„Pod"></a>create - æ ¹æ®èµ„æºæ¸…å•åˆ›å»ºå¯¹åº”çš„Pod</h3><p><strong>åŸºç¡€ç¤ºä¾‹</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹1.èµ„æºæ¸…å•æ¥åˆ›å»º pod</span></span><br><span class="line">kubectl create -f nginx_pod.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2.æ ¹æ®å‘½ä»¤è¡Œç”Ÿæˆä¸€ä¸ª `deployment` èµ„æºæ¸…å•</span></span><br><span class="line">kubectl create  deployment  java-demo  --image=WeiyiGeek/java-demo  --dry-run -o yaml &gt; deploy.yaml</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="cordon-èŠ‚ç‚¹é™åˆ¶åŠ å…¥èµ„æº"><a href="#cordon-èŠ‚ç‚¹é™åˆ¶åŠ å…¥èµ„æº" class="headerlink" title="cordon - èŠ‚ç‚¹é™åˆ¶åŠ å…¥èµ„æº"></a>cordon - èŠ‚ç‚¹é™åˆ¶åŠ å…¥èµ„æº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubectl cordon [èŠ‚ç‚¹åç§°]</span></span><br><span class="line"><span class="comment"># (1) ç¦æ­¢æ–°å»ºç«‹çš„Podåœ¨è¯¥èŠ‚ç‚¹ä¸Šè¿è¡Œ</span></span><br><span class="line">kubectl cordon node-1</span><br><span class="line">node/node-1 cordoned</span><br></pre></td></tr></table></figure>
<p><br/></p>
<h3 id="describe-æ˜¾ç¤ºæœ‰å…³èµ„æºçš„è¯¦ç»†ä¿¡æ¯"><a href="#describe-æ˜¾ç¤ºæœ‰å…³èµ„æºçš„è¯¦ç»†ä¿¡æ¯" class="headerlink" title="describe - æ˜¾ç¤ºæœ‰å…³èµ„æºçš„è¯¦ç»†ä¿¡æ¯"></a>describe - æ˜¾ç¤ºæœ‰å…³èµ„æºçš„è¯¦ç»†ä¿¡æ¯</h3><p>è¯­æ³•å‚æ•°:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe èµ„æºç±»å‹ èµ„æºåç§°</span><br></pre></td></tr></table></figure></p>
<p>åŸºç¡€å®ä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.æŸ¥çœ‹åç§°ä¸ºnginx-deployment-674ff86d-btmt4çš„Podçš„ä¿¡æ¯</span></span><br><span class="line">kubectl describe pod nginx-deployment-674ff86d-btmt4</span><br><span class="line"><span class="comment"># Name:         nginx-deployment-674ff86d-btmt4</span></span><br><span class="line"><span class="comment"># Namespace:    default</span></span><br><span class="line"><span class="comment"># Priority:     0</span></span><br><span class="line"><span class="comment"># Node:         node/10.10.107.192</span></span><br><span class="line"><span class="comment"># Start Time:   Thu, 07 May 2020 14:12:18 +0800</span></span><br><span class="line"><span class="comment"># Labels:       app=nginx</span></span><br><span class="line"><span class="comment">#               pod-template-hash=674ff86d</span></span><br><span class="line"><span class="comment"># Annotations:  cni.projectcalico.org/podIP: 10.100.167.129/32</span></span><br><span class="line"><span class="comment">#               cni.projectcalico.org/podIPs: 10.100.167.129/32</span></span><br><span class="line"><span class="comment"># Status:       Running</span></span><br><span class="line"><span class="comment"># IP:           10.100.167.129</span></span><br><span class="line"><span class="comment"># IPs:</span></span><br><span class="line"><span class="comment">#   IP:           10.100.167.129</span></span><br><span class="line"><span class="comment"># Controlled By:  ReplicaSet/nginx-deployment-674ff86d</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.æŸ¥çœ‹åç§°ä¸ºnginx-deploymentçš„Deploymentçš„ä¿¡æ¯</span></span><br><span class="line">kubectl describe deployment nginx-deployment</span><br><span class="line"><span class="comment"># Name:                   nginx-deployment</span></span><br><span class="line"><span class="comment"># Namespace:              default</span></span><br><span class="line"><span class="comment"># CreationTimestamp:      Thu, 07 May 2020 14:12:18 +0800</span></span><br><span class="line"><span class="comment"># Labels:                 app=nginx</span></span><br><span class="line"><span class="comment"># Annotations:            deployment.kubernetes.io/revision: 1</span></span><br><span class="line"><span class="comment"># Selector:               app=nginx</span></span><br><span class="line"><span class="comment"># Replicas:               1 desired | 1 updated | 1 total | 1 available | 0 unavailable</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># Conditions:</span></span><br><span class="line"><span class="comment">#   Type           Status  Reason</span></span><br><span class="line"><span class="comment">#   ----           ------  ------</span></span><br><span class="line"><span class="comment">#   Available      True    MinimumReplicasAvailable</span></span><br><span class="line"><span class="comment">#   Progressing    True    NewReplicaSetAvailable</span></span><br><span class="line"><span class="comment"># OldReplicaSets:  &lt;none&gt;</span></span><br><span class="line"><span class="comment"># NewReplicaSet:   nginx-deployment-674ff86d (1/1 replicas created)</span></span><br><span class="line"><span class="comment"># Events:          &lt;none&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#3.æŸ¥çœ‹èŠ‚ç‚¹å„é¡¹ä¿¡æ¯</span></span><br><span class="line">kubectl describe node master-03</span><br><span class="line"><span class="comment"># Name:               master-03</span></span><br><span class="line"><span class="comment"># Roles:              master</span></span><br><span class="line"><span class="comment"># Labels:             beta.kubernetes.io/arch=amd64</span></span><br><span class="line"><span class="comment">#                     beta.kubernetes.io/os=linux</span></span><br><span class="line"><span class="comment">#                     kubernetes.io/arch=amd64</span></span><br><span class="line"><span class="comment">#                     kubernetes.io/hostname=master-03</span></span><br><span class="line"><span class="comment">#                     kubernetes.io/os=linux</span></span><br><span class="line"><span class="comment">#                     node-role.kubernetes.io/master=</span></span><br><span class="line"><span class="comment"># Annotations:        kubeadm.alpha.kubernetes.io/cri-socket: /var/run/dockershim.sock</span></span><br><span class="line"><span class="comment">#                     node.alpha.kubernetes.io/ttl: 0</span></span><br><span class="line"><span class="comment">#                     projectcalico.org/IPv4Address: 10.10.107.193/24</span></span><br><span class="line"><span class="comment">#                     projectcalico.org/IPv4IPIPTunnelAddr: 10.100.133.128</span></span><br><span class="line"><span class="comment">#                     volumes.kubernetes.io/controller-managed-attach-detach: true</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="delete-åˆ é™¤èŠ‚ç‚¹å’Œèµ„æº"><a href="#delete-åˆ é™¤èŠ‚ç‚¹å’Œèµ„æº" class="headerlink" title="delete - åˆ é™¤èŠ‚ç‚¹å’Œèµ„æº"></a>delete - åˆ é™¤èŠ‚ç‚¹å’Œèµ„æº</h3><p>æè¿°: å¯ä»¥åˆ é™¤ç›¸å…³èŠ‚ç‚¹å’Œèµ„æºå¯¹è±¡ï¼Œä¾‹å¦‚<code>Pods ã€Svcã€Nodesã€ Namespaceã€ Configmapã€ Deploymentã€rsã€rcã€sts</code>ç­‰ã€‚</p>
<p>è¯­æ³•è¯´æ˜:<code>kubectl delete [TYPE] Flags</code></p>
<p>ç¤ºä¾‹æ¼”ç¤º:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.åœ¨MasterèŠ‚ç‚¹ä¸Šåˆ é™¤æŒ‡å®šçš„èŠ‚ç‚¹ã€‚</span></span><br><span class="line">kubectl delete node k8s-master-1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æŒ‡å®škube-systemåç§°ç©ºé—´åˆ é™¤å…¶Podsã€‚</span></span><br><span class="line">kubectl -n kube-system delete Pods calico-xxxx</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="drain-èŠ‚ç‚¹ç»„ä»¶æ¸…ç†"><a href="#drain-èŠ‚ç‚¹ç»„ä»¶æ¸…ç†" class="headerlink" title="drain - èŠ‚ç‚¹ç»„ä»¶æ¸…ç†"></a>drain - èŠ‚ç‚¹ç»„ä»¶æ¸…ç†</h3><p><strong>åŸºç¡€ç¤ºä¾‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹1.å¼ºåˆ¶åˆ é™¤èŠ‚ç‚¹æœ¬åœ°æ•°æ®ä»¥åŠè¿è¡Œçš„å®¹å™¨</span></span><br><span class="line">kubectl drain master-02 --delete-local-data --force --ignore-daemonsets</span><br><span class="line"><span class="comment"># WARNING: ignoring DaemonSet-managed Pods: kube-system/kube-flannel-ds-amd64-mlcvm, kube-system/kube-proxy-f7rnh</span></span><br><span class="line"><span class="comment"># evicting pod kube-system/coredns-5fd54d7f56-22fwz</span></span><br><span class="line"><span class="comment"># bec	pod/coredns-5fd54d7f56-22fwz evicted</span></span><br><span class="line"><span class="comment"># node/server4 evicted</span></span><br><span class="line">kubectl get nodes master-02</span><br><span class="line"><span class="comment"># NAME      STATUS                     ROLES    AGE     VERSION</span></span><br><span class="line"><span class="comment"># master-02   Ready,SchedulingDisabled   &lt;none&gt;   3h36m   v1.18.3		# ä¸å†è°ƒç”¨æ­¤ç»“ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹2.å¼ºåˆ¶åˆ é™¤å¤„äºterminalçŠ¶æ€æˆ–è€…å¼‚å¸¸çŠ¶æ€çš„Podï¼Œç­‰å¾…æ—¶é—´ä¸º0</span></span><br><span class="line">kubectl delete pod -n ingress-nginx --force --grace-period=0 ingress-nginx-controller-6b8bd48548-jmblv</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="exec-åœ¨podä¸­çš„å®¹å™¨ç¯å¢ƒå†…æ‰§è¡Œå‘½ä»¤-å’Œå‘½ä»¤docker-exec-ç±»ä¼¼"><a href="#exec-åœ¨podä¸­çš„å®¹å™¨ç¯å¢ƒå†…æ‰§è¡Œå‘½ä»¤-å’Œå‘½ä»¤docker-exec-ç±»ä¼¼" class="headerlink" title="exec - åœ¨podä¸­çš„å®¹å™¨ç¯å¢ƒå†…æ‰§è¡Œå‘½ä»¤(å’Œå‘½ä»¤docker exec ç±»ä¼¼)"></a>exec - åœ¨podä¸­çš„å®¹å™¨ç¯å¢ƒå†…æ‰§è¡Œå‘½ä»¤(å’Œå‘½ä»¤docker exec ç±»ä¼¼)</h3><p><strong>è¯­æ³•å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">exec</span> Podåç§° æ“ä½œå‘½ä»¤</span><br><span class="line">kubectl <span class="built_in">exec</span> -n åç§°ç©ºé—´ -ti Podåç§° -c å®¹å™¨åç§° -- /bin/sh</span><br></pre></td></tr></table></figure></p>
<p><strong>åŸºç¡€ç¤ºä¾‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) åœ¨åç§°ä¸º nginx-pod-xxxxxx çš„Podä¸­è¿è¡Œbashã€‚</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it nginx-deployment-674ff86d-btmt4 /bin/bash</span><br><span class="line"><span class="comment"># kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl kubectl exec [POD] -- [COMMAND] instead.</span></span><br><span class="line"><span class="comment"># root@nginx-deployment-674ff86d-btmt4:/# </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) è¿›å…¥Podå¤šä¸ªå®¹å™¨ä¸­çš„å…¶ä¸­ä¸€ä¸ªå®¹å™¨ï¼Œä¾‹å¦‚è¿›å…¥åç§°ä¸º weiyigeek çš„Podä¸­çš„blogå®¹å™¨ã€‚</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -n <span class="built_in">test</span> -ti weiyigeek -c blog -- /bin/sh</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="expose-å°†èµ„æºå…¬å¼€ä¿ç•™ä¸ºæ–°çš„SVCæœåŠ¡ã€‚"><a href="#expose-å°†èµ„æºå…¬å¼€ä¿ç•™ä¸ºæ–°çš„SVCæœåŠ¡ã€‚" class="headerlink" title="expose - å°†èµ„æºå…¬å¼€ä¿ç•™ä¸ºæ–°çš„SVCæœåŠ¡ã€‚"></a>expose - å°†èµ„æºå…¬å¼€ä¿ç•™ä¸ºæ–°çš„SVCæœåŠ¡ã€‚</h3><p>æè¿°:æŒ‰åç§°æŸ¥æ‰¾ <code>deployment, service, replica set, replication controller or pod</code>ï¼Œå¹¶ä½¿ç”¨è¯¥èµ„æºçš„é€‰æ‹©å™¨ä½œä¸ºæŒ‡å®šç«¯å£ä¸Šæ–°æœåŠ¡çš„é€‰æ‹©å™¨, å³åˆ›å»ºæ–°çš„æœåŠ¡ã€‚</p>
<p>æ¸©é¦¨æç¤º: å¦‚æœæ²¡æœ‰ç«¯å£é€šè¿‡â€“portæŒ‡å®šï¼Œå¹¶ä¸”å…¬å¼€çš„èµ„æºæœ‰å¤šä¸ªç«¯å£ï¼Œæ‰€æœ‰ç«¯å£éƒ½å°†è¢«æ–°æœåŠ¡ã€‚æ­¤å¤–å¦‚æœæœªæŒ‡å®šæ ‡ç­¾ï¼Œæ–°æœåŠ¡å°†é‡æ–°ä½¿ç”¨å®ƒæš´éœ²çš„èµ„æºã€‚</p>
<p>å¯èƒ½çš„èµ„æºåŒ…æ‹¬ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼špod (po), service (svc), replicationcontroller (rc), deployment (deploy), replicaset (rs)</p>
<p><strong>è¯­æ³•å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¯­æ³•</span></span><br><span class="line">kubectl expose (-f FILENAME | TYPE NAME) [--port=port] [--protocol=TCP|UDP|SCTP]</span><br><span class="line">[--target-port=number-or-name] [--name=name] [--external-ip=external-ip-of-service] [--<span class="built_in">type</span>=<span class="built_in">type</span>]</span><br><span class="line">[options]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸¸ç”¨å‚æ•°</span></span><br><span class="line">--name=<span class="string">''</span>: æ–°åˆ›å»ºçš„å¯¹è±¡çš„åç§°ã€‚</span><br><span class="line">--port=<span class="string">''</span>: SVC æœåŠ¡ç«¯å£ã€‚</span><br><span class="line">--target-port=<span class="string">''</span>: Pod å®¹å™¨ç«¯å£ã€‚</span><br><span class="line">--protocol=<span class="string">''</span>: SVC æœåŠ¡ç½‘ç»œåè®®, é»˜è®¤TCPã€‚</span><br><span class="line">--<span class="built_in">type</span>=<span class="string">''</span>: æŒ‡å®šæœåŠ¡ç±»å‹,å¯ç”¨èŒƒå›´`ClusterIP, NodePort, LoadBalancer, or ExternalName. Default</span><br><span class="line">is <span class="string">'ClusterIP'</span>`ã€‚</span><br></pre></td></tr></table></figure></p>
<p><strong>åŸºç¡€å®ä¾‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ä¸º nginx éƒ¨ç½²åˆ›å»ºä¸€ä¸ªæœåŠ¡åä¸ºnginx-external ï¼Œè¯¥éƒ¨ç½²æœåŠ¡äºç«¯å£80å¹¶è¿æ¥åˆ°Podå®¹å™¨çš„8080ç«¯å£</span></span><br><span class="line">kubectl expose deployment nginx --name nginx-external --<span class="built_in">type</span>=ClusterIP  --port=80 --target-port=8000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ä¸º nginx-web æœåŠ¡åˆ›å»ºä¸€ä¸ªåˆ«åæœåŠ¡ nginx-web-external , å…¶ç±»å‹ä¸ºNodePortï¼Œæ³¨æ„æ­¤å¤„æˆ‘éšæœºç«¯å£ã€‚</span></span><br><span class="line">kubectl expose service -n devtest nginx-web --name nginx-web-external --<span class="built_in">type</span>=NodePort  --port=80 --target-port=80</span><br><span class="line"><span class="comment"># æ‰§è¡Œç»“æœ</span></span><br><span class="line">$ kubectl get svc -n devtest nginx-web-external</span><br><span class="line"><span class="comment"># NAME                 TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE</span></span><br><span class="line"><span class="comment"># nginx-web-external   NodePort   10.102.35.45   &lt;none&gt;        80:30230/TCP   70s</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="get-æ˜¾ç¤ºèµ„æºåˆ—è¡¨"><a href="#get-æ˜¾ç¤ºèµ„æºåˆ—è¡¨" class="headerlink" title="get - æ˜¾ç¤ºèµ„æºåˆ—è¡¨"></a>get - æ˜¾ç¤ºèµ„æºåˆ—è¡¨</h3><p>æè¿°: æ˜¾ç¤ºkubernetesç›¸å…³èµ„æºå¯¹è±¡ä¿¡æ¯,ä¾‹å¦‚<code>Pods ã€Svcã€Nodesã€ Namespaceã€ Configmapã€ Deploymentã€rsã€rcã€sts</code>ç›¸å…³èµ„æºä¿¡æ¯ã€‚</p>
<p><strong>åŸºç¡€è¯­æ³•</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¯­æ³•</span></span><br><span class="line">kubectl get èµ„æºç±»å‹</span><br><span class="line"><span class="comment"># å‚æ•°</span></span><br><span class="line">-l          <span class="comment">#è·å–ç›¸å…³labelæ ‡ç­¾çš„èµ„æºåˆ—è¡¨</span></span><br><span class="line">-o          <span class="comment">#ä»¥ wide,yaml,jsonpath="&#123;..image&#125;",go-template æ ¼å¼åŒ–è¾“å‡º</span></span><br><span class="line">--namespace <span class="comment">#æŸ¥æ‰¾æŒ‡å®šåç§°ç©ºé—´ä¸‹çš„ Pod</span></span><br><span class="line">--template  <span class="comment">#ä½¿ç”¨ go-template æ ¼å¼åŒ–</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>åŸºç¡€ç¤ºä¾‹</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.è·å–ç±»å‹ä¸ºDeploymentçš„èµ„æºåˆ—è¡¨</span></span><br><span class="line">kubectl get deployments</span><br><span class="line"><span class="comment"># NAME               READY   UP-TO-DATE   AVAILABLE   AGE</span></span><br><span class="line"><span class="comment"># nginx-deployment   1/1     1            1           8h</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.è·å–ç±»å‹ä¸ºPodçš„èµ„æºåˆ—è¡¨</span></span><br><span class="line">kubectl get pods <span class="comment"># é»˜è®¤æ˜¾ç¤ºåç§°ä¸ºdefaultçš„podåˆ—è¡¨</span></span><br><span class="line">kubectl get pods --all-namespaces <span class="comment">#æ‰§è¡Œå‘½ä»¤ï¼Œè·å–æ‰€æœ‰åç§°ç©ºé—´ä¸­çš„æ‰€æœ‰ Pod</span></span><br><span class="line"><span class="comment"># NAME                              READY   STATUS    RESTARTS   AGE</span></span><br><span class="line"><span class="comment"># nginx-deployment-674ff86d-btmt4   1/1     Running   0          8h</span></span><br><span class="line">kubectl get pods -l app=nginx  <span class="comment"># è·å–ç›¸å…³labelæ ‡ç­¾çš„èµ„æºåˆ—è¡¨</span></span><br><span class="line"><span class="comment"># NAME                               READY   STATUS    RESTARTS   AGE</span></span><br><span class="line"><span class="comment"># nginx-deployment-cc7df4f8f-2jlnp   1/1     Running   0          47m</span></span><br><span class="line"><span class="comment"># nginx-deployment-cc7df4f8f-jxwrs   1/1     Running   0          47m </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡‡ç”¨jsonpathè¿‡æ»¤è¯­æ³•è·å–ç¬¦åˆæ¡ä»¶å¾—å¾—Podåç§°</span></span><br><span class="line">kubectl get pods -n kube-system -l <span class="string">"app.kubernetes.io/name=kubernetes-dashboard,app.kubernetes.io/instance=kubernetes-dashboard"</span> -o jsonpath=<span class="string">"&#123;.items[0].metadata.name&#125;"</span>  <span class="comment"># kubernetes-dashboard-879457794-kxvcr</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ -o jsonpath=&#123;..image&#125; å‚æ•°ï¼Œè¾“å‡ºç»“æœå°†æ ¼å¼åŒ–ä¸ºåªåŒ…å«å®¹å™¨é•œåƒåå­—çš„å½¢å¼ </span></span><br><span class="line">kubectl get pods --namespace kube-system -o jsonpath=<span class="string">"&#123;..image&#125;"</span>         <span class="comment"># æŒ‰åç§°ç©ºé—´æŸ¥æ‰¾å®¹å™¨</span></span><br><span class="line">kubectl get pods --all-namespaces -o=jsonpath=<span class="string">"&#123;..image&#125;"</span> -l app=redis   <span class="comment"># redis redis:latest</span></span><br><span class="line"></span><br><span class="line">kubectl get pods --all-namespaces -o jsonpath=<span class="string">"&#123;..image&#125;"</span> | tr -s <span class="string">'[[:space:]]'</span> <span class="string">'\n'</span> |sort | uniq -c  <span class="comment"># jsonpath å°†ç©ºæ ¼æ›¿æ¢ä¸ºæ–°çš„è¡Œå¹¶å¯¹å¯¹ç»“æœæ’åºï¼Œç„¶åè¿›è¡Œè®¡æ•°</span></span><br><span class="line"><span class="comment"># 24 calico/cni:v3.13.1</span></span><br><span class="line"><span class="comment"># 2 calico/kube-controllers:v3.13.1</span></span><br><span class="line"><span class="comment"># 12 calico/node:v3.13.1</span></span><br><span class="line"><span class="comment"># 12 calico/pod2daemon-flexvol:v3.13.1</span></span><br><span class="line"><span class="comment"># 4 mirrorgcrio/coredns:1.6.7</span></span><br><span class="line"><span class="comment"># 6 mirrorgcrio/etcd:3.4.3-0</span></span><br><span class="line"><span class="comment"># 6 mirrorgcrio/kube-apiserver:v1.18.4</span></span><br><span class="line"><span class="comment"># 6 mirrorgcrio/kube-controller-manager:v1.18.4</span></span><br><span class="line"><span class="comment"># 12 mirrorgcrio/kube-proxy:v1.18.4</span></span><br><span class="line"><span class="comment"># 6 mirrorgcrio/kube-scheduler:v1.18.4</span></span><br><span class="line"><span class="comment"># 1 redis</span></span><br><span class="line"><span class="comment"># 1 redis:latest</span></span><br><span class="line"></span><br><span class="line">kubectl get pod -n weiyigeek -l ref=info-student -o jsonpath=<span class="string">"&#123;.items[*].status.podIP&#125;"</span> | tr -s <span class="string">'[[:space:]]'</span> <span class="string">'\n'</span> &gt; ip.txt</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> $(cat ip.txt);<span class="keyword">do</span> <span class="built_in">echo</span> -n <span class="string">"<span class="variable">$x</span> - "</span>;curl -v http://<span class="variable">$&#123;x&#125;</span>:8080/ ;<span class="built_in">echo</span> <span class="string">""</span>;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”¨ Pod ä¸­ image å­—æ®µçš„ç»å¯¹è·¯å¾„æ¥æŸ¥æ‰¾å®¹å™¨çš„é•œåƒåå­—ï¼Œå¯ä»¥è§„é¿ image å­—æ®µé‡å¤å‡ºç°çš„æƒ…å†µã€‚</span></span><br><span class="line">kubectl get pods --all-namespaces -o jsonpath=<span class="string">"&#123;.items[*].spec.containers[*].image&#125;"</span> |tr -s <span class="string">'[[:space:]]'</span> <span class="string">'\n'</span> |  uniq -c | sort -r</span><br><span class="line"><span class="comment"># .items[*]ï¼šæ¯ä¸€ä¸ªè¿”å›å€¼</span></span><br><span class="line"><span class="comment"># .specï¼š è·å– spec</span></span><br><span class="line"><span class="comment"># .containers[*]ï¼š æ¯ä¸€ä¸ª container</span></span><br><span class="line"><span class="comment"># .imageï¼šè·å– image</span></span><br><span class="line"></span><br><span class="line">kubectl get pods -o jsonpath=<span class="string">"&#123;.items[*].spec.containers[*].image&#125;"</span> |tr -s <span class="string">'[[:space:]]'</span> <span class="string">'\n'</span> |  uniq -c | sort -r</span><br><span class="line">    <span class="comment">#   1 redis</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœé€šè¿‡åå­—æŸ¥æ‰¾ Podç”±äºè¿”å›ç»“æœåªæœ‰ä¸€ä¸ª Podï¼Œæ­¤æ—¶ï¼Œ.items[*] è¿™ä¸€éƒ¨åˆ†åº”è¯¥ä» jsonpath ä¸­ç§»é™¤(æ•ˆæœåŒä¸Š)</span></span><br><span class="line">kubectl get pods redis-master-deployment-7d557b94bb-bzw2v -o jsonpath=<span class="string">"&#123;.spec.containers[*].image&#125;"</span> |tr -s <span class="string">'[[:space:]]'</span> <span class="string">'\n'</span> |  uniq -c | sort -r</span><br><span class="line">    <span class="comment">#   1 redis</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># map[containerPort:6379 protocol:TCP]</span></span><br><span class="line"><span class="comment"># æŒ‰PodæŸ¥æ‰¾å®¹å™¨è¾“å‡ºç»“æœå¯ä»¥é€šè¿‡ rannge æ“ä½œéå†(å€¼å¾—å­¦ä¹ åˆ†éš”)</span></span><br><span class="line">kubectl get pods -o=jsonpath=<span class="string">'&#123;range .items[*]&#125;&#123;"\n"&#125;&#123;.metadata.name&#125;&#123;":\t"&#125;&#123;range .spec.containers[*]&#125;&#123;.image&#125;&#123;", "&#125;&#123;end&#125;&#123;end&#125;'</span> |sort</span><br><span class="line"><span class="comment"># redis-master-deployment-7d557b94bb-bzw2v:       redis,</span></span><br><span class="line">kubectl get pods --all-namespaces -o go-template --template=<span class="string">"&#123;&#123;range .items&#125;&#125;&#123;&#123;range .spec.containers&#125;&#125;&#123;&#123;.image&#125;&#125; &#123;&#123;end&#125;&#125;&#123;&#123;end&#125;&#125;"</span></span><br><span class="line">kubectl get pods redis-master-deployment-7d557b94bb-bzw2v --template=<span class="string">'&#123;&#123;(index (index .spec.containers 0).ports 0)&#125;&#125;&#123;&#123;"\n"&#125;&#125;'</span>  <span class="comment">##ä½¿ç”¨go-templateç½—åˆ—å®¹å™¨è¿›è¡ŒJsonè§£æ</span></span><br><span class="line">kubectl get pods --all-namespaces -o=jsonpath=<span class="string">'&#123;range .items[*]&#125;&#123;"\n"&#125;&#123;.metadata.namespace&#125;&#123;":\t"&#125;&#123;.metadata.name&#125;&#123;":\t"&#125;&#123;range .spec.volumes[*]&#125;&#123;.hostPath.path&#125;&#123;", "&#125;&#123;end&#125;&#123;end&#125;'</span> | sort</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.è·å–ç±»å‹ä¸ºNodeçš„èµ„æºåˆ—è¡¨</span></span><br><span class="line">kubectl get nodes</span><br><span class="line"><span class="comment"># NAME   STATUS   ROLES    AGE   VERSION</span></span><br><span class="line"><span class="comment"># k8s    Ready    master   29h   v1.18.2</span></span><br><span class="line">kubectl get nodes -o wide</span><br><span class="line"><span class="comment"># NAME      STATUS   ROLES    AGE   VERSION   INTERNAL-IP     EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION              CONTAINER-RUNTIME</span></span><br><span class="line"><span class="comment"># ks8test   Ready    master   23h   v1.18.3   10.10.107.193   &lt;none&gt;        CentOS Linux 7 (Core)   5.7.0-1.el7.elrepo.x86_64   docker://19.3.9</span></span><br><span class="line"><span class="comment"># node-1    Ready    &lt;none&gt;   41m   v1.18.3   10.20.172.82    &lt;none&gt;        CentOS Linux 7 (Core)   5.7.0-1.el7.elrepo.x86_64   docker://19.3.9</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.åç§°ç©ºé—´åœ¨å‘½ä»¤åå¢åŠ  -A æˆ– --all-namespaces å¯æŸ¥çœ‹æ‰€æœ‰ åç§°ç©ºé—´ä¸­ çš„å¯¹è±¡ï¼Œä½¿ç”¨å‚æ•° -n å¯æŸ¥çœ‹æŒ‡å®šåç§°ç©ºé—´çš„å¯¹è±¡ï¼Œ</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰åç§°ç©ºé—´çš„ Deployment</span></span><br><span class="line">kubectl get deployments -A  <span class="comment"># --all-namespaces</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ kube-system åç§°ç©ºé—´çš„ Deployment</span></span><br><span class="line">kubectl get deployments -n kube-system</span><br><span class="line"><span class="comment"># NAME                      READY   UP-TO-DATE   AVAILABLE   AGE</span></span><br><span class="line"><span class="comment"># calico-kube-controllers   1/1     1            1           29h</span></span><br><span class="line"><span class="comment"># coredns                   2/2     2            2           29h</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.ServicesæŠ½è±¡å±‚æŸ¥çœ‹</span></span><br><span class="line">kubectl get services -o wide</span><br><span class="line">kubectl get svc -o wide</span><br><span class="line"><span class="comment"># NAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE   SELECTOR</span></span><br><span class="line"><span class="comment"># kubernetes      ClusterIP   10.96.0.1      &lt;none&gt;        443/TCP        40h   &lt;none&gt;</span></span><br><span class="line"><span class="comment"># redis-master-service   ClusterIP   10.99.192.159   &lt;none&gt;        6379/TCP   8m24s   app=redis,role=master,tier=backend</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.æŒ‡å®šåç§°ç©ºé—´çš„é…ç½®ä¿¡æ¯æŸ¥çœ‹</span></span><br><span class="line">kubectl get cm kubeadm-config -n kube-system -o yaml</span><br><span class="line"><span class="comment"># apiVersion: v1</span></span><br><span class="line"><span class="comment"># data:</span></span><br><span class="line"><span class="comment">#   ClusterConfiguration: |</span></span><br><span class="line"><span class="comment">#     apiServer:</span></span><br><span class="line"><span class="comment">#       extraArgs:</span></span><br><span class="line"><span class="comment">#         authorization-mode: Node,RBAC</span></span><br><span class="line"><span class="comment">#       timeoutForControlPlane: 4m0s</span></span><br><span class="line"><span class="comment">#     apiVersion: kubeadm.k8s.io/v1beta2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.æŒ‡å®šåç§°ç©ºé—´é€‰ä¸¾ä¿¡æ¯æŸ¥çœ‹</span></span><br><span class="line">kubectl get ep kube-controller-manager -n kube-system -o yaml</span><br><span class="line"><span class="comment"># apiVersion: v1</span></span><br><span class="line"><span class="comment"># kind: Endpoints</span></span><br><span class="line"><span class="comment"># metadata:</span></span><br><span class="line"><span class="comment">#   annotations:</span></span><br><span class="line"><span class="comment">#     control-plane.alpha.kubernetes.io/leader: '&#123;"holderIdentity":"master-01_137ddc1b-55bf-413b-81d3-f76654daa41e","leaseDurationSeconds":15,"acquireTime":"2020-06-24T03:51:16Z","renewTime":"2020-06-28T07:56:52Z","leaderTransitions":6&#125;'</span></span><br><span class="line"><span class="comment">#   creationTimestamp: "2020-06-23T04:45:29Z"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.æŸ¥çœ‹ ReplicaSet(å‰¯æœ¬) çŠ¶æ€ä¸ä¿¡æ¯</span></span><br><span class="line">kubectl get rs</span><br><span class="line"><span class="comment"># NAME                                 DESIRED   CURRENT   READY   AGE</span></span><br><span class="line"><span class="comment"># redis-master-deployment-7d557b94bb   1         1         1       4m46s</span></span><br></pre></td></tr></table></figure></p>
<p><strong>è¡¥å……è¯´æ˜:</strong><br>ç¤ºä¾‹.ä»¥YAMLçš„æ ¼å¼æ˜¾ç¤º k8s ä¸­ kubeadm-config çš„é…ç½®;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl get cm -o yaml -n kube-system kubeadm-config</span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  ClusterConfiguration: |</span><br><span class="line">    apiServer:</span><br><span class="line">      extraArgs:</span><br><span class="line">        authorization-mode: Node,RBAC</span><br><span class="line">      timeoutForControlPlane: 4m0s</span><br><span class="line">    apiVersion: kubeadm.k8s.io/v1beta2</span><br><span class="line">    certificatesDir: /etc/kubernetes/pki</span><br><span class="line">    clusterName: kubernetes</span><br><span class="line">    controlPlaneEndpoint: weiyigeek.k8s:6443</span><br><span class="line">    controllerManager: &#123;&#125;</span><br><span class="line">    dns:</span><br><span class="line">      <span class="built_in">type</span>: CoreDNS</span><br><span class="line">    etcd:</span><br><span class="line">      <span class="built_in">local</span>:</span><br><span class="line">        dataDir: /var/lib/etcd</span><br><span class="line">    imageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers</span><br><span class="line">    kind: ClusterConfiguration</span><br><span class="line">    kubernetesVersion: v1.19.3</span><br><span class="line">    networking:</span><br><span class="line">      dnsDomain: cluster.local</span><br><span class="line">      podSubnet: 10.244.0.0/16</span><br><span class="line">      serviceSubnet: 10.100.0.0/12</span><br><span class="line">    scheduler: &#123;&#125;</span><br><span class="line">  ClusterStatus: |</span><br><span class="line">    apiEndpoints:</span><br><span class="line">      ubuntu:</span><br><span class="line">        advertiseAddress: 10.10.107.202</span><br><span class="line">        bindPort: 6443</span><br><span class="line">    apiVersion: kubeadm.k8s.io/v1beta2</span><br><span class="line">    kind: ClusterStatus</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: <span class="string">"2020-11-04T13:30:06Z"</span></span><br><span class="line">  managedFields:</span><br><span class="line">  - apiVersion: v1</span><br><span class="line">    fieldsType: FieldsV1</span><br><span class="line">    fieldsV1:</span><br><span class="line">      f:data:</span><br><span class="line">        .: &#123;&#125;</span><br><span class="line">        f:ClusterConfiguration: &#123;&#125;</span><br><span class="line">        f:ClusterStatus: &#123;&#125;</span><br><span class="line">    manager: kubeadm</span><br><span class="line">    operation: Update</span><br><span class="line">    time: <span class="string">"2020-11-04T13:30:06Z"</span></span><br><span class="line">  name: kubeadm-config</span><br><span class="line">  namespace: kube-system</span><br><span class="line">  resourceVersion: <span class="string">"162"</span></span><br><span class="line">  selfLink: /api/v1/namespaces/kube-system/configmaps/kubeadm-config</span><br><span class="line">  uid: ee701525-7242-42b3-bc64-6c7ac27dd5d3</span><br></pre></td></tr></table></figure></p>
<p><em>æ³¨æ„äº‹é¡¹:</em></p>
<ul>
<li>æ³¨æ„å¹¶éæ‰€æœ‰å¯¹è±¡éƒ½åœ¨åç§°ç©ºé—´é‡Œï¼›</li>
</ul>
<p><br/></p>
<h3 id="logs-æŸ¥çœ‹podä¸­çš„å®¹å™¨çš„æ‰“å°æ—¥å¿—ï¼ˆå’Œå‘½ä»¤docker-logs-ç±»ä¼¼ï¼‰"><a href="#logs-æŸ¥çœ‹podä¸­çš„å®¹å™¨çš„æ‰“å°æ—¥å¿—ï¼ˆå’Œå‘½ä»¤docker-logs-ç±»ä¼¼ï¼‰" class="headerlink" title="logs - æŸ¥çœ‹podä¸­çš„å®¹å™¨çš„æ‰“å°æ—¥å¿—ï¼ˆå’Œå‘½ä»¤docker logs ç±»ä¼¼ï¼‰"></a>logs - æŸ¥çœ‹podä¸­çš„å®¹å™¨çš„æ‰“å°æ—¥å¿—ï¼ˆå’Œå‘½ä»¤docker logs ç±»ä¼¼ï¼‰</h3><p>æè¿°:è¾“å‡ºpodä¸­ä¸€ä¸ªå®¹å™¨çš„æ—¥å¿—,å¦‚æœpodåªåŒ…å«ä¸€ä¸ªå®¹å™¨åˆ™å¯ä»¥çœç•¥å®¹å™¨åã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubectl logs [Podåç§°]</span></span><br><span class="line">-c, --container=<span class="string">""</span>: å®¹å™¨åã€‚</span><br><span class="line">-f, --follow[=<span class="literal">false</span>]: æŒ‡å®šæ˜¯å¦æŒç»­è¾“å‡ºæ—¥å¿—ã€‚</span><br><span class="line">    --interactive[=<span class="literal">true</span>]: å¦‚æœä¸º<span class="literal">true</span>ï¼Œå½“éœ€è¦æ—¶æç¤ºç”¨æˆ·è¿›è¡Œè¾“å…¥ã€‚é»˜è®¤ä¸º<span class="literal">true</span>ã€‚</span><br><span class="line">    --<span class="built_in">limit</span>-bytes=0: è¾“å‡ºæ—¥å¿—çš„æœ€å¤§å­—èŠ‚æ•°ã€‚é»˜è®¤æ— é™åˆ¶ã€‚</span><br><span class="line">-p, --previous[=<span class="literal">false</span>]: å¦‚æœä¸º<span class="literal">true</span>ï¼Œè¾“å‡ºpodä¸­æ›¾ç»è¿è¡Œè¿‡ï¼Œä½†ç›®å‰å·²ç»ˆæ­¢çš„å®¹å™¨çš„æ—¥å¿—ã€‚</span><br><span class="line">    --since=0: ä»…è¿”å›ç›¸å¯¹æ—¶é—´èŒƒå›´ï¼Œå¦‚5sã€2mæˆ–3hï¼Œä¹‹å†…çš„æ—¥å¿—ã€‚é»˜è®¤è¿”å›æ‰€æœ‰æ—¥å¿—ã€‚åªèƒ½åŒæ—¶ä½¿ç”¨sinceå’Œsince-timeä¸­çš„ä¸€ç§ã€‚</span><br><span class="line">    --since-time=<span class="string">""</span>: ä»…è¿”å›æŒ‡å®šæ—¶é—´ï¼ˆRFC3339æ ¼å¼ï¼‰ä¹‹åçš„æ—¥å¿—ã€‚é»˜è®¤è¿”å›æ‰€æœ‰æ—¥å¿—ã€‚åªèƒ½åŒæ—¶ä½¿ç”¨sinceå’Œsince-timeä¸­çš„ä¸€ç§ã€‚</span><br><span class="line">    --tail=-1: è¦æ˜¾ç¤ºçš„æœ€æ–°çš„æ—¥å¿—æ¡æ•°ã€‚é»˜è®¤ä¸º-1ï¼Œæ˜¾ç¤ºæ‰€æœ‰çš„æ—¥å¿—ã€‚</span><br><span class="line">    --timestamps[=<span class="literal">false</span>]: åœ¨æ—¥å¿—ä¸­åŒ…å«æ—¶é—´æˆ³ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹åç§°ä¸ºnginx-pod-XXXXXXXçš„Podå†…çš„å®¹å™¨æ‰“å°çš„æ—¥å¿—</span></span><br><span class="line"><span class="comment">#æœ¬æ¡ˆä¾‹ä¸­çš„ nginx-pod æ²¡æœ‰è¾“å‡ºæ—¥å¿—ï¼Œæ‰€ä»¥æ‚¨çœ‹åˆ°çš„ç»“æœæ˜¯ç©ºçš„</span></span><br><span class="line">kubectl logs -f nginx-deployment-674ff86d-btmt4</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿”å›pod rubyä¸­å·²ç»åœæ­¢çš„å®¹å™¨web-1çš„æ—¥å¿—å¿«ç…§</span></span><br><span class="line">$ kubectl logs -p -c ruby web-1</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒç»­è¾“å‡ºpod rubyä¸­çš„å®¹å™¨web-1çš„æ—¥å¿—</span></span><br><span class="line">$ kubectl logs -f -c ruby web-1</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»…è¾“å‡ºpod nginxä¸­æœ€è¿‘çš„20æ¡æ—¥å¿—</span></span><br><span class="line">$ kubectl logs --tail=20 nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºpod nginxä¸­æœ€è¿‘ä¸€å°æ—¶å†…äº§ç”Ÿçš„æ‰€æœ‰æ—¥å¿—</span></span><br><span class="line">$ kubectl logs --since=1h nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºå‘½åç©ºé—´ä¸ºWeiyiGeekï¼Œpodsä¸ºBlogçš„æ—¥å¿—ä»…è¿”å›æŒ‡å®šæ—¶é—´ï¼ˆRFC3339æ ¼å¼ï¼‰ä¹‹åçš„æ—¥å¿—å¹¶ä¸”ä»…ä»…è¾“å‡º1024bytes</span></span><br><span class="line"><span class="comment"># æ³¨æ„, åŒ—äº¬æ—¶é—´éœ€è¦+8å°æ—¶</span></span><br><span class="line">$ kubectl logs Blog -n WeiyiGeek --since-time=<span class="string">"2021-12-23T20:20:59Z"</span> --<span class="built_in">limit</span>-bytes=1024</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="run-è¿è¡Œä¸€ä¸ªpodåº”ç”¨"><a href="#run-è¿è¡Œä¸€ä¸ªpodåº”ç”¨" class="headerlink" title="run - è¿è¡Œä¸€ä¸ªpodåº”ç”¨"></a>run - è¿è¡Œä¸€ä¸ªpodåº”ç”¨</h3><p>åŸºç¡€ç¤ºä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¤ºä¾‹1.è¿™æ˜¯ä¸€ç§è‡ªä¸»å¼çš„podå»ºç«‹æ–¹å¼,è¿˜æœ‰ä¸€ç§deploymentæ§åˆ¶å™¨æ–¹å¼;</span></span><br><span class="line">kubectl run helloworld --image=hello-world	</span><br><span class="line">pod/helloworld created</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ‰§è¡Œçš„ç»“æœæ—¥å¿—</span></span><br><span class="line"><span class="comment"># kubectl logs helloworld</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="replace-ç”¨æ–‡ä»¶åæˆ–stdinæ›¿æ¢èµ„æº"><a href="#replace-ç”¨æ–‡ä»¶åæˆ–stdinæ›¿æ¢èµ„æº" class="headerlink" title="replace - ç”¨æ–‡ä»¶åæˆ–stdinæ›¿æ¢èµ„æº"></a>replace - ç”¨æ–‡ä»¶åæˆ–stdinæ›¿æ¢èµ„æº</h3><p>æè¿°: è¯¥å‘½ä»¤æ”¯æŒJSONå’ŒYAMLæ ¼å¼,å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ›´æ¢ç°æœ‰èµ„æºã€‚</p>
<p><strong>è¯­æ³•å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-f, --filename=[]: æŒ‡å®šæ ¼å¼çš„èµ„æºæ–‡ä»¶ã€‚</span><br><span class="line">--force=<span class="literal">false</span>: å¼ºåˆ¶åˆ é™¤èµ„æºã€‚</span><br><span class="line">--<span class="built_in">wait</span>=<span class="literal">false</span>: å¦‚æœä¸ºçœŸï¼Œç­‰å¾…èµ„æºæ¶ˆå¤±åå†è¿”å›ã€‚</span><br></pre></td></tr></table></figure></p>
<p><strong>åŸºç¡€å®ä¾‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ä½¿ç”¨jsonæˆ–è€…yamlæ ¼å¼ï¼Œæ›¿æ¢ç°æœ‰èµ„æºã€‚</span></span><br><span class="line">kubectl replace -f ./pod.json</span><br><span class="line">kubectl replace -f ./deployment.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æ ¹æ®ä¼ é€’ç»™stdinçš„JSONæ›¿æ¢ä¸€ä¸ªpod</span></span><br><span class="line">cat pod.json | kubectl replace -f -</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.å°†å•ä¸ªå®¹å™¨åŠèˆ±çš„å›¾åƒç‰ˆæœ¬ï¼ˆæ ‡ç­¾ï¼‰æ›´æ–°ä¸ºv4 (å€¼å¾—å­¦ä¹ )</span></span><br><span class="line">kubectl get pod mypod -o yaml | sed <span class="string">'s/\(image: myimage\):.*$/\1:v4/'</span> | kubectl replace -f -</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.å¼ºåˆ¶æ›¿æ¢ã€åˆ é™¤ï¼Œç„¶åé‡æ–°åˆ›å»ºèµ„æº</span></span><br><span class="line">kubectl replace --force -f ./pod.json</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="port-forward-ä½¿ç”¨èµ„æºçš„åç§°æ¥è¿›è¡Œæœ¬åœ°ç«¯å£è½¬å‘pod"><a href="#port-forward-ä½¿ç”¨èµ„æºçš„åç§°æ¥è¿›è¡Œæœ¬åœ°ç«¯å£è½¬å‘pod" class="headerlink" title="port-forward - ä½¿ç”¨èµ„æºçš„åç§°æ¥è¿›è¡Œæœ¬åœ°ç«¯å£è½¬å‘pod"></a>port-forward - ä½¿ç”¨èµ„æºçš„åç§°æ¥è¿›è¡Œæœ¬åœ°ç«¯å£è½¬å‘pod</h3><p>æè¿°: å°†ä¸€ä¸ªæˆ–å¤šä¸ªæœ¬åœ°ç«¯å£è½¬å‘åˆ°pod, æ­¤å‘½ä»¤è¦æ±‚èŠ‚ç‚¹å®‰è£… socat, ä½¿ç”¨èµ„æºç±»å‹/åç§°<code>ï¼ˆå¦‚deployment/mydeploymentï¼‰</code>æ¥é€‰æ‹©pod, å¦‚æœçœç•¥èµ„æºç±»å‹é»˜è®¤ä¸ºâ€œpodâ€ã€‚</p>
<p>é€‚ç”¨èŒƒå›´ Podï¼ˆç¼ºçœï¼‰ã€Serviceã€RCã€deploymentã€‚</p>
<p>Tips : è½¬å‘ä¼šè¯ç»“æŸå½“é€‰å®šçš„podç»ˆæ­¢æ—¶ï¼Œéœ€è¦é‡æ–°è¿è¡Œå‘½ä»¤æ‰èƒ½æ¢å¤è½¬å‘ã€‚</p>
<p><strong>è¯­æ³•å‚æ•°:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¯­æ³•</span></span><br><span class="line">kubectl port-forward TYPE/NAME [options] [LOCAL_PORT:]REMOTE_PORT [...[LOCAL_PORT_N:]REMOTE_PORT_N]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‚æ•°</span></span><br><span class="line">--address=[localhost]       <span class="comment">#  è¦ç›‘å¬çš„åœ°å€(é€—å·åˆ†éš”)ã€‚</span></span><br><span class="line">--pod-running-timeout=1m0s: <span class="comment"># ç­‰å¾…æ—¶é—´çš„é•¿åº¦(å¦‚5s, 2mï¼Œæˆ–3hï¼Œå¤§äºé›¶)</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>åŸºç¡€å®ä¾‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># - (0) åœ¨æœ¬åœ°çš„éšæœºç«¯å£ä¸Šä¾¦å¬ï¼Œè½¬å‘åˆ°podä¸­çš„5000</span></span><br><span class="line">kubectl port-forward pod/mypod :5000</span><br><span class="line"></span><br><span class="line"><span class="comment"># - (1) æœ¬åœ°ä¾¦å¬ç«¯å£ 8443 è½¬å‘åˆ°æœåŠ¡é€‰æ‹©çš„podä¸­åä¸ºâ€œhttpsâ€çš„æœåŠ¡ç«¯å£çš„targetPort</span></span><br><span class="line">kubectl port-forward service/myservice 8443:https</span><br><span class="line"></span><br><span class="line"><span class="comment"># - (2) æ˜ å°„ redis-master-7d557b94bb-bzw2v Pod çš„ 6379 åˆ° 127.0.0.1,10.10.107.191 æ¥å£çš„7000</span></span><br><span class="line">kubectl port-forward --address 127.0.0.1,10.10.107.191 pod/redis-master-7d557b94bb-bzw2v 7000:6379</span><br><span class="line">  <span class="comment"># Forwarding from 10.10.107.191:7000 -&gt; 6379</span></span><br><span class="line">  <span class="comment"># Forwarding from 127.0.0.1:7000 -&gt; 6379</span></span><br><span class="line">  <span class="comment"># Handling connection for 7000</span></span><br></pre></td></tr></table></figure></p>
<h3 id="label-èŠ‚ç‚¹ã€èµ„æºæ ‡ç­¾æ›´æ–°ä¸è®¾ç½®"><a href="#label-èŠ‚ç‚¹ã€èµ„æºæ ‡ç­¾æ›´æ–°ä¸è®¾ç½®" class="headerlink" title="label - èŠ‚ç‚¹ã€èµ„æºæ ‡ç­¾æ›´æ–°ä¸è®¾ç½®"></a>label - èŠ‚ç‚¹ã€èµ„æºæ ‡ç­¾æ›´æ–°ä¸è®¾ç½®</h3><p>æè¿°: æ›´æ–°èµ„æºçš„æ ‡ç­¾ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æ ‡ç­¾æ¥è®¾ç½®Podä¸èŠ‚ç‚¹äº²å’Œæ€§ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># èŠ‚ç‚¹è§’è‰²åç§°è®¾ç½®</span></span><br><span class="line">~$ kubectl label node weiyigeek-223 node-role.kubernetes.io/work=<span class="built_in">test</span></span><br><span class="line">node/weiyigeek-223 labeled</span><br><span class="line"></span><br><span class="line"><span class="comment"># å–æ¶ˆèŠ‚ç‚¹è§’è‰²åç§°</span></span><br><span class="line">kubectl label node weiyigeek-223 node-role.kubernetes.io/work</span><br></pre></td></tr></table></figure>
<h3 id="top-é›†ç¾¤ç›¸å…³Metricsèµ„æºæ•°æ®æŸ¥çœ‹-ç±»æ¯”äºLinuxä¸‹çš„Top"><a href="#top-é›†ç¾¤ç›¸å…³Metricsèµ„æºæ•°æ®æŸ¥çœ‹-ç±»æ¯”äºLinuxä¸‹çš„Top" class="headerlink" title="top - é›†ç¾¤ç›¸å…³Metricsèµ„æºæ•°æ®æŸ¥çœ‹(ç±»æ¯”äºLinuxä¸‹çš„Top)"></a>top - é›†ç¾¤ç›¸å…³Metricsèµ„æºæ•°æ®æŸ¥çœ‹(ç±»æ¯”äºLinuxä¸‹çš„Top)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) æ²¡æœ‰å®‰è£… Kubernerters-Metrics-Server çš„æ—¶å€™å°†ä¼šæ˜¾ç¤ºä»¥ä¸‹é”™è¯¯;</span></span><br><span class="line">~$ kubectl top node</span><br><span class="line">error: Metrics API not available</span><br></pre></td></tr></table></figure>
<h3 id="scale-åŠ¨æ€æ›´æ–°å‰¯æœ¬æ•°"><a href="#scale-åŠ¨æ€æ›´æ–°å‰¯æœ¬æ•°" class="headerlink" title="scale - åŠ¨æ€æ›´æ–°å‰¯æœ¬æ•°"></a>scale - åŠ¨æ€æ›´æ–°å‰¯æœ¬æ•°</h3><p>æè¿°: ä¸ºéƒ¨ç½²ã€å‰¯æœ¬é›†ã€å¤åˆ¶æ§åˆ¶å™¨æˆ–æœ‰çŠ¶æ€é›†è®¾ç½®æ–°å¤§å°ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n app scale statefulset/xk-student --replicas=0</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="set-é…ç½®åº”ç”¨ç¨‹åºèµ„æº"><a href="#set-é…ç½®åº”ç”¨ç¨‹åºèµ„æº" class="headerlink" title="set - é…ç½®åº”ç”¨ç¨‹åºèµ„æº"></a>set - é…ç½®åº”ç”¨ç¨‹åºèµ„æº</h3><p><strong>å‘½ä»¤å‚æ•°</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage:</span></span><br><span class="line">  kubectl <span class="built_in">set</span> SUBCOMMAND [options]</span><br><span class="line"><span class="comment"># Available Commands:</span></span><br><span class="line">  env            æ›´æ–°æ¨¡æ¿ç¯å¢ƒå˜é‡</span><br><span class="line">  image          æ›´æ–°æ¨¡æ¿é•œåƒåœ°å€</span><br><span class="line">  resources      åœ¨å¯¹è±¡çš„ pod templates ä¸Šæ›´æ–°èµ„æºçš„ requests/limits</span><br><span class="line">  selector       è®¾ç½® resource çš„ selector</span><br><span class="line">  serviceaccount æ›´æ–°èµ„æºæœåŠ¡è´¦æˆ·</span><br><span class="line">  subject        æ›´æ–°è§’è‰²ç»‘å®šæˆ–ç¾¤é›†è§’è‰²ç»‘å®šä¸­çš„ç”¨æˆ·ã€ç»„æˆ–æœåŠ¡å¸æˆ·</span><br></pre></td></tr></table></figure></p>
<p><strong>ä½¿ç”¨æ¡ˆä¾‹</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.è®¾ç½®deploymentæ§åˆ¶å™¨ç®¡ç†çš„nginxèµ„æº,å°†nginxå®¹å™¨çš„é•œåƒæ¢æˆ1.21.0</span></span><br><span class="line">kubectl <span class="built_in">set</span> image deployment/nginx busybox=busybox:latest nginx=nginx:1.21.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.å°†æ‰€æœ‰deploymentå’Œrcçš„nginxå®¹å™¨æ˜ åƒæ›´æ–°ä¸ºâ€œnginx:1.9.1â€</span></span><br><span class="line">kubectl <span class="built_in">set</span> image deployments,rc nginx=nginx:1.9.1 --all</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.å°†å®ˆæŠ¤ç¨‹åºabcçš„æ‰€æœ‰å®¹å™¨çš„æ˜ åƒæ›´æ–°ä¸ºâ€œnginx:1.9.1â€</span></span><br><span class="line">kubectl <span class="built_in">set</span> image daemonset abc *=nginx:1.9.1</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="wait-ç­‰å¾…ä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºçš„ç‰¹å®šæ¡ä»¶-å®éªŒæ€§"><a href="#wait-ç­‰å¾…ä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºçš„ç‰¹å®šæ¡ä»¶-å®éªŒæ€§" class="headerlink" title="wait - ç­‰å¾…ä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºçš„ç‰¹å®šæ¡ä»¶(å®éªŒæ€§)"></a>wait - ç­‰å¾…ä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºçš„ç‰¹å®šæ¡ä»¶(å®éªŒæ€§)</h3><p>æè¿°: è¯¥å‘½ä»¤ä¼šå ç”¨å¤šä¸ªèµ„æºï¼Œé€šè¿‡ä½¿ç”¨â€“foræ ‡å¿—ç­‰å¾…åœ¨æ¯ä¸ªç»™å®šå¯¹è±¡çš„çŠ¶æ€å­—æ®µä¸­çœ‹åˆ°æŒ‡å®šçš„æ¡ä»¶èµ„æºï¼Œå¹¶å°†å‘æ ‡å‡†è¾“å‡ºä¸€æ¡æˆåŠŸæ¶ˆæ¯ï¼ŒæŒ‡ç¤ºä½•æ—¶æ»¡è¶³æŒ‡å®šæ¡ä»¶ï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨-oé€‰é¡¹æ›´æ”¹ä¸ºè¾“å‡ºç›®æ ‡ã€‚</p>
<p><strong>æ ¼å¼åŒ–è¾“å‡ºæ–‡ä»¶ç±»å‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-o, --output=<span class="string">''</span>: Output format. One of:</span><br><span class="line">json|yaml|name|go-template|go-template-file|template|templatefile|jsonpath|jsonpath-as-json|jsonpath-file.</span><br></pre></td></tr></table></figure></p>
<p><strong>ç®€å•ç¤ºä¾‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ç­‰å¾…Ingressç›¸å…³èµ„æºPodçŠ¶æ€ä¸ºReady,ä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨ï¼Œè¶…æ—¶å®è·µä¸º120</span></span><br><span class="line">kubectl <span class="built_in">wait</span> --namespace ingress-nginx \</span><br><span class="line">  --<span class="keyword">for</span>=condition=ready pod \</span><br><span class="line">  --selector=app.kubernetes.io/component=controller \</span><br><span class="line">  --timeout=120s</span><br><span class="line">  <span class="comment"># pod/ingress-nginx-controller-847949b9d7-9fzrj condition met</span></span><br><span class="line"></span><br><span class="line">kubectl <span class="built_in">wait</span> pod --namespace devtest \</span><br><span class="line">  --<span class="keyword">for</span>=condition=Ready \</span><br><span class="line">  --selector=app=oa \</span><br><span class="line">  --timeout=120s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ç­‰å¾…podâ€œbusybox1â€åŒ…å«ç±»å‹ä¸ºâ€œReadyâ€çš„çŠ¶æ€æ¡ä»¶</span></span><br><span class="line">kubectl <span class="built_in">wait</span> --<span class="keyword">for</span>=condition=Ready pod/busybox1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.çŠ¶æ€æ¡ä»¶çš„é»˜è®¤å€¼ä¸ºtrue,å¯ä»¥å°†å…¶è®¾ç½®ä¸ºfalse</span></span><br><span class="line">kubectl <span class="built_in">wait</span> --<span class="keyword">for</span>=condition=Ready=<span class="literal">false</span> pod/busybox1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.ç­‰å¾…podâ€œbusybox1â€åŒ…å«â€œæ­£åœ¨è¿è¡Œâ€çš„çŠ¶æ€é˜¶æ®µã€‚</span></span><br><span class="line">kubectl <span class="built_in">wait</span> --<span class="keyword">for</span>=jsonpath=<span class="string">'&#123;.status.phase&#125;'</span>=Running pod/busybox1</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘å‡ºâ€œåˆ é™¤â€å‘½ä»¤åï¼Œç­‰å¾…podâ€œbusybox1â€è¢«åˆ é™¤ï¼Œè¶…æ—¶60ç§’</span></span><br><span class="line">kubectl delete pod/busybox1</span><br><span class="line">kubectl <span class="built_in">wait</span> --<span class="keyword">for</span>=delete pod/busybox1 --timeout=60s</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">#æŸ¥çœ‹å½“å‰æ›´æ–°çŠ¶æ€</span><br><span class="line">kubectl rollout status deployments nginx-deployment </span><br><span class="line">kubectl get pods </span><br><span class="line">#æŸ¥çœ‹å¯å›æ»šçš„å†å²ç‰ˆæœ¬</span><br><span class="line">kubectl rollout history deployment&#x2F;nginx-deployment </span><br><span class="line">kubectl rollout undo deployment&#x2F;nginx-deployment</span><br><span class="line">##å¯ä»¥ä½¿ç”¨--revisionå‚æ•°æŒ‡å®šå›é€€åˆ°æŸä¸ªå†å²ç‰ˆæœ¬ </span><br><span class="line">kubectl rollout undo deployment&#x2F;nginx-deployment --to-revision&#x3D;2  </span><br><span class="line">##æš‚åœ deploymentçš„æ›´æ–°</span><br><span class="line">kubectl rollout pause deployment&#x2F;nginx-deployment</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ kubectl get ep -o wide</span><br><span class="line">NAME               ENDPOINTS                                               AGE</span><br><span class="line">deploy-blog-svc    10.244.0.209:80,10.244.1.196:80,10.244.2.99:80          34d</span><br><span class="line">deploy-maven-svc   10.244.0.236:8080,10.244.1.221:8080,10.244.2.124:8080   32d</span><br><span class="line">kubernetes         10.10.107.202:6443                                      83d</span><br><span class="line"># åœ¨Kubenatesçš„ä¸Šåˆ›å»ºdevopså‘½åç©ºé—´ï¼Œç”¨äºJenkinsä½¿ç”¨</span><br><span class="line">kubectl create namespace devops</span><br><span class="line"></span><br><span class="line"># åœ¨Kubernetesä¸Šä¸ºJenkinsæ„å»ºåˆ›å»ºæœ‰Cluster Adminæƒé™çš„Service Account jenkinsï¼š</span><br><span class="line">kubectl create clusterrolebinding jenkins --clusterrole cluster-admin --serviceaccount&#x3D;devops:jenkins</span><br><span class="line"></span><br><span class="line">Tips : åˆ›å»ºDeploymentæ§åˆ¶å™¨æ§åˆ¶çš„èµ„æºï¼Œå®é™…ä¸Šä¸åŠ portä¹Ÿèƒ½é€šè¿‡æœåŠ¡è¿›è¡Œå‘ç°å®é™…å·¥ä½œä¸­ä¸€å®šè¦åŠ ä¸Šä¸ºäº†åæœŸé—®é¢˜çš„æ’æŸ¥</span><br><span class="line"></span><br><span class="line">Tips : å¯ä»¥é‡‡ç”¨ç›´æ¥ RUN åˆ›å»ºPod, å®é™…ä¸Šä¸åŠ portä¹Ÿèƒ½é€šè¿‡æœåŠ¡è¿›è¡Œå‘ç°å®é™…å·¥ä½œä¸­ä¸€å®šè¦åŠ ä¸Šä¸ºäº†åæœŸé—®é¢˜çš„æ’æŸ¥</span><br><span class="line">kubectl run nginx --image nginx:latest --port&#x3D;80 --replicas&#x3D;2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">~$ kubectl get clusterroles system:aggregate-to-admin -o yaml</span><br><span class="line">apiVersion: rbac.authorization.k8s.io&#x2F;v1</span><br><span class="line">kind: ClusterRole</span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    rbac.authorization.kubernetes.io&#x2F;autoupdate: &quot;true&quot;</span><br><span class="line">  creationTimestamp: &quot;2021-01-11T04:55:10Z&quot;</span><br><span class="line">  labels:</span><br><span class="line">    kubernetes.io&#x2F;bootstrapping: rbac-defaults</span><br><span class="line">    rbac.authorization.k8s.io&#x2F;aggregate-to-admin: &quot;true&quot;</span><br><span class="line">  managedFields:</span><br><span class="line">  - apiVersion: rbac.authorization.k8s.io&#x2F;v1</span><br><span class="line">    fieldsType: FieldsV1</span><br><span class="line">    fieldsV1:</span><br><span class="line">      f:metadata:</span><br><span class="line">        f:annotations:</span><br><span class="line">          .: &#123;&#125;</span><br><span class="line">          f:rbac.authorization.kubernetes.io&#x2F;autoupdate: &#123;&#125;</span><br><span class="line">        f:labels:</span><br><span class="line">          .: &#123;&#125;</span><br><span class="line">          f:kubernetes.io&#x2F;bootstrapping: &#123;&#125;</span><br><span class="line">          f:rbac.authorization.k8s.io&#x2F;aggregate-to-admin: &#123;&#125;</span><br><span class="line">      f:rules: &#123;&#125;</span><br><span class="line">    manager: kube-apiserver</span><br><span class="line">    operation: Update</span><br><span class="line">    time: &quot;2021-01-11T04:55:10Z&quot;</span><br><span class="line">  name: system:aggregate-to-admin</span><br><span class="line">  resourceVersion: &quot;50&quot;</span><br><span class="line">  selfLink: &#x2F;apis&#x2F;rbac.authorization.k8s.io&#x2F;v1&#x2F;clusterroles&#x2F;system%3Aaggregate-to-admin</span><br><span class="line">  uid: 93f094d8-f5f6-42c6-bcc8-e6ca9bb0f37a</span><br><span class="line">rules:</span><br><span class="line">- apiGroups:</span><br><span class="line">  - authorization.k8s.io</span><br><span class="line">  resources:</span><br><span class="line">  - localsubjectaccessreviews</span><br><span class="line">  verbs:</span><br><span class="line">  - create</span><br><span class="line">- apiGroups:</span><br><span class="line">  - rbac.authorization.k8s.io</span><br><span class="line">  resources:</span><br><span class="line">  - rolebindings</span><br><span class="line">  - roles</span><br><span class="line">  verbs:</span><br><span class="line">  - create</span><br><span class="line">  - delete</span><br><span class="line">  - deletecollection</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - patch</span><br><span class="line">  - update</span><br><span class="line">  - watch</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒåœ°å€ï¼š <a href="https://www.cnblogs.com/shunzi115/p/12392056.html" target="_blank" rel="noopener">https://www.cnblogs.com/shunzi115/p/12392056.html</a></p>

        </div>
        
        <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
        
        <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½çœ‹å‹,æ¬¢è¿å…³æ³¨åšä¸»å¾®ä¿¡å…¬ä¼—å·å“Ÿ! â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘å³å¯å…³é—­ç»§ç»­æµè§ˆæ–‡ç« .<br>  <b style="color:red;"> æ¸©é¦¨æç¤º: æœªè§£é”çš„ç”¨æˆ·ä¸èƒ½ç²˜è´´å¤åˆ¶æ–‡ç« å†…å®¹å“Ÿ!</b> <br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
           

        <!-- Google å¹¿å‘Š -->
        
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
  

        
<hr/>
<div style="text-align: center;font-weight: bold;">
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>
  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>
<!-- 

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul> -->
  <div>
    <img src="/img/share-wechat.jpg" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·ä¸Visit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº" >
    <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ã€è½¬ä¸ªå‘ã€èµä¸ªåŠ©ã€‘</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œæˆ‘å°†æŒç»­æ•´ç†å‘å¸ƒæ›´å¤šä¼˜è´¨åŸåˆ›æ–‡ç« ï¼ã€‚</p>
    <img src="/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>
</div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2023-03-05T09:22:43.128Z" itemprop="dateUpdated">2023-03-05 17:22:43</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/n2-kubernetesæ“ä½œå‘½ä»¤è¯¦ç»†ä¸€è§ˆ.md" target="_blank" rel="noopener noreferrer">_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/n2-kubernetesæ“ä½œå‘½ä»¤è¯¦ç»†ä¸€è§ˆ.md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2020/5-2-474.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/5-2-474.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">â˜•ï¸ è¯·ä½œè€…å–æ¯å’–å•¡!</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/5-2-474.html&title=ã€Šn2-kubernetesæ“ä½œå‘½ä»¤è¯¦ç»†ä¸€è§ˆã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/5-2-474.html&title=ã€Šn2-kubernetesæ“ä½œå‘½ä»¤è¯¦ç»†ä¸€è§ˆã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/5-2-474.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Šn2-kubernetesæ“ä½œå‘½ä»¤è¯¦ç»†ä¸€è§ˆã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/5-2-474.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/5-2-474.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/5-2-472.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">n0-Kuberneteså…¥å‘è§£å†³FAQè®°å½•</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/5-2-473.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">n1-Kubernetesåç§°æ¦‚å¿µè§£é‡Šä¸€è§ˆ</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-å‰è¨€ç®€è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">0x00 å‰è¨€ç®€è¿°</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01-Kubeadm-å‘½ä»¤-ç”¨æ¥åˆå§‹åŒ–é›†ç¾¤çš„æŒ‡ä»¤"><span class="post-toc-number">2.</span> <span class="post-toc-text">0x01 Kubeadm å‘½ä»¤ - ç”¨æ¥åˆå§‹åŒ–é›†ç¾¤çš„æŒ‡ä»¤</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#init-åˆå§‹åŒ–é…ç½®ç›¸å…³"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">init - åˆå§‹åŒ–é…ç½®ç›¸å…³</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#token-ç”Ÿæˆè®¤è¯ç›¸å…³ä¿¡æ¯"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">token - ç”Ÿæˆè®¤è¯ç›¸å…³ä¿¡æ¯</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#config-åŸºç¡€ç¯å¢ƒä¾èµ–é…ç½®"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">config - åŸºç¡€ç¯å¢ƒä¾èµ–é…ç½®</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#join-é›†ç¾¤æˆ–è€…èŠ‚ç‚¹åŠ å…¥åˆå§‹åŒ–"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">join - é›†ç¾¤æˆ–è€…èŠ‚ç‚¹åŠ å…¥åˆå§‹åŒ–</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#reset-èŠ‚ç‚¹é‡ç½®æ“ä½œ"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">reset - èŠ‚ç‚¹é‡ç½®æ“ä½œ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#upgrade-èŠ‚ç‚¹æ›´æ–°æ“ä½œ"><span class="post-toc-number">2.6.</span> <span class="post-toc-text">upgrade - èŠ‚ç‚¹æ›´æ–°æ“ä½œ</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-Kubelet-å‘½ä»¤-åœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šç”¨æ¥å¯åŠ¨-pod-å’Œå®¹å™¨ç­‰ã€‚"><span class="post-toc-number">3.</span> <span class="post-toc-text">0x02 Kubelet å‘½ä»¤ - åœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šç”¨æ¥å¯åŠ¨ pod å’Œå®¹å™¨ç­‰ã€‚</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x03-Kubectl-å‘½ä»¤-ç”¨æ¥ä¸é›†ç¾¤é€šä¿¡çš„å‘½ä»¤è¡Œå·¥å…·"><span class="post-toc-number">4.</span> <span class="post-toc-text">0x03 Kubectl å‘½ä»¤ - ç”¨æ¥ä¸é›†ç¾¤é€šä¿¡çš„å‘½ä»¤è¡Œå·¥å…·</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#api-versions-å½“å‰å¯ç”¨é›†ç¾¤æ”¯æŒçš„ç‰ˆæœ¬"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">api-versions - å½“å‰å¯ç”¨é›†ç¾¤æ”¯æŒçš„ç‰ˆæœ¬</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#api-resources-è·å¾—æ”¯æŒèµ„æºçš„å®Œæ•´åˆ—è¡¨"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">api-resources - è·å¾—æ”¯æŒèµ„æºçš„å®Œæ•´åˆ—è¡¨</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#apply-å½“èµ„æºæ¸…å•é‡æ–°ä¿®æ”¹åé‡‡ç”¨æ­¤å‘½ä»¤é‡æ–°åº”ç”¨"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">apply - å½“èµ„æºæ¸…å•é‡æ–°ä¿®æ”¹åé‡‡ç”¨æ­¤å‘½ä»¤é‡æ–°åº”ç”¨</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#attach-è¿›å…¥podå®¹å™¨ä¸­è¿›è¡Œäº¤äº’å¼è¿è¡Œ"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">attach - è¿›å…¥podå®¹å™¨ä¸­è¿›è¡Œäº¤äº’å¼è¿è¡Œ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#cluster-info-K8s-é›†ç¾¤ä¿¡æ¯"><span class="post-toc-number">4.5.</span> <span class="post-toc-text">cluster-info - K8s é›†ç¾¤ä¿¡æ¯</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#config-é›†ç¾¤ä¸Šä¸‹æ–‡ä»¥åŠç”¨æˆ·é…ç½®"><span class="post-toc-number">4.6.</span> <span class="post-toc-text">config - é›†ç¾¤ä¸Šä¸‹æ–‡ä»¥åŠç”¨æˆ·é…ç½®</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#cp-å¤åˆ¶Podä¸­çš„æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ä¹‹ä¸­"><span class="post-toc-number">4.7.</span> <span class="post-toc-text">cp - å¤åˆ¶Podä¸­çš„æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ä¹‹ä¸­</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#create-æ ¹æ®èµ„æºæ¸…å•åˆ›å»ºå¯¹åº”çš„Pod"><span class="post-toc-number">4.8.</span> <span class="post-toc-text">create - æ ¹æ®èµ„æºæ¸…å•åˆ›å»ºå¯¹åº”çš„Pod</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#cordon-èŠ‚ç‚¹é™åˆ¶åŠ å…¥èµ„æº"><span class="post-toc-number">4.9.</span> <span class="post-toc-text">cordon - èŠ‚ç‚¹é™åˆ¶åŠ å…¥èµ„æº</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#describe-æ˜¾ç¤ºæœ‰å…³èµ„æºçš„è¯¦ç»†ä¿¡æ¯"><span class="post-toc-number">4.10.</span> <span class="post-toc-text">describe - æ˜¾ç¤ºæœ‰å…³èµ„æºçš„è¯¦ç»†ä¿¡æ¯</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#delete-åˆ é™¤èŠ‚ç‚¹å’Œèµ„æº"><span class="post-toc-number">4.11.</span> <span class="post-toc-text">delete - åˆ é™¤èŠ‚ç‚¹å’Œèµ„æº</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#drain-èŠ‚ç‚¹ç»„ä»¶æ¸…ç†"><span class="post-toc-number">4.12.</span> <span class="post-toc-text">drain - èŠ‚ç‚¹ç»„ä»¶æ¸…ç†</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#exec-åœ¨podä¸­çš„å®¹å™¨ç¯å¢ƒå†…æ‰§è¡Œå‘½ä»¤-å’Œå‘½ä»¤docker-exec-ç±»ä¼¼"><span class="post-toc-number">4.13.</span> <span class="post-toc-text">exec - åœ¨podä¸­çš„å®¹å™¨ç¯å¢ƒå†…æ‰§è¡Œå‘½ä»¤(å’Œå‘½ä»¤docker exec ç±»ä¼¼)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#expose-å°†èµ„æºå…¬å¼€ä¿ç•™ä¸ºæ–°çš„SVCæœåŠ¡ã€‚"><span class="post-toc-number">4.14.</span> <span class="post-toc-text">expose - å°†èµ„æºå…¬å¼€ä¿ç•™ä¸ºæ–°çš„SVCæœåŠ¡ã€‚</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#get-æ˜¾ç¤ºèµ„æºåˆ—è¡¨"><span class="post-toc-number">4.15.</span> <span class="post-toc-text">get - æ˜¾ç¤ºèµ„æºåˆ—è¡¨</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#logs-æŸ¥çœ‹podä¸­çš„å®¹å™¨çš„æ‰“å°æ—¥å¿—ï¼ˆå’Œå‘½ä»¤docker-logs-ç±»ä¼¼ï¼‰"><span class="post-toc-number">4.16.</span> <span class="post-toc-text">logs - æŸ¥çœ‹podä¸­çš„å®¹å™¨çš„æ‰“å°æ—¥å¿—ï¼ˆå’Œå‘½ä»¤docker logs ç±»ä¼¼ï¼‰</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#run-è¿è¡Œä¸€ä¸ªpodåº”ç”¨"><span class="post-toc-number">4.17.</span> <span class="post-toc-text">run - è¿è¡Œä¸€ä¸ªpodåº”ç”¨</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#replace-ç”¨æ–‡ä»¶åæˆ–stdinæ›¿æ¢èµ„æº"><span class="post-toc-number">4.18.</span> <span class="post-toc-text">replace - ç”¨æ–‡ä»¶åæˆ–stdinæ›¿æ¢èµ„æº</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#port-forward-ä½¿ç”¨èµ„æºçš„åç§°æ¥è¿›è¡Œæœ¬åœ°ç«¯å£è½¬å‘pod"><span class="post-toc-number">4.19.</span> <span class="post-toc-text">port-forward - ä½¿ç”¨èµ„æºçš„åç§°æ¥è¿›è¡Œæœ¬åœ°ç«¯å£è½¬å‘pod</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#label-èŠ‚ç‚¹ã€èµ„æºæ ‡ç­¾æ›´æ–°ä¸è®¾ç½®"><span class="post-toc-number">4.20.</span> <span class="post-toc-text">label - èŠ‚ç‚¹ã€èµ„æºæ ‡ç­¾æ›´æ–°ä¸è®¾ç½®</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#top-é›†ç¾¤ç›¸å…³Metricsèµ„æºæ•°æ®æŸ¥çœ‹-ç±»æ¯”äºLinuxä¸‹çš„Top"><span class="post-toc-number">4.21.</span> <span class="post-toc-text">top - é›†ç¾¤ç›¸å…³Metricsèµ„æºæ•°æ®æŸ¥çœ‹(ç±»æ¯”äºLinuxä¸‹çš„Top)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#scale-åŠ¨æ€æ›´æ–°å‰¯æœ¬æ•°"><span class="post-toc-number">4.22.</span> <span class="post-toc-text">scale - åŠ¨æ€æ›´æ–°å‰¯æœ¬æ•°</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#set-é…ç½®åº”ç”¨ç¨‹åºèµ„æº"><span class="post-toc-number">4.23.</span> <span class="post-toc-text">set - é…ç½®åº”ç”¨ç¨‹åºèµ„æº</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#wait-ç­‰å¾…ä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºçš„ç‰¹å®šæ¡ä»¶-å®éªŒæ€§"><span class="post-toc-number">4.24.</span> <span class="post-toc-text">wait - ç­‰å¾…ä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºçš„ç‰¹å®šæ¡ä»¶(å®éªŒæ€§)</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
    <!-- 
  <div id="post-wechat" class="post-wechat" style="position:fixed;top: 360px;bottom: 500px;right: 3%;width: 190px;text-align: center; z-index: 9999">
    <p><b>å…³æ³¨ã€å…¨æ ˆå·¥ç¨‹å¸ˆä¿®ç‚¼æŒ‡å—ã€‘</b></p>
    <img src="/img/wechat-gzh.jpg" class="img-responsive" alt="weiyigeek">
    <p><b>æ¬¢è¿æ·»åŠ ã€ä½œè€…ã€‘å¾®ä¿¡</b></p>
    <img src="/img/wehat.jpg" class="img-responsive" alt="weiyigeek">
  </div>
 -->

    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå°±è¯·ä½œè€…å–æ¯ Coffee â˜•ï¸â˜•ï¸!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      
</article>
</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="/img/share-wechat.jpg" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">åšä¸»Github</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">åšä¸»Gitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">çŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.modb.pro/u/506690" target="_blank">å¢¨å¤©è½®</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.ixigua.com/home/3984243135350727" target="_blank">è¥¿ç“œè§†é¢‘</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2023 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/><a id="SiteRunTime"></a>
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div>
        <div id="blog-wormhole-id" >
          <a href="https://www.foreverblog.cn/go.html" target="_blank"> 
            <img src="https://img.foreverblog.cn/wormhole_2_tp.gif" alt="åå¹´ä¹‹çº¦è™«æ´" style="height:32px;max-height:50px;display:block;margin:0 auto;" title="ç©¿æ¢­è™«æ´-éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢">
          </a>
        </div>
        <div id="cc-myssl-id" >
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank">
            <img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto">
          </a>
        </div>
      </p>
    </div>
</footer>



    <div class="mask" id="mask"></div>

<div id="go" class="waves-effect waves-light">
  <a href="javascript:;" id="goqrcode"> <span class="icon icon-lg icon-qrcode"></span> </a>
  <a href="javascript:;" id="gotop"> <span class="icon icon-lg icon-chevron-up"></span></a>
</div>





<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/5-2-474.html&title=ã€Šn2-kubernetesæ“ä½œå‘½ä»¤è¯¦ç»†ä¸€è§ˆã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/5-2-474.html&title=ã€Šn2-kubernetesæ“ä½œå‘½ä»¤è¯¦ç»†ä¸€è§ˆã€‹ â€” WeiyiGeek Blog&source=[TOC]" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/5-2-474.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Šn2-kubernetesæ“ä½œå‘½ä»¤è¯¦ç»†ä¸€è§ˆã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/5-2-474.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/5-2-474.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMElEQVR42u3aS47CMBAFQO5/6cwWaQZ4rx1GilNeoSgEVxaN+/N4xOt4Wr+vPF9/df+rZ7bfWloYGBiXZRxv18oPvH9C/vn93jAwMO7DSDbxHp9/Kwni+d4wMDAwzronD9kYGBgY5wbcPPjOgiwGBgZGm8SuhMg2cf1iLo6BgXFBxqxw9j+fv9LfwMDAuBTjKFf+hDZcHgsLAwNjb0Ye4JJN5EfD5NW0wx8YGBh3YLRFt6RMtjIc1l7BwMC4A6MdoVgv+ie/WOwBAwNjU8YsvZw1NfPgWwdrDAyMrRmzYYukrNaG4PxY+fJVYmBg3IDRluxnyersnqich4GBsTVjVgKbJbRJKps3CT6QMDAwtmOsPKgtsc1eR1Lyw8DA2I+Rb71tA+TFuPY/oRizwMDA2IiRbzdPINvm5UrQx8DAuBtjfZxiBmtD8B9HQwwMjE0Zw3x3eUhi/aUU/Q0MDIyLM2bDWy3jrMNl1AzAwMDYjpGEubwZOSvJ5Unsh2YDBgbGzRgrjcm2YLcy0vqhy4GBgbE1oz0+5kW0laGKotyGgYGxKaMtxCepb3sonKW1GBgYezOOcrXF/bZJkB8EPzQvMTAwNmLMSv/npr5JmJ4NZ2BgYOzEWElT2xQ0eYuzQI+BgXEHRnJcyxPgfGBiZQgDAwMDIzmW5YnlShAvim4YGBgYcbhs25x5gD7taIiBgXFBRpLEtu2B9vC3MsaBgYGxNyNPHWetx3YTs2CNgYGxKeMHOzFqmBu7ptkAAAAASUVORK5CYII=" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å”¯ä¸€æå®¢-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
<script type="text/javascript">
// ç«™ç‚¹è¿è¡Œæ—¶é—´
var BootDate = new Date("2018/01/01 00:00:00");
function ShowRunTime(id) {
  var NowDate = new Date();
  var RunDateM = parseInt(NowDate - BootDate);
  var RunDays = Math.floor(RunDateM/(24*3600*1000));
  var RunHours = Math.floor(RunDateM%(24*3600*1000)/(3600*1000));
  var RunMinutes = Math.floor(RunDateM%(24*3600*1000)%(3600*1000)/(60*1000));
  var RunSeconds = Math.round(RunDateM%(24*3600*1000)%(3600*1000)%(60*1000)/1000);
  var RunTime = RunDays + " å¤© " + RunHours + " æ—¶ " + RunMinutes + " åˆ† " + RunSeconds + " ç§’";
  document.getElementById(id).innerHTML = "ç½‘ç«™å·²åœ¨é£é›¨ä¸­å‹‰å‹‰å¼ºå¼ºè¿è¡Œäº†ã€ " + RunTime + " ã€‘";
}
setInterval("ShowRunTime('SiteRunTime')", 1000);
</script>
    
  <div id="post-wechat" class="post-wechat" style="position:fixed;top: 360px;bottom: 500px;right: 3%;width: 190px;text-align: center; z-index: 9999">
    <p><b>å…³æ³¨ã€å…¨æ ˆå·¥ç¨‹å¸ˆä¿®ç‚¼æŒ‡å—ã€‘</b></p>
    <img src="/img/wechat-gzh.jpg" class="img-responsive" alt="weiyigeek">
    <p><b>æ¬¢è¿æ·»åŠ ã€ä½œè€…ã€‘å¾®ä¿¡</b></p>
    <img src="/img/wehat.jpg" class="img-responsive" alt="weiyigeek">
  </div>

</body>
</html>