<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-language" content="zh-CN"/>
    <meta name="author" content="WeiyiGeek" />
    <meta name="msvalidate.01" content="5C552FB1D885E0E11D2957EC958C8018" />
    <meta name="shenma-site-verification" content="4c655e91c76be0a93c1b6954c666c9d6_1649049085"/>
    <meta name="bytedance-verification-code" content="lKs4FqwCHSJ3A/c5tT7X" />
    <meta name="sogou_site_verification" content="OC65iET6Bk" />
    
    <title>ğŸŒ 9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç»|WeiyiGeek Blog|å”¯ä¸€æå®¢Geek-ITç½‘ç»œå®‰å…¨è¿ç»´å¼€å‘æŠ€æœ¯çŸ¥è¯†åˆ†äº«-åšå®¢ç«™ç‚¹</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
    <meta name="keywords" content="k8s">
    <meta name="Description" content="WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ªèº«æŠ€æœ¯èƒ½åŠ›,ç«‹å¿—ç»´æŠ¤å¤§ä¼—ç½‘ç»œå®‰å…¨ä¸ºå·±ä»»,åšä¸€ä¸ªå¯¹å›½å®¶æœ‰ç”¨çš„äºº,ä¸ºå®ç°ä¸­åæ°‘æ—ä¼Ÿå¤§å¤å…´çš„ä¸­å›½æ¢¦ä¸æ‡ˆå¥‹æ–—">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery/3.5.2-jquery.fancybox.min.css?v=1.6.6" />
    <link rel="stylesheet" href="/css/style.css?v=1.6.6">
    <!--  -->
     <script type="text/javascript" src="/js/custom/articlecost.js?v=1.6.6"></script> 
    <link rel="stylesheet" href="/css/third-party/gitalk.css?v=1.6.6"> 
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9134434519967436" crossorigin="anonymous"></script>    
    <script type="text/javascript">
        // Data Center
        var DC = {
          reward:	true,
          lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
          v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}')
        };
    </script>
    <script type="text/javascript">window.lazyScripts=[];</script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="WeiyiGeek Blog" type="application/atom+xml">
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg" alt="WeiyiGeek-backgroud">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg" alt="WeiyiGeek-å¤´åƒ">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">WeiyiGeek</h5>
          <a href="mailto:master@weiyigeek.top" title="master@weiyigeek.top" class="mail">
            <span>m</span><span>a</span><span>s</span><span>t</span><span>e</span><span>r</span><span>@</span><span>w</span><span>e</span><span>i</span><span>y</span><span>i</span><span>g</span><span>e</span><span>e</span><span>k</span><span>.</span><span>t</span><span>o</span><span>p</span>
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">
                  <i class="icon icon-lg icon-wechat"></i>
                </a>
              </li>
            
              <li>
                <a href="https://github.com/weiyigeek" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
              <li>
                <a href="https://t.me/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-telegram"></i>
                </a>
              </li>
            
              <li>
                <a href="https://twitter.com/WeiyiGeek" target="_blank">
                  <i class="icon icon-lg icon-twitter"></i>
                </a>
              </li>
            
              <li>
                <a href="https://weibo.com/615643678" target="_blank">
                  <i class="icon icon-lg icon-weibo"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                é¦–é¡µ
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                æ–‡ç« åˆ†ç±»
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                æ–‡ç« æ ‡ç­¾
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                æ–‡ç« å½’æ¡£
              </a>
            </li>
        
            <li class="">
              <a href="/books"  >
                <i class="icon icon-lg icon-book"></i>
                å­¦ä¹ ä¹¦ç±
              </a>
            </li>
        
            <li class="">
              <a href="/about"  >
                <i class="icon icon-lg icon-user"></i>
                å…³äºä½œè€…
              </a>
            </li>
        
            <li class="">
              <a href="/links"  >
                <i class="icon icon-lg icon-link"></i>
                ç«™ç‚¹å¯¼èˆª
              </a>
            </li>
        
            <li class="">
              <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank" >
                <i class="icon icon-lg icon-wechat"></i>
                å…¬ä¼—è´¦å·
              </a>
            </li>
        
            <li class="">
              <a href="https://space.bilibili.com/385802642" target="_blank" >
                <i class="icon icon-lg icon-youtube-play"></i>
                å“”å“©å“”å“©
              </a>
            </li>
        
            <li class="">
              <a href="https://github.com/weiyigeek" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="">
              <a href="https://twitter.com/WeiyiGeek" target="_blank" >
                <i class="icon icon-lg icon-twitter"></i>
                Twitter
              </a>
            </li>
        
            <li class="">
              <a href="https://weibo.com/615643678" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç»</span>
            
        </div>

        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        

        
            <a href="/atom.xml" class="header-icon pull-right waves-effect waves-circle waves-light">
                <i class="icon icon-lg icon-rss"></i>
            </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg" alt="æ–‡ç« å¤´éƒ¨èƒŒæ™¯">
    <div class="container fade-scale">
        <h1 class="title">9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç»</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-10-27T10:37:47.000Z" itemprop="datePublished" class="page-time">
  2020-10-27
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
  <article id="post-è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç»"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç»</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-10-27 18:37:47" datetime="2020-10-27T10:37:47.000Z"  itemprop="datePublished">2020-10-27</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/">Containers</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Containers/OperationTools/">OperationTools</a></li></ul></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p>[TOC]</p>
<h2 id="Security-é›†ç¾¤å®‰å…¨"><a href="#Security-é›†ç¾¤å®‰å…¨" class="headerlink" title="Security - é›†ç¾¤å®‰å…¨"></a>Security - é›†ç¾¤å®‰å…¨</h2><p>æè¿°: Kubernetes ä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼çš„é›†ç¾¤ç®¡ç†å·¥å…·ï¼Œä¿è¯é›†ç¾¤çš„å®‰å…¨æ€§æ˜¯éå¸¸è‡³å…³é‡è¦çš„ã€‚åŒæ—¶ç”±äºAPI Serveræ˜¯é›†ç¾¤å†…éƒ¨å„ä¸ªç»„ä»¶é€šä¿¡çš„ä¸­ä»‹ï¼Œä¹Ÿæ˜¯å¤–éƒ¨æ§åˆ¶çš„å…¥å£ï¼Œæ‰€ä»¥Kubernetesçš„å®‰å…¨æœºåˆ¶åŸºæœ¬æ˜¯å°±æ˜¯å›´ç»•ä¿æŠ¤<code>API Server</code> æ¥è¿›è¡Œè®¾è®¡çš„;</p>
<p>Kubernetes ä½¿ç”¨äº†<code>è®¤è¯(Authentication)ã€é‰´æƒ(Authorization)ã€å‡†å…¥æ§åˆ¶(Admission Control)</code>ä¸‰æ­¥æ¥ä¿è¯ æ¯ä¸ª è¯·æ±‚ API Server éƒ½æ˜¯å®‰å…¨;</p>
<figure class="image-box">
                <a rel=9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç» href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201124151922.png" target="_blank" title="WeiyiGeek.Kubernetesæœºåˆ¶è¯´æ˜" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201124151922.png" alt="WeiyiGeek.Kubernetesæœºåˆ¶è¯´æ˜" title="" class=""></a>
                <p>WeiyiGeek.Kubernetesæœºåˆ¶è¯´æ˜</p>
            </figure>
<p><br></p>
<h3 id="1-Authenticationï¼ˆè®¤è¯ï¼‰"><a href="#1-Authenticationï¼ˆè®¤è¯ï¼‰" class="headerlink" title="1) Authenticationï¼ˆè®¤è¯ï¼‰"></a>1) Authenticationï¼ˆè®¤è¯ï¼‰</h3><p>æè¿°: å¼€å¯TLSæ—¶æ‰€æœ‰çš„è¯·æ±‚éƒ½éœ€è¦é¦–å…ˆè®¤è¯ï¼Œk8sæ”¯æŒå¤šç§è®¤è¯æœºåˆ¶å¹¶æ”¯æŒåŒæ—¶å¼€å¯å¤šä¸ªè®¤è¯æ’ä»¶(<code>åªéœ€è¦ä¸€ä¸ªè®¤è¯é€šè¿‡å³å¯</code>)ï¼Œå¦‚æœè®¤è¯æˆåŠŸåˆ™ç”¨æˆ·çš„usernameä¼šä¼ å…¥æˆæƒæ¨¡å—åšè¿›ä¸€æ­¥çš„æˆæƒéªŒè¯ï¼Œè€Œå¯¹äºè®¤è¯å¤±è´¥çš„è¯·æ±‚åˆ™<code>è¿”å› HTTP 401</code>;</p>
<p><strong>è®¤è¯åˆ†ç±»:</strong></p>
<ul>
<li><p>1.HTTP Token è®¤è¯: é€šè¿‡ä¸€ä¸ªTokenï¼ˆå­—ç¬¦ä¸²ï¼‰ æ¥è¯†åˆ«åˆæ³•ç”¨æˆ·;</p>
<blockquote>
<p>ç®€è¿°: HTTP Token çš„è®¤è¯æ˜¯ç”¨ä¸€ä¸ªå¾ˆé•¿çš„ç‰¹æ®Šç¼–ç æ–¹å¼çš„å¹¶ä¸”éš¾ä»¥è¢«æ¨¡ä»¿çš„å­—ç¬¦ä¸²-Token æ¥è¡¨è¾¾å®¢æˆ·çš„ä¸€ç§æ–¹å¼(å¾ˆé•¿çš„å¾ˆå¤æ‚çš„å®‡ç¬¦ä¸²)ã€‚æ¯ä¸ªToken å¯¹åº”ä¸€ä¸ªç”¨æˆ·åå­˜å‚¨åœ¨ API Server èƒ½è®¿é—®çš„æ–‡ä»¶ä¸­ã€‚å½“å®¢æˆ·ç«¯å‘èµ·APIè°ƒç”¨è¯·æ±‚æ—¶ï¼Œéœ€è¦åœ¨ HTTP Header é‡Œæ”¾å…¥ Tokenã€‚</p>
</blockquote>
</li>
<li><p>2.HTTP Base è®¤è¯: é€šè¿‡ç”¨æˆ·å+å¯†ç çš„æ–¹å¼è®¤è¯;</p>
<blockquote>
<p>ç®€è¿°: ç”¨æˆ·å:å¯†ç ç”¨ BASE64 ç®—æ³•è¿›è¡Œç¼–ç åçš„å®‡ç¬¦ä¸²æ”¾åœ¨ HTTP Request ä¸­çš„ HeatherAuthorization åŸŸé‡Œå‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°åè¿›è¡Œç¼–ç ä»ä¸­è·å–ç”¨æˆ·ååŠå¯†ç ï¼›</p>
</blockquote>
</li>
<li><p>3.HTTPS è®¤è¯ : æœ€ä¸¥æ ¼çš„è®¤è¯æ–¹å¼ä¹‹ä¸€;</p>
<blockquote>
<p>ç®€è¿°:åŸºäºCAæ ¹è¯ä¹¦ç­¾å(ç­¾å‘)çš„å®¢æˆ·ç«¯/æœåŠ¡ç«¯èº«ä»½è®¤è¯æ–¹å¼(<code>æ™®éé‡‡ç”¨æ–¹æ¡ˆ</code>);</p>
</blockquote>
</li>
</ul>
<p>Tips: k8s ä¸ç®¡ç†ç”¨æˆ·è™½ç„¶k8sè®¤è¯æˆæƒé‡‡ç”¨äº†usernameä½†æ˜¯k8så¹¶ä¸ç›´æ¥ç®¡ç†ç”¨æˆ·ï¼Œä¸èƒ½åˆ›å»ºuserå¯¹è±¡ä¹Ÿä¸å­˜å‚¨usernameã€‚</p>
<p><br></p>
<p><strong>è®¤è¯æµç¨‹ï¼š</strong></p>
<ul>
<li>HTTPS è¯ä¹¦åŒå‘è®¤è¯æµç¨‹:</li>
</ul>
<figure class="image-box">
                <a rel=9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç» href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201124154008.png" target="_blank" title="WeiyiGeek.HTTPSåŒå‘è®¤è¯" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201124154008.png" alt="WeiyiGeek.HTTPSåŒå‘è®¤è¯" title="" class=""></a>
                <p>WeiyiGeek.HTTPSåŒå‘è®¤è¯</p>
            </figure>
<ul>
<li>K8S å„èŠ‚ç‚¹è®¤è¯æµç¨‹:</li>
</ul>
<figure class="image-box">
                <a rel=9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç» href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201124154117.png" target="_blank" title="WeiyiGeek.èŠ‚ç‚¹è®¤è¯" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201124154117.png" alt="WeiyiGeek.èŠ‚ç‚¹è®¤è¯" title="" class=""></a>
                <p>WeiyiGeek.èŠ‚ç‚¹è®¤è¯</p>
            </figure>
<p><br></p>
<p><em>è¯ä¹¦é¢å‘è¯´æ˜:</em></p>
<ul>
<li>1.æ‰‹åŠ¨ç­¾å‘: é€šè¿‡ k8s é›†ç¾¤çš„è·Ÿ ca è¿›è¡Œç­¾å‘HTTPS è¯ä¹¦;</li>
<li>2.è‡ªåŠ¨ç­¾å‘: kubelet é¦–æ¬¡è®¿é—® API Server æ—¶ï¼Œä½¿ç”¨ token åšè®¤è¯ï¼Œé€šè¿‡å Contrller Manager ä¼šä¸º kubelet ç”Ÿæˆä¸€ä¸ªè¯ä¹¦ï¼Œä»¥åçš„è®¿é—®éƒ½æ˜¯ç”¨è¯ä¹¦åšè®¤è¯äº†;</li>
</ul>
<p><br></p>
<p><strong>è®¿é—®ç±»å‹:</strong></p>
<ul>
<li>1.Kubenetes ç»„ä»¶ å¯¹API Server çš„è®¿é—®: <code>kubectlã€Controller Managerã€Schedulerã€kubeletã€kube-proxy</code></li>
<li>2.Kubernetes ç®¡ç†çš„Podå®¹å™¨ å¯¹API Server çš„è®¿é—®: Pod (dashborad ä¹Ÿæ˜¯ä»¥Pod å½¢å¼è¿è¡Œ)</li>
</ul>
<p><br></p>
<p><strong>å®‰å…¨æ€§è¯´æ˜:</strong></p>
<ul>
<li>1.Controller Managerã€Scheduler ä¸ API Server åœ¨åŒä¸€å°æœºå™¨ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨API Server çš„éå®‰å…¨ç«¯å£è®¿é—®ï¼Œå¯ä»¥åœ¨NodeèŠ‚ç‚¹æ—¶æ·»åŠ  <code>--insecure-bind-address=127.0.0.1</code> é˜²æ­¢ä¸å¿…è¦çš„æ€§èƒ½æ¶ˆè€—;</li>
<li>2.kubectlã€ kubeletã€ kube-proxy è®¿é—® API Server å°±éƒ½éœ€è¦è¯ä¹¦è¿›è¡Œ HTTPS åŒå‘è®¤è¯;</li>
</ul>
<p><br></p>
<h4 id="è®¤è¯æ–‡ä»¶"><a href="#è®¤è¯æ–‡ä»¶" class="headerlink" title="è®¤è¯æ–‡ä»¶"></a>è®¤è¯æ–‡ä»¶</h4><p>æè¿°: ä¸Šé¢æˆ‘ä»¬è¯´è¿‡k8sä¸¤ç§è®¿é—®æ–¹å¼ä¸€æ˜¯å¯¹API Serverçš„è®¿é—®é€šè¿‡ï¼ˆkubeconfigï¼‰ï¼ŒäºŒæ˜¯å¯¹ç®¡ç†çš„Podå¯¹å®¹å™¨çš„è®¿é—®é€šè¿‡ SAï¼ˆServiceAccountï¼‰;</p>
<h5 id="kubeconfig"><a href="#kubeconfig" class="headerlink" title="kubeconfig"></a>kubeconfig</h5><p>æè¿°: kubeconfig æ–‡ä»¶åŒ…å«é›†ç¾¤å‚æ•° (<code>CAè¯ä¹¦ã€API Serveè®¿é—®è¯ä¹¦</code>)ï¼Œå®¢æˆ·ç«¯å‚æ•°(<code>ä¸Šé¢ç”Ÿæˆçš„è¯ä¹¦å’Œç§é’¥</code>)ï¼Œé›†ç¾¤contextä¿¡æ¯(é›†ç¾¤åç§°ã€ç”¨æˆ·å);</p>
<p>Tips: Kubenetes ç»„ä»¶é€šè¿‡å¯åŠ¨æ—¶<code>æŒ‡å®šä¸åŒçš„ kubeconfig æ–‡ä»¶å¯ä»¥åˆ‡æ¢åˆ°ä¸åŒçš„é›†ç¾¤</code>;</p>
<p><br/></p>
<h5 id="ServiceAccount"><a href="#ServiceAccount" class="headerlink" title="ServiceAccount"></a>ServiceAccount</h5><p>æè¿°: Podä¸­çš„å®¹å™¨è®¿é—®API  Serverã€‚å› ä¸ºPodçš„åˆ›å»ºã€é”€æ¯æ˜¯åŠ¨æ€çš„ï¼Œæ‰€ä»¥è¦ä¸ºå®ƒæ‰‹åŠ¨ç”Ÿæˆè¯ä¹¦å°±ä¸å¯è¡Œäº†ã€‚</p>
<p>Tips: Kubenetes é€šè¿‡ä½¿ç”¨äº†Service Account è§£å†³ Pod è®¿é—®API Serverçš„è®¤è¯é—®é¢˜; (åé¢ä¼šè¯¦ç»†è®²è§£)</p>
<figure class="image-box">
                <a rel=9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç» href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201124155548.png" target="_blank" title="WeiyiGeek.K8sçš„Podä¸ç»„ä»¶è®¤è¯éªŒè¯" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201124155548.png" alt="WeiyiGeek.K8sçš„Podä¸ç»„ä»¶è®¤è¯éªŒè¯" title="" class=""></a>
                <p>WeiyiGeek.K8sçš„Podä¸ç»„ä»¶è®¤è¯éªŒè¯</p>
            </figure>
<p><br/></p>
<p><strong>Q: Secret ä¸ SA çš„å…³ç³»</strong><br>æè¿°: Kubernetes è®¾è®¡äº†ä¸€ç§K8s å¯¹è±¡å«åš Secret åˆ†ä¸ºä¸¤ç±»ï¼Œ</p>
<ul>
<li>å¦ä¸€ç§æ˜¯ç”¨äº ServiceAccount çš„ <code>service-account token</code>ï¼Œ</li>
<li>å¦ä¸€ç§æ˜¯ç”¨äºä¿å­˜ç”¨æˆ·è‡ªå®šä¹‰ä¿å¯†ä¿¡æ¯çš„ <code>Opaque, Service Account</code> ä¸­ç”¨åˆ°åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†: <code>Tokenã€ca.crtã€namespace</code><ul>
<li>token  æ˜¯ä½¿ç”¨API Server ç§é’¥ç­¾åçš„JWTæ ¼å¼, ç”¨äºè®¿é—®API Serveræ—¶Serverç«¯è®¤è¯;</li>
<li>ca.crt æ ¹è¯ä¹¦ç”¨äº Clientç«¯éªŒè¯ <code>API Server</code> å‘é€çš„è¯ä¹¦;</li>
<li>namespace æ ‡è¯†è¿™ä¸ª <code>service-account-token</code> çš„ä½œç”¨åŸŸåç©ºé—´;</li>
</ul>
</li>
</ul>
<p>PS : é»˜è®¤æƒ…å†µä¸‹<code>æ¯ä¸ª namespace éƒ½ä¼šæœ‰ä¸€ä¸ªServiceAccount</code>ï¼Œå¦‚æœ Pod åœ¨åˆ›å»ºæ—¶æ²¡æœ‰æŒ‡å®šServiceAccount, å°±ä¼šä½¿ç”¨Pod æ‰€å±çš„ namespace çš„ ServiceAccount<br>é»˜è®¤æŒ‚è½½ç›®å½•ï¼š<code>/run/secrets/kubernetes.io/serviceaccount/</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰€æœ‰å‘½åç©ºé—´çš„</span></span><br><span class="line">~$ kubectl get secret --all-namespaces</span><br><span class="line">  <span class="comment"># NAMESPACE         NAME                                             TYPE                                  DATA   AGE</span></span><br><span class="line">  <span class="comment"># default           default-token-zglkd                              kubernetes.io/service-account-token   3      18d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é»˜è®¤çš„å‘½åç©ºé—´çš„</span></span><br><span class="line">~$ kubectl describe secret default-token-zglkd --namespace=default</span><br><span class="line">  <span class="comment"># Name:         default-token-zglkd</span></span><br><span class="line">  <span class="comment"># Namespace:    default</span></span><br><span class="line">  <span class="comment"># Labels:       &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># Annotations:  kubernetes.io/service-account.name: default</span></span><br><span class="line">  <span class="comment">#               kubernetes.io/service-account.uid: 938abb62-6ccf-468d-ac60-46feb77cdbf5</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Type:  kubernetes.io/service-account-token</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data</span></span><br><span class="line">  <span class="comment"># ====</span></span><br><span class="line">  <span class="comment"># namespace:  7 bytes</span></span><br><span class="line">  <span class="comment"># token:      eyJhbGciOi.....JSUzI1Ni</span></span><br><span class="line">  <span class="comment"># ca.crt:     1066 bytes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># devops å‘½åç©ºé—´çš„</span></span><br><span class="line">~$ kubectl get secret -n devops</span><br><span class="line">  <span class="comment"># NAME                     TYPE                                  DATA   AGE</span></span><br><span class="line">  <span class="comment"># default-token-mv72l      kubernetes.io/service-account-token   3      39d</span></span><br><span class="line"></span><br><span class="line">~$ kubectl get secret -n devops -o yaml</span><br><span class="line">  <span class="comment"># apiVersion: v1</span></span><br><span class="line">  <span class="comment"># items:</span></span><br><span class="line">  <span class="comment"># - apiVersion: v1</span></span><br><span class="line">  <span class="comment">#   data:</span></span><br><span class="line">  <span class="comment">#     ca.crt: LS0tLS1...0tCg==</span></span><br><span class="line">  <span class="comment">#     namespace: ZGV2b3Bz</span></span><br><span class="line">  <span class="comment">#     token: ZXlKaGJHY...N3JR</span></span><br><span class="line">  <span class="comment">#   kind: Secret</span></span><br><span class="line">  <span class="comment">#   metadata:</span></span><br><span class="line">  <span class="comment">#     annotations:</span></span><br><span class="line">  <span class="comment">#       kubernetes.io/service-account.name: default</span></span><br><span class="line">  <span class="comment">#       kubernetes.io/service-account.uid: 6458d317-c72e-4fe9-b8fd-ed65b5b52718</span></span><br><span class="line">  <span class="comment">#     creationTimestamp: "2021-01-15T07:44:41Z"</span></span><br><span class="line">  <span class="comment">#     managedFields:</span></span><br><span class="line">  <span class="comment">#     - apiVersion: v1</span></span><br><span class="line">  <span class="comment">#       fieldsType: FieldsV1</span></span><br><span class="line">  <span class="comment">#       fieldsV1:</span></span><br><span class="line">  <span class="comment">#         f:data:</span></span><br><span class="line">  <span class="comment">#           .: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#           f:ca.crt: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#           f:namespace: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#           f:token: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#         f:metadata:</span></span><br><span class="line">  <span class="comment">#           f:annotations:</span></span><br><span class="line">  <span class="comment">#             .: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#             f:kubernetes.io/service-account.name: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#             f:kubernetes.io/service-account.uid: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#         f:type: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#       manager: kube-controller-manager</span></span><br><span class="line">  <span class="comment">#       operation: Update</span></span><br><span class="line">  <span class="comment">#       time: "2021-01-15T07:44:41Z"</span></span><br><span class="line">  <span class="comment">#     name: default-token-mv72l</span></span><br><span class="line">  <span class="comment">#     namespace: devops</span></span><br><span class="line">  <span class="comment">#     resourceVersion: "1064652"</span></span><br><span class="line">  <span class="comment">#     selfLink: /api/v1/namespaces/devops/secrets/default-token-mv72l</span></span><br><span class="line">  <span class="comment">#     uid: 9bc8a851-70b5-4814-9ce8-018250d90766</span></span><br><span class="line">  <span class="comment">#   type: kubernetes.io/service-account-token</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h3 id="2-Authorizationï¼ˆé‰´æƒï¼‰"><a href="#2-Authorizationï¼ˆé‰´æƒï¼‰" class="headerlink" title="2) Authorizationï¼ˆé‰´æƒï¼‰"></a>2) Authorizationï¼ˆé‰´æƒï¼‰</h3><p>æè¿°: ä¸Šé¢è®¤è¯è¿‡ç¨‹åªæ˜¯ç¡®è®¤é€šä¿¡çš„åŒæ–¹éƒ½ç¡®è®¤äº†å¯¹æ–¹æ˜¯å¯ä¿¡çš„å¯ä»¥ç›¸äº’é€šä¿¡ï¼Œæ­¤æ—¶è®¤è¯æˆåŠŸä¹‹åçš„åˆ°äº†æˆæƒæ¨¡å—ï¼Œä¸è®¤è¯Authç±»ä¼¼k8sä¹Ÿæ”¯æŒå¤šç§æˆæƒæœºåˆ¶ï¼Œå¹¶æ”¯æŒåŒæ—¶å¼€å¯å¤šä¸ªæˆæƒæ’ä»¶(ä¸€ä¸ªéªŒè¯æˆåŠŸå³å¯)ï¼Œå¦‚æœæˆæƒæˆåŠŸåˆ™ç”¨æˆ·çš„è¯·æ±‚ä¼šå‘é€åˆ°å‡†å…¥æ§åˆ¶æ¨¡å—åšè¿›ä¸€æ­¥çš„è¯·æ±‚éªŒè¯ï¼Œè€Œå¯¹äºæˆæƒå¤±è´¥çš„è¯·æ±‚åˆ™è¿”å›HTTP 403ï¼Œ<code>å³é‰´æƒæ˜¯ç¡®å®šè¯·æ±‚æ–¹æœ‰å“ªäº›èµ„æºçš„æƒé™</code>ã€‚</p>
<p><br/></p>
<p>API Server ç›®å‰æ”¯æŒä»¥ä¸‹å‡ ç§æˆæƒç­–ç•¥ï¼ˆ<code>å¯é€šè¿‡APIServer çš„å¯åŠ¨å‚æ•°â€œ--authorization-modeâ€è®¾ç½®</code>)</p>
<ul>
<li>1.AlwaysDeny: è¡¨ç¤ºæ‹’ç»æ‰€æœ‰çš„è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨äºæµ‹è¯•</li>
<li>2.AlwaysAllow: å…è®¸æ¥æ”¶æ‰€æœ‰è¯·æ±‚ï¼Œå¦‚æœé›†ç¾¤ä¸éœ€è¦æˆæƒæµç¨‹ï¼Œåˆ™å¯ä»¥é‡‡ç”¨è¯¥ç­–ç•¥</li>
<li>3.ABAC (Attribute-Based Access Control): åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼Œè¡¨ç¤ºä½¿ç”¨ç”¨æˆ·é…ç½®çš„æˆæƒè§„åˆ™å¯¹ç”¨æˆ·è¯·æ±‚è¿›è¡ŒåŒ¹é…å’Œæ§åˆ¶</li>
<li>4.Webbook: é€šè¿‡è°ƒç”¨å¤–éƒ¨RESTæœåŠ¡å¯¹ç”¨æˆ·è¿›è¡Œæˆæƒ</li>
<li>5.RBAC (Role-Based Access Control): åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶(é»˜è®¤è§„åˆ™) åç»­è¯¦ç»†è®²è§£</li>
</ul>
<h4 id="ä½¿ç”¨-RBAC-é‰´æƒ"><a href="#ä½¿ç”¨-RBAC-é‰´æƒ" class="headerlink" title="ä½¿ç”¨ - RBAC - é‰´æƒ"></a>ä½¿ç”¨ - RBAC - é‰´æƒ</h4><p>æè¿°: å®é™…ç”Ÿäº§ç¯å¢ƒä¸­å¾€å¾€éœ€è¦å¯¹ä¸åŒè¿ç»´äººå‘˜èµ‹é¢„ä¸åŒçš„æƒé™ï¼Œè€Œæ ¹æ®å®é™…æƒ…å†µä¹Ÿå¯èƒ½ä¼šèµ‹äºˆå¼€å‘äººå‘˜åªè¯»çš„æƒé™æ­¤æ—¶<code>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨RBACè¿›è¡Œé‰´æƒ</code>; </p>
<p>RBAC(<code>Role-Based Access Control</code>) åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶é‰´æƒæœºåˆ¶ï¼Œä½¿ç”¨ rbac.authorization.k8s.io API ç»„ æ¥é©±åŠ¨é‰´æƒå†³å®šï¼Œå…è®¸ä½ é€šè¿‡ Kubernetes API åŠ¨æ€é…ç½®ç­–ç•¥ã€‚  </p>
<p><br/></p>
<p>æ¯”è¾ƒäºå…¶å®ƒè®¿é—®æ§åˆ¶æ–¹å¼æ‹¥æœ‰ä»¥ä¸‹ä¼˜åŠ¿:</p>
<ul>
<li>1.å¯¹é›†ç¾¤ä¸­çš„èµ„æºå’Œéèµ„æºå‡æ‹¥æœ‰å®Œæ•´çš„è¦†ç›–</li>
<li>2.æ•´ä¸ªRBACå®Œå…¨ç”±å‡ ä¸ªAPIå¯¹è±¡å®Œæˆï¼ŒåŒå…¶å®ƒAPIå¯¹è±¡ä¸€æ ·ï¼Œå¯ä»¥ç”¨kubectl æˆ–APIè¿›è¡Œæ“ä½œ</li>
<li>3.å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œè°ƒæ•´ï¼Œæ— éœ€é‡å¯ API Server</li>
</ul>
<p>Tips : åœ¨Kubernetes 1.5 ä¸­å¼•å…¥<code>ç°è¡Œç‰ˆæœ¬æˆä¸ºé»˜è®¤æ ‡å‡†</code>ã€‚<br>Tips : åœ¨å¯åŠ¨ API æœåŠ¡å™¨ æ—¶å°† â€“authorization-mode å‚æ•°è®¾ç½®ä¸ºä¸€ä¸ªé€—å·åˆ†éš”çš„åˆ—è¡¨å¹¶ç¡®ä¿å…¶ä¸­åŒ…å« RBAC<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kube-apiserver --authorization-mode=Example,RBAC</span><br></pre></td></tr></table></figure><br>Tips : api-resources èµ„æºåç§°è§’è‰²ä¸ç»‘å®šä¸€è§ˆè¡¨;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl api-resources | grep <span class="string">"Role"</span></span><br><span class="line">  <span class="comment"># clusterrolebindings                            rbac.authorization.k8s.io      false        ClusterRoleBinding</span></span><br><span class="line">  <span class="comment"># clusterroles                                   rbac.authorization.k8s.io      false        ClusterRole</span></span><br><span class="line">  <span class="comment"># rolebindings                                   rbac.authorization.k8s.io      true         RoleBinding</span></span><br><span class="line">  <span class="comment"># roles                                          rbac.authorization.k8s.io      true         Role</span></span><br><span class="line">~$ kubectl api-versions | grep <span class="string">"rbac.authorization.k8s.io"</span></span><br><span class="line">  <span class="comment"># rbac.authorization.k8s.io/v1</span></span><br><span class="line">  <span class="comment"># rbac.authorization.k8s.io/v1beta1</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h5><p><strong>1.RBAC K8så¯¹è±¡è¯´æ˜</strong><br>æè¿°: RBAC API å£°æ˜äº†å››ç§  Kubernetes å¯¹è±¡ï¼š<code>Roleã€ClusterRoleã€RoleBindingã€ClusterRoleBinding</code>, 4ç§å¯¹è±¡ç±»å‹å‡å¯ä»¥é€šè¿‡ kubectl ä¸ API æ“ä½œ;</p>
<p>RBACçš„ API K8så¯¹è±¡å›¾ç¤º:<br><figure class="image-box">
                <a rel=9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç» href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201124160008.png" target="_blank" title="WeiyiGeek.RBACçš„APIK8s å¯¹è±¡" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2020/2/20201124160008.png" alt="WeiyiGeek.RBACçš„APIK8s å¯¹è±¡" title="" class=""></a>
                <p>WeiyiGeek.RBACçš„APIK8s å¯¹è±¡</p>
            </figure></p>
<p><br></p>
<p><strong>Q: å€¼å¾—æ³¨æ„çš„æ˜¯ Kubenetes å¹¶ä¸ä¼šæä¾›ç”¨æˆ·ç®¡ç†, é‚£ä¹ˆ Userã€Groupã€ServiceAccount æŒ‡å®šçš„ç”¨æˆ·åˆæ˜¯ä»å“ªé‡Œæ¥çš„å‘¢?</strong><br>æè¿°: Kubenetes ç»„ä»¶ (<code>kubectlã€kube-proxy</code>) æˆ–æ˜¯ å…¶ä»–è‡ªå®šä¹‰çš„ç”¨æˆ·åœ¨å‘CAç”³è¯·è¯ä¹¦æ—¶éœ€è¦æä¾›ä¸€ä¸ªè¯ä¹¦è¯·æ±‚æ–‡ä»¶;</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># API Server ä¼šæŠŠå®¢æˆ·ç«¯è¯ä¹¦çš„ CN å­—æ®µä½œä¸ºUserï¼ŒæŠŠ names.OU å­—æ®µä½œä¸º Group</span></span><br><span class="line"><span class="string">cat</span> <span class="string">&gt; appuser-csr.yaml &lt;&lt;'END'</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  "CN": "appuser",  # ç”¨æˆ·åç§°(User)</span></span><br><span class="line"><span class="string">  "hosts": [],</span></span><br><span class="line"><span class="string">  "key":&#123;</span></span><br><span class="line"><span class="string">    "algo": "rsa",</span></span><br><span class="line"><span class="string">    "size": 2048</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  "names":[</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">    "C": "CN",</span></span><br><span class="line"><span class="string">    "ST":"TianJin",</span></span><br><span class="line"><span class="string">    "L": "TJ",</span></span><br><span class="line"><span class="string">    "O": "kubernetes",</span></span><br><span class="line"><span class="string">    "OU": "System"  # ç”¨æˆ·ç»„(Group)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">END</span></span><br></pre></td></tr></table></figure>
<p>Tips : kubelet ä½¿ç”¨ TLS Bootstaping è®¤è¯æ—¶ API Server å¯ä»¥ä½¿ç”¨ <code>Bootstrap Tokens</code> æˆ–è€… <code>Token authenticationfile</code> éªŒè¯ tokenã€‚</p>
<p>Tips : æ— è®ºå“ªä¸€ç§ Kubenetes éƒ½ä¼šä¸ºtoken ç»‘å®šä¸€ä¸ªé»˜è®¤çš„ User å’Œ Group; Pod ä½¿ç”¨ <code>ServiceAccount</code> è®¤è¯æ—¶ <code>service-account-token</code> ä¸­çš„JWTä¼šä¿å­˜Userä¿¡æ¯, æœ‰äº†ç”¨æˆ·ä¿¡æ¯å†åˆ›å»ºä¸€å¯¹<code>è§’è‰²/é›†ç¾¤è§’è‰²(è§’è‰²ç»‘å®š/é›†ç¾¤è§’è‰²ç»‘å®š)</code>K8s å¯¹è±¡å³<code>Roleã€RoleBindingã€ClusterRoleã€ClusterRoleBinding</code>ï¼Œå°±å¯ä»¥å®Œæˆæƒé™ç»‘å®šäº†;</p>
<p><br/></p>
<h5 id="è§’è‰²-Role-and-ClusterRole"><a href="#è§’è‰²-Role-and-ClusterRole" class="headerlink" title="è§’è‰² - Role and ClusterRole"></a>è§’è‰² - Role and ClusterRole</h5><p>æè¿°: åœ¨ RBAC APIä¸­Roleè¡¨ç¤ºä¸€ç»„è§„åˆ™æƒé™<code>åªä¼šå¢åŠ (ç´¯åŠ æƒé™)</code>, ä¸å­˜åœ¨ä¸€ä¸ªèµ„æºä¸€å¼€å§‹å°±æœ‰å¾ˆå¤šæƒé™è€Œé€šè¿‡RBACå¯¹å…¶è¿›è¡Œå‡å°‘çš„æ“ä½œRoleå¯ä»¥å®šä¹‰åœ¨ä¸€ä¸ªnamespace ä¸­ï¼Œå¦‚æœæƒ³è¦è·¨namespaceåˆ™å¯ä»¥åˆ›å»ºClusterRole</p>
<p>Role èµ„æºæ¸…å•ç¤ºä¾‹:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Role</span> </span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span> </span><br><span class="line"><span class="attr">  name:</span> <span class="string">pod-reader</span> </span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">[""]</span> <span class="comment"># "" æ ‡æ˜ core API ç»„</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["pods"]</span> </span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["get",</span> <span class="string">"watch"</span><span class="string">,</span> <span class="string">"list"</span><span class="string">]</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p>æè¿°: ClusterRoleå…·æœ‰ä¸Roleç›¸åŒçš„æƒé™è§’è‰²æ§åˆ¶èƒ½åŠ›ï¼Œä¸åŒçš„æ˜¯<code>ClusterRoleæ˜¯é›†ç¾¤çº§åˆ«çš„</code>å…¶å¯ä»¥ç”¨äºä»¥ä¸‹ç¯å¢ƒä¹‹ä¸­:</p>
<ul>
<li>é›†ç¾¤èŒƒå›´èµ„æºï¼ˆæ¯”å¦‚ èŠ‚ç‚¹ï¼ˆNodeï¼‰ï¼‰</li>
<li>éèµ„æºç«¯ç‚¹ï¼ˆæ¯”å¦‚ /healthzï¼‰</li>
<li>è·¨åå­—ç©ºé—´è®¿é—®çš„åå­—ç©ºé—´ä½œç”¨åŸŸçš„èµ„æºï¼ˆå¦‚ Podsï¼‰ï¼Œæ¯”å¦‚ä½ å¯ä»¥ä½¿ç”¨ ClusterRole æ¥å…è®¸æŸç‰¹å®šç”¨æˆ·æ‰§è¡Œ<code>kubectl get pods --all-namespaces</code></li>
</ul>
<p><br/></p>
<p>ClusterRole æœ‰è‹¥å¹²ç”¨æ³•:</p>
<ul>
<li>å®šä¹‰å¯¹æŸåå­—ç©ºé—´åŸŸå¯¹è±¡çš„è®¿é—®æƒé™ï¼Œå¹¶å°†åœ¨å„ä¸ªåå­—ç©ºé—´å†…å®Œæˆæˆæƒï¼›</li>
<li>ä¸ºåå­—ç©ºé—´ä½œç”¨åŸŸçš„å¯¹è±¡è®¾ç½®è®¿é—®æƒé™ï¼Œå¹¶è·¨æ‰€æœ‰åå­—ç©ºé—´æ‰§è¡Œæˆæƒï¼›</li>
<li>ä¸ºé›†ç¾¤ä½œç”¨åŸŸçš„èµ„æºå®šä¹‰è®¿é—®æƒé™ã€‚</li>
</ul>
<p><br/></p>
<p>ClusterRole èµ„æºæ¸…å•ç¤ºä¾‹:<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span> </span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="comment"># "namespace" è¢«å¿½ç•¥ï¼Œå› ä¸º ClusterRoles ä¸å—åå­—ç©ºé—´é™åˆ¶</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">secret-reader</span> </span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">[""]</span> </span><br><span class="line">  <span class="comment">#  åœ¨ HTTP å±‚é¢ï¼Œç”¨æ¥è®¿é—® Secret å¯¹è±¡çš„èµ„æºçš„åç§°ä¸º "secrets"</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["secrets"]</span> </span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["get","watch","list"]</span></span><br></pre></td></tr></table></figure></p>
<p>Tips : RBAC çš„ Role æˆ– ClusterRole ä¸­åŒ…å«ä¸€ç»„ä»£è¡¨ç›¸å…³æƒé™çš„è§„åˆ™<code>æƒé™æ˜¯çº¯ç²¹ç´¯åŠ çš„ï¼ˆä¸å­˜åœ¨æ‹’ç»æŸæ“ä½œçš„è§„åˆ™ï¼‰</code>ã€‚</p>
<p>Tips : å¦‚æœä½ å¸Œæœ›åœ¨åå­—ç©ºé—´å†…å®šä¹‰è§’è‰²åº”è¯¥ä½¿ç”¨ Roleï¼› å¦‚æœä½ å¸Œæœ›å®šä¹‰é›†ç¾¤èŒƒå›´çš„è§’è‰²åº”è¯¥ä½¿ç”¨ ClusterRoleã€‚</p>
<p>Tips : Role æˆ– ClusterRole å¯¹è±¡çš„åç§°å¿…é¡»æ˜¯åˆæ³•çš„ è·¯å¾„åŒºæ®µåç§°ã€‚</p>
<p><br/></p>
<h5 id="è§’è‰²ç»‘å®š-RoleBinding-and-ClusterRoleBinding"><a href="#è§’è‰²ç»‘å®š-RoleBinding-and-ClusterRoleBinding" class="headerlink" title="è§’è‰²ç»‘å®š - RoleBinding and ClusterRoleBinding"></a>è§’è‰²ç»‘å®š - RoleBinding and ClusterRoleBinding</h5><p>æè¿°: è§’è‰²ç»‘å®šï¼ˆRole Bindingï¼‰æ˜¯å°†è§’è‰²ä¸­å®šä¹‰çš„æƒé™èµ‹äºˆä¸€ä¸ªæˆ–è€…ä¸€ç»„ç”¨æˆ·,  å®ƒåŒ…å«è‹¥å¹²ä¸»ä½“ç”¨æˆ·ã€ç»„æˆ–æœåŠ¡è´¦æˆ·<code>(users,groups,or service accounts)</code>çš„åˆ—è¡¨å’Œå¯¹è¿™äº›ä¸»ä½“æ‰€è·å¾—çš„è§’è‰²çš„å¼•ç”¨;</p>
<p>RoleBinding å¯ä»¥<code>å¼•ç”¨åŒä¸€çš„åå­—ç©ºé—´ä¸­</code>çš„ä»»ä½• Role, æˆ–è€…ä¸€ä¸ª RoleBinding å¯ä»¥å¼•ç”¨æŸ ClusterRole å¹¶å°†è¯¥ ClusterRole ç»‘å®šåˆ° RoleBinding æ‰€åœ¨çš„åå­—ç©ºé—´ï¼›</p>
<p>RoleBinding å¯ä»¥å°†è§’è‰²ä¸­å®šä¹‰çš„æƒé™<code>æˆäºˆç”¨æˆ·æˆ–ç”¨æˆ·ç»„</code>å…¶åŒ…å«ä¸€ç»„<code>æƒé™åˆ—è¡¨ (subjects)</code>ï¼Œæƒé™åˆ—è¡¨ä¸­åŒ…å«æœ‰ä¸åŒå½¢å¼çš„å¾…æˆäºˆæƒé™èµ„æºç±»å‹; </p>
<ul>
<li>RoleBinding åŒæ ·åŒ…å«å¯¹è¢« Bind çš„ Role å¼•ç”¨ <code>RoleBinding</code> é€‚ç”¨äºæŸä¸ªå‘½åç©ºé—´å†…æˆæƒè€Œ <code>ClusterRoleBinding é€‚ç”¨äºé›†ç¾¤èŒƒå›´å†…çš„æˆæƒ</code>;</li>
<li>RoleBinding åŒæ ·å¯ä»¥å¼•ç”¨ <code>ClusterRole</code> æ¥å¯¹<code>å½“å‰ namespace å†…ç”¨æˆ·ã€ç”¨æˆ·ç»„æˆ– ServiceAccount è¿›è¡Œæˆæƒ</code>;</li>
</ul>
<p>ä¾‹å¦‚: å°† default å‘½åç©ºé—´ä¸­çš„ <code>pod-reader Role</code> è§’è‰²æˆäºˆjaneç”¨æˆ·ï¼Œæ­¤å <code>janeç”¨æˆ·</code> åœ¨ default å‘½åç©ºé—´ä¸­å°†å…·æœ‰ pod-reader è§’è‰²çš„æƒé™;</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="comment"># æ­¤è§’è‰²ç»‘å®šå…è®¸ "jane" è¯»å– "default" åå­—ç©ºé—´ä¸­çš„ Pods</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">read-pods</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="comment"># ä½ å¯ä»¥æŒ‡å®šä¸æ­¢ä¸€ä¸ªâ€œsubjectï¼ˆä¸»ä½“ï¼‰â€</span></span><br><span class="line"><span class="attr">- kind:</span> <span class="string">User</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">jane</span> <span class="comment"># "name" æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„</span></span><br><span class="line"><span class="attr">  apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="comment"># "roleRef" æŒ‡å®šä¸æŸ Role æˆ– ClusterRole çš„ç»‘å®šå…³ç³»</span></span><br><span class="line"><span class="attr">  kind:</span> <span class="string">Role</span> <span class="comment"># æ­¤å­—æ®µå¿…é¡»æ˜¯ Role æˆ– ClusterRole</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">pod-reader</span>     <span class="comment"># æ­¤å­—æ®µå¿…é¡»ä¸ä½ è¦ç»‘å®šçš„ Role æˆ– ClusterRole çš„åç§°åŒ¹é…</span></span><br><span class="line"><span class="attr">  apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p>Tips : RoleBinding å¯ä»¥å¼•ç”¨ ClusterRole, å…¶å°†å¯¹åº” ClusterRole ä¸­å®šä¹‰çš„è®¿é—®æƒé™æˆäºˆ RoleBinding æ‰€åœ¨åå­—ç©ºé—´çš„èµ„æº; å¥½å¤„æ˜¯è¿™ç§å¼•ç”¨ä½¿å¾—ä½ å¯ä»¥<code>è·¨æ•´ä¸ªé›†ç¾¤å®šä¹‰ä¸€ç»„é€šç”¨çš„è§’è‰², ä¹‹ååœ¨å¤šä¸ªåå­—ç©ºé—´ä¸­å¤ç”¨</code>ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå°½ç®¡ä¸‹é¢çš„ RoleBinding å¼•ç”¨çš„æ˜¯ä¸€ä¸ª ClusterRoleï¼Œâ€daveâ€ï¼ˆè¿™é‡Œçš„ä¸»ä½“ï¼Œ ä¸åŒºåˆ†å¤§å°å†™ï¼‰åªèƒ½è®¿é—® â€œdevelopmentâ€ åå­—ç©ºé—´ä¸­çš„ Secrets å¯¹è±¡ï¼Œå› ä¸º RoleBinding æ‰€åœ¨çš„åå­—ç©ºé—´ï¼ˆç”±å…¶ metadata å†³å®šï¼‰æ˜¯ â€œdevelopmentâ€ã€‚<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="comment"># æ­¤è§’è‰²ç»‘å®šä½¿å¾—ç”¨æˆ· "dave" èƒ½å¤Ÿè¯»å– "default" åå­—ç©ºé—´ä¸­çš„ Secrets</span></span><br><span class="line"><span class="comment"># ä½ éœ€è¦ä¸€ä¸ªåä¸º "secret-reader" çš„ ClusterRole</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">read-secrets</span></span><br><span class="line">  <span class="comment"># RoleBinding çš„åå­—ç©ºé—´å†³å®šäº†è®¿é—®æƒé™çš„æˆäºˆèŒƒå›´ã€‚</span></span><br><span class="line">  <span class="comment"># è¿™é‡Œä»…æˆæƒåœ¨ "development" åå­—ç©ºé—´å†…çš„è®¿é—®æƒé™ã€‚</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">development</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="attr">- kind:</span> <span class="string">User</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">dave</span> <span class="comment"># 'name' æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„</span></span><br><span class="line"><span class="attr">  apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line"><span class="attr">  kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">secret-reader</span></span><br><span class="line"><span class="attr">  apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>æè¿°: ä½¿ç”¨ClusterRoleBindingå¯ä»¥å¯¹æ•´ä¸ªé›†ç¾¤ä¸­çš„æ‰€æœ‰å‘½åç©ºé—´èµ„æºæƒé™è¿›è¡Œè®¿é—®æƒé™çš„æˆäºˆã€‚</p>
<p>ä¾‹å¦‚ï¼ŒClusterRoleBinding æ ·ä¾‹å±•ç¤ºäº†æˆæƒ <code>manager</code> ç»„å†…æ‰€æœ‰ç”¨æˆ·åœ¨å…¨éƒ¨å‘½åç©ºé—´ä¸­å¯¹ secrets è¿›è¡Œè®¿é—®;<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="comment"># æ­¤é›†ç¾¤è§’è‰²ç»‘å®šå…è®¸ â€œmanagerâ€ ç»„ä¸­çš„ä»»ä½•äººè®¿é—®ä»»ä½•åå­—ç©ºé—´ä¸­çš„ secrets</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">read-secrets-global</span></span><br><span class="line"><span class="comment"># RoleBinding å’Œ ClusterRoleBinding å¯ä»¥å°† Role ç»‘å®šåˆ° Subjects</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="comment"># Subjects ä¸­kindå­—æ®µå¯ä»¥æ˜¯ `groupsã€users æˆ–è€…service accounts`</span></span><br><span class="line"><span class="comment"># users: "alice" "wangyanglinux@163.com" ç”šè‡³æ˜¯ä¸€ç»„å­—ç¬¦ä¸²å½¢å¼çš„æ•°å­—ID, è€Œç®¡ç†å‘˜ç¼ºçœçš„æ˜¯system:xxx, é›†ç¾¤ç®¡ç†å‘˜åº”è¯¥ç¡®ä¿æ™®é€šç”¨æˆ·ä¸ä¼šä½¿ç”¨è¿™ä¸ªå‰ç¼€æ ¼å¼;</span></span><br><span class="line"><span class="comment"># Groups ä¹¦å†™æ ¼å¼ä¸ Usersç›¸åŒï¼Œéƒ½ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æ²¡æœ‰ç‰¹å®šçš„æ ¼å¼è¦æ±‚ï¼›åŒæ ·system:å‰ç¼€ä¸ºç³»ç»Ÿä¿ç•™;</span></span><br><span class="line"><span class="comment"># ServiceAccount : SA è´¦æˆ·</span></span><br><span class="line"><span class="attr">- kind:</span> <span class="string">Group</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">manager</span> <span class="comment"># 'name' æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„</span></span><br><span class="line"><span class="attr">  apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line"><span class="attr">  kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">secret-reader</span></span><br><span class="line"><span class="attr">  apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure></p>
<p>æ‰©å……: åˆ›å»ºäº†ç»‘å®šä¹‹åä½ ä¸èƒ½å†ä¿®æ”¹ç»‘å®šå¯¹è±¡æ‰€å¼•ç”¨çš„ Role æˆ– ClusterRoleã€‚ </p>
<ul>
<li>å¦‚æœè¯•å›¾æ”¹å˜ç»‘å®šå¯¹è±¡çš„ roleRef å°†å¯¼è‡´åˆæ³•æ€§æ£€æŸ¥é”™è¯¯ã€‚</li>
<li>å¦‚æœä½ æƒ³è¦æ”¹å˜ç°æœ‰ç»‘å®šå¯¹è±¡ä¸­ roleRef å­—æ®µçš„å†…å®¹ï¼Œå¿…é¡»åˆ é™¤é‡æ–°åˆ›å»ºç»‘å®šå¯¹è±¡ã€‚</li>
</ul>
<p>Tips : RoleBinding åœ¨æŒ‡å®šçš„åå­—ç©ºé—´ä¸­æ‰§è¡Œæˆæƒï¼Œè€Œ ClusterRoleBinding åœ¨é›†ç¾¤èŒƒå›´æ‰§è¡Œæˆæƒã€‚</p>
<p>Tips : RoleBinding æˆ– ClusterRoleBinding å¯¹è±¡çš„åç§°å¿…é¡»æ˜¯åˆæ³•çš„ è·¯å¾„åŒºæ®µåç§°ã€‚</p>
<p>Tips : å¦‚æœä½ å¸Œæœ›å°†æŸ ClusterRole ç»‘å®šåˆ°é›†ç¾¤ä¸­æ‰€æœ‰åå­—ç©ºé—´ï¼Œä½ è¦ä½¿ç”¨ ClusterRoleBindingã€‚</p>
<p><br/></p>
<h5 id="èšåˆ-ClusterRole-Aggregate"><a href="#èšåˆ-ClusterRole-Aggregate" class="headerlink" title="èšåˆ - ClusterRole Aggregate"></a>èšåˆ - ClusterRole Aggregate</h5><p>æè¿°: å°†è‹¥å¹² ClusterRole èšåˆï¼ˆAggregateï¼‰ èµ·æ¥å½¢æˆä¸€ä¸ªå¤åˆçš„ <code>ClusterRole</code>ã€‚æŸä¸ªæ§åˆ¶å™¨ä½œä¸ºé›†ç¾¤æ§åˆ¶é¢çš„ä¸€éƒ¨åˆ†ä¼šç›‘è§†å¸¦æœ‰ aggregationRule çš„ ClusterRole å¯¹è±¡é›†åˆã€‚</p>
<p>Tips : aggregationRule ä¸ºæ§åˆ¶å™¨å®šä¹‰ä¸€ä¸ªæ ‡ç­¾ <code>é€‰æ‹©ç®—ç¬¦ä¾›åè€…åŒ¹é…</code> åº”è¯¥ç»„åˆåˆ°å½“å‰ ClusterRole çš„ roles å­—æ®µä¸­çš„ ClusterRole å¯¹è±¡ã€‚</p>
<p><strong>èšåˆ ClusterRole çš„ç¤ºä¾‹1ï¼š</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRole</span><br><span class="line">metadata:</span><br><span class="line">  name: monitoring</span><br><span class="line">aggregationRule:</span><br><span class="line">  clusterRoleSelectors:</span><br><span class="line">  - matchLabels:</span><br><span class="line">      rbac.example.com/aggregate-to-monitoring: <span class="string">"true"</span></span><br><span class="line">rules: [] <span class="comment"># æ§åˆ¶é¢è‡ªåŠ¨å¡«å……è¿™é‡Œçš„è§„åˆ™</span></span><br></pre></td></tr></table></figure></p>
<p>Tips : å¦‚æœä½ åˆ›å»ºä¸€ä¸ªä¸æŸç°æœ‰èšåˆ ClusterRole çš„æ ‡ç­¾é€‰æ‹©ç®—ç¬¦åŒ¹é…çš„ ClusterRoleï¼Œ è¿™ä¸€å˜åŒ–ä¼šè§¦å‘æ–°çš„è§„åˆ™è¢«æ·»åŠ åˆ°èšåˆ ClusterRole çš„æ“ä½œã€‚ </p>
<p><strong>èšåˆ ClusterRole çš„ç¤ºä¾‹2</strong>ï¼šé€šè¿‡åˆ›å»ºä¸€ä¸ªæ ‡ç­¾åŒæ ·ä¸º <code>rbac.example.com/aggregate-to-monitoring: true</code> çš„ ClusterRoleæ–°çš„è§„åˆ™å¯è¢«æ·»åŠ åˆ° â€œmonitoringâ€ ClusterRole ä¸­ã€‚<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">monitoring-endpoints</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line">    <span class="string">rbac.example.com/aggregate-to-monitoring:</span> <span class="string">"true"</span></span><br><span class="line"><span class="comment"># å½“ä½ åˆ›å»º "monitoring-endpoints" ClusterRole æ—¶ï¼Œ</span></span><br><span class="line"><span class="comment"># ä¸‹é¢çš„è§„åˆ™ä¹Ÿä¼šè¢«æ·»åŠ åˆ° "monitoring" ClusterRole ä¸­</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">[""]</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["services",</span> <span class="string">"endpoints"</span><span class="string">,</span> <span class="string">"pods"</span><span class="string">]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["get",</span> <span class="string">"list"</span><span class="string">,</span> <span class="string">"watch"</span><span class="string">]</span></span><br></pre></td></tr></table></figure></p>
<p>é»˜è®¤çš„<code>é¢å‘ç”¨æˆ·çš„è§’è‰²ä½¿ç”¨ ClusterRole èšåˆ</code>, è¿™ä½¿å¾—ä½œä¸ºé›†ç¾¤ç®¡ç†å‘˜çš„ä½ å¯ä»¥ä¸ºæ‰©å±•é»˜è®¤è§„åˆ™ï¼ŒåŒ…æ‹¬ä¸ºå®šåˆ¶èµ„æºè®¾ç½®è§„åˆ™;</p>
<p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„ ClusterRoles è®©é»˜è®¤è§’è‰² â€œadminâ€ å’Œ â€œeditâ€ æ‹¥æœ‰ç®¡ç†è‡ªå®šä¹‰èµ„æº â€œCronTabsâ€ çš„æƒé™ï¼Œ â€œviewâ€ è§’è‰²å¯¹ CronTab èµ„æºæ‹¥æœ‰è¯»æ“ä½œæƒé™ã€‚ </p>
<p>ä½ å¯ä»¥å‡å®š CronTab å¯¹è±¡åœ¨ API æœåŠ¡å™¨æ‰€çœ‹åˆ°çš„ URL ä¸­è¢«å‘½åä¸º â€œcrontabsâ€ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRole</span><br><span class="line">metadata:</span><br><span class="line">  name: aggregate-cron-tabs-edit</span><br><span class="line">  labels:</span><br><span class="line">    <span class="comment"># æ·»åŠ ä»¥ä¸‹æƒé™åˆ°é»˜è®¤è§’è‰² "admin" å’Œ "edit" ä¸­</span></span><br><span class="line">    rbac.authorization.k8s.io/aggregate-to-admin: <span class="string">"true"</span></span><br><span class="line">    rbac.authorization.k8s.io/aggregate-to-edit: <span class="string">"true"</span></span><br><span class="line">rules:</span><br><span class="line">- apiGroups: [<span class="string">"stable.example.com"</span>]</span><br><span class="line">  resources: [<span class="string">"crontabs"</span>]</span><br><span class="line">  verbs: [<span class="string">"get"</span>, <span class="string">"list"</span>, <span class="string">"watch"</span>, <span class="string">"create"</span>, <span class="string">"update"</span>, <span class="string">"patch"</span>, <span class="string">"delete"</span>]</span><br><span class="line">---</span><br><span class="line">kind: ClusterRole</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: aggregate-cron-tabs-view</span><br><span class="line">  labels:</span><br><span class="line">    <span class="comment"># æ·»åŠ ä»¥ä¸‹æƒé™åˆ° "view" é»˜è®¤è§’è‰²ä¸­</span></span><br><span class="line">    rbac.authorization.k8s.io/aggregate-to-view: <span class="string">"true"</span></span><br><span class="line">rules:</span><br><span class="line">- apiGroups: [<span class="string">"stable.example.com"</span>]</span><br><span class="line">  resources: [<span class="string">"crontabs"</span>]</span><br><span class="line">  verbs: [<span class="string">"get"</span>, <span class="string">"list"</span>, <span class="string">"watch"</span>]</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h5 id="èµ„æºå¼•ç”¨"><a href="#èµ„æºå¼•ç”¨" class="headerlink" title="èµ„æºå¼•ç”¨"></a>èµ„æºå¼•ç”¨</h5><p>æè¿°: åœ¨ Kubernetes API ä¸­ï¼Œå¤§å¤šæ•°èµ„æºéƒ½æ˜¯ä½¿ç”¨å¯¹è±¡åç§°çš„å­—ç¬¦ä¸²è¡¨ç¤ºæ¥å‘ˆç°ä¸è®¿é—®çš„ã€‚ ä¾‹å¦‚ï¼Œå¯¹äº Pod åº”ä½¿ç”¨ â€œpodsâ€ã€‚ RBAC ä½¿ç”¨å¯¹åº” API ç«¯ç‚¹çš„ URL ä¸­å‘ˆç°çš„åå­—æ¥å¼•ç”¨èµ„æºã€‚</p>
<p>ä¾‹å¦‚ï¼šæœ‰ä¸€äº› Kubernetes API æ¶‰åŠ å­èµ„æºï¼ˆsubresourceï¼‰,logs èµ„æºå°±å±äº pods çš„å­èµ„æºï¼ŒAPI ä¸­ URL æ ·ä¾‹å¦‚ä¸‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/namespaces/&#123;namespace&#125;/pods/&#123;name&#125;/<span class="built_in">log</span></span><br></pre></td></tr></table></figure></p>
<p>Tips : åœ¨è¿™é‡Œï¼Œpods å¯¹åº”åå­—ç©ºé—´ä½œç”¨åŸŸçš„ Pod èµ„æºï¼Œè€Œ log æ˜¯ pods çš„å­èµ„æºã€‚ </p>
<p>ä¾‹å¦‚: åœ¨ RBAC è§’è‰²è¡¨è¾¾å­èµ„æºæ—¶ï¼Œä½¿ç”¨æ–œçº¿ï¼ˆ/ï¼‰æ¥åˆ†éš”èµ„æºå’Œå­èµ„æºã€‚ è¦å…è®¸æŸä¸»ä½“è¯»å– pods åŒæ—¶è®¿é—®è¿™äº› Pod çš„ log å­èµ„æºï¼Œä½ å¯ä»¥è¿™ä¹ˆå†™ï¼š<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Role</span> </span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span> </span><br><span class="line"><span class="attr">  name:</span> <span class="string">pod-and-pod-logs-reader</span> </span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="attr">  - apiGroups:</span> <span class="string">[""]</span> </span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["pods/log"]</span> </span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["get",</span> <span class="string">"list"</span><span class="string">]</span></span><br></pre></td></tr></table></figure></p>
<p>Tips : å¯¹äºæŸäº›è¯·æ±‚ä¹Ÿå¯ä»¥é€šè¿‡ resourceNames åˆ—è¡¨æŒ‰åç§°å¼•ç”¨èµ„æºã€‚ åœ¨æŒ‡å®šæ—¶å¯ä»¥å°†è¯·æ±‚é™å®šä¸ºèµ„æºçš„å•ä¸ªå®ä¾‹ã€‚</p>
<p>ä¾‹å­ä¸­é™åˆ¶å¯ä»¥ â€œgetâ€ å’Œ â€œupdateâ€ ä¸€ä¸ªåä¸º my-configmap çš„ ConfigMapï¼š<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">configmap-updater</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">[""]</span></span><br><span class="line">  <span class="comment"># åœ¨ HTTP å±‚é¢ï¼Œç”¨æ¥è®¿é—® ConfigMap çš„èµ„æºçš„åç§°ä¸º "configmaps"</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["configmaps"]</span></span><br><span class="line"><span class="attr">  resourceNames:</span> <span class="string">["my-configmap"]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["update",</span> <span class="string">"get"</span><span class="string">]</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h5 id="ä¸»ä½“å¼•ç”¨"><a href="#ä¸»ä½“å¼•ç”¨" class="headerlink" title="ä¸»ä½“å¼•ç”¨"></a>ä¸»ä½“å¼•ç”¨</h5><p>æè¿°: RoleBinding æˆ–è€… ClusterRoleBinding å¯ç»‘å®šè§’è‰²åˆ°æŸ <code>*ä¸»ä½“ï¼ˆSubjectï¼‰*</code>ä¸Šã€‚ </p>
<p>Tips : ä¸»ä½“å¯ä»¥æ˜¯ç»„Groupï¼Œç”¨æˆ·User æˆ–è€… æœåŠ¡è´¦æˆ·ServiceAccountã€‚</p>
<p>åœ¨ Kubernetes ä¸­é‰´æƒæ¨¡å—æä¾›ç”¨æˆ·ç»„ä¿¡æ¯ä¸ç”¨æˆ·åä¸€æ ·ï¼Œç”¨æˆ·ç»„åä¹Ÿç”¨å­—ç¬¦ä¸²æ¥è¡¨ç¤ºï¼Œè€Œä¸”å¯¹è¯¥å­—ç¬¦ä¸²æ²¡æœ‰æ ¼å¼è¦æ±‚ï¼Œ åªæ˜¯ä¸èƒ½ä½¿ç”¨ä¿ç•™çš„å‰ç¼€ system:ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- kind: User</span><br><span class="line">name: <span class="string">"weiyigeek"</span></span><br><span class="line">name: <span class="string">"weiyigeek@weiyigeek.top"</span></span><br></pre></td></tr></table></figure></p>
<p>Tips : å‰ç¼€ system: æ˜¯ Kubernetes ç³»ç»Ÿä¿ç•™çš„ï¼Œæ‰€ä»¥ä½ è¦ç¡®ä¿ æ‰€é…ç½®çš„ç”¨æˆ·åæˆ–è€…ç»„åä¸èƒ½å‡ºç°ä¸Šè¿° system: å‰ç¼€, é™¤äº†å¯¹å‰ç¼€çš„é™åˆ¶ä¹‹å¤–RBAC é‰´æƒç³»ç»Ÿä¸å¯¹ç”¨æˆ·åæ ¼å¼ä½œä»»ä½•è¦æ±‚ã€‚</p>
<p>Tips : æœåŠ¡è´¦æˆ·çš„ç”¨æˆ·åå‰ç¼€ä¸º system:serviceaccount , å±äºå‰ç¼€ä¸º system:serviceaccounts çš„ç”¨æˆ·ç»„ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">system:serviceaccount: ï¼ˆå•æ•°ï¼‰æ˜¯ç”¨äº æœåŠ¡è´¦æˆ·ç”¨æˆ·å çš„å‰ç¼€ï¼›</span><br><span class="line">system:serviceaccounts: ï¼ˆå¤æ•°ï¼‰æ˜¯ç”¨äº æœåŠ¡è´¦æˆ·ç»„å çš„å‰ç¼€ã€‚</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<h5 id="è§’è‰²åˆ†ç±»"><a href="#è§’è‰²åˆ†ç±»" class="headerlink" title="è§’è‰²åˆ†ç±»"></a>è§’è‰²åˆ†ç±»</h5><p>æè¿°: æˆ‘ä»¬å¯ä»¥é€šè¿‡ API å‘ç°è§’è‰², æ— è®ºæ˜¯ç»è¿‡èº«ä»½éªŒè¯çš„è¿˜æ˜¯æœªç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼Œé»˜è®¤çš„è§’è‰²ç»‘å®šéƒ½æˆæƒä»–ä»¬è¯»å–è¢«è®¤ä¸º æ˜¯å¯å®‰å…¨åœ°å…¬å¼€è®¿é—®çš„ APIï¼ˆ åŒ…æ‹¬ CustomResourceDefinitionsï¼‰</p>
<p>Tips : å¦‚æœè¦ç¦ç”¨åŒ¿åçš„æœªç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·è®¿é—®ï¼Œè¯·åœ¨ API æœåŠ¡å™¨é…ç½®ä¸­ä¸­æ·»åŠ  <code>--anonymous-auth=false</code>çš„é…ç½®é€‰é¡¹ã€‚</p>
<p>é€šè¿‡è¿è¡Œå‘½ä»¤ kubectl å¯ä»¥æŸ¥çœ‹è¿™äº›è§’è‰²çš„é…ç½®ä¿¡æ¯:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) é›†ç¾¤è§’è‰²</span></span><br><span class="line">~$ kubectl get clusterroles.rbac.authorization.k8s.io</span><br><span class="line">  <span class="comment"># NAME                                                                   CREATED AT</span></span><br><span class="line">  <span class="comment"># admin                                                                  2021-01-11T04:55:10Z</span></span><br><span class="line">  <span class="comment"># calico-kube-controllers                                                2021-01-12T13:13:26Z</span></span><br><span class="line">  <span class="comment"># calico-node                                                            2021-01-12T13:13:26Z</span></span><br><span class="line">  <span class="comment"># cluster-admin                                                          2021-01-11T04:55:10Z</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (2) é›†ç¾¤è§’è‰²ç»‘å®š</span></span><br><span class="line">~$ kubectl get clusterrolebindings.rbac.authorization.k8s.io</span><br><span class="line">  <span class="comment"># NAME                                                   ROLE                                                                               AGE</span></span><br><span class="line">  <span class="comment"># calico-kube-controllers                                ClusterRole/calico-kube-controllers                                                43d</span></span><br><span class="line">  <span class="comment"># calico-node                                            ClusterRole/calico-node                                                            43d</span></span><br><span class="line">  <span class="comment"># cluster-admin                                          ClusterRole/cluster-admin                                                          45d</span></span><br><span class="line">  <span class="comment"># jenkins-crd                                            ClusterRole/jenkins-cr                                                             40d</span></span><br><span class="line">  <span class="comment"># kubeadm:get-nodes                                      ClusterRole/kubeadm:get-nodes                                                      45d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (3) æŸ¥çœ‹æŒ‡å®šè§’è‰²çš„é…ç½®ä¿¡æ¯</span></span><br><span class="line">~$ kubectl get clusterroles system:discovery -o yaml</span><br><span class="line">  <span class="comment"># apiVersion: rbac.authorization.k8s.io/v1</span></span><br><span class="line">  <span class="comment"># kind: ClusterRole</span></span><br><span class="line">  <span class="comment"># metadata:</span></span><br><span class="line">  <span class="comment">#   annotations:</span></span><br><span class="line">  <span class="comment">#     rbac.authorization.kubernetes.io/autoupdate: "true"</span></span><br><span class="line">  <span class="comment">#   creationTimestamp: "2021-01-11T04:55:10Z"</span></span><br><span class="line">  <span class="comment">#   labels:</span></span><br><span class="line">  <span class="comment">#     kubernetes.io/bootstrapping: rbac-defaults</span></span><br><span class="line">  <span class="comment">#   managedFields:</span></span><br><span class="line">  <span class="comment">#   - apiVersion: rbac.authorization.k8s.io/v1</span></span><br><span class="line">  <span class="comment">#     fieldsType: FieldsV1</span></span><br><span class="line">  <span class="comment">#     fieldsV1:</span></span><br><span class="line">  <span class="comment">#       f:metadata:</span></span><br><span class="line">  <span class="comment">#         f:annotations:</span></span><br><span class="line">  <span class="comment">#           .: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#           f:rbac.authorization.kubernetes.io/autoupdate: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#         f:labels:</span></span><br><span class="line">  <span class="comment">#           .: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#           f:kubernetes.io/bootstrapping: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#       f:rules: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#     manager: kube-apiserver</span></span><br><span class="line">  <span class="comment">#     operation: Update</span></span><br><span class="line">  <span class="comment">#     time: "2021-01-11T04:55:10Z"</span></span><br><span class="line">  <span class="comment">#   name: system:discovery</span></span><br><span class="line">  <span class="comment">#   resourceVersion: "44"</span></span><br><span class="line">  <span class="comment">#   selfLink: /apis/rbac.authorization.k8s.io/v1/clusterroles/system%3Adiscovery</span></span><br><span class="line">  <span class="comment">#   uid: 9a8328ee-a5c1-481a-9ac9-d6919ef7aef1</span></span><br><span class="line">  <span class="comment"># rules:</span></span><br><span class="line">  <span class="comment"># - nonResourceURLs:</span></span><br><span class="line">  <span class="comment">#   - /api</span></span><br><span class="line">  <span class="comment">#   - /api/*</span></span><br><span class="line">  <span class="comment">#   - /apis</span></span><br><span class="line">  <span class="comment">#   - /apis/*</span></span><br><span class="line">  <span class="comment">#   - /healthz</span></span><br><span class="line">  <span class="comment">#   - /livez</span></span><br><span class="line">  <span class="comment">#   - /openapi</span></span><br><span class="line">  <span class="comment">#   - /openapi/*</span></span><br><span class="line">  <span class="comment">#   - /readyz</span></span><br><span class="line">  <span class="comment">#   - /version</span></span><br><span class="line">  <span class="comment">#   - /version/</span></span><br><span class="line">  <span class="comment">#   verbs:</span></span><br><span class="line">  <span class="comment">#   - get</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>Kubernetes RBAC API å‘ç°è§’è‰²</strong><br>æè¿°: å¦‚æœä½ ç¼–è¾‘è¯¥ ClusterRole ä½ æ‰€ä½œçš„å˜æ›´ä¼šè¢« API æœåŠ¡å™¨åœ¨é‡å¯æ—¶è‡ªåŠ¨è¦†ç›–ï¼Œè¿™æ˜¯é€šè¿‡<code>è‡ªåŠ¨åå•†æœºåˆ¶å®Œæˆçš„</code>ã€‚è¦é¿å…è¿™ç±»è¦†ç›–æ“ä½œè¦ä¹ˆä¸è¦æ‰‹åŠ¨ç¼–è¾‘è¿™äº›è§’è‰²ï¼Œè¦ä¹ˆç¦æ­¢è‡ªåŠ¨åå•†æœºåˆ¶ã€‚</p>
<p><em>é»˜è®¤ ClusterRole     | é»˜è®¤ ClusterRoleBinding    | æè¿°</em></p>
<blockquote>
<p>system:basic-user    system:authenticated ç»„    ## å…è®¸ç”¨æˆ·ä»¥åªè¯»çš„æ–¹å¼å»è®¿é—®ä»–ä»¬è‡ªå·±çš„åŸºæœ¬ä¿¡æ¯ã€‚åœ¨ 1.14 ç‰ˆæœ¬ä¹‹å‰ï¼Œè¿™ä¸ªè§’è‰²åœ¨é»˜è®¤æƒ…å†µä¸‹ä¹Ÿç»‘å®šåœ¨ system:unauthenticated ä¸Šã€‚</p>
</blockquote>
<blockquote>
<p>system:discovery    system:authenticated ç»„    ## å…è®¸ä»¥åªè¯»æ–¹å¼è®¿é—® API å‘ç°ç«¯ç‚¹ï¼Œè¿™äº›ç«¯ç‚¹ç”¨æ¥å‘ç°å’Œåå•† API çº§åˆ«ã€‚ åœ¨ 1.14 ç‰ˆæœ¬ä¹‹å‰ï¼Œè¿™ä¸ªè§’è‰²åœ¨é»˜è®¤æƒ…å†µä¸‹ç»‘å®šåœ¨ system:unauthenticated ä¸Šã€‚</p>
</blockquote>
<blockquote>
<p>system:public-info-viewer    system:authenticated å’Œ system:unauthenticated ç»„    ## å…è®¸å¯¹é›†ç¾¤çš„éæ•æ„Ÿä¿¡æ¯è¿›è¡Œåªè¯»è®¿é—®ï¼Œå®ƒæ˜¯åœ¨ 1.14 ç‰ˆæœ¬ä¸­å¼•å…¥çš„ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚:è·å– system:basic-user    è§’è‰²ä¿¡æ¯:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get clusterroles system:authenticated -o yaml</span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>é¢å‘ç”¨æˆ·çš„è§’è‰²</strong><br>æè¿°: æŸäº›é»˜è®¤çš„ ClusterRole ä¸æ˜¯ä»¥å‰ç¼€ system: å¼€å¤´çš„ä»–ä»¬æ˜¯é¢å‘ç”¨æˆ·çš„è§’è‰²ã€‚åŒ…æ‹¬è¶…çº§ç”¨æˆ·ï¼ˆSuper-Userï¼‰è§’è‰²ï¼ˆcluster-adminï¼‰ã€ ä½¿ç”¨ ClusterRoleBinding åœ¨é›†ç¾¤èŒƒå›´å†…å®Œæˆæˆæƒçš„è§’è‰²ï¼ˆcluster-statusï¼‰ã€ ä»¥åŠä½¿ç”¨ RoleBinding åœ¨ç‰¹å®šåå­—ç©ºé—´ä¸­æˆäºˆçš„è§’è‰²ï¼ˆadminã€editã€viewï¼‰;</p>
<blockquote>
<p>cluster-admin    | system:masters ç»„     | å…è®¸è¶…çº§ç”¨æˆ·åœ¨å¹³å°ä¸Šçš„ä»»ä½•èµ„æºä¸Šæ‰§è¡Œæ‰€æœ‰æ“ä½œã€‚</p>
</blockquote>
<blockquote>
<p>admin    | æ—  | å…è®¸ç®¡ç†å‘˜è®¿é—®æƒé™ï¼Œæ—¨åœ¨ä½¿ç”¨ RoleBinding åœ¨åå­—ç©ºé—´å†…æ‰§è¡Œæˆæƒã€‚</p>
</blockquote>
<blockquote>
<p>edit | æ—  | å…è®¸å¯¹åå­—ç©ºé—´çš„å¤§å¤šæ•°å¯¹è±¡è¿›è¡Œè¯»/å†™æ“ä½œã€‚</p>
</blockquote>
<blockquote>
<p>view | æ—  | å…è®¸å¯¹åå­—ç©ºé—´çš„å¤§å¤šæ•°å¯¹è±¡æœ‰åªè¯»æƒé™ã€‚</p>
</blockquote>
<p>Tips : é¢å‘ç”¨æˆ·çš„ ClusterRole ä½¿ç”¨ ClusterRole èšåˆä»¥å…è®¸ç®¡ç†å‘˜åœ¨è¿™äº› ClusterRole ä¸Šæ·»åŠ ç”¨äºå®šåˆ¶èµ„æºçš„è§„åˆ™<br>ã€‚<br>å¦‚æœæƒ³è¦æ·»åŠ è§„åˆ™åˆ° adminã€edit æˆ–è€… viewï¼Œ å¯ä»¥åˆ›å»ºå¸¦æœ‰ä»¥ä¸‹ä¸€ä¸ªæˆ–å¤šä¸ªæ ‡ç­¾çš„ ClusterRoleï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    rbac.authorization.k8s.io/aggregate-to-admin: <span class="string">"true"</span></span><br><span class="line">    rbac.authorization.k8s.io/aggregate-to-edit: <span class="string">"true"</span></span><br><span class="line">    rbac.authorization.k8s.io/aggregate-to-view: <span class="string">"true"</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>æ ¸å¿ƒç»„ä»¶è§’è‰²</strong></p>
<blockquote>
<p>system:kube-scheduler    | system:kube-scheduler ç”¨æˆ·    | å…è®¸è®¿é—® scheduler ç»„ä»¶æ‰€éœ€è¦çš„èµ„æºã€‚</p>
</blockquote>
<blockquote>
<p>system:volume-scheduler    | system:kube-scheduler ç”¨æˆ· | å…è®¸è®¿é—® kube-scheduler ç»„ä»¶æ‰€éœ€è¦çš„å·èµ„æºã€‚</p>
</blockquote>
<blockquote>
<p>system:kube-controller-manager    | system:kube-controller-manager ç”¨æˆ·     | å…è®¸è®¿é—®æ§åˆ¶å™¨ç®¡ç†å™¨ ç»„ä»¶æ‰€éœ€è¦çš„èµ„æºã€‚ å„ä¸ªæ§åˆ¶å›è·¯æ‰€éœ€è¦çš„æƒé™åœ¨æ§åˆ¶å™¨è§’è‰² è¯¦è¿°ã€‚</p>
</blockquote>
<blockquote>
<p>system:node    æ—     | å…è®¸è®¿é—® kubelet æ‰€éœ€è¦çš„èµ„æºï¼ŒåŒ…æ‹¬å¯¹æ‰€æœ‰ Secret çš„è¯»æ“ä½œå’Œå¯¹æ‰€æœ‰ Pod çŠ¶æ€å¯¹è±¡çš„å†™æ“ä½œã€‚ä½ åº”è¯¥ä½¿ç”¨ Node é‰´æƒç»„ä»¶ å’Œ NodeRestriction å‡†å…¥æ’ä»¶ è€Œä¸æ˜¯ system:node è§’è‰²ã€‚åŒæ—¶åŸºäº kubelet ä¸Šè°ƒåº¦æ‰§è¡Œçš„ Pod æ¥æˆæƒ kubelet å¯¹ API çš„è®¿é—®ã€‚</p>
</blockquote>
<blockquote>
<p>system:node è§’è‰²çš„æ„ä¹‰ä»…æ˜¯ä¸ºäº†ä¸ä» v1.8 ä¹‹å‰ç‰ˆæœ¬å‡çº§è€Œæ¥çš„é›†ç¾¤å…¼å®¹ã€‚</p>
</blockquote>
<blockquote>
<p>system:node-proxier    | system:kube-proxy ç”¨æˆ· |    å…è®¸è®¿é—® kube-proxy ç»„ä»¶æ‰€éœ€è¦çš„èµ„æºã€‚</p>
</blockquote>
<p><br/></p>
<p><strong>å…¶ä»–ç»„ä»¶è§’è‰²</strong></p>
<table>
<thead>
<tr>
<th>é»˜è®¤ ClusterRole</th>
<th>é»˜è®¤ ClusterRoleBinding</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>system:auth-delegator</strong></td>
<td>æ— </td>
<td>å…è®¸å°†èº«ä»½è®¤è¯å’Œé‰´æƒæ£€æŸ¥æ“ä½œå¤–åŒ…å‡ºå»ã€‚ è¿™ç§è§’è‰²é€šå¸¸ç”¨åœ¨æ’ä»¶å¼ API æœåŠ¡å™¨ä¸Šï¼Œä»¥å®ç°ç»Ÿä¸€çš„èº«ä»½è®¤è¯å’Œé‰´æƒã€‚</td>
</tr>
<tr>
<td><strong>system:heapster</strong></td>
<td>æ— </td>
<td>ä¸º <a href="https://github.com/kubernetes/heapster" target="_blank" rel="noopener">Heapster</a> ç»„ä»¶ï¼ˆå·²å¼ƒç”¨ï¼‰å®šä¹‰çš„è§’è‰²ã€‚</td>
</tr>
<tr>
<td><strong>system:kube-aggregator</strong></td>
<td>æ— </td>
<td>ä¸º <a href="https://github.com/kubernetes/kube-aggregator" target="_blank" rel="noopener">kube-aggregator</a> ç»„ä»¶å®šä¹‰çš„è§’è‰²ã€‚</td>
</tr>
<tr>
<td><strong>system:kube-dns</strong></td>
<td>åœ¨ <strong>kube-system</strong> åå­—ç©ºé—´ä¸­çš„ <strong>kube-dns</strong> æœåŠ¡è´¦æˆ·</td>
<td>ä¸º <a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/" target="_blank" rel="noopener">kube-dns</a> ç»„ä»¶å®šä¹‰çš„è§’è‰²ã€‚</td>
</tr>
<tr>
<td><strong>system:kubelet-api-admin</strong></td>
<td>æ— </td>
<td>å…è®¸ kubelet API çš„å®Œå…¨è®¿é—®æƒé™ã€‚</td>
</tr>
<tr>
<td><strong>system:node-bootstrapper</strong></td>
<td>æ— </td>
<td>å…è®¸è®¿é—®æ‰§è¡Œ <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping/" target="_blank" rel="noopener">kubelet TLS å¯åŠ¨å¼•å¯¼</a> æ‰€éœ€è¦çš„èµ„æºã€‚</td>
</tr>
<tr>
<td><strong>system:node-problem-detector</strong></td>
<td>æ— </td>
<td>ä¸º <a href="https://github.com/kubernetes/node-problem-detector" target="_blank" rel="noopener">node-problem-detector</a> ç»„ä»¶å®šä¹‰çš„è§’è‰²ã€‚</td>
</tr>
<tr>
<td><strong>system:persistent-volume-provisioner</strong></td>
<td>æ— </td>
<td>å…è®¸è®¿é—®å¤§éƒ¨åˆ† <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#provisioner" target="_blank" rel="noopener">åŠ¨æ€å·é©±åŠ¨</a> æ‰€éœ€è¦çš„èµ„æºã€‚</td>
</tr>
<tr>
<td><strong>system:monitoring</strong></td>
<td><strong>system:monitoring</strong> ç»„</td>
<td>å…è®¸å¯¹æ§åˆ¶å¹³é¢ç›‘æ§ç«¯ç‚¹çš„è¯»å–è®¿é—®ï¼ˆä¾‹å¦‚ï¼š<a href="https://kubernetes.io/zh/docs/reference/command-line-tools-reference/kube-apiserver/" target="_blank" rel="noopener">kube-apiserver</a> å­˜æ´»å’Œå°±ç»ªç«¯ç‚¹ï¼ˆ<code>/healthz</code>ã€<code>/livez</code>ã€<code>/readyz</code>ï¼‰ï¼Œ å„ä¸ªå¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼ˆ<code>/healthz/*</code>ã€<code>/livez/*</code>ã€<code>/readyz/*</code>ï¼‰å’Œ <code>/metrics</code>ï¼‰ã€‚ è¯·æ³¨æ„ï¼Œå„ä¸ªè¿è¡ŒçŠ¶å†µæ£€æŸ¥ç«¯ç‚¹å’Œåº¦é‡æ ‡å‡†ç«¯ç‚¹å¯èƒ½ä¼šå…¬å¼€æ•æ„Ÿä¿¡æ¯ã€‚</td>
</tr>
</tbody>
</table>
<p><br></p>
<p><strong>å†…ç½®æ§åˆ¶å™¨çš„è§’è‰²</strong><br>æè¿°: Kubernetes æ§åˆ¶å™¨ç®¡ç†å™¨è¿è¡Œå†…å»ºäº Kubernetes æ§åˆ¶é¢çš„æ§åˆ¶å™¨ã€‚ </p>
<p>å½“ä½¿ç”¨ <code>--use-service-account-credentials</code> å‚æ•°å¯åŠ¨æ—¶, kube-controller-manager ä½¿ç”¨å•ç‹¬çš„æœåŠ¡è´¦æˆ·æ¥å¯åŠ¨æ¯ä¸ªæ§åˆ¶å™¨, æ¯ä¸ªå†…ç½®æ§åˆ¶å™¨éƒ½æœ‰ç›¸åº”çš„ã€å‰ç¼€ä¸º <code>system:controller:</code> çš„è§’è‰²ã€‚</p>
<p>å¦‚æœæ§åˆ¶ç®¡ç†å™¨å¯åŠ¨æ—¶æœªè®¾ç½® <code>--use-service-account-credentials</code>ï¼Œå®ƒä½¿ç”¨è‡ªå·±çš„èº«ä»½å‡­æ®æ¥è¿è¡Œæ‰€æœ‰çš„æ§åˆ¶å™¨ï¼Œè¯¥èº«ä»½å¿…é¡»è¢«æˆäºˆæ‰€æœ‰ç›¸å…³çš„è§’è‰²;</p>
<p><em>è§’è‰²åŒ…æ‹¬:</em></p>
<ul>
<li>system:controller:attachdetach-controller</li>
<li>system:controller:certificate-controller</li>
<li>system:controller:clusterrole-aggregation-controller</li>
<li>system:controller:cronjob-controller</li>
<li>system:controller:daemon-set-controller</li>
<li>system:controller:deployment-controller</li>
<li>system:controller:disruption-controller</li>
<li>system:controller:endpoint-controller</li>
<li>system:controller:expand-controller</li>
<li>system:controller:generic-garbage-collector</li>
<li>system:controller:horizontal-pod-autoscaler</li>
<li>system:controller:job-controller</li>
<li>system:controller:namespace-controller</li>
<li>system:controller:node-controller</li>
<li>system:controller:persistent-volume-binder</li>
<li>system:controller:pod-garbage-collector</li>
<li>system:controller:pv-protection-controller</li>
<li>system:controller:pvc-protection-controller</li>
<li>system:controller:replicaset-controller</li>
<li>system:controller:replication-controller</li>
<li>system:controller:resourcequota-controller</li>
<li>system:controller:root-ca-cert-publisher</li>
<li>system:controller:route-controller</li>
<li>system:controller:service-account-controller</li>
<li>system:controller:service-controller</li>
<li>system:controller:statefulset-controller</li>
<li>system:controller:ttl-controller</li>
</ul>
<p><br/></p>
<h5 id="å®é™…æ¡ˆä¾‹"><a href="#å®é™…æ¡ˆä¾‹" class="headerlink" title="å®é™…æ¡ˆä¾‹"></a>å®é™…æ¡ˆä¾‹</h5><h6 id="Role-ClusterRole-ç¤ºä¾‹"><a href="#Role-ClusterRole-ç¤ºä¾‹" class="headerlink" title="Role | ClusterRole ç¤ºä¾‹"></a>Role | ClusterRole ç¤ºä¾‹</h6><p>æè¿°: ä»¥ä¸‹ç¤ºä¾‹å‡ä¸ºä» Role æˆ– CLusterRole å¯¹è±¡ä¸­æˆªå–å‡ºæ¥ï¼Œæˆ‘ä»¬ä»…å±•ç¤ºå…¶ rules éƒ¨åˆ†ã€‚</p>
<ul>
<li><p>1) å…è®¸è¯»å–åœ¨æ ¸å¿ƒ API ç»„ä¸‹çš„ â€œPodsâ€ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rules:</span><br><span class="line">- apiGroups: [<span class="string">""</span>]</span><br><span class="line">  <span class="comment"># åœ¨ HTTP å±‚é¢ï¼Œç”¨æ¥è®¿é—® Pod çš„èµ„æºçš„åç§°ä¸º "pods"</span></span><br><span class="line">  <span class="comment"># GET /api/v1/namespaces/&#123;namespace&#125;/pods/&#123;name&#125;/log</span></span><br><span class="line">  resources: [<span class="string">"pods"</span>]</span><br><span class="line">  verbs: [<span class="string">"get"</span>, <span class="string">"list"</span>, <span class="string">"watch"</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>2) å…è®¸è¯»/å†™åœ¨ â€œextensionsâ€ å’Œ â€œappsâ€ API ç»„ä¸­çš„ Deploymentï¼ˆåœ¨ HTTP å±‚é¢ï¼Œå¯¹åº” URL ä¸­èµ„æºéƒ¨åˆ†ä¸º â€œdeploymentsâ€ï¼‰ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GET /api/v1/namespaces/&#123;namespace&#125;/deployments/&#123;name&#125;</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">["extensions",</span> <span class="string">"apps"</span><span class="string">]</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["deployments"]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["get",</span> <span class="string">"list"</span><span class="string">,</span> <span class="string">"watch"</span><span class="string">,</span> <span class="string">"create"</span><span class="string">,</span> <span class="string">"update"</span><span class="string">,</span> <span class="string">"patch"</span><span class="string">,</span> <span class="string">"delete"</span><span class="string">]</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>3) å…è®¸è¯»å–æ ¸å¿ƒ API ç»„ä¸­çš„ â€œpodsâ€ å’Œ <code>è¯»/å†™ &quot;batch&quot; æˆ– &quot;extensions&quot; API ç»„ä¸­çš„ &quot;jobs&quot;</code>ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">[""]</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["pods"]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["get",</span> <span class="string">"list"</span><span class="string">,</span> <span class="string">"watch"</span><span class="string">]</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">["batch",</span> <span class="string">"extensions"</span><span class="string">]</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["jobs"]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["get",</span> <span class="string">"list"</span><span class="string">,</span> <span class="string">"watch"</span><span class="string">,</span> <span class="string">"create"</span><span class="string">,</span> <span class="string">"update"</span><span class="string">,</span> <span class="string">"patch"</span><span class="string">,</span> <span class="string">"delete"</span><span class="string">]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>4) å…è®¸è¯»å–åç§°ä¸º â€œmy-configâ€ çš„ ConfigMapï¼ˆéœ€è¦é€šè¿‡ RoleBinding ç»‘å®šä»¥ é™åˆ¶ä¸ºæŸåå­—ç©ºé—´ä¸­ç‰¹å®šçš„ ConfigMapï¼‰ï¼š</p>
</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">[""]</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["configmaps"]</span></span><br><span class="line"><span class="attr">  resourceNames:</span> <span class="string">["my-config"]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["get"]</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>5) å…è®¸è¯»å–åœ¨æ ¸å¿ƒç»„ä¸­çš„ â€œnodesâ€ èµ„æºï¼ˆå› ä¸º Node æ˜¯é›†ç¾¤ä½œç”¨åŸŸçš„ï¼Œæ‰€ä»¥éœ€è¦ ClusterRole ç»‘å®šåˆ° ClusterRoleBinding æ‰ç”Ÿæ•ˆï¼‰ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="attr">- apiGroups:</span> <span class="string">[""]</span></span><br><span class="line"><span class="attr">  resources:</span> <span class="string">["nodes"]</span></span><br><span class="line"><span class="attr">  verbs:</span> <span class="string">["get",</span> <span class="string">"list"</span><span class="string">,</span> <span class="string">"watch"</span><span class="string">]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>6) å…è®¸é’ˆå¯¹éèµ„æºç«¯ç‚¹ /healthz å’Œå…¶å­è·¯å¾„ä¸Šå‘èµ· GET å’Œ POST è¯·æ±‚ ï¼ˆå¿…é¡»åœ¨ ClusterRole ç»‘å®š ClusterRoleBinding æ‰ç”Ÿæ•ˆï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rules:</span><br><span class="line">  - nonResourceURLs: [<span class="string">"/healthz"</span>, <span class="string">"/healthz/*"</span>] <span class="comment"># nonResourceURL ä¸­çš„ '*' æ˜¯ä¸€ä¸ªå…¨å±€é€šé…ç¬¦</span></span><br><span class="line">    verbs: [<span class="string">"get"</span>, <span class="string">"post"</span>]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<h6 id="RoleBinding-ClusterRoleBingding-ç¤ºä¾‹"><a href="#RoleBinding-ClusterRoleBingding-ç¤ºä¾‹" class="headerlink" title="RoleBinding | ClusterRoleBingding ç¤ºä¾‹"></a>RoleBinding | ClusterRoleBingding ç¤ºä¾‹</h6><p>æè¿°: ä¸‹é¢ç¤ºä¾‹æ˜¯ RoleBinding ä¸­çš„ç‰‡æ®µï¼Œä»…å±•ç¤ºå…¶ subjects ä¸ roleRef çš„éƒ¨åˆ†ã€‚</p>
<ul>
<li><p>1) å¯¹äºåç§°ä¸º <a href="mailto:alice@example.com">alice@example.com</a> çš„ç”¨æˆ·ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="attr">- kind:</span> <span class="string">User</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">"alice@example.com"</span></span><br><span class="line"><span class="attr">  apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line"><span class="attr">  kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">secret-reader</span></span><br><span class="line"><span class="attr">  apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>2) å¯¹äºåç§°ä¸º frontend-admins çš„ç”¨æˆ·ç»„ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="attr">- kind:</span> <span class="string">Group</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">"frontend-admins"</span></span><br><span class="line"><span class="attr">  apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>3) å¯¹äº kube-system åå­—ç©ºé—´ä¸­çš„é»˜è®¤æœåŠ¡è´¦æˆ·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: default</span><br><span class="line">  namespace: kube-system</span><br></pre></td></tr></table></figure>
</li>
<li><p>4) å¯¹äºä»»ä½•åç§°ç©ºé—´ä¸­çš„ â€œqaâ€ ç»„ä¸­æ‰€æœ‰çš„æœåŠ¡è´¦æˆ·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">subjects:</span><br><span class="line">- kind: Group</span><br><span class="line">  name: system:serviceaccounts:dev</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  namespace: development</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>5) å¯¹äºåœ¨ä»»ä½•åå­—ç©ºé—´ä¸­çš„æœåŠ¡è´¦æˆ·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">subjects:</span><br><span class="line">- kind: Group</span><br><span class="line">  name: system:serviceaccounts</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br></pre></td></tr></table></figure>
</li>
<li><p>6) å¯¹äºæ‰€æœ‰å·²ç»è¿‡è®¤è¯çš„ç”¨æˆ·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">subjects:</span><br><span class="line">- kind: Group</span><br><span class="line">  name: system:authenticated</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br></pre></td></tr></table></figure>
</li>
<li><p>7) å¯¹äºæ‰€æœ‰æœªé€šè¿‡è®¤è¯çš„ç”¨æˆ·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">subjects:</span><br><span class="line">- kind: Group</span><br><span class="line">  name: system:unauthenticated</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br></pre></td></tr></table></figure>
</li>
<li><p>8) å¯¹äºæ‰€æœ‰ç”¨æˆ·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">subjects:</span><br><span class="line">- kind: Group</span><br><span class="line">  name: system:authenticated</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">- kind: Group</span><br><span class="line">  name: system:unauthenticated</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Tips ï¼š API æœåŠ¡å™¨åˆ›å»ºä¸€ç»„é»˜è®¤çš„ ClusterRole å’Œ ClusterRoleBinding å¯¹è±¡ã€‚ è¿™å…¶ä¸­è®¸å¤šæ˜¯ä»¥ system: ä¸ºå‰ç¼€çš„ï¼Œç”¨ä»¥æ ‡è¯†å¯¹åº”èµ„æºæ˜¯ç›´æ¥ç”±é›†ç¾¤æ§åˆ¶é¢ç®¡ç†çš„ã€‚æ‰€æœ‰çš„é»˜è®¤ <code>ClusterRole å’Œ ClusterRoleBinding</code> éƒ½æœ‰<code>kubernetes.io/bootstrapping=rbac-defaults</code> æ ‡ç­¾ã€‚</p>
<p>Tips : è‡ªåŠ¨åå•†é€šè¿‡è¯¥æœºåˆ¶, åœ¨æ¯æ¬¡å¯åŠ¨æ—¶ <code>API æœåŠ¡å™¨</code>éƒ½ä¼šæ›´æ–°é»˜è®¤ <code>ClusterRole</code> ä»¥æ·»åŠ ç¼ºå¤±çš„å„ç§æƒé™ï¼Œå¹¶æ›´æ–°é»˜è®¤çš„ <code>ClusterRoleBinding</code> ä»¥å¢åŠ ç¼ºå¤±çš„çš„å„ç±»ä¸»ä½“ã€‚ å³ä¿®å¤ä¸€äº›ä¸å°å¿ƒå‘ç”Ÿçš„ä¿®æ”¹ï¼Œå¹¶ä¸”æœ‰åŠ©äº<code>ä¿è¯è§’è‰²å’Œè§’è‰²ç»‘å®š</code>åœ¨æ–°çš„å‘è¡Œç‰ˆæœ¬ä¸­æœ‰æƒé™æˆ–ä¸»ä½“å˜æ›´æ—¶ä»ç„¶ä¿æŒæœ€æ–°ã€‚</p>
<p>æ³¨æ„ ï¼šå¦‚æœåŸºäº RBAC çš„é‰´æƒæœºåˆ¶è¢«å¯ç”¨ï¼Œåˆ™è‡ªåŠ¨åå•†åŠŸèƒ½é»˜è®¤æ˜¯è¢«å¯ç”¨çš„ã€‚</p>
<p>æ³¨æ„ ï¼šåœ¨ä¿®æ”¹åç§°åŒ…å« system: å‰ç¼€çš„ <code>ClusterRole</code> å’Œ <code>ClusterRoleBinding</code> æ—¶è¦æ ¼å¤–å°å¿ƒ, å¯¹è¿™äº›èµ„æºçš„æ›´æ”¹å¯èƒ½å¯¼è‡´é›†ç¾¤æ— æ³•ç»§ç»­å·¥ä½œã€‚</p>
<p><br></p>
<h6 id="ClusterRole-RoleBinding-ç¤ºä¾‹"><a href="#ClusterRole-RoleBinding-ç¤ºä¾‹" class="headerlink" title="ClusterRole | RoleBinding ç¤ºä¾‹"></a>ClusterRole | RoleBinding ç¤ºä¾‹</h6><p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„ ClusterRole å’Œ RoleBinding å°†å…è®¸ç”¨æˆ· user-1 æŠŠåå­—ç©ºé—´ user-1-namespace ä¸­çš„ adminã€edit å’Œ view è§’è‰²èµ‹äºˆå…¶ä»–ç”¨æˆ·ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRole</span><br><span class="line">metadata:</span><br><span class="line">  name: role-grantor</span><br><span class="line">rules:</span><br><span class="line">- apiGroups: [<span class="string">"rbac.authorization.k8s.io"</span>]</span><br><span class="line">  resources: [<span class="string">"rolebindings"</span>]</span><br><span class="line">  verbs: [<span class="string">"create"</span>]</span><br><span class="line">- apiGroups: [<span class="string">"rbac.authorization.k8s.io"</span>]</span><br><span class="line">  resources: [<span class="string">"clusterroles"</span>]</span><br><span class="line">  verbs: [<span class="string">"bind"</span>]</span><br><span class="line">  <span class="comment"># å¿½ç•¥ resourceNames æ„å‘³ç€å…è®¸ç»‘å®šä»»ä½• ClusterRole</span></span><br><span class="line">  resourceNames: [<span class="string">"admin"</span>,<span class="string">"edit"</span>,<span class="string">"view"</span>]</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: RoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: role-grantor-binding</span><br><span class="line">  namespace: user-1-namespace</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: role-grantor</span><br><span class="line">subjects:</span><br><span class="line">- apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: User</span><br><span class="line">  name: user-1</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h6 id="å‘½ä»¤è¡Œè§’è‰²-ç»‘å®šåˆ›å»ºç¤ºä¾‹"><a href="#å‘½ä»¤è¡Œè§’è‰²-ç»‘å®šåˆ›å»ºç¤ºä¾‹" class="headerlink" title="å‘½ä»¤è¡Œè§’è‰²|ç»‘å®šåˆ›å»ºç¤ºä¾‹"></a>å‘½ä»¤è¡Œè§’è‰²|ç»‘å®šåˆ›å»ºç¤ºä¾‹</h6><p><strong>Role</strong><br>æè¿°: åˆ›å»º Role å¯¹è±¡ï¼Œå®šä¹‰åœ¨æŸä¸€åå­—ç©ºé—´ä¸­çš„æƒé™ã€‚ä¾‹å¦‚:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºåç§°ä¸º "pod-reader" çš„ Role å¯¹è±¡ï¼Œå…è®¸ç”¨æˆ·å¯¹ Pods æ‰§è¡Œ getã€watch å’Œ list æ“ä½œï¼š</span></span><br><span class="line">kubectl create role pod-reader --verb=get --verb=list --verb=watch --resource=pods</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºåç§°ä¸º "pod-reader" çš„ Role å¯¹è±¡å¹¶æŒ‡å®š resourceNamesï¼š</span></span><br><span class="line">kubectl create role pod-reader --verb=get --resource=pods --resource-name=readablepod --resource-name=anotherpod</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºåä¸º "foo" çš„ Role å¯¹è±¡å¹¶æŒ‡å®š apiGroupsï¼š</span></span><br><span class="line">kubectl create role foo --verb=get,list,watch --resource=replicasets.apps</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºåä¸º "foo" çš„ Role å¯¹è±¡å¹¶æŒ‡å®šå­èµ„æºæƒé™:</span></span><br><span class="line">kubectl create role foo --verb=get,list,watch --resource=pods,pods/status</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºåä¸º "my-component-lease-holder" çš„ Role å¯¹è±¡ï¼Œä½¿å…¶å…·æœ‰å¯¹ç‰¹å®šåç§°çš„ èµ„æºæ‰§è¡Œ get/update çš„æƒé™ï¼š</span></span><br><span class="line">kubectl create role my-component-lease-holder --verb=get,list,watch,update --resource=lease --resource-name=my-compone</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>clusterrole</strong><br>æè¿°: åˆ›å»º ClusterRole å¯¹è±¡ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¾‹å¦‚ï¼šåˆ›å»ºåç§°ä¸º "pod-reader" çš„ ClusterRoleå¯¹è±¡ï¼Œå…è®¸ç”¨æˆ·å¯¹ Pods å¯¹è±¡æ‰§è¡Œ getã€watchå’Œlist` æ“ä½œï¼š</span></span><br><span class="line">kubectl create clusterrole pod-reader --verb=get,list,watch --resource=pods</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºåä¸º "pod-reader" çš„ ClusterRole å¯¹è±¡å¹¶æŒ‡å®š resourceNamesï¼š</span></span><br><span class="line">kubectl create clusterrole pod-reader --verb=get --resource=pods --resource-name=readablepod --resource-name=anotherpod</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºåä¸º "foo" çš„ ClusterRole å¯¹è±¡å¹¶æŒ‡å®š apiGroupsï¼š</span></span><br><span class="line">kubectl create clusterrole foo --verb=get,list,watch --resource=replicasets.apps</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºåä¸º "foo" çš„ ClusterRole å¯¹è±¡å¹¶æŒ‡å®šå­èµ„æº:</span></span><br><span class="line">kubectl create clusterrole foo --verb=get,list,watch --resource=pods,pods/status</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºåä¸º "foo" çš„ ClusterRole å¯¹è±¡å¹¶æŒ‡å®š nonResourceURLï¼š</span></span><br><span class="line">kubectl create clusterrole <span class="string">"foo"</span> --verb=get --non-resource-url=/logs/*</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºåä¸º "monitoring" çš„ ClusterRole å¯¹è±¡å¹¶æŒ‡å®š aggregationRuleï¼š</span></span><br><span class="line">kubectl create clusterrole monitoring --aggregation-rule=<span class="string">"rbac.example.com/aggregate-to-monitoring=true"</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>rolebinding</strong><br>æè¿°ï¼šåœ¨ç‰¹å®šçš„åå­—ç©ºé—´ä¸­å¯¹ Role æˆ– ClusterRole æˆæƒã€‚<br>ä¾‹å¦‚ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨åå­—ç©ºé—´ "acme" ä¸­ï¼Œå°†åä¸º admin çš„ ClusterRole ä¸­çš„æƒé™æˆäºˆåç§° "bob" çš„ç”¨æˆ·:</span></span><br><span class="line">kubectl create rolebinding bob-admin-binding --clusterrole=admin --user=bob --namespace=acme</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨åå­—ç©ºé—´ "acme" ä¸­ï¼Œå°†åä¸º view çš„ ClusterRole ä¸­çš„æƒé™æˆäºˆåå­—ç©ºé—´ "acme" ä¸­åä¸º myapp çš„æœåŠ¡è´¦æˆ·ï¼š</span></span><br><span class="line">kubectl create rolebinding myapp-view-binding --clusterrole=view --serviceaccount=acme:myapp --namespace=acme</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨åå­—ç©ºé—´ "acme" ä¸­ï¼Œå°†åä¸º view çš„ ClusterRole å¯¹è±¡ä¸­çš„æƒé™æˆäºˆåå­—ç©ºé—´ "myappnamespace" ä¸­åç§°ä¸º myapp çš„æœåŠ¡è´¦æˆ·ï¼š</span></span><br><span class="line">kubectl create rolebinding myappnamespace-myapp-view-binding --clusterrole=view --serviceaccount=myappnamespace:myapp</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>clusterrolebinding</strong><br>æè¿°ï¼šåœ¨æ•´ä¸ªé›†ç¾¤ï¼ˆæ‰€æœ‰åå­—ç©ºé—´ï¼‰ä¸­ç”¨ ClusterRole æˆæƒã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¾‹å¦‚ï¼šåœ¨æ•´ä¸ªé›†ç¾¤èŒƒå›´ï¼Œå°†åä¸º cluster-admin çš„ ClusterRole ä¸­å®šä¹‰çš„æƒé™æˆäºˆåä¸º "root" ç”¨æˆ·ï¼š</span></span><br><span class="line">kubectl create clusterrolebinding root-cluster-admin-binding --clusterrole=cluster-admin --user=root</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨æ•´ä¸ªé›†ç¾¤èŒƒå›´å†…ï¼Œå°†åä¸º system:node-proxier çš„ ClusterRole çš„æƒé™æˆäºˆåä¸º "system:kube-proxy" çš„ç”¨æˆ·ï¼š</span></span><br><span class="line">kubectl create clusterrolebinding kube-proxy-binding --clusterrole=system:node-proxier --user=system:kube-proxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨æ•´ä¸ªé›†ç¾¤èŒƒå›´å†…ï¼Œå°†åä¸º view çš„ ClusterRole ä¸­å®šä¹‰çš„æƒé™æˆäºˆ "acme" åå­—ç©ºé—´ä¸­ åä¸º "myapp" çš„æœåŠ¡è´¦æˆ·ï¼š</span></span><br><span class="line">kubectl create clusterrolebinding myapp-view-binding --clusterrole=view --serviceaccount=acme:myapp</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><strong>auth reconcile</strong><br>æè¿°ï¼šä½¿ç”¨æ¸…å•æ–‡ä»¶æ¥åˆ›å»ºæˆ–è€…æ›´æ–° <code>rbac.authorization.k8s.io/v1 API</code> å¯¹è±¡; å°šä¸å­˜åœ¨çš„å¯¹è±¡ä¼šè¢«åˆ›å»ºï¼Œå¦‚æœå¯¹åº”çš„åå­—ç©ºé—´ä¹Ÿä¸å­˜åœ¨ï¼Œå¿…è¦çš„è¯ä¹Ÿä¼šè¢«åˆ›å»ºã€‚</p>
<ul>
<li>å·²ç»å­˜åœ¨çš„è§’è‰²ä¼šè¢«æ›´æ–°ï¼Œä½¿ä¹‹åŒ…å«è¾“å…¥å¯¹è±¡ä¸­æ‰€ç»™çš„æƒé™ã€‚å¦‚æœæŒ‡å®šäº† â€“remove-extra-permissionsï¼Œå¯ä»¥åˆ é™¤é¢å¤–çš„æƒé™ã€‚</li>
<li>å·²ç»å­˜åœ¨çš„ç»‘å®šä¹Ÿä¼šè¢«æ›´æ–°ï¼Œä½¿ä¹‹åŒ…å«è¾“å…¥å¯¹è±¡ä¸­æ‰€ç»™çš„ä¸»ä½“ã€‚å¦‚æœæŒ‡å®šäº† â€“remove-extra-permissionsï¼Œåˆ™å¯ä»¥åˆ é™¤å¤šä½™çš„ä¸»ä½“ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¾‹å¦‚:æµ‹è¯•åº”ç”¨ RBAC å¯¹è±¡çš„æ¸…å•æ–‡ä»¶ï¼Œæ˜¾ç¤ºå°†è¦è¿›è¡Œçš„æ›´æ”¹ï¼š</span></span><br><span class="line">kubectl auth reconcile -f my-rbac-rules.yaml --dry-run</span><br><span class="line"></span><br><span class="line"><span class="comment"># åº”ç”¨ RBAC å¯¹è±¡çš„æ¸…å•æ–‡ä»¶ï¼Œä¿ç•™è§’è‰²ä¸­çš„é¢å¤–æƒé™å’Œç»‘å®šä¸­çš„å…¶ä»–ä¸»ä½“ï¼š</span></span><br><span class="line">kubectl auth reconcile -f my-rbac-rules.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># åº”ç”¨ RBAC å¯¹è±¡çš„æ¸…å•æ–‡ä»¶, åˆ é™¤è§’è‰²ä¸­çš„é¢å¤–æƒé™å’Œç»‘å®šä¸­çš„å…¶ä»–ä¸»ä½“ï¼š</span></span><br><span class="line">kubectl auth reconcile -f my-rbac-rules.yaml --remove-extra-subjects --remove-extra-permissions</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="3-Admission-Control-å‡†å…¥æ§åˆ¶"><a href="#3-Admission-Control-å‡†å…¥æ§åˆ¶" class="headerlink" title="3) Admission Control (å‡†å…¥æ§åˆ¶)"></a>3) Admission Control (å‡†å…¥æ§åˆ¶)</h3><p>æè¿°: å‡†å…¥æ§åˆ¶(Admission Control)æ˜¯<code>API Server</code>çš„æ’ä»¶é›†åˆé€šè¿‡<code>æ·»åŠ ä¸åŒçš„æ’ä»¶</code>ï¼Œå®ç°é¢å¤–çš„å‡†å…¥æ§åˆ¶è§„åˆ™(<code>å³è¦æ±‚åšè¿›ä¸€æ­¥çš„éªŒè¯æˆ–æ·»åŠ é»˜è®¤å‚æ•°</code>)ã€‚ä¸åŒäºæˆæƒå’Œè®¤è¯åªå…³å¿ƒç”¨æˆ·çš„æ“ä½œè¯·æ±‚ï¼Œå‡†å…¥æ§åˆ¶è¿˜å¤„ç†è¯·æ±‚çš„å†…å®¹ï¼Œå¹¶ä¸”ä»…ä»…å¯¹åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤æˆ–è€…è¿æ¥(å¦‚ä»£ç†)ç­‰æœ‰æ•ˆè€Œå¯¹è¯»æ“ä½œæ— æ•ˆ;</p>
<p>Tips: ç”šè‡³äº<code>Api-Server</code>çš„ä¸€äº›ä¸»è¦çš„åŠŸèƒ½éƒ½éœ€è¦é€šè¿‡ <code>Admission Controllers</code> å®ç°ã€‚</p>
<p>Tips: å‡†å…¥æ§åˆ¶ä¹Ÿæ”¯æŒåŒæ—¶å¼€å¯å¤šä¸ªæ’ä»¶ï¼Œä»–ä»¬ä¾æ¬¡è°ƒç”¨åªæœ‰å…¨éƒ¨æ’ä»¶éƒ½é€šè¿‡è¯·æ±‚ä¹‹åæ‰å¯ä»¥æ”¾å…¥ç³»ç»Ÿ;</p>
<p>æ¯”å¦‚ <code>Service-Account</code> å®˜æ–¹æ–‡æ¡£ä¸Šæœ‰ä¸€ä»½é’ˆå¯¹ä¸åŒç‰ˆæœ¬çš„å‡†å…¥æ§åˆ¶å™¨æ¨èåˆ—è¡¨ï¼Œå…¶ä¸­æœ€æ–°çš„ 1.14 çš„æ¨èåˆ—è¡¨æ˜¯:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NamespaceLifecycle, LimitRanger, ServiceAccount, DefaultStorageClass, DefaultTolerationSeconds,MutatingAdmissionWebhook, ValidatingAdmissionWebhook, ResourceQuota</span><br></pre></td></tr></table></figure>
<p><strong>åˆ—ä¸¾å‡ ä¸ªæ’ä»¶çš„åŠŸèƒ½:</strong></p>
<ul>
<li>1.NamespaceLifecycle: é˜²æ­¢åœ¨ä¸å­˜åœ¨çš„namespaceä¸Šåˆ›å»ºå¯¹è±¡ï¼Œé˜²æ­¢åˆ é™¤ç³»ç»Ÿé¢„ç½®namespaceï¼Œåˆ é™¤namespaceæ—¶ï¼Œè¿å¸¦åˆ é™¤å®ƒçš„æ‰€æœ‰K8s å¯¹è±¡ã€‚</li>
<li>2.LimitRanger: ç¡®ä¿è¯·æ±‚çš„èµ„æºä¸ä¼šè¶…è¿‡èµ„æºæ‰€åœ¨Namespace çš„ LimitRangeçš„é™åˆ¶ã€‚</li>
<li>3.ServiceAccount: å®ç°äº†è‡ªåŠ¨åŒ–æ·»åŠ  ServiceAccountã€‚</li>
<li>4.ResourceQuota: ç¡®ä¿è¯·æ±‚çš„èµ„æºä¸ä¼šè¶…è¿‡èµ„æºçš„ResourceQuotaé™åˆ¶ã€‚</li>
<li>5.AlwaysAdmit: æ¥æ”¶æ‰€æœ‰è¯·æ±‚</li>
<li>6.AlwaysPullImages: æ€»æ˜¯æ‹‰å–æœ€æ–°çš„é•œåƒåœ¨å¤šç§Ÿæˆ·åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ã€‚</li>
<li>7.initalResources: æ ¹æ®é•œåƒçš„ä½¿ç”¨è®°å½•ä¸ºå®¹å™¨è®¾ç½®é»˜è®¤èµ„æºè¯·æ±‚å’Œé™åˆ¶;</li>
<li>8.initializers: ç”¨æ¥ç»™èµ„æºæ‰§è¡Œç­–ç•¥æˆ–è€…é…ç½®é»˜è®¤é€‰é¡¹ï¼ŒåŒ…æ‹¬Initializersæ§åˆ¶å™¨ä¸ç”¨æˆ·è‡ªå®šä¹‰çš„Initalizerä»»åŠ¡ï¼Œæ§åˆ¶å™¨è´Ÿè´£æ‰§è¡Œç”¨æˆ·æäº¤çš„ä»»åŠ¡ï¼Œå®Œæˆåå°†ä»metadata.initalizersåˆ—è¡¨ä¸­åˆ é™¤;</li>
</ul>
<p><br/></p>
<p><strong>initializers</strong><br>å¼€å¯æ–¹å¼: é…ç½®kube-apiserverå¯åŠ¨å‚æ•°ä¸­åŠ å…¥â€“admission-control=â€¦,Initalizers, ç„¶åkube-apiserverå¼€å¯admissionregistration.k8s.io/v1å³(<code>--runtime-config=admissionregistration.k8s.io/v1</code>)éƒ¨ç½² Initializersæ§åˆ¶å™¨;</p>
<p>Tips : æˆ‘ä»¬å¯ä»¥å¤‡æ³¨é‚£äº›è‡ªå®šä¹‰èµ„æºå¯ä»¥å¼€å¯InitializeråŠŸèƒ½;</p>
<p>èµ„æºæ¸…å•ç¤ºä¾‹:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: admissionregistration.k8s.io/v1</span><br><span class="line">kind: InitializerConfiguration</span><br><span class="line">metadata:</span><br><span class="line">  name: example-config</span><br><span class="line">initializers:</span><br><span class="line">  name: podimage.example</span><br><span class="line">  rules: </span><br><span class="line">    apiGroups: [<span class="string">""</span>]</span><br><span class="line">    apiVersion: [<span class="string">"v1"</span>]</span><br><span class="line">    resources: [<span class="string">"pods"</span>]</span><br></pre></td></tr></table></figure></p>
<p>Initialzers åº”ç”¨åœºæ™¯: ä¿®æ”¹èµ„æºçš„é…ç½®ï¼Œæ¯”å¦‚è‡ªåŠ¨ç»™Podæ·»åŠ ä¸€ä¸ªSidecarå®¹å™¨æˆ–å­˜å‚¨å·;</p>
<p>Initializers å¼€å‘: å…¶å¿…é¡»æœ‰ä¸ªå…¨å±€å”¯ä¸€åç§°ï¼Œæ¯”å¦‚<code>initializer.vaultproject.io</code>ï¼Œå…¶æœ‰å¯èƒ½æ”¶åˆ°ä¿¡æ¯ä¸å…¨çš„èµ„æº(<code>æ¯”å¦‚:æœ‰å¯èƒ½æ”¶åˆ°ä¿¡æ¯ä¸å…¨çš„èµ„æº</code>), å¯¹äºInitializerè‡ªèº«éƒ¨ç½²å¯é‡‡ç”¨Deploymentä½†æ˜¯éœ€è¦æ‰‹åŠ¨è®¾ç½®Initializersåˆ—è¡¨ä¸ºç©ºä»¥é¿å…æ— æ³•å¯åŠ¨çš„é—®é¢˜;<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  initializers:</span><br><span class="line">    pengding: []</span><br><span class="line">GenericAdmissionWebhook</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p><strong>GenericAdmissionWebhook</strong><br>æè¿°: æä¾›äº†ä¸€ç§Webhookæ–¹å¼çš„å‡†å…¥æœºåˆ¶ï¼Œå®ƒä¸ä¼šæ”¹å˜è¯·æ±‚å¯¹è±¡ï¼Œä½†å¯ä»¥ç”¨æ¥éªŒè¯ç”¨æˆ·çš„è¯·æ±‚ã€‚</p>
<p>GenericAdmissionWebhook å¯åŠ¨æ–¹å¼: â€“admission-control=â€¦,GenericAdmissionWebhook, ç„¶åkube-apiserverå¼€å¯admissionregistration.k8s.io/v1å³(<code>--runtime-config=admissionregistration.k8s.io/v1</code>)éƒ¨ç½² Webhookæ§åˆ¶å™¨; </p>
<p>Tips : æ³¨æ„æ­¤å¤„çš„å‡†å…¥æ§åˆ¶å™¨å¿…é¡»ä½¿ç”¨TLSå¹¶é€šè¿‡ExternalAdmisshookConfigurations.client.caBundle æƒ³ Kube-apiserver è¿›è¡Œæ³¨å†Œ;</p>
<hr>
<h3 id="4-ä¸Šä¸‹æ–‡ç¯å¢ƒ"><a href="#4-ä¸Šä¸‹æ–‡ç¯å¢ƒ" class="headerlink" title="4) ä¸Šä¸‹æ–‡ç¯å¢ƒ"></a>4) ä¸Šä¸‹æ–‡ç¯å¢ƒ</h3><p>æè¿°: æˆ‘ä»¬å¯ä»¥é€šè¿‡Contextä¸ºä¸Šé¢ä¸åŒçš„NameSpaceä¸‹å®šä¹‰è¿è¡Œç¯å¢ƒæˆ–è€…æ˜¯è¿æ¥å…¶å®ƒk8sé›†ç¾¤è¿›è¡Œç›¸åº”çš„æ“ä½œç®¡ç†ã€‚</p>
<p>é‡‡ç”¨Contextä¸Šä¸‹æ–‡æ–¹å¼æå¤§çš„æé«˜äº†è¿ç»´K8sçš„æ•ˆç‡å’Œæ“ä½œæ€§ã€‚<br><a href="https://www.cnblogs.com/fengrg/p/14931265.html" target="_blank" rel="noopener">https://www.cnblogs.com/fengrg/p/14931265.html</a></p>
<p><strong>æ“ä½œæµç¨‹:</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</span></span><br><span class="line">~$ kubectl cluster-info</span><br><span class="line">  <span class="comment"># Kubernetes master is running at https://weiyigeek-lb-vip.k8s:16443</span></span><br><span class="line">  <span class="comment"># KubeDNS is running at https://weiyigeek-lb-vip.k8s:16443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æŸ¥çœ‹å·²å®šä¹‰çš„Context</span></span><br><span class="line">$ kubectl config view</span><br><span class="line">apiVersion: v1</span><br><span class="line">clusters:</span><br><span class="line">- cluster:</span><br><span class="line">    certificate-authority-data: DATA+OMITTED</span><br><span class="line">    server: https://weiyigeek-lb-vip.k8s:16443</span><br><span class="line">  name: kubernetes</span><br><span class="line">contexts:</span><br><span class="line">- context:</span><br><span class="line">    cluster: kubernetes</span><br><span class="line">    user: kubernetes-admin</span><br><span class="line">  name: kubernetes-admin@kubernetes</span><br><span class="line">current-context: kubernetes-admin@kubernetes</span><br><span class="line">kind: Config</span><br><span class="line">preferences: &#123;&#125;</span><br><span class="line">users:</span><br><span class="line">- name: kubernetes-admin</span><br><span class="line">  user:</span><br><span class="line">    client-certificate-data: REDACTED</span><br><span class="line">    client-key-data: REDACTED</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.ä¸ºæŒ‡å®šçš„Namespaceè®¾ç½®Context</span></span><br><span class="line">$ kubectl config <span class="built_in">set</span>-cluster kubernetes-cluster --server=https://weiyigeek-lb-vip.k8s:16443</span><br><span class="line"></span><br><span class="line">$ kubectl config <span class="built_in">set</span>-context ctx-dev --namespace=dev --cluster=kubernetes-cluster --user dev</span><br><span class="line">Context <span class="string">"ctx-dev"</span> created.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.åˆ‡æ¢å½“å‰è¿è¡Œç¯å¢ƒä¸ºctx-dev</span></span><br><span class="line">$ kubectl config view</span><br><span class="line">apiVersion: v1</span><br><span class="line">clusters:</span><br><span class="line">- cluster:</span><br><span class="line">    server: https://weiyigeek-lb-vip.k8s:16443</span><br><span class="line">  name: kubernetes-cluster</span><br><span class="line">.....</span><br><span class="line">contexts:</span><br><span class="line">- context:</span><br><span class="line">    cluster: kubernetes-cluster</span><br><span class="line">    namespace: dev</span><br><span class="line">    user: dev</span><br><span class="line">  name: ctx-dev</span><br><span class="line"></span><br><span class="line">$ kubectl config use-context ctx-dev</span><br><span class="line">  <span class="comment"># Switched to context "ctx-dev".</span></span><br><span class="line"></span><br><span class="line">$ kubectl config use-context ctx-dev | grep <span class="string">"current-context"</span></span><br><span class="line">  <span class="comment"># Please enter Username: </span></span><br><span class="line">  <span class="comment"># Please enter Password:</span></span><br><span class="line">  <span class="comment"># current-context: ctx-dev</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.åˆ‡æ¢å› kubernetes-admin è¿è¡Œç¯å¢ƒ</span></span><br><span class="line">kubectl config use-context kubernetes-admin@kubernetes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.åˆ é™¤åˆ›å»ºçš„ contextä¸cluster </span></span><br><span class="line">kubectl config delete-context ctx-dev</span><br><span class="line">kubectl config delete-cluster kubernetes-cluster</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="5-åŸºç¡€å®è·µ"><a href="#5-åŸºç¡€å®è·µ" class="headerlink" title="5) åŸºç¡€å®è·µ"></a>5) åŸºç¡€å®è·µ</h3><h4 id="å®éªŒ1-é…ç½®è¯ä¹¦-ä¸-Api-Server-è®¤è¯è®¿é—®"><a href="#å®éªŒ1-é…ç½®è¯ä¹¦-ä¸-Api-Server-è®¤è¯è®¿é—®" class="headerlink" title="å®éªŒ1.é…ç½®è¯ä¹¦ ä¸ Api-Server è®¤è¯è®¿é—®"></a>å®éªŒ1.é…ç½®è¯ä¹¦ ä¸ Api-Server è®¤è¯è®¿é—®</h4><ul>
<li><p>Step 1.åˆ›å»º.kubeæ–‡ä»¶å¤¹å¹¶æŠŠ<code>admin.conf</code>å¤åˆ¶åˆ°æ­¤æ–‡ä»¶å¤¹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) åˆ›å»ºä¸å¤åˆ¶é…ç½®æ–‡ä»¶</span></span><br><span class="line">mkdir -p <span class="variable">$HOME</span>/.kubeTest</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kubeTest/config</span><br></pre></td></tr></table></figure>
</li>
<li><p>Step 2.æ ¹æ®é…ç½®æ–‡ä»¶ç”Ÿæˆp12æ ¼å¼çš„è¯ä¹¦</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># client-certificate-data</span></span><br><span class="line">~$ grep <span class="string">'client-certificate-data'</span> ~/.kube/config | head -n 1 | awk <span class="string">'&#123;print $2&#125;'</span> | base64 -d &gt; client.crt</span><br><span class="line">-----BEGIN CERTIFICATE-----</span><br><span class="line">MIIDEzCCAfugAwIBAgIIWBe7BoJxSXAwDQYJKoZIhvcNAQELBQAwFTETMBEGA1UE</span><br><span class="line">AxMKa3ViZXJuZXRlczAeFw0yMTAxMTEwNDU0NTNaFw0yMjAxMTEwNDU0NTZaMDQx</span><br><span class="line">.......</span><br><span class="line">2ERQAmHha6j9d8x0nolby5HavjKuZuUaac+USV4SZ0l4B2Vx/i76UHdaJh1/iYzp</span><br><span class="line">trDCsYy8SchEdPqzgoKy+Sd1KzMjFtg=</span><br><span class="line">-----END CERTIFICATE-----</span><br><span class="line"></span><br><span class="line"><span class="comment"># client-key-data</span></span><br><span class="line">~$ grep <span class="string">'client-key-data'</span> ~/.kube/config | head -n 1 | awk <span class="string">'&#123;print $2&#125;'</span> | base64 -d &gt; client.key</span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIIEogIBAAKCAQEA5q/YNa8t+bPfMkPlfu54eBTkBHueqDJY1ogJCTS2XSrvEk50</span><br><span class="line">xd5OUVBYyh6Z8dWOexQVeMGtXg9Nmc3okTde38vyTU4A9UsCjJbl9UzsAGsB4dTa</span><br><span class="line">Svk2OPBV7JYaCX2vPAKotB6iYyZrfAnEV6RV3a9JKTZHL7lSTsumgp6XkSTpZJv+</span><br><span class="line">......</span><br><span class="line">1SP558GlSXMyMn5sQZ6EGioURuaBW+ErbSZXLzS/kbulMShFT1PafrVInzXkQ92N</span><br><span class="line">BHH5AoGAIgkTX5Rp6nMtPquk+N3/IASWKiTFLpCGzUslhchz0P3nh041Gwl2Soxf</span><br><span class="line">6DebdQ+j/m2Opolj/lBm85PtXlyY7TMHv1QJH+8LAToCIA4nhwN29zWXkExrI5Sd</span><br><span class="line">QSShmOwGngmhYTHDYiSx7OXQa815tjRsXPEkMU/C9k6QwV+ToEM=</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆ p12 æ ¼å¼è¯ä¹¦ -&gt; kubecfg.p12 (å¯èƒ½è¾“å…¥å¯†ç ä»¥ä¾›ä»¥åå¯¼å…¥æ—¶ä½¿ç”¨)</span></span><br><span class="line">openssl pkcs12 -<span class="built_in">export</span> -clcerts -inkey client.key -<span class="keyword">in</span> client.crt -out kubecfg.p12 -name <span class="string">"kubernetes-client"</span></span><br><span class="line"></span><br><span class="line">~$ ls -lah client.* kubecfg.p12</span><br><span class="line">-rw-r--r-- 1 weiyigeek weiyigeek 1.2K Feb 25 06:44 client.crt</span><br><span class="line">-rw-r--r-- 1 weiyigeek weiyigeek 1.7K Feb 25 06:44 client.key</span><br><span class="line">-rw------- 1 weiyigeek weiyigeek 2.5K Feb 25 06:44 kubecfg.p12</span><br></pre></td></tr></table></figure>
</li>
<li><p>Step 3.å®Œæˆä»¥åæˆ‘ä»¬æŠŠ<code>kubecfg.p12</code>å¤åˆ¶åˆ°è¦è®¿é—®dashboardçš„æœºå™¨ä¸Š, å¦‚æœæ˜¯windowsæœºåˆ™åŒå‡»è¿™ä¸ªæ–‡ä»¶ä¼šå¼¹å‡ºä¸€ä¸ªå®‰è£…å‘å¯¼,éœ€è¦è¾“å…¥æˆ‘ä»¬åˆšæ‰è®¾ç½®çš„å¯†ç è¾“å…¥å®Œä»¥åä¸€ç›´ä¸‹ä¸€æ­¥å°±è¡Œäº†.</p>
</li>
</ul>
<figure class="image-box">
                <a rel=9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç» href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210225145630.png" target="_blank" title="WeiyiGeek.è¯ä¹¦å¯¼å…¥" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210225145630.png" alt="WeiyiGeek.è¯ä¹¦å¯¼å…¥" title="" class=""></a>
                <p>WeiyiGeek.è¯ä¹¦å¯¼å…¥</p>
            </figure>
<ul>
<li>Step 4.å¯¼å…¥å‰åè®¿é—®é›†ç¾¤åœ°å€<code>https://192.168.12.110:16443/api/v1/namespaces/kube-system/services/</code>è¿›è¡Œæ¯”å¯¹ï¼›</li>
</ul>
<p>Tips : æ³¨æ„ç›®å‰ä½¿ç”¨ç«ç‹ä¼šå‡ºç°403 forbiddenç°è±¡åˆ‡æ¢åˆ°è°·æ­Œå°±è¡Œäº†</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ kubectl cluster-info</span><br><span class="line">  <span class="comment"># Kubernetes master is running at https://192.168.12.110:16443</span></span><br><span class="line">  <span class="comment"># KubeDNS is running at https://192.168.12.110:16443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span></span><br><span class="line">  <span class="comment"># https://192.168.12.110:16443/api/v1/namespaces/kubernetes-dashboard/services/</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Step 5.è®¿é—®ç»“æœå¯ä»¥çœ‹åˆ°æ²¡æœ‰å¯¼å…¥è¯ä¹¦å‰æ˜¯æ²¡æœ‰æƒé™è¿æ¥api-serverçš„å¯¼å…¥è¯ä¹¦åæ‰èƒ½ä¸é›†ç¾¤æ­£å¸¸é€šä¿¡;</li>
</ul>
<figure class="image-box">
                <a rel=9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç» href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210225152937.png" target="_blank" title="WeiyiGeek.è¯ä¹¦è®¿é—®é›†ç¾¤" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210225152937.png" alt="WeiyiGeek.è¯ä¹¦è®¿é—®é›†ç¾¤" title="" class=""></a>
                <p>WeiyiGeek.è¯ä¹¦è®¿é—®é›†ç¾¤</p>
            </figure>
<p><br></p>
<h4 id="å®éªŒ2-åˆ›å»ºæ™®é€šç”¨æˆ·è¿›è¡Œå¯¹Kubernetesé›†ç¾¤çš„ç®¡ç†"><a href="#å®éªŒ2-åˆ›å»ºæ™®é€šç”¨æˆ·è¿›è¡Œå¯¹Kubernetesé›†ç¾¤çš„ç®¡ç†" class="headerlink" title="å®éªŒ2.åˆ›å»ºæ™®é€šç”¨æˆ·è¿›è¡Œå¯¹Kubernetesé›†ç¾¤çš„ç®¡ç†"></a>å®éªŒ2.åˆ›å»ºæ™®é€šç”¨æˆ·è¿›è¡Œå¯¹Kubernetesé›†ç¾¤çš„ç®¡ç†</h4><p>Tips: æ™®é€šç”¨æˆ·å¹¶ä¸æ˜¯é€šè¿‡k8sæ¥åˆ›å»ºå’Œç»´æŠ¤ï¼Œæ˜¯é€šè¿‡<code>åˆ›å»ºè¯ä¹¦å’Œåˆ‡æ¢ä¸Šä¸‹æ–‡ç¯å¢ƒçš„æ–¹å¼æ¥åˆ›å»ºå’Œåˆ‡æ¢ç”¨æˆ·</code>ã€‚</p>
<p><strong>å®æ“æ­¥éª¤:</strong></p>
<ul>
<li>(1) ä¸‹è½½è¯ä¹¦ç”Ÿæˆç›¸å…³å·¥å…· <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir cert &amp;&amp; <span class="built_in">cd</span> <span class="variable">$_</span></span><br><span class="line">wget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 </span><br><span class="line">wget https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64 </span><br><span class="line">wget https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64 </span><br><span class="line"></span><br><span class="line">chmod +x *</span><br><span class="line">sudo mv cfssl_linux-amd64 /usr/<span class="built_in">local</span>/bin/cfssl </span><br><span class="line">sudo mv cfssljson_linux-amd64 /usr/<span class="built_in">local</span>/bin/cfssljson</span><br><span class="line">sudo mv cfssl-certinfo_linux-amd64 /usr/<span class="built_in">local</span>/bin/cfssl-certinfo</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>(2) è¯ä¹¦ç”³è¯·æ–‡ä»¶ appuser-csr.json (å‰é¢è¯´è¿‡ CN ä¸ O ä¸¤ä¸ªå­—æ®µ)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; appuser-csr.json &lt;&lt;<span class="string">'END'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"CN"</span>: <span class="string">"appuser"</span>,</span><br><span class="line">  <span class="string">"hosts"</span>: [],</span><br><span class="line">  <span class="string">"key"</span>:&#123;</span><br><span class="line">    <span class="string">"algo"</span>: <span class="string">"rsa"</span>,</span><br><span class="line">    <span class="string">"size"</span>: 2048</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"names"</span>:[</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="string">"C"</span>: <span class="string">"CN"</span>,</span><br><span class="line">    <span class="string">"ST"</span>:<span class="string">"ChongQing"</span>,</span><br><span class="line">    <span class="string">"L"</span>: <span class="string">"ChongQing"</span>,</span><br><span class="line">    <span class="string">"O"</span>: <span class="string">"kubernetes"</span>,</span><br><span class="line">    <span class="string">"OU"</span>: <span class="string">"System"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">END</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li>(3) ç”Ÿæˆappuserç”¨æˆ·çš„è¯ä¹¦ä¸å¯†é’¥<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¯ä¹¦ç”Ÿæˆ</span></span><br><span class="line">cfssl gencert -ca=/etc/kubernetes/pki/ca.crt -ca-key=/etc/kubernetes/pki/ca.key -profile=kubernetes appuser-csr.json | cfssljson -bare appuser</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯ä¹¦ç›¸å…³äº§ç‰©</span></span><br><span class="line">~/k8s/certificate$ ls</span><br><span class="line">  <span class="comment"># appuser.csr  appuser-csr.json  appuser-key.pem  appuser.pem</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯ä¹¦æ ¡éªŒ</span></span><br><span class="line">~/k8s/certificate$ cfssl-certinfo -cert appuser.pem</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"subject"</span>: &#123;</span><br><span class="line">    <span class="string">"common_name"</span>: <span class="string">"appuser"</span>,</span><br><span class="line">    <span class="string">"country"</span>: <span class="string">"CN"</span>,</span><br><span class="line">    <span class="string">"organization"</span>: <span class="string">"kubernetes"</span>,</span><br><span class="line">    <span class="string">"organizational_unit"</span>: <span class="string">"System"</span>,</span><br><span class="line">    <span class="string">"locality"</span>: <span class="string">"ChongQing"</span>,</span><br><span class="line">    <span class="string">"province"</span>: <span class="string">"ChongQing"</span>,</span><br><span class="line">    <span class="string">"names"</span>: [</span><br><span class="line">      <span class="string">"CN"</span>,</span><br><span class="line">      <span class="string">"ChongQing"</span>,</span><br><span class="line">      <span class="string">"ChongQing"</span>,</span><br><span class="line">      <span class="string">"kubernetes"</span>,</span><br><span class="line">      <span class="string">"System"</span>,</span><br><span class="line">      <span class="string">"appuser"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"issuer"</span>: &#123;</span><br><span class="line">    <span class="string">"common_name"</span>: <span class="string">"kubernetes"</span>,</span><br><span class="line">    <span class="string">"names"</span>: [</span><br><span class="line">      <span class="string">"kubernetes"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"serial_number"</span>: <span class="string">"239757714011015189695612917089053624450762739049"</span>,</span><br><span class="line">  <span class="string">"not_before"</span>: <span class="string">"2021-02-25T08:31:00Z"</span>,</span><br><span class="line">  <span class="string">"not_after"</span>: <span class="string">"2022-02-25T08:31:00Z"</span>,</span><br><span class="line">  <span class="string">"sigalg"</span>: <span class="string">"SHA256WithRSA"</span>,</span><br><span class="line">  <span class="string">"authority_key_id"</span>: <span class="string">"77:73:2:88:85:EF:E1:B2:64:5E:D6:9:E0:F:9F:3:5:E8:FE:8D"</span>,</span><br><span class="line">  <span class="string">"subject_key_id"</span>: <span class="string">"A0:45:35:5D:64:59:F9:0:6D:38:49:AF:3F:BD:96:63:F7:CD:6A:FD"</span>,</span><br><span class="line">  <span class="string">"pem"</span>: <span class="string">"-----BEGIN CERTIFICATE-----\AA..............CCC\n-----END CERTIFICATE-----\n"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="image-box">
                <a rel=9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç» href="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210225163023.png" target="_blank" title="WeiyiGeek.CERTIFICATEå’ŒPRIVATE" data-fancybox="images"><img src="https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2021/1/20210225163023.png" alt="WeiyiGeek.CERTIFICATEå’ŒPRIVATE" title="" class=""></a>
                <p>WeiyiGeek.CERTIFICATEå’ŒPRIVATE</p>
            </figure>
<p><br/></p>
<ul>
<li>(4) è®¾ç½®é›†ç¾¤å‚æ•°å¹¶ç”Ÿæˆé…ç½®æ–‡ä»¶ (å³å¯ä»¥ç®¡ç†å…¶å®ƒK8Sé›†ç¾¤)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é‡‡ç”¨åˆå¹¶çš„æ–¹å¼è·å¾—CAçš„pemæ ¼å¼è¯ä¹¦</span></span><br><span class="line"><span class="built_in">cd</span> /etc/kubernetes/pki</span><br><span class="line">sudo cat ca.crt ca.key &gt; ~/k8s/certificate/ca.pem</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®é›†ç¾¤å‚æ•°</span></span><br><span class="line"><span class="built_in">export</span> KUBE_APISERVER=<span class="string">"https://192.168.12.110:16443"</span></span><br><span class="line">kubectl config <span class="built_in">set</span>-cluster kubernetes --certificate-authority=./ca.pem --embed-certs=<span class="literal">true</span> --server=<span class="variable">$&#123;KUBE_APISERVER&#125;</span> --kubeconfig=./appuser.kubeconfig</span><br><span class="line">  <span class="comment"># Cluster "kubernetes" set.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°</span></span><br><span class="line">kubectl config <span class="built_in">set</span>-credentials appuser \</span><br><span class="line">--client-certificate=./appuser.pem \</span><br><span class="line">--client-key=./appuser-key.pem \</span><br><span class="line">--embed-certs=<span class="literal">true</span> \</span><br><span class="line">--kubeconfig=appuser.kubeconfig</span><br><span class="line">  <span class="comment"># User "appuser" set.</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>(5) åˆ›å»ºapp-managerè§’è‰²å¹¶ä¸”æŒ‡å®šå…¶æƒé™ç„¶åç»‘å®šåˆ°appuserç”¨æˆ·ä¹‹ä¸­;<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class="line">kubectl create namespace app</span><br><span class="line"></span><br><span class="line"><span class="comment"># app-manager è§’è‰²åˆ›å»º</span></span><br><span class="line">tee app-manager-role.yaml &lt;&lt;<span class="string">'END'</span></span><br><span class="line">kind: Role</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  namespace: app</span><br><span class="line">  name: app-manager</span><br><span class="line">rules:</span><br><span class="line">  - apiGroups: [<span class="string">""</span>]   <span class="comment"># "" indicates the core API group</span></span><br><span class="line">    resources: [<span class="string">"pods"</span>,<span class="string">"pods/exec"</span>,<span class="string">"persistentvolumes"</span>,<span class="string">"persistentvolumeclaims"</span>,<span class="string">"services"</span>]</span><br><span class="line">    verbs: [<span class="string">"create"</span>, <span class="string">"delete"</span>, <span class="string">"get"</span>, <span class="string">"list"</span>, <span class="string">"watch"</span>, <span class="string">"patch"</span>, <span class="string">"update"</span>]</span><br><span class="line">  - apiGroups: [<span class="string">"extensions"</span>, <span class="string">"apps"</span>]</span><br><span class="line">    resources: [<span class="string">"deployments"</span>, <span class="string">"statefulsets"</span>]</span><br><span class="line">    verbs: [<span class="string">"create"</span>, <span class="string">"delete"</span>, <span class="string">"get"</span>, <span class="string">"list"</span>, <span class="string">"watch"</span>, <span class="string">"patch"</span>, <span class="string">"update"</span>]</span><br><span class="line">  - apiGroups: [<span class="string">""</span>]</span><br><span class="line">    resources: [<span class="string">"pods/log"</span>,<span class="string">"events"</span>,<span class="string">"nodes"</span>,<span class="string">"endpoint"</span>]</span><br><span class="line">    verbs: [<span class="string">"get"</span>,<span class="string">"list"</span>,<span class="string">"watch"</span>]</span><br><span class="line">  - apiGroups: [<span class="string">""</span>,<span class="string">"extensions"</span>]</span><br><span class="line">    resources: [<span class="string">"configmaps"</span>,<span class="string">"secrets"</span>,<span class="string">"serviceaccounts"</span>]</span><br><span class="line">    verbs: [<span class="string">"create"</span>, <span class="string">"delete"</span>, <span class="string">"get"</span>, <span class="string">"list"</span>, <span class="string">"watch"</span>, <span class="string">"patch"</span>, <span class="string">"update"</span>]</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line"><span class="comment"># appuser ç»‘å®šåˆ° app-manager è§’è‰²</span></span><br><span class="line"><span class="comment"># æ–¹å¼1</span></span><br><span class="line">kubectl create rolebinding app-pods --role=app-manager --user=appuser --namespace=app</span><br><span class="line"><span class="comment"># æ–¹å¼2</span></span><br><span class="line">tee appuser-rolebingding.yaml &lt;&lt;<span class="string">'END'</span></span><br><span class="line">kind: RoleBinding</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: app-pods</span><br><span class="line">  namespace: app</span><br><span class="line">subjects:     <span class="comment"># éœ€è¦ç»‘å®šç”¨æˆ·</span></span><br><span class="line">- kind: User</span><br><span class="line">  name: appuser  </span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">roleRef:      <span class="comment"># ç»‘å®šæŒ‡å®šè§’è‰²</span></span><br><span class="line">  kind: Role</span><br><span class="line">  name: app-manager</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®èµ„æºæ¸…å•åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">~/k8s/certificate$ kubectl apply -f app-manager-role.yaml</span><br><span class="line">  <span class="comment"># role.rbac.authorization.k8s.io/app-manager created</span></span><br><span class="line">~/k8s/certificate$ kubectl apply -f appuser-rolebingding.yaml</span><br><span class="line">  <span class="comment"># rolebinding.rbac.authorization.k8s.io/read-pods created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§’è‰²ä¸ç»‘å®šæŸ¥çœ‹</span></span><br><span class="line">~/k8s/certificate$ kubectl get role -n app app-manager</span><br><span class="line">  <span class="comment"># NAME          CREATED AT</span></span><br><span class="line">  <span class="comment"># app-manager   2021-02-25T09:41:01Z</span></span><br><span class="line"></span><br><span class="line">~/k8s/certificate$ kubectl get rolebindings.rbac.authorization.k8s.io -n app</span><br><span class="line">  <span class="comment"># NAME        ROLE               AGE</span></span><br><span class="line">  <span class="comment"># app-pods   Role/app-manager   4m14s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤ç»‘å®š</span></span><br><span class="line">~/k8s/certificate$ kubectl delete rolebindings.rbac.authorization.k8s.io -n app <span class="built_in">read</span>-pods</span><br><span class="line">rolebinding.rbac.authorization.k8s.io <span class="string">"read-pods"</span> deleted</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br/></p>
<ul>
<li><p>(6) è®¾ç½®ä¸Šä¸‹æ–‡å‚æ•°ä»¥åŠè®¾ç½®å½“å‰ç”¨æˆ·ç¯å¢ƒä¸ºæ–°å»ºçš„ç”¨æˆ·;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸Šä¸‹æ–‡å‚æ•°</span></span><br><span class="line">kubectl config <span class="built_in">set</span>-context kubernetes \</span><br><span class="line">--cluster=kubernetes \</span><br><span class="line">--user=appuser \</span><br><span class="line">--namespace=app \</span><br><span class="line">--kubeconfig=appuser.kubeconfig</span><br><span class="line">  <span class="comment"># Context "kubernetes" created.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å½“å‰ç”¨æˆ·ç¯å¢ƒ</span></span><br><span class="line">~/k8s/certificate$ kubectl config use-context  kubernetes --kubeconfig=appuser.kubeconfig</span><br><span class="line">  <span class="comment"># Switched to context "kubernetes".</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>(7) ä½¿ç”¨<code>appuser.kubeconfig</code>æ–‡ä»¶è¦†ç›–é«˜æƒé™çš„<code>config</code>æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mv <span class="variable">$HOME</span>/.kube/config&#123;,.bak&#125; &amp;&amp; cp appuser.kubeconfig <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘ç°å·²ç»æ²¡æœ‰åˆ«çš„`namespace`çš„æƒé™äº†(åªèƒ½è®¿é—®appåç§°ç©ºé—´ä¸­çš„èµ„æº)ï¼ŒåŒæ—¶ä¹Ÿä¸èƒ½è®¿é—®nodeä¿¡æ¯äº†;</span></span><br><span class="line">~/k8s/certificate$ kubectl get node</span><br><span class="line">  <span class="comment"># Error from server (Forbidden): nodes is forbidden: User "appuser" cannot list resource "nodes" in API group "" at the cluster scope</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é»˜è®¤æ˜¯åœ¨ app çš„åç§°ç©ºé—´ä¸­æŸ¥è¯¢èµ„æº</span></span><br><span class="line">~/k8s/certificate$ kubectl get pod</span><br><span class="line">  <span class="comment"># No resources found in app namespace.</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>(8) å®¢æˆ·ç«¯é…ç½®ä¸€è§ˆ(åˆ‡æ¢ä¸Šä¸‹æ–‡å‰å)å¯¹æ¯”</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡æ¢è¦†ç›–.kube/configå‰</span></span><br><span class="line">/k8s/certificate$ kubectl config view</span><br><span class="line">apiVersion: v1</span><br><span class="line">clusters:</span><br><span class="line">- cluster:</span><br><span class="line">    certificate-authority-data: DATA+OMITTED</span><br><span class="line">    server: https://weiyigeek-lb-vip.k8s:16443</span><br><span class="line">  name: kubernetes</span><br><span class="line">contexts:</span><br><span class="line">- context:</span><br><span class="line">    cluster: kubernetes</span><br><span class="line">    user: kubernetes-admin</span><br><span class="line">  name: kubernetes-admin@kubernetes</span><br><span class="line">current-context: kubernetes-admin@kubernetes</span><br><span class="line">kind: Config</span><br><span class="line">preferences: &#123;&#125;</span><br><span class="line">users:</span><br><span class="line">- name: kubernetes-admin  <span class="comment"># ç”¨æˆ·ä¸åŒ</span></span><br><span class="line">  user:</span><br><span class="line">    client-certificate-data: REDACTED</span><br><span class="line">    client-key-data: REDACTED</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢è¦†ç›–.kube/configå</span></span><br><span class="line">~/k8s/certificate$ kubectl config view</span><br><span class="line">apiVersion: v1</span><br><span class="line">clusters:</span><br><span class="line">- cluster:</span><br><span class="line">    certificate-authority-data: DATA+OMITTED</span><br><span class="line">    server: https://192.168.12.110:16443</span><br><span class="line">  name: kubernetes</span><br><span class="line">contexts:</span><br><span class="line">- context:</span><br><span class="line">    cluster: kubernetes  <span class="comment"># é›†ç¾¤åç§°</span></span><br><span class="line">    namespace: app       <span class="comment"># æ³¨æ„åç§°ç©ºé—´</span></span><br><span class="line">    user: appuser        <span class="comment"># ç”¨æˆ·</span></span><br><span class="line">  name: kubernetes       <span class="comment"># ä¸Šä¸‹æ–‡åç§°</span></span><br><span class="line">current-context: kubernetes  <span class="comment"># å½“å‰ä¸Šä¸‹æ–‡</span></span><br><span class="line">kind: Config</span><br><span class="line">preferences: &#123;&#125;</span><br><span class="line">users:</span><br><span class="line">- name: appuser</span><br><span class="line">  user:</span><br><span class="line">    client-certificate-data: REDACTED</span><br><span class="line">    client-key-data: REDACTED</span><br></pre></td></tr></table></figure>
<ul>
<li>(9) é‡‡ç”¨appuserç”¨æˆ·è¿›è¡ŒPodçš„åˆ›å»ºé»˜è®¤åœ¨appåç§°ç©ºé—´ä¹‹ä¸­;</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/.kube$ kubectl run nginx --image nginx:latest --port=80</span><br><span class="line">  <span class="comment"># pod/nginx created</span></span><br></pre></td></tr></table></figure>
<ul>
<li>(10) ç»“æœéªŒè¯ä¸æŸ¥çœ‹æœ€ååˆ é™¤Pod</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">~/.kube$ kubectl get pod -o wide --show-labels</span><br><span class="line">  <span class="comment"># NAME    READY   STATUS    RESTARTS   AGE     IP              NODE       NOMINATED NODE   READINESS GATES   LABELS</span></span><br><span class="line">  <span class="comment"># nginx   1/1     Running   0          2m12s   172.16.24.238   weiyigeek-223   &lt;none&gt;           &lt;none&gt;            run=nginx</span></span><br><span class="line"></span><br><span class="line">~/.kube$ kubectl describe pods nginx</span><br><span class="line">  <span class="comment"># Name:         nginx</span></span><br><span class="line">  <span class="comment"># Namespace:    app</span></span><br><span class="line">  <span class="comment"># Priority:     0</span></span><br><span class="line">  <span class="comment"># Node:         weiyigeek-223/192.168.12.223</span></span><br><span class="line">  <span class="comment"># Start Time:   Thu, 25 Feb 2021 15:11:47 +0000</span></span><br><span class="line">  <span class="comment"># Labels:       run=nginx</span></span><br><span class="line">  <span class="comment"># Annotations:  &lt;none&gt;</span></span><br><span class="line">  <span class="comment"># Status:       Running</span></span><br><span class="line">  <span class="comment"># IP:           172.16.24.238</span></span><br><span class="line"></span><br><span class="line">~/.kube$ kubectl delete pod nginx</span><br><span class="line">pod <span class="string">"nginx"</span> deleted</span><br></pre></td></tr></table></figure>
<p><br/></p>
<h4 id="å®éªŒ3-é›†ç¾¤ç®¡ç†å‘˜ç”¨æˆ·æƒé™ä¸€è§ˆ"><a href="#å®éªŒ3-é›†ç¾¤ç®¡ç†å‘˜ç”¨æˆ·æƒé™ä¸€è§ˆ" class="headerlink" title="å®éªŒ3.é›†ç¾¤ç®¡ç†å‘˜ç”¨æˆ·æƒé™ä¸€è§ˆ"></a>å®éªŒ3.é›†ç¾¤ç®¡ç†å‘˜ç”¨æˆ·æƒé™ä¸€è§ˆ</h4><p>æè¿°: å¯é€šè¿‡kubectlå‘½ä»¤è¡Œè·å–k8sé›†ç¾¤adminç”¨æˆ·çš„æƒé™ä¿¡æ¯;</p>
<p>cluster-admin ç”¨æˆ·æƒé™ä¿¡æ¯ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">~/.kube$ kubectl get clusterrole -n kube-system cluster-admin -o yaml</span><br><span class="line">  <span class="comment"># apiVersion: rbac.authorization.k8s.io/v1</span></span><br><span class="line">  <span class="comment"># kind: ClusterRole</span></span><br><span class="line">  <span class="comment"># metadata:</span></span><br><span class="line">  <span class="comment">#   annotations:</span></span><br><span class="line">  <span class="comment">#     rbac.authorization.kubernetes.io/autoupdate: "true"</span></span><br><span class="line">  <span class="comment">#   creationTimestamp: "2021-01-11T04:55:10Z"</span></span><br><span class="line">  <span class="comment">#   labels:</span></span><br><span class="line">  <span class="comment">#     kubernetes.io/bootstrapping: rbac-defaults</span></span><br><span class="line">  <span class="comment">#   managedFields:</span></span><br><span class="line">  <span class="comment">#   - apiVersion: rbac.authorization.k8s.io/v1</span></span><br><span class="line">  <span class="comment">#     fieldsType: FieldsV1</span></span><br><span class="line">  <span class="comment">#     fieldsV1:</span></span><br><span class="line">  <span class="comment">#       f:metadata:</span></span><br><span class="line">  <span class="comment">#         f:annotations:</span></span><br><span class="line">  <span class="comment">#           .: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#           f:rbac.authorization.kubernetes.io/autoupdate: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#         f:labels:</span></span><br><span class="line">  <span class="comment">#           .: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#           f:kubernetes.io/bootstrapping: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#       f:rules: &#123;&#125;</span></span><br><span class="line">  <span class="comment">#     manager: kube-apiserver</span></span><br><span class="line">  <span class="comment">#     operation: Update</span></span><br><span class="line">  <span class="comment">#     time: "2021-01-11T04:55:10Z"</span></span><br><span class="line">  <span class="comment">#   name: cluster-admin</span></span><br><span class="line">  <span class="comment">#   resourceVersion: "43"</span></span><br><span class="line">  <span class="comment">#   selfLink: /apis/rbac.authorization.k8s.io/v1/clusterroles/cluster-admin</span></span><br><span class="line">  <span class="comment">#   uid: 482f7aff-729f-4ddb-9f1c-babc27bf51e9</span></span><br><span class="line">  <span class="comment"># rules:  # å…³é”®ç‚¹</span></span><br><span class="line">  <span class="comment"># - apiGroups:</span></span><br><span class="line">  <span class="comment">#   - '*'</span></span><br><span class="line">  <span class="comment">#   resources:</span></span><br><span class="line">  <span class="comment">#   - '*'</span></span><br><span class="line">  <span class="comment">#   verbs:</span></span><br><span class="line">  <span class="comment">#   - '*'</span></span><br><span class="line">  <span class="comment"># - nonResourceURLs:</span></span><br><span class="line">  <span class="comment">#   - '*'</span></span><br><span class="line">  <span class="comment">#   verbs:</span></span><br><span class="line">  <span class="comment">#   - '*'</span></span><br></pre></td></tr></table></figure></p>
<p><br/></p>
<p><strong>admin ç”¨æˆ·æƒé™ä¸€è§ˆ(åç»­å¯ä»¥å¤‡ç”¨æŸ¥è¡¨):</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br></pre></td><td class="code"><pre><span class="line">~/.kube$ kubectl get clusterrole -n kube-system admin -o yaml</span><br><span class="line">aggregationRule:</span><br><span class="line">  clusterRoleSelectors:</span><br><span class="line">  - matchLabels:</span><br><span class="line">      rbac.authorization.k8s.io/aggregate-to-admin: <span class="string">"true"</span></span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRole</span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    rbac.authorization.kubernetes.io/autoupdate: <span class="string">"true"</span></span><br><span class="line">  creationTimestamp: <span class="string">"2021-01-11T04:55:10Z"</span></span><br><span class="line">  labels:</span><br><span class="line">    kubernetes.io/bootstrapping: rbac-defaults</span><br><span class="line">  managedFields:</span><br><span class="line">  - apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">    fieldsType: FieldsV1</span><br><span class="line">    fieldsV1:</span><br><span class="line">      f:aggregationRule:</span><br><span class="line">        .: &#123;&#125;</span><br><span class="line">        f:clusterRoleSelectors: &#123;&#125;</span><br><span class="line">      f:metadata:</span><br><span class="line">        f:annotations:</span><br><span class="line">          .: &#123;&#125;</span><br><span class="line">          f:rbac.authorization.kubernetes.io/autoupdate: &#123;&#125;</span><br><span class="line">        f:labels:</span><br><span class="line">          .: &#123;&#125;</span><br><span class="line">          f:kubernetes.io/bootstrapping: &#123;&#125;</span><br><span class="line">    manager: kube-apiserver</span><br><span class="line">    operation: Update</span><br><span class="line">    time: <span class="string">"2021-01-11T04:55:10Z"</span></span><br><span class="line">  - apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">    fieldsType: FieldsV1</span><br><span class="line">    fieldsV1:</span><br><span class="line">      f:rules: &#123;&#125;</span><br><span class="line">    manager: kube-controller-manager</span><br><span class="line">    operation: Update</span><br><span class="line">    time: <span class="string">"2021-01-11T04:55:29Z"</span></span><br><span class="line">  name: admin</span><br><span class="line">  resourceVersion: <span class="string">"366"</span></span><br><span class="line">  selfLink: /apis/rbac.authorization.k8s.io/v1/clusterroles/admin</span><br><span class="line">  uid: 3ea3152e-8e95-4bbc-93b7-8e7aa793270e</span><br><span class="line">rules:</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">""</span></span><br><span class="line">  resources:</span><br><span class="line">  - pods/attach</span><br><span class="line">  - pods/<span class="built_in">exec</span></span><br><span class="line">  - pods/portforward</span><br><span class="line">  - pods/proxy</span><br><span class="line">  - secrets</span><br><span class="line">  - services/proxy</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">""</span></span><br><span class="line">  resources:</span><br><span class="line">  - serviceaccounts</span><br><span class="line">  verbs:</span><br><span class="line">  - impersonate</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">""</span></span><br><span class="line">  resources:</span><br><span class="line">  - pods</span><br><span class="line">  - pods/attach</span><br><span class="line">  - pods/<span class="built_in">exec</span></span><br><span class="line">  - pods/portforward</span><br><span class="line">  - pods/proxy</span><br><span class="line">  verbs:</span><br><span class="line">  - create</span><br><span class="line">  - delete</span><br><span class="line">  - deletecollection</span><br><span class="line">  - patch</span><br><span class="line">  - update</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">""</span></span><br><span class="line">  resources:</span><br><span class="line">  - configmaps</span><br><span class="line">  - endpoints</span><br><span class="line">  - persistentvolumeclaims</span><br><span class="line">  - replicationcontrollers</span><br><span class="line">  - replicationcontrollers/scale</span><br><span class="line">  - secrets</span><br><span class="line">  - serviceaccounts</span><br><span class="line">  - services</span><br><span class="line">  - services/proxy</span><br><span class="line">  verbs:</span><br><span class="line">  - create</span><br><span class="line">  - delete</span><br><span class="line">  - deletecollection</span><br><span class="line">  - patch</span><br><span class="line">  - update</span><br><span class="line">- apiGroups:</span><br><span class="line">  - apps</span><br><span class="line">  resources:</span><br><span class="line">  - daemonsets</span><br><span class="line">  - deployments</span><br><span class="line">  - deployments/rollback</span><br><span class="line">  - deployments/scale</span><br><span class="line">  - replicasets</span><br><span class="line">  - replicasets/scale</span><br><span class="line">  - statefulsets</span><br><span class="line">  - statefulsets/scale</span><br><span class="line">  verbs:</span><br><span class="line">  - create</span><br><span class="line">  - delete</span><br><span class="line">  - deletecollection</span><br><span class="line">  - patch</span><br><span class="line">  - update</span><br><span class="line">- apiGroups:</span><br><span class="line">  - autoscaling</span><br><span class="line">  resources:</span><br><span class="line">  - horizontalpodautoscalers</span><br><span class="line">  verbs:</span><br><span class="line">  - create</span><br><span class="line">  - delete</span><br><span class="line">  - deletecollection</span><br><span class="line">  - patch</span><br><span class="line">  - update</span><br><span class="line">- apiGroups:</span><br><span class="line">  - batch</span><br><span class="line">  resources:</span><br><span class="line">  - cronjobs</span><br><span class="line">  - <span class="built_in">jobs</span></span><br><span class="line">  verbs:</span><br><span class="line">  - create</span><br><span class="line">  - delete</span><br><span class="line">  - deletecollection</span><br><span class="line">  - patch</span><br><span class="line">  - update</span><br><span class="line">- apiGroups:</span><br><span class="line">  - extensions</span><br><span class="line">  resources:</span><br><span class="line">  - daemonsets</span><br><span class="line">  - deployments</span><br><span class="line">  - deployments/rollback</span><br><span class="line">  - deployments/scale</span><br><span class="line">  - ingresses</span><br><span class="line">  - networkpolicies</span><br><span class="line">  - replicasets</span><br><span class="line">  - replicasets/scale</span><br><span class="line">  - replicationcontrollers/scale</span><br><span class="line">  verbs:</span><br><span class="line">  - create</span><br><span class="line">  - delete</span><br><span class="line">  - deletecollection</span><br><span class="line">  - patch</span><br><span class="line">  - update</span><br><span class="line">- apiGroups:</span><br><span class="line">  - policy</span><br><span class="line">  resources:</span><br><span class="line">  - poddisruptionbudgets</span><br><span class="line">  verbs:</span><br><span class="line">  - create</span><br><span class="line">  - delete</span><br><span class="line">  - deletecollection</span><br><span class="line">  - patch</span><br><span class="line">  - update</span><br><span class="line">- apiGroups:</span><br><span class="line">  - networking.k8s.io</span><br><span class="line">  resources:</span><br><span class="line">  - ingresses</span><br><span class="line">  - networkpolicies</span><br><span class="line">  verbs:</span><br><span class="line">  - create</span><br><span class="line">  - delete</span><br><span class="line">  - deletecollection</span><br><span class="line">  - patch</span><br><span class="line">  - update</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">""</span></span><br><span class="line">  resources:</span><br><span class="line">  - configmaps</span><br><span class="line">  - endpoints</span><br><span class="line">  - persistentvolumeclaims</span><br><span class="line">  - persistentvolumeclaims/status</span><br><span class="line">  - pods</span><br><span class="line">  - replicationcontrollers</span><br><span class="line">  - replicationcontrollers/scale</span><br><span class="line">  - serviceaccounts</span><br><span class="line">  - services</span><br><span class="line">  - services/status</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">""</span></span><br><span class="line">  resources:</span><br><span class="line">  - bindings</span><br><span class="line">  - events</span><br><span class="line">  - limitranges</span><br><span class="line">  - namespaces/status</span><br><span class="line">  - pods/<span class="built_in">log</span></span><br><span class="line">  - pods/status</span><br><span class="line">  - replicationcontrollers/status</span><br><span class="line">  - resourcequotas</span><br><span class="line">  - resourcequotas/status</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">""</span></span><br><span class="line">  resources:</span><br><span class="line">  - namespaces</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - apps</span><br><span class="line">  resources:</span><br><span class="line">  - controllerrevisions</span><br><span class="line">  - daemonsets</span><br><span class="line">  - daemonsets/status</span><br><span class="line">  - deployments</span><br><span class="line">  - deployments/scale</span><br><span class="line">  - deployments/status</span><br><span class="line">  - replicasets</span><br><span class="line">  - replicasets/scale</span><br><span class="line">  - replicasets/status</span><br><span class="line">  - statefulsets</span><br><span class="line">  - statefulsets/scale</span><br><span class="line">  - statefulsets/status</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - autoscaling</span><br><span class="line">  resources:</span><br><span class="line">  - horizontalpodautoscalers</span><br><span class="line">  - horizontalpodautoscalers/status</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - batch</span><br><span class="line">  resources:</span><br><span class="line">  - cronjobs</span><br><span class="line">  - cronjobs/status</span><br><span class="line">  - <span class="built_in">jobs</span></span><br><span class="line">  - <span class="built_in">jobs</span>/status</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - extensions</span><br><span class="line">  resources:</span><br><span class="line">  - daemonsets</span><br><span class="line">  - daemonsets/status</span><br><span class="line">  - deployments</span><br><span class="line">  - deployments/scale</span><br><span class="line">  - deployments/status</span><br><span class="line">  - ingresses</span><br><span class="line">  - ingresses/status</span><br><span class="line">  - networkpolicies</span><br><span class="line">  - replicasets</span><br><span class="line">  - replicasets/scale</span><br><span class="line">  - replicasets/status</span><br><span class="line">  - replicationcontrollers/scale</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - policy</span><br><span class="line">  resources:</span><br><span class="line">  - poddisruptionbudgets</span><br><span class="line">  - poddisruptionbudgets/status</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - networking.k8s.io</span><br><span class="line">  resources:</span><br><span class="line">  - ingresses</span><br><span class="line">  - ingresses/status</span><br><span class="line">  - networkpolicies</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - authorization.k8s.io</span><br><span class="line">  resources:</span><br><span class="line">  - localsubjectaccessreviews</span><br><span class="line">  verbs:</span><br><span class="line">  - create</span><br><span class="line">- apiGroups:</span><br><span class="line">  - rbac.authorization.k8s.io</span><br><span class="line">  resources:</span><br><span class="line">  - rolebindings</span><br><span class="line">  - roles</span><br><span class="line">  verbs:</span><br><span class="line">  - create</span><br><span class="line">  - delete</span><br><span class="line">  - deletecollection</span><br><span class="line">  - get</span><br><span class="line">  - list</span><br><span class="line">  - patch</span><br><span class="line">  - update</span><br><span class="line">  - watch</span><br></pre></td></tr></table></figure></p>

        </div>

         
          <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-9134434519967436" data-ad-slot="7905848205"></ins>
        
  
        
  <hr>
  <p> æ¬¢è¿å„ä½å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œå¦‚æ–‡ç« æœ‰è¯¯è¯·åœ¨ä¸‹æ–¹ç•™ä¸‹æ‚¨å®è´µçš„ç»éªŒçŸ¥è¯†ï¼Œä¸ªäººé‚®ç®±åœ°å€<b style="color:#ff654e"><code>ã€master#weiyigeek.topã€‘</code></b>æˆ–è€…ä¸ªäººå…¬ä¼—å·<b style="color:#ff654e"><code>ã€WeiyiGeekã€‘</code></b>è”ç³»æˆ‘ã€‚ </p>

  <p> æ›´å¤šæ–‡ç« æ¥æºäº<b style="color:#03a9f4">ã€WeiyiGeek Blog - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘ã€‘</b>, ä¸ªäººé¦–é¡µåœ°å€( <a style="color: #03a9f4;" href="https://weiyigeek.top" target="_blank"> https://weiyigeek.top </a> )</p>

  <p>ä¸“æ ä¹¦å†™ä¸æ˜“ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªä¸“æ è¿˜ä¸é”™çš„ï¼Œè¯·ç»™è¿™ç¯‡ä¸“æ  <b style="color: red;">ã€ç‚¹ä¸ªèµã€æŠ•ä¸ªå¸ã€æ”¶ä¸ªè—ã€å…³ä¸ªæ³¨ï¼Œè½¬ä¸ªå‘ã€‘(äººé—´äº”å¤§æƒ…)</b>ï¼Œè¿™å°†å¯¹æˆ‘çš„è‚¯å®šï¼Œè°¢è°¢ï¼ã€‚</p>

  <div>
    <img src="https://www.weiyigeek.top/img/weiyigeek.jpg" class="img-responsive" alt="WeiyiGeek-banner">
  </div>

  <ul style="font-weight: bolder;">
    <li>
      <p><span style="color: #03a9f4">echo&nbsp;&nbsp;"ã€ç‚¹ä¸ªèµã€‘ï¼ŒåŠ¨åŠ¨ä½ é‚£ç²—å£®çš„æ‹‡æŒ‡æˆ–è€…èŠŠèŠŠç‰æ‰‹ï¼Œäº²ï¼"</span></p>
    </li>
    <li>
      <p><span style="color: #ff9201">printf("%s",&nbsp;"ã€æŠ•ä¸ªå¸ã€‘ï¼Œä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼ŒæŠ•ä¸ªç¡¬å¸è¡Œä¸è¡Œï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #02a2ff">fmt.Printf("ã€æ”¶ä¸ªè—ã€‘ï¼Œé˜…åå³ç„šä¸åƒç°ï¼Œäº²ï¼")&nbsp;&nbsp;</span></p>
    </li>
    <li>
      <p><span style="color:red">console.info("ã€è½¬ä¸ªå‘ã€‘ï¼Œè®©æ›´å¤šçš„å¿—åŒé“åˆçš„æœ‹å‹ä¸€èµ·å­¦ä¹ äº¤æµï¼Œäº²ï¼")</span></p>
    </li>
    <li>
      <p><span style="color: #ff654e">System.out.println("ã€å…³ä¸ªæ³¨ã€‘ï¼Œåç»­æµè§ˆæŸ¥çœ‹ä¸è¿·è·¯å“Ÿï¼Œäº²ï¼")</span></p>
    </li>
  </ul>

  <div>
    <img src="/img/wechat-search.png" class="img-responsive" alt="æ‰«æFollow(å…³æ³¨)WeiyiGeekå…¬ä¼—å·"  width="380" height="170">
    <img src="/img/wechat-app.png" class="img-responsive" alt="æ‰«æVisit(æµè§ˆ)æå®¢å…¨æ ˆä¿®ç‚¼å°ç¨‹åº"  width="385" height="170">
  </div>
  <hr>
  

  <blockquote class="post-copyright">
    <div class="content">
      
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2022-03-29T05:39:03.675Z" itemprop="dateUpdated">2022-03-29 13:39:03</time>
</span><br>


        <span>æ–‡ç« åŸå§‹è·¯å¾„ï¼š<a href="https://github.com/WeiyiGeek/blog/edit/master/source/_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç».md" target="_blank" rel="noopener noreferrer">_posts/è™šæ‹Ÿäº‘å®¹/äº‘å®¹å™¨/Kubernetes/9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç».md</a></span><br>
         <span class="copy-copyright">è½¬è½½æ³¨æ˜å‡ºå¤„ï¼ŒåŸæ–‡åœ°å€ï¼š<a href="/2020/10-27-535.html" target="_blank" rel="external">https://blog.weiyigeek.top/2020/10-27-535.html</a></span><br>æœ¬ç«™æ–‡ç« å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a> 
    </div>
    <footer>
      <a href="https://blog.weiyigeek.top">
        <img src="/img/avatar.jpg" alt="WeiyiGeek">
        WeiyiGeek
      </a>
    </footer>
  </blockquote>


        
            <div class="page-reward">
  <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-rectangle waves-light">ğŸ‘ é’Ÿæ„ä½œè€…</a>
</div>
            
        
        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/10-27-535.html&title=ã€Š9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç»ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/10-27-535.html&title=ã€Š9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç»ã€‹ â€” WeiyiGeek Blog&source=WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ª..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/10-27-535.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç»ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/10-27-535.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/10-27-535.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
          <!-- è¯„è®ºç»„ä»¶ -->


<div id="gitalk-container"></div>
<script type="text/javascript" src="/js/plugins/gitalk.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/custom/gitalk.init.js?v=1.6.6"></script>
        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2020/10-27-532.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">8-Kuberneteså…¥é—¨åŸºç¡€ä¹‹è°ƒåº¦å™¨ä¸äº²å’Œæ€§ä»‹ç»</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2020/10-13-585.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Linuxä¸WindowsæœåŠ¡å™¨æ“ä½œç³»ç»Ÿå®‰å…¨é˜²å¾¡å®è·µæŒ‡å—</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>ç›®å½•</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Security-é›†ç¾¤å®‰å…¨"><span class="post-toc-number">1.</span> <span class="post-toc-text">Security - é›†ç¾¤å®‰å…¨</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-Authenticationï¼ˆè®¤è¯ï¼‰"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">1) Authenticationï¼ˆè®¤è¯ï¼‰</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#è®¤è¯æ–‡ä»¶"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">è®¤è¯æ–‡ä»¶</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-Authorizationï¼ˆé‰´æƒï¼‰"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">2) Authorizationï¼ˆé‰´æƒï¼‰</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ä½¿ç”¨-RBAC-é‰´æƒ"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">ä½¿ç”¨ - RBAC - é‰´æƒ</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-Admission-Control-å‡†å…¥æ§åˆ¶"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">3) Admission Control (å‡†å…¥æ§åˆ¶)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-ä¸Šä¸‹æ–‡ç¯å¢ƒ"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">4) ä¸Šä¸‹æ–‡ç¯å¢ƒ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-åŸºç¡€å®è·µ"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">5) åŸºç¡€å®è·µ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#å®éªŒ1-é…ç½®è¯ä¹¦-ä¸-Api-Server-è®¤è¯è®¿é—®"><span class="post-toc-number">1.5.1.</span> <span class="post-toc-text">å®éªŒ1.é…ç½®è¯ä¹¦ ä¸ Api-Server è®¤è¯è®¿é—®</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#å®éªŒ2-åˆ›å»ºæ™®é€šç”¨æˆ·è¿›è¡Œå¯¹Kubernetesé›†ç¾¤çš„ç®¡ç†"><span class="post-toc-number">1.5.2.</span> <span class="post-toc-text">å®éªŒ2.åˆ›å»ºæ™®é€šç”¨æˆ·è¿›è¡Œå¯¹Kubernetesé›†ç¾¤çš„ç®¡ç†</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#å®éªŒ3-é›†ç¾¤ç®¡ç†å‘˜ç”¨æˆ·æƒé™ä¸€è§ˆ"><span class="post-toc-number">1.5.3.</span> <span class="post-toc-text">å®éªŒ3.é›†ç¾¤ç®¡ç†å‘˜ç”¨æˆ·æƒé™ä¸€è§ˆ</span></a></li></ol></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    


    <!-- æ”¯ä»˜å®å¾®ä¿¡æ–‡ç« èµèµ -->
    
      <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        å¦‚æœæ­¤ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¿˜è¯·æ”¯æŒä¸€ä¸‹åšä¸»å“Ÿ, è°¢è°¢å„ä½çœ‹å‹â™¥!
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardwechat" src="/img/reward-wechat.jpg" height="250" height="250" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
            <img id="rewardalipay" src="/img/reward-alipay.png" height="250" height="250" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
        </div>
        
        <label class="reward-toggle">
            <!-- <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.png"> -->
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">å¾®ä¿¡</span>
                <span class="reward-toggle-item alipay">æ”¯ä»˜å®</span>
            </div>
        </label>
        
    </div>
</div>

      

    <!-- å¾®ä¿¡å…¬ä¼—å·å…³æ³¨/æ–‡ç« ç‰ˆæƒå¤åˆ¶ -->
    
      <div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0); display:none"></div>
<div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;display:none">
<span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 1.8; font-size: 15px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">X</span>
<p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px; ">
<b style="color:#6190e8;">ä½ å¥½æœ‹å‹,å¯ä»¥å…³ä¸ªæ³¨å—? â¤ <br> è¿™å°†æ˜¯æˆ‘æŒç»­æ›´æ–°æ–‡ç« çš„åŠ¨åŠ›æºæ³‰ï¼Œè°¢è°¢æ”¯æŒï¼(à¹‘â€²á´—â€µà¹‘) </b> <br> å¦‚ä¸æƒ³å…³æ³¨è¯·ç‚¹å‡»å³ä¸Šè§’çš„ã€Xã€‘<br>
<br>Method 1.Please visit <strong><a href="https://twitter.com/WeiyiGeek" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€My Twitterã€‘</a></strong>. There is an article verification code in the homepage.
<br>æ–¹å¼2.è¯·è®¿é—®æœ¬åšä¸»çš„Bç«™<strong><a href="https://space.bilibili.com/385802642" target="_blank" rel="noopener" style="color: rgb(240, 65, 52);text-decoration:underline;">ã€WeiyiGeekã€‘</a></strong>é¦–é¡µå…³æ³¨UPä¸»,<br>å°†è‡ªåŠ¨éšæœºè·å–è§£é”éªŒè¯ç ã€‚
<br>æ–¹å¼3.æ‰«ä¸€æ‰«ä¸‹æ–¹äºŒç»´ç ï¼Œå…³æ³¨æœ¬ç«™<strong>å®˜æ–¹å…¬ä¼—å·</strong><br>
å›å¤ï¼š<strong style="color: rgb(240, 65, 52);">éªŒè¯ç </strong>
å°†è·å–<strong style="color: rgb(240, 65, 52);">è§£é”(æœ‰æ•ˆæœŸ7å¤©)</strong>æœ¬ç«™æ‰€æœ‰æŠ€æœ¯æ–‡ç« å“Ÿ!</p>
<img src="/img/wechat-search.png" style="width: 300px; margin-top: 10px;">
<div id="btw-modal-input-code" style="margin-top: 20px; background: rgb(255, 255, 255);">
  <input id="btw-modal-input" type="number" minlength="4" maxlength="4" placeholder="è¯·è¾“å…¥éªŒè¯ç |Verification Code"
    style="width: 165px; height: 32px; line-height: 32px; padding: 0px 10px; margin: 0px 10px; font-size: 13px; text-rendering: auto; text-transform: none; cursor: text; outline: none; box-sizing: border-box; border: 1px solid rgb(221, 221, 221); -webkit-appearance: textfield; background-color: white; -webkit-rtl-ordering: logical;"/>
  <button id="btw-submit-btn" onclick="yzm_vertify()"
    style="padding: 0px 20px; height: 32px; font-size: 14px; outline: none; border: none; color: rgb(255, 255, 255); background: rgb(222, 104, 109); cursor: pointer;">æ
    äº¤</button> </div>
<p id="btw-footer" style="margin: 40px 0px 20px; color: rgb(153, 153, 153);">@WeiyiGeek - ä¸ºäº†èƒ½åˆ°è¿œæ–¹ï¼Œè„šä¸‹çš„æ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘</p>
</div>
        
</article>
</div>

    </main>
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9134434519967436" data-ad-slot="3629930963" data-ad-format="auto" data-full-width-responsive="true"></ins>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Linksï¼š</span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top" target="_blank">https://weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.weiyigeek.top" target="_blank">https://blog.weiyigeek.top</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weiyigeek.top/img/wechat-search.png" target="_blank">å…¬ä¼—è´¦å·</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://space.bilibili.com/385802642/article" target="_blank">å“”å“©å“”å“©ä¸“æ </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://github.com/weiyigeek" target="_blank">ä¸ªäººGithub</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://gitee.com/WeiyiGeek" target="_blank">ä¸ªäººGitee</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.zhihu.com/people/weiyiSec" target="_blank">ä¸ªäººçŸ¥ä¹</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.cnblogs.com/WeiyiGeek" target="_blank">åšå®¢å›­</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://my.oschina.net/weiyigeek" target="_blank">OSCHINA</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAAqcPSoMqfctaEqJpGSF775eeCjWkrop4AOyLITdMx-L78F5iXzfQcSRM5sY4dq3wR" target="_blank">ä»Šæ—¥å¤´æ¡</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.csdn.net/u013072756?type=lately" target="_blank">CSDN</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.jianshu.com/u/5199a1104739" target="_blank">ç®€ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cloud.tencent.com/developer/user/1389665/articles" target="_blank">è…¾è®¯äº‘+äº‘ç¤¾åŒº</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://cuttlefish.baidu.com/shop/75c5dbd8d15abe23482f4d40" target="_blank">ç™¾åº¦æ–‡åº“</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://author.baidu.com/home?from=blog&app_id=1726736601523415" target="_blank">ITæå®¢çŸ¥è¯†åˆ†äº«</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://blog.51cto.com/weiyigeek" target="_blank">51CTOåšå®¢</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://juejin.cn/user/122767337595934" target="_blank">æ˜é‡‘</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://weibo.com/a/hot/7622022703618049_1.html" target="_blank">å¾®åšæ–‡ç« </a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.xiaohongshu.com/user/profile/627c98bb000000001000e7ba" target="_blank">å°çº¢ä¹¦</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://segmentfault.com/u/weiyigeek" target="_blank">Segmentfault</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.douyin.com/user/MS4wLjABAAAAMSBdMja6XLsdmzafb0RNbFeBemIOk38K1PaOClZeI1Q" target="_blank">æŠ–éŸ³ä¸»é¡µ</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kuaishou.com/profile/3xfbrsrhd2i69x9" target="_blank">å¿«æ‰‹ä¸»é¡µ</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
      <p>
        <span>WeiyiGeek &copy; 2018 - 2022 <a href="https://weiyigeek.top" target="_blank" rel="noopener">weiyigeek.top</a> All rights reserved.å”¯ä¸€æå®¢ITçŸ¥è¯†åˆ†äº« ç‰ˆæƒæ‰€æœ‰ </span>
        
        <span>
          Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/weiyigeek" target="_blank">mellow</a>
        </span>
        
        <br/>è®¿é—®ç»Ÿè®¡
        <span><a href="/sitemap.xml" target="_blank" rel="Sitemaps-ç«™ç‚¹åœ°å›¾">Sitemaps</a> </span>
        <span><a href="/baidusitemap.xml" target="_blank" rel="baidusitemaps-ç™¾åº¦ç«™ç‚¹åœ°å›¾">ç«™ç‚¹åœ°å›¾</a> </span>
        <!-- 
  -->
        <br/>ICPå¤‡æ¡ˆå·<span><a href="https://beian.miit.gov.cn" target="_blank">æ¸ICPå¤‡2022003447å·</a></span>
        <br/>
        <div id="cc-myssl-id">
          <a href="https://myssl.com/blog.weiyigeek.top?from=mysslid" target="_blank" rel="noopener"><img src="https://static.myssl.com/res/images/myssl-id1.png" alt="MySSLå®‰å…¨è®¤è¯" style="max-height:50px;display:block;margin:0 auto"></a>
        </div>
      </p>
    </div>
</footer>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://blog.weiyigeek.top/2020/10-27-535.html&title=ã€Š9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç»ã€‹ â€” WeiyiGeek Blog&pic=https://blog.weiyigeek.top/img/avatar.jpg" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.weiyigeek.top/2020/10-27-535.html&title=ã€Š9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç»ã€‹ â€” WeiyiGeek Blog&source=WeiyiGeek-å”¯ä¸€æå®¢åšå®¢ç«™ç‚¹,å…³æ³¨äºç½‘ç»œå®‰å…¨è¿ç»´,Webå®‰å…¨å¼€å‘,IOTç‰©è”ç½‘å®‰å…¨å¼€å‘,åº”ç”¨å¼€å‘,åˆ†äº«æŠ€æœ¯å­¦ä¹ çŸ¥è¯†ä¸å…¥å‘è§£å†³,æå‡ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸è‡ª..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.weiyigeek.top/2020/10-27-535.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Š9-Kuberneteså…¥é—¨åŸºç¡€ä¹‹é›†ç¾¤å®‰å…¨ä»‹ç»ã€‹ â€” WeiyiGeek Blog&url=https://blog.weiyigeek.top/2020/10-27-535.html&via=https://blog.weiyigeek.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://blog.weiyigeek.top/2020/10-27-535.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACKUlEQVR42u3awW6DMBAE0Pz/T7fXShUwY0NV7McpSgnxy2Hr3fHnE19fv66f78/cc3R9nrgwMDBey0ged7SU5Jnn7ySvIyoGBsYGjKOlHN2Tg5PvSqgXz8HAwMA4vWfsSqgYGBgYLeN8U5gvMd90YmBgYLRNbNJMJtS8uD/Si2NgYLyQkU/d//71I/kGBgbGqxgzbWdblGcK+sUTMDAwlmbMRJht25nHCYMbTQwMjEUZ+fhssAhOB5nJnRgYGHsy2lgx2fC1hbWIEDAwMJZmzASZydA/b1zHhm4YGBi7MfLy91z+0P4QRWCAgYHxckbeyuZNaXIII39y9PNhYGAsypgfk7UNbTuAi1aIgYGxDWOscW0DznzDV5RmDAyMDRjt0C2PIe/6aS6KLwYGxjaMmSMU7eu2sEZdOAYGxqKMseMU7aA/jxnyco+BgbEb44myOxZbthtQDAyMHRhtJJC0nfMHNdrDZxgYGGsz8q+fiRvzojwWKmBgYOzGaN9pG+D2uFgRHmBgYGzAyNvavHS2S2ypg6kpBgbGCxl563g+gJtZXNvcHn4KAwNjOcZXeeVNbDs4a0v8RReOgYGxEOOuYxN5nJCHEDkVAwNjB8Zd276xAjq2ZbzY22JgYCzKmA8U20+N/Qe4iDAxMDAwJpbVFtB8y4iBgYExVnDbwxPtUO+T/wEDA2Mhxl1NbBthjg3mHh+3YWBg/DNG3jrmJfWJRd8QZGJgYLyP8Q1eU/Ub5uIftAAAAABJRU5ErkJggg==" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/jquery/2.1.0-jquery.min.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/jquery/3.5.2-jquery.fancybox.min.js?v=1.6.6"></script>
<!--  //cdn.bootcss.com/node-waves/0.7.4/waves.min.js -->
<script type="text/javascript" src="/js/node-waves/0.7.4-waves.min.js?v=1.6.6"></script> 

<script type="text/javascript" src="/js/method.js?v=1.6.6"></script>
<script type="text/javascript" src="/js/blog.js?v=1.6.6"></script>

<!-- third-party -->
<script type="text/javascript" src="/js/plugins/local_search.js?v=1.6.6"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) { search_path = "search.xml";}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script> 

<script> (adsbygoogle = window.adsbygoogle || []).push({});</script>    


<!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> --> 


  


<script>
  var _hmt = _hmt || [];
  (function() {
    // ç™¾åº¦ç»Ÿè®¡
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?53923c4b5560739bc0ed61e183be6acf";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>
 


<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.staticfile.org/mathjax/2.7.9/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
 
<script>
    (function() {
        var OriginTitile = document.title, titleTime;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = 'WeiyiGeek Blog-å…³æ³¨äºç½‘ç»œå®‰å…¨_ç‰©è”ç½‘å®‰å…¨å¼€å‘_ç½‘ç»œå®‰å…¨è¿ç»´-å­¦ä¹ å¿ƒå¾—åˆ†äº«';
                clearTimeout(titleTime);
            } else {
                document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
                titleTime = setTimeout(function() {
                    document.title = OriginTitile;
                },2000);
            }
        });
    })();
</script>
 

     <script type="text/javascript" src="/js/custom/copytips.js?v=1.6.6"></script> 
</body>
</html>