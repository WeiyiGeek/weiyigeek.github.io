{"title":"KICKSTART无人值守批量安装系统.md","slug":"系统运维/Linux/系统安装/KICKSTART无人值守批量安装系统","date":"2019-03-25T03:34:30.000Z","updated":"2022-03-29T05:39:06.307Z","url":"2019/3-25-187.html","path":"api/articles/2019/3-25-187.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032505.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032506.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032507.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032508.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032509.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032510.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032511.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032512.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032513.png","https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032514.png"],"content":"<p><strong>本章目录</strong><br>(1) 导言<br>(2) 简介<br>(3) DHCP服务安装<br>(4) TFTP服务安装<br>(5) HTTP服务安装<br>(6) PXE服务配置与解释</p>\n<a id=\"more\"></a>\n<h4 id=\"0x01-导言\"><a href=\"#0x01-导言\" class=\"headerlink\" title=\"0x01 导言\"></a>0x01 导言</h4><p>有时候在公司做IT支持的时候，需要做一些机械式重复操作的工作。<br>例如：有时公司同时上线几十甚至上百台服务器，而且需要我们在短时间内完成系统安装。</p>\n<p>这时候我们往往采用网络安装系统(ftp,http,nfs)，或者采用高逼格的方法Kickstart &amp; Cobbler实现自动化安装系统。</p>\n<p>下面我们将手动安装的所有的详细步骤记录到一个文件中，然后kickstart通过读取这个文件就可以实现自动化安装系统。</p>\n<p><em>TIPS：kickstart是一个项目的名称，而cobbler是对kickstart的所有组件的封装（本质上就是网页版本的kickstart）</em></p>\n<hr>\n\n<h4 id=\"0x02-简述\"><a href=\"#0x02-简述\" class=\"headerlink\" title=\"0x02 简述\"></a>0x02 简述</h4><h5 id=\"2-1-PXE介绍\"><a href=\"#2-1-PXE介绍\" class=\"headerlink\" title=\"2.1 PXE介绍\"></a>2.1 PXE介绍</h5><p><em>Q：什么是PXE？</em><br>A：1.PXE，全名Pre-boot Execution Environment，预启动执行环境；<br>  2.通过网络接口启动计算机，不依赖本地存储设备（如硬盘）或本地已安装的操作系统；<br>  3.由Intel和Systemsoft公司于1999年9月20日公布的技术，是Client/Server的工作模式；<br>  4.PXE客户端会调用网际协议(IP)、用户数据报协议(UDP)、动态主机设定协议(DHCP)、小型文件传输协议(TFTP)等网络协议；<br>  5.PXE客户端(client)这个术语是指机器在PXE启动过程中的角色。一个PXE客户端可以是一台服务器、笔记本电脑或者其他装有PXE启动代码的机器（我们电脑的网卡）。</p>\n<h5 id=\"2-2-PXE工作过程\"><a href=\"#2-2-PXE工作过程\" class=\"headerlink\" title=\"2.2 PXE工作过程\"></a>2.2 PXE工作过程</h5><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032505.png\" alt=\"WeiyiGeek.PXE工作过程\" title=\"\" class=\"\">\n                <p>WeiyiGeek.PXE工作过程</p>\n            </figure>\n<p>(1) PXE 客户端发送UDP广播请求<br>      PXE Client向DHCP发送请求 PXE Client从自己的PXE网卡启动，通过PXE BootROM(自启动芯片)会以UDP(简单用户数据报协议)发送一个广播请求，向本网络中的DHCP服务器索取IP。 </p>\n<p> (2) DHCP服务器提供信息<br>      DHCP服务器收到客户端的请求，验证是否来至合法的PXE Client的请求，验证通过它将给客户端一个“提供”响应，这个“提供”响应中包含了为客户端分配的IP地址、pxelinux启动程序(TFTP)位置，以及配置文件所在位置。</p>\n<p>(3) PXE客户端请求下载启动文件<br>     客户端收到服务器的“回应”后，会回应一个帧，以请求传送启动所需文件，这些启动文件包括：pxelinux.0（ #引导文件，相当于grub）、pxelinux.cfg/default(#启动菜单文件)、vmlinuz（内核文件）、initrd.img（伪文件系统文件）等文件。</p>\n<p>(4) TFTP服务器响应客户端请求并传送文件<br>      当服务器收到客户端的请求后，他们之间之后将有更多的信息在客户端与服务器之间作应答, 用以决定启动参数;BootROM由TFTP通讯协议从Boot Server下载启动安装程序所必须的文件(pxelinux.0、pxelinux.cfg/default)，default文件下载完成后，会根据该文件中定义的引导顺序，启动Linux安装程序的引导内核。</p>\n<p>(5) 请求下载自动应答文件<br>     客户端通过pxelinux.cfg/default文件成功的引导Linux安装内核后，安装程序首先必须确定你通过什么安装介质来安装linux，如果是通过网络安装(NFS, FTP, HTTP)，则会在这个时候初始化网络，并定位安装源位置，接着会读取default文件中指定的自动应答文件ks.cfg所在位置，根据该位置请求下载该文件。</p>\n<p><em>补充问题：</em><br>在第2步和第5步初始化2次网络了，这是由于PXE获取的是安装用的内核以及安装程序等，而安装程序要获取的是安装系统所需的二进制包引导以及配置文件。因此PXE模块和安装程序是相对独立的，PXE的网络配置并不能传递给安装程序，从而进行两次获取IP地址过程，但IP地址在DHCP的租期内是一样的。</p>\n<p>(6) 客户端安装操作系统<br>      将ks.cfg文件下载回来后，通过该文件找到OS Server，并按照该文件的配置请求下载安装过程需要的软件包， OS Server和客户端建立连接后，将开始传输软件包，客户端将开始安装操作系统，安装完成后将提示重新引导计算机。</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032506.png\" alt=\"WeiyiGeek.PXE工作示意图\" title=\"\" class=\"\">\n                <p>WeiyiGeek.PXE工作示意图</p>\n            </figure>\n<h5 id=\"2-3-Kickstart和Cobbler介绍\"><a href=\"#2-3-Kickstart和Cobbler介绍\" class=\"headerlink\" title=\"2.3 Kickstart和Cobbler介绍\"></a>2.3 Kickstart和Cobbler介绍</h5><p>Redhat系主要有两种Kickstart和Cobbler。</p>\n<p>(1) Kickstart<br>    是一种无人值守的安装方式，它的工作原理是在安装过程中记录人工干预填写的各种参数，并生成一个名为ks.cfg的文件；如果在自动安装过程中出现要填写参数的情况，安装程序首先会去查找ks.cfg文件，如果找到合适的参数，就采用所找到的参数；如果没有找到合适的参数，便会弹出对话框让安装者手工填写。<br>所以如果ks.cfg文件涵盖了安装过程中所有需要填写的参数，那么安装者完全可以只告诉安装程序从何处下载ks.cfg文件等安装完毕，安装程序会根据ks.cfg中的设置重启/关闭系统，并结束安装。</p>\n<p>(2) Cobbler<br>    集中和简化了通过网络安装操作系统需要使用到的DHCP、TFTP和DNS服务的配置。<br>Cobbler不仅有一个命令行界面，还提供了一个Web界面，大大降低了使用者的入门水平。Cobbler内置了一个轻量级配置管理系统，但它也支持和其它配置管理系统集成，如Puppet，暂时不支持SaltStack。</p>\n<h4 id=\"2-4-环境准备\"><a href=\"#2-4-环境准备\" class=\"headerlink\" title=\"2.4 环境准备\"></a>2.4 环境准备</h4><p>VirtualBox 最小版本 测试设置（自定义NAT网络，不要勾选DHCP）<br>IP/MASK ：192.168.1.0/24<br><img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032507.png\" alt=\"WeiyiGeek.VirtualBox配置\"></p>\n<p>搭建kickstart项目的机器设置：<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">author:Weiyigeek</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">安装环境</span></span><br><span class=\"line\">CentOS release 6.10 (Final) 2.6.32-754.10.1.el6.i686  #为了方便测试使用了双网卡</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">禁用SElinux策略</span></span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> sed -i <span class=\"string\">'s/SELINUX=enforcing/SELINUX=disabled/'</span> /etc/selinux/config</span></span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> getenforce  <span class=\"comment\">#非常重要关闭syslinux</span></span></span><br><span class=\"line\">Disabled</span><br><span class=\"line\">[root@WeiyiGeek ~]# /etc/init.d/iptables status   #非常重要关闭防火墙</span><br><span class=\"line\">iptables: Firewall is not running.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">网卡1自建NAT（必须使用网卡1，否则DHCP开启报错）</span></span><br><span class=\"line\">root@WeiyiGeek ~]# vi /etc/sysconfig/network-scripts/ifcfg-eth1</span><br><span class=\"line\">DEVICE=eth1</span><br><span class=\"line\">HWADDR=08:00:27:AC:53:FC</span><br><span class=\"line\">TYPE=Ethernet</span><br><span class=\"line\">UUID=c3f35428-3740-4791-bc38-8e0d69707d4b</span><br><span class=\"line\">ONBOOT=yes</span><br><span class=\"line\">NM_CONTROLLED=no</span><br><span class=\"line\">BOOTPROTO=static   #设置静态IP</span><br><span class=\"line\">IPADDR=192.168.1.100</span><br><span class=\"line\">NETMASK=255.255.255.0</span><br><span class=\"line\">GATEWAY=192.168.1.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">网卡2 ： 地址转换NAT 即可</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">获取IP</span></span><br><span class=\"line\">[root@WeiyiGeek ~]# ifconfig eth1|awk -F \"[ :]+\" 'NR==2 &#123;print $4&#125;'  </span><br><span class=\"line\">10.0.2.15</span><br></pre></td></tr></table></figure><br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032508.png\" alt=\"WeiyiGeek.项目一览图\" title=\"\" class=\"\">\n                <p>WeiyiGeek.项目一览图</p>\n            </figure></p>\n<p><em>注意事项：</em></p>\n<ol>\n<li>虚拟机网卡采用NAT模式，不要使用桥接模式，因为稍后我们会搭建DHCP服务器，在同一局域网多个DHCP服务会有冲突</li>\n<li>VMware/OracleVM 的NAT模式的dhcp服务也关闭，避免干扰。</li>\n</ol>\n<hr>\n\n<h4 id=\"0x03-安装DHCP\"><a href=\"#0x03-安装DHCP\" class=\"headerlink\" title=\"0x03 安装DHCP\"></a>0x03 安装DHCP</h4><p>DHCP（Dynamic Host Configuration Protocol，动态主机配置协议）通常被应用在大型的局域网络环境中，主要作用是集中的管理、分配IP地址，使网络环境中的主机动态的获得IP地址、网关地址、DNS服务器地址等信息，并能够提升地址的使用率。<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032509.png\" alt=\"WeiyiGeek.dhcp工作\" title=\"\" class=\"\">\n                <p>WeiyiGeek.dhcp工作</p>\n            </figure></p>\n<h5 id=\"3-1-服务安装\"><a href=\"#3-1-服务安装\" class=\"headerlink\" title=\"3.1 服务安装\"></a>3.1 服务安装</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">author:Weiyigeek</span></span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> yum -y install dhcp</span></span><br><span class=\"line\"></span><br><span class=\"line\">[root@WeiyiGeek ~]# rpm -ql dhcp |grep \"dhcpd.conf\"</span><br><span class=\"line\">/etc/dhcp/dhcpd.conf    # 查看配置文件位置</span><br><span class=\"line\"></span><br><span class=\"line\">[root@WeiyiGeek ~]# vi /etc/dhcp/dhcpd.conf</span><br><span class=\"line\"></span><br><span class=\"line\">subnet 192.168.1.0 netmask 255.255.255.0 &#123;</span><br><span class=\"line\">        range 192.168.1.101 192.168.1.200;</span><br><span class=\"line\">        option subnet-mask 255.255.255.0;</span><br><span class=\"line\">        default-lease-time 21600;</span><br><span class=\"line\">        max-lease-time 43200;</span><br><span class=\"line\">        next-server 192.168.1.100;</span><br><span class=\"line\">        filename \"/pxelinux.0\";   #PXE启动文件</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> pxelinux.0是一个bootloader 类似于grub，通过它来加载系统安装引导程序，我们可以在它的配置文件中指定内核的位置和内核的启动参数 </span></span><br><span class=\"line\"></span><br><span class=\"line\">[root@WeiyiGeek ~]# /etc/init.d/dhcpd start</span><br><span class=\"line\">Starting dhcpd:                                            [  OK  ]</span><br><span class=\"line\"></span><br><span class=\"line\">[root@WeiyiGeek ~]# netstat -tlunp | grep \"dhcp\"udp        0      0 0.0.0.0:67                  0.0.0.0:*                               19360/dhcpd</span><br></pre></td></tr></table></figure>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032510.png\" alt=\"WeiyiGeek.服务安装\" title=\"\" class=\"\">\n                <p>WeiyiGeek.服务安装</p>\n            </figure>\n<p>本来软件装完后都要加入开机自启动，但这个Kickstart系统服务端就不能开机自启动，而且用完后服务都要关闭，防止未来重启服务器自动重装系统了。<br>如果机器数量过多的话，注意dhcp服务器的地址池，不要因为耗尽IP而导致dhcpd服务器没有IP地址release的情况。</p>\n<h5 id=\"3-2-DHCP指定监听网卡\"><a href=\"#3-2-DHCP指定监听网卡\" class=\"headerlink\" title=\"3.2 DHCP指定监听网卡\"></a>3.2 DHCP指定监听网卡</h5><p>说明：此知识点与本文无关，只是作者用过这个功能，记于此。 多网卡默认监听eth0，指定DHCP监听eth1网卡<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@WeiyiGeek ~]# vim /etc/sysconfig/dhcpd</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> Command line options here</span></span><br><span class=\"line\">DHCPDARGS=eth1  # 指定监听网卡</span><br><span class=\"line\"></span><br><span class=\"line\">[root@WeiyiGeek ~]# /etc/init.d/dhcpd restart</span><br><span class=\"line\">[root@WeiyiGeek ~]# tailf /var/log/messages  #查看DHCP链接</span><br></pre></td></tr></table></figure></p>\n<hr>\n\n<h4 id=\"0x04-TFTP服务\"><a href=\"#0x04-TFTP服务\" class=\"headerlink\" title=\"0x04 TFTP服务\"></a>0x04 TFTP服务</h4><p>TFTP简介：<br>TFTP（Trivial File Transfer Protocol,简单文件传输协议）是TCP/IP协议族中的一个用来在客户机与服务器之间进行简单文件传输的协议，提供不复杂、开销不大的文件传输服务，端口号为69。</p>\n<h5 id=\"4-1-TFTP安装配置\"><a href=\"#4-1-TFTP安装配置\" class=\"headerlink\" title=\"4.1 TFTP安装配置\"></a>4.1 TFTP安装配置</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@WeiyiGeek ~]# vim /etc/xinetd.d/tftp </span><br><span class=\"line\">[root@WeiyiGeek ~]# yum -y install tftp-server</span><br><span class=\"line\">[root@WeiyiGeek ~]# vim /etc/xinetd.d/tftp</span><br><span class=\"line\"></span><br><span class=\"line\">service tftp</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">        socket_type        = dgram</span><br><span class=\"line\">        protocol             = udp</span><br><span class=\"line\">        wait                    = yes</span><br><span class=\"line\">        user                    = root</span><br><span class=\"line\">        server                 = /usr/sbin/in.tftpd</span><br><span class=\"line\">        # 指定目录，保持默认，不用修改</span><br><span class=\"line\">        server_args             = -s /var/lib/tftpboot</span><br><span class=\"line\">        disable                 = no  </span><br><span class=\"line\">        per_source              = 11</span><br><span class=\"line\">        cps                     = 100 2</span><br><span class=\"line\">        flags                   = IPv4</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">将<span class=\"built_in\">disable</span>从yes改为no</span></span><br><span class=\"line\"></span><br><span class=\"line\">[root@WeiyiGeek ~]# /etc/init.d/xinetd restart</span><br><span class=\"line\">Stopping xinetd:                                           [FAILED]</span><br><span class=\"line\">Starting xinetd:                                           [  OK  ]</span><br><span class=\"line\">[root@WeiyiGeek ~]# netstat -tunlp | grep 69</span><br><span class=\"line\">udp        0      0 0.0.0.0:69                  0.0.0.0:*                               32098/xinetd</span><br></pre></td></tr></table></figure>\n<hr>\n\n<h4 id=\"0x05-配置HTTP服务\"><a href=\"#0x05-配置HTTP服务\" class=\"headerlink\" title=\"0x05 配置HTTP服务\"></a>0x05 配置HTTP服务</h4><p>可以用Apache或Nginx提供HTTP服务，Python的命令web服务不行，会有报错。<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#author:Weiyigeek</span><br><span class=\"line\">$ yum -y install httpd</span><br><span class=\"line\">$ sed -i &quot;277i ServerName 127.0.0.1:80&quot; &#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;httpd.conf</span><br><span class=\"line\"></span><br><span class=\"line\">$ &#x2F;etc&#x2F;init.d&#x2F;httpd start</span><br><span class=\"line\">$ mkdir &#x2F;var&#x2F;www&#x2F;html&#x2F;ISO</span><br><span class=\"line\">$ mount &#x2F;dev&#x2F;cdrom &#x2F;var&#x2F;www&#x2F;html&#x2F;ISO</span><br><span class=\"line\">   mount: block device &#x2F;dev&#x2F;sr0 is write-protected, mounting read-only</span><br><span class=\"line\"></span><br><span class=\"line\">$ df -h</span><br><span class=\"line\">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class=\"line\">&#x2F;dev&#x2F;sr0        3.7G  3.7G     0 100% &#x2F;var&#x2F;www&#x2F;html&#x2F;ISO</span><br><span class=\"line\"># 不管怎么弄，只要把安装光盘内容能通过web发布即可。因为是演示，如果复制镜像就有点浪费时间。但生产环境就一定要复制了，光盘读取速度有限。</span><br></pre></td></tr></table></figure><br>浏览器访问 <a href=\"http://192.168.1.100/ISO/\" target=\"_blank\" rel=\"noopener\">http://192.168.1.100/ISO/</a> 检验配置是否正确:</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032511.png\" alt=\"WeiyiGeek.httpd配置效果\" title=\"\" class=\"\">\n                <p>WeiyiGeek.httpd配置效果</p>\n            </figure>\n<hr>\n\n<h4 id=\"0x06-配置支持PXE的启动程序\"><a href=\"#0x06-配置支持PXE的启动程序\" class=\"headerlink\" title=\"0x06 配置支持PXE的启动程序\"></a>0x06 配置支持PXE的启动程序</h4><h5 id=\"6-1-PXE引导配置（bootstrap）\"><a href=\"#6-1-PXE引导配置（bootstrap）\" class=\"headerlink\" title=\"6.1 PXE引导配置（bootstrap）\"></a>6.1 PXE引导配置（bootstrap）</h5><p>描述：syslinux是一个功能强大的引导加载程序，而且兼容各种介质。SYSLINUX是一个小型的Linux操作系统，它的目的是简化首次安装Linux的时间，并建立修护或其它特殊用途的启动盘。如果没有找到pxelinux.0这个文件,可以安装一下。</p>\n<p>安装命令：<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">author:Weiyigeek</span></span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> yum install syslinux -y</span></span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/              <span class=\"comment\">#重要</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 复制启动菜单程序文件</span></span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\">cp -a /var/www/html/ISO/isolinux/* /var/lib/tftpboot/</span></span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\">ls /var/lib/tftpboot/</span></span><br><span class=\"line\">boot.cat  grub.conf   isolinux.bin  memtest     splash.jpg  vesamenu.c32</span><br><span class=\"line\">boot.msg  initrd.img  isolinux.cfg  pxelinux.0  TRANS.TBL   vmlinuz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 新建一个pxelinux.cfg目录，存放客户端的配置文件。</span></span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> mkdir -p /var/lib/tftpboot/pxelinux.cfg </span></span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> cp /var/www/html/ISO/isolinux/isolinux.cfg /var/lib/tftpboot/pxelinux.cfg/default</span></span><br></pre></td></tr></table></figure></p>\n<h5 id=\"6-2-PXE配置文件default解析\"><a href=\"#6-2-PXE配置文件default解析\" class=\"headerlink\" title=\"6.2 PXE配置文件default解析\"></a>6.2 PXE配置文件default解析</h5><p>VirtualBox需要更改启动顺序（来达到网络启动）VM同样也是，下面配合虚拟机演示讲解default文件。<br>新建一个虚拟机，注意内存需要给1G。</p>\n<p>Step1.打开虚拟机电源后，进行自动获取IP地址并加载Tftp中的pxe启动文件<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032512.png\" alt=\"WeiyiGeek.虚拟机网络启动\" title=\"\" class=\"\">\n                <p>WeiyiGeek.虚拟机网络启动</p>\n            </figure></p>\n<p>Step2.看看光盘中isolinu目录中的isolinux.cfg文件<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">author:Weiyigeek</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> vim /var/lib/tftpboot/pxelinux.cfg/default</span></span><br><span class=\"line\"></span><br><span class=\"line\">default vesamenu.c32  # 默认加载一个菜单</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">prompt 1             <span class=\"comment\"># 开启会显示命令行'boot: '提示符。prompt值为0时则不提示，将会直接启动'default'参数中指定的内容。</span></span></span><br><span class=\"line\">timeout 600           # timeout时间是引导时等待用户手动选择的时间，设为1可直接引导，单位为1/10秒。</span><br><span class=\"line\"></span><br><span class=\"line\">display boot.msg</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 菜单背景图片、标题、颜色。</span></span><br><span class=\"line\">menu background splash.jpg</span><br><span class=\"line\">menu title Welcome to CentOS 6.7!</span><br><span class=\"line\">menu color border 0 #ffffffff #00000000</span><br><span class=\"line\">menu color sel 7 #ffffffff #ff000000</span><br><span class=\"line\">menu color title 0 #ffffffff #00000000</span><br><span class=\"line\">menu color tabmsg 0 #ffffffff #00000000</span><br><span class=\"line\">menu color unsel 0 #ffffffff #00000000</span><br><span class=\"line\">menu color hotsel 0 #ff000000 #ffffffff</span><br><span class=\"line\">menu color hotkey 7 #ffffffff #ff000000</span><br><span class=\"line\">menu color scrollbar 0 #ffffffff #00000000</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> label指定在boot:提示符下输入的关键字，比如boot:linux[ENTER]，这个会启动label linux下标记的kernel和initrd.img文件。</span></span><br><span class=\"line\"></span><br><span class=\"line\">label linux       # 一个标签就是前面图片的一行选项。</span><br><span class=\"line\">  menu label ^Install or upgrade an existing system</span><br><span class=\"line\">  menu default</span><br><span class=\"line\">  kernel vmlinuz  # 指定要启动的内核。同样要注意路径，默认是/tftpboot目录。</span><br><span class=\"line\">  append initrd=initrd.img #指定追加给内核的参数，initrd.img是一个最小的linux系统</span><br><span class=\"line\"></span><br><span class=\"line\">label vesa</span><br><span class=\"line\">  menu label Install system with ^basic video driver</span><br><span class=\"line\">  kernel vmlinuz</span><br><span class=\"line\">  append initrd=initrd.img nomodeset</span><br><span class=\"line\"></span><br><span class=\"line\">label rescue                 #救援</span><br><span class=\"line\">  menu label ^Rescue installed system</span><br><span class=\"line\">  kernel vmlinuz</span><br><span class=\"line\">  append initrd=initrd.img rescue</span><br><span class=\"line\"></span><br><span class=\"line\">label local                     #本地启动</span><br><span class=\"line\">  menu label Boot from ^local drive</span><br><span class=\"line\">  localboot 0xffff</span><br><span class=\"line\"></span><br><span class=\"line\">label memtest              #内存测试</span><br><span class=\"line\">  menu label ^Memory test</span><br><span class=\"line\">  kernel memtest</span><br><span class=\"line\">  append -</span><br><span class=\"line\"></span><br><span class=\"line\">menu end   #结束</span><br></pre></td></tr></table></figure><br>修改default配置文件实现通过网络安装操作系统CentOS7.X 网络安装的关键点，修改default文件如下：<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">default menu.c32</span><br><span class=\"line\">timeout 600</span><br><span class=\"line\">menu title CentOS Linux  PXE Install</span><br><span class=\"line\"></span><br><span class=\"line\">label centos7     #自动安装centos7</span><br><span class=\"line\">      menu label Auto Install CentOS Linux ^7</span><br><span class=\"line\">      kernel centos7/vmlinuz</span><br><span class=\"line\">      append initrd=centos7/initrd.img ks=http://192.168.10.43/ksdir/ks7-1.cfg #应答文件</span><br><span class=\"line\">      </span><br><span class=\"line\"></span><br><span class=\"line\">label linux7    #手动安装centos7</span><br><span class=\"line\">  menu label ^Install CentOS 7.</span><br><span class=\"line\">  kernel vmlinuz</span><br><span class=\"line\">  append initrd=initrd.img inst.repo=http://172.16.1.201/CentOS7/    #手动安装centos7</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">label local     #本地硬盘启动</span><br><span class=\"line\">     menu default    #默认启动项</span><br><span class=\"line\">     menu label Boot from ^local drive</span><br><span class=\"line\">     localboot 0xffff</span><br><span class=\"line\"></span><br><span class=\"line\"> menu end</span><br></pre></td></tr></table></figure></p>\n<p><em>Step 3 .预热之手动网络安装选择URL方式安装</em><br>注：使用NFS的写法nfs:10.0.0.1:/data/sys/kickstart/ks.cfg</p>\n<h4 id=\"0x07-创建ks-cfg文件与解析\"><a href=\"#0x07-创建ks-cfg文件与解析\" class=\"headerlink\" title=\"0x07 创建ks.cfg文件与解析\"></a>0x07 创建ks.cfg文件与解析</h4><p>通常我们在安装操作系统的过程中，需要大量的和服务器交互操作，为了减少这个交互过程，kickstart就诞生了。只需事先定义好一个Kickstart自动应答配置文件ks.cfg（通常存放在安装服务器上），并让安装程序知道该配置文件的位置，在安装过程中安装程序就可以自己从该文件中读取安装配置，这样就避免了在安装过程中多次的人机交互，从而实现无人值守的自动化安装。</p>\n<p><em>生成ks.cfg配置文件的三种方法：</em><br>方法1. 每安装好一台Centos机器，Centos安装程序都会创建一个kickstart配置文件，记录你的真实安装配置，（生成的文件名字叫anaconda-ks.cfg位于/root/anaconda-ks.cfg）然后根据需求进行更改。</p>\n<p>方法2.Centos提供了一个图形化的kickstart配置工具。在任何一个安装好的Linux系统上运行该工具，就可以很容易地创建你自己的kickstart配置文件；kickstart配置工具命令为redhat-config-kickstart（RHEL3）或system-config-kickstart（RHEL4，RHEL5）;</p>\n<p>方法3.阅读kickstart配置文件的手册。用任何一个文本编辑器都可以创建你自己的kickstart配置文件。</p>\n<h5 id=\"7-1-查看-anaconda-ks-cfg\"><a href=\"#7-1-查看-anaconda-ks-cfg\" class=\"headerlink\" title=\"7.1 查看 anaconda-ks.cfg\"></a>7.1 查看 anaconda-ks.cfg</h5><p>$ cat anaconda-ks.cfg<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">author:Weiyigeek</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">CentOS-7 kickstart示例</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">version=DEVEL</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">安装全新的系统</span></span><br><span class=\"line\">install   </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">启用shadow文件验证，使用sha512算法</span></span><br><span class=\"line\">auth --enableshadow --passalgo=sha512</span><br><span class=\"line\"></span><br><span class=\"line\">text</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">指定语言，指定使用美式键盘，设定时区</span></span><br><span class=\"line\">lang en_US.UTF-8</span><br><span class=\"line\">keyboard --vckeymap=us --xlayouts='us'</span><br><span class=\"line\">timezone Asia/Shanghai --isUtc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">安装网络设置(Static | DHCP)</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">network --onboot yes --device eth0 --bootproto static --ip 10.0.0.6 --netmask 255.255.255.0 --gateway 10.0.0.2 --noipv6 --nameserver 10.0.0.2 --hostname centos67</span></span><br><span class=\"line\">network --onboot=on --device=ens33  --bootproto=dhcp --activate --ipv6=auto</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">提示建立新的root密码</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">rootpw newpassword</span></span><br><span class=\"line\">rootpw  --iscrypted $6$2Frfm3Sc/oWdF2Yb$GTS8VbsaeLzAfT46EYJWezKA7VMOnefDAH6anyb12Hu5K1qu1awlpTwBxTjAzXpV/.l983Irdwxo5Rks0QV1p1</span><br><span class=\"line\"></span><br><span class=\"line\">bootloader --location=mbr --driveorder=sda --append=\"crashkernel=auto\"</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"></span></span><br><span class=\"line\">zerombr</span><br><span class=\"line\">clearpart --none --initlabel</span><br><span class=\"line\">part /boot --fstype=ext4 --ondisk=sda --size=400</span><br><span class=\"line\">part swap  --ondisk=sda --size=4000</span><br><span class=\"line\">part / --fstype=ext4 --ondisk=sda --grow --size=200</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">必须要设置重新（否则不能自动化）</span></span><br><span class=\"line\">reboot</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">服务与系统设置</span></span><br><span class=\"line\">firewall --service=ssh</span><br><span class=\"line\">selinux --disabled</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">%</span><span class=\"bash\">packages</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">@base</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">@compat-libraries</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">@core</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">@debugging</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">@development</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">@server-policy</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">@workstation-policy</span></span><br><span class=\"line\">@^minimal</span><br><span class=\"line\">@core</span><br><span class=\"line\"><span class=\"meta\">%</span><span class=\"bash\">end</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">%</span><span class=\"bash\">addon com_redhat_kdump --<span class=\"built_in\">disable</span> --reserve-mb=<span class=\"string\">'auto'</span></span></span><br><span class=\"line\"><span class=\"meta\">%</span><span class=\"bash\">end</span></span><br></pre></td></tr></table></figure><br><br></p>\n<h5 id=\"7-2-ks-cfg详解\"><a href=\"#7-2-ks-cfg详解\" class=\"headerlink\" title=\"7.2 ks.cfg详解\"></a>7.2 ks.cfg详解</h5><p>官网CentOS6 : <a href=\"https://access.redhat.com/knowledge/docs/en-US/Red_Hat_Enterprise_Linux/6/html/Installation_Guide/s1-kickstart2-options.html\" target=\"_blank\" rel=\"noopener\">https://access.redhat.com/knowledge/docs/en-US/Red_Hat_Enterprise_Linux/6/html/Installation_Guide/s1-kickstart2-options.html</a><br>官网自带中文版，选一下语言即可 ks.cfg文件组成大致分为3段</p>\n<p>命令段: 键盘类型，语言，安装方式等系统的配置，有必选项和可选项，如果缺少某项必选项，安装时会中断并提示用户选择此项的选项:</p>\n<p>软件包段: 在安装过程中默认安装的软件包，安装软件时会自动分析依赖关系。<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">%</span><span class=\"bash\">packages</span></span><br><span class=\"line\">@groupname：指定安装的包组</span><br><span class=\"line\">package_name：指定安装的包</span><br><span class=\"line\">-package_name：指定不安装的包</span><br></pre></td></tr></table></figure></p>\n<p>脚本段(可选):<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">%</span><span class=\"bash\">pre:安装系统前执行的命令或脚本(由于只依赖于启动镜像，支持的命令很少)</span></span><br><span class=\"line\"><span class=\"meta\">%</span><span class=\"bash\">post:安装系统后执行的命令或脚本(基本支持所有命令)</span></span><br></pre></td></tr></table></figure></p>\n<p>参数详细：<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">关键字     含义</span><br><span class=\"line\">install     告知安装程序，这是一次全新安装，而不是升级upgrade。</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">通过FTP或HTTP从远程服务器上的安装树中安装。</span></span><br><span class=\"line\">url --url=\"http://192.168.1.100/CentOS-6.7/\"</span><br><span class=\"line\">url --url ftp://&lt;username&gt;:&lt;password&gt;@&lt;server&gt;/&lt;dir&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">从指定的NFS服务器安装。</span></span><br><span class=\"line\">nfs --server=nfsserver.example.com --dir=/tmp/install-tree</span><br><span class=\"line\"></span><br><span class=\"line\">text     使用文本模式安装。</span><br><span class=\"line\">lang     设置在安装过程中使用的语言以及系统的缺省语言 lang en_US.UTF-8</span><br><span class=\"line\">keyboard     设置系统键盘类型 keyboard us</span><br><span class=\"line\">zerombr     清除mbr引导信息。</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">系统引导相关配置。</span></span><br><span class=\"line\">bootloader --location=mbr --driveorder=sda --append=\"crashkernel=auto rhgb quiet\"</span><br><span class=\"line\">--location=,指定引导记录被写入的位置.有效的值如下:mbr(缺省),partition(在包含内核的分区的第一个扇区安装引导装载程序)或none(不安装引导装载程序)。</span><br><span class=\"line\">--driveorder,指定在BIOS引导顺序中居首的驱动器。</span><br><span class=\"line\">--append=,指定内核参数.要指定多个参数,使用空格分隔它们。</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">为通过网络的kickstart安装以及所安装的系统配置联网信息。</span></span><br><span class=\"line\">network --bootproto=dhcp --device=eth0 --onboot=yes --noipv6 --hostname=CentOS6</span><br><span class=\"line\">bootproto=[dhcp/bootp/static]中的一种，缺省值是dhcp。</span><br><span class=\"line\">        bootp和dhcp被认为是相同的；static方法要求在kickstart文件里输入所有的网络信息。</span><br><span class=\"line\"></span><br><span class=\"line\">network --bootproto=static --ip=10.0.0.100 --netmask=255.255.255.0 --gateway=10.0.0.2 --nameserver=10.0.0.2</span><br><span class=\"line\">请注意所有配置信息都必须在一行上指定,不能使用反斜线来换行。</span><br><span class=\"line\">--ip=,要安装的机器的IP地址.</span><br><span class=\"line\">--gateway=,IP地址格式的默认网关.</span><br><span class=\"line\">--netmask=,安装的系统的子网掩码.</span><br><span class=\"line\">--hostname=,安装的系统的主机名.</span><br><span class=\"line\">--onboot=,是否在引导时启用该设备.</span><br><span class=\"line\">--noipv6=,禁用此设备的IPv6.</span><br><span class=\"line\">--nameserver=,配置dns解析.</span><br><span class=\"line\"></span><br><span class=\"line\">timezone     设置系统时区。timezone --utc Asia/Shanghai</span><br><span class=\"line\">authconfig     系统认证信息。authconfig --enableshadow --passalgo=sha512</span><br><span class=\"line\">设置密码加密方式为sha512 启用shadow文件。</span><br><span class=\"line\"></span><br><span class=\"line\">rootpw     root密码</span><br><span class=\"line\"></span><br><span class=\"line\">clearpart     清空分区。</span><br><span class=\"line\">                 clearpart --all --initlabel</span><br><span class=\"line\">                  --all 从系统中清除所有分区，</span><br><span class=\"line\">                  --initlable 初始化磁盘标签</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 磁盘分区</span></span><br><span class=\"line\">part /boot --fstype=ext4 --asprimary --size=200</span><br><span class=\"line\">part swap --size=1024</span><br><span class=\"line\">part / --fstype=ext4 --grow --asprimary --size=200</span><br><span class=\"line\">--fstype=,为分区设置文件系统类型.有效的类型为ext2,ext3,swap和vfat。</span><br><span class=\"line\">--asprimary,强迫把分区分配为主分区,否则提示分区失败。</span><br><span class=\"line\">--size=,以MB为单位的分区最小值.在此处指定一个整数值,如500不要在数字后面加MB。</span><br><span class=\"line\">--grow,告诉分区使用所有可用空间(若有),或使用设置的最大值。</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">firstboot  负责协助配置redhat一些重要的信息。</span><br><span class=\"line\">firstboot  --disable</span><br><span class=\"line\">selinux     关闭selinux ； selinux --disabled</span><br><span class=\"line\">firewall     关闭防火墙  ；  firewall --disabled</span><br><span class=\"line\">logging     设置日志级别；logging --level=info</span><br><span class=\"line\">reboot     设定安装完成后重启,此选项必须存在，不然kickstart显示一条消息，并等待用户按任意键后才重新引导，也可以选择halt关机。</span><br></pre></td></tr></table></figure><br><br></p>\n<h5 id=\"7-3-编写ks文件\"><a href=\"#7-3-编写ks文件\" class=\"headerlink\" title=\"7.3 编写ks文件\"></a>7.3 编写ks文件</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 先生成一个密码备用</span></span><br><span class=\"line\">[root@weiyigeek ~]# grub-crypt</span><br><span class=\"line\">Password:123456</span><br><span class=\"line\">Retype password:123456</span><br><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\">6<span class=\"variable\">$X20eRtuZhkHznTb4</span><span class=\"variable\">$dK0BJByOSAWSDD8jccLVFz0CscijS9ldMWwpoCw</span>/ZEjYw2BTQYGWlgKsn945fFTjRC658UXjuocwJbAjVI5D6/</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[root@weiyigeek ~]# vim /var/www/html/ks_config/CentOS-6.7-ks.cfg</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> Kickstart Configurator <span class=\"keyword\">for</span> CentOS 6.7 </span></span><br><span class=\"line\">install</span><br><span class=\"line\">text</span><br><span class=\"line\">lang en_US.UTF-8</span><br><span class=\"line\">keyboard us</span><br><span class=\"line\">network --onboot yes --device eth0 --bootproto dhcp --noipv6</span><br><span class=\"line\">rootpw  --iscrypted $6$2Frfm3Sc/oWdF2Yb$GTS8VbsaeLzAfT46EYJWezKA7VMOnefDAH6anyb12Hu5K1qu1awlpTwBxTjAzXpV/.l983Irdwxo5Rks0QV1p1</span><br><span class=\"line\">url --url=http://192.168.1.100/ISO</span><br><span class=\"line\">firewall --service=ssh</span><br><span class=\"line\">selinux --disabled</span><br><span class=\"line\">timezone Asia/Shanghai</span><br><span class=\"line\">bootloader --location=mbr --driveorder=sda --append=\"crashkernel=auto rhgb quiet\"</span><br><span class=\"line\">zerombr</span><br><span class=\"line\">clearpart --all</span><br><span class=\"line\">reboot</span><br><span class=\"line\">part /boot --fstype=ext4 --size=400</span><br><span class=\"line\">part swap  --size=4000</span><br><span class=\"line\">part / --fstype=ext4 --grow --size=200</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">%</span><span class=\"bash\">packages</span></span><br><span class=\"line\">@base</span><br><span class=\"line\">@compat-libraries</span><br><span class=\"line\">@debugging</span><br><span class=\"line\">@development</span><br><span class=\"line\">tree</span><br><span class=\"line\">nmap</span><br><span class=\"line\">sysstat</span><br><span class=\"line\">lrzsz</span><br><span class=\"line\">dos2unix</span><br><span class=\"line\">telnet</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">%</span><span class=\"bash\">post</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">我们搭建的网站里存放了优化脚本</span></span><br><span class=\"line\">wget -O /tmp/optimization.sh http://192.168.1.100/ks_config/optimization.sh &amp;&gt;/dev/null</span><br><span class=\"line\">/bin/sh /tmp/optimization.sh</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">%</span><span class=\"bash\">end</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"7-4-开机优化脚本\"><a href=\"#7-4-开机优化脚本\" class=\"headerlink\" title=\"7.4 开机优化脚本\"></a>7.4 开机优化脚本</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@weiyigeek ~]# vim &#x2F;var&#x2F;www&#x2F;html&#x2F;ks_config&#x2F;optimization.sh</span><br><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">##############################################################</span><br><span class=\"line\"># File Name: &#x2F;var&#x2F;www&#x2F;html&#x2F;ks_config&#x2F;optimization.sh</span><br><span class=\"line\"># Version: V1.0</span><br><span class=\"line\"># Author: yao zhang</span><br><span class=\"line\"># Description: Linux system initialization</span><br><span class=\"line\">##############################################################</span><br><span class=\"line\"></span><br><span class=\"line\">. &#x2F;etc&#x2F;init.d&#x2F;functions</span><br><span class=\"line\"></span><br><span class=\"line\">Ip&#x3D;192.168.1.100</span><br><span class=\"line\">Port&#x3D;80</span><br><span class=\"line\">ConfigDir&#x3D;ks_config</span><br><span class=\"line\"></span><br><span class=\"line\"># Judge Http server is ok?</span><br><span class=\"line\">PortNum&#x3D;&#96;nmap $Ip  -p $Port 2&gt;&#x2F;dev&#x2F;null|grep open|wc -l&#96;</span><br><span class=\"line\">[ $PortNum -lt 1 ] &amp;&amp; &#123;</span><br><span class=\"line\">        echo &quot;Http server is bad!&quot;</span><br><span class=\"line\">        exit 1</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># Defined result function</span><br><span class=\"line\">function Msg()&#123;</span><br><span class=\"line\">        if [ $? -eq 0 ];then</span><br><span class=\"line\">          action &quot;$1&quot; &#x2F;bin&#x2F;true</span><br><span class=\"line\">        else</span><br><span class=\"line\">          action &quot;$1&quot; &#x2F;bin&#x2F;false</span><br><span class=\"line\">        fi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># Defined IP function</span><br><span class=\"line\">function ConfigIP()&#123;</span><br><span class=\"line\">        Suffix&#x3D;&#96;ifconfig eth0|awk -F &quot;[ .]+&quot; &#39;NR&#x3D;&#x3D;2 &#123;print $6&#125;&#39;&#96;</span><br><span class=\"line\">        cat &gt;&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-eth0 &lt;&lt;-END</span><br><span class=\"line\">        DEVICE&#x3D;eth0</span><br><span class=\"line\">        TYPE&#x3D;Ethernet</span><br><span class=\"line\">        ONBOOT&#x3D;yes</span><br><span class=\"line\">        NM_CONTROLLED&#x3D;yes</span><br><span class=\"line\">        BOOTPROTO&#x3D;none</span><br><span class=\"line\">        IPADDR&#x3D;10.0.0.$Suffix</span><br><span class=\"line\">        PREFIX&#x3D;24</span><br><span class=\"line\">        GATEWAY&#x3D;10.0.0.2</span><br><span class=\"line\">        DNS1&#x3D;10.0.0.2</span><br><span class=\"line\">        DEFROUTE&#x3D;yes</span><br><span class=\"line\">        IPV4_FAILURE_FATAL&#x3D;yes</span><br><span class=\"line\">        IPV6INIT&#x3D;no</span><br><span class=\"line\">        NAME&#x3D;&quot;System eth0&quot;</span><br><span class=\"line\">        END</span><br><span class=\"line\">        Msg &quot;config eth0&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># Defined Yum source Functions</span><br><span class=\"line\">function yum()&#123;</span><br><span class=\"line\">        YumDir&#x3D;&#x2F;etc&#x2F;yum.repos.d</span><br><span class=\"line\">        [ -f &quot;$YumDir&#x2F;CentOS-Base.repo&quot; ] &amp;&amp; cp $YumDir&#x2F;CentOS-Base.repo&#123;,.ori&#125; </span><br><span class=\"line\">        wget -O $YumDir&#x2F;CentOS-Base.repo http:&#x2F;&#x2F;$Ip:$Port&#x2F;$ConfigDir&#x2F;CentOS-Base.repo &amp;&gt;&#x2F;dev&#x2F;null &amp;&amp;\\</span><br><span class=\"line\">        wget -O $YumDir&#x2F;epel.repo http:&#x2F;&#x2F;$Ip:$Port&#x2F;$ConfigDir&#x2F;epel.repo &amp;&gt;&#x2F;dev&#x2F;null &amp;&amp;\\</span><br><span class=\"line\">        Msg &quot;YUM source&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># Defined Hide the system version number Functions</span><br><span class=\"line\">function HideVersion()&#123;</span><br><span class=\"line\">        [ -f &quot;&#x2F;etc&#x2F;issue&quot; ] &amp;&amp; &gt;&#x2F;etc&#x2F;issue</span><br><span class=\"line\">        Msg &quot;Hide issue&quot; </span><br><span class=\"line\">        [ -f &quot;&#x2F;etc&#x2F;issue.net&quot; ] &amp;&amp; &gt; &#x2F;etc&#x2F;issue.net</span><br><span class=\"line\">        Msg &quot;Hide issue.net&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># Defined OPEN FILES Functions</span><br><span class=\"line\">function openfiles()&#123;</span><br><span class=\"line\">        [ -f &quot;&#x2F;etc&#x2F;security&#x2F;limits.conf&quot; ] &amp;&amp; &#123;</span><br><span class=\"line\">        echo &#39;*  -  nofile  65535&#39; &gt;&gt; &#x2F;etc&#x2F;security&#x2F;limits.conf</span><br><span class=\"line\">        Msg &quot;open files&quot;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># Defined Kernel parameters Functions</span><br><span class=\"line\">function kernel()&#123;</span><br><span class=\"line\">        KernelDir&#x3D;&#x2F;etc</span><br><span class=\"line\">        [ -f &quot;$KernelDir&#x2F;sysctl.conf&quot; ] &amp;&amp; &#x2F;bin&#x2F;mv $KernelDir&#x2F;sysctl.conf&#123;,.ori&#125;</span><br><span class=\"line\">        wget -O $KernelDir&#x2F;sysctl.conf http:&#x2F;&#x2F;$Ip:$Port&#x2F;$ConfigDir&#x2F;sysctl.conf &amp;&gt;&#x2F;dev&#x2F;null</span><br><span class=\"line\">        Msg &quot;Kernel config&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># Defined System Startup Services Functions</span><br><span class=\"line\">function boot()&#123;</span><br><span class=\"line\">        for oldboy in &#96;chkconfig --list|grep &quot;3:on&quot;|awk &#39;&#123;print $1&#125;&#39;|grep -vE &quot;crond|network|rsyslog|sshd|sysstat&quot;&#96; </span><br><span class=\"line\">          do </span><br><span class=\"line\">           chkconfig $oldboy off</span><br><span class=\"line\">        done</span><br><span class=\"line\">        Msg &quot;BOOT config&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># Defined Time Synchronization Functions</span><br><span class=\"line\">function Time()&#123;</span><br><span class=\"line\">        echo &quot;#time sync by zhangyao at $(date +%F)&quot; &gt;&gt;&#x2F;var&#x2F;spool&#x2F;cron&#x2F;root</span><br><span class=\"line\">        echo &#39;*&#x2F;5 * * * * &#x2F;usr&#x2F;sbin&#x2F;ntpdate time.nist.gov &amp;&gt;&#x2F;dev&#x2F;null&#39; &gt;&gt;&#x2F;var&#x2F;spool&#x2F;cron&#x2F;root</span><br><span class=\"line\">        Msg &quot;Time Synchronization&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># Defined main Functions</span><br><span class=\"line\">function main()&#123;</span><br><span class=\"line\">        ConfigIP</span><br><span class=\"line\">        yum</span><br><span class=\"line\">        HideVersion</span><br><span class=\"line\">        openfiles</span><br><span class=\"line\">        kernel</span><br><span class=\"line\">        boot</span><br><span class=\"line\">        Time</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">#调用脚本</span><br><span class=\"line\">main</span><br><span class=\"line\"></span><br><span class=\"line\"># rz上传CentOS-Base.repo、epel.repo、sysctl.conf</span><br></pre></td></tr></table></figure>\n<h5 id=\"7-5-整合编辑default配置文件（最简）\"><a href=\"#7-5-整合编辑default配置文件（最简）\" class=\"headerlink\" title=\"7.5 整合编辑default配置文件（最简）\"></a>7.5 整合编辑default配置文件（最简）</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 最精简配置</span></span><br><span class=\"line\">[root@weiyigeek ~]# vim /var/lib/tftpboot/pxelinux.cfg/default</span><br><span class=\"line\">default ks</span><br><span class=\"line\">prompt 0</span><br><span class=\"line\"></span><br><span class=\"line\">label ks</span><br><span class=\"line\">  kernel vmlinuz</span><br><span class=\"line\">  append initrd=initrd.img ks=http://192.168.1.100/ks_config/CentOS-6.7-ks.cfg # 告诉安装程序ks.cfg文件在哪里</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> append initrd=initrd.img ks=http://192.168.1.100/ks_config/CentOS-6.7-ks.cfg ksdevice=eth0</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> append initrd=initrd.img ks=http://172.16.1.201/ks_config/CentOS7-ks.cfg net.ifnames=0 biosdevname=0 ksdevice=eth1</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> ksdevice=eth0代表当客户端有多块网卡的时候，要实现自动化需要设置从eth1安装，不指定的话，安装的时候系统会让你选择，那就不叫全自动化了。</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"0x08-知识扩展\"><a href=\"#0x08-知识扩展\" class=\"headerlink\" title=\"0x08 知识扩展\"></a>0x08 知识扩展</h4><p>由于多个客户端可以从一个PXE服务器引导，PXE引导映像使用了一个复杂的配置文件搜索方式来查找针对客户机的配置文件。如果客户机的网卡的MAC地址为8F：3H：AA：6B：CC：5D，对应的IP地址为10.0.0.195；那么客户机首先尝试以MAC地址为文件名匹配的配置文件，如果不存在就以IP地址来查找。</p>\n<p>Step1.据上述环境针对这台主机要查找的以一个配置文件就是 /tftpboot/pxelinux.cfg/01-8F：3H：AA：6B：CC：5D</p>\n<p>Step2.如果该文件不存在，就会根据IP地址来查找配置文件了，这个算法更复杂些，PXE映像查找会根据IP地址16进制命名的客户机配置文件。<br>例如：10.0.0.195对应的16进制的形式为C0A801C3，（可以通过syslinux软件包提供的gethostip命令将10进制的IP转换为16进制）</p>\n<p>Step3.如果C0A801C3文件不存在，就尝试查找C0A801C文件，如果C0A801C也不存在，那么就尝试C0A801文件，依次类推，直到查找C文件，如果C也不存在的话，那么最后尝试default文件。</p>\n<p>总体来说，pxelinux搜索的文件的顺序是：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;tftpboot&#x2F;pxelinux.cfg&#x2F;01-88-99-aa-bb-cc-dd</span><br><span class=\"line\">&#x2F;tftpboot&#x2F;pxelinux.cfg&#x2F;C0A801C3</span><br><span class=\"line\">&#x2F;tftpboot&#x2F;pxelinux.cfg&#x2F;C0A801C</span><br><span class=\"line\">&#x2F;tftpboot&#x2F;pxelinux.cfg&#x2F;C0A801</span><br><span class=\"line\">&#x2F;tftpboot&#x2F;pxelinux.cfg&#x2F;C0A80</span><br><span class=\"line\">&#x2F;tftpboot&#x2F;pxelinux.cfg&#x2F;C0A8</span><br><span class=\"line\">&#x2F;tftpboot&#x2F;pxelinux.cfg&#x2F;C0A</span><br><span class=\"line\">&#x2F;tftpboot&#x2F;pxelinux.cfg&#x2F;C0</span><br><span class=\"line\">&#x2F;tftpboot&#x2F;pxelinux.cfg&#x2F;C</span><br><span class=\"line\">&#x2F;tftpboot&#x2F;pxelinux.cfg&#x2F;default</span><br></pre></td></tr></table></figure><br>应用：如果已经从厂商获取了服务器MAC地址，就可以差异化定制安装服务器了。</p>\n<h4 id=\"0x09-踩过的坑\"><a href=\"#0x09-踩过的坑\" class=\"headerlink\" title=\"0x09 踩过的坑\"></a>0x09 踩过的坑</h4><p>问题1：(最小版本的时候)dracut-initqueue : Warning: dracut-initqueue timeout - starting timeout scripts<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032513.png\" alt=\"WeiyiGeek.问题1\" title=\"\" class=\"\">\n                <p>WeiyiGeek.问题1</p>\n            </figure></p>\n<p>产生原因：由于我们并不是U盘进行安装，而是采用手动安装或者采用ks.cfs文件进行安装；<br>解决方法：<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. 修改 /isolinux/isolinux.cfg 里 hd:LABEL= 为U盘的具体标签 </span><br><span class=\"line\">2. 在选择安装CentOS时，选择 Install CentOS 7 ,然后修改 按 e 键，进入修改状态：</span><br><span class=\"line\">    1) 将 hd:LABEL= 修改为U盘的标签(推荐)</span><br><span class=\"line\">    2) 修改为当前 U盘在安装机的具体路径，一般为 /dev/hdb1 等，</span><br><span class=\"line\">3. 按 Ctrl+x 开始执行安装</span><br><span class=\"line\"></span><br><span class=\"line\">label linux</span><br><span class=\"line\">  menu label ^Install CentOS 7</span><br><span class=\"line\">  kernel vmlinuz</span><br><span class=\"line\">  append initrd=initrd.img  inst.repo=http://192.168.1.100/CentOS7/  #手动安装</span><br></pre></td></tr></table></figure></p>\n<p>问题2：启动发现又tftp但是没找到要加载的系统，报错是在TFTP服务的根目录找不到启动文件pxelinux.0<br>如果安装过程出错，可以通过Alt+F2-F5切到其他控制台查看报错信息<br><figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/2019032514.png\" alt=\"WeiyiGeek.问题2\" title=\"\" class=\"\">\n                <p>WeiyiGeek.问题2</p>\n            </figure></p>\n","comments":true,"excerpt":"本章目录<br>(1) 导言<br>(2) 简介<br>(3) DHCP服务安装<br>(4) TFTP服务安装<br>(5) HTTP服务安装<br>(6) PXE服务配置与解释","categories":[{"name":"OperationTools","path":"api/categories/OperationTools.json"},{"name":"Systeminstall","path":"api/categories/Systeminstall.json"}],"tags":[{"name":"KICKSTART","path":"api/tags/KICKSTART.json"}]}