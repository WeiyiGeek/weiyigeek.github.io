{"title":"apt命令之软件仓库管理使用一览表","slug":"系统运维/Linux/常用命令/安装软件类命令/apt软件仓库管理使用一览表","date":"2019-05-17T13:35:30.000Z","updated":"2022-04-28T01:54:34.864Z","url":"2019/5-17-149.html","path":"api/articles/2019/5-17-149.html.json","covers":["https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190522171056.png"],"content":"<p>[TOC]<br><a id=\"more\"></a></p>\n<h2 id=\"0x00-前言简述\"><a href=\"#0x00-前言简述\" class=\"headerlink\" title=\"0x00 前言简述\"></a>0x00 前言简述</h2><p>描述: apt 全称是 Advanced Packaging Tool是Linux系统下的一款安装包管理工具,可以说是Ubuntu系统下最为重要的命令安装、更新、卸载软件升级系统内核都离不开apt命令。</p>\n<p>apt(apt-get)命令是apt包的管理工具他们根据<code>/etc/apt/sources.list</code>里的软件源地址列表搜索目标软件、并通过维护本地软件包列表来安装和卸载软件。</p>\n<p>Ubuntu可以使用apt-get来获取系统或者软件的更新，并且把这些更新从网络上下载下来安装到电脑上</p>\n<p><strong>apt工作原理：</strong><br>描述: Ubuntu采用集中式的软件仓库机制，将各式各样的软件包分门别类地存放在软件仓库中，进行有效地组织和管理，然后将软件仓库置于许许多多的镜像服务器中，并保持基本一致。这样所有的Ubuntu用户随时都能获得最新版本的安装软件包。<br>因此对于用户这些镜像服务器就是他们的软件源（Reposity）, 然而由于每位用户所处的网络环境不同, 不可能随意地访问各镜像站点。</p>\n<figure class=\"image-box\">\n                <img src=\"https://cdn.jsdelivr.net/gh/WeiyiGeek/blogimage/2019/20190522171056.png\" alt=\"WeiyiGeek.apt工作原理\" title=\"\" class=\"\">\n                <p>WeiyiGeek.apt工作原理</p>\n            </figure>\n<p><br></p>\n<p><strong>apt 配置文件</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$vi</span> /etc/apt/sources.list   <span class=\"comment\">#更改更新源</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#文件的内容是软件包的描述信息, 该软件包括当前系统所使用的 ubunt 安装源中的所有软件包,其中包括当前系统中已安装的和未安装的软件包.</span></span><br><span class=\"line\">/var/lib/dpkg/available</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#目录是在用 apt-get install 安装软件时，软件包的临时存放路径</span></span><br><span class=\"line\">/var/cache/apt/archives</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#存放的是软件源站点</span></span><br><span class=\"line\">/etc/apt/sources.list</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#使用apt-get update命令会从/etc/apt/sources.list中下载软件列表，并保存到该目录</span></span><br><span class=\"line\">/var/lib/apt/lists</span><br></pre></td></tr></table></figure></p>\n<hr>\n<h2 id=\"0x01-命令一览\"><a href=\"#0x01-命令一览\" class=\"headerlink\" title=\"0x01 命令一览\"></a>0x01 命令一览</h2><h3 id=\"apt-命令-软件包管理工具\"><a href=\"#apt-命令-软件包管理工具\" class=\"headerlink\" title=\"apt 命令 - 软件包管理工具\"></a>apt 命令 - 软件包管理工具</h3><p>描述: 使用Ubuntu软件中心或命令行实用程序（<code>例如apt或apt-get</code>）安装软件包时，这些软件包是从一个或多个apt软件存储库中下载的。 我们可以使用 apt 命令安装、更新、卸载软件包。</p>\n<p>Ubuntu 软件包查找: <a href=\"https://packages.ubuntu.com/\" target=\"_blank\" rel=\"noopener\">https://packages.ubuntu.com/</a></p>\n<p>Tips : APT存储库是一个网络服务器或本地目录，其中包含可被APT工具读取的deb包和元数据文件。</p>\n<p>Tips : 尽管默认的Ubuntu存储库中有成千上万的应用程序可用，但有时您可能需要从第三方存储库中安装软件,所以我们常常会添加apt仓库地址。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#第一步，需要修改软件源配置文件的各个配置项中的版本标识。类似于将以下配置项。</span></span><br><span class=\"line\">  deb http://cn.archive.ubuntu.com/ubuntu/  dapper main restricted  </span><br><span class=\"line\"><span class=\"comment\">#修改为：</span></span><br><span class=\"line\">  deb http://cn.archive.ubuntu.com/ubuntu/  feisty  main restricted</span><br><span class=\"line\"><span class=\"comment\">#第二步，使用“ apt-get update ”命令刷新软件包更新列表。</span></span><br><span class=\"line\"><span class=\"comment\">#第三步，使用“ apt-get dist-upgrade ”命令为系统升级新的版本。 #更新系统版本</span></span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p><strong>语法参数:</strong><br>apt-get 是一个用于下载和安装软件包的简易命令行界面，最常用命令是 update 和 install。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 语法参数:</span></span><br><span class=\"line\">apt [-h] [-o=config_string] [-c=config_file] [-t=target_release] [-a=architecture] &#123;list | search | show | update | install pkg [&#123;=pkg_version_number | /target_release&#125;]...  | remove pkg... | upgrade | full-upgrade | edit-sources | &#123;-v | --version&#125; | &#123;-h | --<span class=\"built_in\">help</span>&#125;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 命令：</span></span><br><span class=\"line\">  update - 取回更新的软件包列表信息</span><br><span class=\"line\">  upgrade - 进行一次升级</span><br><span class=\"line\">  install - 安装新的软件包(注：软件包名称是 libc6 而非 libc6.deb)</span><br><span class=\"line\">  remove - 卸载软件包</span><br><span class=\"line\">  autoremove - 卸载所有自动安装且不再使用的软件包</span><br><span class=\"line\">  purge - 卸载并清除软件包的配置</span><br><span class=\"line\">  <span class=\"built_in\">source</span> - 下载源码包文件</span><br><span class=\"line\">  build-dep - 为源码包配置所需的编译依赖关系</span><br><span class=\"line\">  dist-upgrade - 发布版升级，见 apt-get(8)</span><br><span class=\"line\">  dselect-upgrade - 根据 dselect 的选择来进行升级</span><br><span class=\"line\">  clean - 删除所有已下载的包文件</span><br><span class=\"line\">  autoclean - 删除已下载的旧包文件</span><br><span class=\"line\">  check - 核对以确认系统的依赖关系的完整性</span><br><span class=\"line\">  changelog - 下载指定软件包，并显示其changelog</span><br><span class=\"line\">  download - 下载指定的二进制包到当前目录</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 选项：</span></span><br><span class=\"line\">  -h  本帮助文档。</span><br><span class=\"line\">  -q  让输出可作为日志 - 不显示进度</span><br><span class=\"line\">  -qq 除了错误外，什么都不输出</span><br><span class=\"line\">  -d  仅仅下载 - 【不】安装或解开包文件</span><br><span class=\"line\">  -s  不作实际操作。只是依次模拟执行命令</span><br><span class=\"line\">  -y  对所有询问都回答是(Yes)，同时不作任何提示</span><br><span class=\"line\">  -f  当出现破损的依赖关系时，程序将尝试修正系统</span><br><span class=\"line\">  -m  当有包文件无法找到时，程序仍尝试继续执行</span><br><span class=\"line\">  -u  显示已升级的软件包列表</span><br><span class=\"line\">  -b  在下载完源码包后，编译生成相应的软件包</span><br><span class=\"line\">  -V  显示详尽的版本号</span><br><span class=\"line\">  -c=? 读取指定配置文件</span><br><span class=\"line\">  -o=? 设置任意指定的配置选项，例如 -o dir::cache=/tmp</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#apt [选项] 命令</span></span><br><span class=\"line\">apt search|install|remove  [package]  <span class=\"comment\">#搜索安装移除</span></span><br><span class=\"line\">apt reinstall [package]  <span class=\"comment\">#重新安装</span></span><br><span class=\"line\">apt update  <span class=\"comment\">#- 更新可用软件包列表</span></span><br><span class=\"line\">apt upgrade  <span class=\"comment\">#- 通过 安装/升级 软件来更新系统</span></span><br><span class=\"line\">apt full-upgrade  <span class=\"comment\">#- 通过 卸载/安装/升级 来更新系统</span></span><br><span class=\"line\">apt edit-sources <span class=\"comment\">#- 编辑软件源信息文件</span></span><br><span class=\"line\">apt autoremove  <span class=\"comment\">#卸载所有自动安装且不再使用的软件包</span></span><br><span class=\"line\">apt show [package]   <span class=\"comment\">#显示软件包具体信息例如：版本号，安装大小，依赖关系，bug报告等等。</span></span><br><span class=\"line\">apt list --upgradeable   <span class=\"comment\">#显示可升级的软件包</span></span><br><span class=\"line\">apt list --installed     <span class=\"comment\">#显示已安装的软件包</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># apt-get [选项] 命令</span></span><br><span class=\"line\"><span class=\"comment\"># apt-get [选项] source 软件包1 [软件包2 ...</span></span><br><span class=\"line\">apt-get search [package] <span class=\"comment\">#搜索软件包</span></span><br><span class=\"line\">apt-get install|remove [package]  <span class=\"comment\">#安装或移除软件包</span></span><br><span class=\"line\">apt-get reinstall [package]   <span class=\"comment\">#重新安装</span></span><br><span class=\"line\"></span><br><span class=\"line\">apt-get update      <span class=\"comment\">#取回更新的软件包列表信息，返回三种状态：一是命中，一是获取，一是忽略。</span></span><br><span class=\"line\">apt-get update --fix-missing [package]  <span class=\"comment\">#更新软件列表/更新异常索引文件</span></span><br><span class=\"line\">apt-get upgrade          <span class=\"comment\">#更新升级软件包</span></span><br><span class=\"line\">apt-get dselect-upgrade  <span class=\"comment\">#使用 dselect 升级</span></span><br><span class=\"line\">apt-get dist-upgrade     <span class=\"comment\"># 发行版升级 (升级系统到新版本)</span></span><br><span class=\"line\"></span><br><span class=\"line\">apt-get purge  <span class=\"comment\">#卸载并清除软件包的配置</span></span><br><span class=\"line\">apt-get --purge remove|autoremove   <span class=\"comment\"># package 删除包及其依赖的软件包+配置文件等</span></span><br><span class=\"line\"></span><br><span class=\"line\">apt-get autoclean        <span class=\"comment\">#删除已下载的旧包文件</span></span><br><span class=\"line\">apt-get clean &amp;&amp; sudo apt-get autoclean  <span class=\"comment\">#清理无用的包</span></span><br><span class=\"line\">apt-get check            <span class=\"comment\">#核对以确认系统的依赖关系的完整性</span></span><br><span class=\"line\"></span><br><span class=\"line\">apt-get <span class=\"built_in\">source</span> package     <span class=\"comment\">#下载该包的源代码</span></span><br><span class=\"line\">apt-get build-dep package  <span class=\"comment\">#为源码包配置所需的编译依赖关系</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># By default apt-get -d install will save .deb in /var/cache/apt/archives and apt-get download in current directory</span></span><br><span class=\"line\">apt-get download [package]  <span class=\"comment\"># 下载指定的二进制包到当前目录</span></span><br><span class=\"line\">apt-get -d install [package]     <span class=\"comment\"># 下载指定的二进制包到当前目录</span></span><br><span class=\"line\"> </span><br><span class=\"line\">apt-get changelog [package] <span class=\"comment\">#下载指定软件包，并显示其变更日志（changelog）</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>基础实例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1) 安装软件包</span></span><br><span class=\"line\">apt-get install PackageName                 <span class=\"comment\"># 普通安装</span></span><br><span class=\"line\">apt-get --reinstall install PackageName     <span class=\"comment\"># 重新安装</span></span><br><span class=\"line\">apt-get install PackageName=VersionName     <span class=\"comment\"># 安装指定包的指定版本</span></span><br><span class=\"line\">apt-get install -f                          <span class=\"comment\"># 修复依赖关系</span></span><br><span class=\"line\">apt-get build-dep PackageName               <span class=\"comment\"># 安装源码包所需要的编译环境</span></span><br><span class=\"line\">apt-get <span class=\"built_in\">source</span> PackageName                  <span class=\"comment\"># 下载软件包的源码</span></span><br><span class=\"line\"><span class=\"comment\"># - 只下载`nfs-common rpcbind`相关软件包和依赖包不进行安装其下载目录为`/var/apt/cache/archive`</span></span><br><span class=\"line\">apt install -d nfs-common rpcbind          </span><br><span class=\"line\">apt --fix-broken install linux-headers-5.4.0-47  <span class=\"comment\"># 修理坏的软件包</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2) 卸载软件包</span></span><br><span class=\"line\">apt-get remove PackageName                  <span class=\"comment\"># 删除软件包, 保留配置文件</span></span><br><span class=\"line\">apt-get purge PackageName                   <span class=\"comment\"># 删除软件包, 同时删除配置文件</span></span><br><span class=\"line\">apt-get autoremove PackageName              <span class=\"comment\"># 删除软件包, 同时删除为满足依赖而自动安装且不再使用的软件包</span></span><br><span class=\"line\">apt-get --purge remove PackageName          <span class=\"comment\"># 删除软件包, 同时删除配置文件</span></span><br><span class=\"line\">apt-get --purge autoremove PackageName      <span class=\"comment\"># 删除软件包, 删除配置文件, 删除不再使用的依赖包</span></span><br><span class=\"line\">apt-get clean &amp;&amp; apt-get autoclean          <span class=\"comment\"># 清除已下载的软件包 和 旧软件包</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3) 更新软件包</span></span><br><span class=\"line\">apt-get clean &amp;&amp; apt-get update            <span class=\"comment\"># 更新安装源(Source)</span></span><br><span class=\"line\">apt-get upgrade                            <span class=\"comment\"># 更新已安装的软件包</span></span><br><span class=\"line\">apt-get dist-upgrade                       <span class=\"comment\"># 更新已安装的软件包(识别并处理依赖关系的改变)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4) 查询软件包</span></span><br><span class=\"line\">apt list                                   <span class=\"comment\"># 列出已安装的所有软件包 或者 dpkg -l      </span></span><br><span class=\"line\">apt show git                               <span class=\"comment\"># 显示指定软件信息</span></span><br><span class=\"line\">  <span class=\"comment\"># Package: git</span></span><br><span class=\"line\">  <span class=\"comment\"># Version: 1:2.20.1-2</span></span><br><span class=\"line\">  <span class=\"comment\"># Priority: optional</span></span><br><span class=\"line\">  <span class=\"comment\"># Section: vcs</span></span><br><span class=\"line\">  <span class=\"comment\"># Maintainer: Gerrit Pape &lt;pape@smarden.org&gt;</span></span><br><span class=\"line\">  <span class=\"comment\"># Installed-Size: 36.1 MB</span></span><br><span class=\"line\">apt-get check                              <span class=\"comment\"># 检查是否有损坏的依赖</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 5) 允许下载被hold锁定版本的软件</span></span><br><span class=\"line\">sudo apt-get install -y kubelet=1.23.6-00 --allow-change-held-packages</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p><strong>补充使用:</strong></p>\n<ul>\n<li>1.-o 选项使用以及代理获取更新<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.squid 代理使用进行获取更新</span></span><br><span class=\"line\">sudo apt -o Acquire::http::proxy=<span class=\"string\">\"http://192.168.12.215:3128/\"</span> update </span><br><span class=\"line\"><span class=\"comment\"># 2.选择IPv4或IPv6通道方式下载更新(可以设置别名)</span></span><br><span class=\"line\">sudo apt-get -o Acquire::ForceIPv4=<span class=\"literal\">true</span> update</span><br><span class=\"line\">sudo apt-get -o Acquire::ForceIPv6=<span class=\"literal\">true</span> upgrade</span><br><span class=\"line\"><span class=\"comment\"># alias apt-get=sudo apt-get -o Acquire::ForceIPv6=true’</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.如果你希望 apt-get 强制使用 IPv6 可以创建如下apt-get配置文件</span></span><br><span class=\"line\">/etc/apt/apt.conf.d/1000-force-ipv6-transport</span><br><span class=\"line\">Acquire::ForceIPv6 <span class=\"string\">\"true\"</span>;</span><br><span class=\"line\"><span class=\"comment\"># 同样如果你希望 apt-get 强制使用 IPv4 可以创建如下配置文件</span></span><br><span class=\"line\">etc/apt/apt.conf.d/1000-force-ipv4-transport</span><br><span class=\"line\">Acquire::ForceIPv4 <span class=\"string\">\"true\"</span>;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<h3 id=\"apt-cache-命令-软件包搜索\"><a href=\"#apt-cache-命令-软件包搜索\" class=\"headerlink\" title=\"apt-cache 命令 - 软件包搜索\"></a>apt-cache 命令 - 软件包搜索</h3><p><strong>基础语法:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-cache search package    <span class=\"comment\"># 搜索包 与 apt search 类似</span></span><br><span class=\"line\">apt-cache show package      <span class=\"comment\"># 获取包的相关信息，如说明、大小、版本等 与 apt show类似</span></span><br><span class=\"line\">apt-cache depends package   <span class=\"comment\"># 查看该软件包需要哪些依赖包</span></span><br><span class=\"line\">apt-cache rdepends package  <span class=\"comment\"># 查看该软件包被哪些包依赖</span></span><br><span class=\"line\">apt-cache pkgnames          <span class=\"comment\"># 列出所有软件包的名字</span></span><br><span class=\"line\">apt-cache policy            <span class=\"comment\"># 显示软件包的安装设置状态</span></span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p><strong>基础示例：</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 实例0.搜索命令在那些软件包之中</span></span><br><span class=\"line\">apt-cache search ifconfig</span><br><span class=\"line\">  <span class=\"comment\"># iproute2 - networking and traffic control tools</span></span><br><span class=\"line\">  <span class=\"comment\"># net-tools - NET-3 networking toolkit</span></span><br><span class=\"line\">  <span class=\"comment\"># gnome-nettool - network information tool for GNOME</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 实例1.获取软件包的相关信息, 如说明、大小、版本等</span></span><br><span class=\"line\">apt-cache show net-tools                </span><br><span class=\"line\">  <span class=\"comment\"># Package: net-tools</span></span><br><span class=\"line\">  <span class=\"comment\"># Architecture: amd64</span></span><br><span class=\"line\">  <span class=\"comment\"># Version: 1.60+git20180626.aebd88e-1ubuntu1</span></span><br><span class=\"line\">  <span class=\"comment\"># Multi-Arch: foreign</span></span><br><span class=\"line\">  <span class=\"comment\"># Priority: optional</span></span><br><span class=\"line\">  <span class=\"comment\"># Section: net</span></span><br><span class=\"line\">  <span class=\"comment\"># Origin: Ubuntu</span></span><br><span class=\"line\">  <span class=\"comment\"># Maintainer: Ubuntu Developers &lt;ubuntu-devel-discuss@lists.ubuntu.com&gt;</span></span><br><span class=\"line\">  <span class=\"comment\"># Original-Maintainer: net-tools Team &lt;team+net-tools@tracker.debian.org&gt;</span></span><br><span class=\"line\">  <span class=\"comment\"># Bugs: https://bugs.launchpad.net/ubuntu/+filebug</span></span><br><span class=\"line\">  <span class=\"comment\"># Installed-Size: 844</span></span><br><span class=\"line\">  <span class=\"comment\"># Depends: libc6 (&gt;= 2.14), libselinux1 (&gt;= 1.32)</span></span><br><span class=\"line\">  <span class=\"comment\"># Filename: pool/main/n/net-tools/net-tools_1.60+git20180626.aebd88e-1ubuntu1_amd64.deb</span></span><br><span class=\"line\">  <span class=\"comment\"># Size: 196392</span></span><br><span class=\"line\">  <span class=\"comment\"># MD5sum: 9c0c2ef6e21c4366564f38b15023f329</span></span><br><span class=\"line\">  <span class=\"comment\"># SHA1: f2c222b8afd37d8601335a3175976a1f4de43875</span></span><br><span class=\"line\">  <span class=\"comment\"># SHA256: 591808d272508bcafb28ab0b151e0d03a0c922a7f7f7e6469b41ec64c46b4a90</span></span><br><span class=\"line\">  <span class=\"comment\"># Homepage: http://sourceforge.net/projects/net-tools/</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 实例2.查看当前软包的补丁</span></span><br><span class=\"line\"><span class=\"variable\">$apt</span>-cache policy git  </span><br><span class=\"line\">  <span class=\"comment\"># git:</span></span><br><span class=\"line\">  <span class=\"comment\">#   已安装：1:2.20.1-2</span></span><br><span class=\"line\">  <span class=\"comment\">#   候选： 1:2.20.1-2</span></span><br><span class=\"line\">  <span class=\"comment\">#   版本列表：</span></span><br><span class=\"line\">  <span class=\"comment\"># *** 1:2.20.1-2 500</span></span><br><span class=\"line\">  <span class=\"comment\">#         500 http://mirrors.aliyun.com/kali kali-rolling/main amd64 Packages</span></span><br><span class=\"line\">  <span class=\"comment\">#         100 /var/lib/dpkg/status</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 实例3.软件包版本选择</span></span><br><span class=\"line\">$ apt-cache madison gcc</span><br><span class=\"line\">  <span class=\"comment\"># gcc | 4:9.3.0-1ubuntu2 | http://mirrors.aliyun.com/ubuntu focal/main amd64 Packages</span></span><br><span class=\"line\">  <span class=\"comment\"># gcc-defaults | 1.185.1ubuntu2 | http://mirrors.aliyun.com/ubuntu focal/main Sources</span></span><br><span class=\"line\">  <span class=\"comment\"># gcc-defaults-mipsen |    1.186.1 | http://mirrors.aliyun.com/ubuntu focal/universe Sources</span></span><br><span class=\"line\"> PackageName</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"apt-mark-命令-软件包标记\"><a href=\"#apt-mark-命令-软件包标记\" class=\"headerlink\" title=\"apt-mark 命令 - 软件包标记\"></a>apt-mark 命令 - 软件包标记</h3><p>描述: 显示、设置和取消设置软件包的各种设置 <code>(手动/自动)</code> 安装标记，也可以用来处理软件包的 dpkg(1) 选中状态，以及列出或过滤拥有某个标记的软件包。</p>\n<p><strong>语法格式:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 语法规则:</span></span><br><span class=\"line\">apt-mark &#123;-f=filename | &#123;auto | manual&#125; pkg...  | &#123;showauto | showmanual&#125; [pkg...] &#125; | &#123;-v | --version&#125; | &#123;-h | --<span class=\"built_in\">help</span>&#125;</span><br><span class=\"line\">apt-mark &#123;hold | unhold | install | remove | purge&#125; pkg...  | &#123;showhold | showinstall | showremove | showpurge&#125; [pkg...]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 常用命令:</span></span><br><span class=\"line\">* auto - 标记指定软件包为自动安装</span><br><span class=\"line\">* manual - 标记指定软件包为手动安装</span><br><span class=\"line\">* minimize-manual - 最小化手动用于将元包的依赖项（可传递的）标记为自动安装</span><br><span class=\"line\">* hold - 标记指定软件包为保留 (held back) 阻止软件自动更新</span><br><span class=\"line\">* unhold - 取消指定软件包的保留 (held back) 标记解除阻止自动更新</span><br><span class=\"line\">* showauto - 列出所有自动安装的软件包</span><br><span class=\"line\">* showhold – 列出设为保留的软件包</span><br><span class=\"line\">* showmanual - 列出所有手动安装的软件包</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 选项说明:</span></span><br><span class=\"line\">`-f=filename, --file=filename` : 从参数`filename`指定的文件名（而不是从默认位置）读取/写入包统计信息，默认位置是由配置项`Dir::State`定义的目录中的扩展状态。</span><br><span class=\"line\">`-c, --config-file` : 配置文件指定要使用的配置文件,程序将读取默认配置文件然后读取此配置文件,如果在解析默认配置文件之前需要设置配置设置，请指定一个带有`apt config`环境变量的文件。</span><br><span class=\"line\">`-o, --option` : 设置任意配置选项。语法是 `-o Foo::Bar=Bar-o` 和`--option`可以多次用于设置不同的选项。</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<p><strong>基础示例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># (1) 针对软件包操作设置。</span></span><br><span class=\"line\"><span class=\"comment\"># 保留用于将包标记为已保留，这将阻止自动安装、升级或删除包。</span></span><br><span class=\"line\">apt-mark hold kubeadm</span><br><span class=\"line\"><span class=\"comment\"># 用于取消先前设置的对包的保留，以允许再次执行更新操作。</span></span><br><span class=\"line\">apt-mark unhold kubeadm</span><br><span class=\"line\">apt-mark unhold libsmbclient samba-libs</span><br><span class=\"line\"><span class=\"comment\"># 用于以与其他show命令相同的方式打印保留的包列表。</span></span><br><span class=\"line\">apt-mark showhold kubeadm     <span class=\"comment\"># kubeadm</span></span><br><span class=\"line\">apt-mark showhold</span><br><span class=\"line\">  <span class=\"comment\"># kubeadm</span></span><br><span class=\"line\">  <span class=\"comment\"># kubectl</span></span><br><span class=\"line\">  <span class=\"comment\"># kubelet</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2) 列出所有手动安装的软件包。</span></span><br><span class=\"line\">apt-mark showmanual | wc -l   <span class=\"comment\"># 61</span></span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h3 id=\"add-apt-repository-命令-添加-apt-仓库\"><a href=\"#add-apt-repository-命令-添加-apt-仓库\" class=\"headerlink\" title=\"add-apt-repository 命令 - 添加 apt 仓库\"></a>add-apt-repository 命令 - 添加 apt 仓库</h3><p>描述: 在Ubuntu和所有其他基于Debian的发行版中，apt软件存储库在<code>/etc/apt/sources.list</code>文件中或在<code>/etc/apt/sources.list.d/</code>目录下的单独文件中定义(<code>目录中的存储库文件的名称必须以.list结尾</code>)。</p>\n<p><strong>方式1</strong><br>Tips : 除了上述方式进行添加apt仓库，其次是<code>add-apt-repository</code>命令<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /etc/apt/sources.list 文件的常规语法采用以下格式：</span></span><br><span class=\"line\">deb http://repo.tld/ubuntu distro component</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 参数1: 定义档案的类型，存档类型可以是 deb 表示存储库包含.deb个软件包 或 deb-src 表示源软件包。</span></span><br><span class=\"line\"><span class=\"comment\"># 参数2: 存储库URL</span></span><br><span class=\"line\"><span class=\"comment\"># 参数3: 指定分发代码名称, 例如`beaver,xenial`等</span></span><br><span class=\"line\"><span class=\"comment\"># 参数4: 是存储库组件或类别, 默认的Ubuntu存储库分为四个部分组件，main 和 restricted与受限组件Universe和multiverse。通常第三方存储库只有一个类别。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 实践 ( Ubuntu 20.04.2 LTS ) 案例</span></span><br><span class=\"line\"><span class=\"comment\"># 配置文件修改</span></span><br><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 手动命令添加存储库,您还需要手动将公共存储库密钥导入系统</span></span><br><span class=\"line\">curl -L https://couchdb.apache.org/repo/bintray-pubkey.asc | sudo apt-key add -</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"deb https://apache.bintray.com/couchdb-deb <span class=\"variable\">$(lsb_release -cs)</span> main\"</span> | sudo tee -a /etc/apt/sources.list.d/couchdb.list</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 移除指定ppa的包</span></span><br><span class=\"line\">sudo add-apt-repository --remove ppa:finalterm/daily</span><br></pre></td></tr></table></figure></p>\n<p>Tips : 注意大多数存储库都提供公钥以对需要下载和导入的已下载软件包进行身份验证。</p>\n<p>Tips : 当要添加或删除存储库，您需要以具有sudo访问权限或root用户的身份登录。</p>\n<p><br></p>\n<p><strong>方式2</strong><br>描述: add-apt-repository实用程序包含在software-properties-common程序包中。要安装它请运行以下命令：<code>sudo apt install software-properties-common</code></p>\n<p><strong>基础语法:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 语法</span></span><br><span class=\"line\">add-apt-repository [options] repository</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 参数</span></span><br><span class=\"line\">repository : 可以是可以添加到sources.list文件 (例如 `deb http://repo.tld/ubuntu distro component`)的常规存储库条目，也可以是`ppa:&lt;user&gt;/&lt;ppa-name&gt;`格式的PPA存储库。</span><br></pre></td></tr></table></figure></p>\n<p>Tips : PPA存储库个人软件包档案（PPA）是一项服务，允许用户上传使用Launchpad构建和发布的Ubuntu源软件包作为apt信息库。</p>\n<p><br/></p>\n<p><strong>基础示例:</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.官方存储库中安装 MongoDB, 首先导入存储库公钥，其次添加MongoDB存储库</span></span><br><span class=\"line\">sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4</span><br><span class=\"line\">sudo add-apt-repository <span class=\"string\">'deb [arch=amd64] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.0 multiverse'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.如果出于任何原因要删除先前启用的存储库，请使用--remove选项：</span></span><br><span class=\"line\">sudo add-apt-repository --remove <span class=\"string\">'deb [arch=amd64] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.0 multiverse'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.添加提供 FFmpeg 版本4.x的Jonathon F的PPA存储库, 此时它会在/etc/apt/sources.list.d/目录下创建一个新文件</span></span><br><span class=\"line\">sudo add-apt-repository ppa:jonathonf/ffmpeg-4</span><br><span class=\"line\">  <span class=\"comment\"># Press [ENTER] to continue or Ctrl-c to cancel adding it.  # 按 Enter 将启用存储库</span></span><br><span class=\"line\">sudo apt install ffmpeg</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 4.Ubuntu 软件源库添加设置稳定docker软件源存储库</span></span><br><span class=\"line\">sudo add-apt-repository \\</span><br><span class=\"line\">  <span class=\"string\">\"deb [arch=amd64] https://download.docker.com/linux/ubuntu \\</span></span><br><span class=\"line\"><span class=\"string\">  <span class=\"variable\">$(lsb_release -cs)</span> \\</span></span><br><span class=\"line\"><span class=\"string\">  stable\"</span></span><br></pre></td></tr></table></figure></p>\n<hr>\n<h2 id=\"0x02-Apt-配置扩充\"><a href=\"#0x02-Apt-配置扩充\" class=\"headerlink\" title=\"0x02 Apt 配置扩充\"></a>0x02 Apt 配置扩充</h2><h3 id=\"0-在Ubuntu-20-04-Focal-Fossas进行APT-Proxy-代理下载软件设置\"><a href=\"#0-在Ubuntu-20-04-Focal-Fossas进行APT-Proxy-代理下载软件设置\" class=\"headerlink\" title=\"0.在Ubuntu 20.04 Focal Fossas进行APT Proxy 代理下载软件设置\"></a>0.在Ubuntu 20.04 Focal Fossas进行APT Proxy 代理下载软件设置</h3><p>Ubuntu 20.04 与 18.04 版本<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Ubuntu 18.04</span></span><br><span class=\"line\">sudo vi/etc/apt/apt.conf.d/98proxy</span><br><span class=\"line\"><span class=\"comment\"># Acquire::http::proxy \"http://username:password@proxy_ip:proxy_port/\";</span></span><br><span class=\"line\"><span class=\"comment\"># Acquire::ftp::proxy \"ftp://username:password@proxy_ip:proxy_port/\";</span></span><br><span class=\"line\"><span class=\"comment\"># Acquire::https::proxy \"https://username:password@proxy_ip:proxy_port/\";</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Ubuntu 20.04</span></span><br><span class=\"line\">sudo tee /etc/apt/apt.conf.d/30proxy &lt;&lt;<span class=\"string\">'EOF'</span></span><br><span class=\"line\">Acquire::http::proxy <span class=\"string\">\"http://192.168.12.215:3128\"</span>;</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 临时生效</span></span><br><span class=\"line\">sudo apt -o Acquire::http::proxy=<span class=\"string\">\"http://192.168.12.215:3128/\"</span> update</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<h3 id=\"1-在Ubuntu-20-04-Focal-Fossas上进行Apt代理客户端配置与apt代理服务器配置\"><a href=\"#1-在Ubuntu-20-04-Focal-Fossas上进行Apt代理客户端配置与apt代理服务器配置\" class=\"headerlink\" title=\"1.在Ubuntu 20.04 Focal Fossas上进行Apt代理客户端配置与apt代理服务器配置\"></a>1.在Ubuntu 20.04 Focal Fossas上进行Apt代理客户端配置与apt代理服务器配置</h3><p>描述:你正在阅读一个关于如何配置apt代理服务器和客户端在Ubuntu 20.04 Focal Fossa 的快速教程<br>环境说明:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$lsb_release</span> -crid</span><br><span class=\"line\">Distributor ID: Ubuntu</span><br><span class=\"line\">Description:    Ubuntu 20.04.1 LTS</span><br><span class=\"line\">Release:        20.04</span><br><span class=\"line\">Codename:       focal</span><br></pre></td></tr></table></figure></p>\n<p><br/></p>\n<p>Ubuntu apt 代理服务器安装操作流程:</p>\n<ul>\n<li>Step 1.安装配置apt cacher代理服务<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install -o Acquire::http::proxy=<span class=\"string\">\"http://192.168.12.215:3128/\"</span> apt-cacher -y</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<hr>\n<h2 id=\"0x04-入坑出坑\"><a href=\"#0x04-入坑出坑\" class=\"headerlink\" title=\"0x04 入坑出坑\"></a>0x04 入坑出坑</h2><p><strong>问题1.运行apt-get进行安装软件时候提示<code>E: Unable to locate package vim[软件名称]</code>;</strong></p>\n<ul>\n<li>问题原因: 当然软件源仓库中没你要得软件或者您还未更新拉取软件仓库(在docker中常常遇到)</li>\n<li>解决方式:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># (1) 更换软件源(详看Linux发行版的镜像网站及开源软件收集)</span></span><br><span class=\"line\"><span class=\"comment\"># (2) 更新软件源仓库</span></span><br><span class=\"line\">apt update</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<p><strong>问题2.<code>E: Unmet dependencies. Try &#39;apt --fix-broken install&#39; with no packages (or specify a solution).</code></strong></p>\n<ul>\n<li>错误描述:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">The following packages were automatically installed and are no longer required:</span><br><span class=\"line\">  linux-headers-5.4.0-42 linux-headers-5.4.0-42-generic linux-image-5.4.0-42-generic linux-modules-5.4.0-42-generic linux-modules-extra-5.4.0-42-generic</span><br><span class=\"line\">Use <span class=\"string\">'sudo apt autoremove'</span> to remove them.</span><br><span class=\"line\"></span><br><span class=\"line\">你可能想运行<span class=\"string\">\"apt—fix-broken install\"</span>来纠正这些错误。</span><br><span class=\"line\">以下软件包有未满足的依赖性:</span><br><span class=\"line\">linux-headers-generic:取决于:linux-headers-5.4.0-58-generic但它不会被安装</span><br></pre></td></tr></table></figure></li>\n<li>解决方式:未满足的依赖关系。尝试不带软件包的“apt -fix-broken install”(或指定一个解决方案)。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt --fix-broken install</span><br><span class=\"line\">sudo apt autoremove</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<p><strong>问题3.安装环境包时出现Could not get lock /var/lib/dpkg/lock - open解决方法</strong></p>\n<ul>\n<li>问题复原:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt autoremove --purge -y snapd</span><br><span class=\"line\">Waiting <span class=\"keyword\">for</span> cache lock: Could not get lock /var/lib/dpkg/lock. It is held by process 321016 (dWaiting <span class=\"keyword\">for</span> cache lock: Could not get lock /var/lib/dpkg/lock. It is held by process 321016 (dWaiting <span class=\"keyword\">for</span> cache lock: Could not get lock /var/lib/dpkg/lock. It is held by process 321016 (dpkg)... Error!</span><br><span class=\"line\">E: dpkg was interrupted, you must manually run <span class=\"string\">'sudo dpkg --configure -a'</span> to correct the problem.</span><br></pre></td></tr></table></figure></li>\n<li>问题原因: 在这个时候主要是因为<code>apt</code>还在运行或者上次执行内核安装或者apt升级时出现错误;</li>\n<li>解决办法:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 方法1：找到并且杀掉所有的apt-get 和 apt进程</span></span><br><span class=\"line\">ps -A | grep apt</span><br><span class=\"line\">sudo <span class=\"built_in\">kill</span> -9 进程ID</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 方法2.删除锁定文件 /var/lib/apt/lists/、/var/lib/dpkg/、/var/cache/apt/archives/ 中</span></span><br><span class=\"line\"><span class=\"comment\"># (1) 首先运行下面的命令来移除 `/var/lib/dpkg/` 文件夹下的锁定文件：</span></span><br><span class=\"line\">$ sudo rm /var/lib/dpkg/lock</span><br><span class=\"line\">$ sudo dpkg --configure -a</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># (2) 也可以如下删除 /var/lib/apt/lists/ 以及缓存文件夹下的锁定文件：</span></span><br><span class=\"line\">$ sudo rm /var/lib/apt/lists/lock</span><br><span class=\"line\">$ sudo rm /var/cache/apt/archives/lock</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<p><strong>问题4.apt安装软件时提示Target Packages (multiverse/binary-amd64/Packages) is configured multiple times in /etc/apt/sources.list错误</strong></p>\n<ul>\n<li>错误信息:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">W: Target Packages (multiverse/binary-amd64/Packages) is configured multiple <span class=\"built_in\">times</span> <span class=\"keyword\">in</span> /etc/apt/sources.list:26 and /etc/apt/sources.list:53</span><br></pre></td></tr></table></figure></li>\n<li>问题原因：更新源重复配置</li>\n<li>解决办法: 将 <code>/etc/apt/sources.list</code>中 apt 仓库地址重复源删掉即可</li>\n</ul>\n<p><br></p>\n<p><strong>问题5.使用apt update命令来同步包索引文件时提示ppa包 404 无法找到</strong></p>\n<ul>\n<li>错误信息:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Err http://ppa.launchpad.net trusty/main amd64 Packages 404  Not Found</span><br><span class=\"line\">Err http://ppa.launchpad.net trusty/main i386 Packages 404  Not Found</span><br><span class=\"line\">W: Failed to fetch http://ppa.launchpad.net/finalterm/daily/Ubuntu/dists/trusty/main/binary-amd64/Packages  404  Not Found</span><br><span class=\"line\">W: Failed to fetch http://ppa.launchpad.net/finalterm/daily/ubuntu/dists/trusty/main/binary-i386/Packages  404  Not Found</span><br></pre></td></tr></table></figure></li>\n<li>解决办法: 鉴别并清除破损的PPA仓库。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.首先找出那些引起\"404 无法找到错误的PPA。</span></span><br><span class=\"line\">$ sudo apt-get update | grep <span class=\"string\">\"Failed\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 2.例如在本例中，Ubuntu Trusty不再支持的PPA仓库是\"ppa:finalterm/daily\",我们将其移除。</span></span><br><span class=\"line\">$ sudo add-apt-repository --remove ppa:finalterm/daily</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 3.最后再次执行 apt-get update 命令来检查它们是否都被成功移除。</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>温馨提示: 你也可以直接在 <code>/etc/apt/sources.list.d/</code> 仓库源中利用编辑器直接编辑。</p>\n<p><br></p>\n<p><strong>问题6.在执行更新系统内核命令时时报 Errors were encountered while processing 错误</strong></p>\n<ul>\n<li>错误信息:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(Reading database ... 149871 files and directories currently installed.)</span><br><span class=\"line\">Removing linux-modules-extra-5.4.0-59-generic (5.4.0-59.65) ...</span><br><span class=\"line\">dpkg: error processing package linux-modules-extra-5.4.0-59-generic (--remove):</span><br><span class=\"line\"> unable to securely remove <span class=\"string\">'/lib/modules/5.4.0-59-generic/kernel/drivers/input/keyboard/xtkbd.ko.dpkg-tmp'</span>: Input/output error</span><br><span class=\"line\">dpkg: too many errors, stopping</span><br><span class=\"line\">Errors were encountered <span class=\"keyword\">while</span> processing:  linux-modules-extra-5.4.0-59-generic <span class=\"comment\"># 错误点</span></span><br><span class=\"line\">Processing was halted because there were too many errors.</span><br><span class=\"line\">E: Sub-process /usr/bin/dpkg returned an error code (1)</span><br></pre></td></tr></table></figure></li>\n<li>解决方法<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /var/lib/dpkg</span><br><span class=\"line\">sudo mv info&#123;,.bak&#125; &amp;&amp; sudo mkdir info</span><br><span class=\"line\">sudo apt update</span><br><span class=\"line\"><span class=\"comment\"># sudo apt-get upgrade  # 生产环境执行该条命令时,一定要慎重、慎重、慎重、慎重</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br/></p>\n<p><strong>问题7.在执行apt更新下载安装输出 dpkg 无法恢复的致命错误</strong></p>\n<ul>\n<li>错误信息:<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">已下载 17.6 kB，耗时 0秒 (238 kB/s)</span><br><span class=\"line\">dpkg: 无法恢复的致命错误，中止:</span><br><span class=\"line\">在 stateoverride 文件中发现未知的系统用户 <span class=\"string\">'redis'</span>；该系统用户在重载之前被移除。</span><br><span class=\"line\">这很有可能是一个打包Bug。您可以通过 dpkg-statoverride 手动移除重载来进行恢复</span><br><span class=\"line\">E: Sub-process /usr/bin/dpkg returned an error code (2)</span><br></pre></td></tr></table></figure></li>\n<li>解决办法: 上述说明在在 stateoverride 文件中发现未知的系统用户 ‘redis’, 我们便可从此文件入手。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vi /var/lib/dpkg/statoverride</span><br><span class=\"line\">geoclue geoclue 755 /var/lib/geoclue</span><br><span class=\"line\">root lp 775 /var/<span class=\"built_in\">log</span>/hp/tmp</span><br><span class=\"line\">root crontab 2755 /usr/bin/crontab</span><br><span class=\"line\">root mlocate 2755 /usr/bin/mlocate</span><br><span class=\"line\">root ssl-cert 710 /etc/ssl/private</span><br><span class=\"line\">root messagebus 4754 /usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class=\"line\"><span class=\"comment\"># redis redis 640 /etc/redis/redis.conf  # 果不其然, 我们系统中已经没有此用户了, 此时我们只需要将此行删除即可。</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ apt update <span class=\"comment\"># 完美解决</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n","comments":true,"excerpt":"[TOC]<br>","categories":[{"name":"Linux命令","path":"api/categories/Linux命令.json"}],"tags":[{"name":"系统命令","path":"api/tags/系统命令.json"}]}