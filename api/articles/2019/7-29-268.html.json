{"title":"Ansible自动化运维学习笔记3","slug":"系统运维/自动化运维/Ansible/Ansible自动化运维学习笔记3","date":"2019-07-29T06:34:30.000Z","updated":"2023-01-31T02:29:10.467Z","url":"2019/7-29-268.html","path":"api/articles/2019/7-29-268.html.json","covers":["https://img.weiyigeek.top/2019/1/20190801110342.png","https://img.weiyigeek.top/2019/1/20190801142628.png"],"content":"<p>[TOC]</p>\n<a id=\"more\"></a>\n<h4 id=\"ansbile-循环\"><a href=\"#ansbile-循环\" class=\"headerlink\" title=\"ansbile 循环\"></a>ansbile 循环</h4><p>在使用ansible的过程中，我们经常需要处理一些返回信息而这些返回信息中，通常可能不是单独的一条返回信息而是一个信息列表;</p>\n<p><strong>循环常用关键字：</strong></p>\n<ul>\n<li>with_items : 迭代列表里面的值或者变量的结果,不分层次全部输出</li>\n<li>with_list : 会循环的输出列表（最外层大列表）中的每一项,分层次</li>\n<li>with_flattened : 与items相同将嵌套列表”拉平展开”，循环的处理每个元素</li>\n<li>with_together : 将两个列表中的元素”对齐合并-一一对应</li>\n<li>with_cartesian : 将每个小列表中的元素按照”笛卡尔的方式”组合后，循环的处理每个组合</li>\n<li>with_nested : 与cartesian相同将每个小列表中的元素按照”笛卡尔的方式”组合</li>\n<li>with_indexed_items : 根据列表设置索引值，可根据索引值取值</li>\n<li>with_sequence : 迭代序列选择步长和输出指定格式话</li>\n<li>with_random_choice : 列表中随机返回一个值</li>\n<li>with_dict : 遍历字典key与value</li>\n<li>with_subelements : 遍历复合结构的字典属性</li>\n<li>with_file : 读取ansible主机中的文件中内容并且遍历</li>\n<li>with_fileglob : 读取ansible主机中指定的目录中匹配符合模式的文件名，只包括文件不包括目录;</li>\n</ul>\n<p><br></p>\n<h5 id=\"with-items-关键字\"><a href=\"#with-items-关键字\" class=\"headerlink\" title=\"with_items 关键字\"></a>with_items 关键字</h5><p><em>如果我们想要循环的处理信息列表中的每一条信息，我们该怎么办呢？</em><br>答：需要采用with_items关键字指定遍历的变量和item变量进行迭代输出;<code>即&quot;with_items&quot;关键字会把返回的列表信息自动处理</code>，将每一条信息单独放在一个名为”item”的变量中，我们只要获取到名为”item”变量的变量值，即可循环的获取到列表中的每一条信息</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#语法1:</span></span><br><span class=\"line\">  tasks:</span><br><span class=\"line\">  - debug:</span><br><span class=\"line\">      msg: <span class=\"string\">\"&#123;&#123;item&#125;&#125;\"</span></span><br><span class=\"line\">    with_items: [ 1, 2, 3 ]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#语法2：</span></span><br><span class=\"line\">  tasks:</span><br><span class=\"line\">  - debug:</span><br><span class=\"line\">      msg: <span class=\"string\">\"&#123;&#123;item&#125;&#125;\"</span></span><br><span class=\"line\">    with_items: [ 1, 2, 3 ]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#语法3：</span></span><br><span class=\"line\"> tasks:</span><br><span class=\"line\">  - debug:</span><br><span class=\"line\">      msg: <span class=\"string\">\"&#123;&#123;item.test1&#125;&#125;\"</span> <span class=\"comment\">#\"a\"和\"c\"会被输出。</span></span><br><span class=\"line\">    with_items:</span><br><span class=\"line\">    - &#123; test1: a, test2: b &#125;</span><br><span class=\"line\">    - &#123; test1: c, test2: d &#125; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#语法4:jinja2是一种模板语言，jinja2是一个基于python的模板引擎</span></span><br><span class=\"line\">- debug:</span><br><span class=\"line\">    msg:</span><br><span class=\"line\">      <span class=\"string\">\"&#123;% for i in item %&#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#123;&#123; i &#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">      &#123;% endfor %&#125;\"</span></span><br><span class=\"line\">    with_items : [ 1, 2, 3 ]</span><br></pre></td></tr></table></figure>\n<p>示例1：如果我想要获取到清单中所有分组的主机的主机名,并且获取返回信息中的第二条信息;<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible testA -m debug -a <span class=\"string\">\"msg=&#123;&#123;groups.all&#125;&#125;\"</span></span><br><span class=\"line\"><span class=\"comment\"># 10.10.107.221 | SUCCESS =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#     \"msg\": [</span></span><br><span class=\"line\"><span class=\"comment\">#         \"local\",</span></span><br><span class=\"line\"><span class=\"comment\">#         \"10.10.107.221\",</span></span><br><span class=\"line\"><span class=\"comment\">#         \"10.20.172.179\"</span></span><br><span class=\"line\"><span class=\"comment\">#     ]</span></span><br><span class=\"line\"><span class=\"comment\"># &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#获取第二项</span></span><br><span class=\"line\">ansible testA -m debug -a <span class=\"string\">\"msg=&#123;&#123;groups.all[1]&#125;&#125;\"</span></span><br><span class=\"line\"><span class=\"comment\"># 10.10.107.221 | SUCCESS =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#     \"msg\": \"10.10.107.221\"</span></span><br><span class=\"line\"><span class=\"comment\"># &#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>实际演示：<br><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># cat &gt; withitems.yml&lt;&lt;END</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">- hosts:</span> <span class=\"string\">local</span></span><br><span class=\"line\"><span class=\"attr\">  remote_user:</span> <span class=\"string\">root</span></span><br><span class=\"line\"><span class=\"attr\">  gather_facts:</span> <span class=\"literal\">no</span></span><br><span class=\"line\"><span class=\"attr\">  tasks:</span></span><br><span class=\"line\"><span class=\"attr\">  - debug:</span></span><br><span class=\"line\"><span class=\"attr\">      msg:</span> <span class=\"string\">\"<span class=\"template-variable\">&#123;&#123;item&#125;&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"attr\">    with_items:</span> <span class=\"string\">\"<span class=\"template-variable\">&#123;&#123;groups.all&#125;&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"attr\">  - debug:</span></span><br><span class=\"line\"><span class=\"attr\">      msg:</span> <span class=\"string\">\"&#123;% for i in item %&#125;<span class=\"template-variable\">&#123;&#123; i &#125;&#125;</span>&#123;% endfor %&#125;\"</span></span><br><span class=\"line\">    <span class=\"string\">with_items</span> <span class=\"string\">:</span> <span class=\"string\">[\"1\",\"2\",\"3\"]</span>  <span class=\"comment\">#注意需要是字符串类型</span></span><br><span class=\"line\"><span class=\"string\">END</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#执行结果</span></span><br><span class=\"line\"><span class=\"string\">ansible-playbook</span> <span class=\"string\">withitems.yml</span></span><br><span class=\"line\"><span class=\"string\">TASK</span> <span class=\"string\">[debug]</span>  <span class=\"comment\">#返回信息中的每一条信息都会循环的被debug模块处理 (一条执行一次)</span></span><br><span class=\"line\"><span class=\"attr\">ok:</span> <span class=\"string\">[local]</span> <span class=\"string\">=&gt;</span> <span class=\"string\">(item=local)</span> <span class=\"string\">=&gt;</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\"><span class=\"attr\">    \"msg\":</span> <span class=\"string\">\"local\"</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"attr\">ok:</span> <span class=\"string\">[local]</span> <span class=\"string\">=&gt;</span> <span class=\"string\">(item=10.10.107.221)</span> <span class=\"string\">=&gt;</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\"><span class=\"attr\">    \"msg\":</span> <span class=\"string\">\"10.10.107.221\"</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"attr\">ok:</span> <span class=\"string\">[local]</span> <span class=\"string\">=&gt;</span> <span class=\"string\">(item=10.20.172.179)</span> <span class=\"string\">=&gt;</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\"><span class=\"attr\">    \"msg\":</span> <span class=\"string\">\"10.20.172.179\"</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#jinja2语言循环语法</span></span><br><span class=\"line\"><span class=\"string\">TASK</span> <span class=\"string\">[debug]</span> </span><br><span class=\"line\"><span class=\"attr\">ok:</span> <span class=\"string\">[local]</span> <span class=\"string\">=&gt;</span> <span class=\"string\">(item=1)</span> <span class=\"string\">=&gt;</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\"><span class=\"attr\">    \"msg\":</span> <span class=\"string\">\"1\"</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"attr\">ok:</span> <span class=\"string\">[local]</span> <span class=\"string\">=&gt;</span> <span class=\"string\">(item=2)</span> <span class=\"string\">=&gt;</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\"><span class=\"attr\">    \"msg\":</span> <span class=\"string\">\"2\"</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"attr\">ok:</span> <span class=\"string\">[local]</span> <span class=\"string\">=&gt;</span> <span class=\"string\">(item=3)</span> <span class=\"string\">=&gt;</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\"><span class=\"attr\">    \"msg\":</span> <span class=\"string\">\"3\"</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>比如，在没有学会使用循环之前如果想要在同一主机中创建四个文件，但是学了循环后您只需要将建立的文件放入数组之中，然后迭代使用;</p>\n<p>循环常使用案例：<br><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># cat &gt; items1.yml &lt;&lt;END</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">- hosts:</span> <span class=\"string\">local</span></span><br><span class=\"line\"><span class=\"attr\">  remote_user:</span> <span class=\"string\">root</span></span><br><span class=\"line\"><span class=\"attr\">  gather_facts:</span> <span class=\"literal\">no</span></span><br><span class=\"line\"><span class=\"attr\">  vars:</span></span><br><span class=\"line\"><span class=\"attr\">    dirs:</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">\"/tmp/a\"</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">\"/tmp/b\"</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">\"/tmp/c\"</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">\"/tmp/d\"</span></span><br><span class=\"line\"><span class=\"attr\">  tasks:</span></span><br><span class=\"line\"><span class=\"attr\">  - file:</span></span><br><span class=\"line\"><span class=\"attr\">      path:</span> <span class=\"string\">\"<span class=\"template-variable\">&#123;&#123;item&#125;&#125;</span>\"</span>    <span class=\"comment\">#关键点1 （多次运行file模块 - 每一行运行一次）</span></span><br><span class=\"line\"><span class=\"attr\">      state:</span> <span class=\"string\">touch</span></span><br><span class=\"line\"><span class=\"attr\">    with_items:</span> <span class=\"string\">\"<span class=\"template-variable\">&#123;&#123;dirs&#125;&#125;</span>\"</span>  <span class=\"comment\">#重复的操作越多，使用循环则越方便  #关键点2</span></span><br><span class=\"line\"><span class=\"attr\">  - shell:</span> <span class=\"string\">\"whoami\"</span>     </span><br><span class=\"line\"><span class=\"attr\">    register:</span> <span class=\"string\">\"cmd\"</span></span><br><span class=\"line\"><span class=\"attr\">  - debug:</span></span><br><span class=\"line\"><span class=\"attr\">      msg:</span> <span class=\"string\">\"<span class=\"template-variable\">&#123;&#123;cmd[item]&#125;&#125;</span>\"</span>   <span class=\"comment\">#关键点3  shell模块命令遍历返回的信息</span></span><br><span class=\"line\"><span class=\"attr\">    with_items:</span> <span class=\"string\">\"<span class=\"template-variable\">&#123;&#123;cmd&#125;&#125;</span>\"</span>    <span class=\"comment\">#关键点4</span></span><br><span class=\"line\"><span class=\"attr\">  - debug:</span></span><br><span class=\"line\"><span class=\"attr\">      var:</span> <span class=\"string\">cmd[item]</span>   <span class=\"comment\">#关键点3  shell模块命令遍历返回的信息</span></span><br><span class=\"line\"><span class=\"attr\">    with_items:</span> <span class=\"string\">\"<span class=\"template-variable\">&#123;&#123;cmd&#125;&#125;</span>\"</span>    <span class=\"comment\">#关键点4</span></span><br><span class=\"line\"><span class=\"string\">END</span></span><br></pre></td></tr></table></figure></p>\n<p>(1)示例执行结果：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#循环建立文件</span></span><br><span class=\"line\">TASK [file]</span><br><span class=\"line\">changed: [<span class=\"built_in\">local</span>] =&gt; (item=/tmp/a)</span><br><span class=\"line\">changed: [<span class=\"built_in\">local</span>] =&gt; (item=/tmp/b)</span><br><span class=\"line\">changed: [<span class=\"built_in\">local</span>] =&gt; (item=/tmp/c)</span><br><span class=\"line\">changed: [<span class=\"built_in\">local</span>] =&gt; (item=/tmp/d)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#循环出来命令执行结果</span></span><br><span class=\"line\">TASK [debug]</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=changed) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=stdout) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: <span class=\"string\">\"root\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=delta) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: <span class=\"string\">\"0:00:00.022253\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=stdout_lines) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: [<span class=\"string\">\"root\"</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=end) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: <span class=\"string\">\"2019-08-01 10:47:41.760052\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=start) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: <span class=\"string\">\"2019-08-01 10:47:41.737799\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=cmd) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: <span class=\"string\">\"whoami\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=failed) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#debug vars执行返回的变量(有格式输出)</span></span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=changed) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"ansible_loop_var\"</span>: <span class=\"string\">\"item\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"cmd[item]\"</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"string\">\"item\"</span>: <span class=\"string\">\"changed\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=stdout) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"ansible_loop_var\"</span>: <span class=\"string\">\"item\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"cmd[item]\"</span>: <span class=\"string\">\"root\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"item\"</span>: <span class=\"string\">\"stdout\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">....... 其他忽略</span><br></pre></td></tr></table></figure></p>\n<p>采用循环我们也可以像file模块一样执行多个命令，<code>只需要将要执行的命令放入with_items关键字中</code>;</p>\n<p>循环输出方式2：<br><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># cat &gt; items2.yml &lt;&lt;END</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">- hosts:</span> <span class=\"string\">local</span></span><br><span class=\"line\"><span class=\"attr\">  remote_user:</span> <span class=\"string\">root</span></span><br><span class=\"line\"><span class=\"attr\">  vars:</span></span><br><span class=\"line\"><span class=\"attr\">    cmd:</span>   <span class=\"comment\">#关键点</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">\"hostname\"</span></span><br><span class=\"line\"><span class=\"bullet\">      -</span> <span class=\"string\">\"hostname -I\"</span></span><br><span class=\"line\"><span class=\"attr\">  gather_facts:</span> <span class=\"literal\">no</span></span><br><span class=\"line\"><span class=\"attr\">  tasks:</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">\"Mutil Shell Execute\"</span></span><br><span class=\"line\"><span class=\"attr\">    shell:</span> <span class=\"string\">\"<span class=\"template-variable\">&#123;&#123;item&#125;&#125;</span>\"</span>      <span class=\"comment\">#关键点</span></span><br><span class=\"line\"><span class=\"attr\">    with_items:</span> <span class=\"string\">\"<span class=\"template-variable\">&#123;&#123;cmd&#125;&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"attr\">    register:</span> <span class=\"string\">returncmd</span>  <span class=\"comment\">#会把多次执行的结果放入returncmd变量之中</span></span><br><span class=\"line\"><span class=\"attr\">  - debug:</span></span><br><span class=\"line\"><span class=\"attr\">      var:</span> <span class=\"string\">returncmd</span></span><br><span class=\"line\"><span class=\"comment\">#当使用了循环以后，每次shell模块执行后的返回值都会放入一个名为\"results\"的序列中，我们可以直接调用使用</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">\"show shell execute result\"</span></span><br><span class=\"line\"><span class=\"attr\">    debug:</span></span><br><span class=\"line\"><span class=\"attr\">      msg:</span> <span class=\"string\">\"<span class=\"template-variable\">&#123;&#123;item.stdout&#125;&#125;</span>\"</span>   <span class=\"comment\">#关键点</span></span><br><span class=\"line\"><span class=\"attr\">    with_items:</span> <span class=\"string\">\"<span class=\"template-variable\">&#123;&#123;returncmd.results&#125;&#125;</span>\"</span>   <span class=\"comment\">#关键点</span></span><br><span class=\"line\"><span class=\"comment\">#因为debug模块只是输出了经过jinja2的for循环处理过的信息而已，debug模块并没有因为for循环而被重复的调用</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">\"jinja2 syntax\"</span></span><br><span class=\"line\"><span class=\"attr\">    debug:</span></span><br><span class=\"line\"><span class=\"attr\">      msg:</span> <span class=\"string\">\"&#123;% for i in returncmd.results %&#125; <span class=\"template-variable\">&#123;&#123; i.stdout &#125;&#125;</span> &#123;% endfor %&#125;\"</span> <span class=\"comment\">#for循环的语法为jinja2语言中的for循环语法</span></span><br><span class=\"line\"><span class=\"string\">END</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#(2)执行结果：</span></span><br><span class=\"line\"><span class=\"string\">TASK</span> <span class=\"string\">[show</span> <span class=\"string\">shell</span> <span class=\"string\">execute</span> <span class=\"string\">result]</span></span><br><span class=\"line\"><span class=\"attr\">ok:</span> <span class=\"string\">[local]</span> <span class=\"string\">=&gt;</span> <span class=\"string\">(item=&#123;'stderr_lines':</span> <span class=\"string\">[],</span> <span class=\"string\">....</span> <span class=\"string\">,</span> <span class=\"string\">'stdout_lines'</span><span class=\"string\">:</span> <span class=\"string\">[u'master'],</span> <span class=\"string\">u'start':</span> <span class=\"string\">u'2019-08-01</span> <span class=\"number\">11</span><span class=\"string\">:17:55.900489'&#125;)</span> <span class=\"string\">=&gt;</span> <span class=\"string\">&#123;</span>   </span><br><span class=\"line\"><span class=\"attr\">   \"msg\":</span> <span class=\"string\">\"master\"</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"attr\">ok:</span> <span class=\"string\">[local]</span> <span class=\"string\">=&gt;</span> <span class=\"string\">(item=&#123;'stderr_lines':</span> <span class=\"string\">[],</span> <span class=\"string\">.....</span> <span class=\"string\">,</span> <span class=\"string\">'stdout_lines'</span><span class=\"string\">:</span> <span class=\"string\">[u'10.10.107.222</span> <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.99</span> <span class=\"string\">'], u'</span><span class=\"string\">start':</span> <span class=\"string\">u'2019-08-01</span> <span class=\"number\">11</span><span class=\"string\">:17:56.116440'&#125;)</span> <span class=\"string\">=&gt;</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\"><span class=\"attr\">    \"msg\":</span> <span class=\"string\">\"10.10.107.222 192.168.1.99 \"</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#jinja2 语法更加的精简</span></span><br><span class=\"line\"><span class=\"string\">TASK</span> <span class=\"string\">[jinja2</span> <span class=\"string\">syntax]</span></span><br><span class=\"line\"><span class=\"attr\">ok:</span> <span class=\"string\">[local]</span> <span class=\"string\">=&gt;</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\"><span class=\"attr\">    \"msg\":</span> <span class=\"string\">\" master  10.10.107.222 192.168.1.99  \"</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br></pre></td></tr></table></figure></p>\n<figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20190801110342.png\" alt=\"WeiyiGeek.returncmd\" title=\"\" class=\"\">\n                <p>WeiyiGeek.returncmd</p>\n            </figure>\n<p><br></p>\n<h5 id=\"with-list-关键字\"><a href=\"#with-list-关键字\" class=\"headerlink\" title=\"with_list 关键字\"></a>with_list 关键字</h5><p>前面我们说 with_items 会循环的输出列表（最外层大列表）中的每一项，按照之前的思路debug模块应该会将<code>每个小列表作为一个小整体输出，而不应该输出小列表中的每个元素</code>，但是事实却是with_items将嵌套在大列表中的每个小列表都\\”展开\\”了，并且将小列表中的元素都输出了</p>\n<p><em>如果我们想要将每个小列表作为一个整体输出该怎么办呢？</em><br>答: 那就需要我们的主人公 with_list关键字，可以将每个小列表作为一个整体输出;经过with_list处理后，每个嵌套在大列表中的小列表都被当做一个整体存放在item变量中，最终被debug作为一个小整体输出了，<code>而不会像with_items一样将小列表&quot;展开拉平&quot;后一并将小列表中的元素循环输出</code>。</p>\n<p>with_list语法:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#语法1：</span></span><br><span class=\"line\">  with_list:</span><br><span class=\"line\">  - [ 1, 2, 3 ]</span><br><span class=\"line\">  - [ a, b ]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#语法2:</span></span><br><span class=\"line\">  with_list:</span><br><span class=\"line\">    -</span><br><span class=\"line\">      - 1</span><br><span class=\"line\">      - 2</span><br><span class=\"line\">      - 3</span><br><span class=\"line\">    -</span><br><span class=\"line\">      - a</span><br><span class=\"line\">      - b</span><br></pre></td></tr></table></figure></p>\n<p>with_list关键字与with_items 与 with_flattened 关键字区别示例:<br><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># cat &gt; itemsVSlist.yml &lt;&lt;END</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">- hosts:</span> <span class=\"string\">local</span></span><br><span class=\"line\"><span class=\"attr\">  remote_user:</span> <span class=\"string\">root</span></span><br><span class=\"line\"><span class=\"attr\">  gather_facts:</span> <span class=\"literal\">no</span></span><br><span class=\"line\"><span class=\"attr\">  tasks:</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">\" with_list show\"</span></span><br><span class=\"line\"><span class=\"attr\">    debug:</span></span><br><span class=\"line\"><span class=\"attr\">      msg:</span> <span class=\"string\">\"<span class=\"template-variable\">&#123;&#123;item&#125;&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"attr\">    with_list:</span>    <span class=\"comment\">#关键点</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">[</span> <span class=\"number\">1</span><span class=\"string\">,</span> <span class=\"number\">2</span><span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">[</span> <span class=\"string\">a,</span> <span class=\"string\">b</span> <span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">\" with_items show\"</span></span><br><span class=\"line\"><span class=\"attr\">    debug:</span></span><br><span class=\"line\"><span class=\"attr\">      msg:</span> <span class=\"string\">\"<span class=\"template-variable\">&#123;&#123;item&#125;&#125;</span>\"</span> </span><br><span class=\"line\"><span class=\"attr\">    with_items:</span> <span class=\"comment\">#关键点</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">[</span> <span class=\"number\">1</span><span class=\"string\">,</span> <span class=\"number\">2</span> <span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">[</span> <span class=\"string\">a,</span> <span class=\"string\">b</span> <span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">\" with_flattened show\"</span></span><br><span class=\"line\"><span class=\"attr\">    debug:</span></span><br><span class=\"line\"><span class=\"attr\">      msg:</span> <span class=\"string\">\"<span class=\"template-variable\">&#123;&#123;item&#125;&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"attr\">    with_flattened:</span> <span class=\"comment\">#关键点</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">[</span> <span class=\"number\">1</span><span class=\"string\">,</span> <span class=\"number\">2</span> <span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">[</span> <span class=\"string\">a,</span> <span class=\"string\">b</span> <span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"string\">END</span></span><br></pre></td></tr></table></figure><br>执行结果：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TASK [with_list show]  <span class=\"comment\">#以列表为单位输出</span></span><br><span class=\"line\"><span class=\"comment\"># ok: [local] =&gt; (item=[1, 2]) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#     \"msg\": [</span></span><br><span class=\"line\"><span class=\"comment\">#         1,</span></span><br><span class=\"line\"><span class=\"comment\">#         2</span></span><br><span class=\"line\"><span class=\"comment\">#     ]</span></span><br><span class=\"line\"><span class=\"comment\"># &#125;</span></span><br><span class=\"line\"><span class=\"comment\"># ok: [local] =&gt; (item=[u'a', u'b']) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#     \"msg\": [</span></span><br><span class=\"line\"><span class=\"comment\">#         \"a\",</span></span><br><span class=\"line\"><span class=\"comment\">#         \"b\"</span></span><br><span class=\"line\"><span class=\"comment\">#     ]</span></span><br><span class=\"line\"><span class=\"comment\"># &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">TASK [with_items show / with_flattened show]   <span class=\"comment\">#会将元素单独输出</span></span><br><span class=\"line\"><span class=\"comment\"># ok: [local] =&gt; (item=1) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#     \"msg\": 1</span></span><br><span class=\"line\"><span class=\"comment\"># &#125;</span></span><br><span class=\"line\"><span class=\"comment\"># ok: [local] =&gt; (item=2) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#     \"msg\": 2</span></span><br><span class=\"line\"><span class=\"comment\"># &#125;</span></span><br><span class=\"line\"><span class=\"comment\"># ok: [local] =&gt; (item=a) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#     \"msg\": \"a\"</span></span><br><span class=\"line\"><span class=\"comment\"># &#125;</span></span><br><span class=\"line\"><span class=\"comment\"># ok: [local] =&gt; (item=b) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#     \"msg\": \"b\"</span></span><br><span class=\"line\"><span class=\"comment\"># &#125;</span></span><br></pre></td></tr></table></figure></p>\n<p>总结：</p>\n<ul>\n<li>当处理单层的简单列表时with_list与with_items以及没有任何区别，with_flattened 只有<code>在处理&quot;嵌套列表&quot;时才会体现出区别</code>;<ul>\n<li>with_items会将嵌套在内的小列表”拉平”，拉平后循环处理所有元素</li>\n<li>with_list则不会”拉平”嵌套的列表，只会循环的处理列表（最外层列表）中的每一项。</li>\n<li>with_flattened 与 with_items效果完全相同,将嵌套列表”拉平展开”，循环的处理每个元素</li>\n</ul>\n</li>\n</ul>\n<p><br></p>\n<h5 id=\"with-together-关键字\"><a href=\"#with-together-关键字\" class=\"headerlink\" title=\"with_together 关键字\"></a>with_together 关键字</h5><p>描述：目前为止我们了解了三个关键字可以用于循环操作，它们是with_list、with_items、with_flattened，下面引出一个新的<code>关键字 with_together 将两个列表中的元素&quot;对齐合并-一一对应&quot;</code></p>\n<p>playbook(剧本案例)：<br><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># cat &gt; withtogether.yml&lt;&lt;END</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">- hosts:</span> <span class=\"string\">local</span></span><br><span class=\"line\"><span class=\"attr\">  remote_user:</span> <span class=\"string\">root</span></span><br><span class=\"line\"><span class=\"attr\">  gather_facts:</span> <span class=\"literal\">no</span></span><br><span class=\"line\"><span class=\"attr\">  tasks:</span></span><br><span class=\"line\"><span class=\"attr\">  - debug:</span></span><br><span class=\"line\"><span class=\"attr\">      msg:</span> <span class=\"string\">\"<span class=\"template-variable\">&#123;&#123; item &#125;&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"attr\">    with_together:</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">[</span> <span class=\"number\">1</span><span class=\"string\">,</span> <span class=\"number\">2</span><span class=\"string\">,</span> <span class=\"number\">3</span> <span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">[</span> <span class=\"string\">a,</span> <span class=\"string\">b</span> <span class=\"string\">]</span></span><br><span class=\"line\"><span class=\"string\">END</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#执行结果</span></span><br><span class=\"line\"><span class=\"comment\"># ok: [local] =&gt; (item=[1, u'a']) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#     \"msg\": [</span></span><br><span class=\"line\"><span class=\"comment\">#         1,</span></span><br><span class=\"line\"><span class=\"comment\">#         \"a\"</span></span><br><span class=\"line\"><span class=\"comment\">#     ]</span></span><br><span class=\"line\"><span class=\"comment\"># &#125;</span></span><br><span class=\"line\"><span class=\"comment\"># ok: [local] =&gt; (item=[2, u'b']) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#     \"msg\": [</span></span><br><span class=\"line\"><span class=\"comment\">#         2,</span></span><br><span class=\"line\"><span class=\"comment\">#         \"b\"</span></span><br><span class=\"line\"><span class=\"comment\">#     ]</span></span><br><span class=\"line\"><span class=\"comment\"># &#125;</span></span><br><span class=\"line\"><span class=\"comment\"># ok: [local] =&gt; (item=[3, u'c']) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">#     \"msg\": [</span></span><br><span class=\"line\"><span class=\"comment\">#         3,</span></span><br><span class=\"line\"><span class=\"comment\">#         \"c\"</span></span><br><span class=\"line\"><span class=\"comment\">#     ]</span></span><br><span class=\"line\"><span class=\"comment\"># &#125;</span></span><br></pre></td></tr></table></figure></p>\n<p><em>从上述结果可以看出：</em></p>\n<ul>\n<li>第一个小列表中的第1个值与第二个小列表中的第1个值合并在一起输出了</li>\n<li>第一个小列表中的第2个值与第二个小列表中的第2个值合并在一起输出了</li>\n<li>第一个小列表中的第3个值与第二个小列表中的第3个值合并在一起输出了</li>\n<li>如果元素数量不同的小列表使用with_together对齐合并,<code>不存在列表中对应值将变成NULL</code>；<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[None, u<span class=\"string\">'c'</span>]) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: [</span><br><span class=\"line\">        null,   <span class=\"comment\">#列表元素数量不同 [1,2] [a, b, c]</span></span><br><span class=\"line\">        <span class=\"string\">\"c\"</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[3, None]) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: [</span><br><span class=\"line\">        3,</span><br><span class=\"line\">        null   <span class=\"comment\">#列表元素数量不同 [1,2,3] [a, b]</span></span><br><span class=\"line\">    ]</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<h5 id=\"with-cartesian-关键字\"><a href=\"#with-cartesian-关键字\" class=\"headerlink\" title=\"with_cartesian 关键字\"></a>with_cartesian 关键字</h5><p>描述：”with_cartesian”关键字的作用就是将每个小列表中的元素按照”笛卡尔的方式”组合后，循环的处理每个组合;其实还有一个关键字可以代替”with_cartesian”，<code>它就是&quot;with_nested&quot;与&quot;with_cartesian&quot;的效果一致</code>;</p>\n<p>比如：我们要再{a,b,c}目录下分别建立下面两个目录{test1, test2}，常规的用法可以采用<code># mkdir -p {a,b,c}/{test1,test2}</code>命令,再ansible采用shell模块执行:<code># ansible test70 -m shell -a &quot;mkdir -p /testdir/testdir/{a,b,c}/{test1,test2}&quot;</code></p>\n<p>但我们这里需要采用with_cartesian关键来实现上述效果：<br><figure class=\"image-box\">\n                <img src=\"https://img.weiyigeek.top/2019/1/20190801142628.png\" alt=\"WeiyiGeek.\" title=\"\" class=\"\">\n                <p>WeiyiGeek.</p>\n            </figure></p>\n<p>实际案例:<br><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># cat &gt; with_cartesian.yml&lt;&lt;END</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">- hosts:</span> <span class=\"string\">local</span></span><br><span class=\"line\"><span class=\"attr\">  remote_user:</span> <span class=\"string\">root</span></span><br><span class=\"line\"><span class=\"attr\">  gather_facts:</span> <span class=\"literal\">no</span></span><br><span class=\"line\"><span class=\"attr\">  tasks:</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">\"Show Create directory\"</span></span><br><span class=\"line\"><span class=\"attr\">    debug:</span></span><br><span class=\"line\"><span class=\"attr\">      msg:</span> <span class=\"string\">\"<span class=\"template-variable\">&#123;&#123; item &#125;&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"attr\">    with_cartesian:</span>   <span class=\"comment\">#关键点</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">[a,</span> <span class=\"string\">b,</span> <span class=\"string\">c]</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">[test1,</span> <span class=\"string\">test2]</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">\"shell create Directory\"</span></span><br><span class=\"line\"><span class=\"attr\">    file:</span></span><br><span class=\"line\"><span class=\"attr\">      path:</span> <span class=\"string\">\"/tmp/<span class=\"template-variable\">&#123;&#123;item.0&#125;&#125;</span>/<span class=\"template-variable\">&#123;&#123;item.1&#125;&#125;</span>\"</span>  <span class=\"comment\">#关键点</span></span><br><span class=\"line\"><span class=\"attr\">      state:</span> <span class=\"string\">directory</span></span><br><span class=\"line\"><span class=\"attr\">    with_cartesian:</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">[a,</span> <span class=\"string\">b,</span> <span class=\"string\">c]</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">[test1,</span> <span class=\"string\">test2]</span></span><br><span class=\"line\"><span class=\"string\">END</span></span><br></pre></td></tr></table></figure><br>执行结果：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#Debug msg情况 -&gt; 笛卡尔积</span></span><br><span class=\"line\">TASK [Show Create directory] </span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[u<span class=\"string\">'a'</span>, u<span class=\"string\">'test1'</span>]) =&gt; &#123;<span class=\"string\">\"msg\"</span>: [<span class=\"string\">\"a\"</span>,<span class=\"string\">\"test1\"</span>]&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[u<span class=\"string\">'a'</span>, u<span class=\"string\">'test2'</span>]) =&gt; &#123;<span class=\"string\">\"msg\"</span>: [<span class=\"string\">\"a\"</span>, <span class=\"string\">\"test2\"</span>]&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[u<span class=\"string\">'b'</span>, u<span class=\"string\">'test1'</span>]) =&gt; &#123;<span class=\"string\">\"msg\"</span>: [<span class=\"string\">\"b\"</span>,<span class=\"string\">\"test1\"</span>]&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[u<span class=\"string\">'b'</span>, u<span class=\"string\">'test2'</span>]) =&gt; &#123;<span class=\"string\">\"msg\"</span>: [<span class=\"string\">\"b\"</span>,<span class=\"string\">\"test2\"</span>]&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[u<span class=\"string\">'c'</span>, u<span class=\"string\">'test1'</span>]) =&gt; &#123;<span class=\"string\">\"msg\"</span>: [<span class=\"string\">\"c\"</span>,<span class=\"string\">\"test1\"</span>]&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[u<span class=\"string\">'c'</span>, u<span class=\"string\">'test2'</span>]) =&gt; &#123;<span class=\"string\">\"msg\"</span>: [<span class=\"string\">\"c\"</span>,<span class=\"string\">\"test2\"</span>]&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#创建的目录情况</span></span><br><span class=\"line\">TASK [shell create Directory] </span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[u<span class=\"string\">'a'</span>, u<span class=\"string\">'test1'</span>])</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[u<span class=\"string\">'a'</span>, u<span class=\"string\">'test2'</span>])</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[u<span class=\"string\">'b'</span>, u<span class=\"string\">'test1'</span>])</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[u<span class=\"string\">'b'</span>, u<span class=\"string\">'test2'</span>])</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[u<span class=\"string\">'c'</span>, u<span class=\"string\">'test1'</span>])</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[u<span class=\"string\">'c'</span>, u<span class=\"string\">'test2'</span>])</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h5 id=\"with-indexed-items-关键字\"><a href=\"#with-indexed-items-关键字\" class=\"headerlink\" title=\"with_indexed_items 关键字\"></a>with_indexed_items 关键字</h5><p>描述：顾名思义应该与”索引”有关,”with_indexed_items”的作用就是在循环处理列表时为列表中的<code>每一项添加&quot;数字索引&quot;，&quot;索引&quot;从0开始</code>.</p>\n<ul>\n<li>单层列表 ：按照顺序进行从0开始编号</li>\n<li>多层列表 ：会将嵌套的两层列表”拉平”后按照顺序为每一项编号，”拉平”效果跟之前总结的”with_flattened”效果类似;<ul>\n<li>但是当多加了一层嵌套以后”with_indexed_items”并不能像”with_flattened”一样将嵌套的列表”完全拉平”，<code>第二层列表中的项如果仍然是一个列表&quot;with_indexed_items&quot;则不会拉平这个列表，而是将其当做一个整体进行编号</code>。</li>\n</ul>\n</li>\n</ul>\n<p>基础示例：单层列表与多层列表<br><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># cat &gt; with_indexed_items.yml &lt;&lt;END</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">- hosts:</span> <span class=\"string\">local</span></span><br><span class=\"line\"><span class=\"attr\">  remote_user:</span> <span class=\"string\">root</span></span><br><span class=\"line\"><span class=\"attr\">  gather_facts:</span> <span class=\"literal\">no</span></span><br><span class=\"line\"><span class=\"attr\">  tasks:</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">\"Example play 1\"</span></span><br><span class=\"line\"><span class=\"attr\">    debug:</span></span><br><span class=\"line\"><span class=\"attr\">      msg:</span> <span class=\"string\">\"E.g 1: index is : <span class=\"template-variable\">&#123;&#123; item.0 &#125;&#125;</span> , value is <span class=\"template-variable\">&#123;&#123; item.1 &#125;&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"attr\">    with_indexed_items:</span>  <span class=\"comment\">#将添加过编号的每一项放入到了item中,简单的单层列表</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">test1</span>  <span class=\"comment\">#test1索引编号是0</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">test2</span>  <span class=\"comment\">#test2索引编号是1</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">test3</span>  <span class=\"comment\">#test3索引编号是2</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">\"Example play 2\"</span></span><br><span class=\"line\"><span class=\"attr\">    debug:</span></span><br><span class=\"line\"><span class=\"attr\">      msg:</span> <span class=\"string\">\"E.g 2: index is : <span class=\"template-variable\">&#123;&#123; item.0 &#125;&#125;</span> , value is <span class=\"template-variable\">&#123;&#123; item.1 &#125;&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"attr\">    with_indexed_items:</span>  <span class=\"comment\">#多层列表与with_flattened效果类似进行拉升</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">[a,b,c]</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">[test1,</span> <span class=\"string\">test2]</span></span><br><span class=\"line\"><span class=\"attr\">  - name:</span> <span class=\"string\">\"Example play 3\"</span></span><br><span class=\"line\"><span class=\"attr\">    debug:</span></span><br><span class=\"line\"><span class=\"attr\">      msg:</span> <span class=\"string\">\"E.g 3: index is : <span class=\"template-variable\">&#123;&#123; item.0 &#125;&#125;</span> , value is <span class=\"template-variable\">&#123;&#123; item.1 &#125;&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"attr\">    with_indexed_items:</span> <span class=\"comment\">#多层列表但是列表中镶嵌列表 （特殊重点）</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">[a,b]</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">[c,</span> <span class=\"string\">[d,e]]</span></span><br><span class=\"line\"><span class=\"bullet\">    -</span> <span class=\"string\">[end]</span></span><br><span class=\"line\"><span class=\"string\">END</span></span><br></pre></td></tr></table></figure><br>执行结果：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#TASK [Example play 1] </span></span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[0, u<span class=\"string\">'test1'</span>]) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"E.g 1: index is : 0 , value is test1\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[1, u<span class=\"string\">'test2'</span>]) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"E.g 1: index is : 1 , value is test2\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[2, u<span class=\"string\">'test3'</span>]) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"E.g 1: index is : 2 , value is test3\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#TASK [Example play 2] </span></span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[0, u<span class=\"string\">'a'</span>]) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"E.g 2: index is : 0 , value is a\"</span></span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[1, u<span class=\"string\">'b'</span>]) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"E.g 2: index is : 1 , value is b\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[2, u<span class=\"string\">'c'</span>]) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"E.g 2: index is : 2 , value is c\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[3, u<span class=\"string\">'test1'</span>]) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"E.g 2: index is : 3 , value is test1\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[4, u<span class=\"string\">'test2'</span>]) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"E.g 2: index is : 4 , value is test2\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#TASK [Example play 3] </span></span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[0, u<span class=\"string\">'a'</span>]) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"E.g 3: index is : 0 , value is a\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[1, u<span class=\"string\">'b'</span>]) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"E.g 3: index is : 1 , value is b\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[2, u<span class=\"string\">'c'</span>]) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"E.g 3: index is : 2 , value is c\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[3, [u<span class=\"string\">'d'</span>, u<span class=\"string\">'e'</span>]]) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"E.g 3: index is : 3 , value is [u'd', u'e']\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[4, u<span class=\"string\">'end'</span>]) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"E.g 3: index is : 4 , value is end\"</span>&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h5 id=\"with-sequence-关键字\"><a href=\"#with-sequence-关键字\" class=\"headerlink\" title=\"with_sequence 关键字\"></a>with_sequence 关键字</h5><p>描述：采用with_sequence关键字，可以指定开始与结束并且可以指定step步跳,即可以帮助我们按照顺序生成数字序列;<br><code>&quot;with_sequence&quot;还有一个小功能</code>，就是\\”格式化\\”输出数据的功能，\\”格式化数据\\”的方法与C语言的printf函数的使用方法类似，</p>\n<p>基础案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># cat &gt;with_sequence.yml&lt;&lt;END</span></span><br><span class=\"line\">---</span><br><span class=\"line\">- hosts: <span class=\"built_in\">local</span></span><br><span class=\"line\">  remote_user: root</span><br><span class=\"line\">  gather_facts: no</span><br><span class=\"line\">  tasks:</span><br><span class=\"line\">  - name: <span class=\"string\">\"Method 1\"</span></span><br><span class=\"line\">    debug:</span><br><span class=\"line\">      msg: <span class=\"string\">\"&#123;&#123; item &#125;&#125;\"</span></span><br><span class=\"line\">    with_sequence: start=1 end=3 stride=1</span><br><span class=\"line\">    <span class=\"comment\">#其中start=1表示从1开始，end=3表示到5结束，stride=1表示步长为1，即从1到5每次增加1</span></span><br><span class=\"line\">  - name: <span class=\"string\">\"Method 2\"</span></span><br><span class=\"line\">    debug:</span><br><span class=\"line\">      msg: <span class=\"string\">\"&#123;&#123; item &#125;&#125;\"</span></span><br><span class=\"line\">    with_sequence: count=3</span><br><span class=\"line\">    <span class=\"comment\">#count=5表示数字序列默认从1开始，到3结束，默认步长为1，与上述两种写法的效果相同</span></span><br><span class=\"line\">  - name: <span class=\"string\">\"Demo 3\"</span></span><br><span class=\"line\">    debug: </span><br><span class=\"line\">      msg: <span class=\"string\">\"&#123;&#123; item &#125;&#125;\"</span>  <span class=\"comment\">#\" %0.2f\"表示将数字格式化为一个保留两位小数点的浮点数</span></span><br><span class=\"line\">    with_sequence: start=6 end=2 stride=-2 format=<span class=\"string\">\"number is %0.2f\"</span>   <span class=\"comment\">#关键点</span></span><br><span class=\"line\">  - name: <span class=\"string\">\"Demo 4 - Create dir\"</span></span><br><span class=\"line\">    file:</span><br><span class=\"line\">      path: <span class=\"string\">\"/tmp/test&#123;&#123; item &#125;&#125;\"</span></span><br><span class=\"line\">      state: directory</span><br><span class=\"line\">    with_sequence:</span><br><span class=\"line\">      start=2</span><br><span class=\"line\">      end=10</span><br><span class=\"line\">      stride=2</span><br><span class=\"line\">END</span><br></pre></td></tr></table></figure><br>执行结果：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#TASK [Method 1 / Method 1]</span></span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=1) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"1\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=2) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"2\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=3) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"3\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#TASK [Demo 3] </span></span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=number is 6.00) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"number is 6.00\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=number is 4.00) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"number is 4.00\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=number is 2.00) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"number is 2.00\"</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#TASK [Demo 4 - Create dir]</span></span><br><span class=\"line\">changed: [<span class=\"built_in\">local</span>] =&gt; (item=2)</span><br><span class=\"line\">changed: [<span class=\"built_in\">local</span>] =&gt; (item=4)</span><br><span class=\"line\">changed: [<span class=\"built_in\">local</span>] =&gt; (item=6)</span><br><span class=\"line\">changed: [<span class=\"built_in\">local</span>] =&gt; (item=8)</span><br><span class=\"line\">changed: [<span class=\"built_in\">local</span>] =&gt; (item=10)</span><br></pre></td></tr></table></figure></p>\n<p>总结：</p>\n<ul>\n<li>当我们不指定stride的值时，stride的值默认为1;</li>\n<li>当end的值小于start的值时，则必须指定stride的值，而且stride的值必须是负数;</li>\n</ul>\n<p><br></p>\n<h5 id=\"with-random-choice-关键字\"><a href=\"#with-random-choice-关键字\" class=\"headerlink\" title=\"with_random_choice 关键字\"></a>with_random_choice 关键字</h5><p>描述:可以从列表的多个值中随机返回一个值;</p>\n<p>我们使用\\”with_random_choice\\”处理这个列表,可以看出每次返回的结果是从列表中随机选中的一个<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># cat &gt;with_random_choice.yml&lt;&lt;END</span></span><br><span class=\"line\">---</span><br><span class=\"line\">- hosts: <span class=\"built_in\">local</span></span><br><span class=\"line\">  remote_user: root</span><br><span class=\"line\">  gather_facts: no</span><br><span class=\"line\">  tasks:</span><br><span class=\"line\">  - debug:</span><br><span class=\"line\">      msg: <span class=\"string\">\"&#123;&#123; item &#125;&#125;\"</span></span><br><span class=\"line\">    with_random_choice:</span><br><span class=\"line\">    - <span class=\"string\">\"one\"</span></span><br><span class=\"line\">    - 2</span><br><span class=\"line\">    - <span class=\"string\">\"three\"</span></span><br><span class=\"line\">    - 4</span><br><span class=\"line\">    - <span class=\"string\">\"five\"</span></span><br><span class=\"line\">END</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#执行结果(随机列表)</span></span><br><span class=\"line\">TASK [debug]</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=three) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: <span class=\"string\">\"three\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h5 id=\"with-dict-关键字\"><a href=\"#with-dict-关键字\" class=\"headerlink\" title=\"with_dict 关键字\"></a>with_dict 关键字</h5><p>描述：从字面意思就可看出，它是可以遍历对象的即字典类型的，分别将字典的key与value进行存储并且支持迭代;</p>\n<p>基础案例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># cat &gt;with_dict.yml&lt;&lt;END</span></span><br><span class=\"line\">---</span><br><span class=\"line\">- hosts: <span class=\"built_in\">local</span></span><br><span class=\"line\">  remote_user: root</span><br><span class=\"line\">  gather_facts: no</span><br><span class=\"line\">  vars:</span><br><span class=\"line\">    users:</span><br><span class=\"line\">      WeiyiGeek: female</span><br><span class=\"line\">      Baby_ang: male</span><br><span class=\"line\">  tasks:</span><br><span class=\"line\">  - name: <span class=\"string\">\"Demo 1.dict\"</span></span><br><span class=\"line\">    debug:</span><br><span class=\"line\">      msg: <span class=\"string\">\"Username: &#123;&#123; item.key &#125;&#125; , User's gender: &#123;&#123; item.value &#125;&#125;\"</span></span><br><span class=\"line\">    with_dict: <span class=\"string\">\"&#123;&#123;users&#125;&#125;\"</span></span><br><span class=\"line\">  - name: <span class=\"string\">\"Demo 2.dict\"</span></span><br><span class=\"line\">    debug:  <span class=\"comment\">#关键点</span></span><br><span class=\"line\">      msg: <span class=\"string\">\"Item: &#123;&#123; item.key &#125;&#125;, Username: &#123;&#123; item.value['name'] &#125;&#125; , User's gender: &#123;&#123; item.value.gender &#125;&#125; , User's Telephone: &#123;&#123; item.value.telephone &#125;&#125;\"</span></span><br><span class=\"line\">    with_dict:</span><br><span class=\"line\">      alice:</span><br><span class=\"line\">        name: Alice Appleworth</span><br><span class=\"line\">        gender: female</span><br><span class=\"line\">        telephone: 123-456-7890</span><br><span class=\"line\">      bob:</span><br><span class=\"line\">        name: Bob Bananarama</span><br><span class=\"line\">        gender: male</span><br><span class=\"line\">        telephone: 987-654-3210</span><br><span class=\"line\">END</span><br></pre></td></tr></table></figure><br>执行结果：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#TASK [Demo 1.dict] </span></span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=&#123;<span class=\"string\">'value'</span>: u<span class=\"string\">'male'</span>, <span class=\"string\">'key'</span>: u<span class=\"string\">'Baby_ang'</span>&#125;) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: <span class=\"string\">\"Username: Baby_ang , User's gender: male\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=&#123;<span class=\"string\">'value'</span>: u<span class=\"string\">'female'</span>, <span class=\"string\">'key'</span>: u<span class=\"string\">'WeiyiGeek'</span>&#125;) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: <span class=\"string\">\"Username: WeiyiGeek , User's gender: female\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#TASK [Demo 2.dict]</span></span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=&#123;<span class=\"string\">'value'</span>: &#123;u<span class=\"string\">'gender'</span>: u<span class=\"string\">'male'</span>, u<span class=\"string\">'name'</span>: u<span class=\"string\">'Bob Bananarama'</span>, u<span class=\"string\">'telephone'</span>: u<span class=\"string\">'987-654-3210'</span>&#125;, <span class=\"string\">'key'</span>: u<span class=\"string\">'bob'</span>&#125;) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: <span class=\"string\">\"Item: bob, Username: Bob Bananarama , User's gender: male , User's Telephone: 987-654-3210\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=&#123;<span class=\"string\">'value'</span>: &#123;u<span class=\"string\">'gender'</span>: u<span class=\"string\">'female'</span>, u<span class=\"string\">'name'</span>: u<span class=\"string\">'Alice Appleworth'</span>, u<span class=\"string\">'telephone'</span>: u<span class=\"string\">'123-456-7890'</span>&#125;, <span class=\"string\">'key'</span>: u<span class=\"string\">'alice'</span>&#125;) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: <span class=\"string\">\"Item: alice, Username: Alice Appleworth , User's gender: female , User's Telephone: 123-456-7890\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h5 id=\"with-subelements-关键字\"><a href=\"#with-subelements-关键字\" class=\"headerlink\" title=\"with_subelements 关键字\"></a>with_subelements 关键字</h5><p>描述：该关键字支持复合类型的字典；”with_subelements”的以处理一个的复合结构的字典数据，在处理这个字典的同时，需要指定一个子元素，这个子元素的值必须是一个列表，”with_subelements”会将子元素的列表中的每一项作为一个整体，将其他子元素作为一个整体，然后将两个整体组合成item。</p>\n<p>基础案例：<br>由于item由两个整体组成，所以我们通过item.0获取到第一个小整体，即gender和name属性，然后通过item.1获取到第二个小整体，即hobby列表中的每一项；<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># cat &gt;with_subelement.yml&lt;&lt;END</span></span><br><span class=\"line\">---</span><br><span class=\"line\">- hosts: <span class=\"built_in\">local</span></span><br><span class=\"line\">  remote_user: root</span><br><span class=\"line\">  gather_facts: no</span><br><span class=\"line\">  vars:</span><br><span class=\"line\">    users:</span><br><span class=\"line\">    - name: WeiyiGeek</span><br><span class=\"line\">      gender: male</span><br><span class=\"line\">      hobby:</span><br><span class=\"line\">        - Skateboard</span><br><span class=\"line\">        - VideoGame</span><br><span class=\"line\">    - name: Xiaodaigua</span><br><span class=\"line\">      gender: female</span><br><span class=\"line\">      hobby:</span><br><span class=\"line\">        - Music</span><br><span class=\"line\">  tasks:</span><br><span class=\"line\">  - debug:</span><br><span class=\"line\">      msg: <span class=\"string\">\"&#123;&#123; item.0.name &#125;&#125; 's hobby is &#123;&#123; item.1 &#125;&#125; , User's Gender is &#123;&#123; item.0.gender&#125;&#125;\"</span>  <span class=\"comment\">#关键点(变成子对象元素，既可以分别可以将两个字典进行整合)</span></span><br><span class=\"line\">    with_subelements:</span><br><span class=\"line\">    - <span class=\"string\">\"&#123;&#123;users&#125;&#125;\"</span></span><br><span class=\"line\">    - hobby  <span class=\"comment\">#关键点，整合后实际是vars中 &#123;&#123;item&#125;&#125;.hobby</span></span><br><span class=\"line\">END</span><br></pre></td></tr></table></figure></p>\n<p>执行结果:<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#TASK [debug] </span></span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[&#123;u<span class=\"string\">'gender'</span>: u<span class=\"string\">'male'</span>, u<span class=\"string\">'name'</span>: u<span class=\"string\">'WeiyiGeek'</span>&#125;, u<span class=\"string\">'Skateboard'</span>]) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: <span class=\"string\">\"WeiyiGeek 's hobby is Skateboard , User's Gender is male\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[&#123;u<span class=\"string\">'gender'</span>: u<span class=\"string\">'male'</span>, u<span class=\"string\">'name'</span>: u<span class=\"string\">'WeiyiGeek'</span>&#125;, u<span class=\"string\">'VideoGame'</span>]) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: <span class=\"string\">\"WeiyiGeek 's hobby is VideoGame , User's Gender is male\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=[&#123;u<span class=\"string\">'gender'</span>: u<span class=\"string\">'female'</span>, u<span class=\"string\">'name'</span>: u<span class=\"string\">'Xiaodaigua'</span>&#125;, u<span class=\"string\">'Music'</span>]) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: <span class=\"string\">\"Xiaodaigua 's hobby is Music , User's Gender is female\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h5 id=\"with-file-关键字\"><a href=\"#with-file-关键字\" class=\"headerlink\" title=\"with_file 关键字\"></a>with_file 关键字</h5><p>描述：循环的获取到ansible主机中的文件的内容,注意不是远程目标主机中的文件;</p>\n<p>基础示例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># cat &gt; with_file.yml&lt;&lt;END</span></span><br><span class=\"line\">---</span><br><span class=\"line\">- hosts: <span class=\"built_in\">local</span></span><br><span class=\"line\">  remote_user: root</span><br><span class=\"line\">  gather_facts: no</span><br><span class=\"line\">  tasks:</span><br><span class=\"line\">  - debug:</span><br><span class=\"line\">      msg: <span class=\"string\">\"&#123;&#123; item &#125;&#125;\"</span></span><br><span class=\"line\">    with_file:  <span class=\"comment\">#可以通过\"with_file\"关键字获取到ansible主机中的文件内容</span></span><br><span class=\"line\">    - /tmp/demo1.txt  <span class=\"comment\">#ansbile主机上的文件</span></span><br><span class=\"line\">    - /tmp/demo2.txt</span><br><span class=\"line\">END</span><br></pre></td></tr></table></figure></p>\n<p>执行结果：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#TASK [debug]</span></span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=.....) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: <span class=\"string\">\"master\\n10.10.107.222 192.168.1.99 \\nMon Aug  5 16:29:39 CST 2019\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=.....) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"string\">\"msg\"</span>: <span class=\"string\">\"Linux master 3.10.0-957.12.2.el7.x86_64 #1 SMP Tue May 14 21:24:32 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br></p>\n<h5 id=\"with-fileglob-关键字\"><a href=\"#with-fileglob-关键字\" class=\"headerlink\" title=\"with_fileglob 关键字\"></a>with_fileglob 关键字</h5><p>描述: 是用来匹配文件名称的，我们可以通过”with_fileglob”关键字，在指定的目录中匹配符合模式的文件名；<br>注意: “with_fileglob”只会匹配指定目录中的文件，而不会匹配指定目录中的目录。</p>\n<p>比如:我们定义了一个列表，这个列表中只有一个值是一个路径，路径中包含一个通配符，如”/testdir/*”应该代表了/testdir目录中的所有文件；<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#常用通配符</span></span><br><span class=\"line\">- *</span><br><span class=\"line\">- ?</span><br></pre></td></tr></table></figure></p>\n<p>基础示例：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># cat &gt;with_fileglob.yml&lt;&lt;END</span></span><br><span class=\"line\">---</span><br><span class=\"line\">- hosts: <span class=\"built_in\">local</span></span><br><span class=\"line\">  remote_user: root</span><br><span class=\"line\">  gather_facts: no</span><br><span class=\"line\">  tasks:</span><br><span class=\"line\">  - debug:</span><br><span class=\"line\">      msg: <span class=\"string\">\"&#123;&#123; item &#125;&#125;\"</span></span><br><span class=\"line\">    with_fileglob:  <span class=\"comment\">#可以通过\"with_file\"关键字获取到ansible主机中的文件内容</span></span><br><span class=\"line\">    - /tmp/demo*.???  <span class=\"comment\">#ansbile主机上的文件</span></span><br><span class=\"line\">    - /root/*</span><br><span class=\"line\">END</span><br></pre></td></tr></table></figure><br>执行结果：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#TASK [debug] </span></span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=/tmp/demo1.txt) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"/tmp/demo1.txt\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=/tmp/demo2.txt) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"/tmp/demo2.txt\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=/root/with_dict.yml) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"/root/with_dict.yml\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=/root/with_subelement.yml) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"/root/with_subelement.yml\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=/root/with_fileglob.yml) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"/root/with_fileglob.yml\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=/root/with_sequence.yml) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"/root/with_sequence.yml\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=/root/with_random_choice.yml) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"/root/with_random_choice.yml\"</span>&#125;</span><br><span class=\"line\">ok: [<span class=\"built_in\">local</span>] =&gt; (item=/root/with_file.yml) =&gt; &#123;<span class=\"string\">\"msg\"</span>: <span class=\"string\">\"/root/with_file.yml\"</span>&#125;</span><br></pre></td></tr></table></figure><br>执行上面的playbook后，会将满足通配符的文件都会被匹配到最终循环的被debug模块输出;</p>\n","comments":true,"excerpt":"[TOC]","categories":[{"name":"自动化运维","path":"api/categories/自动化运维.json"},{"name":"运维基础","path":"api/categories/运维基础.json"}],"tags":[{"name":"Ansible","path":"api/tags/Ansible.json"}]}